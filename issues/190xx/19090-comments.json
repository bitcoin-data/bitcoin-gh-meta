[
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2020-05-28T13:16:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19090#issuecomment-635343332",
      "id" : 635343332,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19090",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNTM0MzMzMg==",
      "updated_at" : "2020-05-28T13:16:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/635343332",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19090#discussion_r431826785"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431826785"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Might be better to have something like:\r\n\r\n```c++\r\n    // Tell any threads running serviceQueue to stop as soon as they are\r\n    // done servicing whatever task they are currently servicing.\r\n    void stop_immediately();\r\n\r\n    // Tell any threads running serviceQueue to stop as soon as\r\n    // there is no work left to be done.\r\n    void stop_when_drained();\r\n```",
      "commit_id" : "fa8337fcdbcab8368d5bf111c4b2e5acf25e6e22",
      "created_at" : "2020-05-28T13:17:25Z",
      "diff_hunk" : "@@ -73,10 +73,10 @@ class CScheduler\n     // and interrupted using boost::interrupt_thread\n     void serviceQueue();\n \n-    // Tell any threads running serviceQueue to stop as soon as they're\n-    // done servicing whatever task they're currently servicing (drain=false)\n+    // Tell any threads running serviceQueue to stop as soon as they are\n+    // done servicing whatever task they are currently servicing (drain=false)\n     // or when there is no work left to be done (drain=true)\n-    void stop(bool drain=false);\n+    void stop(bool drain);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19090#discussion_r431826785",
      "id" : 431826785,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgyNjc4NQ==",
      "original_commit_id" : "fafaf24446653bd585e723edc120198b30c78b17",
      "original_line" : 79,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/scheduler.h",
      "position" : null,
      "pull_request_review_id" : 420096088,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19090",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-21T10:03:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431826785",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19090#discussion_r431828224"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431828224"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hmm, I kind-of think that comment's helpful.",
      "commit_id" : "fa8337fcdbcab8368d5bf111c4b2e5acf25e6e22",
      "created_at" : "2020-05-28T13:19:34Z",
      "diff_hunk" : "@@ -62,8 +61,6 @@ class CScheduler\n      */\n     void MockForward(std::chrono::seconds delta_seconds);\n \n-    // To keep things as simple as possible, there is no unschedule.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19090#discussion_r431828224",
      "id" : 431828224,
      "line" : 70,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgyODIyNA==",
      "original_commit_id" : "fa5240025766423b2ed645f31bb621b3f1969f59",
      "original_line" : 70,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/scheduler.h",
      "position" : 67,
      "pull_request_review_id" : 420096088,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19090",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-21T10:03:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431828224",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19090#discussion_r431831911"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431831911"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This should be clear from our general policy that everything should be as minimal as possible and that unused features should not be implemented.\r\n\r\nIf the comment is brought back, I'd prefer the alternative version:\r\n\r\n```cpp\r\n     // To keep things as simple as possible, there is no unschedule and the scheduler can not schedule events on your electronic barista",
      "commit_id" : "fa8337fcdbcab8368d5bf111c4b2e5acf25e6e22",
      "created_at" : "2020-05-28T13:25:16Z",
      "diff_hunk" : "@@ -62,8 +61,6 @@ class CScheduler\n      */\n     void MockForward(std::chrono::seconds delta_seconds);\n \n-    // To keep things as simple as possible, there is no unschedule.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19090#discussion_r431831911",
      "id" : 431831911,
      "in_reply_to_id" : 431828224,
      "line" : 70,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgzMTkxMQ==",
      "original_commit_id" : "fa5240025766423b2ed645f31bb621b3f1969f59",
      "original_line" : 70,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/scheduler.h",
      "position" : 67,
      "pull_request_review_id" : 420102899,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19090",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-21T10:03:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431831911",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19090#discussion_r431832161"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431832161"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sure, will do that",
      "commit_id" : "fa8337fcdbcab8368d5bf111c4b2e5acf25e6e22",
      "created_at" : "2020-05-28T13:25:39Z",
      "diff_hunk" : "@@ -73,10 +73,10 @@ class CScheduler\n     // and interrupted using boost::interrupt_thread\n     void serviceQueue();\n \n-    // Tell any threads running serviceQueue to stop as soon as they're\n-    // done servicing whatever task they're currently servicing (drain=false)\n+    // Tell any threads running serviceQueue to stop as soon as they are\n+    // done servicing whatever task they are currently servicing (drain=false)\n     // or when there is no work left to be done (drain=true)\n-    void stop(bool drain=false);\n+    void stop(bool drain);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19090#discussion_r431832161",
      "id" : 431832161,
      "in_reply_to_id" : 431826785,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgzMjE2MQ==",
      "original_commit_id" : "fafaf24446653bd585e723edc120198b30c78b17",
      "original_line" : 79,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/scheduler.h",
      "position" : null,
      "pull_request_review_id" : 420103265,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19090",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-21T10:03:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431832161",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19090#discussion_r431889410"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431889410"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "fa8337fcdbcab8368d5bf111c4b2e5acf25e6e22",
      "created_at" : "2020-05-28T14:39:34Z",
      "diff_hunk" : "@@ -73,10 +73,10 @@ class CScheduler\n     // and interrupted using boost::interrupt_thread\n     void serviceQueue();\n \n-    // Tell any threads running serviceQueue to stop as soon as they're\n-    // done servicing whatever task they're currently servicing (drain=false)\n+    // Tell any threads running serviceQueue to stop as soon as they are\n+    // done servicing whatever task they are currently servicing (drain=false)\n     // or when there is no work left to be done (drain=true)\n-    void stop(bool drain=false);\n+    void stop(bool drain);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19090#discussion_r431889410",
      "id" : 431889410,
      "in_reply_to_id" : 431826785,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg4OTQxMA==",
      "original_commit_id" : "fafaf24446653bd585e723edc120198b30c78b17",
      "original_line" : 79,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/scheduler.h",
      "position" : null,
      "pull_request_review_id" : 420181117,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19090",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-21T10:03:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431889410",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19090#discussion_r431922496"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431922496"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If you're changing this, perhaps make it a unique_ptr to indicate unique ownership?",
      "commit_id" : "fa8337fcdbcab8368d5bf111c4b2e5acf25e6e22",
      "created_at" : "2020-05-28T15:23:28Z",
      "diff_hunk" : "@@ -5,36 +5,30 @@\n #ifndef BITCOIN_SCHEDULER_H\n #define BITCOIN_SCHEDULER_H\n \n-//\n-// NOTE:\n-// boost::thread should be ported to std::thread\n-// when we support C++11.\n-//\n #include <condition_variable>\n #include <functional>\n #include <list>\n #include <map>\n \n #include <sync.h>\n \n-//\n-// Simple class for background tasks that should be run\n-// periodically or once \"after a while\"\n-//\n-// Usage:\n-//\n-// CScheduler* s = new CScheduler();\n-// s->scheduleFromNow(doSomething, std::chrono::milliseconds{11}); // Assuming a: void doSomething() { }\n-// s->scheduleFromNow([=] { this->func(argument); }, std::chrono::milliseconds{3});\n-// boost::thread* t = new boost::thread(std::bind(CScheduler::serviceQueue, s));\n-//\n-// ... then at program shutdown, make sure to call stop() to clean up the thread(s) running serviceQueue:\n-// s->stop();\n-// t->join();\n-// delete t;\n-// delete s; // Must be done after thread is interrupted/joined.\n-//\n-\n+/**\n+ * Simple class for background tasks that should be run\n+ * periodically or once \"after a while\"\n+ *\n+ * Usage:\n+ *\n+ * CScheduler* s = new CScheduler();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19090#discussion_r431922496",
      "id" : 431922496,
      "line" : 21,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTkyMjQ5Ng==",
      "original_commit_id" : "fae1ef5e7bf3f0b6d1d181b77b9dc7a3bb0486dc",
      "original_line" : 21,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/scheduler.h",
      "position" : 40,
      "pull_request_review_id" : 420225225,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19090",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-21T10:03:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431922496",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19090#discussion_r431945705"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431945705"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is a really good change. Explicitly naming these functions makes it much clearer at the call site.\r\n\r\nDo you think a follow-up should remove the `StopWhenDrained()` function entirely? It's only used in tests.",
      "commit_id" : "fa8337fcdbcab8368d5bf111c4b2e5acf25e6e22",
      "created_at" : "2020-05-28T15:55:46Z",
      "diff_hunk" : "@@ -67,23 +61,32 @@ class CScheduler\n      */\n     void MockForward(std::chrono::seconds delta_seconds);\n \n-    // To keep things as simple as possible, there is no unschedule.\n-\n-    // Services the queue 'forever'. Should be run in a thread,\n-    // and interrupted using boost::interrupt_thread\n+    /**\n+     * Services the queue 'forever'. Should be run in a thread,\n+     * and interrupted using boost::interrupt_thread\n+     */\n     void serviceQueue();\n \n-    // Tell any threads running serviceQueue to stop as soon as they're\n-    // done servicing whatever task they're currently servicing (drain=false)\n-    // or when there is no work left to be done (drain=true)\n-    void stop(bool drain=false);\n+    /** Tell any threads running serviceQueue to stop as soon as the current task is done */\n+    void StopImmediately()\n+    {\n+        WITH_LOCK(newTaskMutex, stopRequested = true);\n+        newTaskScheduled.notify_all();\n+    }\n+    /** Tell any threads running serviceQueue to stop when there is no work left to be done */\n+    void StopWhenDrained()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19090#discussion_r431945705",
      "id" : 431945705,
      "line" : 77,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk0NTcwNQ==",
      "original_commit_id" : "fae1ef5e7bf3f0b6d1d181b77b9dc7a3bb0486dc",
      "original_line" : 77,
      "original_position" : 88,
      "original_start_line" : null,
      "path" : "src/scheduler.h",
      "position" : 88,
      "pull_request_review_id" : 420225225,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19090",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-21T10:03:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431945705",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19090#discussion_r431961148"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431961148"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I find it more readable to to have the arguments split over multiple lines, though I guess that means I should open a PR to remove `AllowAllParametersOfDeclarationOnNextLine: false` from `.clang-format`?",
      "commit_id" : "fa8337fcdbcab8368d5bf111c4b2e5acf25e6e22",
      "created_at" : "2020-05-28T16:17:58Z",
      "diff_hunk" : "@@ -67,23 +61,32 @@ class CScheduler\n      */\n     void MockForward(std::chrono::seconds delta_seconds);\n \n-    // To keep things as simple as possible, there is no unschedule.\n-\n-    // Services the queue 'forever'. Should be run in a thread,\n-    // and interrupted using boost::interrupt_thread\n+    /**\n+     * Services the queue 'forever'. Should be run in a thread,\n+     * and interrupted using boost::interrupt_thread\n+     */\n     void serviceQueue();\n \n-    // Tell any threads running serviceQueue to stop as soon as they're\n-    // done servicing whatever task they're currently servicing (drain=false)\n-    // or when there is no work left to be done (drain=true)\n-    void stop(bool drain=false);\n+    /** Tell any threads running serviceQueue to stop as soon as the current task is done */\n+    void StopImmediately()\n+    {\n+        WITH_LOCK(newTaskMutex, stopRequested = true);\n+        newTaskScheduled.notify_all();\n+    }\n+    /** Tell any threads running serviceQueue to stop when there is no work left to be done */\n+    void StopWhenDrained()\n+    {\n+        WITH_LOCK(newTaskMutex, stopWhenEmpty = true);\n+        newTaskScheduled.notify_all();\n+    }\n \n-    // Returns number of tasks waiting to be serviced,\n-    // and first and last task times\n-    size_t getQueueInfo(std::chrono::system_clock::time_point &first,\n-                        std::chrono::system_clock::time_point &last) const;\n+    /**\n+     * Returns number of tasks waiting to be serviced,\n+     * and first and last task times\n+     */\n+    size_t getQueueInfo(std::chrono::system_clock::time_point& first, std::chrono::system_clock::time_point& last) const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19090#discussion_r431961148",
      "id" : 431961148,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk2MTE0OA==",
      "original_commit_id" : "fae1ef5e7bf3f0b6d1d181b77b9dc7a3bb0486dc",
      "original_line" : 87,
      "original_position" : 102,
      "original_start_line" : null,
      "path" : "src/scheduler.h",
      "position" : null,
      "pull_request_review_id" : 420225225,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19090",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-21T10:03:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431961148",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19090#discussion_r431967728"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431967728"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Not sure how to preserve this part of the comment then:\r\n\r\n```\r\ndelete s; // Must be done after thread is interrupted/joined.\r\n```\r\n\r\nIf this is changed, I'd rather just\r\n\r\n```\r\nCScheduler s{};\r\ns.scheduleFromNow(doSomething, std::chrono::milliseconds{11}); // Assuming a: void doSomething() { }\r\ns.scheduleFromNow([=] { this->func(argument); }, std::chrono::milliseconds{3});\r\nstd::thread t{[&] { s.serviceQueue(); }};\r\n \r\n ... then at program shutdown, make sure to call stop() to clean up the thread(s) running serviceQueue:\r\ns.stop();\r\nt.join();",
      "commit_id" : "fa8337fcdbcab8368d5bf111c4b2e5acf25e6e22",
      "created_at" : "2020-05-28T16:27:57Z",
      "diff_hunk" : "@@ -5,36 +5,30 @@\n #ifndef BITCOIN_SCHEDULER_H\n #define BITCOIN_SCHEDULER_H\n \n-//\n-// NOTE:\n-// boost::thread should be ported to std::thread\n-// when we support C++11.\n-//\n #include <condition_variable>\n #include <functional>\n #include <list>\n #include <map>\n \n #include <sync.h>\n \n-//\n-// Simple class for background tasks that should be run\n-// periodically or once \"after a while\"\n-//\n-// Usage:\n-//\n-// CScheduler* s = new CScheduler();\n-// s->scheduleFromNow(doSomething, std::chrono::milliseconds{11}); // Assuming a: void doSomething() { }\n-// s->scheduleFromNow([=] { this->func(argument); }, std::chrono::milliseconds{3});\n-// boost::thread* t = new boost::thread(std::bind(CScheduler::serviceQueue, s));\n-//\n-// ... then at program shutdown, make sure to call stop() to clean up the thread(s) running serviceQueue:\n-// s->stop();\n-// t->join();\n-// delete t;\n-// delete s; // Must be done after thread is interrupted/joined.\n-//\n-\n+/**\n+ * Simple class for background tasks that should be run\n+ * periodically or once \"after a while\"\n+ *\n+ * Usage:\n+ *\n+ * CScheduler* s = new CScheduler();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19090#discussion_r431967728",
      "id" : 431967728,
      "in_reply_to_id" : 431922496,
      "line" : 21,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk2NzcyOA==",
      "original_commit_id" : "fae1ef5e7bf3f0b6d1d181b77b9dc7a3bb0486dc",
      "original_line" : 21,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/scheduler.h",
      "position" : 40,
      "pull_request_review_id" : 420287493,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19090",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-21T10:03:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431967728",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19090#discussion_r431983182"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431983182"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In this case splitting over multiple lines is allowed because `BinPack...` is already set to `false`. However, unless `AlignAfterOpenBracket` is changed to `Align` I find it less readable.\r\n\r\nIn any case changing `.clang-format` should be done in a separate pr, and I might object changing `AlignAfterOpenBracket` to `Align` because it wastes so much whitespace.",
      "commit_id" : "fa8337fcdbcab8368d5bf111c4b2e5acf25e6e22",
      "created_at" : "2020-05-28T16:53:50Z",
      "diff_hunk" : "@@ -67,23 +61,32 @@ class CScheduler\n      */\n     void MockForward(std::chrono::seconds delta_seconds);\n \n-    // To keep things as simple as possible, there is no unschedule.\n-\n-    // Services the queue 'forever'. Should be run in a thread,\n-    // and interrupted using boost::interrupt_thread\n+    /**\n+     * Services the queue 'forever'. Should be run in a thread,\n+     * and interrupted using boost::interrupt_thread\n+     */\n     void serviceQueue();\n \n-    // Tell any threads running serviceQueue to stop as soon as they're\n-    // done servicing whatever task they're currently servicing (drain=false)\n-    // or when there is no work left to be done (drain=true)\n-    void stop(bool drain=false);\n+    /** Tell any threads running serviceQueue to stop as soon as the current task is done */\n+    void StopImmediately()\n+    {\n+        WITH_LOCK(newTaskMutex, stopRequested = true);\n+        newTaskScheduled.notify_all();\n+    }\n+    /** Tell any threads running serviceQueue to stop when there is no work left to be done */\n+    void StopWhenDrained()\n+    {\n+        WITH_LOCK(newTaskMutex, stopWhenEmpty = true);\n+        newTaskScheduled.notify_all();\n+    }\n \n-    // Returns number of tasks waiting to be serviced,\n-    // and first and last task times\n-    size_t getQueueInfo(std::chrono::system_clock::time_point &first,\n-                        std::chrono::system_clock::time_point &last) const;\n+    /**\n+     * Returns number of tasks waiting to be serviced,\n+     * and first and last task times\n+     */\n+    size_t getQueueInfo(std::chrono::system_clock::time_point& first, std::chrono::system_clock::time_point& last) const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19090#discussion_r431983182",
      "id" : 431983182,
      "in_reply_to_id" : 431961148,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk4MzE4Mg==",
      "original_commit_id" : "fae1ef5e7bf3f0b6d1d181b77b9dc7a3bb0486dc",
      "original_line" : 87,
      "original_position" : 102,
      "original_start_line" : null,
      "path" : "src/scheduler.h",
      "position" : null,
      "pull_request_review_id" : 420309126,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19090",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-21T10:03:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431983182",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19090#discussion_r431998325"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431998325"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That looks reasonable to me, although I don't think it's _that_ important. If you don't think it matters, leave it as is to avoid bikeshedding.\r\n\r\nHowever, I do think that you should s/stop()/StopImmediately()/ in this comment now that you're removing the `stop()` function.",
      "commit_id" : "fa8337fcdbcab8368d5bf111c4b2e5acf25e6e22",
      "created_at" : "2020-05-28T17:18:44Z",
      "diff_hunk" : "@@ -5,36 +5,30 @@\n #ifndef BITCOIN_SCHEDULER_H\n #define BITCOIN_SCHEDULER_H\n \n-//\n-// NOTE:\n-// boost::thread should be ported to std::thread\n-// when we support C++11.\n-//\n #include <condition_variable>\n #include <functional>\n #include <list>\n #include <map>\n \n #include <sync.h>\n \n-//\n-// Simple class for background tasks that should be run\n-// periodically or once \"after a while\"\n-//\n-// Usage:\n-//\n-// CScheduler* s = new CScheduler();\n-// s->scheduleFromNow(doSomething, std::chrono::milliseconds{11}); // Assuming a: void doSomething() { }\n-// s->scheduleFromNow([=] { this->func(argument); }, std::chrono::milliseconds{3});\n-// boost::thread* t = new boost::thread(std::bind(CScheduler::serviceQueue, s));\n-//\n-// ... then at program shutdown, make sure to call stop() to clean up the thread(s) running serviceQueue:\n-// s->stop();\n-// t->join();\n-// delete t;\n-// delete s; // Must be done after thread is interrupted/joined.\n-//\n-\n+/**\n+ * Simple class for background tasks that should be run\n+ * periodically or once \"after a while\"\n+ *\n+ * Usage:\n+ *\n+ * CScheduler* s = new CScheduler();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19090#discussion_r431998325",
      "id" : 431998325,
      "in_reply_to_id" : 431922496,
      "line" : 21,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk5ODMyNQ==",
      "original_commit_id" : "fae1ef5e7bf3f0b6d1d181b77b9dc7a3bb0486dc",
      "original_line" : 21,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/scheduler.h",
      "position" : 40,
      "pull_request_review_id" : 420329139,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19090",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-21T10:03:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431998325",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19090#discussion_r432010042"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432010042"
         }
      },
      "author_association" : "MEMBER",
      "body" : "https://github.com/bitcoin/bitcoin/pull/19095",
      "commit_id" : "fa8337fcdbcab8368d5bf111c4b2e5acf25e6e22",
      "created_at" : "2020-05-28T17:38:49Z",
      "diff_hunk" : "@@ -67,23 +61,32 @@ class CScheduler\n      */\n     void MockForward(std::chrono::seconds delta_seconds);\n \n-    // To keep things as simple as possible, there is no unschedule.\n-\n-    // Services the queue 'forever'. Should be run in a thread,\n-    // and interrupted using boost::interrupt_thread\n+    /**\n+     * Services the queue 'forever'. Should be run in a thread,\n+     * and interrupted using boost::interrupt_thread\n+     */\n     void serviceQueue();\n \n-    // Tell any threads running serviceQueue to stop as soon as they're\n-    // done servicing whatever task they're currently servicing (drain=false)\n-    // or when there is no work left to be done (drain=true)\n-    void stop(bool drain=false);\n+    /** Tell any threads running serviceQueue to stop as soon as the current task is done */\n+    void StopImmediately()\n+    {\n+        WITH_LOCK(newTaskMutex, stopRequested = true);\n+        newTaskScheduled.notify_all();\n+    }\n+    /** Tell any threads running serviceQueue to stop when there is no work left to be done */\n+    void StopWhenDrained()\n+    {\n+        WITH_LOCK(newTaskMutex, stopWhenEmpty = true);\n+        newTaskScheduled.notify_all();\n+    }\n \n-    // Returns number of tasks waiting to be serviced,\n-    // and first and last task times\n-    size_t getQueueInfo(std::chrono::system_clock::time_point &first,\n-                        std::chrono::system_clock::time_point &last) const;\n+    /**\n+     * Returns number of tasks waiting to be serviced,\n+     * and first and last task times\n+     */\n+    size_t getQueueInfo(std::chrono::system_clock::time_point& first, std::chrono::system_clock::time_point& last) const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19090#discussion_r432010042",
      "id" : 432010042,
      "in_reply_to_id" : 431961148,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjAxMDA0Mg==",
      "original_commit_id" : "fae1ef5e7bf3f0b6d1d181b77b9dc7a3bb0486dc",
      "original_line" : 87,
      "original_position" : 102,
      "original_start_line" : null,
      "path" : "src/scheduler.h",
      "position" : null,
      "pull_request_review_id" : 420344213,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19090",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-21T10:03:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432010042",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19090#discussion_r432035864"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432035864"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Left as is for now.",
      "commit_id" : "fa8337fcdbcab8368d5bf111c4b2e5acf25e6e22",
      "created_at" : "2020-05-28T18:26:13Z",
      "diff_hunk" : "@@ -5,36 +5,30 @@\n #ifndef BITCOIN_SCHEDULER_H\n #define BITCOIN_SCHEDULER_H\n \n-//\n-// NOTE:\n-// boost::thread should be ported to std::thread\n-// when we support C++11.\n-//\n #include <condition_variable>\n #include <functional>\n #include <list>\n #include <map>\n \n #include <sync.h>\n \n-//\n-// Simple class for background tasks that should be run\n-// periodically or once \"after a while\"\n-//\n-// Usage:\n-//\n-// CScheduler* s = new CScheduler();\n-// s->scheduleFromNow(doSomething, std::chrono::milliseconds{11}); // Assuming a: void doSomething() { }\n-// s->scheduleFromNow([=] { this->func(argument); }, std::chrono::milliseconds{3});\n-// boost::thread* t = new boost::thread(std::bind(CScheduler::serviceQueue, s));\n-//\n-// ... then at program shutdown, make sure to call stop() to clean up the thread(s) running serviceQueue:\n-// s->stop();\n-// t->join();\n-// delete t;\n-// delete s; // Must be done after thread is interrupted/joined.\n-//\n-\n+/**\n+ * Simple class for background tasks that should be run\n+ * periodically or once \"after a while\"\n+ *\n+ * Usage:\n+ *\n+ * CScheduler* s = new CScheduler();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19090#discussion_r432035864",
      "id" : 432035864,
      "in_reply_to_id" : 431922496,
      "line" : 21,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjAzNTg2NA==",
      "original_commit_id" : "fae1ef5e7bf3f0b6d1d181b77b9dc7a3bb0486dc",
      "original_line" : 21,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/scheduler.h",
      "position" : 40,
      "pull_request_review_id" : 420378331,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19090",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-21T10:03:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432035864",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19090#discussion_r432035936"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432035936"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "fa8337fcdbcab8368d5bf111c4b2e5acf25e6e22",
      "created_at" : "2020-05-28T18:26:21Z",
      "diff_hunk" : "@@ -67,23 +61,32 @@ class CScheduler\n      */\n     void MockForward(std::chrono::seconds delta_seconds);\n \n-    // To keep things as simple as possible, there is no unschedule.\n-\n-    // Services the queue 'forever'. Should be run in a thread,\n-    // and interrupted using boost::interrupt_thread\n+    /**\n+     * Services the queue 'forever'. Should be run in a thread,\n+     * and interrupted using boost::interrupt_thread\n+     */\n     void serviceQueue();\n \n-    // Tell any threads running serviceQueue to stop as soon as they're\n-    // done servicing whatever task they're currently servicing (drain=false)\n-    // or when there is no work left to be done (drain=true)\n-    void stop(bool drain=false);\n+    /** Tell any threads running serviceQueue to stop as soon as the current task is done */\n+    void StopImmediately()\n+    {\n+        WITH_LOCK(newTaskMutex, stopRequested = true);\n+        newTaskScheduled.notify_all();\n+    }\n+    /** Tell any threads running serviceQueue to stop when there is no work left to be done */\n+    void StopWhenDrained()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19090#discussion_r432035936",
      "id" : 432035936,
      "in_reply_to_id" : 431945705,
      "line" : 77,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjAzNTkzNg==",
      "original_commit_id" : "fae1ef5e7bf3f0b6d1d181b77b9dc7a3bb0486dc",
      "original_line" : 77,
      "original_position" : 88,
      "original_start_line" : null,
      "path" : "src/scheduler.h",
      "position" : 88,
      "pull_request_review_id" : 420378430,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19090",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-21T10:03:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432035936",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Removed some more code as requested by @jnewbery ",
      "created_at" : "2020-05-28T18:26:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19090#issuecomment-635518938",
      "id" : 635518938,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19090",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNTUxODkzOA==",
      "updated_at" : "2020-05-28T18:26:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/635518938",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Reverted back to the previous version for a smaller diff",
      "created_at" : "2020-05-28T23:31:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19090#issuecomment-635670795",
      "id" : 635670795,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19090",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNTY3MDc5NQ==",
      "updated_at" : "2020-05-28T23:31:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/635670795",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "reACK fa197f1d1119346b8980cf1a8b34ceee07f30a6a\r\n\r\nonly change is renaming `StopImmediately()` to `stop()` (presumably so `StopWhenDrained()` can be removed in a follow-up PR.\r\n\r\n> Reverted back to the previous version for a smaller diff\r\n\r\nGood. My original suggestion was to remove `StopWhenDrained()` in a follow-up. No need to do everything in one PR.",
      "created_at" : "2020-05-29T02:17:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19090#issuecomment-635717262",
      "id" : 635717262,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19090",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNTcxNzI2Mg==",
      "updated_at" : "2020-05-29T02:17:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/635717262",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19090#discussion_r443203639"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443203639"
         }
      },
      "author_association" : "MEMBER",
      "body" : "thx fixed",
      "commit_id" : "fa8337fcdbcab8368d5bf111c4b2e5acf25e6e22",
      "created_at" : "2020-06-21T10:06:40Z",
      "diff_hunk" : "@@ -67,23 +61,32 @@ class CScheduler\n      */\n     void MockForward(std::chrono::seconds delta_seconds);\n \n-    // To keep things as simple as possible, there is no unschedule.\n-\n-    // Services the queue 'forever'. Should be run in a thread,\n-    // and interrupted using boost::interrupt_thread\n+    /**\n+     * Services the queue 'forever'. Should be run in a thread,\n+     * and interrupted using boost::interrupt_thread\n+     */\n     void serviceQueue();\n \n-    // Tell any threads running serviceQueue to stop as soon as they're\n-    // done servicing whatever task they're currently servicing (drain=false)\n-    // or when there is no work left to be done (drain=true)\n-    void stop(bool drain=false);\n+    /** Tell any threads running serviceQueue to stop as soon as the current task is done */\n+    void StopImmediately()\n+    {\n+        WITH_LOCK(newTaskMutex, stopRequested = true);\n+        newTaskScheduled.notify_all();\n+    }\n+    /** Tell any threads running serviceQueue to stop when there is no work left to be done */\n+    void StopWhenDrained()\n+    {\n+        WITH_LOCK(newTaskMutex, stopWhenEmpty = true);\n+        newTaskScheduled.notify_all();\n+    }\n \n-    // Returns number of tasks waiting to be serviced,\n-    // and first and last task times\n-    size_t getQueueInfo(std::chrono::system_clock::time_point &first,\n-                        std::chrono::system_clock::time_point &last) const;\n+    /**\n+     * Returns number of tasks waiting to be serviced,\n+     * and first and last task times\n+     */\n+    size_t getQueueInfo(std::chrono::system_clock::time_point& first, std::chrono::system_clock::time_point& last) const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19090#discussion_r443203639",
      "id" : 443203639,
      "in_reply_to_id" : 431961148,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIwMzYzOQ==",
      "original_commit_id" : "fae1ef5e7bf3f0b6d1d181b77b9dc7a3bb0486dc",
      "original_line" : 87,
      "original_position" : 102,
      "original_start_line" : null,
      "path" : "src/scheduler.h",
      "position" : null,
      "pull_request_review_id" : 434487758,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19090",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-21T10:06:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443203639",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Force pushed last commit, but should be trivial to re-review with `git range-diff bitcoin-core/master --word-diff-regex=. A B`",
      "created_at" : "2020-06-21T10:07:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19090#issuecomment-647107374",
      "id" : 647107374,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19090",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NzEwNzM3NA==",
      "updated_at" : "2020-06-21T10:07:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/647107374",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK fa8337fcdbcab8368d5bf111c4b2e5acf25e6e22",
      "created_at" : "2020-06-22T13:27:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19090#issuecomment-647519122",
      "id" : 647519122,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19090",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NzUxOTEyMg==",
      "updated_at" : "2020-06-22T13:27:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/647519122",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   }
]
