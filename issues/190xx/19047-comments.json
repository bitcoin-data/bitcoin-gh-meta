[
   {
      "author_association" : "MEMBER",
      "body" : "What do you mean? The potential deadlock should still be detected, and then either `std::abort`, or `std::logic_error`, or the sanitizer abort will kill the process with a non-zero exit code.",
      "created_at" : "2020-05-22T10:52:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19047#issuecomment-632629242",
      "id" : 632629242,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19047",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMjYyOTI0Mg==",
      "updated_at" : "2020-05-22T10:52:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/632629242",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke \r\n> What do you mean? The potential deadlock should still be detected, and then either `std::abort`, or `std::logic_error`, or the sanitizer abort will kill the process with a non-zero exit code.\r\n\r\nI suggest to use both tools to detect a potential deadlock, each tool in its own test:\r\n- the `-DDEBUG_LOCKORDER` flag in the \"[bionic]  [no depends, only system libs, sanitizers: address/leak (ASan + LSan) + undefined (UBSan) + integer]\" CI test (the current state)\r\n\r\n_and_\r\n- the ThreadSanitizer in the \"[bionic]  [no depends, only system libs, sanitizers: thread (TSan), no wallet]\" CI test (the subject to change) that is possible by dropping the `-DDEBUG_LOCKORDER` flag",
      "created_at" : "2020-05-22T11:01:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19047#issuecomment-632632896",
      "id" : 632632896,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19047",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMjYzMjg5Ng==",
      "updated_at" : "2020-05-22T11:03:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/632632896",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "And the scope of the ThreadSanitizer is wider than that of our instrumented mutexes.",
      "created_at" : "2020-05-22T11:08:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19047#issuecomment-632635860",
      "id" : 632635860,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19047",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMjYzNTg2MA==",
      "updated_at" : "2020-05-22T11:08:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/632635860",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "So are you saying that `DEBUG_LOCKORDER` with tsan might result in a false negative?",
      "created_at" : "2020-05-22T11:11:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19047#issuecomment-632636667",
      "id" : 632636667,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19047",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMjYzNjY2Nw==",
      "updated_at" : "2020-05-22T11:11:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/632636667",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> So are you saying that `DEBUG_LOCKORDER` with tsan might result in a false negative?\r\n\r\nNo :)\r\n\r\nI only say that we do not test for potential deadlocks by means of the ThreadSanitizer. Always the `DEBUG_LOCKORDER` facilities are used only (on Travis CI).",
      "created_at" : "2020-05-22T11:14:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19047#issuecomment-632637924",
      "id" : 632637924,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19047",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMjYzNzkyNA==",
      "updated_at" : "2020-05-22T11:14:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/632637924",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> So are you saying that `DEBUG_LOCKORDER` with tsan might result in a false negative?\r\n\r\nTo be exact, when binaries are built with the `--with-sanitizers=thread CPPFLAGS=-DDEBUG_LOCKORDER` `configure` options the `DEBUG_LOCKORDER` code prevents the ThreadSanitizer from rising a warning. If the `DEBUG_LOCKORDER` code fails to detect a lock order inversion, the ThreadSanitizer should emit a warning.",
      "created_at" : "2020-05-22T11:28:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19047#issuecomment-632643782",
      "id" : 632643782,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19047",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMjY0Mzc4Mg==",
      "updated_at" : "2020-05-22T11:28:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/632643782",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> If the DEBUG_LOCKORDER code fails to detect a lock order inversion, the ThreadSanitizer should emit a warning.\r\n\r\nIt should emit the warning, unless I am missing something and there are false negatives.",
      "created_at" : "2020-05-22T11:54:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19047#issuecomment-632653535",
      "id" : 632653535,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19047",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMjY1MzUzNQ==",
      "updated_at" : "2020-05-22T11:54:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/632653535",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke \r\n```\r\n$ ./configure --with-sanitizers=thread && make clean && make\r\n$ ./src/test/test_bitcoin --run_test=sync_tests\r\nRunning 1 test case...\r\n...\r\n*** No errors detected\r\nThreadSanitizer: reported 2 warnings\r\n```\r\nvs\r\n```\r\n\r\n$ ./configure --with-sanitizers=thread CPPFLAGS=-DDEBUG_LOCKORDER && make clean && make\r\n$ ./src/test/test_bitcoin --run_test=sync_tests\r\nRunning 1 test case...\r\n\r\n*** No errors detected\r\n```\r\n\r\nPlease note no warnings from the ThreadSanitizer in the latter case.",
      "created_at" : "2020-05-22T12:19:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19047#issuecomment-632663594",
      "id" : 632663594,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19047",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMjY2MzU5NA==",
      "updated_at" : "2020-05-22T12:19:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/632663594",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The sync tests are causing a potential deadlock on purpose. As far as I can see everything works as expected.",
      "created_at" : "2020-05-22T12:24:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19047#issuecomment-632665252",
      "id" : 632665252,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19047",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMjY2NTI1Mg==",
      "updated_at" : "2020-05-22T12:24:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/632665252",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> The sync tests are causing a potential deadlock on purpose. As far as I can see everything works as expected.\r\n\r\nOf course! But it shows that `CPPFLAGS=-DDEBUG_LOCKORDER` suppresses the ThreadSanitizer warnings.",
      "created_at" : "2020-05-22T12:28:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19047#issuecomment-632666525",
      "id" : 632666525,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19047",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMjY2NjUyNQ==",
      "updated_at" : "2020-05-22T12:28:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/632666525",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "That is the exact purpose of it in this test case, otherwise ci could never pass under tsan",
      "created_at" : "2020-05-22T12:37:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19047#issuecomment-632669569",
      "id" : 632669569,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19047",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMjY2OTU2OQ==",
      "updated_at" : "2020-05-22T12:37:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/632669569",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> That is the exact purpose of it in this test case, otherwise ci could never pass under tsan\r\n\r\nI think not `CPPFLAGS=-DDEBUG_LOCKORDER` but the `test/sanitizer_suppressions/tsan` is responsible for the ThreadSanitizer warning suppression in that case: https://github.com/bitcoin/bitcoin/blob/b5c423c48e094bd098e11c3d1f57acae7502a4da/test/sanitizer_suppressions/tsan#L8\r\n",
      "created_at" : "2020-05-22T12:42:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19047#issuecomment-632671505",
      "id" : 632671505,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19047",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMjY3MTUwNQ==",
      "updated_at" : "2020-05-22T12:42:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/632671505",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "`DDEBUG_LOCKORDER` is used to make the failure \"soft\" and recoverable. If it wasn't set either our sync.cpp logic would abort the whole program and mark ci as failed or tsan would abort the whole program and mark the ci as failed.",
      "created_at" : "2020-05-22T12:49:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19047#issuecomment-632674303",
      "id" : 632674303,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19047",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMjY3NDMwMw==",
      "updated_at" : "2020-05-22T12:49:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/632674303",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The suppression is needed when someone is compiling without `DDEBUG_LOCKORDER`",
      "created_at" : "2020-05-22T12:50:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19047#issuecomment-632674431",
      "id" : 632674431,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19047",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMjY3NDQzMQ==",
      "updated_at" : "2020-05-22T12:50:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/632674431",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke \r\n> `DDEBUG_LOCKORDER` is used to make the failure \"soft\" and recoverable. If it wasn't set either our sync.cpp logic would abort the whole program and mark ci as failed or tsan would abort the whole program and mark the ci as failed.\r\n\r\n> The suppression is needed when someone is compiling without `DDEBUG_LOCKORDER`\r\n\r\nThe CI already uses `test/sanitizer_suppressions/tsan`: https://github.com/bitcoin/bitcoin/blob/b5c423c48e094bd098e11c3d1f57acae7502a4da/ci/test/04_install.sh#L27\r\n\r\nMind looking into the following CI jobs:\r\n- https://travis-ci.org/github/hebasto/bitcoin/jobs/690019636 `-DDEBUG_LOCKORDER` is dropped, the ThreadSanitizer only is used to detect lock order inversion; _test passed_\r\n- https://travis-ci.org/github/hebasto/bitcoin/jobs/690019637 the same as master; `-DDEBUG_LOCKORDER` is used to detect lock order inversion\r\n\r\n?\r\n",
      "created_at" : "2020-05-22T13:32:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19047#issuecomment-632692372",
      "id" : 632692372,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19047",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMjY5MjM3Mg==",
      "updated_at" : "2020-05-22T13:32:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/632692372",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Ok, but what exactly is the harm or risk? I don't see why the must be mutually exclusive.",
      "created_at" : "2020-05-22T13:35:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19047#issuecomment-632693907",
      "id" : 632693907,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19047",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMjY5MzkwNw==",
      "updated_at" : "2020-05-22T13:35:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/632693907",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Ok, but what exactly is the harm or risk?\r\n\r\nWe are just not using a free opportunity to test our code base with both tools, each tool in its _own_ CI job, without interference.\r\n\r\n",
      "created_at" : "2020-05-22T13:51:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19047#issuecomment-632700493",
      "id" : 632700493,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19047",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMjcwMDQ5Mw==",
      "updated_at" : "2020-05-22T13:51:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/632700493",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I do run my own set of ci configs outside the repo and I do hope that I am not the only one running tests with sanitizers enabled. We can't possibly fit every matrix combination into a ci build.",
      "created_at" : "2020-05-22T14:16:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19047#issuecomment-632716068",
      "id" : 632716068,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19047",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMjcxNjA2OA==",
      "updated_at" : "2020-05-22T14:16:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/632716068",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "So you think that opening a pr with this [branch](https://github.com/hebasto/bitcoin/tree/200522-tsan-only) is pointless, aren't you?",
      "created_at" : "2020-05-22T14:29:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19047#issuecomment-632722227",
      "id" : 632722227,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19047",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMjcyMjIyNw==",
      "updated_at" : "2020-05-22T14:29:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/632722227",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Ignoring the very specific test `potential_deadlock_detected` our `DEBUG_LOCKORDER` deadlock prevention will call `abort()` if it detects a deadlock. That is good enough to fail the CI job. If it does not detect the deadlock, then the tsan is not prevented from acting.\r\n\r\nSo I think that there is no need to remove `DEBUG_LOCKORDER` from the tsan CI job as in https://github.com/hebasto/bitcoin/commit/991068d9ea74a865c464c9645ca1fb20e36f41eb. Because a potential deadlock will either be detected by `DEBUG_LOCKORDER` (leading to `abort()`) or, if it misses it, then it will be detected by the thread sanitizer. In either case the CI job should fail.\r\n\r\n> Using both options simultaneously does not work as in the former case lock() is not called if lock order inversion is detected, and the ThreadSanitizer fails to warn about the issue.\r\n\r\nThat is true, but we get an `abort()` in that case which is also good enough, no?",
      "created_at" : "2020-06-02T07:53:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19047#issuecomment-637360524",
      "id" : 637360524,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19047",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNzM2MDUyNA==",
      "updated_at" : "2020-06-02T07:53:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/637360524",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "btw, now `-DDEBUG_LOCKORDER` directly affects TSan run result: https://github.com/bitcoin/bitcoin/pull/19983#discussion_r547336086",
      "created_at" : "2020-12-22T18:20:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19047#issuecomment-749701054",
      "id" : 749701054,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19047",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0OTcwMTA1NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-22T18:20:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/749701054",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Is it the case that `DEBUG_LOCKORDER` fails to detect some double lock? That would be a bug.",
      "created_at" : "2020-12-23T09:42:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19047#issuecomment-750043301",
      "id" : 750043301,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19047",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1MDA0MzMwMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-23T09:42:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/750043301",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   }
]
