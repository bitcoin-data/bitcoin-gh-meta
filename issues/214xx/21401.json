{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "Currently versionbits deployments are stored in a simple C array in `Params`. Setting the actual values needs to be done externally. Since the memory is allocated and initialized when `Params` is initialized, it is possible to have a deployment with uninitialized (or otherwise garbage and invalid) values set for its parameters if something is forgotten when they are being set.\r\n\r\nInstead of this two step approach (create deployment object, then set its members), I think it is better to have a constructor where those parameters are passed in and set when the deployment is initialized. This PR does that. In order for this to work though, `vDeployments` cannot be a simple C array. It is instead changed to be a `std::map<DeploymentPos, VBitsDeployment>`. This maps the deployment enum to the `VBitsDeployment` object itself; this is essentially how we were using `vDeployments` previously. Additionally, by also changing `VersionBitsDeploymentInfo` to a map as well, we are able to remove `MAX_VERSION_BITS_DEPLOYMENT` and all of the places where we were iterating the deployments no longer need to cast an int to `DeploymentPos`.\r\n\r\nAn additional concern is that the members of `VBitsDeployment` are not const and could thus be accidentally changed during runtime. To prevent this, this PR makes all members of `VBitsDeployment` const.\r\n\r\nLastly, to make `VBitsDeployment` actually fully describe a deployment, this PR moves the number of blocks in a period into the struct. In order to ensure that this variable matches up with the retarget period, a unit test is added.\r\n\r\nBuilt on top of #21392 and #21380 for the refactors and other changes they make to `VBitsDeployment`.",
   "closed_at" : "2021-05-25T04:56:39Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
      "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
      "followers_url" : "https://api.github.com/users/achow101/followers",
      "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/achow101",
      "id" : 3782274,
      "login" : "achow101",
      "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
      "organizations_url" : "https://api.github.com/users/achow101/orgs",
      "received_events_url" : "https://api.github.com/users/achow101/received_events",
      "repos_url" : "https://api.github.com/users/achow101/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/achow101"
   },
   "comments" : 8,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21401/comments",
   "created_at" : "2021-03-09T23:44:08Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21401/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/21401",
   "id" : 826810127,
   "labels" : [
      {
         "color" : "cccccc",
         "default" : false,
         "description" : "",
         "id" : 955867938,
         "name" : "Needs rebase",
         "node_id" : "MDU6TGFiZWw5NTU4Njc5Mzg=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase"
      },
      {
         "color" : "E6F6D6",
         "default" : false,
         "description" : null,
         "id" : 135961,
         "name" : "Refactoring",
         "node_id" : "MDU6TGFiZWwxMzU5NjE=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21401/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDExOlB1bGxSZXF1ZXN0NTg4NzgyMjcx",
   "number" : 21401,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/21401.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21401",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/21401.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21401"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "Refactor versionbits deployments to avoid potential uninitialized variables",
   "updated_at" : "2021-05-25T04:56:39Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21401",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
      "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
      "followers_url" : "https://api.github.com/users/achow101/followers",
      "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/achow101",
      "id" : 3782274,
      "login" : "achow101",
      "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
      "organizations_url" : "https://api.github.com/users/achow101/orgs",
      "received_events_url" : "https://api.github.com/users/achow101/received_events",
      "repos_url" : "https://api.github.com/users/achow101/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/achow101"
   }
}
