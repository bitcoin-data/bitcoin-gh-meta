[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r113172602"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113172602"
         }
      },
      "author_association" : "OWNER",
      "body" : "This functionality could come in useful.\r\n\r\nAs for the API I prefer to not do any string combining/parsing here, this makes the API less clean to work with at least in my experience. I'd prefer to add an optional (can be null or missing) `fromblock` argument.",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-04-25T11:47:12Z",
      "diff_hunk" : "@@ -192,11 +195,34 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\"\")\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true\")\n             + HelpExampleRpc(\"getrawtransaction\", \"\\\"mytxid\\\", true\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"myblockhash:mytxid\\\"\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"myblockhash:mytxid\\\", true\")\n         );\n \n     LOCK(cs_main);\n \n-    uint256 hash = ParseHashV(request.params[0], \"parameter 1\");\n+    uint256 hash;\n+    int64_t blockHeight = -1;\n+    bool inMainChain = true;\n+    auto p = request.params[0].get_str().find(':');",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r113172602",
      "id" : 113172602,
      "original_commit_id" : "221e725814b9bba82c3f0f37ba3c4efea06038ea",
      "original_position" : 42,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 34538670,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113172602",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Nice feature!\r\nI agree with @laanwj about the string parsing. The `<block>:<txid>` schematics looks good at first sight, but we are using JSON and should stay with JSON and don't add another form or key/value encoding.",
      "created_at" : "2017-04-25T19:37:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-297141513",
      "id" : 297141513,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-04-25T19:37:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/297141513",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Fair enough, I'll add a blockhash argument instead. I was kind of toying with the idea of a new standard for referencing transactions which included the block height (not hash) so everyone could always find a tx presuming they had the block in question, and that thought sort of seeped in here.",
      "created_at" : "2017-04-26T04:24:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-297234272",
      "id" : 297234272,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-04-26T04:24:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/297234272",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/250224?v=3",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "body" : "@gmaxwell \r\n> Allowing it work on orphan blocks is an interesting idea. I'm a little less sure about that-- I think it could allow it to return transactions that have never been validated, which would be somewhat surprising.\r\n\r\nI just realized my logic was flawed on this. I am passing the block height only to the GetTransaction method, which means it will always pick the active chain at the given height. Either I throw when the block is not in the main chain (i.e. no support for orphaned blocks) or I move the height determine logic over to validation.cpp. I am leaning towards the latter, but feedback welcome.\r\n\r\nEdit: passing  CBlockIndex to GetTransaction seems like a great way to do this. Going with that.",
      "created_at" : "2017-04-26T05:12:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-297239855",
      "id" : 297239855,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-04-26T06:14:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/297239855",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/250224?v=3",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "body" : "The code now works as advertised (see updated OP).\r\n\r\n[History](https://github.com/kallewoof/bitcoin/commits/gettx-with-blockhash-unsquashed):\r\n* 2017-04-25: [1 (block hash support in getrawtx)](https://github.com/kallewoof/bitcoin/commit/7f3042b2c4d4e5d9457365e4a6c8d4a57a3ec35b)\r\n* 2017-04-26: Ã¢ÂÂ [2Ã¢ÂÂ±1 (bh:txid to 2 params)](https://github.com/kallewoof/bitcoin/commit/e269ecd404268e68e05b632331e21eef07646b1f) Ã¢ÂÂ [3 (fix fVerbose parsing)](https://github.com/kallewoof/bitcoin/commit/228882777eaf04792cacd9bad3a206263f54aaba) Ã¢ÂÂ [4Ã¢ÂÂ±1 (switch to block index in GetTx)](https://github.com/kallewoof/bitcoin/commit/fb92653ff10c24344ff46d7ee686b32091983d90)",
      "created_at" : "2017-04-26T05:44:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-297243978",
      "id" : 297243978,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-05-01T06:31:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/297243978",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/250224?v=3",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r114429566"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114429566"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: You can replace this and the next three lines with:\r\n\r\n```c++\r\n} else {\r\n    fVerbose = (request.params[1].get_bool());\r\n}\r\n```\r\n\r\nsince `get_bool()` does the type testing for you and throws the JSONRPCError if the type isn't a VBOOL.\r\n\r\nUp to you whether you think that's clearer.",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-05-02T21:26:44Z",
      "diff_hunk" : "@@ -192,34 +195,44 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\"\")\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true\")\n             + HelpExampleRpc(\"getrawtransaction\", \"\\\"mytxid\\\", true\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" false \\\"myblockhash\\\"\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true \\\"myblockhash\\\"\")\n         );\n \n     LOCK(cs_main);\n \n+    bool inMainChain = true;\n     uint256 hash = ParseHashV(request.params[0], \"parameter 1\");\n+    CBlockIndex* blockIndex = NULL;\n \n     // Accept either a bool (true) or a num (>=1) to indicate verbose output.\n     bool fVerbose = false;\n     if (request.params.size() > 1) {\n         if (request.params[1].isNum()) {\n-            if (request.params[1].get_int() != 0) {\n-                fVerbose = true;\n-            }\n+            fVerbose = (request.params[1].get_int() != 0);\n+        } else if (request.params[1].isBool()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r114429566",
      "id" : 114429566,
      "original_commit_id" : "23be83e143b29fc6f478b37218cc4e20ebe2c35a",
      "original_position" : 54,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 35895271,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114429566",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "body" : "utACK, but I think this deserves a new functional test case.",
      "created_at" : "2017-05-02T21:27:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-298766522",
      "id" : 298766522,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-05-02T21:27:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/298766522",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r114771044"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114771044"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ohh, good point! Thanks.\r\nEdit: I don't want it to throw for `null` values though. ",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-05-04T13:23:22Z",
      "diff_hunk" : "@@ -192,34 +195,44 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\"\")\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true\")\n             + HelpExampleRpc(\"getrawtransaction\", \"\\\"mytxid\\\", true\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" false \\\"myblockhash\\\"\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true \\\"myblockhash\\\"\")\n         );\n \n     LOCK(cs_main);\n \n+    bool inMainChain = true;\n     uint256 hash = ParseHashV(request.params[0], \"parameter 1\");\n+    CBlockIndex* blockIndex = NULL;\n \n     // Accept either a bool (true) or a num (>=1) to indicate verbose output.\n     bool fVerbose = false;\n     if (request.params.size() > 1) {\n         if (request.params[1].isNum()) {\n-            if (request.params[1].get_int() != 0) {\n-                fVerbose = true;\n-            }\n+            fVerbose = (request.params[1].get_int() != 0);\n+        } else if (request.params[1].isBool()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r114771044",
      "id" : 114771044,
      "in_reply_to_id" : 114429566,
      "original_commit_id" : "23be83e143b29fc6f478b37218cc4e20ebe2c35a",
      "original_position" : 54,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 36265827,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114771044",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r114771638"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114771638"
         }
      },
      "author_association" : "MEMBER",
      "body" : "So I end up with\r\n```C++\r\n        if (request.params[1].isNum()) {\r\n            fVerbose = (request.params[1].get_int() != 0);\r\n        } else if (!request.params[1].isNull()) {\r\n            fVerbose = (request.params[1].get_bool());\r\n        }\r\n```",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-05-04T13:26:05Z",
      "diff_hunk" : "@@ -192,34 +195,44 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\"\")\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true\")\n             + HelpExampleRpc(\"getrawtransaction\", \"\\\"mytxid\\\", true\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" false \\\"myblockhash\\\"\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true \\\"myblockhash\\\"\")\n         );\n \n     LOCK(cs_main);\n \n+    bool inMainChain = true;\n     uint256 hash = ParseHashV(request.params[0], \"parameter 1\");\n+    CBlockIndex* blockIndex = NULL;\n \n     // Accept either a bool (true) or a num (>=1) to indicate verbose output.\n     bool fVerbose = false;\n     if (request.params.size() > 1) {\n         if (request.params[1].isNum()) {\n-            if (request.params[1].get_int() != 0) {\n-                fVerbose = true;\n-            }\n+            fVerbose = (request.params[1].get_int() != 0);\n+        } else if (request.params[1].isBool()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r114771638",
      "id" : 114771638,
      "in_reply_to_id" : 114429566,
      "original_commit_id" : "23be83e143b29fc6f478b37218cc4e20ebe2c35a",
      "original_position" : 54,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 36266506,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114771638",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "body" : "@jnewbery I agree. Will get to work on that.\r\n\r\n[[...]](https://github.com/kallewoof/bitcoin/commits/gettx-with-blockhash-unsquashed):\r\n* 2017-05-04: [5Ã¢ÂÂ±2 (improve fVerbose)](https://github.com/kallewoof/bitcoin/commit/2a921bf5585ac72e2154b41492ab70ecd3e46241)",
      "created_at" : "2017-05-04T13:31:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-299185551",
      "id" : 299185551,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-05-04T13:31:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/299185551",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/250224?v=3",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "body" : "@jnewbery Added some tests to `rawtransactions.py` for the included blockhash variant (a6b8461).\r\n\r\n[[...]](https://github.com/kallewoof/bitcoin/commits/gettx-with-blockhash-unsquashed):\r\n* 2017-05-08: [6 (tests)](https://github.com/kallewoof/bitcoin/commit/99f115cc5a0d3dc8b93b5107ed2fe933488c85e6)",
      "created_at" : "2017-05-08T04:28:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-299770203",
      "id" : 299770203,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-05-08T04:28:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/299770203",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/250224?v=3",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r116580150"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/116580150"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: no need for brackets here. The following should do:\r\n\r\n`block1, block2 = self.nodes[2].generate(2)`",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-05-15T19:28:59Z",
      "diff_hunk" : "@@ -64,6 +64,20 @@ def run_test(self):\n         # This will raise an exception since there are missing inputs\n         assert_raises_jsonrpc(-25, \"Missing inputs\", self.nodes[2].sendrawtransaction, rawtx['hex'])\n \n+        ############################\n+        # getrawtx with block hash #\n+        ############################\n+\n+        # make a tx by sending then generate 2 blocks; block1 has the tx in it,\n+        # presumably\n+        tx = self.nodes[2].sendtoaddress(self.nodes[1].getnewaddress(), 1)\n+        [ block1, block2 ] = self.nodes[2].generate(2)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r116580150",
      "id" : 116580150,
      "original_commit_id" : "a6b84618ad04dccc628aa4905fced4784a62895a",
      "original_position" : 11,
      "path" : "test/functional/rawtransactions.py",
      "position" : null,
      "pull_request_review_id" : 38211445,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/116580150",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r116580435"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/116580435"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: I think it's better to assert on the actual value here (ie verify that the getrawtransaction returned the correct transaction rather than returned anything). The following should do that:\r\n\r\n`assert_equal(self.nodes[0].getrawtransaction(tx, True, block1)['txid'], tx)`",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-05-15T19:30:21Z",
      "diff_hunk" : "@@ -64,6 +64,20 @@ def run_test(self):\n         # This will raise an exception since there are missing inputs\n         assert_raises_jsonrpc(-25, \"Missing inputs\", self.nodes[2].sendrawtransaction, rawtx['hex'])\n \n+        ############################\n+        # getrawtx with block hash #\n+        ############################\n+\n+        # make a tx by sending then generate 2 blocks; block1 has the tx in it,\n+        # presumably\n+        tx = self.nodes[2].sendtoaddress(self.nodes[1].getnewaddress(), 1)\n+        [ block1, block2 ] = self.nodes[2].generate(2)\n+        self.sync_all()\n+        # We should be able to get the raw transaction by providing the correct block\n+        assert self.nodes[0].getrawtransaction(tx, True, block1)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r116580435",
      "id" : 116580435,
      "original_commit_id" : "a6b84618ad04dccc628aa4905fced4784a62895a",
      "original_position" : 14,
      "path" : "test/functional/rawtransactions.py",
      "position" : null,
      "pull_request_review_id" : 38211445,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/116580435",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "body" : "Is this still needed after #8704?",
      "created_at" : "2017-05-15T22:32:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-301623888",
      "id" : 301623888,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-05-15T22:32:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/301623888",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@sipa The use cases are quite different I think. #8704 lets you see all transactions in a given block. This lets you grab a transaction directly from a block without indexing.",
      "created_at" : "2017-05-16T02:41:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-301659483",
      "id" : 301659483,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-05-16T02:41:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/301659483",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/250224?v=3",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "body" : "@kallewoof #8704 does not require indexing either",
      "created_at" : "2017-05-16T02:42:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-301659552",
      "id" : 301659552,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-05-16T02:42:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/301659552",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Yeah, sorry, I meant that this is a way to get a specific transaction if you know the block hash, whereas #8704 shows you all transactions in the entire block. You get the info, but you have to wade through stuff to get it.",
      "created_at" : "2017-05-16T02:56:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-301661539",
      "id" : 301661539,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-05-16T02:56:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/301661539",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/250224?v=3",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r116656164"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/116656164"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@jnewbery Good points, thanks. Addressed!",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-05-16T05:12:43Z",
      "diff_hunk" : "@@ -64,6 +64,20 @@ def run_test(self):\n         # This will raise an exception since there are missing inputs\n         assert_raises_jsonrpc(-25, \"Missing inputs\", self.nodes[2].sendrawtransaction, rawtx['hex'])\n \n+        ############################\n+        # getrawtx with block hash #\n+        ############################\n+\n+        # make a tx by sending then generate 2 blocks; block1 has the tx in it,\n+        # presumably\n+        tx = self.nodes[2].sendtoaddress(self.nodes[1].getnewaddress(), 1)\n+        [ block1, block2 ] = self.nodes[2].generate(2)\n+        self.sync_all()\n+        # We should be able to get the raw transaction by providing the correct block\n+        assert self.nodes[0].getrawtransaction(tx, True, block1)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r116656164",
      "id" : 116656164,
      "in_reply_to_id" : 116580435,
      "original_commit_id" : "a6b84618ad04dccc628aa4905fced4784a62895a",
      "original_position" : 14,
      "path" : "test/functional/rawtransactions.py",
      "position" : null,
      "pull_request_review_id" : 38292688,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/116656164",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "body" : "In both cases the whole block has to be loaded from disk, and parsed, and searched linearly. The difference is whether the linear search step happens on the server or client.\r\n\r\nI think both #8704 and this can be useful, but have to agree there's only superficial difference.\r\n",
      "created_at" : "2017-05-16T05:25:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-301678856",
      "id" : 301678856,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-05-16T05:25:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/301678856",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "The difference between the two is the serialization and transmission and parsing of ~5MB of JSON data vs a few hundred bytes of hex encoded data. That's a 1,000x difference on the client side, and the same absolute improvement on the server -- although as a multiplier it'd be less since as you note the server still has to parse the block from disk. That's a nontrivial performance difference.\r\n\r\n(Also, this would have greatly helped me in the past so another +1 from me.)",
      "created_at" : "2017-05-16T08:32:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-301713146",
      "id" : 301713146,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-05-16T08:32:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/301713146",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/69154?v=3",
         "events_url" : "https://api.github.com/users/maaku/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maaku/followers",
         "following_url" : "https://api.github.com/users/maaku/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maaku/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maaku",
         "id" : 69154,
         "login" : "maaku",
         "organizations_url" : "https://api.github.com/users/maaku/orgs",
         "received_events_url" : "https://api.github.com/users/maaku/received_events",
         "repos_url" : "https://api.github.com/users/maaku/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maaku/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maaku/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maaku"
      }
   },
   {
      "body" : "Agree with @maaku - simply encoding the data into 5MB of json could be time-consuming, during which time the cs_main lock is held. Having a command to return just a single transaction from a block seems very useful.",
      "created_at" : "2017-05-16T13:31:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-301782636",
      "id" : 301782636,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-05-16T13:31:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/301782636",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r119996123"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/119996123"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should probably mention that it MUST be in that block in this case...",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-06-03T22:11:33Z",
      "diff_hunk" : "@@ -124,12 +124,13 @@ void TxToJSON(const CTransaction& tx, const uint256 hashBlock, UniValue& entry)\n \n UniValue getrawtransaction(const JSONRPCRequest& request)\n {\n-    if (request.fHelp || request.params.size() < 1 || request.params.size() > 2)\n+    if (request.fHelp || request.params.size() < 1 || request.params.size() > 3)\n         throw std::runtime_error(\n-            \"getrawtransaction \\\"txid\\\" ( verbose )\\n\"\n+            \"getrawtransaction \\\"txid\\\" ( verbose \\\"blockhash\\\" )\\n\"\n \n             \"\\nNOTE: By default this function only works for mempool transactions. If the -txindex option is\\n\"\n-            \"enabled, it also works for blockchain transactions.\\n\"\n+            \"enabled, it also works for blockchain transactions. If the block hash is known, it can be provided\\n\"\n+            \"for nodes without -txindex.\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r119996123",
      "id" : 119996123,
      "original_commit_id" : "8f84e8c6e1e1b357c7080ac1830d24d057b07dc0",
      "original_position" : 13,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 41928927,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/119996123",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r119996146"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/119996146"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Remove \"in chain\". Maybe \"in database\"?",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-06-03T22:13:56Z",
      "diff_hunk" : "@@ -192,34 +195,42 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\"\")\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true\")\n             + HelpExampleRpc(\"getrawtransaction\", \"\\\"mytxid\\\", true\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" false \\\"myblockhash\\\"\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true \\\"myblockhash\\\"\")\n         );\n \n     LOCK(cs_main);\n \n+    bool inMainChain = true;\n     uint256 hash = ParseHashV(request.params[0], \"parameter 1\");\n+    CBlockIndex* blockIndex = NULL;\n \n     // Accept either a bool (true) or a num (>=1) to indicate verbose output.\n     bool fVerbose = false;\n     if (request.params.size() > 1) {\n         if (request.params[1].isNum()) {\n-            if (request.params[1].get_int() != 0) {\n-                fVerbose = true;\n-            }\n+            fVerbose = (request.params[1].get_int() != 0);\n+        } else if (!request.params[1].isNull()) {\n+            fVerbose = (request.params[1].get_bool());\n         }\n-        else if(request.params[1].isBool()) {\n-            if(request.params[1].isTrue()) {\n-                fVerbose = true;\n+    }\n+\n+    if (request.params.size() > 2 && !request.params[2].isNull()) {\n+        uint256 blockHash = ParseHashV(request.params[2], \"parameter 3\");\n+        if (!blockHash.IsNull()) {\n+            BlockMap::iterator it = mapBlockIndex.find(blockHash);\n+            if (it == mapBlockIndex.end()) {\n+                throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Block hash not found in chain\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r119996146",
      "id" : 119996146,
      "original_commit_id" : "8f84e8c6e1e1b357c7080ac1830d24d057b07dc0",
      "original_position" : 67,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 41928927,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/119996146",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r119996169"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/119996169"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Whether *the block specified* is in the main chain or not... This could be false with the tx being still in the main chain!",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-06-03T22:14:43Z",
      "diff_hunk" : "@@ -139,12 +140,14 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             \"\\nArguments:\\n\"\n             \"1. \\\"txid\\\"      (string, required) The transaction id\\n\"\n             \"2. verbose       (bool, optional, default=false) If false, return a string, otherwise return a json object\\n\"\n+            \"3. \\\"blockhash\\\" (string, optional) The block in which to look for the transaction\\n\"\n \n             \"\\nResult (if verbose is not set or set to false):\\n\"\n             \"\\\"data\\\"      (string) The serialized, hex-encoded data for 'txid'\\n\"\n \n             \"\\nResult (if verbose is set to true):\\n\"\n             \"{\\n\"\n+            \"  \\\"inMainChain\\\": b,       (bool) Whether transaction is in the main chain or not. Only visible when specifying block hash\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r119996169",
      "id" : 119996169,
      "original_commit_id" : "8f84e8c6e1e1b357c7080ac1830d24d057b07dc0",
      "original_position" : 28,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 41928927,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/119996169",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "Suggested message fix on my `gettx-with-blockhash-0.14` branch (cherry-pick).",
      "created_at" : "2017-06-03T22:28:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-306005152",
      "id" : 306005152,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-06-03T22:28:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/306005152",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "Needs rebase.",
      "created_at" : "2017-06-04T18:44:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-306058851",
      "id" : 306058851,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-06-04T18:44:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/306058851",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@luke-jr Thanks for the review! I cherry-picked your commit. \r\n\r\n[[...]](https://github.com/kallewoof/bitcoin/commits/gettx-with-blockhash-unsquashed):\r\n* 2017-06-05: [7 (nits (luke-jr))](https://github.com/kallewoof/bitcoin/commit/974e4ef131c79aa78b7f7eeb759b1d729823c33e)\r\n\r\n@sipa Rebased.",
      "created_at" : "2017-06-05T00:19:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-306077485",
      "id" : 306077485,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-06-05T00:19:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/306077485",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/250224?v=3",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r120715589"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120715589"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hmm? Shouldn't we use the parameter's name here instead of \"parameter 3\"?",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-06-07T18:57:08Z",
      "diff_hunk" : "@@ -130,34 +134,42 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\"\")\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true\")\n             + HelpExampleRpc(\"getrawtransaction\", \"\\\"mytxid\\\", true\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" false \\\"myblockhash\\\"\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true \\\"myblockhash\\\"\")\n         );\n \n     LOCK(cs_main);\n \n+    bool inMainChain = true;\n     uint256 hash = ParseHashV(request.params[0], \"parameter 1\");\n+    CBlockIndex* blockIndex = NULL;\n \n     // Accept either a bool (true) or a num (>=1) to indicate verbose output.\n     bool fVerbose = false;\n     if (request.params.size() > 1) {\n         if (request.params[1].isNum()) {\n-            if (request.params[1].get_int() != 0) {\n-                fVerbose = true;\n-            }\n+            fVerbose = (request.params[1].get_int() != 0);\n+        } else if (!request.params[1].isNull()) {\n+            fVerbose = (request.params[1].get_bool());\n         }\n-        else if(request.params[1].isBool()) {\n-            if(request.params[1].isTrue()) {\n-                fVerbose = true;\n+    }\n+\n+    if (request.params.size() > 2 && !request.params[2].isNull()) {\n+        uint256 blockHash = ParseHashV(request.params[2], \"parameter 3\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r120715589",
      "id" : 120715589,
      "original_commit_id" : "caa27c1d5d9491f4e0e51ae88874dbcf0f4d6be4",
      "original_position" : 64,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 42702171,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120715589",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r120717627"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120717627"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hmm, maybe say \"if blockhash is specified\" or otherwise mention this wont appear unless a blockhash is provided. Even better, fill it out if GetTransaction returns the blockhash cause it found it via UTXO/txindex.",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-06-07T19:06:07Z",
      "diff_hunk" : "@@ -77,12 +79,14 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             \"\\nArguments:\\n\"\n             \"1. \\\"txid\\\"      (string, required) The transaction id\\n\"\n             \"2. verbose       (bool, optional, default=false) If false, return a string, otherwise return a json object\\n\"\n+            \"3. \\\"blockhash\\\" (string, optional) The block in which to look for the transaction\\n\"\n \n             \"\\nResult (if verbose is not set or set to false):\\n\"\n             \"\\\"data\\\"      (string) The serialized, hex-encoded data for 'txid'\\n\"\n \n             \"\\nResult (if verbose is set to true):\\n\"\n             \"{\\n\"\n+            \"  \\\"inMainChain\\\": b,       (bool) Whether specified block is in the main chain or not\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r120717627",
      "id" : 120717627,
      "original_commit_id" : "caa27c1d5d9491f4e0e51ae88874dbcf0f4d6be4",
      "original_position" : 29,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 42702171,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120717627",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r120718991"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120718991"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "grammar nit: this reads funny to me, and could be a bit more explicit. Maybe:\r\n\r\n\"If the block which contains the transaction is known, its hash can be provided even for nodes without -txindex.\"\r\n\"Note that if a blockhash is provided, only it will be searched and if the transaction is in mempool, other blocks, or if this node does not have the given block available, the transaction will not be found.\"",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-06-07T19:12:31Z",
      "diff_hunk" : "@@ -62,12 +62,14 @@ void TxToJSON(const CTransaction& tx, const uint256 hashBlock, UniValue& entry)\n \n UniValue getrawtransaction(const JSONRPCRequest& request)\n {\n-    if (request.fHelp || request.params.size() < 1 || request.params.size() > 2)\n+    if (request.fHelp || request.params.size() < 1 || request.params.size() > 3)\n         throw std::runtime_error(\n-            \"getrawtransaction \\\"txid\\\" ( verbose )\\n\"\n+            \"getrawtransaction \\\"txid\\\" ( verbose \\\"blockhash\\\" )\\n\"\n \n             \"\\nNOTE: By default this function only works for mempool transactions. If the -txindex option is\\n\"\n-            \"enabled, it also works for blockchain transactions.\\n\"\n+            \"enabled, it also works for blockchain transactions. If the block hash is known, it can be provided\\n\"\n+            \"for nodes without -txindex, in which case the transaction will only be found if it is in that\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r120718991",
      "id" : 120718991,
      "original_commit_id" : "caa27c1d5d9491f4e0e51ae88874dbcf0f4d6be4",
      "original_position" : 13,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 42702171,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120718991",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r120719169"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120719169"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe further update this error message, eg if (blockIndex) \"No such transaction found in the provided block\".",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-06-07T19:13:25Z",
      "diff_hunk" : "@@ -130,34 +134,42 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\"\")\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true\")\n             + HelpExampleRpc(\"getrawtransaction\", \"\\\"mytxid\\\", true\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" false \\\"myblockhash\\\"\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true \\\"myblockhash\\\"\")\n         );\n \n     LOCK(cs_main);\n \n+    bool inMainChain = true;\n     uint256 hash = ParseHashV(request.params[0], \"parameter 1\");\n+    CBlockIndex* blockIndex = NULL;\n \n     // Accept either a bool (true) or a num (>=1) to indicate verbose output.\n     bool fVerbose = false;\n     if (request.params.size() > 1) {\n         if (request.params[1].isNum()) {\n-            if (request.params[1].get_int() != 0) {\n-                fVerbose = true;\n-            }\n+            fVerbose = (request.params[1].get_int() != 0);\n+        } else if (!request.params[1].isNull()) {\n+            fVerbose = (request.params[1].get_bool());\n         }\n-        else if(request.params[1].isBool()) {\n-            if(request.params[1].isTrue()) {\n-                fVerbose = true;\n+    }\n+\n+    if (request.params.size() > 2 && !request.params[2].isNull()) {\n+        uint256 blockHash = ParseHashV(request.params[2], \"parameter 3\");\n+        if (!blockHash.IsNull()) {\n+            BlockMap::iterator it = mapBlockIndex.find(blockHash);\n+            if (it == mapBlockIndex.end()) {\n+                throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Block hash not found\");\n             }\n-        }\n-        else {\n-            throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid type provided. Verbose parameter must be a boolean.\");\n+            blockIndex = it->second;\n+            inMainChain = (chainActive[blockIndex->nHeight] == blockIndex);\n         }\n     }\n \n     CTransactionRef tx;\n     uint256 hashBlock;\n-    if (!GetTransaction(hash, tx, Params().GetConsensus(), hashBlock, true))\n-        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, std::string(fTxIndex ? \"No such mempool or blockchain transaction\"\n+    if (!GetTransaction(hash, tx, Params().GetConsensus(), hashBlock, true, blockIndex))\n+        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, std::string(fTxIndex || blockIndex ? \"No such mempool or blockchain transaction\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r120719169",
      "id" : 120719169,
      "original_commit_id" : "caa27c1d5d9491f4e0e51ae88874dbcf0f4d6be4",
      "original_position" : 83,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 42702171,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120719169",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r120798213"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120798213"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, that looks better yeah. Adding with minor tweaks.\r\n```C++\r\n            \"\\nNOTE: By default this function only works for mempool transactions. If the -txindex option is\\n\"\r\n            \"enabled, it also works for blockchain transactions. If the block which contains the transaction\\n\"\r\n            \"is known, its hash can be provided even for nodes without -txindex. Note that if a blockhash is\\n\"\r\n            \"provided, only that block will be searched and if the transaction is in the mempool or other\\n\"\r\n            \"blocks, or if this node does not have the given block available, the transaction will not be found.\\n\"\r\n```\r\n",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-06-08T04:34:31Z",
      "diff_hunk" : "@@ -62,12 +62,14 @@ void TxToJSON(const CTransaction& tx, const uint256 hashBlock, UniValue& entry)\n \n UniValue getrawtransaction(const JSONRPCRequest& request)\n {\n-    if (request.fHelp || request.params.size() < 1 || request.params.size() > 2)\n+    if (request.fHelp || request.params.size() < 1 || request.params.size() > 3)\n         throw std::runtime_error(\n-            \"getrawtransaction \\\"txid\\\" ( verbose )\\n\"\n+            \"getrawtransaction \\\"txid\\\" ( verbose \\\"blockhash\\\" )\\n\"\n \n             \"\\nNOTE: By default this function only works for mempool transactions. If the -txindex option is\\n\"\n-            \"enabled, it also works for blockchain transactions.\\n\"\n+            \"enabled, it also works for blockchain transactions. If the block hash is known, it can be provided\\n\"\n+            \"for nodes without -txindex, in which case the transaction will only be found if it is in that\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r120798213",
      "id" : 120798213,
      "in_reply_to_id" : 120718991,
      "original_commit_id" : "caa27c1d5d9491f4e0e51ae88874dbcf0f4d6be4",
      "original_position" : 13,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 42790097,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120798213",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r120798376"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120798376"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I was sure I did, but guess not:\r\n```C++\r\n            \"  \\\"inMainChain\\\": b,     (bool) Whether specified block is in the main chain or not (only present with explicit \\\"blockhash\\\" argument)\\n\"\r\n```\r\nI like the idea of including when able but will keep it out of this PR for now.",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-06-08T04:36:44Z",
      "diff_hunk" : "@@ -77,12 +79,14 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             \"\\nArguments:\\n\"\n             \"1. \\\"txid\\\"      (string, required) The transaction id\\n\"\n             \"2. verbose       (bool, optional, default=false) If false, return a string, otherwise return a json object\\n\"\n+            \"3. \\\"blockhash\\\" (string, optional) The block in which to look for the transaction\\n\"\n \n             \"\\nResult (if verbose is not set or set to false):\\n\"\n             \"\\\"data\\\"      (string) The serialized, hex-encoded data for 'txid'\\n\"\n \n             \"\\nResult (if verbose is set to true):\\n\"\n             \"{\\n\"\n+            \"  \\\"inMainChain\\\": b,       (bool) Whether specified block is in the main chain or not\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r120798376",
      "id" : 120798376,
      "in_reply_to_id" : 120717627,
      "original_commit_id" : "caa27c1d5d9491f4e0e51ae88874dbcf0f4d6be4",
      "original_position" : 29,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 42790266,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120798376",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r120798462"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120798462"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The general tendency seems to be to identify the parameter index so I stuck with that. I agree it may be better to be more descriptive though...",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-06-08T04:37:52Z",
      "diff_hunk" : "@@ -130,34 +134,42 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\"\")\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true\")\n             + HelpExampleRpc(\"getrawtransaction\", \"\\\"mytxid\\\", true\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" false \\\"myblockhash\\\"\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true \\\"myblockhash\\\"\")\n         );\n \n     LOCK(cs_main);\n \n+    bool inMainChain = true;\n     uint256 hash = ParseHashV(request.params[0], \"parameter 1\");\n+    CBlockIndex* blockIndex = NULL;\n \n     // Accept either a bool (true) or a num (>=1) to indicate verbose output.\n     bool fVerbose = false;\n     if (request.params.size() > 1) {\n         if (request.params[1].isNum()) {\n-            if (request.params[1].get_int() != 0) {\n-                fVerbose = true;\n-            }\n+            fVerbose = (request.params[1].get_int() != 0);\n+        } else if (!request.params[1].isNull()) {\n+            fVerbose = (request.params[1].get_bool());\n         }\n-        else if(request.params[1].isBool()) {\n-            if(request.params[1].isTrue()) {\n-                fVerbose = true;\n+    }\n+\n+    if (request.params.size() > 2 && !request.params[2].isNull()) {\n+        uint256 blockHash = ParseHashV(request.params[2], \"parameter 3\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r120798462",
      "id" : 120798462,
      "in_reply_to_id" : 120715589,
      "original_commit_id" : "caa27c1d5d9491f4e0e51ae88874dbcf0f4d6be4",
      "original_position" : 64,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 42790352,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120798462",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r120798796"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120798796"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah, I wanted to avoid `?:?:`. Rewritten as:\r\n```C++\r\n    if (!GetTransaction(hash, tx, Params().GetConsensus(), hashBlock, true, blockIndex)) {\r\n        std::string errmsg;\r\n        if (blockIndex) {\r\n            errmsg = \"No such transaction found in the provided block\";\r\n        } else {\r\n            errmsg = fTxIndex\r\n              ? \"No such mempool or blockchain transaction\"\r\n              : \"No such mempool transaction. Use -txindex to enable blockchain transaction queries\";\r\n        }\r\n        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, errmsg + \". Use gettransaction for wallet transactions.\");\r\n    }\r\n```\r\n",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-06-08T04:41:33Z",
      "diff_hunk" : "@@ -130,34 +134,42 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\"\")\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true\")\n             + HelpExampleRpc(\"getrawtransaction\", \"\\\"mytxid\\\", true\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" false \\\"myblockhash\\\"\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true \\\"myblockhash\\\"\")\n         );\n \n     LOCK(cs_main);\n \n+    bool inMainChain = true;\n     uint256 hash = ParseHashV(request.params[0], \"parameter 1\");\n+    CBlockIndex* blockIndex = NULL;\n \n     // Accept either a bool (true) or a num (>=1) to indicate verbose output.\n     bool fVerbose = false;\n     if (request.params.size() > 1) {\n         if (request.params[1].isNum()) {\n-            if (request.params[1].get_int() != 0) {\n-                fVerbose = true;\n-            }\n+            fVerbose = (request.params[1].get_int() != 0);\n+        } else if (!request.params[1].isNull()) {\n+            fVerbose = (request.params[1].get_bool());\n         }\n-        else if(request.params[1].isBool()) {\n-            if(request.params[1].isTrue()) {\n-                fVerbose = true;\n+    }\n+\n+    if (request.params.size() > 2 && !request.params[2].isNull()) {\n+        uint256 blockHash = ParseHashV(request.params[2], \"parameter 3\");\n+        if (!blockHash.IsNull()) {\n+            BlockMap::iterator it = mapBlockIndex.find(blockHash);\n+            if (it == mapBlockIndex.end()) {\n+                throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Block hash not found\");\n             }\n-        }\n-        else {\n-            throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid type provided. Verbose parameter must be a boolean.\");\n+            blockIndex = it->second;\n+            inMainChain = (chainActive[blockIndex->nHeight] == blockIndex);\n         }\n     }\n \n     CTransactionRef tx;\n     uint256 hashBlock;\n-    if (!GetTransaction(hash, tx, Params().GetConsensus(), hashBlock, true))\n-        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, std::string(fTxIndex ? \"No such mempool or blockchain transaction\"\n+    if (!GetTransaction(hash, tx, Params().GetConsensus(), hashBlock, true, blockIndex))\n+        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, std::string(fTxIndex || blockIndex ? \"No such mempool or blockchain transaction\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r120798796",
      "id" : 120798796,
      "in_reply_to_id" : 120719169,
      "original_commit_id" : "caa27c1d5d9491f4e0e51ae88874dbcf0f4d6be4",
      "original_position" : 83,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 42790704,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120798796",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "body" : "@TheBlueMatt Thanks for the review!\r\n\r\n> Generally we try to make sure that after each individual commit, at least it builds and all tests pass.\r\n\r\nWe try to keep tests as separate commits though, so that would assume tests and code changes come in pairs (tests will fail before test commit or after test commit and before change commit, obv). That was my intention with the split here. I may have screwed up. I'll double check and/or squash as appropriate.\r\n\r\nEdit: I noticed the order was off (two fixes then two tests). Rearranged them. The commit/test pairs now pass make check individually (i.e. a43ec61 and 8f2ce52).\r\n\r\nEdit 2: [[...]](https://github.com/kallewoof/bitcoin/commits/gettx-with-blockhash-unsquashed):\r\n* 2017-06-08: [8 (nits)](https://github.com/kallewoof/bitcoin/commit/65d77eaf656547f0ee1539b01eb180968c1fee79)",
      "created_at" : "2017-06-08T04:43:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-306996708",
      "id" : 306996708,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-06-08T05:10:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/306996708",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/250224?v=3",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "body" : "utACK 8f2ce52c9257392d7e6523b39a26e9697a30ca76",
      "created_at" : "2017-06-22T21:15:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-310504749",
      "id" : 310504749,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-06-22T21:15:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/310504749",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "Needs rebase.",
      "created_at" : "2017-07-14T08:09:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-315299193",
      "id" : 315299193,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-07-14T08:09:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/315299193",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Rebased.",
      "created_at" : "2017-07-14T09:48:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-315319217",
      "id" : 315319217,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-07-14T09:48:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/315319217",
      "user" : {
         "avatar_url" : "https://avatars4.githubusercontent.com/u/250224?v=3",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "body" : "a) Is there a reason why mainchain height is not supported as alternative for the blockhash? Eventually with a security of only accepting heights of a hundred blocks below the tip as a reorganisation protection (but I'd prefer to not add this protection).\r\n\r\nb) @kallewoof the idea about the standard for a transaction reference has already been worked into a BIP: https://github.com/bitcoin/bips/pull/555 (maybe we can support this Ã¢ÂÂ if we agree on that BIP to be worth implementing Ã¢ÂÂÃÂ also via `getrawtransaction`).",
      "created_at" : "2017-07-14T09:53:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-315320364",
      "id" : 315320364,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-07-14T09:53:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/315320364",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "@jonasschnelli Regarding height, I chose not to include it as it could potentially cause unexpected results when a reorg happens, but if people don't think that's an issue it should be fairly straightforward to allow for both.\r\n\r\nEdit: as for the standard, that looks exciting for sure. If it matures enough and this PR isn't merged already I may take a stab at it.",
      "created_at" : "2017-07-14T10:18:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-315325449",
      "id" : 315325449,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-07-14T10:18:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/315325449",
      "user" : {
         "avatar_url" : "https://avatars4.githubusercontent.com/u/250224?v=3",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r127816715"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/127816715"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This may be confused with Params().NetworkIDString() == \"main\" (kind of like we do with \"testnet\" in getinfo).\r\nCan we rename to \"inActiveChain\" or something of the sort?",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-07-17T20:30:31Z",
      "diff_hunk" : "@@ -76,12 +79,14 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             \"\\nArguments:\\n\"\n             \"1. \\\"txid\\\"      (string, required) The transaction id\\n\"\n             \"2. verbose       (bool, optional, default=false) If false, return a string, otherwise return a json object\\n\"\n+            \"3. \\\"blockhash\\\" (string, optional) The block in which to look for the transaction\\n\"\n \n             \"\\nResult (if verbose is not set or set to false):\\n\"\n             \"\\\"data\\\"      (string) The serialized, hex-encoded data for 'txid'\\n\"\n \n             \"\\nResult (if verbose is set to true):\\n\"\n             \"{\\n\"\n+            \"  \\\"inMainChain\\\": b,     (bool) Whether specified block is in the main chain or not (only present with explicit \\\"blockhash\\\" argument)\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r127816715",
      "id" : 127816715,
      "original_commit_id" : "3ec2d287e24c9cc573ead2898546499abf49db9d",
      "original_position" : 30,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 50438104,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/127816715",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1008458?v=4",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r127818832"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/127818832"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Perhaps the diff can be less disruptive by moving everything inside ```if (!blockIndex) {...}``` to a new static function defined right above instead of indenting all of it?",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-07-17T20:38:45Z",
      "diff_hunk" : "@@ -900,43 +900,44 @@ bool AcceptToMemoryPool(CTxMemPool& pool, CValidationState &state, const CTransa\n }\n \n /** Return transaction in txOut, and if it was found inside a block, its hash is placed in hashBlock */\n-bool GetTransaction(const uint256 &hash, CTransactionRef &txOut, const Consensus::Params& consensusParams, uint256 &hashBlock, bool fAllowSlow)\n+bool GetTransaction(const uint256 &hash, CTransactionRef &txOut, const Consensus::Params& consensusParams, uint256 &hashBlock, bool fAllowSlow, CBlockIndex* blockIndex)\n {\n-    CBlockIndex *pindexSlow = NULL;\n+    CBlockIndex* pindexSlow = blockIndex;\n \n     LOCK(cs_main);\n \n-    CTransactionRef ptx = mempool.get(hash);\n-    if (ptx)\n-    {\n-        txOut = ptx;\n-        return true;\n-    }\n+    if (!blockIndex) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r127818832",
      "id" : 127818832,
      "original_commit_id" : "3ec2d287e24c9cc573ead2898546499abf49db9d",
      "original_position" : 18,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 50440382,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/127818832",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1008458?v=4",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "utACK 3ec2d287e24c9cc573ead2898546499abf49db9d besides small nits.",
      "created_at" : "2017-07-17T20:45:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-315877808",
      "id" : 315877808,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-07-17T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/315877808",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1008458?v=4",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r127875966"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/127875966"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm not a huge fan of changing code just to make diffs smaller, and as I mention above, you can put `?w=1` to get diff without indentation changes.",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-07-18T03:32:33Z",
      "diff_hunk" : "@@ -900,43 +900,44 @@ bool AcceptToMemoryPool(CTxMemPool& pool, CValidationState &state, const CTransa\n }\n \n /** Return transaction in txOut, and if it was found inside a block, its hash is placed in hashBlock */\n-bool GetTransaction(const uint256 &hash, CTransactionRef &txOut, const Consensus::Params& consensusParams, uint256 &hashBlock, bool fAllowSlow)\n+bool GetTransaction(const uint256 &hash, CTransactionRef &txOut, const Consensus::Params& consensusParams, uint256 &hashBlock, bool fAllowSlow, CBlockIndex* blockIndex)\n {\n-    CBlockIndex *pindexSlow = NULL;\n+    CBlockIndex* pindexSlow = blockIndex;\n \n     LOCK(cs_main);\n \n-    CTransactionRef ptx = mempool.get(hash);\n-    if (ptx)\n-    {\n-        txOut = ptx;\n-        return true;\n-    }\n+    if (!blockIndex) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r127875966",
      "id" : 127875966,
      "in_reply_to_id" : 127818832,
      "original_commit_id" : "3ec2d287e24c9cc573ead2898546499abf49db9d",
      "original_position" : 18,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 50501504,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/127875966",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "body" : "Addressed @jtimon nits.\r\n@jonasschnelli I added support for supplying block height instead of block hash.",
      "created_at" : "2017-07-18T03:45:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-315950004",
      "id" : 315950004,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-07-18T03:45:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/315950004",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "body" : "I'm not sure about allowing the height.\r\nOne can always call getblockhash if he knows the txid and block height without knowing the block hash somehow.\r\nThat's not the case for the BIP proposal @jonasschnelli refers to, since they don't know the txid anyway (only block height and tx position). I suggest we leave the BIP discussion out of this PR, which in my opinion makes sense on its own. And also leave the height option for later (or never).\r\n",
      "created_at" : "2017-07-18T21:59:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-316210666",
      "id" : 316210666,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-07-18T21:59:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/316210666",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1008458?v=4",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "@jtimon It feels like a convenience thing that, IMO, getblock should have as well (i.e. allow both height number and block hash). I don't have a strong opinion on the subject though, and will drop the last 2 commits (height support) whenever this is ready for merging unless someone argues for block height support.\r\n",
      "created_at" : "2017-07-19T02:15:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-316252594",
      "id" : 316252594,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-07-19T02:15:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/316252594",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "body" : "Well, don't have a strong opinion on adding the block height either, if more people like it, let's keep it.\r\nOr perhaps it can be proposed after this for both getrawtransaction and getblock at the same time?\r\n",
      "created_at" : "2017-07-20T19:46:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-316810151",
      "id" : 316810151,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-07-20T19:46:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/316810151",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1008458?v=4",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "concept ACK, needs rebase/squash, would review",
      "created_at" : "2017-08-23T15:12:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-324367771",
      "id" : 324367771,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-08-23T15:12:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/324367771",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "body" : "@instagibbs Rebased & squashed; also removed block height option for now. Will push as separate PR if desirable.",
      "created_at" : "2017-08-24T07:25:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-324555587",
      "id" : 324555587,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-08-24T07:25:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/324555587",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r135016562"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/135016562"
         }
      },
      "author_association" : "MEMBER",
      "body" : "maybe `in_active_chain`? I'm parsing this as \"inactive chain\"",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-08-24T13:38:59Z",
      "diff_hunk" : "@@ -76,12 +79,14 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             \"\\nArguments:\\n\"\n             \"1. \\\"txid\\\"      (string, required) The transaction id\\n\"\n             \"2. verbose       (bool, optional, default=false) If false, return a string, otherwise return a json object\\n\"\n+            \"3. \\\"blockhash\\\" (string, optional) The block in which to look for the transaction\\n\"\n \n             \"\\nResult (if verbose is not set or set to false):\\n\"\n             \"\\\"data\\\"      (string) The serialized, hex-encoded data for 'txid'\\n\"\n \n             \"\\nResult (if verbose is set to true):\\n\"\n             \"{\\n\"\n+            \"  \\\"inActiveChain\\\": b,   (bool) Whether specified block is in the active chain or not (only present with explicit \\\"blockhash\\\" argument)\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r135016562",
      "id" : 135016562,
      "original_commit_id" : "cc75dab930d5fb340e8cf9948e3caf3284320d3c",
      "original_position" : 30,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 58379205,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/135016562",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r135016993"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/135016993"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`in_active_chain` to conform to new style guide and make easier to read.",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-08-24T13:40:38Z",
      "diff_hunk" : "@@ -129,41 +134,53 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\"\")\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true\")\n             + HelpExampleRpc(\"getrawtransaction\", \"\\\"mytxid\\\", true\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" false \\\"myblockhash\\\"\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true \\\"myblockhash\\\"\")\n         );\n \n     LOCK(cs_main);\n \n+    bool inActiveChain = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r135016993",
      "id" : 135016993,
      "original_commit_id" : "cc75dab930d5fb340e8cf9948e3caf3284320d3c",
      "original_position" : 44,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 58379205,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/135016993",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r135018818"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/135018818"
         }
      },
      "author_association" : "MEMBER",
      "body" : "should skip this logic if user has provided the blockhash?",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-08-24T13:47:24Z",
      "diff_hunk" : "@@ -897,43 +897,44 @@ bool AcceptToMemoryPool(CTxMemPool& pool, CValidationState &state, const CTransa\n }\n \n /** Return transaction in txOut, and if it was found inside a block, its hash is placed in hashBlock */\n-bool GetTransaction(const uint256 &hash, CTransactionRef &txOut, const Consensus::Params& consensusParams, uint256 &hashBlock, bool fAllowSlow)\n+bool GetTransaction(const uint256& hash, CTransactionRef& txOut, const Consensus::Params& consensusParams, uint256& hashBlock, bool fAllowSlow, CBlockIndex* blockIndex)\n {\n-    CBlockIndex *pindexSlow = nullptr;\n+    CBlockIndex* pindexSlow = blockIndex;\n \n     LOCK(cs_main);\n \n-    CTransactionRef ptx = mempool.get(hash);\n-    if (ptx)\n-    {\n-        txOut = ptx;\n-        return true;\n-    }\n+    if (!blockIndex) {\n+        CTransactionRef ptx = mempool.get(hash);\n+        if (ptx) {\n+            txOut = ptx;\n+            return true;\n+        }\n \n-    if (fTxIndex) {\n-        CDiskTxPos postx;\n-        if (pblocktree->ReadTxIndex(hash, postx)) {\n-            CAutoFile file(OpenBlockFile(postx, true), SER_DISK, CLIENT_VERSION);\n-            if (file.IsNull())\n-                return error(\"%s: OpenBlockFile failed\", __func__);\n-            CBlockHeader header;\n-            try {\n-                file >> header;\n-                fseek(file.Get(), postx.nTxOffset, SEEK_CUR);\n-                file >> txOut;\n-            } catch (const std::exception& e) {\n-                return error(\"%s: Deserialize or I/O error - %s\", __func__, e.what());\n+        if (fTxIndex) {\n+            CDiskTxPos postx;\n+            if (pblocktree->ReadTxIndex(hash, postx)) {\n+                CAutoFile file(OpenBlockFile(postx, true), SER_DISK, CLIENT_VERSION);\n+                if (file.IsNull())\n+                    return error(\"%s: OpenBlockFile failed\", __func__);\n+                CBlockHeader header;\n+                try {\n+                    file >> header;\n+                    fseek(file.Get(), postx.nTxOffset, SEEK_CUR);\n+                    file >> txOut;\n+                } catch (const std::exception& e) {\n+                    return error(\"%s: Deserialize or I/O error - %s\", __func__, e.what());\n+                }\n+                hashBlock = header.GetHash();\n+                if (txOut->GetHash() != hash)\n+                    return error(\"%s: txid mismatch\", __func__);\n+                return true;\n             }\n-            hashBlock = header.GetHash();\n-            if (txOut->GetHash() != hash)\n-                return error(\"%s: txid mismatch\", __func__);\n-            return true;\n         }\n-    }\n \n-    if (fAllowSlow) { // use coin database to locate block that contains transaction, and scan it\n-        const Coin& coin = AccessByTxid(*pcoinsTip, hash);\n-        if (!coin.IsSpent()) pindexSlow = chainActive[coin.nHeight];\n+        if (fAllowSlow) { // use coin database to locate block that contains transaction, and scan it",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r135018818",
      "id" : 135018818,
      "original_commit_id" : "cc75dab930d5fb340e8cf9948e3caf3284320d3c",
      "original_position" : 67,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 58379205,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/135018818",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r135165744"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/135165744"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is inside the `if (!blockIndex)` block so it should never execute if a block hash was provided, no?",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-08-25T01:09:01Z",
      "diff_hunk" : "@@ -897,43 +897,44 @@ bool AcceptToMemoryPool(CTxMemPool& pool, CValidationState &state, const CTransa\n }\n \n /** Return transaction in txOut, and if it was found inside a block, its hash is placed in hashBlock */\n-bool GetTransaction(const uint256 &hash, CTransactionRef &txOut, const Consensus::Params& consensusParams, uint256 &hashBlock, bool fAllowSlow)\n+bool GetTransaction(const uint256& hash, CTransactionRef& txOut, const Consensus::Params& consensusParams, uint256& hashBlock, bool fAllowSlow, CBlockIndex* blockIndex)\n {\n-    CBlockIndex *pindexSlow = nullptr;\n+    CBlockIndex* pindexSlow = blockIndex;\n \n     LOCK(cs_main);\n \n-    CTransactionRef ptx = mempool.get(hash);\n-    if (ptx)\n-    {\n-        txOut = ptx;\n-        return true;\n-    }\n+    if (!blockIndex) {\n+        CTransactionRef ptx = mempool.get(hash);\n+        if (ptx) {\n+            txOut = ptx;\n+            return true;\n+        }\n \n-    if (fTxIndex) {\n-        CDiskTxPos postx;\n-        if (pblocktree->ReadTxIndex(hash, postx)) {\n-            CAutoFile file(OpenBlockFile(postx, true), SER_DISK, CLIENT_VERSION);\n-            if (file.IsNull())\n-                return error(\"%s: OpenBlockFile failed\", __func__);\n-            CBlockHeader header;\n-            try {\n-                file >> header;\n-                fseek(file.Get(), postx.nTxOffset, SEEK_CUR);\n-                file >> txOut;\n-            } catch (const std::exception& e) {\n-                return error(\"%s: Deserialize or I/O error - %s\", __func__, e.what());\n+        if (fTxIndex) {\n+            CDiskTxPos postx;\n+            if (pblocktree->ReadTxIndex(hash, postx)) {\n+                CAutoFile file(OpenBlockFile(postx, true), SER_DISK, CLIENT_VERSION);\n+                if (file.IsNull())\n+                    return error(\"%s: OpenBlockFile failed\", __func__);\n+                CBlockHeader header;\n+                try {\n+                    file >> header;\n+                    fseek(file.Get(), postx.nTxOffset, SEEK_CUR);\n+                    file >> txOut;\n+                } catch (const std::exception& e) {\n+                    return error(\"%s: Deserialize or I/O error - %s\", __func__, e.what());\n+                }\n+                hashBlock = header.GetHash();\n+                if (txOut->GetHash() != hash)\n+                    return error(\"%s: txid mismatch\", __func__);\n+                return true;\n             }\n-            hashBlock = header.GetHash();\n-            if (txOut->GetHash() != hash)\n-                return error(\"%s: txid mismatch\", __func__);\n-            return true;\n         }\n-    }\n \n-    if (fAllowSlow) { // use coin database to locate block that contains transaction, and scan it\n-        const Coin& coin = AccessByTxid(*pcoinsTip, hash);\n-        if (!coin.IsSpent()) pindexSlow = chainActive[coin.nHeight];\n+        if (fAllowSlow) { // use coin database to locate block that contains transaction, and scan it",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r135165744",
      "id" : 135165744,
      "in_reply_to_id" : 135018818,
      "original_commit_id" : "cc75dab930d5fb340e8cf9948e3caf3284320d3c",
      "original_position" : 67,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 58549203,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/135165744",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r135167500"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/135167500"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oops! Not good at counting brackets.",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-08-25T01:27:18Z",
      "diff_hunk" : "@@ -897,43 +897,44 @@ bool AcceptToMemoryPool(CTxMemPool& pool, CValidationState &state, const CTransa\n }\n \n /** Return transaction in txOut, and if it was found inside a block, its hash is placed in hashBlock */\n-bool GetTransaction(const uint256 &hash, CTransactionRef &txOut, const Consensus::Params& consensusParams, uint256 &hashBlock, bool fAllowSlow)\n+bool GetTransaction(const uint256& hash, CTransactionRef& txOut, const Consensus::Params& consensusParams, uint256& hashBlock, bool fAllowSlow, CBlockIndex* blockIndex)\n {\n-    CBlockIndex *pindexSlow = nullptr;\n+    CBlockIndex* pindexSlow = blockIndex;\n \n     LOCK(cs_main);\n \n-    CTransactionRef ptx = mempool.get(hash);\n-    if (ptx)\n-    {\n-        txOut = ptx;\n-        return true;\n-    }\n+    if (!blockIndex) {\n+        CTransactionRef ptx = mempool.get(hash);\n+        if (ptx) {\n+            txOut = ptx;\n+            return true;\n+        }\n \n-    if (fTxIndex) {\n-        CDiskTxPos postx;\n-        if (pblocktree->ReadTxIndex(hash, postx)) {\n-            CAutoFile file(OpenBlockFile(postx, true), SER_DISK, CLIENT_VERSION);\n-            if (file.IsNull())\n-                return error(\"%s: OpenBlockFile failed\", __func__);\n-            CBlockHeader header;\n-            try {\n-                file >> header;\n-                fseek(file.Get(), postx.nTxOffset, SEEK_CUR);\n-                file >> txOut;\n-            } catch (const std::exception& e) {\n-                return error(\"%s: Deserialize or I/O error - %s\", __func__, e.what());\n+        if (fTxIndex) {\n+            CDiskTxPos postx;\n+            if (pblocktree->ReadTxIndex(hash, postx)) {\n+                CAutoFile file(OpenBlockFile(postx, true), SER_DISK, CLIENT_VERSION);\n+                if (file.IsNull())\n+                    return error(\"%s: OpenBlockFile failed\", __func__);\n+                CBlockHeader header;\n+                try {\n+                    file >> header;\n+                    fseek(file.Get(), postx.nTxOffset, SEEK_CUR);\n+                    file >> txOut;\n+                } catch (const std::exception& e) {\n+                    return error(\"%s: Deserialize or I/O error - %s\", __func__, e.what());\n+                }\n+                hashBlock = header.GetHash();\n+                if (txOut->GetHash() != hash)\n+                    return error(\"%s: txid mismatch\", __func__);\n+                return true;\n             }\n-            hashBlock = header.GetHash();\n-            if (txOut->GetHash() != hash)\n-                return error(\"%s: txid mismatch\", __func__);\n-            return true;\n         }\n-    }\n \n-    if (fAllowSlow) { // use coin database to locate block that contains transaction, and scan it\n-        const Coin& coin = AccessByTxid(*pcoinsTip, hash);\n-        if (!coin.IsSpent()) pindexSlow = chainActive[coin.nHeight];\n+        if (fAllowSlow) { // use coin database to locate block that contains transaction, and scan it",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r135167500",
      "id" : 135167500,
      "in_reply_to_id" : 135018818,
      "original_commit_id" : "cc75dab930d5fb340e8cf9948e3caf3284320d3c",
      "original_position" : 67,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 58551051,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/135167500",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "body" : "I fail at counting brackets.\r\n\r\nutACK https://github.com/bitcoin/bitcoin/pull/10275/commits/440123fb8c7196a7ee209495f02b2f7c0deaa0bb",
      "created_at" : "2017-08-25T01:29:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-324800051",
      "id" : 324800051,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-08-25T01:29:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/324800051",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r136588539"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136588539"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: alignment",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-09-01T14:32:33Z",
      "diff_hunk" : "@@ -76,12 +79,14 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             \"\\nArguments:\\n\"\n             \"1. \\\"txid\\\"      (string, required) The transaction id\\n\"\n             \"2. verbose       (bool, optional, default=false) If false, return a string, otherwise return a json object\\n\"\n+            \"3. \\\"blockhash\\\" (string, optional) The block in which to look for the transaction\\n\"\n \n             \"\\nResult (if verbose is not set or set to false):\\n\"\n             \"\\\"data\\\"      (string) The serialized, hex-encoded data for 'txid'\\n\"\n \n             \"\\nResult (if verbose is set to true):\\n\"\n             \"{\\n\"\n+            \"  \\\"in_active_chain\\\": b, (bool) Whether specified block is in the active chain or not (only present with explicit \\\"blockhash\\\" argument)\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r136588539",
      "id" : 136588539,
      "original_commit_id" : "440123fb8c7196a7ee209495f02b2f7c0deaa0bb",
      "original_position" : 30,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : 32,
      "pull_request_review_id" : 60152203,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136588539",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r136589098"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136589098"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think we would also hit this error if the block had been pruned. In that case, this error is misleading.\r\n\r\nIs there any way to test above for whether the block has been pruned and error out before doing the transaction lookup?",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-09-01T14:34:57Z",
      "diff_hunk" : "@@ -129,42 +134,55 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\"\")\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true\")\n             + HelpExampleRpc(\"getrawtransaction\", \"\\\"mytxid\\\", true\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" false \\\"myblockhash\\\"\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true \\\"myblockhash\\\"\")\n         );\n \n     LOCK(cs_main);\n \n+    bool in_active_chain = true;\n     uint256 hash = ParseHashV(request.params[0], \"parameter 1\");\n+    CBlockIndex* blockindex = nullptr;\n \n     // Accept either a bool (true) or a num (>=1) to indicate verbose output.\n     bool fVerbose = false;\n     if (!request.params[1].isNull()) {\n-        if (request.params[1].isNum()) {\n-            if (request.params[1].get_int() != 0) {\n-                fVerbose = true;\n-            }\n-        }\n-        else if(request.params[1].isBool()) {\n-            if(request.params[1].isTrue()) {\n-                fVerbose = true;\n+        fVerbose = request.params[1].isNum() ? (request.params[1].get_int() != 0) : request.params[1].get_bool();\n+    }\n+\n+    if (!request.params[2].isNull()) {\n+        uint256 blockhash = ParseHashV(request.params[2], \"parameter 3\");\n+        if (!blockhash.IsNull()) {\n+            BlockMap::iterator it = mapBlockIndex.find(blockhash);\n+            if (it == mapBlockIndex.end()) {\n+                throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Block hash not found\");\n             }\n-        }\n-        else {\n-            throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid type provided. Verbose parameter must be a boolean.\");\n+            blockindex = it->second;\n+            in_active_chain = (chainActive[blockindex->nHeight] == blockindex);\n         }\n     }\n \n     CTransactionRef tx;\n-    uint256 hashBlock;\n-    if (!GetTransaction(hash, tx, Params().GetConsensus(), hashBlock, true))\n-        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, std::string(fTxIndex ? \"No such mempool or blockchain transaction\"\n-            : \"No such mempool transaction. Use -txindex to enable blockchain transaction queries\") +\n-            \". Use gettransaction for wallet transactions.\");\n+    uint256 hash_block;\n+    if (!GetTransaction(hash, tx, Params().GetConsensus(), hash_block, true, blockindex)) {\n+        std::string errmsg;\n+        if (blockindex) {\n+            errmsg = \"No such transaction found in the provided block\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r136589098",
      "id" : 136589098,
      "original_commit_id" : "440123fb8c7196a7ee209495f02b2f7c0deaa0bb",
      "original_position" : 87,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 60152203,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136589098",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r136591227"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136591227"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Lose the `presumably` :)",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-09-01T14:43:38Z",
      "diff_hunk" : "@@ -52,6 +52,20 @@ def run_test(self):\n         # This will raise an exception since there are missing inputs\n         assert_raises_jsonrpc(-25, \"Missing inputs\", self.nodes[2].sendrawtransaction, rawtx['hex'])\n \n+        ############################\n+        # getrawtx with block hash #\n+        ############################\n+\n+        # make a tx by sending then generate 2 blocks; block1 has the tx in it,\n+        # presumably",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r136591227",
      "id" : 136591227,
      "original_commit_id" : "440123fb8c7196a7ee209495f02b2f7c0deaa0bb",
      "original_position" : 9,
      "path" : "test/functional/rawtransactions.py",
      "position" : null,
      "pull_request_review_id" : 60152203,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136591227",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r136591446"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136591446"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You need to make the matching error text longer to be non-ambiguous. This test will still pass if the node returns the error `No such mempool or blockchain transaction` (which would be incorrect behaviour)",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-09-01T14:44:37Z",
      "diff_hunk" : "@@ -52,6 +52,20 @@ def run_test(self):\n         # This will raise an exception since there are missing inputs\n         assert_raises_jsonrpc(-25, \"Missing inputs\", self.nodes[2].sendrawtransaction, rawtx['hex'])\n \n+        ############################\n+        # getrawtx with block hash #\n+        ############################\n+\n+        # make a tx by sending then generate 2 blocks; block1 has the tx in it,\n+        # presumably\n+        tx = self.nodes[2].sendtoaddress(self.nodes[1].getnewaddress(), 1)\n+        block1, block2 = self.nodes[2].generate(2)\n+        self.sync_all()\n+        # We should be able to get the raw transaction by providing the correct block\n+        assert_equal(self.nodes[0].getrawtransaction(tx, True, block1)['txid'], tx)\n+        # We should not get the tx if we provide an unrelated block\n+        assert_raises_jsonrpc(-5, \"No such\", self.nodes[0].getrawtransaction, tx, True, block2)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r136591446",
      "id" : 136591446,
      "original_commit_id" : "440123fb8c7196a7ee209495f02b2f7c0deaa0bb",
      "original_position" : 16,
      "path" : "test/functional/rawtransactions.py",
      "position" : null,
      "pull_request_review_id" : 60152203,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136591446",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r136735089"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136735089"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```C++\r\n            \"  \\\"in_active_chain\\\": b, (bool) Whether specified block is in the active chain or not (only present with explicit \\\"blockhash\\\" argument)\\n\"\r\n            \"  \\\"hex\\\" : \\\"data\\\",       (string) The serialized, hex-encoded data for 'txid'\\n\"\r\n```\r\nbecomes\r\n```\r\n  \"in_active_chain\": b, (bool) Whether specified block is in the active chain or not (only present with explicit \"blockhash\" argument)\r\n  \"hex\" : \"data\",       (string) The serialized, hex-encoded data for 'txid'\r\n```\r\n(two \\ vs four \\ means indentation diff in code)",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-09-04T02:15:07Z",
      "diff_hunk" : "@@ -76,12 +79,14 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             \"\\nArguments:\\n\"\n             \"1. \\\"txid\\\"      (string, required) The transaction id\\n\"\n             \"2. verbose       (bool, optional, default=false) If false, return a string, otherwise return a json object\\n\"\n+            \"3. \\\"blockhash\\\" (string, optional) The block in which to look for the transaction\\n\"\n \n             \"\\nResult (if verbose is not set or set to false):\\n\"\n             \"\\\"data\\\"      (string) The serialized, hex-encoded data for 'txid'\\n\"\n \n             \"\\nResult (if verbose is set to true):\\n\"\n             \"{\\n\"\n+            \"  \\\"in_active_chain\\\": b, (bool) Whether specified block is in the active chain or not (only present with explicit \\\"blockhash\\\" argument)\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r136735089",
      "id" : 136735089,
      "in_reply_to_id" : 136588539,
      "original_commit_id" : "440123fb8c7196a7ee209495f02b2f7c0deaa0bb",
      "original_position" : 30,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : 32,
      "pull_request_review_id" : 60313988,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136735089",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r136736030"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136736030"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good point!\r\n\r\nI added code (https://github.com/bitcoin/bitcoin/pull/10275/commits/3c0cb434bde411d2daf8e4a440c85e80b1eb1f62) that checks if pruning is enabled, and if it is, checks if the block is actually available by reading it from disk and setting the error message based on the results of that.",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-09-04T02:31:17Z",
      "diff_hunk" : "@@ -129,42 +134,55 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\"\")\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true\")\n             + HelpExampleRpc(\"getrawtransaction\", \"\\\"mytxid\\\", true\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" false \\\"myblockhash\\\"\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true \\\"myblockhash\\\"\")\n         );\n \n     LOCK(cs_main);\n \n+    bool in_active_chain = true;\n     uint256 hash = ParseHashV(request.params[0], \"parameter 1\");\n+    CBlockIndex* blockindex = nullptr;\n \n     // Accept either a bool (true) or a num (>=1) to indicate verbose output.\n     bool fVerbose = false;\n     if (!request.params[1].isNull()) {\n-        if (request.params[1].isNum()) {\n-            if (request.params[1].get_int() != 0) {\n-                fVerbose = true;\n-            }\n-        }\n-        else if(request.params[1].isBool()) {\n-            if(request.params[1].isTrue()) {\n-                fVerbose = true;\n+        fVerbose = request.params[1].isNum() ? (request.params[1].get_int() != 0) : request.params[1].get_bool();\n+    }\n+\n+    if (!request.params[2].isNull()) {\n+        uint256 blockhash = ParseHashV(request.params[2], \"parameter 3\");\n+        if (!blockhash.IsNull()) {\n+            BlockMap::iterator it = mapBlockIndex.find(blockhash);\n+            if (it == mapBlockIndex.end()) {\n+                throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Block hash not found\");\n             }\n-        }\n-        else {\n-            throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid type provided. Verbose parameter must be a boolean.\");\n+            blockindex = it->second;\n+            in_active_chain = (chainActive[blockindex->nHeight] == blockindex);\n         }\n     }\n \n     CTransactionRef tx;\n-    uint256 hashBlock;\n-    if (!GetTransaction(hash, tx, Params().GetConsensus(), hashBlock, true))\n-        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, std::string(fTxIndex ? \"No such mempool or blockchain transaction\"\n-            : \"No such mempool transaction. Use -txindex to enable blockchain transaction queries\") +\n-            \". Use gettransaction for wallet transactions.\");\n+    uint256 hash_block;\n+    if (!GetTransaction(hash, tx, Params().GetConsensus(), hash_block, true, blockindex)) {\n+        std::string errmsg;\n+        if (blockindex) {\n+            errmsg = \"No such transaction found in the provided block\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r136736030",
      "id" : 136736030,
      "in_reply_to_id" : 136589098,
      "original_commit_id" : "440123fb8c7196a7ee209495f02b2f7c0deaa0bb",
      "original_position" : 87,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 60314972,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136736030",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r136736199"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136736199"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oops. Fixed, thanks.",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-09-04T02:34:34Z",
      "diff_hunk" : "@@ -52,6 +52,20 @@ def run_test(self):\n         # This will raise an exception since there are missing inputs\n         assert_raises_jsonrpc(-25, \"Missing inputs\", self.nodes[2].sendrawtransaction, rawtx['hex'])\n \n+        ############################\n+        # getrawtx with block hash #\n+        ############################\n+\n+        # make a tx by sending then generate 2 blocks; block1 has the tx in it,\n+        # presumably\n+        tx = self.nodes[2].sendtoaddress(self.nodes[1].getnewaddress(), 1)\n+        block1, block2 = self.nodes[2].generate(2)\n+        self.sync_all()\n+        # We should be able to get the raw transaction by providing the correct block\n+        assert_equal(self.nodes[0].getrawtransaction(tx, True, block1)['txid'], tx)\n+        # We should not get the tx if we provide an unrelated block\n+        assert_raises_jsonrpc(-5, \"No such\", self.nodes[0].getrawtransaction, tx, True, block2)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r136736199",
      "id" : 136736199,
      "in_reply_to_id" : 136591446,
      "original_commit_id" : "440123fb8c7196a7ee209495f02b2f7c0deaa0bb",
      "original_position" : 16,
      "path" : "test/functional/rawtransactions.py",
      "position" : null,
      "pull_request_review_id" : 60315156,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136736199",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jnewbery Thanks for the review! I think I've addressed all your comments.\r\n\r\nEdit: Actually I forgot about the commit merge. I try to keep tests and code changes as separate commits. Why would you want it to succeed between the test update? (Or am I confused about what you're asking?)",
      "created_at" : "2017-09-04T02:37:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-326853357",
      "id" : 326853357,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-09-04T05:42:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/326853357",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r136855111"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136855111"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, of course you're correct. The `size`, `vsize`, `version`, ... fields below aren't aligned by the same logic, but that's beyond the scope of this PR. Please disregard my previous comment.",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-09-04T17:03:26Z",
      "diff_hunk" : "@@ -76,12 +79,14 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             \"\\nArguments:\\n\"\n             \"1. \\\"txid\\\"      (string, required) The transaction id\\n\"\n             \"2. verbose       (bool, optional, default=false) If false, return a string, otherwise return a json object\\n\"\n+            \"3. \\\"blockhash\\\" (string, optional) The block in which to look for the transaction\\n\"\n \n             \"\\nResult (if verbose is not set or set to false):\\n\"\n             \"\\\"data\\\"      (string) The serialized, hex-encoded data for 'txid'\\n\"\n \n             \"\\nResult (if verbose is set to true):\\n\"\n             \"{\\n\"\n+            \"  \\\"in_active_chain\\\": b, (bool) Whether specified block is in the active chain or not (only present with explicit \\\"blockhash\\\" argument)\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r136855111",
      "id" : 136855111,
      "in_reply_to_id" : 136588539,
      "original_commit_id" : "440123fb8c7196a7ee209495f02b2f7c0deaa0bb",
      "original_position" : 30,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : 32,
      "pull_request_review_id" : 60452204,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136855111",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I try to keep tests and code changes as separate commits. Why would you want it to succeed between the test update? (Or am I confused about what you're asking?)\r\n\r\nI think the principal is that each individual commit should be at least internally consistent (should build and pass its own tests). Your first commit updates the product code so the returned error changes, and your second commit updates the test code to pass with the new error string. That means that if I run the tests after the first commit they'll fail.\r\n\r\nI understand the desire to structure the commits in a way that tells a story, but this breaks tools like git bisect that rely on commits to be internally consistent.",
      "created_at" : "2017-09-04T17:07:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-327003388",
      "id" : 327003388,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-09-04T17:07:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/327003388",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jnewbery You can `git bisect skip` if you land on a commit squeezed in between tests. I don't really agree with squashing test updates and code changes together, personally. That's how I've always done it, anyway.",
      "created_at" : "2017-09-05T01:27:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-327048248",
      "id" : 327048248,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-09-05T01:27:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/327048248",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I agree with @jnewbery, one commit should not break the code, tests including. If you revert that commit, codes stays green. IMO makes reviewing easier.",
      "created_at" : "2017-09-05T07:14:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-327091375",
      "id" : 327091375,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-09-05T07:14:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/327091375",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r137105079"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/137105079"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Use `fHavePruned`",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-09-05T20:28:50Z",
      "diff_hunk" : "@@ -129,42 +134,63 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\"\")\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true\")\n             + HelpExampleRpc(\"getrawtransaction\", \"\\\"mytxid\\\", true\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" false \\\"myblockhash\\\"\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true \\\"myblockhash\\\"\")\n         );\n \n     LOCK(cs_main);\n \n+    bool in_active_chain = true;\n     uint256 hash = ParseHashV(request.params[0], \"parameter 1\");\n+    CBlockIndex* blockindex = nullptr;\n \n     // Accept either a bool (true) or a num (>=1) to indicate verbose output.\n     bool fVerbose = false;\n     if (!request.params[1].isNull()) {\n-        if (request.params[1].isNum()) {\n-            if (request.params[1].get_int() != 0) {\n-                fVerbose = true;\n-            }\n-        }\n-        else if(request.params[1].isBool()) {\n-            if(request.params[1].isTrue()) {\n-                fVerbose = true;\n+        fVerbose = request.params[1].isNum() ? (request.params[1].get_int() != 0) : request.params[1].get_bool();\n+    }\n+\n+    if (!request.params[2].isNull()) {\n+        uint256 blockhash = ParseHashV(request.params[2], \"parameter 3\");\n+        if (!blockhash.IsNull()) {\n+            BlockMap::iterator it = mapBlockIndex.find(blockhash);\n+            if (it == mapBlockIndex.end()) {\n+                throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Block hash not found\");\n             }\n-        }\n-        else {\n-            throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid type provided. Verbose parameter must be a boolean.\");\n+            blockindex = it->second;\n+            in_active_chain = (chainActive[blockindex->nHeight] == blockindex);\n         }\n     }\n \n     CTransactionRef tx;\n-    uint256 hashBlock;\n-    if (!GetTransaction(hash, tx, Params().GetConsensus(), hashBlock, true))\n-        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, std::string(fTxIndex ? \"No such mempool or blockchain transaction\"\n-            : \"No such mempool transaction. Use -txindex to enable blockchain transaction queries\") +\n-            \". Use gettransaction for wallet transactions.\");\n+    uint256 hash_block;\n+    if (!GetTransaction(hash, tx, Params().GetConsensus(), hash_block, true, blockindex)) {\n+        std::string errmsg;\n+        if (blockindex) {\n+            bool block_available = true;\n+            if (gArgs.GetArg(\"-prune\", 0)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r137105079",
      "id" : 137105079,
      "original_commit_id" : "67caecc0ae342ca7350b8a96753083d6fb03df72",
      "original_position" : 88,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 60729925,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/137105079",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r137105749"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/137105749"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Use `!(pblockindex->nStatus & BLOCK_HAVE_DATA) && pblockindex->nTx > 0` (see `getblock`)",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-09-05T20:31:22Z",
      "diff_hunk" : "@@ -129,42 +134,63 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\"\")\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true\")\n             + HelpExampleRpc(\"getrawtransaction\", \"\\\"mytxid\\\", true\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" false \\\"myblockhash\\\"\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true \\\"myblockhash\\\"\")\n         );\n \n     LOCK(cs_main);\n \n+    bool in_active_chain = true;\n     uint256 hash = ParseHashV(request.params[0], \"parameter 1\");\n+    CBlockIndex* blockindex = nullptr;\n \n     // Accept either a bool (true) or a num (>=1) to indicate verbose output.\n     bool fVerbose = false;\n     if (!request.params[1].isNull()) {\n-        if (request.params[1].isNum()) {\n-            if (request.params[1].get_int() != 0) {\n-                fVerbose = true;\n-            }\n-        }\n-        else if(request.params[1].isBool()) {\n-            if(request.params[1].isTrue()) {\n-                fVerbose = true;\n+        fVerbose = request.params[1].isNum() ? (request.params[1].get_int() != 0) : request.params[1].get_bool();\n+    }\n+\n+    if (!request.params[2].isNull()) {\n+        uint256 blockhash = ParseHashV(request.params[2], \"parameter 3\");\n+        if (!blockhash.IsNull()) {\n+            BlockMap::iterator it = mapBlockIndex.find(blockhash);\n+            if (it == mapBlockIndex.end()) {\n+                throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Block hash not found\");\n             }\n-        }\n-        else {\n-            throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid type provided. Verbose parameter must be a boolean.\");\n+            blockindex = it->second;\n+            in_active_chain = (chainActive[blockindex->nHeight] == blockindex);\n         }\n     }\n \n     CTransactionRef tx;\n-    uint256 hashBlock;\n-    if (!GetTransaction(hash, tx, Params().GetConsensus(), hashBlock, true))\n-        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, std::string(fTxIndex ? \"No such mempool or blockchain transaction\"\n-            : \"No such mempool transaction. Use -txindex to enable blockchain transaction queries\") +\n-            \". Use gettransaction for wallet transactions.\");\n+    uint256 hash_block;\n+    if (!GetTransaction(hash, tx, Params().GetConsensus(), hash_block, true, blockindex)) {\n+        std::string errmsg;\n+        if (blockindex) {\n+            bool block_available = true;\n+            if (gArgs.GetArg(\"-prune\", 0)) {\n+                // we are pruning; see if block is available at all\n+                CBlock block;\n+                block_available = ReadBlockFromDisk(block, blockindex, Params().GetConsensus());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r137105749",
      "id" : 137105749,
      "original_commit_id" : "67caecc0ae342ca7350b8a96753083d6fb03df72",
      "original_position" : 91,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 60729925,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/137105749",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I agree individual commits should never break the tests ideally. That doesn't mean that you can't introduce new functionality and its new tests in separated commits when that's not the case.\r\nNeeds rebase again.",
      "created_at" : "2017-09-05T22:30:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-327321920",
      "id" : 327321920,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-09-05T22:30:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/327321920",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1008458?v=4",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Last two commits look good. For the pruning error, I think you can error out earlier by re-using the pruned test from `getblock`:\r\n\r\n```\r\n     if (fHavePruned && !(pblockindex->nStatus & BLOCK_HAVE_DATA) && pblockindex->nTx > 0)\r\n        throw JSONRPCError(RPC_MISC_ERROR, \"Block not available (pruned data)\");\r\n```\r\n\r\n> I don't really agree with squashing test updates and code changes together, personally.\r\n\r\nok. I think both ways are valid, and I've come across both before. I'm not sure if this project has a preferred style.",
      "created_at" : "2017-09-05T23:20:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-327330124",
      "id" : 327330124,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-09-05T23:20:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/327330124",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I'm merging those commits as it's not new functionality but just a fix that changes an error message.",
      "created_at" : "2017-09-06T02:52:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-327359781",
      "id" : 327359781,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-09-06T02:52:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/327359781",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@luke-jr Nice!",
      "created_at" : "2017-09-06T02:53:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-327359819",
      "id" : 327359819,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-09-06T02:53:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/327359819",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r137375529"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/137375529"
         }
      },
      "author_association" : "MEMBER",
      "body" : "supernit: Not finding a block because it's been pruned is not a `RPC_INVALID_ADDRESS_OR_KEY` error. It would more accurately be a `RPC_MISC_ERROR`.\r\n\r\nMy suggestion would be to do the pruned check above, immediately after the `throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Block hash not found\");` line",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-09-06T20:06:15Z",
      "diff_hunk" : "@@ -130,42 +135,58 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\"\")\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true\")\n             + HelpExampleRpc(\"getrawtransaction\", \"\\\"mytxid\\\", true\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" false \\\"myblockhash\\\"\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true \\\"myblockhash\\\"\")\n         );\n \n     LOCK(cs_main);\n \n+    bool in_active_chain = true;\n     uint256 hash = ParseHashV(request.params[0], \"parameter 1\");\n+    CBlockIndex* blockindex = nullptr;\n \n     // Accept either a bool (true) or a num (>=1) to indicate verbose output.\n     bool fVerbose = false;\n     if (!request.params[1].isNull()) {\n-        if (request.params[1].isNum()) {\n-            if (request.params[1].get_int() != 0) {\n-                fVerbose = true;\n-            }\n-        }\n-        else if(request.params[1].isBool()) {\n-            if(request.params[1].isTrue()) {\n-                fVerbose = true;\n+        fVerbose = request.params[1].isNum() ? (request.params[1].get_int() != 0) : request.params[1].get_bool();\n+    }\n+\n+    if (!request.params[2].isNull()) {\n+        uint256 blockhash = ParseHashV(request.params[2], \"parameter 3\");\n+        if (!blockhash.IsNull()) {\n+            BlockMap::iterator it = mapBlockIndex.find(blockhash);\n+            if (it == mapBlockIndex.end()) {\n+                throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Block hash not found\");\n             }\n-        }\n-        else {\n-            throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid type provided. Verbose parameter must be a boolean.\");\n+            blockindex = it->second;\n+            in_active_chain = (chainActive[blockindex->nHeight] == blockindex);\n         }\n     }\n \n     CTransactionRef tx;\n-    uint256 hashBlock;\n-    if (!GetTransaction(hash, tx, Params().GetConsensus(), hashBlock, true))\n-        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, std::string(fTxIndex ? \"No such mempool or blockchain transaction\"\n-            : \"No such mempool transaction. Use -txindex to enable blockchain transaction queries\") +\n-            \". Use gettransaction for wallet transactions.\");\n+    uint256 hash_block;\n+    if (!GetTransaction(hash, tx, Params().GetConsensus(), hash_block, true, blockindex)) {\n+        std::string errmsg;\n+        if (blockindex) {\n+            bool block_pruned = fHavePruned && !(blockindex->nStatus & BLOCK_HAVE_DATA) && blockindex->nTx > 0;\n+            errmsg = block_pruned\n+              ? \"Block not available (pruned data)\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r137375529",
      "id" : 137375529,
      "original_commit_id" : "3ff7a5707184da1f1f872af6e29448fddb2ecc41",
      "original_position" : 89,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 61034671,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/137375529",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r137433560"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/137433560"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah, I was thinking about that too. Fixing.",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-09-07T02:17:32Z",
      "diff_hunk" : "@@ -130,42 +135,58 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\"\")\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true\")\n             + HelpExampleRpc(\"getrawtransaction\", \"\\\"mytxid\\\", true\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" false \\\"myblockhash\\\"\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true \\\"myblockhash\\\"\")\n         );\n \n     LOCK(cs_main);\n \n+    bool in_active_chain = true;\n     uint256 hash = ParseHashV(request.params[0], \"parameter 1\");\n+    CBlockIndex* blockindex = nullptr;\n \n     // Accept either a bool (true) or a num (>=1) to indicate verbose output.\n     bool fVerbose = false;\n     if (!request.params[1].isNull()) {\n-        if (request.params[1].isNum()) {\n-            if (request.params[1].get_int() != 0) {\n-                fVerbose = true;\n-            }\n-        }\n-        else if(request.params[1].isBool()) {\n-            if(request.params[1].isTrue()) {\n-                fVerbose = true;\n+        fVerbose = request.params[1].isNum() ? (request.params[1].get_int() != 0) : request.params[1].get_bool();\n+    }\n+\n+    if (!request.params[2].isNull()) {\n+        uint256 blockhash = ParseHashV(request.params[2], \"parameter 3\");\n+        if (!blockhash.IsNull()) {\n+            BlockMap::iterator it = mapBlockIndex.find(blockhash);\n+            if (it == mapBlockIndex.end()) {\n+                throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Block hash not found\");\n             }\n-        }\n-        else {\n-            throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid type provided. Verbose parameter must be a boolean.\");\n+            blockindex = it->second;\n+            in_active_chain = (chainActive[blockindex->nHeight] == blockindex);\n         }\n     }\n \n     CTransactionRef tx;\n-    uint256 hashBlock;\n-    if (!GetTransaction(hash, tx, Params().GetConsensus(), hashBlock, true))\n-        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, std::string(fTxIndex ? \"No such mempool or blockchain transaction\"\n-            : \"No such mempool transaction. Use -txindex to enable blockchain transaction queries\") +\n-            \". Use gettransaction for wallet transactions.\");\n+    uint256 hash_block;\n+    if (!GetTransaction(hash, tx, Params().GetConsensus(), hash_block, true, blockindex)) {\n+        std::string errmsg;\n+        if (blockindex) {\n+            bool block_pruned = fHavePruned && !(blockindex->nStatus & BLOCK_HAVE_DATA) && blockindex->nTx > 0;\n+            errmsg = block_pruned\n+              ? \"Block not available (pruned data)\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r137433560",
      "id" : 137433560,
      "in_reply_to_id" : 137375529,
      "original_commit_id" : "3ff7a5707184da1f1f872af6e29448fddb2ecc41",
      "original_position" : 89,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 61099094,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/137433560",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-utACK 300a5f15d54484691d47eb5ec23acde6d82bfda1\r\n\r\n",
      "created_at" : "2017-09-23T10:05:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-331624208",
      "id" : 331624208,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-09-23T10:05:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/331624208",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1008458?v=4",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r153341394"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153341394"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why check nTx here? Its just as useful to provide an error of \"Block not available\" if it has been pruned as if it has not yet been received in full.",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-11-27T22:20:16Z",
      "diff_hunk" : "@@ -130,42 +135,58 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\"\")\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true\")\n             + HelpExampleRpc(\"getrawtransaction\", \"\\\"mytxid\\\", true\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" false \\\"myblockhash\\\"\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true \\\"myblockhash\\\"\")\n         );\n \n     LOCK(cs_main);\n \n+    bool in_active_chain = true;\n     uint256 hash = ParseHashV(request.params[0], \"parameter 1\");\n+    CBlockIndex* blockindex = nullptr;\n \n     // Accept either a bool (true) or a num (>=1) to indicate verbose output.\n     bool fVerbose = false;\n     if (!request.params[1].isNull()) {\n-        if (request.params[1].isNum()) {\n-            if (request.params[1].get_int() != 0) {\n-                fVerbose = true;\n-            }\n-        }\n-        else if(request.params[1].isBool()) {\n-            if(request.params[1].isTrue()) {\n-                fVerbose = true;\n+        fVerbose = request.params[1].isNum() ? (request.params[1].get_int() != 0) : request.params[1].get_bool();\n+    }\n+\n+    if (!request.params[2].isNull()) {\n+        uint256 blockhash = ParseHashV(request.params[2], \"parameter 3\");\n+        if (!blockhash.IsNull()) {\n+            BlockMap::iterator it = mapBlockIndex.find(blockhash);\n+            if (it == mapBlockIndex.end()) {\n+                throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Block hash not found\");\n             }\n-        }\n-        else {\n-            throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid type provided. Verbose parameter must be a boolean.\");\n+            blockindex = it->second;\n+            in_active_chain = (chainActive[blockindex->nHeight] == blockindex);\n         }\n     }\n \n     CTransactionRef tx;\n-    uint256 hashBlock;\n-    if (!GetTransaction(hash, tx, Params().GetConsensus(), hashBlock, true))\n-        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, std::string(fTxIndex ? \"No such mempool or blockchain transaction\"\n-            : \"No such mempool transaction. Use -txindex to enable blockchain transaction queries\") +\n-            \". Use gettransaction for wallet transactions.\");\n+    uint256 hash_block;\n+    if (!GetTransaction(hash, tx, Params().GetConsensus(), hash_block, true, blockindex)) {\n+        std::string errmsg;\n+        if (blockindex) {\n+            if (fHavePruned && !(blockindex->nStatus & BLOCK_HAVE_DATA) && blockindex->nTx > 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r153341394",
      "id" : 153341394,
      "original_commit_id" : "4d15dce560d43028067ae9581bf30fc3d3cfc5f7",
      "original_position" : 87,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 79332601,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153341394",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r153367497"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153367497"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is how the check is done in a lot of places. E.g. \r\nhttps://github.com/kallewoof/bitcoin/blame/gettx-with-blockhash/src/rest.cpp#L219\r\n\r\nI'm not sure why an additional nTx check is needed, to be honest.",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-11-28T00:51:32Z",
      "diff_hunk" : "@@ -130,42 +135,58 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\"\")\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true\")\n             + HelpExampleRpc(\"getrawtransaction\", \"\\\"mytxid\\\", true\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" false \\\"myblockhash\\\"\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true \\\"myblockhash\\\"\")\n         );\n \n     LOCK(cs_main);\n \n+    bool in_active_chain = true;\n     uint256 hash = ParseHashV(request.params[0], \"parameter 1\");\n+    CBlockIndex* blockindex = nullptr;\n \n     // Accept either a bool (true) or a num (>=1) to indicate verbose output.\n     bool fVerbose = false;\n     if (!request.params[1].isNull()) {\n-        if (request.params[1].isNum()) {\n-            if (request.params[1].get_int() != 0) {\n-                fVerbose = true;\n-            }\n-        }\n-        else if(request.params[1].isBool()) {\n-            if(request.params[1].isTrue()) {\n-                fVerbose = true;\n+        fVerbose = request.params[1].isNum() ? (request.params[1].get_int() != 0) : request.params[1].get_bool();\n+    }\n+\n+    if (!request.params[2].isNull()) {\n+        uint256 blockhash = ParseHashV(request.params[2], \"parameter 3\");\n+        if (!blockhash.IsNull()) {\n+            BlockMap::iterator it = mapBlockIndex.find(blockhash);\n+            if (it == mapBlockIndex.end()) {\n+                throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Block hash not found\");\n             }\n-        }\n-        else {\n-            throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid type provided. Verbose parameter must be a boolean.\");\n+            blockindex = it->second;\n+            in_active_chain = (chainActive[blockindex->nHeight] == blockindex);\n         }\n     }\n \n     CTransactionRef tx;\n-    uint256 hashBlock;\n-    if (!GetTransaction(hash, tx, Params().GetConsensus(), hashBlock, true))\n-        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, std::string(fTxIndex ? \"No such mempool or blockchain transaction\"\n-            : \"No such mempool transaction. Use -txindex to enable blockchain transaction queries\") +\n-            \". Use gettransaction for wallet transactions.\");\n+    uint256 hash_block;\n+    if (!GetTransaction(hash, tx, Params().GetConsensus(), hash_block, true, blockindex)) {\n+        std::string errmsg;\n+        if (blockindex) {\n+            if (fHavePruned && !(blockindex->nStatus & BLOCK_HAVE_DATA) && blockindex->nTx > 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r153367497",
      "id" : 153367497,
      "in_reply_to_id" : 153341394,
      "original_commit_id" : "4d15dce560d43028067ae9581bf30fc3d3cfc5f7",
      "original_position" : 87,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 79362014,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153367497",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r153368118"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153368118"
         }
      },
      "author_association" : "OWNER",
      "body" : "\"nTx > 0\" means we had the block's contents at some point.",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-11-28T00:55:28Z",
      "diff_hunk" : "@@ -130,42 +135,58 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\"\")\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true\")\n             + HelpExampleRpc(\"getrawtransaction\", \"\\\"mytxid\\\", true\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" false \\\"myblockhash\\\"\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true \\\"myblockhash\\\"\")\n         );\n \n     LOCK(cs_main);\n \n+    bool in_active_chain = true;\n     uint256 hash = ParseHashV(request.params[0], \"parameter 1\");\n+    CBlockIndex* blockindex = nullptr;\n \n     // Accept either a bool (true) or a num (>=1) to indicate verbose output.\n     bool fVerbose = false;\n     if (!request.params[1].isNull()) {\n-        if (request.params[1].isNum()) {\n-            if (request.params[1].get_int() != 0) {\n-                fVerbose = true;\n-            }\n-        }\n-        else if(request.params[1].isBool()) {\n-            if(request.params[1].isTrue()) {\n-                fVerbose = true;\n+        fVerbose = request.params[1].isNum() ? (request.params[1].get_int() != 0) : request.params[1].get_bool();\n+    }\n+\n+    if (!request.params[2].isNull()) {\n+        uint256 blockhash = ParseHashV(request.params[2], \"parameter 3\");\n+        if (!blockhash.IsNull()) {\n+            BlockMap::iterator it = mapBlockIndex.find(blockhash);\n+            if (it == mapBlockIndex.end()) {\n+                throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Block hash not found\");\n             }\n-        }\n-        else {\n-            throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid type provided. Verbose parameter must be a boolean.\");\n+            blockindex = it->second;\n+            in_active_chain = (chainActive[blockindex->nHeight] == blockindex);\n         }\n     }\n \n     CTransactionRef tx;\n-    uint256 hashBlock;\n-    if (!GetTransaction(hash, tx, Params().GetConsensus(), hashBlock, true))\n-        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, std::string(fTxIndex ? \"No such mempool or blockchain transaction\"\n-            : \"No such mempool transaction. Use -txindex to enable blockchain transaction queries\") +\n-            \". Use gettransaction for wallet transactions.\");\n+    uint256 hash_block;\n+    if (!GetTransaction(hash, tx, Params().GetConsensus(), hash_block, true, blockindex)) {\n+        std::string errmsg;\n+        if (blockindex) {\n+            if (fHavePruned && !(blockindex->nStatus & BLOCK_HAVE_DATA) && blockindex->nTx > 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r153368118",
      "id" : 153368118,
      "in_reply_to_id" : 153341394,
      "original_commit_id" : "4d15dce560d43028067ae9581bf30fc3d3cfc5f7",
      "original_position" : 87,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 79362654,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153368118",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r153374816"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153374816"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, I'm saying remove the fHavePruned and nTx check here - if we have a block's header but not its body, then we'll throw a \"No such transaction found in the provided block\" error, which is nonsense. Easier to just make this error generic.",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-11-28T01:42:38Z",
      "diff_hunk" : "@@ -130,42 +135,58 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\"\")\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true\")\n             + HelpExampleRpc(\"getrawtransaction\", \"\\\"mytxid\\\", true\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" false \\\"myblockhash\\\"\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true \\\"myblockhash\\\"\")\n         );\n \n     LOCK(cs_main);\n \n+    bool in_active_chain = true;\n     uint256 hash = ParseHashV(request.params[0], \"parameter 1\");\n+    CBlockIndex* blockindex = nullptr;\n \n     // Accept either a bool (true) or a num (>=1) to indicate verbose output.\n     bool fVerbose = false;\n     if (!request.params[1].isNull()) {\n-        if (request.params[1].isNum()) {\n-            if (request.params[1].get_int() != 0) {\n-                fVerbose = true;\n-            }\n-        }\n-        else if(request.params[1].isBool()) {\n-            if(request.params[1].isTrue()) {\n-                fVerbose = true;\n+        fVerbose = request.params[1].isNum() ? (request.params[1].get_int() != 0) : request.params[1].get_bool();\n+    }\n+\n+    if (!request.params[2].isNull()) {\n+        uint256 blockhash = ParseHashV(request.params[2], \"parameter 3\");\n+        if (!blockhash.IsNull()) {\n+            BlockMap::iterator it = mapBlockIndex.find(blockhash);\n+            if (it == mapBlockIndex.end()) {\n+                throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Block hash not found\");\n             }\n-        }\n-        else {\n-            throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid type provided. Verbose parameter must be a boolean.\");\n+            blockindex = it->second;\n+            in_active_chain = (chainActive[blockindex->nHeight] == blockindex);\n         }\n     }\n \n     CTransactionRef tx;\n-    uint256 hashBlock;\n-    if (!GetTransaction(hash, tx, Params().GetConsensus(), hashBlock, true))\n-        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, std::string(fTxIndex ? \"No such mempool or blockchain transaction\"\n-            : \"No such mempool transaction. Use -txindex to enable blockchain transaction queries\") +\n-            \". Use gettransaction for wallet transactions.\");\n+    uint256 hash_block;\n+    if (!GetTransaction(hash, tx, Params().GetConsensus(), hash_block, true, blockindex)) {\n+        std::string errmsg;\n+        if (blockindex) {\n+            if (fHavePruned && !(blockindex->nStatus & BLOCK_HAVE_DATA) && blockindex->nTx > 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r153374816",
      "id" : 153374816,
      "in_reply_to_id" : 153341394,
      "original_commit_id" : "4d15dce560d43028067ae9581bf30fc3d3cfc5f7",
      "original_position" : 87,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 79369897,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153374816",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r153375434"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153375434"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ahh, OK.",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-11-28T01:47:52Z",
      "diff_hunk" : "@@ -130,42 +135,58 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\"\")\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true\")\n             + HelpExampleRpc(\"getrawtransaction\", \"\\\"mytxid\\\", true\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" false \\\"myblockhash\\\"\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true \\\"myblockhash\\\"\")\n         );\n \n     LOCK(cs_main);\n \n+    bool in_active_chain = true;\n     uint256 hash = ParseHashV(request.params[0], \"parameter 1\");\n+    CBlockIndex* blockindex = nullptr;\n \n     // Accept either a bool (true) or a num (>=1) to indicate verbose output.\n     bool fVerbose = false;\n     if (!request.params[1].isNull()) {\n-        if (request.params[1].isNum()) {\n-            if (request.params[1].get_int() != 0) {\n-                fVerbose = true;\n-            }\n-        }\n-        else if(request.params[1].isBool()) {\n-            if(request.params[1].isTrue()) {\n-                fVerbose = true;\n+        fVerbose = request.params[1].isNum() ? (request.params[1].get_int() != 0) : request.params[1].get_bool();\n+    }\n+\n+    if (!request.params[2].isNull()) {\n+        uint256 blockhash = ParseHashV(request.params[2], \"parameter 3\");\n+        if (!blockhash.IsNull()) {\n+            BlockMap::iterator it = mapBlockIndex.find(blockhash);\n+            if (it == mapBlockIndex.end()) {\n+                throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Block hash not found\");\n             }\n-        }\n-        else {\n-            throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid type provided. Verbose parameter must be a boolean.\");\n+            blockindex = it->second;\n+            in_active_chain = (chainActive[blockindex->nHeight] == blockindex);\n         }\n     }\n \n     CTransactionRef tx;\n-    uint256 hashBlock;\n-    if (!GetTransaction(hash, tx, Params().GetConsensus(), hashBlock, true))\n-        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, std::string(fTxIndex ? \"No such mempool or blockchain transaction\"\n-            : \"No such mempool transaction. Use -txindex to enable blockchain transaction queries\") +\n-            \". Use gettransaction for wallet transactions.\");\n+    uint256 hash_block;\n+    if (!GetTransaction(hash, tx, Params().GetConsensus(), hash_block, true, blockindex)) {\n+        std::string errmsg;\n+        if (blockindex) {\n+            if (fHavePruned && !(blockindex->nStatus & BLOCK_HAVE_DATA) && blockindex->nTx > 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r153375434",
      "id" : 153375434,
      "in_reply_to_id" : 153341394,
      "original_commit_id" : "4d15dce560d43028067ae9581bf30fc3d3cfc5f7",
      "original_position" : 87,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 79370613,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153375434",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jnewbery You wouldn't happen to have any hints on what's going on here? https://travis-ci.org/bitcoin/bitcoin/jobs/308238239\r\n```\r\nmake  \\\r\n\t  top_distdir=\"bitcoin-x86_64-unknown-linux-gnu\" distdir=\"bitcoin-x86_64-unknown-linux-gnu\" \\\r\n\t  dist-hook\r\nmake[1]: Entering directory `/home/travis/build/bitcoin/bitcoin/build'\r\n/usr/bin/git archive --format=tar HEAD -- src/clientversion.cpp | ${TAR-tar} -C bitcoin-x86_64-unknown-linux-gnu -xf -\r\nfatal: current working directory is untracked\r\ntar: This does not look like a tar archive\r\ntar: Exiting with failure status due to previous errors\r\nmake[1]: [dist-hook] Error 2 (ignored)\r\nmake[1]: Leaving directory `/home/travis/build/bitcoin/bitcoin/build'\r\n```",
      "created_at" : "2017-11-28T05:33:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-347418716",
      "id" : 347418716,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-11-28T05:33:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/347418716",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r154700602"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/154700602"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Now the error message is wrong :/. You should drop the \"(pruned data)\" note, as this can happen if you've received the header but not (yet) the block.",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-12-04T16:31:53Z",
      "diff_hunk" : "@@ -132,42 +137,58 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\"\")\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true\")\n             + HelpExampleRpc(\"getrawtransaction\", \"\\\"mytxid\\\", true\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" false \\\"myblockhash\\\"\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true \\\"myblockhash\\\"\")\n         );\n \n     LOCK(cs_main);\n \n+    bool in_active_chain = true;\n     uint256 hash = ParseHashV(request.params[0], \"parameter 1\");\n+    CBlockIndex* blockindex = nullptr;\n \n     // Accept either a bool (true) or a num (>=1) to indicate verbose output.\n     bool fVerbose = false;\n     if (!request.params[1].isNull()) {\n-        if (request.params[1].isNum()) {\n-            if (request.params[1].get_int() != 0) {\n-                fVerbose = true;\n-            }\n-        }\n-        else if(request.params[1].isBool()) {\n-            if(request.params[1].isTrue()) {\n-                fVerbose = true;\n+        fVerbose = request.params[1].isNum() ? (request.params[1].get_int() != 0) : request.params[1].get_bool();\n+    }\n+\n+    if (!request.params[2].isNull()) {\n+        uint256 blockhash = ParseHashV(request.params[2], \"parameter 3\");\n+        if (!blockhash.IsNull()) {\n+            BlockMap::iterator it = mapBlockIndex.find(blockhash);\n+            if (it == mapBlockIndex.end()) {\n+                throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Block hash not found\");\n             }\n-        }\n-        else {\n-            throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid type provided. Verbose parameter must be a boolean.\");\n+            blockindex = it->second;\n+            in_active_chain = (chainActive[blockindex->nHeight] == blockindex);\n         }\n     }\n \n     CTransactionRef tx;\n-    uint256 hashBlock;\n-    if (!GetTransaction(hash, tx, Params().GetConsensus(), hashBlock, true))\n-        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, std::string(fTxIndex ? \"No such mempool or blockchain transaction\"\n-            : \"No such mempool transaction. Use -txindex to enable blockchain transaction queries\") +\n-            \". Use gettransaction for wallet transactions.\");\n+    uint256 hash_block;\n+    if (!GetTransaction(hash, tx, Params().GetConsensus(), hash_block, true, blockindex)) {\n+        std::string errmsg;\n+        if (blockindex) {\n+            if (!(blockindex->nStatus & BLOCK_HAVE_DATA)) {\n+                throw JSONRPCError(RPC_MISC_ERROR, \"Block not available (pruned data)\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r154700602",
      "id" : 154700602,
      "original_commit_id" : "9cdcd16253b5727623eedf3b565680431b2e9f16",
      "original_position" : 88,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 80902505,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/154700602",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r154701948"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/154701948"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Looks like this line was lost in a rebase? Shouldn't remove it.",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-12-04T16:36:19Z",
      "diff_hunk" : "@@ -927,46 +927,44 @@ bool AcceptToMemoryPool(CTxMemPool& pool, CValidationState &state, const CTransa\n }\n \n /** Return transaction in txOut, and if it was found inside a block, its hash is placed in hashBlock */\n-bool GetTransaction(const uint256 &hash, CTransactionRef &txOut, const Consensus::Params& consensusParams, uint256 &hashBlock, bool fAllowSlow)\n+bool GetTransaction(const uint256& hash, CTransactionRef& txOut, const Consensus::Params& consensusParams, uint256& hashBlock, bool fAllowSlow, CBlockIndex* blockIndex)\n {\n-    CBlockIndex *pindexSlow = nullptr;\n+    CBlockIndex* pindexSlow = blockIndex;\n \n     LOCK(cs_main);\n \n-    CTransactionRef ptx = mempool.get(hash);\n-    if (ptx)\n-    {\n-        txOut = ptx;\n-        return true;\n-    }\n-\n-    if (fTxIndex) {\n-        CDiskTxPos postx;\n-        if (pblocktree->ReadTxIndex(hash, postx)) {\n-            CAutoFile file(OpenBlockFile(postx, true), SER_DISK, CLIENT_VERSION);\n-            if (file.IsNull())\n-                return error(\"%s: OpenBlockFile failed\", __func__);\n-            CBlockHeader header;\n-            try {\n-                file >> header;\n-                fseek(file.Get(), postx.nTxOffset, SEEK_CUR);\n-                file >> txOut;\n-            } catch (const std::exception& e) {\n-                return error(\"%s: Deserialize or I/O error - %s\", __func__, e.what());\n-            }\n-            hashBlock = header.GetHash();\n-            if (txOut->GetHash() != hash)\n-                return error(\"%s: txid mismatch\", __func__);\n+    if (!blockIndex) {\n+        CTransactionRef ptx = mempool.get(hash);\n+        if (ptx) {\n+            txOut = ptx;\n             return true;\n         }\n \n-        // transaction not found in index, nothing more can be done",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r154701948",
      "id" : 154701948,
      "original_commit_id" : "9cdcd16253b5727623eedf3b565680431b2e9f16",
      "original_position" : 43,
      "path" : "src/validation.cpp",
      "position" : 48,
      "pull_request_review_id" : 80902505,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/154701948",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r154806602"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/154806602"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oh, damn. Sorry about that. Fixed.",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-12-04T23:26:31Z",
      "diff_hunk" : "@@ -132,42 +137,58 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\"\")\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true\")\n             + HelpExampleRpc(\"getrawtransaction\", \"\\\"mytxid\\\", true\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" false \\\"myblockhash\\\"\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true \\\"myblockhash\\\"\")\n         );\n \n     LOCK(cs_main);\n \n+    bool in_active_chain = true;\n     uint256 hash = ParseHashV(request.params[0], \"parameter 1\");\n+    CBlockIndex* blockindex = nullptr;\n \n     // Accept either a bool (true) or a num (>=1) to indicate verbose output.\n     bool fVerbose = false;\n     if (!request.params[1].isNull()) {\n-        if (request.params[1].isNum()) {\n-            if (request.params[1].get_int() != 0) {\n-                fVerbose = true;\n-            }\n-        }\n-        else if(request.params[1].isBool()) {\n-            if(request.params[1].isTrue()) {\n-                fVerbose = true;\n+        fVerbose = request.params[1].isNum() ? (request.params[1].get_int() != 0) : request.params[1].get_bool();\n+    }\n+\n+    if (!request.params[2].isNull()) {\n+        uint256 blockhash = ParseHashV(request.params[2], \"parameter 3\");\n+        if (!blockhash.IsNull()) {\n+            BlockMap::iterator it = mapBlockIndex.find(blockhash);\n+            if (it == mapBlockIndex.end()) {\n+                throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Block hash not found\");\n             }\n-        }\n-        else {\n-            throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid type provided. Verbose parameter must be a boolean.\");\n+            blockindex = it->second;\n+            in_active_chain = (chainActive[blockindex->nHeight] == blockindex);\n         }\n     }\n \n     CTransactionRef tx;\n-    uint256 hashBlock;\n-    if (!GetTransaction(hash, tx, Params().GetConsensus(), hashBlock, true))\n-        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, std::string(fTxIndex ? \"No such mempool or blockchain transaction\"\n-            : \"No such mempool transaction. Use -txindex to enable blockchain transaction queries\") +\n-            \". Use gettransaction for wallet transactions.\");\n+    uint256 hash_block;\n+    if (!GetTransaction(hash, tx, Params().GetConsensus(), hash_block, true, blockindex)) {\n+        std::string errmsg;\n+        if (blockindex) {\n+            if (!(blockindex->nStatus & BLOCK_HAVE_DATA)) {\n+                throw JSONRPCError(RPC_MISC_ERROR, \"Block not available (pruned data)\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r154806602",
      "id" : 154806602,
      "in_reply_to_id" : 154700602,
      "original_commit_id" : "9cdcd16253b5727623eedf3b565680431b2e9f16",
      "original_position" : 88,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 81025357,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/154806602",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r154806796"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/154806796"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed!",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-12-04T23:27:37Z",
      "diff_hunk" : "@@ -927,46 +927,44 @@ bool AcceptToMemoryPool(CTxMemPool& pool, CValidationState &state, const CTransa\n }\n \n /** Return transaction in txOut, and if it was found inside a block, its hash is placed in hashBlock */\n-bool GetTransaction(const uint256 &hash, CTransactionRef &txOut, const Consensus::Params& consensusParams, uint256 &hashBlock, bool fAllowSlow)\n+bool GetTransaction(const uint256& hash, CTransactionRef& txOut, const Consensus::Params& consensusParams, uint256& hashBlock, bool fAllowSlow, CBlockIndex* blockIndex)\n {\n-    CBlockIndex *pindexSlow = nullptr;\n+    CBlockIndex* pindexSlow = blockIndex;\n \n     LOCK(cs_main);\n \n-    CTransactionRef ptx = mempool.get(hash);\n-    if (ptx)\n-    {\n-        txOut = ptx;\n-        return true;\n-    }\n-\n-    if (fTxIndex) {\n-        CDiskTxPos postx;\n-        if (pblocktree->ReadTxIndex(hash, postx)) {\n-            CAutoFile file(OpenBlockFile(postx, true), SER_DISK, CLIENT_VERSION);\n-            if (file.IsNull())\n-                return error(\"%s: OpenBlockFile failed\", __func__);\n-            CBlockHeader header;\n-            try {\n-                file >> header;\n-                fseek(file.Get(), postx.nTxOffset, SEEK_CUR);\n-                file >> txOut;\n-            } catch (const std::exception& e) {\n-                return error(\"%s: Deserialize or I/O error - %s\", __func__, e.what());\n-            }\n-            hashBlock = header.GetHash();\n-            if (txOut->GetHash() != hash)\n-                return error(\"%s: txid mismatch\", __func__);\n+    if (!blockIndex) {\n+        CTransactionRef ptx = mempool.get(hash);\n+        if (ptx) {\n+            txOut = ptx;\n             return true;\n         }\n \n-        // transaction not found in index, nothing more can be done",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r154806796",
      "id" : 154806796,
      "in_reply_to_id" : 154701948,
      "original_commit_id" : "9cdcd16253b5727623eedf3b565680431b2e9f16",
      "original_position" : 43,
      "path" : "src/validation.cpp",
      "position" : 48,
      "pull_request_review_id" : 81025595,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/154806796",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "I realize I'm very late with this, so this is just for consideration and not an objection to this PR.\r\n\r\nI believe `getrawtransaction` is already a weird mixed bag of semantics (it works when a transaction is confirmed but at least one output is not yet spent by a confirmed transaction, or if the transaction is unconfirmed, or if txindex is available for everything but the genesis block). Adding yet another combination that works in some cases will only further the difficulty of explaining it.\r\n\r\nIdeally, I think this RPC should be replaced with a `lookuprawtransaction` (or so) which only works when `-txindex` is enabled. In case you only know a transaction is unconfirmed, use `getmempoolentry` which already exists. This functionality provided here should IMHO just be a separate RPC.",
      "created_at" : "2017-12-05T01:02:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-349160332",
      "id" : 349160332,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-12-05T01:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/349160332",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r154823055"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/154823055"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Use `chainActive.Contains()`?",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-12-05T01:14:03Z",
      "diff_hunk" : "@@ -132,42 +137,58 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\"\")\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true\")\n             + HelpExampleRpc(\"getrawtransaction\", \"\\\"mytxid\\\", true\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" false \\\"myblockhash\\\"\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true \\\"myblockhash\\\"\")\n         );\n \n     LOCK(cs_main);\n \n+    bool in_active_chain = true;\n     uint256 hash = ParseHashV(request.params[0], \"parameter 1\");\n+    CBlockIndex* blockindex = nullptr;\n \n     // Accept either a bool (true) or a num (>=1) to indicate verbose output.\n     bool fVerbose = false;\n     if (!request.params[1].isNull()) {\n-        if (request.params[1].isNum()) {\n-            if (request.params[1].get_int() != 0) {\n-                fVerbose = true;\n-            }\n-        }\n-        else if(request.params[1].isBool()) {\n-            if(request.params[1].isTrue()) {\n-                fVerbose = true;\n+        fVerbose = request.params[1].isNum() ? (request.params[1].get_int() != 0) : request.params[1].get_bool();\n+    }\n+\n+    if (!request.params[2].isNull()) {\n+        uint256 blockhash = ParseHashV(request.params[2], \"parameter 3\");\n+        if (!blockhash.IsNull()) {\n+            BlockMap::iterator it = mapBlockIndex.find(blockhash);\n+            if (it == mapBlockIndex.end()) {\n+                throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Block hash not found\");\n             }\n-        }\n-        else {\n-            throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid type provided. Verbose parameter must be a boolean.\");\n+            blockindex = it->second;\n+            in_active_chain = (chainActive[blockindex->nHeight] == blockindex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r154823055",
      "id" : 154823055,
      "original_commit_id" : "def73636a075ca36ed412284944c9e3e01ea38d8",
      "original_position" : 73,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 81044009,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/154823055",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Dear God, this PR is 7 months old. The behavior changes are all well-documented and it's a very useful feature, there's gotta be a statue of limitations on concept objections.\n\nOn December 4, 2017 8:02:52 PM EST, Pieter Wuille <notifications@github.com> wrote:\n>I realize I'm very late with this, so this is just for consideration\n>and not an objection to this PR.\n>\n>I believe `getrawtransaction` is already a weird mixed bag of semantics\n>(it works when a transaction is confirmed but at least one output is\n>not yet spent by a confirmed transaction, or if the transaction is\n>unconfirmed, or if txindex is available for everything but the genesis\n>block). Adding yet another combination that works will only further the\n>difficulty of explaining it.\n>\n>Ideally, I think this RPC should be replaced with a\n>`lookuprawtransaction` (or so) which only works when `-txindex` is\n>enabled. In case you only know a transaction is unconfirmed, use\n>`getmempoolentry` which already exists. This functionality provided\n>here should IMHO just be a separate RPC.\n>\n>-- \n>You are receiving this because you were mentioned.\n>Reply to this email directly or view it on GitHub:\n>https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-349160332\n",
      "created_at" : "2017-12-05T01:17:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-349162918",
      "id" : 349162918,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-12-05T01:17:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/349162918",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r154823677"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/154823677"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "~~Add tests for invalid hash?~~\r\n - ~~must be string;~~\r\n - ~~must be hexadecimal string;~~\r\n - ~~must be of length.~~",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-12-05T01:18:28Z",
      "diff_hunk" : "@@ -132,42 +137,58 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\"\")\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true\")\n             + HelpExampleRpc(\"getrawtransaction\", \"\\\"mytxid\\\", true\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" false \\\"myblockhash\\\"\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true \\\"myblockhash\\\"\")\n         );\n \n     LOCK(cs_main);\n \n+    bool in_active_chain = true;\n     uint256 hash = ParseHashV(request.params[0], \"parameter 1\");\n+    CBlockIndex* blockindex = nullptr;\n \n     // Accept either a bool (true) or a num (>=1) to indicate verbose output.\n     bool fVerbose = false;\n     if (!request.params[1].isNull()) {\n-        if (request.params[1].isNum()) {\n-            if (request.params[1].get_int() != 0) {\n-                fVerbose = true;\n-            }\n-        }\n-        else if(request.params[1].isBool()) {\n-            if(request.params[1].isTrue()) {\n-                fVerbose = true;\n+        fVerbose = request.params[1].isNum() ? (request.params[1].get_int() != 0) : request.params[1].get_bool();\n+    }\n+\n+    if (!request.params[2].isNull()) {\n+        uint256 blockhash = ParseHashV(request.params[2], \"parameter 3\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r154823677",
      "id" : 154823677,
      "original_commit_id" : "def73636a075ca36ed412284944c9e3e01ea38d8",
      "original_position" : 63,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : 65,
      "pull_request_review_id" : 81044009,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T14:18:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/154823677",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r154824227"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/154824227"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "~~Missing test for `in_active_chain`.~~",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-12-05T01:22:41Z",
      "diff_hunk" : "@@ -132,42 +137,58 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\"\")\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true\")\n             + HelpExampleRpc(\"getrawtransaction\", \"\\\"mytxid\\\", true\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" false \\\"myblockhash\\\"\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true \\\"myblockhash\\\"\")\n         );\n \n     LOCK(cs_main);\n \n+    bool in_active_chain = true;\n     uint256 hash = ParseHashV(request.params[0], \"parameter 1\");\n+    CBlockIndex* blockindex = nullptr;\n \n     // Accept either a bool (true) or a num (>=1) to indicate verbose output.\n     bool fVerbose = false;\n     if (!request.params[1].isNull()) {\n-        if (request.params[1].isNum()) {\n-            if (request.params[1].get_int() != 0) {\n-                fVerbose = true;\n-            }\n-        }\n-        else if(request.params[1].isBool()) {\n-            if(request.params[1].isTrue()) {\n-                fVerbose = true;\n+        fVerbose = request.params[1].isNum() ? (request.params[1].get_int() != 0) : request.params[1].get_bool();\n+    }\n+\n+    if (!request.params[2].isNull()) {\n+        uint256 blockhash = ParseHashV(request.params[2], \"parameter 3\");\n+        if (!blockhash.IsNull()) {\n+            BlockMap::iterator it = mapBlockIndex.find(blockhash);\n+            if (it == mapBlockIndex.end()) {\n+                throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Block hash not found\");\n             }\n-        }\n-        else {\n-            throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid type provided. Verbose parameter must be a boolean.\");\n+            blockindex = it->second;\n+            in_active_chain = (chainActive[blockindex->nHeight] == blockindex);\n         }\n     }\n \n     CTransactionRef tx;\n-    uint256 hashBlock;\n-    if (!GetTransaction(hash, tx, Params().GetConsensus(), hashBlock, true))\n-        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, std::string(fTxIndex ? \"No such mempool or blockchain transaction\"\n-            : \"No such mempool transaction. Use -txindex to enable blockchain transaction queries\") +\n-            \". Use gettransaction for wallet transactions.\");\n+    uint256 hash_block;\n+    if (!GetTransaction(hash, tx, Params().GetConsensus(), hash_block, true, blockindex)) {\n+        std::string errmsg;\n+        if (blockindex) {\n+            if (!(blockindex->nStatus & BLOCK_HAVE_DATA)) {\n+                throw JSONRPCError(RPC_MISC_ERROR, \"Block not available\");\n+            }\n+            errmsg = \"No such transaction found in the provided block\";\n+        } else {\n+            errmsg = fTxIndex\n+              ? \"No such mempool or blockchain transaction\"\n+              : \"No such mempool transaction. Use -txindex to enable blockchain transaction queries\";\n+        }\n+        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, errmsg + \". Use gettransaction for wallet transactions.\");\n+    }\n \n-    if (!fVerbose)\n+    if (!fVerbose) {\n         return EncodeHexTx(*tx, RPCSerializationFlags());\n+    }\n \n     UniValue result(UniValue::VOBJ);\n-    TxToJSON(*tx, hashBlock, result);\n+    if (blockindex) result.push_back(Pair(\"in_active_chain\", in_active_chain));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r154824227",
      "id" : 154824227,
      "original_commit_id" : "def73636a075ca36ed412284944c9e3e01ea38d8",
      "original_position" : 106,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : 108,
      "pull_request_review_id" : 81044009,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T14:18:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/154824227",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "I'm explicitly not objecting in any way, just offering a view to consider.",
      "created_at" : "2017-12-05T01:28:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-349164909",
      "id" : 349164909,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-12-05T01:29:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/349164909",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I agree `getrawtransaction` is very confusing until you understand its limitations. I'll gladly work on streamlining it into potentially two or more RPC calls post-merge. Biggest concern is backwards compatibility and (alternatively) bloat.\r\n\r\nEdit: I do think the confusion will be decreased when users are given the option of providing a block hash, as there was *no way* to get the tx before this PR.",
      "created_at" : "2017-12-05T01:31:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-349165468",
      "id" : 349165468,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-12-05T01:32:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/349165468",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r154825370"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/154825370"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`# getrawtransaction with block hash #`?",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-12-05T01:31:33Z",
      "diff_hunk" : "@@ -50,6 +50,19 @@ def run_test(self):\n         # This will raise an exception since there are missing inputs\n         assert_raises_rpc_error(-25, \"Missing inputs\", self.nodes[2].sendrawtransaction, rawtx['hex'])\n \n+        ############################\n+        # getrawtx with block hash #",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r154825370",
      "id" : 154825370,
      "original_commit_id" : "def73636a075ca36ed412284944c9e3e01ea38d8",
      "original_position" : 5,
      "path" : "test/functional/rawtransactions.py",
      "position" : null,
      "pull_request_review_id" : 81044009,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/154825370",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r154825428"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/154825428"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Care to explain the new argument?",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-12-05T01:31:56Z",
      "diff_hunk" : "@@ -927,46 +927,47 @@ bool AcceptToMemoryPool(CTxMemPool& pool, CValidationState &state, const CTransa\n }\n \n /** Return transaction in txOut, and if it was found inside a block, its hash is placed in hashBlock */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r154825428",
      "id" : 154825428,
      "original_commit_id" : "def73636a075ca36ed412284944c9e3e01ea38d8",
      "original_position" : 3,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 81044009,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/154825428",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r154825935"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/154825935"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit, mind to fix `verbose` alignment?",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-12-05T01:35:41Z",
      "diff_hunk" : "@@ -79,12 +82,14 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             \"\\nArguments:\\n\"\n             \"1. \\\"txid\\\"      (string, required) The transaction id\\n\"\n             \"2. verbose       (bool, optional, default=false) If false, return a string, otherwise return a json object\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r154825935",
      "id" : 154825935,
      "original_commit_id" : "def73636a075ca36ed412284944c9e3e01ea38d8",
      "original_position" : 22,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 81044009,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/154825935",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@promag Thanks for the review! I think I addressed all your comments.",
      "created_at" : "2017-12-05T02:05:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-349171439",
      "id" : 349171439,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-12-05T02:05:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/349171439",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r154831307"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/154831307"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Can remove this.",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-12-05T02:18:15Z",
      "diff_hunk" : "@@ -50,6 +50,26 @@ def run_test(self):\n         # This will raise an exception since there are missing inputs\n         assert_raises_rpc_error(-25, \"Missing inputs\", self.nodes[2].sendrawtransaction, rawtx['hex'])\n \n+        #####################################\n+        # getrawtransaction with block hash #\n+        #####################################\n+\n+        # make a tx by sending then generate 2 blocks; block1 has the tx in it\n+        tx = self.nodes[2].sendtoaddress(self.nodes[1].getnewaddress(), 1)\n+        block1, block2 = self.nodes[2].generate(2)\n+        self.sync_all()\n+        # We should be able to get the raw transaction by providing the correct block\n+        gottx = self.nodes[0].getrawtransaction(tx, True, block1)\n+        assert_equal(gottx['txid'], tx)\n+        assert_equal(gottx['in_active_chain'], True)\n+        # We should not get the tx if we provide an unrelated block\n+        assert_raises_rpc_error(-5, \"No such transaction found\", self.nodes[0].getrawtransaction, tx, True, block2)\n+        # An invalid block hash should raise the correct errors\n+        assert_raises_rpc_error(-8, \"parameter 3 must be hexadecimal\", self.nodes[0].getrawtransaction, tx, True, True)\n+        assert_raises_rpc_error(-8, \"parameter 3 must be hexadecimal\", self.nodes[0].getrawtransaction, tx, True, \"foobar\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r154831307",
      "id" : 154831307,
      "original_commit_id" : "650e4eee922d689a5d5d5a4c62fb6d9cf0e71529",
      "original_position" : 20,
      "path" : "test/functional/rawtransactions.py",
      "position" : 24,
      "pull_request_review_id" : 81053127,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/154831307",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r154838762"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/154838762"
         }
      },
      "author_association" : "MEMBER",
      "body" : "First test checks for non-string, this one for non-hexadecimal string. May be redundant but they check different things.",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-12-05T03:26:06Z",
      "diff_hunk" : "@@ -50,6 +50,26 @@ def run_test(self):\n         # This will raise an exception since there are missing inputs\n         assert_raises_rpc_error(-25, \"Missing inputs\", self.nodes[2].sendrawtransaction, rawtx['hex'])\n \n+        #####################################\n+        # getrawtransaction with block hash #\n+        #####################################\n+\n+        # make a tx by sending then generate 2 blocks; block1 has the tx in it\n+        tx = self.nodes[2].sendtoaddress(self.nodes[1].getnewaddress(), 1)\n+        block1, block2 = self.nodes[2].generate(2)\n+        self.sync_all()\n+        # We should be able to get the raw transaction by providing the correct block\n+        gottx = self.nodes[0].getrawtransaction(tx, True, block1)\n+        assert_equal(gottx['txid'], tx)\n+        assert_equal(gottx['in_active_chain'], True)\n+        # We should not get the tx if we provide an unrelated block\n+        assert_raises_rpc_error(-5, \"No such transaction found\", self.nodes[0].getrawtransaction, tx, True, block2)\n+        # An invalid block hash should raise the correct errors\n+        assert_raises_rpc_error(-8, \"parameter 3 must be hexadecimal\", self.nodes[0].getrawtransaction, tx, True, True)\n+        assert_raises_rpc_error(-8, \"parameter 3 must be hexadecimal\", self.nodes[0].getrawtransaction, tx, True, \"foobar\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r154838762",
      "id" : 154838762,
      "in_reply_to_id" : 154831307,
      "original_commit_id" : "650e4eee922d689a5d5d5a4c62fb6d9cf0e71529",
      "original_position" : 20,
      "path" : "test/functional/rawtransactions.py",
      "position" : 24,
      "pull_request_review_id" : 81061337,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T03:28:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/154838762",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@promag Added test for unset `in_active_chain`.",
      "created_at" : "2017-12-05T03:28:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-349184096",
      "id" : 349184096,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-12-05T03:28:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/349184096",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r154956174"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/154956174"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit, add space after `,`. Same below.",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-12-05T14:15:34Z",
      "diff_hunk" : "@@ -188,13 +212,13 @@ def run_test(self):\n         assert_equal(self.nodes[0].getrawtransaction(txHash, True)[\"hex\"], rawTxSigned['hex'])\n \n         # 6. invalid parameters - supply txid and string \"Flase\"\n-        assert_raises_rpc_error(-3,\"Invalid type\", self.nodes[0].getrawtransaction, txHash, \"Flase\")\n+        assert_raises_rpc_error(-1,\"not a boolean\", self.nodes[0].getrawtransaction, txHash, \"Flase\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r154956174",
      "id" : 154956174,
      "original_commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "original_position" : 36,
      "path" : "test/functional/rawtransactions.py",
      "position" : 36,
      "pull_request_review_id" : 81195223,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T14:21:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/154956174",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r154956472"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/154956472"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit, remaining comments are lowercase. Same below.",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-12-05T14:16:31Z",
      "diff_hunk" : "@@ -50,6 +50,30 @@ def run_test(self):\n         # This will raise an exception since there are missing inputs\n         assert_raises_rpc_error(-25, \"Missing inputs\", self.nodes[2].sendrawtransaction, rawtx['hex'])\n \n+        #####################################\n+        # getrawtransaction with block hash #\n+        #####################################\n+\n+        # make a tx by sending then generate 2 blocks; block1 has the tx in it\n+        tx = self.nodes[2].sendtoaddress(self.nodes[1].getnewaddress(), 1)\n+        block1, block2 = self.nodes[2].generate(2)\n+        self.sync_all()\n+        # We should be able to get the raw transaction by providing the correct block",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r154956472",
      "id" : 154956472,
      "original_commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "original_position" : 12,
      "path" : "test/functional/rawtransactions.py",
      "position" : 12,
      "pull_request_review_id" : 81195223,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T14:21:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/154956472",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r154956832"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/154956832"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Calling without blockhash in a *section* where the RPC is tested with a block hash :trollface: maybe move this elsewhere?",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-12-05T14:17:43Z",
      "diff_hunk" : "@@ -50,6 +50,30 @@ def run_test(self):\n         # This will raise an exception since there are missing inputs\n         assert_raises_rpc_error(-25, \"Missing inputs\", self.nodes[2].sendrawtransaction, rawtx['hex'])\n \n+        #####################################\n+        # getrawtransaction with block hash #\n+        #####################################\n+\n+        # make a tx by sending then generate 2 blocks; block1 has the tx in it\n+        tx = self.nodes[2].sendtoaddress(self.nodes[1].getnewaddress(), 1)\n+        block1, block2 = self.nodes[2].generate(2)\n+        self.sync_all()\n+        # We should be able to get the raw transaction by providing the correct block\n+        gottx = self.nodes[0].getrawtransaction(tx, True, block1)\n+        assert_equal(gottx['txid'], tx)\n+        assert_equal(gottx['in_active_chain'], True)\n+        # We should not have the 'in_active_chain' flag when we don't provide a block\n+        gottx = self.nodes[0].getrawtransaction(tx, True)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r154956832",
      "id" : 154956832,
      "original_commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "original_position" : 17,
      "path" : "test/functional/rawtransactions.py",
      "position" : 17,
      "pull_request_review_id" : 81195223,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T14:21:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/154956832",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r154957937"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/154957937"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Could use parameter name instead of `parameter 3`? This is ugly for named args. (fix others in a new commit or in a follow up PR, whatever).",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-12-05T14:21:25Z",
      "diff_hunk" : "@@ -132,42 +137,58 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\"\")\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true\")\n             + HelpExampleRpc(\"getrawtransaction\", \"\\\"mytxid\\\", true\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" false \\\"myblockhash\\\"\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true \\\"myblockhash\\\"\")\n         );\n \n     LOCK(cs_main);\n \n+    bool in_active_chain = true;\n     uint256 hash = ParseHashV(request.params[0], \"parameter 1\");\n+    CBlockIndex* blockindex = nullptr;\n \n     // Accept either a bool (true) or a num (>=1) to indicate verbose output.\n     bool fVerbose = false;\n     if (!request.params[1].isNull()) {\n-        if (request.params[1].isNum()) {\n-            if (request.params[1].get_int() != 0) {\n-                fVerbose = true;\n-            }\n-        }\n-        else if(request.params[1].isBool()) {\n-            if(request.params[1].isTrue()) {\n-                fVerbose = true;\n+        fVerbose = request.params[1].isNum() ? (request.params[1].get_int() != 0) : request.params[1].get_bool();\n+    }\n+\n+    if (!request.params[2].isNull()) {\n+        uint256 blockhash = ParseHashV(request.params[2], \"parameter 3\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r154957937",
      "id" : 154957937,
      "original_commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "original_position" : 65,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : 65,
      "pull_request_review_id" : 81195223,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-05T14:21:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/154957937",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "utACK 434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-12-05T18:29:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-349396767",
      "id" : 349396767,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-12-05T18:29:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/349396767",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r155110399"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155110399"
         }
      },
      "author_association" : "MEMBER",
      "body" : "<strike> nit: Should not be initialized, to aid static analysers. </strike>\r\n\r\nStrike that. gcc would throw a warning.",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-12-05T23:44:53Z",
      "diff_hunk" : "@@ -132,30 +137,58 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\"\")\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true\")\n             + HelpExampleRpc(\"getrawtransaction\", \"\\\"mytxid\\\", true\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" false \\\"myblockhash\\\"\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true \\\"myblockhash\\\"\")\n         );\n \n     LOCK(cs_main);\n \n+    bool in_active_chain = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r155110399",
      "id" : 155110399,
      "original_commit_id" : "b16795167704687d908f881dacf04d388db28cb3",
      "original_position" : 46,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : 46,
      "pull_request_review_id" : 81375709,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-06T01:43:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155110399",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Sorry for the sloppy review. I messed up the parameter order when testing. Also gcc complains about my nit-fix.\r\n\r\nTested ACK now:\r\n\r\n```\r\n-----BEGIN PGP SIGNED MESSAGE-----\r\nHash: SHA512\r\n\r\nTested ACK 434526aba680cb73208e018a02827d51a71cfff6\r\n-----BEGIN PGP SIGNATURE-----\r\n\r\niQIcBAEBCgAGBQJaJ1PQAAoJENLqSFDnUoslonMQAJz8bVoePuyYUgOHkbGIGemj\r\n4yUyywvp34A4BocYrczH9Im6q+/VBoLrxd+7BqcrhWclHC2G7tvVircgXS/O/RHE\r\nSrEjox5dpLnQ5vW2Ik1hZkdlWvJvn6KBPRqLxZ8qLVFE2ym9BapDhZy33kePh4If\r\nBPBalz7U/1rMz2p2a7yKLo26+MArSwt9kiGebuzgUeaUREjn3gQhaouo4mGSVN59\r\n3Fc1zw3TS1zRuXek/EGL6uuRNQsZZkS08maHtZcsigtwS9drrekrPgx2LswvqGoN\r\nHNkF3AkVK2RZ96cvyG1DbGPG8PkY+EQxO97de2Jlq8/8qQ7wu/BrwJvhjGpdoqGI\r\nSL2pA9KgPfWDTDr13Tcavm+iGk+SbI99Hk+MgsyRArplPJYUtTi43WID/uRaydyE\r\nmCykCPFHkDehVIb8FL/MxSCyBzqJxn4IGXL/Q4A+BbbEYgu1Yi8xtE1o/sCqHyvD\r\nqoKlj1ns9JhNOIpdZNhaWvVb30VuugcZh1/I7CE4NJINdaP7oYKLS0JCiBjwxLKN\r\n6lvBYfoJmNLOvEOiB5DGeQEtnU/mBeGrDgoRddNpnKWRQMOIKi53aKvmeJ4XNw0T\r\nUcIAxaj6c+lZNKYeedePcuRKapqIW9fEQ9IAI8+duRisl6TBcn7/0bJHjWLgy062\r\nNtvMJ3zBCmEhX3Vs4km5\r\n=6+iY\r\n-----END PGP SIGNATURE-----\r\n",
      "created_at" : "2017-12-06T02:22:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-349509602",
      "id" : 349509602,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-12-06T02:22:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/349509602",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r155138708"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155138708"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`in_active_chain` is a part of the blockhash stuff, though, so it sort of makes sense to keep the test together with the others.",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-12-06T03:27:08Z",
      "diff_hunk" : "@@ -50,6 +50,30 @@ def run_test(self):\n         # This will raise an exception since there are missing inputs\n         assert_raises_rpc_error(-25, \"Missing inputs\", self.nodes[2].sendrawtransaction, rawtx['hex'])\n \n+        #####################################\n+        # getrawtransaction with block hash #\n+        #####################################\n+\n+        # make a tx by sending then generate 2 blocks; block1 has the tx in it\n+        tx = self.nodes[2].sendtoaddress(self.nodes[1].getnewaddress(), 1)\n+        block1, block2 = self.nodes[2].generate(2)\n+        self.sync_all()\n+        # We should be able to get the raw transaction by providing the correct block\n+        gottx = self.nodes[0].getrawtransaction(tx, True, block1)\n+        assert_equal(gottx['txid'], tx)\n+        assert_equal(gottx['in_active_chain'], True)\n+        # We should not have the 'in_active_chain' flag when we don't provide a block\n+        gottx = self.nodes[0].getrawtransaction(tx, True)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r155138708",
      "id" : 155138708,
      "in_reply_to_id" : 154956832,
      "original_commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "original_position" : 17,
      "path" : "test/functional/rawtransactions.py",
      "position" : 17,
      "pull_request_review_id" : 81407544,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-06T03:27:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155138708",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r155138788"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155138788"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is used in a ton of places. I never saw consensus on what exactly to do and chose to stick with it for now. As you said, different PR.",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-12-06T03:27:57Z",
      "diff_hunk" : "@@ -132,42 +137,58 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\"\")\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true\")\n             + HelpExampleRpc(\"getrawtransaction\", \"\\\"mytxid\\\", true\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" false \\\"myblockhash\\\"\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true \\\"myblockhash\\\"\")\n         );\n \n     LOCK(cs_main);\n \n+    bool in_active_chain = true;\n     uint256 hash = ParseHashV(request.params[0], \"parameter 1\");\n+    CBlockIndex* blockindex = nullptr;\n \n     // Accept either a bool (true) or a num (>=1) to indicate verbose output.\n     bool fVerbose = false;\n     if (!request.params[1].isNull()) {\n-        if (request.params[1].isNum()) {\n-            if (request.params[1].get_int() != 0) {\n-                fVerbose = true;\n-            }\n-        }\n-        else if(request.params[1].isBool()) {\n-            if(request.params[1].isTrue()) {\n-                fVerbose = true;\n+        fVerbose = request.params[1].isNum() ? (request.params[1].get_int() != 0) : request.params[1].get_bool();\n+    }\n+\n+    if (!request.params[2].isNull()) {\n+        uint256 blockhash = ParseHashV(request.params[2], \"parameter 3\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r155138788",
      "id" : 155138788,
      "in_reply_to_id" : 154957937,
      "original_commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "original_position" : 65,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : 65,
      "pull_request_review_id" : 81407634,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-06T03:27:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155138788",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jtimon @jnewbery \r\nMind to re-ACK?",
      "created_at" : "2017-12-06T03:30:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-349521253",
      "id" : 349521253,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-12-06T03:30:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/349521253",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-12-06T07:09:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-349554584",
      "id" : 349554584,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2017-12-06T07:09:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/349554584",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r155379281"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155379281"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: these lines are confusing for me:\r\n\r\n```\r\n        uint256 blockhash = ParseHashV(request.params[2], \"parameter 3\");\r\n        if (!blockhash.IsNull()) {\r\n```\r\n\r\n`ParseHashV()` can either throw or return a uint256. The only way it'll return a null uint256 is if the input is a 64 length string of `0`s. That can't be a valid block (if someone finds a block that hashes to zero then they win Bitcoin The Game and we can all stop playing), so I think that this if condition is unnecessary - if parameter 3 is all zeroes, we should throw with the error that 0x0 is an invalid block.\r\n\r\nI don't think this is a huge problem - if all zeroes is supplied as the block hash, we'll just drop through and search for the transaction in the {mempool , blockchain (if fTxIndex) , UTXO set} as if no block hash had been provided. However, it's a bit confusing for the code reader since it implies to me that we're expecting `ParseHashV()` to return a null value if it fails to parse the hash.",
      "commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "created_at" : "2017-12-06T22:22:18Z",
      "diff_hunk" : "@@ -132,42 +137,58 @@ UniValue getrawtransaction(const JSONRPCRequest& request)\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\"\")\n             + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true\")\n             + HelpExampleRpc(\"getrawtransaction\", \"\\\"mytxid\\\", true\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" false \\\"myblockhash\\\"\")\n+            + HelpExampleCli(\"getrawtransaction\", \"\\\"mytxid\\\" true \\\"myblockhash\\\"\")\n         );\n \n     LOCK(cs_main);\n \n+    bool in_active_chain = true;\n     uint256 hash = ParseHashV(request.params[0], \"parameter 1\");\n+    CBlockIndex* blockindex = nullptr;\n \n     // Accept either a bool (true) or a num (>=1) to indicate verbose output.\n     bool fVerbose = false;\n     if (!request.params[1].isNull()) {\n-        if (request.params[1].isNum()) {\n-            if (request.params[1].get_int() != 0) {\n-                fVerbose = true;\n-            }\n-        }\n-        else if(request.params[1].isBool()) {\n-            if(request.params[1].isTrue()) {\n-                fVerbose = true;\n+        fVerbose = request.params[1].isNum() ? (request.params[1].get_int() != 0) : request.params[1].get_bool();\n+    }\n+\n+    if (!request.params[2].isNull()) {\n+        uint256 blockhash = ParseHashV(request.params[2], \"parameter 3\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#discussion_r155379281",
      "id" : 155379281,
      "original_commit_id" : "434526aba680cb73208e018a02827d51a71cfff6",
      "original_position" : 65,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : 65,
      "pull_request_review_id" : 81689365,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10275",
      "updated_at" : "2017-12-06T22:22:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155379281",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "For reference, This was proposed (and closed) in #2421.",
      "created_at" : "2018-02-22T01:24:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-367536021",
      "id" : 367536021,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2018-02-22T01:24:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/367536021",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@promag I believe the concerns raised in #2421 are not relevant anymore / in this implementation.",
      "created_at" : "2018-02-22T04:23:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10275#issuecomment-367563299",
      "id" : 367563299,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10275",
      "updated_at" : "2018-02-22T04:23:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/367563299",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   }
]
