[
   {
      "author_association" : "MEMBER",
      "body" : "Big Concept ACK, excited about this",
      "created_at" : "2018-01-24T01:57:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-359994997",
      "id" : 359994997,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-01-24T01:57:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/359994997",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "Should this be labeled consensus? This is a P2P change, right?\r\n",
      "created_at" : "2018-01-24T14:36:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-360154896",
      "id" : 360154896,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-01-24T14:36:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/360154896",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@laanwj This is a data structure to be used in a P2P change. I first thought that it shouldn't be tagged \"Consensus\", but there's an argument to be made for it. It doesn't affect blockchain consensus, but it is kind of a softer P2P consensus change, where network clients (though not other full nodes) may disconnect/ban you if you serve incorrectly computed block filters. I'll let you make the call on the tag.",
      "created_at" : "2018-01-24T17:09:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-360204783",
      "id" : 360204783,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-01-24T17:09:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/360204783",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "Any fork that can be resolved by a P2P adaptor that speaks both protocols is not a consensus change.",
      "created_at" : "2018-01-24T17:12:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-360205706",
      "id" : 360205706,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-01-24T17:12:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/360205706",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "> This is a data structure to be used in a P2P change.\r\n\r\nThanks for the explanation. With \"consensus\" we mean the blockchain consensus rules code. Banning\\disconnecting is a P2P level issue. So changing the label to P2P.",
      "created_at" : "2018-01-24T17:19:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-360207830",
      "id" : 360207830,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-01-24T17:19:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/360207830",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Great work @jimpo!\r\nBig Concept ACK,... will help to get this done.",
      "created_at" : "2018-01-25T22:33:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-360623262",
      "id" : 360623262,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-01-25T22:33:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/360623262",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r167173632"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/167173632"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Not sure, but I guess that comments belongs to L113?",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-02-09T09:13:33Z",
      "diff_hunk" : "@@ -0,0 +1,319 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <primitives/transaction.h>\n+#include <script/script.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+static constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+static constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)\n+{\n+    // Write quotient as unary-encoded: q 1's followed by one 0.\n+    uint64_t q = n >> k;\n+    while (q > 0) {\n+        int nbits = q <= 64 ? static_cast<int>(q) : 64;\n+        bitwriter.Write(~0ULL, nbits);\n+        q -= nbits;\n+    }\n+    bitwriter.Write(0, 1);\n+\n+    // Write the remainder in k bits. Since the remainder is just the bottom\n+    // k bits of n, there is no need to mask first.\n+    bitwriter.Write(n, k);\n+}\n+\n+template <typename IStream>\n+static uint64_t GolombRiceDecode(BitStreamReader<IStream>& bitreader, uint8_t k)\n+{\n+    // Read unary-encoded quotient: q 1's followed by one 0.\n+    uint64_t q = 0;\n+    while (bitreader.Read(1) == 1) {\n+        q++;\n+    }\n+\n+    uint64_t r = bitreader.Read(k);\n+\n+    return (q << k) + r;\n+}\n+\n+// Map a value x that is uniformly distributed in the range [0, 2^64) to a\n+// value uniformly distributed in [0, n) by returning the upper 64 bits of\n+// x * n.\n+//\n+// See: https://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/\n+static uint64_t MapIntoRange(uint64_t x, uint64_t n)\n+{\n+    // To perform the calculation on 64-bit numbers without losing the\n+    // result to overflow, split the numbers into the most significant and\n+    // least significant 32 bits and perform multiplication piece-wise.\n+    //\n+    // See: https://stackoverflow.com/a/26855440\n+    uint64_t x_hi = x >> 32;\n+    uint64_t x_lo = x & 0xFFFFFFFF;\n+    uint64_t n_hi = n >> 32;\n+    uint64_t n_lo = n & 0xFFFFFFFF;\n+\n+    uint64_t ac = x_hi * n_hi;\n+    uint64_t ad = x_hi * n_lo;\n+    uint64_t bc = x_lo * n_hi;\n+    uint64_t bd = x_lo * n_lo;\n+\n+    uint64_t mid34 = (bd >> 32) + (bc & 0xFFFFFFFF) + (ad & 0xFFFFFFFF);\n+    uint64_t upper64 = ac + (bc >> 32) + (ad >> 32) + (mid34 >> 32);\n+    return upper64;\n+}\n+\n+uint64_t GCSFilter::HashToRange(const Element& element) const\n+{\n+    uint64_t hash = CSipHasher(m_siphash_k0, m_siphash_k1)\n+        .Write(element.data(), element.size())\n+        .Finalize();\n+    return MapIntoRange(hash, m_F);\n+}\n+\n+std::vector<uint64_t> GCSFilter::BuildHashedSet(const std::set<Element>& elements) const\n+{\n+    std::vector<uint64_t> hashed_elements;\n+    hashed_elements.reserve(elements.size());\n+    for (const Element& element : elements) {\n+        hashed_elements.push_back(HashToRange(element));\n+    }\n+    std::sort(hashed_elements.begin(), hashed_elements.end());\n+    return hashed_elements;\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P)\n+    : m_siphash_k0(siphash_k0), m_siphash_k1(siphash_k1), m_P(P), m_N(0), m_F(0)\n+{\n+    if (m_P > 32) {\n+        throw std::invalid_argument(\"P must be <=32\");\n+    }\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P,\n+                     std::vector<unsigned char> encoded_filter)\n+    : GCSFilter(siphash_k0, siphash_k1, P)\n+{\n+    m_encoded = std::move(encoded_filter);\n+\n+    CVectorReader stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    m_N = ReadCompactSize(stream);\n+    m_F = m_N << m_P;\n+\n+    if (m_N >= (1ULL << 32)) {\n+        throw std::invalid_argument(\"N must be <2^32\");\n+    }\n+\n+    // Surface any errors decoding the filter on construction.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r167173632",
      "id" : 167173632,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2NzE3MzYzMg==",
      "original_commit_id" : "884ebec137484daac81c208b805815ff9ee3b35c",
      "original_position" : 117,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 95354532,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/167173632",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Reviewed and tested a bit... nice, clean PR!\r\nI would wish we had more test vectors... ",
      "created_at" : "2018-02-09T09:46:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-364385727",
      "id" : 364385727,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-02-09T09:46:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/364385727",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK. Would it useful to add some (hidden) RPC commands so other developers can test it?",
      "created_at" : "2018-02-09T15:14:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-364461376",
      "id" : 364461376,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-02-09T15:14:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/364461376",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@jonasschnelli Thanks for reviewing. The test vectors were generated from a Go program I have that cross-validates against the [btcsuite implementation](https://github.com/Roasbeef/btcutil/pull/6). I can easily add any specific testnet blocks to the list of cases. The blocks were chosen to exercise certain edge cases (eg. empty filters, duplicate pushdatas, invalid output scripts), but the vectors aren't commented with which edges cases they exercise. I'll add the comments, because it seems worthwhile.\r\n\r\n@Sjors I'd definitely like to see RPC commands to fetch specific filters and filter headers, but I think it makes more sense to do that after adding the filter index, so that the RPC handlers just have to look up a precomputed filter/header. (So basically, in a subsequent PR).",
      "created_at" : "2018-02-09T18:15:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-364513902",
      "id" : 364513902,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-02-09T18:47:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/364513902",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r167313633"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/167313633"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "No, the idea is that the below lines fully decode the filter in the constructor so that any errors decoding get raised during construction rather than when it is first matched against. I'll elaborate on the comment.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-02-09T18:49:12Z",
      "diff_hunk" : "@@ -0,0 +1,319 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <primitives/transaction.h>\n+#include <script/script.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+static constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+static constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)\n+{\n+    // Write quotient as unary-encoded: q 1's followed by one 0.\n+    uint64_t q = n >> k;\n+    while (q > 0) {\n+        int nbits = q <= 64 ? static_cast<int>(q) : 64;\n+        bitwriter.Write(~0ULL, nbits);\n+        q -= nbits;\n+    }\n+    bitwriter.Write(0, 1);\n+\n+    // Write the remainder in k bits. Since the remainder is just the bottom\n+    // k bits of n, there is no need to mask first.\n+    bitwriter.Write(n, k);\n+}\n+\n+template <typename IStream>\n+static uint64_t GolombRiceDecode(BitStreamReader<IStream>& bitreader, uint8_t k)\n+{\n+    // Read unary-encoded quotient: q 1's followed by one 0.\n+    uint64_t q = 0;\n+    while (bitreader.Read(1) == 1) {\n+        q++;\n+    }\n+\n+    uint64_t r = bitreader.Read(k);\n+\n+    return (q << k) + r;\n+}\n+\n+// Map a value x that is uniformly distributed in the range [0, 2^64) to a\n+// value uniformly distributed in [0, n) by returning the upper 64 bits of\n+// x * n.\n+//\n+// See: https://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/\n+static uint64_t MapIntoRange(uint64_t x, uint64_t n)\n+{\n+    // To perform the calculation on 64-bit numbers without losing the\n+    // result to overflow, split the numbers into the most significant and\n+    // least significant 32 bits and perform multiplication piece-wise.\n+    //\n+    // See: https://stackoverflow.com/a/26855440\n+    uint64_t x_hi = x >> 32;\n+    uint64_t x_lo = x & 0xFFFFFFFF;\n+    uint64_t n_hi = n >> 32;\n+    uint64_t n_lo = n & 0xFFFFFFFF;\n+\n+    uint64_t ac = x_hi * n_hi;\n+    uint64_t ad = x_hi * n_lo;\n+    uint64_t bc = x_lo * n_hi;\n+    uint64_t bd = x_lo * n_lo;\n+\n+    uint64_t mid34 = (bd >> 32) + (bc & 0xFFFFFFFF) + (ad & 0xFFFFFFFF);\n+    uint64_t upper64 = ac + (bc >> 32) + (ad >> 32) + (mid34 >> 32);\n+    return upper64;\n+}\n+\n+uint64_t GCSFilter::HashToRange(const Element& element) const\n+{\n+    uint64_t hash = CSipHasher(m_siphash_k0, m_siphash_k1)\n+        .Write(element.data(), element.size())\n+        .Finalize();\n+    return MapIntoRange(hash, m_F);\n+}\n+\n+std::vector<uint64_t> GCSFilter::BuildHashedSet(const std::set<Element>& elements) const\n+{\n+    std::vector<uint64_t> hashed_elements;\n+    hashed_elements.reserve(elements.size());\n+    for (const Element& element : elements) {\n+        hashed_elements.push_back(HashToRange(element));\n+    }\n+    std::sort(hashed_elements.begin(), hashed_elements.end());\n+    return hashed_elements;\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P)\n+    : m_siphash_k0(siphash_k0), m_siphash_k1(siphash_k1), m_P(P), m_N(0), m_F(0)\n+{\n+    if (m_P > 32) {\n+        throw std::invalid_argument(\"P must be <=32\");\n+    }\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P,\n+                     std::vector<unsigned char> encoded_filter)\n+    : GCSFilter(siphash_k0, siphash_k1, P)\n+{\n+    m_encoded = std::move(encoded_filter);\n+\n+    CVectorReader stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    m_N = ReadCompactSize(stream);\n+    m_F = m_N << m_P;\n+\n+    if (m_N >= (1ULL << 32)) {\n+        throw std::invalid_argument(\"N must be <2^32\");\n+    }\n+\n+    // Surface any errors decoding the filter on construction.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r167313633",
      "id" : 167313633,
      "in_reply_to_id" : 167173632,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2NzMxMzYzMw==",
      "original_commit_id" : "884ebec137484daac81c208b805815ff9ee3b35c",
      "original_position" : 117,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 95523188,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/167313633",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r174886724"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174886724"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"streams: Create CVectorReader stream interface for vectors.\" (93f702b08e413c5c025b155bfb62b721d27939f5)\r\n\r\nThis is pretty similar to the VectorReader class @TheBlueMatt is adding here: https://github.com/TheBlueMatt/bitcoin/commit/bb608a995e8fd16d156145bf41023e7a77d44971 for https://github.com/bitcoin/bitcoin/compare/master...TheBlueMatt:2018-02-miningserver\r\n\r\nYour implementation is more general with support for deserialization in the constructor and more complete comments. But his has a `pos()` method and uses non-hungarian names which are recommended by the contrib guide. Anyway you may want to incorporate some of his changes.\r\n\r\n",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-03-15T18:29:54Z",
      "diff_hunk" : "@@ -138,6 +138,80 @@ class CVectorWriter\n     size_t nPos;\n };\n \n+/* Minimal stream for reading from an existing vector by reference\n+ */\n+class CVectorReader",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r174886724",
      "id" : 174886724,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3NDg4NjcyNA==",
      "original_commit_id" : "93f702b08e413c5c025b155bfb62b721d27939f5",
      "original_position" : 6,
      "path" : "src/streams.h",
      "position" : null,
      "pull_request_review_id" : 104327123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174886724",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r174888569"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174888569"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"streams: Create CVectorReader stream interface for vectors.\" (93f702b08e413c5c025b155bfb62b721d27939f5)\r\n\r\nIt would be nice if this just had `const unsigned char*` and `size_t` members instead of a requiring a reference to an actual vector. That way the class could be used to efficiently deserialize from any memory location, and be compatible with other containers like `std::string`.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-03-15T18:34:53Z",
      "diff_hunk" : "@@ -138,6 +138,80 @@ class CVectorWriter\n     size_t nPos;\n };\n \n+/* Minimal stream for reading from an existing vector by reference\n+ */\n+class CVectorReader\n+{\n+private:\n+    const int nType;\n+    const int nVersion;\n+    const std::vector<unsigned char>& vchData;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r174888569",
      "id" : 174888569,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3NDg4ODU2OQ==",
      "original_commit_id" : "93f702b08e413c5c025b155bfb62b721d27939f5",
      "original_position" : 11,
      "path" : "src/streams.h",
      "position" : null,
      "pull_request_review_id" : 104327123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/174888569",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> @Sjors I'd definitely like to see RPC commands to fetch specific filters and filter headers, but I think it makes more sense to do that after adding the filter index, so that the RPC handlers just have to look up a precomputed filter/header. (So basically, in a subsequent PR).\r\n\r\nEven a proof-of-concept PR for that would be useful for review.",
      "created_at" : "2018-03-15T19:07:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-373489502",
      "id" : 373489502,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-03-15T19:07:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/373489502",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r175538303"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/175538303"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "OK, I can bring that commit over instead or modify this one to remove the hungarian notation.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-03-19T18:22:00Z",
      "diff_hunk" : "@@ -138,6 +138,80 @@ class CVectorWriter\n     size_t nPos;\n };\n \n+/* Minimal stream for reading from an existing vector by reference\n+ */\n+class CVectorReader",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r175538303",
      "id" : 175538303,
      "in_reply_to_id" : 174886724,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3NTUzODMwMw==",
      "original_commit_id" : "93f702b08e413c5c025b155bfb62b721d27939f5",
      "original_position" : 6,
      "path" : "src/streams.h",
      "position" : null,
      "pull_request_review_id" : 105083611,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/175538303",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r175539924"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/175539924"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'd rather not deal with raw pointers because it leaves space for unsafe accesses. If generality is a concern, I'd prefer a templated approach with random access iterators.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-03-19T18:27:18Z",
      "diff_hunk" : "@@ -138,6 +138,80 @@ class CVectorWriter\n     size_t nPos;\n };\n \n+/* Minimal stream for reading from an existing vector by reference\n+ */\n+class CVectorReader\n+{\n+private:\n+    const int nType;\n+    const int nVersion;\n+    const std::vector<unsigned char>& vchData;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r175539924",
      "id" : 175539924,
      "in_reply_to_id" : 174888569,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3NTUzOTkyNA==",
      "original_commit_id" : "93f702b08e413c5c025b155bfb62b721d27939f5",
      "original_position" : 11,
      "path" : "src/streams.h",
      "position" : null,
      "pull_request_review_id" : 105085540,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/175539924",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@Sjors Here is a branch that exposes an RPC for testing/playing around: https://github.com/jimpo/bitcoin/tree/bip158-rpc. Is not intended to be merged for reasons stated [above](https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-364513902).",
      "created_at" : "2018-03-20T01:48:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-374444591",
      "id" : 374444591,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-03-20T17:31:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/374444591",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178601571"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178601571"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"streams: Implement BitStreamReader/Writer classes.\"\r\n\r\nComment for m_offset would be helpful. Maybe `//!< Number of high order bits in m_buffer already returned by previous Read() calls.`",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-04-02T17:47:00Z",
      "diff_hunk" : "@@ -509,12 +509,88 @@ class CDataStream\n     }\n };\n \n+template <typename IStream>\n+class BitStreamReader\n+{\n+private:\n+    IStream& m_istream;\n+    uint8_t m_buffer;\n+    int m_offset;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178601571",
      "id" : 178601571,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3ODYwMTU3MQ==",
      "original_commit_id" : "e6e320d600c70cf4d530b49f3e526cdb7e66be6d",
      "original_position" : 10,
      "path" : "src/streams.h",
      "position" : null,
      "pull_request_review_id" : 108683613,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178601571",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178604425"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178604425"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"streams: Implement BitStreamReader/Writer classes.\"\r\n\r\nWould be nice to initialize `m_buffer`, `m_offset` above, where they are declared (see \"Initialize all non-static class members where they are defined\" guideline from https://github.com/bitcoin/bitcoin/blob/master/doc/developer-notes.md). Similarly in BitStreamWriter below.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-04-02T17:57:11Z",
      "diff_hunk" : "@@ -509,12 +509,88 @@ class CDataStream\n     }\n };\n \n+template <typename IStream>\n+class BitStreamReader\n+{\n+private:\n+    IStream& m_istream;\n+    uint8_t m_buffer;\n+    int m_offset;\n \n+public:\n+    BitStreamReader(IStream& istream)\n+        : m_istream(istream), m_buffer(0), m_offset(8) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178604425",
      "id" : 178604425,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3ODYwNDQyNQ==",
      "original_commit_id" : "e6e320d600c70cf4d530b49f3e526cdb7e66be6d",
      "original_position" : 14,
      "path" : "src/streams.h",
      "position" : null,
      "pull_request_review_id" : 108683613,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178604425",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178605236"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178605236"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"streams: Implement BitStreamReader/Writer classes.\"\r\n\r\nWould be nice to add a simple unit test writing values to a stream with BitStreamWriter, and then making sure same values are returned from BitStreamReader.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-04-02T17:59:57Z",
      "diff_hunk" : "@@ -509,12 +509,88 @@ class CDataStream\n     }\n };\n \n+template <typename IStream>\n+class BitStreamReader\n+{\n+private:\n+    IStream& m_istream;\n+    uint8_t m_buffer;\n+    int m_offset;\n \n+public:\n+    BitStreamReader(IStream& istream)\n+        : m_istream(istream), m_buffer(0), m_offset(8) {}\n \n+    /** Read the specified number of bits from the stream. The data is returned\n+     * in the nbits least signficant bits of a 64-bit uint.\n+     */\n+    uint64_t Read(int nbits) {\n+        if (nbits < 0 || nbits > 64) {\n+            throw std::out_of_range(\"nbits must be between 0 and 64\");\n+        }\n+\n+        uint64_t data = 0;\n+        while (nbits > 0) {\n+            if (m_offset == 8) {\n+                m_istream >> m_buffer;\n+                m_offset = 0;\n+            }\n \n+            int bits = std::min(8 - m_offset, nbits);\n+            data <<= bits;\n+            data |= static_cast<uint8_t>(m_buffer << m_offset) >> (8 - bits);\n+            m_offset += bits;\n+            nbits -= bits;\n+        }\n+        return data;\n+    }\n+};\n \n+template <typename OStream>\n+class BitStreamWriter",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178605236",
      "id" : 178605236,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3ODYwNTIzNg==",
      "original_commit_id" : "e6e320d600c70cf4d530b49f3e526cdb7e66be6d",
      "original_position" : 42,
      "path" : "src/streams.h",
      "position" : 129,
      "pull_request_review_id" : 108683613,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178605236",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178606747"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178606747"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"streams: Implement BitStreamReader/Writer classes.\"\r\n\r\nWould be good to add destructor either asserting `m_offset == 0`, or calling Flush(). Discarding bits that have been written but not flushed seems less safe than you might want as default behavior.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-04-02T18:05:44Z",
      "diff_hunk" : "@@ -509,12 +509,88 @@ class CDataStream\n     }\n };\n \n+template <typename IStream>\n+class BitStreamReader\n+{\n+private:\n+    IStream& m_istream;\n+    uint8_t m_buffer;\n+    int m_offset;\n \n+public:\n+    BitStreamReader(IStream& istream)\n+        : m_istream(istream), m_buffer(0), m_offset(8) {}\n \n+    /** Read the specified number of bits from the stream. The data is returned\n+     * in the nbits least signficant bits of a 64-bit uint.\n+     */\n+    uint64_t Read(int nbits) {\n+        if (nbits < 0 || nbits > 64) {\n+            throw std::out_of_range(\"nbits must be between 0 and 64\");\n+        }\n+\n+        uint64_t data = 0;\n+        while (nbits > 0) {\n+            if (m_offset == 8) {\n+                m_istream >> m_buffer;\n+                m_offset = 0;\n+            }\n \n+            int bits = std::min(8 - m_offset, nbits);\n+            data <<= bits;\n+            data |= static_cast<uint8_t>(m_buffer << m_offset) >> (8 - bits);\n+            m_offset += bits;\n+            nbits -= bits;\n+        }\n+        return data;\n+    }\n+};\n \n+template <typename OStream>\n+class BitStreamWriter\n+{\n+private:\n+    OStream& m_ostream;\n+    uint8_t m_buffer;\n+    int m_offset;\n \n+public:\n+    BitStreamWriter(OStream& ostream)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178606747",
      "id" : 178606747,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3ODYwNjc0Nw==",
      "original_commit_id" : "e6e320d600c70cf4d530b49f3e526cdb7e66be6d",
      "original_position" : 50,
      "path" : "src/streams.h",
      "position" : null,
      "pull_request_review_id" : 108683613,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178606747",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178608110"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178608110"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"streams: Implement BitStreamReader/Writer classes.\"\r\n\r\nWould add  `= 0; //!< Number of high-order bits in m_buffer that have been written but not yet flushed to the stream.`",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-04-02T18:10:47Z",
      "diff_hunk" : "@@ -509,12 +509,88 @@ class CDataStream\n     }\n };\n \n+template <typename IStream>\n+class BitStreamReader\n+{\n+private:\n+    IStream& m_istream;\n+    uint8_t m_buffer;\n+    int m_offset;\n \n+public:\n+    BitStreamReader(IStream& istream)\n+        : m_istream(istream), m_buffer(0), m_offset(8) {}\n \n+    /** Read the specified number of bits from the stream. The data is returned\n+     * in the nbits least signficant bits of a 64-bit uint.\n+     */\n+    uint64_t Read(int nbits) {\n+        if (nbits < 0 || nbits > 64) {\n+            throw std::out_of_range(\"nbits must be between 0 and 64\");\n+        }\n+\n+        uint64_t data = 0;\n+        while (nbits > 0) {\n+            if (m_offset == 8) {\n+                m_istream >> m_buffer;\n+                m_offset = 0;\n+            }\n \n+            int bits = std::min(8 - m_offset, nbits);\n+            data <<= bits;\n+            data |= static_cast<uint8_t>(m_buffer << m_offset) >> (8 - bits);\n+            m_offset += bits;\n+            nbits -= bits;\n+        }\n+        return data;\n+    }\n+};\n \n+template <typename OStream>\n+class BitStreamWriter\n+{\n+private:\n+    OStream& m_ostream;\n+    uint8_t m_buffer;\n+    int m_offset;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178608110",
      "id" : 178608110,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3ODYwODExMA==",
      "original_commit_id" : "e6e320d600c70cf4d530b49f3e526cdb7e66be6d",
      "original_position" : 47,
      "path" : "src/streams.h",
      "position" : null,
      "pull_request_review_id" : 108683613,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178608110",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178627611"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178627611"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"blockfilter: Declare GCSFilter class for BIP 158 impl.\"\r\n\r\nIt seems cumbersome for this to be implemented as a class, since none of the class members can change after construction, and some of the stored state is redundant (`m_F` is derived from `m_N` and `m_P`), `m_N` is redundant with `elements.size()` and can be derived from `m_encoded`).\r\n\r\nIf this were a simple set of functions instead, like:\r\n\r\n```c++\r\n\r\nstruct FilterParams { k0; k1; P; };\r\n\r\nvector<char> BuildFilter(FilterParams, set<Elements>);\r\n\r\nbool FilterContains(FilterParams, vector<char>, Element);\r\n\r\nbool FilterContainsAny(FilterParams, vector<char>, set<Element>);\r\n```\r\n\r\nusage would be more obvious, and you could get rid of the current runtime throws and asserts checking for inconsistencies in the state.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-04-02T19:31:35Z",
      "diff_hunk" : "@@ -0,0 +1,62 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_BLOCKFILTER_H\n+#define BITCOIN_BLOCKFILTER_H\n+\n+#include <set>\n+#include <stdint.h>\n+#include <vector>\n+\n+#include <serialize.h>\n+#include <uint256.h>\n+\n+/**\n+ * This implements a Golomb-coded set as defined in BIP 158. It is a\n+ * compact, probabilistic data structure for testing set membership.\n+ */\n+class GCSFilter",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178627611",
      "id" : 178627611,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3ODYyNzYxMQ==",
      "original_commit_id" : "15d529dfc2b65f2badaa520799187aff103af2b6",
      "original_position" : 19,
      "path" : "src/blockfilter.h",
      "position" : 21,
      "pull_request_review_id" : 108683613,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178627611",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178629277"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178629277"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"blockfilter: Implement GCSFilter constructors.\"\r\n\r\nHere and other places, N seems like it should be 32 bits instead 64.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-04-02T19:39:04Z",
      "diff_hunk" : "@@ -0,0 +1,155 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178629277",
      "id" : 178629277,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3ODYyOTI3Nw==",
      "original_commit_id" : "1b1d231ed77869174c33fde97efc65b0a0044ae0",
      "original_position" : 16,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 108683613,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178629277",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178630615"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178630615"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"blockfilter: Implement GCSFilter constructors.\"\r\n\r\nI wonder if the optimization below actually buys anything over a more direct:\r\n\r\n```c++\r\nfor (int i = 0; i < q; ++i) bitwriter.Write(1, 1);\r\n```",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-04-02T19:45:15Z",
      "diff_hunk" : "@@ -0,0 +1,155 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)\n+{\n+    // Write quotient as unary-encoded: q 1's followed by one 0.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178630615",
      "id" : 178630615,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3ODYzMDYxNQ==",
      "original_commit_id" : "1b1d231ed77869174c33fde97efc65b0a0044ae0",
      "original_position" : 18,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 108683613,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178630615",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178637016"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178637016"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"blockfilter: Implement GCSFilter Match methods.\"\r\n\r\nWould suggest implementing `Match` and `MatchAny` in terms of a common\r\n\r\n```c++\r\nMatch(const uint64_t* sorted_element_hashes, size_t size)\r\n```\r\n\r\nmethod to get rid of all the code duplication between the existing methods. No outside code would need to change, they could just call \r\n\r\n```c++\r\nMatch(&query, 1);\r\nMatch(queries.data(), queries.size());\r\n```\r\n\r\nrespectively.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-04-02T20:12:15Z",
      "diff_hunk" : "@@ -153,3 +153,64 @@ GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P,\n \n     bitwriter.Flush();\n }\n+\n+bool GCSFilter::Match(const GCSFilter::Element& element) const\n+{\n+    uint64_t query = HashToRange(element);\n+\n+    CVectorReader stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    // Seek forward by size of N\n+    uint64_t N = ReadCompactSize(stream);\n+    assert(N == m_N);\n+\n+    BitStreamReader<CVectorReader> bitreader(stream);\n+\n+    uint64_t value = 0;\n+    for (uint64_t i = 0; i < m_N; i++) {\n+        uint64_t delta = GolombRiceDecode(bitreader, m_P);\n+        value += delta;\n+\n+        if (query == value) {\n+            return true;\n+        } else if (query < value) {\n+            break;\n+        }\n+    }\n+\n+    return false;\n+}\n+\n+bool GCSFilter::MatchAny(const std::set<Element>& elements) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178637016",
      "id" : 178637016,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3ODYzNzAxNg==",
      "original_commit_id" : "fb96e966c87f27fbfdf53ad7b8fd5a3c6c679a77",
      "original_position" : 32,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 108683613,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178637016",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r180940245"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/180940245"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Didn't know about that guideline. Will do.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-04-12T01:04:44Z",
      "diff_hunk" : "@@ -509,12 +509,88 @@ class CDataStream\n     }\n };\n \n+template <typename IStream>\n+class BitStreamReader\n+{\n+private:\n+    IStream& m_istream;\n+    uint8_t m_buffer;\n+    int m_offset;\n \n+public:\n+    BitStreamReader(IStream& istream)\n+        : m_istream(istream), m_buffer(0), m_offset(8) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r180940245",
      "id" : 180940245,
      "in_reply_to_id" : 178604425,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4MDk0MDI0NQ==",
      "original_commit_id" : "e6e320d600c70cf4d530b49f3e526cdb7e66be6d",
      "original_position" : 14,
      "path" : "src/streams.h",
      "position" : null,
      "pull_request_review_id" : 111451491,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/180940245",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK\r\n\r\nNice work!",
      "created_at" : "2018-04-15T06:19:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-381383206",
      "id" : 381383206,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-04-15T06:19:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/381383206",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Has there been any work yet on using this to implement BIP 157? I've worked on indexing in the past, and could take a look at implementing it.",
      "created_at" : "2018-04-17T01:20:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-381799042",
      "id" : 381799042,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-04-17T01:20:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/381799042",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/544777?v=4",
         "events_url" : "https://api.github.com/users/braydonf/events{/privacy}",
         "followers_url" : "https://api.github.com/users/braydonf/followers",
         "following_url" : "https://api.github.com/users/braydonf/following{/other_user}",
         "gists_url" : "https://api.github.com/users/braydonf/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/braydonf",
         "id" : 544777,
         "login" : "braydonf",
         "organizations_url" : "https://api.github.com/users/braydonf/orgs",
         "received_events_url" : "https://api.github.com/users/braydonf/received_events",
         "repos_url" : "https://api.github.com/users/braydonf/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/braydonf/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/braydonf/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/braydonf"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r181930525"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/181930525"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This does not seem up to date with the latest version of BIP158 (I'll review in full later).",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-04-17T01:30:56Z",
      "diff_hunk" : "@@ -0,0 +1,323 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <primitives/transaction.h>\n+#include <script/script.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)\n+{\n+    // Write quotient as unary-encoded: q 1's followed by one 0.\n+    uint64_t q = n >> k;\n+    while (q > 0) {\n+        int nbits = q <= 64 ? static_cast<int>(q) : 64;\n+        bitwriter.Write(~0ULL, nbits);\n+        q -= nbits;\n+    }\n+    bitwriter.Write(0, 1);\n+\n+    // Write the remainder in k bits. Since the remainder is just the bottom\n+    // k bits of n, there is no need to mask first.\n+    bitwriter.Write(n, k);\n+}\n+\n+template <typename IStream>\n+static uint64_t GolombRiceDecode(BitStreamReader<IStream>& bitreader, uint8_t k)\n+{\n+    // Read unary-encoded quotient: q 1's followed by one 0.\n+    uint64_t q = 0;\n+    while (bitreader.Read(1) == 1) {\n+        q++;\n+    }\n+\n+    uint64_t r = bitreader.Read(k);\n+\n+    return (q << k) + r;\n+}\n+\n+// Map a value x that is uniformly distributed in the range [0, 2^64) to a\n+// value uniformly distributed in [0, n) by returning the upper 64 bits of\n+// x * n.\n+//\n+// See: https://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/\n+static uint64_t MapIntoRange(uint64_t x, uint64_t n)\n+{\n+    // To perform the calculation on 64-bit numbers without losing the\n+    // result to overflow, split the numbers into the most significant and\n+    // least significant 32 bits and perform multiplication piece-wise.\n+    //\n+    // See: https://stackoverflow.com/a/26855440\n+    uint64_t x_hi = x >> 32;\n+    uint64_t x_lo = x & 0xFFFFFFFF;\n+    uint64_t n_hi = n >> 32;\n+    uint64_t n_lo = n & 0xFFFFFFFF;\n+\n+    uint64_t ac = x_hi * n_hi;\n+    uint64_t ad = x_hi * n_lo;\n+    uint64_t bc = x_lo * n_hi;\n+    uint64_t bd = x_lo * n_lo;\n+\n+    uint64_t mid34 = (bd >> 32) + (bc & 0xFFFFFFFF) + (ad & 0xFFFFFFFF);\n+    uint64_t upper64 = ac + (bc >> 32) + (ad >> 32) + (mid34 >> 32);\n+    return upper64;\n+}\n+\n+uint64_t GCSFilter::HashToRange(const Element& element) const\n+{\n+    uint64_t hash = CSipHasher(m_siphash_k0, m_siphash_k1)\n+        .Write(element.data(), element.size())\n+        .Finalize();\n+    return MapIntoRange(hash, m_F);\n+}\n+\n+std::vector<uint64_t> GCSFilter::BuildHashedSet(const std::set<Element>& elements) const\n+{\n+    std::vector<uint64_t> hashed_elements;\n+    hashed_elements.reserve(elements.size());\n+    for (const Element& element : elements) {\n+        hashed_elements.push_back(HashToRange(element));\n+    }\n+    std::sort(hashed_elements.begin(), hashed_elements.end());\n+    return hashed_elements;\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P)\n+    : m_siphash_k0(siphash_k0), m_siphash_k1(siphash_k1), m_P(P), m_N(0), m_F(0)\n+{\n+    if (m_P > 32) {\n+        throw std::invalid_argument(\"P must be <=32\");\n+    }\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P,\n+                     std::vector<unsigned char> encoded_filter)\n+    : GCSFilter(siphash_k0, siphash_k1, P)\n+{\n+    m_encoded = std::move(encoded_filter);\n+\n+    CVectorReader stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    m_N = ReadCompactSize(stream);\n+    m_F = m_N << m_P;\n+\n+    if (m_N >= (1ULL << 32)) {\n+        throw std::ios_base::failure(\"N must be <2^32\");\n+    }\n+\n+    // Verify that the encoded filter contains exactly N elements. If it has too much or too little\n+    // data, a std::ios_base::failure exception will be raised.\n+    BitStreamReader<CVectorReader> bitreader(stream);\n+    for (uint64_t i = 0; i < m_N; i++) {\n+        GolombRiceDecode(bitreader, m_P);\n+    }\n+    if (!stream.empty()) {\n+        throw std::ios_base::failure(\"encoded_filter contains excess data\");\n+    }\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P,\n+                     const std::set<GCSFilter::Element>& elements)\n+    : GCSFilter(siphash_k0, siphash_k1, P)\n+{\n+    if (elements.size() >= (1ULL << 32)) {\n+        throw std::invalid_argument(\"N must be <2^32\");\n+    }\n+\n+    m_N = elements.size();\n+    m_F = m_N << m_P;\n+\n+    CVectorWriter stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    WriteCompactSize(stream, m_N);\n+\n+    if (elements.empty()) {\n+        return;\n+    }\n+\n+    BitStreamWriter<CVectorWriter> bitwriter(stream);\n+\n+    uint64_t last_value = 0;\n+    for (uint64_t value : BuildHashedSet(elements)) {\n+        uint64_t delta = value - last_value;\n+        GolombRiceEncode(bitwriter, m_P, delta);\n+        last_value = value;\n+    }\n+\n+    bitwriter.Flush();\n+}\n+\n+bool GCSFilter::Match(const GCSFilter::Element& element) const\n+{\n+    uint64_t query = HashToRange(element);\n+\n+    CVectorReader stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    // Seek forward by size of N\n+    uint64_t N = ReadCompactSize(stream);\n+    assert(N == m_N);\n+\n+    BitStreamReader<CVectorReader> bitreader(stream);\n+\n+    uint64_t value = 0;\n+    for (uint64_t i = 0; i < m_N; i++) {\n+        uint64_t delta = GolombRiceDecode(bitreader, m_P);\n+        value += delta;\n+\n+        if (query == value) {\n+            return true;\n+        } else if (query < value) {\n+            break;\n+        }\n+    }\n+\n+    return false;\n+}\n+\n+bool GCSFilter::MatchAny(const std::set<Element>& elements) const\n+{\n+    const std::vector<uint64_t>&& queries = BuildHashedSet(elements);\n+\n+    CVectorReader stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    // Seek forward by size of N\n+    uint64_t N = ReadCompactSize(stream);\n+    assert(N == m_N);\n+\n+    BitStreamReader<CVectorReader> bitreader(stream);\n+\n+    uint64_t value = 0;\n+    auto query_it = queries.begin();\n+    for (uint64_t i = 0; i < m_N; i++) {\n+        uint64_t delta = GolombRiceDecode(bitreader, m_P);\n+        value += delta;\n+\n+        while (true) {\n+            if (query_it == queries.end()) {\n+                return false;\n+            } else if (*query_it == value) {\n+                return true;\n+            } else if (*query_it > value) {\n+                break;\n+            }\n+\n+            query_it++;\n+        }\n+    }\n+\n+    return false;\n+}\n+\n+static std::set<GCSFilter::Element> BasicFilterElements(const CBlock& block)\n+{\n+    std::set<GCSFilter::Element> elements;\n+    for (const CTransactionRef& tx : block.vtx) {\n+        // Include txid of each transaction.\n+        const uint256& txid = tx->GetHash();\n+        elements.emplace(txid.begin(), txid.end());\n+\n+        // Include previous outpoint of each input, except for coinbase.\n+        if (!tx->IsCoinBase()) {\n+            for (const CTxIn& txin : tx->vin) {\n+                std::vector<unsigned char> ser_outpoint;\n+                CVectorWriter(GCS_SER_TYPE, GCS_SER_VERSION, ser_outpoint, 0, txin.prevout);\n+                elements.insert(std::move(ser_outpoint));\n+            }\n+        }\n+\n+        // Include all data pushes in output scripts.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r181930525",
      "id" : 181930525,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4MTkzMDUyNQ==",
      "original_commit_id" : "68777c59c91fdcdc2967a39b70d41f215c6846ca",
      "original_position" : 237,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 112641204,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/181930525",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r181987725"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/181987725"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good suggestion.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-04-17T08:16:24Z",
      "diff_hunk" : "@@ -153,3 +153,64 @@ GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P,\n \n     bitwriter.Flush();\n }\n+\n+bool GCSFilter::Match(const GCSFilter::Element& element) const\n+{\n+    uint64_t query = HashToRange(element);\n+\n+    CVectorReader stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    // Seek forward by size of N\n+    uint64_t N = ReadCompactSize(stream);\n+    assert(N == m_N);\n+\n+    BitStreamReader<CVectorReader> bitreader(stream);\n+\n+    uint64_t value = 0;\n+    for (uint64_t i = 0; i < m_N; i++) {\n+        uint64_t delta = GolombRiceDecode(bitreader, m_P);\n+        value += delta;\n+\n+        if (query == value) {\n+            return true;\n+        } else if (query < value) {\n+            break;\n+        }\n+    }\n+\n+    return false;\n+}\n+\n+bool GCSFilter::MatchAny(const std::set<Element>& elements) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r181987725",
      "id" : 181987725,
      "in_reply_to_id" : 178637016,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4MTk4NzcyNQ==",
      "original_commit_id" : "fb96e966c87f27fbfdf53ad7b8fd5a3c6c679a77",
      "original_position" : 32,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 112706974,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/181987725",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r181992611"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/181992611"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why do you say that? This function can encode 64-bit ints if it needs to. Also, it would have to immediately get cast to a uint64_t either way.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-04-17T08:32:52Z",
      "diff_hunk" : "@@ -0,0 +1,155 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r181992611",
      "id" : 181992611,
      "in_reply_to_id" : 178629277,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4MTk5MjYxMQ==",
      "original_commit_id" : "1b1d231ed77869174c33fde97efc65b0a0044ae0",
      "original_position" : 16,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 112712507,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/181992611",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r182009549"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/182009549"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Added in 5f67272f5a2d8567faf7b139c0239bc2788ed8b1.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-04-17T09:27:58Z",
      "diff_hunk" : "@@ -509,12 +509,88 @@ class CDataStream\n     }\n };\n \n+template <typename IStream>\n+class BitStreamReader\n+{\n+private:\n+    IStream& m_istream;\n+    uint8_t m_buffer;\n+    int m_offset;\n \n+public:\n+    BitStreamReader(IStream& istream)\n+        : m_istream(istream), m_buffer(0), m_offset(8) {}\n \n+    /** Read the specified number of bits from the stream. The data is returned\n+     * in the nbits least signficant bits of a 64-bit uint.\n+     */\n+    uint64_t Read(int nbits) {\n+        if (nbits < 0 || nbits > 64) {\n+            throw std::out_of_range(\"nbits must be between 0 and 64\");\n+        }\n+\n+        uint64_t data = 0;\n+        while (nbits > 0) {\n+            if (m_offset == 8) {\n+                m_istream >> m_buffer;\n+                m_offset = 0;\n+            }\n \n+            int bits = std::min(8 - m_offset, nbits);\n+            data <<= bits;\n+            data |= static_cast<uint8_t>(m_buffer << m_offset) >> (8 - bits);\n+            m_offset += bits;\n+            nbits -= bits;\n+        }\n+        return data;\n+    }\n+};\n \n+template <typename OStream>\n+class BitStreamWriter",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r182009549",
      "id" : 182009549,
      "in_reply_to_id" : 178605236,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4MjAwOTU0OQ==",
      "original_commit_id" : "e6e320d600c70cf4d530b49f3e526cdb7e66be6d",
      "original_position" : 42,
      "path" : "src/streams.h",
      "position" : 129,
      "pull_request_review_id" : 112732372,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/182009549",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r182010116"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/182010116"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I originally tried something like that, but I preferred to make it an actual class. I see the ability to store derivable data in private fields and check data consistency before using the data as features of this approach.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-04-17T09:29:55Z",
      "diff_hunk" : "@@ -0,0 +1,62 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_BLOCKFILTER_H\n+#define BITCOIN_BLOCKFILTER_H\n+\n+#include <set>\n+#include <stdint.h>\n+#include <vector>\n+\n+#include <serialize.h>\n+#include <uint256.h>\n+\n+/**\n+ * This implements a Golomb-coded set as defined in BIP 158. It is a\n+ * compact, probabilistic data structure for testing set membership.\n+ */\n+class GCSFilter",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r182010116",
      "id" : 182010116,
      "in_reply_to_id" : 178627611,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4MjAxMDExNg==",
      "original_commit_id" : "15d529dfc2b65f2badaa520799187aff103af2b6",
      "original_position" : 19,
      "path" : "src/blockfilter.h",
      "position" : 21,
      "pull_request_review_id" : 112733105,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/182010116",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r182010184"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/182010184"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-04-17T09:30:10Z",
      "diff_hunk" : "@@ -0,0 +1,323 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <primitives/transaction.h>\n+#include <script/script.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)\n+{\n+    // Write quotient as unary-encoded: q 1's followed by one 0.\n+    uint64_t q = n >> k;\n+    while (q > 0) {\n+        int nbits = q <= 64 ? static_cast<int>(q) : 64;\n+        bitwriter.Write(~0ULL, nbits);\n+        q -= nbits;\n+    }\n+    bitwriter.Write(0, 1);\n+\n+    // Write the remainder in k bits. Since the remainder is just the bottom\n+    // k bits of n, there is no need to mask first.\n+    bitwriter.Write(n, k);\n+}\n+\n+template <typename IStream>\n+static uint64_t GolombRiceDecode(BitStreamReader<IStream>& bitreader, uint8_t k)\n+{\n+    // Read unary-encoded quotient: q 1's followed by one 0.\n+    uint64_t q = 0;\n+    while (bitreader.Read(1) == 1) {\n+        q++;\n+    }\n+\n+    uint64_t r = bitreader.Read(k);\n+\n+    return (q << k) + r;\n+}\n+\n+// Map a value x that is uniformly distributed in the range [0, 2^64) to a\n+// value uniformly distributed in [0, n) by returning the upper 64 bits of\n+// x * n.\n+//\n+// See: https://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/\n+static uint64_t MapIntoRange(uint64_t x, uint64_t n)\n+{\n+    // To perform the calculation on 64-bit numbers without losing the\n+    // result to overflow, split the numbers into the most significant and\n+    // least significant 32 bits and perform multiplication piece-wise.\n+    //\n+    // See: https://stackoverflow.com/a/26855440\n+    uint64_t x_hi = x >> 32;\n+    uint64_t x_lo = x & 0xFFFFFFFF;\n+    uint64_t n_hi = n >> 32;\n+    uint64_t n_lo = n & 0xFFFFFFFF;\n+\n+    uint64_t ac = x_hi * n_hi;\n+    uint64_t ad = x_hi * n_lo;\n+    uint64_t bc = x_lo * n_hi;\n+    uint64_t bd = x_lo * n_lo;\n+\n+    uint64_t mid34 = (bd >> 32) + (bc & 0xFFFFFFFF) + (ad & 0xFFFFFFFF);\n+    uint64_t upper64 = ac + (bc >> 32) + (ad >> 32) + (mid34 >> 32);\n+    return upper64;\n+}\n+\n+uint64_t GCSFilter::HashToRange(const Element& element) const\n+{\n+    uint64_t hash = CSipHasher(m_siphash_k0, m_siphash_k1)\n+        .Write(element.data(), element.size())\n+        .Finalize();\n+    return MapIntoRange(hash, m_F);\n+}\n+\n+std::vector<uint64_t> GCSFilter::BuildHashedSet(const std::set<Element>& elements) const\n+{\n+    std::vector<uint64_t> hashed_elements;\n+    hashed_elements.reserve(elements.size());\n+    for (const Element& element : elements) {\n+        hashed_elements.push_back(HashToRange(element));\n+    }\n+    std::sort(hashed_elements.begin(), hashed_elements.end());\n+    return hashed_elements;\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P)\n+    : m_siphash_k0(siphash_k0), m_siphash_k1(siphash_k1), m_P(P), m_N(0), m_F(0)\n+{\n+    if (m_P > 32) {\n+        throw std::invalid_argument(\"P must be <=32\");\n+    }\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P,\n+                     std::vector<unsigned char> encoded_filter)\n+    : GCSFilter(siphash_k0, siphash_k1, P)\n+{\n+    m_encoded = std::move(encoded_filter);\n+\n+    CVectorReader stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    m_N = ReadCompactSize(stream);\n+    m_F = m_N << m_P;\n+\n+    if (m_N >= (1ULL << 32)) {\n+        throw std::ios_base::failure(\"N must be <2^32\");\n+    }\n+\n+    // Verify that the encoded filter contains exactly N elements. If it has too much or too little\n+    // data, a std::ios_base::failure exception will be raised.\n+    BitStreamReader<CVectorReader> bitreader(stream);\n+    for (uint64_t i = 0; i < m_N; i++) {\n+        GolombRiceDecode(bitreader, m_P);\n+    }\n+    if (!stream.empty()) {\n+        throw std::ios_base::failure(\"encoded_filter contains excess data\");\n+    }\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P,\n+                     const std::set<GCSFilter::Element>& elements)\n+    : GCSFilter(siphash_k0, siphash_k1, P)\n+{\n+    if (elements.size() >= (1ULL << 32)) {\n+        throw std::invalid_argument(\"N must be <2^32\");\n+    }\n+\n+    m_N = elements.size();\n+    m_F = m_N << m_P;\n+\n+    CVectorWriter stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    WriteCompactSize(stream, m_N);\n+\n+    if (elements.empty()) {\n+        return;\n+    }\n+\n+    BitStreamWriter<CVectorWriter> bitwriter(stream);\n+\n+    uint64_t last_value = 0;\n+    for (uint64_t value : BuildHashedSet(elements)) {\n+        uint64_t delta = value - last_value;\n+        GolombRiceEncode(bitwriter, m_P, delta);\n+        last_value = value;\n+    }\n+\n+    bitwriter.Flush();\n+}\n+\n+bool GCSFilter::Match(const GCSFilter::Element& element) const\n+{\n+    uint64_t query = HashToRange(element);\n+\n+    CVectorReader stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    // Seek forward by size of N\n+    uint64_t N = ReadCompactSize(stream);\n+    assert(N == m_N);\n+\n+    BitStreamReader<CVectorReader> bitreader(stream);\n+\n+    uint64_t value = 0;\n+    for (uint64_t i = 0; i < m_N; i++) {\n+        uint64_t delta = GolombRiceDecode(bitreader, m_P);\n+        value += delta;\n+\n+        if (query == value) {\n+            return true;\n+        } else if (query < value) {\n+            break;\n+        }\n+    }\n+\n+    return false;\n+}\n+\n+bool GCSFilter::MatchAny(const std::set<Element>& elements) const\n+{\n+    const std::vector<uint64_t>&& queries = BuildHashedSet(elements);\n+\n+    CVectorReader stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    // Seek forward by size of N\n+    uint64_t N = ReadCompactSize(stream);\n+    assert(N == m_N);\n+\n+    BitStreamReader<CVectorReader> bitreader(stream);\n+\n+    uint64_t value = 0;\n+    auto query_it = queries.begin();\n+    for (uint64_t i = 0; i < m_N; i++) {\n+        uint64_t delta = GolombRiceDecode(bitreader, m_P);\n+        value += delta;\n+\n+        while (true) {\n+            if (query_it == queries.end()) {\n+                return false;\n+            } else if (*query_it == value) {\n+                return true;\n+            } else if (*query_it > value) {\n+                break;\n+            }\n+\n+            query_it++;\n+        }\n+    }\n+\n+    return false;\n+}\n+\n+static std::set<GCSFilter::Element> BasicFilterElements(const CBlock& block)\n+{\n+    std::set<GCSFilter::Element> elements;\n+    for (const CTransactionRef& tx : block.vtx) {\n+        // Include txid of each transaction.\n+        const uint256& txid = tx->GetHash();\n+        elements.emplace(txid.begin(), txid.end());\n+\n+        // Include previous outpoint of each input, except for coinbase.\n+        if (!tx->IsCoinBase()) {\n+            for (const CTxIn& txin : tx->vin) {\n+                std::vector<unsigned char> ser_outpoint;\n+                CVectorWriter(GCS_SER_TYPE, GCS_SER_VERSION, ser_outpoint, 0, txin.prevout);\n+                elements.insert(std::move(ser_outpoint));\n+            }\n+        }\n+\n+        // Include all data pushes in output scripts.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r182010184",
      "id" : 182010184,
      "in_reply_to_id" : 181930525,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4MjAxMDE4NA==",
      "original_commit_id" : "68777c59c91fdcdc2967a39b70d41f215c6846ca",
      "original_position" : 237,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 112733198,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/182010184",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187781309"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187781309"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Agree, it would be nice to align the two implementations.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-05-12T19:34:24Z",
      "diff_hunk" : "@@ -138,6 +138,80 @@ class CVectorWriter\n     size_t nPos;\n };\n \n+/* Minimal stream for reading from an existing vector by reference\n+ */\n+class CVectorReader",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187781309",
      "id" : 187781309,
      "in_reply_to_id" : 174886724,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4Nzc4MTMwOQ==",
      "original_commit_id" : "93f702b08e413c5c025b155bfb62b721d27939f5",
      "original_position" : 6,
      "path" : "src/streams.h",
      "position" : null,
      "pull_request_review_id" : 119634940,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187781309",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187781338"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187781338"
         }
      },
      "author_association" : "MEMBER",
      "body" : "An alternative (which could be done later, not a blocker for this PR) is using the `Span` class that was introduced in #12886 and is being extended in #13062).",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-05-12T19:36:10Z",
      "diff_hunk" : "@@ -138,6 +138,80 @@ class CVectorWriter\n     size_t nPos;\n };\n \n+/* Minimal stream for reading from an existing vector by reference\n+ */\n+class CVectorReader\n+{\n+private:\n+    const int nType;\n+    const int nVersion;\n+    const std::vector<unsigned char>& vchData;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187781338",
      "id" : 187781338,
      "in_reply_to_id" : 174888569,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4Nzc4MTMzOA==",
      "original_commit_id" : "93f702b08e413c5c025b155bfb62b721d27939f5",
      "original_position" : 11,
      "path" : "src/streams.h",
      "position" : null,
      "pull_request_review_id" : 119634940,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187781338",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187781729"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187781729"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"streams: Implement BitStreamReader/Writer classes.\", any reason to not make these operate with a 64-bit (or even larger) buffer? That would both simplify the code (no need to loop in the read/write operations) and possibly improve performance (due to fewer read/flush calls to the underlying buffer).",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-05-12T19:54:16Z",
      "diff_hunk" : "@@ -509,12 +509,102 @@ class CDataStream\n     }\n };\n \n+template <typename IStream>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187781729",
      "id" : 187781729,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4Nzc4MTcyOQ==",
      "original_commit_id" : "f7426bde309b35cb773935f7323f7546bcbb8c5b",
      "original_position" : 4,
      "path" : "src/streams.h",
      "position" : 85,
      "pull_request_review_id" : 119634940,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187781729",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187781753"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187781753"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't understand this comment either.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-05-12T19:55:57Z",
      "diff_hunk" : "@@ -0,0 +1,155 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187781753",
      "id" : 187781753,
      "in_reply_to_id" : 178629277,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4Nzc4MTc1Mw==",
      "original_commit_id" : "1b1d231ed77869174c33fde97efc65b0a0044ae0",
      "original_position" : 16,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 119634940,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187781753",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187781789"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187781789"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Perhaps add a note here to use `unsigned __int128` on supported platforms; that should be significantly faster than doing 4 separate multiplications.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-05-12T19:57:45Z",
      "diff_hunk" : "@@ -0,0 +1,155 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)\n+{\n+    // Write quotient as unary-encoded: q 1's followed by one 0.\n+    uint64_t q = n >> k;\n+    while (q > 0) {\n+        int nbits = q <= 64 ? static_cast<int>(q) : 64;\n+        bitwriter.Write(~0ULL, nbits);\n+        q -= nbits;\n+    }\n+    bitwriter.Write(0, 1);\n+\n+    // Write the remainder in k bits. Since the remainder is just the bottom\n+    // k bits of n, there is no need to mask first.\n+    bitwriter.Write(n, k);\n+}\n+\n+template <typename IStream>\n+static uint64_t GolombRiceDecode(BitStreamReader<IStream>& bitreader, uint8_t k)\n+{\n+    // Read unary-encoded quotient: q 1's followed by one 0.\n+    uint64_t q = 0;\n+    while (bitreader.Read(1) == 1) {\n+        q++;\n+    }\n+\n+    uint64_t r = bitreader.Read(k);\n+\n+    return (q << k) + r;\n+}\n+\n+// Map a value x that is uniformly distributed in the range [0, 2^64) to a\n+// value uniformly distributed in [0, n) by returning the upper 64 bits of\n+// x * n.\n+//\n+// See: https://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/\n+static uint64_t MapIntoRange(uint64_t x, uint64_t n)\n+{\n+    // To perform the calculation on 64-bit numbers without losing the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187781789",
      "id" : 187781789,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4Nzc4MTc4OQ==",
      "original_commit_id" : "c0815aa428d36d0ce0dc788e397e4e17066f708b",
      "original_position" : 53,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 119634940,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187781789",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187782008"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187782008"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think the reference type is useful here; copy elision should apply, and otherwise at worst a move will occur.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-05-12T20:07:54Z",
      "diff_hunk" : "@@ -153,3 +153,47 @@ GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P,\n \n     bitwriter.Flush();\n }\n+\n+bool GCSFilter::MatchInternal(const uint64_t* element_hashes, size_t size) const\n+{\n+    CVectorReader stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    // Seek forward by size of N\n+    uint64_t N = ReadCompactSize(stream);\n+    assert(N == m_N);\n+\n+    BitStreamReader<CVectorReader> bitreader(stream);\n+\n+    uint64_t value = 0;\n+    int hashes_index = 0;\n+    for (uint64_t i = 0; i < m_N; i++) {\n+        uint64_t delta = GolombRiceDecode(bitreader, m_P);\n+        value += delta;\n+\n+        while (true) {\n+            if (hashes_index == size) {\n+                return false;\n+            } else if (element_hashes[hashes_index] == value) {\n+                return true;\n+            } else if (element_hashes[hashes_index] > value) {\n+                break;\n+            }\n+\n+            hashes_index++;\n+        }\n+    }\n+\n+    return false;\n+}\n+\n+bool GCSFilter::Match(const GCSFilter::Element& element) const\n+{\n+    uint64_t query = HashToRange(element);\n+    return MatchInternal(&query, 1);\n+}\n+\n+bool GCSFilter::MatchAny(const std::set<Element>& elements) const\n+{\n+    const std::vector<uint64_t>&& queries = BuildHashedSet(elements);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187782008",
      "id" : 187782008,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4Nzc4MjAwOA==",
      "original_commit_id" : "a780779b3a8f8e7daf270b4f1355dbcaf31e56fd",
      "original_position" : 45,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 119634940,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187782008",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187782029"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187782029"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is this worth it? The filter will be decoded twice in practice due to this?",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-05-12T20:08:57Z",
      "diff_hunk" : "@@ -0,0 +1,155 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)\n+{\n+    // Write quotient as unary-encoded: q 1's followed by one 0.\n+    uint64_t q = n >> k;\n+    while (q > 0) {\n+        int nbits = q <= 64 ? static_cast<int>(q) : 64;\n+        bitwriter.Write(~0ULL, nbits);\n+        q -= nbits;\n+    }\n+    bitwriter.Write(0, 1);\n+\n+    // Write the remainder in k bits. Since the remainder is just the bottom\n+    // k bits of n, there is no need to mask first.\n+    bitwriter.Write(n, k);\n+}\n+\n+template <typename IStream>\n+static uint64_t GolombRiceDecode(BitStreamReader<IStream>& bitreader, uint8_t k)\n+{\n+    // Read unary-encoded quotient: q 1's followed by one 0.\n+    uint64_t q = 0;\n+    while (bitreader.Read(1) == 1) {\n+        q++;\n+    }\n+\n+    uint64_t r = bitreader.Read(k);\n+\n+    return (q << k) + r;\n+}\n+\n+// Map a value x that is uniformly distributed in the range [0, 2^64) to a\n+// value uniformly distributed in [0, n) by returning the upper 64 bits of\n+// x * n.\n+//\n+// See: https://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/\n+static uint64_t MapIntoRange(uint64_t x, uint64_t n)\n+{\n+    // To perform the calculation on 64-bit numbers without losing the\n+    // result to overflow, split the numbers into the most significant and\n+    // least significant 32 bits and perform multiplication piece-wise.\n+    //\n+    // See: https://stackoverflow.com/a/26855440\n+    uint64_t x_hi = x >> 32;\n+    uint64_t x_lo = x & 0xFFFFFFFF;\n+    uint64_t n_hi = n >> 32;\n+    uint64_t n_lo = n & 0xFFFFFFFF;\n+\n+    uint64_t ac = x_hi * n_hi;\n+    uint64_t ad = x_hi * n_lo;\n+    uint64_t bc = x_lo * n_hi;\n+    uint64_t bd = x_lo * n_lo;\n+\n+    uint64_t mid34 = (bd >> 32) + (bc & 0xFFFFFFFF) + (ad & 0xFFFFFFFF);\n+    uint64_t upper64 = ac + (bc >> 32) + (ad >> 32) + (mid34 >> 32);\n+    return upper64;\n+}\n+\n+uint64_t GCSFilter::HashToRange(const Element& element) const\n+{\n+    uint64_t hash = CSipHasher(m_siphash_k0, m_siphash_k1)\n+        .Write(element.data(), element.size())\n+        .Finalize();\n+    return MapIntoRange(hash, m_F);\n+}\n+\n+std::vector<uint64_t> GCSFilter::BuildHashedSet(const std::set<Element>& elements) const\n+{\n+    std::vector<uint64_t> hashed_elements;\n+    hashed_elements.reserve(elements.size());\n+    for (const Element& element : elements) {\n+        hashed_elements.push_back(HashToRange(element));\n+    }\n+    std::sort(hashed_elements.begin(), hashed_elements.end());\n+    return hashed_elements;\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P)\n+    : m_siphash_k0(siphash_k0), m_siphash_k1(siphash_k1), m_P(P), m_N(0), m_F(0)\n+{\n+    if (m_P > 32) {\n+        throw std::invalid_argument(\"P must be <=32\");\n+    }\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P,\n+                     std::vector<unsigned char> encoded_filter)\n+    : GCSFilter(siphash_k0, siphash_k1, P)\n+{\n+    m_encoded = std::move(encoded_filter);\n+\n+    CVectorReader stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    m_N = ReadCompactSize(stream);\n+    m_F = m_N << m_P;\n+\n+    if (m_N >= (1ULL << 32)) {\n+        throw std::ios_base::failure(\"N must be <2^32\");\n+    }\n+\n+    // Verify that the encoded filter contains exactly N elements. If it has too much or too little",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187782029",
      "id" : 187782029,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4Nzc4MjAyOQ==",
      "original_commit_id" : "c0815aa428d36d0ce0dc788e397e4e17066f708b",
      "original_position" : 115,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 119634940,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187782029",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187809813"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187809813"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Perhaps could improve performance, but it'd be trickier to handle streams that are not aligned on 8-byte boundaries. Since the buffer size is an implementation detail, would you be OK leaving that optimization for a later PR?",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-05-13T18:42:21Z",
      "diff_hunk" : "@@ -509,12 +509,102 @@ class CDataStream\n     }\n };\n \n+template <typename IStream>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187809813",
      "id" : 187809813,
      "in_reply_to_id" : 187781729,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4NzgwOTgxMw==",
      "original_commit_id" : "f7426bde309b35cb773935f7323f7546bcbb8c5b",
      "original_position" : 4,
      "path" : "src/streams.h",
      "position" : 85,
      "pull_request_review_id" : 119663169,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187809813",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187810229"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187810229"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'll drop it if people prefer. I think having the constructor check its input makes for a better API. I'd also note that Core won't actually use these match methods unless it implements a light client mode -- they are just here for completeness and testing.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-05-13T18:59:32Z",
      "diff_hunk" : "@@ -0,0 +1,155 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)\n+{\n+    // Write quotient as unary-encoded: q 1's followed by one 0.\n+    uint64_t q = n >> k;\n+    while (q > 0) {\n+        int nbits = q <= 64 ? static_cast<int>(q) : 64;\n+        bitwriter.Write(~0ULL, nbits);\n+        q -= nbits;\n+    }\n+    bitwriter.Write(0, 1);\n+\n+    // Write the remainder in k bits. Since the remainder is just the bottom\n+    // k bits of n, there is no need to mask first.\n+    bitwriter.Write(n, k);\n+}\n+\n+template <typename IStream>\n+static uint64_t GolombRiceDecode(BitStreamReader<IStream>& bitreader, uint8_t k)\n+{\n+    // Read unary-encoded quotient: q 1's followed by one 0.\n+    uint64_t q = 0;\n+    while (bitreader.Read(1) == 1) {\n+        q++;\n+    }\n+\n+    uint64_t r = bitreader.Read(k);\n+\n+    return (q << k) + r;\n+}\n+\n+// Map a value x that is uniformly distributed in the range [0, 2^64) to a\n+// value uniformly distributed in [0, n) by returning the upper 64 bits of\n+// x * n.\n+//\n+// See: https://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/\n+static uint64_t MapIntoRange(uint64_t x, uint64_t n)\n+{\n+    // To perform the calculation on 64-bit numbers without losing the\n+    // result to overflow, split the numbers into the most significant and\n+    // least significant 32 bits and perform multiplication piece-wise.\n+    //\n+    // See: https://stackoverflow.com/a/26855440\n+    uint64_t x_hi = x >> 32;\n+    uint64_t x_lo = x & 0xFFFFFFFF;\n+    uint64_t n_hi = n >> 32;\n+    uint64_t n_lo = n & 0xFFFFFFFF;\n+\n+    uint64_t ac = x_hi * n_hi;\n+    uint64_t ad = x_hi * n_lo;\n+    uint64_t bc = x_lo * n_hi;\n+    uint64_t bd = x_lo * n_lo;\n+\n+    uint64_t mid34 = (bd >> 32) + (bc & 0xFFFFFFFF) + (ad & 0xFFFFFFFF);\n+    uint64_t upper64 = ac + (bc >> 32) + (ad >> 32) + (mid34 >> 32);\n+    return upper64;\n+}\n+\n+uint64_t GCSFilter::HashToRange(const Element& element) const\n+{\n+    uint64_t hash = CSipHasher(m_siphash_k0, m_siphash_k1)\n+        .Write(element.data(), element.size())\n+        .Finalize();\n+    return MapIntoRange(hash, m_F);\n+}\n+\n+std::vector<uint64_t> GCSFilter::BuildHashedSet(const std::set<Element>& elements) const\n+{\n+    std::vector<uint64_t> hashed_elements;\n+    hashed_elements.reserve(elements.size());\n+    for (const Element& element : elements) {\n+        hashed_elements.push_back(HashToRange(element));\n+    }\n+    std::sort(hashed_elements.begin(), hashed_elements.end());\n+    return hashed_elements;\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P)\n+    : m_siphash_k0(siphash_k0), m_siphash_k1(siphash_k1), m_P(P), m_N(0), m_F(0)\n+{\n+    if (m_P > 32) {\n+        throw std::invalid_argument(\"P must be <=32\");\n+    }\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P,\n+                     std::vector<unsigned char> encoded_filter)\n+    : GCSFilter(siphash_k0, siphash_k1, P)\n+{\n+    m_encoded = std::move(encoded_filter);\n+\n+    CVectorReader stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    m_N = ReadCompactSize(stream);\n+    m_F = m_N << m_P;\n+\n+    if (m_N >= (1ULL << 32)) {\n+        throw std::ios_base::failure(\"N must be <2^32\");\n+    }\n+\n+    // Verify that the encoded filter contains exactly N elements. If it has too much or too little",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187810229",
      "id" : 187810229,
      "in_reply_to_id" : 187782029,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4NzgxMDIyOQ==",
      "original_commit_id" : "c0815aa428d36d0ce0dc788e397e4e17066f708b",
      "original_position" : 115,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 119663586,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187810229",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187810670"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187810670"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah, let's look at this later. It would complicate the reader indeed. For the writer I think it's pretty straightfoward.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-05-13T19:14:53Z",
      "diff_hunk" : "@@ -509,12 +509,102 @@ class CDataStream\n     }\n };\n \n+template <typename IStream>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187810670",
      "id" : 187810670,
      "in_reply_to_id" : 187781729,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4NzgxMDY3MA==",
      "original_commit_id" : "f7426bde309b35cb773935f7323f7546bcbb8c5b",
      "original_position" : 4,
      "path" : "src/streams.h",
      "position" : 85,
      "pull_request_review_id" : 119664021,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187810670",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187810728"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187810728"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I expect we'll start using it for rescanning pretty quickly, regardless of protocol implementations.\r\n\r\nDo you have any numbers for how fast it is to iterate through a 10000 element set or so?",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-05-13T19:16:51Z",
      "diff_hunk" : "@@ -0,0 +1,155 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)\n+{\n+    // Write quotient as unary-encoded: q 1's followed by one 0.\n+    uint64_t q = n >> k;\n+    while (q > 0) {\n+        int nbits = q <= 64 ? static_cast<int>(q) : 64;\n+        bitwriter.Write(~0ULL, nbits);\n+        q -= nbits;\n+    }\n+    bitwriter.Write(0, 1);\n+\n+    // Write the remainder in k bits. Since the remainder is just the bottom\n+    // k bits of n, there is no need to mask first.\n+    bitwriter.Write(n, k);\n+}\n+\n+template <typename IStream>\n+static uint64_t GolombRiceDecode(BitStreamReader<IStream>& bitreader, uint8_t k)\n+{\n+    // Read unary-encoded quotient: q 1's followed by one 0.\n+    uint64_t q = 0;\n+    while (bitreader.Read(1) == 1) {\n+        q++;\n+    }\n+\n+    uint64_t r = bitreader.Read(k);\n+\n+    return (q << k) + r;\n+}\n+\n+// Map a value x that is uniformly distributed in the range [0, 2^64) to a\n+// value uniformly distributed in [0, n) by returning the upper 64 bits of\n+// x * n.\n+//\n+// See: https://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/\n+static uint64_t MapIntoRange(uint64_t x, uint64_t n)\n+{\n+    // To perform the calculation on 64-bit numbers without losing the\n+    // result to overflow, split the numbers into the most significant and\n+    // least significant 32 bits and perform multiplication piece-wise.\n+    //\n+    // See: https://stackoverflow.com/a/26855440\n+    uint64_t x_hi = x >> 32;\n+    uint64_t x_lo = x & 0xFFFFFFFF;\n+    uint64_t n_hi = n >> 32;\n+    uint64_t n_lo = n & 0xFFFFFFFF;\n+\n+    uint64_t ac = x_hi * n_hi;\n+    uint64_t ad = x_hi * n_lo;\n+    uint64_t bc = x_lo * n_hi;\n+    uint64_t bd = x_lo * n_lo;\n+\n+    uint64_t mid34 = (bd >> 32) + (bc & 0xFFFFFFFF) + (ad & 0xFFFFFFFF);\n+    uint64_t upper64 = ac + (bc >> 32) + (ad >> 32) + (mid34 >> 32);\n+    return upper64;\n+}\n+\n+uint64_t GCSFilter::HashToRange(const Element& element) const\n+{\n+    uint64_t hash = CSipHasher(m_siphash_k0, m_siphash_k1)\n+        .Write(element.data(), element.size())\n+        .Finalize();\n+    return MapIntoRange(hash, m_F);\n+}\n+\n+std::vector<uint64_t> GCSFilter::BuildHashedSet(const std::set<Element>& elements) const\n+{\n+    std::vector<uint64_t> hashed_elements;\n+    hashed_elements.reserve(elements.size());\n+    for (const Element& element : elements) {\n+        hashed_elements.push_back(HashToRange(element));\n+    }\n+    std::sort(hashed_elements.begin(), hashed_elements.end());\n+    return hashed_elements;\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P)\n+    : m_siphash_k0(siphash_k0), m_siphash_k1(siphash_k1), m_P(P), m_N(0), m_F(0)\n+{\n+    if (m_P > 32) {\n+        throw std::invalid_argument(\"P must be <=32\");\n+    }\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P,\n+                     std::vector<unsigned char> encoded_filter)\n+    : GCSFilter(siphash_k0, siphash_k1, P)\n+{\n+    m_encoded = std::move(encoded_filter);\n+\n+    CVectorReader stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    m_N = ReadCompactSize(stream);\n+    m_F = m_N << m_P;\n+\n+    if (m_N >= (1ULL << 32)) {\n+        throw std::ios_base::failure(\"N must be <2^32\");\n+    }\n+\n+    // Verify that the encoded filter contains exactly N elements. If it has too much or too little",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187810728",
      "id" : 187810728,
      "in_reply_to_id" : 187782029,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4NzgxMDcyOA==",
      "original_commit_id" : "c0815aa428d36d0ce0dc788e397e4e17066f708b",
      "original_position" : 115,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 119664076,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187810728",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187839783"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187839783"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-05-14T05:35:31Z",
      "diff_hunk" : "@@ -138,6 +138,80 @@ class CVectorWriter\n     size_t nPos;\n };\n \n+/* Minimal stream for reading from an existing vector by reference\n+ */\n+class CVectorReader",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187839783",
      "id" : 187839783,
      "in_reply_to_id" : 174886724,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4NzgzOTc4Mw==",
      "original_commit_id" : "93f702b08e413c5c025b155bfb62b721d27939f5",
      "original_position" : 6,
      "path" : "src/streams.h",
      "position" : null,
      "pull_request_review_id" : 119697928,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187839783",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187839843"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187839843"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed in 07df98686ec423dcf38ac28ad8e325708cb5b902.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-05-14T05:36:20Z",
      "diff_hunk" : "@@ -0,0 +1,155 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)\n+{\n+    // Write quotient as unary-encoded: q 1's followed by one 0.\n+    uint64_t q = n >> k;\n+    while (q > 0) {\n+        int nbits = q <= 64 ? static_cast<int>(q) : 64;\n+        bitwriter.Write(~0ULL, nbits);\n+        q -= nbits;\n+    }\n+    bitwriter.Write(0, 1);\n+\n+    // Write the remainder in k bits. Since the remainder is just the bottom\n+    // k bits of n, there is no need to mask first.\n+    bitwriter.Write(n, k);\n+}\n+\n+template <typename IStream>\n+static uint64_t GolombRiceDecode(BitStreamReader<IStream>& bitreader, uint8_t k)\n+{\n+    // Read unary-encoded quotient: q 1's followed by one 0.\n+    uint64_t q = 0;\n+    while (bitreader.Read(1) == 1) {\n+        q++;\n+    }\n+\n+    uint64_t r = bitreader.Read(k);\n+\n+    return (q << k) + r;\n+}\n+\n+// Map a value x that is uniformly distributed in the range [0, 2^64) to a\n+// value uniformly distributed in [0, n) by returning the upper 64 bits of\n+// x * n.\n+//\n+// See: https://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/\n+static uint64_t MapIntoRange(uint64_t x, uint64_t n)\n+{\n+    // To perform the calculation on 64-bit numbers without losing the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187839843",
      "id" : 187839843,
      "in_reply_to_id" : 187781789,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4NzgzOTg0Mw==",
      "original_commit_id" : "c0815aa428d36d0ce0dc788e397e4e17066f708b",
      "original_position" : 53,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 119698018,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187839843",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187840056"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187840056"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Benchmarks added in f1b341a9262f24ff72b5961538f83ffbf532d8d9. Decoding a 10,000 element filter and matching against one missing element takes about 20us, and grows linearly in the number of elements (as expected).",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-05-14T05:38:00Z",
      "diff_hunk" : "@@ -0,0 +1,155 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)\n+{\n+    // Write quotient as unary-encoded: q 1's followed by one 0.\n+    uint64_t q = n >> k;\n+    while (q > 0) {\n+        int nbits = q <= 64 ? static_cast<int>(q) : 64;\n+        bitwriter.Write(~0ULL, nbits);\n+        q -= nbits;\n+    }\n+    bitwriter.Write(0, 1);\n+\n+    // Write the remainder in k bits. Since the remainder is just the bottom\n+    // k bits of n, there is no need to mask first.\n+    bitwriter.Write(n, k);\n+}\n+\n+template <typename IStream>\n+static uint64_t GolombRiceDecode(BitStreamReader<IStream>& bitreader, uint8_t k)\n+{\n+    // Read unary-encoded quotient: q 1's followed by one 0.\n+    uint64_t q = 0;\n+    while (bitreader.Read(1) == 1) {\n+        q++;\n+    }\n+\n+    uint64_t r = bitreader.Read(k);\n+\n+    return (q << k) + r;\n+}\n+\n+// Map a value x that is uniformly distributed in the range [0, 2^64) to a\n+// value uniformly distributed in [0, n) by returning the upper 64 bits of\n+// x * n.\n+//\n+// See: https://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/\n+static uint64_t MapIntoRange(uint64_t x, uint64_t n)\n+{\n+    // To perform the calculation on 64-bit numbers without losing the\n+    // result to overflow, split the numbers into the most significant and\n+    // least significant 32 bits and perform multiplication piece-wise.\n+    //\n+    // See: https://stackoverflow.com/a/26855440\n+    uint64_t x_hi = x >> 32;\n+    uint64_t x_lo = x & 0xFFFFFFFF;\n+    uint64_t n_hi = n >> 32;\n+    uint64_t n_lo = n & 0xFFFFFFFF;\n+\n+    uint64_t ac = x_hi * n_hi;\n+    uint64_t ad = x_hi * n_lo;\n+    uint64_t bc = x_lo * n_hi;\n+    uint64_t bd = x_lo * n_lo;\n+\n+    uint64_t mid34 = (bd >> 32) + (bc & 0xFFFFFFFF) + (ad & 0xFFFFFFFF);\n+    uint64_t upper64 = ac + (bc >> 32) + (ad >> 32) + (mid34 >> 32);\n+    return upper64;\n+}\n+\n+uint64_t GCSFilter::HashToRange(const Element& element) const\n+{\n+    uint64_t hash = CSipHasher(m_siphash_k0, m_siphash_k1)\n+        .Write(element.data(), element.size())\n+        .Finalize();\n+    return MapIntoRange(hash, m_F);\n+}\n+\n+std::vector<uint64_t> GCSFilter::BuildHashedSet(const std::set<Element>& elements) const\n+{\n+    std::vector<uint64_t> hashed_elements;\n+    hashed_elements.reserve(elements.size());\n+    for (const Element& element : elements) {\n+        hashed_elements.push_back(HashToRange(element));\n+    }\n+    std::sort(hashed_elements.begin(), hashed_elements.end());\n+    return hashed_elements;\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P)\n+    : m_siphash_k0(siphash_k0), m_siphash_k1(siphash_k1), m_P(P), m_N(0), m_F(0)\n+{\n+    if (m_P > 32) {\n+        throw std::invalid_argument(\"P must be <=32\");\n+    }\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P,\n+                     std::vector<unsigned char> encoded_filter)\n+    : GCSFilter(siphash_k0, siphash_k1, P)\n+{\n+    m_encoded = std::move(encoded_filter);\n+\n+    CVectorReader stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    m_N = ReadCompactSize(stream);\n+    m_F = m_N << m_P;\n+\n+    if (m_N >= (1ULL << 32)) {\n+        throw std::ios_base::failure(\"N must be <2^32\");\n+    }\n+\n+    // Verify that the encoded filter contains exactly N elements. If it has too much or too little",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187840056",
      "id" : 187840056,
      "in_reply_to_id" : 187782029,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4Nzg0MDA1Ng==",
      "original_commit_id" : "c0815aa428d36d0ce0dc788e397e4e17066f708b",
      "original_position" : 115,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 119698257,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187840056",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@sipa Thanks for the review. I agree on the extended filter -- I have dropped it from this PR. The code is in a new branch https://github.com/jimpo/bitcoin/tree/bip-158-extended in case it becomes useful in the future.",
      "created_at" : "2018-05-14T05:41:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-388702764",
      "id" : 388702764,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-05-14T05:41:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/388702764",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK f1b341a9262f24ff72b5961538f83ffbf532d8d9\r\nI think this is a good and sane start since this is not used yet. I wish there would be more test vectors.",
      "created_at" : "2018-05-14T06:19:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-388708714",
      "id" : 388708714,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-05-14T06:19:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/388708714",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187978111"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187978111"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "k should be checked < 64 to avoid right shift overflow, which could trigger a platform specific response. I know this is practically excluded with m_P <= 32, but if that is the safety net then there is also no need to check nbits <= 64 in bit stream read and write.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-05-14T14:39:32Z",
      "diff_hunk" : "@@ -0,0 +1,266 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <primitives/transaction.h>\n+#include <script/script.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187978111",
      "id" : 187978111,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4Nzk3ODExMQ==",
      "original_commit_id" : "f1b341a9262f24ff72b5961538f83ffbf532d8d9",
      "original_position" : 18,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 119864048,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187978111",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4289351?v=4",
         "events_url" : "https://api.github.com/users/tamasblummer/events{/privacy}",
         "followers_url" : "https://api.github.com/users/tamasblummer/followers",
         "following_url" : "https://api.github.com/users/tamasblummer/following{/other_user}",
         "gists_url" : "https://api.github.com/users/tamasblummer/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/tamasblummer",
         "id" : 4289351,
         "login" : "tamasblummer",
         "node_id" : "MDQ6VXNlcjQyODkzNTE=",
         "organizations_url" : "https://api.github.com/users/tamasblummer/orgs",
         "received_events_url" : "https://api.github.com/users/tamasblummer/received_events",
         "repos_url" : "https://api.github.com/users/tamasblummer/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/tamasblummer/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/tamasblummer/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/tamasblummer"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187978488"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187978488"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "same here with k < 64 to avoid shift left overflow",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-05-14T14:40:34Z",
      "diff_hunk" : "@@ -0,0 +1,266 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <primitives/transaction.h>\n+#include <script/script.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)\n+{\n+    // Write quotient as unary-encoded: q 1's followed by one 0.\n+    uint64_t q = n >> k;\n+    while (q > 0) {\n+        int nbits = q <= 64 ? static_cast<int>(q) : 64;\n+        bitwriter.Write(~0ULL, nbits);\n+        q -= nbits;\n+    }\n+    bitwriter.Write(0, 1);\n+\n+    // Write the remainder in k bits. Since the remainder is just the bottom\n+    // k bits of n, there is no need to mask first.\n+    bitwriter.Write(n, k);\n+}\n+\n+template <typename IStream>\n+static uint64_t GolombRiceDecode(BitStreamReader<IStream>& bitreader, uint8_t k)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187978488",
      "id" : 187978488,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4Nzk3ODQ4OA==",
      "original_commit_id" : "f1b341a9262f24ff72b5961538f83ffbf532d8d9",
      "original_position" : 35,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 119864543,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187978488",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4289351?v=4",
         "events_url" : "https://api.github.com/users/tamasblummer/events{/privacy}",
         "followers_url" : "https://api.github.com/users/tamasblummer/followers",
         "following_url" : "https://api.github.com/users/tamasblummer/following{/other_user}",
         "gists_url" : "https://api.github.com/users/tamasblummer/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/tamasblummer",
         "id" : 4289351,
         "login" : "tamasblummer",
         "node_id" : "MDQ6VXNlcjQyODkzNTE=",
         "organizations_url" : "https://api.github.com/users/tamasblummer/orgs",
         "received_events_url" : "https://api.github.com/users/tamasblummer/received_events",
         "repos_url" : "https://api.github.com/users/tamasblummer/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/tamasblummer/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/tamasblummer/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/tamasblummer"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187995873"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187995873"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm not sure this assertion would add much. The reason for the check in the BitStreamReader/Writer is because it is part of a public interface. This function (and decode) are static within this compilation unit and thus part of a private interface.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-05-14T15:26:05Z",
      "diff_hunk" : "@@ -0,0 +1,266 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <primitives/transaction.h>\n+#include <script/script.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r187995873",
      "id" : 187995873,
      "in_reply_to_id" : 187978111,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4Nzk5NTg3Mw==",
      "original_commit_id" : "f1b341a9262f24ff72b5961538f83ffbf532d8d9",
      "original_position" : 18,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 119885833,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187995873",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188012208"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188012208"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "thanks, that is fine then. I did not check the visibility.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-05-14T16:13:19Z",
      "diff_hunk" : "@@ -0,0 +1,266 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <primitives/transaction.h>\n+#include <script/script.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188012208",
      "id" : 188012208,
      "in_reply_to_id" : 187978111,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4ODAxMjIwOA==",
      "original_commit_id" : "f1b341a9262f24ff72b5961538f83ffbf532d8d9",
      "original_position" : 18,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 119906053,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188012208",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4289351?v=4",
         "events_url" : "https://api.github.com/users/tamasblummer/events{/privacy}",
         "followers_url" : "https://api.github.com/users/tamasblummer/followers",
         "following_url" : "https://api.github.com/users/tamasblummer/following{/other_user}",
         "gists_url" : "https://api.github.com/users/tamasblummer/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/tamasblummer",
         "id" : 4289351,
         "login" : "tamasblummer",
         "node_id" : "MDQ6VXNlcjQyODkzNTE=",
         "organizations_url" : "https://api.github.com/users/tamasblummer/orgs",
         "received_events_url" : "https://api.github.com/users/tamasblummer/received_events",
         "repos_url" : "https://api.github.com/users/tamasblummer/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/tamasblummer/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/tamasblummer/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/tamasblummer"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188021443"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188021443"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "shouldn't GolombRiceEncode and GolombRiceEncode  functions be rather members of GCSFilter since they always use its initialized m_P as k ?",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-05-14T16:43:48Z",
      "diff_hunk" : "@@ -0,0 +1,266 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <primitives/transaction.h>\n+#include <script/script.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188021443",
      "id" : 188021443,
      "in_reply_to_id" : 187978111,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4ODAyMTQ0Mw==",
      "original_commit_id" : "f1b341a9262f24ff72b5961538f83ffbf532d8d9",
      "original_position" : 18,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 119917244,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188021443",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4289351?v=4",
         "events_url" : "https://api.github.com/users/tamasblummer/events{/privacy}",
         "followers_url" : "https://api.github.com/users/tamasblummer/followers",
         "following_url" : "https://api.github.com/users/tamasblummer/following{/other_user}",
         "gists_url" : "https://api.github.com/users/tamasblummer/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/tamasblummer",
         "id" : 4289351,
         "login" : "tamasblummer",
         "node_id" : "MDQ6VXNlcjQyODkzNTE=",
         "organizations_url" : "https://api.github.com/users/tamasblummer/orgs",
         "received_events_url" : "https://api.github.com/users/tamasblummer/received_events",
         "repos_url" : "https://api.github.com/users/tamasblummer/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/tamasblummer/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/tamasblummer/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/tamasblummer"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188043478"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188043478"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "comments would not hurt here. P Golomb-Rice Parameter (2^P), N number of elements in set. F is derived from P and N, so it better would not be here at all. ",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-05-14T17:57:37Z",
      "diff_hunk" : "@@ -0,0 +1,140 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_BLOCKFILTER_H\n+#define BITCOIN_BLOCKFILTER_H\n+\n+#include <set>\n+#include <stdint.h>\n+#include <vector>\n+\n+#include <primitives/block.h>\n+#include <serialize.h>\n+#include <uint256.h>\n+\n+/**\n+ * This implements a Golomb-coded set as defined in BIP 158. It is a\n+ * compact, probabilistic data structure for testing set membership.\n+ */\n+class GCSFilter\n+{\n+public:\n+    typedef std::vector<unsigned char> Element;\n+\n+private:\n+    uint64_t m_siphash_k0;\n+    uint64_t m_siphash_k1;\n+    uint8_t m_P;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188043478",
      "id" : 188043478,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4ODA0MzQ3OA==",
      "original_commit_id" : "f1b341a9262f24ff72b5961538f83ffbf532d8d9",
      "original_position" : 28,
      "path" : "src/blockfilter.h",
      "position" : null,
      "pull_request_review_id" : 119943482,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188043478",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4289351?v=4",
         "events_url" : "https://api.github.com/users/tamasblummer/events{/privacy}",
         "followers_url" : "https://api.github.com/users/tamasblummer/followers",
         "following_url" : "https://api.github.com/users/tamasblummer/following{/other_user}",
         "gists_url" : "https://api.github.com/users/tamasblummer/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/tamasblummer",
         "id" : 4289351,
         "login" : "tamasblummer",
         "node_id" : "MDQ6VXNlcjQyODkzNTE=",
         "organizations_url" : "https://api.github.com/users/tamasblummer/orgs",
         "received_events_url" : "https://api.github.com/users/tamasblummer/received_events",
         "repos_url" : "https://api.github.com/users/tamasblummer/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/tamasblummer/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/tamasblummer/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/tamasblummer"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188053959"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188053959"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Agree with @jimpo, used IStream and OStream should be buffered implementations, not this specific algo. ",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-05-14T18:31:54Z",
      "diff_hunk" : "@@ -509,12 +509,102 @@ class CDataStream\n     }\n };\n \n+template <typename IStream>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188053959",
      "id" : 188053959,
      "in_reply_to_id" : 187781729,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4ODA1Mzk1OQ==",
      "original_commit_id" : "f7426bde309b35cb773935f7323f7546bcbb8c5b",
      "original_position" : 4,
      "path" : "src/streams.h",
      "position" : 85,
      "pull_request_review_id" : 119956120,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188053959",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4289351?v=4",
         "events_url" : "https://api.github.com/users/tamasblummer/events{/privacy}",
         "followers_url" : "https://api.github.com/users/tamasblummer/followers",
         "following_url" : "https://api.github.com/users/tamasblummer/following{/other_user}",
         "gists_url" : "https://api.github.com/users/tamasblummer/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/tamasblummer",
         "id" : 4289351,
         "login" : "tamasblummer",
         "node_id" : "MDQ6VXNlcjQyODkzNTE=",
         "organizations_url" : "https://api.github.com/users/tamasblummer/orgs",
         "received_events_url" : "https://api.github.com/users/tamasblummer/received_events",
         "repos_url" : "https://api.github.com/users/tamasblummer/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/tamasblummer/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/tamasblummer/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/tamasblummer"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Why match on the txid of each transaction? I can't imagine a use-case where you'd ever want that where you couldn't simply match by one (or multiple) of the output scripts for little additional cost.",
      "created_at" : "2018-05-14T19:54:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-388941774",
      "id" : 388941774,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-05-14T19:54:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/388941774",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188079506"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188079506"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I prefer they be standalone functions.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-05-14T20:02:07Z",
      "diff_hunk" : "@@ -0,0 +1,266 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <primitives/transaction.h>\n+#include <script/script.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188079506",
      "id" : 188079506,
      "in_reply_to_id" : 187978111,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4ODA3OTUwNg==",
      "original_commit_id" : "f1b341a9262f24ff72b5961538f83ffbf532d8d9",
      "original_position" : 18,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 119987435,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188079506",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@TheBlueMatt I can definitely think of use cases where one only has the txid. For example, if a lightning wallet wants to determine if a channel exists, it only gets the txid from the `channel_announcement`.\r\n\r\nI definitely think txids should be included in a filter, though I think there's a valid argument for putting them in their own filter given that a basic wallet does not need them.",
      "created_at" : "2018-05-14T20:07:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-388945360",
      "id" : 388945360,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-05-14T20:07:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/388945360",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Hmm? channel_announcement messages don't contain a txid, they contain a block number/tx index/txo index, which is obviously way more effecient than storing all the filters (which are pretty huge, in total), scanning all of them, and then downloading the corresponding block to verify the transaction is there (of course an SPV Proof is much more effecient in either case).\n\nOn May 14, 2018 8:07:17 PM UTC, Jim Posen <notifications@github.com> wrote:\n>@TheBlueMatt I can definitely think of use cases where one only has the\n>txid. For example, if a lightning wallet wants to determine if a\n>channel exists, it only gets the txid from the `channel_announcement`.\n>\n>I definitely think txids should be included in a filter, though I think\n>there's a valid argument for putting them in their own filter given\n>that a basic wallet does not need them.\n>\n>-- \n>You are receiving this because you were mentioned.\n>Reply to this email directly or view it on GitHub:\n>https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-388945360\n",
      "created_at" : "2018-05-14T20:12:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-388946819",
      "id" : 388946819,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-05-14T20:12:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/388946819",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "You're right, I forgot that channel_announcement uses the short ID instead of the channel ID.\r\n\r\nGiven that it would be a BIP change, I think the conversation about whether to remove TXID from the basic filter and move it to another filter (or drop entirely) is better had on the mailing list.",
      "created_at" : "2018-05-14T22:20:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-388981463",
      "id" : 388981463,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-05-14T22:20:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/388981463",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188208980"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188208980"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`size_t`?",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-05-15T08:48:09Z",
      "diff_hunk" : "@@ -138,6 +138,80 @@ class CVectorWriter\n     size_t nPos;\n };\n \n+/* Minimal stream for reading from an existing vector by reference\n+ */\n+class VectorReader\n+{\n+private:\n+    const int m_type;\n+    const int m_version;\n+    const std::vector<unsigned char>& m_data;\n+    size_t m_pos = 0;\n+\n+public:\n+\n+    /*\n+     * @param[in]  type Serialization Type\n+     * @param[in]  version Serialization Version (including any flags)\n+     * @param[in]  data Referenced byte vector to overwrite/append\n+     * @param[in]  pos Starting position. Vector index where reads should start.\n+     */\n+    VectorReader(int type, int version, const std::vector<unsigned char>& data, size_t pos)\n+        : m_type(type), m_version(version), m_data(data)\n+    {\n+        seek(pos);\n+    }\n+\n+    /*\n+     * (other params same as above)\n+     * @param[in]  args  A list of items to deserialize starting at pos.\n+     */\n+    template <typename... Args>\n+    VectorReader(int type, int version, const std::vector<unsigned char>& data, size_t pos,\n+                  Args&&... args)\n+        : VectorReader(type, version, data, pos)\n+    {\n+        ::UnserializeMany(*this, std::forward<Args>(args)...);\n+    }\n+\n+    template<typename T>\n+    VectorReader& operator>>(T& obj)\n+    {\n+        // Unserialize from this stream\n+        ::Unserialize(*this, obj);\n+        return (*this);\n+    }\n+\n+    int GetVersion() const { return m_version; }\n+    int GetType() const { return m_type; }\n+\n+    size_t size() const { return m_data.size() - m_pos; }\n+    bool empty() const { return m_data.size() == m_pos; }\n+\n+    void read(char* dst, size_t n)\n+    {\n+        if (n == 0) {\n+            return;\n+        }\n+\n+        // Read from the beginning of the buffer\n+        unsigned int pos_next = m_pos + n;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188208980",
      "id" : 188208980,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4ODIwODk4MA==",
      "original_commit_id" : "5a339f4118cc65a09d2321628e0db3102361c552",
      "original_position" : 61,
      "path" : "src/streams.h",
      "position" : null,
      "pull_request_review_id" : 120137580,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188208980",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188209476"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188209476"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Comment says signed, but it is unsigned.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-05-15T08:49:43Z",
      "diff_hunk" : "@@ -71,6 +71,51 @@ BOOST_AUTO_TEST_CASE(streams_vector_writer)\n     vch.clear();\n }\n \n+BOOST_AUTO_TEST_CASE(streams_vector_reader)\n+{\n+    std::vector<unsigned char> vch = {1, 255, 3, 4, 5, 6};\n+\n+    VectorReader reader(SER_NETWORK, INIT_PROTO_VERSION, vch, 0);\n+    BOOST_CHECK_EQUAL(reader.size(), 6);\n+    BOOST_CHECK(!reader.empty());\n+\n+    // Read a single byte as an unsigned char.\n+    unsigned char a;\n+    reader >> a;\n+    BOOST_CHECK_EQUAL(a, 1);\n+    BOOST_CHECK_EQUAL(reader.size(), 5);\n+    BOOST_CHECK(!reader.empty());\n+\n+    // Read a single byte as a signed char.\n+    char b;\n+    reader >> b;\n+    BOOST_CHECK_EQUAL(b, -1);\n+    BOOST_CHECK_EQUAL(reader.size(), 4);\n+    BOOST_CHECK(!reader.empty());\n+\n+    // Read a 4 bytes as a signed int.\n+    unsigned int c;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188209476",
      "id" : 188209476,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4ODIwOTQ3Ng==",
      "original_commit_id" : "7a77fc51df74916707b1a6c0ad8583c93de91824",
      "original_position" : 27,
      "path" : "src/test/streams_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 120137580,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188209476",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188209813"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188209813"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`d` is a `signed int`, comment says `unsigned int`.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-05-15T08:50:46Z",
      "diff_hunk" : "@@ -71,6 +71,51 @@ BOOST_AUTO_TEST_CASE(streams_vector_writer)\n     vch.clear();\n }\n \n+BOOST_AUTO_TEST_CASE(streams_vector_reader)\n+{\n+    std::vector<unsigned char> vch = {1, 255, 3, 4, 5, 6};\n+\n+    VectorReader reader(SER_NETWORK, INIT_PROTO_VERSION, vch, 0);\n+    BOOST_CHECK_EQUAL(reader.size(), 6);\n+    BOOST_CHECK(!reader.empty());\n+\n+    // Read a single byte as an unsigned char.\n+    unsigned char a;\n+    reader >> a;\n+    BOOST_CHECK_EQUAL(a, 1);\n+    BOOST_CHECK_EQUAL(reader.size(), 5);\n+    BOOST_CHECK(!reader.empty());\n+\n+    // Read a single byte as a signed char.\n+    char b;\n+    reader >> b;\n+    BOOST_CHECK_EQUAL(b, -1);\n+    BOOST_CHECK_EQUAL(reader.size(), 4);\n+    BOOST_CHECK(!reader.empty());\n+\n+    // Read a 4 bytes as a signed int.\n+    unsigned int c;\n+    reader >> c;\n+    BOOST_CHECK_EQUAL(c, 100992003); // 3,4,5,6 in little-endian base-256\n+    BOOST_CHECK_EQUAL(reader.size(), 0);\n+    BOOST_CHECK(reader.empty());\n+\n+    // Reading after end of byte vector throws an error.\n+    signed int d;\n+    BOOST_CHECK_THROW(reader >> d, std::ios_base::failure);\n+\n+    // Read a 4 bytes as an unsigned int from the beginning of the buffer.\n+    reader.seek(-6);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188209813",
      "id" : 188209813,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4ODIwOTgxMw==",
      "original_commit_id" : "7a77fc51df74916707b1a6c0ad8583c93de91824",
      "original_position" : 38,
      "path" : "src/test/streams_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 120137580,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188209813",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188211827"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188211827"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe also include a really high value (e.g. using all 64 bits). These are all single-byte values and will not test the looping part at all, I think?",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-05-15T08:56:59Z",
      "diff_hunk" : "@@ -116,6 +116,36 @@ BOOST_AUTO_TEST_CASE(streams_vector_reader)\n     BOOST_CHECK_THROW(reader >> d, std::ios_base::failure);\n }\n \n+BOOST_AUTO_TEST_CASE(bitstream_reader_writer)\n+{\n+    CDataStream data(SER_NETWORK, INIT_PROTO_VERSION);\n+\n+    BitStreamWriter<CDataStream> bit_writer(data);\n+    bit_writer.Write(0, 1);\n+    bit_writer.Write(2, 2);\n+    bit_writer.Write(6, 3);\n+    bit_writer.Write(11, 4);\n+    bit_writer.Write(1, 5);\n+    bit_writer.Write(32, 6);\n+    bit_writer.Write(7, 7);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188211827",
      "id" : 188211827,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4ODIxMTgyNw==",
      "original_commit_id" : "84ecb19ab6bf7d96c21c7100d49fad48fc1ac73d",
      "original_position" : 15,
      "path" : "src/test/streams_tests.cpp",
      "position" : 60,
      "pull_request_review_id" : 120137580,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188211827",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188218055"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188218055"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I recommend avoiding actual random values for unit tests, as generating random data is expensive and the tests may end up failing only sporadically, making it harder to debug (run the test 10 times and see the error once kinda thing).\r\n\r\nA simple approach is to use a random generator \"manually\" once to generate 200 random numbers as a big static vector. Another is to do e.g. `srand(12345);` once and then use `rand()`, but I'm not sure if that has downsides (or if it's slow, too).",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-05-15T09:16:31Z",
      "diff_hunk" : "@@ -0,0 +1,35 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <random.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+BOOST_AUTO_TEST_SUITE(blockfilter_tests)\n+\n+BOOST_AUTO_TEST_CASE(gcsfilter_test)\n+{\n+    std::set<GCSFilter::Element> included_elements, excluded_elements;\n+    for (int i = 0; i < 100; ++i) {\n+        GCSFilter::Element rand1(32);\n+        GetRandBytes(rand1.data(), rand1.size());\n+        included_elements.insert(std::move(rand1));\n+\n+        GCSFilter::Element rand2(32);\n+        GetRandBytes(rand2.data(), rand2.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188218055",
      "id" : 188218055,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4ODIxODA1NQ==",
      "original_commit_id" : "a10dc09b7f968b904b136ab09e8959d52f8229ff",
      "original_position" : 21,
      "path" : "src/test/blockfilter_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 120137580,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188218055",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188220185"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188220185"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe also check that `prevout(36e, 1)` is not a match while at it.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-05-15T09:23:57Z",
      "diff_hunk" : "@@ -32,4 +36,37 @@ BOOST_AUTO_TEST_CASE(gcsfilter_test)\n     }\n }\n \n+BOOST_AUTO_TEST_CASE(blockfilter_basic_test)\n+{\n+    CBlock block = getBlock13b8a();\n+    BlockFilter block_filter(BlockFilterType::BASIC, block);\n+    const GCSFilter& filter = block_filter.GetFilter();\n+\n+    // TXID of first non-coinbase tx in block.\n+    const uint256& txid = uint256S(\"f9fc751cb7dc372406a9f8d738d5e6f8f63bab71986a39cf36ee70ee17036d07\");\n+    GCSFilter::Element txid_element(txid.begin(), txid.end());\n+    BOOST_CHECK(filter.Match(txid_element));\n+\n+    // Outpoint spent by first non-coinbase tx in block.\n+    COutPoint prevout(uint256S(\"36e8f98c5f5733f88ca00dfa05afd7af5dc34dda802790daba6aa1afcb8c6096\"), 0);\n+    GCSFilter::Element prevout_element;\n+    CVectorWriter(SER_NETWORK, 0, prevout_element, 0, prevout);\n+    BOOST_CHECK(filter.Match(prevout_element));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188220185",
      "id" : 188220185,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4ODIyMDE4NQ==",
      "original_commit_id" : "d7f8d3838ae4a7a5043351d81791ded96903761f",
      "original_position" : 32,
      "path" : "src/test/blockfilter_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 120137580,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188220185",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188223873"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188223873"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Note use of `GetRandBytes` here as well. Potential inconsistency in test outcomes and potential slowdown.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-05-15T09:35:53Z",
      "diff_hunk" : "@@ -0,0 +1,42 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <random.h>\n+#include <blockfilter.h>\n+\n+static void ConstructGCSFilter(benchmark::State& state)\n+{\n+    std::set<GCSFilter::Element> elements;\n+    for (int i = 0; i < 10000; i++) {\n+        GCSFilter::Element element(32);\n+        GetRandBytes(element.data(), element.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188223873",
      "id" : 188223873,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4ODIyMzg3Mw==",
      "original_commit_id" : "f1b341a9262f24ff72b5961538f83ffbf532d8d9",
      "original_position" : 14,
      "path" : "src/bench/gcs_filter.cpp",
      "position" : null,
      "pull_request_review_id" : 120137580,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188223873",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188416389"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188416389"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good idea.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-05-15T19:56:32Z",
      "diff_hunk" : "@@ -32,4 +36,37 @@ BOOST_AUTO_TEST_CASE(gcsfilter_test)\n     }\n }\n \n+BOOST_AUTO_TEST_CASE(blockfilter_basic_test)\n+{\n+    CBlock block = getBlock13b8a();\n+    BlockFilter block_filter(BlockFilterType::BASIC, block);\n+    const GCSFilter& filter = block_filter.GetFilter();\n+\n+    // TXID of first non-coinbase tx in block.\n+    const uint256& txid = uint256S(\"f9fc751cb7dc372406a9f8d738d5e6f8f63bab71986a39cf36ee70ee17036d07\");\n+    GCSFilter::Element txid_element(txid.begin(), txid.end());\n+    BOOST_CHECK(filter.Match(txid_element));\n+\n+    // Outpoint spent by first non-coinbase tx in block.\n+    COutPoint prevout(uint256S(\"36e8f98c5f5733f88ca00dfa05afd7af5dc34dda802790daba6aa1afcb8c6096\"), 0);\n+    GCSFilter::Element prevout_element;\n+    CVectorWriter(SER_NETWORK, 0, prevout_element, 0, prevout);\n+    BOOST_CHECK(filter.Match(prevout_element));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188416389",
      "id" : 188416389,
      "in_reply_to_id" : 188220185,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4ODQxNjM4OQ==",
      "original_commit_id" : "d7f8d3838ae4a7a5043351d81791ded96903761f",
      "original_position" : 32,
      "path" : "src/test/blockfilter_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 120390684,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188416389",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188418596"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188418596"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It's testing the looping part insofar as some of the writes crossed byte boundaries, but I also added a write/read of a 2-byte value.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-05-15T20:04:03Z",
      "diff_hunk" : "@@ -116,6 +116,36 @@ BOOST_AUTO_TEST_CASE(streams_vector_reader)\n     BOOST_CHECK_THROW(reader >> d, std::ios_base::failure);\n }\n \n+BOOST_AUTO_TEST_CASE(bitstream_reader_writer)\n+{\n+    CDataStream data(SER_NETWORK, INIT_PROTO_VERSION);\n+\n+    BitStreamWriter<CDataStream> bit_writer(data);\n+    bit_writer.Write(0, 1);\n+    bit_writer.Write(2, 2);\n+    bit_writer.Write(6, 3);\n+    bit_writer.Write(11, 4);\n+    bit_writer.Write(1, 5);\n+    bit_writer.Write(32, 6);\n+    bit_writer.Write(7, 7);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188418596",
      "id" : 188418596,
      "in_reply_to_id" : 188211827,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4ODQxODU5Ng==",
      "original_commit_id" : "84ecb19ab6bf7d96c21c7100d49fad48fc1ac73d",
      "original_position" : 15,
      "path" : "src/test/streams_tests.cpp",
      "position" : 60,
      "pull_request_review_id" : 120393476,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188418596",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188418651"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188418651"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Removed the rand.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-05-15T20:04:17Z",
      "diff_hunk" : "@@ -0,0 +1,35 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <random.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+BOOST_AUTO_TEST_SUITE(blockfilter_tests)\n+\n+BOOST_AUTO_TEST_CASE(gcsfilter_test)\n+{\n+    std::set<GCSFilter::Element> included_elements, excluded_elements;\n+    for (int i = 0; i < 100; ++i) {\n+        GCSFilter::Element rand1(32);\n+        GetRandBytes(rand1.data(), rand1.size());\n+        included_elements.insert(std::move(rand1));\n+\n+        GCSFilter::Element rand2(32);\n+        GetRandBytes(rand2.data(), rand2.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r188418651",
      "id" : 188418651,
      "in_reply_to_id" : 188218055,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4ODQxODY1MQ==",
      "original_commit_id" : "a10dc09b7f968b904b136ab09e8959d52f8229ff",
      "original_position" : 21,
      "path" : "src/test/blockfilter_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 120393541,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188418651",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-utACK 669599d",
      "created_at" : "2018-05-16T01:01:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-389361376",
      "id" : 389361376,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-05-16T01:01:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/389361376",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Agree with @jimpo: dropping the txid filter check should be addresses via the BIP.",
      "created_at" : "2018-05-16T06:25:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-389408689",
      "id" : 389408689,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "updated_at" : "2018-05-16T06:25:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/389408689",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r202554741"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202554741"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: `++i` here and elsewhere - I think every non-test post-increment can be pre.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-07-15T21:13:28Z",
      "diff_hunk" : "@@ -0,0 +1,43 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <blockfilter.h>\n+\n+static void ConstructGCSFilter(benchmark::State& state)\n+{\n+    std::set<GCSFilter::Element> elements;\n+    for (int i = 0; i < 10000; i++) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r202554741",
      "id" : 202554741,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwMjU1NDc0MQ==",
      "original_commit_id" : "4fe143a623bbddf794bd29da1ece4b03809783f1",
      "original_position" : 11,
      "path" : "src/bench/gcs_filter.cpp",
      "position" : null,
      "pull_request_review_id" : 137278522,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202554741",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r202554798"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202554798"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: `static`?",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-07-15T21:15:47Z",
      "diff_hunk" : "@@ -0,0 +1,261 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <primitives/transaction.h>\n+#include <script/script.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r202554798",
      "id" : 202554798,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwMjU1NDc5OA==",
      "original_commit_id" : "4fe143a623bbddf794bd29da1ece4b03809783f1",
      "original_position" : 12,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 137278522,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202554798",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r202554802"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202554802"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: `static`?",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-07-15T21:16:01Z",
      "diff_hunk" : "@@ -0,0 +1,261 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <primitives/transaction.h>\n+#include <script/script.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r202554802",
      "id" : 202554802,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwMjU1NDgwMg==",
      "original_commit_id" : "4fe143a623bbddf794bd29da1ece4b03809783f1",
      "original_position" : 15,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 137278522,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202554802",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r202555191"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202555191"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: `explicit`?",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-07-15T21:30:56Z",
      "diff_hunk" : "@@ -435,12 +509,102 @@ class CDataStream\n     }\n };\n \n+template <typename IStream>\n+class BitStreamReader\n+{\n+private:\n+    IStream& m_istream;\n+\n+    /// Buffered byte read in from the input stream. A new byte is read into the\n+    /// buffer when m_offset reaches 8.\n+    uint8_t m_buffer{0};\n+\n+    /// Number of high order bits in m_buffer already returned by previous\n+    /// Read() calls. The next bit to be returned is at this offset from the\n+    /// most significant bit position.\n+    int m_offset{8};\n+\n+public:\n+    BitStreamReader(IStream& istream) : m_istream(istream) {}\n+\n+    uint64_t Read(int nbits) {\n+        if (nbits < 0 || nbits > 64) {\n+            throw std::out_of_range(\"nbits must be between 0 and 64\");\n+        }\n \n+        uint64_t data = 0;\n+        while (nbits > 0) {\n+            if (m_offset == 8) {\n+                m_istream >> m_buffer;\n+                m_offset = 0;\n+            }\n \n+            int bits = std::min(8 - m_offset, nbits);\n+            data <<= bits;\n+            data |= static_cast<uint8_t>(m_buffer << m_offset) >> (8 - bits);\n+            m_offset += bits;\n+            nbits -= bits;\n+        }\n+        return data;\n+    }\n+};\n \n+template <typename OStream>\n+class BitStreamWriter\n+{\n+private:\n+    OStream& m_ostream;\n \n+    /// Buffered byte waiting to be written to the output stream. The byte is\n+    /// written buffer when m_offset reaches 8 or Flush() is called.\n+    uint8_t m_buffer{0};\n \n+    /// Number of high order bits in m_buffer already written by previous\n+    /// Write() calls and not yet flushed to the stream. The next bit to be\n+    /// written to is at this offset from the most significant bit position.\n+    int m_offset{0};\n+\n+public:\n+    BitStreamWriter(OStream& ostream) : m_ostream(ostream) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r202555191",
      "id" : 202555191,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwMjU1NTE5MQ==",
      "original_commit_id" : "4fe143a623bbddf794bd29da1ece4b03809783f1",
      "original_position" : 141,
      "path" : "src/streams.h",
      "position" : null,
      "pull_request_review_id" : 137278522,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202555191",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r202555331"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202555331"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: could extract this as a method to share with `BlockFilter::BlockFilter`",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-07-15T21:35:28Z",
      "diff_hunk" : "@@ -0,0 +1,144 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_BLOCKFILTER_H\n+#define BITCOIN_BLOCKFILTER_H\n+\n+#include <set>\n+#include <stdint.h>\n+#include <vector>\n+\n+#include <primitives/block.h>\n+#include <serialize.h>\n+#include <uint256.h>\n+#include <undo.h>\n+\n+/**\n+ * This implements a Golomb-coded set as defined in BIP 158. It is a\n+ * compact, probabilistic data structure for testing set membership.\n+ */\n+class GCSFilter\n+{\n+public:\n+    typedef std::vector<unsigned char> Element;\n+\n+private:\n+    uint64_t m_siphash_k0;\n+    uint64_t m_siphash_k1;\n+    uint8_t m_P;  //!< Golomb-Rice coding parameter\n+    uint32_t m_M;  //!< Inverse false positive rate\n+    uint32_t m_N;  //!< Number of elements in the filter\n+    uint64_t m_F;  //!< Range of element hashes, F = N * M\n+    std::vector<unsigned char> m_encoded;\n+\n+    /** Hash a data element to an integer in the range [0, N * 2^P). */\n+    uint64_t HashToRange(const Element& element) const;\n+\n+    std::vector<uint64_t> BuildHashedSet(const std::set<Element>& elements) const;\n+\n+    /** Helper method used to implement Match and MatchAny */\n+    bool MatchInternal(const uint64_t* sorted_element_hashes, size_t size) const;\n+\n+public:\n+\n+    /** Constructs an empty filter. */\n+    GCSFilter(uint64_t siphash_k0 = 0, uint64_t siphash_k1 = 0, uint8_t P = 0, uint32_t M = 0);\n+\n+    /** Reconstructs an already-created filter from an encoding. */\n+    GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P, uint32_t M,\n+              std::vector<unsigned char> encoded_filter);\n+\n+    /** Builds a new filter from the params and set of elements. */\n+    GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P, uint32_t M,\n+              const std::set<Element>& elements);\n+\n+    uint8_t GetP() const { return m_P; }\n+    uint32_t GetN() const { return m_N; }\n+    uint32_t GetM() const { return m_M; }\n+    const std::vector<unsigned char>& GetEncoded() const { return m_encoded; }\n+\n+    /**\n+     * Checks if the element may be in the set. False positives are possible\n+     * with probability 1/M.\n+     */\n+    bool Match(const Element& element) const;\n+\n+    /**\n+     * Checks if any of the given elements may be in the set. False positives\n+     * are possible with probability 1/M per element checked. This is more\n+     * efficient that checking Match on multiple elements separately.\n+     */\n+    bool MatchAny(const std::set<Element>& elements) const;\n+};\n+\n+constexpr uint8_t BASIC_FILTER_P = 19;\n+constexpr uint32_t BASIC_FILTER_M = 784931;\n+\n+enum BlockFilterType : uint8_t\n+{\n+    BASIC = 0,\n+};\n+\n+/**\n+ * Complete block filter struct as defined in BIP 157. Serialization matches\n+ * payload of \"cfilter\" messages.\n+ */\n+class BlockFilter\n+{\n+private:\n+    BlockFilterType m_filter_type;\n+    uint256 m_block_hash;\n+    GCSFilter m_filter;\n+\n+public:\n+\n+    // Construct a new BlockFilter of the specified type from a block.\n+    BlockFilter(BlockFilterType filter_type, const CBlock& block, const CBlockUndo& block_undo);\n+\n+    BlockFilterType GetFilterType() const { return m_filter_type; }\n+\n+    const GCSFilter& GetFilter() const { return m_filter; }\n+\n+    const std::vector<unsigned char>& GetEncodedFilter() const\n+    {\n+        return m_filter.GetEncoded();\n+    }\n+\n+    // Compute the filter hash.\n+    uint256 GetHash() const;\n+\n+    // Compute the filter header given the previous one.\n+    uint256 ComputeHeader(const uint256& prev_header) const;\n+\n+    template <typename Stream>\n+    void Serialize(Stream& s) const {\n+        s << m_block_hash\n+          << static_cast<uint8_t>(m_filter_type)\n+          << m_filter.GetEncoded();\n+    }\n+\n+    template <typename Stream>\n+    void Unserialize(Stream& s) {\n+        std::vector<unsigned char> encoded_filter;\n+        uint8_t filter_type;\n+\n+        s >> m_block_hash\n+          >> filter_type\n+          >> encoded_filter;\n+\n+        m_filter_type = static_cast<BlockFilterType>(filter_type);\n+\n+        switch (m_filter_type) {\n+        case BlockFilterType::BASIC:\n+            m_filter = GCSFilter(m_block_hash.GetUint64(0), m_block_hash.GetUint64(1),\n+                                 BASIC_FILTER_P, BASIC_FILTER_M, std::move(encoded_filter));\n+            break;\n+\n+        default:\n+            throw std::ios_base::failure(\"unknown filter_type\");\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r202555331",
      "id" : 202555331,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwMjU1NTMzMQ==",
      "original_commit_id" : "4fe143a623bbddf794bd29da1ece4b03809783f1",
      "original_position" : 140,
      "path" : "src/blockfilter.h",
      "position" : 141,
      "pull_request_review_id" : 137278522,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202555331",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r202555497"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202555497"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: `/**` here and elsewhere in the class",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-07-15T21:41:10Z",
      "diff_hunk" : "@@ -138,6 +138,80 @@ class CVectorWriter\n     size_t nPos;\n };\n \n+/* Minimal stream for reading from an existing vector by reference",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r202555497",
      "id" : 202555497,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwMjU1NTQ5Nw==",
      "original_commit_id" : "4fe143a623bbddf794bd29da1ece4b03809783f1",
      "original_position" : 4,
      "path" : "src/streams.h",
      "position" : null,
      "pull_request_review_id" : 137278522,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202555497",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r202555770"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202555770"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is exposing this in b50195afc40188064d43efc71a9c4feab6667ec8 necessary? I don't see a call to it.\r\n\r\nChecked and this builds just the coins.h include from that commit.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-07-15T21:52:42Z",
      "diff_hunk" : "@@ -408,6 +409,8 @@ bool ReadBlockFromDisk(CBlock& block, const CBlockIndex* pindex, const Consensus\n bool ReadRawBlockFromDisk(std::vector<uint8_t>& block, const CDiskBlockPos& pos, const CMessageHeader::MessageStartChars& message_start);\n bool ReadRawBlockFromDisk(std::vector<uint8_t>& block, const CBlockIndex* pindex, const CMessageHeader::MessageStartChars& message_start);\n \n+bool UndoReadFromDisk(CBlockUndo& blockundo, const CBlockIndex *pindex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r202555770",
      "id" : 202555770,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwMjU1NTc3MA==",
      "original_commit_id" : "4fe143a623bbddf794bd29da1ece4b03809783f1",
      "original_position" : 12,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 137278522,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202555770",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r202758020"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202758020"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This uses a different form of the constructor from `BlockFilter::BlockFilter`. Could extract to a templated method, but I don't think that's worth it.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-07-16T17:06:22Z",
      "diff_hunk" : "@@ -0,0 +1,144 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_BLOCKFILTER_H\n+#define BITCOIN_BLOCKFILTER_H\n+\n+#include <set>\n+#include <stdint.h>\n+#include <vector>\n+\n+#include <primitives/block.h>\n+#include <serialize.h>\n+#include <uint256.h>\n+#include <undo.h>\n+\n+/**\n+ * This implements a Golomb-coded set as defined in BIP 158. It is a\n+ * compact, probabilistic data structure for testing set membership.\n+ */\n+class GCSFilter\n+{\n+public:\n+    typedef std::vector<unsigned char> Element;\n+\n+private:\n+    uint64_t m_siphash_k0;\n+    uint64_t m_siphash_k1;\n+    uint8_t m_P;  //!< Golomb-Rice coding parameter\n+    uint32_t m_M;  //!< Inverse false positive rate\n+    uint32_t m_N;  //!< Number of elements in the filter\n+    uint64_t m_F;  //!< Range of element hashes, F = N * M\n+    std::vector<unsigned char> m_encoded;\n+\n+    /** Hash a data element to an integer in the range [0, N * 2^P). */\n+    uint64_t HashToRange(const Element& element) const;\n+\n+    std::vector<uint64_t> BuildHashedSet(const std::set<Element>& elements) const;\n+\n+    /** Helper method used to implement Match and MatchAny */\n+    bool MatchInternal(const uint64_t* sorted_element_hashes, size_t size) const;\n+\n+public:\n+\n+    /** Constructs an empty filter. */\n+    GCSFilter(uint64_t siphash_k0 = 0, uint64_t siphash_k1 = 0, uint8_t P = 0, uint32_t M = 0);\n+\n+    /** Reconstructs an already-created filter from an encoding. */\n+    GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P, uint32_t M,\n+              std::vector<unsigned char> encoded_filter);\n+\n+    /** Builds a new filter from the params and set of elements. */\n+    GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P, uint32_t M,\n+              const std::set<Element>& elements);\n+\n+    uint8_t GetP() const { return m_P; }\n+    uint32_t GetN() const { return m_N; }\n+    uint32_t GetM() const { return m_M; }\n+    const std::vector<unsigned char>& GetEncoded() const { return m_encoded; }\n+\n+    /**\n+     * Checks if the element may be in the set. False positives are possible\n+     * with probability 1/M.\n+     */\n+    bool Match(const Element& element) const;\n+\n+    /**\n+     * Checks if any of the given elements may be in the set. False positives\n+     * are possible with probability 1/M per element checked. This is more\n+     * efficient that checking Match on multiple elements separately.\n+     */\n+    bool MatchAny(const std::set<Element>& elements) const;\n+};\n+\n+constexpr uint8_t BASIC_FILTER_P = 19;\n+constexpr uint32_t BASIC_FILTER_M = 784931;\n+\n+enum BlockFilterType : uint8_t\n+{\n+    BASIC = 0,\n+};\n+\n+/**\n+ * Complete block filter struct as defined in BIP 157. Serialization matches\n+ * payload of \"cfilter\" messages.\n+ */\n+class BlockFilter\n+{\n+private:\n+    BlockFilterType m_filter_type;\n+    uint256 m_block_hash;\n+    GCSFilter m_filter;\n+\n+public:\n+\n+    // Construct a new BlockFilter of the specified type from a block.\n+    BlockFilter(BlockFilterType filter_type, const CBlock& block, const CBlockUndo& block_undo);\n+\n+    BlockFilterType GetFilterType() const { return m_filter_type; }\n+\n+    const GCSFilter& GetFilter() const { return m_filter; }\n+\n+    const std::vector<unsigned char>& GetEncodedFilter() const\n+    {\n+        return m_filter.GetEncoded();\n+    }\n+\n+    // Compute the filter hash.\n+    uint256 GetHash() const;\n+\n+    // Compute the filter header given the previous one.\n+    uint256 ComputeHeader(const uint256& prev_header) const;\n+\n+    template <typename Stream>\n+    void Serialize(Stream& s) const {\n+        s << m_block_hash\n+          << static_cast<uint8_t>(m_filter_type)\n+          << m_filter.GetEncoded();\n+    }\n+\n+    template <typename Stream>\n+    void Unserialize(Stream& s) {\n+        std::vector<unsigned char> encoded_filter;\n+        uint8_t filter_type;\n+\n+        s >> m_block_hash\n+          >> filter_type\n+          >> encoded_filter;\n+\n+        m_filter_type = static_cast<BlockFilterType>(filter_type);\n+\n+        switch (m_filter_type) {\n+        case BlockFilterType::BASIC:\n+            m_filter = GCSFilter(m_block_hash.GetUint64(0), m_block_hash.GetUint64(1),\n+                                 BASIC_FILTER_P, BASIC_FILTER_M, std::move(encoded_filter));\n+            break;\n+\n+        default:\n+            throw std::ios_base::failure(\"unknown filter_type\");\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r202758020",
      "id" : 202758020,
      "in_reply_to_id" : 202555331,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwMjc1ODAyMA==",
      "original_commit_id" : "4fe143a623bbddf794bd29da1ece4b03809783f1",
      "original_position" : 140,
      "path" : "src/blockfilter.h",
      "position" : 141,
      "pull_request_review_id" : 137518178,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202758020",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r202893314"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202893314"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Removed that commit.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-07-17T04:48:26Z",
      "diff_hunk" : "@@ -408,6 +409,8 @@ bool ReadBlockFromDisk(CBlock& block, const CBlockIndex* pindex, const Consensus\n bool ReadRawBlockFromDisk(std::vector<uint8_t>& block, const CDiskBlockPos& pos, const CMessageHeader::MessageStartChars& message_start);\n bool ReadRawBlockFromDisk(std::vector<uint8_t>& block, const CBlockIndex* pindex, const CMessageHeader::MessageStartChars& message_start);\n \n+bool UndoReadFromDisk(CBlockUndo& blockundo, const CBlockIndex *pindex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r202893314",
      "id" : 202893314,
      "in_reply_to_id" : 202555770,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwMjg5MzMxNA==",
      "original_commit_id" : "4fe143a623bbddf794bd29da1ece4b03809783f1",
      "original_position" : 12,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 137675113,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/202893314",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r203002692"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/203002692"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm curious what triggered this request. I may be reading the wrong places, but e.g. https://stackoverflow.com/questions/45987571/difference-between-constexpr-and-static-constexpr-global-variable indicates static does nothing at all here.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-07-17T12:35:57Z",
      "diff_hunk" : "@@ -0,0 +1,261 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <primitives/transaction.h>\n+#include <script/script.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r203002692",
      "id" : 203002692,
      "in_reply_to_id" : 202554798,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwMzAwMjY5Mg==",
      "original_commit_id" : "4fe143a623bbddf794bd29da1ece4b03809783f1",
      "original_position" : 12,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 137805430,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/203002692",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r203040263"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/203040263"
         }
      },
      "author_association" : "MEMBER",
      "body" : "My thought was to make these explicitly translation-unit local, to communicate that to the reader and to enforce that from the linker. Here's what cppreference says about what gets internal linkage:\r\n\r\n> internal linkage. The name can be referred to from all scopes in the current translation unit.\r\n> Any of the following names declared at namespace scope have internal linkage:\r\n> * variables, functions, or function templates declared static;\r\n> * non-volatile non-inline (since C++17) const-qualified variables (including constexpr) that aren't declared extern and aren't previously declared to have external linkage;\r\n> * data members of anonymous unions.\r\n\r\nhttps://en.cppreference.com/w/cpp/language/storage_duration#Linkage\r\n\r\nWorth noting that non-static constexpr variables can be declared extern in other contexts and rendered external linkage, while static variables can not be.\r\n\r\nUnnamed namespaces are another way to enforce this:\r\n> Even though names in an unnamed namespace may be declared with external linkage, they are never accessible from other translation units because their namespace name is unique.\r\nhttps://en.cppreference.com/w/cpp/language/namespace#Unnamed_namespaces",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-07-17T14:18:32Z",
      "diff_hunk" : "@@ -0,0 +1,261 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <primitives/transaction.h>\n+#include <script/script.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r203040263",
      "id" : 203040263,
      "in_reply_to_id" : 202554798,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwMzA0MDI2Mw==",
      "original_commit_id" : "4fe143a623bbddf794bd29da1ece4b03809783f1",
      "original_position" : 12,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 137850985,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/203040263",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r203078822"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/203078822"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "@kallewoof Interesting. I looked it up too and came across this: https://stackoverflow.com/a/13867690.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-07-17T15:54:04Z",
      "diff_hunk" : "@@ -0,0 +1,261 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <primitives/transaction.h>\n+#include <script/script.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r203078822",
      "id" : 203078822,
      "in_reply_to_id" : 202554798,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwMzA3ODgyMg==",
      "original_commit_id" : "4fe143a623bbddf794bd29da1ece4b03809783f1",
      "original_position" : 12,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 137898822,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/203078822",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r203627166"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/203627166"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@jimpo Yeah I read that one too, but the last paragraph was what made me unsure in the end whether it was good or bad\r\n\r\n> However, there is one case where you wouldn't want to use static constexper. Unless a constexpr declared object is either ODR-used or declared static, the compiler is free to not include it at all. That's pretty useful, because it allows the use of compile-time temporary constexpr arrays without polluting the compiled program with unnecessary bytes. In that case, you would clearly not want to use static, since static is likely to force the object to exist at runtime.\r\n\r\nI honestly can't tell if this applies here or not without thinking about it more.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-07-19T07:34:40Z",
      "diff_hunk" : "@@ -0,0 +1,261 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <primitives/transaction.h>\n+#include <script/script.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r203627166",
      "id" : 203627166,
      "in_reply_to_id" : 202554798,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwMzYyNzE2Ng==",
      "original_commit_id" : "4fe143a623bbddf794bd29da1ece4b03809783f1",
      "original_position" : 12,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 138552301,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/203627166",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r204219029"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/204219029"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This doesn't seem to work for me (x86_64 linux, GCC 7.3.0), verified by looking at the disassembled code.\r\n\r\nInterestingly, there is hardly any impact on the benchmarks when I modify the code to use force using 128-bit multiplication - suggesting that most of the time is spent elsewhere (hashing, bit operations?).",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-07-21T19:10:46Z",
      "diff_hunk" : "@@ -52,6 +52,9 @@ static uint64_t GolombRiceDecode(BitStreamReader<IStream>& bitreader, uint8_t k)\n // See: https://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/\n static uint64_t MapIntoRange(uint64_t x, uint64_t n)\n {\n+#ifdef __SIZE_INT128__",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r204219029",
      "id" : 204219029,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwNDIxOTAyOQ==",
      "original_commit_id" : "ad2d7c93a26767e948770f56b39b93c8116dbd21",
      "original_position" : 4,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 139266569,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/204219029",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r204234846"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/204234846"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Oops, that's a typo. It should be `__SIZEOF_INT128__`. Will fix.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-07-22T10:12:36Z",
      "diff_hunk" : "@@ -52,6 +52,9 @@ static uint64_t GolombRiceDecode(BitStreamReader<IStream>& bitreader, uint8_t k)\n // See: https://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/\n static uint64_t MapIntoRange(uint64_t x, uint64_t n)\n {\n+#ifdef __SIZE_INT128__",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r204234846",
      "id" : 204234846,
      "in_reply_to_id" : 204219029,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwNDIzNDg0Ng==",
      "original_commit_id" : "ad2d7c93a26767e948770f56b39b93c8116dbd21",
      "original_position" : 4,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 139282220,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/204234846",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r204287501"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/204287501"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yup, that works.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-07-23T05:50:41Z",
      "diff_hunk" : "@@ -52,6 +52,9 @@ static uint64_t GolombRiceDecode(BitStreamReader<IStream>& bitreader, uint8_t k)\n // See: https://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/\n static uint64_t MapIntoRange(uint64_t x, uint64_t n)\n {\n+#ifdef __SIZE_INT128__",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r204287501",
      "id" : 204287501,
      "in_reply_to_id" : 204219029,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwNDI4NzUwMQ==",
      "original_commit_id" : "ad2d7c93a26767e948770f56b39b93c8116dbd21",
      "original_position" : 4,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 139338555,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/204287501",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r204288229"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/204288229"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: should be `[0, N * M)` or `[0, F)`, I think.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-07-23T05:56:44Z",
      "diff_hunk" : "@@ -0,0 +1,144 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_BLOCKFILTER_H\n+#define BITCOIN_BLOCKFILTER_H\n+\n+#include <set>\n+#include <stdint.h>\n+#include <vector>\n+\n+#include <primitives/block.h>\n+#include <serialize.h>\n+#include <uint256.h>\n+#include <undo.h>\n+\n+/**\n+ * This implements a Golomb-coded set as defined in BIP 158. It is a\n+ * compact, probabilistic data structure for testing set membership.\n+ */\n+class GCSFilter\n+{\n+public:\n+    typedef std::vector<unsigned char> Element;\n+\n+private:\n+    uint64_t m_siphash_k0;\n+    uint64_t m_siphash_k1;\n+    uint8_t m_P;  //!< Golomb-Rice coding parameter\n+    uint32_t m_M;  //!< Inverse false positive rate\n+    uint32_t m_N;  //!< Number of elements in the filter\n+    uint64_t m_F;  //!< Range of element hashes, F = N * M\n+    std::vector<unsigned char> m_encoded;\n+\n+    /** Hash a data element to an integer in the range [0, N * 2^P). */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r204288229",
      "id" : 204288229,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIwNDI4ODIyOQ==",
      "original_commit_id" : "fcbba910125dcb98814b0c58f4611bf60280a000",
      "original_position" : 35,
      "path" : "src/blockfilter.h",
      "position" : null,
      "pull_request_review_id" : 139339449,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/204288229",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK",
      "created_at" : "2018-07-30T19:30:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-408982346",
      "id" : 408982346,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwODk4MjM0Ng==",
      "updated_at" : "2018-07-30T19:30:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/408982346",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r210287583"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/210287583"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Re: https://github.com/bitcoin/bitcoin/pull/12254#discussion_r174888569\r\n\r\nI think it would be good to change VectorReader to SpanReader now that Span exists. It would be a simple change, and better describe what this class does, and make it more reusable.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-08-15T14:30:37Z",
      "diff_hunk" : "@@ -138,6 +138,80 @@ class CVectorWriter\n     size_t nPos;\n };\n \n+/* Minimal stream for reading from an existing vector by reference\n+ */\n+class CVectorReader\n+{\n+private:\n+    const int nType;\n+    const int nVersion;\n+    const std::vector<unsigned char>& vchData;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r210287583",
      "id" : 210287583,
      "in_reply_to_id" : 174888569,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMDI4NzU4Mw==",
      "original_commit_id" : "93f702b08e413c5c025b155bfb62b721d27939f5",
      "original_position" : 11,
      "path" : "src/streams.h",
      "position" : null,
      "pull_request_review_id" : 146469075,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/210287583",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r210954376"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/210954376"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"streams: Implement BitStreamReader/Writer classes.\" (faaa4b8432d194acb26ffcac07c379444da327ac)\r\n\r\nThere was previously a comment here (in e6e320d600c70cf4d530b49f3e526cdb7e66be6d). Was it dropped inadvertently?\r\n\r\n```c++\r\n    /** Read the specified number of bits from the stream. The data is returned\r\n     * in the nbits least signficant bits of a 64-bit uint.\r\n     */\r\n```",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-08-17T15:51:26Z",
      "diff_hunk" : "@@ -509,12 +509,102 @@ class CDataStream\n     }\n };\n \n+template <typename IStream>\n+class BitStreamReader\n+{\n+private:\n+    IStream& m_istream;\n \n+    /// Buffered byte read in from the input stream. A new byte is read into the\n+    /// buffer when m_offset reaches 8.\n+    uint8_t m_buffer{0};\n \n+    /// Number of high order bits in m_buffer already returned by previous\n+    /// Read() calls. The next bit to be returned is at this offset from the\n+    /// most significant bit position.\n+    int m_offset{8};\n \n+public:\n+    explicit BitStreamReader(IStream& istream) : m_istream(istream) {}\n \n+    uint64_t Read(int nbits) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r210954376",
      "id" : 210954376,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMDk1NDM3Ng==",
      "original_commit_id" : "faaa4b8432d194acb26ffcac07c379444da327ac",
      "original_position" : 22,
      "path" : "src/streams.h",
      "position" : null,
      "pull_request_review_id" : 147283037,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/210954376",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r210970797"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/210970797"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "RE: https://github.com/bitcoin/bitcoin/pull/12254#discussion_r178629277\r\n\r\n> I don't understand this comment either.\r\n\r\nThe comment was just attached in the wrong place. In 15d529dfc2b65f2badaa520799187aff103af2b6 `m_N` was `uint64_t` (fixed now).",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-08-17T16:55:12Z",
      "diff_hunk" : "@@ -0,0 +1,155 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r210970797",
      "id" : 210970797,
      "in_reply_to_id" : 178629277,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMDk3MDc5Nw==",
      "original_commit_id" : "1b1d231ed77869174c33fde97efc65b0a0044ae0",
      "original_position" : 16,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 147283037,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/210970797",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r210974078"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/210974078"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"streams: Unit test for VectorReader class.\" (bdb34199345ad2c6f98da5d3f303d0993f6c722c)\r\n\r\nShould probably say `signed char` explicitly, since plain `char` isn't necessarily signed.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-08-17T17:08:53Z",
      "diff_hunk" : "@@ -68,6 +68,51 @@ BOOST_AUTO_TEST_CASE(streams_vector_writer)\n     vch.clear();\n }\n \n+BOOST_AUTO_TEST_CASE(streams_vector_reader)\n+{\n+    std::vector<unsigned char> vch = {1, 255, 3, 4, 5, 6};\n+\n+    VectorReader reader(SER_NETWORK, INIT_PROTO_VERSION, vch, 0);\n+    BOOST_CHECK_EQUAL(reader.size(), 6);\n+    BOOST_CHECK(!reader.empty());\n+\n+    // Read a single byte as an unsigned char.\n+    unsigned char a;\n+    reader >> a;\n+    BOOST_CHECK_EQUAL(a, 1);\n+    BOOST_CHECK_EQUAL(reader.size(), 5);\n+    BOOST_CHECK(!reader.empty());\n+\n+    // Read a single byte as a signed char.\n+    char b;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r210974078",
      "id" : 210974078,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMDk3NDA3OA==",
      "original_commit_id" : "bdb34199345ad2c6f98da5d3f303d0993f6c722c",
      "original_position" : 20,
      "path" : "src/test/streams_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 147307772,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/210974078",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r210976725"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/210976725"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"streams: Unit tests for BitStreamReader and BitStreamWriter.\" (e15e553b746e64f0eeda420e4c10eccfc747d69f)\r\n\r\nMight be good to have additional `BOOST_CHECK(data.empty())` and `BOOST_CHECK(data_copy.empty())` checks to make sure reads & writes are still aligned if somebody modifies the test.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-08-17T17:19:25Z",
      "diff_hunk" : "@@ -113,6 +113,41 @@ BOOST_AUTO_TEST_CASE(streams_vector_reader)\n     BOOST_CHECK_THROW(reader >> d, std::ios_base::failure);\n }\n \n+BOOST_AUTO_TEST_CASE(bitstream_reader_writer)\n+{\n+    CDataStream data(SER_NETWORK, INIT_PROTO_VERSION);\n+\n+    BitStreamWriter<CDataStream> bit_writer(data);\n+    bit_writer.Write(0, 1);\n+    bit_writer.Write(2, 2);\n+    bit_writer.Write(6, 3);\n+    bit_writer.Write(11, 4);\n+    bit_writer.Write(1, 5);\n+    bit_writer.Write(32, 6);\n+    bit_writer.Write(7, 7);\n+    bit_writer.Write(30497, 16);\n+    bit_writer.Flush();\n+\n+    CDataStream data_copy(data);\n+    uint32_t serialized_int1;\n+    data >> serialized_int1;\n+    BOOST_CHECK_EQUAL(serialized_int1, (uint32_t)0x7700C35A); // NOTE: Serialized as LE\n+    uint16_t serialized_int2;\n+    data >> serialized_int2;\n+    BOOST_CHECK_EQUAL(serialized_int2, (uint16_t)0x1072); // NOTE: Serialized as LE\n+\n+    BitStreamReader<CDataStream> bit_reader(data_copy);\n+    BOOST_CHECK_EQUAL(bit_reader.Read(1), 0);\n+    BOOST_CHECK_EQUAL(bit_reader.Read(2), 2);\n+    BOOST_CHECK_EQUAL(bit_reader.Read(3), 6);\n+    BOOST_CHECK_EQUAL(bit_reader.Read(4), 11);\n+    BOOST_CHECK_EQUAL(bit_reader.Read(5), 1);\n+    BOOST_CHECK_EQUAL(bit_reader.Read(6), 32);\n+    BOOST_CHECK_EQUAL(bit_reader.Read(7), 7);\n+    BOOST_CHECK_EQUAL(bit_reader.Read(16), 30497);\n+    BOOST_CHECK_THROW(bit_reader.Read(8), std::ios_base::failure);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r210976725",
      "id" : 210976725,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMDk3NjcyNQ==",
      "original_commit_id" : "e15e553b746e64f0eeda420e4c10eccfc747d69f",
      "original_position" : 36,
      "path" : "src/test/streams_tests.cpp",
      "position" : 81,
      "pull_request_review_id" : 147307772,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/210976725",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r210992123"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/210992123"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"blockfilter: Implement GCSFilter constructors.\" (515af0398b8f2aab77645871198c69fea91a07ff)\r\n\r\nMaybe use `x` and `P` instead of `n` and `k` to be consistent with golomb_encode function from BIP158. This would also be more consistent with the `GCSFilter` class, which uses `P`.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-08-17T18:15:41Z",
      "diff_hunk" : "@@ -0,0 +1,151 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+static constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+static constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t k, uint64_t n)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r210992123",
      "id" : 210992123,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMDk5MjEyMw==",
      "original_commit_id" : "515af0398b8f2aab77645871198c69fea91a07ff",
      "original_position" : 16,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 147307772,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/210992123",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r210999608"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/210999608"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"blockfilter: Construction of basic block filters.\" (f7a5bdb54ba597fe06bcb54e886c43436899ab48)\r\n\r\nChange seems unrelated to this commit.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-08-17T18:41:46Z",
      "diff_hunk" : "@@ -6,6 +6,7 @@\n #ifndef BITCOIN_UNDO_H\n #define BITCOIN_UNDO_H\n \n+#include <coins.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r210999608",
      "id" : 210999608,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMDk5OTYwOA==",
      "original_commit_id" : "f7a5bdb54ba597fe06bcb54e886c43436899ab48",
      "original_position" : 4,
      "path" : "src/undo.h",
      "position" : 4,
      "pull_request_review_id" : 147307772,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/210999608",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r211006188"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211006188"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"blockfilter: Construction of basic block filters.\" (f7a5bdb54ba597fe06bcb54e886c43436899ab48)\r\n\r\nI think it could be beneficial if `GCSFilter` defined: \r\n\r\n```c++\r\ntypedef std::unordered_set<Element> Elements;\r\n```\r\n\r\nAnd if this function, the `GCSFilter` constructor, `BuildHashedSet`, and `MatchAny` all used  `GCSFilter::Elements` instead of `std::set<GCSFilter::Element>`. It'd be nice to decrease the coupling to one data structure, and since `std::set` is an ordered set, these functions are pointlessly also sorting the elements when order is not important.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-08-17T19:06:27Z",
      "diff_hunk" : "@@ -193,3 +195,41 @@ bool GCSFilter::MatchAny(const std::set<Element>& elements) const\n     const std::vector<uint64_t> queries = BuildHashedSet(elements);\n     return MatchInternal(queries.data(), queries.size());\n }\n+\n+static std::set<GCSFilter::Element> BasicFilterElements(const CBlock& block,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r211006188",
      "id" : 211006188,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMTAwNjE4OA==",
      "original_commit_id" : "f7a5bdb54ba597fe06bcb54e886c43436899ab48",
      "original_position" : 14,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 147307772,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211006188",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r211010036"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211010036"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"blockfilter: Serialization methods on BlockFilter.\" (c14e4d5a950ed40d96a8956e4622e1d9670da72d)\r\n\r\nNote: https://github.com/bitcoin/bips/blob/master/bip-0157.mediawiki#filter-headers is the relevant section of the bip describing block filter hash (`GetHash`) and filter header (`ComputeHeader`) derivations.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-08-17T19:23:32Z",
      "diff_hunk" : "@@ -233,3 +233,24 @@ BlockFilter::BlockFilter(BlockFilterType filter_type, const CBlock& block, const\n         throw std::invalid_argument(\"unknown filter_type\");\n     }\n }\n+\n+uint256 BlockFilter::GetHash() const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r211010036",
      "id" : 211010036,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMTAxMDAzNg==",
      "original_commit_id" : "ab852f91602c268d894e8f882f7f8212fd39f9dd",
      "original_position" : 5,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 147307772,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211010036",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r211403699"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211403699"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It's required because `blockfilter.h` includes `undo.h` and won't compile otherwise. This could be moved to separate commit though.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-08-20T20:52:50Z",
      "diff_hunk" : "@@ -6,6 +6,7 @@\n #ifndef BITCOIN_UNDO_H\n #define BITCOIN_UNDO_H\n \n+#include <coins.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r211403699",
      "id" : 211403699,
      "in_reply_to_id" : 210999608,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMTQwMzY5OQ==",
      "original_commit_id" : "f7a5bdb54ba597fe06bcb54e886c43436899ab48",
      "original_position" : 4,
      "path" : "src/undo.h",
      "position" : 4,
      "pull_request_review_id" : 147818087,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211403699",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r211406600"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211406600"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't understand the benefit. The assertion of a `std::ios_base::failure` is meant to test that the buffer is out of data.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-08-20T21:03:35Z",
      "diff_hunk" : "@@ -113,6 +113,41 @@ BOOST_AUTO_TEST_CASE(streams_vector_reader)\n     BOOST_CHECK_THROW(reader >> d, std::ios_base::failure);\n }\n \n+BOOST_AUTO_TEST_CASE(bitstream_reader_writer)\n+{\n+    CDataStream data(SER_NETWORK, INIT_PROTO_VERSION);\n+\n+    BitStreamWriter<CDataStream> bit_writer(data);\n+    bit_writer.Write(0, 1);\n+    bit_writer.Write(2, 2);\n+    bit_writer.Write(6, 3);\n+    bit_writer.Write(11, 4);\n+    bit_writer.Write(1, 5);\n+    bit_writer.Write(32, 6);\n+    bit_writer.Write(7, 7);\n+    bit_writer.Write(30497, 16);\n+    bit_writer.Flush();\n+\n+    CDataStream data_copy(data);\n+    uint32_t serialized_int1;\n+    data >> serialized_int1;\n+    BOOST_CHECK_EQUAL(serialized_int1, (uint32_t)0x7700C35A); // NOTE: Serialized as LE\n+    uint16_t serialized_int2;\n+    data >> serialized_int2;\n+    BOOST_CHECK_EQUAL(serialized_int2, (uint16_t)0x1072); // NOTE: Serialized as LE\n+\n+    BitStreamReader<CDataStream> bit_reader(data_copy);\n+    BOOST_CHECK_EQUAL(bit_reader.Read(1), 0);\n+    BOOST_CHECK_EQUAL(bit_reader.Read(2), 2);\n+    BOOST_CHECK_EQUAL(bit_reader.Read(3), 6);\n+    BOOST_CHECK_EQUAL(bit_reader.Read(4), 11);\n+    BOOST_CHECK_EQUAL(bit_reader.Read(5), 1);\n+    BOOST_CHECK_EQUAL(bit_reader.Read(6), 32);\n+    BOOST_CHECK_EQUAL(bit_reader.Read(7), 7);\n+    BOOST_CHECK_EQUAL(bit_reader.Read(16), 30497);\n+    BOOST_CHECK_THROW(bit_reader.Read(8), std::ios_base::failure);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r211406600",
      "id" : 211406600,
      "in_reply_to_id" : 210976725,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMTQwNjYwMA==",
      "original_commit_id" : "e15e553b746e64f0eeda420e4c10eccfc747d69f",
      "original_position" : 36,
      "path" : "src/test/streams_tests.cpp",
      "position" : 81,
      "pull_request_review_id" : 147821766,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211406600",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r211407126"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211407126"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks, good catch.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-08-20T21:05:50Z",
      "diff_hunk" : "@@ -509,12 +509,102 @@ class CDataStream\n     }\n };\n \n+template <typename IStream>\n+class BitStreamReader\n+{\n+private:\n+    IStream& m_istream;\n \n+    /// Buffered byte read in from the input stream. A new byte is read into the\n+    /// buffer when m_offset reaches 8.\n+    uint8_t m_buffer{0};\n \n+    /// Number of high order bits in m_buffer already returned by previous\n+    /// Read() calls. The next bit to be returned is at this offset from the\n+    /// most significant bit position.\n+    int m_offset{8};\n \n+public:\n+    explicit BitStreamReader(IStream& istream) : m_istream(istream) {}\n \n+    uint64_t Read(int nbits) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r211407126",
      "id" : 211407126,
      "in_reply_to_id" : 210954376,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMTQwNzEyNg==",
      "original_commit_id" : "faaa4b8432d194acb26ffcac07c379444da327ac",
      "original_position" : 22,
      "path" : "src/streams.h",
      "position" : null,
      "pull_request_review_id" : 147822466,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211407126",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r211492786"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211492786"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I added the typedef to `std::set`. In commit e645d53b3d5fa5912e3a99cc4fec74aee64e81e5, I change it to `std::unordered_set` which uses a randomly selected SipHash instance to hash the byte vector. Let me know if you think this is acceptable or whether it should be left as `std::set`.",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-08-21T06:39:11Z",
      "diff_hunk" : "@@ -193,3 +195,41 @@ bool GCSFilter::MatchAny(const std::set<Element>& elements) const\n     const std::vector<uint64_t> queries = BuildHashedSet(elements);\n     return MatchInternal(queries.data(), queries.size());\n }\n+\n+static std::set<GCSFilter::Element> BasicFilterElements(const CBlock& block,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r211492786",
      "id" : 211492786,
      "in_reply_to_id" : 211006188,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMTQ5Mjc4Ng==",
      "original_commit_id" : "f7a5bdb54ba597fe06bcb54e886c43436899ab48",
      "original_position" : 14,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 147921118,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-25T17:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/211492786",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@ryanofsky Thank you for the review. I'm going to leave `GCSElementSet` typedef'ed to `std::set` in this PR and will open a separate PR after this is merged to change to `unordered_set`. Creating the custom hasher and putting it in an appropriate location requires shuffling some code around which is not relevant to this PR and I'd rather not add another reason to hold off on merging this.",
      "created_at" : "2018-08-24T23:24:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-415907116",
      "id" : 415907116,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxNTkwNzExNg==",
      "updated_at" : "2018-08-24T23:24:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/415907116",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Question for maintainers: While this PR was fun to review, I'm curious if there's a specific reason it wasn't merged previously? It has 4 other acks and doesn't touch existing functionality, and the new functionality is pretty well covered by test vectors.\r\n\r\ndidn't want to merge it last-minute for 0.17, but it can go in now IMO",
      "created_at" : "2018-08-26T14:23:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#issuecomment-416042517",
      "id" : 416042517,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12254",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxNjA0MjUxNw==",
      "updated_at" : "2018-08-26T14:23:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/416042517",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r212830981"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/212830981"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Isnt this an OOB read?",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-08-26T16:07:00Z",
      "diff_hunk" : "@@ -0,0 +1,260 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <blockfilter.h>\n+#include <hash.h>\n+#include <primitives/transaction.h>\n+#include <script/script.h>\n+#include <streams.h>\n+\n+/// SerType used to serialize parameters in GCS filter encoding.\n+static constexpr int GCS_SER_TYPE = SER_NETWORK;\n+\n+/// Protocol version used to serialize parameters in GCS filter encoding.\n+static constexpr int GCS_SER_VERSION = 0;\n+\n+template <typename OStream>\n+static void GolombRiceEncode(BitStreamWriter<OStream>& bitwriter, uint8_t P, uint64_t x)\n+{\n+    // Write quotient as unary-encoded: q 1's followed by one 0.\n+    uint64_t q = x >> P;\n+    while (q > 0) {\n+        int nbits = q <= 64 ? static_cast<int>(q) : 64;\n+        bitwriter.Write(~0ULL, nbits);\n+        q -= nbits;\n+    }\n+    bitwriter.Write(0, 1);\n+\n+    // Write the remainder in P bits. Since the remainder is just the bottom\n+    // P bits of x, there is no need to mask first.\n+    bitwriter.Write(x, P);\n+}\n+\n+template <typename IStream>\n+static uint64_t GolombRiceDecode(BitStreamReader<IStream>& bitreader, uint8_t P)\n+{\n+    // Read unary-encoded quotient: q 1's followed by one 0.\n+    uint64_t q = 0;\n+    while (bitreader.Read(1) == 1) {\n+        ++q;\n+    }\n+\n+    uint64_t r = bitreader.Read(P);\n+\n+    return (q << P) + r;\n+}\n+\n+// Map a value x that is uniformly distributed in the range [0, 2^64) to a\n+// value uniformly distributed in [0, n) by returning the upper 64 bits of\n+// x * n.\n+//\n+// See: https://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/\n+static uint64_t MapIntoRange(uint64_t x, uint64_t n)\n+{\n+#ifdef __SIZEOF_INT128__\n+    return (static_cast<unsigned __int128>(x) * static_cast<unsigned __int128>(n)) >> 64;\n+#else\n+    // To perform the calculation on 64-bit numbers without losing the\n+    // result to overflow, split the numbers into the most significant and\n+    // least significant 32 bits and perform multiplication piece-wise.\n+    //\n+    // See: https://stackoverflow.com/a/26855440\n+    uint64_t x_hi = x >> 32;\n+    uint64_t x_lo = x & 0xFFFFFFFF;\n+    uint64_t n_hi = n >> 32;\n+    uint64_t n_lo = n & 0xFFFFFFFF;\n+\n+    uint64_t ac = x_hi * n_hi;\n+    uint64_t ad = x_hi * n_lo;\n+    uint64_t bc = x_lo * n_hi;\n+    uint64_t bd = x_lo * n_lo;\n+\n+    uint64_t mid34 = (bd >> 32) + (bc & 0xFFFFFFFF) + (ad & 0xFFFFFFFF);\n+    uint64_t upper64 = ac + (bc >> 32) + (ad >> 32) + (mid34 >> 32);\n+    return upper64;\n+#endif\n+}\n+\n+uint64_t GCSFilter::HashToRange(const Element& element) const\n+{\n+    uint64_t hash = CSipHasher(m_siphash_k0, m_siphash_k1)\n+        .Write(element.data(), element.size())\n+        .Finalize();\n+    return MapIntoRange(hash, m_F);\n+}\n+\n+std::vector<uint64_t> GCSFilter::BuildHashedSet(const ElementSet& elements) const\n+{\n+    std::vector<uint64_t> hashed_elements;\n+    hashed_elements.reserve(elements.size());\n+    for (const Element& element : elements) {\n+        hashed_elements.push_back(HashToRange(element));\n+    }\n+    std::sort(hashed_elements.begin(), hashed_elements.end());\n+    return hashed_elements;\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P, uint32_t M)\n+    : m_siphash_k0(siphash_k0), m_siphash_k1(siphash_k1), m_P(P), m_M(M), m_N(0), m_F(0)\n+{}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P, uint32_t M,\n+                     std::vector<unsigned char> encoded_filter)\n+    : GCSFilter(siphash_k0, siphash_k1, P, M)\n+{\n+    m_encoded = std::move(encoded_filter);\n+\n+    VectorReader stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    uint64_t N = ReadCompactSize(stream);\n+    m_N = static_cast<uint32_t>(N);\n+    if (m_N != N) {\n+        throw std::ios_base::failure(\"N must be <2^32\");\n+    }\n+    m_F = static_cast<uint64_t>(m_N) * static_cast<uint64_t>(m_M);\n+\n+    // Verify that the encoded filter contains exactly N elements. If it has too much or too little\n+    // data, a std::ios_base::failure exception will be raised.\n+    BitStreamReader<VectorReader> bitreader(stream);\n+    for (uint64_t i = 0; i < m_N; ++i) {\n+        GolombRiceDecode(bitreader, m_P);\n+    }\n+    if (!stream.empty()) {\n+        throw std::ios_base::failure(\"encoded_filter contains excess data\");\n+    }\n+}\n+\n+GCSFilter::GCSFilter(uint64_t siphash_k0, uint64_t siphash_k1, uint8_t P, uint32_t M,\n+                     const ElementSet& elements)\n+    : GCSFilter(siphash_k0, siphash_k1, P, M)\n+{\n+    size_t N = elements.size();\n+    m_N = static_cast<uint32_t>(N);\n+    if (m_N != N) {\n+        throw std::invalid_argument(\"N must be <2^32\");\n+    }\n+    m_F = static_cast<uint64_t>(m_N) * static_cast<uint64_t>(m_M);\n+\n+    CVectorWriter stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    WriteCompactSize(stream, m_N);\n+\n+    if (elements.empty()) {\n+        return;\n+    }\n+\n+    BitStreamWriter<CVectorWriter> bitwriter(stream);\n+\n+    uint64_t last_value = 0;\n+    for (uint64_t value : BuildHashedSet(elements)) {\n+        uint64_t delta = value - last_value;\n+        GolombRiceEncode(bitwriter, m_P, delta);\n+        last_value = value;\n+    }\n+\n+    bitwriter.Flush();\n+}\n+\n+bool GCSFilter::MatchInternal(const uint64_t* element_hashes, size_t size) const\n+{\n+    VectorReader stream(GCS_SER_TYPE, GCS_SER_VERSION, m_encoded, 0);\n+\n+    // Seek forward by size of N\n+    uint64_t N = ReadCompactSize(stream);\n+    assert(N == m_N);\n+\n+    BitStreamReader<VectorReader> bitreader(stream);\n+\n+    uint64_t value = 0;\n+    size_t hashes_index = 0;\n+    for (uint32_t i = 0; i < m_N; ++i) {\n+        uint64_t delta = GolombRiceDecode(bitreader, m_P);\n+        value += delta;\n+\n+        while (true) {\n+            if (hashes_index == size) {\n+                return false;\n+            } else if (element_hashes[hashes_index] == value) {\n+                return true;\n+            } else if (element_hashes[hashes_index] > value) {\n+                break;\n+            }\n+\n+            hashes_index++;\n+        }\n+    }\n+\n+    return false;\n+}\n+\n+bool GCSFilter::Match(const Element& element) const\n+{\n+    uint64_t query = HashToRange(element);\n+    return MatchInternal(&query, 1);\n+}\n+\n+bool GCSFilter::MatchAny(const ElementSet& elements) const\n+{\n+    const std::vector<uint64_t> queries = BuildHashedSet(elements);\n+    return MatchInternal(queries.data(), queries.size());\n+}\n+\n+static GCSFilter::ElementSet BasicFilterElements(const CBlock& block,\n+                                                 const CBlockUndo& block_undo)\n+{\n+    GCSFilter::ElementSet elements;\n+\n+    for (const CTransactionRef& tx : block.vtx) {\n+        for (const CTxOut& txout : tx->vout) {\n+            const CScript& script = txout.scriptPubKey;\n+            if (script[0] == OP_RETURN) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r212830981",
      "id" : 212830981,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMjgzMDk4MQ==",
      "original_commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "original_position" : 211,
      "path" : "src/blockfilter.cpp",
      "position" : 211,
      "pull_request_review_id" : 149543032,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-26T16:07:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/212830981",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r213016782"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213016782"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Post-merge nit: \"signficant\" should be \"significant\".\r\n\r\nThis misspelling was automatically identified by `codespell`.\r\n\r\nAutomatic `codespell` checking is introduced in PR #13954. It warns (note: warn only, no build failure) when a PR introduces spelling errors. Please review :-)",
      "commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "created_at" : "2018-08-27T15:30:13Z",
      "diff_hunk" : "@@ -436,12 +510,105 @@ class CDataStream\n     }\n };\n \n+template <typename IStream>\n+class BitStreamReader\n+{\n+private:\n+    IStream& m_istream;\n+\n+    /// Buffered byte read in from the input stream. A new byte is read into the\n+    /// buffer when m_offset reaches 8.\n+    uint8_t m_buffer{0};\n+\n+    /// Number of high order bits in m_buffer already returned by previous\n+    /// Read() calls. The next bit to be returned is at this offset from the\n+    /// most significant bit position.\n+    int m_offset{8};\n+\n+public:\n+    explicit BitStreamReader(IStream& istream) : m_istream(istream) {}\n+\n+    /** Read the specified number of bits from the stream. The data is returned\n+     * in the nbits least signficant bits of a 64-bit uint.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12254#discussion_r213016782",
      "id" : 213016782,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMzAxNjc4Mg==",
      "original_commit_id" : "254c85b68794ada713dbdae415db72adf5fcbaf3",
      "original_position" : 104,
      "path" : "src/streams.h",
      "position" : 104,
      "pull_request_review_id" : 149762413,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12254",
      "updated_at" : "2018-08-27T15:30:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/213016782",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   }
]
