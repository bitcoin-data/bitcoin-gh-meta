[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I assume libnatpmp should be subtree'd or we should still use the version linked-against in miniupnpc?\n\nOn January 28, 2018 8:15:18 PM UTC, Annanay Agarwal <notifications@github.com> wrote:\n>Adds minimal support for NATPMP (and removes dependency on external\n>UPnP library). Reference implementation in `miniupnp/libnatpmp`.\n>\n>WIP but aims to fix #11902 .\n>You can view, comment on, or merge this pull request online at:\n>\n>  https://github.com/bitcoin/bitcoin/pull/12288\n>\n>-- Commit Summary --\n>\n>* Add basic NATPMP support, get gateway by file parsing,\n>getpublicaddress, map public-private port\n>\n>-- File Changes --\n>\n>    A src/getgateway.c (570)\n>    A src/getgateway.h (47)\n>    A src/natpmp.c (354)\n>    A src/natpmp.h (182)\n>    M src/net.cpp (187)\n>    A src/wingettimeofday.c (60)\n>    A src/wingettimeofday.h (36)\n>\n>-- Patch Links --\n>\n>https://github.com/bitcoin/bitcoin/pull/12288.patch\n>https://github.com/bitcoin/bitcoin/pull/12288.diff\n>\n>-- \n>You are receiving this because you are subscribed to this thread.\n>Reply to this email directly or view it on GitHub:\n>https://github.com/bitcoin/bitcoin/pull/12288\n",
      "created_at" : "2018-01-28T20:37:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12288#issuecomment-361093713",
      "id" : 361093713,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12288",
      "updated_at" : "2018-01-28T20:37:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/361093713",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "This PR just copies 6 files from libnatpmp into the repository. Perhaps this is a sufficiently low amount of code that we want to do this (like with tinyformat), but if so, putting them in a subdirectory together may be better.\n\nI haven't checked how much changes were necessary to them, but if it was 0, perhaps we can subtree but still build them directly from our build system (as opposed to building as a library and linking statically).",
      "created_at" : "2018-01-28T20:42:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12288#issuecomment-361094071",
      "id" : 361094071,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12288",
      "updated_at" : "2018-01-28T20:42:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/361094071",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "There are minor changes to the copied files, some including changing the `WIN32` macro, and others according to the coding guidelines like changing `NULL` to `nullptr`, etc.\r\n\r\n",
      "created_at" : "2018-01-29T05:45:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12288#issuecomment-361145997",
      "id" : 361145997,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12288",
      "updated_at" : "2018-01-29T05:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/361145997",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/10982987?v=4",
         "events_url" : "https://api.github.com/users/annanay25/events{/privacy}",
         "followers_url" : "https://api.github.com/users/annanay25/followers",
         "following_url" : "https://api.github.com/users/annanay25/following{/other_user}",
         "gists_url" : "https://api.github.com/users/annanay25/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/annanay25",
         "id" : 10982987,
         "login" : "annanay25",
         "organizations_url" : "https://api.github.com/users/annanay25/orgs",
         "received_events_url" : "https://api.github.com/users/annanay25/received_events",
         "repos_url" : "https://api.github.com/users/annanay25/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/annanay25/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/annanay25/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/annanay25"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "libnatpmp seems to have been virtually unmaintained a while (last commit was Mar 15, 2016), so I think it doesn't matter whether we use 'subtree'. It might be easier to just include the (small) implementation files into our build system and see if we can maintain it ourselves, cutting out parts we don't need.\r\n\r\nAt least now we don't have to carry the `.java`s.\r\n\r\n> putting them in a subdirectory together may be better.\r\n\r\nI agree with that - whatever you do, please don't put them in `src/` root.",
      "created_at" : "2018-01-29T09:02:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12288#issuecomment-361180620",
      "id" : 361180620,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12288",
      "updated_at" : "2018-01-29T09:02:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/361180620",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "This is failing the travis build - did you perhaps forget to add `natpmp.h` to the makefile, so that it's not included in make dist?\r\n```\r\nMaking check in src\r\nmake[1]: Entering directory `/home/travis/build/bitcoin/bitcoin/build/bitcoin-i686-w64-mingw32/src'\r\nmake[2]: Entering directory `/home/travis/build/bitcoin/bitcoin/build/bitcoin-i686-w64-mingw32/src'\r\n  CXX      libbitcoin_server_a-net.o\r\n  CXX      libbitcoin_server_a-noui.o\r\n  CXX      libbitcoin_server_a-pow.o\r\n  CXX      libbitcoin_server_a-rest.o\r\nnet.cpp:31:20: fatal error: natpmp.h: No such file or directory\r\n #include <natpmp.h>\r\n                    ^\r\ncompilation terminated.\r\nmake[2]: *** [libbitcoin_server_a-net.o] Error 1\r\nmake[2]: *** Waiting for unfinished jobs....\r\nmake[2]: Leaving directory `/home/travis/build/bitcoin/bitcoin/build/bitcoin-i686-w64-mingw32/src'\r\nmake[1]: *** [check-recursive] Error 1\r\nmake[1]: Leaving directory `/home/travis/build/bitcoin/bitcoin/build/bitcoin-i686-w64-mingw32/src'\r\nmake: *** [check-recursive] Error 1\r\n```",
      "created_at" : "2018-02-08T16:06:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12288#issuecomment-364159788",
      "id" : 364159788,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12288",
      "updated_at" : "2018-02-08T16:06:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/364159788",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@laanwj ;\r\n\r\nI'm a little confused with the name mangling happening here. The `src/natpmp/*.c` files have `extern \"C\"` in the function prototypes, which confirms no name mangling (confirmed this with `nm src/natpmp/libbitcoin_server_a-natpmp.o | grep initnatpmp`), but C++ object files are looking for mangled function names?",
      "created_at" : "2018-03-13T07:36:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12288#issuecomment-372573415",
      "id" : 372573415,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12288",
      "updated_at" : "2018-03-13T07:36:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/372573415",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/10982987?v=4",
         "events_url" : "https://api.github.com/users/annanay25/events{/privacy}",
         "followers_url" : "https://api.github.com/users/annanay25/followers",
         "following_url" : "https://api.github.com/users/annanay25/following{/other_user}",
         "gists_url" : "https://api.github.com/users/annanay25/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/annanay25",
         "id" : 10982987,
         "login" : "annanay25",
         "organizations_url" : "https://api.github.com/users/annanay25/orgs",
         "received_events_url" : "https://api.github.com/users/annanay25/received_events",
         "repos_url" : "https://api.github.com/users/annanay25/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/annanay25/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/annanay25/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/annanay25"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "> but C++ object files are looking for mangled function names?\r\n\r\nYou need the extern \"C\" in the header, not in the implementation files.",
      "created_at" : "2018-04-11T09:59:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12288#issuecomment-380397088",
      "id" : 380397088,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12288",
      "updated_at" : "2018-04-11T09:59:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/380397088",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--5d09a71f8925f3f132321140b44b946d-->The last travis run for this pull request was 101 days ago and is thus outdated. To trigger a fresh travis build, this pull request should be closed and re-opened.",
      "created_at" : "2018-07-21T17:29:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12288#issuecomment-406811437",
      "id" : 406811437,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12288",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwNjgxMTQzNw==",
      "updated_at" : "2018-07-21T17:29:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/406811437",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12288#discussion_r214548964"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12288"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/214548964"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Typo found by `codespell`: automaticaly",
      "commit_id" : "fcd026b8e0313a7a46e29ddca8e97274e97b08ae",
      "created_at" : "2018-09-02T18:21:52Z",
      "diff_hunk" : "@@ -0,0 +1,208 @@\n+/* $Id: natpmp.h,v 1.19 2014/04/01 09:39:29 nanard Exp $ */\n+/* libnatpmp\n+Copyright (c) 2007-2014, Thomas BERNARD\n+All rights reserved.\n+Redistribution and use in source and binary forms, with or without\n+modification, are permitted provided that the following conditions are met:\n+    * Redistributions of source code must retain the above copyright notice,\n+      this list of conditions and the following disclaimer.\n+    * Redistributions in binary form must reproduce the above copyright notice,\n+      this list of conditions and the following disclaimer in the documentation\n+      and/or other materials provided with the distribution.\n+    * The name of the author may not be used to endorse or promote products\n+      derived from this software without specific prior written permission.\n+THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n+AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n+IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n+ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE\n+LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\n+CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\n+SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\n+INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\n+CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n+ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n+POSSIBILITY OF SUCH DAMAGE.\n+*/\n+\n+#ifndef __NATPMP_H__\n+#define __NATPMP_H__\n+\n+#include <time.h>\n+\n+#if !defined(_MSC_VER)\n+#include <sys/time.h>\n+#endif\n+\n+#ifdef WIN32\n+#include <winsock2.h>\n+#if !defined(_MSC_VER) || _MSC_VER >= 1600\n+#include <stdint.h>\n+#else    /* !defined(_MSC_VER) || _MSC_VER >= 1600 */\n+typedef unsigned long uint32_t;\n+typedef unsigned short uint16_t;\n+#endif    /* !defined(_MSC_VER) || _MSC_VER >= 1600 */\n+#define in_addr_t uint32_t\n+#else\n+#include <netinet/in.h>\n+#endif\n+\n+#include <natpmp/natpmp_declspec.h>\n+\n+typedef struct {\n+    int s;    /* socket */\n+    in_addr_t gateway;    /* default gateway (IPv4) */\n+    int has_pending_request;\n+    unsigned char pending_request[12];\n+    int pending_request_len;\n+    int try_number;\n+    struct timeval retry_time;\n+} natpmp_t;\n+\n+typedef struct {\n+    uint16_t type;    /* NATPMP_RESPTYPE_* */\n+    uint16_t resultcode;    /* NAT-PMP response code */\n+    uint32_t epoch;    /* Seconds since start of epoch */\n+    union {\n+        struct {\n+            //in_addr_t addr;\n+            struct in_addr addr;\n+        } publicaddress;\n+        struct {\n+            uint16_t privateport;\n+            uint16_t mappedpublicport;\n+            uint32_t lifetime;\n+        } newportmapping;\n+    } pnu;\n+} natpmpresp_t;\n+\n+/* possible values for type field of natpmpresp_t */\n+#define NATPMP_RESPTYPE_PUBLICADDRESS (0)\n+// #define NATPMP_RESPTYPE_UDPPORTMAPPING (1)\n+#define NATPMP_RESPTYPE_TCPPORTMAPPING (1)\n+\n+/* return values */\n+/* NATPMP_ERR_INVALIDARGS : invalid arguments passed to the function */\n+#define NATPMP_ERR_INVALIDARGS (-1)\n+/* NATPMP_ERR_SOCKETERROR : socket() failed. check errno for details */\n+#define NATPMP_ERR_SOCKETERROR (-2)\n+/* NATPMP_ERR_CANNOTGETGATEWAY : can't get default gateway IP */\n+#define NATPMP_ERR_CANNOTGETGATEWAY (-3)\n+/* NATPMP_ERR_CLOSEERR : close() failed. check errno for details */\n+#define NATPMP_ERR_CLOSEERR (-4)\n+/* NATPMP_ERR_RECVFROM : recvfrom() failed. check errno for details */\n+#define NATPMP_ERR_RECVFROM (-5)\n+/* NATPMP_ERR_NOPENDINGREQ : readnatpmpresponseorretry() called while\n+ * no NAT-PMP request was pending */\n+#define NATPMP_ERR_NOPENDINGREQ (-6)\n+/* NATPMP_ERR_NOGATEWAYSUPPORT : the gateway does not support NAT-PMP */\n+#define NATPMP_ERR_NOGATEWAYSUPPORT (-7)\n+/* NATPMP_ERR_CONNECTERR : connect() failed. check errno for details */\n+#define NATPMP_ERR_CONNECTERR (-8)\n+/* NATPMP_ERR_WRONGPACKETSOURCE : packet not received from the network gateway */\n+#define NATPMP_ERR_WRONGPACKETSOURCE (-9)\n+/* NATPMP_ERR_SENDERR : send() failed. check errno for details */\n+#define NATPMP_ERR_SENDERR (-10)\n+/* NATPMP_ERR_FCNTLERROR : fcntl() failed. check errno for details */\n+#define NATPMP_ERR_FCNTLERROR (-11)\n+/* NATPMP_ERR_GETTIMEOFDAYERR : gettimeofday() failed. check errno for details */\n+#define NATPMP_ERR_GETTIMEOFDAYERR (-12)\n+\n+/* */\n+#define NATPMP_ERR_UNSUPPORTEDVERSION (-14)\n+#define NATPMP_ERR_UNSUPPORTEDOPCODE (-15)\n+\n+/* Errors from the server : */\n+#define NATPMP_ERR_UNDEFINEDERROR (-49)\n+#define NATPMP_ERR_NOTAUTHORIZED (-51)\n+#define NATPMP_ERR_NETWORKFAILURE (-52)\n+#define NATPMP_ERR_OUTOFRESOURCES (-53)\n+\n+/* NATPMP_TRYAGAIN : no data available for the moment. try again later */\n+#define NATPMP_TRYAGAIN (-100)\n+\n+#ifdef __cplusplus\n+extern \"C\" {\n+#endif\n+\n+/* initnatpmp()\n+ * initialize a natpmp_t object\n+ * With forcegw=1 the gateway is not detected automaticaly.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12288#discussion_r214548964",
      "id" : 214548964,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNDU0ODk2NA==",
      "original_commit_id" : "fcd026b8e0313a7a46e29ddca8e97274e97b08ae",
      "original_position" : 129,
      "path" : "src/natpmp/natpmp.h",
      "position" : 129,
      "pull_request_review_id" : 151629046,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12288",
      "updated_at" : "2018-09-02T18:21:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/214548964",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12288#discussion_r214548971"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12288"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/214548971"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Typo found by `codespell`: liftime",
      "commit_id" : "fcd026b8e0313a7a46e29ddca8e97274e97b08ae",
      "created_at" : "2018-09-02T18:22:13Z",
      "diff_hunk" : "@@ -1468,81 +1466,101 @@ static std::thread g_upnp_thread;\n void ThreadMapPort()\n {\n     std::string port = strprintf(\"%u\", GetListenPort());\n-    const char * multicastif = nullptr;\n-    const char * minissdpdpath = nullptr;\n-    struct UPNPDev * devlist = nullptr;\n-    char lanaddr[64];\n-\n-#ifndef UPNPDISCOVER_SUCCESS\n-    /* miniupnpc 1.5 */\n-    devlist = upnpDiscover(2000, multicastif, minissdpdpath, 0);\n-#elif MINIUPNPC_API_VERSION < 14\n-    /* miniupnpc 1.6 */\n-    int error = 0;\n-    devlist = upnpDiscover(2000, multicastif, minissdpdpath, 0, 0, &error);\n-#else\n-    /* miniupnpc 1.9.20150730 */\n-    int error = 0;\n-    devlist = upnpDiscover(2000, multicastif, minissdpdpath, 0, 0, 2, &error);\n-#endif\n \n-    struct UPNPUrls urls;\n-    struct IGDdatas data;\n+    natpmp_t natpmp;\n+    natpmpresp_t response;\n     int r;\n+    int sav_errno;\n+    struct timeval timeout;\n+    fd_set fds;\n+    int i;\n+    int protocol = 0;\n+    uint16_t privateport = std::atoi(port.c_str());\n+    uint16_t publicport = std::atoi(port.c_str());\n+    uint32_t lifetime = 3600;\n+    int command = 0;\n+    int forcegw = 0;\n+    in_addr_t gateway = 0;\n+    struct in_addr gateway_in_use;\n+\n+\n+    try{\n+        /* initnatpmp() */\n+        r = initnatpmp(&natpmp, forcegw, gateway, port.c_str());\n+        LogPrintf(\"NATPMP: initnatpmp returned %d\\n\", r);\n+\n+        gateway_in_use.s_addr = natpmp.gateway;\n+\n+        /* sendpublicaddressrequest() */\n+        r = sendpublicaddressrequest(&natpmp);\n+        LogPrintf(\"NATPMP: sendpublicaddressrequest returned %d\\n\", r);\n \n-    r = UPNP_GetValidIGD(devlist, &urls, &data, lanaddr, sizeof(lanaddr));\n-    if (r == 1)\n-    {\n-        if (fDiscover) {\n-            char externalIPAddress[40];\n-            r = UPNP_GetExternalIPAddress(urls.controlURL, data.first.servicetype, externalIPAddress);\n-            if(r != UPNPCOMMAND_SUCCESS)\n-                LogPrintf(\"UPnP: GetExternalIPAddress() returned %d\\n\", r);\n-            else\n-            {\n-                if(externalIPAddress[0])\n-                {\n-                    CNetAddr resolved;\n-                    if(LookupHost(externalIPAddress, resolved, false)) {\n-                        LogPrintf(\"UPnP: ExternalIPAddress = %s\\n\", resolved.ToString().c_str());\n-                        AddLocal(resolved, LOCAL_UPNP);\n-                    }\n+        do {\n+            FD_ZERO(&fds);\n+            FD_SET(natpmp.s, &fds);\n+            getnatpmprequesttimeout(&natpmp, &timeout);\n+            r = select(FD_SETSIZE, &fds, nullptr, nullptr, &timeout);\n+            if(r>=0) {\n+                r = readnatpmpresponseorretry(&natpmp, &response);\n+                sav_errno = errno;\n+                LogPrintf(\"NATPMP: readnatpmpresponseorretry returned %d (%s)\\n\",\n+                        r, r==0?\"OK\":(r==NATPMP_TRYAGAIN?\"TRY AGAIN\":\"FAILED\"));\n+\n+                if(r<0 && r!=NATPMP_TRYAGAIN) {\n+#ifdef ENABLE_STRNATPMPERR\n+                    LogPrintf(\"NATPMP: readnatpmpresponseorretry() failed : %s\\n\",\n+                            strnatpmperr(r));\n+#endif\n+                    LogPrintf(\"  errno=%d '%s'\\n\",\n+                            sav_errno, strerror(sav_errno));\n                 }\n-                else\n-                    LogPrintf(\"UPnP: GetExternalIPAddress failed.\\n\");\n+            }else{\n+                LogPrintf(\"NATPMP: Error with select()\\n\");\n             }\n-        }\n+        } while(r==NATPMP_TRYAGAIN);\n+\n+        LogPrintf(\"NATPMP: Public IP address : %s\\n\", \n+                inet_ntoa(response.pnu.publicaddress.addr));\n \n-        std::string strDesc = \"Bitcoin \" + FormatFullVersion();\n+\n+        /* sendnewportmappingrequest() */\n+        r = sendnewportmappingrequest(&natpmp, privateport, \n+                publicport, lifetime);\n+        LogPrintf(\"NATPMP: sendnewportmappingrequest returned %d (%s)\\n\",\n+                r, r==12?\"SUCCESS\":\"FAILED\");\n \n         do {\n-#ifndef UPNPDISCOVER_SUCCESS\n-            /* miniupnpc 1.5 */\n-            r = UPNP_AddPortMapping(urls.controlURL, data.first.servicetype,\n-                                port.c_str(), port.c_str(), lanaddr, strDesc.c_str(), \"TCP\", 0);\n-#else\n-            /* miniupnpc 1.6 */\n-            r = UPNP_AddPortMapping(urls.controlURL, data.first.servicetype,\n-                                port.c_str(), port.c_str(), lanaddr, strDesc.c_str(), \"TCP\", 0, \"0\");\n+            FD_ZERO(&fds);\n+            FD_SET(natpmp.s, &fds);\n+            getnatpmprequesttimeout(&natpmp, &timeout);\n+            select(FD_SETSIZE, &fds, nullptr, nullptr, &timeout);\n+            r = readnatpmpresponseorretry(&natpmp, &response);\n+            LogPrintf(\"NATPMP: readnatpmpresponseorretry returned %d (%s)\\n\",\n+                    r, r==0?\"OK\":(r==NATPMP_TRYAGAIN?\"TRY AGAIN\":\"FAILED\"));\n+        } while(r==NATPMP_TRYAGAIN);\n+\n+        if(r<0) {\n+#ifdef ENABLE_STRNATPMPERR\n+            LogPrintf(\"NATPMP: readnatpmpresponseorretry() failed : %s\\n\",\n+                    strnatpmperr(r));\n #endif\n-\n-            if(r!=UPNPCOMMAND_SUCCESS)\n-                LogPrintf(\"AddPortMapping(%s, %s, %s) failed with code %d (%s)\\n\",\n-                    port, port, lanaddr, r, strupnperror(r));\n-            else\n-                LogPrintf(\"UPnP Port Mapping successful.\\n\");\n         }\n-        while(g_upnp_interrupt.sleep_for(std::chrono::minutes(20)));\n \n-        r = UPNP_DeletePortMapping(urls.controlURL, data.first.servicetype, port.c_str(), \"TCP\", 0);\n-        LogPrintf(\"UPNP_DeletePortMapping() returned: %d\\n\", r);\n-        freeUPNPDevlist(devlist); devlist = nullptr;\n-        FreeUPNPUrls(&urls);\n-    } else {\n-        LogPrintf(\"No valid UPnP IGDs found\\n\");\n-        freeUPNPDevlist(devlist); devlist = nullptr;\n-        if (r != 0)\n-            FreeUPNPUrls(&urls);\n+        LogPrintf(\"Mapped public port %hu protocol %s to local port %hu \"\n+                \"liftime %u\\n\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12288#discussion_r214548971",
      "id" : 214548971,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNDU0ODk3MQ==",
      "original_commit_id" : "fcd026b8e0313a7a46e29ddca8e97274e97b08ae",
      "original_position" : 169,
      "path" : "src/net.cpp",
      "position" : 169,
      "pull_request_review_id" : 151629056,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12288",
      "updated_at" : "2018-09-02T18:22:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/214548971",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#14856](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14856.html) ([WIP] net: remove more CConnman globals (theuni) by dongcarl)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2018-09-21T13:26:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12288#issuecomment-423530334",
      "id" : 423530334,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12288",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyMzUzMDMzNA==",
      "updated_at" : "2018-12-03T20:44:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/423530334",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@annanay25 It seems like the work on this PR has stalled somewhat. Do you have time to continue working on this PR? :-)",
      "created_at" : "2018-12-09T19:22:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12288#issuecomment-445563825",
      "id" : 445563825,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12288",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NTU2MzgyNQ==",
      "updated_at" : "2018-12-09T19:22:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/445563825",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Is this PR still relevant? I'm not sure if I will be able to continue working on it. @practicalswift ",
      "created_at" : "2018-12-10T07:11:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12288#issuecomment-445709663",
      "id" : 445709663,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12288",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NTcwOTY2Mw==",
      "updated_at" : "2018-12-10T07:11:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/445709663",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/10982987?v=4",
         "events_url" : "https://api.github.com/users/annanay25/events{/privacy}",
         "followers_url" : "https://api.github.com/users/annanay25/followers",
         "following_url" : "https://api.github.com/users/annanay25/following{/other_user}",
         "gists_url" : "https://api.github.com/users/annanay25/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/annanay25",
         "id" : 10982987,
         "login" : "annanay25",
         "node_id" : "MDQ6VXNlcjEwOTgyOTg3",
         "organizations_url" : "https://api.github.com/users/annanay25/orgs",
         "received_events_url" : "https://api.github.com/users/annanay25/received_events",
         "repos_url" : "https://api.github.com/users/annanay25/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/annanay25/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/annanay25/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/annanay25"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think it's still relevant, but closing if you're not able to work on it anymore. Will add \"up for grabs\" tag.",
      "created_at" : "2018-12-10T07:23:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12288#issuecomment-445712089",
      "id" : 445712089,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12288",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NTcxMjA4OQ==",
      "updated_at" : "2018-12-10T07:23:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/445712089",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Can someone please re-assign #11902 to me? I would like to take this PR forward.",
      "created_at" : "2019-03-23T20:01:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12288#issuecomment-475900103",
      "id" : 475900103,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12288",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3NTkwMDEwMw==",
      "updated_at" : "2019-03-23T20:01:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/475900103",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/8533116?v=4",
         "events_url" : "https://api.github.com/users/MishraShivendra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MishraShivendra/followers",
         "following_url" : "https://api.github.com/users/MishraShivendra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MishraShivendra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MishraShivendra",
         "id" : 8533116,
         "login" : "MishraShivendra",
         "node_id" : "MDQ6VXNlcjg1MzMxMTY=",
         "organizations_url" : "https://api.github.com/users/MishraShivendra/orgs",
         "received_events_url" : "https://api.github.com/users/MishraShivendra/received_events",
         "repos_url" : "https://api.github.com/users/MishraShivendra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MishraShivendra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MishraShivendra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MishraShivendra"
      }
   }
]
