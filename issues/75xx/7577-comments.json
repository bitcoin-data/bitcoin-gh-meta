[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Looks good to me... utACK.\n",
      "created_at" : "2016-02-22T20:50:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7577#issuecomment-187377293",
      "id" : 187377293,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7577",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDE4NzM3NzI5Mw==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/187377293/reactions"
      },
      "updated_at" : "2016-02-22T20:50:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/187377293",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/17022881?v=4",
         "events_url" : "https://api.github.com/users/kirkalx/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kirkalx/followers",
         "following_url" : "https://api.github.com/users/kirkalx/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kirkalx/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kirkalx",
         "id" : 17022881,
         "login" : "kirkalx",
         "node_id" : "MDQ6VXNlcjE3MDIyODgx",
         "organizations_url" : "https://api.github.com/users/kirkalx/orgs",
         "received_events_url" : "https://api.github.com/users/kirkalx/received_events",
         "repos_url" : "https://api.github.com/users/kirkalx/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kirkalx/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kirkalx/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kirkalx"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Does this need a bump to get travis to check it @jonasschnelli ?\n",
      "created_at" : "2016-02-24T03:40:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7577#issuecomment-188047847",
      "id" : 188047847,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7577",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDE4ODA0Nzg0Nw==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/188047847/reactions"
      },
      "updated_at" : "2016-02-24T03:40:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/188047847",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/17022881?v=4",
         "events_url" : "https://api.github.com/users/kirkalx/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kirkalx/followers",
         "following_url" : "https://api.github.com/users/kirkalx/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kirkalx/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kirkalx",
         "id" : 17022881,
         "login" : "kirkalx",
         "node_id" : "MDQ6VXNlcjE3MDIyODgx",
         "organizations_url" : "https://api.github.com/users/kirkalx/orgs",
         "received_events_url" : "https://api.github.com/users/kirkalx/received_events",
         "repos_url" : "https://api.github.com/users/kirkalx/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kirkalx/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kirkalx/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kirkalx"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Force pushed (no changes), this should give Travis a kick.\n",
      "created_at" : "2016-02-24T06:49:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7577#issuecomment-188107601",
      "id" : 188107601,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7577",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDE4ODEwNzYwMQ==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/188107601/reactions"
      },
      "updated_at" : "2016-02-24T06:49:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/188107601",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, this is a nice step toward factoring out the wallet code (as well as a step towards being able to load multiple wallets).\n\nI do think the return condition is a bit messy, e.g. using both a NULL return value as well as a non-empty errorString as an error condition:\n\n``` patch\n +        if (!pwalletMain)\n +            return false;\n...\n +        if (!errorString.empty())\n +            return InitError(errorString);\n```\n\nIdeally, InitLoadWallet would always return NULL if an error happened, and always fill errorString.\nI understand that this is a change with more impact, though: e.g. make `walletInstance` a scoped pointer, which is released (and then returned) only on success.\n",
      "created_at" : "2016-03-01T15:39:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7577#issuecomment-190775473",
      "id" : 190775473,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7577",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDE5MDc3NTQ3Mw==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/190775473/reactions"
      },
      "updated_at" : "2016-03-01T17:15:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/190775473",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "From the initial work I've done on updating some of Jonas's other wallet patches, this is familiar and I agree it can be confusing, especially in some of the more complicated changes where wallet code calls some other wallet code with its own error handling. The intention is to end up with at least one (and preferably only one) error message in the log if something goes wrong. Worst case scenario if we screw up is that the program just shuts down without an error being reported.\n",
      "created_at" : "2016-03-01T21:24:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7577#issuecomment-190911699",
      "id" : 190911699,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7577",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDE5MDkxMTY5OQ==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/190911699/reactions"
      },
      "updated_at" : "2016-03-01T21:24:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/190911699",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/17022881?v=4",
         "events_url" : "https://api.github.com/users/kirkalx/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kirkalx/followers",
         "following_url" : "https://api.github.com/users/kirkalx/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kirkalx/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kirkalx",
         "id" : 17022881,
         "login" : "kirkalx",
         "node_id" : "MDQ6VXNlcjE3MDIyODgx",
         "organizations_url" : "https://api.github.com/users/kirkalx/orgs",
         "received_events_url" : "https://api.github.com/users/kirkalx/received_events",
         "repos_url" : "https://api.github.com/users/kirkalx/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kirkalx/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kirkalx/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kirkalx"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Agree with @laanwj. I wanted to keep the changes at a minimum because this is not the first try to get this into master.\n\nWill adapt a better return code handling.\n",
      "created_at" : "2016-03-05T18:33:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7577#issuecomment-192704088",
      "id" : 192704088,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7577",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDE5MjcwNDA4OA==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/192704088/reactions"
      },
      "updated_at" : "2016-03-05T18:33:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/192704088",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Sweet, utACK 32ffefc12ba5a5956d64a7c207f0070a11041339. Sorry, no dev machine at present so can't test...\n",
      "created_at" : "2016-03-05T23:02:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7577#issuecomment-192756511",
      "id" : 192756511,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7577",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDE5Mjc1NjUxMQ==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/192756511/reactions"
      },
      "updated_at" : "2016-03-05T23:02:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/192756511",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/17022881?v=4",
         "events_url" : "https://api.github.com/users/kirkalx/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kirkalx/followers",
         "following_url" : "https://api.github.com/users/kirkalx/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kirkalx/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kirkalx",
         "id" : 17022881,
         "login" : "kirkalx",
         "node_id" : "MDQ6VXNlcjE3MDIyODgx",
         "organizations_url" : "https://api.github.com/users/kirkalx/orgs",
         "received_events_url" : "https://api.github.com/users/kirkalx/received_events",
         "repos_url" : "https://api.github.com/users/kirkalx/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kirkalx/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kirkalx/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kirkalx"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Agree with @laanwj. I wanted to keep the changes at a minimum because this is not the first try to get this into master.\n\nYes, changing this may be too risky right now, at least this is straightforward and easy to review.\n\nutACK\n",
      "created_at" : "2016-03-06T20:32:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7577#issuecomment-192983561",
      "id" : 192983561,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7577",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDE5Mjk4MzU2MQ==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/192983561/reactions"
      },
      "updated_at" : "2016-03-06T20:32:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/192983561",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Needs rebase after #7576\n",
      "created_at" : "2016-03-11T07:41:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7577#issuecomment-195235979",
      "id" : 195235979,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7577",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDE5NTIzNTk3OQ==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/195235979/reactions"
      },
      "updated_at" : "2016-03-11T07:41:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/195235979",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased.\n",
      "created_at" : "2016-03-11T13:41:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7577#issuecomment-195365945",
      "id" : 195365945,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7577",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDE5NTM2NTk0NQ==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/195365945/reactions"
      },
      "updated_at" : "2016-03-11T13:41:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/195365945",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7577#discussion_r55940542"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7577"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/55940542"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: Please don't mix concatenations (`+=`)and assignments (`=`). You refactored this such that there can only be one error in the `errorString`, so an assignment would be sufficient.\n",
      "commit_id" : "15e6e13624e3bd322db67861ec27bd5f9d18b6e8",
      "created_at" : "2016-03-13T17:32:09Z",
      "diff_hunk" : "@@ -2991,6 +2991,165 @@ std::string CWallet::GetWalletHelpString(bool showDebug)\n     return strUsage;\n }\n \n+CWallet* CWallet::InitLoadWallet(bool fDisableWallet, const std::string& strWalletFile, std::string& warningString, std::string& errorString)\n+{\n+    // needed to restore wallet transaction meta data after -zapwallettxes\n+    std::vector<CWalletTx> vWtx;\n+\n+    if (GetBoolArg(\"-zapwallettxes\", false)) {\n+        uiInterface.InitMessage(_(\"Zapping all transactions from wallet...\"));\n+\n+        CWallet *tempWallet = new CWallet(strWalletFile);\n+        DBErrors nZapWalletRet = tempWallet->ZapWalletTx(vWtx);\n+        if (nZapWalletRet != DB_LOAD_OK) {\n+            errorString = _(\"Error loading wallet.dat: Wallet corrupted\");\n+            uiInterface.InitMessage(_(\"Error loading wallet.dat: Wallet corrupted\"));\n+            return NULL;\n+        }\n+\n+        delete tempWallet;\n+        tempWallet = NULL;\n+    }\n+\n+    uiInterface.InitMessage(_(\"Loading wallet...\"));\n+\n+    int64_t nStart = GetTimeMillis();\n+    bool fFirstRun = true;\n+    CWallet *walletInstance = new CWallet(strWalletFile);\n+    DBErrors nLoadWalletRet = walletInstance->LoadWallet(fFirstRun);\n+    if (nLoadWalletRet != DB_LOAD_OK)\n+    {\n+        if (nLoadWalletRet == DB_CORRUPT)\n+            errorString += _(\"Error loading wallet.dat: Wallet corrupted\") + \"\\n\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7577#discussion_r55940542",
      "id" : 55940542,
      "line" : 3023,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTQwNTQy",
      "original_commit_id" : "4841d7d9acc69e557edd683f6ad6812459d741ec",
      "original_line" : null,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 33,
      "pull_request_review_id" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7577",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/55940542/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2016-03-14T08:33:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/55940542",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7577#discussion_r55941026"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7577"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/55941026"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You'd have to move this above the `return NULL`. (or remove it, as it is dead code)\n",
      "commit_id" : "15e6e13624e3bd322db67861ec27bd5f9d18b6e8",
      "created_at" : "2016-03-13T17:59:28Z",
      "diff_hunk" : "@@ -2991,6 +2991,165 @@ std::string CWallet::GetWalletHelpString(bool showDebug)\n     return strUsage;\n }\n \n+CWallet* CWallet::InitLoadWallet(bool fDisableWallet, const std::string& strWalletFile, std::string& warningString, std::string& errorString)\n+{\n+    // needed to restore wallet transaction meta data after -zapwallettxes\n+    std::vector<CWalletTx> vWtx;\n+\n+    if (GetBoolArg(\"-zapwallettxes\", false)) {\n+        uiInterface.InitMessage(_(\"Zapping all transactions from wallet...\"));\n+\n+        CWallet *tempWallet = new CWallet(strWalletFile);\n+        DBErrors nZapWalletRet = tempWallet->ZapWalletTx(vWtx);\n+        if (nZapWalletRet != DB_LOAD_OK) {\n+            errorString = _(\"Error loading wallet.dat: Wallet corrupted\");\n+            uiInterface.InitMessage(_(\"Error loading wallet.dat: Wallet corrupted\"));\n+            return NULL;\n+        }\n+\n+        delete tempWallet;\n+        tempWallet = NULL;\n+    }\n+\n+    uiInterface.InitMessage(_(\"Loading wallet...\"));\n+\n+    int64_t nStart = GetTimeMillis();\n+    bool fFirstRun = true;\n+    CWallet *walletInstance = new CWallet(strWalletFile);\n+    DBErrors nLoadWalletRet = walletInstance->LoadWallet(fFirstRun);\n+    if (nLoadWalletRet != DB_LOAD_OK)\n+    {\n+        if (nLoadWalletRet == DB_CORRUPT)\n+            errorString += _(\"Error loading wallet.dat: Wallet corrupted\") + \"\\n\";\n+        else if (nLoadWalletRet == DB_NONCRITICAL_ERROR)\n+        {\n+            warningString += _(\"Error reading wallet.dat! All keys read correctly, but transaction data\"\n+                          \" or address book entries might be missing or incorrect.\");\n+        }\n+        else if (nLoadWalletRet == DB_TOO_NEW)\n+            errorString += strprintf(_(\"Error loading wallet.dat: Wallet requires newer version of %s\"), _(PACKAGE_NAME)) + \"\\n\";\n+        else if (nLoadWalletRet == DB_NEED_REWRITE)\n+        {\n+            errorString += strprintf(_(\"Wallet needed to be rewritten: restart %s to complete\"), _(PACKAGE_NAME)) + \"\\n\";\n+            LogPrintf(\"%s\", errorString);\n+        }\n+        else\n+            errorString += _(\"Error loading wallet.dat\") + \"\\n\";\n+\n+        if (!errorString.empty())\n+            return NULL;\n+    }\n+\n+    if (GetBoolArg(\"-upgradewallet\", fFirstRun))\n+    {\n+        int nMaxVersion = GetArg(\"-upgradewallet\", 0);\n+        if (nMaxVersion == 0) // the -upgradewallet without argument case\n+        {\n+            LogPrintf(\"Performing wallet upgrade to %i\\n\", FEATURE_LATEST);\n+            nMaxVersion = CLIENT_VERSION;\n+            walletInstance->SetMinVersion(FEATURE_LATEST); // permanently upgrade the wallet immediately\n+        }\n+        else\n+            LogPrintf(\"Allowing wallet upgrade up to %i\\n\", nMaxVersion);\n+        if (nMaxVersion < walletInstance->GetVersion())\n+        {\n+            errorString += _(\"Cannot downgrade wallet\") + \"\\n\";\n+            return NULL;\n+        }\n+        walletInstance->SetMaxVersion(nMaxVersion);\n+    }\n+\n+    if (fFirstRun)\n+    {\n+        // Create new keyUser and set as default key\n+        RandAddSeedPerfmon();\n+\n+        CPubKey newDefaultKey;\n+        if (walletInstance->GetKeyFromPool(newDefaultKey)) {\n+            walletInstance->SetDefaultKey(newDefaultKey);\n+            if (!walletInstance->SetAddressBook(walletInstance->vchDefaultKey.GetID(), \"\", \"receive\"))\n+            {\n+                errorString += _(\"Cannot write default address\") += \"\\n\";\n+                return NULL;\n+            }\n+        }\n+\n+        walletInstance->SetBestChain(chainActive.GetLocator());\n+    }\n+\n+    LogPrintf(\"%s\", errorString);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7577#discussion_r55941026",
      "id" : 55941026,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTQxMDI2",
      "original_commit_id" : "4841d7d9acc69e557edd683f6ad6812459d741ec",
      "original_line" : null,
      "original_position" : 90,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7577",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/55941026/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2016-03-14T08:33:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/55941026",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK  4841d7d\n",
      "created_at" : "2016-03-13T18:09:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7577#issuecomment-196014847",
      "id" : 196014847,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7577",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDE5NjAxNDg0Nw==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/196014847/reactions"
      },
      "updated_at" : "2016-03-13T18:09:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/196014847",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7577#discussion_r55967499"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7577"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/55967499"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "My main focus was it to make the change as \"moveonly\" as possible. The current code also concats error strings (https://github.com/bitcoin/bitcoin/pull/7577/files#diff-c865a8939105e6350a50af02766291b7L1454).\n\nIMO best strategy is to move the wallet code away from init.cpp, then optimize it. This changes was already included in two closed PR (which where closed due to inactivity and lack of review).\nWe probably should distinct between refactor/\"moveonly-ish\" PRs and behavior change PRs.\n",
      "commit_id" : "15e6e13624e3bd322db67861ec27bd5f9d18b6e8",
      "created_at" : "2016-03-14T08:29:48Z",
      "diff_hunk" : "@@ -2991,6 +2991,165 @@ std::string CWallet::GetWalletHelpString(bool showDebug)\n     return strUsage;\n }\n \n+CWallet* CWallet::InitLoadWallet(bool fDisableWallet, const std::string& strWalletFile, std::string& warningString, std::string& errorString)\n+{\n+    // needed to restore wallet transaction meta data after -zapwallettxes\n+    std::vector<CWalletTx> vWtx;\n+\n+    if (GetBoolArg(\"-zapwallettxes\", false)) {\n+        uiInterface.InitMessage(_(\"Zapping all transactions from wallet...\"));\n+\n+        CWallet *tempWallet = new CWallet(strWalletFile);\n+        DBErrors nZapWalletRet = tempWallet->ZapWalletTx(vWtx);\n+        if (nZapWalletRet != DB_LOAD_OK) {\n+            errorString = _(\"Error loading wallet.dat: Wallet corrupted\");\n+            uiInterface.InitMessage(_(\"Error loading wallet.dat: Wallet corrupted\"));\n+            return NULL;\n+        }\n+\n+        delete tempWallet;\n+        tempWallet = NULL;\n+    }\n+\n+    uiInterface.InitMessage(_(\"Loading wallet...\"));\n+\n+    int64_t nStart = GetTimeMillis();\n+    bool fFirstRun = true;\n+    CWallet *walletInstance = new CWallet(strWalletFile);\n+    DBErrors nLoadWalletRet = walletInstance->LoadWallet(fFirstRun);\n+    if (nLoadWalletRet != DB_LOAD_OK)\n+    {\n+        if (nLoadWalletRet == DB_CORRUPT)\n+            errorString += _(\"Error loading wallet.dat: Wallet corrupted\") + \"\\n\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7577#discussion_r55967499",
      "id" : 55967499,
      "line" : 3023,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTY3NDk5",
      "original_commit_id" : "4841d7d9acc69e557edd683f6ad6812459d741ec",
      "original_line" : null,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 33,
      "pull_request_review_id" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7577",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/55967499/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2016-03-14T08:33:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/55967499",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7577#discussion_r55967834"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7577"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/55967834"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Right. This is dead code now. Move the log print to the init.cpp error handling (L1434).\n",
      "commit_id" : "15e6e13624e3bd322db67861ec27bd5f9d18b6e8",
      "created_at" : "2016-03-14T08:34:07Z",
      "diff_hunk" : "@@ -2991,6 +2991,165 @@ std::string CWallet::GetWalletHelpString(bool showDebug)\n     return strUsage;\n }\n \n+CWallet* CWallet::InitLoadWallet(bool fDisableWallet, const std::string& strWalletFile, std::string& warningString, std::string& errorString)\n+{\n+    // needed to restore wallet transaction meta data after -zapwallettxes\n+    std::vector<CWalletTx> vWtx;\n+\n+    if (GetBoolArg(\"-zapwallettxes\", false)) {\n+        uiInterface.InitMessage(_(\"Zapping all transactions from wallet...\"));\n+\n+        CWallet *tempWallet = new CWallet(strWalletFile);\n+        DBErrors nZapWalletRet = tempWallet->ZapWalletTx(vWtx);\n+        if (nZapWalletRet != DB_LOAD_OK) {\n+            errorString = _(\"Error loading wallet.dat: Wallet corrupted\");\n+            uiInterface.InitMessage(_(\"Error loading wallet.dat: Wallet corrupted\"));\n+            return NULL;\n+        }\n+\n+        delete tempWallet;\n+        tempWallet = NULL;\n+    }\n+\n+    uiInterface.InitMessage(_(\"Loading wallet...\"));\n+\n+    int64_t nStart = GetTimeMillis();\n+    bool fFirstRun = true;\n+    CWallet *walletInstance = new CWallet(strWalletFile);\n+    DBErrors nLoadWalletRet = walletInstance->LoadWallet(fFirstRun);\n+    if (nLoadWalletRet != DB_LOAD_OK)\n+    {\n+        if (nLoadWalletRet == DB_CORRUPT)\n+            errorString += _(\"Error loading wallet.dat: Wallet corrupted\") + \"\\n\";\n+        else if (nLoadWalletRet == DB_NONCRITICAL_ERROR)\n+        {\n+            warningString += _(\"Error reading wallet.dat! All keys read correctly, but transaction data\"\n+                          \" or address book entries might be missing or incorrect.\");\n+        }\n+        else if (nLoadWalletRet == DB_TOO_NEW)\n+            errorString += strprintf(_(\"Error loading wallet.dat: Wallet requires newer version of %s\"), _(PACKAGE_NAME)) + \"\\n\";\n+        else if (nLoadWalletRet == DB_NEED_REWRITE)\n+        {\n+            errorString += strprintf(_(\"Wallet needed to be rewritten: restart %s to complete\"), _(PACKAGE_NAME)) + \"\\n\";\n+            LogPrintf(\"%s\", errorString);\n+        }\n+        else\n+            errorString += _(\"Error loading wallet.dat\") + \"\\n\";\n+\n+        if (!errorString.empty())\n+            return NULL;\n+    }\n+\n+    if (GetBoolArg(\"-upgradewallet\", fFirstRun))\n+    {\n+        int nMaxVersion = GetArg(\"-upgradewallet\", 0);\n+        if (nMaxVersion == 0) // the -upgradewallet without argument case\n+        {\n+            LogPrintf(\"Performing wallet upgrade to %i\\n\", FEATURE_LATEST);\n+            nMaxVersion = CLIENT_VERSION;\n+            walletInstance->SetMinVersion(FEATURE_LATEST); // permanently upgrade the wallet immediately\n+        }\n+        else\n+            LogPrintf(\"Allowing wallet upgrade up to %i\\n\", nMaxVersion);\n+        if (nMaxVersion < walletInstance->GetVersion())\n+        {\n+            errorString += _(\"Cannot downgrade wallet\") + \"\\n\";\n+            return NULL;\n+        }\n+        walletInstance->SetMaxVersion(nMaxVersion);\n+    }\n+\n+    if (fFirstRun)\n+    {\n+        // Create new keyUser and set as default key\n+        RandAddSeedPerfmon();\n+\n+        CPubKey newDefaultKey;\n+        if (walletInstance->GetKeyFromPool(newDefaultKey)) {\n+            walletInstance->SetDefaultKey(newDefaultKey);\n+            if (!walletInstance->SetAddressBook(walletInstance->vchDefaultKey.GetID(), \"\", \"receive\"))\n+            {\n+                errorString += _(\"Cannot write default address\") += \"\\n\";\n+                return NULL;\n+            }\n+        }\n+\n+        walletInstance->SetBestChain(chainActive.GetLocator());\n+    }\n+\n+    LogPrintf(\"%s\", errorString);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7577#discussion_r55967834",
      "id" : 55967834,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTY3ODM0",
      "original_commit_id" : "4841d7d9acc69e557edd683f6ad6812459d741ec",
      "original_line" : null,
      "original_position" : 90,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7577",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/55967834/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2016-03-14T08:34:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/55967834",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7577#discussion_r55975082"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7577"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/55975082"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It is ugly but was already the case in the previous version. This literally moves the code. Let's leave improvements here to later pulls.\n",
      "commit_id" : "15e6e13624e3bd322db67861ec27bd5f9d18b6e8",
      "created_at" : "2016-03-14T09:43:03Z",
      "diff_hunk" : "@@ -2991,6 +2991,165 @@ std::string CWallet::GetWalletHelpString(bool showDebug)\n     return strUsage;\n }\n \n+CWallet* CWallet::InitLoadWallet(bool fDisableWallet, const std::string& strWalletFile, std::string& warningString, std::string& errorString)\n+{\n+    // needed to restore wallet transaction meta data after -zapwallettxes\n+    std::vector<CWalletTx> vWtx;\n+\n+    if (GetBoolArg(\"-zapwallettxes\", false)) {\n+        uiInterface.InitMessage(_(\"Zapping all transactions from wallet...\"));\n+\n+        CWallet *tempWallet = new CWallet(strWalletFile);\n+        DBErrors nZapWalletRet = tempWallet->ZapWalletTx(vWtx);\n+        if (nZapWalletRet != DB_LOAD_OK) {\n+            errorString = _(\"Error loading wallet.dat: Wallet corrupted\");\n+            uiInterface.InitMessage(_(\"Error loading wallet.dat: Wallet corrupted\"));\n+            return NULL;\n+        }\n+\n+        delete tempWallet;\n+        tempWallet = NULL;\n+    }\n+\n+    uiInterface.InitMessage(_(\"Loading wallet...\"));\n+\n+    int64_t nStart = GetTimeMillis();\n+    bool fFirstRun = true;\n+    CWallet *walletInstance = new CWallet(strWalletFile);\n+    DBErrors nLoadWalletRet = walletInstance->LoadWallet(fFirstRun);\n+    if (nLoadWalletRet != DB_LOAD_OK)\n+    {\n+        if (nLoadWalletRet == DB_CORRUPT)\n+            errorString += _(\"Error loading wallet.dat: Wallet corrupted\") + \"\\n\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7577#discussion_r55975082",
      "id" : 55975082,
      "line" : 3023,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTc1MDgy",
      "original_commit_id" : "4841d7d9acc69e557edd683f6ad6812459d741ec",
      "original_line" : null,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 33,
      "pull_request_review_id" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7577",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/55975082/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2016-03-14T09:43:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/55975082",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7577#discussion_r55984898"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7577"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/55984898"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thx for the quick fix. Good this is merged now.\n",
      "commit_id" : "15e6e13624e3bd322db67861ec27bd5f9d18b6e8",
      "created_at" : "2016-03-14T11:12:25Z",
      "diff_hunk" : "@@ -2991,6 +2991,165 @@ std::string CWallet::GetWalletHelpString(bool showDebug)\n     return strUsage;\n }\n \n+CWallet* CWallet::InitLoadWallet(bool fDisableWallet, const std::string& strWalletFile, std::string& warningString, std::string& errorString)\n+{\n+    // needed to restore wallet transaction meta data after -zapwallettxes\n+    std::vector<CWalletTx> vWtx;\n+\n+    if (GetBoolArg(\"-zapwallettxes\", false)) {\n+        uiInterface.InitMessage(_(\"Zapping all transactions from wallet...\"));\n+\n+        CWallet *tempWallet = new CWallet(strWalletFile);\n+        DBErrors nZapWalletRet = tempWallet->ZapWalletTx(vWtx);\n+        if (nZapWalletRet != DB_LOAD_OK) {\n+            errorString = _(\"Error loading wallet.dat: Wallet corrupted\");\n+            uiInterface.InitMessage(_(\"Error loading wallet.dat: Wallet corrupted\"));\n+            return NULL;\n+        }\n+\n+        delete tempWallet;\n+        tempWallet = NULL;\n+    }\n+\n+    uiInterface.InitMessage(_(\"Loading wallet...\"));\n+\n+    int64_t nStart = GetTimeMillis();\n+    bool fFirstRun = true;\n+    CWallet *walletInstance = new CWallet(strWalletFile);\n+    DBErrors nLoadWalletRet = walletInstance->LoadWallet(fFirstRun);\n+    if (nLoadWalletRet != DB_LOAD_OK)\n+    {\n+        if (nLoadWalletRet == DB_CORRUPT)\n+            errorString += _(\"Error loading wallet.dat: Wallet corrupted\") + \"\\n\";\n+        else if (nLoadWalletRet == DB_NONCRITICAL_ERROR)\n+        {\n+            warningString += _(\"Error reading wallet.dat! All keys read correctly, but transaction data\"\n+                          \" or address book entries might be missing or incorrect.\");\n+        }\n+        else if (nLoadWalletRet == DB_TOO_NEW)\n+            errorString += strprintf(_(\"Error loading wallet.dat: Wallet requires newer version of %s\"), _(PACKAGE_NAME)) + \"\\n\";\n+        else if (nLoadWalletRet == DB_NEED_REWRITE)\n+        {\n+            errorString += strprintf(_(\"Wallet needed to be rewritten: restart %s to complete\"), _(PACKAGE_NAME)) + \"\\n\";\n+            LogPrintf(\"%s\", errorString);\n+        }\n+        else\n+            errorString += _(\"Error loading wallet.dat\") + \"\\n\";\n+\n+        if (!errorString.empty())\n+            return NULL;\n+    }\n+\n+    if (GetBoolArg(\"-upgradewallet\", fFirstRun))\n+    {\n+        int nMaxVersion = GetArg(\"-upgradewallet\", 0);\n+        if (nMaxVersion == 0) // the -upgradewallet without argument case\n+        {\n+            LogPrintf(\"Performing wallet upgrade to %i\\n\", FEATURE_LATEST);\n+            nMaxVersion = CLIENT_VERSION;\n+            walletInstance->SetMinVersion(FEATURE_LATEST); // permanently upgrade the wallet immediately\n+        }\n+        else\n+            LogPrintf(\"Allowing wallet upgrade up to %i\\n\", nMaxVersion);\n+        if (nMaxVersion < walletInstance->GetVersion())\n+        {\n+            errorString += _(\"Cannot downgrade wallet\") + \"\\n\";\n+            return NULL;\n+        }\n+        walletInstance->SetMaxVersion(nMaxVersion);\n+    }\n+\n+    if (fFirstRun)\n+    {\n+        // Create new keyUser and set as default key\n+        RandAddSeedPerfmon();\n+\n+        CPubKey newDefaultKey;\n+        if (walletInstance->GetKeyFromPool(newDefaultKey)) {\n+            walletInstance->SetDefaultKey(newDefaultKey);\n+            if (!walletInstance->SetAddressBook(walletInstance->vchDefaultKey.GetID(), \"\", \"receive\"))\n+            {\n+                errorString += _(\"Cannot write default address\") += \"\\n\";\n+                return NULL;\n+            }\n+        }\n+\n+        walletInstance->SetBestChain(chainActive.GetLocator());\n+    }\n+\n+    LogPrintf(\"%s\", errorString);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7577#discussion_r55984898",
      "id" : 55984898,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTg0ODk4",
      "original_commit_id" : "4841d7d9acc69e557edd683f6ad6812459d741ec",
      "original_line" : null,
      "original_position" : 90,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7577",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/55984898/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2016-03-14T11:12:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/55984898",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
