{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "While working on adapting Miniscript to Tapscript, i [noticed](https://gist.github.com/sipa/06c5c844df155d4e5044c2c8cac9c05e?permalink_comment_id=4434770#gistcomment-4434770) signatures in Tapscript only commit to the leaf (i previously assumed they committed to the whole branch). It's been discussed lately on the mailing list as well ([1](https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2023-February/021452.html), [2](https://github.com/bitcoin-inquisition/bitcoin/issues/19)).  This means if the same script is used in two different leaves, a signature for one can be rebound to the other.\r\n\r\nIf one signed a transaction it shouldn't matter what script path it used as long as the transaction itself didn't change [0]. However, the possibility to change the script path used may cause two issues:\r\n1. It messes up with Miniscript's malleability analysis (and is a malleability vector in itself).\r\n2. It allows to potentially hinder the confirmation of a transaction if the two leaves aren't at the same height ([h/t aj](https://gist.github.com/sipa/06c5c844df155d4e5044c2c8cac9c05e?permalink_comment_id=4434792#gistcomment-4434792)).\r\n\r\nI don't think 1. is a valid point. Miniscript's analysis is about malleability from a third party that only gets to see a single satisfaction. The composition of the tree would not be known to the third party here, therefore they wouldn't be able to malleate.\r\n\r\nThis leaves 2. which is more important in the context of presigned transactions, and in this case we'd expect protocol designers to take great care when designing the descriptors used so it would most likely not be an issue.\r\n\r\nOn the other hand it really is inexpensive to check, and AFAICT it serves no purpose to duplicate a leaf. So we could avoid a potential future footgun we didn't anticipate for cheap?\r\n\r\n@sipa @achow101 @apoelstra @sanket1729 thoughts?\r\n\r\n[0]Â Some may argue this doesn't always hold, while it may be valid it's imo out of scope here.",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 1,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27104/comments",
   "created_at" : "2023-02-15T14:24:42Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27104/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/27104",
   "id" : 1585951774,
   "labels" : [],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27104/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "I_kwDOABII585eh7Qe",
   "number" : 27104,
   "performed_via_github_app" : null,
   "reactions" : {
      "+1" : 0,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 0,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27104/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "state_reason" : null,
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27104/timeline",
   "title" : "Disallow duplicate leaves inside `tr()` descriptors",
   "updated_at" : "2023-02-15T14:25:20Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27104",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
      "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
      "followers_url" : "https://api.github.com/users/darosior/followers",
      "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
      "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/darosior",
      "id" : 22457751,
      "login" : "darosior",
      "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
      "organizations_url" : "https://api.github.com/users/darosior/orgs",
      "received_events_url" : "https://api.github.com/users/darosior/received_events",
      "repos_url" : "https://api.github.com/users/darosior/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/darosior"
   }
}
