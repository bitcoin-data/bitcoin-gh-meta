{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "Closes https://github.com/bitcoin/bitcoin/issues/27051\r\n\r\nWhen the wallet creates a transaction internally, it will also create an alternative that spends using destination groups and see if the fee difference is negligible. If it costs the user the same to send the grouped version, we send it (even if the user has `avoidpartialspends` set to `false` which is default). This patch ensures that the second transaction creation attempt re-uses the change destination selected by the first attempt. Otherwise, the first change address remains reserved, will not be used in the second attempt, and then will never be used by the wallet, leaving gaps in the BIP44 chain.\r\n\r\nIf the user had `avoidpartialspends` set to true, there is no second version of the created transaction and the change addresses are not affected.\r\n\r\nI believe this behavior was introduced in https://github.com/bitcoin/bitcoin/pull/14582",
   "closed_at" : "2023-02-20T17:20:47Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
      "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
      "followers_url" : "https://api.github.com/users/fanquake/followers",
      "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/fanquake",
      "id" : 863730,
      "login" : "fanquake",
      "node_id" : "MDQ6VXNlcjg2MzczMA==",
      "organizations_url" : "https://api.github.com/users/fanquake/orgs",
      "received_events_url" : "https://api.github.com/users/fanquake/received_events",
      "repos_url" : "https://api.github.com/users/fanquake/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/fanquake"
   },
   "comments" : 8,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27053/comments",
   "created_at" : "2023-02-06T20:40:44Z",
   "draft" : false,
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27053/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/27053",
   "id" : 1573246579,
   "labels" : [
      {
         "color" : "08a781",
         "default" : false,
         "description" : null,
         "id" : 149424,
         "name" : "Wallet",
         "node_id" : "MDU6TGFiZWwxNDk0MjQ=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27053/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "PR_kwDOABII585JYARt",
   "number" : 27053,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/27053.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27053",
      "merged_at" : "2023-02-20T17:20:47Z",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/27053.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27053"
   },
   "reactions" : {
      "+1" : 0,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 0,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27053/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "state_reason" : null,
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27053/timeline",
   "title" : "wallet: reuse change dest when re-creating TX with avoidpartialspends",
   "updated_at" : "2023-02-20T17:27:05Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27053",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
      "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
      "followers_url" : "https://api.github.com/users/pinheadmz/followers",
      "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
      "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/pinheadmz",
      "id" : 2084648,
      "login" : "pinheadmz",
      "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
      "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
      "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
      "repos_url" : "https://api.github.com/users/pinheadmz/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/pinheadmz"
   }
}
