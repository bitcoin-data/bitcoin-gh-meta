[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9630#discussion_r97853843"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9630"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/97853843"
         }
      },
      "body" : "This sounds like logic that belongs in LoadBlockIndex, not in the basic data structure logic.",
      "commit_id" : "d180c15ef812a1053db941f56dbb4a1707c87b4b",
      "created_at" : "2017-01-25T19:06:25Z",
      "diff_hunk" : "@@ -99,8 +100,12 @@ CBlockIndex* CBlockIndex::GetAncestor(int height)\n             // Only follow pskip if pprev->pskip isn't better than pskip->pprev.\n             pindexWalk = pindexWalk->pskip;\n             heightWalk = heightSkip;\n+        } else if (pindexWalk->pprev == NULL) {\n+            // pindexWalk should always have a parent (since pindexWalk is not the genesis block)\n+            LogPrintf(\"%s: Block index is missing a block. Block %s, height %d has no parent.\\n\",  __func__, pindexWalk->GetBlockHash().ToString(), heightWalk);\n+            LogPrintf(\"%s: Run bitcoin with -reindex to rebuild the block index. This will redownload the entire blockchain if running a pruned node.\\n\",  __func__);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9630#discussion_r97853843",
      "id" : 97853843,
      "original_commit_id" : "d180c15ef812a1053db941f56dbb4a1707c87b4b",
      "original_position" : 15,
      "path" : "src/chain.cpp",
      "position" : 15,
      "pull_request_review_id" : 18476918,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9630",
      "updated_at" : "2017-01-25T19:06:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/97853843",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "Concept ACK, also did this a few times while debugging but never bothered to PR it.\r\n\r\nAgree with @sipa that logging doesn't belong here, but in the caller, to which the error condition would need to be signalled in some way.\r\n\r\nAlso: should we use AbortNode instead of abort() to make sure GUI users get a popup to check the debug log?",
      "created_at" : "2017-01-26T18:47:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9630#issuecomment-275475094",
      "id" : 275475094,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9630",
      "updated_at" : "2017-01-26T18:47:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/275475094",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sipa @laanwj thanks for the feedback. I'll take a look at putting the logging into the caller.",
      "created_at" : "2017-01-26T22:24:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9630#issuecomment-275533279",
      "id" : 275533279,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9630",
      "updated_at" : "2017-01-26T22:24:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/275533279",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK but agree with the feedback.",
      "created_at" : "2017-03-18T19:51:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9630#issuecomment-287570274",
      "id" : 287570274,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9630",
      "updated_at" : "2017-03-18T19:51:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/287570274",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1008458?v=4",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Closing this for now. I'll reopen once I've changed this to incorporate the feedback.",
      "created_at" : "2017-03-30T18:34:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9630#issuecomment-290503960",
      "id" : 290503960,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9630",
      "updated_at" : "2017-03-30T18:34:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/290503960",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Hello, i see this assertion error showing on a MessageBox ( i'm under Windows ):\r\n\r\n```\r\nAssertion Failed!\r\nProgram: C:\\Program Files\\Bitcoin\\bitcoin-qt.exe\r\nFile: chain.cpp Line 101\r\nExpression: pIndexWalk->prev\r\n```\r\n\r\nThe logs seem not to be helpful.\r\ndb.log is empty, and this is from debug.log:\r\n\r\n```\r\n2018-01-16 22:10:31 Bitcoin version v0.14.2\r\n2018-01-16 22:10:31 InitParameterInteraction: parameter interaction: -whitelistforcerelay=1 -> setting -whitelistrelay=1\r\n2018-01-16 22:10:31 Assuming ancestors of block 00000000000000000013176bf8d7dfeab4e1db31dc93bc311b436e82ab226b90 have valid signatures.\r\n2018-01-16 22:10:31 GUI: \"registerShutdownBlockReason: Successfully registered: Bitcoin Core didn't yet exit safely...\"\r\n2018-01-16 22:10:31 Default data directory C:\\Users\\Developer\\AppData\\Roaming\\Bitcoin\r\n2018-01-16 22:10:31 Using data directory X:\\btc-wallet\r\n2018-01-16 22:10:31 Using config file X:\\btc-wallet\\bitcoin.conf\r\n2018-01-16 22:10:31 Using at most 125 automatic connections (2048 file descriptors available)\r\n2018-01-16 22:10:31 Using 32 MiB out of 32 requested for signature cache, able to store 1048576 elements\r\n2018-01-16 22:10:31 Using 2 threads for script verification\r\n2018-01-16 22:10:31 scheduler thread start\r\n2018-01-16 22:10:31 libevent: getaddrinfo: nodename nor servname provided, or not known\r\n2018-01-16 22:10:31 Binding RPC on address ::1 port 8332 failed.\r\n2018-01-16 22:10:31 HTTP: creating work queue of depth 16\r\n2018-01-16 22:10:31 Config options rpcuser and rpcpassword will soon be deprecated. Locally-run instances may remove rpcuser to use cookie-based auth, or may be replaced with rpcauth. Please see share/rpcuser for rpcauth auth generation.\r\n2018-01-16 22:10:31 HTTP: starting 4 worker threads\r\n2018-01-16 22:10:31 Using BerkeleyDB version Berkeley DB 4.8.30: (April  9, 2010)\r\n2018-01-16 22:10:31 Using wallet wallet.dat\r\n2018-01-16 22:10:31 init message: Verifying wallet...\r\n2018-01-16 22:10:31 CDBEnv::Open: LogDir=X:\\btc-wallet\\database ErrorFile=X:\\btc-wallet\\db.log\r\n2018-01-16 22:10:31 Bound to [::]:8333\r\n2018-01-16 22:10:31 Bound to 0.0.0.0:8333\r\n2018-01-16 22:10:31 Cache configuration:\r\n2018-01-16 22:10:31 * Using 2.0MiB for block index database\r\n2018-01-16 22:10:31 * Using 8.0MiB for chain state database\r\n2018-01-16 22:10:31 * Using 440.0MiB for in-memory UTXO set (plus up to 286.1MiB of unused mempool space)\r\n2018-01-16 22:10:31 init message: Loading block index...\r\n2018-01-16 22:10:31 Opening LevelDB in X:\\btc-wallet\\blocks\\index\r\n2018-01-16 22:10:31 Opened LevelDB successfully\r\n2018-01-16 22:10:31 Using obfuscation key for X:\\btc-wallet\\blocks\\index: 0000000000000000\r\n2018-01-16 22:10:31 Opening LevelDB in X:\\btc-wallet\\chainstate\r\n2018-01-16 22:10:31 Opened LevelDB successfully\r\n2018-01-16 22:10:31 Using obfuscation key for X:\\btc-wallet\\chainstate: 63e0585ea48cf626\r\n2018-01-16 22:12:41 \r\n\r\n\r\n\r\n2018-01-16 22:12:41 Bitcoin version v0.14.2\r\n2018-01-16 22:12:41 InitParameterInteraction: parameter interaction: -whitelistforcerelay=1 -> setting -whitelistrelay=1\r\n2018-01-16 22:12:41 Assuming ancestors of block 00000000000000000013176bf8d7dfeab4e1db31dc93bc311b436e82ab226b90 have valid signatures.\r\n2018-01-16 22:12:41 GUI: \"registerShutdownBlockReason: Successfully registered: Bitcoin Core didn't yet exit safely...\"\r\n2018-01-16 22:12:42 Default data directory C:\\Users\\Developer\\AppData\\Roaming\\Bitcoin\r\n2018-01-16 22:12:42 Using data directory X:\\btc-wallet\r\n2018-01-16 22:12:42 Using config file X:\\btc-wallet\\bitcoin.conf\r\n2018-01-16 22:12:42 Using at most 125 automatic connections (2048 file descriptors available)\r\n2018-01-16 22:12:42 Using 32 MiB out of 32 requested for signature cache, able to store 1048576 elements\r\n2018-01-16 22:12:42 Using 2 threads for script verification\r\n2018-01-16 22:12:42 scheduler thread start\r\n2018-01-16 22:12:42 libevent: getaddrinfo: nodename nor servname provided, or not known\r\n2018-01-16 22:12:42 Binding RPC on address ::1 port 8332 failed.\r\n2018-01-16 22:12:42 HTTP: creating work queue of depth 16\r\n2018-01-16 22:12:42 Config options rpcuser and rpcpassword will soon be deprecated. Locally-run instances may remove rpcuser to use cookie-based auth, or may be replaced with rpcauth. Please see share/rpcuser for rpcauth auth generation.\r\n2018-01-16 22:12:42 HTTP: starting 4 worker threads\r\n2018-01-16 22:12:42 Using BerkeleyDB version Berkeley DB 4.8.30: (April  9, 2010)\r\n2018-01-16 22:12:42 Using wallet wallet.dat\r\n2018-01-16 22:12:42 init message: Verifying wallet...\r\n2018-01-16 22:12:42 CDBEnv::Open: LogDir=X:\\btc-wallet\\database ErrorFile=X:\\btc-wallet\\db.log\r\n2018-01-16 22:12:42 Bound to [::]:8333\r\n2018-01-16 22:12:42 Bound to 0.0.0.0:8333\r\n2018-01-16 22:12:42 Cache configuration:\r\n2018-01-16 22:12:42 * Using 2.0MiB for block index database\r\n2018-01-16 22:12:42 * Using 8.0MiB for chain state database\r\n2018-01-16 22:12:42 * Using 440.0MiB for in-memory UTXO set (plus up to 286.1MiB of unused mempool space)\r\n2018-01-16 22:12:42 init message: Loading block index...\r\n2018-01-16 22:12:42 Opening LevelDB in X:\\btc-wallet\\blocks\\index\r\n2018-01-16 22:12:42 Opened LevelDB successfully\r\n2018-01-16 22:12:42 Using obfuscation key for X:\\btc-wallet\\blocks\\index: 0000000000000000\r\n2018-01-16 22:12:42 Opening LevelDB in X:\\btc-wallet\\chainstate\r\n2018-01-16 22:12:42 Opened LevelDB successfully\r\n2018-01-16 22:12:42 Using obfuscation key for X:\\btc-wallet\\chainstate: 63e0585ea48cf626\r\n```\r\n\r\nI have tried removing peers.dat ,  to no avail.\r\nThen i removed .lock and every .dat and .log file except wallet.dat and retried. \r\nDid not help.\r\n\r\nWhat else can i try ?\r\nI wish not to re-download the whole blockchain, it may take even a whole week\r\nThanks\r\n\r\n\r\n.......\r\nEDIT: i had an electricity blackout today and my PC crashed, so i might have disk errors. Will run a chkdisk and retry.\r\n\r\nBut i have to say that last night my wallet was synchronized and i closed it, then i have backupped the whole blocks/ and chainstate/ folders to another drive.\r\n\r\nToday after the blackout/crash , before retrying to open Bitcoin Core, i removed those 2 folders and restored from the backups altogether, but apparently that was not enough.\r\n\r\nMaybe i was stupid not thinking to backup the whole wallet folder, and not just blocks/ and chainstate/ .\r\nDo you think it would be enough as a backup routine?\r\nThanks\r\n.......\r\n\r\n\r\n\r\n",
      "created_at" : "2018-01-16T22:19:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9630#issuecomment-358127101",
      "id" : 358127101,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9630",
      "updated_at" : "2018-01-17T00:23:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/358127101",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/22989619?v=4",
         "events_url" : "https://api.github.com/users/sleepndevelop/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sleepndevelop/followers",
         "following_url" : "https://api.github.com/users/sleepndevelop/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sleepndevelop/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sleepndevelop",
         "id" : 22989619,
         "login" : "sleepndevelop",
         "organizations_url" : "https://api.github.com/users/sleepndevelop/orgs",
         "received_events_url" : "https://api.github.com/users/sleepndevelop/received_events",
         "repos_url" : "https://api.github.com/users/sleepndevelop/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sleepndevelop/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sleepndevelop/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sleepndevelop"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "UPDATE: chkdsk did not help, but i got away with the -reindex wallet flag.\r\nIt is taking a lot of time though",
      "created_at" : "2018-01-17T04:56:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9630#issuecomment-358197129",
      "id" : 358197129,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9630",
      "updated_at" : "2018-01-17T04:56:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/358197129",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/22989619?v=4",
         "events_url" : "https://api.github.com/users/sleepndevelop/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sleepndevelop/followers",
         "following_url" : "https://api.github.com/users/sleepndevelop/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sleepndevelop/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sleepndevelop",
         "id" : 22989619,
         "login" : "sleepndevelop",
         "organizations_url" : "https://api.github.com/users/sleepndevelop/orgs",
         "received_events_url" : "https://api.github.com/users/sleepndevelop/received_events",
         "repos_url" : "https://api.github.com/users/sleepndevelop/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sleepndevelop/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sleepndevelop/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sleepndevelop"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@sleepndevelop `-reindex` worked for me but took over an hour on the testnet.\r\n\r\nI wonder if `-reindex-chainstate` would've worked ([should be faster](https://bitcoin.stackexchange.com/a/60711/44541)).",
      "created_at" : "2018-05-03T11:33:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9630#issuecomment-386265547",
      "id" : 386265547,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9630",
      "updated_at" : "2018-05-03T11:33:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/386265547",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/4957940?v=4",
         "events_url" : "https://api.github.com/users/Andrade/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Andrade/followers",
         "following_url" : "https://api.github.com/users/Andrade/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Andrade/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Andrade",
         "id" : 4957940,
         "login" : "Andrade",
         "organizations_url" : "https://api.github.com/users/Andrade/orgs",
         "received_events_url" : "https://api.github.com/users/Andrade/received_events",
         "repos_url" : "https://api.github.com/users/Andrade/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Andrade/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Andrade/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Andrade"
      }
   }
]
