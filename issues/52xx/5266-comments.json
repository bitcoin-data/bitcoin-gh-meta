[
   {
      "body" : "Would it be possible to use the `dumpwallet` RPC output instead, it's much easier to parse and likely to remain usable in more software longer. On the downside, it's not natively encrypted.",
      "created_at" : "2014-11-12T20:41:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5266#issuecomment-62789467",
      "id" : 62789467,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5266",
      "updated_at" : "2014-11-12T20:54:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/62789467",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@sipa hmm... it would be more open to other wallets. correct. On the other hand; how easy would it be for endusers to restore a backup? I think there is no easy way to import a RPC dumped wallet.\r\nIMO, endusers should just have <n> valid file(s) where they can restore. But a reasonable question is, how users could load a bitcoin-core wallet into other wallet-apps. But this might be out of scope for the backup-process because it affects also the non-backup wallet.dat.",
      "created_at" : "2014-11-12T20:51:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5266#issuecomment-62791001",
      "id" : 62791001,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5266",
      "updated_at" : "2014-11-12T20:51:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/62791001",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Yes there is a way to import it, using `importwallet`.",
      "created_at" : "2014-11-12T20:54:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5266#issuecomment-62791452",
      "id" : 62791452,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5266",
      "updated_at" : "2014-11-12T20:54:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/62791452",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@sipa: ah. right. Somebody should update https://en.bitcoin.it/wiki/Original_Bitcoin_client/API_calls_list :)\r\nBut the enduser then could not just restore the wallet.dat file... or we could detect if the wallet.dat is RPC dumped file and import it straight.\r\nI would prefer to have a restore possibility on file level.",
      "created_at" : "2014-11-12T21:01:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5266#issuecomment-62792680",
      "id" : 62792680,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5266",
      "updated_at" : "2014-11-12T21:01:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/62792680",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "@jonasschnelli the GUI has no way to restore a backup at all - whether it's done using backupwallet or dumpwallet. That definitely needs fixing, but I would really advise against using the BDB-based format for anything but legacy.",
      "created_at" : "2014-11-12T21:04:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5266#issuecomment-62793121",
      "id" : 62793121,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5266",
      "updated_at" : "2014-11-12T21:04:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/62793121",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@sipa i just thought through the whole thing again. Your right. Restore per file won't work anyway without rescan everything.\r\nI'll change it to use RPC walletdumped format.\r\nEnduser with limited IT understanding should import it through the Qt client (where i will focus on as soon as the basic things are sorted out).",
      "created_at" : "2014-11-12T21:33:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5266#issuecomment-62798248",
      "id" : 62798248,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5266",
      "updated_at" : "2014-11-12T21:33:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/62798248",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "@sipa i only see a huge drawback when using the walletdumps-txt: encryption. Unencrypted wallet dumps is IMO very risky. Of course we could encrypt the dumps before the go to the filesystem. But this lead to the question what passphrase/key we use for encrypting the backups dumps. Maybe adding a \"backup-key\" to the wallet would be a overhead?\r\nAny ideas how we could solve that in a nice way?",
      "created_at" : "2014-11-13T07:28:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5266#issuecomment-62851679",
      "id" : 62851679,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5266",
      "updated_at" : "2014-11-13T07:35:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/62851679",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Good point about `dumpwallet` format not being encrypted. We should definitely support that. \r\n\r\nFor example Schildback's Bitcoin Wallet uses a format similar to our dumpwallet format, one line per key, but encrypts the file before writing. This can be decrypted from the command line using `openssl enc -d -aes-256-cbc -a -in` (see https://github.com/schildbach/bitcoin-wallet/blob/master/wallet/README.recover ), or of course imported back into the application.\r\n\r\nAs for the key, would be multiple options there:\r\n- Encrypt the file with the same key as used for the wallet (easy for the user, but not very secure)\r\n- Ask the user for a password every time backing up, and add a \"password\" parameter to the dumpwallet RPC call (easiest to implement, most transparent to the user)\r\n- As you say, store a \"backup key\" in the settings\r\n",
      "created_at" : "2014-11-13T09:52:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5266#issuecomment-62866550",
      "id" : 62866550,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5266",
      "updated_at" : "2014-11-13T09:54:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/62866550",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "I think we should encrypt the dumps with a key derived from the same password the wallet is encrypted.\r\n\r\nAdditional to that, for experience users, we could allow to set a base64 encoded EC PubKey in the bitcoinconf. The dumps then could be encrypted aes-256-cbc creating a random key with EVP_Seal. The encrypted key length and data will be stored in the dump.\r\nWith that, experience users could do encrypted backups with keeping their backup key secret.",
      "created_at" : "2014-11-13T15:34:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5266#issuecomment-62908118",
      "id" : 62908118,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5266",
      "updated_at" : "2014-11-13T15:34:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/62908118",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Please don't introduce yet another encryption format in the system if it can all be avoided, analyizing and maintaining two is additional work I'd rather avoid.   The simpler thing is to just backup the existing files, then we're sure to get all the data, sure that it's already encrypted and not creating additional exposure, etc.",
      "created_at" : "2014-11-13T23:03:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5266#issuecomment-62982835",
      "id" : 62982835,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5266",
      "updated_at" : "2014-11-13T23:03:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/62982835",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "@gmaxwell agreed. Than i keep the pull request as it is. For now we backup just the wallet.dat. Dumping is IMO not a backup because it lacks of metadata (dump != backup). A backup should be somehow a 1:1 copy.\r\nIf a user enables `-backupsdumps` AND `-backupsallowunencrypted` he can do unencrypted dumps as backups.\r\n\r\nBefore working on encrypted dumps as backup possibilities i would prefer to implement the/a backup mechanism in the GUI.",
      "created_at" : "2014-11-14T07:53:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5266#issuecomment-63021148",
      "id" : 63021148,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5266",
      "updated_at" : "2014-11-14T07:53:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/63021148",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/5266#discussion_r20348410"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5266"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/20348410"
         }
      },
      "body" : "By \"Bitcoin Core\" :)?",
      "commit_id" : "b4afdb4ada50e231a49d0eca2364616aa35bd1a8",
      "created_at" : "2014-11-14T09:03:28Z",
      "diff_hunk" : "@@ -2261,6 +2287,48 @@ bool CWallet::GetDestData(const CTxDestination &dest, const std::string &key, st\n     return false;\n }\n \n+bool CWallet::DumpToStream(std::ostream& stream)\n+{\n+    std::map<CKeyID, int64_t> mapKeyBirth;\n+    std::set<CKeyID> setKeyPool;\n+    this->GetKeyBirthTimes(mapKeyBirth);\n+    this->GetAllReserveKeys(setKeyPool);\n+\n+    // sort time/key pairs\n+    std::vector<std::pair<int64_t, CKeyID> > vKeyBirth;\n+    for (std::map<CKeyID, int64_t>::const_iterator it = mapKeyBirth.begin(); it != mapKeyBirth.end(); it++) {\n+        vKeyBirth.push_back(std::make_pair(it->second, it->first));\n+    }\n+    mapKeyBirth.clear();\n+    std::sort(vKeyBirth.begin(), vKeyBirth.end());\n+\n+    // produce output\n+    stream << strprintf(\"# Wallet dump created by Bitcoin %s (%s)\\n\", CLIENT_BUILD, CLIENT_DATE);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5266#discussion_r20348410",
      "id" : 20348410,
      "original_commit_id" : "9f39fc05033c89c3a0b43df66f5ff44b63eae1fc",
      "original_position" : 83,
      "path" : "src/wallet.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5266",
      "updated_at" : "2014-11-14T13:20:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/20348410",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=3",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/5266#discussion_r20348474"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5266"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/20348474"
         }
      },
      "body" : "You were missing a few months here, so this will be my only nit for you ;). Can you please try to use alphabetical ordering for such includes (see e.g. most other files). This belongs to the top of the boost includes.",
      "commit_id" : "b4afdb4ada50e231a49d0eca2364616aa35bd1a8",
      "created_at" : "2014-11-14T09:04:56Z",
      "diff_hunk" : "@@ -13,10 +13,14 @@\n #include \"utiltime.h\"\n #include \"wallet.h\"\n \n+#include <fstream>\n+\n #include <boost/filesystem.hpp>\n #include <boost/foreach.hpp>\n #include <boost/scoped_ptr.hpp>\n #include <boost/thread.hpp>\n+#include <boost/algorithm/string.hpp>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5266#discussion_r20348474",
      "id" : 20348474,
      "original_commit_id" : "9f39fc05033c89c3a0b43df66f5ff44b63eae1fc",
      "original_position" : 10,
      "path" : "src/walletdb.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5266",
      "updated_at" : "2014-11-14T13:20:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/20348474",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=3",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/5266#discussion_r20348561"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5266"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/20348561"
         }
      },
      "body" : "IMHO the default path could be set as the second parameter here and directly converted to a boost::path perhaps?\r\nThat could remove the if-else below.",
      "commit_id" : "b4afdb4ada50e231a49d0eca2364616aa35bd1a8",
      "created_at" : "2014-11-14T09:06:55Z",
      "diff_hunk" : "@@ -889,6 +893,157 @@ bool BackupWallet(const CWallet& wallet, const string& strDest)\n     return false;\n }\n \n+std::map<std::time_t, filesystem::path> CWalletDB::GetAvailableBackups()\n+{\n+    filesystem::path backupDir;\n+    std::string strBackupsDir   = GetArg(\"-backupspath\", \"\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5266#discussion_r20348561",
      "id" : 20348561,
      "original_commit_id" : "9f39fc05033c89c3a0b43df66f5ff44b63eae1fc",
      "original_position" : 22,
      "path" : "src/walletdb.cpp",
      "position" : 18,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5266",
      "updated_at" : "2014-11-14T13:20:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/20348561",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=3",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/5266#discussion_r20348585"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5266"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/20348585"
         }
      },
      "body" : "Nit: Some comments in the code would be nice.",
      "commit_id" : "b4afdb4ada50e231a49d0eca2364616aa35bd1a8",
      "created_at" : "2014-11-14T09:07:30Z",
      "diff_hunk" : "@@ -889,6 +893,157 @@ bool BackupWallet(const CWallet& wallet, const string& strDest)\n     return false;\n }\n \n+std::map<std::time_t, filesystem::path> CWalletDB::GetAvailableBackups()\n+{\n+    filesystem::path backupDir;\n+    std::string strBackupsDir   = GetArg(\"-backupspath\", \"\");\n+    if(strBackupsDir != \"\")\n+        backupDir = boost::filesystem::path(strBackupsDir);\n+    else\n+    {\n+        backupDir = GetDataDir() / DEFAULT_BACKUPS_DIR;\n+    }\n+    \n+    std::map<std::time_t, filesystem::path> backupFiles;\n+    \n+    try {\n+        if(!filesystem::is_directory(backupDir))\n+            return backupFiles;\n+        \n+        filesystem::directory_iterator it(backupDir), eod;\n+        BOOST_FOREACH(filesystem::path const &p, std::make_pair(it, eod))\n+        {\n+            if(is_regular_file(p) && (ends_with(p.string(), BACKUP_BDB_EXTENSION) || ends_with(p.string(), BACKUP_DUMP_EXTENSION)))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5266#discussion_r20348585",
      "id" : 20348585,
      "original_commit_id" : "9f39fc05033c89c3a0b43df66f5ff44b63eae1fc",
      "original_position" : 39,
      "path" : "src/walletdb.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5266",
      "updated_at" : "2014-11-14T13:20:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/20348585",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=3",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/5266#discussion_r20348609"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5266"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/20348609"
         }
      },
      "body" : "Is this return needed or will we reach the function end after the catch anyway?",
      "commit_id" : "b4afdb4ada50e231a49d0eca2364616aa35bd1a8",
      "created_at" : "2014-11-14T09:08:16Z",
      "diff_hunk" : "@@ -889,6 +893,157 @@ bool BackupWallet(const CWallet& wallet, const string& strDest)\n     return false;\n }\n \n+std::map<std::time_t, filesystem::path> CWalletDB::GetAvailableBackups()\n+{\n+    filesystem::path backupDir;\n+    std::string strBackupsDir   = GetArg(\"-backupspath\", \"\");\n+    if(strBackupsDir != \"\")\n+        backupDir = boost::filesystem::path(strBackupsDir);\n+    else\n+    {\n+        backupDir = GetDataDir() / DEFAULT_BACKUPS_DIR;\n+    }\n+    \n+    std::map<std::time_t, filesystem::path> backupFiles;\n+    \n+    try {\n+        if(!filesystem::is_directory(backupDir))\n+            return backupFiles;\n+        \n+        filesystem::directory_iterator it(backupDir), eod;\n+        BOOST_FOREACH(filesystem::path const &p, std::make_pair(it, eod))\n+        {\n+            if(is_regular_file(p) && (ends_with(p.string(), BACKUP_BDB_EXTENSION) || ends_with(p.string(), BACKUP_DUMP_EXTENSION)))\n+                backupFiles.insert(std::pair<std::time_t, filesystem::path>(filesystem::last_write_time( p ), p));\n+        }\n+    }\n+    catch(const filesystem::filesystem_error &e) {\n+        LogPrintf(\"error retrieving available backups (%s)\\n\", e.what());\n+        return backupFiles;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5266#discussion_r20348609",
      "id" : 20348609,
      "original_commit_id" : "9f39fc05033c89c3a0b43df66f5ff44b63eae1fc",
      "original_position" : 45,
      "path" : "src/walletdb.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5266",
      "updated_at" : "2014-11-14T13:20:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/20348609",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=3",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/5266#discussion_r20357188"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5266"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/20357188"
         }
      },
      "body" : "hmm.. the `GetDataDir()` (which must be part of the default backup path) returns a `boost::filesystem::path` instance which is not compatible with `GetArg`'s default argument. Converting the GetDataDir into a std::string first would probably end up in the same \"mess\".\r\nOr do you see a other solution?",
      "commit_id" : "b4afdb4ada50e231a49d0eca2364616aa35bd1a8",
      "created_at" : "2014-11-14T13:00:02Z",
      "diff_hunk" : "@@ -889,6 +893,157 @@ bool BackupWallet(const CWallet& wallet, const string& strDest)\n     return false;\n }\n \n+std::map<std::time_t, filesystem::path> CWalletDB::GetAvailableBackups()\n+{\n+    filesystem::path backupDir;\n+    std::string strBackupsDir   = GetArg(\"-backupspath\", \"\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5266#discussion_r20357188",
      "id" : 20357188,
      "original_commit_id" : "9f39fc05033c89c3a0b43df66f5ff44b63eae1fc",
      "original_position" : 22,
      "path" : "src/walletdb.cpp",
      "position" : 18,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5266",
      "updated_at" : "2014-11-14T13:20:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/20357188",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/5266#discussion_r20357442"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5266"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/20357442"
         }
      },
      "body" : "I would say it's needed. When calling `GetAvailableBackups` you then can expect a empty hash-map even when there was a error.",
      "commit_id" : "b4afdb4ada50e231a49d0eca2364616aa35bd1a8",
      "created_at" : "2014-11-14T13:07:01Z",
      "diff_hunk" : "@@ -889,6 +893,157 @@ bool BackupWallet(const CWallet& wallet, const string& strDest)\n     return false;\n }\n \n+std::map<std::time_t, filesystem::path> CWalletDB::GetAvailableBackups()\n+{\n+    filesystem::path backupDir;\n+    std::string strBackupsDir   = GetArg(\"-backupspath\", \"\");\n+    if(strBackupsDir != \"\")\n+        backupDir = boost::filesystem::path(strBackupsDir);\n+    else\n+    {\n+        backupDir = GetDataDir() / DEFAULT_BACKUPS_DIR;\n+    }\n+    \n+    std::map<std::time_t, filesystem::path> backupFiles;\n+    \n+    try {\n+        if(!filesystem::is_directory(backupDir))\n+            return backupFiles;\n+        \n+        filesystem::directory_iterator it(backupDir), eod;\n+        BOOST_FOREACH(filesystem::path const &p, std::make_pair(it, eod))\n+        {\n+            if(is_regular_file(p) && (ends_with(p.string(), BACKUP_BDB_EXTENSION) || ends_with(p.string(), BACKUP_DUMP_EXTENSION)))\n+                backupFiles.insert(std::pair<std::time_t, filesystem::path>(filesystem::last_write_time( p ), p));\n+        }\n+    }\n+    catch(const filesystem::filesystem_error &e) {\n+        LogPrintf(\"error retrieving available backups (%s)\\n\", e.what());\n+        return backupFiles;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5266#discussion_r20357442",
      "id" : 20357442,
      "original_commit_id" : "9f39fc05033c89c3a0b43df66f5ff44b63eae1fc",
      "original_position" : 45,
      "path" : "src/walletdb.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5266",
      "updated_at" : "2014-11-14T13:20:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/20357442",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "@Diapolo okay, did overhaul the code, added some comments, etc.\r\nYou might check it again.",
      "created_at" : "2014-11-14T13:08:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5266#issuecomment-63062159",
      "id" : 63062159,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5266",
      "updated_at" : "2014-11-14T13:08:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/63062159",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/5266#discussion_r20357551"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5266"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/20357551"
         }
      },
      "body" : "\"absolute\"",
      "commit_id" : "b4afdb4ada50e231a49d0eca2364616aa35bd1a8",
      "created_at" : "2014-11-14T13:10:11Z",
      "diff_hunk" : "@@ -368,7 +368,16 @@ std::string HelpMessage(HelpMessageMode mode)\n     strUsage += \"  -rpcsslcertificatechainfile=<file.cert>  \" + strprintf(_(\"Server certificate file (default: %s)\"), \"server.cert\") + \"\\n\";\n     strUsage += \"  -rpcsslprivatekeyfile=<file.pem>         \" + strprintf(_(\"Server private key (default: %s)\"), \"server.pem\") + \"\\n\";\n     strUsage += \"  -rpcsslciphers=<ciphers>                 \" + strprintf(_(\"Acceptable ciphers (default: %s)\"), \"TLSv1.2+HIGH:TLSv1+HIGH:!SSLv2:!aNULL:!eNULL:!3DES:@STRENGTH\") + \"\\n\";\n-\n+    \n+#ifdef ENABLE_WALLET\n+    strUsage += \"\\n\" + _(\"Backup options:\") + \"\\n\";\n+    strUsage += \"  -backups                                 \" + strprintf(_(\"Enable auto creation of UNENCRYPTED backups (dumps) (default: %u)\"), DEFAULT_BACKUPS_ENABLED) + \"\\n\";\n+    strUsage += \"  -backupsallowunencrypted                 \" + strprintf(_(\"Allow backups of unencrypted wallets (default: %u)\"), DEFAULT_ALLOW_UNENCRYPTED_BACKUPS) + \"\\n\";\n+    strUsage += \"  -backupspath=<dir>                       \" + strprintf(_(\"Specify absolut path to backups directory (default: %s)\"), strprintf(\"<datadir>/%s\", DEFAULT_BACKUPS_DIR)) + \"\\n\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5266#discussion_r20357551",
      "id" : 20357551,
      "original_commit_id" : "167fc953dd61bfcee2a2115d602bbbd179f592bb",
      "original_position" : 10,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5266",
      "updated_at" : "2014-11-14T13:20:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/20357551",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/5266#discussion_r20357568"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5266"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/20357568"
         }
      },
      "body" : "So I need to specify two options to enable backups (assuming an unencrypted wallet)? Why?",
      "commit_id" : "b4afdb4ada50e231a49d0eca2364616aa35bd1a8",
      "created_at" : "2014-11-14T13:10:37Z",
      "diff_hunk" : "@@ -368,7 +368,16 @@ std::string HelpMessage(HelpMessageMode mode)\n     strUsage += \"  -rpcsslcertificatechainfile=<file.cert>  \" + strprintf(_(\"Server certificate file (default: %s)\"), \"server.cert\") + \"\\n\";\n     strUsage += \"  -rpcsslprivatekeyfile=<file.pem>         \" + strprintf(_(\"Server private key (default: %s)\"), \"server.pem\") + \"\\n\";\n     strUsage += \"  -rpcsslciphers=<ciphers>                 \" + strprintf(_(\"Acceptable ciphers (default: %s)\"), \"TLSv1.2+HIGH:TLSv1+HIGH:!SSLv2:!aNULL:!eNULL:!3DES:@STRENGTH\") + \"\\n\";\n-\n+    \n+#ifdef ENABLE_WALLET\n+    strUsage += \"\\n\" + _(\"Backup options:\") + \"\\n\";\n+    strUsage += \"  -backups                                 \" + strprintf(_(\"Enable auto creation of UNENCRYPTED backups (dumps) (default: %u)\"), DEFAULT_BACKUPS_ENABLED) + \"\\n\";\n+    strUsage += \"  -backupsallowunencrypted                 \" + strprintf(_(\"Allow backups of unencrypted wallets (default: %u)\"), DEFAULT_ALLOW_UNENCRYPTED_BACKUPS) + \"\\n\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5266#discussion_r20357568",
      "id" : 20357568,
      "original_commit_id" : "167fc953dd61bfcee2a2115d602bbbd179f592bb",
      "original_position" : 9,
      "path" : "src/init.cpp",
      "position" : 9,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5266",
      "updated_at" : "2014-11-14T13:20:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/20357568",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/5266#discussion_r20357899"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5266"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/20357899"
         }
      },
      "body" : "I've started it very restrained. Maybe once the `-backup` feature could be enabled by default.\r\nI think enabling two options for making unencrypted backups is okay because it's somehow bad practice.",
      "commit_id" : "b4afdb4ada50e231a49d0eca2364616aa35bd1a8",
      "created_at" : "2014-11-14T13:20:10Z",
      "diff_hunk" : "@@ -368,7 +368,16 @@ std::string HelpMessage(HelpMessageMode mode)\n     strUsage += \"  -rpcsslcertificatechainfile=<file.cert>  \" + strprintf(_(\"Server certificate file (default: %s)\"), \"server.cert\") + \"\\n\";\n     strUsage += \"  -rpcsslprivatekeyfile=<file.pem>         \" + strprintf(_(\"Server private key (default: %s)\"), \"server.pem\") + \"\\n\";\n     strUsage += \"  -rpcsslciphers=<ciphers>                 \" + strprintf(_(\"Acceptable ciphers (default: %s)\"), \"TLSv1.2+HIGH:TLSv1+HIGH:!SSLv2:!aNULL:!eNULL:!3DES:@STRENGTH\") + \"\\n\";\n-\n+    \n+#ifdef ENABLE_WALLET\n+    strUsage += \"\\n\" + _(\"Backup options:\") + \"\\n\";\n+    strUsage += \"  -backups                                 \" + strprintf(_(\"Enable auto creation of UNENCRYPTED backups (dumps) (default: %u)\"), DEFAULT_BACKUPS_ENABLED) + \"\\n\";\n+    strUsage += \"  -backupsallowunencrypted                 \" + strprintf(_(\"Allow backups of unencrypted wallets (default: %u)\"), DEFAULT_ALLOW_UNENCRYPTED_BACKUPS) + \"\\n\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5266#discussion_r20357899",
      "id" : 20357899,
      "original_commit_id" : "167fc953dd61bfcee2a2115d602bbbd179f592bb",
      "original_position" : 9,
      "path" : "src/init.cpp",
      "position" : 9,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5266",
      "updated_at" : "2014-11-14T13:20:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/20357899",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Any NACKs ACKs?\r\nI would like to extend this to the GUI.",
      "created_at" : "2014-12-16T21:05:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5266#issuecomment-67231788",
      "id" : 67231788,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5266",
      "updated_at" : "2014-12-16T21:05:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/67231788",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "@jonasschnelli Concept ACK, haven't looked at the code. I promise I will, but right now I cannot keep up with the number of pulls anymore.\r\n",
      "created_at" : "2014-12-17T10:59:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5266#issuecomment-67307021",
      "id" : 67307021,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5266",
      "updated_at" : "2014-12-17T10:59:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/67307021",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "rebased",
      "created_at" : "2015-03-05T08:07:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5266#issuecomment-77322533",
      "id" : 77322533,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5266",
      "updated_at" : "2015-03-05T08:07:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/77322533",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "rebased.",
      "created_at" : "2015-03-12T13:11:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5266#issuecomment-78476159",
      "id" : 78476159,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5266",
      "updated_at" : "2015-03-12T13:11:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/78476159",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "I'm no longer convinced that this PRs solution is going into the right direction. As example: what means a encrypted wallet? Why are metadata like labels and comments (which could harm privacy) not encrypted in a encrypted wallet?\r\nHow would this perform after there is support for Bip32?",
      "created_at" : "2015-04-16T08:59:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5266#issuecomment-93683298",
      "id" : 93683298,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5266",
      "updated_at" : "2015-04-16T09:00:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/93683298",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "@jonasschnelli   Things other than private keys are not encrypted because otherwise the user is forced to enter their key at every startup or use, which is inconvenient and would punish users for using encryption and would leave their key more vulnerable to observation by malware or people around them. The entry of the key also becomes an important consent point: a user of an encrypted wallet can never accidentally send money no matter how stupidly they click or how far they explore.\r\n\r\nEncryption of a wallet is not usually adequate for privacy on your local computer in any case:  your logs, browser cache, etc all leak much of the same data...  When we talk about backups the situation is somewhat different, and I can agree it may make sense to have all the data encrypted there.  If I were to do it again I would have an master key encrypted with the hardened user passphrase used to derive separate keys for encrypting the whole wallet and the private keys. At the first use, I'd cache the whole wallet subkey (but not the private key one) in a separate file.  This way backups would preserve privacy, so long as they didn't backup the cache.\r\n\r\nBIP32 is not at all a replacement for backups; at most it protects key material. It does nothing to preserve metadata which can be absolutely critical (keeping in mind that in much of the developed world if your taxes are audited its up to you to prove you were paying what you owed). I somewhat regret inventing the public derivation thats most commonly used now-- it's overused, and in ways that harm security (often by people who do not understand the implications). \r\n",
      "created_at" : "2015-04-16T12:09:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5266#issuecomment-93718490",
      "id" : 93718490,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5266",
      "updated_at" : "2015-04-16T12:09:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/93718490",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "Closing for this older PR.  It sounds like there is general agreement that something like this is a good direction, but it's doesn't seem to be coalescing into a specific solution that is liked.\r\n\r\nMy own criticism:   I don't think this low level functionality is needed at all for non-GUI daemon.  It can be implemented with a simple, external cron script that applies well to the local site.\r\n\r\nSuggestions:\r\n* Add such a script to contrib/\r\n* Directly implement a GUI-specific, user-friendly backup method in the GUI.  Don't try to match bitcoind and GUI backup behaviors, as the two sets of users can be quite different.  Do what makes sense for the GUI.\r\n",
      "created_at" : "2015-07-23T18:36:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5266#issuecomment-124203383",
      "id" : 124203383,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5266",
      "updated_at" : "2015-07-23T18:36:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/124203383",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "Agree with @jgarzik in general.\r\nWhat made me stop woking on this: as long as an \"encrypted wallet\" contains unencrypted sensitive data  (like transactions [unencrypted], labels [unencrypted] and wtx comments [unencrypted]) it is to risky to auto-backup a wallet.\r\nUsers might start to think they can store the backup in a insecure space (like dropbox, etc.) because they are assuming the backup is encrypted (which is a false assumption, only the private keys are encrypted).",
      "created_at" : "2015-07-23T18:41:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5266#issuecomment-124206119",
      "id" : 124206119,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5266",
      "updated_at" : "2015-07-23T18:41:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/124206119",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   }
]
