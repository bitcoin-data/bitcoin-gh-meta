[
   {
      "author_association" : "MEMBER",
      "body" : "I originally suggested this as a follow up to #20187: https://github.com/bitcoin/bitcoin/pull/20187#discussion_r511795306\r\n\r\ncc @mzumsande @amitiuttarwar @sdaftuar ",
      "created_at" : "2020-11-03T09:22:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20291#issuecomment-720999091",
      "id" : 720999091,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20291",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyMDk5OTA5MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-03T09:22:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/720999091",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #20228 (addrman: Make addrman a top-level component by jnewbery)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-11-03T11:07:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20291#issuecomment-721050210",
      "id" : 721050210,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20291",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyMTA1MDIxMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-03T11:07:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/721050210",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK.\r\n\r\nHow about adding a commit to rename `CAddrMan::Connected` (which is only ever called during disconnection) and correct the documentation, as suggested in https://github.com/bitcoin/bitcoin/pull/20187#discussion_r514646785 and https://github.com/bitcoin/bitcoin/pull/20187#pullrequestreview-521189824 ?",
      "created_at" : "2020-11-03T15:31:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20291#issuecomment-721200717",
      "id" : 721200717,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20291",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyMTIwMDcxNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-03T15:31:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/721200717",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> How about adding a commit to rename CAddrMan::Connected (which is only ever called during disconnection) and correct the documentation\r\n\r\nI haven't changed the name, but I've updated the documentation, so at least it should be obvious to readers what the function is doing. I think we need to reconsider our whole approach to nTime/nLastSuccess, and potentially remove nTime for addr messages altogether (see https://github.com/bitcoin-core/bitcoin-devwiki/wiki/P2P-IRC-meetings#20-oct-2020). For now, I think updating the function comment is enough.",
      "created_at" : "2020-11-04T11:44:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20291#issuecomment-721684434",
      "id" : 721684434,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20291",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyMTY4NDQzNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-04T11:44:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/721684434",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2020-11-04T17:03:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20291#issuecomment-721855151",
      "id" : 721855151,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20291",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyMTg1NTE1MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-04T17:03:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/721855151",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20291#discussion_r517579502"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20291"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/517579502"
         }
      },
      "author_association" : "MEMBER",
      "body" : "this comment seems unnecessary- addrman uses this convention of external Function() & internal Function_() in several places.\r\n\r\n(but ofc not a big deal if it stays) ",
      "commit_id" : "0bfce9dc46234b196a8b3679c21d6f8455962495",
      "created_at" : "2020-11-04T19:26:05Z",
      "diff_hunk" : "@@ -676,7 +686,7 @@ friend class CAddrManTest;\n         return vAddr;\n     }\n \n-    //! Mark an entry as currently-connected-to.\n+    //! Outer function for Connected_()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20291#discussion_r517579502",
      "id" : 517579502,
      "line" : 689,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzU3OTUwMg==",
      "original_commit_id" : "0bfce9dc46234b196a8b3679c21d6f8455962495",
      "original_line" : 689,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 26,
      "pull_request_review_id" : 523669149,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20291",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-05T02:05:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/517579502",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20291#discussion_r517738114"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20291"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/517738114"
         }
      },
      "author_association" : "MEMBER",
      "body" : "might be worth adding a word or two that indicates these are our primary uses of `nTime`, but not the only ones. the comment got me curious so I dove in and looked around, but its not the easiest to sift through a grep for `nTime` ð\r\n```suggestion\r\n     *  updates the CAddress's nTime, which is primarily used in our IsTerrible()\r\n```\r\n\r\nincase curious, some other times we read from `nTime` are when processing an `ADDR` message & deciding whether to relay & for debug printing in `ConnectNode`",
      "commit_id" : "0bfce9dc46234b196a8b3679c21d6f8455962495",
      "created_at" : "2020-11-05T02:01:33Z",
      "diff_hunk" : "@@ -258,8 +258,18 @@ friend class CAddrManTest;\n     //! Select several addresses at once.\n     void GetAddr_(std::vector<CAddress> &vAddr, size_t max_addresses, size_t max_pct) EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n-    //! Mark an entry as currently-connected-to.\n-    void Connected_(const CService &addr, int64_t nTime) EXCLUSIVE_LOCKS_REQUIRED(cs);\n+    /** We have successfully connected to this peer. Calling this function\n+     *  updates the CAddress's nTime, which is used in our IsTerrible()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20291#discussion_r517738114",
      "id" : 517738114,
      "line" : 262,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzczODExNA==",
      "original_commit_id" : "0bfce9dc46234b196a8b3679c21d6f8455962495",
      "original_line" : 262,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 7,
      "pull_request_review_id" : 523669149,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20291",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-05T02:05:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/517738114",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> one slightly tangential question- when looking for other touch points of nTime, I came across this comment:\r\n\r\n> // find an entry, creating it if necessary. \r\n // nTime and nServices of found node is updated, if necessary. \r\n CAddrInfo* Create(const CAddress &addr, const CNetAddr &addrSource, int *pnId = NULL); \r\n\r\n>but from reading the function definition, I don't understand how. can it really update the existing nTime of a CAddress? looks like both the header comment and function were added in 5fee401, so seems likely I'm misunderstanding the code.\r\n\r\nNo, you're not misunderstanding. That comment is just plain wrong. It doesn't find the entry, it always creates it. And it doesn't update the nTime and nServices. I think it's probably vestigial from when the code was being written. Perhaps logic was moved around (what it's describing is closer to what the `Add_()` function does), but it's inaccurate now.",
      "created_at" : "2020-11-06T10:29:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20291#issuecomment-723005030",
      "id" : 723005030,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20291",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyMzAwNTAzMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-06T10:29:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/723005030",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20291#discussion_r518660894"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20291"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/518660894"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I like _all_ functions to have doxygen comments, even if they're short and seem unnecessary. I prefer this to say \"outer function\" than just be a duplicate of the comment for the inner function, which is what it was before.",
      "commit_id" : "0bfce9dc46234b196a8b3679c21d6f8455962495",
      "created_at" : "2020-11-06T10:30:47Z",
      "diff_hunk" : "@@ -676,7 +686,7 @@ friend class CAddrManTest;\n         return vAddr;\n     }\n \n-    //! Mark an entry as currently-connected-to.\n+    //! Outer function for Connected_()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20291#discussion_r518660894",
      "id" : 518660894,
      "in_reply_to_id" : 517579502,
      "line" : 689,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODY2MDg5NA==",
      "original_commit_id" : "0bfce9dc46234b196a8b3679c21d6f8455962495",
      "original_line" : 689,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 26,
      "pull_request_review_id" : 525031160,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20291",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-06T10:30:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/518660894",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20291#discussion_r518662686"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20291"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/518662686"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> some other times we read from nTime are when processing an ADDR message & deciding whether to relay\r\n\r\nAh. This is using the `nTime` from a received `addr`, so not quite the same as the `nTime` stored in a `CAddress` in addrman.\r\n\r\n> for debug printing in ConnectNode\r\n\r\nYes, this is true. The nTime is logged here.\r\n\r\nI think I'm right in saying that the only _functional_ uses of nTime in a `CAddress` in addrman are in `IsTerrible()` and when relaying the `CAddress` to a peer in response to a `getaddr`.",
      "commit_id" : "0bfce9dc46234b196a8b3679c21d6f8455962495",
      "created_at" : "2020-11-06T10:34:06Z",
      "diff_hunk" : "@@ -258,8 +258,18 @@ friend class CAddrManTest;\n     //! Select several addresses at once.\n     void GetAddr_(std::vector<CAddress> &vAddr, size_t max_addresses, size_t max_pct) EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n-    //! Mark an entry as currently-connected-to.\n-    void Connected_(const CService &addr, int64_t nTime) EXCLUSIVE_LOCKS_REQUIRED(cs);\n+    /** We have successfully connected to this peer. Calling this function\n+     *  updates the CAddress's nTime, which is used in our IsTerrible()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20291#discussion_r518662686",
      "id" : 518662686,
      "in_reply_to_id" : 517738114,
      "line" : 262,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODY2MjY4Ng==",
      "original_commit_id" : "0bfce9dc46234b196a8b3679c21d6f8455962495",
      "original_line" : 262,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 7,
      "pull_request_review_id" : 525033529,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20291",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-06T10:34:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/518662686",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20291#discussion_r519034963"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20291"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519034963"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> I think I'm right in saying that the only functional uses of nTime in a CAddress in addrman are in IsTerrible() and when relaying the CAddress to a peer in response to a getaddr.\r\n\r\nyup, I agree. thats why my suggestion was just to clarify that difference (esp since grep doesn't immediately make this clear). not a big deal though, maybe to consider if you touch up the code for another reason. \r\n\r\n> Ah. This is using the nTime from a received addr, so not quite the same as the nTime stored in a CAddress in addrman.\r\n\r\nhm well, looks like we read the addr into a `CAddress` object and then decide whether or not to add it to our addrman? ofc the functionality of `Connected_` doesn't have the ability to impact the value at that time, but its still the same `CAddress.nTime` field thats being read?  ",
      "commit_id" : "0bfce9dc46234b196a8b3679c21d6f8455962495",
      "created_at" : "2020-11-06T22:23:41Z",
      "diff_hunk" : "@@ -258,8 +258,18 @@ friend class CAddrManTest;\n     //! Select several addresses at once.\n     void GetAddr_(std::vector<CAddress> &vAddr, size_t max_addresses, size_t max_pct) EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n-    //! Mark an entry as currently-connected-to.\n-    void Connected_(const CService &addr, int64_t nTime) EXCLUSIVE_LOCKS_REQUIRED(cs);\n+    /** We have successfully connected to this peer. Calling this function\n+     *  updates the CAddress's nTime, which is used in our IsTerrible()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20291#discussion_r519034963",
      "id" : 519034963,
      "in_reply_to_id" : 517738114,
      "line" : 262,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTAzNDk2Mw==",
      "original_commit_id" : "0bfce9dc46234b196a8b3679c21d6f8455962495",
      "original_line" : 262,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 7,
      "pull_request_review_id" : 525531897,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20291",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-06T22:23:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/519034963",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Code review ACK 0bfce9dc46234b196a8b3679c21d6f8455962495",
      "created_at" : "2020-11-10T22:07:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20291#issuecomment-724996067",
      "id" : 724996067,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20291",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyNDk5NjA2Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-10T22:07:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/724996067",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20291#discussion_r521542298"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20291"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/521542298"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Perhaps it's worth explicitly documenting that we do not call Connected() for FEELER connections?  (This behavior emerges from feelers not having the `fSuccessfullyConnected` bool set, and I think it's desirable to maintain this behavior because otherwise long-lived block-relay-only connections might stick out as the ones which haven't been updated in a while.)",
      "commit_id" : "0bfce9dc46234b196a8b3679c21d6f8455962495",
      "created_at" : "2020-11-11T18:02:14Z",
      "diff_hunk" : "@@ -855,8 +852,9 @@ void PeerManager::FinalizeNode(const CNode& node, bool& fUpdateConnectionTime) {\n     if (state->fSyncStarted)\n         nSyncStarted--;\n \n-    if (misbehavior == 0 && state->fCurrentlyConnected && !node.IsBlockOnlyConn()) {\n-        // Note: we avoid changing visible addrman state for block-relay-only peers\n+    if (node.fSuccessfullyConnected && misbehavior == 0 &&\n+        !node.IsBlockOnlyConn() && !node.IsInboundConn()) {\n+        // Only change visible addrman state for outbound, full-relay peers",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20291#discussion_r521542298",
      "id" : 521542298,
      "line" : 857,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTU0MjI5OA==",
      "original_commit_id" : "0bfce9dc46234b196a8b3679c21d6f8455962495",
      "original_line" : 857,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 25,
      "pull_request_review_id" : 528412435,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20291",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-11T18:02:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/521542298",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20291#discussion_r521998219"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20291"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/521998219"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good suggestion. I'm touching this line again in https://github.com/bitcoin/bitcoin/pull/20228, which will need to be rebased once this is merged. Rather than invalidate the ACKs here for a comment update, I'll make the change there.",
      "commit_id" : "0bfce9dc46234b196a8b3679c21d6f8455962495",
      "created_at" : "2020-11-12T10:26:14Z",
      "diff_hunk" : "@@ -855,8 +852,9 @@ void PeerManager::FinalizeNode(const CNode& node, bool& fUpdateConnectionTime) {\n     if (state->fSyncStarted)\n         nSyncStarted--;\n \n-    if (misbehavior == 0 && state->fCurrentlyConnected && !node.IsBlockOnlyConn()) {\n-        // Note: we avoid changing visible addrman state for block-relay-only peers\n+    if (node.fSuccessfullyConnected && misbehavior == 0 &&\n+        !node.IsBlockOnlyConn() && !node.IsInboundConn()) {\n+        // Only change visible addrman state for outbound, full-relay peers",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20291#discussion_r521998219",
      "id" : 521998219,
      "in_reply_to_id" : 521542298,
      "line" : 857,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTk5ODIxOQ==",
      "original_commit_id" : "0bfce9dc46234b196a8b3679c21d6f8455962495",
      "original_line" : 857,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 25,
      "pull_request_review_id" : 528947095,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20291",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-12T10:26:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/521998219",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20291#discussion_r527083966"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20291"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/527083966"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done in #20228.",
      "commit_id" : "0bfce9dc46234b196a8b3679c21d6f8455962495",
      "created_at" : "2020-11-19T17:52:12Z",
      "diff_hunk" : "@@ -855,8 +852,9 @@ void PeerManager::FinalizeNode(const CNode& node, bool& fUpdateConnectionTime) {\n     if (state->fSyncStarted)\n         nSyncStarted--;\n \n-    if (misbehavior == 0 && state->fCurrentlyConnected && !node.IsBlockOnlyConn()) {\n-        // Note: we avoid changing visible addrman state for block-relay-only peers\n+    if (node.fSuccessfullyConnected && misbehavior == 0 &&\n+        !node.IsBlockOnlyConn() && !node.IsInboundConn()) {\n+        // Only change visible addrman state for outbound, full-relay peers",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20291#discussion_r527083966",
      "id" : 527083966,
      "in_reply_to_id" : 521542298,
      "line" : 857,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA4Mzk2Ng==",
      "original_commit_id" : "0bfce9dc46234b196a8b3679c21d6f8455962495",
      "original_line" : 857,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 25,
      "pull_request_review_id" : 534704000,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20291",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-19T17:52:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/527083966",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   }
]
