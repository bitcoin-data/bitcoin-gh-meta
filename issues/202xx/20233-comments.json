[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r511200283"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511200283"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: other cases line break after banman",
      "commit_id" : "9d5575e27ce3d628c83816bd321bb83a2a6c4c80",
      "created_at" : "2020-10-23T23:50:50Z",
      "diff_hunk" : "@@ -172,7 +172,9 @@ TestingSetup::TestingSetup(const std::string& chainName, const std::vector<const\n \n     m_node.banman = MakeUnique<BanMan>(GetDataDir() / \"banlist.dat\", nullptr, DEFAULT_MISBEHAVING_BANTIME);\n     m_node.connman = MakeUnique<CConnman>(0x1337, 0x1337, *m_node.addrman); // Deterministic randomness for tests.\n-    m_node.peerman = MakeUnique<PeerManager>(chainparams, *m_node.connman, m_node.banman.get(), *m_node.scheduler, *m_node.chainman, *m_node.mempool);\n+    m_node.peerman = MakeUnique<PeerManager>(chainparams, *m_node.connman, *m_node.addrman,\n+                                             m_node.banman.get(), *m_node.scheduler, *m_node.chainman,\n+                                             *m_node.mempool);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r511200283",
      "id" : 511200283,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTIwMDI4Mw==",
      "original_commit_id" : "b155d8aeda0775275aa184ba6080fc32c5395de9",
      "original_line" : 177,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/test/util/setup_common.cpp",
      "position" : null,
      "pull_request_review_id" : 516115087,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-30T10:54:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511200283",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#22627](https://github.com/bitcoin/bitcoin/pull/22627) ([addrman] De-duplicate Add() function by amitiuttarwar)\n* [#21878](https://github.com/bitcoin/bitcoin/pull/21878) (Make all networking code mockable by vasild)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-10-24T08:59:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-715884174",
      "id" : 715884174,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxNTg4NDE3NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-06T20:57:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/715884174",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK\r\n\r\nShould we run with `-checkaddrman` in at least one of the Travis jobs?",
      "created_at" : "2020-10-24T09:03:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-715884692",
      "id" : 715884692,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxNTg4NDY5Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-24T15:37:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/715884692",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Should we run with -checkaddrman in at least one of the Traivs jobs?\r\n\r\n`-checkaddrman` is enabled by default for regtest, so is on for all Travis jobs (although our functional tests probably don't exercise addrman very much)",
      "created_at" : "2020-10-24T10:28:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-715894659",
      "id" : 715894659,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxNTg5NDY1OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-24T10:28:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/715894659",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The consistency check fails on one of the unit tests. I've converted this PR to draft status while I work out why it's failing.",
      "created_at" : "2020-10-24T17:11:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-716008503",
      "id" : 716008503,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxNjAwODUwMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-25T09:32:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/716008503",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> `-checkaddrman` is enabled by default for regtest, so is on for all Travis jobs (although our functional tests probably don't exercise addrman very much)\r\n\r\nOh, I missed the \"by default on regtest\" in the PR description. Sorry about that :)\r\n\r\nDefaulting to sanity checking in regtest makes perfect sense! Even more Concept ACK :)",
      "created_at" : "2020-10-24T21:56:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-716060484",
      "id" : 716060484,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxNjA2MDQ4NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-24T21:56:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/716060484",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've fixed the failing unit tests.",
      "created_at" : "2020-10-25T10:00:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-716121546",
      "id" : 716121546,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxNjEyMTU0Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-25T10:00:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/716121546",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This makes some of the functional tests run very slowly. I'll do some comparisons and maybe disable consistency checks on the slowest tests.",
      "created_at" : "2020-10-25T14:47:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-716160060",
      "id" : 716160060,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxNjE2MDA2MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-25T14:47:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/716160060",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Marking as draft until #20228 is merged.",
      "created_at" : "2020-10-26T12:02:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-716503063",
      "id" : 716503063,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxNjUwMzA2Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-26T12:02:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/716503063",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r514380030"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/514380030"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't it matters where the line break is, as long as the line isn't too long.",
      "commit_id" : "9d5575e27ce3d628c83816bd321bb83a2a6c4c80",
      "created_at" : "2020-10-29T16:06:07Z",
      "diff_hunk" : "@@ -172,7 +172,9 @@ TestingSetup::TestingSetup(const std::string& chainName, const std::vector<const\n \n     m_node.banman = MakeUnique<BanMan>(GetDataDir() / \"banlist.dat\", nullptr, DEFAULT_MISBEHAVING_BANTIME);\n     m_node.connman = MakeUnique<CConnman>(0x1337, 0x1337, *m_node.addrman); // Deterministic randomness for tests.\n-    m_node.peerman = MakeUnique<PeerManager>(chainparams, *m_node.connman, m_node.banman.get(), *m_node.scheduler, *m_node.chainman, *m_node.mempool);\n+    m_node.peerman = MakeUnique<PeerManager>(chainparams, *m_node.connman, *m_node.addrman,\n+                                             m_node.banman.get(), *m_node.scheduler, *m_node.chainman,\n+                                             *m_node.mempool);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r514380030",
      "id" : 514380030,
      "in_reply_to_id" : 511200283,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDM4MDAzMA==",
      "original_commit_id" : "b155d8aeda0775275aa184ba6080fc32c5395de9",
      "original_line" : 177,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/test/util/setup_common.cpp",
      "position" : null,
      "pull_request_review_id" : 519830824,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-30T10:54:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/514380030",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This seems to make rpc_net and p2p_getaddr_caching tests run extremely slowly:\r\n\r\n    rpc_net.py                                       | â Passed  | 1372 s\r\n    p2p_getaddr_caching.py                           | â Passed  | 1367 s\r\n\r\nI don't think there's any need for this to be based on #20228 -- passing a \"check_addrman\" from init to CConnman seems to work fine, see https://github.com/ajtowns/bitcoin/commits/202101-addrman-check eg.\r\n\r\nMore generally, I'm not sure that these consistency checks are that useful to enable at runtime/CI rather than just using them as an aid when making changes to addrman internals.",
      "created_at" : "2021-01-06T02:57:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-755044221",
      "id" : 755044221,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1NTA0NDIyMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-06T02:57:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/755044221",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> This seems to make rpc_net and p2p_getaddr_caching tests run extremely slowly.\r\n\r\nYes, see my comment at https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-716160060. I was planning on addressing that after 20228 was merged, probably by disabling the checks for those tests, or perhaps by changing the consistency check configuration to be a ratio, like the mempool consistency checks:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/68196a891056f98c1df0debacf09fb2ea4682a43/src/txmempool.h#L491\r\n\r\n> I don't think there's any need for this to be based on #20228 -- passing a \"check_addrman\" from init to CConnman seems to work fine, see ajtowns/bitcoin@202101-addrman-check (commits) eg.\r\n\r\nSure, we could continue to pass function calls and (now) ctor parameters through CConnman, but I don't see why that is desirable. Connman _uses_ addrman, but there's no reason for it to _have_ an addrman. Addrman is also used by peerman and the RPCs. Connman's resposibility is to open and maintain connections. Storing and maintaining our map of accessible nodes on the network is a separate  responsibility.\r\n\r\nThere was also some discussion here: http://www.erisian.com.au/bitcoin-core-dev/log-2020-12-16.html#l-585 about being able to manage addrman more directly. Again, in that case it'd be easier if RPC directly held a handle to the addrman instead of passing messages through connman.\r\n\r\n> More generally, I'm not sure that these consistency checks are that useful to enable at runtime/CI rather than just using them as an aid when making changes to addrman internals.\r\n\r\nI think somewhere that they're definitely useful would be in fuzz testing, to ensure that there's no way to violate addrman's invariants. See the usage of txrequest's sanity check here:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/68196a891056f98c1df0debacf09fb2ea4682a43/src/test/fuzz/txrequest.cpp#L373\r\n\r\nwhich is called after every loop in the fuzz tester.",
      "created_at" : "2021-01-06T09:30:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-755188580",
      "id" : 755188580,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1NTE4ODU4MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-06T09:30:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/755188580",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Connman uses addrman, but there's no reason for it to have an addrman.\r\n\r\nThere's no point having addrman without a connman outside of unit tests (in which case the test can create an addrman directly), and connman uses addrman. That's enough reason for connman to be the thing that owns it, and for anything that wants it to access it via connman. I don't think there's anything you could do with `node.addrman` that you couldn't do equally well with `node.connman.GetAddrman()`.\r\n\r\nBut more importantly, it's easy to separate the two questions (should connman own the addrman instance and should debug_addrman be used more often) and judge them independently, so we should.\r\n\r\n> I think somewhere that they're definitely useful would be in fuzz testing, [...]\r\n\r\nYeah; I agree in principle. But while I think txrequest's checks are reasonably optimised to be run frequently with modest data sets, I think addrman's is very heavy weight and only really works for pretty small ones. Maybe it would make sense to have the automatic internal checks (`Good()` surrounds `Good_()` by invocations to `Check()`) only happen via compile-time changes so you can use them when debugging, but still have `Check_()` compiled unconditionally so that the fuzzer and unit tests call `Check()` themselves.\r\n\r\nAny idea how much this PR currently slows down the fuzzer? Doing the checks irregularly might be enough either way though -- perhaps especially if how irregular it is adjust dynamically (100% for the first x checks, 50% for the next x checks, etc?)\r\n\r\nHmm, actually, at least as it stands, perhaps addrman checks should be a regtest-only option, rather than a regtest-by-default option? Aren't those checks always too heavyweight to run when addrman is populated from mainnet/testnet?",
      "created_at" : "2021-01-07T06:24:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-755914044",
      "id" : 755914044,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1NTkxNDA0NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-07T06:24:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/755914044",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> But more importantly, it's easy to separate the two questions (should connman own the addrman instance and should debug_addrman be used more often) and judge them independently, so we should.\r\n\r\nThe aim of this PR is to add the ability to run internal consistency checks in addrman. If that can be done without adding more unnecessary coupling between components, then we should do that. There's no good reason that connman should be forwarding constructor parameters through to addrman, so I don't want to add that.\r\n\r\nThis design of both connman and peerman holding a handle to another component is exactly the same as we use for banman, with the added bonus that banman is internally an optional component (although there's no exposed configuration option to disable it). That design ensures very clean separation between components with no unexpected dependencies creeping in, and no boilerplate forwarding code in connman.\r\n\r\nChanging the constuctor parameters is changing the public interface of addrman, so there are two choices:\r\n\r\n1. keep it in connman and update connman's ctor interface, adding yet more coupling between components\r\n2. split out addrman and then add the ctor parameter\r\n\r\n(2) is more work now, but it's a net removal of boilerplate code (-24 in #20228), and is a better design for the long term.",
      "created_at" : "2021-01-07T09:55:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-756011974",
      "id" : 756011974,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1NjAxMTk3NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-07T09:55:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/756011974",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased on master. I'm leaving this as draft since I still need to update it to disable addrman consistency checks for certain tests.",
      "created_at" : "2021-03-30T10:54:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-810124639",
      "id" : 810124639,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMDEyNDYzOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-30T10:54:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/810124639",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2021-07-16T11:43:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-881386449",
      "id" : 881386449,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "IC_kwDOABII5840iOPR",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-16T11:43:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/881386449",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Addrman corruption is getting more attention recently, so I've rebased on master, with some small changes:\r\n\r\n- the option is now an integer, where setting `-checkaddrman=n` will cause the consistency checks to be run every `n` operations (similar to `-checkmempool=n`).\r\n- the consistency check ratio is set to 100 for unit tests. On my machine, running the addrman_tests took: \r\n  - with no consistency checks: 0.65s\r\n  - with consistency check ratio set to 100: 0.71s\r\n  - with consistency check ratio set to 1: 7.75s\r\n\r\n  Running consistency checks on 1% of operations seems to give good increased coverage without impacting test runtime too much\r\n- consistency checks are disabled by default for all networks, including regtest. That can be changed in a follow-up PR if people think it should be enabled by default for regtest.",
      "created_at" : "2021-07-19T10:49:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-882447465",
      "id" : 882447465,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "IC_kwDOABII5840mRRp",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-19T10:49:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/882447465",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672204202"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672204202"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: https://en.cppreference.com/w/cpp/algorithm/clamp",
      "commit_id" : "9d5575e27ce3d628c83816bd321bb83a2a6c4c80",
      "created_at" : "2021-07-19T11:09:55Z",
      "diff_hunk" : "@@ -1160,7 +1161,8 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     const bool ignores_incoming_txs{args.GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY)};\n \n     assert(!node.addrman);\n-    node.addrman = std::make_unique<CAddrMan>();\n+    int32_t check_addrman = std::min<int32_t>(std::max<int32_t>(args.GetArg(\"-checkaddrman\", DEFAULT_ADDRMAN_CONSISTENCY_CHECKS), 0), 1000000);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672204202",
      "id" : 672204202,
      "line" : 1164,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MjIwNDIwMg==",
      "original_commit_id" : "9d5575e27ce3d628c83816bd321bb83a2a6c4c80",
      "original_line" : 1164,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 13,
      "pull_request_review_id" : 709426299,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-19T11:11:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672204202",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672204994"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672204994"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nice. Verbosely complaining to developers about bugs makes them less likely to get missed.",
      "commit_id" : "9d5575e27ce3d628c83816bd321bb83a2a6c4c80",
      "created_at" : "2021-07-19T11:11:20Z",
      "diff_hunk" : "@@ -723,22 +729,19 @@ class CAddrMan\n     CAddrInfo SelectTriedCollision_() EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n     //! Consistency check\n-    void Check()\n-        EXCLUSIVE_LOCKS_REQUIRED(cs)\n+    void Check() EXCLUSIVE_LOCKS_REQUIRED(cs)\n     {\n-#ifdef DEBUG_ADDRMAN\n         AssertLockHeld(cs);\n-        const int err = Check_();\n+\n+        int err = Check_();\n         if (err) {\n             LogPrintf(\"ADDRMAN CONSISTENCY CHECK FAILED!!! err=%i\\n\", err);\n+            assert(false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672204994",
      "id" : 672204994,
      "line" : 739,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MjIwNDk5NA==",
      "original_commit_id" : "9d5575e27ce3d628c83816bd321bb83a2a6c4c80",
      "original_line" : 739,
      "original_position" : 53,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 53,
      "pull_request_review_id" : 709426299,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-19T11:11:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672204994",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672214710"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672214710"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Unrelated improvement: Maybe just simplify the `if foo return -xx;` with `assert(!foo);` in the cpp file?",
      "commit_id" : "9d5575e27ce3d628c83816bd321bb83a2a6c4c80",
      "created_at" : "2021-07-19T11:27:57Z",
      "diff_hunk" : "@@ -723,22 +729,19 @@ class CAddrMan\n     CAddrInfo SelectTriedCollision_() EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n     //! Consistency check\n-    void Check()\n-        EXCLUSIVE_LOCKS_REQUIRED(cs)\n+    void Check() EXCLUSIVE_LOCKS_REQUIRED(cs)\n     {\n-#ifdef DEBUG_ADDRMAN\n         AssertLockHeld(cs);\n-        const int err = Check_();\n+\n+        int err = Check_();\n         if (err) {\n             LogPrintf(\"ADDRMAN CONSISTENCY CHECK FAILED!!! err=%i\\n\", err);\n+            assert(false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672214710",
      "id" : 672214710,
      "in_reply_to_id" : 672204994,
      "line" : 739,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MjIxNDcxMA==",
      "original_commit_id" : "9d5575e27ce3d628c83816bd321bb83a2a6c4c80",
      "original_line" : 739,
      "original_position" : 53,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 53,
      "pull_request_review_id" : 709439753,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-19T11:27:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672214710",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672236604"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672236604"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n            std::abort();\r\n```",
      "commit_id" : "a343f9079c30e1dce6f13852ff84bab7dab3fcde",
      "created_at" : "2021-07-19T12:03:29Z",
      "diff_hunk" : "@@ -723,22 +729,19 @@ class CAddrMan\n     CAddrInfo SelectTriedCollision_() EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n     //! Consistency check\n-    void Check()\n-        EXCLUSIVE_LOCKS_REQUIRED(cs)\n+    void Check() EXCLUSIVE_LOCKS_REQUIRED(cs)\n     {\n-#ifdef DEBUG_ADDRMAN\n         AssertLockHeld(cs);\n-        const int err = Check_();\n+\n+        int err = Check_();\n         if (err) {\n             LogPrintf(\"ADDRMAN CONSISTENCY CHECK FAILED!!! err=%i\\n\", err);\n+            assert(false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672236604",
      "id" : 672236604,
      "in_reply_to_id" : 672204994,
      "line" : 739,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MjIzNjYwNA==",
      "original_commit_id" : "9d5575e27ce3d628c83816bd321bb83a2a6c4c80",
      "original_line" : 739,
      "original_position" : 53,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 53,
      "pull_request_review_id" : 709466880,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-19T12:03:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672236604",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672279096"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672279096"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke I left the cpp file unchanged in case we want to later add some kind of recovery code instead of simply asserting on failure. Changing the `if foo return -xx;` to `assert(!foo)` would involve making changes in more places.\r\n\r\n@vasild - What's the advantage of using `std::abort`? I see lots more examples of `assert(false)` in the code than `std::abort()`.",
      "commit_id" : "a343f9079c30e1dce6f13852ff84bab7dab3fcde",
      "created_at" : "2021-07-19T13:05:45Z",
      "diff_hunk" : "@@ -723,22 +729,19 @@ class CAddrMan\n     CAddrInfo SelectTriedCollision_() EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n     //! Consistency check\n-    void Check()\n-        EXCLUSIVE_LOCKS_REQUIRED(cs)\n+    void Check() EXCLUSIVE_LOCKS_REQUIRED(cs)\n     {\n-#ifdef DEBUG_ADDRMAN\n         AssertLockHeld(cs);\n-        const int err = Check_();\n+\n+        int err = Check_();\n         if (err) {\n             LogPrintf(\"ADDRMAN CONSISTENCY CHECK FAILED!!! err=%i\\n\", err);\n+            assert(false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672279096",
      "id" : 672279096,
      "in_reply_to_id" : 672204994,
      "line" : 739,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MjI3OTA5Ng==",
      "original_commit_id" : "9d5575e27ce3d628c83816bd321bb83a2a6c4c80",
      "original_line" : 739,
      "original_position" : 53,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 53,
      "pull_request_review_id" : 709522796,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-19T13:05:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672279096",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672279183"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672279183"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nice. Done.",
      "commit_id" : "a343f9079c30e1dce6f13852ff84bab7dab3fcde",
      "created_at" : "2021-07-19T13:05:53Z",
      "diff_hunk" : "@@ -1160,7 +1161,8 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     const bool ignores_incoming_txs{args.GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY)};\n \n     assert(!node.addrman);\n-    node.addrman = std::make_unique<CAddrMan>();\n+    int32_t check_addrman = std::min<int32_t>(std::max<int32_t>(args.GetArg(\"-checkaddrman\", DEFAULT_ADDRMAN_CONSISTENCY_CHECKS), 0), 1000000);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672279183",
      "id" : 672279183,
      "in_reply_to_id" : 672204202,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MjI3OTE4Mw==",
      "original_commit_id" : "9d5575e27ce3d628c83816bd321bb83a2a6c4c80",
      "original_line" : 1164,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 709522920,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-19T13:05:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672279183",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "review ACK a343f9079c30e1dce6f13852ff84bab7dab3fcde",
      "created_at" : "2021-07-19T14:07:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-882577713",
      "id" : 882577713,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "IC_kwDOABII5840mxEx",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-19T14:07:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/882577713",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, seems like an obvious win. Will review soon.",
      "created_at" : "2021-07-19T14:12:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-882582362",
      "id" : 882582362,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "IC_kwDOABII5840myNa",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-19T14:12:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/882582362",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672382001"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672382001"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`assert()` calls `abort()`, so it is the same thing in practice (modulo the \"strange\" message `assertion failed: false`). Feel free to ignore or use `assert(0)` or `assert(nullptr)`.",
      "commit_id" : "a343f9079c30e1dce6f13852ff84bab7dab3fcde",
      "created_at" : "2021-07-19T15:04:01Z",
      "diff_hunk" : "@@ -723,22 +729,19 @@ class CAddrMan\n     CAddrInfo SelectTriedCollision_() EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n     //! Consistency check\n-    void Check()\n-        EXCLUSIVE_LOCKS_REQUIRED(cs)\n+    void Check() EXCLUSIVE_LOCKS_REQUIRED(cs)\n     {\n-#ifdef DEBUG_ADDRMAN\n         AssertLockHeld(cs);\n-        const int err = Check_();\n+\n+        int err = Check_();\n         if (err) {\n             LogPrintf(\"ADDRMAN CONSISTENCY CHECK FAILED!!! err=%i\\n\", err);\n+            assert(false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672382001",
      "id" : 672382001,
      "in_reply_to_id" : 672204994,
      "line" : 739,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MjM4MjAwMQ==",
      "original_commit_id" : "9d5575e27ce3d628c83816bd321bb83a2a6c4c80",
      "original_line" : 739,
      "original_position" : 53,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 53,
      "pull_request_review_id" : 709660740,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-19T15:04:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672382001",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672404847"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672404847"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: clang-format, spaces around `=`",
      "commit_id" : "a343f9079c30e1dce6f13852ff84bab7dab3fcde",
      "created_at" : "2021-07-19T15:29:50Z",
      "diff_hunk" : "@@ -482,7 +485,7 @@ class CAddrMan\n         mapAddr.clear();\n     }\n \n-    CAddrMan()\n+    CAddrMan(int32_t addrman_check=DEFAULT_ADDRMAN_CONSISTENCY_CHECKS) : m_consistency_check(addrman_check)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672404847",
      "id" : 672404847,
      "line" : 488,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MjQwNDg0Nw==",
      "original_commit_id" : "a343f9079c30e1dce6f13852ff84bab7dab3fcde",
      "original_line" : 488,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 24,
      "pull_request_review_id" : 709690567,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-19T16:03:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672404847",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672405977"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672405977"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why remove `const`?",
      "commit_id" : "a343f9079c30e1dce6f13852ff84bab7dab3fcde",
      "created_at" : "2021-07-19T15:31:09Z",
      "diff_hunk" : "@@ -723,22 +729,19 @@ class CAddrMan\n     CAddrInfo SelectTriedCollision_() EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n     //! Consistency check\n-    void Check()\n-        EXCLUSIVE_LOCKS_REQUIRED(cs)\n+    void Check() EXCLUSIVE_LOCKS_REQUIRED(cs)\n     {\n-#ifdef DEBUG_ADDRMAN\n         AssertLockHeld(cs);\n-        const int err = Check_();\n+\n+        int err = Check_();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672405977",
      "id" : 672405977,
      "line" : 736,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MjQwNTk3Nw==",
      "original_commit_id" : "a343f9079c30e1dce6f13852ff84bab7dab3fcde",
      "original_line" : 736,
      "original_position" : 50,
      "original_start_line" : 731,
      "path" : "src/addrman.h",
      "position" : 50,
      "pull_request_review_id" : 709690567,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : 731,
      "start_side" : "LEFT",
      "updated_at" : "2021-07-19T16:03:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672405977",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672410803"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672410803"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n    argsman.AddArg(\"-checkaddrman\", strprintf(\"Do consistency checks on the addrman every <n> operations. Use 0 to disable. (default: %u)\", DEFAULT_ADDRMAN_CONSISTENCY_CHECKS), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\r\n```",
      "commit_id" : "a343f9079c30e1dce6f13852ff84bab7dab3fcde",
      "created_at" : "2021-07-19T15:37:03Z",
      "diff_hunk" : "@@ -502,6 +502,7 @@ void SetupServerArgs(ArgsManager& argsman)\n     argsman.AddArg(\"-checkblocks=<n>\", strprintf(\"How many blocks to check at startup (default: %u, 0 = all)\", DEFAULT_CHECKBLOCKS), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-checklevel=<n>\", strprintf(\"How thorough the block verification of -checkblocks is: %s (0-4, default: %u)\", Join(CHECKLEVEL_DOC, \", \"), DEFAULT_CHECKLEVEL), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-checkblockindex\", strprintf(\"Do a consistency check for the block tree, chainstate, and other validation data structures occasionally. (default: %u, regtest: %u)\", defaultChainParams->DefaultConsistencyChecks(), regtestChainParams->DefaultConsistencyChecks()), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n+    argsman.AddArg(\"-checkaddrman\", strprintf(\"Do consistency checks on the addrman before and after every <n> operations (default: %u)\", DEFAULT_ADDRMAN_CONSISTENCY_CHECKS), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672410803",
      "id" : 672410803,
      "line" : 505,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MjQxMDgwMw==",
      "original_commit_id" : "a343f9079c30e1dce6f13852ff84bab7dab3fcde",
      "original_line" : 505,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 4,
      "pull_request_review_id" : 709690567,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-19T16:03:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672410803",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672428534"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672428534"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This could result in \"sometimes fails, sometimes succeeds\" tests on CI. A developer should always get the failure if using `-checkaddrman=1`. If this is undesirable, then `if (++counter % m_consistency_check == 0)` can be considered to get the checks at deterministic times.",
      "commit_id" : "a343f9079c30e1dce6f13852ff84bab7dab3fcde",
      "created_at" : "2021-07-19T15:58:17Z",
      "diff_hunk" : "@@ -460,11 +460,13 @@ CAddrInfo CAddrMan::Select_(bool newOnly)\n     }\n }\n \n-#ifdef DEBUG_ADDRMAN\n int CAddrMan::Check_()\n {\n     AssertLockHeld(cs);\n \n+    if (m_consistency_check == 0) return 0;\n+    if (GetRand(m_consistency_check) >= 1) return 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672428534",
      "id" : 672428534,
      "line" : 468,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MjQyODUzNA==",
      "original_commit_id" : "a343f9079c30e1dce6f13852ff84bab7dab3fcde",
      "original_line" : 468,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 10,
      "pull_request_review_id" : 709690567,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-19T16:03:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672428534",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672437419"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672437419"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The same is true for `CTxMemPool::check`. At least here we could use `insecure_rand`, which should be deterministic if initialized deterministically. ",
      "commit_id" : "a343f9079c30e1dce6f13852ff84bab7dab3fcde",
      "created_at" : "2021-07-19T16:09:26Z",
      "diff_hunk" : "@@ -460,11 +460,13 @@ CAddrInfo CAddrMan::Select_(bool newOnly)\n     }\n }\n \n-#ifdef DEBUG_ADDRMAN\n int CAddrMan::Check_()\n {\n     AssertLockHeld(cs);\n \n+    if (m_consistency_check == 0) return 0;\n+    if (GetRand(m_consistency_check) >= 1) return 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672437419",
      "id" : 672437419,
      "in_reply_to_id" : 672428534,
      "line" : 468,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MjQzNzQxOQ==",
      "original_commit_id" : "a343f9079c30e1dce6f13852ff84bab7dab3fcde",
      "original_line" : 468,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 10,
      "pull_request_review_id" : 709733274,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-19T16:09:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672437419",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> This results in about 8% slowdown of ./src/test/test_bitcoin on my machine (approx 6m10s -> 6m45s).\r\n\r\nHmmm, that's rather worrying. I'd expect the only test for this to have a material impact on would be the addrman tests, which take less than a second to run. Perhaps the calls to `GetRand()` are expensive enough that even with consistency checks disabled, this has a negative effect on performance.",
      "created_at" : "2021-07-19T17:11:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-882715719",
      "id" : 882715719,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "IC_kwDOABII5840nSxH",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-19T17:11:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/882715719",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "`GetRand` seems unneeded wasteful anyway (it calls `SeedFast` on every call). Have you seen https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672437419 ?",
      "created_at" : "2021-07-19T17:20:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-882722128",
      "id" : 882722128,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "IC_kwDOABII5840nUVQ",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-19T17:20:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/882722128",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> GetRand seems unneeded wasteful anyway (it calls SeedFast on every call). Have you seen #20233 (comment) ?\r\n\r\nI see it. I'll try this with `insecure_rand` tomorrow. Thanks for the tip!",
      "created_at" : "2021-07-19T17:30:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-882728536",
      "id" : 882728536,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "IC_kwDOABII5840nV5Y",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-19T17:30:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/882728536",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-07-20T02:27:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-883003211",
      "id" : 883003211,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "IC_kwDOABII5840oY9L",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-20T02:27:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/883003211",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672815269"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672815269"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`assert(false && \"addrman consistency check failed\");` perhaps? Or `assert(err == 0)` or `Assume(err == 0)`",
      "commit_id" : "a343f9079c30e1dce6f13852ff84bab7dab3fcde",
      "created_at" : "2021-07-20T05:26:23Z",
      "diff_hunk" : "@@ -723,22 +729,19 @@ class CAddrMan\n     CAddrInfo SelectTriedCollision_() EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n     //! Consistency check\n-    void Check()\n-        EXCLUSIVE_LOCKS_REQUIRED(cs)\n+    void Check() EXCLUSIVE_LOCKS_REQUIRED(cs)\n     {\n-#ifdef DEBUG_ADDRMAN\n         AssertLockHeld(cs);\n-        const int err = Check_();\n+\n+        int err = Check_();\n         if (err) {\n             LogPrintf(\"ADDRMAN CONSISTENCY CHECK FAILED!!! err=%i\\n\", err);\n+            assert(false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672815269",
      "id" : 672815269,
      "in_reply_to_id" : 672204994,
      "line" : 739,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MjgxNTI2OQ==",
      "original_commit_id" : "9d5575e27ce3d628c83816bd321bb83a2a6c4c80",
      "original_line" : 739,
      "original_position" : 53,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 53,
      "pull_request_review_id" : 710186687,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-20T05:26:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672815269",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672816243"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672816243"
         }
      },
      "author_association" : "MEMBER",
      "body" : "#22500 ;)",
      "commit_id" : "a343f9079c30e1dce6f13852ff84bab7dab3fcde",
      "created_at" : "2021-07-20T05:29:02Z",
      "diff_hunk" : "@@ -723,22 +729,19 @@ class CAddrMan\n     CAddrInfo SelectTriedCollision_() EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n     //! Consistency check\n-    void Check()\n-        EXCLUSIVE_LOCKS_REQUIRED(cs)\n+    void Check() EXCLUSIVE_LOCKS_REQUIRED(cs)\n     {\n-#ifdef DEBUG_ADDRMAN\n         AssertLockHeld(cs);\n-        const int err = Check_();\n+\n+        int err = Check_();\n         if (err) {\n             LogPrintf(\"ADDRMAN CONSISTENCY CHECK FAILED!!! err=%i\\n\", err);\n+            assert(false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672816243",
      "id" : 672816243,
      "in_reply_to_id" : 672204994,
      "line" : 739,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MjgxNjI0Mw==",
      "original_commit_id" : "9d5575e27ce3d628c83816bd321bb83a2a6c4c80",
      "original_line" : 739,
      "original_position" : 53,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 53,
      "pull_request_review_id" : 710187722,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-20T05:29:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672816243",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672878735"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672878735"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Or set `g_mock_deterministic_tests` to `true` for all tests :eyes: :bomb: ",
      "commit_id" : "a343f9079c30e1dce6f13852ff84bab7dab3fcde",
      "created_at" : "2021-07-20T07:33:55Z",
      "diff_hunk" : "@@ -460,11 +460,13 @@ CAddrInfo CAddrMan::Select_(bool newOnly)\n     }\n }\n \n-#ifdef DEBUG_ADDRMAN\n int CAddrMan::Check_()\n {\n     AssertLockHeld(cs);\n \n+    if (m_consistency_check == 0) return 0;\n+    if (GetRand(m_consistency_check) >= 1) return 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672878735",
      "id" : 672878735,
      "in_reply_to_id" : 672428534,
      "line" : 468,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3Mjg3ODczNQ==",
      "original_commit_id" : "a343f9079c30e1dce6f13852ff84bab7dab3fcde",
      "original_line" : 468,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 10,
      "pull_request_review_id" : 710264114,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-20T07:33:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672878735",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672883161"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672883161"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Would it be a good idea to\r\n1. do the check unconditionally at the end of `Unserialize()` (as if `m_consistency_check == 1`) and\r\n2. if it fails, to treat it as disk corruption - throw `std::ios_base::failure` instead of `abort()`?",
      "commit_id" : "a343f9079c30e1dce6f13852ff84bab7dab3fcde",
      "created_at" : "2021-07-20T07:40:40Z",
      "diff_hunk" : "@@ -723,22 +729,19 @@ class CAddrMan\n     CAddrInfo SelectTriedCollision_() EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n     //! Consistency check\n-    void Check()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672883161",
      "id" : 672883161,
      "line" : 726,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3Mjg4MzE2MQ==",
      "original_commit_id" : "a343f9079c30e1dce6f13852ff84bab7dab3fcde",
      "original_line" : 726,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 42,
      "pull_request_review_id" : 710269786,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-20T07:40:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672883161",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672910911"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672910911"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Seems reasonable. This can be done as a follow-up if desired.",
      "commit_id" : "a343f9079c30e1dce6f13852ff84bab7dab3fcde",
      "created_at" : "2021-07-20T08:20:41Z",
      "diff_hunk" : "@@ -723,22 +729,19 @@ class CAddrMan\n     CAddrInfo SelectTriedCollision_() EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n     //! Consistency check\n-    void Check()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672910911",
      "id" : 672910911,
      "in_reply_to_id" : 672883161,
      "line" : 726,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MjkxMDkxMQ==",
      "original_commit_id" : "a343f9079c30e1dce6f13852ff84bab7dab3fcde",
      "original_line" : 726,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 42,
      "pull_request_review_id" : 710305961,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-20T08:20:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672910911",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672913835"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672913835"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> At least here we could use insecure_rand, which should be deterministic if initialized deterministically.\r\n\r\nThis has the unfortunate effect that the checks are run on the same operations for every run of the unit tests. Having them picked at random means that eventually they're run at every operation in the unit tests. Taking entropy from insecure_rand at different points would also invalidate the tests that have hard-coded values based on the determinstic insecure_rand.",
      "commit_id" : "a343f9079c30e1dce6f13852ff84bab7dab3fcde",
      "created_at" : "2021-07-20T08:24:39Z",
      "diff_hunk" : "@@ -460,11 +460,13 @@ CAddrInfo CAddrMan::Select_(bool newOnly)\n     }\n }\n \n-#ifdef DEBUG_ADDRMAN\n int CAddrMan::Check_()\n {\n     AssertLockHeld(cs);\n \n+    if (m_consistency_check == 0) return 0;\n+    if (GetRand(m_consistency_check) >= 1) return 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672913835",
      "id" : 672913835,
      "in_reply_to_id" : 672428534,
      "line" : 468,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MjkxMzgzNQ==",
      "original_commit_id" : "a343f9079c30e1dce6f13852ff84bab7dab3fcde",
      "original_line" : 468,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 10,
      "pull_request_review_id" : 710309689,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-20T08:24:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672913835",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> This results in about 8% slowdown of ./src/test/test_bitcoin on my machine (approx 6m10s -> 6m45s).\r\n\r\n@vasild how many samples did you take? There's some variance in the time taken to run the entire test suite, so you'll need to run it several times to ensure that this isn't just noise. Here are my results:\r\n\r\nReturning immediately from `_Check()`:\r\n\r\n```\r\nâ time `for i in {1..5}; do ./src/test/test_bitcoin; done`\r\n\r\n[...]\r\n\r\nreal\t4m1.543s\r\nuser\t2m28.929s\r\nsys\t0m25.260s\r\n```\r\n\r\nAnd calling `GetRand(m_consistency_check)` in `_Check()`:\r\n\r\n```\r\nâ time `for i in {1..5}; do ./src/test/test_bitcoin; done`\r\n\r\n[...]\r\n\r\nreal\t4m0.947s\r\nuser\t2m33.306s\r\nsys\t0m21.416s\r\n```\r\n\r\nSo for me, there's essentially no difference.",
      "created_at" : "2021-07-20T10:30:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-883284166",
      "id" : 883284166,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "IC_kwDOABII5840pdjG",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-20T10:30:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/883284166",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r673004759"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/673004759"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done",
      "commit_id" : "b251f68ba7069fdb11cb66c0b6b8acdcce667fc9",
      "created_at" : "2021-07-20T10:33:48Z",
      "diff_hunk" : "@@ -482,7 +485,7 @@ class CAddrMan\n         mapAddr.clear();\n     }\n \n-    CAddrMan()\n+    CAddrMan(int32_t addrman_check=DEFAULT_ADDRMAN_CONSISTENCY_CHECKS) : m_consistency_check(addrman_check)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r673004759",
      "id" : 673004759,
      "in_reply_to_id" : 672404847,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MzAwNDc1OQ==",
      "original_commit_id" : "a343f9079c30e1dce6f13852ff84bab7dab3fcde",
      "original_line" : 488,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 710426774,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-20T10:33:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/673004759",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r673004808"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/673004808"
         }
      },
      "author_association" : "MEMBER",
      "body" : "added back",
      "commit_id" : "b251f68ba7069fdb11cb66c0b6b8acdcce667fc9",
      "created_at" : "2021-07-20T10:33:52Z",
      "diff_hunk" : "@@ -723,22 +729,19 @@ class CAddrMan\n     CAddrInfo SelectTriedCollision_() EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n     //! Consistency check\n-    void Check()\n-        EXCLUSIVE_LOCKS_REQUIRED(cs)\n+    void Check() EXCLUSIVE_LOCKS_REQUIRED(cs)\n     {\n-#ifdef DEBUG_ADDRMAN\n         AssertLockHeld(cs);\n-        const int err = Check_();\n+\n+        int err = Check_();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r673004808",
      "id" : 673004808,
      "in_reply_to_id" : 672405977,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MzAwNDgwOA==",
      "original_commit_id" : "a343f9079c30e1dce6f13852ff84bab7dab3fcde",
      "original_line" : 736,
      "original_position" : 50,
      "original_start_line" : 731,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 710426835,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "LEFT",
      "updated_at" : "2021-07-20T10:33:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/673004808",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r673004862"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/673004862"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done",
      "commit_id" : "b251f68ba7069fdb11cb66c0b6b8acdcce667fc9",
      "created_at" : "2021-07-20T10:33:58Z",
      "diff_hunk" : "@@ -502,6 +502,7 @@ void SetupServerArgs(ArgsManager& argsman)\n     argsman.AddArg(\"-checkblocks=<n>\", strprintf(\"How many blocks to check at startup (default: %u, 0 = all)\", DEFAULT_CHECKBLOCKS), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-checklevel=<n>\", strprintf(\"How thorough the block verification of -checkblocks is: %s (0-4, default: %u)\", Join(CHECKLEVEL_DOC, \", \"), DEFAULT_CHECKLEVEL), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-checkblockindex\", strprintf(\"Do a consistency check for the block tree, chainstate, and other validation data structures occasionally. (default: %u, regtest: %u)\", defaultChainParams->DefaultConsistencyChecks(), regtestChainParams->DefaultConsistencyChecks()), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n+    argsman.AddArg(\"-checkaddrman\", strprintf(\"Do consistency checks on the addrman before and after every <n> operations (default: %u)\", DEFAULT_ADDRMAN_CONSISTENCY_CHECKS), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r673004862",
      "id" : 673004862,
      "in_reply_to_id" : 672410803,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MzAwNDg2Mg==",
      "original_commit_id" : "a343f9079c30e1dce6f13852ff84bab7dab3fcde",
      "original_line" : 505,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 710426906,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-20T10:33:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/673004862",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r673005563"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/673005563"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Leaving this as is for now. The `GetRand()` call doesn't seem to result in a performance degradation from my tests: https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-883284166.",
      "commit_id" : "b251f68ba7069fdb11cb66c0b6b8acdcce667fc9",
      "created_at" : "2021-07-20T10:35:13Z",
      "diff_hunk" : "@@ -460,11 +460,13 @@ CAddrInfo CAddrMan::Select_(bool newOnly)\n     }\n }\n \n-#ifdef DEBUG_ADDRMAN\n int CAddrMan::Check_()\n {\n     AssertLockHeld(cs);\n \n+    if (m_consistency_check == 0) return 0;\n+    if (GetRand(m_consistency_check) >= 1) return 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r673005563",
      "id" : 673005563,
      "in_reply_to_id" : 672428534,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MzAwNTU2Mw==",
      "original_commit_id" : "a343f9079c30e1dce6f13852ff84bab7dab3fcde",
      "original_line" : 468,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 710427912,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-20T10:35:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/673005563",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r673814769"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/673814769"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks @MarcoFalke. I've added the two commits from that PR into this branch.",
      "commit_id" : "b251f68ba7069fdb11cb66c0b6b8acdcce667fc9",
      "created_at" : "2021-07-21T09:30:44Z",
      "diff_hunk" : "@@ -723,22 +729,19 @@ class CAddrMan\n     CAddrInfo SelectTriedCollision_() EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n     //! Consistency check\n-    void Check()\n-        EXCLUSIVE_LOCKS_REQUIRED(cs)\n+    void Check() EXCLUSIVE_LOCKS_REQUIRED(cs)\n     {\n-#ifdef DEBUG_ADDRMAN\n         AssertLockHeld(cs);\n-        const int err = Check_();\n+\n+        int err = Check_();\n         if (err) {\n             LogPrintf(\"ADDRMAN CONSISTENCY CHECK FAILED!!! err=%i\\n\", err);\n+            assert(false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r673814769",
      "id" : 673814769,
      "in_reply_to_id" : 672204994,
      "line" : 744,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MzgxNDc2OQ==",
      "original_commit_id" : "9d5575e27ce3d628c83816bd321bb83a2a6c4c80",
      "original_line" : 744,
      "original_position" : 53,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 53,
      "pull_request_review_id" : 711450563,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-21T09:30:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/673814769",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Added the two commits from PR #22500, to resolve the various suggestions in this thread: https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672204994.",
      "created_at" : "2021-07-21T09:31:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-884041364",
      "id" : 884041364,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "IC_kwDOABII5840sWaU",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-21T09:31:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/884041364",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke has just told me that he no longer believes that #22500 is the right approach, so I've removed those two commits again.",
      "created_at" : "2021-07-21T09:41:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-884047846",
      "id" : 884047846,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "IC_kwDOABII5840sX_m",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-21T09:41:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/884047846",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r675103344"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/675103344"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Perhaps use `insecure_rand.randrange(m_consistency_check_ratio)`? Probably orders of magnitude faster...",
      "commit_id" : "b251f68ba7069fdb11cb66c0b6b8acdcce667fc9",
      "created_at" : "2021-07-22T19:27:35Z",
      "diff_hunk" : "@@ -459,11 +459,14 @@ CAddrInfo CAddrMan::Select_(bool newOnly)\n     }\n }\n \n-#ifdef DEBUG_ADDRMAN\n int CAddrMan::Check_()\n {\n     AssertLockHeld(cs);\n \n+    // Run consistency checks 1 in m_consistency_check_ratio times if enabled\n+    if (m_consistency_check_ratio == 0) return 0;\n+    if (GetRand(m_consistency_check_ratio) >= 1) return 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r675103344",
      "id" : 675103344,
      "line" : 468,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3NTEwMzM0NA==",
      "original_commit_id" : "b251f68ba7069fdb11cb66c0b6b8acdcce667fc9",
      "original_line" : 468,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 11,
      "pull_request_review_id" : 713159227,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-22T19:27:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/675103344",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r675114327"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/675114327"
         }
      },
      "author_association" : "MEMBER",
      "body" : "See previous discussion: https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672913835",
      "commit_id" : "b251f68ba7069fdb11cb66c0b6b8acdcce667fc9",
      "created_at" : "2021-07-22T19:45:47Z",
      "diff_hunk" : "@@ -459,11 +459,14 @@ CAddrInfo CAddrMan::Select_(bool newOnly)\n     }\n }\n \n-#ifdef DEBUG_ADDRMAN\n int CAddrMan::Check_()\n {\n     AssertLockHeld(cs);\n \n+    // Run consistency checks 1 in m_consistency_check_ratio times if enabled\n+    if (m_consistency_check_ratio == 0) return 0;\n+    if (GetRand(m_consistency_check_ratio) >= 1) return 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r675114327",
      "id" : 675114327,
      "in_reply_to_id" : 675103344,
      "line" : 468,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3NTExNDMyNw==",
      "original_commit_id" : "b251f68ba7069fdb11cb66c0b6b8acdcce667fc9",
      "original_line" : 468,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 11,
      "pull_request_review_id" : 713173134,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-22T19:45:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/675114327",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r675123971"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/675123971"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think I was mistaken about this causing problems for the unit tests. I'll try again with insecure_rand tomorrow.",
      "commit_id" : "b251f68ba7069fdb11cb66c0b6b8acdcce667fc9",
      "created_at" : "2021-07-22T20:01:27Z",
      "diff_hunk" : "@@ -459,11 +459,14 @@ CAddrInfo CAddrMan::Select_(bool newOnly)\n     }\n }\n \n-#ifdef DEBUG_ADDRMAN\n int CAddrMan::Check_()\n {\n     AssertLockHeld(cs);\n \n+    // Run consistency checks 1 in m_consistency_check_ratio times if enabled\n+    if (m_consistency_check_ratio == 0) return 0;\n+    if (GetRand(m_consistency_check_ratio) >= 1) return 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r675123971",
      "id" : 675123971,
      "in_reply_to_id" : 675103344,
      "line" : 468,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3NTEyMzk3MQ==",
      "original_commit_id" : "b251f68ba7069fdb11cb66c0b6b8acdcce667fc9",
      "original_line" : 468,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 11,
      "pull_request_review_id" : 713185474,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-22T20:01:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/675123971",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r675218487"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/675218487"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The same `MakeDeterministic()` also exists in `net_tests.cpp` and should be changed there too to prevent `net_tests/caddrdb_read` from failing (though I'm not sure why these tests are there, looks to me like they should be integrated into `addrman_tests.cpp` or removed if redundant).",
      "commit_id" : "b251f68ba7069fdb11cb66c0b6b8acdcce667fc9",
      "created_at" : "2021-07-22T23:11:11Z",
      "diff_hunk" : "@@ -34,7 +34,7 @@ class CAddrManTest : public CAddrMan\n     //! Ensure that bucket placement is always the same for testing purposes.\n     void MakeDeterministic()\n     {\n-        nKey.SetNull();\n+        nKey = uint256{1};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r675218487",
      "id" : 675218487,
      "line" : 38,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3NTIxODQ4Nw==",
      "original_commit_id" : "21112bd5df84d468d87b207d5023c7f4ed10f950",
      "original_line" : 37,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/addrman_tests.cpp",
      "position" : 13,
      "pull_request_review_id" : 713302526,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-22T23:11:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/675218487",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r675451225"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/675451225"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "6818d5e82f0a2ce5a7092c5a2b9d0760eca60866",
      "created_at" : "2021-07-23T10:01:16Z",
      "diff_hunk" : "@@ -459,11 +459,14 @@ CAddrInfo CAddrMan::Select_(bool newOnly)\n     }\n }\n \n-#ifdef DEBUG_ADDRMAN\n int CAddrMan::Check_()\n {\n     AssertLockHeld(cs);\n \n+    // Run consistency checks 1 in m_consistency_check_ratio times if enabled\n+    if (m_consistency_check_ratio == 0) return 0;\n+    if (GetRand(m_consistency_check_ratio) >= 1) return 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r675451225",
      "id" : 675451225,
      "in_reply_to_id" : 675103344,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3NTQ1MTIyNQ==",
      "original_commit_id" : "b251f68ba7069fdb11cb66c0b6b8acdcce667fc9",
      "original_line" : 468,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 713577361,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-23T10:01:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/675451225",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r675452435"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/675452435"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oh good spot! There's also a deterministic addrman in the fuzzers.\r\n\r\nI've added a `deterministic` argument to the `CAddrMan` ctor (similar to `TxRequestTracker`) to consolidate these into one place, so that the tests can just ask for a deterministic addrman rather than constructing and addrman and then updating its internals.\r\n\r\nI agree that those addrman tests in net_tests.cpp should be moved to addrman_tests.cpp, but that can be done in another PR.",
      "commit_id" : "6818d5e82f0a2ce5a7092c5a2b9d0760eca60866",
      "created_at" : "2021-07-23T10:03:16Z",
      "diff_hunk" : "@@ -34,7 +34,7 @@ class CAddrManTest : public CAddrMan\n     //! Ensure that bucket placement is always the same for testing purposes.\n     void MakeDeterministic()\n     {\n-        nKey.SetNull();\n+        nKey = uint256{1};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r675452435",
      "id" : 675452435,
      "in_reply_to_id" : 675218487,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3NTQ1MjQzNQ==",
      "original_commit_id" : "21112bd5df84d468d87b207d5023c7f4ed10f950",
      "original_line" : 37,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/addrman_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 713578984,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-23T10:03:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/675452435",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the recent review comments @sipa @MarcoFalke @mzumsande. All comments should now be addressed.",
      "created_at" : "2021-07-23T10:04:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-885533996",
      "id" : 885533996,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "IC_kwDOABII5840yC0s",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-23T10:04:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/885533996",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r675581724"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/675581724"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is still true, right?\r\n\r\n> This has the unfortunate effect that the checks are run on the same operations for every run of the unit tests. Having them picked at random means that eventually they're run at every operation in the unit tests.\r\n\r\nFrom https://github.com/bitcoin/bitcoin/pull/20233#discussion_r672913835",
      "commit_id" : "6818d5e82f0a2ce5a7092c5a2b9d0760eca60866",
      "created_at" : "2021-07-23T13:52:17Z",
      "diff_hunk" : "@@ -459,11 +459,14 @@ CAddrInfo CAddrMan::Select_(bool newOnly)\n     }\n }\n \n-#ifdef DEBUG_ADDRMAN\n int CAddrMan::Check_()\n {\n     AssertLockHeld(cs);\n \n+    // Run consistency checks 1 in m_consistency_check_ratio times if enabled\n+    if (m_consistency_check_ratio == 0) return 0;\n+    if (insecure_rand.randrange(m_consistency_check_ratio) >= 1) return 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r675581724",
      "id" : 675581724,
      "line" : 468,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3NTU4MTcyNA==",
      "original_commit_id" : "6818d5e82f0a2ce5a7092c5a2b9d0760eca60866",
      "original_line" : 468,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 11,
      "pull_request_review_id" : 713749409,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-23T13:52:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/675581724",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r675628010"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/675628010"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, I think this is true, but I'm not sure how big a problem it is. Before this PR we weren't running the consistency tests at all in the unit tests.",
      "commit_id" : "6818d5e82f0a2ce5a7092c5a2b9d0760eca60866",
      "created_at" : "2021-07-23T14:54:39Z",
      "diff_hunk" : "@@ -459,11 +459,14 @@ CAddrInfo CAddrMan::Select_(bool newOnly)\n     }\n }\n \n-#ifdef DEBUG_ADDRMAN\n int CAddrMan::Check_()\n {\n     AssertLockHeld(cs);\n \n+    // Run consistency checks 1 in m_consistency_check_ratio times if enabled\n+    if (m_consistency_check_ratio == 0) return 0;\n+    if (insecure_rand.randrange(m_consistency_check_ratio) >= 1) return 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r675628010",
      "id" : 675628010,
      "in_reply_to_id" : 675581724,
      "line" : 468,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3NTYyODAxMA==",
      "original_commit_id" : "6818d5e82f0a2ce5a7092c5a2b9d0760eca60866",
      "original_line" : 468,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 11,
      "pull_request_review_id" : 713812174,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-23T14:54:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/675628010",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r676472503"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/676472503"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: initialize `insecure_rand` here:\r\n\r\n```suggestion\r\n        : insecure_rand(deterministic), m_consistency_check_ratio(consistency_check_ratio)          \r\n```\r\n\r\nand remove `insecure_rand = FastRandomContext(true);` from below.\r\n\r\nAlso, given that `Clear()` (called from the constructor) contains `nKey = insecure_rand.rand256();` maybe also remove `nKey = uint256{1};` from below.",
      "commit_id" : "24515fee608f992ecc9af3cfc174a0a27c112df6",
      "created_at" : "2021-07-26T10:14:12Z",
      "diff_hunk" : "@@ -486,9 +489,15 @@ class CAddrMan\n         mapAddr.clear();\n     }\n \n-    CAddrMan()\n+    CAddrMan(bool deterministic = false,\n+             int32_t consistency_check_ratio = DEFAULT_ADDRMAN_CONSISTENCY_CHECKS)\n+        : m_consistency_check_ratio(consistency_check_ratio)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r676472503",
      "id" : 676472503,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3NjQ3MjUwMw==",
      "original_commit_id" : "6818d5e82f0a2ce5a7092c5a2b9d0760eca60866",
      "original_line" : 494,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 714674335,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-26T12:43:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/676472503",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r676730241"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/676730241"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've moved the `insecure_rand` to the initializer list as suggested.\r\n\r\nI'm not going to remove the `nKey` assignment in this PR. I'd like to remove the `Clear()` method from `CAddrMan` in a future PR. The only place it's used in the product code is if peers.dat deserialization fails, we'll call `Clear()`. I think it's better just to instantiate a new `CAddrMan` object in that case, since it's definitely possible to imagine new data being added to `CAddrMan` and not added to the `Clear()` method. It wasn't previously possible to instantiate a new `CAddrMan` since it was a global initialized before `main()`, but now that its lifetime is managed to `context.node`, we can just reset the unique ptr to a new instance.",
      "commit_id" : "24515fee608f992ecc9af3cfc174a0a27c112df6",
      "created_at" : "2021-07-26T15:49:38Z",
      "diff_hunk" : "@@ -486,9 +489,15 @@ class CAddrMan\n         mapAddr.clear();\n     }\n \n-    CAddrMan()\n+    CAddrMan(bool deterministic = false,\n+             int32_t consistency_check_ratio = DEFAULT_ADDRMAN_CONSISTENCY_CHECKS)\n+        : m_consistency_check_ratio(consistency_check_ratio)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r676730241",
      "id" : 676730241,
      "in_reply_to_id" : 676472503,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3NjczMDI0MQ==",
      "original_commit_id" : "6818d5e82f0a2ce5a7092c5a2b9d0760eca60866",
      "original_line" : 494,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 715011518,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-26T15:49:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/676730241",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the review @vasild! I've taken your suggestion of setting `insecure_rand` in the initializer list.\r\n\r\nI've also removed the default args for the `CAddrMan` constructor, since default args are evil and can hide subtle bugs.",
      "created_at" : "2021-07-26T16:00:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-886827484",
      "id" : 886827484,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "IC_kwDOABII58402-nc",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-26T16:00:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/886827484",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r676753548"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/676753548"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: here and below - indentation of 3 spaces",
      "commit_id" : "24515fee608f992ecc9af3cfc174a0a27c112df6",
      "created_at" : "2021-07-26T16:17:49Z",
      "diff_hunk" : "@@ -82,7 +82,7 @@ static void AddrManAdd(benchmark::Bench& bench)\n \n static void AddrManSelect(benchmark::Bench& bench)\n {\n-    CAddrMan addrman;\n+   CAddrMan addrman(/* deterministic */ false, /* consistency_checks */ 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r676753548",
      "id" : 676753548,
      "line" : 85,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3Njc1MzU0OA==",
      "original_commit_id" : "24515fee608f992ecc9af3cfc174a0a27c112df6",
      "original_line" : 85,
      "original_position" : 14,
      "original_start_line" : 85,
      "path" : "src/bench/addrman.cpp",
      "position" : 14,
      "pull_request_review_id" : 715041423,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : 85,
      "start_side" : "LEFT",
      "updated_at" : "2021-07-26T16:34:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/676753548",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r676764762"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/676764762"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In the previous incarnation of this PR which did not pass `consistency_checks` explicitly: `CAddrMan addrman(/* deterministic */ false)` it would have equaled to `DEFAULT_ADDRMAN_CONSISTENCY_CHECKS`.\r\n\r\nIn the latest incarnation (24515fee60) `0` is passed explicitly.\r\n\r\nThis contains the assumption that `DEFAULT_ADDRMAN_CONSISTENCY_CHECKS` is `0` which is true now, but could change in the future.\r\n\r\nI think it is good to keep using `DEFAULT_ADDRMAN_CONSISTENCY_CHECKS` as default value instead of `0`. That is, either call `CAddrMan addrman(/* deterministic */ false, DEFAULT_ADDRMAN_CONSISTENCY_CHECKS)` in all places or restore the default second argument, which defaults to `DEFAULT_ADDRMAN_CONSISTENCY_CHECKS`.",
      "commit_id" : "24515fee608f992ecc9af3cfc174a0a27c112df6",
      "created_at" : "2021-07-26T16:32:33Z",
      "diff_hunk" : "@@ -25,7 +25,7 @@ FUZZ_TARGET_INIT(connman, initialize_connman)\n {\n     FuzzedDataProvider fuzzed_data_provider{buffer.data(), buffer.size()};\n     SetMockTime(ConsumeTime(fuzzed_data_provider));\n-    CAddrMan addrman;\n+    CAddrMan addrman(/* deterministic */ false, /* consistency_checks */ 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r676764762",
      "id" : 676764762,
      "line" : 28,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3Njc2NDc2Mg==",
      "original_commit_id" : "24515fee608f992ecc9af3cfc174a0a27c112df6",
      "original_line" : 28,
      "original_position" : 5,
      "original_start_line" : 28,
      "path" : "src/test/fuzz/connman.cpp",
      "position" : 5,
      "pull_request_review_id" : 715041423,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : 28,
      "start_side" : "LEFT",
      "updated_at" : "2021-07-26T16:34:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/676764762",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r676766775"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/676766775"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe also adding `explicit` would make sense.",
      "commit_id" : "24515fee608f992ecc9af3cfc174a0a27c112df6",
      "created_at" : "2021-07-26T16:35:02Z",
      "diff_hunk" : "@@ -486,9 +489,15 @@ class CAddrMan\n         mapAddr.clear();\n     }\n \n-    CAddrMan()\n+    CAddrMan(bool deterministic = false,\n+             int32_t consistency_check_ratio = DEFAULT_ADDRMAN_CONSISTENCY_CHECKS)\n+        : m_consistency_check_ratio(consistency_check_ratio)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r676766775",
      "id" : 676766775,
      "in_reply_to_id" : 676472503,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3Njc2Njc3NQ==",
      "original_commit_id" : "6818d5e82f0a2ce5a7092c5a2b9d0760eca60866",
      "original_line" : 494,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 715058057,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-26T16:35:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/676766775",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r677247258"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/677247258"
         }
      },
      "author_association" : "MEMBER",
      "body" : "oops. Fixed.",
      "commit_id" : "0f959391190d973f09ea8ba5d4f34a87e2164040",
      "created_at" : "2021-07-27T08:45:49Z",
      "diff_hunk" : "@@ -82,7 +82,7 @@ static void AddrManAdd(benchmark::Bench& bench)\n \n static void AddrManSelect(benchmark::Bench& bench)\n {\n-    CAddrMan addrman;\n+   CAddrMan addrman(/* deterministic */ false, /* consistency_checks */ 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r677247258",
      "id" : 677247258,
      "in_reply_to_id" : 676753548,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3NzI0NzI1OA==",
      "original_commit_id" : "24515fee608f992ecc9af3cfc174a0a27c112df6",
      "original_line" : 85,
      "original_position" : 14,
      "original_start_line" : 85,
      "path" : "src/bench/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 715651060,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "LEFT",
      "updated_at" : "2021-07-27T08:45:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/677247258",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r677247457"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/677247457"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Made the ctor explicit.",
      "commit_id" : "0f959391190d973f09ea8ba5d4f34a87e2164040",
      "created_at" : "2021-07-27T08:46:05Z",
      "diff_hunk" : "@@ -486,9 +489,15 @@ class CAddrMan\n         mapAddr.clear();\n     }\n \n-    CAddrMan()\n+    CAddrMan(bool deterministic = false,\n+             int32_t consistency_check_ratio = DEFAULT_ADDRMAN_CONSISTENCY_CHECKS)\n+        : m_consistency_check_ratio(consistency_check_ratio)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r677247457",
      "id" : 677247457,
      "in_reply_to_id" : 676472503,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3NzI0NzQ1Nw==",
      "original_commit_id" : "6818d5e82f0a2ce5a7092c5a2b9d0760eca60866",
      "original_line" : 494,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 715651334,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-27T08:46:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/677247457",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r677250016"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/677250016"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's the other way around. The previous version implicitly assumed that the `DEFAULT_ADDRMAN_CONSISTENCY_CHECKS` was 0. This line is explicitly saying that we want an addrman without consistency checks.\r\n\r\nIf we used `DEFAULT_ADDRMAN_CONSISTENCY_CHECKS` explicitly in the call sites and that value changes in future (unlikely I think, since we don't want these debug checks enabled in production), then all call sites would have to be checked to make sure that the change in behavior is what is wanted. For example, we certainly wouldn't want to enable the consistency checks in benchmarks, since it'd totally skew the measurements.",
      "commit_id" : "0f959391190d973f09ea8ba5d4f34a87e2164040",
      "created_at" : "2021-07-27T08:49:19Z",
      "diff_hunk" : "@@ -25,7 +25,7 @@ FUZZ_TARGET_INIT(connman, initialize_connman)\n {\n     FuzzedDataProvider fuzzed_data_provider{buffer.data(), buffer.size()};\n     SetMockTime(ConsumeTime(fuzzed_data_provider));\n-    CAddrMan addrman;\n+    CAddrMan addrman(/* deterministic */ false, /* consistency_checks */ 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r677250016",
      "id" : 677250016,
      "in_reply_to_id" : 676764762,
      "line" : 28,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3NzI1MDAxNg==",
      "original_commit_id" : "24515fee608f992ecc9af3cfc174a0a27c112df6",
      "original_line" : 28,
      "original_position" : 5,
      "original_start_line" : 28,
      "path" : "src/test/fuzz/connman.cpp",
      "position" : 5,
      "pull_request_review_id" : 715654517,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : 28,
      "start_side" : "LEFT",
      "updated_at" : "2021-07-27T08:49:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/677250016",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r677450006"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/677450006"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I see, makes sense, thanks for the elaboration!",
      "commit_id" : "0f959391190d973f09ea8ba5d4f34a87e2164040",
      "created_at" : "2021-07-27T13:28:58Z",
      "diff_hunk" : "@@ -25,7 +25,7 @@ FUZZ_TARGET_INIT(connman, initialize_connman)\n {\n     FuzzedDataProvider fuzzed_data_provider{buffer.data(), buffer.size()};\n     SetMockTime(ConsumeTime(fuzzed_data_provider));\n-    CAddrMan addrman;\n+    CAddrMan addrman(/* deterministic */ false, /* consistency_checks */ 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r677450006",
      "id" : 677450006,
      "in_reply_to_id" : 676764762,
      "line" : 28,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3NzQ1MDAwNg==",
      "original_commit_id" : "24515fee608f992ecc9af3cfc174a0a27c112df6",
      "original_line" : 28,
      "original_position" : 5,
      "original_start_line" : 28,
      "path" : "src/test/fuzz/connman.cpp",
      "position" : 5,
      "pull_request_review_id" : 715914488,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : 28,
      "start_side" : "LEFT",
      "updated_at" : "2021-07-27T13:28:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/677450006",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Before this PR, it was possible to run all unit and fuzz tests with checks enabled on every step (when compiled with `DEBUG_ADDRMAN`). One had to recompile, but changing the source code was not necessary.\r\n\r\nWith this PR, addrman unit tests are run with checks on every 100th step, other unit tests and fuzz tests have the checks disabled. To change that (to enable the checks or get them more often than once per 100), a modification of the source code is necessary on the following lines:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/0f959391190d973f09ea8ba5d4f34a87e2164040/src/test/addrman_tests.cpp#L25\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/0f959391190d973f09ea8ba5d4f34a87e2164040/src/test/fuzz/addrman.cpp#L29\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/0f959391190d973f09ea8ba5d4f34a87e2164040/src/test/fuzz/connman.cpp#L28\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/0f959391190d973f09ea8ba5d4f34a87e2164040/src/test/fuzz/data_stream.cpp#L24\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/0f959391190d973f09ea8ba5d4f34a87e2164040/src/test/fuzz/deserialize.cpp#L202\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/0f959391190d973f09ea8ba5d4f34a87e2164040/src/test/net_tests.cpp#L38\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/0f959391190d973f09ea8ba5d4f34a87e2164040/src/test/net_tests.cpp#L122\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/0f959391190d973f09ea8ba5d4f34a87e2164040/src/test/net_tests.cpp#L139\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/0f959391190d973f09ea8ba5d4f34a87e2164040/src/test/net_tests.cpp#L153\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/0f959391190d973f09ea8ba5d4f34a87e2164040/src/test/net_tests.cpp#L169\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/0f959391190d973f09ea8ba5d4f34a87e2164040/src/test/util/setup_common.cpp#L196\r\n\r\nWhat about replacing those hardcoded `0`s (no checks) with a constant `DEFAULT_ADDRMAN_CONSISTENCY_CHECKS_IN_TESTS` that can be easily changed in order to enable the checks? Or maybe have two constants `..._IN_ADDRMAN_TESTS=100` and `..._IN_TESTS=0`.\r\n\r\nOr replace the `0`s with something like `m_args.GetArg(\"-checkaddrman\", 0)` so that the checks can be enabled without modifying the source code, e.g.:\r\n```\r\n./src/test/test_bitcoin --run_test=\"net_tests/*\" -- -checkaddrman=5\r\n```",
      "created_at" : "2021-07-30T10:54:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-889813074",
      "id" : 889813074,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "IC_kwDOABII5841CXhS",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-30T10:54:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/889813074",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-08-02T11:32:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-890953151",
      "id" : 890953151,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "IC_kwDOABII5841Gt2_",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-02T11:32:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/890953151",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased and taken the fix from #22601.\r\n\r\n> What about replacing those hardcoded 0s (no checks) with a constant DEFAULT_ADDRMAN_CONSISTENCY_CHECKS_IN_TESTS that can be easily changed in order to enable the checks? Or maybe have two constants ..._IN_ADDRMAN_TESTS=100 and ..._IN_TESTS=0.\r\n\r\n> Or replace the 0s with something like m_args.GetArg(\"-checkaddrman\", 0) so that the checks can be enabled without modifying the source code.\r\n\r\n@vasild - This can be done in a follow-up PR if desired. This PR has already gone through multiple rounds of review, so I'd like to settle on a final version of it now.",
      "created_at" : "2021-08-02T13:09:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-891013192",
      "id" : 891013192,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "IC_kwDOABII5841G8hI",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-02T13:09:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/891013192",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK\r\n\r\nThis approach seems to resolve a lot of potential headache caused by the fact that barely anyone ever builds with DEBUG_ADDRMAN (see https://github.com/bitcoin/bitcoin/pull/21940#issuecomment-890937517 for an example where this caused problems) and we don't have a CI instance running with it. The only slight drawback I could think of this solution is that the (released) bitcoind binary is a little bit larger compared to the current compile-time flag approach, containing code that the average user will never run. OTOH the fact that with this the tests can trigger regular addrman consistency checks with the default build outweights this by far :)",
      "created_at" : "2021-08-02T20:31:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-891313223",
      "id" : 891313223,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "IC_kwDOABII5841IFxH",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-02T20:31:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/891313223",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r682766066"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/682766066"
         }
      },
      "author_association" : "MEMBER",
      "body" : "7883160 suggestion\r\n```diff\r\n- *    * Several indexes are kept for high performance. Setting m_consistency_check_ratio will introduce (expensive)\r\n- *      consistency checks for the entire data structure.\r\n+ *    * Several indexes are kept for high performance. Setting m_consistency_check_ratio with the -checkaddrman\r\n+        configuration option will introduce (expensive) consistency checks for the entire data structure.\r\n```\r\n",
      "commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "created_at" : "2021-08-04T16:16:49Z",
      "diff_hunk" : "@@ -119,7 +122,7 @@ class CAddrInfo : public CAddress\n  *        tried ones) is evicted from it, back to the \"new\" buckets.\n  *    * Bucket selection is based on cryptographic hashing, using a randomly-generated 256-bit key, which should not\n  *      be observable by adversaries.\n- *    * Several indexes are kept for high performance. Defining DEBUG_ADDRMAN will introduce frequent (and expensive)\n+ *    * Several indexes are kept for high performance. Setting m_consistency_check_ratio will introduce (expensive)\n  *      consistency checks for the entire data structure.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r682766066",
      "id" : 682766066,
      "line" : 126,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4Mjc2NjA2Ng==",
      "original_commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "original_line" : 126,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 16,
      "pull_request_review_id" : 722484116,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-04T16:59:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/682766066",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r682768076"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/682768076"
         }
      },
      "author_association" : "MEMBER",
      "body" : "7883160 missng `=<n>`? (and optional suggestions for the descriptions)\r\n\r\n```diff\r\n-    argsman.AddArg(\"-checkaddrman\", strprintf(\"Do consistency checks on the addrman every <n> operations. Use 0 to disable. (default: %u)\", DEFAULT_ADDRMAN_CONSISTENCY_CHECKS), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\r\n-    argsman.AddArg(\"-checkmempool=<n>\", strprintf(\"Run checks every <n> transactions (default: %u, regtest: %u)\", defaultChainParams->DefaultConsistencyChecks(), regtestChainParams->DefaultConsistencyChecks()), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\r\n+    argsman.AddArg(\"-checkaddrman=<n>\", strprintf(\"Run addrman consistency checks every <n> operations. Use 0 to disable. (default: %u)\", DEFAULT_ADDRMAN_CONSISTENCY_CHECKS), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\r\n+    argsman.AddArg(\"-checkmempool=<n>\", strprintf(\"Run mempool consistency checks every <n> transactions (default: %u, regtest: %u)\", defaultChainParams->DefaultConsistencyChecks(), regtestChainParams->DefaultConsistencyChecks()), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\r\n```\r\n",
      "commit_id" : "a4d78546b0858602c60c03fdf8b35ca666ab2e56",
      "created_at" : "2021-08-04T16:19:18Z",
      "diff_hunk" : "@@ -501,6 +501,7 @@ void SetupServerArgs(ArgsManager& argsman)\n     argsman.AddArg(\"-checkblocks=<n>\", strprintf(\"How many blocks to check at startup (default: %u, 0 = all)\", DEFAULT_CHECKBLOCKS), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-checklevel=<n>\", strprintf(\"How thorough the block verification of -checkblocks is: %s (0-4, default: %u)\", Join(CHECKLEVEL_DOC, \", \"), DEFAULT_CHECKLEVEL), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-checkblockindex\", strprintf(\"Do a consistency check for the block tree, chainstate, and other validation data structures occasionally. (default: %u, regtest: %u)\", defaultChainParams->DefaultConsistencyChecks(), regtestChainParams->DefaultConsistencyChecks()), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n+    argsman.AddArg(\"-checkaddrman\", strprintf(\"Do consistency checks on the addrman every <n> operations. Use 0 to disable. (default: %u)\", DEFAULT_ADDRMAN_CONSISTENCY_CHECKS), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-checkmempool=<n>\", strprintf(\"Run checks every <n> transactions (default: %u, regtest: %u)\", defaultChainParams->DefaultConsistencyChecks(), regtestChainParams->DefaultConsistencyChecks()), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r682768076",
      "id" : 682768076,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4Mjc2ODA3Ng==",
      "original_commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "original_line" : 505,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 722484116,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-07T10:17:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/682768076",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r682770019"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/682770019"
         }
      },
      "author_association" : "MEMBER",
      "body" : "579584d Should the 4 CAddrMan ctors that follow pass deterministic `true` instead of `false`?\r\n\r\n```diff\r\n-    CAddrMan addrman1(/* deterministic */ false, /* consistency_checks */ 0);\r\n+    CAddrMan addrman1(/* deterministic */ true, /* consistency_checks */ 0);\r\n```\r\n",
      "commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "created_at" : "2021-08-04T16:21:43Z",
      "diff_hunk" : "@@ -105,7 +101,6 @@ BOOST_AUTO_TEST_CASE(cnode_listen_port)\n BOOST_AUTO_TEST_CASE(caddrdb_read)\n {\n     CAddrManUncorrupted addrmanUncorrupted;\n-    addrmanUncorrupted.MakeDeterministic();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r682770019",
      "id" : 682770019,
      "line" : 108,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4Mjc3MDAxOQ==",
      "original_commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "original_line" : 108,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : 21,
      "pull_request_review_id" : 722484116,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-04T16:51:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/682770019",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r682771234"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/682771234"
         }
      },
      "author_association" : "MEMBER",
      "body" : "579584d nit, prefer prefix iterator (idem in addrman_tests.cpp)\r\n```suggestion\r\n    for (size_t i{0}; i < addrman_count; ++i) {\r\n```",
      "commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "created_at" : "2021-08-04T16:23:12Z",
      "diff_hunk" : "@@ -112,10 +112,12 @@ static void AddrManGood(benchmark::Bench& bench)\n      * we want to do the same amount of work in every loop iteration. */\n \n     bench.epochs(5).epochIterations(1);\n+    size_t addrman_count = bench.epochs() * bench.epochIterations();\n \n-    std::vector<CAddrMan> addrmans(bench.epochs() * bench.epochIterations());\n-    for (auto& addrman : addrmans) {\n-        FillAddrMan(addrman);\n+    std::vector<std::unique_ptr<CAddrMan>> addrmans(addrman_count);\n+    for (size_t i{0}; i < addrman_count; i++) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r682771234",
      "id" : 682771234,
      "line" : 118,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4Mjc3MTIzNA==",
      "original_commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "original_line" : 118,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/bench/addrman.cpp",
      "position" : 37,
      "pull_request_review_id" : 722484116,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-04T16:51:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/682771234",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r682772126"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/682772126"
         }
      },
      "author_association" : "MEMBER",
      "body" : "579584d for benchmarks would it be preferable to pass deterministic `true`?\r\n",
      "commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "created_at" : "2021-08-04T16:24:18Z",
      "diff_hunk" : "@@ -112,10 +112,12 @@ static void AddrManGood(benchmark::Bench& bench)\n      * we want to do the same amount of work in every loop iteration. */\n \n     bench.epochs(5).epochIterations(1);\n+    size_t addrman_count = bench.epochs() * bench.epochIterations();\n \n-    std::vector<CAddrMan> addrmans(bench.epochs() * bench.epochIterations());\n-    for (auto& addrman : addrmans) {\n-        FillAddrMan(addrman);\n+    std::vector<std::unique_ptr<CAddrMan>> addrmans(addrman_count);\n+    for (size_t i{0}; i < addrman_count; i++) {\n+        addrmans[i] = std::make_unique<CAddrMan>(/* deterministic */ false, /* consistency_checks */ 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r682772126",
      "id" : 682772126,
      "line" : 119,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4Mjc3MjEyNg==",
      "original_commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "original_line" : 119,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/bench/addrman.cpp",
      "position" : 38,
      "pull_request_review_id" : 722484116,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-04T16:51:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/682772126",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r682772390"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/682772390"
         }
      },
      "author_association" : "MEMBER",
      "body" : "579584d nit, can be const",
      "commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "created_at" : "2021-08-04T16:24:38Z",
      "diff_hunk" : "@@ -112,10 +112,12 @@ static void AddrManGood(benchmark::Bench& bench)\n      * we want to do the same amount of work in every loop iteration. */\n \n     bench.epochs(5).epochIterations(1);\n+    size_t addrman_count = bench.epochs() * bench.epochIterations();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r682772390",
      "id" : 682772390,
      "line" : 115,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4Mjc3MjM5MA==",
      "original_commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "original_line" : 115,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/bench/addrman.cpp",
      "position" : 31,
      "pull_request_review_id" : 722484116,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-04T16:51:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/682772390",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r682776199"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/682776199"
         }
      },
      "author_association" : "MEMBER",
      "body" : "7883160 negative values would be meaningless and value is clamped in range 0...1000000; could be unsigned\r\n\r\n<details><summary>tested diff</summary><p>\r\n\r\n```diff\r\n--- a/src/addrman.h\r\n+++ b/src/addrman.h\r\n@@ -27,7 +27,7 @@ \r\n /** Default for -checkaddrman */\r\n /** Default for -checkaddrman */\r\n-static constexpr int32_t DEFAULT_ADDRMAN_CONSISTENCY_CHECKS{0};\r\n+static constexpr uint32_t DEFAULT_ADDRMAN_CONSISTENCY_CHECKS{0};\r\n \r\n@@ -495,7 +495,7 @@ public: \r\n-    explicit CAddrMan(bool deterministic, int32_t consistency_check_ratio)\r\n+    explicit CAddrMan(bool deterministic, uint32_t consistency_check_ratio)\r\n\r\n@@ -704,7 +704,7 @@ private:\r\n     /** Perform consistency checks every m_consistency_check_ratio operations (if non-zero). */\r\n-    const int32_t m_consistency_check_ratio;\r\n+    const uint32_t m_consistency_check_ratio;\r\n\r\n--- a/src/init.cpp\r\n+++ b/src/init.cpp\r\n@@ -1165,7 +1165,7 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\r\n \r\n     assert(!node.addrman);\r\n-    auto check_addrman = std::clamp<int32_t>(args.GetArg(\"-checkaddrman\", DEFAULT_ADDRMAN_CONSISTENCY_CHECKS), 0, 1000000);\r\n+    auto check_addrman = std::clamp<uint32_t>(args.GetArg(\"-checkaddrman\", DEFAULT_ADDRMAN_CONSISTENCY_CHECKS), 0, 1000000);\r\n```\r\n</p></details>\r\n",
      "commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "created_at" : "2021-08-04T16:29:35Z",
      "diff_hunk" : "@@ -691,6 +697,9 @@ class CAddrMan\n     //! Holds addrs inserted into tried table that collide with existing entries. Test-before-evict discipline used to resolve these collisions.\n     std::set<int> m_tried_collisions;\n \n+    /** Perform consistency checks every m_consistency_check_ratio operations (if non-zero). */\n+    const int32_t m_consistency_check_ratio;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r682776199",
      "id" : 682776199,
      "line" : 701,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4Mjc3NjE5OQ==",
      "original_commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "original_line" : 701,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 55,
      "pull_request_review_id" : 722484116,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-04T16:55:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/682776199",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "In 0d2d0de the commit message states \"addrman_tests fail when consistency checks are enabled\"...I was unable to reproduce this failure in the preceding commits. Is it still the case, should the message be updated, can the commit be dropped?",
      "created_at" : "2021-08-04T16:54:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-892816577",
      "id" : 892816577,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "IC_kwDOABII5841N0zB",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-05T01:12:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/892816577",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r682796896"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/682796896"
         }
      },
      "author_association" : "MEMBER",
      "body" : "78831602\r\n```bash\r\n$ test/lint/lint-spelling.sh \r\nsrc/init.cpp:1164: determinstic ==> deterministic\r\n```\r\n",
      "commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "created_at" : "2021-08-04T16:58:03Z",
      "diff_hunk" : "@@ -1159,7 +1160,8 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     const bool ignores_incoming_txs{args.GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY)};\n \n     assert(!node.addrman);\n-    node.addrman = std::make_unique<CAddrMan>();\n+    auto check_addrman = std::clamp<int32_t>(args.GetArg(\"-checkaddrman\", DEFAULT_ADDRMAN_CONSISTENCY_CHECKS), 0, 1000000);\n+    node.addrman = std::make_unique<CAddrMan>(/* determinstic */ false, /* consistency_checks */ check_addrman);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r682796896",
      "id" : 682796896,
      "line" : 1164,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4Mjc5Njg5Ng==",
      "original_commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "original_line" : 1164,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 14,
      "pull_request_review_id" : 722523877,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-04T16:58:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/682796896",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r683005930"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/683005930"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: the variable name `addrs` makes me think its a vector since that's a common naming pattern in the codebase, so I'd prefer if this was something like `num_addrs`. ",
      "commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "created_at" : "2021-08-04T22:39:58Z",
      "diff_hunk" : "@@ -256,24 +256,27 @@ BOOST_AUTO_TEST_CASE(addrman_new_collisions)\n \n     CNetAddr source = ResolveIP(\"252.2.2.2\");\n \n-    BOOST_CHECK_EQUAL(addrman.size(), 0U);\n+    uint32_t addrs{0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r683005930",
      "id" : 683005930,
      "line" : 259,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4MzAwNTkzMA==",
      "original_commit_id" : "0d2d0dee480c5841ea01cc6a7dd2ddd68dfe14e1",
      "original_line" : 259,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/test/addrman_tests.cpp",
      "position" : 41,
      "pull_request_review_id" : 722795655,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-04T23:24:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/683005930",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r683018519"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/683018519"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could it make sense to enable the consistency checks here? \r\n\r\nI saw the conversation here https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-755188580, where you said: \r\n> I think somewhere that they're definitely useful would be in fuzz testing, to ensure that there's no way to violate addrman's invariants.\r\n\r\nSo wondering why you landed on disabling.",
      "commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "created_at" : "2021-08-04T23:12:39Z",
      "diff_hunk" : "@@ -26,7 +26,7 @@ FUZZ_TARGET_INIT(addrman, initialize_addrman)\n {\n     FuzzedDataProvider fuzzed_data_provider(buffer.data(), buffer.size());\n     SetMockTime(ConsumeTime(fuzzed_data_provider));\n-    CAddrMan addr_man(/* deterministic */ true);\n+    CAddrMan addr_man(/* deterministic */ true, /* consistency_checks */ 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r683018519",
      "id" : 683018519,
      "line" : 29,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4MzAxODUxOQ==",
      "original_commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "original_line" : 29,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/fuzz/addrman.cpp",
      "position" : 20,
      "pull_request_review_id" : 722795655,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-04T23:24:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/683018519",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-08-05T14:43:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-893516315",
      "id" : 893516315,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "IC_kwDOABII5841Qfob",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-05T14:43:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/893516315",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r683551331"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/683551331"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done",
      "commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "created_at" : "2021-08-05T15:16:32Z",
      "diff_hunk" : "@@ -119,7 +122,7 @@ class CAddrInfo : public CAddress\n  *        tried ones) is evicted from it, back to the \"new\" buckets.\n  *    * Bucket selection is based on cryptographic hashing, using a randomly-generated 256-bit key, which should not\n  *      be observable by adversaries.\n- *    * Several indexes are kept for high performance. Defining DEBUG_ADDRMAN will introduce frequent (and expensive)\n+ *    * Several indexes are kept for high performance. Setting m_consistency_check_ratio will introduce (expensive)\n  *      consistency checks for the entire data structure.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r683551331",
      "id" : 683551331,
      "in_reply_to_id" : 682766066,
      "line" : 126,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4MzU1MTMzMQ==",
      "original_commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "original_line" : 126,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 16,
      "pull_request_review_id" : 723487066,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-05T15:16:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/683551331",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r683551893"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/683551893"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's the same default for both mainnet and regtest (disabled).",
      "commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "created_at" : "2021-08-05T15:17:14Z",
      "diff_hunk" : "@@ -501,6 +501,7 @@ void SetupServerArgs(ArgsManager& argsman)\n     argsman.AddArg(\"-checkblocks=<n>\", strprintf(\"How many blocks to check at startup (default: %u, 0 = all)\", DEFAULT_CHECKBLOCKS), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-checklevel=<n>\", strprintf(\"How thorough the block verification of -checkblocks is: %s (0-4, default: %u)\", Join(CHECKLEVEL_DOC, \", \"), DEFAULT_CHECKLEVEL), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-checkblockindex\", strprintf(\"Do a consistency check for the block tree, chainstate, and other validation data structures occasionally. (default: %u, regtest: %u)\", defaultChainParams->DefaultConsistencyChecks(), regtestChainParams->DefaultConsistencyChecks()), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n+    argsman.AddArg(\"-checkaddrman\", strprintf(\"Do consistency checks on the addrman every <n> operations. Use 0 to disable. (default: %u)\", DEFAULT_ADDRMAN_CONSISTENCY_CHECKS), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-checkmempool=<n>\", strprintf(\"Run checks every <n> transactions (default: %u, regtest: %u)\", defaultChainParams->DefaultConsistencyChecks(), regtestChainParams->DefaultConsistencyChecks()), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r683551893",
      "id" : 683551893,
      "in_reply_to_id" : 682768076,
      "line" : 505,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4MzU1MTg5Mw==",
      "original_commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "original_line" : 505,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 5,
      "pull_request_review_id" : 723487861,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-05T15:17:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/683551893",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r683553195"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/683553195"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think so. They weren't deterministic before.",
      "commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "created_at" : "2021-08-05T15:18:39Z",
      "diff_hunk" : "@@ -105,7 +101,6 @@ BOOST_AUTO_TEST_CASE(cnode_listen_port)\n BOOST_AUTO_TEST_CASE(caddrdb_read)\n {\n     CAddrManUncorrupted addrmanUncorrupted;\n-    addrmanUncorrupted.MakeDeterministic();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r683553195",
      "id" : 683553195,
      "in_reply_to_id" : 682770019,
      "line" : 108,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4MzU1MzE5NQ==",
      "original_commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "original_line" : 108,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : 21,
      "pull_request_review_id" : 723489584,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-05T15:18:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/683553195",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r683556161"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/683556161"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed here. I don't think I've added any `i++` in addrman_tests.cpp.",
      "commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "created_at" : "2021-08-05T15:21:49Z",
      "diff_hunk" : "@@ -112,10 +112,12 @@ static void AddrManGood(benchmark::Bench& bench)\n      * we want to do the same amount of work in every loop iteration. */\n \n     bench.epochs(5).epochIterations(1);\n+    size_t addrman_count = bench.epochs() * bench.epochIterations();\n \n-    std::vector<CAddrMan> addrmans(bench.epochs() * bench.epochIterations());\n-    for (auto& addrman : addrmans) {\n-        FillAddrMan(addrman);\n+    std::vector<std::unique_ptr<CAddrMan>> addrmans(addrman_count);\n+    for (size_t i{0}; i < addrman_count; i++) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r683556161",
      "id" : 683556161,
      "in_reply_to_id" : 682771234,
      "line" : 118,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4MzU1NjE2MQ==",
      "original_commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "original_line" : 118,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/bench/addrman.cpp",
      "position" : 37,
      "pull_request_review_id" : 723493420,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-05T15:21:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/683556161",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r683556703"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/683556703"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Perhaps, but that's a change in behaviour. Maybe we can do it in a follow up PR.",
      "commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "created_at" : "2021-08-05T15:22:24Z",
      "diff_hunk" : "@@ -112,10 +112,12 @@ static void AddrManGood(benchmark::Bench& bench)\n      * we want to do the same amount of work in every loop iteration. */\n \n     bench.epochs(5).epochIterations(1);\n+    size_t addrman_count = bench.epochs() * bench.epochIterations();\n \n-    std::vector<CAddrMan> addrmans(bench.epochs() * bench.epochIterations());\n-    for (auto& addrman : addrmans) {\n-        FillAddrMan(addrman);\n+    std::vector<std::unique_ptr<CAddrMan>> addrmans(addrman_count);\n+    for (size_t i{0}; i < addrman_count; i++) {\n+        addrmans[i] = std::make_unique<CAddrMan>(/* deterministic */ false, /* consistency_checks */ 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r683556703",
      "id" : 683556703,
      "in_reply_to_id" : 682772126,
      "line" : 119,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4MzU1NjcwMw==",
      "original_commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "original_line" : 119,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/bench/addrman.cpp",
      "position" : 38,
      "pull_request_review_id" : 723494083,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-05T15:22:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/683556703",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r683557598"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/683557598"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done",
      "commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "created_at" : "2021-08-05T15:23:21Z",
      "diff_hunk" : "@@ -112,10 +112,12 @@ static void AddrManGood(benchmark::Bench& bench)\n      * we want to do the same amount of work in every loop iteration. */\n \n     bench.epochs(5).epochIterations(1);\n+    size_t addrman_count = bench.epochs() * bench.epochIterations();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r683557598",
      "id" : 683557598,
      "in_reply_to_id" : 682772390,
      "line" : 115,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4MzU1NzU5OA==",
      "original_commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "original_line" : 115,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/bench/addrman.cpp",
      "position" : 31,
      "pull_request_review_id" : 723495289,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-05T15:23:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/683557598",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r683559040"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/683559040"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Since we're already clamping the value, I don't think it matters.",
      "commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "created_at" : "2021-08-05T15:24:51Z",
      "diff_hunk" : "@@ -691,6 +697,9 @@ class CAddrMan\n     //! Holds addrs inserted into tried table that collide with existing entries. Test-before-evict discipline used to resolve these collisions.\n     std::set<int> m_tried_collisions;\n \n+    /** Perform consistency checks every m_consistency_check_ratio operations (if non-zero). */\n+    const int32_t m_consistency_check_ratio;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r683559040",
      "id" : 683559040,
      "in_reply_to_id" : 682776199,
      "line" : 701,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4MzU1OTA0MA==",
      "original_commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "original_line" : 701,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 55,
      "pull_request_review_id" : 723497100,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-05T15:24:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/683559040",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r683563507"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/683563507"
         }
      },
      "author_association" : "MEMBER",
      "body" : "fixed",
      "commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "created_at" : "2021-08-05T15:29:39Z",
      "diff_hunk" : "@@ -1159,7 +1160,8 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     const bool ignores_incoming_txs{args.GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY)};\n \n     assert(!node.addrman);\n-    node.addrman = std::make_unique<CAddrMan>();\n+    auto check_addrman = std::clamp<int32_t>(args.GetArg(\"-checkaddrman\", DEFAULT_ADDRMAN_CONSISTENCY_CHECKS), 0, 1000000);\n+    node.addrman = std::make_unique<CAddrMan>(/* determinstic */ false, /* consistency_checks */ check_addrman);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r683563507",
      "id" : 683563507,
      "in_reply_to_id" : 682796896,
      "line" : 1164,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4MzU2MzUwNw==",
      "original_commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "original_line" : 1164,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 14,
      "pull_request_review_id" : 723503180,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-05T15:29:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/683563507",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r683563784"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/683563784"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added here and to the other fuzzers.",
      "commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "created_at" : "2021-08-05T15:29:59Z",
      "diff_hunk" : "@@ -26,7 +26,7 @@ FUZZ_TARGET_INIT(addrman, initialize_addrman)\n {\n     FuzzedDataProvider fuzzed_data_provider(buffer.data(), buffer.size());\n     SetMockTime(ConsumeTime(fuzzed_data_provider));\n-    CAddrMan addr_man(/* deterministic */ true);\n+    CAddrMan addr_man(/* deterministic */ true, /* consistency_checks */ 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r683563784",
      "id" : 683563784,
      "in_reply_to_id" : 683018519,
      "line" : 29,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4MzU2Mzc4NA==",
      "original_commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "original_line" : 29,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/fuzz/addrman.cpp",
      "position" : 20,
      "pull_request_review_id" : 723503585,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-05T15:29:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/683563784",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r683594181"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/683594181"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done!",
      "commit_id" : "00fd0891ce799084fdd137fafc0522c27fbfb429",
      "created_at" : "2021-08-05T16:07:57Z",
      "diff_hunk" : "@@ -256,24 +256,27 @@ BOOST_AUTO_TEST_CASE(addrman_new_collisions)\n \n     CNetAddr source = ResolveIP(\"252.2.2.2\");\n \n-    BOOST_CHECK_EQUAL(addrman.size(), 0U);\n+    uint32_t addrs{0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r683594181",
      "id" : 683594181,
      "in_reply_to_id" : 683005930,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4MzU5NDE4MQ==",
      "original_commit_id" : "0d2d0dee480c5841ea01cc6a7dd2ddd68dfe14e1",
      "original_line" : 259,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/test/addrman_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 723544302,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-05T16:07:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/683594181",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased and addressed review comments from @jonatack and @amitiuttarwar ",
      "created_at" : "2021-08-05T16:15:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-893586268",
      "id" : 893586268,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "IC_kwDOABII5841Qwtc",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-05T16:15:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/893586268",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> In 0d2d0de the commit message states \"addrman_tests fail when consistency checks are enabled\"...I was unable to reproduce this failure in the preceding commits. Is it still the case, should the message be updated, can the commit be dropped?\r\n\r\n@jonatack - I think it's still true. Try enabling `DEBUG_ADDRMAN` and running the addrman tests here: https://github.com/jnewbery/bitcoin/tree/2021-08-fail-addrman-tests\r\n\r\nThe first commit fixes the build so it's possible to build with `DEBUG_ADDRMAN`. The second commit aborts if `Check()` fails, rather than just logging.\r\n\r\nWithout the _Make deterministic addrman use nKey = 1_ commit, then when we make addrman checks a runtime option and add the assert, then the tests would fail.",
      "created_at" : "2021-08-05T17:17:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-893635010",
      "id" : 893635010,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "IC_kwDOABII5841Q8nC",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-05T17:17:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/893635010",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks @jnewbery, I'll have a look (once the guix build finishes â°)",
      "created_at" : "2021-08-05T17:48:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-893661732",
      "id" : 893661732,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "IC_kwDOABII5841RDIk",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-05T17:48:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/893661732",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "reACK 00fd0891ce",
      "created_at" : "2021-08-06T18:55:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-894455854",
      "id" : 894455854,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "IC_kwDOABII5841UFAu",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-06T18:55:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/894455854",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 00fd0891ce799084fdd137fafc0522c27fbfb429 per `git range-diff 03826ae 7883160 00fd089` modulo the addrman fuzzer crash\r\n\r\n<details><summary>reproduced the CI addrman fuzzer crash locally</summary><p>\r\n\r\n```bash\r\nSUMMARY: UndefinedBehaviorSanitizer: undefined-behavior serialize.h:205:93 in \r\nfuzz: ./addrman.h:754: void CAddrMan::Check() const: Assertion `false' failed.\r\n==62677== ERROR: libFuzzer: deadly signal\r\n    #0 0x55f7ef82d671 in __sanitizer_print_stack_trace (/home/jon/projects/bitcoin/bitcoin/src/test/fuzz/fuzz+0x1000671)\r\n    #1 0x55f7ef775008 in fuzzer::PrintStackTrace() fuzzer.o\r\n    #2 0x55f7ef758ef3 in fuzzer::Fuzzer::CrashCallback() fuzzer.o\r\n    #3 0x7fe5896ab13f  (/lib/x86_64-linux-gnu/libpthread.so.0+0x1413f)\r\n    #4 0x7fe589317ce0 in __libc_signal_restore_set signal/../sysdeps/unix/sysv/linux/internal-signals.h:86:3\r\n    #5 0x7fe589317ce0 in raise signal/../sysdeps/unix/sysv/linux/raise.c:48:3\r\n    #6 0x7fe589301536 in abort stdlib/abort.c:79:7\r\n    #7 0x7fe58930140e in __assert_fail_base assert/assert.c:92:3\r\n    #8 0x7fe589310661 in __assert_fail assert/assert.c:101:3\r\n    #9 0x55f7ef86ed17 in CAddrMan::Check() const ./addrman.h:754:13\r\n    #10 0x55f7ef866d2c in CAddrMan::Select(bool) const ./addrman.h:601:9\r\n    #11 0x55f7ef8638e1 in addrman_fuzz_target(Span<unsigned char const>) test/fuzz/addrman.cpp:306:26\r\n    #12 0x55f7ef85b9d5 in void std::__invoke_impl<void, void (*&)(Span<unsigned char const>), Span<unsigned char const> >(std::__invoke_other, void (*&)(Span<unsigned char const>), Span<unsigned char const>&&) /usr/bin/../lib/gcc/x86_64-linux-gnu/10/../../../../include/c++/10/bits/invoke.h:60:14\r\n    #13 0x55f7ef85b89d in std::enable_if<is_invocable_r_v<void, void (*&)(Span<unsigned char const>), Span<unsigned char const> >, void>::type std::__invoke_r<void, void (*&)(Span<unsigned char const>), Span<unsigned char const> >(void (*&)(Span<unsigned char const>), Span<unsigned char const>&&) /usr/bin/../lib/gcc/x86_64-linux-gnu/10/../../../../include/c++/10/bits/invoke.h:110:2\r\n    #14 0x55f7ef85b608 in std::_Function_handler<void (Span<unsigned char const>), void (*)(Span<unsigned char const>)>::_M_invoke(std::_Any_data const&, Span<unsigned char const>&&) /usr/bin/../lib/gcc/x86_64-linux-gnu/10/../../../../include/c++/10/bits/std_function.h:291:9\r\n    #15 0x55f7f078934d in std::function<void (Span<unsigned char const>)>::operator()(Span<unsigned char const>) const /usr/bin/../lib/gcc/x86_64-linux-gnu/10/../../../../include/c++/10/bits/std_function.h:622:14\r\n    #16 0x55f7f0788ff8 in LLVMFuzzerTestOneInput test/fuzz/fuzz.cpp:91:5\r\n    #17 0x55f7ef75a783 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) fuzzer.o\r\n    #18 0x55f7ef759c8a in fuzzer::Fuzzer::RunOne(unsigned char const*, unsigned long, bool, fuzzer::InputInfo*, bool, bool*) fuzzer.o\r\n    #19 0x55f7ef75c084 in fuzzer::Fuzzer::ReadAndExecuteSeedCorpora(std::__Fuzzer::vector<fuzzer::SizedFile, fuzzer::fuzzer_allocator<fuzzer::SizedFile> >&) fuzzer.o\r\n    #20 0x55f7ef75c299 in fuzzer::Fuzzer::Loop(std::__Fuzzer::vector<fuzzer::SizedFile, fuzzer::fuzzer_allocator<fuzzer::SizedFile> >&) fuzzer.o\r\n    #21 0x55f7ef74bae7 in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) fuzzer.o\r\n    #22 0x55f7ef7757c2 in main (/home/jon/projects/bitcoin/bitcoin/src/test/fuzz/fuzz+0xf487c2)\r\n    #23 0x7fe589302d09 in __libc_start_main csu/../csu/libc-start.c:308:16\r\n    #24 0x55f7ef722969 in _start (/home/jon/projects/bitcoin/bitcoin/src/test/fuzz/fuzz+0xef5969)\r\n\r\nNOTE: libFuzzer has rudimentary signal handlers.\r\n      Combine libFuzzer with AddressSanitizer or similar for better crash reports.\r\nSUMMARY: libFuzzer: deadly signal\r\nMS: 0 ; base unit: 0000000000000000000000000000000000000000\r\n0x0,0x0,0x0,0x0,0x0,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0xe1,0xdc,0xdc,0xdc,0xdc,0xdc,0xdc,0xdc,0x23,0x23,0x23,0xbb,0x1,0x0,0x0,0x23,0x27,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x40,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x0,0x0,0x0,0x0,0x1,0x0,0x0,0x0,0x0,0x0,0xf,0xda,0x3f,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x23,0x23,0x0,0x0,0x0,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0xff,0xff,0xff,0x1f,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,0xf4,0xf4,0xf4,0xf4,0xf4,0xf4,0xf4,0xf4,0xf4,0xb4,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x23,0x23,0x23,0x23,0x23,0x23,0xe1,0xdc,0xdc,0xdc,0xdc,0x32,0xa3,0x1,0x0,0x0,0x0,0x0,0x0,0x0,0x41,0x0,0xff,0x0,0x0,0xff,0x0,0x0,0x2b,\r\n\\x00\\x00\\x00\\x00\\x00#############\\xe1\\xdc\\xdc\\xdc\\xdc\\xdc\\xdc\\xdc###\\xbb\\x01\\x00\\x00#'#############@#################\\x00\\x00\\x00\\x00\\x01\\x00\\x00\\x00\\x00\\x00\\x0f\\xda?\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00##\\x00\\x00\\x00########\\xff\\xff\\xff\\x1f####################\\xf4\\xf4\\xf4\\xf4\\xf4\\xf4\\xf4\\xf4\\xf4\\xb4\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff######\\xe1\\xdc\\xdc\\xdc\\xdc2\\xa3\\x01\\x00\\x00\\x00\\x00\\x00\\x00A\\x00\\xff\\x00\\x00\\xff\\x00\\x00+\r\nartifact_prefix='./'; Test unit written to ./crash-d20c926b04d9e4e2657d97d3c5e77bde0e9a9daa\r\nBase64: AAAAAAAjIyMjIyMjIyMjIyMj4dzc3Nzc3NwjIyO7AQAAIycjIyMjIyMjIyMjIyMjQCMjIyMjIyMjIyMjIyMjIyMjAAAAAAEAAAAAAA/aPwAAAAAAAAAAAAAAIyMAAAAjIyMjIyMjI////x8jIyMjIyMjIyMjIyMjIyMjIyMjI/T09PT09PT09LT///////////////////8jIyMjIyPh3Nzc3DKjAQAAAAAAAEEA/wAA/wAAKw==\r\n```\r\n</p></details>\r\n\r\nDon't hesitate to reconsider taking the suggestion at https://github.com/bitcoin/bitcoin/pull/20233#discussion_r682768076.\r\n\r\n\r\n> Without the _Make deterministic addrman use nKey = 1_ commit, then when we make addrman checks a runtime option and add the assert, then the tests would fail.\r\n\r\nGot it. You are right--I dropped that commit and the addrman unit tests fail.\r\n\r\n",
      "created_at" : "2021-08-07T10:14:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-894635035",
      "id" : 894635035,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "IC_kwDOABII5841Uwwb",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-07T10:14:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/894635035",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r686725613"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686725613"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "a4d78546b0858602c60c03fdf8b35ca666ab2e56",
      "created_at" : "2021-08-11T11:04:11Z",
      "diff_hunk" : "@@ -501,6 +501,7 @@ void SetupServerArgs(ArgsManager& argsman)\n     argsman.AddArg(\"-checkblocks=<n>\", strprintf(\"How many blocks to check at startup (default: %u, 0 = all)\", DEFAULT_CHECKBLOCKS), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-checklevel=<n>\", strprintf(\"How thorough the block verification of -checkblocks is: %s (0-4, default: %u)\", Join(CHECKLEVEL_DOC, \", \"), DEFAULT_CHECKLEVEL), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-checkblockindex\", strprintf(\"Do a consistency check for the block tree, chainstate, and other validation data structures occasionally. (default: %u, regtest: %u)\", defaultChainParams->DefaultConsistencyChecks(), regtestChainParams->DefaultConsistencyChecks()), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n+    argsman.AddArg(\"-checkaddrman\", strprintf(\"Do consistency checks on the addrman every <n> operations. Use 0 to disable. (default: %u)\", DEFAULT_ADDRMAN_CONSISTENCY_CHECKS), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-checkmempool=<n>\", strprintf(\"Run checks every <n> transactions (default: %u, regtest: %u)\", defaultChainParams->DefaultConsistencyChecks(), regtestChainParams->DefaultConsistencyChecks()), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r686725613",
      "id" : 686725613,
      "in_reply_to_id" : 682768076,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NjcyNTYxMw==",
      "original_commit_id" : "7883160288226ddc9a682e48647efef051a6286e",
      "original_line" : 505,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 727345910,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-11T11:04:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/686725613",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've disabled the consistency checks again in the addrman fuzz test. I think the problem is that the fuzzer will call `Clear()`, and subsequent calls to `Check()` may fail, since `Clear()` may leave the CAddrMan in a slightly inconsistent state.\r\n\r\nI have a branch that removes `Clear()` at https://github.com/jnewbery/bitcoin/tree/2021-08-remove-addrman-clear, which I'll open after this is merged, and then re-enable consistency checks in the fuzzer.",
      "created_at" : "2021-08-11T11:11:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-896737668",
      "id" : 896737668,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "IC_kwDOABII5841cyGE",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-11T11:11:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/896737668",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK a4d78546b0858602c60c03fdf8b35ca666ab2e56 per `git diff 00fd089 a4d7854`, tested by adding logging similar to #22479 and running with `-checkaddrman=<n>` for various values 0/1/10/100 etc, tested the updated docs with `bitcoind -help-debug | grep -A2 \"checkaddrman\\|checkmempool\"` and verified rebased on master that compiling with `CPPFLAGS=\"-DDEBUG_ADDRMAN\"` no longer causes the build to error.\r\n\r\n```diff\r\nsrc/addrman.cpp\r\n@@ -438,6 +438,7 @@ int CAddrMan::Check_() const\r\n     // Run consistency checks 1 in m_consistency_check_ratio times if enabled\r\n     if (m_consistency_check_ratio == 0) return 0;\r\n     if (insecure_rand.randrange(m_consistency_check_ratio) >= 1) return 0;\r\n+    LogPrintf(\"Check addrman\\n\");\r\n```\r\n\r\n```\r\n$ ./src/bitcoind -help-debug | grep -A2 \"checkaddrman\\|checkmempool\"\r\n  -checkaddrman=<n>\r\n       Run addrman consistency checks every <n> operations. Use 0 to disable.\r\n       (default: 0)\r\n--\r\n  -checkmempool=<n>\r\n       Run mempool consistency checks every <n> transactions. Use 0 to disable.\r\n       (default: 0, regtest: 1)\r\n```\r\n",
      "created_at" : "2021-08-12T17:02:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-897808457",
      "id" : 897808457,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "IC_kwDOABII5841g3hJ",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-12T17:02:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/897808457",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Code-review ACK a4d78546b0858602c60c03fdf8b35ca666ab2e56\r\nAlso did some testing with different values of `-checkaddrman` and it worked as expected.",
      "created_at" : "2021-08-12T21:39:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-897985846",
      "id" : 897985846,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "IC_kwDOABII5841hi02",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-12T21:39:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/897985846",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r688324819"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/688324819"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n    BOOST_CHECK_EQUAL(addrman.size(), 36);\r\n```",
      "commit_id" : "a4d78546b0858602c60c03fdf8b35ca666ab2e56",
      "created_at" : "2021-08-13T08:04:56Z",
      "diff_hunk" : "@@ -862,20 +868,20 @@ BOOST_AUTO_TEST_CASE(addrman_noevict)\n         BOOST_CHECK(addrman.SelectTriedCollision().ToString() == \"[::]:0\");\n     }\n \n-    // Collision between 23 and 19.\n-    CService addr23 = ResolveService(\"250.1.1.23\");\n-    BOOST_CHECK(addrman.Add(CAddress(addr23, NODE_NONE), source));\n-    addrman.Good(addr23);\n+    // Collision between 36 and 19.\n+    CService addr36 = ResolveService(\"250.1.1.36\");\n+    BOOST_CHECK(addrman.Add(CAddress(addr36, NODE_NONE), source));\n+    addrman.Good(addr36);\n \n-    BOOST_CHECK(addrman.size() == 23);\n-    BOOST_CHECK(addrman.SelectTriedCollision().ToString() == \"250.1.1.19:0\");\n+    BOOST_CHECK(addrman.size() == 36);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r688324819",
      "id" : 688324819,
      "line" : 876,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4ODMyNDgxOQ==",
      "original_commit_id" : "10aac241455a3270462d49b53732477ed97623e7",
      "original_line" : 876,
      "original_position" : 109,
      "original_start_line" : null,
      "path" : "src/test/addrman_tests.cpp",
      "position" : 136,
      "pull_request_review_id" : 729364999,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-13T08:23:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/688324819",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r688325369"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/688325369"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n    BOOST_CHECK_EQUAL(addrman.size(), 59);\r\n```",
      "commit_id" : "a4d78546b0858602c60c03fdf8b35ca666ab2e56",
      "created_at" : "2021-08-13T08:05:57Z",
      "diff_hunk" : "@@ -885,17 +891,17 @@ BOOST_AUTO_TEST_CASE(addrman_noevict)\n     }\n \n     // Cause a collision.\n-    CService addr33 = ResolveService(\"250.1.1.33\");\n-    BOOST_CHECK(addrman.Add(CAddress(addr33, NODE_NONE), source));\n-    addrman.Good(addr33);\n-    BOOST_CHECK(addrman.size() == 33);\n+    CService addr59 = ResolveService(\"250.1.1.59\");\n+    BOOST_CHECK(addrman.Add(CAddress(addr59, NODE_NONE), source));\n+    addrman.Good(addr59);\n+    BOOST_CHECK(addrman.size() == 59);\n \n-    BOOST_CHECK(addrman.SelectTriedCollision().ToString() == \"250.1.1.27:0\");\n+    BOOST_CHECK_EQUAL(addrman.SelectTriedCollision().ToString(), \"250.1.1.10:0\");\n \n     // Cause a second collision.\n-    BOOST_CHECK(!addrman.Add(CAddress(addr23, NODE_NONE), source));\n-    addrman.Good(addr23);\n-    BOOST_CHECK(addrman.size() == 33);\n+    BOOST_CHECK(!addrman.Add(CAddress(addr36, NODE_NONE), source));\n+    addrman.Good(addr36);\n+    BOOST_CHECK(addrman.size() == 59);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#discussion_r688325369",
      "id" : 688325369,
      "line" : 904,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4ODMyNTM2OQ==",
      "original_commit_id" : "10aac241455a3270462d49b53732477ed97623e7",
      "original_line" : 904,
      "original_position" : 145,
      "original_start_line" : null,
      "path" : "src/test/addrman_tests.cpp",
      "position" : 172,
      "pull_request_review_id" : 729364999,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20233",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-13T08:23:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/688325369",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The various nits/changes mentioned can be done in a followup. Either separately, or potentially as part of the `Clear()` branch.",
      "created_at" : "2021-08-13T09:02:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-898302500",
      "id" : 898302500,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "IC_kwDOABII5841iwIk",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-13T09:02:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/898302500",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I've disabled the consistency checks again in the addrman fuzz test. I think the problem is that the fuzzer will call `Clear()`, and subsequent calls to `Check()` may fail, since `Clear()` may leave the CAddrMan in a slightly inconsistent state.\r\n> \r\n> I have a branch that removes `Clear()` at https://github.com/jnewbery/bitcoin/tree/2021-08-remove-addrman-clear, which I'll open after this is merged, and then re-enable consistency checks in the fuzzer.\r\n\r\nNot sure if this is sufficient. Since #22493, we have a fuzz test that deserializes from random data, and `Unserialize()` doesn't seem to be designed to prevent the finer inconsistencies from occurring that `Check()` checks for. I verified that the fuzz inputs from #22503 and #22519 still crash when running on this PR with `consistency_check_ratio=1` (#22504 doesn't for some reason)\r\n`",
      "created_at" : "2021-08-13T09:11:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-898307721",
      "id" : 898307721,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "IC_kwDOABII5841ixaJ",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-13T09:11:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/898307721",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : ">> ... replace the 0s with something like `m_args.GetArg(\"-checkaddrman\", 0)` so that the checks can be enabled without modifying the source code.\r\n\r\n> @vasild - This can be done in a follow-up PR ...\r\n\r\nDone in https://github.com/bitcoin/bitcoin/pull/23373.\r\n",
      "created_at" : "2021-10-27T12:24:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20233#issuecomment-952871817",
      "id" : 952871817,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20233",
      "node_id" : "IC_kwDOABII5844y6uJ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/952871817/reactions"
      },
      "updated_at" : "2021-10-27T12:24:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/952871817",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   }
]
