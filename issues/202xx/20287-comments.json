[
   {
      "author_association" : "MEMBER",
      "body" : "It's a bit hard to test this, but I'm pretty sure it happens.\r\n\r\nFor BnB coin selection, we call `OutputGroup::GetPositiveOnlyGroup`. This will remove from the `OutputGroup` any dust outputs. But if after the removal, the `OutputGroup`'s effective value is still positive, then it remains available for coin selection. So it is possible that BnB will select an `OutputGroup` but not the dust outputs associated with the same destination, so the avoid partial spends condition is violated.\r\n\r\nThis does have a privacy risk as the user may think that avoid partial spends is active, but then a partial spend occurs. If this risk is indeed a problem, then we could just remove any `OutputGroup` that contains dust outputs, regardless of the other outputs in that group. However this has a DoS attack risk. If an attacker sends dust outputs to existing addresses, then it is possible for that attacker to prevent someone who has enabled avoid partial spends from spending any of their coins because all `OutputGroup`s would be removed for containing dust.",
      "created_at" : "2020-11-02T23:22:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/20287#issuecomment-720781742",
      "id" : 720781742,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20287",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyMDc4MTc0Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-02T23:22:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/720781742",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Even though `OutputGroup::GetPositiveOnlyGroup` has been refactored away, it looks to me that this is still an issue as `GroupOutputs()` is still filtering by `EffectiveValue() >0`:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/8d12127a9c19cb218d661a88ab9b6871c9d853b9/src/wallet/spend.cpp#L470-L473\r\n\r\nIf we remove the dust filter here then we become liable to a dust attack where an attacker could send us many dust outputs which would always be selected, causing our fee requirements to (significantly) increase. By retaining the dust filter we potentially open ourselves to future partial spending.\r\n\r\nOne thing I don't quite understand, will a dusty output not always be a dusty output, so long as the user doesn't modify `-dustrelayfee`? If so, then I don't think this is an issue -- that output will not be selected for an output group today, nor in the future. If however a user changes their `-dustrelayfee` then they can be notified of the interaction, perhaps via `ParameterInteraction()`?\r\n\r\nFor me it would be cleaner if the `-avoidpartialspends` flag worked as advertised and _always_ prevented partial spends. In the event that the DoS attack mentioned occured, ideally the wallet would return an error message that there is enough output value to construct the transaction but the outputs are being excluded by the `-avoidpartialspends` flag, and the user must disable it so that they can be selected.",
      "created_at" : "2023-03-08T10:07:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/20287#issuecomment-1459925538",
      "id" : 1459925538,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20287",
      "node_id" : "IC_kwDOABII585XBLIi",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1459925538/reactions"
      },
      "updated_at" : "2023-03-08T10:07:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1459925538",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   }
]
