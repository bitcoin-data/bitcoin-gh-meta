[
   {
      "author_association" : "MEMBER",
      "body" : "The build failure is due to an eight year old bug in clang: https://bugs.llvm.org/show_bug.cgi?id=8263",
      "created_at" : "2018-04-26T21:38:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13098#issuecomment-384797131",
      "id" : 384797131,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13098",
      "updated_at" : "2018-04-26T21:38:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/384797131",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I like the goal here but I find the changes a bit overwhelming for achieving this.  It seems like we could achieve this more easily in other ways, like (1) just building the hash on demand the first time it's requested, or (2) adding a deserialization flag to CTransaction that instructs it to skip the hash if we're not planning to use it?\r\n\r\n[I'm not sure if (1) is a great solution, since there might be some memory-cache-benefits to building the hash at the time of deserialization, and maybe no one likes the design of having a mutable hash inside of CTransaction, but it would be a super-small diff...]",
      "created_at" : "2018-04-27T13:04:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13098#issuecomment-384964026",
      "id" : 384964026,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13098",
      "updated_at" : "2018-04-27T13:04:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/384964026",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I didn't particularly like option (1) because it makes the caching run-time depended (it is always compiled in, but only used when it happens to be requested), compared to having it compile time enforced by typing `CPureTransaction` instead of `CTransaction`.\r\n\r\nNote that my approach is a variation of option (2) by passing through the type of the transaction to `ReadBlockFromDisk` instead of passing through an additional flag that is converted to a deserialization option and then passed on to the constructor of the transaction.\r\n\r\nSo I think having explicit types is advantageous in both code clarity and cleanness, with the tradeoff of a minimally larger diff.\r\n\r\nNote: I will push a fixed up version of the patch by next Monday to minimize the diff and (hopefully) work around the gcc and clang compiler bugs.",
      "created_at" : "2018-04-27T14:24:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13098#issuecomment-384985819",
      "id" : 384985819,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13098",
      "updated_at" : "2018-04-27T14:24:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/384985819",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Fair enough, I just don't want us to overlook simpler solutions that might be acceptable.  I'm happy to let the reviewers with stronger feelings about the design of these data types chime in.",
      "created_at" : "2018-04-27T14:40:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13098#issuecomment-384990768",
      "id" : 384990768,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13098",
      "updated_at" : "2018-04-27T14:40:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/384990768",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I just pushed a version that might compile on our buggy clang and that is according to the design that @sipa requested in https://github.com/bitcoin/bitcoin/pull/13011#issuecomment-383145046\r\n\r\n> Then at the very least introduce alternate versions of CTransaction/CBlock that don't precompute anything, for use in reindexing and rescanning and serving blocks from disk.",
      "created_at" : "2018-04-27T15:09:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13098#issuecomment-384999627",
      "id" : 384999627,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13098",
      "updated_at" : "2018-04-27T15:09:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/384999627",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "@MarcoFalke Thanks for working on this, I'll review soon.\r\n\r\n@sdaftuar My preference is having separate types, for these reasons:\r\n* Having lazily-computed hashes in transactions involves synchronization structures (atomics at least to avoid multiple threads simultaneously getting a hash for the first time).\r\n* Smaller in memory in places where it's not needed.\r\n* We have the option of later moving the with-hash types into consensus code and not exposing it.",
      "created_at" : "2018-04-27T20:57:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13098#issuecomment-385092217",
      "id" : 385092217,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13098",
      "updated_at" : "2018-04-27T20:57:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/385092217",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This seems like very useful work, but for serving out historic blocks it would perhaps be better if we could (largely) avoid deserializing and re-serializing them entirely as doing so is tremendously expensive (involving a billionity mallocs). Better is better however. ",
      "created_at" : "2018-05-01T18:15:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13098#issuecomment-385745421",
      "id" : 385745421,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13098",
      "updated_at" : "2018-05-01T18:15:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/385745421",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : ">  Having lazily-computed hashes in transactions involves synchronization structures (atomics at least to avoid multiple threads simultaneously getting a hash for the first time).\r\n\r\nAgree. The main thing I don't like about lazy evaluation is that it's much harder to reason about performance then. I think I prefer the current explicit solution, even though much more verbose.\r\n\r\n> This seems like very useful work, but for serving out historic blocks it would perhaps be better if we could (largely) avoid deserializing and re-serializing them entirely as doing so is tremendously expensive (involving a billionity mallocs). Better is better however.\r\n\r\nYes - I was also about to say this. How difficult would it be to serve the data directly from disk, without serialization/deserialization roundtrip?\r\n\r\n~~Edit: to do this efficiently would require a change to the on-disk format to add the size, or adding the on-disk block size to the block index.~~ OH this is actually already there, situated before the `nPos`:\r\n```\r\n    // Write index header\r\n    unsigned int nSize = GetSerializeSize(fileout, block);\r\n    fileout << messageStart << nSize;\r\n```",
      "created_at" : "2018-05-02T11:09:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13098#issuecomment-385942233",
      "id" : 385942233,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13098",
      "updated_at" : "2018-05-02T11:18:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/385942233",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "> but for serving out historic blocks it would perhaps be better if we could (largely) avoid deserializing and re-serializing them entirely\r\n\r\nMy dumb try at this: #13151",
      "created_at" : "2018-05-02T12:17:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13098#issuecomment-385958355",
      "id" : 385958355,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13098",
      "updated_at" : "2018-05-02T12:17:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/385958355",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Even with 13151 something like this might very useful for making _rescan_ faster...  rescan is slow enough to make it largely unusable now.  I'd been thinking deserialization was worse than hashing in it, but the performance numbers above make me wonder.",
      "created_at" : "2018-05-02T18:08:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13098#issuecomment-386069372",
      "id" : 386069372,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13098",
      "updated_at" : "2018-05-02T18:08:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/386069372",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Certainly Concept ACK if we can get rescan up for this (even as a separate PR), just using it for serving blocks for old nodes is maybe less worth it (at least post-13151).",
      "created_at" : "2018-05-02T19:57:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13098#issuecomment-386101356",
      "id" : 386101356,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13098",
      "updated_at" : "2018-05-02T19:57:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/386101356",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Will do a rebase once the other pull is merged",
      "created_at" : "2018-05-02T20:00:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13098#issuecomment-386102286",
      "id" : 386102286,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13098",
      "updated_at" : "2018-05-02T20:00:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/386102286",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Nice work!\r\nConcept ACK",
      "created_at" : "2018-05-03T06:44:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13098#issuecomment-386204339",
      "id" : 386204339,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13098",
      "updated_at" : "2018-05-03T06:44:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/386204339",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Any reason not to reuse `CMutableTransaction` for the purposes where `CPureTransaction` is introduced here? The only reason why `CTransaction` is immutable is to not interfere with or require synchronization on its precomputed hashes. As `CMutableTransaction` has no cashed hashes, this is not an issue.\r\n",
      "created_at" : "2018-05-23T23:16:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13098#issuecomment-391530089",
      "id" : 391530089,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13098",
      "updated_at" : "2018-05-23T23:16:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/391530089",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sipa I'd prefer to make it \"type-safe\", i.e. make it impossible/compile-time enforced that none of the expensive operations are called. Otherwise this seems too fragile.\r\n\r\nI think to make it compile-time enforced, this would require to change one of transaction types to be a class that takes template arguments and then add a static assert in `Get*Hash`. I am happy to change to that implementation.",
      "created_at" : "2018-05-24T15:54:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13098#issuecomment-391766471",
      "id" : 391766471,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13098",
      "updated_at" : "2018-05-24T15:54:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/391766471",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke But as long as you keep CMutableTransaction around, such a guarantee doesn't really exist, as that class still has uncached hashing operations (and should probably remain so, see a recent PR that speeds up signing by avoiding CMutableTransaction -> CTransaction conversions).\n\nMy preference is just to evolve CTransaction into the validation-logic-optimized-efficient transaction representation, and CMutableTransaction into the simple-generic representation. That may mean that uncached hashes are still invoked in places where performance doesn't matter that much.\n\n",
      "created_at" : "2018-05-24T16:04:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13098#issuecomment-391769939",
      "id" : 391769939,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13098",
      "updated_at" : "2018-05-24T16:04:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/391769939",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "After discussing this a bit with @MarcoFalke, I see the advantage of being able to enforce through the type system that no GetHash is unexpectedly called on transactions that don't have a cache in certain specific cases (like serving historical blocks).\n\nOn the other hand, it's also introducing yet another type for the same data, which seems a high price. As it has const fields, conversion to other transaction types will be expensive if it's ever needed, but it does get the ability to take advantage of more efficient storage if they get implemented (like one malloc per transaction).\n\nOverall, I think my preference is to reuse CMutableTransaction here, but if we want the extra guarantees and an extra type, the current approach seems fine.",
      "created_at" : "2018-05-24T16:59:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13098#issuecomment-391787330",
      "id" : 391787330,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13098",
      "updated_at" : "2018-05-24T17:01:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/391787330",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13098#discussion_r217529351"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217529351"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It seems like when `!pblock && inv.type == MSG_FILTERED_BLOCK` or  `!pblock && inv.type == MSG_CMPCT_BLOCK` in previous code, the message would be dropped, but now the block gets read from disk? Is this an intentional change if so?",
      "commit_id" : "775202dea78c2c139823029bd8124836b064943e",
      "created_at" : "2018-09-13T20:49:21Z",
      "diff_hunk" : "@@ -1187,61 +1188,72 @@ void static ProcessGetBlockData(CNode* pfrom, const CChainParams& chainparams, c\n             }\n             connman->PushMessage(pfrom, msgMaker.Make(NetMsgType::BLOCK, MakeSpan(block_data)));\n             // Don't set pblock as we've sent the block\n-        } else {\n-            // Send block from disk\n-            std::shared_ptr<CBlock> pblockRead = std::make_shared<CBlock>();\n-            if (!ReadBlockFromDisk(*pblockRead, pindex, consensusParams))\n-                assert(!\"cannot load block from disk\");\n-            pblock = pblockRead;\n-        }\n-        if (pblock) {\n-            if (inv.type == MSG_BLOCK)\n-                connman->PushMessage(pfrom, msgMaker.Make(SERIALIZE_TRANSACTION_NO_WITNESS, NetMsgType::BLOCK, *pblock));\n-            else if (inv.type == MSG_WITNESS_BLOCK)\n-                connman->PushMessage(pfrom, msgMaker.Make(NetMsgType::BLOCK, *pblock));\n-            else if (inv.type == MSG_FILTERED_BLOCK)\n+        } else if (inv.type == MSG_WITNESS_BLOCK || inv.type == MSG_BLOCK) {\n+            const int ser_flags{inv.type == MSG_BLOCK ? SERIALIZE_TRANSACTION_NO_WITNESS : 0};\n+            if (pblock) {\n+                connman->PushMessage(pfrom, msgMaker.Make(ser_flags, NetMsgType::BLOCK, *pblock));\n+            } else {\n+                CPureBlock pure_block;\n+                if (!ReadBlockFromDisk(pure_block, pindex, consensusParams)) assert(!\"cannot load block from disk\");\n+                connman->PushMessage(pfrom, msgMaker.Make(ser_flags, NetMsgType::BLOCK, pure_block));\n+            }\n+        } else if (inv.type == MSG_FILTERED_BLOCK) {\n+            CBlock basic_block;\n+            if (!pblock && !ReadBlockFromDisk(basic_block, pindex, consensusParams)) assert(!\"cannot load block from disk\");\n+            bool sendMerkleBlock = false;\n+            CMerkleBlock merkleBlock;\n             {\n-                bool sendMerkleBlock = false;\n-                CMerkleBlock merkleBlock;\n-                {\n-                    LOCK(pfrom->cs_filter);\n-                    if (pfrom->pfilter) {\n-                        sendMerkleBlock = true;\n-                        merkleBlock = CMerkleBlock(*pblock, *pfrom->pfilter);\n-                    }\n+                LOCK(pfrom->cs_filter);\n+                if (pfrom->pfilter) {\n+                    sendMerkleBlock = true;\n+                    merkleBlock = pblock ? CMerkleBlock(*pblock, *pfrom->pfilter) : CMerkleBlock(basic_block, *pfrom->pfilter);\n                 }\n-                if (sendMerkleBlock) {\n-                    connman->PushMessage(pfrom, msgMaker.Make(NetMsgType::MERKLEBLOCK, merkleBlock));\n-                    // CMerkleBlock just contains hashes, so also push any transactions in the block the client did not see\n-                    // This avoids hurting performance by pointlessly requiring a round-trip\n-                    // Note that there is currently no way for a node to request any single transactions we didn't send here -\n-                    // they must either disconnect and retry or request the full block.\n-                    // Thus, the protocol spec specified allows for us to provide duplicate txn here,\n-                    // however we MUST always provide at least what the remote peer needs\n-                    typedef std::pair<unsigned int, uint256> PairType;\n-                    for (PairType& pair : merkleBlock.vMatchedTxn)\n-                        connman->PushMessage(pfrom, msgMaker.Make(SERIALIZE_TRANSACTION_NO_WITNESS, NetMsgType::TX, *pblock->vtx[pair.first]));\n+            }\n+            if (sendMerkleBlock) {\n+                connman->PushMessage(pfrom, msgMaker.Make(NetMsgType::MERKLEBLOCK, merkleBlock));\n+                // CMerkleBlock just contains hashes, so also push any transactions in the block the client did not see\n+                // This avoids hurting performance by pointlessly requiring a round-trip\n+                // Note that there is currently no way for a node to request any single transactions we didn't send here -\n+                // they must either disconnect and retry or request the full block.\n+                // Thus, the protocol spec specified allows for us to provide duplicate txn here,\n+                // however we MUST always provide at least what the remote peer needs\n+                typedef std::pair<unsigned int, uint256> PairType;\n+                for (PairType& pair : merkleBlock.vMatchedTxn) {\n+                    pblock ?\n+                        connman->PushMessage(pfrom, msgMaker.Make(SERIALIZE_TRANSACTION_NO_WITNESS, NetMsgType::TX, pblock->vtx[pair.first])) :\n+                        connman->PushMessage(pfrom, msgMaker.Make(SERIALIZE_TRANSACTION_NO_WITNESS, NetMsgType::TX, basic_block.vtx[pair.first]));\n                 }\n-                // else\n-                    // no response\n             }\n-            else if (inv.type == MSG_CMPCT_BLOCK)\n-            {\n-                // If a peer is asking for old blocks, we're almost guaranteed\n-                // they won't have a useful mempool to match against a compact block,\n-                // and we don't feel like constructing the object for them, so\n-                // instead we respond with the full, non-compact block.\n-                bool fPeerWantsWitness = State(pfrom->GetId())->fWantsCmpctWitness;\n-                int nSendFlags = fPeerWantsWitness ? 0 : SERIALIZE_TRANSACTION_NO_WITNESS;\n-                if (CanDirectFetch(consensusParams) && pindex->nHeight >= chainActive.Height() - MAX_CMPCTBLOCK_DEPTH) {\n-                    if ((fPeerWantsWitness || !fWitnessesPresentInARecentCompactBlock) && a_recent_compact_block && a_recent_compact_block->header.GetHash() == pindex->GetBlockHash()) {\n-                        connman->PushMessage(pfrom, msgMaker.Make(nSendFlags, NetMsgType::CMPCTBLOCK, *a_recent_compact_block));\n+            // else\n+            // no response\n+        } else if (inv.type == MSG_CMPCT_BLOCK) {\n+            // If a peer is asking for old blocks, we're almost guaranteed\n+            // they won't have a useful mempool to match against a compact block,\n+            // and we don't feel like constructing the object for them, so\n+            // instead we respond with the full, non-compact block.\n+            bool fPeerWantsWitness = State(pfrom->GetId())->fWantsCmpctWitness;\n+            int nSendFlags = fPeerWantsWitness ? 0 : SERIALIZE_TRANSACTION_NO_WITNESS;\n+            if (CanDirectFetch(consensusParams) && pindex->nHeight >= chainActive.Height() - MAX_CMPCTBLOCK_DEPTH) {\n+                if ((fPeerWantsWitness || !fWitnessesPresentInARecentCompactBlock) && a_recent_compact_block && a_recent_compact_block->header.GetHash() == pindex->GetBlockHash()) {\n+                    connman->PushMessage(pfrom, msgMaker.Make(nSendFlags, NetMsgType::CMPCTBLOCK, *a_recent_compact_block));\n+                } else {\n+                    CBlockHeaderAndShortTxIDs cmpctblock;\n+                    CBlock block_read;\n+                    if (pblock) {\n+                        cmpctblock = CBlockHeaderAndShortTxIDs{*pblock, fPeerWantsWitness};\n                     } else {\n-                        CBlockHeaderAndShortTxIDs cmpctblock(*pblock, fPeerWantsWitness);\n-                        connman->PushMessage(pfrom, msgMaker.Make(nSendFlags, NetMsgType::CMPCTBLOCK, cmpctblock));\n+                        if (!ReadBlockFromDisk(block_read, pindex, consensusParams)) assert(!\"cannot load block from disk\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13098#discussion_r217529351",
      "id" : 217529351,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNzUyOTM1MQ==",
      "original_commit_id" : "775202dea78c2c139823029bd8124836b064943e",
      "original_position" : 115,
      "path" : "src/net_processing.cpp",
      "position" : 115,
      "pull_request_review_id" : 155266414,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13098",
      "updated_at" : "2018-09-13T20:49:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217529351",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13098#discussion_r218696305"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/218696305"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```\r\n2018-09-18 21:44:48 cppcheck(pr=13098): [src/primitives/transaction.h:292]: (style) Class 'CPureTransaction' has a constructor with 1 argument that is not explicit.\r\n```",
      "commit_id" : "775202dea78c2c139823029bd8124836b064943e",
      "created_at" : "2018-09-19T07:35:39Z",
      "diff_hunk" : "@@ -283,6 +288,43 @@ class CTransaction\n     const int32_t nVersion;\n     const uint32_t nLockTime;\n \n+    /** Convert a CMutableTransaction into a CPureTransaction. */\n+    CPureTransaction(const CMutableTransaction& tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13098#discussion_r218696305",
      "id" : 218696305,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxODY5NjMwNQ==",
      "original_commit_id" : "775202dea78c2c139823029bd8124836b064943e",
      "original_position" : 32,
      "path" : "src/primitives/transaction.h",
      "position" : 32,
      "pull_request_review_id" : 156688624,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13098",
      "updated_at" : "2018-09-19T07:35:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/218696305",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13098#discussion_r218696343"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/218696343"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```\r\n2018-09-18 21:44:48 cppcheck(pr=13098): [src/primitives/transaction.h:293]: (style) Class 'CPureTransaction' has a constructor with 1 argument that is not explicit.\r\n```",
      "commit_id" : "775202dea78c2c139823029bd8124836b064943e",
      "created_at" : "2018-09-19T07:35:50Z",
      "diff_hunk" : "@@ -283,6 +288,43 @@ class CTransaction\n     const int32_t nVersion;\n     const uint32_t nLockTime;\n \n+    /** Convert a CMutableTransaction into a CPureTransaction. */\n+    CPureTransaction(const CMutableTransaction& tx);\n+    CPureTransaction(CMutableTransaction&& tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13098#discussion_r218696343",
      "id" : 218696343,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxODY5NjM0Mw==",
      "original_commit_id" : "775202dea78c2c139823029bd8124836b064943e",
      "original_position" : 33,
      "path" : "src/primitives/transaction.h",
      "position" : 33,
      "pull_request_review_id" : 156688681,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13098",
      "updated_at" : "2018-09-19T07:35:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/218696343",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13098#discussion_r218696418"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13098"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/218696418"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```\r\n2018-09-18 21:44:48 cppcheck(pr=13098): [src/bench/checkblock.cpp:31]: (warning) Assert statement calls a function which may have desired side effects: 'Rewind'.\r\n```",
      "commit_id" : "775202dea78c2c139823029bd8124836b064943e",
      "created_at" : "2018-09-19T07:36:09Z",
      "diff_hunk" : "@@ -17,6 +17,21 @@ namespace block_bench {\n // a block off the wire, but before we can relay the block on to peers using\n // compact block relay.\n \n+static void DeserializePureBlockTest(benchmark::State& state)\n+{\n+    CDataStream stream((const char*)block_bench::block413567,\n+        (const char*)&block_bench::block413567[sizeof(block_bench::block413567)],\n+        SER_NETWORK, PROTOCOL_VERSION);\n+    char a = '\\0';\n+    stream.write(&a, 1); // Prevent compaction\n+\n+    while (state.KeepRunning()) {\n+        CPureBlock block;\n+        stream >> block;\n+        assert(stream.Rewind(sizeof(block_bench::block413567)));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13098#discussion_r218696418",
      "id" : 218696418,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxODY5NjQxOA==",
      "original_commit_id" : "775202dea78c2c139823029bd8124836b064943e",
      "original_position" : 15,
      "path" : "src/bench/checkblock.cpp",
      "position" : 15,
      "pull_request_review_id" : 156688776,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13098",
      "updated_at" : "2018-09-19T07:36:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/218696418",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->Reviewers, this pull request conflicts with the following ones:\n\n* #14337 ([refactoring] Create common interface for CMutableTransaction and CTransaction with static polymorphism by lucash-dev)\n* #14194 (Annotate unused parameters with [[maybe_unused]] by practicalswift)\n* #13864 (validation: Document where we are intentionally ignoring bool return values from validation related functions by practicalswift)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2018-09-20T22:38:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13098#issuecomment-423356937",
      "id" : 423356937,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13098",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyMzM1NjkzNw==",
      "updated_at" : "2018-09-27T20:50:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/423356937",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Curious why this was closed.",
      "created_at" : "2018-10-19T15:19:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13098#issuecomment-431399312",
      "id" : 431399312,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13098",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMTM5OTMxMg==",
      "updated_at" : "2018-10-19T15:19:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/431399312",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased (with the p2p changes removed) here: #17529",
      "created_at" : "2019-11-20T04:00:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13098#issuecomment-555827098",
      "id" : 555827098,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13098",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1NTgyNzA5OA==",
      "updated_at" : "2019-11-20T04:00:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/555827098",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
