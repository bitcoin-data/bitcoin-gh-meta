[
   {
      "body" : "Code review ACK; I didn't try to test.\r\n",
      "created_at" : "2015-02-24T16:20:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5820#issuecomment-75788188",
      "id" : 75788188,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5820",
      "updated_at" : "2015-02-24T16:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/75788188",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=3",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   },
   {
      "body" : "ut ACK\r\n",
      "created_at" : "2015-02-24T17:05:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5820#issuecomment-75797835",
      "id" : 75797835,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5820",
      "updated_at" : "2015-02-24T17:05:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/75797835",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "Tested; works as expected.",
      "created_at" : "2015-02-24T21:04:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5820#issuecomment-75845472",
      "id" : 75845472,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5820",
      "updated_at" : "2015-02-24T21:04:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/75845472",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "utACK",
      "created_at" : "2015-02-26T16:07:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5820#issuecomment-76205348",
      "id" : 76205348,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5820",
      "updated_at" : "2015-02-26T16:07:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/76205348",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Backported to 0.10 as aeb92792281b4cb9958f3defc9e36f63e65b778a",
      "created_at" : "2015-02-26T16:16:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5820#issuecomment-76207267",
      "id" : 76207267,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5820",
      "updated_at" : "2015-02-26T16:16:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/76207267",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@SergioDemianLerner How about an nbits test?",
      "created_at" : "2015-03-07T01:56:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5820#issuecomment-77667024",
      "id" : 77667024,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5820",
      "updated_at" : "2015-03-07T01:56:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/77667024",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "@SergioDemianLerner I would really prefer avoiding checkpoints for this. Wouldn't a nHeight-based check be just as good to prevent that, similar to the check added in this patch?",
      "created_at" : "2015-03-07T13:07:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5820#issuecomment-77688655",
      "id" : 77688655,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5820",
      "updated_at" : "2015-03-07T13:08:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/77688655",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "We have several possibilities:\r\n\r\n1. Some basic housekeeping that can be done when a block is received during download to prevent strange things like blocks with a current time-stamp but low height. Assume for a moment that blocks before a checkpoint have a nTime field that are lower than the checkpoint time (generally this requires to check only about 12 previous blocks, although theoretically one should have to check up to the genesis block). \r\nThis would be a check like:\r\n\r\npcheckpoint = last check point \r\nif ((block->nHeight < pcheckpoint->nHeight) && (block->GetBlockTime() > pcheckpoint->Time))\r\n    reject the block/header\r\n\r\n2. Prevent node finger-printing altogether: do not advertise nor return a block or header that is not in the best chain. (but store them, as currently the node does)\r\n3. Limit the extent of fingerprint to some maximum depth relative to the current best chain height (sipa's proposal).\r\n4. Force node fingerprinting to require at least some PoW (gmaxwell's proposal).\r\n5. Limit the blocks to advertise/return based on the same check of 1, but done at the time the block is asked by a peer (my first proposal)\r\n\r\nOption 3 has sense only if the relative height is less than 1-month of time (current fingerprinting window). This limits the re-org depth. I like option 1.",
      "created_at" : "2015-03-07T15:27:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5820#issuecomment-77693762",
      "id" : 77693762,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5820",
      "updated_at" : "2015-03-07T15:28:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/77693762",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1752347?v=3",
         "events_url" : "https://api.github.com/users/SergioDemianLerner/events{/privacy}",
         "followers_url" : "https://api.github.com/users/SergioDemianLerner/followers",
         "following_url" : "https://api.github.com/users/SergioDemianLerner/following{/other_user}",
         "gists_url" : "https://api.github.com/users/SergioDemianLerner/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/SergioDemianLerner",
         "id" : 1752347,
         "login" : "SergioDemianLerner",
         "organizations_url" : "https://api.github.com/users/SergioDemianLerner/orgs",
         "received_events_url" : "https://api.github.com/users/SergioDemianLerner/received_events",
         "repos_url" : "https://api.github.com/users/SergioDemianLerner/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/SergioDemianLerner/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/SergioDemianLerner/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/SergioDemianLerner"
      }
   },
   {
      "body" : "Another alternative is using \"equivalent PoW-days\". You look at the\ndifference in nChainWork between the requested block and the best known\nheader, divided by the best difficulty seen, multiplied by the block\ninterval. This yields something with time units: the amount of time an\nattacker with 100% of the current observable hash rate would need to expend\nto build on top of the fork to beat the main chain. Accept requests of a\nblock when this time value is less than some constant.\n\nAlso, I don't believe this actually hurts reorganizations. The new blocks\nto reorg to can always be requested from the peer who has already switched\nto it. The only reason why you'd allow requests for blocks outside of your\nown best chain, is because during a reorg your own view of the best chain\nmay chain between an inv and the receipt of a getdata in response. Not\nanswering could delay convergence (but only a bit, there are timeouts). One\nmonth of desync time is probably serious overkill, but given that the\nhashrate can hardly drop in such a time frame, it already makes\nfingerprinting very expensive.\n",
      "created_at" : "2015-03-07T17:22:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5820#issuecomment-77699290",
      "id" : 77699290,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5820",
      "updated_at" : "2015-03-07T17:22:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/77699290",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
