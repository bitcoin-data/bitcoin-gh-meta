[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#14053](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14053.html) (Add address-based index (attempt 4?) by marcinja)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-01-08T23:22:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17897#issuecomment-572306584",
      "id" : 572306584,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17897",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3MjMwNjU4NA==",
      "updated_at" : "2020-01-08T23:22:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/572306584",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17897#discussion_r364818758"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/364818758"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit, a similar comment could be added in `BaseIndex::Stop`.",
      "commit_id" : "4a6cb2f6bc7e27a8257ed475fb93f4a509bd2121",
      "created_at" : "2020-01-09T15:56:19Z",
      "diff_hunk" : "@@ -246,6 +244,10 @@ void Shutdown(NodeContext& node)\n     // CValidationInterface callbacks, flush them...\n     GetMainSignals().FlushBackgroundCallbacks();\n \n+    // Stop all indexes only after flushing background callbacks.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17897#discussion_r364818758",
      "id" : 364818758,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDgxODc1OA==",
      "original_commit_id" : "4a6cb2f6bc7e27a8257ed475fb93f4a509bd2121",
      "original_position" : 13,
      "path" : "src/init.cpp",
      "position" : 13,
      "pull_request_review_id" : 340625070,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17897",
      "updated_at" : "2020-01-09T15:56:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/364818758",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17897#discussion_r364841208"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17897"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/364841208"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good point, though I think a better solution is to just call `Commit` from inside `BaseIndex::Stop` because I don't see much of a downside and it puts less of a burden on the caller.",
      "commit_id" : "4a6cb2f6bc7e27a8257ed475fb93f4a509bd2121",
      "created_at" : "2020-01-09T16:36:17Z",
      "diff_hunk" : "@@ -246,6 +244,10 @@ void Shutdown(NodeContext& node)\n     // CValidationInterface callbacks, flush them...\n     GetMainSignals().FlushBackgroundCallbacks();\n \n+    // Stop all indexes only after flushing background callbacks.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17897#discussion_r364841208",
      "id" : 364841208,
      "in_reply_to_id" : 364818758,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg0MTIwOA==",
      "original_commit_id" : "4a6cb2f6bc7e27a8257ed475fb93f4a509bd2121",
      "original_position" : 13,
      "path" : "src/init.cpp",
      "position" : 13,
      "pull_request_review_id" : 340654732,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17897",
      "updated_at" : "2020-01-09T16:36:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/364841208",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks @promag, fixed.",
      "created_at" : "2020-01-10T00:52:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17897#issuecomment-572824104",
      "id" : 572824104,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17897",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3MjgyNDEwNA==",
      "updated_at" : "2020-01-10T00:52:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/572824104",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Looks good now, this time I'll test.",
      "created_at" : "2020-01-10T10:51:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17897#issuecomment-572986822",
      "id" : 572986822,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17897",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3Mjk4NjgyMg==",
      "updated_at" : "2020-01-10T10:51:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/572986822",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@promag I don't think so. Why?",
      "created_at" : "2020-01-10T22:00:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17897#issuecomment-573222171",
      "id" : 573222171,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17897",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3MzIyMjE3MQ==",
      "updated_at" : "2020-01-10T22:00:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/573222171",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Actually I think it's fine, I was missing the `!m_synced` check.\r\n\r\nI was seeing this order of events:\r\n - `Interrupt()` is called which asynchronously stops the loop in `ThreadSync()`\r\n - before `UnregisterValidationInterface` is called,  validation notifications can be delivered, which can't be handled.\r\n\r\nBut now I see the `m_synced` flag to guard against this case.\r\n\r\nAnyway, would be nice to include steps/changes to reproduce the original problem.\r\n\r\nCode review ACK 9dd58ca611f6f2b59c25d727a4e955333525d345, but failed to test because I can't reproduce the original problem.",
      "created_at" : "2020-01-14T09:53:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17897#issuecomment-574093378",
      "id" : 574093378,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17897",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NDA5MzM3OA==",
      "updated_at" : "2020-01-14T09:54:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/574093378",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> Actually I think it's fine, I was missing the `!m_synced` check.\r\n> \r\n> I was seeing this order of events:\r\n> \r\n> * `Interrupt()` is called which asynchronously stops the loop in `ThreadSync()`\r\n> * before `UnregisterValidationInterface` is called,  validation notifications can be delivered, which can't be handled.\r\n> \r\n> But now I see the `m_synced` flag to guard against this case.\r\n> \r\n> Anyway, would be nice to include steps/changes to reproduce the original problem.\r\n> \r\n> Code review ACK [9dd58ca](https://github.com/bitcoin/bitcoin/commit/9dd58ca611f6f2b59c25d727a4e955333525d345), but failed to test because I can't reproduce the original problem.\r\n\r\nSo here is how I can currently reproduce it:\r\n\r\nCreate a new datadir, start syncing with txindex=1. Let it run a while until there are decent number of block files, say to block 190000. Kill it. So when you restart, you'd expect that the txindex would restart at the same point as the block indexer at 190000 since they were both at the same point before you killed the daemon, but instead, I see the txindex starting at 39339, even though the data is in the txindex leveldb, it still has to run through every block again until it catches up and sets a new checkpoint, which is what led me to believe it wasn't being closed correctly since that's when leveldb writes out the current metadata for the next load. Here's my logfile from doing that\r\n[bitcoind.txindex.redacted.log](https://github.com/bitcoin/bitcoin/files/4089302/bitcoind.txindex.redacted.log)\r\n",
      "created_at" : "2020-01-21T05:27:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17897#issuecomment-576523914",
      "id" : 576523914,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17897",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NjUyMzkxNA==",
      "updated_at" : "2020-01-21T05:27:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/576523914",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/107466?v=4",
         "events_url" : "https://api.github.com/users/paulyc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paulyc/followers",
         "following_url" : "https://api.github.com/users/paulyc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paulyc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paulyc",
         "id" : 107466,
         "login" : "paulyc",
         "node_id" : "MDQ6VXNlcjEwNzQ2Ng==",
         "organizations_url" : "https://api.github.com/users/paulyc/orgs",
         "received_events_url" : "https://api.github.com/users/paulyc/received_events",
         "repos_url" : "https://api.github.com/users/paulyc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paulyc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paulyc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paulyc"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks @paulyc, I have done that but didn't wait for that block count.",
      "created_at" : "2020-01-21T14:40:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17897#issuecomment-576711708",
      "id" : 576711708,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17897",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NjcxMTcwOA==",
      "updated_at" : "2020-01-21T14:40:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/576711708",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "tested ACK 9dd58ca611f6f2b59c25d727a4e955333525d345\r\n\r\nTested as described by @paulyc. Also ran tests locally.",
      "created_at" : "2020-01-22T00:09:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17897#issuecomment-576946410",
      "id" : 576946410,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17897",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3Njk0NjQxMA==",
      "updated_at" : "2020-01-22T00:09:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/576946410",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Tested ACK 9dd58ca611f6f2b59c25d727a4e955333525d345\r\n\r\n<details>\r\n  <summary>master branch showing txindex sync begins at block 0 upon restart</summary>\r\n\r\n  ```\r\n$ ./bitcoind -txindex=1 -datadir=oij\r\n[...]\r\n2020-01-22T06:11:44Z Shutdown: In progress...\r\n2020-01-22T06:11:44Z net thread exit\r\n2020-01-22T06:11:44Z UpdateTip: new best=000000000000035010292db86f97a207d96a4106af108fcb016550dee0e4f96e height=168089 version=0x00000001 log2_work=67.727578 tx=2483951 date='2012-02-23T10:53:35Z' progress=0.004994 cache=202.5MiB(1524617txo)\r\n[...]\r\n2020-01-22T06:12:21Z Shutdown: done\r\n$ ./bitcoind -txindex=1 -datadir=oij\r\n[...]\r\n2020-01-22T06:12:56Z Opening LevelDB in /Users/me/workspace/bitcoin/src/oij/indexes/txindex\r\n2020-01-22T06:12:57Z Opened LevelDB successfully\r\n2020-01-22T06:12:57Z Using obfuscation key for /Users/me/workspace/bitcoin/src/oij/indexes/txindex: 0000000000000000\r\n2020-01-22T06:12:57Z txindex thread start\r\n2020-01-22T06:12:57Z init message: Loading wallet...\r\n2020-01-22T06:12:57Z Syncing txindex with block chain from height 0\r\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n[...]\r\n  ```\r\n</details>\r\n\r\n<details>\r\n  <summary>#17897 PR showing txindex sync prevails upon restart</summary>\r\n\r\n  ```\r\n$ ./bitcoind -txindex=1 -datadir=oij-jimpo\r\n[...]\r\n2020-01-22T06:17:35Z Opening LevelDB in /Users/me/workspace/bitcoin/src/oij-jimpo/indexes/txindex\r\n2020-01-22T06:17:35Z Opened LevelDB successfully\r\n2020-01-22T06:17:35Z Using obfuscation key for /Users/me/workspace/bitcoin/src/oij-jimpo/indexes/txindex: 0000000000000000\r\n2020-01-22T06:17:35Z txindex thread start\r\n2020-01-22T06:17:35Z txindex is enabled\r\n2020-01-22T06:17:35Z init message: Loading wallet...\r\n2020-01-22T06:17:35Z txindex thread exit\r\n[...]\r\n2020-01-22T06:39:03Z UpdateTip: new best=000000000000000a92ff09eb56af38ad02b64ee75d4b71274caa437efc1e8b6c height=172386 version=0x00000001 log2_work=67.87869 tx=2670294 date='2012-03-22T19:16:30Z' progress=0.005368 cache=213.9MiB(1617994txo)\r\n[...]\r\n2020-01-22T06:39:40Z Shutdown: done\r\n$ ./bitcoind -txindex=1 -datadir=oij-jimpo\r\n[...]\r\n2020-01-22T06:46:12Z Loaded best chain: hashBestChain=000000000000000a92ff09eb56af38ad02b64ee75d4b71274caa437efc1e8b6c height=172386 date=2012-03-22T19:16:30Z progress=0.005368\r\n[...]\r\n2020-01-22T06:46:15Z Opening LevelDB in /Users/me/workspace/bitcoin/src/oij-jimpo/indexes/txindex\r\n2020-01-22T06:46:16Z Opened LevelDB successfully\r\n2020-01-22T06:46:16Z Using obfuscation key for /Users/me/workspace/bitcoin/src/oij-jimpo/indexes/txindex: 0000000000000000\r\n2020-01-22T06:46:16Z txindex thread start\r\n2020-01-22T06:46:16Z txindex is enabled at height 172386\r\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n2020-01-22T06:46:16Z txindex thread exit\r\n[...]\r\n  ```\r\n</details>",
      "created_at" : "2020-01-22T06:59:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17897#issuecomment-577037170",
      "id" : 577037170,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17897",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NzAzNzE3MA==",
      "updated_at" : "2020-01-22T06:59:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/577037170",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Looks good. I've tested master (742f84d0de79fcaf17578f9c3376be248c3259bc) vs this PR (9dd58ca611f6f2b59c25d727a4e955333525d345) and am seeing the same fixed behaviour. Thanks @promag, @fjahr, @kallewoof and @paulyc for testing.\r\n\r\n#### master\r\n```bash\r\n2020-01-22T08:56:22Z UpdateTip: new best=0000000000002d533ff0e59ee25496b4f403d8ce7b4b7fcd9181dadad8f625b3 height=118827 version=0x00000001 log2_work=61.774365 tx=416409 date='2011-04-17T13:39:54Z' progress=0.000837 cache=33.9MiB(212154txo)\r\n^C2020-01-22T08:56:24Z tor: Thread interrupt\r\n2020-01-22T08:56:24Z Shutdown: In progress...\r\n<snip>\r\n2020-01-22T08:56:25Z Shutdown: done\r\n....\r\nbitcoin $ ./src/bitcoind -txindex -datadir=/Users/michael/Desktop/master\r\n2020-01-22T08:56:32Z Bitcoin Core version v0.19.99.0-742f84d0d (release build)\r\n<snip>\r\n2020-01-22T08:56:35Z Loaded best chain: hashBestChain=0000000000002d533ff0e59ee25496b4f403d8ce7b4b7fcd9181dadad8f625b3 height=118827 date=2011-04-17T13:39:54Z progress=0.000837\r\n<snip>\r\n2020-01-22T08:56:36Z Using obfuscation key for /Users/michael/Desktop/master/indexes/txindex: 0000000000000000\r\n2020-01-22T08:56:36Z txindex thread start\r\n2020-01-22T08:56:36Z Syncing txindex with block chain from height 65\r\n```\r\n\r\n#### This PR\r\n```bash\r\n2020-01-22T09:19:53Z Shutdown: In progress...\r\n2020-01-22T09:19:53Z UpdateTip: new best=00000000000092c47111d9ca453b6df25b6e139faf438ab06070638417195fba height=116260 version=0x00000001 log2_work=61.415013 tx=385266 date='2011-04-02T06:16:42Z' progress=0.000774 cache=30.4MiB(196729txo)\r\n<snip>\r\n2020-01-22T09:20:10Z Shutdown: done\r\n....\r\nbitcoin $ ./src/bitcoind -txindex -datadir=/Users/michael/Desktop/17897\r\n2020-01-22T09:20:54Z Bitcoin Core version v0.19.99.0-9dd58ca61 (release build)\r\n<snip>\r\n2020-01-22T09:21:02Z Loaded best chain: hashBestChain=00000000000092c47111d9ca453b6df25b6e139faf438ab06070638417195fba height=116260 date=2011-04-02T06:16:42Z progress=0.000774\r\n<snip>\r\n2020-01-22T09:21:07Z Using obfuscation key for /Users/michael/Desktop/17897/indexes/txindex: 0000000000000000\r\n2020-01-22T09:21:07Z txindex thread start\r\n2020-01-22T09:21:07Z init message: Loading wallet...\r\n2020-01-22T09:21:07Z txindex is enabled at height 116260\r\n```",
      "created_at" : "2020-01-22T09:29:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17897#issuecomment-577090538",
      "id" : 577090538,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17897",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NzA5MDUzOA==",
      "updated_at" : "2020-01-22T09:29:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/577090538",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This has been backported to the 0.19 branch in 9d980c1f7f6fd0eb686d3cc94ba4698547f151c2.",
      "created_at" : "2020-01-22T10:27:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17897#issuecomment-577115395",
      "id" : 577115395,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17897",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NzExNTM5NQ==",
      "updated_at" : "2020-01-22T10:27:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/577115395",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   }
]
