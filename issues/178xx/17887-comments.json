[
   {
      "author_association" : "MEMBER",
      "body" : "So this code has been wrong for 7 years? Why do we only notice the effect now?",
      "created_at" : "2020-01-07T13:31:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-571586468",
      "id" : 571586468,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3MTU4NjQ2OA==",
      "updated_at" : "2020-01-07T13:31:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/571586468",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> So this code has been wrong for 7 years? Why do we only notice the effect now?\r\n\r\nItâs likely this issue only started occurring with the introduction of APFS, which is quite recent.",
      "created_at" : "2020-01-07T13:32:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-571587229",
      "id" : 571587229,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3MTU4NzIyOQ==",
      "updated_at" : "2020-01-07T13:32:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/571587229",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "~~@sipa I suspect the OS eventually reclaims pre-allocated space, but it seems block files are not suffering from this kind of issue, so I'm honestly not sure. The docs clearly indicate we were using it wrong, though.~~ (Edit: the issue is a bit more convoluted; see https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-573504904)\r\n\r\nOld edit:\r\n> Itâs likely this issue only started occurring with the introduction of APFS, which is quite recent.\r\n\r\nThat is probably more likely.",
      "created_at" : "2020-01-07T13:33:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-571587438",
      "id" : 571587438,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3MTU4NzQzOA==",
      "updated_at" : "2020-01-21T14:33:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/571587438",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "On my machine (APFS encrypted volume), I was seeing rev00002.dat hitting 20 MB around block 135k. After this patch (running up to block 191106, then shutting down) I see\r\n```Bash\r\n$ du -ch *.dat\r\n128M\tblk00000.dat\r\n128M\tblk00001.dat\r\n128M\tblk00002.dat\r\n128M\tblk00003.dat\r\n128M\tblk00004.dat\r\n128M\tblk00005.dat\r\n128M\tblk00006.dat\r\n128M\tblk00007.dat\r\n128M\tblk00008.dat\r\n128M\tblk00009.dat\r\n128M\tblk00010.dat\r\n128M\tblk00011.dat\r\n128M\tblk00012.dat\r\n128M\tblk00013.dat\r\n128M\tblk00014.dat\r\n128M\tblk00015.dat\r\n128M\tblk00016.dat\r\n 48M\tblk00017.dat\r\n 20M\trev00000.dat\r\n 17M\trev00001.dat\r\n 17M\trev00002.dat\r\n 17M\trev00003.dat\r\n 17M\trev00004.dat\r\n 18M\trev00005.dat\r\n 18M\trev00006.dat\r\n 19M\trev00007.dat\r\n 19M\trev00008.dat\r\n 18M\trev00009.dat\r\n 18M\trev00010.dat\r\n 19M\trev00011.dat\r\n 19M\trev00012.dat\r\n 19M\trev00013.dat\r\n 19M\trev00014.dat\r\n 18M\trev00015.dat\r\n 19M\trev00016.dat\r\n5.1M\trev00017.dat\r\n2.5G\ttotal\r\n```\r\n\r\nMaster (~same block, after shutdown):\r\n```Bash\r\n$ du -ch *.dat\r\n128M\tblk00000.dat\r\n128M\tblk00001.dat\r\n128M\tblk00002.dat\r\n128M\tblk00003.dat\r\n128M\tblk00004.dat\r\n128M\tblk00005.dat\r\n128M\tblk00006.dat\r\n128M\tblk00007.dat\r\n128M\tblk00008.dat\r\n128M\tblk00009.dat\r\n128M\tblk00010.dat\r\n128M\tblk00011.dat\r\n128M\tblk00012.dat\r\n128M\tblk00013.dat\r\n128M\tblk00014.dat\r\n128M\tblk00015.dat\r\n128M\tblk00016.dat\r\n144M\tblk00017.dat\r\n 19M\trev00000.dat\r\n 17M\trev00001.dat\r\n 16M\trev00002.dat\r\n 17M\trev00003.dat\r\n 17M\trev00004.dat\r\n 18M\trev00005.dat\r\n 18M\trev00006.dat\r\n 36M\trev00007.dat\r\n 51M\trev00008.dat\r\n 18M\trev00009.dat\r\n 18M\trev00010.dat\r\n 18M\trev00011.dat\r\n162M\trev00012.dat\r\n 67M\trev00013.dat\r\n126M\trev00014.dat\r\n 51M\trev00015.dat\r\n 67M\trev00016.dat\r\n 21M\trev00017.dat\r\n3.0G\ttotal\r\n```\r\n\r\nBoth runs were after `rm -rf $BITCOINDIR`.\r\n\r\n`grep 'Pre-allocating'` results for master run, minus a small part of the start: https://pastebin.com/dXLLcRQa\r\n\r\nLooking closely at the run on master, the files are blowing up 2x in size until they are no longer used, at which point they are **sometimes** truncated to their actual size. The blow-up applies to blk files as well, but these are always truncated down after use (see blk00017.dat, which is too large because it isn't finished yet; this was after shutting Bitcoin Core down).\r\n\r\nRunning on this PR, the 2x blowup is not occurring for either files.\r\n\r\nRunning macos 10.14.6 (Mojave). User is running Catalina, so perhaps I would see the problem more often if I upgraded.",
      "created_at" : "2020-01-07T13:43:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-571591432",
      "id" : 571591432,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3MTU5MTQzMg==",
      "updated_at" : "2020-01-07T15:33:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/571591432",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.",
      "created_at" : "2020-01-07T13:54:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-571595731",
      "id" : 571595731,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3MTU5NTczMQ==",
      "updated_at" : "2020-01-07T23:17:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/571595731",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Enlightening read: https://www.mail-archive.com/filesystem-dev@lists.apple.com/msg00226.html",
      "created_at" : "2020-01-07T16:11:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-571654678",
      "id" : 571654678,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3MTY1NDY3OA==",
      "updated_at" : "2020-01-07T16:11:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/571654678",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Tested on MacOS 10.15.2 on an APFS volume and the problem disappears. Also tested on a mounted HFS+ disk volume and the problem disappears.",
      "created_at" : "2020-01-07T19:03:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-571725182",
      "id" : 571725182,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3MTcyNTE4Mg==",
      "updated_at" : "2020-01-07T19:03:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/571725182",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/54533?v=4",
         "events_url" : "https://api.github.com/users/IPGlider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/IPGlider/followers",
         "following_url" : "https://api.github.com/users/IPGlider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/IPGlider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/IPGlider",
         "id" : 54533,
         "login" : "IPGlider",
         "node_id" : "MDQ6VXNlcjU0NTMz",
         "organizations_url" : "https://api.github.com/users/IPGlider/orgs",
         "received_events_url" : "https://api.github.com/users/IPGlider/received_events",
         "repos_url" : "https://api.github.com/users/IPGlider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/IPGlider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/IPGlider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/IPGlider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2020-01-08T02:45:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-571867237",
      "id" : 571867237,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3MTg2NzIzNw==",
      "updated_at" : "2020-01-08T02:45:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/571867237",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I ran this on machine 2 in the issue report and can confirm that there is no blowup.\r\n\r\n- MacBook Pro (15-inch, 2018)\r\n- 2,6 GHz 6-Core Intel Core i7\r\n- 32 GB 2400 MHz DDR4\r\n- macOS Catalina 10.15.2 (upgraded from Mojave)\r\n\r\nTested on an APFS unencrypted disk image with 3 GB in size and let it run until the image was full:\r\n```\r\n$ ./bitcoind -datadir=/Volumes/APFS\r\n2020-01-09T19:43:17Z UpdateTip: \r\nnew best=000000000000059cfb1620756c7a88b679dfcbedc1d3c255dbc0f09481f8021b\r\nheight=191055 version=0x00000001 log2_work=68.451374 tx=5349799 \r\ndate='2012-07-27T17:15:53Z' progress=0.010844 cache=292.8MiB(2160691txo)\r\n2020-01-09T19:43:19Z *** Disk space is too low!\r\n\r\n$ cd /Volumes/APFS/blocks/\r\n\r\n$ du -ch *.dat\r\n128M\tblk00000.dat\r\n128M\tblk00001.dat\r\n128M\tblk00002.dat\r\n128M\tblk00003.dat\r\n128M\tblk00004.dat\r\n128M\tblk00005.dat\r\n128M\tblk00006.dat\r\n128M\tblk00007.dat\r\n128M\tblk00008.dat\r\n128M\tblk00009.dat\r\n128M\tblk00010.dat\r\n128M\tblk00011.dat\r\n128M\tblk00012.dat\r\n128M\tblk00013.dat\r\n128M\tblk00014.dat\r\n128M\tblk00015.dat\r\n128M\tblk00016.dat\r\n 48M\tblk00017.dat\r\n 20M\trev00000.dat\r\n 17M\trev00001.dat\r\n 16M\trev00002.dat\r\n 17M\trev00003.dat\r\n 18M\trev00004.dat\r\n 18M\trev00005.dat\r\n 19M\trev00006.dat\r\n 18M\trev00007.dat\r\n 19M\trev00008.dat\r\n 18M\trev00009.dat\r\n 19M\trev00010.dat\r\n 18M\trev00011.dat\r\n 18M\trev00012.dat\r\n 18M\trev00013.dat\r\n 19M\trev00014.dat\r\n 18M\trev00015.dat\r\n 19M\trev00016.dat\r\n5.0M\trev00017.dat\r\n2.5G\ttotal\r\n```\r\n\r\nTested on a Mac OS Extended (HFS+) unencrypted disk image with 3 GB in size:\r\n```\r\n$ ./bitcoind -datadir=/Volumes/HFS+/\r\n2020-01-09T20:13:51Z UpdateTip: \r\nnew best=00000000000004e055fbb153a6371891f7dc52adbe525b3a5cf3b9413fde7551 \r\nheight=189775 version=0x00000001 log2_work=68.414219 tx=5084658 \r\ndate='2012-07-19T07:39:48Z' progress=0.010306 cache=285.6MiB(2101977txo)\r\n2020-01-09T20:13:51Z Error: Disk space is too low!\r\n\r\n$ cd /Volumes/HFS+/blocks/\r\n\r\n$ du -ch *.dat\r\n128M\tblk00000.dat\r\n128M\tblk00001.dat\r\n128M\tblk00002.dat\r\n128M\tblk00003.dat\r\n128M\tblk00004.dat\r\n128M\tblk00005.dat\r\n128M\tblk00006.dat\r\n128M\tblk00007.dat\r\n128M\tblk00008.dat\r\n128M\tblk00009.dat\r\n128M\tblk00010.dat\r\n128M\tblk00011.dat\r\n128M\tblk00012.dat\r\n128M\tblk00013.dat\r\n128M\tblk00014.dat\r\n128M\tblk00015.dat\r\n 64M\tblk00016.dat\r\n 19M\trev00000.dat\r\n 17M\trev00001.dat\r\n 16M\trev00002.dat\r\n 16M\trev00003.dat\r\n 17M\trev00004.dat\r\n 17M\trev00005.dat\r\n 18M\trev00006.dat\r\n 18M\trev00007.dat\r\n 18M\trev00008.dat\r\n 18M\trev00009.dat\r\n 18M\trev00010.dat\r\n 18M\trev00011.dat\r\n 18M\trev00012.dat\r\n 18M\trev00013.dat\r\n 18M\trev00014.dat\r\n 18M\trev00015.dat\r\n8.0M\trev00016.dat\r\n2.3G\ttotal\r\n```",
      "created_at" : "2020-01-09T20:18:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-572737177",
      "id" : 572737177,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3MjczNzE3Nw==",
      "updated_at" : "2020-01-09T20:18:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/572737177",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/20860124?v=4",
         "events_url" : "https://api.github.com/users/eriknylund/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eriknylund/followers",
         "following_url" : "https://api.github.com/users/eriknylund/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eriknylund/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eriknylund",
         "id" : 20860124,
         "login" : "eriknylund",
         "node_id" : "MDQ6VXNlcjIwODYwMTI0",
         "organizations_url" : "https://api.github.com/users/eriknylund/orgs",
         "received_events_url" : "https://api.github.com/users/eriknylund/received_events",
         "repos_url" : "https://api.github.com/users/eriknylund/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eriknylund/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eriknylund/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eriknylund"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I also built a Bitcoin-Qt.dmg and started a fresh download on machine 1 in the issue report, to verify that I can successfully complete the initial block download on the Mac mini with 480 GB of free disk space at the start. ETA 3 days.",
      "created_at" : "2020-01-09T20:44:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-572746538",
      "id" : 572746538,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3Mjc0NjUzOA==",
      "updated_at" : "2020-01-09T20:44:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/572746538",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/20860124?v=4",
         "events_url" : "https://api.github.com/users/eriknylund/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eriknylund/followers",
         "following_url" : "https://api.github.com/users/eriknylund/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eriknylund/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eriknylund",
         "id" : 20860124,
         "login" : "eriknylund",
         "node_id" : "MDQ6VXNlcjIwODYwMTI0",
         "organizations_url" : "https://api.github.com/users/eriknylund/orgs",
         "received_events_url" : "https://api.github.com/users/eriknylund/received_events",
         "repos_url" : "https://api.github.com/users/eriknylund/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eriknylund/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eriknylund/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eriknylund"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've just finished a from scratch sync using this PR + 17892, on an macOS (APFS) machine. Data directory is the expected size. No longer seeing very large rev*.dat files, most are between 16 and 21mb.",
      "created_at" : "2020-01-10T05:06:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-572875388",
      "id" : 572875388,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3Mjg3NTM4OA==",
      "updated_at" : "2020-01-10T05:06:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/572875388",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> I also built a Bitcoin-Qt.dmg and started a fresh download on machine 1 in the issue report, to verify that I can successfully complete the initial block download on the Mac mini with 480 GB of free disk space at the start. ETA 3 days.\r\n\r\n> I've just finished a from scratch sync using this PR + 17892, on an macOS (APFS) machine. Data directory is the expected size. No longer seeing very large rev*.dat files, most are between 16 and 21mb.\r\n\r\nThe IBD is now complete and the estimate is spot on. 280 GB of disk space is used. The rev*.dat file sizes are in the range 12-27 MB.\r\n```\r\nBitcoin % pwd\r\n/Users/erik/Library/Application Support/Bitcoin\r\n\r\nBitcoin % du -h .\r\n 92M\t./blocks/index\r\n276G\t./blocks\r\n3.7G\t./chainstate\r\n2.0M\t./wallets/database\r\n4.0M\t./wallets\r\n280G\t.\r\n\r\nBitcoin % tail debug.log\r\n2020-01-12T17:17:44Z UpdateTip: \r\nnew best=000000000000000000141d63c0a927235c7e21b39f8c632f9b7e70a9f3fb1659 \r\nheight=612543 version=0x3fffe000 log2_work=91.544872 tx=492581053 \r\ndate='2020-01-12T17:17:13Z' progress=1.000000 cache=259.8MiB(1712729txo) \r\nwarning='71 of last 100 blocks have unexpected version'\r\n\r\nBitcoin % du -ch blocks/rev*.dat | sort -n\r\n 12M\tblocks/rev00311.dat\r\n 12M\tblocks/rev01927.dat\r\n 14M\tblocks/rev00314.dat\r\n...\r\n 23M\tblocks/rev00337.dat\r\n 24M\tblocks/rev01037.dat\r\n 27M\tblocks/rev01036.dat\r\n 35G\ttotal\r\n```",
      "created_at" : "2020-01-12T17:24:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-573437436",
      "id" : 573437436,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3MzQzNzQzNg==",
      "updated_at" : "2020-01-12T17:58:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/573437436",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/20860124?v=4",
         "events_url" : "https://api.github.com/users/eriknylund/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eriknylund/followers",
         "following_url" : "https://api.github.com/users/eriknylund/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eriknylund/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eriknylund",
         "id" : 20860124,
         "login" : "eriknylund",
         "node_id" : "MDQ6VXNlcjIwODYwMTI0",
         "organizations_url" : "https://api.github.com/users/eriknylund/orgs",
         "received_events_url" : "https://api.github.com/users/eriknylund/received_events",
         "repos_url" : "https://api.github.com/users/eriknylund/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eriknylund/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eriknylund/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eriknylund"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Looking a bit more into the rev files I see what is most likely the truncation issue @kallewoof discovered in https://github.com/bitcoin/bitcoin/issues/17890\r\n```\r\nBitcoin % du -h blocks/rev00337.dat blocks/rev01037.dat blocks/rev01036.dat\r\n 23M\tblocks/rev00337.dat\r\n 24M\tblocks/rev01037.dat\r\n 27M\tblocks/rev01036.dat\r\nBitcoin % ls -lh blocks/rev00337.dat blocks/rev01037.dat blocks/rev01036.dat\r\n-rw-------  1 erik  staff    21M Jan 10 10:46 blocks/rev00337.dat\r\n-rw-------  1 erik  staff    23M Jan 11 12:56 blocks/rev01036.dat\r\n-rw-------  1 erik  staff    21M Jan 11 12:58 blocks/rev01037.dat\r\n```",
      "created_at" : "2020-01-12T19:57:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-573451085",
      "id" : 573451085,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3MzQ1MTA4NQ==",
      "updated_at" : "2020-01-12T19:57:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/573451085",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/20860124?v=4",
         "events_url" : "https://api.github.com/users/eriknylund/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eriknylund/followers",
         "following_url" : "https://api.github.com/users/eriknylund/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eriknylund/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eriknylund",
         "id" : 20860124,
         "login" : "eriknylund",
         "node_id" : "MDQ6VXNlcjIwODYwMTI0",
         "organizations_url" : "https://api.github.com/users/eriknylund/orgs",
         "received_events_url" : "https://api.github.com/users/eriknylund/received_events",
         "repos_url" : "https://api.github.com/users/eriknylund/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eriknylund/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eriknylund/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eriknylund"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks! Yeah, we will have to do a one time run-through of all the rev files to clean up the excess use, or we will end up with wasted space for everyone.. I'm honestly not sure why this isn't affecting other systems though. The finalize issue is not mac specific (only the over-preallocating issue is).",
      "created_at" : "2020-01-13T04:28:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-573503652",
      "id" : 573503652,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3MzUwMzY1Mg==",
      "updated_at" : "2020-01-13T04:28:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/573503652",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This made me realize that this actually is a bug in the operating system. I couldn't explain why this didn't happen to earlier versions, but I believe I can now.\r\n\r\nThe bug is that ftruncate does not return pre-allocated disk space.\r\n\r\nBefore, we would over-preallocate and then immediately truncate back down to the expected size. This worked in pre-APFS land, but APFS has a bug which leaves the pre-allocated space as occupied by the file, even though we call ftruncate.\r\n\r\nI will make a minimal test case displaying this behavior and submit a report to Apple.\r\n\r\nEdit: https://openradar.appspot.com/radar?id=4930713610616832\r\n\r\nEdit: I updated the bug report above with information on `F_PUNCHHOLE`, which appears to be the way to un-preallocate (return) space; this does nothing, however.",
      "created_at" : "2020-01-13T04:36:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-573504904",
      "id" : 573504904,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3MzUwNDkwNA==",
      "updated_at" : "2020-01-14T09:00:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/573504904",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17887#discussion_r366013822"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17887"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/366013822"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: could `static_cast`",
      "commit_id" : "75163f4729c10c40d2843da28a8c79ab89193f6a",
      "created_at" : "2020-01-13T20:33:40Z",
      "diff_hunk" : "@@ -978,13 +978,13 @@ void AllocateFileRange(FILE *file, unsigned int offset, unsigned int length) {\n     fst.fst_flags = F_ALLOCATECONTIG;\n     fst.fst_posmode = F_PEOFPOSMODE;\n     fst.fst_offset = 0;\n-    fst.fst_length = (off_t)offset + length;\n+    fst.fst_length = length; // mac os fst_length takes the # of free bytes to allocate, not desired file size\n     fst.fst_bytesalloc = 0;\n     if (fcntl(fileno(file), F_PREALLOCATE, &fst) == -1) {\n         fst.fst_flags = F_ALLOCATEALL;\n         fcntl(fileno(file), F_PREALLOCATE, &fst);\n     }\n-    ftruncate(fileno(file), fst.fst_length);\n+    ftruncate(fileno(file), (off_t)offset + length);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#discussion_r366013822",
      "id" : 366013822,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjAxMzgyMg==",
      "original_commit_id" : "5de93dced1a2d10b21ce0afa3bfb293cf58071e9",
      "original_position" : 12,
      "path" : "src/util/system.cpp",
      "position" : null,
      "pull_request_review_id" : 342120365,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17887",
      "updated_at" : "2020-01-14T23:57:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/366013822",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK https://github.com/bitcoin/bitcoin/pull/17887/commits/5de93dced1a2d10b21ce0afa3bfb293cf58071e9 also checked `man fcntl` locally",
      "created_at" : "2020-01-13T20:35:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-573858010",
      "id" : 573858010,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3Mzg1ODAxMA==",
      "updated_at" : "2020-01-13T20:35:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/573858010",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17887#discussion_r366122599"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17887"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/366122599"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "75163f4729c10c40d2843da28a8c79ab89193f6a",
      "created_at" : "2020-01-14T02:08:42Z",
      "diff_hunk" : "@@ -978,13 +978,13 @@ void AllocateFileRange(FILE *file, unsigned int offset, unsigned int length) {\n     fst.fst_flags = F_ALLOCATECONTIG;\n     fst.fst_posmode = F_PEOFPOSMODE;\n     fst.fst_offset = 0;\n-    fst.fst_length = (off_t)offset + length;\n+    fst.fst_length = length; // mac os fst_length takes the # of free bytes to allocate, not desired file size\n     fst.fst_bytesalloc = 0;\n     if (fcntl(fileno(file), F_PREALLOCATE, &fst) == -1) {\n         fst.fst_flags = F_ALLOCATEALL;\n         fcntl(fileno(file), F_PREALLOCATE, &fst);\n     }\n-    ftruncate(fileno(file), fst.fst_length);\n+    ftruncate(fileno(file), (off_t)offset + length);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#discussion_r366122599",
      "id" : 366122599,
      "in_reply_to_id" : 366013822,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjEyMjU5OQ==",
      "original_commit_id" : "5de93dced1a2d10b21ce0afa3bfb293cf58071e9",
      "original_position" : 12,
      "path" : "src/util/system.cpp",
      "position" : null,
      "pull_request_review_id" : 342255134,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17887",
      "updated_at" : "2020-01-14T23:57:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/366122599",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@arvidn Any chance you could comment here, given you patched an [APFS related issue in libtorrent](https://github.com/arvidn/libtorrent/pull/2450) some time ago?",
      "created_at" : "2020-01-14T12:27:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-574151224",
      "id" : 574151224,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NDE1MTIyNA==",
      "updated_at" : "2020-01-14T12:27:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/574151224",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "This patch changes the behavior of `AllocateFileRange()`, which is documented to:\r\n\r\n> this function tries to make a particular range of a file allocated (corresponding to disk space) it is advisory, and the range specified in the arguments will never contain live data\r\n\r\nIt doesn't seem like this patch correctly implements the documented behavior. It might fix an issue in how `AllocateFileRange()` is used, but there still seems to be a mismatch in how `AllocateFileRange()` behaves on other operating systems and what it's documented to do.\r\n\r\nIf I understand the mailing list post Dominic Giampaolo correctly, in order to implement the documented behavior of `AllocateFileRange()` you would also need to `stat()` the file and set:\r\n\r\n```\r\nfst.fst_length = offset + length - st_size;\r\n```\r\n\r\nand if `offset + length` < `st_size`, skip the `fcntl()` call entirely.",
      "created_at" : "2020-01-14T13:17:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-574168424",
      "id" : 574168424,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NDE2ODQyNA==",
      "updated_at" : "2020-01-14T13:17:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/574168424",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/661450?v=4",
         "events_url" : "https://api.github.com/users/arvidn/events{/privacy}",
         "followers_url" : "https://api.github.com/users/arvidn/followers",
         "following_url" : "https://api.github.com/users/arvidn/following{/other_user}",
         "gists_url" : "https://api.github.com/users/arvidn/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/arvidn",
         "id" : 661450,
         "login" : "arvidn",
         "node_id" : "MDQ6VXNlcjY2MTQ1MA==",
         "organizations_url" : "https://api.github.com/users/arvidn/orgs",
         "received_events_url" : "https://api.github.com/users/arvidn/received_events",
         "repos_url" : "https://api.github.com/users/arvidn/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/arvidn/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/arvidn/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/arvidn"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Edit: nevermind, I see what you're saying, but I believe offset is already (supposed to be) equal to st_size, so I don't think it matters.",
      "created_at" : "2020-01-14T13:50:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-574183171",
      "id" : 574183171,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NDE4MzE3MQ==",
      "updated_at" : "2020-01-14T13:51:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/574183171",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> but I believe offset is already (supposed to be) equal to st_size\r\n\r\nRight, this patch makes that assumption. The windows implementation does not make this assumption, nor does the documentation state it will make this assumption.",
      "created_at" : "2020-01-14T13:57:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-574185968",
      "id" : 574185968,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NDE4NTk2OA==",
      "updated_at" : "2020-01-14T13:57:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/574185968",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/661450?v=4",
         "events_url" : "https://api.github.com/users/arvidn/events{/privacy}",
         "followers_url" : "https://api.github.com/users/arvidn/followers",
         "following_url" : "https://api.github.com/users/arvidn/following{/other_user}",
         "gists_url" : "https://api.github.com/users/arvidn/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/arvidn",
         "id" : 661450,
         "login" : "arvidn",
         "node_id" : "MDQ6VXNlcjY2MTQ1MA==",
         "organizations_url" : "https://api.github.com/users/arvidn/orgs",
         "received_events_url" : "https://api.github.com/users/arvidn/received_events",
         "repos_url" : "https://api.github.com/users/arvidn/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/arvidn/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/arvidn/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/arvidn"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I see what you mean. I don't think it matters in this case either way, but it's worth pointing out.",
      "created_at" : "2020-01-14T14:13:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-574192908",
      "id" : 574192908,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NDE5MjkwOA==",
      "updated_at" : "2020-01-14T14:13:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/574192908",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Either way, that's unrelated to the question which is how to properly pre-allocate (and more importantly, how to return unused space at the end) on APFS.",
      "created_at" : "2020-01-14T14:14:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-574193394",
      "id" : 574193394,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NDE5MzM5NA==",
      "updated_at" : "2020-01-14T14:14:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/574193394",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Pushed a comment regarding the assumption `<file size> == offset` in the OSX version.",
      "created_at" : "2020-01-14T23:58:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-574430849",
      "id" : 574430849,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NDQzMDg0OQ==",
      "updated_at" : "2020-01-14T23:58:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/574430849",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17887#discussion_r366831506"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17887"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/366831506"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Wouldn't it make sense to add an assertion here? Implementing a function differently than documented on a OS (silently assuming it is always used in a specific way) could turn into a troubleshooting nightmare at some point.",
      "commit_id" : "75163f4729c10c40d2843da28a8c79ab89193f6a",
      "created_at" : "2020-01-15T11:41:44Z",
      "diff_hunk" : "@@ -974,17 +974,19 @@ void AllocateFileRange(FILE *file, unsigned int offset, unsigned int length) {\n     SetEndOfFile(hFile);\n #elif defined(MAC_OSX)\n     // OSX specific version\n+    // NOTE: Contrary to other OS versions, the OSX version assumes that\n+    // NOTE: offset is the size of the file.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#discussion_r366831506",
      "id" : 366831506,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjgzMTUwNg==",
      "original_commit_id" : "75163f4729c10c40d2843da28a8c79ab89193f6a",
      "original_position" : 5,
      "path" : "src/util/system.cpp",
      "position" : 5,
      "pull_request_review_id" : 343160768,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17887",
      "updated_at" : "2020-01-15T11:43:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/366831506",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17887#discussion_r366838661"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17887"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/366838661"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You would have to check file size, in which case you might as well do what @arvidn suggested. It depends on the impact of checking the file size (once per MB of data for rev files). I initially wrote code to do just that, but it felt wasteful. If people think it's fine, I can switch to this (or if there's a more optimized variant).\r\n\r\n```diff\r\ndiff --git a/src/util/system.cpp b/src/util/system.cpp\r\nindex d9fc38c91..3edcf5bc3 100644\r\n--- a/src/util/system.cpp\r\n+++ b/src/util/system.cpp\r\n@@ -974,11 +974,17 @@ void AllocateFileRange(FILE *file, unsigned int offset, unsigned int length) {\r\n     SetEndOfFile(hFile);\r\n #elif defined(MAC_OSX)\r\n     // OSX specific version\r\n+    long pos = ftell(file);\r\n+    fseek(file, 0L, SEEK_END);\r\n+    long filesize = ftell(file);\r\n+    fseek(file, pos, SEEK_SET);\r\n+    if (offset + length <= filesize) return;\r\n     fstore_t fst;\r\n     fst.fst_flags = F_ALLOCATECONTIG;\r\n     fst.fst_posmode = F_PEOFPOSMODE;\r\n     fst.fst_offset = 0;\r\n-    fst.fst_length = length; // mac os fst_length takes the # of free bytes to allocate, not desired file size\r\n+    // mac os fst_length takes the # of free bytes to allocate, not desired file size\r\n+    fst.fst_length = static_cast<off_t>(offset) + length - filesize;\r\n     fst.fst_bytesalloc = 0;\r\n     if (fcntl(fileno(file), F_PREALLOCATE, &fst) == -1) {\r\n         fst.fst_flags = F_ALLOCATEALL;\r\n```",
      "commit_id" : "75163f4729c10c40d2843da28a8c79ab89193f6a",
      "created_at" : "2020-01-15T12:00:16Z",
      "diff_hunk" : "@@ -974,17 +974,19 @@ void AllocateFileRange(FILE *file, unsigned int offset, unsigned int length) {\n     SetEndOfFile(hFile);\n #elif defined(MAC_OSX)\n     // OSX specific version\n+    // NOTE: Contrary to other OS versions, the OSX version assumes that\n+    // NOTE: offset is the size of the file.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#discussion_r366838661",
      "id" : 366838661,
      "in_reply_to_id" : 366831506,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjgzODY2MQ==",
      "original_commit_id" : "75163f4729c10c40d2843da28a8c79ab89193f6a",
      "original_position" : 5,
      "path" : "src/util/system.cpp",
      "position" : 5,
      "pull_request_review_id" : 343170042,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17887",
      "updated_at" : "2020-01-15T12:00:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/366838661",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17887#discussion_r366930914"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17887"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/366930914"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, that seems wasteful.\r\n\r\nAnother solution would be to remove the `offset` parameter and define the function to always work relative to the end of the file, for all platforms. This also avoids using the function in the wrong away.",
      "commit_id" : "75163f4729c10c40d2843da28a8c79ab89193f6a",
      "created_at" : "2020-01-15T15:14:53Z",
      "diff_hunk" : "@@ -974,17 +974,19 @@ void AllocateFileRange(FILE *file, unsigned int offset, unsigned int length) {\n     SetEndOfFile(hFile);\n #elif defined(MAC_OSX)\n     // OSX specific version\n+    // NOTE: Contrary to other OS versions, the OSX version assumes that\n+    // NOTE: offset is the size of the file.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#discussion_r366930914",
      "id" : 366930914,
      "in_reply_to_id" : 366831506,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjkzMDkxNA==",
      "original_commit_id" : "75163f4729c10c40d2843da28a8c79ab89193f6a",
      "original_position" : 5,
      "path" : "src/util/system.cpp",
      "position" : 5,
      "pull_request_review_id" : 343292461,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17887",
      "updated_at" : "2020-01-15T15:14:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/366930914",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17887#discussion_r366959618"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17887"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/366959618"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think the main reason why it is there in the first place is to avoid the seek part when possible. It basically functions as a cache approximating the file size. It will overshoot by a small amount (depending on the size of whatever is being written that doesn't currently fit), but it's mostly accurate, and I think for performance reasons this is done that way. After all, only the *preallocate* part overshoots - the `ftruncate` call adjusts the file size to the expected value (..except it doesn't -- see #17892).\r\n\r\nWe could of course remove the offset completely, but I think it would be an unnecessary performance loss with very little gain.\r\n\r\nIn practice, we end up over-pre-allocating up to the maximum possible value of an entry written into the respective files; for rev files, I assume this is usually in the few kbs range, and for blk files, I assume it's a couple of MBs since blocks are around that size. Analysis on this as below.\r\n\r\n===\r\n\r\nGiven:\r\n* `required` = bytes needed\r\n* `position` = current position inside file\r\n* `chunk_size` = the size of each chunk in the file (1 MB for rev files)\r\n* `allocation` = current file allocation (pre-allocated space)\r\n* `filesize` = current file *size*, i.e. whatever we truncated it to (this is identical to `allocation` on systems except OSX, and is in part mitigated by the fix here)\r\n* `old_chunks = (position + chunk_size - 1) / chunk_size`\r\n* `new_chunks = (position + required + chunk_size - 1) / chunk_size`\r\n\r\nFor the case where `new_chunks > old_chunks`, there is a discrepancy in `position` vs `filesize` that is between `0..chunk_size-1` (not greater, because the code never allocates more chunks than needed).\r\n* The `offset` is set to the former, and thus the assumed file size is in the range `[filesize - chunk_offset + 1 .. filesize]`.\r\n* The `length` is set to the value `new_chunks * chunk_size - position`, i.e. `position + required + chunk_size - 1 - position = required + chunk_size - 1`.\r\n\r\nResults:\r\n* Expectation: pre-allocate `required + chunk_size - 1` free bytes to get a file with size `position + required + chunk_size - 1` bytes, then truncate to that size.\r\n* Result: pre-allocate `required + chunk_size - 1` free bytes to get a file with size `filesize + required + chunk_size - 1` bytes, then truncate to `position + required + chunk_size - 1` bytes (this is currently not functional on APFS).\r\n* I.e. we end up with up to `chunk_size` more bytes in the pre-allocation stage.\r\n* For the rev case, we end up over-pre-allocating up to 1 extra MB of space that we keep bumping (fairly randomly in the range 0..1024*1024, though in practice this value is capped at the size of the biggest entry we write into rev files).\r\n* For the blk case, we over-pre-allocate up to 16 MB, but since blocks are capped at a few MBs, this ends up being a few MBs in practice.\r\n\r\nIf you spot any errors, let me know and I'll update.",
      "commit_id" : "75163f4729c10c40d2843da28a8c79ab89193f6a",
      "created_at" : "2020-01-15T16:01:08Z",
      "diff_hunk" : "@@ -974,17 +974,19 @@ void AllocateFileRange(FILE *file, unsigned int offset, unsigned int length) {\n     SetEndOfFile(hFile);\n #elif defined(MAC_OSX)\n     // OSX specific version\n+    // NOTE: Contrary to other OS versions, the OSX version assumes that\n+    // NOTE: offset is the size of the file.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#discussion_r366959618",
      "id" : 366959618,
      "in_reply_to_id" : 366831506,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njk1OTYxOA==",
      "original_commit_id" : "75163f4729c10c40d2843da28a8c79ab89193f6a",
      "original_position" : 5,
      "path" : "src/util/system.cpp",
      "position" : 5,
      "pull_request_review_id" : 343329942,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17887",
      "updated_at" : "2020-01-15T16:01:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/366959618",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "```\r\n=== BLOCK FILE INFO STATS (blocks 0 .. 50000) ===\r\nBLOCKS: 49877 additions, 12276387 total space, 246.1 bytes/addition\r\nREVS:   49437 additions, 2365864 total space, 47.9 bytes/addition\r\n\r\n=== BLOCK FILE INFO STATS (blocks 50000 .. 100000) ===\r\nBLOCKS: 49996 additions, 48138897 total space, 962.9 bytes/addition\r\n     3 allocations; 30243 over, 0 under => 10081.0 over/alloc, 0.0 under/alloc\r\nREVS:   49838 additions, 7405309 total space, 148.6 bytes/addition\r\n     7 allocations; 30309 over, 0 under => 4329.9 over/alloc, 0.0 under/alloc\r\n\r\n=== BLOCK FILE INFO STATS (blocks 100000 .. 150000) ===\r\nBLOCKS: 50003 additions, 626534873 total space, 12529.9 bytes/addition\r\n     38 allocations; 414684 over, 0 under => 10912.7 over/alloc, 0.0 under/alloc\r\nREVS:   49910 additions, 76723416 total space, 1537.2 bytes/addition\r\n     78 allocations; 140190 over, 0 under => 1797.3 over/alloc, 0.0 under/alloc\r\n\r\n=== BLOCK FILE INFO STATS (blocks 150000 .. 200000) ===\r\nBLOCKS: 49984 additions, 2449096762 total space, 48997.6 bytes/addition\r\n     147 allocations; 8693387 over, 0 under => 59138.7 over/alloc, 0.0 under/alloc\r\nREVS:   50221 additions, 329612289 total space, 6563.2 bytes/addition\r\n     329 allocations; 2841940 over, 0 under => 8638.1 over/alloc, 0.0 under/alloc\r\n\r\n=== BLOCK FILE INFO STATS (blocks 200000 .. 250000) ===\r\nBLOCKS: 50085 additions, 6683661512 total space, 133446.4 bytes/addition\r\n     397 allocations; 35292223 over, 0 under => 88897.3 over/alloc, 0.0 under/alloc\r\nREVS:   50444 additions, 898707532 total space, 17815.9 bytes/addition\r\n     886 allocations; 10750386 over, 0 under => 12133.6 over/alloc, 0.0 under/alloc\r\n\r\n=== BLOCK FILE INFO STATS (blocks 250000 .. 300000) ===\r\nBLOCKS: 49928 additions, 8774861776 total space, 175750.3 bytes/addition\r\n     526 allocations; 67195634 over, 0 under => 127748.4 over/alloc, 0.0 under/alloc\r\nREVS:   49276 additions, 1193450599 total space, 24219.7 bytes/addition\r\n     1181 allocations; 21881254 over, 0 under => 18527.7 over/alloc, 0.0 under/alloc\r\n\r\n=== BLOCK FILE INFO STATS (blocks 300000 .. 350000) ===\r\nBLOCKS: 50051 additions, 14839754426 total space, 296492.7 bytes/addition\r\n     886 allocations; 188673758 over, 0 under => 212950.1 over/alloc, 0.0 under/alloc\r\nREVS:   50406 additions, 2084855624 total space, 41361.3 bytes/addition\r\n     2037 allocations; 61869705 over, 0 under => 30373.0 over/alloc, 0.0 under/alloc\r\n\r\n=== BLOCK FILE INFO STATS (blocks 350000 .. 400000) ===\r\nBLOCKS: 50070 additions, 27257622944 total space, 544390.3 bytes/addition\r\n     1627 allocations; 549589308 over, 0 under => 337793.1 over/alloc, 0.0 under/alloc\r\nREVS:   50443 additions, 3878444863 total space, 76887.7 bytes/addition\r\n     3785 allocations; 183316201 over, 0 under => 48432.3 over/alloc, 0.0 under/alloc\r\n\r\n=== BLOCK FILE INFO STATS (blocks 400000 .. 450000) ===\r\nBLOCKS: 49953 additions, 39828992105 total space, 797329.3 bytes/addition\r\n     2385 allocations; 943542364 over, 0 under => 395615.2 over/alloc, 0.0 under/alloc\r\nREVS:   49951 additions, 5365225097 total space, 107409.8 bytes/addition\r\n     5276 allocations; 296906600 over, 0 under => 56274.9 over/alloc, 0.0 under/alloc\r\n\r\n=== BLOCK FILE INFO STATS (blocks 450000 .. 500000) ===\r\nBLOCKS: 50037 additions, 47505676936 total space, 949411.0 bytes/addition\r\n     2840 allocations; 1300043016 over, 0 under => 457761.6 over/alloc, 0.0 under/alloc\r\nREVS:   50030 additions, 6404583587 total space, 128014.9 bytes/addition\r\n     6284 allocations; 385011825 over, 0 under => 61268.6 over/alloc, 0.0 under/alloc\r\n\r\n=== BLOCK FILE INFO STATS (blocks 500000 .. 550000) ===\r\nBLOCKS: 50006 additions, 43443126157 total space, 868758.2 bytes/addition\r\n    2599 allocations; 1225858445 over, 0 under => 471665.4 over/alloc, 0.0 under/alloc\r\nREVS:   50019 additions, 5910980004 total space, 118174.7 bytes/addition\r\n    5800 allocations; 376748454 over, 0 under => 64956.6 over/alloc, 0.0 under/alloc\r\n\r\n=== BLOCK FILE INFO STATS (blocks 550000 .. 600000) ===\r\nBLOCKS: 49998 additions, 53633781103 total space, 1072718.5 bytes/addition\r\n    3211 allocations; 1685246556 over, 0 under => 524835.4 over/alloc, 0.0 under/alloc\r\nREVS:   49982 additions, 6957171383 total space, 139193.5 bytes/addition\r\n    6833 allocations; 476667594 over, 0 under => 69759.6 over/alloc, 0.0 under/alloc\r\n```\r\n",
      "created_at" : "2020-01-17T01:12:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-575420390",
      "id" : 575420390,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NTQyMDM5MA==",
      "updated_at" : "2020-01-17T01:12:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/575420390",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Strictly increasing, but looks like rev files will over-allocate by about 70 kb on average, and block files by .5 MB.",
      "created_at" : "2020-01-17T01:14:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-575420715",
      "id" : 575420715,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NTQyMDcxNQ==",
      "updated_at" : "2020-01-17T01:14:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/575420715",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> ```\r\n> === BLOCK FILE INFO STATS (blocks 0 .. 50000) ===\r\n> BLOCKS: 49877 additions, 12276387 total space, 246.1 bytes/addition\r\n> REVS:   49437 additions, 2365864 total space, 47.9 bytes/addition\r\n> \r\n> === BLOCK FILE INFO STATS (blocks 50000 .. 100000) ===\r\n> BLOCKS: 49996 additions, 48138897 total space, 962.9 bytes/addition\r\n>      3 allocations; 30243 over, 0 under => 10081.0 over/alloc, 0.0 under/alloc\r\n> REVS:   49838 additions, 7405309 total space, 148.6 bytes/addition\r\n>      7 allocations; 30309 over, 0 under => 4329.9 over/alloc, 0.0 under/alloc\r\n> \r\n> === BLOCK FILE INFO STATS (blocks 100000 .. 150000) ===\r\n> BLOCKS: 50003 additions, 626534873 total space, 12529.9 bytes/addition\r\n>      38 allocations; 414684 over, 0 under => 10912.7 over/alloc, 0.0 under/alloc\r\n> REVS:   49910 additions, 76723416 total space, 1537.2 bytes/addition\r\n>      78 allocations; 140190 over, 0 under => 1797.3 over/alloc, 0.0 under/alloc\r\n> \r\n> === BLOCK FILE INFO STATS (blocks 150000 .. 200000) ===\r\n> BLOCKS: 49984 additions, 2449096762 total space, 48997.6 bytes/addition\r\n>      147 allocations; 8693387 over, 0 under => 59138.7 over/alloc, 0.0 under/alloc\r\n> REVS:   50221 additions, 329612289 total space, 6563.2 bytes/addition\r\n>      329 allocations; 2841940 over, 0 under => 8638.1 over/alloc, 0.0 under/alloc\r\n> \r\n> === BLOCK FILE INFO STATS (blocks 200000 .. 250000) ===\r\n> BLOCKS: 50085 additions, 6683661512 total space, 133446.4 bytes/addition\r\n>      397 allocations; 35292223 over, 0 under => 88897.3 over/alloc, 0.0 under/alloc\r\n> REVS:   50444 additions, 898707532 total space, 17815.9 bytes/addition\r\n>      886 allocations; 10750386 over, 0 under => 12133.6 over/alloc, 0.0 under/alloc\r\n> \r\n> === BLOCK FILE INFO STATS (blocks 250000 .. 300000) ===\r\n> BLOCKS: 49928 additions, 8774861776 total space, 175750.3 bytes/addition\r\n>      526 allocations; 67195634 over, 0 under => 127748.4 over/alloc, 0.0 under/alloc\r\n> REVS:   49276 additions, 1193450599 total space, 24219.7 bytes/addition\r\n>      1181 allocations; 21881254 over, 0 under => 18527.7 over/alloc, 0.0 under/alloc\r\n> \r\n> === BLOCK FILE INFO STATS (blocks 300000 .. 350000) ===\r\n> BLOCKS: 50051 additions, 14839754426 total space, 296492.7 bytes/addition\r\n>      886 allocations; 188673758 over, 0 under => 212950.1 over/alloc, 0.0 under/alloc\r\n> REVS:   50406 additions, 2084855624 total space, 41361.3 bytes/addition\r\n>      2037 allocations; 61869705 over, 0 under => 30373.0 over/alloc, 0.0 under/alloc\r\n> \r\n> === BLOCK FILE INFO STATS (blocks 350000 .. 400000) ===\r\n> BLOCKS: 50070 additions, 27257622944 total space, 544390.3 bytes/addition\r\n>      1627 allocations; 549589308 over, 0 under => 337793.1 over/alloc, 0.0 under/alloc\r\n> REVS:   50443 additions, 3878444863 total space, 76887.7 bytes/addition\r\n>      3785 allocations; 183316201 over, 0 under => 48432.3 over/alloc, 0.0 under/alloc\r\n> \r\n> === BLOCK FILE INFO STATS (blocks 400000 .. 450000) ===\r\n> BLOCKS: 49953 additions, 39828992105 total space, 797329.3 bytes/addition\r\n>      2385 allocations; 943542364 over, 0 under => 395615.2 over/alloc, 0.0 under/alloc\r\n> REVS:   49951 additions, 5365225097 total space, 107409.8 bytes/addition\r\n>      5276 allocations; 296906600 over, 0 under => 56274.9 over/alloc, 0.0 under/alloc\r\n> \r\n> === BLOCK FILE INFO STATS (blocks 450000 .. 500000) ===\r\n> BLOCKS: 50037 additions, 47505676936 total space, 949411.0 bytes/addition\r\n>      2840 allocations; 1300043016 over, 0 under => 457761.6 over/alloc, 0.0 under/alloc\r\n> REVS:   50030 additions, 6404583587 total space, 128014.9 bytes/addition\r\n>      6284 allocations; 385011825 over, 0 under => 61268.6 over/alloc, 0.0 under/alloc\r\n> \r\n> === BLOCK FILE INFO STATS (blocks 500000 .. 550000) ===\r\n> BLOCKS: 50006 additions, 43443126157 total space, 868758.2 bytes/addition\r\n>     2599 allocations; 1225858445 over, 0 under => 471665.4 over/alloc, 0.0 under/alloc\r\n> REVS:   50019 additions, 5910980004 total space, 118174.7 bytes/addition\r\n>     5800 allocations; 376748454 over, 0 under => 64956.6 over/alloc, 0.0 under/alloc\r\n> \r\n> === BLOCK FILE INFO STATS (blocks 550000 .. 600000) ===\r\n> BLOCKS: 49998 additions, 53633781103 total space, 1072718.5 bytes/addition\r\n>     3211 allocations; 1685246556 over, 0 under => 524835.4 over/alloc, 0.0 under/alloc\r\n> REVS:   49982 additions, 6957171383 total space, 139193.5 bytes/addition\r\n>     6833 allocations; 476667594 over, 0 under => 69759.6 over/alloc, 0.0 under/alloc\r\n> ```\r\n\r\nI'm curious to know, how did you go about collecting these stats?",
      "created_at" : "2020-01-20T19:22:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-576401959",
      "id" : 576401959,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NjQwMTk1OQ==",
      "updated_at" : "2020-01-20T19:22:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/576401959",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/20860124?v=4",
         "events_url" : "https://api.github.com/users/eriknylund/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eriknylund/followers",
         "following_url" : "https://api.github.com/users/eriknylund/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eriknylund/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eriknylund",
         "id" : 20860124,
         "login" : "eriknylund",
         "node_id" : "MDQ6VXNlcjIwODYwMTI0",
         "organizations_url" : "https://api.github.com/users/eriknylund/orgs",
         "received_events_url" : "https://api.github.com/users/eriknylund/received_events",
         "repos_url" : "https://api.github.com/users/eriknylund/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eriknylund/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eriknylund/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eriknylund"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "ACK 75163f4729c10c40d2843da28a8c79ab89193f6a built locally. All tests passing. Manual test as per my previous comment above on an older commit, using an APFS unencrypted disk image with 3 GB.\r\n\r\nAre there any new tests that would make sense to add for this change?",
      "created_at" : "2020-01-20T19:43:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-576408371",
      "id" : 576408371,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NjQwODM3MQ==",
      "updated_at" : "2020-01-20T19:43:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/576408371",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/20860124?v=4",
         "events_url" : "https://api.github.com/users/eriknylund/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eriknylund/followers",
         "following_url" : "https://api.github.com/users/eriknylund/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eriknylund/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eriknylund",
         "id" : 20860124,
         "login" : "eriknylund",
         "node_id" : "MDQ6VXNlcjIwODYwMTI0",
         "organizations_url" : "https://api.github.com/users/eriknylund/orgs",
         "received_events_url" : "https://api.github.com/users/eriknylund/received_events",
         "repos_url" : "https://api.github.com/users/eriknylund/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eriknylund/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eriknylund/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eriknylund"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@eriknylund \r\n\r\n> I'm curious to know, how did you go about collecting these stats?\r\n\r\nI simply patched Bitcoin Core directly and re-ran IBD. I did some polishing on the final output, though. The branch is called 'macos-f_preallocate_fix-benchmarked' if you wanna see: https://github.com/kallewoof/bitcoin/tree/macos-f_preallocate_fix-benchmarked",
      "created_at" : "2020-01-21T00:19:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-576468293",
      "id" : 576468293,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NjQ2ODI5Mw==",
      "updated_at" : "2020-01-21T00:19:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/576468293",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@kallewoof wrote:\r\n> I suspect the OS eventually reclaims pre-allocated space, but it seems block files are not suffering from this kind of issue, so I'm honestly not sure. The docs clearly indicate we were using it wrong, though.\r\n\r\nMaybe. I have the blockchain on my macOS Catalina machine (APFS with encryption). Most historical rev files are ~17 MB but starting from `rev01835.dat` (October 22, 2019) I'm seeing many big ones (up to 171MB). `blk` files don't have this issue. Catalina was released on October 7th and I upgraded on the 9th according to `softwareupdate --history`. There was another system update on the 15th. I did sync Bitcoin Core multiple times in the interim, covering about 10 rev files which are normal size.\r\n\r\nNote that Finder just shows ~17 MB sizes.\r\n\r\nWhen I sync a fresh node from scratch I see rev files get as large as 100 MB, though usually shrinking back a bit when it moves the next one:\r\n<img width=\"380\" alt=\"Schermafbeelding 2020-01-21 om 14 47 19\" src=\"https://user-images.githubusercontent.com/10217/72810007-1333ac00-3c5d-11ea-9261-22b029acd358.png\">\r\n \r\nWith this PR rev files don't grow over 19 MB.\r\n\r\nI also tried starting a (testnet) node that was previously synced on master, but a day behind, and it didn't complain. \r\n",
      "created_at" : "2020-01-21T14:22:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-576703457",
      "id" : 576703457,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NjcwMzQ1Nw==",
      "updated_at" : "2020-01-21T14:22:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/576703457",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@Sjors Thanks for testing! Yeah, that comment is outdated. I will update it. I described it in detail here: https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-573504904\r\n",
      "created_at" : "2020-01-21T14:31:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-576707795",
      "id" : 576707795,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NjcwNzc5NQ==",
      "updated_at" : "2020-01-21T14:31:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/576707795",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK, great find!",
      "created_at" : "2020-01-21T16:38:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-576767853",
      "id" : 576767853,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3Njc2Nzg1Mw==",
      "updated_at" : "2020-01-21T16:38:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/576767853",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Hm, I could not reproduce the issue with the current master (631df3ee87ec93e1fc748715671cdb5cff7308e6) in a way indicated here: https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-571591432\r\n\r\nI started a new IBD and let it run up to ~220k blocks. Checked the blocks folder every couple of minutes and never saw a `rev` file larger than 20M, not even the most recent one as described by @Sjors .\r\n\r\nHere are my file sizes: https://gist.github.com/fjahr/a56a2c81217b255f448f2b53928c93db\r\n\r\nSystem: macOS Catalina 10.15.2, APFS (Encrypted), 2016 MBP\r\n\r\nHappy to test again if that's helpful. Based on the information I read here, I can't tell why my results are different from everyone else.\r\n\r\n**Edit:** I was now able to reproduce larger `rev` files (up to 64M). I was previously compiling with `--enable-debug` which appears to prevent this issue from appearing.\r\n\r\n**Edit 2:** This patch fixed the issue when `--enable-debug` is not enabled. I updated the gist file to with my other results.",
      "created_at" : "2020-01-21T17:05:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-576780731",
      "id" : 576780731,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3Njc4MDczMQ==",
      "updated_at" : "2020-01-21T18:50:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/576780731",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I ran with `--enable-debug` though.",
      "created_at" : "2020-01-21T19:08:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-576832365",
      "id" : 576832365,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NjgzMjM2NQ==",
      "updated_at" : "2020-01-21T19:08:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/576832365",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "My sizes using this pull request, running Catalina and an unencrypted APFS disk:\r\n\r\nhttps://pastebin.com/W53SX4xg\r\n\r\nRunning master:\r\n\r\nhttps://pastebin.com/0Sj2XXny\r\n\r\nAll file sizes for both this PR and master don't seem any different while running or after shutdown.",
      "created_at" : "2020-01-21T19:10:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-576833123",
      "id" : 576833123,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NjgzMzEyMw==",
      "updated_at" : "2020-01-21T19:10:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/576833123",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3718063?v=4",
         "events_url" : "https://api.github.com/users/bg002h/events{/privacy}",
         "followers_url" : "https://api.github.com/users/bg002h/followers",
         "following_url" : "https://api.github.com/users/bg002h/following{/other_user}",
         "gists_url" : "https://api.github.com/users/bg002h/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/bg002h",
         "id" : 3718063,
         "login" : "bg002h",
         "node_id" : "MDQ6VXNlcjM3MTgwNjM=",
         "organizations_url" : "https://api.github.com/users/bg002h/orgs",
         "received_events_url" : "https://api.github.com/users/bg002h/received_events",
         "repos_url" : "https://api.github.com/users/bg002h/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/bg002h/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/bg002h/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/bg002h"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@bg002h `ls -alFh` won't see the issue. Try `du -ch` instead.",
      "created_at" : "2020-01-21T19:14:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-576835181",
      "id" : 576835181,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NjgzNTE4MQ==",
      "updated_at" : "2020-01-21T19:14:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/576835181",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@Sjors Thx for the tip!\r\n\r\nI reformatted my NVME raid to APFS, encrypted, case sensitive since the above.\r\n\r\nFor master, I see: \r\nhttps://pastebin.com/GeqsZhmh (rev 50 was 45M)\r\n\r\nrunning this PR (pastern is down):\r\nbcg@Brians-MacBook-Pro blocks % du -ch *\r\n128M\tblk00000.dat\r\n.\r\n.\r\n.\r\n128M\tblk00052.dat\r\n 16M\tblk00053.dat\r\n8.0K\tindex\r\n 19M\trev00000.dat\r\n 16M\trev00001.dat\r\n 16M\trev00002.dat\r\n 16M\trev00003.dat\r\n 16M\trev00004.dat\r\n 17M\trev00005.dat\r\n 17M\trev00006.dat\r\n 17M\trev00007.dat\r\n 18M\trev00008.dat\r\n 18M\trev00009.dat\r\n 17M\trev00010.dat\r\n 17M\trev00011.dat\r\n 18M\trev00012.dat\r\n 18M\trev00013.dat\r\n 17M\trev00014.dat\r\n 17M\trev00015.dat\r\n 18M\trev00016.dat\r\n 17M\trev00017.dat\r\n 17M\trev00018.dat\r\n 17M\trev00019.dat\r\n 17M\trev00020.dat\r\n 17M\trev00021.dat\r\n 17M\trev00022.dat\r\n 17M\trev00023.dat\r\n 17M\trev00024.dat\r\n 17M\trev00025.dat\r\n 17M\trev00026.dat\r\n 17M\trev00027.dat\r\n 17M\trev00028.dat\r\n 17M\trev00029.dat\r\n 17M\trev00030.dat\r\n 17M\trev00031.dat\r\n 17M\trev00032.dat\r\n 17M\trev00033.dat\r\n 17M\trev00034.dat\r\n 17M\trev00035.dat\r\n 17M\trev00036.dat\r\n 17M\trev00037.dat\r\n 17M\trev00038.dat\r\n 17M\trev00039.dat\r\n 17M\trev00040.dat\r\n 17M\trev00041.dat\r\n 17M\trev00042.dat\r\n 17M\trev00043.dat\r\n 17M\trev00044.dat\r\n 17M\trev00045.dat\r\n 17M\trev00046.dat\r\n 17M\trev00047.dat\r\n 17M\trev00048.dat\r\n 17M\trev00049.dat\r\n 17M\trev00050.dat\r\n 17M\trev00051.dat\r\n 17M\trev00052.dat\r\n2.0M\trev00053.dat *in progress*\r\n7.5G\ttotal",
      "created_at" : "2020-01-21T19:33:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-576843316",
      "id" : 576843316,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3Njg0MzMxNg==",
      "updated_at" : "2020-01-21T19:33:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/576843316",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3718063?v=4",
         "events_url" : "https://api.github.com/users/bg002h/events{/privacy}",
         "followers_url" : "https://api.github.com/users/bg002h/followers",
         "following_url" : "https://api.github.com/users/bg002h/following{/other_user}",
         "gists_url" : "https://api.github.com/users/bg002h/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/bg002h",
         "id" : 3718063,
         "login" : "bg002h",
         "node_id" : "MDQ6VXNlcjM3MTgwNjM=",
         "organizations_url" : "https://api.github.com/users/bg002h/orgs",
         "received_events_url" : "https://api.github.com/users/bg002h/received_events",
         "repos_url" : "https://api.github.com/users/bg002h/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/bg002h/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/bg002h/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/bg002h"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "using master, and checking du repeatedly during blk1, rev1 gets pretty big before being trimmed back:\r\n\r\ncg@Brians-MacBook-Pro blocks % du -ch *\r\n576M\tblk00000.dat\r\n8.0K\tindex\r\n190M\trev00000.dat\r\n766M\ttotal\r\n\r\nThe behavior is not observed using this PR:\r\n\r\nbcg@Brians-MacBook-Pro blocks % du -ch *\r\n128M\tblk00000.dat\r\n8.0K\tindex\r\n 17M\trev00000.dat\r\n145M\ttotal\r\nbcg@Brians-MacBook-Pro blocks % du -ch *\r\n128M\tblk00000.dat\r\n8.0K\tindex\r\n 18M\trev00000.dat\r\n146M\ttotal\r\nbcg@Brians-MacBook-Pro blocks % du -ch *\r\n128M\tblk00000.dat\r\n8.0K\tindex\r\n 19M\trev00000.dat\r\n147M\ttotal\r\nbcg@Brians-MacBook-Pro blocks % du -ch *\r\n128M\tblk00000.dat\r\n8.0K\tindex\r\n 19M\trev00000.dat\r\n147M\ttotal\r\nbcg@Brians-MacBook-Pro blocks % du -ch *\r\n128M\tblk00000.dat\r\n8.0K\tindex\r\n 19M\trev00000.dat\r\n147M\ttotal\r\nbcg@Brians-MacBook-Pro blocks % du -ch *\r\n128M\tblk00000.dat\r\n 16M\tblk00001.dat\r\n8.0K\tindex\r\n 19M\trev00000.dat\r\n1.0M\trev00001.dat\r\n164M\ttotal\r\nbcg@Brians-MacBook-Pro blocks % du -ch *\r\n128M\tblk00000.dat\r\n 16M\tblk00001.dat\r\n8.0K\tindex\r\n 19M\trev00000.dat\r\n1.0M\trev00001.dat\r\n164M\ttotal\r\nbcg@Brians-MacBook-Pro blocks % \r\nbcg@Brians-MacBook-Pro blocks % du -ch *\r\n128M\tblk00000.dat\r\n 96M\tblk00001.dat\r\n8.0K\tindex\r\n 19M\trev00000.dat\r\n 12M\trev00001.dat\r\n255M\ttotal",
      "created_at" : "2020-01-21T19:42:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-576847315",
      "id" : 576847315,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3Njg0NzMxNQ==",
      "updated_at" : "2020-01-21T19:42:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/576847315",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3718063?v=4",
         "events_url" : "https://api.github.com/users/bg002h/events{/privacy}",
         "followers_url" : "https://api.github.com/users/bg002h/followers",
         "following_url" : "https://api.github.com/users/bg002h/following{/other_user}",
         "gists_url" : "https://api.github.com/users/bg002h/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/bg002h",
         "id" : 3718063,
         "login" : "bg002h",
         "node_id" : "MDQ6VXNlcjM3MTgwNjM=",
         "organizations_url" : "https://api.github.com/users/bg002h/orgs",
         "received_events_url" : "https://api.github.com/users/bg002h/received_events",
         "repos_url" : "https://api.github.com/users/bg002h/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/bg002h/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/bg002h/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/bg002h"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I ran with `--enable-debug` though.\r\n\r\nStrange, I double checked and still not seeing any large rev files with `--enable-debug`...",
      "created_at" : "2020-01-21T20:30:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-576867136",
      "id" : 576867136,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3Njg2NzEzNg==",
      "updated_at" : "2020-01-21T20:30:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/576867136",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "`--enable-debug` should not matter in this case. ",
      "created_at" : "2020-01-22T01:15:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-576962596",
      "id" : 576962596,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3Njk2MjU5Ng==",
      "updated_at" : "2020-01-22T01:15:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/576962596",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "FWIW I'm able to reproduce this on gitian-built clients as far back as 0.12.",
      "created_at" : "2020-01-22T02:00:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-576973222",
      "id" : 576973222,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3Njk3MzIyMg==",
      "updated_at" : "2020-01-22T02:00:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/576973222",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/69154?v=4",
         "events_url" : "https://api.github.com/users/maaku/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maaku/followers",
         "following_url" : "https://api.github.com/users/maaku/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maaku/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maaku",
         "id" : 69154,
         "login" : "maaku",
         "node_id" : "MDQ6VXNlcjY5MTU0",
         "organizations_url" : "https://api.github.com/users/maaku/orgs",
         "received_events_url" : "https://api.github.com/users/maaku/received_events",
         "repos_url" : "https://api.github.com/users/maaku/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maaku/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maaku/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maaku"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17887#discussion_r369635091"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17887"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/369635091"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think that's correct.\r\nThough I would expect the seek to be of negligible performance compared to the allocation of disk space itself.\r\n\r\nBut it's always possible to do that later; if people tested that this fixes the issue let's not make further changes here.",
      "commit_id" : "75163f4729c10c40d2843da28a8c79ab89193f6a",
      "created_at" : "2020-01-22T15:39:44Z",
      "diff_hunk" : "@@ -974,17 +974,19 @@ void AllocateFileRange(FILE *file, unsigned int offset, unsigned int length) {\n     SetEndOfFile(hFile);\n #elif defined(MAC_OSX)\n     // OSX specific version\n+    // NOTE: Contrary to other OS versions, the OSX version assumes that\n+    // NOTE: offset is the size of the file.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#discussion_r369635091",
      "id" : 369635091,
      "in_reply_to_id" : 366831506,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTYzNTA5MQ==",
      "original_commit_id" : "75163f4729c10c40d2843da28a8c79ab89193f6a",
      "original_position" : 5,
      "path" : "src/util/system.cpp",
      "position" : 5,
      "pull_request_review_id" : 346685674,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17887",
      "updated_at" : "2020-01-22T15:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/369635091",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "code review ACK 75163f4729c10c40d2843da28a8c79ab89193f6a\r\nI have checked  [the documentation](https://developer.apple.com/library/archive/documentation/System/Conceptual/ManPages_iPhoneOS/man2/fcntl.2.html) that the new use of `F_PREALLOCATE` is correct (and the old one is wrong).\r\n\r\nThanks everyone for testing!",
      "created_at" : "2020-01-22T15:46:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-577249108",
      "id" : 577249108,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NzI0OTEwOA==",
      "updated_at" : "2020-01-22T15:46:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/577249108",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Being backported to 0.19 in #17988.",
      "created_at" : "2020-01-23T00:42:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-577453618",
      "id" : 577453618,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NzQ1MzYxOA==",
      "updated_at" : "2020-01-23T00:42:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/577453618",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Apple responded to my bug report regarding this, in case people are curious: https://openradar.appspot.com/radar?id=4930713610616832",
      "created_at" : "2020-09-02T04:01:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17887#issuecomment-685278688",
      "id" : 685278688,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17887",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NTI3ODY4OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-02T04:01:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/685278688",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   }
]
