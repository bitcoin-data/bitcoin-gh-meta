{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "Fixes #17603 (together with #17824)\r\n\r\n`getbalances` is using the cache within `GetAvailableCredit` under certain conditions [here](https://github.com/bitcoin/bitcoin/blob/35fff5be60e853455abc24713481544e91adfedb/src/wallet/wallet.cpp#L1826). For a wallet with `avoid_reuse` activated this can lead to inconsistent reporting of `used` transactions/balances between `getbalances` and `listunspent` as pointed out in #17603. When an address is reused before the first transaction is spending from this address, the cache is not updated even after the transaction is sent. This means the remaining outputs at the reused address are not showing up as `used` in `getbalances`.\r\n\r\nWith this change, any newly incoming transaction belonging to the wallet marks all the other outputs at the same address as dirty.",
   "closed_at" : "2020-01-15T09:11:57Z",
   "closed_by" : {
      "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
      "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
      "followers_url" : "https://api.github.com/users/meshcollider/followers",
      "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
      "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/meshcollider",
      "id" : 3211283,
      "login" : "meshcollider",
      "node_id" : "MDQ6VXNlcjMyMTEyODM=",
      "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
      "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
      "repos_url" : "https://api.github.com/users/meshcollider/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/meshcollider"
   },
   "comments" : 17,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17843/comments",
   "created_at" : "2020-01-02T00:50:16Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17843/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/17843",
   "id" : 544417317,
   "labels" : [
      {
         "color" : "08a781",
         "default" : false,
         "description" : null,
         "id" : 149424,
         "name" : "Wallet",
         "node_id" : "MDU6TGFiZWwxNDk0MjQ=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17843/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDExOlB1bGxSZXF1ZXN0MzU4NTMwODk2",
   "number" : 17843,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/17843.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17843",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/17843.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17843"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "wallet: Reset reused transactions cache",
   "updated_at" : "2020-01-15T09:11:58Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17843",
   "user" : {
      "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
      "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
      "followers_url" : "https://api.github.com/users/fjahr/followers",
      "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
      "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/fjahr",
      "id" : 1322187,
      "login" : "fjahr",
      "node_id" : "MDQ6VXNlcjEzMjIxODc=",
      "organizations_url" : "https://api.github.com/users/fjahr/orgs",
      "received_events_url" : "https://api.github.com/users/fjahr/received_events",
      "repos_url" : "https://api.github.com/users/fjahr/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/fjahr"
   }
}
