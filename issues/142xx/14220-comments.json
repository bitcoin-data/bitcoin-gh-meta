[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->No more conflicts as of last run.",
      "created_at" : "2018-09-15T12:46:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#issuecomment-421565005",
      "id" : 421565005,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14220",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyMTU2NTAwNQ==",
      "updated_at" : "2018-10-09T04:26:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/421565005",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "concept ACK",
      "created_at" : "2018-09-16T07:15:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#issuecomment-421713958",
      "id" : 421713958,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14220",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyMTcxMzk1OA==",
      "updated_at" : "2018-09-16T07:15:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/421713958",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r217916417"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217916417"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: Comment doesn't seem to match the assert. Could just add...\r\n```\r\nassert_equal(len(self.nodes[0].listunspent()), 1)\r\n```",
      "commit_id" : "de9662b7b8e578d31401412e821c2d910d9ea80a",
      "created_at" : "2018-09-16T14:36:09Z",
      "diff_hunk" : "@@ -0,0 +1,80 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2018 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test relay of transaction chains.\n+\n+Ensure that if bitcoind announces a transaction it will also respond\n+to getdata requests for parents of the transaction.\n+\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    connect_nodes,\n+    disconnect_nodes,\n+    sync_blocks\n+)\n+\n+class ChainRelayTest(BitcoinTestFramework):\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.log.info(\"Generating one utxo for node0\")\n+\n+        self.nodes[0].generate(1)\n+        self.sync_all()\n+        self.nodes[1].generate(100)\n+        self.sync_all()\n+\n+        # Node0 should now have 1 utxo.\n+        assert self.nodes[0].getbalance() > 10 # Should be 50, but doesn't matter",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r217916417",
      "id" : 217916417,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNzkxNjQxNw==",
      "original_commit_id" : "ba6c0a16868163e0c42927e7593b3596037df520",
      "original_position" : 37,
      "path" : "test/functional/p2p_txchain_relay.py",
      "position" : null,
      "pull_request_review_id" : 155747119,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220",
      "updated_at" : "2018-10-09T03:05:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217916417",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/14220652?v=4",
         "events_url" : "https://api.github.com/users/conscott/events{/privacy}",
         "followers_url" : "https://api.github.com/users/conscott/followers",
         "following_url" : "https://api.github.com/users/conscott/following{/other_user}",
         "gists_url" : "https://api.github.com/users/conscott/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/conscott",
         "id" : 14220652,
         "login" : "conscott",
         "node_id" : "MDQ6VXNlcjE0MjIwNjUy",
         "organizations_url" : "https://api.github.com/users/conscott/orgs",
         "received_events_url" : "https://api.github.com/users/conscott/received_events",
         "repos_url" : "https://api.github.com/users/conscott/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/conscott/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/conscott/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/conscott"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Tested ACK b723d95fa08c8058f4ab32cdd5329b4df3aac036",
      "created_at" : "2018-09-16T15:17:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#issuecomment-421781112",
      "id" : 421781112,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14220",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyMTc4MTExMg==",
      "updated_at" : "2018-09-16T15:17:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/421781112",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/14220652?v=4",
         "events_url" : "https://api.github.com/users/conscott/events{/privacy}",
         "followers_url" : "https://api.github.com/users/conscott/followers",
         "following_url" : "https://api.github.com/users/conscott/following{/other_user}",
         "gists_url" : "https://api.github.com/users/conscott/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/conscott",
         "id" : 14220652,
         "login" : "conscott",
         "node_id" : "MDQ6VXNlcjE0MjIwNjUy",
         "organizations_url" : "https://api.github.com/users/conscott/orgs",
         "received_events_url" : "https://api.github.com/users/conscott/received_events",
         "repos_url" : "https://api.github.com/users/conscott/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/conscott/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/conscott/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/conscott"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r217927370"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217927370"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Commit \"Don't relay tx data to peers until after tx announcement\"\r\n\r\nDoesn't seem quite obvious that `std::set` is worst, why did you picked `std::unordered_set`?",
      "commit_id" : "de9662b7b8e578d31401412e821c2d910d9ea80a",
      "created_at" : "2018-09-16T20:50:38Z",
      "diff_hunk" : "@@ -153,7 +154,12 @@ namespace {\n     std::atomic<int64_t> g_last_tip_update(0);\n \n     /** Relay map */\n-    typedef std::map<uint256, CTransactionRef> MapRelay;\n+    struct RelayEntry {\n+        RelayEntry(CTransactionRef &&tx) : m_txref(tx) {}\n+        CTransactionRef m_txref;\n+        std::unordered_set<NodeId> m_node_map;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r217927370",
      "id" : 217927370,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNzkyNzM3MA==",
      "original_commit_id" : "68657b8ae32265d724acdc919784b63030948b8d",
      "original_position" : 16,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 155757673,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220",
      "updated_at" : "2018-10-09T03:05:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217927370",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r217927456"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217927456"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Commit \"Don't relay tx data to peers until after tx announcement\"\r\n\r\nFrom developer notes:\r\n```\r\n- By default, declare single-argument constructors `explicit`.\r\n\r\n  - *Rationale*: This is a precaution to avoid unintended conversions that might\r\n    arise when single-argument constructors are used as implicit conversion\r\n    functions.\r\n```",
      "commit_id" : "de9662b7b8e578d31401412e821c2d910d9ea80a",
      "created_at" : "2018-09-16T20:54:16Z",
      "diff_hunk" : "@@ -153,7 +154,12 @@ namespace {\n     std::atomic<int64_t> g_last_tip_update(0);\n \n     /** Relay map */\n-    typedef std::map<uint256, CTransactionRef> MapRelay;\n+    struct RelayEntry {\n+        RelayEntry(CTransactionRef &&tx) : m_txref(tx) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r217927456",
      "id" : 217927456,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNzkyNzQ1Ng==",
      "original_commit_id" : "68657b8ae32265d724acdc919784b63030948b8d",
      "original_position" : 14,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 155757673,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220",
      "updated_at" : "2018-10-09T03:05:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217927456",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r217927481"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217927481"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Commit \"Don't relay tx data to peers until after tx announcement\"\r\n\r\n~~nit, could use `emplace(k,v)` since you are touching this line.~~\r\n\r\nThis is moved and updated in the next commit.",
      "commit_id" : "de9662b7b8e578d31401412e821c2d910d9ea80a",
      "created_at" : "2018-09-16T20:55:10Z",
      "diff_hunk" : "@@ -3610,7 +3616,10 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n                             vRelayExpiration.pop_front();\n                         }\n \n-                        auto ret = mapRelay.insert(std::make_pair(hash, std::move(txinfo.tx)));\n+                        auto ret = mapRelay.insert(std::make_pair(hash, RelayEntry(std::move(txinfo.tx))));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r217927481",
      "id" : 217927481,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNzkyNzQ4MQ==",
      "original_commit_id" : "68657b8ae32265d724acdc919784b63030948b8d",
      "original_position" : 38,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 155757673,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220",
      "updated_at" : "2018-10-09T03:05:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217927481",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r217927487"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217927487"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Commit \"Don't relay tx data to peers until after tx announcement\"\r\n\r\nnit, s/_map/_set?\r\n",
      "commit_id" : "de9662b7b8e578d31401412e821c2d910d9ea80a",
      "created_at" : "2018-09-16T20:55:31Z",
      "diff_hunk" : "@@ -153,7 +154,12 @@ namespace {\n     std::atomic<int64_t> g_last_tip_update(0);\n \n     /** Relay map */\n-    typedef std::map<uint256, CTransactionRef> MapRelay;\n+    struct RelayEntry {\n+        RelayEntry(CTransactionRef &&tx) : m_txref(tx) {}\n+        CTransactionRef m_txref;\n+        std::unordered_set<NodeId> m_node_map;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r217927487",
      "id" : 217927487,
      "in_reply_to_id" : 217927370,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNzkyNzQ4Nw==",
      "original_commit_id" : "68657b8ae32265d724acdc919784b63030948b8d",
      "original_position" : 16,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 155757673,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220",
      "updated_at" : "2018-10-09T03:05:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217927487",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r217927530"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217927530"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Commit \"Add ancestors of announced transactions to mapRelay\"\r\n\r\nnit, could drop `std::make_pair`.",
      "commit_id" : "de9662b7b8e578d31401412e821c2d910d9ea80a",
      "created_at" : "2018-09-16T20:57:28Z",
      "diff_hunk" : "@@ -164,6 +164,18 @@ namespace {\n     /** Expiration-time ordered list of (expire time, relay map entry) pairs. */\n     std::deque<std::pair<int64_t, MapRelay::iterator>> vRelayExpiration GUARDED_BY(cs_main);\n \n+    void AddToMapRelay(CTransactionRef &&txref, NodeId peer, int64_t time_now) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+    {\n+        const uint256& hash = txref->GetHash();\n+        auto ret = mapRelay.emplace(std::make_pair(hash, RelayEntry(std::move(txref))));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r217927530",
      "id" : 217927530,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNzkyNzUzMA==",
      "original_commit_id" : "3c227a6bf97076da449cb956c894b3e0b01e6735",
      "original_position" : 7,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 155757673,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220",
      "updated_at" : "2018-10-09T03:05:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217927530",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK. I wrote a test in  #14240 that should only pass with your first commit.",
      "created_at" : "2018-09-18T20:40:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#issuecomment-422545832",
      "id" : 422545832,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14220",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyMjU0NTgzMg==",
      "updated_at" : "2018-09-18T20:40:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/422545832",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r219679799"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219679799"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```\r\n2018-09-22 21:02:10 cpplint(pr=14220): src/net_processing.cpp:158:  Single-parameter constructors should be marked explicit.  [runtime/explicit] [5]\r\n```",
      "commit_id" : "de9662b7b8e578d31401412e821c2d910d9ea80a",
      "created_at" : "2018-09-22T19:04:41Z",
      "diff_hunk" : "@@ -153,11 +154,28 @@ namespace {\n     std::atomic<int64_t> g_last_tip_update(0);\n \n     /** Relay map */\n-    typedef std::map<uint256, CTransactionRef> MapRelay;\n+    struct RelayEntry {\n+        RelayEntry(CTransactionRef &&tx) : m_txref(tx) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r219679799",
      "id" : 219679799,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTY3OTc5OQ==",
      "original_commit_id" : "b723d95fa08c8058f4ab32cdd5329b4df3aac036",
      "original_position" : 14,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 157919312,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220",
      "updated_at" : "2018-10-09T03:05:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219679799",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sdaftuar Do you feel like splitting this up? I believe one of the fixes is a bugfix, the other a feature.",
      "created_at" : "2018-09-24T19:29:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#issuecomment-424096098",
      "id" : 424096098,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14220",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyNDA5NjA5OA==",
      "updated_at" : "2018-09-24T19:29:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/424096098",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r219968248"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219968248"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Constant time lookup seemed better to me than log_n lookup but I dunno, is there a reason you think std::set is better here?  I suspect it doesn't really matter.",
      "commit_id" : "de9662b7b8e578d31401412e821c2d910d9ea80a",
      "created_at" : "2018-09-24T19:56:56Z",
      "diff_hunk" : "@@ -153,7 +154,12 @@ namespace {\n     std::atomic<int64_t> g_last_tip_update(0);\n \n     /** Relay map */\n-    typedef std::map<uint256, CTransactionRef> MapRelay;\n+    struct RelayEntry {\n+        RelayEntry(CTransactionRef &&tx) : m_txref(tx) {}\n+        CTransactionRef m_txref;\n+        std::unordered_set<NodeId> m_node_map;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r219968248",
      "id" : 219968248,
      "in_reply_to_id" : 217927370,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTk2ODI0OA==",
      "original_commit_id" : "68657b8ae32265d724acdc919784b63030948b8d",
      "original_position" : 16,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 158269506,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220",
      "updated_at" : "2018-10-09T03:05:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219968248",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke This PR is now just the bugfix along with the test you wrote (thanks!), I'll separately PR the new feature.\r\n\r\nI believe I've also incorporated all the PR comments that are relevant for the bugfix commit.",
      "created_at" : "2018-09-25T12:06:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#issuecomment-424316233",
      "id" : 424316233,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14220",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyNDMxNjIzMw==",
      "updated_at" : "2018-09-25T12:06:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/424316233",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Tested ACK 736462c26de7a267bdf75c1f86bf12932c604b3d (I wrote the test, that fails without this patch)",
      "created_at" : "2018-09-25T17:51:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#issuecomment-424439341",
      "id" : 424439341,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14220",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyNDQzOTM0MQ==",
      "updated_at" : "2018-09-25T17:51:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/424439341",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Is this for backport?",
      "created_at" : "2018-09-25T17:56:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#issuecomment-424441006",
      "id" : 424441006,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14220",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyNDQ0MTAwNg==",
      "updated_at" : "2018-09-25T17:56:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/424441006",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I don't think we need to backport this (in particular I wouldn't want to interfere with the 0.17.0 release), as the bug has been present for so long, there's no urgency.  And I tend to think that changes like this to the p2p behavior are better to sit in master for a while before appearing in a release anyway.\r\n\r\nAny idea what is going on with the appveyor test run?",
      "created_at" : "2018-09-25T18:07:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#issuecomment-424444818",
      "id" : 424444818,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14220",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyNDQ0NDgxOA==",
      "updated_at" : "2018-09-25T18:07:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/424444818",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I guess it's worth pointing out as well, that this change without the improvement in #14318 may well worsen relay of transactions that are part of chains a bit.  For instance, if a peer of ours asks for the parent of a transaction we announced, then as long as that parent is in mapRelay -- ie it was recently announced -- then we'd provide it, even if that peer wasn't connected to us at the time the parent transaction was announced.\r\n\r\nI have no idea how common that sort of thing is, but rather than spend too much time wondering about it, I'd say it's better to not backport this change (and arguably I shouldn't have unbundled this PR from #14318).",
      "created_at" : "2018-09-25T18:42:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#issuecomment-424456193",
      "id" : 424456193,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14220",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyNDQ1NjE5Mw==",
      "updated_at" : "2018-09-25T18:42:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/424456193",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK https://github.com/bitcoin/bitcoin/pull/14220/commits/736462c26de7a267bdf75c1f86bf12932c604b3d\r\n\r\nIn plain English, I'd characterize this change as \"don't respond to a GETDATA(txn) for a peer who you haven't previously sent INV(txn).\"",
      "created_at" : "2018-09-26T19:13:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#issuecomment-424836172",
      "id" : 424836172,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14220",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyNDgzNjE3Mg==",
      "updated_at" : "2018-09-26T19:13:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/424836172",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r220690123"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220690123"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: distribuiton (spelling)",
      "commit_id" : "de9662b7b8e578d31401412e821c2d910d9ea80a",
      "created_at" : "2018-09-26T19:16:12Z",
      "diff_hunk" : "@@ -0,0 +1,89 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2018 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that we don't leak txs to inbound peers that we haven't yet announced to\"\"\"\n+\n+from test_framework.messages import msg_getdata, CInv\n+from test_framework.mininode import mininode_lock, P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than,\n+    wait_until,\n+)\n+\n+\n+class P2PLeakTxTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        gen_node = self.nodes[0]  # The block and tx generating node\n+        gen_node.generate(1)\n+        self.sync_all()\n+\n+        inbound_peer = self.nodes[0].add_p2p_connection(P2PDataStore())  # An \"attacking\" inbound peer\n+        outbound_peer = self.nodes[1]  # Our outbound peer\n+\n+        # In an adversiarial setting we can generally assume that inbound peers\n+        # are more likely to spy on us than outbound peers. Thus, on average,\n+        # we announce transactions first to outbound peers, then to (all)\n+        # inbound peers. Inbound peers must not be able to request the\n+        # transaction they haven't yet received the announcement for it.\n+        #\n+        # With only one outbound peer, we expect that a tx is first announced\n+        # to (all) inbound peers (and thus present a potential leak) in 28.5% of\n+        # the cases.\n+        #\n+        # Probability( time_ann_inbound < time_ann_outbound )                 =\n+        # Ã¢ÂÂ« f_in(x)                           * F_out(x)                   dx =\n+        # Ã¢ÂÂ« (lambda_in * exp(-lambda_in * x)) * (1 - exp(-lambda_out * x)) dx =\n+        # 0.285714\n+        #\n+        # Where,\n+        # * f_in is the pdf of the exponential distribution for inbound peers,\n+        #   with lambda_in = 1 / INVENTORY_BROADCAST_INTERVAL = 1/5\n+        # * F_out is the cdf of the expon. distribuiton for outbound peers,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r220690123",
      "id" : 220690123,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMDY5MDEyMw==",
      "original_commit_id" : "736462c26de7a267bdf75c1f86bf12932c604b3d",
      "original_position" : 50,
      "path" : "test/functional/p2p_leak_tx.py",
      "position" : null,
      "pull_request_review_id" : 159156936,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220",
      "updated_at" : "2018-10-09T03:05:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220690123",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r220690330"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220690330"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This test, being stochastic, looks like it'll fail spuriously. I guess it if happens too often, we can up `REPEATS` or something.",
      "commit_id" : "de9662b7b8e578d31401412e821c2d910d9ea80a",
      "created_at" : "2018-09-26T19:16:55Z",
      "diff_hunk" : "@@ -0,0 +1,89 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2018 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that we don't leak txs to inbound peers that we haven't yet announced to\"\"\"\n+\n+from test_framework.messages import msg_getdata, CInv\n+from test_framework.mininode import mininode_lock, P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than,\n+    wait_until,\n+)\n+\n+\n+class P2PLeakTxTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        gen_node = self.nodes[0]  # The block and tx generating node\n+        gen_node.generate(1)\n+        self.sync_all()\n+\n+        inbound_peer = self.nodes[0].add_p2p_connection(P2PDataStore())  # An \"attacking\" inbound peer\n+        outbound_peer = self.nodes[1]  # Our outbound peer\n+\n+        # In an adversiarial setting we can generally assume that inbound peers\n+        # are more likely to spy on us than outbound peers. Thus, on average,\n+        # we announce transactions first to outbound peers, then to (all)\n+        # inbound peers. Inbound peers must not be able to request the\n+        # transaction they haven't yet received the announcement for it.\n+        #\n+        # With only one outbound peer, we expect that a tx is first announced\n+        # to (all) inbound peers (and thus present a potential leak) in 28.5% of\n+        # the cases.\n+        #\n+        # Probability( time_ann_inbound < time_ann_outbound )                 =\n+        # Ã¢ÂÂ« f_in(x)                           * F_out(x)                   dx =\n+        # Ã¢ÂÂ« (lambda_in * exp(-lambda_in * x)) * (1 - exp(-lambda_out * x)) dx =\n+        # 0.285714\n+        #\n+        # Where,\n+        # * f_in is the pdf of the exponential distribution for inbound peers,\n+        #   with lambda_in = 1 / INVENTORY_BROADCAST_INTERVAL = 1/5\n+        # * F_out is the cdf of the expon. distribuiton for outbound peers,\n+        #   with lambda_out = 1 / (INVENTORY_BROADCAST_INTERVAL >> 1) = 1/2\n+        #\n+        # Due to measurement delays, the actual monte-carlo leak is a bit\n+        # higher. Assume a total delay of 0.6 s (Includes network delays and\n+        # rpc delay to poll the raw mempool)\n+        #\n+        # Probability( time_ann_inbound < time_ann_outbound + 0.6 )           =\n+        # Ã¢ÂÂ« f_in(x)                           * F_out(x + 0.6)             dx =\n+        # Ã¢ÂÂ« (lambda_in * exp(-lambda_in * x)) * (1 - exp(-lambda_out * (x+.6))) dx =\n+        # 0.366485\n+        EXPECTED_MEASURED_LEAK = .366485\n+\n+        REPEATS = 100\n+        measured_leak = 0\n+        self.log.info('Start simulation for {} repeats'.format(REPEATS))\n+        for i in range(REPEATS):\n+            self.log.debug('Run {}/{}'.format(i, REPEATS))\n+            txid = gen_node.sendtoaddress(gen_node.getnewaddress(), 0.033)\n+            want_tx = msg_getdata()\n+            want_tx.inv.append(CInv(t=1, h=int(txid, 16)))\n+\n+            wait_until(lambda: txid in outbound_peer.getrawmempool(), lock=mininode_lock)\n+            inbound_peer.send_message(want_tx)\n+            inbound_peer.sync_with_ping()\n+\n+            if inbound_peer.last_message.get('notfound'):\n+                assert_equal(inbound_peer.last_message['notfound'].vec[0].hash, int(txid, 16))\n+                inbound_peer.last_message.pop('notfound')\n+            else:\n+                measured_leak += 1\n+\n+        measured_leak /= REPEATS\n+        self.log.info('Measured leak of {}'.format(measured_leak))\n+\n+        assert_greater_than(EXPECTED_MEASURED_LEAK, measured_leak)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r220690330",
      "id" : 220690330,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMDY5MDMzMA==",
      "original_commit_id" : "736462c26de7a267bdf75c1f86bf12932c604b3d",
      "original_position" : 85,
      "path" : "test/functional/p2p_leak_tx.py",
      "position" : null,
      "pull_request_review_id" : 159156936,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220",
      "updated_at" : "2018-10-09T03:05:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220690330",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r220694414"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220694414"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Someone could run it for 1000 times and see if it fails at all\r\n\r\n```\r\n./test/functional/test_runner.py -j 15 $(for i in {0..999}; do echo p2p_leak_tx ; done)",
      "commit_id" : "de9662b7b8e578d31401412e821c2d910d9ea80a",
      "created_at" : "2018-09-26T19:30:31Z",
      "diff_hunk" : "@@ -0,0 +1,89 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2018 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that we don't leak txs to inbound peers that we haven't yet announced to\"\"\"\n+\n+from test_framework.messages import msg_getdata, CInv\n+from test_framework.mininode import mininode_lock, P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than,\n+    wait_until,\n+)\n+\n+\n+class P2PLeakTxTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        gen_node = self.nodes[0]  # The block and tx generating node\n+        gen_node.generate(1)\n+        self.sync_all()\n+\n+        inbound_peer = self.nodes[0].add_p2p_connection(P2PDataStore())  # An \"attacking\" inbound peer\n+        outbound_peer = self.nodes[1]  # Our outbound peer\n+\n+        # In an adversiarial setting we can generally assume that inbound peers\n+        # are more likely to spy on us than outbound peers. Thus, on average,\n+        # we announce transactions first to outbound peers, then to (all)\n+        # inbound peers. Inbound peers must not be able to request the\n+        # transaction they haven't yet received the announcement for it.\n+        #\n+        # With only one outbound peer, we expect that a tx is first announced\n+        # to (all) inbound peers (and thus present a potential leak) in 28.5% of\n+        # the cases.\n+        #\n+        # Probability( time_ann_inbound < time_ann_outbound )                 =\n+        # Ã¢ÂÂ« f_in(x)                           * F_out(x)                   dx =\n+        # Ã¢ÂÂ« (lambda_in * exp(-lambda_in * x)) * (1 - exp(-lambda_out * x)) dx =\n+        # 0.285714\n+        #\n+        # Where,\n+        # * f_in is the pdf of the exponential distribution for inbound peers,\n+        #   with lambda_in = 1 / INVENTORY_BROADCAST_INTERVAL = 1/5\n+        # * F_out is the cdf of the expon. distribuiton for outbound peers,\n+        #   with lambda_out = 1 / (INVENTORY_BROADCAST_INTERVAL >> 1) = 1/2\n+        #\n+        # Due to measurement delays, the actual monte-carlo leak is a bit\n+        # higher. Assume a total delay of 0.6 s (Includes network delays and\n+        # rpc delay to poll the raw mempool)\n+        #\n+        # Probability( time_ann_inbound < time_ann_outbound + 0.6 )           =\n+        # Ã¢ÂÂ« f_in(x)                           * F_out(x + 0.6)             dx =\n+        # Ã¢ÂÂ« (lambda_in * exp(-lambda_in * x)) * (1 - exp(-lambda_out * (x+.6))) dx =\n+        # 0.366485\n+        EXPECTED_MEASURED_LEAK = .366485\n+\n+        REPEATS = 100\n+        measured_leak = 0\n+        self.log.info('Start simulation for {} repeats'.format(REPEATS))\n+        for i in range(REPEATS):\n+            self.log.debug('Run {}/{}'.format(i, REPEATS))\n+            txid = gen_node.sendtoaddress(gen_node.getnewaddress(), 0.033)\n+            want_tx = msg_getdata()\n+            want_tx.inv.append(CInv(t=1, h=int(txid, 16)))\n+\n+            wait_until(lambda: txid in outbound_peer.getrawmempool(), lock=mininode_lock)\n+            inbound_peer.send_message(want_tx)\n+            inbound_peer.sync_with_ping()\n+\n+            if inbound_peer.last_message.get('notfound'):\n+                assert_equal(inbound_peer.last_message['notfound'].vec[0].hash, int(txid, 16))\n+                inbound_peer.last_message.pop('notfound')\n+            else:\n+                measured_leak += 1\n+\n+        measured_leak /= REPEATS\n+        self.log.info('Measured leak of {}'.format(measured_leak))\n+\n+        assert_greater_than(EXPECTED_MEASURED_LEAK, measured_leak)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r220694414",
      "id" : 220694414,
      "in_reply_to_id" : 220690330,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMDY5NDQxNA==",
      "original_commit_id" : "736462c26de7a267bdf75c1f86bf12932c604b3d",
      "original_position" : 85,
      "path" : "test/functional/p2p_leak_tx.py",
      "position" : null,
      "pull_request_review_id" : 159162303,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220",
      "updated_at" : "2018-10-09T03:05:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220694414",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r220710702"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220710702"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I dunno too. Considering the size is small I agree it doesn't matter.",
      "commit_id" : "de9662b7b8e578d31401412e821c2d910d9ea80a",
      "created_at" : "2018-09-26T20:25:05Z",
      "diff_hunk" : "@@ -153,7 +154,12 @@ namespace {\n     std::atomic<int64_t> g_last_tip_update(0);\n \n     /** Relay map */\n-    typedef std::map<uint256, CTransactionRef> MapRelay;\n+    struct RelayEntry {\n+        RelayEntry(CTransactionRef &&tx) : m_txref(tx) {}\n+        CTransactionRef m_txref;\n+        std::unordered_set<NodeId> m_node_map;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r220710702",
      "id" : 220710702,
      "in_reply_to_id" : 217927370,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMDcxMDcwMg==",
      "original_commit_id" : "68657b8ae32265d724acdc919784b63030948b8d",
      "original_position" : 16,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 159182753,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220",
      "updated_at" : "2018-10-09T03:05:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/220710702",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2018-09-27T15:34:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#issuecomment-425138689",
      "id" : 425138689,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14220",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyNTEzODY4OQ==",
      "updated_at" : "2018-09-27T15:34:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/425138689",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r221013286"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/221013286"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Looks like it fails about 9% of the time for me. :(",
      "commit_id" : "de9662b7b8e578d31401412e821c2d910d9ea80a",
      "created_at" : "2018-09-27T17:36:49Z",
      "diff_hunk" : "@@ -0,0 +1,89 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2018 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that we don't leak txs to inbound peers that we haven't yet announced to\"\"\"\n+\n+from test_framework.messages import msg_getdata, CInv\n+from test_framework.mininode import mininode_lock, P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than,\n+    wait_until,\n+)\n+\n+\n+class P2PLeakTxTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        gen_node = self.nodes[0]  # The block and tx generating node\n+        gen_node.generate(1)\n+        self.sync_all()\n+\n+        inbound_peer = self.nodes[0].add_p2p_connection(P2PDataStore())  # An \"attacking\" inbound peer\n+        outbound_peer = self.nodes[1]  # Our outbound peer\n+\n+        # In an adversiarial setting we can generally assume that inbound peers\n+        # are more likely to spy on us than outbound peers. Thus, on average,\n+        # we announce transactions first to outbound peers, then to (all)\n+        # inbound peers. Inbound peers must not be able to request the\n+        # transaction they haven't yet received the announcement for it.\n+        #\n+        # With only one outbound peer, we expect that a tx is first announced\n+        # to (all) inbound peers (and thus present a potential leak) in 28.5% of\n+        # the cases.\n+        #\n+        # Probability( time_ann_inbound < time_ann_outbound )                 =\n+        # Ã¢ÂÂ« f_in(x)                           * F_out(x)                   dx =\n+        # Ã¢ÂÂ« (lambda_in * exp(-lambda_in * x)) * (1 - exp(-lambda_out * x)) dx =\n+        # 0.285714\n+        #\n+        # Where,\n+        # * f_in is the pdf of the exponential distribution for inbound peers,\n+        #   with lambda_in = 1 / INVENTORY_BROADCAST_INTERVAL = 1/5\n+        # * F_out is the cdf of the expon. distribuiton for outbound peers,\n+        #   with lambda_out = 1 / (INVENTORY_BROADCAST_INTERVAL >> 1) = 1/2\n+        #\n+        # Due to measurement delays, the actual monte-carlo leak is a bit\n+        # higher. Assume a total delay of 0.6 s (Includes network delays and\n+        # rpc delay to poll the raw mempool)\n+        #\n+        # Probability( time_ann_inbound < time_ann_outbound + 0.6 )           =\n+        # Ã¢ÂÂ« f_in(x)                           * F_out(x + 0.6)             dx =\n+        # Ã¢ÂÂ« (lambda_in * exp(-lambda_in * x)) * (1 - exp(-lambda_out * (x+.6))) dx =\n+        # 0.366485\n+        EXPECTED_MEASURED_LEAK = .366485\n+\n+        REPEATS = 100\n+        measured_leak = 0\n+        self.log.info('Start simulation for {} repeats'.format(REPEATS))\n+        for i in range(REPEATS):\n+            self.log.debug('Run {}/{}'.format(i, REPEATS))\n+            txid = gen_node.sendtoaddress(gen_node.getnewaddress(), 0.033)\n+            want_tx = msg_getdata()\n+            want_tx.inv.append(CInv(t=1, h=int(txid, 16)))\n+\n+            wait_until(lambda: txid in outbound_peer.getrawmempool(), lock=mininode_lock)\n+            inbound_peer.send_message(want_tx)\n+            inbound_peer.sync_with_ping()\n+\n+            if inbound_peer.last_message.get('notfound'):\n+                assert_equal(inbound_peer.last_message['notfound'].vec[0].hash, int(txid, 16))\n+                inbound_peer.last_message.pop('notfound')\n+            else:\n+                measured_leak += 1\n+\n+        measured_leak /= REPEATS\n+        self.log.info('Measured leak of {}'.format(measured_leak))\n+\n+        assert_greater_than(EXPECTED_MEASURED_LEAK, measured_leak)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r221013286",
      "id" : 221013286,
      "in_reply_to_id" : 220690330,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMTAxMzI4Ng==",
      "original_commit_id" : "736462c26de7a267bdf75c1f86bf12932c604b3d",
      "original_position" : 85,
      "path" : "test/functional/p2p_leak_tx.py",
      "position" : null,
      "pull_request_review_id" : 159560141,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220",
      "updated_at" : "2018-10-09T03:05:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/221013286",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased, but I think we need to adjust the test so that it has a drastically lower error rate, or drop it from this PR.  @MarcoFalke thoughts?",
      "created_at" : "2018-09-27T18:04:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#issuecomment-425188679",
      "id" : 425188679,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14220",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyNTE4ODY3OQ==",
      "updated_at" : "2018-09-27T18:04:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/425188679",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r221118923"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/221118923"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: unrelated change?",
      "commit_id" : "de9662b7b8e578d31401412e821c2d910d9ea80a",
      "created_at" : "2018-09-28T01:09:11Z",
      "diff_hunk" : "@@ -1232,7 +1232,27 @@ def __repr__(self):\n         return \"msg_mempool()\"\n \n \n-class msg_sendheaders:\n+class msg_notfound():\n+    __slots__ = (\"vec\")\n+    command = b\"notfound\"\n+\n+    def __init__(self, vec=None):\n+        if vec is None:\n+            self.vec = []\n+        else:\n+            self.vec = vec\n+\n+    def deserialize(self, f):\n+        self.vec = deser_vector(f, CInv)\n+\n+    def serialize(self):\n+        return ser_vector(self.vec)\n+\n+    def __repr__(self):\n+        return \"msg_notfound(vec=%s)\" % (repr(self.vec))\n+\n+\n+class msg_sendheaders():",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r221118923",
      "id" : 221118923,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMTExODkyMw==",
      "original_commit_id" : "47bf6e9622101181ca6d0ec60985fd683c17704c",
      "original_position" : 25,
      "path" : "test/functional/test_framework/messages.py",
      "position" : null,
      "pull_request_review_id" : 159692379,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220",
      "updated_at" : "2018-10-09T03:05:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/221118923",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r221133435"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/221133435"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sorry for that. I haven't actually run the test substantially after writing. I seems you could set `        EXPECTED_MEASURED_LEAK = .42` or so without making the test useless. (On master the leak is always 1.00, so setting the expected measured leak to any number less than 1 should be fine)\r\n\r\n![figure_1](https://user-images.githubusercontent.com/6399679/46206730-f3070d80-c2f2-11e8-8bb5-1e51e6870619.png)\r\n(measured leak on x-axis)\r\n",
      "commit_id" : "de9662b7b8e578d31401412e821c2d910d9ea80a",
      "created_at" : "2018-09-28T03:28:01Z",
      "diff_hunk" : "@@ -0,0 +1,89 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2018 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that we don't leak txs to inbound peers that we haven't yet announced to\"\"\"\n+\n+from test_framework.messages import msg_getdata, CInv\n+from test_framework.mininode import mininode_lock, P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than,\n+    wait_until,\n+)\n+\n+\n+class P2PLeakTxTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        gen_node = self.nodes[0]  # The block and tx generating node\n+        gen_node.generate(1)\n+        self.sync_all()\n+\n+        inbound_peer = self.nodes[0].add_p2p_connection(P2PDataStore())  # An \"attacking\" inbound peer\n+        outbound_peer = self.nodes[1]  # Our outbound peer\n+\n+        # In an adversiarial setting we can generally assume that inbound peers\n+        # are more likely to spy on us than outbound peers. Thus, on average,\n+        # we announce transactions first to outbound peers, then to (all)\n+        # inbound peers. Inbound peers must not be able to request the\n+        # transaction they haven't yet received the announcement for it.\n+        #\n+        # With only one outbound peer, we expect that a tx is first announced\n+        # to (all) inbound peers (and thus present a potential leak) in 28.5% of\n+        # the cases.\n+        #\n+        # Probability( time_ann_inbound < time_ann_outbound )                 =\n+        # Ã¢ÂÂ« f_in(x)                           * F_out(x)                   dx =\n+        # Ã¢ÂÂ« (lambda_in * exp(-lambda_in * x)) * (1 - exp(-lambda_out * x)) dx =\n+        # 0.285714\n+        #\n+        # Where,\n+        # * f_in is the pdf of the exponential distribution for inbound peers,\n+        #   with lambda_in = 1 / INVENTORY_BROADCAST_INTERVAL = 1/5\n+        # * F_out is the cdf of the expon. distribuiton for outbound peers,\n+        #   with lambda_out = 1 / (INVENTORY_BROADCAST_INTERVAL >> 1) = 1/2\n+        #\n+        # Due to measurement delays, the actual monte-carlo leak is a bit\n+        # higher. Assume a total delay of 0.6 s (Includes network delays and\n+        # rpc delay to poll the raw mempool)\n+        #\n+        # Probability( time_ann_inbound < time_ann_outbound + 0.6 )           =\n+        # Ã¢ÂÂ« f_in(x)                           * F_out(x + 0.6)             dx =\n+        # Ã¢ÂÂ« (lambda_in * exp(-lambda_in * x)) * (1 - exp(-lambda_out * (x+.6))) dx =\n+        # 0.366485\n+        EXPECTED_MEASURED_LEAK = .366485\n+\n+        REPEATS = 100\n+        measured_leak = 0\n+        self.log.info('Start simulation for {} repeats'.format(REPEATS))\n+        for i in range(REPEATS):\n+            self.log.debug('Run {}/{}'.format(i, REPEATS))\n+            txid = gen_node.sendtoaddress(gen_node.getnewaddress(), 0.033)\n+            want_tx = msg_getdata()\n+            want_tx.inv.append(CInv(t=1, h=int(txid, 16)))\n+\n+            wait_until(lambda: txid in outbound_peer.getrawmempool(), lock=mininode_lock)\n+            inbound_peer.send_message(want_tx)\n+            inbound_peer.sync_with_ping()\n+\n+            if inbound_peer.last_message.get('notfound'):\n+                assert_equal(inbound_peer.last_message['notfound'].vec[0].hash, int(txid, 16))\n+                inbound_peer.last_message.pop('notfound')\n+            else:\n+                measured_leak += 1\n+\n+        measured_leak /= REPEATS\n+        self.log.info('Measured leak of {}'.format(measured_leak))\n+\n+        assert_greater_than(EXPECTED_MEASURED_LEAK, measured_leak)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r221133435",
      "id" : 221133435,
      "in_reply_to_id" : 220690330,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMTEzMzQzNQ==",
      "original_commit_id" : "736462c26de7a267bdf75c1f86bf12932c604b3d",
      "original_position" : 85,
      "path" : "test/functional/p2p_leak_tx.py",
      "position" : null,
      "pull_request_review_id" : 159692379,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220",
      "updated_at" : "2018-10-09T03:05:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/221133435",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--32850dd3fdea838b4049e64f46995ea2-->\n| Coverage  | Change ([pull 14220](https://drahtbot.github.io/reports/coverage/bitcoin/bitcoin/14220/total.coverage/index.html)) | Reference ([master](https://drahtbot.github.io/reports/coverage/bitcoin/bitcoin/master/total.coverage/index.html))   |\n|-----------|-------------------------|--------------------|\n| Lines     | +0.0094 %            | 87.0361 %        |\n| Functions | -0.0130 %            | 84.1130 %        |\n| Branches  | +0.0047 %            | 51.5451 %        |\n",
      "created_at" : "2018-09-28T10:49:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#issuecomment-425398442",
      "id" : 425398442,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14220",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyNTM5ODQ0Mg==",
      "updated_at" : "2018-09-28T10:49:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/425398442",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r221381012"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/221381012"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I bumped it up to 0.45, and it failed once in 1000 runs, so i bumped it up to 0.50 and ran it 5000 times with no failures.  I have not really looked at the test or analyzed the statistics at all to verify that this makes sense.",
      "commit_id" : "de9662b7b8e578d31401412e821c2d910d9ea80a",
      "created_at" : "2018-09-28T21:04:03Z",
      "diff_hunk" : "@@ -0,0 +1,89 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2018 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that we don't leak txs to inbound peers that we haven't yet announced to\"\"\"\n+\n+from test_framework.messages import msg_getdata, CInv\n+from test_framework.mininode import mininode_lock, P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than,\n+    wait_until,\n+)\n+\n+\n+class P2PLeakTxTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        gen_node = self.nodes[0]  # The block and tx generating node\n+        gen_node.generate(1)\n+        self.sync_all()\n+\n+        inbound_peer = self.nodes[0].add_p2p_connection(P2PDataStore())  # An \"attacking\" inbound peer\n+        outbound_peer = self.nodes[1]  # Our outbound peer\n+\n+        # In an adversiarial setting we can generally assume that inbound peers\n+        # are more likely to spy on us than outbound peers. Thus, on average,\n+        # we announce transactions first to outbound peers, then to (all)\n+        # inbound peers. Inbound peers must not be able to request the\n+        # transaction they haven't yet received the announcement for it.\n+        #\n+        # With only one outbound peer, we expect that a tx is first announced\n+        # to (all) inbound peers (and thus present a potential leak) in 28.5% of\n+        # the cases.\n+        #\n+        # Probability( time_ann_inbound < time_ann_outbound )                 =\n+        # Ã¢ÂÂ« f_in(x)                           * F_out(x)                   dx =\n+        # Ã¢ÂÂ« (lambda_in * exp(-lambda_in * x)) * (1 - exp(-lambda_out * x)) dx =\n+        # 0.285714\n+        #\n+        # Where,\n+        # * f_in is the pdf of the exponential distribution for inbound peers,\n+        #   with lambda_in = 1 / INVENTORY_BROADCAST_INTERVAL = 1/5\n+        # * F_out is the cdf of the expon. distribuiton for outbound peers,\n+        #   with lambda_out = 1 / (INVENTORY_BROADCAST_INTERVAL >> 1) = 1/2\n+        #\n+        # Due to measurement delays, the actual monte-carlo leak is a bit\n+        # higher. Assume a total delay of 0.6 s (Includes network delays and\n+        # rpc delay to poll the raw mempool)\n+        #\n+        # Probability( time_ann_inbound < time_ann_outbound + 0.6 )           =\n+        # Ã¢ÂÂ« f_in(x)                           * F_out(x + 0.6)             dx =\n+        # Ã¢ÂÂ« (lambda_in * exp(-lambda_in * x)) * (1 - exp(-lambda_out * (x+.6))) dx =\n+        # 0.366485\n+        EXPECTED_MEASURED_LEAK = .366485\n+\n+        REPEATS = 100\n+        measured_leak = 0\n+        self.log.info('Start simulation for {} repeats'.format(REPEATS))\n+        for i in range(REPEATS):\n+            self.log.debug('Run {}/{}'.format(i, REPEATS))\n+            txid = gen_node.sendtoaddress(gen_node.getnewaddress(), 0.033)\n+            want_tx = msg_getdata()\n+            want_tx.inv.append(CInv(t=1, h=int(txid, 16)))\n+\n+            wait_until(lambda: txid in outbound_peer.getrawmempool(), lock=mininode_lock)\n+            inbound_peer.send_message(want_tx)\n+            inbound_peer.sync_with_ping()\n+\n+            if inbound_peer.last_message.get('notfound'):\n+                assert_equal(inbound_peer.last_message['notfound'].vec[0].hash, int(txid, 16))\n+                inbound_peer.last_message.pop('notfound')\n+            else:\n+                measured_leak += 1\n+\n+        measured_leak /= REPEATS\n+        self.log.info('Measured leak of {}'.format(measured_leak))\n+\n+        assert_greater_than(EXPECTED_MEASURED_LEAK, measured_leak)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r221381012",
      "id" : 221381012,
      "in_reply_to_id" : 220690330,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMTM4MTAxMg==",
      "original_commit_id" : "736462c26de7a267bdf75c1f86bf12932c604b3d",
      "original_position" : 85,
      "path" : "test/functional/p2p_leak_tx.py",
      "position" : null,
      "pull_request_review_id" : 160023846,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220",
      "updated_at" : "2018-10-09T03:05:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/221381012",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r221381060"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/221381060"
         }
      },
      "author_association" : "MEMBER",
      "body" : "fixed",
      "commit_id" : "de9662b7b8e578d31401412e821c2d910d9ea80a",
      "created_at" : "2018-09-28T21:04:17Z",
      "diff_hunk" : "@@ -1232,7 +1232,27 @@ def __repr__(self):\n         return \"msg_mempool()\"\n \n \n-class msg_sendheaders:\n+class msg_notfound():\n+    __slots__ = (\"vec\")\n+    command = b\"notfound\"\n+\n+    def __init__(self, vec=None):\n+        if vec is None:\n+            self.vec = []\n+        else:\n+            self.vec = vec\n+\n+    def deserialize(self, f):\n+        self.vec = deser_vector(f, CInv)\n+\n+    def serialize(self):\n+        return ser_vector(self.vec)\n+\n+    def __repr__(self):\n+        return \"msg_notfound(vec=%s)\" % (repr(self.vec))\n+\n+\n+class msg_sendheaders():",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r221381060",
      "id" : 221381060,
      "in_reply_to_id" : 221118923,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMTM4MTA2MA==",
      "original_commit_id" : "47bf6e9622101181ca6d0ec60985fd683c17704c",
      "original_position" : 25,
      "path" : "test/functional/test_framework/messages.py",
      "position" : null,
      "pull_request_review_id" : 160023914,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220",
      "updated_at" : "2018-10-09T03:05:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/221381060",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-ACK 320a85e3427685d4bed9d585c3a3c45e288d5a30",
      "created_at" : "2018-10-01T01:26:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#issuecomment-425768162",
      "id" : 425768162,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14220",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyNTc2ODE2Mg==",
      "updated_at" : "2018-10-01T01:26:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/425768162",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2018-10-08T04:02:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#issuecomment-427717108",
      "id" : 427717108,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14220",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyNzcxNzEwOA==",
      "updated_at" : "2018-10-08T04:02:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/427717108",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r223248001"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/223248001"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't understand what this test is supposed to be testing. Is it:\r\n\r\n(i) that we don't leak txs to inbound peers that we haven't yet announced to (as stated in the docstring); or\r\n(ii) that txs are probabilistically announced to outbound peers before inbound peers.\r\n\r\nIf (i), can't we just test that for every tx, either we receive a `NOTFOUND` message for the tx or we've already received an `INV` message for the tx?\r\n\r\nThe `assert_greater_than()` call here seems to be simply testing (ii). Or maybe I'm misunderstanding?",
      "commit_id" : "de9662b7b8e578d31401412e821c2d910d9ea80a",
      "created_at" : "2018-10-08T04:53:25Z",
      "diff_hunk" : "@@ -0,0 +1,93 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2018 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that we don't leak txs to inbound peers that we haven't yet announced to\"\"\"\n+\n+from test_framework.messages import msg_getdata, CInv\n+from test_framework.mininode import mininode_lock, P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than,\n+    wait_until,\n+)\n+\n+\n+class P2PLeakTxTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        gen_node = self.nodes[0]  # The block and tx generating node\n+        gen_node.generate(1)\n+        self.sync_all()\n+\n+        inbound_peer = self.nodes[0].add_p2p_connection(P2PDataStore())  # An \"attacking\" inbound peer\n+        outbound_peer = self.nodes[1]  # Our outbound peer\n+\n+        # In an adversarial setting we can generally assume that inbound peers\n+        # are more likely to spy on us than outbound peers. Thus, on average,\n+        # we announce transactions first to outbound peers, then to (all)\n+        # inbound peers. Inbound peers must not be able to successfully request a\n+        # transaction if they haven't yet received the announcement for it.\n+        #\n+        # With only one outbound peer, we expect that a tx is first announced\n+        # to (all) inbound peers (and thus present a potential leak) in 28.5% of\n+        # the cases.\n+        #\n+        # Probability( time_ann_inbound < time_ann_outbound )                 =\n+        # Ã¢ÂÂ« f_in(x)                           * F_out(x)                   dx =\n+        # Ã¢ÂÂ« (lambda_in * exp(-lambda_in * x)) * (1 - exp(-lambda_out * x)) dx =\n+        # 0.285714\n+        #\n+        # Where,\n+        # * f_in is the pdf of the exponential distribution for inbound peers,\n+        #   with lambda_in = 1 / INVENTORY_BROADCAST_INTERVAL = 1/5\n+        # * F_out is the cdf of the expon. distribution for outbound peers,\n+        #   with lambda_out = 1 / (INVENTORY_BROADCAST_INTERVAL >> 1) = 1/2\n+        #\n+        # Due to measurement delays, the actual monte-carlo leak is a bit\n+        # higher. Assume a total delay of 0.6 s (Includes network delays and\n+        # rpc delay to poll the raw mempool)\n+        #\n+        # Probability( time_ann_inbound < time_ann_outbound + 0.6 )           =\n+        # Ã¢ÂÂ« f_in(x)                           * F_out(x + 0.6)             dx =\n+        # Ã¢ÂÂ« (lambda_in * exp(-lambda_in * x)) * (1 - exp(-lambda_out * (x+.6))) dx =\n+        # 0.366485\n+        # EXPECTED_MEASURED_LEAK = .366485\n+        # Because this test is empirical and our testing framework isn't set up\n+        # to handle tests that fail with some expected likelihood, we bump this\n+        # value up to decrease the false positive rate.\n+        EXPECTED_MEASURED_LEAK = .50\n+\n+        REPEATS = 100\n+        measured_leak = 0\n+        self.log.info('Start simulation for {} repeats'.format(REPEATS))\n+        for i in range(REPEATS):\n+            self.log.debug('Run {}/{}'.format(i, REPEATS))\n+            txid = gen_node.sendtoaddress(gen_node.getnewaddress(), 0.033)\n+            want_tx = msg_getdata()\n+            want_tx.inv.append(CInv(t=1, h=int(txid, 16)))\n+\n+            wait_until(lambda: txid in outbound_peer.getrawmempool(), lock=mininode_lock)\n+            inbound_peer.send_message(want_tx)\n+            inbound_peer.sync_with_ping()\n+\n+            if inbound_peer.last_message.get('notfound'):\n+                assert_equal(inbound_peer.last_message['notfound'].vec[0].hash, int(txid, 16))\n+                inbound_peer.last_message.pop('notfound')\n+            else:\n+                measured_leak += 1\n+\n+        measured_leak /= REPEATS\n+        self.log.info('Measured leak of {}'.format(measured_leak))\n+\n+        assert_greater_than(EXPECTED_MEASURED_LEAK, measured_leak)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r223248001",
      "id" : 223248001,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMzI0ODAwMQ==",
      "original_commit_id" : "320a85e3427685d4bed9d585c3a3c45e288d5a30",
      "original_position" : 89,
      "path" : "test/functional/p2p_leak_tx.py",
      "position" : null,
      "pull_request_review_id" : 162328321,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220",
      "updated_at" : "2018-10-09T03:05:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/223248001",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r223281424"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/223281424"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Makes sense! That makes the test easier to understand as well:\r\n\r\n(to be applied on current HEAD commit of this branch)\r\n\r\n```diff\r\ndiff --git a/test/functional/p2p_leak_tx.py b/test/functional/p2p_leak_tx.py\r\nindex 21d1d4ed2d..a0ceaedd67 100755\r\n--- a/test/functional/p2p_leak_tx.py\r\n+++ b/test/functional/p2p_leak_tx.py\r\n@@ -13,10 +13,17 @@ from test_framework.util import (\r\n     wait_until,\r\n )\r\n \r\n+import time\r\n+\r\n+\r\n+class P2PNode(P2PDataStore):\r\n+    def on_inv(self, msg):\r\n+        pass\r\n+\r\n \r\n class P2PLeakTxTest(BitcoinTestFramework):\r\n     def set_test_params(self):\r\n-        self.num_nodes = 2\r\n+        self.num_nodes = 1\r\n \r\n     def skip_test_if_missing_module(self):\r\n         self.skip_if_no_wallet()\r\n@@ -26,67 +33,28 @@ class P2PLeakTxTest(BitcoinTestFramework):\r\n         gen_node.generate(1)\r\n         self.sync_all()\r\n \r\n-        inbound_peer = self.nodes[0].add_p2p_connection(P2PDataStore())  # An \"attacking\" inbound peer\r\n-        outbound_peer = self.nodes[1]  # Our outbound peer\r\n+        inbound_peer = self.nodes[0].add_p2p_connection(P2PNode())  # An \"attacking\" inbound peer\r\n \r\n-        # In an adversarial setting we can generally assume that inbound peers\r\n-        # are more likely to spy on us than outbound peers. Thus, on average,\r\n-        # we announce transactions first to outbound peers, then to (all)\r\n-        # inbound peers. Inbound peers must not be able to successfully request a\r\n-        # transaction if they haven't yet received the announcement for it.\r\n-        #\r\n-        # With only one outbound peer, we expect that a tx is first announced\r\n-        # to (all) inbound peers (and thus present a potential leak) in 28.5% of\r\n-        # the cases.\r\n-        #\r\n-        # Probability( time_ann_inbound < time_ann_outbound )                 =\r\n-        # Ã¢ÂÂ« f_in(x)                           * F_out(x)                   dx =\r\n-        # Ã¢ÂÂ« (lambda_in * exp(-lambda_in * x)) * (1 - exp(-lambda_out * x)) dx =\r\n-        # 0.285714\r\n-        #\r\n-        # Where,\r\n-        # * f_in is the pdf of the exponential distribution for inbound peers,\r\n-        #   with lambda_in = 1 / INVENTORY_BROADCAST_INTERVAL = 1/5\r\n-        # * F_out is the cdf of the expon. distribution for outbound peers,\r\n-        #   with lambda_out = 1 / (INVENTORY_BROADCAST_INTERVAL >> 1) = 1/2\r\n-        #\r\n-        # Due to measurement delays, the actual monte-carlo leak is a bit\r\n-        # higher. Assume a total delay of 0.6 s (Includes network delays and\r\n-        # rpc delay to poll the raw mempool)\r\n-        #\r\n-        # Probability( time_ann_inbound < time_ann_outbound + 0.6 )           =\r\n-        # Ã¢ÂÂ« f_in(x)                           * F_out(x + 0.6)             dx =\r\n-        # Ã¢ÂÂ« (lambda_in * exp(-lambda_in * x)) * (1 - exp(-lambda_out * (x+.6))) dx =\r\n-        # 0.366485\r\n-        # EXPECTED_MEASURED_LEAK = .366485\r\n-        # Because this test is empirical and our testing framework isn't set up\r\n-        # to handle tests that fail with some expected likelihood, we bump this\r\n-        # value up to decrease the false positive rate.\r\n-        EXPECTED_MEASURED_LEAK = .50\r\n-\r\n-        REPEATS = 100\r\n-        measured_leak = 0\r\n-        self.log.info('Start simulation for {} repeats'.format(REPEATS))\r\n+        REPEATS = 10\r\n+        self.log.info('Start test for {} repeats'.format(REPEATS))\r\n         for i in range(REPEATS):\r\n             self.log.debug('Run {}/{}'.format(i, REPEATS))\r\n             txid = gen_node.sendtoaddress(gen_node.getnewaddress(), 0.033)\r\n+\r\n+            time.sleep(5)\r\n+\r\n             want_tx = msg_getdata()\r\n             want_tx.inv.append(CInv(t=1, h=int(txid, 16)))\r\n-\r\n-            wait_until(lambda: txid in outbound_peer.getrawmempool(), lock=mininode_lock)\r\n             inbound_peer.send_message(want_tx)\r\n             inbound_peer.sync_with_ping()\r\n \r\n             if inbound_peer.last_message.get('notfound'):\r\n+                self.log.debug('tx {} was not yet announced to us.'.format(txid))\r\n                 assert_equal(inbound_peer.last_message['notfound'].vec[0].hash, int(txid, 16))\r\n                 inbound_peer.last_message.pop('notfound')\r\n             else:\r\n-                measured_leak += 1\r\n-\r\n-        measured_leak /= REPEATS\r\n-        self.log.info('Measured leak of {}'.format(measured_leak))\r\n-\r\n-        assert_greater_than(EXPECTED_MEASURED_LEAK, measured_leak)\r\n+                self.log.debug('tx {} was announced to us.'.format(txid))\r\n+                assert int(txid, 16) in [inv.hash for inv in inbound_peer.last_message['inv'].inv]\r\n \r\n \r\n if __name__ == '__main__':\r\n",
      "commit_id" : "de9662b7b8e578d31401412e821c2d910d9ea80a",
      "created_at" : "2018-10-08T08:23:57Z",
      "diff_hunk" : "@@ -0,0 +1,93 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2018 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that we don't leak txs to inbound peers that we haven't yet announced to\"\"\"\n+\n+from test_framework.messages import msg_getdata, CInv\n+from test_framework.mininode import mininode_lock, P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than,\n+    wait_until,\n+)\n+\n+\n+class P2PLeakTxTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        gen_node = self.nodes[0]  # The block and tx generating node\n+        gen_node.generate(1)\n+        self.sync_all()\n+\n+        inbound_peer = self.nodes[0].add_p2p_connection(P2PDataStore())  # An \"attacking\" inbound peer\n+        outbound_peer = self.nodes[1]  # Our outbound peer\n+\n+        # In an adversarial setting we can generally assume that inbound peers\n+        # are more likely to spy on us than outbound peers. Thus, on average,\n+        # we announce transactions first to outbound peers, then to (all)\n+        # inbound peers. Inbound peers must not be able to successfully request a\n+        # transaction if they haven't yet received the announcement for it.\n+        #\n+        # With only one outbound peer, we expect that a tx is first announced\n+        # to (all) inbound peers (and thus present a potential leak) in 28.5% of\n+        # the cases.\n+        #\n+        # Probability( time_ann_inbound < time_ann_outbound )                 =\n+        # Ã¢ÂÂ« f_in(x)                           * F_out(x)                   dx =\n+        # Ã¢ÂÂ« (lambda_in * exp(-lambda_in * x)) * (1 - exp(-lambda_out * x)) dx =\n+        # 0.285714\n+        #\n+        # Where,\n+        # * f_in is the pdf of the exponential distribution for inbound peers,\n+        #   with lambda_in = 1 / INVENTORY_BROADCAST_INTERVAL = 1/5\n+        # * F_out is the cdf of the expon. distribution for outbound peers,\n+        #   with lambda_out = 1 / (INVENTORY_BROADCAST_INTERVAL >> 1) = 1/2\n+        #\n+        # Due to measurement delays, the actual monte-carlo leak is a bit\n+        # higher. Assume a total delay of 0.6 s (Includes network delays and\n+        # rpc delay to poll the raw mempool)\n+        #\n+        # Probability( time_ann_inbound < time_ann_outbound + 0.6 )           =\n+        # Ã¢ÂÂ« f_in(x)                           * F_out(x + 0.6)             dx =\n+        # Ã¢ÂÂ« (lambda_in * exp(-lambda_in * x)) * (1 - exp(-lambda_out * (x+.6))) dx =\n+        # 0.366485\n+        # EXPECTED_MEASURED_LEAK = .366485\n+        # Because this test is empirical and our testing framework isn't set up\n+        # to handle tests that fail with some expected likelihood, we bump this\n+        # value up to decrease the false positive rate.\n+        EXPECTED_MEASURED_LEAK = .50\n+\n+        REPEATS = 100\n+        measured_leak = 0\n+        self.log.info('Start simulation for {} repeats'.format(REPEATS))\n+        for i in range(REPEATS):\n+            self.log.debug('Run {}/{}'.format(i, REPEATS))\n+            txid = gen_node.sendtoaddress(gen_node.getnewaddress(), 0.033)\n+            want_tx = msg_getdata()\n+            want_tx.inv.append(CInv(t=1, h=int(txid, 16)))\n+\n+            wait_until(lambda: txid in outbound_peer.getrawmempool(), lock=mininode_lock)\n+            inbound_peer.send_message(want_tx)\n+            inbound_peer.sync_with_ping()\n+\n+            if inbound_peer.last_message.get('notfound'):\n+                assert_equal(inbound_peer.last_message['notfound'].vec[0].hash, int(txid, 16))\n+                inbound_peer.last_message.pop('notfound')\n+            else:\n+                measured_leak += 1\n+\n+        measured_leak /= REPEATS\n+        self.log.info('Measured leak of {}'.format(measured_leak))\n+\n+        assert_greater_than(EXPECTED_MEASURED_LEAK, measured_leak)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r223281424",
      "id" : 223281424,
      "in_reply_to_id" : 223248001,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMzI4MTQyNA==",
      "original_commit_id" : "320a85e3427685d4bed9d585c3a3c45e288d5a30",
      "original_position" : 89,
      "path" : "test/functional/p2p_leak_tx.py",
      "position" : null,
      "pull_request_review_id" : 162367314,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220",
      "updated_at" : "2018-10-09T03:05:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/223281424",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r223293921"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/223293921"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Concept ACK the change to the test!\r\n\r\nCan we add multiple P2P connections to the node to get more test repeats in parallel, or does the change to tx propagation in https://github.com/bitcoin/bitcoin/pull/13298 mean that we'll announce to all those peers at the same time and not get any additional benefit?",
      "commit_id" : "de9662b7b8e578d31401412e821c2d910d9ea80a",
      "created_at" : "2018-10-08T09:06:38Z",
      "diff_hunk" : "@@ -0,0 +1,93 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2018 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that we don't leak txs to inbound peers that we haven't yet announced to\"\"\"\n+\n+from test_framework.messages import msg_getdata, CInv\n+from test_framework.mininode import mininode_lock, P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than,\n+    wait_until,\n+)\n+\n+\n+class P2PLeakTxTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        gen_node = self.nodes[0]  # The block and tx generating node\n+        gen_node.generate(1)\n+        self.sync_all()\n+\n+        inbound_peer = self.nodes[0].add_p2p_connection(P2PDataStore())  # An \"attacking\" inbound peer\n+        outbound_peer = self.nodes[1]  # Our outbound peer\n+\n+        # In an adversarial setting we can generally assume that inbound peers\n+        # are more likely to spy on us than outbound peers. Thus, on average,\n+        # we announce transactions first to outbound peers, then to (all)\n+        # inbound peers. Inbound peers must not be able to successfully request a\n+        # transaction if they haven't yet received the announcement for it.\n+        #\n+        # With only one outbound peer, we expect that a tx is first announced\n+        # to (all) inbound peers (and thus present a potential leak) in 28.5% of\n+        # the cases.\n+        #\n+        # Probability( time_ann_inbound < time_ann_outbound )                 =\n+        # Ã¢ÂÂ« f_in(x)                           * F_out(x)                   dx =\n+        # Ã¢ÂÂ« (lambda_in * exp(-lambda_in * x)) * (1 - exp(-lambda_out * x)) dx =\n+        # 0.285714\n+        #\n+        # Where,\n+        # * f_in is the pdf of the exponential distribution for inbound peers,\n+        #   with lambda_in = 1 / INVENTORY_BROADCAST_INTERVAL = 1/5\n+        # * F_out is the cdf of the expon. distribution for outbound peers,\n+        #   with lambda_out = 1 / (INVENTORY_BROADCAST_INTERVAL >> 1) = 1/2\n+        #\n+        # Due to measurement delays, the actual monte-carlo leak is a bit\n+        # higher. Assume a total delay of 0.6 s (Includes network delays and\n+        # rpc delay to poll the raw mempool)\n+        #\n+        # Probability( time_ann_inbound < time_ann_outbound + 0.6 )           =\n+        # Ã¢ÂÂ« f_in(x)                           * F_out(x + 0.6)             dx =\n+        # Ã¢ÂÂ« (lambda_in * exp(-lambda_in * x)) * (1 - exp(-lambda_out * (x+.6))) dx =\n+        # 0.366485\n+        # EXPECTED_MEASURED_LEAK = .366485\n+        # Because this test is empirical and our testing framework isn't set up\n+        # to handle tests that fail with some expected likelihood, we bump this\n+        # value up to decrease the false positive rate.\n+        EXPECTED_MEASURED_LEAK = .50\n+\n+        REPEATS = 100\n+        measured_leak = 0\n+        self.log.info('Start simulation for {} repeats'.format(REPEATS))\n+        for i in range(REPEATS):\n+            self.log.debug('Run {}/{}'.format(i, REPEATS))\n+            txid = gen_node.sendtoaddress(gen_node.getnewaddress(), 0.033)\n+            want_tx = msg_getdata()\n+            want_tx.inv.append(CInv(t=1, h=int(txid, 16)))\n+\n+            wait_until(lambda: txid in outbound_peer.getrawmempool(), lock=mininode_lock)\n+            inbound_peer.send_message(want_tx)\n+            inbound_peer.sync_with_ping()\n+\n+            if inbound_peer.last_message.get('notfound'):\n+                assert_equal(inbound_peer.last_message['notfound'].vec[0].hash, int(txid, 16))\n+                inbound_peer.last_message.pop('notfound')\n+            else:\n+                measured_leak += 1\n+\n+        measured_leak /= REPEATS\n+        self.log.info('Measured leak of {}'.format(measured_leak))\n+\n+        assert_greater_than(EXPECTED_MEASURED_LEAK, measured_leak)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r223293921",
      "id" : 223293921,
      "in_reply_to_id" : 223248001,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMzI5MzkyMQ==",
      "original_commit_id" : "320a85e3427685d4bed9d585c3a3c45e288d5a30",
      "original_position" : 89,
      "path" : "test/functional/p2p_leak_tx.py",
      "position" : null,
      "pull_request_review_id" : 162382581,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220",
      "updated_at" : "2018-10-09T03:05:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/223293921",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r223296240"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/223296240"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Currently we can only easily add inbound mininode peers (which are in the same bucket for tx propagation), so right now it couldn't run in parallel that way.\r\n\r\nI am happy to adjust the test as soon as we can add outbound connections to mininode peers.",
      "commit_id" : "de9662b7b8e578d31401412e821c2d910d9ea80a",
      "created_at" : "2018-10-08T09:15:01Z",
      "diff_hunk" : "@@ -0,0 +1,93 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2018 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that we don't leak txs to inbound peers that we haven't yet announced to\"\"\"\n+\n+from test_framework.messages import msg_getdata, CInv\n+from test_framework.mininode import mininode_lock, P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than,\n+    wait_until,\n+)\n+\n+\n+class P2PLeakTxTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        gen_node = self.nodes[0]  # The block and tx generating node\n+        gen_node.generate(1)\n+        self.sync_all()\n+\n+        inbound_peer = self.nodes[0].add_p2p_connection(P2PDataStore())  # An \"attacking\" inbound peer\n+        outbound_peer = self.nodes[1]  # Our outbound peer\n+\n+        # In an adversarial setting we can generally assume that inbound peers\n+        # are more likely to spy on us than outbound peers. Thus, on average,\n+        # we announce transactions first to outbound peers, then to (all)\n+        # inbound peers. Inbound peers must not be able to successfully request a\n+        # transaction if they haven't yet received the announcement for it.\n+        #\n+        # With only one outbound peer, we expect that a tx is first announced\n+        # to (all) inbound peers (and thus present a potential leak) in 28.5% of\n+        # the cases.\n+        #\n+        # Probability( time_ann_inbound < time_ann_outbound )                 =\n+        # Ã¢ÂÂ« f_in(x)                           * F_out(x)                   dx =\n+        # Ã¢ÂÂ« (lambda_in * exp(-lambda_in * x)) * (1 - exp(-lambda_out * x)) dx =\n+        # 0.285714\n+        #\n+        # Where,\n+        # * f_in is the pdf of the exponential distribution for inbound peers,\n+        #   with lambda_in = 1 / INVENTORY_BROADCAST_INTERVAL = 1/5\n+        # * F_out is the cdf of the expon. distribution for outbound peers,\n+        #   with lambda_out = 1 / (INVENTORY_BROADCAST_INTERVAL >> 1) = 1/2\n+        #\n+        # Due to measurement delays, the actual monte-carlo leak is a bit\n+        # higher. Assume a total delay of 0.6 s (Includes network delays and\n+        # rpc delay to poll the raw mempool)\n+        #\n+        # Probability( time_ann_inbound < time_ann_outbound + 0.6 )           =\n+        # Ã¢ÂÂ« f_in(x)                           * F_out(x + 0.6)             dx =\n+        # Ã¢ÂÂ« (lambda_in * exp(-lambda_in * x)) * (1 - exp(-lambda_out * (x+.6))) dx =\n+        # 0.366485\n+        # EXPECTED_MEASURED_LEAK = .366485\n+        # Because this test is empirical and our testing framework isn't set up\n+        # to handle tests that fail with some expected likelihood, we bump this\n+        # value up to decrease the false positive rate.\n+        EXPECTED_MEASURED_LEAK = .50\n+\n+        REPEATS = 100\n+        measured_leak = 0\n+        self.log.info('Start simulation for {} repeats'.format(REPEATS))\n+        for i in range(REPEATS):\n+            self.log.debug('Run {}/{}'.format(i, REPEATS))\n+            txid = gen_node.sendtoaddress(gen_node.getnewaddress(), 0.033)\n+            want_tx = msg_getdata()\n+            want_tx.inv.append(CInv(t=1, h=int(txid, 16)))\n+\n+            wait_until(lambda: txid in outbound_peer.getrawmempool(), lock=mininode_lock)\n+            inbound_peer.send_message(want_tx)\n+            inbound_peer.sync_with_ping()\n+\n+            if inbound_peer.last_message.get('notfound'):\n+                assert_equal(inbound_peer.last_message['notfound'].vec[0].hash, int(txid, 16))\n+                inbound_peer.last_message.pop('notfound')\n+            else:\n+                measured_leak += 1\n+\n+        measured_leak /= REPEATS\n+        self.log.info('Measured leak of {}'.format(measured_leak))\n+\n+        assert_greater_than(EXPECTED_MEASURED_LEAK, measured_leak)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r223296240",
      "id" : 223296240,
      "in_reply_to_id" : 223248001,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMzI5NjI0MA==",
      "original_commit_id" : "320a85e3427685d4bed9d585c3a3c45e288d5a30",
      "original_position" : 89,
      "path" : "test/functional/p2p_leak_tx.py",
      "position" : null,
      "pull_request_review_id" : 162385405,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220",
      "updated_at" : "2018-10-09T03:05:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/223296240",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Picked up Marco's latest test and rebased on master due to the `test_runner.py` conflict.",
      "created_at" : "2018-10-09T02:57:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#issuecomment-428043168",
      "id" : 428043168,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14220",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyODA0MzE2OA==",
      "updated_at" : "2018-10-09T02:57:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/428043168",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r223548444"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/223548444"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks!",
      "commit_id" : "de9662b7b8e578d31401412e821c2d910d9ea80a",
      "created_at" : "2018-10-09T02:58:19Z",
      "diff_hunk" : "@@ -0,0 +1,93 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2018 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that we don't leak txs to inbound peers that we haven't yet announced to\"\"\"\n+\n+from test_framework.messages import msg_getdata, CInv\n+from test_framework.mininode import mininode_lock, P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than,\n+    wait_until,\n+)\n+\n+\n+class P2PLeakTxTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        gen_node = self.nodes[0]  # The block and tx generating node\n+        gen_node.generate(1)\n+        self.sync_all()\n+\n+        inbound_peer = self.nodes[0].add_p2p_connection(P2PDataStore())  # An \"attacking\" inbound peer\n+        outbound_peer = self.nodes[1]  # Our outbound peer\n+\n+        # In an adversarial setting we can generally assume that inbound peers\n+        # are more likely to spy on us than outbound peers. Thus, on average,\n+        # we announce transactions first to outbound peers, then to (all)\n+        # inbound peers. Inbound peers must not be able to successfully request a\n+        # transaction if they haven't yet received the announcement for it.\n+        #\n+        # With only one outbound peer, we expect that a tx is first announced\n+        # to (all) inbound peers (and thus present a potential leak) in 28.5% of\n+        # the cases.\n+        #\n+        # Probability( time_ann_inbound < time_ann_outbound )                 =\n+        # Ã¢ÂÂ« f_in(x)                           * F_out(x)                   dx =\n+        # Ã¢ÂÂ« (lambda_in * exp(-lambda_in * x)) * (1 - exp(-lambda_out * x)) dx =\n+        # 0.285714\n+        #\n+        # Where,\n+        # * f_in is the pdf of the exponential distribution for inbound peers,\n+        #   with lambda_in = 1 / INVENTORY_BROADCAST_INTERVAL = 1/5\n+        # * F_out is the cdf of the expon. distribution for outbound peers,\n+        #   with lambda_out = 1 / (INVENTORY_BROADCAST_INTERVAL >> 1) = 1/2\n+        #\n+        # Due to measurement delays, the actual monte-carlo leak is a bit\n+        # higher. Assume a total delay of 0.6 s (Includes network delays and\n+        # rpc delay to poll the raw mempool)\n+        #\n+        # Probability( time_ann_inbound < time_ann_outbound + 0.6 )           =\n+        # Ã¢ÂÂ« f_in(x)                           * F_out(x + 0.6)             dx =\n+        # Ã¢ÂÂ« (lambda_in * exp(-lambda_in * x)) * (1 - exp(-lambda_out * (x+.6))) dx =\n+        # 0.366485\n+        # EXPECTED_MEASURED_LEAK = .366485\n+        # Because this test is empirical and our testing framework isn't set up\n+        # to handle tests that fail with some expected likelihood, we bump this\n+        # value up to decrease the false positive rate.\n+        EXPECTED_MEASURED_LEAK = .50\n+\n+        REPEATS = 100\n+        measured_leak = 0\n+        self.log.info('Start simulation for {} repeats'.format(REPEATS))\n+        for i in range(REPEATS):\n+            self.log.debug('Run {}/{}'.format(i, REPEATS))\n+            txid = gen_node.sendtoaddress(gen_node.getnewaddress(), 0.033)\n+            want_tx = msg_getdata()\n+            want_tx.inv.append(CInv(t=1, h=int(txid, 16)))\n+\n+            wait_until(lambda: txid in outbound_peer.getrawmempool(), lock=mininode_lock)\n+            inbound_peer.send_message(want_tx)\n+            inbound_peer.sync_with_ping()\n+\n+            if inbound_peer.last_message.get('notfound'):\n+                assert_equal(inbound_peer.last_message['notfound'].vec[0].hash, int(txid, 16))\n+                inbound_peer.last_message.pop('notfound')\n+            else:\n+                measured_leak += 1\n+\n+        measured_leak /= REPEATS\n+        self.log.info('Measured leak of {}'.format(measured_leak))\n+\n+        assert_greater_than(EXPECTED_MEASURED_LEAK, measured_leak)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r223548444",
      "id" : 223548444,
      "in_reply_to_id" : 223248001,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMzU0ODQ0NA==",
      "original_commit_id" : "320a85e3427685d4bed9d585c3a3c45e288d5a30",
      "original_position" : 89,
      "path" : "test/functional/p2p_leak_tx.py",
      "position" : null,
      "pull_request_review_id" : 162701895,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220",
      "updated_at" : "2018-10-09T03:05:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/223548444",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Added a commit because of this:\r\n\r\n```\r\n./test/functional/p2p_leak_tx.py:8:1: F401 'test_framework.mininode.mininode_lock' imported but unused\r\n./test/functional/p2p_leak_tx.py:10:1: F401 'test_framework.util.assert_greater_than' imported but unused\r\n./test/functional/p2p_leak_tx.py:10:1: F401 'test_framework.util.wait_until' imported but unused\r\n```",
      "created_at" : "2018-10-09T03:06:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#issuecomment-428044364",
      "id" : 428044364,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14220",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyODA0NDM2NA==",
      "updated_at" : "2018-10-09T03:06:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/428044364",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Feel free to just squash these trivial fixups in",
      "created_at" : "2018-10-09T03:30:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#issuecomment-428047754",
      "id" : 428047754,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14220",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyODA0Nzc1NA==",
      "updated_at" : "2018-10-09T03:30:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/428047754",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r223950591"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/223950591"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think a comment here would be helpful (since `mi->second.m_node_set.count(pfrom->GetId())` isn't immediately obvious when read outside the context of this PR). Something like:\r\n\r\n```\r\n// Only send the transaction if we've previously announced it to this peer\r\n```",
      "commit_id" : "de9662b7b8e578d31401412e821c2d910d9ea80a",
      "created_at" : "2018-10-10T06:31:03Z",
      "diff_hunk" : "@@ -1284,8 +1290,8 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n             bool push = false;\n             auto mi = mapRelay.find(inv.hash);\n             int nSendFlags = (inv.type == MSG_TX ? SERIALIZE_TRANSACTION_NO_WITNESS : 0);\n-            if (mi != mapRelay.end()) {\n-                connman->PushMessage(pfrom, msgMaker.Make(nSendFlags, NetMsgType::TX, *mi->second));\n+            if (mi != mapRelay.end() && mi->second.m_node_set.count(pfrom->GetId())) {\n+                connman->PushMessage(pfrom, msgMaker.Make(nSendFlags, NetMsgType::TX, *mi->second.m_txref));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r223950591",
      "id" : 223950591,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMzk1MDU5MQ==",
      "original_commit_id" : "de9662b7b8e578d31401412e821c2d910d9ea80a",
      "original_position" : 29,
      "path" : "src/net_processing.cpp",
      "position" : 29,
      "pull_request_review_id" : 163200623,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220",
      "updated_at" : "2018-10-10T06:42:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/223950591",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r223950825"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/223950825"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Note that we can leak mempool contents (and lose privacy) to a peer if it sends us a MEMPOOL message. That is unchanged by this PR, but the logic here is a bit confusing and we should probably deprecate support for MEMPOOL in future.",
      "commit_id" : "de9662b7b8e578d31401412e821c2d910d9ea80a",
      "created_at" : "2018-10-10T06:32:11Z",
      "diff_hunk" : "@@ -1284,8 +1290,8 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n             bool push = false;\n             auto mi = mapRelay.find(inv.hash);\n             int nSendFlags = (inv.type == MSG_TX ? SERIALIZE_TRANSACTION_NO_WITNESS : 0);\n-            if (mi != mapRelay.end()) {\n-                connman->PushMessage(pfrom, msgMaker.Make(nSendFlags, NetMsgType::TX, *mi->second));\n+            if (mi != mapRelay.end() && mi->second.m_node_set.count(pfrom->GetId())) {\n+                connman->PushMessage(pfrom, msgMaker.Make(nSendFlags, NetMsgType::TX, *mi->second.m_txref));\n                 push = true;\n             } else if (pfrom->timeLastMempoolReq) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r223950825",
      "id" : 223950825,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMzk1MDgyNQ==",
      "original_commit_id" : "de9662b7b8e578d31401412e821c2d910d9ea80a",
      "original_position" : 31,
      "path" : "src/net_processing.cpp",
      "position" : 31,
      "pull_request_review_id" : 163200623,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220",
      "updated_at" : "2018-10-10T06:42:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/223950825",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r223952467"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/223952467"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've now reviewed this test. Sadly, it doesn't test the new code (and does not fail on master).\r\n\r\nSince the node-under-test has only one peer, the transaction won't get added to `mapRelay` until we send the `INV` to that peer. That means in the if/else branches at the bottom of this test:\r\n\r\n- if the node has already sent us an INV for the tx, then it'll be in the `mapRelay` and the node will send us the TX.\r\n- if the node has not yet sent us an INV for the tx, then it won't be in the `mapRelay` and we'll fail `mi != mapRelay.end()` and not even reach `&& mi->second.m_node_set.count(pfrom->GetId())`\r\n\r\nTo test the new code, we want the to be in `mapRelay`, but the peer to not be in the `RelayEntry`. That's not possible if the node has only one peer.\r\n\r\nPerhaps we should remove the test from this PR and add it under a future PR. If you do so, please tag me in that PR and I'll commit to reviewing the test.",
      "commit_id" : "de9662b7b8e578d31401412e821c2d910d9ea80a",
      "created_at" : "2018-10-10T06:41:10Z",
      "diff_hunk" : "@@ -0,0 +1,59 @@\n+#!/usr/bin/env python3",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r223952467",
      "id" : 223952467,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMzk1MjQ2Nw==",
      "original_commit_id" : "de9662b7b8e578d31401412e821c2d910d9ea80a",
      "original_position" : 1,
      "path" : "test/functional/p2p_leak_tx.py",
      "position" : 1,
      "pull_request_review_id" : 163200623,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220",
      "updated_at" : "2018-10-10T06:42:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/223952467",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "One other question: do we know how large `mapRelay` is expected to grow? Do we know how much additional memory will be used by changing the `CTransactionRef` to a `RelayEntry`?",
      "created_at" : "2018-10-10T08:34:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#issuecomment-428486018",
      "id" : 428486018,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14220",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyODQ4NjAxOA==",
      "updated_at" : "2018-10-10T08:34:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/428486018",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've written an alternative test here: https://github.com/jnewbery/bitcoin/tree/pr14220.1 which reliably tests the new behaviour and fails on master.",
      "created_at" : "2018-10-15T14:43:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#issuecomment-429881442",
      "id" : 429881442,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14220",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyOTg4MTQ0Mg==",
      "updated_at" : "2018-10-15T14:43:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/429881442",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "https://github.com/bitcoin/bitcoin/pull/14220",
      "created_at" : "2018-10-15T15:29:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#issuecomment-429901128",
      "id" : 429901128,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14220",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyOTkwMTEyOA==",
      "updated_at" : "2018-10-15T15:29:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/429901128",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/43432383?v=4",
         "events_url" : "https://api.github.com/users/vnbtc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vnbtc/followers",
         "following_url" : "https://api.github.com/users/vnbtc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vnbtc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vnbtc",
         "id" : 43432383,
         "login" : "vnbtc",
         "node_id" : "MDQ6VXNlcjQzNDMyMzgz",
         "organizations_url" : "https://api.github.com/users/vnbtc/orgs",
         "received_events_url" : "https://api.github.com/users/vnbtc/received_events",
         "repos_url" : "https://api.github.com/users/vnbtc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vnbtc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vnbtc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vnbtc"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r225809009"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/225809009"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Use `m_txref(std::move(tx))` here. `tx` in this context is _not_ an rvalue reference (as it's been bound to variable), it's only initialized by accepting an rvalue reference.",
      "commit_id" : "de9662b7b8e578d31401412e821c2d910d9ea80a",
      "created_at" : "2018-10-17T07:35:39Z",
      "diff_hunk" : "@@ -153,7 +154,12 @@ namespace {\n     std::atomic<int64_t> g_last_tip_update(0);\n \n     /** Relay map */\n-    typedef std::map<uint256, CTransactionRef> MapRelay;\n+    struct RelayEntry {\n+        explicit RelayEntry(CTransactionRef &&tx) : m_txref(tx) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r225809009",
      "id" : 225809009,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNTgwOTAwOQ==",
      "original_commit_id" : "f979abd13867673df501bf712daa878d466389c1",
      "original_position" : 14,
      "path" : "src/net_processing.cpp",
      "position" : 14,
      "pull_request_review_id" : 165489169,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220",
      "updated_at" : "2018-10-17T07:48:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/225809009",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r225813001"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/225813001"
         }
      },
      "author_association" : "MEMBER",
      "body" : "One relatively easy solution (I think), is to only announce transactions that have been longer than say 60s in the mempool at the time the MEMPOOL message is received, and to enforce the same time restriction in this block of code (so you can't fetch transactions that were received less than 60s before the last MEMPOOL request).",
      "commit_id" : "de9662b7b8e578d31401412e821c2d910d9ea80a",
      "created_at" : "2018-10-17T07:47:49Z",
      "diff_hunk" : "@@ -1284,8 +1290,8 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n             bool push = false;\n             auto mi = mapRelay.find(inv.hash);\n             int nSendFlags = (inv.type == MSG_TX ? SERIALIZE_TRANSACTION_NO_WITNESS : 0);\n-            if (mi != mapRelay.end()) {\n-                connman->PushMessage(pfrom, msgMaker.Make(nSendFlags, NetMsgType::TX, *mi->second));\n+            if (mi != mapRelay.end() && mi->second.m_node_set.count(pfrom->GetId())) {\n+                connman->PushMessage(pfrom, msgMaker.Make(nSendFlags, NetMsgType::TX, *mi->second.m_txref));\n                 push = true;\n             } else if (pfrom->timeLastMempoolReq) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r225813001",
      "id" : 225813001,
      "in_reply_to_id" : 223950825,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNTgxMzAwMQ==",
      "original_commit_id" : "de9662b7b8e578d31401412e821c2d910d9ea80a",
      "original_position" : 31,
      "path" : "src/net_processing.cpp",
      "position" : 31,
      "pull_request_review_id" : 165489169,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220",
      "updated_at" : "2018-10-17T07:48:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/225813001",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r226017914"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/226017914"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I had no idea, thank you for pointing this out!",
      "commit_id" : "de9662b7b8e578d31401412e821c2d910d9ea80a",
      "created_at" : "2018-10-17T17:07:05Z",
      "diff_hunk" : "@@ -153,7 +154,12 @@ namespace {\n     std::atomic<int64_t> g_last_tip_update(0);\n \n     /** Relay map */\n-    typedef std::map<uint256, CTransactionRef> MapRelay;\n+    struct RelayEntry {\n+        explicit RelayEntry(CTransactionRef &&tx) : m_txref(tx) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r226017914",
      "id" : 226017914,
      "in_reply_to_id" : 225809009,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNjAxNzkxNA==",
      "original_commit_id" : "f979abd13867673df501bf712daa878d466389c1",
      "original_position" : 14,
      "path" : "src/net_processing.cpp",
      "position" : 14,
      "pull_request_review_id" : 165740267,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220",
      "updated_at" : "2018-10-17T17:07:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/226017914",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : ">One other question: do we know how large mapRelay is expected to grow? Do we know how much additional memory will be used by changing the CTransactionRef to a RelayEntry?\r\n\r\nmapRelay is bounded by our rate-limited transaction relay algorithm, but on further thought, this approach may potentially use quite a bit more memory than I originally realized.\r\n\r\nI'll close this PR for now and re-open when I have an alternative that I think is worth pursuing.",
      "created_at" : "2018-10-17T17:08:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#issuecomment-430710707",
      "id" : 430710707,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14220",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMDcxMDcwNw==",
      "updated_at" : "2018-10-17T17:08:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/430710707",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r226864609"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/226864609"
         }
      },
      "author_association" : "MEMBER",
      "body" : "There are at most 9 buckets, so a set of outbound `NodeId`s and a flag for inbound ones might demand less memory?",
      "commit_id" : "de9662b7b8e578d31401412e821c2d910d9ea80a",
      "created_at" : "2018-10-21T14:19:34Z",
      "diff_hunk" : "@@ -153,7 +154,12 @@ namespace {\n     std::atomic<int64_t> g_last_tip_update(0);\n \n     /** Relay map */\n-    typedef std::map<uint256, CTransactionRef> MapRelay;\n+    struct RelayEntry {\n+        explicit RelayEntry(CTransactionRef &&tx) : m_txref(tx) {}\n+        CTransactionRef m_txref;\n+        std::unordered_set<NodeId> m_node_set;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14220#discussion_r226864609",
      "id" : 226864609,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNjg2NDYwOQ==",
      "original_commit_id" : "de9662b7b8e578d31401412e821c2d910d9ea80a",
      "original_position" : 16,
      "path" : "src/net_processing.cpp",
      "position" : 16,
      "pull_request_review_id" : 166787081,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14220",
      "updated_at" : "2018-10-21T14:19:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/226864609",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
