[
   {
      "author_association" : "MEMBER",
      "body" : "@fanquake Is this good enough or do you want faster? `-unsafesqlitesync` does not appear to have any effect. The next thing would be to reduce the number of txs created, but I'm concerned that doing so will make it harder to observe actual performance issues that this benchmark is intended to measure.",
      "created_at" : "2022-04-19T17:02:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24924#issuecomment-1102883503",
      "id" : 1102883503,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24924",
      "node_id" : "IC_kwDOABII585BvKqv",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1102883503/reactions"
      },
      "updated_at" : "2022-04-19T17:02:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1102883503",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "review ACK 9e404a98312d73c969adf4f8e87aad1ac4b3029d",
      "created_at" : "2022-04-19T17:19:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24924#issuecomment-1102898407",
      "id" : 1102898407,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24924",
      "node_id" : "IC_kwDOABII585BvOTn",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1102898407/reactions"
      },
      "updated_at" : "2022-04-19T17:19:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1102898407",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "On my machine:\r\n\r\nBefore PR #24913\r\n```\r\nExecuted in   57.34 secs    fish           external\r\n   usr time   57.60 secs  843.00 micros   57.60 secs\r\n   sys time    1.43 secs    0.00 micros    1.43 secs\r\n```\r\nAfter PR #24913\r\n```\r\n|    1,525,136,424.90 |                0.66 |    0.2% |    189.67 | `WalletLoadingDescriptors`\r\n|      873,902,969.45 |                1.14 |    0.3% |    106.20 | `WalletLoadingLegacy`\r\n\r\n________________________________________________________\r\nExecuted in  564.01 secs    fish           external\r\n   usr time  540.03 secs  427.00 micros  540.02 secs\r\n   sys time   13.35 secs   95.00 micros   13.35 secs\r\n```\r\nThis PR\r\n```\r\n|    1,740,638,493.00 |                0.57 |    0.6% |     26.13 | `WalletLoadingDescriptors`\r\n|    1,016,725,382.00 |                0.98 |    0.9% |     12.72 | `WalletLoadingLegacy`\r\n\r\n________________________________________________________\r\nExecuted in  348.35 secs    fish           external\r\n   usr time  328.66 secs    1.05 millis  328.66 secs\r\n   sys time   12.46 secs    0.60 millis   12.46 secs\r\n```\r\n\r\nThere's a good improvement  (348.35 secs) over PR #24913 (540.03 secs), but it still takes a lot longer than before it (57.34 secs).",
      "created_at" : "2022-04-19T20:40:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24924#issuecomment-1103131951",
      "id" : 1103131951,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24924",
      "node_id" : "IC_kwDOABII585BwHUv",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1103131951/reactions"
      },
      "updated_at" : "2022-04-19T20:40:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1103131951",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/94266259?v=4",
         "events_url" : "https://api.github.com/users/w0xlt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/w0xlt/followers",
         "following_url" : "https://api.github.com/users/w0xlt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/w0xlt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/w0xlt",
         "id" : 94266259,
         "login" : "w0xlt",
         "node_id" : "U_kgDOBZ5jkw",
         "organizations_url" : "https://api.github.com/users/w0xlt/orgs",
         "received_events_url" : "https://api.github.com/users/w0xlt/received_events",
         "repos_url" : "https://api.github.com/users/w0xlt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/w0xlt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/w0xlt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/w0xlt"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> @fanquake Is this good enough or do you want faster?\r\n\r\nI think to be good enough, it needs to run in a similar time to all of the other benchmarks, i.e max ~1-2 seconds, otherwise anyone running `make check` on macOS is going to be opening issues asking why running `make check` (has suddenly started) taking 10+ minutes. I tested this branch, but stopped after `WalletLoadingDescriptors` took 12 minutes:\r\n```bash\r\n|           80,237.38 |           12,463.02 |    0.1% |      0.01 | `VerifyScriptBench`\r\n|            8,190.91 |          122,086.52 |    1.2% |      0.01 | `WalletBalanceClean`\r\n|          179,780.20 |            5,562.35 |    1.5% |      0.01 | `WalletBalanceDirty`\r\n|            7,929.42 |          126,112.61 |    0.1% |      0.01 | `WalletBalanceMine`\r\n|               42.47 |       23,546,683.62 |    0.0% |      0.01 | `WalletBalanceWatch`\r\n|      902,283,977.00 |                1.11 |    1.4% |    105.48 | `WalletLoadingDescriptors`\r\n^C\r\nsrc/bench/bench_bitcoin  59.66s user 24.31s system 11% cpu 12:01.03 total\r\n```\r\n\r\n> -unsafesqlitesync does not appear to have any effect. The next thing would be to reduce the number of txs created, but I'm concerned that doing so will make it harder to observe actual performance issues that this benchmark is intended to measure.\r\n\r\nGiven that, it seems like we've got another macOS only-performance issue, that we should probably figure out the root cause of?",
      "created_at" : "2022-04-20T08:55:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24924#issuecomment-1103649451",
      "id" : 1103649451,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24924",
      "node_id" : "IC_kwDOABII585ByFqr",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1103649451/reactions"
      },
      "updated_at" : "2022-04-20T08:55:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1103649451",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I think to be good enough, it needs to run in a similar time to all of the other benchmarks, i.e max ~1-2 seconds, \r\n\r\nAgree. It's unacceptable to have a benchmark take in the order of minutes. Remember that benchmarks are there to measure small timespans (such as inner loop functions), not very long processes.\r\n\r\nI've also seen a CI timeout due to this. Remember that we do `bench/bench_bitcoin &> /dev/null` in one of the CI runs.",
      "created_at" : "2022-04-20T17:16:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24924#issuecomment-1104205424",
      "id" : 1104205424,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24924",
      "node_id" : "IC_kwDOABII585B0NZw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1104205424/reactions"
      },
      "updated_at" : "2022-04-20T17:16:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1104205424",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've added the following changes:\r\n* The number of benchmark epochs is reduced from the default 11 to 5.\r\n* Use `unsafesqlitesync`\r\n* Use mock databases\r\n  * Update sqlite's mock database implementation to use in-memory dbs rather than just temp dbs\r\n* Instead of mining blocks to wallet addresses, we make transactions and add them directly with `AddToWallet`.\r\n* Reduced the number of txs added to the wallet from 5000 to 1000.\r\n\r\nThis still doesn't make it as fast as the other benchmarks though.\r\n\r\n***\r\n\r\nBefore #24913:\r\n\r\n```\r\n________________________________________________________\r\nExecuted in   11.37 secs    fish           external\r\n   usr time   11.36 secs    0.00 micros   11.36 secs\r\n   sys time    7.62 secs  435.00 micros    7.62 secs\r\n```\r\n\r\nAfter #24913:\r\n\r\n```\r\n________________________________________________________\r\nExecuted in  150.77 secs    fish           external\r\n   usr time  148.99 secs  334.00 micros  148.99 secs\r\n   sys time    9.42 secs   88.00 micros    9.42 secs\r\n```\r\n\r\nThis PR:\r\n\r\n```\r\n________________________________________________________\r\nExecuted in   20.25 secs    fish           external\r\n   usr time   20.21 secs  319.00 micros   20.21 secs\r\n   sys time    7.92 secs  158.00 micros    7.92 secs\r\n```",
      "created_at" : "2022-04-20T18:18:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24924#issuecomment-1104271927",
      "id" : 1104271927,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24924",
      "node_id" : "IC_kwDOABII585B0do3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1104271927/reactions"
      },
      "updated_at" : "2022-04-20T18:18:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1104271927",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This PR makes `./src/bench/bench_bitcoin -filter=WalletLoadingDescriptors` go from taking 246s to 2.3s for me, making \"make check\" a lot more usable.\r\n\r\n(Ubuntu 22.04 on a Ryzen 5950X system; my ZFS filesystem setup may make flushing/syncing relatively slower)",
      "created_at" : "2022-05-10T15:47:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24924#issuecomment-1122567133",
      "id" : 1122567133,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24924",
      "node_id" : "IC_kwDOABII585C6QPd",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1122567133/reactions"
      },
      "updated_at" : "2022-05-10T15:47:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1122567133",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Looks like this also introduces memory corruption, looking at the CI output?",
      "created_at" : "2022-05-10T15:50:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24924#issuecomment-1122572484",
      "id" : 1122572484,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24924",
      "node_id" : "IC_kwDOABII585C6RjE",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1122572484/reactions"
      },
      "updated_at" : "2022-05-10T15:50:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1122572484",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Haven't reviewed the code at all, but e673d8b475995075b696208386c9e45ae7ca3e20 reduces the runtime of the WalletLoadingDescriptors test from 4m25s to 0.1s for me",
      "created_at" : "2022-05-10T16:05:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24924#issuecomment-1122595413",
      "id" : 1122595413,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24924",
      "node_id" : "IC_kwDOABII585C6XJV",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1122595413/reactions"
      },
      "updated_at" : "2022-05-10T16:05:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1122595413",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "tACK e673d8b475995075b696208386c9e45ae7ca3e20\r\n\r\nThis solves the `make check` issue with `bench_bitcoin` reported [here](https://github.com/bitcoin/bitcoin/issues/25185)",
      "created_at" : "2022-05-22T05:20:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24924#issuecomment-1133820981",
      "id" : 1133820981,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24924",
      "node_id" : "IC_kwDOABII585DlLw1",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1133820981/reactions"
      },
      "updated_at" : "2022-05-22T05:20:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1133820981",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/24482484?v=4",
         "events_url" : "https://api.github.com/users/Rspigler/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Rspigler/followers",
         "following_url" : "https://api.github.com/users/Rspigler/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Rspigler/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Rspigler",
         "id" : 24482484,
         "login" : "Rspigler",
         "node_id" : "MDQ6VXNlcjI0NDgyNDg0",
         "organizations_url" : "https://api.github.com/users/Rspigler/orgs",
         "received_events_url" : "https://api.github.com/users/Rspigler/received_events",
         "repos_url" : "https://api.github.com/users/Rspigler/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Rspigler/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Rspigler/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Rspigler"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24924#discussion_r881777393"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24924"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/881777393"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In 4af3547e:\r\n\r\nI'm not so sure why do we need to update the database here, guess that what you wanted to do is rollback the db to the first mocked database created at line 103 and not the recently loaded one? So in case of any modification, we ensure that the benchmark is always running from the same static db input?",
      "commit_id" : "e673d8b475995075b696208386c9e45ae7ca3e20",
      "created_at" : "2022-05-25T15:10:47Z",
      "diff_hunk" : "@@ -72,21 +94,30 @@ static void WalletLoading(benchmark::Bench& bench, bool legacy_wallet)\n     // Setup the wallet\n     // Loading the wallet will also create it\n     DatabaseOptions options;\n-    if (!legacy_wallet) options.create_flags = WALLET_FLAG_DESCRIPTORS;\n-    auto wallet = BenchLoadWallet(context, options);\n+    if (legacy_wallet) {\n+        options.require_format = DatabaseFormat::BERKELEY;\n+    } else {\n+        options.create_flags = WALLET_FLAG_DESCRIPTORS;\n+        options.require_format = DatabaseFormat::SQLITE;\n+    }\n+    auto database = CreateMockWalletDatabase(options);\n+    auto wallet = BenchLoadWallet(std::move(database), context, options);\n \n     // Generate a bunch of transactions and addresses to put into the wallet\n     for (int i = 0; i < 1000; ++i) {\n         AddTx(*wallet);\n     }\n \n+    database = DuplicateMockDatabase(wallet->GetDatabase(), options);\n+\n     // reload the wallet for the actual benchmark\n     BenchUnloadWallet(std::move(wallet));\n \n     bench.epochs(5).run([&] {\n-        wallet = BenchLoadWallet(context, options);\n+        wallet = BenchLoadWallet(std::move(database), context, options);\n \n         // Cleanup\n+        database = DuplicateMockDatabase(wallet->GetDatabase(), options);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24924#discussion_r881777393",
      "id" : 881777393,
      "line" : 120,
      "node_id" : "PRRC_kwDOABII5840jtrx",
      "original_commit_id" : "4af3547ebac672a2d516e8696fd3580a766c27eb",
      "original_line" : 120,
      "original_position" : 86,
      "original_start_line" : null,
      "path" : "src/bench/wallet_loading.cpp",
      "position" : 86,
      "pull_request_review_id" : 985000006,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24924",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/881777393/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-25T15:38:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/881777393",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24924#discussion_r882878063"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24924"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/882878063"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Actually it's because deleting the wallet so that we can load it again will delete the database.",
      "commit_id" : "e673d8b475995075b696208386c9e45ae7ca3e20",
      "created_at" : "2022-05-26T16:52:13Z",
      "diff_hunk" : "@@ -72,21 +94,30 @@ static void WalletLoading(benchmark::Bench& bench, bool legacy_wallet)\n     // Setup the wallet\n     // Loading the wallet will also create it\n     DatabaseOptions options;\n-    if (!legacy_wallet) options.create_flags = WALLET_FLAG_DESCRIPTORS;\n-    auto wallet = BenchLoadWallet(context, options);\n+    if (legacy_wallet) {\n+        options.require_format = DatabaseFormat::BERKELEY;\n+    } else {\n+        options.create_flags = WALLET_FLAG_DESCRIPTORS;\n+        options.require_format = DatabaseFormat::SQLITE;\n+    }\n+    auto database = CreateMockWalletDatabase(options);\n+    auto wallet = BenchLoadWallet(std::move(database), context, options);\n \n     // Generate a bunch of transactions and addresses to put into the wallet\n     for (int i = 0; i < 1000; ++i) {\n         AddTx(*wallet);\n     }\n \n+    database = DuplicateMockDatabase(wallet->GetDatabase(), options);\n+\n     // reload the wallet for the actual benchmark\n     BenchUnloadWallet(std::move(wallet));\n \n     bench.epochs(5).run([&] {\n-        wallet = BenchLoadWallet(context, options);\n+        wallet = BenchLoadWallet(std::move(database), context, options);\n \n         // Cleanup\n+        database = DuplicateMockDatabase(wallet->GetDatabase(), options);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24924#discussion_r882878063",
      "id" : 882878063,
      "in_reply_to_id" : 881777393,
      "line" : 120,
      "node_id" : "PRRC_kwDOABII5840n6Zv",
      "original_commit_id" : "4af3547ebac672a2d516e8696fd3580a766c27eb",
      "original_line" : 120,
      "original_position" : 86,
      "original_start_line" : null,
      "path" : "src/bench/wallet_loading.cpp",
      "position" : 86,
      "pull_request_review_id" : 986512360,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24924",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/882878063/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-26T16:52:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/882878063",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> if I (manually) revert commits [817c051](https://github.com/bitcoin/bitcoin/commit/817c051364208d3f9e7e2af5700bd2bee5c9f303) (using unsafesqlitesync)\r\n\r\nI think `-unsafesqlitesync` has more of an effect on macs than linux?",
      "created_at" : "2022-05-26T16:53:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24924#issuecomment-1138786032",
      "id" : 1138786032,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24924",
      "node_id" : "IC_kwDOABII585D4H7w",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1138786032/reactions"
      },
      "updated_at" : "2022-05-26T16:53:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1138786032",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24924#discussion_r883602515"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24924"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/883602515"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "k, that is because of the db destructor, good.",
      "commit_id" : "e673d8b475995075b696208386c9e45ae7ca3e20",
      "created_at" : "2022-05-27T13:12:56Z",
      "diff_hunk" : "@@ -72,21 +94,30 @@ static void WalletLoading(benchmark::Bench& bench, bool legacy_wallet)\n     // Setup the wallet\n     // Loading the wallet will also create it\n     DatabaseOptions options;\n-    if (!legacy_wallet) options.create_flags = WALLET_FLAG_DESCRIPTORS;\n-    auto wallet = BenchLoadWallet(context, options);\n+    if (legacy_wallet) {\n+        options.require_format = DatabaseFormat::BERKELEY;\n+    } else {\n+        options.create_flags = WALLET_FLAG_DESCRIPTORS;\n+        options.require_format = DatabaseFormat::SQLITE;\n+    }\n+    auto database = CreateMockWalletDatabase(options);\n+    auto wallet = BenchLoadWallet(std::move(database), context, options);\n \n     // Generate a bunch of transactions and addresses to put into the wallet\n     for (int i = 0; i < 1000; ++i) {\n         AddTx(*wallet);\n     }\n \n+    database = DuplicateMockDatabase(wallet->GetDatabase(), options);\n+\n     // reload the wallet for the actual benchmark\n     BenchUnloadWallet(std::move(wallet));\n \n     bench.epochs(5).run([&] {\n-        wallet = BenchLoadWallet(context, options);\n+        wallet = BenchLoadWallet(std::move(database), context, options);\n \n         // Cleanup\n+        database = DuplicateMockDatabase(wallet->GetDatabase(), options);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24924#discussion_r883602515",
      "id" : 883602515,
      "in_reply_to_id" : 881777393,
      "line" : 120,
      "node_id" : "PRRC_kwDOABII5840qrRT",
      "original_commit_id" : "4af3547ebac672a2d516e8696fd3580a766c27eb",
      "original_line" : 120,
      "original_position" : 86,
      "original_start_line" : null,
      "path" : "src/bench/wallet_loading.cpp",
      "position" : 86,
      "pull_request_review_id" : 987492567,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24924",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/883602515/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-27T13:12:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/883602515",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#25466](https://github.com/bitcoin/bitcoin/pull/25466) (ci: add unused-using-decls to clang-tidy by fanquake)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-06-25T06:32:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24924#issuecomment-1166204389",
      "id" : 1166204389,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24924",
      "node_id" : "IC_kwDOABII585Fgt3l",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1166204389/reactions"
      },
      "updated_at" : "2022-06-25T06:32:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1166204389",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   }
]
