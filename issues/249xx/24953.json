{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "**Expected behavior**\r\n\r\nI expected for the program to keep executing, or to shutdown gracefully, after having displayed and/or logged messages/warnings telling me that write permissions are lacking on the involved filesystem resources. This can affect attempting to write to directories outside of the normal bitcoin data directory and/or blocks directory, as seen in my second example below. The nastier crashes are like the ones in the GUI settings that could happen concurrent to data modification. Those could lead to data corruption when files are not flushed, and/or data gets out of synch.\r\n\r\n**Actual behavior**\r\n\r\nThe program logged a runaway exception and immediately aborted.\r\n\r\n**To reproduce**\r\n\r\nThis can be reproduced in multiple ways since there are many references to `fs::create_directories`. Also, crashes can result from restrictive `umask` settings too since some calls attempt to create directories multiple levels deep.\r\n\r\nHere are two easy ways:\r\n\r\n1. bitcoind \"-blocksdir not writable\"\r\n    1. start with the command line: `mkdir /tmp/blocks && chmod 0500 /tmp/blocks && ./src/bitcoind -blocksdir=/tmp/blocks`\r\n    2. the program will immediately crash with this logged in the console:\r\n```\r\n************************\r\nEXCEPTION: NSt10filesystem7__cxx1116filesystem_errorE       \r\nfilesystem error: cannot create directories: Permission denied [/tmp/blocks/blocks]       \r\nbitcoin in AppInit()\r\n```\r\n2. bitcoin-qt \"Start Bitcoin Core on system login\r\n    1. start with the command line: `mkdir -p /tmp/btc && mkdir -p /tmp/crash && chmod 0500 /tmp/crash && XDG_CONFIG_HOME=/tmp/crash ./src/qt/bitcoin-qt -debug -datadir=/tmp/btc -connect=0`\r\n    4. in the GUI go to the `Settings` menu and select `Options...`\r\n    5. check `Start Bitcoin Core on system login`\r\n![settings](https://user-images.githubusercontent.com/6440430/164890624-f335ed11-96c1-460a-b6eb-7204c079b3d9.png)\r\n    6. click OK. you will be presented with the exception as:\r\n![exception](https://user-images.githubusercontent.com/6440430/164890658-393a5303-6924-494c-a955-a3f2cc2d870c.png)\r\n    7. the console will show:\r\n```\r\n************************\r\nEXCEPTION: NSt10filesystem7__cxx1116filesystem_errorE       \r\nfilesystem error: cannot create directories: Permission denied [/tmp/crash/autostart]       \r\nbitcoin in Runaway exception       \r\n\r\nbitcoin-qt: ./checkqueue.h:204: CCheckQueue<T>::~CCheckQueue() [with T = CScriptCheck]: Assertion `m_worker_threads.empty()' failed.\r\nAborted (core dumped)\r\n```\r\n\r\n**System information**\r\n\r\nThis affects current master branch as of at least be7a5f2fc400e7a3ef72dedbdcf49dd6c96d4f9e. Tested on Ubuntu 21.10.\r\n",
   "closed_at" : "2022-06-09T12:26:14Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/6440430?v=4",
      "events_url" : "https://api.github.com/users/mruddy/events{/privacy}",
      "followers_url" : "https://api.github.com/users/mruddy/followers",
      "following_url" : "https://api.github.com/users/mruddy/following{/other_user}",
      "gists_url" : "https://api.github.com/users/mruddy/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/mruddy",
      "id" : 6440430,
      "login" : "mruddy",
      "node_id" : "MDQ6VXNlcjY0NDA0MzA=",
      "organizations_url" : "https://api.github.com/users/mruddy/orgs",
      "received_events_url" : "https://api.github.com/users/mruddy/received_events",
      "repos_url" : "https://api.github.com/users/mruddy/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/mruddy/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/mruddy/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/mruddy"
   },
   "comments" : 2,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24953/comments",
   "created_at" : "2022-04-23T10:36:53Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24953/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/24953",
   "id" : 1213267267,
   "labels" : [
      {
         "color" : "5319e7",
         "default" : false,
         "description" : "",
         "id" : 241832923,
         "name" : "Utils/log/libs",
         "node_id" : "MDU6TGFiZWwyNDE4MzI5MjM=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Utils/log/libs"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24953/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "I_kwDOABII585IUP1D",
   "number" : 24953,
   "performed_via_github_app" : null,
   "reactions" : {
      "+1" : 0,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 0,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24953/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "state_reason" : "completed",
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24953/timeline",
   "title" : "fs::create_directories causes crashes in multiple places when lacking write permission",
   "updated_at" : "2022-06-09T12:26:14Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24953",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/6440430?v=4",
      "events_url" : "https://api.github.com/users/mruddy/events{/privacy}",
      "followers_url" : "https://api.github.com/users/mruddy/followers",
      "following_url" : "https://api.github.com/users/mruddy/following{/other_user}",
      "gists_url" : "https://api.github.com/users/mruddy/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/mruddy",
      "id" : 6440430,
      "login" : "mruddy",
      "node_id" : "MDQ6VXNlcjY0NDA0MzA=",
      "organizations_url" : "https://api.github.com/users/mruddy/orgs",
      "received_events_url" : "https://api.github.com/users/mruddy/received_events",
      "repos_url" : "https://api.github.com/users/mruddy/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/mruddy/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/mruddy/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/mruddy"
   }
}
