[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r454153812"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/454153812"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think it is needed in python to duplicate how the script was called in the help.\r\n\r\n```suggestion\r\n        epilog=\"EXAMPLE \\n\\t{sys.argv[0]} -o out.json <data-dir>/peer_logging/**/*.dat\",\r\n```\r\n\r\nIn case you wanted to do this because the import (` sys.path.append('test/functional')`) is relative to the pwd, you could make it relative to this file, which would be more stable.\r\n\r\nAlso, a test wouldn't hurt.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-14T07:19:41Z",
      "diff_hunk" : "@@ -0,0 +1,91 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message log binary files.  To be used in conjunction with -logmessages.\"\"\"\n+\n+import argparse\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List\n+\n+sys.path.append('test/functional')\n+\n+from test_framework.mininode import MESSAGEMAP\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+COMMAND_SIZE = 12\n+\n+def to_jsonable(obj: Any) -> Any:\n+    ret = {}\n+    # The msg objects don't generally include \"msgtype\" in their __slots__\n+    if hasattr(obj, \"msgtype\"):\n+        ret[\"msgtype\"] = getattr(obj, \"msgtype\", None).decode()\n+    if hasattr(obj, \"__dict__\"):\n+        ret = obj.__dict__\n+    elif hasattr(obj, \"__slots__\"):\n+        for slot in obj.__slots__:\n+            val = getattr(obj, slot, None)\n+            ret[slot] = to_jsonable(val)\n+    elif isinstance(obj, list):\n+        ret = [to_jsonable(a) for a in obj]\n+    elif isinstance(obj, bytes):\n+        ret = obj.hex()\n+    else:\n+        ret = obj\n+    return ret\n+\n+\n+def process_file(path: Path, messages: List[Any], recv: bool) -> None:\n+    with open(path, 'rb') as f_in:\n+        while True:\n+            tmp_header = f_in.read(TIME_SIZE + LENGTH_SIZE + COMMAND_SIZE)\n+            if not tmp_header:\n+                break\n+            tmp_header = BytesIO(tmp_header)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\") # type: int\n+            command = tmp_header.read(COMMAND_SIZE).split(b'\\x00', 1)[0]  # type: bytes\n+            length = int.from_bytes(tmp_header.read(LENGTH_SIZE), \"little\") # type: int\n+            if command not in MESSAGEMAP:\n+                continue    # For now just skip unrecognized messages\n+            msg = MESSAGEMAP[command]()\n+            msg.deserialize(f_in)\n+            msg_dict = to_jsonable(msg)\n+            msg_dict[\"time\"] = time\n+            msg_dict[\"length\"] = length\n+            msg_dict[\"recv\"] = recv\n+            messages.append(msg_dict)\n+\n+\n+def main():\n+    \"\"\"Main\"\"\"\n+    parser = argparse.ArgumentParser(\n+        description=__doc__,\n+        epilog=\"EXAMPLE \\n\\tpython contrib/peer-logging/peer-logging-parser.py -o out.json <data-dir>/peer_logging/**/*.dat\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r454153812",
      "id" : 454153812,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDE1MzgxMg==",
      "original_commit_id" : "dc393b30e97f743c1e58ce94051c4f4f918beb70",
      "original_line" : 67,
      "original_position" : 67,
      "original_start_line" : null,
      "path" : "contrib/peer-logging/peer-logging-parser.py",
      "position" : null,
      "pull_request_review_id" : 447849752,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/454153812",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r454163465"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/454163465"
         }
      },
      "author_association" : "MEMBER",
      "body" : "\"dumpmessages\"?",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-14T07:38:12Z",
      "diff_hunk" : "@@ -3636,6 +3636,10 @@ bool PeerLogicValidation::ProcessMessages(CNode* pfrom, std::atomic<bool>& inter\n     }\n     CNetMessage& msg(msgs.front());\n \n+    std::vector<unsigned char> tmp(msg.m_recv.data(), msg.m_recv.data() + msg.m_recv.size());\n+    if (gArgs.IsArgSet(\"-dumpmessages\"))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r454163465",
      "id" : 454163465,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDE2MzQ2NQ==",
      "original_commit_id" : "38c6f10d5c0c21818c934f5f265890909abd1ec2",
      "original_line" : 3640,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 447861896,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/454163465",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK the high-level idea. I think this feature may be quite useful while debugging, and it requires very few lines of code.\r\n\r\nI have two questions though:\r\n1. How to better integrate it with the existing codebase? Should the format be similar to what we have now:\r\n`received: addr (30003 bytes) peer=0`? Or maybe it doesn't matter.\r\n2. Is there any threat of this feature being used for DoS? Perhaps on a system where file create is expensive, an attacker could disconnect/reconnect (from a new net address?) to make us create a new file? Maybe the file should be created after 1 minute of connection lifetime? (Although the messages from the very beginning should not be lost).",
      "created_at" : "2020-07-14T07:48:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-658027492",
      "id" : 658027492,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1ODAyNzQ5Mg==",
      "updated_at" : "2020-07-14T07:48:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/658027492",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #20404 (Remove names from translatable strings by hebasto)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-07-14T07:58:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-658032164",
      "id" : 658032164,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1ODAzMjE2NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-01T18:00:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/658032164",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r454189508"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/454189508"
         }
      },
      "author_association" : "MEMBER",
      "body" : "use `fs::create_directories` (which is currently just an alias for boost::filesystem`, but means that the std filesystem can be substituted in when we upgrade our c++ version.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-14T08:25:32Z",
      "diff_hunk" : "@@ -2865,3 +2867,25 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void LogMessage(CNode* node, std::string& command, std::vector<unsigned char>& data, bool is_incoming)\n+{\n+    int64_t time = GetTimeMicros();\n+\n+    fs::path base_path = GetDataDir() / \"peer_logging\" / node->addr.ToString();\n+    boost::filesystem::create_directories(base_path);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r454189508",
      "id" : 454189508,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDE4OTUwOA==",
      "original_commit_id" : "dc393b30e97f743c1e58ce94051c4f4f918beb70",
      "original_line" : 2876,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 447894982,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/454189508",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r454189846"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/454189846"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Does this mean we try to create the directory every time we send/receive a message? Is that a problem?",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-14T08:26:09Z",
      "diff_hunk" : "@@ -2865,3 +2867,25 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void LogMessage(CNode* node, std::string& command, std::vector<unsigned char>& data, bool is_incoming)\n+{\n+    int64_t time = GetTimeMicros();\n+\n+    fs::path base_path = GetDataDir() / \"peer_logging\" / node->addr.ToString();\n+    boost::filesystem::create_directories(base_path);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r454189846",
      "id" : 454189846,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDE4OTg0Ng==",
      "original_commit_id" : "dc393b30e97f743c1e58ce94051c4f4f918beb70",
      "original_line" : 2876,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 447894982,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/454189846",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r454190521"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/454190521"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can this logic be moved to `ReceiveMsgBytes` so that all the message dumping is contained within the net layer?",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-14T08:27:21Z",
      "diff_hunk" : "@@ -3636,6 +3636,10 @@ bool PeerLogicValidation::ProcessMessages(CNode* pfrom, std::atomic<bool>& inter\n     }\n     CNetMessage& msg(msgs.front());\n \n+    std::vector<unsigned char> tmp(msg.m_recv.data(), msg.m_recv.data() + msg.m_recv.size());\n+    if (gArgs.IsArgSet(\"-dumpmessages\"))\n+        LogMessage(pfrom, msg.m_command, tmp, true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r454190521",
      "id" : 454190521,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDE5MDUyMQ==",
      "original_commit_id" : "dc393b30e97f743c1e58ce94051c4f4f918beb70",
      "original_line" : 3641,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 447894982,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/454190521",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r454288639"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/454288639"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ah thanks fixed!",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-14T11:28:35Z",
      "diff_hunk" : "@@ -3636,6 +3636,10 @@ bool PeerLogicValidation::ProcessMessages(CNode* pfrom, std::atomic<bool>& inter\n     }\n     CNetMessage& msg(msgs.front());\n \n+    std::vector<unsigned char> tmp(msg.m_recv.data(), msg.m_recv.data() + msg.m_recv.size());\n+    if (gArgs.IsArgSet(\"-dumpmessages\"))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r454288639",
      "id" : 454288639,
      "in_reply_to_id" : 454163465,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDI4ODYzOQ==",
      "original_commit_id" : "38c6f10d5c0c21818c934f5f265890909abd1ec2",
      "original_line" : 3640,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 448020557,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/454288639",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2020-07-14T13:16:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-658173380",
      "id" : 658173380,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1ODE3MzM4MA==",
      "updated_at" : "2020-07-14T13:16:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/658173380",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r454466665"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/454466665"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes!  It's unfortunate that we have some MessageHandler code in net.cpp.  Right now all of the logging is done is done in MessageHandler, I think we should keep it that way.  It would be nice to move PushMessage to net_processing some day.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-14T16:01:25Z",
      "diff_hunk" : "@@ -3636,6 +3636,10 @@ bool PeerLogicValidation::ProcessMessages(CNode* pfrom, std::atomic<bool>& inter\n     }\n     CNetMessage& msg(msgs.front());\n \n+    std::vector<unsigned char> tmp(msg.m_recv.data(), msg.m_recv.data() + msg.m_recv.size());\n+    if (gArgs.IsArgSet(\"-dumpmessages\"))\n+        LogMessage(pfrom, msg.m_command, tmp, true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r454466665",
      "id" : 454466665,
      "in_reply_to_id" : 454190521,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQ2NjY2NQ==",
      "original_commit_id" : "dc393b30e97f743c1e58ce94051c4f4f918beb70",
      "original_line" : 3641,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 448247139,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/454466665",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r454484398"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/454484398"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\nvoid LogMessage(const CNode& node, const std::string& command, const std::vector<unsigned char>& data, bool is_incoming)\r\n```\r\n\r\nRationale: [F.15: Prefer simple and conventional ways of passing information ](https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rf-conventional) (C++ Core Guidlines) :)",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-14T16:28:11Z",
      "diff_hunk" : "@@ -2865,3 +2867,25 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void LogMessage(CNode* node, std::string& command, std::vector<unsigned char>& data, bool is_incoming)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r454484398",
      "id" : 454484398,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQ4NDM5OA==",
      "original_commit_id" : "cf5966a76f136d1ca7a986d6ca11808047a812c6",
      "original_line" : 2871,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 448269477,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/454484398",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r454512068"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/454512068"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, you're right. Even though PushMessage is in net.cpp, it's always executed on the MessageHandler thread.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-14T17:11:49Z",
      "diff_hunk" : "@@ -3636,6 +3636,10 @@ bool PeerLogicValidation::ProcessMessages(CNode* pfrom, std::atomic<bool>& inter\n     }\n     CNetMessage& msg(msgs.front());\n \n+    std::vector<unsigned char> tmp(msg.m_recv.data(), msg.m_recv.data() + msg.m_recv.size());\n+    if (gArgs.IsArgSet(\"-dumpmessages\"))\n+        LogMessage(pfrom, msg.m_command, tmp, true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r454512068",
      "id" : 454512068,
      "in_reply_to_id" : 454190521,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDUxMjA2OA==",
      "original_commit_id" : "dc393b30e97f743c1e58ce94051c4f4f918beb70",
      "original_line" : 3641,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 448303477,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/454512068",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r454516050"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/454516050"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    f.write((const char*)data.data(), data.size());\r\n```",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-14T17:18:25Z",
      "diff_hunk" : "@@ -2865,3 +2867,25 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void LogMessage(CNode* node, std::string& command, std::vector<unsigned char>& data, bool is_incoming)\n+{\n+    int64_t time = GetTimeMicros();\n+\n+    fs::path base_path = GetDataDir() / \"peer_logging\" / node->addr.ToString();\n+    boost::filesystem::create_directories(base_path);\n+\n+    fs::path path = base_path / (is_incoming ? \"msgs_recv.dat\" : \"msgs_sent.dat\");\n+    std::ofstream f(path.c_str(), std::ios::binary | std::ios::out | std::ios::app);\n+\n+    f.write((char *) &time, sizeof(time));\n+    f << command.data();\n+    for (int i = command.length(); i < CMessageHeader::COMMAND_SIZE; ++i){\n+        f << '\\0';\n+    }\n+    uint32_t size = data.size();\n+    f.write((char *) &size, sizeof(size));\n+    for (auto i : data){\n+        f << i;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r454516050",
      "id" : 454516050,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDUxNjA1MA==",
      "original_commit_id" : "cf5966a76f136d1ca7a986d6ca11808047a812c6",
      "original_line" : 2890,
      "original_position" : 33,
      "original_start_line" : 2888,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 448269477,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/454516050",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r454516500"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/454516500"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\nvoid LogMessage(const CNode& node, const std::string& command, const std::vector<unsigned char>& data, bool is_incoming);\r\n```",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-14T17:19:11Z",
      "diff_hunk" : "@@ -1004,4 +1004,6 @@ inline std::chrono::microseconds PoissonNextSend(std::chrono::microseconds now,\n     return std::chrono::microseconds{PoissonNextSend(now.count(), average_interval.count())};\n }\n \n+void LogMessage(CNode* node, std::string& command, std::vector<unsigned char>& data, bool is_incoming);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r454516500",
      "id" : 454516500,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDUxNjUwMA==",
      "original_commit_id" : "cf5966a76f136d1ca7a986d6ca11808047a812c6",
      "original_line" : 1007,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 448269477,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/454516500",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r454516814"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/454516814"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The scope of `tmp` can be limited to the `gArgs.IsArgSet(\"-logmessages\")` case below.\r\n\r\n(Or perhaps skip introducing a new variable - the name `tmp` really doesn't add any information to the reader.)",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-14T17:19:41Z",
      "diff_hunk" : "@@ -3636,6 +3636,10 @@ bool PeerLogicValidation::ProcessMessages(CNode* pfrom, std::atomic<bool>& inter\n     }\n     CNetMessage& msg(msgs.front());\n \n+    std::vector<unsigned char> tmp(msg.m_recv.data(), msg.m_recv.data() + msg.m_recv.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r454516814",
      "id" : 454516814,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDUxNjgxNA==",
      "original_commit_id" : "cf5966a76f136d1ca7a986d6ca11808047a812c6",
      "original_line" : 3639,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 448269477,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/454516814",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r454525647"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/454525647"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could use `CAutoFile` instead (which provides proper serialization automatically)?\r\n\r\nNo need for `c_str()` here :)",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-14T17:33:50Z",
      "diff_hunk" : "@@ -2865,3 +2867,25 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void LogMessage(CNode* node, std::string& command, std::vector<unsigned char>& data, bool is_incoming)\n+{\n+    int64_t time = GetTimeMicros();\n+\n+    fs::path base_path = GetDataDir() / \"peer_logging\" / node->addr.ToString();\n+    boost::filesystem::create_directories(base_path);\n+\n+    fs::path path = base_path / (is_incoming ? \"msgs_recv.dat\" : \"msgs_sent.dat\");\n+    std::ofstream f(path.c_str(), std::ios::binary | std::ios::out | std::ios::app);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r454525647",
      "id" : 454525647,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDUyNTY0Nw==",
      "original_commit_id" : "cf5966a76f136d1ca7a986d6ca11808047a812c6",
      "original_line" : 2879,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 448269477,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/454525647",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r454531068"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/454531068"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: Could be introduced when needed?\r\n\r\nRationale: [ES.21: Donât introduce a variable (or constant) before you need to use it](https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-introduce) (C++ Core Guidelines) :)",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-14T17:42:24Z",
      "diff_hunk" : "@@ -2865,3 +2867,25 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void LogMessage(CNode* node, std::string& command, std::vector<unsigned char>& data, bool is_incoming)\n+{\n+    int64_t time = GetTimeMicros();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r454531068",
      "id" : 454531068,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDUzMTA2OA==",
      "original_commit_id" : "cf5966a76f136d1ca7a986d6ca11808047a812c6",
      "original_line" : 2870,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 448269477,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/454531068",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r454586940"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/454586940"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit. If if log messages where enabled  by` -logmessages=<LogMessageDir> `not empty\r\nwe would have a separate LogMessagesDir , instead of logging in DataDir by default. And DataDir should be always <> LogDir.imho. see   #19419  ",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-14T19:18:41Z",
      "diff_hunk" : "@@ -2865,3 +2867,25 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void LogMessage(CNode* node, std::string& command, std::vector<unsigned char>& data, bool is_incoming)\n+{\n+    int64_t time = GetTimeMicros();\n+\n+    fs::path base_path = GetDataDir() / \"peer_logging\" / node->addr.ToString();\n+    boost::filesystem::create_directories(base_path);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r454586940",
      "id" : 454586940,
      "in_reply_to_id" : 454189508,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU4Njk0MA==",
      "original_commit_id" : "dc393b30e97f743c1e58ce94051c4f4f918beb70",
      "original_line" : 2876,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 448394427,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/454586940",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/34917548?v=4",
         "events_url" : "https://api.github.com/users/Saibato/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Saibato/followers",
         "following_url" : "https://api.github.com/users/Saibato/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Saibato/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Saibato",
         "id" : 34917548,
         "login" : "Saibato",
         "node_id" : "MDQ6VXNlcjM0OTE3NTQ4",
         "organizations_url" : "https://api.github.com/users/Saibato/orgs",
         "received_events_url" : "https://api.github.com/users/Saibato/received_events",
         "repos_url" : "https://api.github.com/users/Saibato/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Saibato/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Saibato/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Saibato"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r456432065"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/456432065"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is ok.  As per the boost docs: \"Creation failure because [base_path] resolves to an existing directory shall not be treated as an error.\"",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-17T13:11:13Z",
      "diff_hunk" : "@@ -2865,3 +2867,25 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void LogMessage(CNode* node, std::string& command, std::vector<unsigned char>& data, bool is_incoming)\n+{\n+    int64_t time = GetTimeMicros();\n+\n+    fs::path base_path = GetDataDir() / \"peer_logging\" / node->addr.ToString();\n+    boost::filesystem::create_directories(base_path);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r456432065",
      "id" : 456432065,
      "in_reply_to_id" : 454189846,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQzMjA2NQ==",
      "original_commit_id" : "dc393b30e97f743c1e58ce94051c4f4f918beb70",
      "original_line" : 2876,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 450643906,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/456432065",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r456464413"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/456464413"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I can't imagine this is a performance hit, but if anyone is worried I guess this could be moved to the CNode's constructor.  I would want to first be really sure that a node's address won't ever change.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-17T14:06:06Z",
      "diff_hunk" : "@@ -2865,3 +2867,25 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void LogMessage(CNode* node, std::string& command, std::vector<unsigned char>& data, bool is_incoming)\n+{\n+    int64_t time = GetTimeMicros();\n+\n+    fs::path base_path = GetDataDir() / \"peer_logging\" / node->addr.ToString();\n+    boost::filesystem::create_directories(base_path);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r456464413",
      "id" : 456464413,
      "in_reply_to_id" : 454189846,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ2NDQxMw==",
      "original_commit_id" : "dc393b30e97f743c1e58ce94051c4f4f918beb70",
      "original_line" : 2876,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 450686601,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/456464413",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r456978790"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/456978790"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> \r\n> \r\n> Nit. If if log messages where enabled by`-logmessages=<LogMessageDir>`not empty\r\n> we would have a separate LogMessagesDir , instead of logging in DataDir by default. And DataDir should be always <> LogDir.imho. see #19419\r\n\r\nI'll consider this, having the log directory configurable would be nice.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-20T00:51:12Z",
      "diff_hunk" : "@@ -2865,3 +2867,25 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void LogMessage(CNode* node, std::string& command, std::vector<unsigned char>& data, bool is_incoming)\n+{\n+    int64_t time = GetTimeMicros();\n+\n+    fs::path base_path = GetDataDir() / \"peer_logging\" / node->addr.ToString();\n+    boost::filesystem::create_directories(base_path);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r456978790",
      "id" : 456978790,
      "in_reply_to_id" : 454189508,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njk3ODc5MA==",
      "original_commit_id" : "dc393b30e97f743c1e58ce94051c4f4f918beb70",
      "original_line" : 2876,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 451187565,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/456978790",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r456998242"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/456998242"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "thanks :)",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-20T02:36:52Z",
      "diff_hunk" : "@@ -2865,3 +2867,25 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void LogMessage(CNode* node, std::string& command, std::vector<unsigned char>& data, bool is_incoming)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r456998242",
      "id" : 456998242,
      "in_reply_to_id" : 454484398,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njk5ODI0Mg==",
      "original_commit_id" : "cf5966a76f136d1ca7a986d6ca11808047a812c6",
      "original_line" : 2871,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 451255367,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/456998242",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r456998332"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/456998332"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for suggesting this, `CAutoFile` is much nicer",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-20T02:37:11Z",
      "diff_hunk" : "@@ -2865,3 +2867,25 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void LogMessage(CNode* node, std::string& command, std::vector<unsigned char>& data, bool is_incoming)\n+{\n+    int64_t time = GetTimeMicros();\n+\n+    fs::path base_path = GetDataDir() / \"peer_logging\" / node->addr.ToString();\n+    boost::filesystem::create_directories(base_path);\n+\n+    fs::path path = base_path / (is_incoming ? \"msgs_recv.dat\" : \"msgs_sent.dat\");\n+    std::ofstream f(path.c_str(), std::ios::binary | std::ios::out | std::ios::app);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r456998332",
      "id" : 456998332,
      "in_reply_to_id" : 454525647,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njk5ODMzMg==",
      "original_commit_id" : "cf5966a76f136d1ca7a986d6ca11808047a812c6",
      "original_line" : 2879,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 451255566,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/456998332",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r456998405"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/456998405"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-20T02:37:23Z",
      "diff_hunk" : "@@ -2865,3 +2867,25 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void LogMessage(CNode* node, std::string& command, std::vector<unsigned char>& data, bool is_incoming)\n+{\n+    int64_t time = GetTimeMicros();\n+\n+    fs::path base_path = GetDataDir() / \"peer_logging\" / node->addr.ToString();\n+    boost::filesystem::create_directories(base_path);\n+\n+    fs::path path = base_path / (is_incoming ? \"msgs_recv.dat\" : \"msgs_sent.dat\");\n+    std::ofstream f(path.c_str(), std::ios::binary | std::ios::out | std::ios::app);\n+\n+    f.write((char *) &time, sizeof(time));\n+    f << command.data();\n+    for (int i = command.length(); i < CMessageHeader::COMMAND_SIZE; ++i){\n+        f << '\\0';\n+    }\n+    uint32_t size = data.size();\n+    f.write((char *) &size, sizeof(size));\n+    for (auto i : data){\n+        f << i;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r456998405",
      "id" : 456998405,
      "in_reply_to_id" : 454516050,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njk5ODQwNQ==",
      "original_commit_id" : "cf5966a76f136d1ca7a986d6ca11808047a812c6",
      "original_line" : 2890,
      "original_position" : 33,
      "original_start_line" : 2888,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 451255673,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/456998405",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r456998477"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/456998477"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "good point, done",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-20T02:37:39Z",
      "diff_hunk" : "@@ -3636,6 +3636,10 @@ bool PeerLogicValidation::ProcessMessages(CNode* pfrom, std::atomic<bool>& inter\n     }\n     CNetMessage& msg(msgs.front());\n \n+    std::vector<unsigned char> tmp(msg.m_recv.data(), msg.m_recv.data() + msg.m_recv.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r456998477",
      "id" : 456998477,
      "in_reply_to_id" : 454516814,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njk5ODQ3Nw==",
      "original_commit_id" : "cf5966a76f136d1ca7a986d6ca11808047a812c6",
      "original_line" : 3639,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 451255883,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/456998477",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`git range-diff master cf5966a 9898fa1`\r\n\r\nMade suggested changes and fixed the Travis problem.",
      "created_at" : "2020-07-20T02:39:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-660768336",
      "id" : 660768336,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2MDc2ODMzNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-20T02:39:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/660768336",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r457072901"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/457072901"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit:\r\n\r\n```suggestion\r\n        if (gArgs.IsArgSet(\"-logmessages\")) {\r\n```",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-20T05:47:11Z",
      "diff_hunk" : "@@ -2813,6 +2813,8 @@ void CConnman::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n \n         if (pnode->nSendSize > nSendBufferMaxSize)\n             pnode->fPauseSend = true;\n+        if (gArgs.IsArgSet(\"-logmessages\"))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r457072901",
      "id" : 457072901,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzA3MjkwMQ==",
      "original_commit_id" : "9898fa106229d79772657ae8c4ff4555e8641aad",
      "original_line" : 2816,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 447849752,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/457072901",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r457073081"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/457073081"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit:\r\n\r\n```suggestion\r\n            LogMessage(*pnode, msg.m_type, msg.data, /* incoming */ false);\r\n```",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-20T05:47:30Z",
      "diff_hunk" : "@@ -2813,6 +2813,8 @@ void CConnman::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n \n         if (pnode->nSendSize > nSendBufferMaxSize)\n             pnode->fPauseSend = true;\n+        if (gArgs.IsArgSet(\"-logmessages\"))\n+            LogMessage(*pnode, msg.m_type, msg.data, false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r457073081",
      "id" : 457073081,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzA3MzA4MQ==",
      "original_commit_id" : "9898fa106229d79772657ae8c4ff4555e8641aad",
      "original_line" : 2817,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 447849752,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/457073081",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r457075888"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/457075888"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: Only valid message types are logged, not junk data\r\n\r\n```suggestion\r\nvoid LogMessage(const CNode& node, const std::string& msg_type, const std::vector<unsigned char>& data, bool is_incoming)\r\n```\r\n\r\nAlso, instead of copying the message data into a new vector, why not use a cheap std::span?",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-20T05:53:02Z",
      "diff_hunk" : "@@ -2865,3 +2867,23 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void LogMessage(const CNode& node, const std::string& command, const std::vector<unsigned char>& data, bool is_incoming)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r457075888",
      "id" : 457075888,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzA3NTg4OA==",
      "original_commit_id" : "9898fa106229d79772657ae8c4ff4555e8641aad",
      "original_line" : 2871,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 447849752,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/457075888",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r457076718"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/457076718"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Q: Is it important that this time is equal to the receive time of the message?\r\n\r\nIf yes, you could pass in the time from the caller. (msg.m_time)",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-20T05:54:42Z",
      "diff_hunk" : "@@ -2865,3 +2867,23 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void LogMessage(const CNode& node, const std::string& command, const std::vector<unsigned char>& data, bool is_incoming)\n+{\n+    int64_t time = GetTimeMicros();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r457076718",
      "id" : 457076718,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzA3NjcxOA==",
      "original_commit_id" : "9898fa106229d79772657ae8c4ff4555e8641aad",
      "original_line" : 2870,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 447849752,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/457076718",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@naumenkogs thanks for the concept ack!\r\n\r\n> How to better integrate it with the existing codebase? Should the format be similar to what we have now:\r\nreceived: addr (30003 bytes) peer=0? Or maybe it doesn't matter.\r\n\r\nIMO that format is good for a debug log, where things need to be compact on a single line.  For this I much prefer JSON.\r\n\r\n> Is there any threat of this feature being used for DoS? ...\r\n\r\nAt the moment, with this locked behind a debug flag, I'm not worried about DoS vectors.  For both debugging and learning someone should be at the keyboard and the node shouldn't be working with anything real.  Additionally, I imagine that if writing a very small amount to disk in this way (every time a message is sent or received) is a DoS vector then there are many more serious ones available.\r\n\r\nThat said, this is worth consideration, especially if we think this will one day be used for wider purposes.\r\n",
      "created_at" : "2020-07-21T12:48:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-661838550",
      "id" : 661838550,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2MTgzODU1MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-21T12:48:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/661838550",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r458760191"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/458760191"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The exact time doesn't matter, this is mainly used for sorting the messages later.  All that's important is that messages that are sent later have a later time.  To avoid races I only call LogMessage from the MessageHandler thread.  When sending a message in PushMessage, we don't have anything like msg.m_time until the message is into SocketHandler.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-22T12:39:01Z",
      "diff_hunk" : "@@ -2865,3 +2867,23 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void LogMessage(const CNode& node, const std::string& command, const std::vector<unsigned char>& data, bool is_incoming)\n+{\n+    int64_t time = GetTimeMicros();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r458760191",
      "id" : 458760191,
      "in_reply_to_id" : 457076718,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODc2MDE5MQ==",
      "original_commit_id" : "9898fa106229d79772657ae8c4ff4555e8641aad",
      "original_line" : 2870,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 453275506,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/458760191",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r458763531"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/458763531"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'd prefer to keep this as it is.  I understand (and agree with) ES.21 completely, but I'm trying to treat `time` as an argument, not a local, which is why it's right at the top.  I would love to pass it in instead but practically can't (see [here](https://github.com/bitcoin/bitcoin/pull/19509#discussion_r458760191)).\r\n\r\nIf anyone is strongly against this I'll move it.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-22T12:44:55Z",
      "diff_hunk" : "@@ -2865,3 +2867,25 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void LogMessage(CNode* node, std::string& command, std::vector<unsigned char>& data, bool is_incoming)\n+{\n+    int64_t time = GetTimeMicros();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r458763531",
      "id" : 458763531,
      "in_reply_to_id" : 454531068,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODc2MzUzMQ==",
      "original_commit_id" : "cf5966a76f136d1ca7a986d6ca11808047a812c6",
      "original_line" : 2870,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 453279914,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/458763531",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r458765292"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/458765292"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ah I misread the style guide!\r\n\r\nNow that I'm adding braces to this, I'll add them to the rest of PushMessage.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-22T12:47:50Z",
      "diff_hunk" : "@@ -2813,6 +2813,8 @@ void CConnman::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n \n         if (pnode->nSendSize > nSendBufferMaxSize)\n             pnode->fPauseSend = true;\n+        if (gArgs.IsArgSet(\"-logmessages\"))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r458765292",
      "id" : 458765292,
      "in_reply_to_id" : 457072901,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODc2NTI5Mg==",
      "original_commit_id" : "9898fa106229d79772657ae8c4ff4555e8641aad",
      "original_line" : 2816,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 453282138,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/458765292",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r459000213"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459000213"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done\r\n\r\n(That sort of format string is something I'm looking forward to in 3.6 ð)",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-22T18:33:21Z",
      "diff_hunk" : "@@ -0,0 +1,91 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message log binary files.  To be used in conjunction with -logmessages.\"\"\"\n+\n+import argparse\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List\n+\n+sys.path.append('test/functional')\n+\n+from test_framework.mininode import MESSAGEMAP\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+COMMAND_SIZE = 12\n+\n+def to_jsonable(obj: Any) -> Any:\n+    ret = {}\n+    # The msg objects don't generally include \"msgtype\" in their __slots__\n+    if hasattr(obj, \"msgtype\"):\n+        ret[\"msgtype\"] = getattr(obj, \"msgtype\", None).decode()\n+    if hasattr(obj, \"__dict__\"):\n+        ret = obj.__dict__\n+    elif hasattr(obj, \"__slots__\"):\n+        for slot in obj.__slots__:\n+            val = getattr(obj, slot, None)\n+            ret[slot] = to_jsonable(val)\n+    elif isinstance(obj, list):\n+        ret = [to_jsonable(a) for a in obj]\n+    elif isinstance(obj, bytes):\n+        ret = obj.hex()\n+    else:\n+        ret = obj\n+    return ret\n+\n+\n+def process_file(path: Path, messages: List[Any], recv: bool) -> None:\n+    with open(path, 'rb') as f_in:\n+        while True:\n+            tmp_header = f_in.read(TIME_SIZE + LENGTH_SIZE + COMMAND_SIZE)\n+            if not tmp_header:\n+                break\n+            tmp_header = BytesIO(tmp_header)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\") # type: int\n+            command = tmp_header.read(COMMAND_SIZE).split(b'\\x00', 1)[0]  # type: bytes\n+            length = int.from_bytes(tmp_header.read(LENGTH_SIZE), \"little\") # type: int\n+            if command not in MESSAGEMAP:\n+                continue    # For now just skip unrecognized messages\n+            msg = MESSAGEMAP[command]()\n+            msg.deserialize(f_in)\n+            msg_dict = to_jsonable(msg)\n+            msg_dict[\"time\"] = time\n+            msg_dict[\"length\"] = length\n+            msg_dict[\"recv\"] = recv\n+            messages.append(msg_dict)\n+\n+\n+def main():\n+    \"\"\"Main\"\"\"\n+    parser = argparse.ArgumentParser(\n+        description=__doc__,\n+        epilog=\"EXAMPLE \\n\\tpython contrib/peer-logging/peer-logging-parser.py -o out.json <data-dir>/peer_logging/**/*.dat\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r459000213",
      "id" : 459000213,
      "in_reply_to_id" : 454153812,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTAwMDIxMw==",
      "original_commit_id" : "dc393b30e97f743c1e58ce94051c4f4f918beb70",
      "original_line" : 67,
      "original_position" : 67,
      "original_start_line" : null,
      "path" : "contrib/peer-logging/peer-logging-parser.py",
      "position" : null,
      "pull_request_review_id" : 453581023,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459000213",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r459000283"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459000283"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "A test is in the works",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-22T18:33:30Z",
      "diff_hunk" : "@@ -0,0 +1,91 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message log binary files.  To be used in conjunction with -logmessages.\"\"\"\n+\n+import argparse\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List\n+\n+sys.path.append('test/functional')\n+\n+from test_framework.mininode import MESSAGEMAP\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+COMMAND_SIZE = 12\n+\n+def to_jsonable(obj: Any) -> Any:\n+    ret = {}\n+    # The msg objects don't generally include \"msgtype\" in their __slots__\n+    if hasattr(obj, \"msgtype\"):\n+        ret[\"msgtype\"] = getattr(obj, \"msgtype\", None).decode()\n+    if hasattr(obj, \"__dict__\"):\n+        ret = obj.__dict__\n+    elif hasattr(obj, \"__slots__\"):\n+        for slot in obj.__slots__:\n+            val = getattr(obj, slot, None)\n+            ret[slot] = to_jsonable(val)\n+    elif isinstance(obj, list):\n+        ret = [to_jsonable(a) for a in obj]\n+    elif isinstance(obj, bytes):\n+        ret = obj.hex()\n+    else:\n+        ret = obj\n+    return ret\n+\n+\n+def process_file(path: Path, messages: List[Any], recv: bool) -> None:\n+    with open(path, 'rb') as f_in:\n+        while True:\n+            tmp_header = f_in.read(TIME_SIZE + LENGTH_SIZE + COMMAND_SIZE)\n+            if not tmp_header:\n+                break\n+            tmp_header = BytesIO(tmp_header)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\") # type: int\n+            command = tmp_header.read(COMMAND_SIZE).split(b'\\x00', 1)[0]  # type: bytes\n+            length = int.from_bytes(tmp_header.read(LENGTH_SIZE), \"little\") # type: int\n+            if command not in MESSAGEMAP:\n+                continue    # For now just skip unrecognized messages\n+            msg = MESSAGEMAP[command]()\n+            msg.deserialize(f_in)\n+            msg_dict = to_jsonable(msg)\n+            msg_dict[\"time\"] = time\n+            msg_dict[\"length\"] = length\n+            msg_dict[\"recv\"] = recv\n+            messages.append(msg_dict)\n+\n+\n+def main():\n+    \"\"\"Main\"\"\"\n+    parser = argparse.ArgumentParser(\n+        description=__doc__,\n+        epilog=\"EXAMPLE \\n\\tpython contrib/peer-logging/peer-logging-parser.py -o out.json <data-dir>/peer_logging/**/*.dat\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r459000283",
      "id" : 459000283,
      "in_reply_to_id" : 454153812,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTAwMDI4Mw==",
      "original_commit_id" : "dc393b30e97f743c1e58ce94051c4f4f918beb70",
      "original_line" : 67,
      "original_position" : 67,
      "original_start_line" : null,
      "path" : "contrib/peer-logging/peer-logging-parser.py",
      "position" : null,
      "pull_request_review_id" : 453581112,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459000283",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r459000374"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459000374"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-22T18:33:39Z",
      "diff_hunk" : "@@ -2813,6 +2813,8 @@ void CConnman::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n \n         if (pnode->nSendSize > nSendBufferMaxSize)\n             pnode->fPauseSend = true;\n+        if (gArgs.IsArgSet(\"-logmessages\"))\n+            LogMessage(*pnode, msg.m_type, msg.data, false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r459000374",
      "id" : 459000374,
      "in_reply_to_id" : 457073081,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTAwMDM3NA==",
      "original_commit_id" : "9898fa106229d79772657ae8c4ff4555e8641aad",
      "original_line" : 2817,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 453581216,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459000374",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r459000465"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459000465"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good point!  done",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-22T18:33:47Z",
      "diff_hunk" : "@@ -2865,3 +2867,23 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void LogMessage(const CNode& node, const std::string& command, const std::vector<unsigned char>& data, bool is_incoming)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r459000465",
      "id" : 459000465,
      "in_reply_to_id" : 457075888,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTAwMDQ2NQ==",
      "original_commit_id" : "9898fa106229d79772657ae8c4ff4555e8641aad",
      "original_line" : 2871,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 453581310,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459000465",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`git range-diff master 9898fa1 cbb154e`\r\n\r\n- Trivial Rebase\r\n- Added a commit at the beginning cleaning up PushMessage's and ProcessMessages's if statements\r\n- LogMessage now uses Span\r\n- command -> msg_type\r\n- python import is now relative to file\r\n- other small comments and fixes",
      "created_at" : "2020-07-22T19:03:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-662631024",
      "id" : 662631024,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2MjYzMTAyNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-22T19:03:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/662631024",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r459072714"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459072714"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Please avoid change unrelated lines (unless there are good reasons doing so). It makes it harder to reason about the actual changes if one includes unrelated whitespace changes in the same commit :)\r\n\r\nApplies also below and throughout this PR.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-22T20:46:03Z",
      "diff_hunk" : "@@ -2811,18 +2811,17 @@ void CConnman::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n         pnode->mapSendBytesPerMsgCmd[msg.m_type] += nTotalSize;\n         pnode->nSendSize += nTotalSize;\n \n-        if (pnode->nSendSize > nSendBufferMaxSize)\n-            pnode->fPauseSend = true;\n+        if (pnode->nSendSize > nSendBufferMaxSize) pnode->fPauseSend = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r459072714",
      "id" : 459072714,
      "line" : 2885,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTA3MjcxNA==",
      "original_commit_id" : "cbb154e5d5b001b8e940be49a9692e2f6e27e29c",
      "original_line" : 2885,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 16,
      "pull_request_review_id" : 453671898,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459072714",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r459075159"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459075159"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same here (and below): don't change unrelated lines :)",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-22T20:50:44Z",
      "diff_hunk" : "@@ -3648,14 +3648,12 @@ bool PeerLogicValidation::ProcessMessages(CNode* pfrom, std::atomic<bool>& inter\n     if (!pfrom->orphan_work_set.empty()) return true;\n \n     // Don't bother if send buffer is too full to respond anyway\n-    if (pfrom->fPauseSend)\n-        return false;\n+    if (pfrom->fPauseSend) return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r459075159",
      "id" : 459075159,
      "line" : 4031,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTA3NTE1OQ==",
      "original_commit_id" : "cbb154e5d5b001b8e940be49a9692e2f6e27e29c",
      "original_line" : 4031,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 6,
      "pull_request_review_id" : 453671898,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459075159",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r459179239"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459179239"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I made these changes in response to [this comment](https://github.com/bitcoin/bitcoin/pull/19509#discussion_r457072901).  As far as I can tell they're all in the first commit 84a79d61cef5c9386597869adccda4aa5992cc96 (which only contains the unrelated changes), and they don't show up at all in `git range-diff master 9898fa1 cbb154e`.  i.e. on my machine I haven't mixed any real changes with whitespace changes.\r\n\r\nAre you seeing something different?  Is there a better way I could have done this?",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-23T02:05:34Z",
      "diff_hunk" : "@@ -2811,18 +2811,17 @@ void CConnman::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n         pnode->mapSendBytesPerMsgCmd[msg.m_type] += nTotalSize;\n         pnode->nSendSize += nTotalSize;\n \n-        if (pnode->nSendSize > nSendBufferMaxSize)\n-            pnode->fPauseSend = true;\n+        if (pnode->nSendSize > nSendBufferMaxSize) pnode->fPauseSend = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r459179239",
      "id" : 459179239,
      "in_reply_to_id" : 459072714,
      "line" : 2885,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTE3OTIzOQ==",
      "original_commit_id" : "cbb154e5d5b001b8e940be49a9692e2f6e27e29c",
      "original_line" : 2885,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 16,
      "pull_request_review_id" : 453798174,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459179239",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r459347986"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459347986"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This seems reasonable. Although the general advice is to not fix style on lines that you're not otherwise touching, if it's all contained within a single cleanup commit, then I think that's also fine.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-23T10:14:25Z",
      "diff_hunk" : "@@ -2811,18 +2811,17 @@ void CConnman::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n         pnode->mapSendBytesPerMsgCmd[msg.m_type] += nTotalSize;\n         pnode->nSendSize += nTotalSize;\n \n-        if (pnode->nSendSize > nSendBufferMaxSize)\n-            pnode->fPauseSend = true;\n+        if (pnode->nSendSize > nSendBufferMaxSize) pnode->fPauseSend = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r459347986",
      "id" : 459347986,
      "in_reply_to_id" : 459072714,
      "line" : 2885,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM0Nzk4Ng==",
      "original_commit_id" : "cbb154e5d5b001b8e940be49a9692e2f6e27e29c",
      "original_line" : 2885,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 16,
      "pull_request_review_id" : 453999273,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459347986",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r459643471"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459643471"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    for (auto i = msg_type.length(); i < CMessageHeader::COMMAND_SIZE; ++i) {\r\n```\r\n\r\nto fix the compile failure:\r\n\r\n```\r\nnet.cpp:2880:39: error: comparison of integers of different signs: 'int' and 'const size_t' (aka 'const unsigned long') [-Werror,-Wsign-compare]\r\n\r\n    for (int i = msg_type.length(); i < CMessageHeader::COMMAND_SIZE; ++i) {\r\n\r\n                                    ~ ^ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n\r\n1 error generated.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-23T18:23:55Z",
      "diff_hunk" : "@@ -2865,3 +2864,23 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void LogMessage(const CNode& node, const std::string& msg_type, const Span<const unsigned char>& data, bool is_incoming)\n+{\n+    int64_t time = GetTimeMicros();\n+\n+    fs::path base_path = GetDataDir() / \"peer_logging\" / node.addr.ToString();\n+    fs::create_directories(base_path);\n+\n+    fs::path path = base_path / (is_incoming ? \"msgs_recv.dat\" : \"msgs_sent.dat\");\n+    CAutoFile f(fsbridge::fopen(path, \"ab\"), SER_DISK, CLIENT_VERSION);\n+\n+    f.write((const char*)&time, sizeof(time));\n+    f.write(msg_type.data(), msg_type.length());\n+    for (int i = msg_type.length(); i < CMessageHeader::COMMAND_SIZE; ++i) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r459643471",
      "id" : 459643471,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTY0MzQ3MQ==",
      "original_commit_id" : "cbb154e5d5b001b8e940be49a9692e2f6e27e29c",
      "original_line" : 2880,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 454388361,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459643471",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r459655628"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459655628"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm not sure why this didn't come up before, and still doesn't come up on my machine :/  Regardless, fixed.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-23T18:45:29Z",
      "diff_hunk" : "@@ -2865,3 +2864,23 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void LogMessage(const CNode& node, const std::string& msg_type, const Span<const unsigned char>& data, bool is_incoming)\n+{\n+    int64_t time = GetTimeMicros();\n+\n+    fs::path base_path = GetDataDir() / \"peer_logging\" / node.addr.ToString();\n+    fs::create_directories(base_path);\n+\n+    fs::path path = base_path / (is_incoming ? \"msgs_recv.dat\" : \"msgs_sent.dat\");\n+    CAutoFile f(fsbridge::fopen(path, \"ab\"), SER_DISK, CLIENT_VERSION);\n+\n+    f.write((const char*)&time, sizeof(time));\n+    f.write(msg_type.data(), msg_type.length());\n+    for (int i = msg_type.length(); i < CMessageHeader::COMMAND_SIZE; ++i) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r459655628",
      "id" : 459655628,
      "in_reply_to_id" : 459643471,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTY1NTYyOA==",
      "original_commit_id" : "cbb154e5d5b001b8e940be49a9692e2f6e27e29c",
      "original_line" : 2880,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 454403731,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459655628",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`git range-diff master cbb154e 863c6b5`\r\n\r\n- Added Test\r\n- Fixed Travis warning\r\n- Made Time Mockable",
      "created_at" : "2020-07-23T18:47:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-663172100",
      "id" : 663172100,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2MzE3MjEwMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-23T18:47:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/663172100",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r459677362"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459677362"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't know either: #19123",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-23T19:26:02Z",
      "diff_hunk" : "@@ -2865,3 +2864,23 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void LogMessage(const CNode& node, const std::string& msg_type, const Span<const unsigned char>& data, bool is_incoming)\n+{\n+    int64_t time = GetTimeMicros();\n+\n+    fs::path base_path = GetDataDir() / \"peer_logging\" / node.addr.ToString();\n+    fs::create_directories(base_path);\n+\n+    fs::path path = base_path / (is_incoming ? \"msgs_recv.dat\" : \"msgs_sent.dat\");\n+    CAutoFile f(fsbridge::fopen(path, \"ab\"), SER_DISK, CLIENT_VERSION);\n+\n+    f.write((const char*)&time, sizeof(time));\n+    f.write(msg_type.data(), msg_type.length());\n+    for (int i = msg_type.length(); i < CMessageHeader::COMMAND_SIZE; ++i) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r459677362",
      "id" : 459677362,
      "in_reply_to_id" : 459643471,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTY3NzM2Mg==",
      "original_commit_id" : "cbb154e5d5b001b8e940be49a9692e2f6e27e29c",
      "original_line" : 2880,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 454431303,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459677362",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Huge Concept ACK! Very nice idea with simple implementation, I'm also pretty sure this will be very helpful for debugging purposes. Will definitely code-review that within the next days.\r\n\r\nJust one detail I find quite odd: why create two files instead of just one and not rather include the direction as part of the serialization for each message? Is it only about saving disk space (1 byte per message) or is there another reason I'm not aware of? I've never seen a logging/sniffing tool that divides up into multiple files before and tend to think it would only complicate re-assembling the whole send/receive order later.",
      "created_at" : "2020-07-26T19:45:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-664031860",
      "id" : 664031860,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2NDAzMTg2MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-26T19:48:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/664031860",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@theStack Thanks for the concept ACK!\r\n\r\n> why create two files instead of just one\r\n\r\nGood question; I considered a few ways of doing this.  Just to be clear, I create two files _per peer_.  Partially, yes, this saves 1 byte per message.  I could have also just logged everything into one file, which meant I would have had to save the peer address alongside each message as well.  Ultimately, I chose the current way with the intention of simplifying the usage of the parser.  As it stands, the parser is a simple \"just give me what you want me to parse\" sort of program.  This allows the user to take advantage of globbing when selecting which files to parse (e.g. `**/*.dat` or `**/msgs_recv.dat`).  Additionally the parser, being written in python, is actually noticeably slow.  Forcing it to process all of the messages and then filter would be unnecessarily inconvenient.",
      "created_at" : "2020-07-27T12:46:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-664374225",
      "id" : 664374225,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2NDM3NDIyNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-27T12:47:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/664374225",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> > why create two files instead of just one\r\n> \r\n> Good question; I considered a few ways of doing this. Just to be clear, I create two files _per peer_. Partially, yes, this saves 1 byte per message. I could have also just logged everything into one file, which meant I would have had to save the peer address alongside each message as well. Ultimately, I chose the current way with the intention of simplifying the usage of the parser. As it stands, the parser is a simple \"just give me what you want me to parse\" sort of program. This allows the user to take advantage of globbing when selecting which files to parse (e.g. `**/*.dat` or `**/msgs_recv.dat`). Additionally the parser, being written in python, is actually noticeably slow. Forcing it to process all of the messages and then filter would be unnecessarily inconvenient.\r\n\r\nGenerally I'd say it makes sense to divide up into files/folders by criteria that I would likely use as frequent search key for accessing the logging data. Would I often want to access logs for a certain peer? Absolutely. Would I want to see _only_ incoming or outcoming messages for a certain peer? Very unlikely, as the resulting data is probably not very valueable without the whole request/response stream in both directions. On the other hand, your arguments for simplification, efficiency (if only looking for incoming _or_ outcoming messages is really such a frequent operation) and flexibility are also very strong, hence this solution is also okay with me.\r\n\r\nI reviewed the code in more detail and noticed that there may be a serialization endianness problem, see the comments soon following below.\r\n",
      "created_at" : "2020-07-28T12:53:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-665021261",
      "id" : 665021261,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2NTAyMTI2MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-28T12:53:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/665021261",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r461556730"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/461556730"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This way of serialization doesn't seem to be endian-agnostic, i.e. it depends on the architecture whether this is written out in big or little endian format. In the parsing script you assume both time and data size are stored in little endian, hence this needs to be enforced here. I think `ser_writedata32` (see `serialization.h`) can be used for this.\r\nIt's a pity though that the CI tests don't fail, I think this is because we don't have any testing instance where the architecture uses big endian byte order :/",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-28T12:55:24Z",
      "diff_hunk" : "@@ -2861,3 +2861,23 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void LogMessage(const CNode& node, const std::string& msg_type, const Span<const unsigned char>& data, bool is_incoming)\n+{\n+    auto time = GetTime<std::chrono::microseconds>();\n+\n+    fs::path base_path = GetDataDir() / \"peer_logging\" / node.addr.ToString();\n+    fs::create_directories(base_path);\n+\n+    fs::path path = base_path / (is_incoming ? \"msgs_recv.dat\" : \"msgs_sent.dat\");\n+    CAutoFile f(fsbridge::fopen(path, \"ab\"), SER_DISK, CLIENT_VERSION);\n+\n+    f.write((const char*)&time, sizeof(time));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r461556730",
      "id" : 461556730,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTU1NjczMA==",
      "original_commit_id" : "0c31d58f7d5c40a73e9fd67f57acf33a4d45f24a",
      "original_line" : 2875,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 456600960,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/461556730",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r461556757"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/461556757"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Same as above, this should be guaranteed to be written out in little endian byte order.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-28T12:55:28Z",
      "diff_hunk" : "@@ -2861,3 +2861,23 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void LogMessage(const CNode& node, const std::string& msg_type, const Span<const unsigned char>& data, bool is_incoming)\n+{\n+    auto time = GetTime<std::chrono::microseconds>();\n+\n+    fs::path base_path = GetDataDir() / \"peer_logging\" / node.addr.ToString();\n+    fs::create_directories(base_path);\n+\n+    fs::path path = base_path / (is_incoming ? \"msgs_recv.dat\" : \"msgs_sent.dat\");\n+    CAutoFile f(fsbridge::fopen(path, \"ab\"), SER_DISK, CLIENT_VERSION);\n+\n+    f.write((const char*)&time, sizeof(time));\n+    f.write(msg_type.data(), msg_type.length());\n+    for (auto i = msg_type.length(); i < CMessageHeader::COMMAND_SIZE; ++i) {\n+        f << '\\0';\n+    }\n+    uint32_t size = data.size();\n+    f.write((const char*)&size, sizeof(size));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r461556757",
      "id" : 461556757,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTU1Njc1Nw==",
      "original_commit_id" : "0c31d58f7d5c40a73e9fd67f57acf33a4d45f24a",
      "original_line" : 2881,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 456600960,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/461556757",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-run ci",
      "created_at" : "2020-07-28T15:53:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-665122781",
      "id" : 665122781,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2NTEyMjc4MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-28T15:53:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/665122781",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r461724204"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/461724204"
         }
      },
      "author_association" : "MEMBER",
      "body" : "would be good to use assert_equal for debugability \r\n\r\nhttps://travis-ci.org/github/bitcoin/bitcoin/jobs/712616300#L3056",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-28T16:45:10Z",
      "diff_hunk" : "@@ -0,0 +1,69 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test node peer logging capability.\n+\n+Additionally, the output of contrib/peer-logging/peer-logging-parser.py should be verified manually.\n+\"\"\"\n+\n+import glob\n+from io import BytesIO\n+import os\n+\n+from test_framework.mininode import P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+COMMAND_SIZE = 12\n+\n+def mini_parser(dat_file):\n+    \"\"\"Parse a data file created by LogMessage.\n+\n+    From the data file we'll only check the structure.\n+\n+    We won't care about things like:\n+    - Deserializing the payload of the message\n+        - This is managed by the deserialize methods in test_framework.messages\n+    - The order of the messages\n+        - There's no reason why we can't, say, change the order of the messages in the handshake\n+    - Message Type\n+        - We can add new message types\n+\n+    We're ignoring these because they're simply too brittle to test here.\n+    \"\"\"\n+    with open(dat_file, 'rb') as f_in:\n+        while True:\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + COMMAND_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\") # type: int\n+            assert(time >= 1231006505000000)   # genesis block timestamp\n+            command = tmp_header.read(COMMAND_SIZE).split(b'\\x00', 1)[0]  # type: bytes\n+            assert(len(command) > 0)\n+            length = int.from_bytes(tmp_header.read(LENGTH_SIZE), \"little\") # type: int\n+            data = f_in.read(length)\n+            assert(len(data) == length)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r461724204",
      "id" : 461724204,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTcyNDIwNA==",
      "original_commit_id" : "863c6b5aeb08a8769895a3fb08a9adb6753b4567",
      "original_line" : 48,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "test/functional/p2p_peer_logging.py",
      "position" : null,
      "pull_request_review_id" : 456820101,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/461724204",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I don't find your \"why not Wireshark?\" very convincing... If anything, it made me less sure this should get merged.\r\n\r\nWireshark is a fairly simple and standard tool. Glancing at the code, this PR is basically just a less-user-friendly reinvention thereof.\r\n\r\nIf there are concerns with maintenance of the Wireshark dissector, as I understand it, we could fork it and maintain it out of Wireshark's codebase.",
      "created_at" : "2020-07-29T23:50:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-665987681",
      "id" : 665987681,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2NTk4NzY4MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-29T23:50:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/665987681",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r462986846"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/462986846"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-30T13:15:04Z",
      "diff_hunk" : "@@ -2861,3 +2861,23 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void LogMessage(const CNode& node, const std::string& msg_type, const Span<const unsigned char>& data, bool is_incoming)\n+{\n+    auto time = GetTime<std::chrono::microseconds>();\n+\n+    fs::path base_path = GetDataDir() / \"peer_logging\" / node.addr.ToString();\n+    fs::create_directories(base_path);\n+\n+    fs::path path = base_path / (is_incoming ? \"msgs_recv.dat\" : \"msgs_sent.dat\");\n+    CAutoFile f(fsbridge::fopen(path, \"ab\"), SER_DISK, CLIENT_VERSION);\n+\n+    f.write((const char*)&time, sizeof(time));\n+    f.write(msg_type.data(), msg_type.length());\n+    for (auto i = msg_type.length(); i < CMessageHeader::COMMAND_SIZE; ++i) {\n+        f << '\\0';\n+    }\n+    uint32_t size = data.size();\n+    f.write((const char*)&size, sizeof(size));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r462986846",
      "id" : 462986846,
      "in_reply_to_id" : 461556757,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk4Njg0Ng==",
      "original_commit_id" : "0c31d58f7d5c40a73e9fd67f57acf33a4d45f24a",
      "original_line" : 2881,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 458388071,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/462986846",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r462988168"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/462988168"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for catching this!  When fixing it I considered if it was better to instead change the test to follow the system endianness (with python's `sys.byteorder`).  I think fixing a particular endianness for the .dat files, as temporary as they are, is better.  Someone might generate them on a BE system and then parse them on a LE system one day...",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-30T13:17:02Z",
      "diff_hunk" : "@@ -2861,3 +2861,23 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void LogMessage(const CNode& node, const std::string& msg_type, const Span<const unsigned char>& data, bool is_incoming)\n+{\n+    auto time = GetTime<std::chrono::microseconds>();\n+\n+    fs::path base_path = GetDataDir() / \"peer_logging\" / node.addr.ToString();\n+    fs::create_directories(base_path);\n+\n+    fs::path path = base_path / (is_incoming ? \"msgs_recv.dat\" : \"msgs_sent.dat\");\n+    CAutoFile f(fsbridge::fopen(path, \"ab\"), SER_DISK, CLIENT_VERSION);\n+\n+    f.write((const char*)&time, sizeof(time));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r462988168",
      "id" : 462988168,
      "in_reply_to_id" : 461556730,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk4ODE2OA==",
      "original_commit_id" : "0c31d58f7d5c40a73e9fd67f57acf33a4d45f24a",
      "original_line" : 2875,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 458389774,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/462988168",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r462988274"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/462988274"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-30T13:17:11Z",
      "diff_hunk" : "@@ -0,0 +1,69 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test node peer logging capability.\n+\n+Additionally, the output of contrib/peer-logging/peer-logging-parser.py should be verified manually.\n+\"\"\"\n+\n+import glob\n+from io import BytesIO\n+import os\n+\n+from test_framework.mininode import P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+COMMAND_SIZE = 12\n+\n+def mini_parser(dat_file):\n+    \"\"\"Parse a data file created by LogMessage.\n+\n+    From the data file we'll only check the structure.\n+\n+    We won't care about things like:\n+    - Deserializing the payload of the message\n+        - This is managed by the deserialize methods in test_framework.messages\n+    - The order of the messages\n+        - There's no reason why we can't, say, change the order of the messages in the handshake\n+    - Message Type\n+        - We can add new message types\n+\n+    We're ignoring these because they're simply too brittle to test here.\n+    \"\"\"\n+    with open(dat_file, 'rb') as f_in:\n+        while True:\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + COMMAND_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\") # type: int\n+            assert(time >= 1231006505000000)   # genesis block timestamp\n+            command = tmp_header.read(COMMAND_SIZE).split(b'\\x00', 1)[0]  # type: bytes\n+            assert(len(command) > 0)\n+            length = int.from_bytes(tmp_header.read(LENGTH_SIZE), \"little\") # type: int\n+            data = f_in.read(length)\n+            assert(len(data) == length)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r462988274",
      "id" : 462988274,
      "in_reply_to_id" : 461724204,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk4ODI3NA==",
      "original_commit_id" : "863c6b5aeb08a8769895a3fb08a9adb6753b4567",
      "original_line" : 48,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "test/functional/p2p_peer_logging.py",
      "position" : null,
      "pull_request_review_id" : 458389902,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/462988274",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`git range-diff master 863c6b5 f5fffb7`\r\n\r\n- Enforced little-endian writing to match parser\r\n- Test uses `assert_equal` when possible",
      "created_at" : "2020-07-30T13:19:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-666359778",
      "id" : 666359778,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2NjM1OTc3OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-30T13:19:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/666359778",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-07-30T16:25:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-666505365",
      "id" : 666505365,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2NjUwNTM2NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-30T16:25:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/666505365",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "rebased",
      "created_at" : "2020-07-31T00:46:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-666845848",
      "id" : 666845848,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2Njg0NTg0OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-31T00:46:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/666845848",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r463725486"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/463725486"
         }
      },
      "author_association" : "MEMBER",
      "body" : "chmod this to 755 so it's executable.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-31T17:01:48Z",
      "diff_hunk" : "@@ -0,0 +1,92 @@\n+#!/usr/bin/env python3",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r463725486",
      "id" : 463725486,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcyNTQ4Ng==",
      "original_commit_id" : "6095431033a3590fa74761f1bfede4c68a032a88",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "contrib/peer-logging/peer-logging-parser.py",
      "position" : null,
      "pull_request_review_id" : 459324826,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/463725486",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r463725672"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/463725672"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: pep8 says at least 2 spaces before an inline comment :grimacing: ",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-31T17:02:13Z",
      "diff_hunk" : "@@ -0,0 +1,92 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message log binary files.  To be used in conjunction with -logmessages.\"\"\"\n+\n+import argparse\n+import os\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.mininode import MESSAGEMAP  # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+COMMAND_SIZE = 12\n+\n+def to_jsonable(obj: Any) -> Any:\n+    ret = {}    # type: Any\n+    # The msg objects don't generally include \"msgtype\" in their __slots__\n+    if hasattr(obj, \"msgtype\"):\n+        ret[\"msgtype\"] = getattr(obj, \"msgtype\", None).decode()\n+    if hasattr(obj, \"__dict__\"):\n+        ret = obj.__dict__\n+    elif hasattr(obj, \"__slots__\"):\n+        for slot in obj.__slots__:\n+            val = getattr(obj, slot, None)\n+            ret[slot] = to_jsonable(val)\n+    elif isinstance(obj, list):\n+        ret = [to_jsonable(a) for a in obj]\n+    elif isinstance(obj, bytes):\n+        ret = obj.hex()\n+    else:\n+        ret = obj\n+    return ret\n+\n+\n+def process_file(path: Path, messages: List[Any], recv: bool) -> None:\n+    with open(path, 'rb') as f_in:\n+        while True:\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + COMMAND_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\") # type: int",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r463725672",
      "id" : 463725672,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcyNTY3Mg==",
      "original_commit_id" : "6095431033a3590fa74761f1bfede4c68a032a88",
      "original_line" : 50,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "contrib/peer-logging/peer-logging-parser.py",
      "position" : null,
      "pull_request_review_id" : 459324826,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/463725672",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r463725809"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/463725809"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: `is_incoming` can be const",
      "commit_id" : "6095431033a3590fa74761f1bfede4c68a032a88",
      "created_at" : "2020-07-31T17:02:31Z",
      "diff_hunk" : "@@ -1005,4 +1006,6 @@ inline std::chrono::microseconds PoissonNextSend(std::chrono::microseconds now,\n     return std::chrono::microseconds{PoissonNextSend(now.count(), average_interval.count())};\n }\n \n+void LogMessage(const CNode& node, const std::string& msg_type, const Span<const unsigned char>& data, bool is_incoming);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r463725809",
      "id" : 463725809,
      "line" : 1009,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcyNTgwOQ==",
      "original_commit_id" : "6095431033a3590fa74761f1bfede4c68a032a88",
      "original_line" : 1009,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 18,
      "pull_request_review_id" : 459324826,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-31T17:21:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/463725809",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r463731380"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/463731380"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`\"recv\": true` and `\"recv\": false` don't seem very friendly here. Perhaps `\"direction\": \"received\"` and `\"direction\": \"sent\"` is better?",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-31T17:14:44Z",
      "diff_hunk" : "@@ -0,0 +1,92 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message log binary files.  To be used in conjunction with -logmessages.\"\"\"\n+\n+import argparse\n+import os\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.mininode import MESSAGEMAP  # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+COMMAND_SIZE = 12\n+\n+def to_jsonable(obj: Any) -> Any:\n+    ret = {}    # type: Any\n+    # The msg objects don't generally include \"msgtype\" in their __slots__\n+    if hasattr(obj, \"msgtype\"):\n+        ret[\"msgtype\"] = getattr(obj, \"msgtype\", None).decode()\n+    if hasattr(obj, \"__dict__\"):\n+        ret = obj.__dict__\n+    elif hasattr(obj, \"__slots__\"):\n+        for slot in obj.__slots__:\n+            val = getattr(obj, slot, None)\n+            ret[slot] = to_jsonable(val)\n+    elif isinstance(obj, list):\n+        ret = [to_jsonable(a) for a in obj]\n+    elif isinstance(obj, bytes):\n+        ret = obj.hex()\n+    else:\n+        ret = obj\n+    return ret\n+\n+\n+def process_file(path: Path, messages: List[Any], recv: bool) -> None:\n+    with open(path, 'rb') as f_in:\n+        while True:\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + COMMAND_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\") # type: int\n+            command = tmp_header.read(COMMAND_SIZE).split(b'\\x00', 1)[0]  # type: bytes\n+            length = int.from_bytes(tmp_header.read(LENGTH_SIZE), \"little\") # type: int\n+            if command not in MESSAGEMAP:\n+                continue    # For now just skip unrecognized messages\n+            msg = MESSAGEMAP[command]()\n+            msg.deserialize(f_in)\n+            msg_dict = to_jsonable(msg)\n+            msg_dict[\"time\"] = time\n+            msg_dict[\"length\"] = length\n+            msg_dict[\"recv\"] = recv",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r463731380",
      "id" : 463731380,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzczMTM4MA==",
      "original_commit_id" : "6095431033a3590fa74761f1bfede4c68a032a88",
      "original_line" : 60,
      "original_position" : 60,
      "original_start_line" : null,
      "path" : "contrib/peer-logging/peer-logging-parser.py",
      "position" : null,
      "pull_request_review_id" : 459324826,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/463731380",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r463732392"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/463732392"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You should deserialize the body of the message to a sub-object. That means if any message types contain fields called 'msgtype', 'time', 'length' or 'recv', they won't conflict with the metadata.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-07-31T17:16:55Z",
      "diff_hunk" : "@@ -0,0 +1,92 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message log binary files.  To be used in conjunction with -logmessages.\"\"\"\n+\n+import argparse\n+import os\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.mininode import MESSAGEMAP  # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+COMMAND_SIZE = 12\n+\n+def to_jsonable(obj: Any) -> Any:\n+    ret = {}    # type: Any\n+    # The msg objects don't generally include \"msgtype\" in their __slots__\n+    if hasattr(obj, \"msgtype\"):\n+        ret[\"msgtype\"] = getattr(obj, \"msgtype\", None).decode()\n+    if hasattr(obj, \"__dict__\"):\n+        ret = obj.__dict__\n+    elif hasattr(obj, \"__slots__\"):\n+        for slot in obj.__slots__:\n+            val = getattr(obj, slot, None)\n+            ret[slot] = to_jsonable(val)\n+    elif isinstance(obj, list):\n+        ret = [to_jsonable(a) for a in obj]\n+    elif isinstance(obj, bytes):\n+        ret = obj.hex()\n+    else:\n+        ret = obj\n+    return ret\n+\n+\n+def process_file(path: Path, messages: List[Any], recv: bool) -> None:\n+    with open(path, 'rb') as f_in:\n+        while True:\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + COMMAND_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\") # type: int\n+            command = tmp_header.read(COMMAND_SIZE).split(b'\\x00', 1)[0]  # type: bytes\n+            length = int.from_bytes(tmp_header.read(LENGTH_SIZE), \"little\") # type: int\n+            if command not in MESSAGEMAP:\n+                continue    # For now just skip unrecognized messages\n+            msg = MESSAGEMAP[command]()\n+            msg.deserialize(f_in)\n+            msg_dict = to_jsonable(msg)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r463732392",
      "id" : 463732392,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzczMjM5Mg==",
      "original_commit_id" : "6095431033a3590fa74761f1bfede4c68a032a88",
      "original_line" : 57,
      "original_position" : 57,
      "original_start_line" : null,
      "path" : "contrib/peer-logging/peer-logging-parser.py",
      "position" : null,
      "pull_request_review_id" : 459324826,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/463732392",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r465302710"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/465302710"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "oof thanks, TIL\r\n\r\n(I'm surprised nothing caught this)",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-04T20:11:49Z",
      "diff_hunk" : "@@ -0,0 +1,92 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message log binary files.  To be used in conjunction with -logmessages.\"\"\"\n+\n+import argparse\n+import os\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.mininode import MESSAGEMAP  # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+COMMAND_SIZE = 12\n+\n+def to_jsonable(obj: Any) -> Any:\n+    ret = {}    # type: Any\n+    # The msg objects don't generally include \"msgtype\" in their __slots__\n+    if hasattr(obj, \"msgtype\"):\n+        ret[\"msgtype\"] = getattr(obj, \"msgtype\", None).decode()\n+    if hasattr(obj, \"__dict__\"):\n+        ret = obj.__dict__\n+    elif hasattr(obj, \"__slots__\"):\n+        for slot in obj.__slots__:\n+            val = getattr(obj, slot, None)\n+            ret[slot] = to_jsonable(val)\n+    elif isinstance(obj, list):\n+        ret = [to_jsonable(a) for a in obj]\n+    elif isinstance(obj, bytes):\n+        ret = obj.hex()\n+    else:\n+        ret = obj\n+    return ret\n+\n+\n+def process_file(path: Path, messages: List[Any], recv: bool) -> None:\n+    with open(path, 'rb') as f_in:\n+        while True:\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + COMMAND_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\") # type: int",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r465302710",
      "id" : 465302710,
      "in_reply_to_id" : 463725672,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTMwMjcxMA==",
      "original_commit_id" : "6095431033a3590fa74761f1bfede4c68a032a88",
      "original_line" : 50,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "contrib/peer-logging/peer-logging-parser.py",
      "position" : null,
      "pull_request_review_id" : 461138138,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/465302710",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r465307759"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/465307759"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'll meet you in the middle and do `\"direction\": \"recv\"` and `\"direction\": \"sent\"` :)",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-04T20:21:36Z",
      "diff_hunk" : "@@ -0,0 +1,92 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message log binary files.  To be used in conjunction with -logmessages.\"\"\"\n+\n+import argparse\n+import os\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.mininode import MESSAGEMAP  # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+COMMAND_SIZE = 12\n+\n+def to_jsonable(obj: Any) -> Any:\n+    ret = {}    # type: Any\n+    # The msg objects don't generally include \"msgtype\" in their __slots__\n+    if hasattr(obj, \"msgtype\"):\n+        ret[\"msgtype\"] = getattr(obj, \"msgtype\", None).decode()\n+    if hasattr(obj, \"__dict__\"):\n+        ret = obj.__dict__\n+    elif hasattr(obj, \"__slots__\"):\n+        for slot in obj.__slots__:\n+            val = getattr(obj, slot, None)\n+            ret[slot] = to_jsonable(val)\n+    elif isinstance(obj, list):\n+        ret = [to_jsonable(a) for a in obj]\n+    elif isinstance(obj, bytes):\n+        ret = obj.hex()\n+    else:\n+        ret = obj\n+    return ret\n+\n+\n+def process_file(path: Path, messages: List[Any], recv: bool) -> None:\n+    with open(path, 'rb') as f_in:\n+        while True:\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + COMMAND_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\") # type: int\n+            command = tmp_header.read(COMMAND_SIZE).split(b'\\x00', 1)[0]  # type: bytes\n+            length = int.from_bytes(tmp_header.read(LENGTH_SIZE), \"little\") # type: int\n+            if command not in MESSAGEMAP:\n+                continue    # For now just skip unrecognized messages\n+            msg = MESSAGEMAP[command]()\n+            msg.deserialize(f_in)\n+            msg_dict = to_jsonable(msg)\n+            msg_dict[\"time\"] = time\n+            msg_dict[\"length\"] = length\n+            msg_dict[\"recv\"] = recv",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r465307759",
      "id" : 465307759,
      "in_reply_to_id" : 463731380,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTMwNzc1OQ==",
      "original_commit_id" : "6095431033a3590fa74761f1bfede4c68a032a88",
      "original_line" : 60,
      "original_position" : 60,
      "original_start_line" : null,
      "path" : "contrib/peer-logging/peer-logging-parser.py",
      "position" : null,
      "pull_request_review_id" : 461144991,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/465307759",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r465310100"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/465310100"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-04T20:26:23Z",
      "diff_hunk" : "@@ -0,0 +1,92 @@\n+#!/usr/bin/env python3",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r465310100",
      "id" : 465310100,
      "in_reply_to_id" : 463725486,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTMxMDEwMA==",
      "original_commit_id" : "6095431033a3590fa74761f1bfede4c68a032a88",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "contrib/peer-logging/peer-logging-parser.py",
      "position" : null,
      "pull_request_review_id" : 461147857,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/465310100",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r465310222"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/465310222"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done, and improved the names and order",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-04T20:26:40Z",
      "diff_hunk" : "@@ -0,0 +1,92 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message log binary files.  To be used in conjunction with -logmessages.\"\"\"\n+\n+import argparse\n+import os\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.mininode import MESSAGEMAP  # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+COMMAND_SIZE = 12\n+\n+def to_jsonable(obj: Any) -> Any:\n+    ret = {}    # type: Any\n+    # The msg objects don't generally include \"msgtype\" in their __slots__\n+    if hasattr(obj, \"msgtype\"):\n+        ret[\"msgtype\"] = getattr(obj, \"msgtype\", None).decode()\n+    if hasattr(obj, \"__dict__\"):\n+        ret = obj.__dict__\n+    elif hasattr(obj, \"__slots__\"):\n+        for slot in obj.__slots__:\n+            val = getattr(obj, slot, None)\n+            ret[slot] = to_jsonable(val)\n+    elif isinstance(obj, list):\n+        ret = [to_jsonable(a) for a in obj]\n+    elif isinstance(obj, bytes):\n+        ret = obj.hex()\n+    else:\n+        ret = obj\n+    return ret\n+\n+\n+def process_file(path: Path, messages: List[Any], recv: bool) -> None:\n+    with open(path, 'rb') as f_in:\n+        while True:\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + COMMAND_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\") # type: int\n+            command = tmp_header.read(COMMAND_SIZE).split(b'\\x00', 1)[0]  # type: bytes\n+            length = int.from_bytes(tmp_header.read(LENGTH_SIZE), \"little\") # type: int\n+            if command not in MESSAGEMAP:\n+                continue    # For now just skip unrecognized messages\n+            msg = MESSAGEMAP[command]()\n+            msg.deserialize(f_in)\n+            msg_dict = to_jsonable(msg)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r465310222",
      "id" : 465310222,
      "in_reply_to_id" : 463732392,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTMxMDIyMg==",
      "original_commit_id" : "6095431033a3590fa74761f1bfede4c68a032a88",
      "original_line" : 57,
      "original_position" : 57,
      "original_start_line" : null,
      "path" : "contrib/peer-logging/peer-logging-parser.py",
      "position" : null,
      "pull_request_review_id" : 461148006,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/465310222",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`git range-diff master 6095431 8e165ac`\r\n\r\n  * Values coming from `uint256` variables print as hex correctly\r\n  * Restructured the output, renamed some fields\r\n  * Some whitespace fixes\r\n  * Small change to `msg_generic` (unused) in `messages.py`",
      "created_at" : "2020-08-04T20:28:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-668808754",
      "id" : 668808754,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2ODgwODc1NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-04T20:28:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/668808754",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`git range-diff master 6095431 0547b23`\r\n\r\n  * Values coming from `uint256` variables print as hex correctly\r\n  * Restructured the output, renamed some fields\r\n  * Some whitespace fixes\r\n  * Small change to `msg_generic` (unused) in `messages.py`",
      "created_at" : "2020-08-05T14:21:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-669222105",
      "id" : 669222105,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2OTIyMjEwNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-05T14:21:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/669222105",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r465770624"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/465770624"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Instead of reimplementing the parser here, couldn't this just call `contrib/peer-logging/peer-logging-parser.py {dat_file}`?",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-05T14:31:14Z",
      "diff_hunk" : "@@ -0,0 +1,70 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test node peer logging capability.\n+\n+Additionally, the output of contrib/peer-logging/peer-logging-parser.py should be verified manually.\n+\"\"\"\n+\n+import glob\n+from io import BytesIO\n+import os\n+\n+from test_framework.mininode import P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+COMMAND_SIZE = 12\n+\n+def mini_parser(dat_file):\n+    \"\"\"Parse a data file created by LogMessage.\n+\n+    From the data file we'll only check the structure.\n+\n+    We won't care about things like:\n+    - Deserializing the payload of the message\n+        - This is managed by the deserialize methods in test_framework.messages\n+    - The order of the messages\n+        - There's no reason why we can't, say, change the order of the messages in the handshake\n+    - Message Type\n+        - We can add new message types\n+\n+    We're ignoring these because they're simply too brittle to test here.\n+    \"\"\"\n+    with open(dat_file, 'rb') as f_in:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r465770624",
      "id" : 465770624,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTc3MDYyNA==",
      "original_commit_id" : "0547b23754b193e45ba722e555f97f2dd60dd1b5",
      "original_line" : 37,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "test/functional/p2p_peer_logging.py",
      "position" : null,
      "pull_request_review_id" : 461722878,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/465770624",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r466248108"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466248108"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think the cast to `size_t` is not needed here? `msg.m_recv` is an instance of `CDataStream`, its `size()` method returns `CDataStream::size_type` which is a typedef to a `std::vector::size_type`, which again is `size_t`.\r\n```suggestion\r\n        LogMessage(*pfrom, msg.m_command, Span<const unsigned char>{(unsigned char*)msg.m_recv.data(), msg.m_recv.size()}, /* incoming */ true);\r\n```",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-06T08:52:03Z",
      "diff_hunk" : "@@ -3804,6 +3804,10 @@ bool PeerLogicValidation::ProcessMessages(CNode* pfrom, std::atomic<bool>& inter\n     }\n     CNetMessage& msg(msgs.front());\n \n+    if (gArgs.IsArgSet(\"-logmessages\")) {\n+        LogMessage(*pfrom, msg.m_command, Span<const unsigned char>{(unsigned char*)msg.m_recv.data(), (size_t)msg.m_recv.size()}, /* incoming */ true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r466248108",
      "id" : 466248108,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjI0ODEwOA==",
      "original_commit_id" : "fac22eae7ce14cac4e7ab364325165ee8f7fa1ff",
      "original_line" : 3808,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 462312851,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466248108",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r466255925"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466255925"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The \"command\" terminology should not be used anymore for network messages, we just call it \"message type\" now (see e.g. PRs https://github.com/bitcoin/bitcoin/pull/18533, https://github.com/bitcoin/bitcoin/pull/18610, https://github.com/bitcoin/bitcoin/pull/18937). Replacement suggestions: . s/COMMAND_SIZE/MSGTYPE_SIZE and s/command/msg_type (in the parsing code below).",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-06T09:05:50Z",
      "diff_hunk" : "@@ -0,0 +1,121 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message log binary files.  To be used in conjunction with -logmessages.\"\"\"\n+\n+import argparse\n+import os\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.messages import ser_uint256     # noqa: E402\n+from test_framework.mininode import MESSAGEMAP      # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+COMMAND_SIZE = 12",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r466255925",
      "id" : 466255925,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjI1NTkyNQ==",
      "original_commit_id" : "78959de4b410987e1b1ed07f08bb0adce52ea218",
      "original_line" : 22,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "contrib/peer-logging/peer-logging-parser.py",
      "position" : null,
      "pull_request_review_id" : 462312851,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466255925",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r466279593"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466279593"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "+1 on code deduplication. The included timestamps check (all timestamps are past genesis block) can be done on the result rather than directly in the parser.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-06T09:29:34Z",
      "diff_hunk" : "@@ -0,0 +1,70 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test node peer logging capability.\n+\n+Additionally, the output of contrib/peer-logging/peer-logging-parser.py should be verified manually.\n+\"\"\"\n+\n+import glob\n+from io import BytesIO\n+import os\n+\n+from test_framework.mininode import P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+COMMAND_SIZE = 12\n+\n+def mini_parser(dat_file):\n+    \"\"\"Parse a data file created by LogMessage.\n+\n+    From the data file we'll only check the structure.\n+\n+    We won't care about things like:\n+    - Deserializing the payload of the message\n+        - This is managed by the deserialize methods in test_framework.messages\n+    - The order of the messages\n+        - There's no reason why we can't, say, change the order of the messages in the handshake\n+    - Message Type\n+        - We can add new message types\n+\n+    We're ignoring these because they're simply too brittle to test here.\n+    \"\"\"\n+    with open(dat_file, 'rb') as f_in:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r466279593",
      "id" : 466279593,
      "in_reply_to_id" : 465770624,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjI3OTU5Mw==",
      "original_commit_id" : "0547b23754b193e45ba722e555f97f2dd60dd1b5",
      "original_line" : 37,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "test/functional/p2p_peer_logging.py",
      "position" : null,
      "pull_request_review_id" : 462312851,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466279593",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r466284790"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466284790"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "For skipping unrecognized messages, I think a dummy read on `f_in` (`length` bytes) is missing here to advance the file pointer to the next message.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-06T09:33:52Z",
      "diff_hunk" : "@@ -0,0 +1,121 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message log binary files.  To be used in conjunction with -logmessages.\"\"\"\n+\n+import argparse\n+import os\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.messages import ser_uint256     # noqa: E402\n+from test_framework.mininode import MESSAGEMAP      # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+COMMAND_SIZE = 12\n+\n+# The test framework classes stores hashes as large ints in many cases.\n+# There isn't a way to distinguish between a large int and a large int that is actually a blob of bytes.\n+# As such, they are itemized here\n+# (These can be easily found by looking for calls to deser_uint256, deser_uint256_vector, and uint256_from_str in messages.py)\n+HASH_INTS = [\n+    \"blockhash\",\n+    \"block_hash\",\n+    \"hash\",     # A few conflicts here\n+    \"hashMerkleRoot\",\n+    \"hashPrevBlock\",\n+    \"hashstop\",\n+    \"prev_header\",\n+    \"sha256\",\n+    \"stop_hash\",\n+]\n+\n+HASH_INT_VECTORS = [\n+    \"hashes\",\n+    \"headers\",  # One conflict here\n+    \"vHave\",\n+    \"vHash\",\n+]\n+\n+def to_jsonable(obj: Any) -> Any:\n+    if hasattr(obj, \"__dict__\"):\n+        return obj.__dict__\n+    elif hasattr(obj, \"__slots__\"):\n+        ret = {}    # type: Any\n+        for slot in obj.__slots__:\n+            val = getattr(obj, slot, None)\n+            if slot in HASH_INTS and isinstance(val, int):\n+                ret[slot] = ser_uint256(val).hex()\n+            elif slot in HASH_INT_VECTORS and isinstance(val[0], int):\n+                ret[slot] = [ser_uint256(a).hex() for a in val]\n+            else:\n+                ret[slot] = to_jsonable(val)\n+        return ret\n+    elif isinstance(obj, list):\n+        return [to_jsonable(a) for a in obj]\n+    elif isinstance(obj, bytes):\n+        return obj.hex()\n+    else:\n+        return obj\n+\n+\n+def process_file(path: Path, messages: List[Any], recv: bool) -> None:\n+    with open(path, 'rb') as f_in:\n+        while True:\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + COMMAND_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int\n+            command = tmp_header.read(COMMAND_SIZE).split(b'\\x00', 1)[0]     # type: bytes\n+            length = int.from_bytes(tmp_header.read(LENGTH_SIZE), \"little\")  # type: int\n+            if command not in MESSAGEMAP:\n+                continue    # For now just skip unrecognized messages",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r466284790",
      "id" : 466284790,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjI4NDc5MA==",
      "original_commit_id" : "78959de4b410987e1b1ed07f08bb0adce52ea218",
      "original_line" : 80,
      "original_position" : 80,
      "original_start_line" : 79,
      "path" : "contrib/peer-logging/peer-logging-parser.py",
      "position" : null,
      "pull_request_review_id" : 462312851,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466284790",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r466302307"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466302307"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think it's much better not to assume that the contrib directory is available. Functional tests can be run when the build directory is out of tree and the source directory is not available. It makes sense to me to have a limited parser in the test case rather than importing from somewhere else.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-06T09:58:11Z",
      "diff_hunk" : "@@ -0,0 +1,70 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test node peer logging capability.\n+\n+Additionally, the output of contrib/peer-logging/peer-logging-parser.py should be verified manually.\n+\"\"\"\n+\n+import glob\n+from io import BytesIO\n+import os\n+\n+from test_framework.mininode import P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+COMMAND_SIZE = 12\n+\n+def mini_parser(dat_file):\n+    \"\"\"Parse a data file created by LogMessage.\n+\n+    From the data file we'll only check the structure.\n+\n+    We won't care about things like:\n+    - Deserializing the payload of the message\n+        - This is managed by the deserialize methods in test_framework.messages\n+    - The order of the messages\n+        - There's no reason why we can't, say, change the order of the messages in the handshake\n+    - Message Type\n+        - We can add new message types\n+\n+    We're ignoring these because they're simply too brittle to test here.\n+    \"\"\"\n+    with open(dat_file, 'rb') as f_in:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r466302307",
      "id" : 466302307,
      "in_reply_to_id" : 465770624,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjMwMjMwNw==",
      "original_commit_id" : "0547b23754b193e45ba722e555f97f2dd60dd1b5",
      "original_line" : 37,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "test/functional/p2p_peer_logging.py",
      "position" : null,
      "pull_request_review_id" : 462377533,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466302307",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r466306326"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466306326"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Could check here after the deserialization if the `f_in` was advanced by the expected `length` (what is currently done in the functional test), e.g. something like:\r\n```\r\n            msg_start_pos = f_in.tell()\r\n            ...\r\n            msg.deserialize(f_in)\r\n            ...\r\n            msg_length = f_in.tell() - msg_start_pos\r\n            assert_equal(length, msg_length)\r\n```",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-06T10:05:24Z",
      "diff_hunk" : "@@ -0,0 +1,121 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message log binary files.  To be used in conjunction with -logmessages.\"\"\"\n+\n+import argparse\n+import os\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.messages import ser_uint256     # noqa: E402\n+from test_framework.mininode import MESSAGEMAP      # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+COMMAND_SIZE = 12\n+\n+# The test framework classes stores hashes as large ints in many cases.\n+# There isn't a way to distinguish between a large int and a large int that is actually a blob of bytes.\n+# As such, they are itemized here\n+# (These can be easily found by looking for calls to deser_uint256, deser_uint256_vector, and uint256_from_str in messages.py)\n+HASH_INTS = [\n+    \"blockhash\",\n+    \"block_hash\",\n+    \"hash\",     # A few conflicts here\n+    \"hashMerkleRoot\",\n+    \"hashPrevBlock\",\n+    \"hashstop\",\n+    \"prev_header\",\n+    \"sha256\",\n+    \"stop_hash\",\n+]\n+\n+HASH_INT_VECTORS = [\n+    \"hashes\",\n+    \"headers\",  # One conflict here\n+    \"vHave\",\n+    \"vHash\",\n+]\n+\n+def to_jsonable(obj: Any) -> Any:\n+    if hasattr(obj, \"__dict__\"):\n+        return obj.__dict__\n+    elif hasattr(obj, \"__slots__\"):\n+        ret = {}    # type: Any\n+        for slot in obj.__slots__:\n+            val = getattr(obj, slot, None)\n+            if slot in HASH_INTS and isinstance(val, int):\n+                ret[slot] = ser_uint256(val).hex()\n+            elif slot in HASH_INT_VECTORS and isinstance(val[0], int):\n+                ret[slot] = [ser_uint256(a).hex() for a in val]\n+            else:\n+                ret[slot] = to_jsonable(val)\n+        return ret\n+    elif isinstance(obj, list):\n+        return [to_jsonable(a) for a in obj]\n+    elif isinstance(obj, bytes):\n+        return obj.hex()\n+    else:\n+        return obj\n+\n+\n+def process_file(path: Path, messages: List[Any], recv: bool) -> None:\n+    with open(path, 'rb') as f_in:\n+        while True:\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + COMMAND_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int\n+            command = tmp_header.read(COMMAND_SIZE).split(b'\\x00', 1)[0]     # type: bytes\n+            length = int.from_bytes(tmp_header.read(LENGTH_SIZE), \"little\")  # type: int\n+            if command not in MESSAGEMAP:\n+                continue    # For now just skip unrecognized messages\n+            msg = MESSAGEMAP[command]()\n+            msg.deserialize(f_in)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r466306326",
      "id" : 466306326,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjMwNjMyNg==",
      "original_commit_id" : "78959de4b410987e1b1ed07f08bb0adce52ea218",
      "original_line" : 82,
      "original_position" : 82,
      "original_start_line" : null,
      "path" : "contrib/peer-logging/peer-logging-parser.py",
      "position" : null,
      "pull_request_review_id" : 462382512,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466306326",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r466318870"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466318870"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I agree that the dependency on the contrib directory is a drawback, but then on the other hand we already have a test importing from contrib: `feature_loadblock.py` (uses `contrib/linearize` scripts). Is there really a need to run functional tests without the other sources available? They are all part of the same repository.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-06T10:30:26Z",
      "diff_hunk" : "@@ -0,0 +1,70 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test node peer logging capability.\n+\n+Additionally, the output of contrib/peer-logging/peer-logging-parser.py should be verified manually.\n+\"\"\"\n+\n+import glob\n+from io import BytesIO\n+import os\n+\n+from test_framework.mininode import P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+COMMAND_SIZE = 12\n+\n+def mini_parser(dat_file):\n+    \"\"\"Parse a data file created by LogMessage.\n+\n+    From the data file we'll only check the structure.\n+\n+    We won't care about things like:\n+    - Deserializing the payload of the message\n+        - This is managed by the deserialize methods in test_framework.messages\n+    - The order of the messages\n+        - There's no reason why we can't, say, change the order of the messages in the handshake\n+    - Message Type\n+        - We can add new message types\n+\n+    We're ignoring these because they're simply too brittle to test here.\n+    \"\"\"\n+    with open(dat_file, 'rb') as f_in:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r466318870",
      "id" : 466318870,
      "in_reply_to_id" : 465770624,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjMxODg3MA==",
      "original_commit_id" : "0547b23754b193e45ba722e555f97f2dd60dd1b5",
      "original_line" : 37,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "test/functional/p2p_peer_logging.py",
      "position" : null,
      "pull_request_review_id" : 462397981,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466318870",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r466323684"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466323684"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Is there really a need to run functional tests without the other sources available?\r\n\r\nYes, it's an explicit usage pattern to build out of tree and be able to run tests separately from the source directory.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-06T10:40:29Z",
      "diff_hunk" : "@@ -0,0 +1,70 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test node peer logging capability.\n+\n+Additionally, the output of contrib/peer-logging/peer-logging-parser.py should be verified manually.\n+\"\"\"\n+\n+import glob\n+from io import BytesIO\n+import os\n+\n+from test_framework.mininode import P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+COMMAND_SIZE = 12\n+\n+def mini_parser(dat_file):\n+    \"\"\"Parse a data file created by LogMessage.\n+\n+    From the data file we'll only check the structure.\n+\n+    We won't care about things like:\n+    - Deserializing the payload of the message\n+        - This is managed by the deserialize methods in test_framework.messages\n+    - The order of the messages\n+        - There's no reason why we can't, say, change the order of the messages in the handshake\n+    - Message Type\n+        - We can add new message types\n+\n+    We're ignoring these because they're simply too brittle to test here.\n+    \"\"\"\n+    with open(dat_file, 'rb') as f_in:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r466323684",
      "id" : 466323684,
      "in_reply_to_id" : 465770624,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjMyMzY4NA==",
      "original_commit_id" : "0547b23754b193e45ba722e555f97f2dd60dd1b5",
      "original_line" : 37,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "test/functional/p2p_peer_logging.py",
      "position" : null,
      "pull_request_review_id" : 462404054,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466323684",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r466357165"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466357165"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hm, so the usage pattern in this case is \"copy the `test/functional` folder somewhere\" and executing from there, decoupled from the repository, should still work? Still not convinced why anyone should ever want/do that (maybe I'm missing something there).",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-06T11:51:25Z",
      "diff_hunk" : "@@ -0,0 +1,70 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test node peer logging capability.\n+\n+Additionally, the output of contrib/peer-logging/peer-logging-parser.py should be verified manually.\n+\"\"\"\n+\n+import glob\n+from io import BytesIO\n+import os\n+\n+from test_framework.mininode import P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+COMMAND_SIZE = 12\n+\n+def mini_parser(dat_file):\n+    \"\"\"Parse a data file created by LogMessage.\n+\n+    From the data file we'll only check the structure.\n+\n+    We won't care about things like:\n+    - Deserializing the payload of the message\n+        - This is managed by the deserialize methods in test_framework.messages\n+    - The order of the messages\n+        - There's no reason why we can't, say, change the order of the messages in the handshake\n+    - Message Type\n+        - We can add new message types\n+\n+    We're ignoring these because they're simply too brittle to test here.\n+    \"\"\"\n+    with open(dat_file, 'rb') as f_in:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r466357165",
      "id" : 466357165,
      "in_reply_to_id" : 465770624,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjM1NzE2NQ==",
      "original_commit_id" : "0547b23754b193e45ba722e555f97f2dd60dd1b5",
      "original_line" : 37,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "test/functional/p2p_peer_logging.py",
      "position" : null,
      "pull_request_review_id" : 462445547,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466357165",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r466377977"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466377977"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Search for \"out of tree builds\" in this repo. You'll see lots of issues/PRs for running tests out of tree.\r\n\r\n> I agree that the dependency on the contrib directory is a drawback, but then on the other hand we already have a test importing from contrib: feature_loadblock.py (uses contrib/linearize scripts).\r\n\r\nYes, and I think that's a terrible pattern that we shouldn't repeat. Importing code from contrib essentially makes those files part of the test framework.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-06T12:32:17Z",
      "diff_hunk" : "@@ -0,0 +1,70 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test node peer logging capability.\n+\n+Additionally, the output of contrib/peer-logging/peer-logging-parser.py should be verified manually.\n+\"\"\"\n+\n+import glob\n+from io import BytesIO\n+import os\n+\n+from test_framework.mininode import P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+COMMAND_SIZE = 12\n+\n+def mini_parser(dat_file):\n+    \"\"\"Parse a data file created by LogMessage.\n+\n+    From the data file we'll only check the structure.\n+\n+    We won't care about things like:\n+    - Deserializing the payload of the message\n+        - This is managed by the deserialize methods in test_framework.messages\n+    - The order of the messages\n+        - There's no reason why we can't, say, change the order of the messages in the handshake\n+    - Message Type\n+        - We can add new message types\n+\n+    We're ignoring these because they're simply too brittle to test here.\n+    \"\"\"\n+    with open(dat_file, 'rb') as f_in:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r466377977",
      "id" : 466377977,
      "in_reply_to_id" : 465770624,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjM3Nzk3Nw==",
      "original_commit_id" : "0547b23754b193e45ba722e555f97f2dd60dd1b5",
      "original_line" : 37,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "test/functional/p2p_peer_logging.py",
      "position" : null,
      "pull_request_review_id" : 462472673,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466377977",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r466392607"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466392607"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I imagine I did this because I had to, but you're right I see no reason for this cast (and clang++ agrees).  Thanks!",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-06T12:58:39Z",
      "diff_hunk" : "@@ -3804,6 +3804,10 @@ bool PeerLogicValidation::ProcessMessages(CNode* pfrom, std::atomic<bool>& inter\n     }\n     CNetMessage& msg(msgs.front());\n \n+    if (gArgs.IsArgSet(\"-logmessages\")) {\n+        LogMessage(*pfrom, msg.m_command, Span<const unsigned char>{(unsigned char*)msg.m_recv.data(), (size_t)msg.m_recv.size()}, /* incoming */ true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r466392607",
      "id" : 466392607,
      "in_reply_to_id" : 466248108,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjM5MjYwNw==",
      "original_commit_id" : "fac22eae7ce14cac4e7ab364325165ee8f7fa1ff",
      "original_line" : 3808,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 462492350,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466392607",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r466394744"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466394744"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for catching this!  This \"command -> message type\" switch is a monumental effort that I'm happy to be a part of.\r\n\r\nI'm going to choose `msgtype` not `msg_type` for the same reasons you did in #18610 :)",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-06T13:02:08Z",
      "diff_hunk" : "@@ -0,0 +1,121 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message log binary files.  To be used in conjunction with -logmessages.\"\"\"\n+\n+import argparse\n+import os\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.messages import ser_uint256     # noqa: E402\n+from test_framework.mininode import MESSAGEMAP      # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+COMMAND_SIZE = 12",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r466394744",
      "id" : 466394744,
      "in_reply_to_id" : 466255925,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjM5NDc0NA==",
      "original_commit_id" : "78959de4b410987e1b1ed07f08bb0adce52ea218",
      "original_line" : 22,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "contrib/peer-logging/peer-logging-parser.py",
      "position" : null,
      "pull_request_review_id" : 462495201,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466394744",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r466397116"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466397116"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It is, thanks!",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-06T13:05:52Z",
      "diff_hunk" : "@@ -0,0 +1,121 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message log binary files.  To be used in conjunction with -logmessages.\"\"\"\n+\n+import argparse\n+import os\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.messages import ser_uint256     # noqa: E402\n+from test_framework.mininode import MESSAGEMAP      # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+COMMAND_SIZE = 12\n+\n+# The test framework classes stores hashes as large ints in many cases.\n+# There isn't a way to distinguish between a large int and a large int that is actually a blob of bytes.\n+# As such, they are itemized here\n+# (These can be easily found by looking for calls to deser_uint256, deser_uint256_vector, and uint256_from_str in messages.py)\n+HASH_INTS = [\n+    \"blockhash\",\n+    \"block_hash\",\n+    \"hash\",     # A few conflicts here\n+    \"hashMerkleRoot\",\n+    \"hashPrevBlock\",\n+    \"hashstop\",\n+    \"prev_header\",\n+    \"sha256\",\n+    \"stop_hash\",\n+]\n+\n+HASH_INT_VECTORS = [\n+    \"hashes\",\n+    \"headers\",  # One conflict here\n+    \"vHave\",\n+    \"vHash\",\n+]\n+\n+def to_jsonable(obj: Any) -> Any:\n+    if hasattr(obj, \"__dict__\"):\n+        return obj.__dict__\n+    elif hasattr(obj, \"__slots__\"):\n+        ret = {}    # type: Any\n+        for slot in obj.__slots__:\n+            val = getattr(obj, slot, None)\n+            if slot in HASH_INTS and isinstance(val, int):\n+                ret[slot] = ser_uint256(val).hex()\n+            elif slot in HASH_INT_VECTORS and isinstance(val[0], int):\n+                ret[slot] = [ser_uint256(a).hex() for a in val]\n+            else:\n+                ret[slot] = to_jsonable(val)\n+        return ret\n+    elif isinstance(obj, list):\n+        return [to_jsonable(a) for a in obj]\n+    elif isinstance(obj, bytes):\n+        return obj.hex()\n+    else:\n+        return obj\n+\n+\n+def process_file(path: Path, messages: List[Any], recv: bool) -> None:\n+    with open(path, 'rb') as f_in:\n+        while True:\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + COMMAND_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int\n+            command = tmp_header.read(COMMAND_SIZE).split(b'\\x00', 1)[0]     # type: bytes\n+            length = int.from_bytes(tmp_header.read(LENGTH_SIZE), \"little\")  # type: int\n+            if command not in MESSAGEMAP:\n+                continue    # For now just skip unrecognized messages",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r466397116",
      "id" : 466397116,
      "in_reply_to_id" : 466284790,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjM5NzExNg==",
      "original_commit_id" : "78959de4b410987e1b1ed07f08bb0adce52ea218",
      "original_line" : 80,
      "original_position" : 80,
      "original_start_line" : 79,
      "path" : "contrib/peer-logging/peer-logging-parser.py",
      "position" : null,
      "pull_request_review_id" : 462498374,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466397116",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r466407938"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466407938"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I like this a lot, thanks",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-06T13:23:02Z",
      "diff_hunk" : "@@ -0,0 +1,121 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message log binary files.  To be used in conjunction with -logmessages.\"\"\"\n+\n+import argparse\n+import os\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.messages import ser_uint256     # noqa: E402\n+from test_framework.mininode import MESSAGEMAP      # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+COMMAND_SIZE = 12\n+\n+# The test framework classes stores hashes as large ints in many cases.\n+# There isn't a way to distinguish between a large int and a large int that is actually a blob of bytes.\n+# As such, they are itemized here\n+# (These can be easily found by looking for calls to deser_uint256, deser_uint256_vector, and uint256_from_str in messages.py)\n+HASH_INTS = [\n+    \"blockhash\",\n+    \"block_hash\",\n+    \"hash\",     # A few conflicts here\n+    \"hashMerkleRoot\",\n+    \"hashPrevBlock\",\n+    \"hashstop\",\n+    \"prev_header\",\n+    \"sha256\",\n+    \"stop_hash\",\n+]\n+\n+HASH_INT_VECTORS = [\n+    \"hashes\",\n+    \"headers\",  # One conflict here\n+    \"vHave\",\n+    \"vHash\",\n+]\n+\n+def to_jsonable(obj: Any) -> Any:\n+    if hasattr(obj, \"__dict__\"):\n+        return obj.__dict__\n+    elif hasattr(obj, \"__slots__\"):\n+        ret = {}    # type: Any\n+        for slot in obj.__slots__:\n+            val = getattr(obj, slot, None)\n+            if slot in HASH_INTS and isinstance(val, int):\n+                ret[slot] = ser_uint256(val).hex()\n+            elif slot in HASH_INT_VECTORS and isinstance(val[0], int):\n+                ret[slot] = [ser_uint256(a).hex() for a in val]\n+            else:\n+                ret[slot] = to_jsonable(val)\n+        return ret\n+    elif isinstance(obj, list):\n+        return [to_jsonable(a) for a in obj]\n+    elif isinstance(obj, bytes):\n+        return obj.hex()\n+    else:\n+        return obj\n+\n+\n+def process_file(path: Path, messages: List[Any], recv: bool) -> None:\n+    with open(path, 'rb') as f_in:\n+        while True:\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + COMMAND_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int\n+            command = tmp_header.read(COMMAND_SIZE).split(b'\\x00', 1)[0]     # type: bytes\n+            length = int.from_bytes(tmp_header.read(LENGTH_SIZE), \"little\")  # type: int\n+            if command not in MESSAGEMAP:\n+                continue    # For now just skip unrecognized messages\n+            msg = MESSAGEMAP[command]()\n+            msg.deserialize(f_in)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r466407938",
      "id" : 466407938,
      "in_reply_to_id" : 466306326,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQwNzkzOA==",
      "original_commit_id" : "78959de4b410987e1b1ed07f08bb0adce52ea218",
      "original_line" : 82,
      "original_position" : 82,
      "original_start_line" : null,
      "path" : "contrib/peer-logging/peer-logging-parser.py",
      "position" : null,
      "pull_request_review_id" : 462512555,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466407938",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`git range-diff master 0547b23 4205c56`\r\n\r\n  * peer logging -> message logging\r\n  * command -> msgtype\r\n  * Removed unneeded `size_t` cast\r\n  * Parser now properly handles unrecognized messages\r\n  * Parser now verified payload length\r\n",
      "created_at" : "2020-08-06T13:58:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-669943836",
      "id" : 669943836,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2OTk0MzgzNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-06T13:58:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/669943836",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Regarding mini_parser in the functional test: discussion [here](https://github.com/bitcoin/bitcoin/pull/19509#discussion_r465770624).  The popular question is \"Why reimplement the parser here, as opposed to just calling `contrib/message-logging/message-logging-parser.py`?\"\r\n\r\nThe main reason, which I agree with, is brought up by @jnewbery.  \r\n\r\n> I think it's much better not to assume that the contrib directory is available. Functional tests can be run when the build directory is out of tree and the source directory is not available. It makes sense to me to have a limited parser in the test case rather than importing from somewhere else.\r\n\r\nAdditionally, I think that this separate mini_parser makes it clear, at a glance, what exactly is being tested.  As noted in the module docstring of `p2p_message_logging.py`, the message logging parser _isn't_ tested in this test.  This test is for LogMessage only.  I would hate to run into a Hubble Space Telescope-like problem where LogMessage is wrong but the message logging parser is wrong in the same way, so the errors go by unnoticed.\r\n",
      "created_at" : "2020-08-06T14:00:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-669945057",
      "id" : 669945057,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2OTk0NTA1Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-06T14:00:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/669945057",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r466528085"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466528085"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Sorry that I didn't noticed on the earlier review today, but: if you rebase on master, this will unlock you the nice `MakeUCharSpan` (see commit e63dcc3a6752e7d406e7a650c2d6c2e95cd39aab, introduced with PR #19326 that was merged 3 days ago), not needing to cast anything anymore. :tada: ",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-06T16:15:27Z",
      "diff_hunk" : "@@ -3804,6 +3804,10 @@ bool PeerLogicValidation::ProcessMessages(CNode* pfrom, std::atomic<bool>& inter\n     }\n     CNetMessage& msg(msgs.front());\n \n+    if (gArgs.IsArgSet(\"-logmessages\")) {\n+        LogMessage(*pfrom, msg.m_command, Span<const unsigned char>{(unsigned char*)msg.m_recv.data(), msg.m_recv.size()}, /* incoming */ true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r466528085",
      "id" : 466528085,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjUyODA4NQ==",
      "original_commit_id" : "6f0e88752d9dcfe551d618e7afb09fd2063fc050",
      "original_line" : 3808,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 462670289,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466528085",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r466988386"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466988386"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "To my understanding the primary point of out of tree builds is separation between the _build artifacts_ (i.e. everything spit out by `make`, like binaries, manpages etc.) and the source folder. I guess our disagreement stems from the fact that in your view, `contrib` is part of the source folder, while in my view it isn't -- it only contains scripts and no compilation units, hence no ending up in an (out of tree) build folder. That could change in the future though, so I can see your point.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-07T11:43:51Z",
      "diff_hunk" : "@@ -0,0 +1,70 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test node peer logging capability.\n+\n+Additionally, the output of contrib/peer-logging/peer-logging-parser.py should be verified manually.\n+\"\"\"\n+\n+import glob\n+from io import BytesIO\n+import os\n+\n+from test_framework.mininode import P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+COMMAND_SIZE = 12\n+\n+def mini_parser(dat_file):\n+    \"\"\"Parse a data file created by LogMessage.\n+\n+    From the data file we'll only check the structure.\n+\n+    We won't care about things like:\n+    - Deserializing the payload of the message\n+        - This is managed by the deserialize methods in test_framework.messages\n+    - The order of the messages\n+        - There's no reason why we can't, say, change the order of the messages in the handshake\n+    - Message Type\n+        - We can add new message types\n+\n+    We're ignoring these because they're simply too brittle to test here.\n+    \"\"\"\n+    with open(dat_file, 'rb') as f_in:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r466988386",
      "id" : 466988386,
      "in_reply_to_id" : 465770624,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njk4ODM4Ng==",
      "original_commit_id" : "0547b23754b193e45ba722e555f97f2dd60dd1b5",
      "original_line" : 37,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "test/functional/p2p_peer_logging.py",
      "position" : null,
      "pull_request_review_id" : 463245822,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466988386",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r466989983"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466989983"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The functional test scripts itself live in the *source* directory. The build directory has a symlink to it. As long as the script in contrib is also symlinked to the build dir, this should not affect out-of-tree builds at all. And all ci scripts use out-of-tree builds, so if this lead to issues, it would be noticed immediately.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-07T11:47:58Z",
      "diff_hunk" : "@@ -0,0 +1,70 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test node peer logging capability.\n+\n+Additionally, the output of contrib/peer-logging/peer-logging-parser.py should be verified manually.\n+\"\"\"\n+\n+import glob\n+from io import BytesIO\n+import os\n+\n+from test_framework.mininode import P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+COMMAND_SIZE = 12\n+\n+def mini_parser(dat_file):\n+    \"\"\"Parse a data file created by LogMessage.\n+\n+    From the data file we'll only check the structure.\n+\n+    We won't care about things like:\n+    - Deserializing the payload of the message\n+        - This is managed by the deserialize methods in test_framework.messages\n+    - The order of the messages\n+        - There's no reason why we can't, say, change the order of the messages in the handshake\n+    - Message Type\n+        - We can add new message types\n+\n+    We're ignoring these because they're simply too brittle to test here.\n+    \"\"\"\n+    with open(dat_file, 'rb') as f_in:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r466989983",
      "id" : 466989983,
      "in_reply_to_id" : 465770624,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njk4OTk4Mw==",
      "original_commit_id" : "0547b23754b193e45ba722e555f97f2dd60dd1b5",
      "original_line" : 37,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "test/functional/p2p_peer_logging.py",
      "position" : null,
      "pull_request_review_id" : 463247867,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/466989983",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r467258687"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/467258687"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks, I'll do this!  Another upcoming improvement is #19660, but I'll try and leave that for a follow-up as not to increase the scope too far here.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-07T20:40:08Z",
      "diff_hunk" : "@@ -3804,6 +3804,10 @@ bool PeerLogicValidation::ProcessMessages(CNode* pfrom, std::atomic<bool>& inter\n     }\n     CNetMessage& msg(msgs.front());\n \n+    if (gArgs.IsArgSet(\"-logmessages\")) {\n+        LogMessage(*pfrom, msg.m_command, Span<const unsigned char>{(unsigned char*)msg.m_recv.data(), msg.m_recv.size()}, /* incoming */ true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r467258687",
      "id" : 467258687,
      "in_reply_to_id" : 466528085,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI1ODY4Nw==",
      "original_commit_id" : "6f0e88752d9dcfe551d618e7afb09fd2063fc050",
      "original_line" : 3808,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 463598152,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/467258687",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r467259378"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/467259378"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I've elaborated on why I did this [below](https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-669945057).  If anyone is still against this choice, please let me know!",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-07T20:41:54Z",
      "diff_hunk" : "@@ -0,0 +1,70 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test node peer logging capability.\n+\n+Additionally, the output of contrib/peer-logging/peer-logging-parser.py should be verified manually.\n+\"\"\"\n+\n+import glob\n+from io import BytesIO\n+import os\n+\n+from test_framework.mininode import P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+COMMAND_SIZE = 12\n+\n+def mini_parser(dat_file):\n+    \"\"\"Parse a data file created by LogMessage.\n+\n+    From the data file we'll only check the structure.\n+\n+    We won't care about things like:\n+    - Deserializing the payload of the message\n+        - This is managed by the deserialize methods in test_framework.messages\n+    - The order of the messages\n+        - There's no reason why we can't, say, change the order of the messages in the handshake\n+    - Message Type\n+        - We can add new message types\n+\n+    We're ignoring these because they're simply too brittle to test here.\n+    \"\"\"\n+    with open(dat_file, 'rb') as f_in:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r467259378",
      "id" : 467259378,
      "in_reply_to_id" : 465770624,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI1OTM3OA==",
      "original_commit_id" : "0547b23754b193e45ba722e555f97f2dd60dd1b5",
      "original_line" : 37,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "test/functional/p2p_peer_logging.py",
      "position" : null,
      "pull_request_review_id" : 463599041,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/467259378",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`git range-diff master 4205c56 555e48a`\r\n\r\n- Rebased (trivial)\r\n- Now uses `MakeUCharSpan` as suggested [here](https://github.com/bitcoin/bitcoin/pull/19509#discussion_r466528085)\r\n- Now accounts for the increase in file descriptor usage (by one)\r\n   - This will be improved in #18911",
      "created_at" : "2020-08-07T21:38:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-670723420",
      "id" : 670723420,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3MDcyMzQyMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-13T23:49:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/670723420",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I tested the logging parser on my system (running Python 3.5.2) and got the following error:\r\n```\r\n$ contrib/message-logging/message-logging-parser.py /tmp/bitcoin_func_test_9sw28m5f/node0/regtest/message_logging/127.0.0.1\\:33370/*.dat\r\n/tmp/bitcoin_func_test_9sw28m5f/node0/regtest/message_logging/127.0.0.1:33370/msgs_recv.dat\r\n<class 'pathlib.PosixPath'>\r\nTraceback (most recent call last):\r\n  File \"contrib/message-logging/message-logging-parser.py\", line 129, in <module>\r\n    main()\r\n  File \"contrib/message-logging/message-logging-parser.py\", line 117, in main\r\n    process_file(log, messages, \"recv\" in log.stem)\r\n  File \"contrib/message-logging/message-logging-parser.py\", line 73, in process_file\r\n    with open(path, 'rb') as f_in:\r\nTypeError: invalid file: PosixPath('/tmp/bitcoin_func_test_9sw28m5f/node0/regtest/message_logging/127.0.0.1:33370/msgs_recv.dat')\r\n```\r\nTurns out that `open()` is capable to take `os.PathLike` objects only from Python 3.6 onwards, see https://stackoverflow.com/a/42694113\r\nSince we are still on Python 3.5 (though there is already a PR for changing to 3.6, see https://github.com/bitcoin/bitcoin/pull/19504), this should be fixed by converting the path to a string by opening `str(path)` instead.",
      "created_at" : "2020-08-11T21:00:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-672276687",
      "id" : 672276687,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3MjI3NjY4Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-11T21:00:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/672276687",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`git range-diff master 555e48a 4fc2e39`\r\n\r\n@theStack thanks for catching that!  I had been running this all under the wrong environment the whole time. (I'll plug `conda` here, never worry about your python environment again: just make sure to pick the right one)\r\n\r\nIn fixing this I ran into a current python bug!\r\nhttps://discuss.python.org/t/pathlib-absolute-vs-resolve/2573\r\n\r\nTL;DR: if you want an absolute path to a file that may not exist, in Python 3.5, **always** use `Path.cwd() / Path(arg)`.  This is due to the \"strictness\" of `resolve()` discussed [here](https://docs.python.org/3/library/pathlib.html#pathlib.Path.resolve).",
      "created_at" : "2020-08-13T23:48:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-673764080",
      "id" : 673764080,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3Mzc2NDA4MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-14T02:27:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/673764080",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@luke-jr says:\r\n> I don't find your \"why not Wireshark?\" very convincing... If anything, it made me less sure this should get merged. Wireshark is a fairly simple and standard tool. Glancing at the code, this PR is basically just a less-user-friendly reinvention thereof. If there are concerns with maintenance of the Wireshark dissector, as I understand it, we could fork it and maintain it out of Wireshark's codebase.\r\n\r\nI'm inclined to agree. Also with a more general system like [tracepoints](https://jb55.com/s/tracepoints.patch.txt) we could do low overhead p2p(& other subsystem) tracing/filtering/[scripting](https://jb55.com/s/ibd.bt.txt) without any [custom code](https://github.com/bitcoin/bitcoin/pull/19509#pullrequestreview-447894982)",
      "created_at" : "2020-08-17T20:10:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-675088137",
      "id" : 675088137,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3NTA4ODEzNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-17T20:10:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/675088137",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r472436516"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472436516"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        # Connect and disconnect a node so that the handshake occurs\r\n```",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-18T19:41:17Z",
      "diff_hunk" : "@@ -0,0 +1,70 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test per-peer message logging capability.\n+\n+Additionally, the output of contrib/message-logging/message-logging-parser.py should be verified manually.\n+\"\"\"\n+\n+import glob\n+from io import BytesIO\n+import os\n+\n+from test_framework.mininode import P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+def mini_parser(dat_file):\n+    \"\"\"Parse a data file created by LogMessage.\n+\n+    From the data file we'll only check the structure.\n+\n+    We won't care about things like:\n+    - Deserializing the payload of the message\n+        - This is managed by the deserialize methods in test_framework.messages\n+    - The order of the messages\n+        - There's no reason why we can't, say, change the order of the messages in the handshake\n+    - Message Type\n+        - We can add new message types\n+\n+    We're ignoring these because they're simply too brittle to test here.\n+    \"\"\"\n+    with open(dat_file, 'rb') as f_in:\n+        while True:\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int\n+            assert(time >= 1231006505000000)   # genesis block timestamp\n+            msgtype = tmp_header.read(MSGTYPE_SIZE).split(b'\\x00', 1)[0]     # type: bytes\n+            assert(len(msgtype) > 0)\n+            length = int.from_bytes(tmp_header.read(LENGTH_SIZE), \"little\")  # type: int\n+            data = f_in.read(length)\n+            assert_equal(len(data), length)\n+\n+\n+class MessageLoggingTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+        self.extra_args = [[\"-logmessages\"]]\n+        self.setup_clean_chain = True\n+\n+    def run_test(self):\n+        logdir = os.path.join(self.nodes[0].datadir, \"regtest/message_logging\")\n+        # Connect an disconnect a node so that the handshake occurs",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r472436516",
      "id" : 472436516,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQzNjUxNg==",
      "original_commit_id" : "4fc2e3906377991a05f78a938c0aa2f04056b81c",
      "original_line" : 60,
      "original_position" : 60,
      "original_start_line" : null,
      "path" : "test/functional/p2p_message_logging.py",
      "position" : null,
      "pull_request_review_id" : 469767134,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472436516",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/755825?v=4",
         "events_url" : "https://api.github.com/users/adamjonas/events{/privacy}",
         "followers_url" : "https://api.github.com/users/adamjonas/followers",
         "following_url" : "https://api.github.com/users/adamjonas/following{/other_user}",
         "gists_url" : "https://api.github.com/users/adamjonas/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/adamjonas",
         "id" : 755825,
         "login" : "adamjonas",
         "node_id" : "MDQ6VXNlcjc1NTgyNQ==",
         "organizations_url" : "https://api.github.com/users/adamjonas/orgs",
         "received_events_url" : "https://api.github.com/users/adamjonas/received_events",
         "repos_url" : "https://api.github.com/users/adamjonas/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/adamjonas/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/adamjonas/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/adamjonas"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r472545184"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472545184"
         }
      },
      "author_association" : "MEMBER",
      "body" : "conflicts with what? ",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-18T23:18:18Z",
      "diff_hunk" : "@@ -0,0 +1,127 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message log binary files.  To be used in conjunction with -logmessages.\"\"\"\n+\n+import argparse\n+import os\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.messages import ser_uint256     # noqa: E402\n+from test_framework.mininode import MESSAGEMAP      # noqa: E402\n+from test_framework.util import assert_equal        # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+# The test framework classes stores hashes as large ints in many cases.\n+# There isn't a way to distinguish between a large int and a large int that is actually a blob of bytes.\n+# As such, they are itemized here\n+# (These can be easily found by looking for calls to deser_uint256, deser_uint256_vector, and uint256_from_str in messages.py)\n+HASH_INTS = [\n+    \"blockhash\",\n+    \"block_hash\",\n+    \"hash\",     # A few conflicts here",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r472545184",
      "id" : 472545184,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjU0NTE4NA==",
      "original_commit_id" : "0d10af73df19de62726065cb63c123fda8c237b1",
      "original_line" : 32,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "contrib/message-logging/message-logging-parser.py",
      "position" : null,
      "pull_request_review_id" : 469892791,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472545184",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r472549706"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472549706"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm not following why this `disconnect_p2ps()` is needed here. The comment above says \"so that the handshake occurs\", but this doesn't clarify anything for me. do you mean the version handshake? why do we need to disconnect for the version handshake to occur?\r\n\r\nmy understanding of this test is that it parses through the sent & received data files to check the structure of each recorded message is valid. I added some logging to see what message types are recorded & from what I can tell its the same whether or not we disconnect. am I missing something? ",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-18T23:31:47Z",
      "diff_hunk" : "@@ -0,0 +1,70 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test per-peer message logging capability.\n+\n+Additionally, the output of contrib/message-logging/message-logging-parser.py should be verified manually.\n+\"\"\"\n+\n+import glob\n+from io import BytesIO\n+import os\n+\n+from test_framework.mininode import P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+def mini_parser(dat_file):\n+    \"\"\"Parse a data file created by LogMessage.\n+\n+    From the data file we'll only check the structure.\n+\n+    We won't care about things like:\n+    - Deserializing the payload of the message\n+        - This is managed by the deserialize methods in test_framework.messages\n+    - The order of the messages\n+        - There's no reason why we can't, say, change the order of the messages in the handshake\n+    - Message Type\n+        - We can add new message types\n+\n+    We're ignoring these because they're simply too brittle to test here.\n+    \"\"\"\n+    with open(dat_file, 'rb') as f_in:\n+        while True:\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int\n+            assert(time >= 1231006505000000)   # genesis block timestamp\n+            msgtype = tmp_header.read(MSGTYPE_SIZE).split(b'\\x00', 1)[0]     # type: bytes\n+            assert(len(msgtype) > 0)\n+            length = int.from_bytes(tmp_header.read(LENGTH_SIZE), \"little\")  # type: int\n+            data = f_in.read(length)\n+            assert_equal(len(data), length)\n+\n+\n+class MessageLoggingTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+        self.extra_args = [[\"-logmessages\"]]\n+        self.setup_clean_chain = True\n+\n+    def run_test(self):\n+        logdir = os.path.join(self.nodes[0].datadir, \"regtest/message_logging\")\n+        # Connect an disconnect a node so that the handshake occurs\n+        self.nodes[0].add_p2p_connection(P2PDataStore())\n+        self.nodes[0].disconnect_p2ps()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r472549706",
      "id" : 472549706,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjU0OTcwNg==",
      "original_commit_id" : "4fc2e3906377991a05f78a938c0aa2f04056b81c",
      "original_line" : 62,
      "original_position" : 62,
      "original_start_line" : null,
      "path" : "test/functional/p2p_message_logging.py",
      "position" : null,
      "pull_request_review_id" : 469892791,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472549706",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r472551723"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472551723"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Might you add something to this affect to the commit title so people know that? I didn't get that from reading \"Clean PushMessage and ProcessMessages\". Maybe \"Whitespace only changes in PushMessage and ProcessMessages\"",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-18T23:38:09Z",
      "diff_hunk" : "@@ -2811,18 +2811,17 @@ void CConnman::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n         pnode->mapSendBytesPerMsgCmd[msg.m_type] += nTotalSize;\n         pnode->nSendSize += nTotalSize;\n \n-        if (pnode->nSendSize > nSendBufferMaxSize)\n-            pnode->fPauseSend = true;\n+        if (pnode->nSendSize > nSendBufferMaxSize) pnode->fPauseSend = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r472551723",
      "id" : 472551723,
      "in_reply_to_id" : 459072714,
      "line" : 2885,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjU1MTcyMw==",
      "original_commit_id" : "cbb154e5d5b001b8e940be49a9692e2f6e27e29c",
      "original_line" : 2885,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 16,
      "pull_request_review_id" : 469900074,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472551723",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/177646?v=4",
         "events_url" : "https://api.github.com/users/narula/events{/privacy}",
         "followers_url" : "https://api.github.com/users/narula/followers",
         "following_url" : "https://api.github.com/users/narula/following{/other_user}",
         "gists_url" : "https://api.github.com/users/narula/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/narula",
         "id" : 177646,
         "login" : "narula",
         "node_id" : "MDQ6VXNlcjE3NzY0Ng==",
         "organizations_url" : "https://api.github.com/users/narula/orgs",
         "received_events_url" : "https://api.github.com/users/narula/received_events",
         "repos_url" : "https://api.github.com/users/narula/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/narula/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/narula/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/narula"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r472555719"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472555719"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think \".dat\" is the right extension. These are logs, not data, and should end in \".log\".",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-18T23:51:36Z",
      "diff_hunk" : "@@ -2880,3 +2880,23 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void LogMessage(const CNode& node, const std::string& msg_type, const Span<const unsigned char>& data, bool is_incoming)\n+{\n+    auto time = GetTime<std::chrono::microseconds>();\n+\n+    fs::path base_path = GetDataDir() / \"message_logging\" / node.addr.ToString();\n+    fs::create_directories(base_path);\n+\n+    fs::path path = base_path / (is_incoming ? \"msgs_recv.dat\" : \"msgs_sent.dat\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r472555719",
      "id" : 472555719,
      "line" : 2951,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjU1NTcxOQ==",
      "original_commit_id" : "ac953a3773aa5e940976a79276894f5e892d1c55",
      "original_line" : 2951,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 53,
      "pull_request_review_id" : 469904528,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472555719",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/177646?v=4",
         "events_url" : "https://api.github.com/users/narula/events{/privacy}",
         "followers_url" : "https://api.github.com/users/narula/followers",
         "following_url" : "https://api.github.com/users/narula/following{/other_user}",
         "gists_url" : "https://api.github.com/users/narula/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/narula",
         "id" : 177646,
         "login" : "narula",
         "node_id" : "MDQ6VXNlcjE3NzY0Ng==",
         "organizations_url" : "https://api.github.com/users/narula/orgs",
         "received_events_url" : "https://api.github.com/users/narula/received_events",
         "repos_url" : "https://api.github.com/users/narula/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/narula/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/narula/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/narula"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "~~It pains me a bit that this circumvents the existing logging infrastructure. Why is it not the case this is all just logged to debug.log (like everything else) and the parser works on that, filtering peer messages?~~\r\n\r\nAs @jnewbery points out below, I totally missed that this was binary logging! I should have looked more carefully.",
      "created_at" : "2020-08-19T00:00:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-675776414",
      "id" : 675776414,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3NTc3NjQxNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-19T13:05:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/675776414",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/177646?v=4",
         "events_url" : "https://api.github.com/users/narula/events{/privacy}",
         "followers_url" : "https://api.github.com/users/narula/followers",
         "following_url" : "https://api.github.com/users/narula/following{/other_user}",
         "gists_url" : "https://api.github.com/users/narula/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/narula",
         "id" : 177646,
         "login" : "narula",
         "node_id" : "MDQ6VXNlcjE3NzY0Ng==",
         "organizations_url" : "https://api.github.com/users/narula/orgs",
         "received_events_url" : "https://api.github.com/users/narula/received_events",
         "repos_url" : "https://api.github.com/users/narula/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/narula/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/narula/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/narula"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> It pains me a bit that this circumvents the existing logging infrastructure. Why is it not the case this is all just logged to debug.log (like everything else) and the parser works on that, filtering peer messages?\r\n\r\nThis PR dumps binary serialized messages (not text) to file, which is then post-processed by other software. The msgs_*.dat files can be enormous - hundreds of megabytes if blocks are being sent over that connection. Converting those messages to printable text and dropping them into the debug.log file would make them larger still, overwhelm the standard debug logging (eg a block message converted to hex would be millions of characters), and probably be a performance bottleneck (since all messages logged to debug.log would need to be deserialized and passed through tinyformat.h).\r\n\r\nI think this also answers your other questions:\r\n\r\n> I don't think \".dat\" is the right extension. These are logs, not data, and should end in \".log\".\r\n\r\n`.log` to me suggests printable text log files. These are binary files that need post-processing before they're readable.",
      "created_at" : "2020-08-19T08:20:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-675927925",
      "id" : 675927925,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3NTkyNzkyNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-19T08:20:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/675927925",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Regarding the \"why not use Wireshark?\" discussion:\r\n\r\nI don't know about which use cases others are thinking about, but having this in `master` would help me a lot at least:\r\n\r\nI will use this feature in ways not suitable for Wireshark: both for long-term permanent capture of messages for after-the-fact trouble-shooting/debugging, and also for capturing messages that can be fed as seeds into the net message fuzzers.\r\n\r\nI've played with this PR a bit and it covers my needs: I certainly hope it will land in `master` :)",
      "created_at" : "2020-08-19T10:11:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-676082265",
      "id" : 676082265,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3NjA4MjI2NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-19T18:16:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/676082265",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r472923476"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472923476"
         }
      },
      "author_association" : "MEMBER",
      "body" : "at HEAD 4fc2e3906, there are still a number of misformatted inline comments and a few other nits that you would see by running the new python files through pycodestyle and black (with black, I tend to ignore the single-to-double quote changes and some of the newlines for brackets, but otherwise it's useful)",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-19T10:22:03Z",
      "diff_hunk" : "@@ -0,0 +1,92 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message log binary files.  To be used in conjunction with -logmessages.\"\"\"\n+\n+import argparse\n+import os\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.mininode import MESSAGEMAP  # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+COMMAND_SIZE = 12\n+\n+def to_jsonable(obj: Any) -> Any:\n+    ret = {}    # type: Any\n+    # The msg objects don't generally include \"msgtype\" in their __slots__\n+    if hasattr(obj, \"msgtype\"):\n+        ret[\"msgtype\"] = getattr(obj, \"msgtype\", None).decode()\n+    if hasattr(obj, \"__dict__\"):\n+        ret = obj.__dict__\n+    elif hasattr(obj, \"__slots__\"):\n+        for slot in obj.__slots__:\n+            val = getattr(obj, slot, None)\n+            ret[slot] = to_jsonable(val)\n+    elif isinstance(obj, list):\n+        ret = [to_jsonable(a) for a in obj]\n+    elif isinstance(obj, bytes):\n+        ret = obj.hex()\n+    else:\n+        ret = obj\n+    return ret\n+\n+\n+def process_file(path: Path, messages: List[Any], recv: bool) -> None:\n+    with open(path, 'rb') as f_in:\n+        while True:\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + COMMAND_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\") # type: int",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r472923476",
      "id" : 472923476,
      "in_reply_to_id" : 463725672,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkyMzQ3Ng==",
      "original_commit_id" : "6095431033a3590fa74761f1bfede4c68a032a88",
      "original_line" : 50,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "contrib/peer-logging/peer-logging-parser.py",
      "position" : null,
      "pull_request_review_id" : 470322406,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472923476",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r472931626"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472931626"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could this be moved to the start of the function right after the `LogPrint(BCLog::NET, â¦)` call to a.) avoid being run while we're holding `pnode->cs_vSend` (which we don't need for logging), and b.) make sure all `sending %s (%d bytes) peer=%d``BCLog::NET` debug log entries are guaranteed to have a corresponding entry in the message capture file (in the absence of fatal logging errors)?",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-19T10:37:08Z",
      "diff_hunk" : "@@ -2830,18 +2830,17 @@ void CConnman::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n         pnode->mapSendBytesPerMsgCmd[msg.m_type] += nTotalSize;\n         pnode->nSendSize += nTotalSize;\n \n-        if (pnode->nSendSize > nSendBufferMaxSize)\n-            pnode->fPauseSend = true;\n+        if (pnode->nSendSize > nSendBufferMaxSize) pnode->fPauseSend = true;\n+        if (gArgs.IsArgSet(\"-logmessages\")) {\n+            LogMessage(*pnode, msg.m_type, MakeSpan(msg.data), /* incoming */ false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r472931626",
      "id" : 472931626,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkzMTYyNg==",
      "original_commit_id" : "4fc2e3906377991a05f78a938c0aa2f04056b81c",
      "original_line" : 2835,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 470332650,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472931626",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r472932199"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472932199"
         }
      },
      "author_association" : "MEMBER",
      "body" : "here and in `net.cpp::2834`, this may be somewhat more robust:\r\n\r\n```diff\r\n\r\n-    if (gArgs.IsArgSet(\"-logmessages\")) {\r\n+    if (gArgs.GetBoolArg(\"-logmessages\", false)) {\r\n```\r\n\r\nsee https://github.com/bitcoin/bitcoin/pull/19089/files#diff-321303fddcf725df060981d626a05df9R619 and tests at https://github.com/bitcoin/bitcoin/pull/19089/files#diff-ff77e31823822bc143e3113aaf85d4b9R64 that iirc would fail with `IsArgSet()`",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-19T10:38:06Z",
      "diff_hunk" : "@@ -3841,6 +3839,10 @@ bool PeerLogicValidation::ProcessMessages(CNode* pfrom, std::atomic<bool>& inter\n     }\n     CNetMessage& msg(msgs.front());\n \n+    if (gArgs.IsArgSet(\"-logmessages\")) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r472932199",
      "id" : 472932199,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkzMjE5OQ==",
      "original_commit_id" : "4fc2e3906377991a05f78a938c0aa2f04056b81c",
      "original_line" : 3842,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 470333360,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472932199",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r472933214"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472933214"
         }
      },
      "author_association" : "MEMBER",
      "body" : "To make it easier to reason about this function (and its locking requirements) from looking at the function signature, what about replacing `const CNode& node` with `const CAddress& address` since that is what is actually used (`node.addr`)?",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-19T10:40:09Z",
      "diff_hunk" : "@@ -2884,3 +2883,23 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void LogMessage(const CNode& node, const std::string& msg_type, const Span<const unsigned char>& data, bool is_incoming)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r472933214",
      "id" : 472933214,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkzMzIxNA==",
      "original_commit_id" : "4fc2e3906377991a05f78a938c0aa2f04056b81c",
      "original_line" : 2887,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 470332650,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472933214",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r472933882"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472933882"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think `.dat` is fine since this is a non-text binary file. Personally I expect files with the `.log` suffix to be enjoyable in `less` (more or less) :)",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-19T10:41:22Z",
      "diff_hunk" : "@@ -2880,3 +2880,23 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void LogMessage(const CNode& node, const std::string& msg_type, const Span<const unsigned char>& data, bool is_incoming)\n+{\n+    auto time = GetTime<std::chrono::microseconds>();\n+\n+    fs::path base_path = GetDataDir() / \"message_logging\" / node.addr.ToString();\n+    fs::create_directories(base_path);\n+\n+    fs::path path = base_path / (is_incoming ? \"msgs_recv.dat\" : \"msgs_sent.dat\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r472933882",
      "id" : 472933882,
      "in_reply_to_id" : 472555719,
      "line" : 2951,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkzMzg4Mg==",
      "original_commit_id" : "ac953a3773aa5e940976a79276894f5e892d1c55",
      "original_line" : 2951,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 53,
      "pull_request_review_id" : 470332650,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472933882",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r472965651"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472965651"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think the help should specify the `message_logging` directory location and also mention the location of and need to use the `contrib/message-logging/message-logging-parser.py` script.\r\n\r\nPerhaps also add a markdown documentation file somewhere relevant that makes sense.\r\n\r\nAll of this, along with usage info, might also usefully be in the header docstring of the parser script and make sure it shows up nicely when git grepping.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-19T11:42:17Z",
      "diff_hunk" : "@@ -520,6 +520,7 @@ void SetupServerArgs(NodeContext& node)\n         ArgsManager::ALLOW_ANY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-debugexclude=<category>\", strprintf(\"Exclude debugging information for a category. Can be used in conjunction with -debug=1 to output debug logs for all categories except one or more specified categories.\"), ArgsManager::ALLOW_ANY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-logips\", strprintf(\"Include IP addresses in debug output (default: %u)\", DEFAULT_LOGIPS), ArgsManager::ALLOW_ANY, OptionsCategory::DEBUG_TEST);\n+    argsman.AddArg(\"-logmessages\", \"Log all p2p messages to file\", ArgsManager::ALLOW_BOOL | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r472965651",
      "id" : 472965651,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk2NTY1MQ==",
      "original_commit_id" : "4fc2e3906377991a05f78a938c0aa2f04056b81c",
      "original_line" : 535,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 470374440,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472965651",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r472966785"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472966785"
         }
      },
      "author_association" : "MEMBER",
      "body" : "There may be a better way to do it, but I found the stdout to be much more readable with:\r\n```diff\r\n import os\r\n+import pprint\r\n import sys\r\n...\r\n-        print(jsonrep)\r\n+        pprint.pprint(jsonrep)\r\n```\r\nThere seems to be a formatting issue due to unescaped double quotes, however.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-19T11:44:31Z",
      "diff_hunk" : "@@ -0,0 +1,127 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message log binary files.  To be used in conjunction with -logmessages.\"\"\"\n+\n+import argparse\n+import os\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.messages import ser_uint256     # noqa: E402\n+from test_framework.mininode import MESSAGEMAP      # noqa: E402\n+from test_framework.util import assert_equal        # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+# The test framework classes stores hashes as large ints in many cases.\n+# There isn't a way to distinguish between a large int and a large int that is actually a blob of bytes.\n+# As such, they are itemized here\n+# (These can be easily found by looking for calls to deser_uint256, deser_uint256_vector, and uint256_from_str in messages.py)\n+HASH_INTS = [\n+    \"blockhash\",\n+    \"block_hash\",\n+    \"hash\",     # A few conflicts here\n+    \"hashMerkleRoot\",\n+    \"hashPrevBlock\",\n+    \"hashstop\",\n+    \"prev_header\",\n+    \"sha256\",\n+    \"stop_hash\",\n+]\n+\n+HASH_INT_VECTORS = [\n+    \"hashes\",\n+    \"headers\",  # One conflict here\n+    \"vHave\",\n+    \"vHash\",\n+]\n+\n+def to_jsonable(obj: Any) -> Any:\n+    if hasattr(obj, \"__dict__\"):\n+        return obj.__dict__\n+    elif hasattr(obj, \"__slots__\"):\n+        ret = {}    # type: Any\n+        for slot in obj.__slots__:\n+            val = getattr(obj, slot, None)\n+            if slot in HASH_INTS and isinstance(val, int):\n+                ret[slot] = ser_uint256(val).hex()\n+            elif slot in HASH_INT_VECTORS and isinstance(val[0], int):\n+                ret[slot] = [ser_uint256(a).hex() for a in val]\n+            else:\n+                ret[slot] = to_jsonable(val)\n+        return ret\n+    elif isinstance(obj, list):\n+        return [to_jsonable(a) for a in obj]\n+    elif isinstance(obj, bytes):\n+        return obj.hex()\n+    else:\n+        return obj\n+\n+\n+def process_file(path: str, messages: List[Any], recv: bool) -> None:\n+    with open(path, 'rb') as f_in:\n+        while True:\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int\n+            msgtype = tmp_header.read(MSGTYPE_SIZE).split(b'\\x00', 1)[0]     # type: bytes\n+            length = int.from_bytes(tmp_header.read(LENGTH_SIZE), \"little\")  # type: int\n+            if msgtype not in MESSAGEMAP:\n+                # For now just skip unrecognized messages\n+                f_in.read(length)\n+                continue\n+            payload_start_pos = f_in.tell()\n+            msg = MESSAGEMAP[msgtype]()\n+            msg.deserialize(f_in)\n+            payload_length = f_in.tell() - payload_start_pos\n+            assert_equal(length, payload_length)\n+            msg_dict = {}\n+            msg_dict[\"msgtype\"] = getattr(msg, \"msgtype\", None).decode()\n+            msg_dict[\"direction\"] = \"recv\" if recv else \"sent\"\n+            msg_dict[\"time\"] = time\n+            msg_dict[\"size\"] = length   # \"size\" is less readable here, but more readable in the output\n+            if length:\n+                msg_dict[\"body\"] = to_jsonable(msg)\n+            messages.append(msg_dict)\n+\n+\n+def main():\n+    \"\"\"Main\"\"\"\n+    parser = argparse.ArgumentParser(\n+        description=__doc__,\n+        epilog=\"EXAMPLE \\n\\t{0} -o out.json <data-dir>/message_logging/**/*.dat\".format(sys.argv[0]),\n+        formatter_class=argparse.RawTextHelpFormatter)\n+    parser.add_argument(\n+        \"logpaths\", nargs='+',\n+        help=\"binary message dump files to parse.\")\n+    parser.add_argument(\"-o\", \"--output\", help=\"output file.  If unset print to stdout\")\n+    args = parser.parse_args()\n+    logpaths = [Path.cwd() / Path(logpath) for logpath in args.logpaths]\n+    output = Path.cwd() / Path(args.output) if args.output else False\n+\n+    messages = []   # type: List[Any]\n+    for log in logpaths:\n+        process_file(str(log), messages, \"recv\" in log.stem)\n+\n+    messages.sort(key=lambda msg: msg['time'])\n+\n+    jsonrep = json.dumps(messages)\n+    if output:\n+        with open(str(output), 'w+', encoding=\"utf8\") as f_out:\n+            f_out.write(jsonrep)\n+    else:\n+        print(jsonrep)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r472966785",
      "id" : 472966785,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk2Njc4NQ==",
      "original_commit_id" : "4fc2e3906377991a05f78a938c0aa2f04056b81c",
      "original_line" : 173,
      "original_position" : 124,
      "original_start_line" : null,
      "path" : "contrib/message-logging/message-logging-parser.py",
      "position" : null,
      "pull_request_review_id" : 470375904,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/472966785",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r473013742"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/473013742"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, please disregard my comment, I misunderstood!",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-19T13:06:12Z",
      "diff_hunk" : "@@ -2880,3 +2880,23 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void LogMessage(const CNode& node, const std::string& msg_type, const Span<const unsigned char>& data, bool is_incoming)\n+{\n+    auto time = GetTime<std::chrono::microseconds>();\n+\n+    fs::path base_path = GetDataDir() / \"message_logging\" / node.addr.ToString();\n+    fs::create_directories(base_path);\n+\n+    fs::path path = base_path / (is_incoming ? \"msgs_recv.dat\" : \"msgs_sent.dat\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r473013742",
      "id" : 473013742,
      "in_reply_to_id" : 472555719,
      "line" : 2951,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzAxMzc0Mg==",
      "original_commit_id" : "ac953a3773aa5e940976a79276894f5e892d1c55",
      "original_line" : 2951,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 53,
      "pull_request_review_id" : 470436384,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/473013742",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/177646?v=4",
         "events_url" : "https://api.github.com/users/narula/events{/privacy}",
         "followers_url" : "https://api.github.com/users/narula/followers",
         "following_url" : "https://api.github.com/users/narula/following{/other_user}",
         "gists_url" : "https://api.github.com/users/narula/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/narula",
         "id" : 177646,
         "login" : "narula",
         "node_id" : "MDQ6VXNlcjE3NzY0Ng==",
         "organizations_url" : "https://api.github.com/users/narula/orgs",
         "received_events_url" : "https://api.github.com/users/narula/received_events",
         "repos_url" : "https://api.github.com/users/narula/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/narula/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/narula/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/narula"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I think this is a clear Concept ACK for new contributors. \r\n\r\nI was unsure on the Concept ACK for longer term contributors. The fact that this is useful for some longer term contributors (e.g. @theStack, @practicalswift) convinces me it is just about a Concept ACK given the low cost (future maintenance, additional complexity). \r\n\r\n>  If there are concerns with maintenance of the Wireshark dissector, as I understand it, we could fork it and maintain it out of Wireshark's codebase.\r\n\r\nThis sounds like it would be more work and in the absence of someone saying they are keen to do this I think it is an overall Concept ACK for this PR from me. \r\n\r\n(Excellent initial motivation section from @troygiorshev and fair challenge from @luke-jr)",
      "created_at" : "2020-08-19T14:41:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-676468262",
      "id" : 676468262,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3NjQ2ODI2Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-19T14:41:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/676468262",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/16323900?v=4",
         "events_url" : "https://api.github.com/users/michaelfolkson/events{/privacy}",
         "followers_url" : "https://api.github.com/users/michaelfolkson/followers",
         "following_url" : "https://api.github.com/users/michaelfolkson/following{/other_user}",
         "gists_url" : "https://api.github.com/users/michaelfolkson/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/michaelfolkson",
         "id" : 16323900,
         "login" : "michaelfolkson",
         "node_id" : "MDQ6VXNlcjE2MzIzOTAw",
         "organizations_url" : "https://api.github.com/users/michaelfolkson/orgs",
         "received_events_url" : "https://api.github.com/users/michaelfolkson/received_events",
         "repos_url" : "https://api.github.com/users/michaelfolkson/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/michaelfolkson/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/michaelfolkson/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/michaelfolkson"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r473136113"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/473136113"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I have the same question - [by default](https://github.com/bitcoin/bitcoin/blob/e9b30126545d6ddd8772363e4079d1e4908ad117/test/functional/test_framework/test_node.py#L515), `add_p2p_connection` waits for verack.\r\n\r\nMy initial guess was that disconnecting the peer closed the files or unlocked a mutex, but I don't think this is the case ð¤  ",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-19T15:55:46Z",
      "diff_hunk" : "@@ -0,0 +1,70 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test per-peer message logging capability.\n+\n+Additionally, the output of contrib/message-logging/message-logging-parser.py should be verified manually.\n+\"\"\"\n+\n+import glob\n+from io import BytesIO\n+import os\n+\n+from test_framework.mininode import P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+def mini_parser(dat_file):\n+    \"\"\"Parse a data file created by LogMessage.\n+\n+    From the data file we'll only check the structure.\n+\n+    We won't care about things like:\n+    - Deserializing the payload of the message\n+        - This is managed by the deserialize methods in test_framework.messages\n+    - The order of the messages\n+        - There's no reason why we can't, say, change the order of the messages in the handshake\n+    - Message Type\n+        - We can add new message types\n+\n+    We're ignoring these because they're simply too brittle to test here.\n+    \"\"\"\n+    with open(dat_file, 'rb') as f_in:\n+        while True:\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int\n+            assert(time >= 1231006505000000)   # genesis block timestamp\n+            msgtype = tmp_header.read(MSGTYPE_SIZE).split(b'\\x00', 1)[0]     # type: bytes\n+            assert(len(msgtype) > 0)\n+            length = int.from_bytes(tmp_header.read(LENGTH_SIZE), \"little\")  # type: int\n+            data = f_in.read(length)\n+            assert_equal(len(data), length)\n+\n+\n+class MessageLoggingTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+        self.extra_args = [[\"-logmessages\"]]\n+        self.setup_clean_chain = True\n+\n+    def run_test(self):\n+        logdir = os.path.join(self.nodes[0].datadir, \"regtest/message_logging\")\n+        # Connect an disconnect a node so that the handshake occurs\n+        self.nodes[0].add_p2p_connection(P2PDataStore())\n+        self.nodes[0].disconnect_p2ps()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r473136113",
      "id" : 473136113,
      "in_reply_to_id" : 472549706,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzEzNjExMw==",
      "original_commit_id" : "4fc2e3906377991a05f78a938c0aa2f04056b81c",
      "original_line" : 62,
      "original_position" : 62,
      "original_start_line" : null,
      "path" : "test/functional/p2p_message_logging.py",
      "position" : null,
      "pull_request_review_id" : 470599778,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/473136113",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I wonder why the name \"message dumping\" was changed to \"message logging\". I find dumping a much more accurate term, as this isn't just producing a log (which sounds more like metadata recording), but an exact dump of all messages.",
      "created_at" : "2020-08-19T17:18:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-676555213",
      "id" : 676555213,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3NjU1NTIxMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-19T17:18:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/676555213",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r473217347"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/473217347"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "or just piping trough `jq`, gives you colors too",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-19T17:52:07Z",
      "diff_hunk" : "@@ -0,0 +1,127 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message log binary files.  To be used in conjunction with -logmessages.\"\"\"\n+\n+import argparse\n+import os\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.messages import ser_uint256     # noqa: E402\n+from test_framework.mininode import MESSAGEMAP      # noqa: E402\n+from test_framework.util import assert_equal        # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+# The test framework classes stores hashes as large ints in many cases.\n+# There isn't a way to distinguish between a large int and a large int that is actually a blob of bytes.\n+# As such, they are itemized here\n+# (These can be easily found by looking for calls to deser_uint256, deser_uint256_vector, and uint256_from_str in messages.py)\n+HASH_INTS = [\n+    \"blockhash\",\n+    \"block_hash\",\n+    \"hash\",     # A few conflicts here\n+    \"hashMerkleRoot\",\n+    \"hashPrevBlock\",\n+    \"hashstop\",\n+    \"prev_header\",\n+    \"sha256\",\n+    \"stop_hash\",\n+]\n+\n+HASH_INT_VECTORS = [\n+    \"hashes\",\n+    \"headers\",  # One conflict here\n+    \"vHave\",\n+    \"vHash\",\n+]\n+\n+def to_jsonable(obj: Any) -> Any:\n+    if hasattr(obj, \"__dict__\"):\n+        return obj.__dict__\n+    elif hasattr(obj, \"__slots__\"):\n+        ret = {}    # type: Any\n+        for slot in obj.__slots__:\n+            val = getattr(obj, slot, None)\n+            if slot in HASH_INTS and isinstance(val, int):\n+                ret[slot] = ser_uint256(val).hex()\n+            elif slot in HASH_INT_VECTORS and isinstance(val[0], int):\n+                ret[slot] = [ser_uint256(a).hex() for a in val]\n+            else:\n+                ret[slot] = to_jsonable(val)\n+        return ret\n+    elif isinstance(obj, list):\n+        return [to_jsonable(a) for a in obj]\n+    elif isinstance(obj, bytes):\n+        return obj.hex()\n+    else:\n+        return obj\n+\n+\n+def process_file(path: str, messages: List[Any], recv: bool) -> None:\n+    with open(path, 'rb') as f_in:\n+        while True:\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int\n+            msgtype = tmp_header.read(MSGTYPE_SIZE).split(b'\\x00', 1)[0]     # type: bytes\n+            length = int.from_bytes(tmp_header.read(LENGTH_SIZE), \"little\")  # type: int\n+            if msgtype not in MESSAGEMAP:\n+                # For now just skip unrecognized messages\n+                f_in.read(length)\n+                continue\n+            payload_start_pos = f_in.tell()\n+            msg = MESSAGEMAP[msgtype]()\n+            msg.deserialize(f_in)\n+            payload_length = f_in.tell() - payload_start_pos\n+            assert_equal(length, payload_length)\n+            msg_dict = {}\n+            msg_dict[\"msgtype\"] = getattr(msg, \"msgtype\", None).decode()\n+            msg_dict[\"direction\"] = \"recv\" if recv else \"sent\"\n+            msg_dict[\"time\"] = time\n+            msg_dict[\"size\"] = length   # \"size\" is less readable here, but more readable in the output\n+            if length:\n+                msg_dict[\"body\"] = to_jsonable(msg)\n+            messages.append(msg_dict)\n+\n+\n+def main():\n+    \"\"\"Main\"\"\"\n+    parser = argparse.ArgumentParser(\n+        description=__doc__,\n+        epilog=\"EXAMPLE \\n\\t{0} -o out.json <data-dir>/message_logging/**/*.dat\".format(sys.argv[0]),\n+        formatter_class=argparse.RawTextHelpFormatter)\n+    parser.add_argument(\n+        \"logpaths\", nargs='+',\n+        help=\"binary message dump files to parse.\")\n+    parser.add_argument(\"-o\", \"--output\", help=\"output file.  If unset print to stdout\")\n+    args = parser.parse_args()\n+    logpaths = [Path.cwd() / Path(logpath) for logpath in args.logpaths]\n+    output = Path.cwd() / Path(args.output) if args.output else False\n+\n+    messages = []   # type: List[Any]\n+    for log in logpaths:\n+        process_file(str(log), messages, \"recv\" in log.stem)\n+\n+    messages.sort(key=lambda msg: msg['time'])\n+\n+    jsonrep = json.dumps(messages)\n+    if output:\n+        with open(str(output), 'w+', encoding=\"utf8\") as f_out:\n+            f_out.write(jsonrep)\n+    else:\n+        print(jsonrep)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r473217347",
      "id" : 473217347,
      "in_reply_to_id" : 472966785,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIxNzM0Nw==",
      "original_commit_id" : "4fc2e3906377991a05f78a938c0aa2f04056b81c",
      "original_line" : 173,
      "original_position" : 124,
      "original_start_line" : null,
      "path" : "contrib/message-logging/message-logging-parser.py",
      "position" : null,
      "pull_request_review_id" : 470705976,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/473217347",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/551068?v=4",
         "events_url" : "https://api.github.com/users/FelixWeis/events{/privacy}",
         "followers_url" : "https://api.github.com/users/FelixWeis/followers",
         "following_url" : "https://api.github.com/users/FelixWeis/following{/other_user}",
         "gists_url" : "https://api.github.com/users/FelixWeis/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/FelixWeis",
         "id" : 551068,
         "login" : "FelixWeis",
         "node_id" : "MDQ6VXNlcjU1MTA2OA==",
         "organizations_url" : "https://api.github.com/users/FelixWeis/orgs",
         "received_events_url" : "https://api.github.com/users/FelixWeis/received_events",
         "repos_url" : "https://api.github.com/users/FelixWeis/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/FelixWeis/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/FelixWeis/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/FelixWeis"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r473218039"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/473218039"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "might be an issue on windows. `:` is not a valid file name char.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-19T17:53:20Z",
      "diff_hunk" : "@@ -2884,3 +2883,23 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void LogMessage(const CNode& node, const std::string& msg_type, const Span<const unsigned char>& data, bool is_incoming)\n+{\n+    auto time = GetTime<std::chrono::microseconds>();\n+\n+    fs::path base_path = GetDataDir() / \"message_logging\" / node.addr.ToString();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r473218039",
      "id" : 473218039,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIxODAzOQ==",
      "original_commit_id" : "4fc2e3906377991a05f78a938c0aa2f04056b81c",
      "original_line" : 2891,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 470706828,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/473218039",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/551068?v=4",
         "events_url" : "https://api.github.com/users/FelixWeis/events{/privacy}",
         "followers_url" : "https://api.github.com/users/FelixWeis/followers",
         "following_url" : "https://api.github.com/users/FelixWeis/following{/other_user}",
         "gists_url" : "https://api.github.com/users/FelixWeis/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/FelixWeis",
         "id" : 551068,
         "login" : "FelixWeis",
         "node_id" : "MDQ6VXNlcjU1MTA2OA==",
         "organizations_url" : "https://api.github.com/users/FelixWeis/orgs",
         "received_events_url" : "https://api.github.com/users/FelixWeis/received_events",
         "repos_url" : "https://api.github.com/users/FelixWeis/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/FelixWeis/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/FelixWeis/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/FelixWeis"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r473223806"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/473223806"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The docs could also helpfully mention that passing both send and recv files to the parser will interleave them in order.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-19T18:03:17Z",
      "diff_hunk" : "@@ -520,6 +520,7 @@ void SetupServerArgs(NodeContext& node)\n         ArgsManager::ALLOW_ANY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-debugexclude=<category>\", strprintf(\"Exclude debugging information for a category. Can be used in conjunction with -debug=1 to output debug logs for all categories except one or more specified categories.\"), ArgsManager::ALLOW_ANY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-logips\", strprintf(\"Include IP addresses in debug output (default: %u)\", DEFAULT_LOGIPS), ArgsManager::ALLOW_ANY, OptionsCategory::DEBUG_TEST);\n+    argsman.AddArg(\"-logmessages\", \"Log all p2p messages to file\", ArgsManager::ALLOW_BOOL | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r473223806",
      "id" : 473223806,
      "in_reply_to_id" : 472965651,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIyMzgwNg==",
      "original_commit_id" : "4fc2e3906377991a05f78a938c0aa2f04056b81c",
      "original_line" : 535,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 470714030,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/473223806",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r473444931"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/473444931"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Each open file should have its fd so `nMaxConnections` * 2 ?",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-19T23:47:52Z",
      "diff_hunk" : "@@ -86,6 +87,8 @@ static const uint64_t MAX_UPLOAD_TIMEFRAME = 60 * 60 * 24;\n static const bool DEFAULT_BLOCKSONLY = false;\n /** -peertimeout default */\n static const int64_t DEFAULT_PEER_CONNECT_TIMEOUT = 60;\n+/** Number of file descriptors required for message logging **/\n+static const int NUM_FDS_MESSAGE_LOGGING = 1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r473444931",
      "id" : 473444931,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzQ0NDkzMQ==",
      "original_commit_id" : "4fc2e3906377991a05f78a938c0aa2f04056b81c",
      "original_line" : 90,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 471037212,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/473444931",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r473447384"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/473447384"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Have you tried to fit this call in `CConnman::SocketHandler` like when we iter to increment `nSizeAdded` ? I think it would be cleaner to avoid leaking more network-level processing in a p2p protocol processing function.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-19T23:51:25Z",
      "diff_hunk" : "@@ -3841,6 +3839,10 @@ bool PeerLogicValidation::ProcessMessages(CNode* pfrom, std::atomic<bool>& inter\n     }\n     CNetMessage& msg(msgs.front());\n \n+    if (gArgs.IsArgSet(\"-logmessages\")) {\n+        LogMessage(*pfrom, msg.m_command, MakeUCharSpan(msg.m_recv), /* incoming */ true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r473447384",
      "id" : 473447384,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzQ0NzM4NA==",
      "original_commit_id" : "4fc2e3906377991a05f78a938c0aa2f04056b81c",
      "original_line" : 3843,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 471037212,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/473447384",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r473895565"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/473895565"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "For only advancing the file pointer, the `seek` method would probably be more appropriate (see e.g. https://code-maven.com/python-seek):\r\n```suggestion\r\n                f_in.seek(length, os.SEEK_CUR)\r\n```",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-20T11:19:51Z",
      "diff_hunk" : "@@ -0,0 +1,127 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message log binary files.  To be used in conjunction with -logmessages.\"\"\"\n+\n+import argparse\n+import os\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.messages import ser_uint256     # noqa: E402\n+from test_framework.mininode import MESSAGEMAP      # noqa: E402\n+from test_framework.util import assert_equal        # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+# The test framework classes stores hashes as large ints in many cases.\n+# There isn't a way to distinguish between a large int and a large int that is actually a blob of bytes.\n+# As such, they are itemized here\n+# (These can be easily found by looking for calls to deser_uint256, deser_uint256_vector, and uint256_from_str in messages.py)\n+HASH_INTS = [\n+    \"blockhash\",\n+    \"block_hash\",\n+    \"hash\",     # A few conflicts here\n+    \"hashMerkleRoot\",\n+    \"hashPrevBlock\",\n+    \"hashstop\",\n+    \"prev_header\",\n+    \"sha256\",\n+    \"stop_hash\",\n+]\n+\n+HASH_INT_VECTORS = [\n+    \"hashes\",\n+    \"headers\",  # One conflict here\n+    \"vHave\",\n+    \"vHash\",\n+]\n+\n+def to_jsonable(obj: Any) -> Any:\n+    if hasattr(obj, \"__dict__\"):\n+        return obj.__dict__\n+    elif hasattr(obj, \"__slots__\"):\n+        ret = {}    # type: Any\n+        for slot in obj.__slots__:\n+            val = getattr(obj, slot, None)\n+            if slot in HASH_INTS and isinstance(val, int):\n+                ret[slot] = ser_uint256(val).hex()\n+            elif slot in HASH_INT_VECTORS and isinstance(val[0], int):\n+                ret[slot] = [ser_uint256(a).hex() for a in val]\n+            else:\n+                ret[slot] = to_jsonable(val)\n+        return ret\n+    elif isinstance(obj, list):\n+        return [to_jsonable(a) for a in obj]\n+    elif isinstance(obj, bytes):\n+        return obj.hex()\n+    else:\n+        return obj\n+\n+\n+def process_file(path: str, messages: List[Any], recv: bool) -> None:\n+    with open(path, 'rb') as f_in:\n+        while True:\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int\n+            msgtype = tmp_header.read(MSGTYPE_SIZE).split(b'\\x00', 1)[0]     # type: bytes\n+            length = int.from_bytes(tmp_header.read(LENGTH_SIZE), \"little\")  # type: int\n+            if msgtype not in MESSAGEMAP:\n+                # For now just skip unrecognized messages\n+                f_in.read(length)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r473895565",
      "id" : 473895565,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzg5NTU2NQ==",
      "original_commit_id" : "0d10af73df19de62726065cb63c123fda8c237b1",
      "original_line" : 110,
      "original_position" : 82,
      "original_start_line" : null,
      "path" : "contrib/message-logging/message-logging-parser.py",
      "position" : null,
      "pull_request_review_id" : 471497051,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/473895565",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r473949673"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/473949673"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This part of the parser recognizes a uint256 by the name of the member.  It doesn't take into account the name of the class.  In some classes (in messages.py), `self.hash` refers to one of these \"int-encoded\" uint256s, and in others it does not.\r\n\r\ne.g.\r\nCOutPoint, `self.hash` is an \"int-encoded\" uint256\r\nCTransaction, `self.hash` is a str\r\n\r\nThis is here to justify the `isinstance(val, int)` checks in `to_jsonable` but I think it's causing more confusion than it's helping.  I'll comment this somewhere else.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-20T12:59:08Z",
      "diff_hunk" : "@@ -0,0 +1,127 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message log binary files.  To be used in conjunction with -logmessages.\"\"\"\n+\n+import argparse\n+import os\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.messages import ser_uint256     # noqa: E402\n+from test_framework.mininode import MESSAGEMAP      # noqa: E402\n+from test_framework.util import assert_equal        # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+# The test framework classes stores hashes as large ints in many cases.\n+# There isn't a way to distinguish between a large int and a large int that is actually a blob of bytes.\n+# As such, they are itemized here\n+# (These can be easily found by looking for calls to deser_uint256, deser_uint256_vector, and uint256_from_str in messages.py)\n+HASH_INTS = [\n+    \"blockhash\",\n+    \"block_hash\",\n+    \"hash\",     # A few conflicts here",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r473949673",
      "id" : 473949673,
      "in_reply_to_id" : 472545184,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzk0OTY3Mw==",
      "original_commit_id" : "0d10af73df19de62726065cb63c123fda8c237b1",
      "original_line" : 32,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "contrib/message-logging/message-logging-parser.py",
      "position" : null,
      "pull_request_review_id" : 471568984,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/473949673",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r473957438"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/473957438"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "You're both right, it isn't needed.\r\n\r\nI thought it was just good form to disconnect the peers at the end of the test.  Makes it easier for someone to expand the test later.\r\n\r\nI'll fix the comment",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-20T13:11:49Z",
      "diff_hunk" : "@@ -0,0 +1,70 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test per-peer message logging capability.\n+\n+Additionally, the output of contrib/message-logging/message-logging-parser.py should be verified manually.\n+\"\"\"\n+\n+import glob\n+from io import BytesIO\n+import os\n+\n+from test_framework.mininode import P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+def mini_parser(dat_file):\n+    \"\"\"Parse a data file created by LogMessage.\n+\n+    From the data file we'll only check the structure.\n+\n+    We won't care about things like:\n+    - Deserializing the payload of the message\n+        - This is managed by the deserialize methods in test_framework.messages\n+    - The order of the messages\n+        - There's no reason why we can't, say, change the order of the messages in the handshake\n+    - Message Type\n+        - We can add new message types\n+\n+    We're ignoring these because they're simply too brittle to test here.\n+    \"\"\"\n+    with open(dat_file, 'rb') as f_in:\n+        while True:\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int\n+            assert(time >= 1231006505000000)   # genesis block timestamp\n+            msgtype = tmp_header.read(MSGTYPE_SIZE).split(b'\\x00', 1)[0]     # type: bytes\n+            assert(len(msgtype) > 0)\n+            length = int.from_bytes(tmp_header.read(LENGTH_SIZE), \"little\")  # type: int\n+            data = f_in.read(length)\n+            assert_equal(len(data), length)\n+\n+\n+class MessageLoggingTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+        self.extra_args = [[\"-logmessages\"]]\n+        self.setup_clean_chain = True\n+\n+    def run_test(self):\n+        logdir = os.path.join(self.nodes[0].datadir, \"regtest/message_logging\")\n+        # Connect an disconnect a node so that the handshake occurs\n+        self.nodes[0].add_p2p_connection(P2PDataStore())\n+        self.nodes[0].disconnect_p2ps()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r473957438",
      "id" : 473957438,
      "in_reply_to_id" : 472549706,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzk1NzQzOA==",
      "original_commit_id" : "4fc2e3906377991a05f78a938c0aa2f04056b81c",
      "original_line" : 62,
      "original_position" : 62,
      "original_start_line" : null,
      "path" : "test/functional/p2p_message_logging.py",
      "position" : null,
      "pull_request_review_id" : 471589255,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/473957438",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r473978706"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/473978706"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "thanks, fixed",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-20T13:34:25Z",
      "diff_hunk" : "@@ -3841,6 +3839,10 @@ bool PeerLogicValidation::ProcessMessages(CNode* pfrom, std::atomic<bool>& inter\n     }\n     CNetMessage& msg(msgs.front());\n \n+    if (gArgs.IsArgSet(\"-logmessages\")) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r473978706",
      "id" : 473978706,
      "in_reply_to_id" : 472932199,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzk3ODcwNg==",
      "original_commit_id" : "4fc2e3906377991a05f78a938c0aa2f04056b81c",
      "original_line" : 3842,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 471619249,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/473978706",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r473986877"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/473986877"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yup, it can, and I agree with you that it should be.  The locking in PushMessage is a bit of a mess, which I fix up a little in #19673.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-20T13:41:55Z",
      "diff_hunk" : "@@ -2830,18 +2830,17 @@ void CConnman::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n         pnode->mapSendBytesPerMsgCmd[msg.m_type] += nTotalSize;\n         pnode->nSendSize += nTotalSize;\n \n-        if (pnode->nSendSize > nSendBufferMaxSize)\n-            pnode->fPauseSend = true;\n+        if (pnode->nSendSize > nSendBufferMaxSize) pnode->fPauseSend = true;\n+        if (gArgs.IsArgSet(\"-logmessages\")) {\n+            LogMessage(*pnode, msg.m_type, MakeSpan(msg.data), /* incoming */ false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r473986877",
      "id" : 473986877,
      "in_reply_to_id" : 472931626,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzk4Njg3Nw==",
      "original_commit_id" : "4fc2e3906377991a05f78a938c0aa2f04056b81c",
      "original_line" : 2835,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 471626269,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/473986877",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r473992333"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/473992333"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I like this, thanks.  One day LogMessage may use other attributes of a CNode, but it can be easily changed back when the time comes.  Done.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-20T13:46:54Z",
      "diff_hunk" : "@@ -2884,3 +2883,23 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void LogMessage(const CNode& node, const std::string& msg_type, const Span<const unsigned char>& data, bool is_incoming)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r473992333",
      "id" : 473992333,
      "in_reply_to_id" : 472933214,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzk5MjMzMw==",
      "original_commit_id" : "4fc2e3906377991a05f78a938c0aa2f04056b81c",
      "original_line" : 2887,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 471630854,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/473992333",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r474025412"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/474025412"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "We open and close the file every time, so I think it is correct the way it is.  I intentionally didn't want to double or triple our fd usage.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-20T14:27:29Z",
      "diff_hunk" : "@@ -86,6 +87,8 @@ static const uint64_t MAX_UPLOAD_TIMEFRAME = 60 * 60 * 24;\n static const bool DEFAULT_BLOCKSONLY = false;\n /** -peertimeout default */\n static const int64_t DEFAULT_PEER_CONNECT_TIMEOUT = 60;\n+/** Number of file descriptors required for message logging **/\n+static const int NUM_FDS_MESSAGE_LOGGING = 1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r474025412",
      "id" : 474025412,
      "in_reply_to_id" : 473444931,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDAyNTQxMg==",
      "original_commit_id" : "4fc2e3906377991a05f78a938c0aa2f04056b81c",
      "original_line" : 90,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 471670447,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/474025412",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r474029818"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/474029818"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks.  Fixed",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-20T14:33:08Z",
      "diff_hunk" : "@@ -0,0 +1,70 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test per-peer message logging capability.\n+\n+Additionally, the output of contrib/message-logging/message-logging-parser.py should be verified manually.\n+\"\"\"\n+\n+import glob\n+from io import BytesIO\n+import os\n+\n+from test_framework.mininode import P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+def mini_parser(dat_file):\n+    \"\"\"Parse a data file created by LogMessage.\n+\n+    From the data file we'll only check the structure.\n+\n+    We won't care about things like:\n+    - Deserializing the payload of the message\n+        - This is managed by the deserialize methods in test_framework.messages\n+    - The order of the messages\n+        - There's no reason why we can't, say, change the order of the messages in the handshake\n+    - Message Type\n+        - We can add new message types\n+\n+    We're ignoring these because they're simply too brittle to test here.\n+    \"\"\"\n+    with open(dat_file, 'rb') as f_in:\n+        while True:\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int\n+            assert(time >= 1231006505000000)   # genesis block timestamp\n+            msgtype = tmp_header.read(MSGTYPE_SIZE).split(b'\\x00', 1)[0]     # type: bytes\n+            assert(len(msgtype) > 0)\n+            length = int.from_bytes(tmp_header.read(LENGTH_SIZE), \"little\")  # type: int\n+            data = f_in.read(length)\n+            assert_equal(len(data), length)\n+\n+\n+class MessageLoggingTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+        self.extra_args = [[\"-logmessages\"]]\n+        self.setup_clean_chain = True\n+\n+    def run_test(self):\n+        logdir = os.path.join(self.nodes[0].datadir, \"regtest/message_logging\")\n+        # Connect an disconnect a node so that the handshake occurs",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r474029818",
      "id" : 474029818,
      "in_reply_to_id" : 472436516,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDAyOTgxOA==",
      "original_commit_id" : "4fc2e3906377991a05f78a938c0aa2f04056b81c",
      "original_line" : 60,
      "original_position" : 60,
      "original_start_line" : null,
      "path" : "test/functional/p2p_message_logging.py",
      "position" : null,
      "pull_request_review_id" : 471676311,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/474029818",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r474210703"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/474210703"
         }
      },
      "author_association" : "MEMBER",
      "body" : "gotcha, sounds good ",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-20T19:11:50Z",
      "diff_hunk" : "@@ -0,0 +1,127 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message log binary files.  To be used in conjunction with -logmessages.\"\"\"\n+\n+import argparse\n+import os\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.messages import ser_uint256     # noqa: E402\n+from test_framework.mininode import MESSAGEMAP      # noqa: E402\n+from test_framework.util import assert_equal        # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+# The test framework classes stores hashes as large ints in many cases.\n+# There isn't a way to distinguish between a large int and a large int that is actually a blob of bytes.\n+# As such, they are itemized here\n+# (These can be easily found by looking for calls to deser_uint256, deser_uint256_vector, and uint256_from_str in messages.py)\n+HASH_INTS = [\n+    \"blockhash\",\n+    \"block_hash\",\n+    \"hash\",     # A few conflicts here",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r474210703",
      "id" : 474210703,
      "in_reply_to_id" : 472545184,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDIxMDcwMw==",
      "original_commit_id" : "0d10af73df19de62726065cb63c123fda8c237b1",
      "original_line" : 32,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "contrib/message-logging/message-logging-parser.py",
      "position" : null,
      "pull_request_review_id" : 471906213,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/474210703",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r474249437"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/474249437"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Right, performance not being an issue, we shouldn't bother opening/closing every time. ",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-20T20:19:35Z",
      "diff_hunk" : "@@ -86,6 +87,8 @@ static const uint64_t MAX_UPLOAD_TIMEFRAME = 60 * 60 * 24;\n static const bool DEFAULT_BLOCKSONLY = false;\n /** -peertimeout default */\n static const int64_t DEFAULT_PEER_CONNECT_TIMEOUT = 60;\n+/** Number of file descriptors required for message logging **/\n+static const int NUM_FDS_MESSAGE_LOGGING = 1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r474249437",
      "id" : 474249437,
      "in_reply_to_id" : 473444931,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDI0OTQzNw==",
      "original_commit_id" : "4fc2e3906377991a05f78a938c0aa2f04056b81c",
      "original_line" : 90,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 471956396,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/474249437",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r474807738"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/474807738"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks, fixed to use underscores instead",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-08-21T16:39:34Z",
      "diff_hunk" : "@@ -2884,3 +2883,23 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void LogMessage(const CNode& node, const std::string& msg_type, const Span<const unsigned char>& data, bool is_incoming)\n+{\n+    auto time = GetTime<std::chrono::microseconds>();\n+\n+    fs::path base_path = GetDataDir() / \"message_logging\" / node.addr.ToString();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r474807738",
      "id" : 474807738,
      "in_reply_to_id" : 473218039,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDgwNzczOA==",
      "original_commit_id" : "4fc2e3906377991a05f78a938c0aa2f04056b81c",
      "original_line" : 2891,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 472635784,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/474807738",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`git range-diff master 4fc2e39 ff3a39c`\r\n\r\nThanks for the review everyone!\r\n\r\nImprovement\r\n\r\n* Added a progress bar to the parser\r\n\r\nFixes\r\n\r\n* Now uses GetBoolArg as opposed to IsArgSet\r\n* IP addresses now have colons replaced with underscores\r\n* One LogMessage call site is moved, as per [this comment](https://github.com/bitcoin/bitcoin/pull/19509#discussion_r472931626)\r\n* LogMessage now takes a `CAddress&` as opposed to a `CNode&`\r\n* Clarified some comments\r\n\r\nNext up, a rename and some light documentation!\r\n",
      "created_at" : "2020-08-21T16:48:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-678387396",
      "id" : 678387396,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3ODM4NzM5Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-21T16:48:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/678387396",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r481088231"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/481088231"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: Put the default in a shared const",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-09-01T12:08:04Z",
      "diff_hunk" : "@@ -3839,6 +3839,10 @@ bool PeerLogicValidation::ProcessMessages(CNode* pfrom, std::atomic<bool>& inter\n     }\n     CNetMessage& msg(msgs.front());\n \n+    if (gArgs.GetBoolArg(\"-logmessages\", false)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r481088231",
      "id" : 481088231,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTA4ODIzMQ==",
      "original_commit_id" : "801154b36035bd8849e0f21a3c6d48f18db56293",
      "original_line" : 3878,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 479674111,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/481088231",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r481094927"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/481094927"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit\r\n```suggestion\r\n        if (optimisticSend) nBytesSent = SocketSendData(pnode);\r\n```\r\n\r\nor:\r\n```suggestion\r\n        if (node->vSendMsg.empty()) nBytesSent = SocketSendData(pnode);\r\n```\r\nand remove the bool completely. The comment already clarifies what is happening.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-09-01T12:20:56Z",
      "diff_hunk" : "@@ -2830,18 +2830,14 @@ void CConnman::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n         pnode->mapSendBytesPerMsgCmd[msg.m_type] += nTotalSize;\n         pnode->nSendSize += nTotalSize;\n \n-        if (pnode->nSendSize > nSendBufferMaxSize)\n-            pnode->fPauseSend = true;\n+        if (pnode->nSendSize > nSendBufferMaxSize) pnode->fPauseSend = true;\n         pnode->vSendMsg.push_back(std::move(serializedHeader));\n-        if (nMessageSize)\n-            pnode->vSendMsg.push_back(std::move(msg.data));\n+        if (nMessageSize) pnode->vSendMsg.push_back(std::move(msg.data));\n \n         // If write queue empty, attempt \"optimistic write\"\n-        if (optimisticSend == true)\n-            nBytesSent = SocketSendData(pnode);\n+        if (optimisticSend == true) nBytesSent = SocketSendData(pnode);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r481094927",
      "id" : 481094927,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTA5NDkyNw==",
      "original_commit_id" : "b3a0e528d1128ee456258f4b265b52b7e8fbc6a6",
      "original_line" : 2938,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 479674111,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/481094927",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r481106188"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/481106188"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: Add info on the default setting.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-09-01T12:40:04Z",
      "diff_hunk" : "@@ -520,6 +520,7 @@ void SetupServerArgs(NodeContext& node)\n         ArgsManager::ALLOW_ANY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-debugexclude=<category>\", strprintf(\"Exclude debugging information for a category. Can be used in conjunction with -debug=1 to output debug logs for all categories except one or more specified categories.\"), ArgsManager::ALLOW_ANY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-logips\", strprintf(\"Include IP addresses in debug output (default: %u)\", DEFAULT_LOGIPS), ArgsManager::ALLOW_ANY, OptionsCategory::DEBUG_TEST);\n+    argsman.AddArg(\"-logmessages\", \"Log all p2p messages to file\", ArgsManager::ALLOW_BOOL | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r481106188",
      "id" : 481106188,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTEwNjE4OA==",
      "original_commit_id" : "801154b36035bd8849e0f21a3c6d48f18db56293",
      "original_line" : 535,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 479674111,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/481106188",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, I think the dumping changes to the C++ here could entirely be replaced with a use of #19866, no strong opinion on whether we should do both or not, but I think the python analysis tooling here is useful in any case.",
      "created_at" : "2020-09-06T12:36:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-687778637",
      "id" : 687778637,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4Nzc3ODYzNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-06T12:36:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/687778637",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-09-21T22:20:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-696409325",
      "id" : 696409325,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5NjQwOTMyNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-21T22:20:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/696409325",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`git range-diff master ff3a39c ba68f02`\r\n\r\ntrivial rebase",
      "created_at" : "2020-09-23T02:11:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-697079425",
      "id" : 697079425,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5NzA3OTQyNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-23T02:11:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/697079425",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@troygiorshev what's the status here? You've rebased, but there are unaddressed review comments from a few contributors. CI is also failing.",
      "created_at" : "2020-09-23T09:51:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-697259250",
      "id" : 697259250,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5NzI1OTI1MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-23T09:51:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/697259250",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r495583680"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495583680"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "All `test_framework.mininode` need to be replaced by `test_framework.p2p` as of https://github.com/bitcoin/bitcoin/pull/19760",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-09-27T15:22:48Z",
      "diff_hunk" : "@@ -0,0 +1,176 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message log binary files.  To be used in conjunction with -logmessages.\"\"\"\n+\n+import argparse\n+import os\n+import shutil\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List, Optional\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.messages import ser_uint256     # noqa: E402\n+from test_framework.mininode import MESSAGEMAP      # noqa: E402",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r495583680",
      "id" : 495583680,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTU4MzY4MA==",
      "original_commit_id" : "ba68f02310c8ce4080aca8153e644634354678ab",
      "original_line" : 19,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "contrib/message-logging/message-logging-parser.py",
      "position" : null,
      "pull_request_review_id" : 497088959,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/495583680",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/16323900?v=4",
         "events_url" : "https://api.github.com/users/michaelfolkson/events{/privacy}",
         "followers_url" : "https://api.github.com/users/michaelfolkson/followers",
         "following_url" : "https://api.github.com/users/michaelfolkson/following{/other_user}",
         "gists_url" : "https://api.github.com/users/michaelfolkson/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/michaelfolkson",
         "id" : 16323900,
         "login" : "michaelfolkson",
         "node_id" : "MDQ6VXNlcjE2MzIzOTAw",
         "organizations_url" : "https://api.github.com/users/michaelfolkson/orgs",
         "received_events_url" : "https://api.github.com/users/michaelfolkson/received_events",
         "repos_url" : "https://api.github.com/users/michaelfolkson/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/michaelfolkson/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/michaelfolkson/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/michaelfolkson"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-09-29T10:04:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-700602638",
      "id" : 700602638,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwMDYwMjYzOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-29T10:04:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/700602638",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`git range-diff master ba68f02 5d5aeca`\r\n\r\nRebased",
      "created_at" : "2020-10-07T04:09:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-704679027",
      "id" : 704679027,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwNDY3OTAyNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-07T04:09:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/704679027",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r500727575"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500727575"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "For simplicity, and to avoid any race conditions, I've made sure to keep all calls to `LogMessage` in `MessageHandler`.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-10-07T04:16:26Z",
      "diff_hunk" : "@@ -3841,6 +3839,10 @@ bool PeerLogicValidation::ProcessMessages(CNode* pfrom, std::atomic<bool>& inter\n     }\n     CNetMessage& msg(msgs.front());\n \n+    if (gArgs.IsArgSet(\"-logmessages\")) {\n+        LogMessage(*pfrom, msg.m_command, MakeUCharSpan(msg.m_recv), /* incoming */ true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r500727575",
      "id" : 500727575,
      "in_reply_to_id" : 473447384,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDcyNzU3NQ==",
      "original_commit_id" : "4fc2e3906377991a05f78a938c0aa2f04056b81c",
      "original_line" : 3843,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 503512875,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500727575",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`git range-diff master 5d5aeca 18bcf97`\r\n\r\n* Renamed \"Logging\" to \"Capture\" throughout!",
      "created_at" : "2020-10-07T04:55:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-704691194",
      "id" : 704691194,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwNDY5MTE5NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-07T04:55:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/704691194",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r500737999"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500737999"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm more than happy to do this!",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-10-07T04:59:33Z",
      "diff_hunk" : "@@ -2830,18 +2830,14 @@ void CConnman::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n         pnode->mapSendBytesPerMsgCmd[msg.m_type] += nTotalSize;\n         pnode->nSendSize += nTotalSize;\n \n-        if (pnode->nSendSize > nSendBufferMaxSize)\n-            pnode->fPauseSend = true;\n+        if (pnode->nSendSize > nSendBufferMaxSize) pnode->fPauseSend = true;\n         pnode->vSendMsg.push_back(std::move(serializedHeader));\n-        if (nMessageSize)\n-            pnode->vSendMsg.push_back(std::move(msg.data));\n+        if (nMessageSize) pnode->vSendMsg.push_back(std::move(msg.data));\n \n         // If write queue empty, attempt \"optimistic write\"\n-        if (optimisticSend == true)\n-            nBytesSent = SocketSendData(pnode);\n+        if (optimisticSend == true) nBytesSent = SocketSendData(pnode);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r500737999",
      "id" : 500737999,
      "in_reply_to_id" : 481094927,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDczNzk5OQ==",
      "original_commit_id" : "b3a0e528d1128ee456258f4b265b52b7e8fbc6a6",
      "original_line" : 2938,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 503525221,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500737999",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r500739219"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500739219"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks!",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-10-07T05:03:59Z",
      "diff_hunk" : "@@ -0,0 +1,176 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message log binary files.  To be used in conjunction with -logmessages.\"\"\"\n+\n+import argparse\n+import os\n+import shutil\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List, Optional\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.messages import ser_uint256     # noqa: E402\n+from test_framework.mininode import MESSAGEMAP      # noqa: E402",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r500739219",
      "id" : 500739219,
      "in_reply_to_id" : 495583680,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDczOTIxOQ==",
      "original_commit_id" : "ba68f02310c8ce4080aca8153e644634354678ab",
      "original_line" : 19,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "contrib/message-logging/message-logging-parser.py",
      "position" : null,
      "pull_request_review_id" : 503526682,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/500739219",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`git range-diff master 18bcf97 d2d3d12`\r\n\r\n* Now uses `seek` instead of `read`\r\n* Fixed `mininode` to `p2p` problem\r\n* Removed unneeded `optimistic_send` boolean from `PushMessage`\r\n\r\nStill TODO: Documentation!",
      "created_at" : "2020-10-07T05:08:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-704694969",
      "id" : 704694969,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwNDY5NDk2OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-07T05:08:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/704694969",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Tested ACK d2d3d12d94477d0d377c82738832dfca2ac9e531\r\n\r\nLooking forward to having this in `master`. This functionality is super useful for 1.) learning purposes, 2.) troubleshooting purposes, and 3.) fuzzing purposes (easy generation of seed corpora from actual message data).\r\n\r\nI encourage others to review. To try this out:\r\n\r\n```\r\n$ gh checkout pr 19509 && make distclean && ./autogen.sh && ./configure --with-incompatible-bdb && make\r\n$ src/bitcoind -capturemessages\r\n# now look in ~/.bitcoin/message_capture/\r\n```\r\n\r\nThe availability of easy-to-use built-in tools such as this and `bitcoin-cli -netinfo` which allow for easy debugging/inspection of the P2P layer of Bitcoin Core will make the road to P2P understanding so much easier/quicker for future generations of Bitcoin Core contributions. Neat feature with great long-term benefits @troygiorshev! Thanks! :)",
      "created_at" : "2020-10-07T09:30:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-704814038",
      "id" : 704814038,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwNDgxNDAzOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-07T09:37:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/704814038",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r501096593"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/501096593"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think I'll leave formatting to the user!  I'll take the `jq` suggestion and add that as a note in the module docstring.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-10-07T15:16:32Z",
      "diff_hunk" : "@@ -0,0 +1,127 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message log binary files.  To be used in conjunction with -logmessages.\"\"\"\n+\n+import argparse\n+import os\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.messages import ser_uint256     # noqa: E402\n+from test_framework.mininode import MESSAGEMAP      # noqa: E402\n+from test_framework.util import assert_equal        # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+# The test framework classes stores hashes as large ints in many cases.\n+# There isn't a way to distinguish between a large int and a large int that is actually a blob of bytes.\n+# As such, they are itemized here\n+# (These can be easily found by looking for calls to deser_uint256, deser_uint256_vector, and uint256_from_str in messages.py)\n+HASH_INTS = [\n+    \"blockhash\",\n+    \"block_hash\",\n+    \"hash\",     # A few conflicts here\n+    \"hashMerkleRoot\",\n+    \"hashPrevBlock\",\n+    \"hashstop\",\n+    \"prev_header\",\n+    \"sha256\",\n+    \"stop_hash\",\n+]\n+\n+HASH_INT_VECTORS = [\n+    \"hashes\",\n+    \"headers\",  # One conflict here\n+    \"vHave\",\n+    \"vHash\",\n+]\n+\n+def to_jsonable(obj: Any) -> Any:\n+    if hasattr(obj, \"__dict__\"):\n+        return obj.__dict__\n+    elif hasattr(obj, \"__slots__\"):\n+        ret = {}    # type: Any\n+        for slot in obj.__slots__:\n+            val = getattr(obj, slot, None)\n+            if slot in HASH_INTS and isinstance(val, int):\n+                ret[slot] = ser_uint256(val).hex()\n+            elif slot in HASH_INT_VECTORS and isinstance(val[0], int):\n+                ret[slot] = [ser_uint256(a).hex() for a in val]\n+            else:\n+                ret[slot] = to_jsonable(val)\n+        return ret\n+    elif isinstance(obj, list):\n+        return [to_jsonable(a) for a in obj]\n+    elif isinstance(obj, bytes):\n+        return obj.hex()\n+    else:\n+        return obj\n+\n+\n+def process_file(path: str, messages: List[Any], recv: bool) -> None:\n+    with open(path, 'rb') as f_in:\n+        while True:\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int\n+            msgtype = tmp_header.read(MSGTYPE_SIZE).split(b'\\x00', 1)[0]     # type: bytes\n+            length = int.from_bytes(tmp_header.read(LENGTH_SIZE), \"little\")  # type: int\n+            if msgtype not in MESSAGEMAP:\n+                # For now just skip unrecognized messages\n+                f_in.read(length)\n+                continue\n+            payload_start_pos = f_in.tell()\n+            msg = MESSAGEMAP[msgtype]()\n+            msg.deserialize(f_in)\n+            payload_length = f_in.tell() - payload_start_pos\n+            assert_equal(length, payload_length)\n+            msg_dict = {}\n+            msg_dict[\"msgtype\"] = getattr(msg, \"msgtype\", None).decode()\n+            msg_dict[\"direction\"] = \"recv\" if recv else \"sent\"\n+            msg_dict[\"time\"] = time\n+            msg_dict[\"size\"] = length   # \"size\" is less readable here, but more readable in the output\n+            if length:\n+                msg_dict[\"body\"] = to_jsonable(msg)\n+            messages.append(msg_dict)\n+\n+\n+def main():\n+    \"\"\"Main\"\"\"\n+    parser = argparse.ArgumentParser(\n+        description=__doc__,\n+        epilog=\"EXAMPLE \\n\\t{0} -o out.json <data-dir>/message_logging/**/*.dat\".format(sys.argv[0]),\n+        formatter_class=argparse.RawTextHelpFormatter)\n+    parser.add_argument(\n+        \"logpaths\", nargs='+',\n+        help=\"binary message dump files to parse.\")\n+    parser.add_argument(\"-o\", \"--output\", help=\"output file.  If unset print to stdout\")\n+    args = parser.parse_args()\n+    logpaths = [Path.cwd() / Path(logpath) for logpath in args.logpaths]\n+    output = Path.cwd() / Path(args.output) if args.output else False\n+\n+    messages = []   # type: List[Any]\n+    for log in logpaths:\n+        process_file(str(log), messages, \"recv\" in log.stem)\n+\n+    messages.sort(key=lambda msg: msg['time'])\n+\n+    jsonrep = json.dumps(messages)\n+    if output:\n+        with open(str(output), 'w+', encoding=\"utf8\") as f_out:\n+            f_out.write(jsonrep)\n+    else:\n+        print(jsonrep)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r501096593",
      "id" : 501096593,
      "in_reply_to_id" : 472966785,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTA5NjU5Mw==",
      "original_commit_id" : "4fc2e3906377991a05f78a938c0aa2f04056b81c",
      "original_line" : 173,
      "original_position" : 124,
      "original_start_line" : null,
      "path" : "contrib/message-logging/message-logging-parser.py",
      "position" : null,
      "pull_request_review_id" : 503992691,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/501096593",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I'm planning to rereview this once the CI failures are fixed and the documentation is done.",
      "created_at" : "2020-10-09T09:57:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-706088661",
      "id" : 706088661,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwNjA4ODY2MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-09T09:57:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/706088661",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`git range-diff master d2d3d12 d0ffb34`\r\n\r\n* Fixed remaining `mininode` to `p2p` issue\r\n* Added documentation!",
      "created_at" : "2020-10-14T06:17:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-708183871",
      "id" : 708183871,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwODE4Mzg3MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-14T06:17:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/708183871",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`git range-diff master d0ffb34 9a9314a`\r\n\r\n* Rebased to master to fix Travis\r\n\r\nAll pending TODOs for this PR are complete.  Thanks to everyone who has reviewed so far, should be an easy reACK from many of you!",
      "created_at" : "2020-10-14T06:17:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-708183974",
      "id" : 708183974,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwODE4Mzk3NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-14T06:17:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/708183974",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK.",
      "created_at" : "2020-10-14T07:07:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-708206663",
      "id" : 708206663,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwODIwNjY2Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-14T07:07:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/708206663",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-ACK 9a9314aa454c88a577260406fed3cb391dc4e4a7: diff still looks correct\r\n\r\nLooking forward to having this neat feature in `master`!",
      "created_at" : "2020-10-14T07:45:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-708224567",
      "id" : 708224567,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwODIyNDU2Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-14T07:45:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/708224567",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r504472499"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/504472499"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Any reason for this behavior change?",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-10-14T07:51:54Z",
      "diff_hunk" : "@@ -2930,24 +2930,19 @@ void CConnman::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n     size_t nBytesSent = 0;\n     {\n         LOCK(pnode->cs_vSend);\n-        bool optimisticSend(pnode->vSendMsg.empty());\n \n         //log total amount of bytes per message type\n         pnode->mapSendBytesPerMsgCmd[msg.m_type] += nTotalSize;\n         pnode->nSendSize += nTotalSize;\n \n-        if (pnode->nSendSize > nSendBufferMaxSize)\n-            pnode->fPauseSend = true;\n+        if (pnode->nSendSize > nSendBufferMaxSize) pnode->fPauseSend = true;\n         pnode->vSendMsg.push_back(std::move(serializedHeader));\n-        if (nMessageSize)\n-            pnode->vSendMsg.push_back(std::move(msg.data));\n+        if (nMessageSize) pnode->vSendMsg.push_back(std::move(msg.data));\n \n         // If write queue empty, attempt \"optimistic write\"\n-        if (optimisticSend == true)\n-            nBytesSent = SocketSendData(pnode);\n+        if (pnode->vSendMsg.empty()) nBytesSent = SocketSendData(pnode);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r504472499",
      "id" : 504472499,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDQ3MjQ5OQ==",
      "original_commit_id" : "c2f62aefabc2b00ce0ed28901d80d636b600feef",
      "original_line" : 2943,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 508081864,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/504472499",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r504472745"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/504472745"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Probably causing the ci failures",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-10-14T07:52:18Z",
      "diff_hunk" : "@@ -2930,24 +2930,19 @@ void CConnman::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n     size_t nBytesSent = 0;\n     {\n         LOCK(pnode->cs_vSend);\n-        bool optimisticSend(pnode->vSendMsg.empty());\n \n         //log total amount of bytes per message type\n         pnode->mapSendBytesPerMsgCmd[msg.m_type] += nTotalSize;\n         pnode->nSendSize += nTotalSize;\n \n-        if (pnode->nSendSize > nSendBufferMaxSize)\n-            pnode->fPauseSend = true;\n+        if (pnode->nSendSize > nSendBufferMaxSize) pnode->fPauseSend = true;\n         pnode->vSendMsg.push_back(std::move(serializedHeader));\n-        if (nMessageSize)\n-            pnode->vSendMsg.push_back(std::move(msg.data));\n+        if (nMessageSize) pnode->vSendMsg.push_back(std::move(msg.data));\n \n         // If write queue empty, attempt \"optimistic write\"\n-        if (optimisticSend == true)\n-            nBytesSent = SocketSendData(pnode);\n+        if (pnode->vSendMsg.empty()) nBytesSent = SocketSendData(pnode);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r504472745",
      "id" : 504472745,
      "in_reply_to_id" : 504472499,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDQ3Mjc0NQ==",
      "original_commit_id" : "c2f62aefabc2b00ce0ed28901d80d636b600feef",
      "original_line" : 2943,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 508082166,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/504472745",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Removed my ACK (temporarily) in light of @MarcoFalke's [comment](https://github.com/bitcoin/bitcoin/pull/19509#discussion_r504472499) about the unrelated change in `src/net.cpp`. \r\n\r\nHopefully that will be resolved soon and I'd be glad to re-review :)",
      "created_at" : "2020-10-14T08:21:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-708242978",
      "id" : 708242978,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwODI0Mjk3OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-14T08:21:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/708242978",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r504680940"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/504680940"
         }
      },
      "author_association" : "MEMBER",
      "body" : "c2f62aefabc2b00ce0ed28901d80d636b600feef\r\n\r\nExactly, msg.data is pushed to `vSendMsg` right above.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-10-14T13:34:37Z",
      "diff_hunk" : "@@ -2930,24 +2930,19 @@ void CConnman::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n     size_t nBytesSent = 0;\n     {\n         LOCK(pnode->cs_vSend);\n-        bool optimisticSend(pnode->vSendMsg.empty());\n \n         //log total amount of bytes per message type\n         pnode->mapSendBytesPerMsgCmd[msg.m_type] += nTotalSize;\n         pnode->nSendSize += nTotalSize;\n \n-        if (pnode->nSendSize > nSendBufferMaxSize)\n-            pnode->fPauseSend = true;\n+        if (pnode->nSendSize > nSendBufferMaxSize) pnode->fPauseSend = true;\n         pnode->vSendMsg.push_back(std::move(serializedHeader));\n-        if (nMessageSize)\n-            pnode->vSendMsg.push_back(std::move(msg.data));\n+        if (nMessageSize) pnode->vSendMsg.push_back(std::move(msg.data));\n \n         // If write queue empty, attempt \"optimistic write\"\n-        if (optimisticSend == true)\n-            nBytesSent = SocketSendData(pnode);\n+        if (pnode->vSendMsg.empty()) nBytesSent = SocketSendData(pnode);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r504680940",
      "id" : 504680940,
      "in_reply_to_id" : 504472499,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDY4MDk0MA==",
      "original_commit_id" : "c2f62aefabc2b00ce0ed28901d80d636b600feef",
      "original_line" : 2943,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 508351542,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/504680940",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r504685058"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/504685058"
         }
      },
      "author_association" : "MEMBER",
      "body" : "2dd63707380ae5cdf79a2a8d98e0133f881f9381\r\n\r\nI know this is a debugging feature, but file open/close for each message is kind of bad right, also because close flushes?",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-10-14T13:40:10Z",
      "diff_hunk" : "@@ -2985,3 +2985,27 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void CaptureMessage(const CAddress& addr, const std::string& msg_type, const Span<const unsigned char>& data, bool is_incoming)\n+{\n+    auto time = GetTime<std::chrono::microseconds>();\n+\n+    // Windows folder names can not include a colon\n+    std::string clean_addr = addr.ToString();\n+    std::replace(clean_addr.begin(), clean_addr.end(), ':', '_');\n+\n+    fs::path base_path = GetDataDir() / \"message_capture\" / clean_addr;\n+    fs::create_directories(base_path);\n+\n+    fs::path path = base_path / (is_incoming ? \"msgs_recv.dat\" : \"msgs_sent.dat\");\n+    CAutoFile f(fsbridge::fopen(path, \"ab\"), SER_DISK, CLIENT_VERSION);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r504685058",
      "id" : 504685058,
      "line" : 2952,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDY4NTA1OA==",
      "original_commit_id" : "2dd63707380ae5cdf79a2a8d98e0133f881f9381",
      "original_line" : 2952,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 54,
      "pull_request_review_id" : 508351542,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/504685058",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "We could (also) expose these via ZMQ, just saying.",
      "created_at" : "2020-10-14T13:44:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-708411183",
      "id" : 708411183,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwODQxMTE4Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-14T13:44:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/708411183",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r505020396"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/505020396"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'll give this a look",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-10-14T22:24:09Z",
      "diff_hunk" : "@@ -2930,24 +2930,19 @@ void CConnman::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n     size_t nBytesSent = 0;\n     {\n         LOCK(pnode->cs_vSend);\n-        bool optimisticSend(pnode->vSendMsg.empty());\n \n         //log total amount of bytes per message type\n         pnode->mapSendBytesPerMsgCmd[msg.m_type] += nTotalSize;\n         pnode->nSendSize += nTotalSize;\n \n-        if (pnode->nSendSize > nSendBufferMaxSize)\n-            pnode->fPauseSend = true;\n+        if (pnode->nSendSize > nSendBufferMaxSize) pnode->fPauseSend = true;\n         pnode->vSendMsg.push_back(std::move(serializedHeader));\n-        if (nMessageSize)\n-            pnode->vSendMsg.push_back(std::move(msg.data));\n+        if (nMessageSize) pnode->vSendMsg.push_back(std::move(msg.data));\n \n         // If write queue empty, attempt \"optimistic write\"\n-        if (optimisticSend == true)\n-            nBytesSent = SocketSendData(pnode);\n+        if (pnode->vSendMsg.empty()) nBytesSent = SocketSendData(pnode);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r505020396",
      "id" : 505020396,
      "in_reply_to_id" : 504472499,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTAyMDM5Ng==",
      "original_commit_id" : "c2f62aefabc2b00ce0ed28901d80d636b600feef",
      "original_line" : 2943,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 508811939,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/505020396",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r505984756"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/505984756"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yep this was silly of me, thanks for finding the bug!",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-10-16T02:10:22Z",
      "diff_hunk" : "@@ -2930,24 +2930,19 @@ void CConnman::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n     size_t nBytesSent = 0;\n     {\n         LOCK(pnode->cs_vSend);\n-        bool optimisticSend(pnode->vSendMsg.empty());\n \n         //log total amount of bytes per message type\n         pnode->mapSendBytesPerMsgCmd[msg.m_type] += nTotalSize;\n         pnode->nSendSize += nTotalSize;\n \n-        if (pnode->nSendSize > nSendBufferMaxSize)\n-            pnode->fPauseSend = true;\n+        if (pnode->nSendSize > nSendBufferMaxSize) pnode->fPauseSend = true;\n         pnode->vSendMsg.push_back(std::move(serializedHeader));\n-        if (nMessageSize)\n-            pnode->vSendMsg.push_back(std::move(msg.data));\n+        if (nMessageSize) pnode->vSendMsg.push_back(std::move(msg.data));\n \n         // If write queue empty, attempt \"optimistic write\"\n-        if (optimisticSend == true)\n-            nBytesSent = SocketSendData(pnode);\n+        if (pnode->vSendMsg.empty()) nBytesSent = SocketSendData(pnode);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r505984756",
      "id" : 505984756,
      "in_reply_to_id" : 504472499,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTk4NDc1Ng==",
      "original_commit_id" : "c2f62aefabc2b00ce0ed28901d80d636b600feef",
      "original_line" : 2943,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 509964773,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/505984756",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`git range-diff master 9a9314a 2418ec6`\r\n\r\n* Reverted the change to optimisticSend\r\n\r\nTravis shouldâ¢ pass now.  I can't get the fuzz tests to build, but I get the same linker error on `master` as I do here, so I assume it's unrelated. ",
      "created_at" : "2020-10-16T02:41:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-709696165",
      "id" : 709696165,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwOTY5NjE2NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-16T02:41:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/709696165",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r506003646"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/506003646"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm not sure that I see the disadvantage.  The alternative required using a greater number of file descriptors, which I thought was worse.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-10-16T02:44:28Z",
      "diff_hunk" : "@@ -2985,3 +2985,27 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void CaptureMessage(const CAddress& addr, const std::string& msg_type, const Span<const unsigned char>& data, bool is_incoming)\n+{\n+    auto time = GetTime<std::chrono::microseconds>();\n+\n+    // Windows folder names can not include a colon\n+    std::string clean_addr = addr.ToString();\n+    std::replace(clean_addr.begin(), clean_addr.end(), ':', '_');\n+\n+    fs::path base_path = GetDataDir() / \"message_capture\" / clean_addr;\n+    fs::create_directories(base_path);\n+\n+    fs::path path = base_path / (is_incoming ? \"msgs_recv.dat\" : \"msgs_sent.dat\");\n+    CAutoFile f(fsbridge::fopen(path, \"ab\"), SER_DISK, CLIENT_VERSION);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r506003646",
      "id" : 506003646,
      "in_reply_to_id" : 504685058,
      "line" : 2952,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjAwMzY0Ng==",
      "original_commit_id" : "2dd63707380ae5cdf79a2a8d98e0133f881f9381",
      "original_line" : 2952,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 54,
      "pull_request_review_id" : 509974648,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/506003646",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Cirrus failing to fetch `sqlite-autoconf-3320100.tar.gz`, 404.  Unrelated.",
      "created_at" : "2020-10-16T09:46:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-709944745",
      "id" : 709944745,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwOTk0NDc0NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-16T09:46:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/709944745",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r506402741"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/506402741"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If measurements show that this ever becomes a problem in practice it can be tackled in a follow-up.\r\n\r\nTBH I'm much more worried about the possible file descriptor DoS vector that we would risk open up if the file descriptor were kept open.\r\n\r\nSecurity first! :)",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-10-16T13:14:49Z",
      "diff_hunk" : "@@ -2985,3 +2985,27 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void CaptureMessage(const CAddress& addr, const std::string& msg_type, const Span<const unsigned char>& data, bool is_incoming)\n+{\n+    auto time = GetTime<std::chrono::microseconds>();\n+\n+    // Windows folder names can not include a colon\n+    std::string clean_addr = addr.ToString();\n+    std::replace(clean_addr.begin(), clean_addr.end(), ':', '_');\n+\n+    fs::path base_path = GetDataDir() / \"message_capture\" / clean_addr;\n+    fs::create_directories(base_path);\n+\n+    fs::path path = base_path / (is_incoming ? \"msgs_recv.dat\" : \"msgs_sent.dat\");\n+    CAutoFile f(fsbridge::fopen(path, \"ab\"), SER_DISK, CLIENT_VERSION);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r506402741",
      "id" : 506402741,
      "in_reply_to_id" : 504685058,
      "line" : 2952,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjQwMjc0MQ==",
      "original_commit_id" : "2dd63707380ae5cdf79a2a8d98e0133f881f9381",
      "original_line" : 2952,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 54,
      "pull_request_review_id" : 510456205,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/506402741",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 2418ec658ccd2e8e033bced0f5b7c183946940ac",
      "created_at" : "2020-10-16T13:48:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-710058576",
      "id" : 710058576,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxMDA1ODU3Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-16T13:48:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/710058576",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "The changes themselves LGTM. However, while testing the feature on mainnet, the parsing tool `contrib/message-capture/message-capture-parser.py` encountered a problem decoding the following `version` message:\r\n\r\n```\r\n$ xxd -g1 msgs_recv.dat\r\n00000000: 75 da 89 ca 28 b4 05 00 76 65 72 73 69 6f 6e 00  u...(...version.\r\n00000010: 00 00 00 00 6b 00 00 00 60 ea 00 00 00 00 00 00  ....k...`.......\r\n00000020: 00 00 00 00 95 68 b1 5f 00 00 00 00 01 00 00 00  .....h._........\r\n00000030: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ff ff  ................\r\n00000040: d9 4f b2 14 20 8d 01 00 00 00 00 00 00 00 00 00  .O.. ...........\r\n00000050: 00 00 00 00 00 00 00 00 ff ff 00 00 00 00 00 00  ................\r\n00000060: 25 08 55 ca 19 a0 39 05 15 2f 62 69 74 63 6f 69  %.U...9../bitcoi\r\n00000070: 6e 2d 73 65 65 64 65 72 3a 30 2e 30 31 2f 30 57  n-seeder:0.01/0W\r\n00000080: 05 00 00                                         ...\r\n```\r\nThis output can be converted back to the binary file via `xxd -r hexdump.txt`. If anyone has a better idea how to share binary data for reviewing here (probably base64 or alike?), I'd be glad to hear it.\r\n\r\n```\r\n$ contrib/message-capture/message-capture-parser.py ~/.bitcoin/message_capture/78.244.132.5_52410/*\r\nProcessing /home/honeybadger/.bitcoin/message_capture/78.244.132.5_52410/msgs_recv.dat\r\nTraceback (most recent call last):\r\n  File \"contrib/message-capture/message-capture-parser.py\", line 178, in <module>\r\n    main()\r\n  File \"contrib/message-capture/message-capture-parser.py\", line 160, in main\r\n    process_file(str(capture), messages, \"recv\" in capture.stem, progress_bar)\r\n  File \"contrib/message-capture/message-capture-parser.py\", line 117, in process_file\r\n    assert_equal(length, payload_length)\r\n  File \"contrib/message-capture/../../test/functional/test_framework/util.py\", line 50, in assert_equal                                                                                                   \r\n    raise AssertionError(\"not(%s)\" % \" == \".join(str(arg) for arg in (thing1, thing2) + args))\r\nAssertionError: not(107 == 106)\r\n```\r\nIt seems like the deserialization routine for `msg_version` is consuming one byte less than expected. Guess that has to do with the optional `fRelay` field at the end. See also [BIP37](https://github.com/bitcoin/bips/blob/master/bip-0037.mediawiki#Extensions_to_existing_messages) and [BIP60](https://github.com/bitcoin/bips/blob/master/bip-0060.mediawiki) -- the latter is a draft, but it seems to summarize perfectly the problem we have here.",
      "created_at" : "2020-11-15T19:59:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-727627176",
      "id" : 727627176,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyNzYyNzE3Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-15T20:00:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/727627176",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r523807168"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/523807168"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: I'd just drop the `python` command part and call the script directly (also because on some systems, `python` symlinks to `python2`, not `python3`! See also https://www.python.org/dev/peps/pep-0394/), thanks to the she-bang on top of the file the right python interpreter will be called.\r\n",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-11-15T20:10:48Z",
      "diff_hunk" : "@@ -0,0 +1,25 @@\n+# Per-Peer Message Capture\n+\n+## Purpose\n+\n+This feature allows for message capture on a per-peer basis.  It answers the simple question: \"Can I see what messages my node is sending and receiving?\"\n+\n+## Usage and Functionality\n+\n+* Run `bitcoind` with the `-capturemessage` option.\n+* Look in the `message_capture` folder in your datadir.\n+  * Typically this will be `~/.bitcoin/message_capture`.\n+  * See that there are many folders inside, one for each peer names with its IP address and port.\n+  * Inside each peer's folder there are two `.dat` files: one is for received messages (`msgs_recv.dat`) and the other is for sent messages (`msgs_sent.dat`).\n+* Run `contrib/message-capture/message-capture-parser.py` with the proper arguments.\n+  * See the `-h` option for help.\n+  * To see all messages, both sent and received, for all peers use:\n+    ```\n+    python contrib/message-capture/message-capture-parser.py -o out.json \\",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r523807168",
      "id" : 523807168,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzgwNzE2OA==",
      "original_commit_id" : "2418ec658ccd2e8e033bced0f5b7c183946940ac",
      "original_line" : 18,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "contrib/message-capture/message-capture-docs.md",
      "position" : null,
      "pull_request_review_id" : 530830774,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/523807168",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r523807480"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/523807480"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: Could simply use `jq out.json` here (see also the \"The Useless Use of Cat Award\" http://porkmail.org/era/unix/award.html#cat)",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-11-15T20:13:55Z",
      "diff_hunk" : "@@ -0,0 +1,25 @@\n+# Per-Peer Message Capture\n+\n+## Purpose\n+\n+This feature allows for message capture on a per-peer basis.  It answers the simple question: \"Can I see what messages my node is sending and receiving?\"\n+\n+## Usage and Functionality\n+\n+* Run `bitcoind` with the `-capturemessage` option.\n+* Look in the `message_capture` folder in your datadir.\n+  * Typically this will be `~/.bitcoin/message_capture`.\n+  * See that there are many folders inside, one for each peer names with its IP address and port.\n+  * Inside each peer's folder there are two `.dat` files: one is for received messages (`msgs_recv.dat`) and the other is for sent messages (`msgs_sent.dat`).\n+* Run `contrib/message-capture/message-capture-parser.py` with the proper arguments.\n+  * See the `-h` option for help.\n+  * To see all messages, both sent and received, for all peers use:\n+    ```\n+    python contrib/message-capture/message-capture-parser.py -o out.json \\\n+    ~/.bitcoin/message_capture/**/*.dat\n+    ```\n+  * Note:  The messages in the given `.dat` files will be interleaved in chronological order.  So, giving both received and sent `.dat` files (as above with `*.dat`) will result in all messages being interleaved in chronological order.\n+  * If an output file is not provided (i.e. the `-o` option is not used), then the output prints to `stdout`.\n+* View the resulting output.\n+  * The output file is `JSON` formatted.\n+  * Suggestion: use `jq` to view the output, with `cat out.json | jq`",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r523807480",
      "id" : 523807480,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzgwNzQ4MA==",
      "original_commit_id" : "2418ec658ccd2e8e033bced0f5b7c183946940ac",
      "original_line" : 25,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "contrib/message-capture/message-capture-docs.md",
      "position" : null,
      "pull_request_review_id" : 530830774,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/523807480",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r525552080"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525552080"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for the link :)\r\n\r\n`cat foo.txt | less` is so common I once saw the suggestion to set a shell alias:\r\n`alias L='| less'`\r\nso that you can run `cat foo.txt L`!",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-11-17T21:58:18Z",
      "diff_hunk" : "@@ -0,0 +1,25 @@\n+# Per-Peer Message Capture\n+\n+## Purpose\n+\n+This feature allows for message capture on a per-peer basis.  It answers the simple question: \"Can I see what messages my node is sending and receiving?\"\n+\n+## Usage and Functionality\n+\n+* Run `bitcoind` with the `-capturemessage` option.\n+* Look in the `message_capture` folder in your datadir.\n+  * Typically this will be `~/.bitcoin/message_capture`.\n+  * See that there are many folders inside, one for each peer names with its IP address and port.\n+  * Inside each peer's folder there are two `.dat` files: one is for received messages (`msgs_recv.dat`) and the other is for sent messages (`msgs_sent.dat`).\n+* Run `contrib/message-capture/message-capture-parser.py` with the proper arguments.\n+  * See the `-h` option for help.\n+  * To see all messages, both sent and received, for all peers use:\n+    ```\n+    python contrib/message-capture/message-capture-parser.py -o out.json \\\n+    ~/.bitcoin/message_capture/**/*.dat\n+    ```\n+  * Note:  The messages in the given `.dat` files will be interleaved in chronological order.  So, giving both received and sent `.dat` files (as above with `*.dat`) will result in all messages being interleaved in chronological order.\n+  * If an output file is not provided (i.e. the `-o` option is not used), then the output prints to `stdout`.\n+* View the resulting output.\n+  * The output file is `JSON` formatted.\n+  * Suggestion: use `jq` to view the output, with `cat out.json | jq`",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r525552080",
      "id" : 525552080,
      "in_reply_to_id" : 523807480,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU1MjA4MA==",
      "original_commit_id" : "2418ec658ccd2e8e033bced0f5b7c183946940ac",
      "original_line" : 25,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "contrib/message-capture/message-capture-docs.md",
      "position" : null,
      "pull_request_review_id" : 532846982,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525552080",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r525559389"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525559389"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thank you again for the link.  I'm so used to having python environment problems that I've always tried to be as explicit as possible when running python scripts.  Since switching to conda I haven't had any problems, and I'm sure other people have things figured out as well (Either they only have one python install or they use an environment manager too).  I'll make this change.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-11-17T22:12:30Z",
      "diff_hunk" : "@@ -0,0 +1,25 @@\n+# Per-Peer Message Capture\n+\n+## Purpose\n+\n+This feature allows for message capture on a per-peer basis.  It answers the simple question: \"Can I see what messages my node is sending and receiving?\"\n+\n+## Usage and Functionality\n+\n+* Run `bitcoind` with the `-capturemessage` option.\n+* Look in the `message_capture` folder in your datadir.\n+  * Typically this will be `~/.bitcoin/message_capture`.\n+  * See that there are many folders inside, one for each peer names with its IP address and port.\n+  * Inside each peer's folder there are two `.dat` files: one is for received messages (`msgs_recv.dat`) and the other is for sent messages (`msgs_sent.dat`).\n+* Run `contrib/message-capture/message-capture-parser.py` with the proper arguments.\n+  * See the `-h` option for help.\n+  * To see all messages, both sent and received, for all peers use:\n+    ```\n+    python contrib/message-capture/message-capture-parser.py -o out.json \\",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r525559389",
      "id" : 525559389,
      "in_reply_to_id" : 523807168,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU1OTM4OQ==",
      "original_commit_id" : "2418ec658ccd2e8e033bced0f5b7c183946940ac",
      "original_line" : 18,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "contrib/message-capture/message-capture-docs.md",
      "position" : null,
      "pull_request_review_id" : 532856303,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525559389",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`git range-diff master 2418ec6 4690881`\r\n\r\n* Fixed version fRelay bug\r\n  * The parser now more closely matches how parsing works in the test framework and in bitcoind\r\n* Documentation now follows PEP 0394\r\n* Removed cat overuse in documentation\r\n\r\nFirst of all, many thanks @theStack for both finding the bug and identifying exactly what causes it.  Your guess was spot on and the links to the BIPs were very useful!  It ended up identifying a small bug with how I implemented my message parser.\r\n\r\nHowever, I'm not sure what to think about this message.  Looking at it closely, it has the following:\r\n\r\n* Version = 60000\r\n* fRelay = 0 (1 byte)\r\n* Declared payload size = 107\r\n* Actual payload size = 107\r\n\r\nThe fRelay field is only supposed to exist as of version 70001.  So this message is malformed.  But, in the protocol's implementation in bitcoind, we don't check this.\r\n\r\nThis is a discrepancy between our testing framework and bitcoind.  If fRelay was 1 for a message with version <70001, bitcoind would take it as a 1, whereas our testing framework would take it was a 0.  I don't think this will ever happen in the real world, but it's worth noting.  I've opened a PR to discuss this as #20411.\r\n\r\nFor now I take this as fixed.",
      "created_at" : "2020-11-18T00:42:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-729302211",
      "id" : 729302211,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyOTMwMjIxMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-18T01:01:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/729302211",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Also, I thought sharing the binary file as a hexdump worked great!  Thanks for adding the tip to use xxd's `-r` flag.  I personally use HxD in Windows to view and edit binary files.  It's a GUI so everything's messy - someone who uses xxd with vim might have a good reason to have binary files shared one way or another.",
      "created_at" : "2020-11-18T01:03:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-729308771",
      "id" : 729308771,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyOTMwODc3MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-18T01:08:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/729308771",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r525840678"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525840678"
         }
      },
      "author_association" : "MEMBER",
      "body" : "contrib/message-capture/message-capture-parser.py:20:1: F401 'test_framework.util.assert_equal' imported but unused",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2020-11-18T06:24:34Z",
      "diff_hunk" : "@@ -0,0 +1,174 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message capture binary files.  To be used in conjunction with -capturemessages.\"\"\"\n+\n+import argparse\n+import os\n+import shutil\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List, Optional\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.messages import ser_uint256     # noqa: E402\n+from test_framework.p2p import MESSAGEMAP           # noqa: E402\n+from test_framework.util import assert_equal        # noqa: E402",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r525840678",
      "id" : 525840678,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTg0MDY3OA==",
      "original_commit_id" : "4690881fc52a2d5d8b17c7a1e4ae07d3e2d88e14",
      "original_line" : 20,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "contrib/message-capture/message-capture-parser.py",
      "position" : null,
      "pull_request_review_id" : 533134376,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/525840678",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "another example: In commit fa74d3d720f I removed unused deserialize code, because supported versions of Bitcoin Core would never serialize such a version message. (We only use the test framework to test supported versions of Core). So I am wondering if the message capture may ever write a message that can't be parsed by our test code. And if there is a way to protect against this.",
      "created_at" : "2020-11-18T06:29:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-729462566",
      "id" : 729462566,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyOTQ2MjU2Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-18T06:29:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/729462566",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Is there any chance this PR could get a release milestone?\r\n\r\nFWIW I love this feature and would love to see it in `master` soon :)  Thanks @troygiorshev!",
      "created_at" : "2020-11-18T10:02:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-729571242",
      "id" : 729571242,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyOTU3MTI0Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-18T10:02:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/729571242",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-11-19T16:36:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-730493789",
      "id" : 730493789,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDczMDQ5Mzc4OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-19T16:36:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/730493789",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> So I am wondering if the message capture may ever write a message that can't be parsed by our test code. And if there is a way to protect against this.\r\n\r\nIdeally, in my mind, our test code should function as closely as possible to Core.  So, if a message can be parsed by Core it should be able to be parsed by our test code.  You're right that this will get tricky for undefined behavior or broken messages like this.\r\n\r\n~~For now I'll add a MIN_PEER_PROTO_VERSION check as suggested [in 14025](https://github.com/bitcoin/bitcoin/pull/14025#issuecomment-415426683).~~\r\n\r\nEdit: We still have to have a way to deal with messages that fail to be deserialized by the test code.  Doesn't appear to be a problem, see below.",
      "created_at" : "2020-11-25T07:01:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-733509943",
      "id" : 733509943,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDczMzUwOTk0Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-25T07:21:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/733509943",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "the message capture code will write the message *before* parsing. So except for the message header (message type) nothing is parsed, it could be any raw byte string. There is no way the test framework could make sense of that if not by accident.",
      "created_at" : "2020-11-25T07:06:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-733511635",
      "id" : 733511635,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDczMzUxMTYzNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-25T07:06:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/733511635",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Oh, yeah you're completely right, thanks.\r\n\r\nLuckily (due to #19107) only messages with a valid header are pushed onto the vRecv queue, given to ProcessMessages, and parsed by the message capture parser.  So we can trust that the header is workable.  This will allow us to simply skip ~~messages~~ files that contain messages that fail deserilization, and we should be able to continue parsing all of the other ones.\r\n\r\nI'll think of a nice way to signal this to the user.\r\n\r\nEdit: I think we'll have to skip the entire file that contains a bad message, as a bad stated size will result in the next message being deserialized badly almost all of the time.  I'll experiment and see how best to fix this.",
      "created_at" : "2020-11-25T07:20:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-733517645",
      "id" : 733517645,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDczMzUxNzY0NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-06T15:15:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/733517645",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`git range-diff master 4690881 abbb8ac`\r\n\r\n* Parser now no longer crashes when it reaches an unrecognized or broken message.  Instead it simply skips that message and the rest of the file the message came from.\r\n* Removed an unused import from the previous force push",
      "created_at" : "2021-01-19T20:49:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-763130904",
      "id" : 763130904,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MzEzMDkwNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-19T20:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/763130904",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`git range-diff master abbb8ac d2e0f73`\r\n\r\n* Rebased",
      "created_at" : "2021-01-19T21:03:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-763139446",
      "id" : 763139446,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MzEzOTQ0Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-19T21:03:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/763139446",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r560507013"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560507013"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: \"P2P\" is more commonly used.\r\n\r\n```\r\n$ git grep -E ' P2P ' | wc -l\r\n230\r\n$ git grep -E ' p2p ' | wc -l\r\n63\r\n```",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-19T21:26:53Z",
      "diff_hunk" : "@@ -521,6 +521,7 @@ void SetupServerArgs(NodeContext& node)\n     argsman.AddArg(\"-limitdescendantcount=<n>\", strprintf(\"Do not accept transactions if any ancestor would have <n> or more in-mempool descendants (default: %u)\", DEFAULT_DESCENDANT_LIMIT), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-limitdescendantsize=<n>\", strprintf(\"Do not accept transactions if any ancestor would have more than <n> kilobytes of in-mempool descendants (default: %u).\", DEFAULT_DESCENDANT_SIZE_LIMIT), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-addrmantest\", \"Allows to test address relay on localhost\", ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n+    argsman.AddArg(\"-capturemessages\", \"Capture all p2p messages to file\", ArgsManager::ALLOW_BOOL | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r560507013",
      "id" : 560507013,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDUwNzAxMw==",
      "original_commit_id" : "d2e0f731c5c7a2e1c060beb1ed5b16e7632e5f9d",
      "original_line" : 524,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 571674570,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560507013",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r560511017"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560511017"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This should be `-capturemessages` (with ending \"s\") :)",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-19T21:34:02Z",
      "diff_hunk" : "@@ -0,0 +1,25 @@\n+# Per-Peer Message Capture\n+\n+## Purpose\n+\n+This feature allows for message capture on a per-peer basis.  It answers the simple question: \"Can I see what messages my node is sending and receiving?\"\n+\n+## Usage and Functionality\n+\n+* Run `bitcoind` with the `-capturemessage` option.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r560511017",
      "id" : 560511017,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDUxMTAxNw==",
      "original_commit_id" : "d2e0f731c5c7a2e1c060beb1ed5b16e7632e5f9d",
      "original_line" : 9,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "contrib/message-capture/message-capture-docs.md",
      "position" : null,
      "pull_request_review_id" : 571674570,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560511017",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r560516632"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560516632"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Sounds good, and Wikipedia agrees.  Fixed",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-19T21:44:34Z",
      "diff_hunk" : "@@ -521,6 +521,7 @@ void SetupServerArgs(NodeContext& node)\n     argsman.AddArg(\"-limitdescendantcount=<n>\", strprintf(\"Do not accept transactions if any ancestor would have <n> or more in-mempool descendants (default: %u)\", DEFAULT_DESCENDANT_LIMIT), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-limitdescendantsize=<n>\", strprintf(\"Do not accept transactions if any ancestor would have more than <n> kilobytes of in-mempool descendants (default: %u).\", DEFAULT_DESCENDANT_SIZE_LIMIT), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-addrmantest\", \"Allows to test address relay on localhost\", ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n+    argsman.AddArg(\"-capturemessages\", \"Capture all p2p messages to file\", ArgsManager::ALLOW_BOOL | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r560516632",
      "id" : 560516632,
      "in_reply_to_id" : 560507013,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDUxNjYzMg==",
      "original_commit_id" : "d2e0f731c5c7a2e1c060beb1ed5b16e7632e5f9d",
      "original_line" : 524,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 571686513,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560516632",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r560516802"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560516802"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thank you!",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-19T21:44:54Z",
      "diff_hunk" : "@@ -0,0 +1,25 @@\n+# Per-Peer Message Capture\n+\n+## Purpose\n+\n+This feature allows for message capture on a per-peer basis.  It answers the simple question: \"Can I see what messages my node is sending and receiving?\"\n+\n+## Usage and Functionality\n+\n+* Run `bitcoind` with the `-capturemessage` option.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r560516802",
      "id" : 560516802,
      "in_reply_to_id" : 560511017,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDUxNjgwMg==",
      "original_commit_id" : "d2e0f731c5c7a2e1c060beb1ed5b16e7632e5f9d",
      "original_line" : 9,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "contrib/message-capture/message-capture-docs.md",
      "position" : null,
      "pull_request_review_id" : 571686766,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560516802",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`git range-diff master d2e0f73 af8bcd1`\r\n\r\n* Fixed two typos in documentation",
      "created_at" : "2021-01-19T21:46:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-763162247",
      "id" : 763162247,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MzE2MjI0Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-19T21:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/763162247",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Tested ACK af8bcd1a6ecdfa15d7fb0f98256d47dec9b40f61",
      "created_at" : "2021-01-20T02:43:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-763289712",
      "id" : 763289712,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MzI4OTcxMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-20T02:43:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/763289712",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r560878242"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560878242"
         }
      },
      "author_association" : "MEMBER",
      "body" : "There's no need to explicitly convert to a span from a vector since #18468 was merged.\r\n\r\n```suggestion\r\n        CaptureMessage(pnode->addr, msg.m_type, msg.data, /* incoming */ false);\r\n```\r\n\r\nNo need to change this unless you touch the branch for another reason.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-20T11:10:17Z",
      "diff_hunk" : "@@ -2864,6 +2864,9 @@ void CConnman::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n {\n     size_t nMessageSize = msg.data.size();\n     LogPrint(BCLog::NET, \"sending %s (%d bytes) peer=%d\\n\",  SanitizeString(msg.m_type), nMessageSize, pnode->GetId());\n+    if (gArgs.GetBoolArg(\"-capturemessages\", false)) {\n+        CaptureMessage(pnode->addr, msg.m_type, MakeSpan(msg.data), /* incoming */ false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r560878242",
      "id" : 560878242,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDg3ODI0Mg==",
      "original_commit_id" : "af8bcd1a6ecdfa15d7fb0f98256d47dec9b40f61",
      "original_line" : 2868,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 572113296,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560878242",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r560883409"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560883409"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No need to duplicate the process_file call:\r\n\r\n```suggestion\r\n    else:\r\n        progress_bar = None\r\n\r\n    for capture in capturepaths:\r\n        process_file(str(capture), messages, \"recv\" in capture.stem, progress_bar)\r\n```",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-20T11:19:11Z",
      "diff_hunk" : "@@ -0,0 +1,188 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message capture binary files.  To be used in conjunction with -capturemessages.\"\"\"\n+\n+import argparse\n+import os\n+import shutil\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List, Optional\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.messages import ser_uint256     # noqa: E402\n+from test_framework.p2p import MESSAGEMAP           # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+# The test framework classes stores hashes as large ints in many cases.\n+# These are variables of type uint256 in core.\n+# There isn't a way to distinguish between a large int and a large int that is actually a blob of bytes.\n+# As such, they are itemized here.\n+# Any variables with these names that are of type int are actually uint256 variables.\n+# (These can be easily found by looking for calls to deser_uint256, deser_uint256_vector, and uint256_from_str in messages.py)\n+HASH_INTS = [\n+    \"blockhash\",\n+    \"block_hash\",\n+    \"hash\",\n+    \"hashMerkleRoot\",\n+    \"hashPrevBlock\",\n+    \"hashstop\",\n+    \"prev_header\",\n+    \"sha256\",\n+    \"stop_hash\",\n+]\n+\n+HASH_INT_VECTORS = [\n+    \"hashes\",\n+    \"headers\",\n+    \"vHave\",\n+    \"vHash\",\n+]\n+\n+\n+class ProgressBar:\n+    def __init__(self, total: float):\n+        self.total = total\n+        self.running = 0\n+\n+    def set_progress(self, progress: float):\n+        cols = shutil.get_terminal_size()[0]\n+        if cols <= 12:\n+            return\n+        max_blocks = cols - 9\n+        num_blocks = int(max_blocks*progress)\n+        print('\\r[ {}{} ] {:3.0f}%'.format(\n+                '#'*num_blocks,\n+                ' '*(max_blocks - num_blocks),\n+                progress*100),\n+            end ='')\n+\n+    def update(self, more: float):\n+        self.running += more\n+        self.set_progress(self.running / self.total)\n+\n+\n+def to_jsonable(obj: Any) -> Any:\n+    if hasattr(obj, \"__dict__\"):\n+        return obj.__dict__\n+    elif hasattr(obj, \"__slots__\"):\n+        ret = {}    # type: Any\n+        for slot in obj.__slots__:\n+            val = getattr(obj, slot, None)\n+            if slot in HASH_INTS and isinstance(val, int):\n+                ret[slot] = ser_uint256(val).hex()\n+            elif slot in HASH_INT_VECTORS and isinstance(val[0], int):\n+                ret[slot] = [ser_uint256(a).hex() for a in val]\n+            else:\n+                ret[slot] = to_jsonable(val)\n+        return ret\n+    elif isinstance(obj, list):\n+        return [to_jsonable(a) for a in obj]\n+    elif isinstance(obj, bytes):\n+        return obj.hex()\n+    else:\n+        return obj\n+\n+\n+def process_file(path: str, messages: List[Any], recv: bool, progress_bar: Optional[ProgressBar]) -> None:\n+    with open(path, 'rb') as f_in:\n+        if progress_bar:\n+            bytes_read = 0\n+        while True:\n+            if progress_bar:\n+                # Update progress bar\n+                diff = f_in.tell() - bytes_read - 1\n+                progress_bar.update(diff)\n+                bytes_read = f_in.tell() - 1\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int\n+            msgtype = tmp_header.read(MSGTYPE_SIZE).split(b'\\x00', 1)[0]     # type: bytes\n+            length = int.from_bytes(tmp_header.read(LENGTH_SIZE), \"little\")  # type: int\n+            if msgtype not in MESSAGEMAP:\n+                # For now just skip unrecognized messages\n+                f_in.seek(length, os.SEEK_CUR)\n+                print(f\"Skipping unrecognized message type {msgtype}\", file=sys.stderr)\n+                continue\n+            msg_ser = BytesIO(f_in.read(length))\n+            msg = MESSAGEMAP[msgtype]()\n+            try:\n+                msg.deserialize(msg_ser)\n+            except KeyboardInterrupt:\n+                raise\n+            except Exception:\n+                # Message was bad, skip the rest of the file\n+                print(f\"Found broken message, skipping remainder of file: {path}\", file=sys.stderr)\n+                break\n+            msg_dict = {}\n+            msg_dict[\"msgtype\"] = getattr(msg, \"msgtype\", None).decode()\n+            msg_dict[\"direction\"] = \"recv\" if recv else \"sent\"\n+            msg_dict[\"time\"] = time\n+            msg_dict[\"size\"] = length   # \"size\" is less readable here, but more readable in the output\n+            if length:\n+                msg_dict[\"body\"] = to_jsonable(msg)\n+            messages.append(msg_dict)\n+        if progress_bar:\n+            # Update the progress bar to the end of the current file\n+            # in case we exited the loop early\n+            f_in.seek(0, os.SEEK_END)   # Go to end of file\n+            diff = f_in.tell() - bytes_read - 1\n+            progress_bar.update(diff)\n+\n+\n+def main():\n+    \"\"\"Main\"\"\"\n+    parser = argparse.ArgumentParser(\n+        description=__doc__,\n+        epilog=\"EXAMPLE \\n\\t{0} -o out.json <data-dir>/message_capture/**/*.dat\".format(sys.argv[0]),\n+        formatter_class=argparse.RawTextHelpFormatter)\n+    parser.add_argument(\n+        \"capturepaths\",\n+        nargs='+',\n+        help=\"binary message capture files to parse.\")\n+    parser.add_argument(\n+        \"-o\", \"--output\",\n+        help=\"output file.  If unset print to stdout\")\n+    parser.add_argument(\n+        \"--no-progress-bar\",\n+        action='store_true',\n+        help=\"disable the progress bar.  Automatically set if the output is not a terminal\")\n+    args = parser.parse_args()\n+    capturepaths = [Path.cwd() / Path(capturepath) for capturepath in args.capturepaths]\n+    output = Path.cwd() / Path(args.output) if args.output else False\n+    use_progress_bar = (not args.no_progress_bar) and sys.stdout.isatty()\n+\n+    messages = []   # type: List[Any]\n+    if use_progress_bar:\n+        total_size = sum(capture.stat().st_size for capture in capturepaths)\n+        progress_bar = ProgressBar(total_size)\n+        for capture in capturepaths:\n+            process_file(str(capture), messages, \"recv\" in capture.stem, progress_bar)\n+    else:\n+        for capture in capturepaths:\n+            process_file(str(capture), messages, \"recv\" in capture.stem, None)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r560883409",
      "id" : 560883409,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDg4MzQwOQ==",
      "original_commit_id" : "af8bcd1a6ecdfa15d7fb0f98256d47dec9b40f61",
      "original_line" : 173,
      "original_position" : 173,
      "original_start_line" : 169,
      "path" : "contrib/message-capture/message-capture-parser.py",
      "position" : null,
      "pull_request_review_id" : 572113296,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560883409",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r560883958"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560883958"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can you add `-n` as a short argument here?",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-20T11:20:13Z",
      "diff_hunk" : "@@ -0,0 +1,188 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message capture binary files.  To be used in conjunction with -capturemessages.\"\"\"\n+\n+import argparse\n+import os\n+import shutil\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List, Optional\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.messages import ser_uint256     # noqa: E402\n+from test_framework.p2p import MESSAGEMAP           # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+# The test framework classes stores hashes as large ints in many cases.\n+# These are variables of type uint256 in core.\n+# There isn't a way to distinguish between a large int and a large int that is actually a blob of bytes.\n+# As such, they are itemized here.\n+# Any variables with these names that are of type int are actually uint256 variables.\n+# (These can be easily found by looking for calls to deser_uint256, deser_uint256_vector, and uint256_from_str in messages.py)\n+HASH_INTS = [\n+    \"blockhash\",\n+    \"block_hash\",\n+    \"hash\",\n+    \"hashMerkleRoot\",\n+    \"hashPrevBlock\",\n+    \"hashstop\",\n+    \"prev_header\",\n+    \"sha256\",\n+    \"stop_hash\",\n+]\n+\n+HASH_INT_VECTORS = [\n+    \"hashes\",\n+    \"headers\",\n+    \"vHave\",\n+    \"vHash\",\n+]\n+\n+\n+class ProgressBar:\n+    def __init__(self, total: float):\n+        self.total = total\n+        self.running = 0\n+\n+    def set_progress(self, progress: float):\n+        cols = shutil.get_terminal_size()[0]\n+        if cols <= 12:\n+            return\n+        max_blocks = cols - 9\n+        num_blocks = int(max_blocks*progress)\n+        print('\\r[ {}{} ] {:3.0f}%'.format(\n+                '#'*num_blocks,\n+                ' '*(max_blocks - num_blocks),\n+                progress*100),\n+            end ='')\n+\n+    def update(self, more: float):\n+        self.running += more\n+        self.set_progress(self.running / self.total)\n+\n+\n+def to_jsonable(obj: Any) -> Any:\n+    if hasattr(obj, \"__dict__\"):\n+        return obj.__dict__\n+    elif hasattr(obj, \"__slots__\"):\n+        ret = {}    # type: Any\n+        for slot in obj.__slots__:\n+            val = getattr(obj, slot, None)\n+            if slot in HASH_INTS and isinstance(val, int):\n+                ret[slot] = ser_uint256(val).hex()\n+            elif slot in HASH_INT_VECTORS and isinstance(val[0], int):\n+                ret[slot] = [ser_uint256(a).hex() for a in val]\n+            else:\n+                ret[slot] = to_jsonable(val)\n+        return ret\n+    elif isinstance(obj, list):\n+        return [to_jsonable(a) for a in obj]\n+    elif isinstance(obj, bytes):\n+        return obj.hex()\n+    else:\n+        return obj\n+\n+\n+def process_file(path: str, messages: List[Any], recv: bool, progress_bar: Optional[ProgressBar]) -> None:\n+    with open(path, 'rb') as f_in:\n+        if progress_bar:\n+            bytes_read = 0\n+        while True:\n+            if progress_bar:\n+                # Update progress bar\n+                diff = f_in.tell() - bytes_read - 1\n+                progress_bar.update(diff)\n+                bytes_read = f_in.tell() - 1\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int\n+            msgtype = tmp_header.read(MSGTYPE_SIZE).split(b'\\x00', 1)[0]     # type: bytes\n+            length = int.from_bytes(tmp_header.read(LENGTH_SIZE), \"little\")  # type: int\n+            if msgtype not in MESSAGEMAP:\n+                # For now just skip unrecognized messages\n+                f_in.seek(length, os.SEEK_CUR)\n+                print(f\"Skipping unrecognized message type {msgtype}\", file=sys.stderr)\n+                continue\n+            msg_ser = BytesIO(f_in.read(length))\n+            msg = MESSAGEMAP[msgtype]()\n+            try:\n+                msg.deserialize(msg_ser)\n+            except KeyboardInterrupt:\n+                raise\n+            except Exception:\n+                # Message was bad, skip the rest of the file\n+                print(f\"Found broken message, skipping remainder of file: {path}\", file=sys.stderr)\n+                break\n+            msg_dict = {}\n+            msg_dict[\"msgtype\"] = getattr(msg, \"msgtype\", None).decode()\n+            msg_dict[\"direction\"] = \"recv\" if recv else \"sent\"\n+            msg_dict[\"time\"] = time\n+            msg_dict[\"size\"] = length   # \"size\" is less readable here, but more readable in the output\n+            if length:\n+                msg_dict[\"body\"] = to_jsonable(msg)\n+            messages.append(msg_dict)\n+        if progress_bar:\n+            # Update the progress bar to the end of the current file\n+            # in case we exited the loop early\n+            f_in.seek(0, os.SEEK_END)   # Go to end of file\n+            diff = f_in.tell() - bytes_read - 1\n+            progress_bar.update(diff)\n+\n+\n+def main():\n+    \"\"\"Main\"\"\"\n+    parser = argparse.ArgumentParser(\n+        description=__doc__,\n+        epilog=\"EXAMPLE \\n\\t{0} -o out.json <data-dir>/message_capture/**/*.dat\".format(sys.argv[0]),\n+        formatter_class=argparse.RawTextHelpFormatter)\n+    parser.add_argument(\n+        \"capturepaths\",\n+        nargs='+',\n+        help=\"binary message capture files to parse.\")\n+    parser.add_argument(\n+        \"-o\", \"--output\",\n+        help=\"output file.  If unset print to stdout\")\n+    parser.add_argument(\n+        \"--no-progress-bar\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r560883958",
      "id" : 560883958,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDg4Mzk1OA==",
      "original_commit_id" : "af8bcd1a6ecdfa15d7fb0f98256d47dec9b40f61",
      "original_line" : 157,
      "original_position" : 157,
      "original_start_line" : null,
      "path" : "contrib/message-capture/message-capture-parser.py",
      "position" : null,
      "pull_request_review_id" : 572113296,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560883958",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r560884968"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560884968"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This function is a bit of a wall of code. I'd suggest a few blank lines to split up different areas of functionality and make it a bit more readable.\r\n\r\nSomething like:\r\n\r\n```python\r\n        while True:\r\n            if progress_bar:\r\n                # Update progress bar\r\n                diff = f_in.tell() - bytes_read - 1\r\n                progress_bar.update(diff)\r\n                bytes_read = f_in.tell() - 1\r\n\r\n            # Read header\r\n            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\r\n            if not tmp_header_raw:\r\n                break\r\n            tmp_header = BytesIO(tmp_header_raw)\r\n            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int\r\n            msgtype = tmp_header.read(MSGTYPE_SIZE).split(b'\\x00', 1)[0]     # type: bytes\r\n            length = int.from_bytes(tmp_header.read(LENGTH_SIZE), \"little\")  # type: int\r\n\r\n            if msgtype not in MESSAGEMAP:\r\n                # For now just skip unrecognized messages\r\n                f_in.seek(length, os.SEEK_CUR)\r\n                print(f\"Skipping unrecognized message type {msgtype}\", file=sys.stderr)\r\n                continue\r\n\r\n            # Read body\r\n            msg_ser = BytesIO(f_in.read(length))\r\n            msg = MESSAGEMAP[msgtype]()\r\n            try:\r\n                msg.deserialize(msg_ser)\r\n            except KeyboardInterrupt:\r\n                raise\r\n            except Exception:\r\n                # Message was bad, skip the rest of the file\r\n                print(f\"Found broken message, skipping remainder of file: {path}\", file=sys.stderr)\r\n                break\r\n\r\n            # Construct msg_dict and insert into messages\r\n            msg_dict = {}\r\n            msg_dict[\"msgtype\"] = getattr(msg, \"msgtype\", None).decode()\r\n            msg_dict[\"direction\"] = \"recv\" if recv else \"sent\"\r\n            msg_dict[\"time\"] = time\r\n            msg_dict[\"size\"] = length   # \"size\" is less readable here, but more readable in the output\r\n            if length:\r\n                msg_dict[\"body\"] = to_jsonable(msg)\r\n            messages.append(msg_dict)\r\n\r\n        if progress_bar:\r\n            # Update the progress bar to the end of the current file\r\n            # in case we exited the loop early\r\n            f_in.seek(0, os.SEEK_END)   # Go to end of file\r\n            diff = f_in.tell() - bytes_read - 1\r\n            progress_bar.update(diff)\r\n```",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-20T11:22:07Z",
      "diff_hunk" : "@@ -0,0 +1,188 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message capture binary files.  To be used in conjunction with -capturemessages.\"\"\"\n+\n+import argparse\n+import os\n+import shutil\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List, Optional\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.messages import ser_uint256     # noqa: E402\n+from test_framework.p2p import MESSAGEMAP           # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+# The test framework classes stores hashes as large ints in many cases.\n+# These are variables of type uint256 in core.\n+# There isn't a way to distinguish between a large int and a large int that is actually a blob of bytes.\n+# As such, they are itemized here.\n+# Any variables with these names that are of type int are actually uint256 variables.\n+# (These can be easily found by looking for calls to deser_uint256, deser_uint256_vector, and uint256_from_str in messages.py)\n+HASH_INTS = [\n+    \"blockhash\",\n+    \"block_hash\",\n+    \"hash\",\n+    \"hashMerkleRoot\",\n+    \"hashPrevBlock\",\n+    \"hashstop\",\n+    \"prev_header\",\n+    \"sha256\",\n+    \"stop_hash\",\n+]\n+\n+HASH_INT_VECTORS = [\n+    \"hashes\",\n+    \"headers\",\n+    \"vHave\",\n+    \"vHash\",\n+]\n+\n+\n+class ProgressBar:\n+    def __init__(self, total: float):\n+        self.total = total\n+        self.running = 0\n+\n+    def set_progress(self, progress: float):\n+        cols = shutil.get_terminal_size()[0]\n+        if cols <= 12:\n+            return\n+        max_blocks = cols - 9\n+        num_blocks = int(max_blocks*progress)\n+        print('\\r[ {}{} ] {:3.0f}%'.format(\n+                '#'*num_blocks,\n+                ' '*(max_blocks - num_blocks),\n+                progress*100),\n+            end ='')\n+\n+    def update(self, more: float):\n+        self.running += more\n+        self.set_progress(self.running / self.total)\n+\n+\n+def to_jsonable(obj: Any) -> Any:\n+    if hasattr(obj, \"__dict__\"):\n+        return obj.__dict__\n+    elif hasattr(obj, \"__slots__\"):\n+        ret = {}    # type: Any\n+        for slot in obj.__slots__:\n+            val = getattr(obj, slot, None)\n+            if slot in HASH_INTS and isinstance(val, int):\n+                ret[slot] = ser_uint256(val).hex()\n+            elif slot in HASH_INT_VECTORS and isinstance(val[0], int):\n+                ret[slot] = [ser_uint256(a).hex() for a in val]\n+            else:\n+                ret[slot] = to_jsonable(val)\n+        return ret\n+    elif isinstance(obj, list):\n+        return [to_jsonable(a) for a in obj]\n+    elif isinstance(obj, bytes):\n+        return obj.hex()\n+    else:\n+        return obj\n+\n+\n+def process_file(path: str, messages: List[Any], recv: bool, progress_bar: Optional[ProgressBar]) -> None:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r560884968",
      "id" : 560884968,
      "line" : 95,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDg4NDk2OA==",
      "original_commit_id" : "af8bcd1a6ecdfa15d7fb0f98256d47dec9b40f61",
      "original_line" : 95,
      "original_position" : 95,
      "original_start_line" : null,
      "path" : "contrib/message-capture/message-capture-parser.py",
      "position" : 95,
      "pull_request_review_id" : 572113296,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560884968",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r560888340"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560888340"
         }
      },
      "author_association" : "MEMBER",
      "body" : "A few pep8 style suggestions:\r\n\r\n- surround arithmetic operators with spaces\r\n- no spaces around named argument parameters\r\n- align parameters with opening parens\r\n\r\n```suggestion\r\n        num_blocks = int(max_blocks * progress)\r\n        print('\\r[ {}{} ] {:3.0f}%'.format('#' * num_blocks,\r\n                                           ' ' * (max_blocks - num_blocks),\r\n                                           progress * 100),\r\n              end='')\r\n\r\n```",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-20T11:27:41Z",
      "diff_hunk" : "@@ -0,0 +1,188 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message capture binary files.  To be used in conjunction with -capturemessages.\"\"\"\n+\n+import argparse\n+import os\n+import shutil\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List, Optional\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.messages import ser_uint256     # noqa: E402\n+from test_framework.p2p import MESSAGEMAP           # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+# The test framework classes stores hashes as large ints in many cases.\n+# These are variables of type uint256 in core.\n+# There isn't a way to distinguish between a large int and a large int that is actually a blob of bytes.\n+# As such, they are itemized here.\n+# Any variables with these names that are of type int are actually uint256 variables.\n+# (These can be easily found by looking for calls to deser_uint256, deser_uint256_vector, and uint256_from_str in messages.py)\n+HASH_INTS = [\n+    \"blockhash\",\n+    \"block_hash\",\n+    \"hash\",\n+    \"hashMerkleRoot\",\n+    \"hashPrevBlock\",\n+    \"hashstop\",\n+    \"prev_header\",\n+    \"sha256\",\n+    \"stop_hash\",\n+]\n+\n+HASH_INT_VECTORS = [\n+    \"hashes\",\n+    \"headers\",\n+    \"vHave\",\n+    \"vHash\",\n+]\n+\n+\n+class ProgressBar:\n+    def __init__(self, total: float):\n+        self.total = total\n+        self.running = 0\n+\n+    def set_progress(self, progress: float):\n+        cols = shutil.get_terminal_size()[0]\n+        if cols <= 12:\n+            return\n+        max_blocks = cols - 9\n+        num_blocks = int(max_blocks*progress)\n+        print('\\r[ {}{} ] {:3.0f}%'.format(\n+                '#'*num_blocks,\n+                ' '*(max_blocks - num_blocks),\n+                progress*100),\n+            end ='')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r560888340",
      "id" : 560888340,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDg4ODM0MA==",
      "original_commit_id" : "af8bcd1a6ecdfa15d7fb0f98256d47dec9b40f61",
      "original_line" : 66,
      "original_position" : 66,
      "original_start_line" : 61,
      "path" : "contrib/message-capture/message-capture-parser.py",
      "position" : null,
      "pull_request_review_id" : 572113296,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560888340",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r560895332"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560895332"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm not sure if we want this. You could imagine running this test inside some environment where the system time is not set correctly. That'd potentially cause this test to fail even though there's no problem with message capture.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-20T11:40:01Z",
      "diff_hunk" : "@@ -0,0 +1,70 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test per-peer message capture capability.\n+\n+Additionally, the output of contrib/message-capture/message-capture-parser.py should be verified manually.\n+\"\"\"\n+\n+import glob\n+from io import BytesIO\n+import os\n+\n+from test_framework.p2p import P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+def mini_parser(dat_file):\n+    \"\"\"Parse a data file created by CaptureMessage.\n+\n+    From the data file we'll only check the structure.\n+\n+    We won't care about things like:\n+    - Deserializing the payload of the message\n+        - This is managed by the deserialize methods in test_framework.messages\n+    - The order of the messages\n+        - There's no reason why we can't, say, change the order of the messages in the handshake\n+    - Message Type\n+        - We can add new message types\n+\n+    We're ignoring these because they're simply too brittle to test here.\n+    \"\"\"\n+    with open(dat_file, 'rb') as f_in:\n+        while True:\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int\n+            assert(time >= 1231006505000000)   # genesis block timestamp",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r560895332",
      "id" : 560895332,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDg5NTMzMg==",
      "original_commit_id" : "af8bcd1a6ecdfa15d7fb0f98256d47dec9b40f61",
      "original_line" : 44,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "test/functional/p2p_message_capture.py",
      "position" : null,
      "pull_request_review_id" : 572113296,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560895332",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r560895909"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560895909"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Perhaps also assert that there are no non-null characters after the first non-null character? i.e. the message type is a string of printable characters followed by just null characters.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-20T11:41:03Z",
      "diff_hunk" : "@@ -0,0 +1,70 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test per-peer message capture capability.\n+\n+Additionally, the output of contrib/message-capture/message-capture-parser.py should be verified manually.\n+\"\"\"\n+\n+import glob\n+from io import BytesIO\n+import os\n+\n+from test_framework.p2p import P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+def mini_parser(dat_file):\n+    \"\"\"Parse a data file created by CaptureMessage.\n+\n+    From the data file we'll only check the structure.\n+\n+    We won't care about things like:\n+    - Deserializing the payload of the message\n+        - This is managed by the deserialize methods in test_framework.messages\n+    - The order of the messages\n+        - There's no reason why we can't, say, change the order of the messages in the handshake\n+    - Message Type\n+        - We can add new message types\n+\n+    We're ignoring these because they're simply too brittle to test here.\n+    \"\"\"\n+    with open(dat_file, 'rb') as f_in:\n+        while True:\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int\n+            assert(time >= 1231006505000000)   # genesis block timestamp\n+            msgtype = tmp_header.read(MSGTYPE_SIZE).split(b'\\x00', 1)[0]     # type: bytes\n+            assert(len(msgtype) > 0)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r560895909",
      "id" : 560895909,
      "line" : 49,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDg5NTkwOQ==",
      "original_commit_id" : "af8bcd1a6ecdfa15d7fb0f98256d47dec9b40f61",
      "original_line" : 49,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "test/functional/p2p_message_capture.py",
      "position" : 49,
      "pull_request_review_id" : 572113296,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560895909",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r560900447"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560900447"
         }
      },
      "author_association" : "MEMBER",
      "body" : "We should also test that these files are non-empty. We may not know the exact sequence of messages, but there should be some messages during initial handshake, and we should capture them.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-20T11:49:07Z",
      "diff_hunk" : "@@ -0,0 +1,70 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test per-peer message capture capability.\n+\n+Additionally, the output of contrib/message-capture/message-capture-parser.py should be verified manually.\n+\"\"\"\n+\n+import glob\n+from io import BytesIO\n+import os\n+\n+from test_framework.p2p import P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+def mini_parser(dat_file):\n+    \"\"\"Parse a data file created by CaptureMessage.\n+\n+    From the data file we'll only check the structure.\n+\n+    We won't care about things like:\n+    - Deserializing the payload of the message\n+        - This is managed by the deserialize methods in test_framework.messages\n+    - The order of the messages\n+        - There's no reason why we can't, say, change the order of the messages in the handshake\n+    - Message Type\n+        - We can add new message types\n+\n+    We're ignoring these because they're simply too brittle to test here.\n+    \"\"\"\n+    with open(dat_file, 'rb') as f_in:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r560900447",
      "id" : 560900447,
      "line" : 37,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDkwMDQ0Nw==",
      "original_commit_id" : "af8bcd1a6ecdfa15d7fb0f98256d47dec9b40f61",
      "original_line" : 37,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "test/functional/p2p_message_capture.py",
      "position" : 37,
      "pull_request_review_id" : 572113296,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560900447",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r560908669"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560908669"
         }
      },
      "author_association" : "MEMBER",
      "body" : "We don't have guidance on line length in the style guide, but anything over 100 columns is a bit long for my taste. Also consider adding a doxygen comment:\r\n\r\n```suggestion\r\n/** Dump timestamp and binary message to file */\r\nvoid CaptureMessage(const CAddress& addr, const std::string& msg_type,\r\n                    const Span<const unsigned char>& data, bool is_incoming);\r\n\r\n```",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-20T12:03:42Z",
      "diff_hunk" : "@@ -1239,6 +1242,8 @@ inline std::chrono::microseconds PoissonNextSend(std::chrono::microseconds now,\n     return std::chrono::microseconds{PoissonNextSend(now.count(), average_interval.count())};\n }\n \n+void CaptureMessage(const CAddress& addr, const std::string& msg_type, const Span<const unsigned char>& data, bool is_incoming);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r560908669",
      "id" : 560908669,
      "line" : 1246,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDkwODY2OQ==",
      "original_commit_id" : "af8bcd1a6ecdfa15d7fb0f98256d47dec9b40f61",
      "original_line" : 1246,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 22,
      "pull_request_review_id" : 572113296,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560908669",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r560908973"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560908973"
         }
      },
      "author_association" : "MEMBER",
      "body" : "maybe s/time/now/",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-20T12:04:12Z",
      "diff_hunk" : "@@ -2933,3 +2932,27 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void CaptureMessage(const CAddress& addr, const std::string& msg_type, const Span<const unsigned char>& data, bool is_incoming)\n+{\n+    auto time = GetTime<std::chrono::microseconds>();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r560908973",
      "id" : 560908973,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDkwODk3Mw==",
      "original_commit_id" : "af8bcd1a6ecdfa15d7fb0f98256d47dec9b40f61",
      "original_line" : 2938,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 572113296,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560908973",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r561060570"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561060570"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-20T15:36:49Z",
      "diff_hunk" : "@@ -0,0 +1,174 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message capture binary files.  To be used in conjunction with -capturemessages.\"\"\"\n+\n+import argparse\n+import os\n+import shutil\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List, Optional\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.messages import ser_uint256     # noqa: E402\n+from test_framework.p2p import MESSAGEMAP           # noqa: E402\n+from test_framework.util import assert_equal        # noqa: E402",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r561060570",
      "id" : 561060570,
      "in_reply_to_id" : 525840678,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTA2MDU3MA==",
      "original_commit_id" : "4690881fc52a2d5d8b17c7a1e4ae07d3e2d88e14",
      "original_line" : 20,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "contrib/message-capture/message-capture-parser.py",
      "position" : null,
      "pull_request_review_id" : 572350051,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561060570",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r561075800"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561075800"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Since this is new code: consider running `black` all new `.py` files added in this PR :)",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-20T15:56:05Z",
      "diff_hunk" : "@@ -0,0 +1,188 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message capture binary files.  To be used in conjunction with -capturemessages.\"\"\"\n+\n+import argparse\n+import os\n+import shutil\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List, Optional\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.messages import ser_uint256     # noqa: E402\n+from test_framework.p2p import MESSAGEMAP           # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+# The test framework classes stores hashes as large ints in many cases.\n+# These are variables of type uint256 in core.\n+# There isn't a way to distinguish between a large int and a large int that is actually a blob of bytes.\n+# As such, they are itemized here.\n+# Any variables with these names that are of type int are actually uint256 variables.\n+# (These can be easily found by looking for calls to deser_uint256, deser_uint256_vector, and uint256_from_str in messages.py)\n+HASH_INTS = [\n+    \"blockhash\",\n+    \"block_hash\",\n+    \"hash\",\n+    \"hashMerkleRoot\",\n+    \"hashPrevBlock\",\n+    \"hashstop\",\n+    \"prev_header\",\n+    \"sha256\",\n+    \"stop_hash\",\n+]\n+\n+HASH_INT_VECTORS = [\n+    \"hashes\",\n+    \"headers\",\n+    \"vHave\",\n+    \"vHash\",\n+]\n+\n+\n+class ProgressBar:\n+    def __init__(self, total: float):\n+        self.total = total\n+        self.running = 0\n+\n+    def set_progress(self, progress: float):\n+        cols = shutil.get_terminal_size()[0]\n+        if cols <= 12:\n+            return\n+        max_blocks = cols - 9\n+        num_blocks = int(max_blocks*progress)\n+        print('\\r[ {}{} ] {:3.0f}%'.format(\n+                '#'*num_blocks,\n+                ' '*(max_blocks - num_blocks),\n+                progress*100),\n+            end ='')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r561075800",
      "id" : 561075800,
      "in_reply_to_id" : 560888340,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTA3NTgwMA==",
      "original_commit_id" : "af8bcd1a6ecdfa15d7fb0f98256d47dec9b40f61",
      "original_line" : 66,
      "original_position" : 66,
      "original_start_line" : 61,
      "path" : "contrib/message-capture/message-capture-parser.py",
      "position" : null,
      "pull_request_review_id" : 572370800,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561075800",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r561343199"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561343199"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks, this is much more readable now.  I've broken it up slightly differently than you.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-20T22:16:24Z",
      "diff_hunk" : "@@ -0,0 +1,188 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message capture binary files.  To be used in conjunction with -capturemessages.\"\"\"\n+\n+import argparse\n+import os\n+import shutil\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List, Optional\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.messages import ser_uint256     # noqa: E402\n+from test_framework.p2p import MESSAGEMAP           # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+# The test framework classes stores hashes as large ints in many cases.\n+# These are variables of type uint256 in core.\n+# There isn't a way to distinguish between a large int and a large int that is actually a blob of bytes.\n+# As such, they are itemized here.\n+# Any variables with these names that are of type int are actually uint256 variables.\n+# (These can be easily found by looking for calls to deser_uint256, deser_uint256_vector, and uint256_from_str in messages.py)\n+HASH_INTS = [\n+    \"blockhash\",\n+    \"block_hash\",\n+    \"hash\",\n+    \"hashMerkleRoot\",\n+    \"hashPrevBlock\",\n+    \"hashstop\",\n+    \"prev_header\",\n+    \"sha256\",\n+    \"stop_hash\",\n+]\n+\n+HASH_INT_VECTORS = [\n+    \"hashes\",\n+    \"headers\",\n+    \"vHave\",\n+    \"vHash\",\n+]\n+\n+\n+class ProgressBar:\n+    def __init__(self, total: float):\n+        self.total = total\n+        self.running = 0\n+\n+    def set_progress(self, progress: float):\n+        cols = shutil.get_terminal_size()[0]\n+        if cols <= 12:\n+            return\n+        max_blocks = cols - 9\n+        num_blocks = int(max_blocks*progress)\n+        print('\\r[ {}{} ] {:3.0f}%'.format(\n+                '#'*num_blocks,\n+                ' '*(max_blocks - num_blocks),\n+                progress*100),\n+            end ='')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r561343199",
      "id" : 561343199,
      "in_reply_to_id" : 560888340,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTM0MzE5OQ==",
      "original_commit_id" : "af8bcd1a6ecdfa15d7fb0f98256d47dec9b40f61",
      "original_line" : 66,
      "original_position" : 66,
      "original_start_line" : 61,
      "path" : "contrib/message-capture/message-capture-parser.py",
      "position" : null,
      "pull_request_review_id" : 572696355,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561343199",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r561344484"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561344484"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm fine to remove this, especially given your other suggestions that add other pieces to this test.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-20T22:19:01Z",
      "diff_hunk" : "@@ -0,0 +1,70 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test per-peer message capture capability.\n+\n+Additionally, the output of contrib/message-capture/message-capture-parser.py should be verified manually.\n+\"\"\"\n+\n+import glob\n+from io import BytesIO\n+import os\n+\n+from test_framework.p2p import P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+def mini_parser(dat_file):\n+    \"\"\"Parse a data file created by CaptureMessage.\n+\n+    From the data file we'll only check the structure.\n+\n+    We won't care about things like:\n+    - Deserializing the payload of the message\n+        - This is managed by the deserialize methods in test_framework.messages\n+    - The order of the messages\n+        - There's no reason why we can't, say, change the order of the messages in the handshake\n+    - Message Type\n+        - We can add new message types\n+\n+    We're ignoring these because they're simply too brittle to test here.\n+    \"\"\"\n+    with open(dat_file, 'rb') as f_in:\n+        while True:\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int\n+            assert(time >= 1231006505000000)   # genesis block timestamp",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r561344484",
      "id" : 561344484,
      "in_reply_to_id" : 560895332,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTM0NDQ4NA==",
      "original_commit_id" : "af8bcd1a6ecdfa15d7fb0f98256d47dec9b40f61",
      "original_line" : 44,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "test/functional/p2p_message_capture.py",
      "position" : null,
      "pull_request_review_id" : 572697858,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561344484",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562128298"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562128298"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Added the doxygen comment, but I think I'll leave the long line as it is.  Looking through the rest of net.h, I see many declarations longer than 100 characters, and I don't see any that have been broken up the way you're suggesting.\r\n\r\nI agree with you that it's not great, but I'm going to appeal to consistency in this case.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-21T19:05:56Z",
      "diff_hunk" : "@@ -1239,6 +1242,8 @@ inline std::chrono::microseconds PoissonNextSend(std::chrono::microseconds now,\n     return std::chrono::microseconds{PoissonNextSend(now.count(), average_interval.count())};\n }\n \n+void CaptureMessage(const CAddress& addr, const std::string& msg_type, const Span<const unsigned char>& data, bool is_incoming);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562128298",
      "id" : 562128298,
      "in_reply_to_id" : 560908669,
      "line" : 1246,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjEyODI5OA==",
      "original_commit_id" : "af8bcd1a6ecdfa15d7fb0f98256d47dec9b40f61",
      "original_line" : 1246,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 22,
      "pull_request_review_id" : 573648305,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562128298",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`git range-diff master af8bcd1 a17b250`\r\n\r\n* Implemented various style improvement suggested by jnewbery above",
      "created_at" : "2021-01-21T19:39:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-764889339",
      "id" : 764889339,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2NDg4OTMzOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-21T19:39:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/764889339",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562208110"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562208110"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: sorry to be annoying with this command [again](https://github.com/bitcoin/bitcoin/pull/19509#discussion_r523807480), but I just found out that it's mandatory to add a filter as second parameter (e.g. the dot `.` for _all_), otherwise the command fails.\r\n```\r\n$ jq out.json\r\njq: error: out/0 is not defined at <top-level>, line 1:\r\nout.json\r\njq: 1 compile error\r\n\r\n$ jq . out.json\r\n[\r\n  {\r\n    \"msgtype\": \"version\",\r\n    \"direction\": \"sent\",\r\n..........\r\n```\r\n",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-21T21:27:30Z",
      "diff_hunk" : "@@ -0,0 +1,25 @@\n+# Per-Peer Message Capture\n+\n+## Purpose\n+\n+This feature allows for message capture on a per-peer basis.  It answers the simple question: \"Can I see what messages my node is sending and receiving?\"\n+\n+## Usage and Functionality\n+\n+* Run `bitcoind` with the `-capturemessages` option.\n+* Look in the `message_capture` folder in your datadir.\n+  * Typically this will be `~/.bitcoin/message_capture`.\n+  * See that there are many folders inside, one for each peer names with its IP address and port.\n+  * Inside each peer's folder there are two `.dat` files: one is for received messages (`msgs_recv.dat`) and the other is for sent messages (`msgs_sent.dat`).\n+* Run `contrib/message-capture/message-capture-parser.py` with the proper arguments.\n+  * See the `-h` option for help.\n+  * To see all messages, both sent and received, for all peers use:\n+    ```\n+    ./contrib/message-capture/message-capture-parser.py -o out.json \\\n+    ~/.bitcoin/message_capture/**/*.dat\n+    ```\n+  * Note:  The messages in the given `.dat` files will be interleaved in chronological order.  So, giving both received and sent `.dat` files (as above with `*.dat`) will result in all messages being interleaved in chronological order.\n+  * If an output file is not provided (i.e. the `-o` option is not used), then the output prints to `stdout`.\n+* View the resulting output.\n+  * The output file is `JSON` formatted.\n+  * Suggestion: use `jq` to view the output, with `jq out.json`",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562208110",
      "id" : 562208110,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjIwODExMA==",
      "original_commit_id" : "a17b2509e0d7e7e05fd5600d5387608bb706ac0e",
      "original_line" : 25,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "contrib/message-capture/message-capture-docs.md",
      "position" : null,
      "pull_request_review_id" : 573749922,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562208110",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562209068"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562209068"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "yocto-nit: git shows some trailing whitespace in this line",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-21T21:29:08Z",
      "diff_hunk" : "@@ -0,0 +1,198 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message capture binary files.  To be used in conjunction with -capturemessages.\"\"\"\n+\n+import argparse\n+import os\n+import shutil\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List, Optional\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.messages import ser_uint256     # noqa: E402\n+from test_framework.p2p import MESSAGEMAP           # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+# The test framework classes stores hashes as large ints in many cases.\n+# These are variables of type uint256 in core.\n+# There isn't a way to distinguish between a large int and a large int that is actually a blob of bytes.\n+# As such, they are itemized here.\n+# Any variables with these names that are of type int are actually uint256 variables.\n+# (These can be easily found by looking for calls to deser_uint256, deser_uint256_vector, and uint256_from_str in messages.py)\n+HASH_INTS = [\n+    \"blockhash\",\n+    \"block_hash\",\n+    \"hash\",\n+    \"hashMerkleRoot\",\n+    \"hashPrevBlock\",\n+    \"hashstop\",\n+    \"prev_header\",\n+    \"sha256\",\n+    \"stop_hash\",\n+]\n+\n+HASH_INT_VECTORS = [\n+    \"hashes\",\n+    \"headers\",\n+    \"vHave\",\n+    \"vHash\",\n+]\n+\n+\n+class ProgressBar:\n+    def __init__(self, total: float):\n+        self.total = total\n+        self.running = 0\n+\n+    def set_progress(self, progress: float):\n+        cols = shutil.get_terminal_size()[0]\n+        if cols <= 12:\n+            return\n+        max_blocks = cols - 9\n+        num_blocks = int(max_blocks * progress)\n+        print('\\r[ {}{} ] {:3.0f}%'\n+              .format('#' * num_blocks,\n+                      ' ' * (max_blocks - num_blocks),\n+                      progress * 100),\n+              end ='')\n+\n+    def update(self, more: float):\n+        self.running += more\n+        self.set_progress(self.running / self.total)\n+\n+\n+def to_jsonable(obj: Any) -> Any:\n+    if hasattr(obj, \"__dict__\"):\n+        return obj.__dict__\n+    elif hasattr(obj, \"__slots__\"):\n+        ret = {}    # type: Any\n+        for slot in obj.__slots__:\n+            val = getattr(obj, slot, None)\n+            if slot in HASH_INTS and isinstance(val, int):\n+                ret[slot] = ser_uint256(val).hex()\n+            elif slot in HASH_INT_VECTORS and isinstance(val[0], int):\n+                ret[slot] = [ser_uint256(a).hex() for a in val]\n+            else:\n+                ret[slot] = to_jsonable(val)\n+        return ret\n+    elif isinstance(obj, list):\n+        return [to_jsonable(a) for a in obj]\n+    elif isinstance(obj, bytes):\n+        return obj.hex()\n+    else:\n+        return obj\n+\n+\n+def process_file(path: str, messages: List[Any], recv: bool, progress_bar: Optional[ProgressBar]) -> None:\n+    with open(path, 'rb') as f_in:\n+        if progress_bar:\n+            bytes_read = 0\n+\n+        while True:\n+            if progress_bar:\n+                # Update progress bar\n+                diff = f_in.tell() - bytes_read - 1\n+                progress_bar.update(diff)\n+                bytes_read = f_in.tell() - 1\n+            ",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562209068",
      "id" : 562209068,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjIwOTA2OA==",
      "original_commit_id" : "d3353b507fe2a2c26a690186a6cd7ff4cee42ba0",
      "original_line" : 106,
      "original_position" : 106,
      "original_start_line" : null,
      "path" : "contrib/message-capture/message-capture-parser.py",
      "position" : null,
      "pull_request_review_id" : 573749922,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562209068",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562272863"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562272863"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ultranit: \"to file\" is slightly confusing as it's not capturing all traffic into just a single file.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-21T23:50:31Z",
      "diff_hunk" : "@@ -521,6 +521,7 @@ void SetupServerArgs(NodeContext& node)\n     argsman.AddArg(\"-limitdescendantcount=<n>\", strprintf(\"Do not accept transactions if any ancestor would have <n> or more in-mempool descendants (default: %u)\", DEFAULT_DESCENDANT_LIMIT), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-limitdescendantsize=<n>\", strprintf(\"Do not accept transactions if any ancestor would have more than <n> kilobytes of in-mempool descendants (default: %u).\", DEFAULT_DESCENDANT_SIZE_LIMIT), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-addrmantest\", \"Allows to test address relay on localhost\", ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n+    argsman.AddArg(\"-capturemessages\", \"Capture all P2P messages to file\", ArgsManager::ALLOW_BOOL | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562272863",
      "id" : 562272863,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjI3Mjg2Mw==",
      "original_commit_id" : "e2b6430dcb50a4e90f70a3dcea693a6dc8112634",
      "original_line" : 524,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 573829313,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562272863",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562273457"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562273457"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's a bit strange that this happens in net_processing while the capture of outgoing messages is in net.\r\n\r\nAny reason why this can't be in net as well? I'd expect CNode::ReceiveMsgBytes to work well.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-21T23:52:20Z",
      "diff_hunk" : "@@ -4042,6 +4042,10 @@ bool PeerManagerImpl::ProcessMessages(CNode* pfrom, std::atomic<bool>& interrupt\n     }\n     CNetMessage& msg(msgs.front());\n \n+    if (gArgs.GetBoolArg(\"-capturemessages\", false)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562273457",
      "id" : 562273457,
      "line" : 4045,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjI3MzQ1Nw==",
      "original_commit_id" : "e2b6430dcb50a4e90f70a3dcea693a6dc8112634",
      "original_line" : 4045,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 21,
      "pull_request_review_id" : 573829313,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562273457",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562274872"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562274872"
         }
      },
      "author_association" : "MEMBER",
      "body" : "A suggestion (possibly for a future PR):\r\n\r\nIt's unnecessary to have this script load the entire dump of all files into memory and then sort them, as we know that every individual file is internally sorted.\r\n\r\nSo an approach is possible where you have a loop in which you read one message for each file, and then loop {pick the one with the smallest timestamp; print that one; read one message from that file; repeat}. This would be faster, lower memory (especially when analyzing lots of dumps), and support streaming.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-21T23:56:32Z",
      "diff_hunk" : "@@ -0,0 +1,198 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message capture binary files.  To be used in conjunction with -capturemessages.\"\"\"\n+\n+import argparse\n+import os\n+import shutil\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List, Optional\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.messages import ser_uint256     # noqa: E402\n+from test_framework.p2p import MESSAGEMAP           # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+# The test framework classes stores hashes as large ints in many cases.\n+# These are variables of type uint256 in core.\n+# There isn't a way to distinguish between a large int and a large int that is actually a blob of bytes.\n+# As such, they are itemized here.\n+# Any variables with these names that are of type int are actually uint256 variables.\n+# (These can be easily found by looking for calls to deser_uint256, deser_uint256_vector, and uint256_from_str in messages.py)\n+HASH_INTS = [\n+    \"blockhash\",\n+    \"block_hash\",\n+    \"hash\",\n+    \"hashMerkleRoot\",\n+    \"hashPrevBlock\",\n+    \"hashstop\",\n+    \"prev_header\",\n+    \"sha256\",\n+    \"stop_hash\",\n+]\n+\n+HASH_INT_VECTORS = [\n+    \"hashes\",\n+    \"headers\",\n+    \"vHave\",\n+    \"vHash\",\n+]\n+\n+\n+class ProgressBar:\n+    def __init__(self, total: float):\n+        self.total = total\n+        self.running = 0\n+\n+    def set_progress(self, progress: float):\n+        cols = shutil.get_terminal_size()[0]\n+        if cols <= 12:\n+            return\n+        max_blocks = cols - 9\n+        num_blocks = int(max_blocks * progress)\n+        print('\\r[ {}{} ] {:3.0f}%'\n+              .format('#' * num_blocks,\n+                      ' ' * (max_blocks - num_blocks),\n+                      progress * 100),\n+              end ='')\n+\n+    def update(self, more: float):\n+        self.running += more\n+        self.set_progress(self.running / self.total)\n+\n+\n+def to_jsonable(obj: Any) -> Any:\n+    if hasattr(obj, \"__dict__\"):\n+        return obj.__dict__\n+    elif hasattr(obj, \"__slots__\"):\n+        ret = {}    # type: Any\n+        for slot in obj.__slots__:\n+            val = getattr(obj, slot, None)\n+            if slot in HASH_INTS and isinstance(val, int):\n+                ret[slot] = ser_uint256(val).hex()\n+            elif slot in HASH_INT_VECTORS and isinstance(val[0], int):\n+                ret[slot] = [ser_uint256(a).hex() for a in val]\n+            else:\n+                ret[slot] = to_jsonable(val)\n+        return ret\n+    elif isinstance(obj, list):\n+        return [to_jsonable(a) for a in obj]\n+    elif isinstance(obj, bytes):\n+        return obj.hex()\n+    else:\n+        return obj\n+\n+\n+def process_file(path: str, messages: List[Any], recv: bool, progress_bar: Optional[ProgressBar]) -> None:\n+    with open(path, 'rb') as f_in:\n+        if progress_bar:\n+            bytes_read = 0\n+\n+        while True:\n+            if progress_bar:\n+                # Update progress bar\n+                diff = f_in.tell() - bytes_read - 1\n+                progress_bar.update(diff)\n+                bytes_read = f_in.tell() - 1\n+            \n+            # Read the Header\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int\n+            msgtype = tmp_header.read(MSGTYPE_SIZE).split(b'\\x00', 1)[0]     # type: bytes\n+            length = int.from_bytes(tmp_header.read(LENGTH_SIZE), \"little\")  # type: int\n+\n+            # Determine message type\n+            if msgtype not in MESSAGEMAP:\n+                # For now just skip unrecognized messages\n+                f_in.seek(length, os.SEEK_CUR)\n+                print(f\"Skipping unrecognized message type {msgtype}\", file=sys.stderr)\n+                continue\n+            msg_ser = BytesIO(f_in.read(length))\n+            msg = MESSAGEMAP[msgtype]()\n+\n+            # Deserialize the message\n+            try:\n+                msg.deserialize(msg_ser)\n+            except KeyboardInterrupt:\n+                raise\n+            except Exception:\n+                # Message was bad, skip the rest of the file\n+                print(f\"Found broken message, skipping remainder of file: {path}\", file=sys.stderr)\n+                break\n+\n+            # Convert message to dictionary and add it to the messages dict\n+            msg_dict = {}\n+            msg_dict[\"msgtype\"] = getattr(msg, \"msgtype\", None).decode()\n+            msg_dict[\"direction\"] = \"recv\" if recv else \"sent\"\n+            msg_dict[\"time\"] = time\n+            msg_dict[\"size\"] = length   # \"size\" is less readable here, but more readable in the output\n+            if length:\n+                msg_dict[\"body\"] = to_jsonable(msg)\n+            messages.append(msg_dict)\n+\n+        if progress_bar:\n+            # Update the progress bar to the end of the current file\n+            # in case we exited the loop early\n+            f_in.seek(0, os.SEEK_END)   # Go to end of file\n+            diff = f_in.tell() - bytes_read - 1\n+            progress_bar.update(diff)\n+\n+\n+def main():\n+    \"\"\"Main\"\"\"\n+    parser = argparse.ArgumentParser(\n+        description=__doc__,\n+        epilog=\"EXAMPLE \\n\\t{0} -o out.json <data-dir>/message_capture/**/*.dat\".format(sys.argv[0]),\n+        formatter_class=argparse.RawTextHelpFormatter)\n+    parser.add_argument(\n+        \"capturepaths\",\n+        nargs='+',\n+        help=\"binary message capture files to parse.\")\n+    parser.add_argument(\n+        \"-o\", \"--output\",\n+        help=\"output file.  If unset print to stdout\")\n+    parser.add_argument(\n+        \"-n\", \"--no-progress-bar\",\n+        action='store_true',\n+        help=\"disable the progress bar.  Automatically set if the output is not a terminal\")\n+    args = parser.parse_args()\n+    capturepaths = [Path.cwd() / Path(capturepath) for capturepath in args.capturepaths]\n+    output = Path.cwd() / Path(args.output) if args.output else False\n+    use_progress_bar = (not args.no_progress_bar) and sys.stdout.isatty()\n+\n+    messages = []   # type: List[Any]\n+    if use_progress_bar:\n+        total_size = sum(capture.stat().st_size for capture in capturepaths)\n+        progress_bar = ProgressBar(total_size)\n+    else:\n+        progress_bar = None\n+\n+    for capture in capturepaths:\n+        process_file(str(capture), messages, \"recv\" in capture.stem, progress_bar)\n+\n+    messages.sort(key=lambda msg: msg['time'])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562274872",
      "id" : 562274872,
      "line" : 201,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjI3NDg3Mg==",
      "original_commit_id" : "d3353b507fe2a2c26a690186a6cd7ff4cee42ba0",
      "original_line" : 201,
      "original_position" : 185,
      "original_start_line" : null,
      "path" : "contrib/message-capture/message-capture-parser.py",
      "position" : 201,
      "pull_request_review_id" : 573829313,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562274872",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562277332"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562277332"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why make this DEBUG_ONLY? It's certainly not a feature for all users, but it's also not just a development debugging tool.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-22T00:03:22Z",
      "diff_hunk" : "@@ -521,6 +521,7 @@ void SetupServerArgs(NodeContext& node)\n     argsman.AddArg(\"-limitdescendantcount=<n>\", strprintf(\"Do not accept transactions if any ancestor would have <n> or more in-mempool descendants (default: %u)\", DEFAULT_DESCENDANT_LIMIT), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-limitdescendantsize=<n>\", strprintf(\"Do not accept transactions if any ancestor would have more than <n> kilobytes of in-mempool descendants (default: %u).\", DEFAULT_DESCENDANT_SIZE_LIMIT), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-addrmantest\", \"Allows to test address relay on localhost\", ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n+    argsman.AddArg(\"-capturemessages\", \"Capture all P2P messages to file\", ArgsManager::ALLOW_BOOL | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562277332",
      "id" : 562277332,
      "in_reply_to_id" : 562272863,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjI3NzMzMg==",
      "original_commit_id" : "e2b6430dcb50a4e90f70a3dcea693a6dc8112634",
      "original_line" : 524,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 573829313,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562277332",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562284378"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562284378"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Not sure this is what you want to do when an unparsable message is encountered. As each record has an overall length field, there should be no problem with skipping it.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-22T00:23:01Z",
      "diff_hunk" : "@@ -0,0 +1,198 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message capture binary files.  To be used in conjunction with -capturemessages.\"\"\"\n+\n+import argparse\n+import os\n+import shutil\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List, Optional\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.messages import ser_uint256     # noqa: E402\n+from test_framework.p2p import MESSAGEMAP           # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+# The test framework classes stores hashes as large ints in many cases.\n+# These are variables of type uint256 in core.\n+# There isn't a way to distinguish between a large int and a large int that is actually a blob of bytes.\n+# As such, they are itemized here.\n+# Any variables with these names that are of type int are actually uint256 variables.\n+# (These can be easily found by looking for calls to deser_uint256, deser_uint256_vector, and uint256_from_str in messages.py)\n+HASH_INTS = [\n+    \"blockhash\",\n+    \"block_hash\",\n+    \"hash\",\n+    \"hashMerkleRoot\",\n+    \"hashPrevBlock\",\n+    \"hashstop\",\n+    \"prev_header\",\n+    \"sha256\",\n+    \"stop_hash\",\n+]\n+\n+HASH_INT_VECTORS = [\n+    \"hashes\",\n+    \"headers\",\n+    \"vHave\",\n+    \"vHash\",\n+]\n+\n+\n+class ProgressBar:\n+    def __init__(self, total: float):\n+        self.total = total\n+        self.running = 0\n+\n+    def set_progress(self, progress: float):\n+        cols = shutil.get_terminal_size()[0]\n+        if cols <= 12:\n+            return\n+        max_blocks = cols - 9\n+        num_blocks = int(max_blocks * progress)\n+        print('\\r[ {}{} ] {:3.0f}%'\n+              .format('#' * num_blocks,\n+                      ' ' * (max_blocks - num_blocks),\n+                      progress * 100),\n+              end ='')\n+\n+    def update(self, more: float):\n+        self.running += more\n+        self.set_progress(self.running / self.total)\n+\n+\n+def to_jsonable(obj: Any) -> Any:\n+    if hasattr(obj, \"__dict__\"):\n+        return obj.__dict__\n+    elif hasattr(obj, \"__slots__\"):\n+        ret = {}    # type: Any\n+        for slot in obj.__slots__:\n+            val = getattr(obj, slot, None)\n+            if slot in HASH_INTS and isinstance(val, int):\n+                ret[slot] = ser_uint256(val).hex()\n+            elif slot in HASH_INT_VECTORS and isinstance(val[0], int):\n+                ret[slot] = [ser_uint256(a).hex() for a in val]\n+            else:\n+                ret[slot] = to_jsonable(val)\n+        return ret\n+    elif isinstance(obj, list):\n+        return [to_jsonable(a) for a in obj]\n+    elif isinstance(obj, bytes):\n+        return obj.hex()\n+    else:\n+        return obj\n+\n+\n+def process_file(path: str, messages: List[Any], recv: bool, progress_bar: Optional[ProgressBar]) -> None:\n+    with open(path, 'rb') as f_in:\n+        if progress_bar:\n+            bytes_read = 0\n+\n+        while True:\n+            if progress_bar:\n+                # Update progress bar\n+                diff = f_in.tell() - bytes_read - 1\n+                progress_bar.update(diff)\n+                bytes_read = f_in.tell() - 1\n+            \n+            # Read the Header\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int\n+            msgtype = tmp_header.read(MSGTYPE_SIZE).split(b'\\x00', 1)[0]     # type: bytes\n+            length = int.from_bytes(tmp_header.read(LENGTH_SIZE), \"little\")  # type: int\n+\n+            # Determine message type\n+            if msgtype not in MESSAGEMAP:\n+                # For now just skip unrecognized messages\n+                f_in.seek(length, os.SEEK_CUR)\n+                print(f\"Skipping unrecognized message type {msgtype}\", file=sys.stderr)\n+                continue\n+            msg_ser = BytesIO(f_in.read(length))\n+            msg = MESSAGEMAP[msgtype]()\n+\n+            # Deserialize the message\n+            try:\n+                msg.deserialize(msg_ser)\n+            except KeyboardInterrupt:\n+                raise\n+            except Exception:\n+                # Message was bad, skip the rest of the file\n+                print(f\"Found broken message, skipping remainder of file: {path}\", file=sys.stderr)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562284378",
      "id" : 562284378,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjI4NDM3OA==",
      "original_commit_id" : "a17b2509e0d7e7e05fd5600d5387608bb706ac0e",
      "original_line" : 132,
      "original_position" : 132,
      "original_start_line" : null,
      "path" : "contrib/message-capture/message-capture-parser.py",
      "position" : null,
      "pull_request_review_id" : 573842467,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562284378",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562515326"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562515326"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Note to myself: Remove `MakeUCharSpan` after #20464 ",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-22T09:53:55Z",
      "diff_hunk" : "@@ -4042,6 +4042,10 @@ bool PeerManagerImpl::ProcessMessages(CNode* pfrom, std::atomic<bool>& interrupt\n     }\n     CNetMessage& msg(msgs.front());\n \n+    if (gArgs.GetBoolArg(\"-capturemessages\", false)) {\n+        CaptureMessage(pfrom->addr, msg.m_command, MakeUCharSpan(msg.m_recv), /* incoming */ true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562515326",
      "id" : 562515326,
      "line" : 4046,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjUxNTMyNg==",
      "original_commit_id" : "e2b6430dcb50a4e90f70a3dcea693a6dc8112634",
      "original_line" : 4046,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 22,
      "pull_request_review_id" : 574106687,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562515326",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562522841"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562522841"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The difference would be that disconnected nodes may still have their messages captured and that the capture file will record a time closer to the receive time, as opposed to the process time of the message? No opinion on what to do, just asking about the difference.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-22T10:06:28Z",
      "diff_hunk" : "@@ -4042,6 +4042,10 @@ bool PeerManagerImpl::ProcessMessages(CNode* pfrom, std::atomic<bool>& interrupt\n     }\n     CNetMessage& msg(msgs.front());\n \n+    if (gArgs.GetBoolArg(\"-capturemessages\", false)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562522841",
      "id" : 562522841,
      "in_reply_to_id" : 562273457,
      "line" : 4045,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjUyMjg0MQ==",
      "original_commit_id" : "e2b6430dcb50a4e90f70a3dcea693a6dc8112634",
      "original_line" : 4045,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 21,
      "pull_request_review_id" : 574106687,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562522841",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562522979"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562522979"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That's fair!",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-22T10:06:41Z",
      "diff_hunk" : "@@ -1239,6 +1242,8 @@ inline std::chrono::microseconds PoissonNextSend(std::chrono::microseconds now,\n     return std::chrono::microseconds{PoissonNextSend(now.count(), average_interval.count())};\n }\n \n+void CaptureMessage(const CAddress& addr, const std::string& msg_type, const Span<const unsigned char>& data, bool is_incoming);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562522979",
      "id" : 562522979,
      "in_reply_to_id" : 560908669,
      "line" : 1246,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjUyMjk3OQ==",
      "original_commit_id" : "af8bcd1a6ecdfa15d7fb0f98256d47dec9b40f61",
      "original_line" : 1246,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 22,
      "pull_request_review_id" : 574116877,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562522979",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562524979"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562524979"
         }
      },
      "author_association" : "MEMBER",
      "body" : "completely unrelated, but this seems fragile. Would be good to remove those ints and only use uint256`s",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-22T10:09:54Z",
      "diff_hunk" : "@@ -0,0 +1,198 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message capture binary files.  To be used in conjunction with -capturemessages.\"\"\"\n+\n+import argparse\n+import os\n+import shutil\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List, Optional\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.messages import ser_uint256     # noqa: E402\n+from test_framework.p2p import MESSAGEMAP           # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+# The test framework classes stores hashes as large ints in many cases.\n+# These are variables of type uint256 in core.\n+# There isn't a way to distinguish between a large int and a large int that is actually a blob of bytes.\n+# As such, they are itemized here.\n+# Any variables with these names that are of type int are actually uint256 variables.\n+# (These can be easily found by looking for calls to deser_uint256, deser_uint256_vector, and uint256_from_str in messages.py)\n+HASH_INTS = [\n+    \"blockhash\",\n+    \"block_hash\",\n+    \"hash\",\n+    \"hashMerkleRoot\",\n+    \"hashPrevBlock\",\n+    \"hashstop\",\n+    \"prev_header\",\n+    \"sha256\",\n+    \"stop_hash\",\n+]\n+\n+HASH_INT_VECTORS = [\n+    \"hashes\",\n+    \"headers\",\n+    \"vHave\",\n+    \"vHash\",\n+]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562524979",
      "id" : 562524979,
      "line" : 48,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjUyNDk3OQ==",
      "original_commit_id" : "a17b2509e0d7e7e05fd5600d5387608bb706ac0e",
      "original_line" : 48,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "contrib/message-capture/message-capture-parser.py",
      "position" : 48,
      "pull_request_review_id" : 574106687,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562524979",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562531971"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562531971"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Tend to agree. The test framework can only deserialize a subset of messages than what Bitcoin Core can deserialize. This is expected to happen in practice, so should fail gracefully in some way. Probably like an unknown message type.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-22T10:21:16Z",
      "diff_hunk" : "@@ -0,0 +1,198 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message capture binary files.  To be used in conjunction with -capturemessages.\"\"\"\n+\n+import argparse\n+import os\n+import shutil\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List, Optional\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.messages import ser_uint256     # noqa: E402\n+from test_framework.p2p import MESSAGEMAP           # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+# The test framework classes stores hashes as large ints in many cases.\n+# These are variables of type uint256 in core.\n+# There isn't a way to distinguish between a large int and a large int that is actually a blob of bytes.\n+# As such, they are itemized here.\n+# Any variables with these names that are of type int are actually uint256 variables.\n+# (These can be easily found by looking for calls to deser_uint256, deser_uint256_vector, and uint256_from_str in messages.py)\n+HASH_INTS = [\n+    \"blockhash\",\n+    \"block_hash\",\n+    \"hash\",\n+    \"hashMerkleRoot\",\n+    \"hashPrevBlock\",\n+    \"hashstop\",\n+    \"prev_header\",\n+    \"sha256\",\n+    \"stop_hash\",\n+]\n+\n+HASH_INT_VECTORS = [\n+    \"hashes\",\n+    \"headers\",\n+    \"vHave\",\n+    \"vHash\",\n+]\n+\n+\n+class ProgressBar:\n+    def __init__(self, total: float):\n+        self.total = total\n+        self.running = 0\n+\n+    def set_progress(self, progress: float):\n+        cols = shutil.get_terminal_size()[0]\n+        if cols <= 12:\n+            return\n+        max_blocks = cols - 9\n+        num_blocks = int(max_blocks * progress)\n+        print('\\r[ {}{} ] {:3.0f}%'\n+              .format('#' * num_blocks,\n+                      ' ' * (max_blocks - num_blocks),\n+                      progress * 100),\n+              end ='')\n+\n+    def update(self, more: float):\n+        self.running += more\n+        self.set_progress(self.running / self.total)\n+\n+\n+def to_jsonable(obj: Any) -> Any:\n+    if hasattr(obj, \"__dict__\"):\n+        return obj.__dict__\n+    elif hasattr(obj, \"__slots__\"):\n+        ret = {}    # type: Any\n+        for slot in obj.__slots__:\n+            val = getattr(obj, slot, None)\n+            if slot in HASH_INTS and isinstance(val, int):\n+                ret[slot] = ser_uint256(val).hex()\n+            elif slot in HASH_INT_VECTORS and isinstance(val[0], int):\n+                ret[slot] = [ser_uint256(a).hex() for a in val]\n+            else:\n+                ret[slot] = to_jsonable(val)\n+        return ret\n+    elif isinstance(obj, list):\n+        return [to_jsonable(a) for a in obj]\n+    elif isinstance(obj, bytes):\n+        return obj.hex()\n+    else:\n+        return obj\n+\n+\n+def process_file(path: str, messages: List[Any], recv: bool, progress_bar: Optional[ProgressBar]) -> None:\n+    with open(path, 'rb') as f_in:\n+        if progress_bar:\n+            bytes_read = 0\n+\n+        while True:\n+            if progress_bar:\n+                # Update progress bar\n+                diff = f_in.tell() - bytes_read - 1\n+                progress_bar.update(diff)\n+                bytes_read = f_in.tell() - 1\n+            \n+            # Read the Header\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int\n+            msgtype = tmp_header.read(MSGTYPE_SIZE).split(b'\\x00', 1)[0]     # type: bytes\n+            length = int.from_bytes(tmp_header.read(LENGTH_SIZE), \"little\")  # type: int\n+\n+            # Determine message type\n+            if msgtype not in MESSAGEMAP:\n+                # For now just skip unrecognized messages\n+                f_in.seek(length, os.SEEK_CUR)\n+                print(f\"Skipping unrecognized message type {msgtype}\", file=sys.stderr)\n+                continue\n+            msg_ser = BytesIO(f_in.read(length))\n+            msg = MESSAGEMAP[msgtype]()\n+\n+            # Deserialize the message\n+            try:\n+                msg.deserialize(msg_ser)\n+            except KeyboardInterrupt:\n+                raise\n+            except Exception:\n+                # Message was bad, skip the rest of the file\n+                print(f\"Found broken message, skipping remainder of file: {path}\", file=sys.stderr)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562531971",
      "id" : 562531971,
      "in_reply_to_id" : 562284378,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjUzMTk3MQ==",
      "original_commit_id" : "a17b2509e0d7e7e05fd5600d5387608bb706ac0e",
      "original_line" : 132,
      "original_position" : 132,
      "original_start_line" : null,
      "path" : "contrib/message-capture/message-capture-parser.py",
      "position" : null,
      "pull_request_review_id" : 574106687,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562531971",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Slightly less sure about separating send/receive, but seems ok.\r\n\r\nThis was my suggestion. Maybe a hangover from my telecoms days when it was common to dump different streams for send/recv. The benefit here is that we save one bit (really one byte since there's nowhere to stuff it in the other metadata fields) per message because we don't need a flag to indicate send/recv. As well as that, there are probably at least some tools/analyses that are only interested in traffic in one direction. Splitting the files means that those tools would not have to read/filter/seek over a bunch of messages that they're not interested in.\r\n\r\n> I wonder if we shouldn't go further actually. Having one file (or two) = one session would be pretty nice for certain analyses. That could be accomplished by adding e.g. (our own node startup time, peer id) or (connection start time) in the filenames (or directory names).\r\n\r\nACK! I think a directory structure of `<IP_port>/<peerid>/[send|recv].dev` would work very nicely.\r\n\r\n> I'm slightly concerned about the overhead of opening/closing files for every message sent/received. Has anyone benchmarked this (or have ideas for a useful benchmark, even)? I understand the rationale of not occupying a large part of the file descriptor space for this, but it'd be good to know it doesn't really hurt.\r\n\r\nThis is something that @troygiorshev and I discussed at length, but I can't find that discussion in this PR, so it was probably before it was opened. Troy, do you have any notes from then? I know you looked into both alternatives.",
      "created_at" : "2021-01-22T10:22:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-765304301",
      "id" : 765304301,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2NTMwNDMwMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-22T10:22:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/765304301",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562532549"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562532549"
         }
      },
      "author_association" : "MEMBER",
      "body" : "There was some discussion of that here: https://github.com/bitcoin/bitcoin/pull/19509#discussion_r454190521.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-22T10:22:16Z",
      "diff_hunk" : "@@ -4042,6 +4042,10 @@ bool PeerManagerImpl::ProcessMessages(CNode* pfrom, std::atomic<bool>& interrupt\n     }\n     CNetMessage& msg(msgs.front());\n \n+    if (gArgs.GetBoolArg(\"-capturemessages\", false)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562532549",
      "id" : 562532549,
      "in_reply_to_id" : 562273457,
      "line" : 4045,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjUzMjU0OQ==",
      "original_commit_id" : "e2b6430dcb50a4e90f70a3dcea693a6dc8112634",
      "original_line" : 4045,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 21,
      "pull_request_review_id" : 574129216,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562532549",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562533570"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562533570"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Probably my suggestion as well. Making it DEBUG_ONLY allows this to be an experimental feature that we can alter/remove in future releases without disrupting users' workflow. We can always remove DEBUG_ONLY later if we're happy to make it more visible.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-22T10:24:05Z",
      "diff_hunk" : "@@ -521,6 +521,7 @@ void SetupServerArgs(NodeContext& node)\n     argsman.AddArg(\"-limitdescendantcount=<n>\", strprintf(\"Do not accept transactions if any ancestor would have <n> or more in-mempool descendants (default: %u)\", DEFAULT_DESCENDANT_LIMIT), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-limitdescendantsize=<n>\", strprintf(\"Do not accept transactions if any ancestor would have more than <n> kilobytes of in-mempool descendants (default: %u).\", DEFAULT_DESCENDANT_SIZE_LIMIT), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-addrmantest\", \"Allows to test address relay on localhost\", ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n+    argsman.AddArg(\"-capturemessages\", \"Capture all P2P messages to file\", ArgsManager::ALLOW_BOOL | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562533570",
      "id" : 562533570,
      "in_reply_to_id" : 562272863,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjUzMzU3MA==",
      "original_commit_id" : "e2b6430dcb50a4e90f70a3dcea693a6dc8112634",
      "original_line" : 524,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 574130611,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562533570",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562535085"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562535085"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, definitely a good suggestion. I agree this can wait for a future PR.\r\n\r\nSee the use of `heapq.merge()` in `test/functional/combine_logs.py` for one way to do this (although I never enhanced that to support streaming since there wasn't an immediate need).",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-22T10:26:28Z",
      "diff_hunk" : "@@ -0,0 +1,198 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message capture binary files.  To be used in conjunction with -capturemessages.\"\"\"\n+\n+import argparse\n+import os\n+import shutil\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List, Optional\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.messages import ser_uint256     # noqa: E402\n+from test_framework.p2p import MESSAGEMAP           # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+# The test framework classes stores hashes as large ints in many cases.\n+# These are variables of type uint256 in core.\n+# There isn't a way to distinguish between a large int and a large int that is actually a blob of bytes.\n+# As such, they are itemized here.\n+# Any variables with these names that are of type int are actually uint256 variables.\n+# (These can be easily found by looking for calls to deser_uint256, deser_uint256_vector, and uint256_from_str in messages.py)\n+HASH_INTS = [\n+    \"blockhash\",\n+    \"block_hash\",\n+    \"hash\",\n+    \"hashMerkleRoot\",\n+    \"hashPrevBlock\",\n+    \"hashstop\",\n+    \"prev_header\",\n+    \"sha256\",\n+    \"stop_hash\",\n+]\n+\n+HASH_INT_VECTORS = [\n+    \"hashes\",\n+    \"headers\",\n+    \"vHave\",\n+    \"vHash\",\n+]\n+\n+\n+class ProgressBar:\n+    def __init__(self, total: float):\n+        self.total = total\n+        self.running = 0\n+\n+    def set_progress(self, progress: float):\n+        cols = shutil.get_terminal_size()[0]\n+        if cols <= 12:\n+            return\n+        max_blocks = cols - 9\n+        num_blocks = int(max_blocks * progress)\n+        print('\\r[ {}{} ] {:3.0f}%'\n+              .format('#' * num_blocks,\n+                      ' ' * (max_blocks - num_blocks),\n+                      progress * 100),\n+              end ='')\n+\n+    def update(self, more: float):\n+        self.running += more\n+        self.set_progress(self.running / self.total)\n+\n+\n+def to_jsonable(obj: Any) -> Any:\n+    if hasattr(obj, \"__dict__\"):\n+        return obj.__dict__\n+    elif hasattr(obj, \"__slots__\"):\n+        ret = {}    # type: Any\n+        for slot in obj.__slots__:\n+            val = getattr(obj, slot, None)\n+            if slot in HASH_INTS and isinstance(val, int):\n+                ret[slot] = ser_uint256(val).hex()\n+            elif slot in HASH_INT_VECTORS and isinstance(val[0], int):\n+                ret[slot] = [ser_uint256(a).hex() for a in val]\n+            else:\n+                ret[slot] = to_jsonable(val)\n+        return ret\n+    elif isinstance(obj, list):\n+        return [to_jsonable(a) for a in obj]\n+    elif isinstance(obj, bytes):\n+        return obj.hex()\n+    else:\n+        return obj\n+\n+\n+def process_file(path: str, messages: List[Any], recv: bool, progress_bar: Optional[ProgressBar]) -> None:\n+    with open(path, 'rb') as f_in:\n+        if progress_bar:\n+            bytes_read = 0\n+\n+        while True:\n+            if progress_bar:\n+                # Update progress bar\n+                diff = f_in.tell() - bytes_read - 1\n+                progress_bar.update(diff)\n+                bytes_read = f_in.tell() - 1\n+            \n+            # Read the Header\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int\n+            msgtype = tmp_header.read(MSGTYPE_SIZE).split(b'\\x00', 1)[0]     # type: bytes\n+            length = int.from_bytes(tmp_header.read(LENGTH_SIZE), \"little\")  # type: int\n+\n+            # Determine message type\n+            if msgtype not in MESSAGEMAP:\n+                # For now just skip unrecognized messages\n+                f_in.seek(length, os.SEEK_CUR)\n+                print(f\"Skipping unrecognized message type {msgtype}\", file=sys.stderr)\n+                continue\n+            msg_ser = BytesIO(f_in.read(length))\n+            msg = MESSAGEMAP[msgtype]()\n+\n+            # Deserialize the message\n+            try:\n+                msg.deserialize(msg_ser)\n+            except KeyboardInterrupt:\n+                raise\n+            except Exception:\n+                # Message was bad, skip the rest of the file\n+                print(f\"Found broken message, skipping remainder of file: {path}\", file=sys.stderr)\n+                break\n+\n+            # Convert message to dictionary and add it to the messages dict\n+            msg_dict = {}\n+            msg_dict[\"msgtype\"] = getattr(msg, \"msgtype\", None).decode()\n+            msg_dict[\"direction\"] = \"recv\" if recv else \"sent\"\n+            msg_dict[\"time\"] = time\n+            msg_dict[\"size\"] = length   # \"size\" is less readable here, but more readable in the output\n+            if length:\n+                msg_dict[\"body\"] = to_jsonable(msg)\n+            messages.append(msg_dict)\n+\n+        if progress_bar:\n+            # Update the progress bar to the end of the current file\n+            # in case we exited the loop early\n+            f_in.seek(0, os.SEEK_END)   # Go to end of file\n+            diff = f_in.tell() - bytes_read - 1\n+            progress_bar.update(diff)\n+\n+\n+def main():\n+    \"\"\"Main\"\"\"\n+    parser = argparse.ArgumentParser(\n+        description=__doc__,\n+        epilog=\"EXAMPLE \\n\\t{0} -o out.json <data-dir>/message_capture/**/*.dat\".format(sys.argv[0]),\n+        formatter_class=argparse.RawTextHelpFormatter)\n+    parser.add_argument(\n+        \"capturepaths\",\n+        nargs='+',\n+        help=\"binary message capture files to parse.\")\n+    parser.add_argument(\n+        \"-o\", \"--output\",\n+        help=\"output file.  If unset print to stdout\")\n+    parser.add_argument(\n+        \"-n\", \"--no-progress-bar\",\n+        action='store_true',\n+        help=\"disable the progress bar.  Automatically set if the output is not a terminal\")\n+    args = parser.parse_args()\n+    capturepaths = [Path.cwd() / Path(capturepath) for capturepath in args.capturepaths]\n+    output = Path.cwd() / Path(args.output) if args.output else False\n+    use_progress_bar = (not args.no_progress_bar) and sys.stdout.isatty()\n+\n+    messages = []   # type: List[Any]\n+    if use_progress_bar:\n+        total_size = sum(capture.stat().st_size for capture in capturepaths)\n+        progress_bar = ProgressBar(total_size)\n+    else:\n+        progress_bar = None\n+\n+    for capture in capturepaths:\n+        process_file(str(capture), messages, \"recv\" in capture.stem, progress_bar)\n+\n+    messages.sort(key=lambda msg: msg['time'])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562535085",
      "id" : 562535085,
      "in_reply_to_id" : 562274872,
      "line" : 201,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjUzNTA4NQ==",
      "original_commit_id" : "d3353b507fe2a2c26a690186a6cd7ff4cee42ba0",
      "original_line" : 201,
      "original_position" : 185,
      "original_start_line" : null,
      "path" : "contrib/message-capture/message-capture-parser.py",
      "position" : 201,
      "pull_request_review_id" : 574132408,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562535085",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562537965"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562537965"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit\r\n\r\n```suggestion\r\n            msg_dict[\"msgtype\"] = msg.msgtype.decode()\r\n```\r\nor\r\n```suggestion\r\n            msg_dict[\"msgtype\"] = msg_type.decode()\r\n```",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-22T10:30:49Z",
      "diff_hunk" : "@@ -0,0 +1,198 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message capture binary files.  To be used in conjunction with -capturemessages.\"\"\"\n+\n+import argparse\n+import os\n+import shutil\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List, Optional\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.messages import ser_uint256     # noqa: E402\n+from test_framework.p2p import MESSAGEMAP           # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+# The test framework classes stores hashes as large ints in many cases.\n+# These are variables of type uint256 in core.\n+# There isn't a way to distinguish between a large int and a large int that is actually a blob of bytes.\n+# As such, they are itemized here.\n+# Any variables with these names that are of type int are actually uint256 variables.\n+# (These can be easily found by looking for calls to deser_uint256, deser_uint256_vector, and uint256_from_str in messages.py)\n+HASH_INTS = [\n+    \"blockhash\",\n+    \"block_hash\",\n+    \"hash\",\n+    \"hashMerkleRoot\",\n+    \"hashPrevBlock\",\n+    \"hashstop\",\n+    \"prev_header\",\n+    \"sha256\",\n+    \"stop_hash\",\n+]\n+\n+HASH_INT_VECTORS = [\n+    \"hashes\",\n+    \"headers\",\n+    \"vHave\",\n+    \"vHash\",\n+]\n+\n+\n+class ProgressBar:\n+    def __init__(self, total: float):\n+        self.total = total\n+        self.running = 0\n+\n+    def set_progress(self, progress: float):\n+        cols = shutil.get_terminal_size()[0]\n+        if cols <= 12:\n+            return\n+        max_blocks = cols - 9\n+        num_blocks = int(max_blocks * progress)\n+        print('\\r[ {}{} ] {:3.0f}%'\n+              .format('#' * num_blocks,\n+                      ' ' * (max_blocks - num_blocks),\n+                      progress * 100),\n+              end ='')\n+\n+    def update(self, more: float):\n+        self.running += more\n+        self.set_progress(self.running / self.total)\n+\n+\n+def to_jsonable(obj: Any) -> Any:\n+    if hasattr(obj, \"__dict__\"):\n+        return obj.__dict__\n+    elif hasattr(obj, \"__slots__\"):\n+        ret = {}    # type: Any\n+        for slot in obj.__slots__:\n+            val = getattr(obj, slot, None)\n+            if slot in HASH_INTS and isinstance(val, int):\n+                ret[slot] = ser_uint256(val).hex()\n+            elif slot in HASH_INT_VECTORS and isinstance(val[0], int):\n+                ret[slot] = [ser_uint256(a).hex() for a in val]\n+            else:\n+                ret[slot] = to_jsonable(val)\n+        return ret\n+    elif isinstance(obj, list):\n+        return [to_jsonable(a) for a in obj]\n+    elif isinstance(obj, bytes):\n+        return obj.hex()\n+    else:\n+        return obj\n+\n+\n+def process_file(path: str, messages: List[Any], recv: bool, progress_bar: Optional[ProgressBar]) -> None:\n+    with open(path, 'rb') as f_in:\n+        if progress_bar:\n+            bytes_read = 0\n+\n+        while True:\n+            if progress_bar:\n+                # Update progress bar\n+                diff = f_in.tell() - bytes_read - 1\n+                progress_bar.update(diff)\n+                bytes_read = f_in.tell() - 1\n+            \n+            # Read the Header\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int\n+            msgtype = tmp_header.read(MSGTYPE_SIZE).split(b'\\x00', 1)[0]     # type: bytes\n+            length = int.from_bytes(tmp_header.read(LENGTH_SIZE), \"little\")  # type: int\n+\n+            # Determine message type\n+            if msgtype not in MESSAGEMAP:\n+                # For now just skip unrecognized messages\n+                f_in.seek(length, os.SEEK_CUR)\n+                print(f\"Skipping unrecognized message type {msgtype}\", file=sys.stderr)\n+                continue\n+            msg_ser = BytesIO(f_in.read(length))\n+            msg = MESSAGEMAP[msgtype]()\n+\n+            # Deserialize the message\n+            try:\n+                msg.deserialize(msg_ser)\n+            except KeyboardInterrupt:\n+                raise\n+            except Exception:\n+                # Message was bad, skip the rest of the file\n+                print(f\"Found broken message, skipping remainder of file: {path}\", file=sys.stderr)\n+                break\n+\n+            # Convert message to dictionary and add it to the messages dict\n+            msg_dict = {}\n+            msg_dict[\"msgtype\"] = getattr(msg, \"msgtype\", None).decode()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562537965",
      "id" : 562537965,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjUzNzk2NQ==",
      "original_commit_id" : "a17b2509e0d7e7e05fd5600d5387608bb706ac0e",
      "original_line" : 137,
      "original_position" : 137,
      "original_start_line" : null,
      "path" : "contrib/message-capture/message-capture-parser.py",
      "position" : null,
      "pull_request_review_id" : 574106687,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562537965",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562539575"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562539575"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit\r\n\r\n```suggestion\r\n```",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-22T10:33:34Z",
      "diff_hunk" : "@@ -0,0 +1,198 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message capture binary files.  To be used in conjunction with -capturemessages.\"\"\"\n+\n+import argparse\n+import os\n+import shutil\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List, Optional\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.messages import ser_uint256     # noqa: E402\n+from test_framework.p2p import MESSAGEMAP           # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+# The test framework classes stores hashes as large ints in many cases.\n+# These are variables of type uint256 in core.\n+# There isn't a way to distinguish between a large int and a large int that is actually a blob of bytes.\n+# As such, they are itemized here.\n+# Any variables with these names that are of type int are actually uint256 variables.\n+# (These can be easily found by looking for calls to deser_uint256, deser_uint256_vector, and uint256_from_str in messages.py)\n+HASH_INTS = [\n+    \"blockhash\",\n+    \"block_hash\",\n+    \"hash\",\n+    \"hashMerkleRoot\",\n+    \"hashPrevBlock\",\n+    \"hashstop\",\n+    \"prev_header\",\n+    \"sha256\",\n+    \"stop_hash\",\n+]\n+\n+HASH_INT_VECTORS = [\n+    \"hashes\",\n+    \"headers\",\n+    \"vHave\",\n+    \"vHash\",\n+]\n+\n+\n+class ProgressBar:\n+    def __init__(self, total: float):\n+        self.total = total\n+        self.running = 0\n+\n+    def set_progress(self, progress: float):\n+        cols = shutil.get_terminal_size()[0]\n+        if cols <= 12:\n+            return\n+        max_blocks = cols - 9\n+        num_blocks = int(max_blocks * progress)\n+        print('\\r[ {}{} ] {:3.0f}%'\n+              .format('#' * num_blocks,\n+                      ' ' * (max_blocks - num_blocks),\n+                      progress * 100),\n+              end ='')\n+\n+    def update(self, more: float):\n+        self.running += more\n+        self.set_progress(self.running / self.total)\n+\n+\n+def to_jsonable(obj: Any) -> Any:\n+    if hasattr(obj, \"__dict__\"):\n+        return obj.__dict__\n+    elif hasattr(obj, \"__slots__\"):\n+        ret = {}    # type: Any\n+        for slot in obj.__slots__:\n+            val = getattr(obj, slot, None)\n+            if slot in HASH_INTS and isinstance(val, int):\n+                ret[slot] = ser_uint256(val).hex()\n+            elif slot in HASH_INT_VECTORS and isinstance(val[0], int):\n+                ret[slot] = [ser_uint256(a).hex() for a in val]\n+            else:\n+                ret[slot] = to_jsonable(val)\n+        return ret\n+    elif isinstance(obj, list):\n+        return [to_jsonable(a) for a in obj]\n+    elif isinstance(obj, bytes):\n+        return obj.hex()\n+    else:\n+        return obj\n+\n+\n+def process_file(path: str, messages: List[Any], recv: bool, progress_bar: Optional[ProgressBar]) -> None:\n+    with open(path, 'rb') as f_in:\n+        if progress_bar:\n+            bytes_read = 0\n+\n+        while True:\n+            if progress_bar:\n+                # Update progress bar\n+                diff = f_in.tell() - bytes_read - 1\n+                progress_bar.update(diff)\n+                bytes_read = f_in.tell() - 1\n+            \n+            # Read the Header\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int\n+            msgtype = tmp_header.read(MSGTYPE_SIZE).split(b'\\x00', 1)[0]     # type: bytes\n+            length = int.from_bytes(tmp_header.read(LENGTH_SIZE), \"little\")  # type: int\n+\n+            # Determine message type\n+            if msgtype not in MESSAGEMAP:\n+                # For now just skip unrecognized messages\n+                f_in.seek(length, os.SEEK_CUR)\n+                print(f\"Skipping unrecognized message type {msgtype}\", file=sys.stderr)\n+                continue\n+            msg_ser = BytesIO(f_in.read(length))\n+            msg = MESSAGEMAP[msgtype]()\n+\n+            # Deserialize the message\n+            try:\n+                msg.deserialize(msg_ser)\n+            except KeyboardInterrupt:\n+                raise\n+            except Exception:\n+                # Message was bad, skip the rest of the file\n+                print(f\"Found broken message, skipping remainder of file: {path}\", file=sys.stderr)\n+                break\n+\n+            # Convert message to dictionary and add it to the messages dict\n+            msg_dict = {}\n+            msg_dict[\"msgtype\"] = getattr(msg, \"msgtype\", None).decode()\n+            msg_dict[\"direction\"] = \"recv\" if recv else \"sent\"\n+            msg_dict[\"time\"] = time\n+            msg_dict[\"size\"] = length   # \"size\" is less readable here, but more readable in the output\n+            if length:\n+                msg_dict[\"body\"] = to_jsonable(msg)\n+            messages.append(msg_dict)\n+\n+        if progress_bar:\n+            # Update the progress bar to the end of the current file\n+            # in case we exited the loop early\n+            f_in.seek(0, os.SEEK_END)   # Go to end of file\n+            diff = f_in.tell() - bytes_read - 1\n+            progress_bar.update(diff)\n+\n+\n+def main():\n+    \"\"\"Main\"\"\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562539575",
      "id" : 562539575,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjUzOTU3NQ==",
      "original_commit_id" : "a17b2509e0d7e7e05fd5600d5387608bb706ac0e",
      "original_line" : 154,
      "original_position" : 154,
      "original_start_line" : null,
      "path" : "contrib/message-capture/message-capture-parser.py",
      "position" : null,
      "pull_request_review_id" : 574106687,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562539575",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562543791"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562543791"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Just check that the message type is in `MESSAGEMAP`? I think we wouldn't ever want to add a message type that is not in `MESSAGEMAP`.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-22T10:40:53Z",
      "diff_hunk" : "@@ -0,0 +1,76 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test per-peer message capture capability.\n+\n+Additionally, the output of contrib/message-capture/message-capture-parser.py should be verified manually.\n+\"\"\"\n+\n+import glob\n+from io import BytesIO\n+import os\n+\n+from test_framework.p2p import P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+def mini_parser(dat_file):\n+    \"\"\"Parse a data file created by CaptureMessage.\n+\n+    From the data file we'll only check the structure.\n+\n+    We won't care about things like:\n+    - Deserializing the payload of the message\n+        - This is managed by the deserialize methods in test_framework.messages\n+    - The order of the messages\n+        - There's no reason why we can't, say, change the order of the messages in the handshake\n+    - Message Type\n+        - We can add new message types\n+\n+    We're ignoring these because they're simply too brittle to test here.\n+    \"\"\"\n+    with open(dat_file, 'rb') as f_in:\n+        # This should have at least one message in it\n+        assert(os.fstat(f_in.fileno()).st_size >= TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+        while True:\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            _ = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int\n+            raw_msgtype = tmp_header.read(MSGTYPE_SIZE)\n+            msgtype = raw_msgtype.split(b'\\x00', 1)[0]     # type: bytes\n+            remainder =  raw_msgtype.split(b'\\x00', 1)[1]\n+            assert(len(msgtype) > 0)\n+            assert(msgtype.decode().isprintable())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562543791",
      "id" : 562543791,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjU0Mzc5MQ==",
      "original_commit_id" : "a17b2509e0d7e7e05fd5600d5387608bb706ac0e",
      "original_line" : 50,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "test/functional/p2p_message_capture.py",
      "position" : null,
      "pull_request_review_id" : 574106687,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562543791",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562545025"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562545025"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That seems fragile. What if the payload happens to be printable? ",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-22T10:43:13Z",
      "diff_hunk" : "@@ -0,0 +1,76 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test per-peer message capture capability.\n+\n+Additionally, the output of contrib/message-capture/message-capture-parser.py should be verified manually.\n+\"\"\"\n+\n+import glob\n+from io import BytesIO\n+import os\n+\n+from test_framework.p2p import P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+def mini_parser(dat_file):\n+    \"\"\"Parse a data file created by CaptureMessage.\n+\n+    From the data file we'll only check the structure.\n+\n+    We won't care about things like:\n+    - Deserializing the payload of the message\n+        - This is managed by the deserialize methods in test_framework.messages\n+    - The order of the messages\n+        - There's no reason why we can't, say, change the order of the messages in the handshake\n+    - Message Type\n+        - We can add new message types\n+\n+    We're ignoring these because they're simply too brittle to test here.\n+    \"\"\"\n+    with open(dat_file, 'rb') as f_in:\n+        # This should have at least one message in it\n+        assert(os.fstat(f_in.fileno()).st_size >= TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+        while True:\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            _ = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int\n+            raw_msgtype = tmp_header.read(MSGTYPE_SIZE)\n+            msgtype = raw_msgtype.split(b'\\x00', 1)[0]     # type: bytes\n+            remainder =  raw_msgtype.split(b'\\x00', 1)[1]\n+            assert(len(msgtype) > 0)\n+            assert(msgtype.decode().isprintable())\n+            assert(len(remainder) == 0 or not remainder.decode().isprintable())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562545025",
      "id" : 562545025,
      "line" : 51,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjU0NTAyNQ==",
      "original_commit_id" : "a17b2509e0d7e7e05fd5600d5387608bb706ac0e",
      "original_line" : 51,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "test/functional/p2p_message_capture.py",
      "position" : 51,
      "pull_request_review_id" : 574106687,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562545025",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> ACK! I think a directory structure of <IP_port>/<peerid>/[send|recv].dev would work very nicely.\r\n\r\nI think that could be confusing, because the same IP_port can have different peerid during the same connection (reconnect), but also can have the same peerid across restarts. So this make it *harder* to get the msgs of just one session.",
      "created_at" : "2021-01-22T10:53:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-765320311",
      "id" : 765320311,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2NTMyMDMxMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-22T10:53:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/765320311",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "There has been some feedback, but at the very least you need to fix the linter for this to be merged.",
      "created_at" : "2021-01-22T10:58:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-765322561",
      "id" : 765322561,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2NTMyMjU2MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-22T10:58:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/765322561",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I think that could be confusing, because the same IP_port can have different peerid during the same connection (reconnect), but also can have the same peerid across restarts. So this make it harder to get the msgs of just one session.\r\n\r\nAh, good point. I'd missed sipa's point about using a `(our own node startup time, peer id)` pair to handle restarts.",
      "created_at" : "2021-01-22T11:02:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-765324760",
      "id" : 765324760,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2NTMyNDc2MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-22T11:02:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/765324760",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sipa \r\n\r\n> Concept ACK. I really like the approach of having separate files per peer/connection. Slightly less sure about separating send/receive, but seems ok.\r\n\r\nAgreed: I also have a slight preference towards combining send and recv in the same file for these type of captures.\r\n\r\nFor \"request-response\" analysis it is really nice to be able to have the messages in correct order without having to correlate timestamps from two different files to produce an \"ordered\" file covering the entire flow.\r\n\r\nPersonally I think this ease-of-use benefit in the exceeds the cost (one extra byte to indicate direction, and having to skip one direction in the case of one direction analysis).\r\n\r\n> I wonder if we shouldn't go further actually. Having one file (or two) = one session would be pretty nice for certain analyses. That could be accomplished by adding e.g. (our own node startup time, peer id) or (connection start time) in the filenames (or directory names).\r\n\r\nStrong Concept ACK on this idea as well.\r\n\r\nIn the use cases I can think of the relevant unit of analysis is more likely to be \"one specific session (with one specific IP)\" than \"all session with one specific IP\".\r\n\r\nAnd the latter use cases can easily be covered by the user by simply concatenating multiple files of the \"one specific session\" type :)",
      "created_at" : "2021-01-22T16:00:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-765508093",
      "id" : 765508093,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2NTUwODA5Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-23T03:18:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/765508093",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562835751"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562835751"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Hmm, I don't think this functionality really belongs in the net_processing layer/thread in the first place. It's net that handles the connection and parsing/serializing of messages from/to a stream of bytes. So if that's the reason for having this weird split across modules, I'm not sure it's desirable.\r\n\r\nAnyway, no big deal - it just strikes me as ugly, but if it works, it works.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-22T18:45:14Z",
      "diff_hunk" : "@@ -4042,6 +4042,10 @@ bool PeerManagerImpl::ProcessMessages(CNode* pfrom, std::atomic<bool>& interrupt\n     }\n     CNetMessage& msg(msgs.front());\n \n+    if (gArgs.GetBoolArg(\"-capturemessages\", false)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562835751",
      "id" : 562835751,
      "in_reply_to_id" : 562273457,
      "line" : 4045,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjgzNTc1MQ==",
      "original_commit_id" : "e2b6430dcb50a4e90f70a3dcea693a6dc8112634",
      "original_line" : 4045,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 21,
      "pull_request_review_id" : 574525530,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562835751",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jnewbery \r\n\r\n> The benefit here is that we save one bit (really one byte since there's nowhere to stuff it in the other metadata fields) per message because we don't need a flag to indicate send/recv.\r\n\r\nThe direction could be stored in the top bit of the size field. The max protocol message size is 4000000 bytes, so even 3 bytes would be enough if we really wanted to. A variable-length encoding of command name (1 length byte + that many bytes for the command name itself e.g.) would also save several bytes on average per message.\r\n\r\nI don't think dump size is that much of a priority that it warrants lots of extra effort, but I also don't think the size argument on itself is a good reason for splitting the files based on direction.\r\n\r\n> As well as that, there are probably at least some tools/analyses that are only interested in traffic in one direction. Splitting the files means that those tools would not have to read/filter/seek over a bunch of messages that they're not interested in.\r\n\r\nMaybe, but I expect those to also be interested in just one or a few commands, and they'll still need to read/filter/seek over the ones they don't care about. On the other hand, anything analyzing query/response like things will need to look in both files too.\r\n\r\nEspecially if we'd go in a direction of separating separate sessions to the same ip/port, I think there is an elegance to having exactly 1 file = 1 session.\r\n\r\nAnother idea: would it make sense to store the version information of the dumping node (CLIENT_NAME, CLIENT_VERSION, perhaps also connection type)? Either in a header at the beginning of the file, or in the filename. That would make it easy to do analyses to compare behavior of different client versions.\r\n\r\nWhat about a directory structure of `<CLIENT_NAME>_<CLIENT_VERSION>/<ip>_<port>/<timestamp>_<peerid>.dat`?\r\n",
      "created_at" : "2021-01-22T19:09:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-765625996",
      "id" : 765625996,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2NTYyNTk5Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-22T19:12:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/765625996",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Especially if we'd go in a direction of separating separate sessions to the same ip/port, I think there is an elegance to having exactly 1 file = 1 session.\r\n\r\nI agree that this seems very nice. I don't have any objection to changing the output to be this way.\r\n\r\n> What about a directory structure of `<CLIENT_NAME>_<CLIENT_VERSION>/<ip>_<port>/<timestamp>_<peerid>.dat`?\r\n\r\nI'm less convinced of this. For one, those details can easily be fished out of the received version message in the file. I also like the directory structure of one directory per peer in `.bitcoin/message_capture` (and one file per session in each of those directories). But again, if other people prefer that I won't strongly oppose it.",
      "created_at" : "2021-01-22T19:28:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-765635682",
      "id" : 765635682,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2NTYzNTY4Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-22T19:28:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/765635682",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I'm less convinced of this.\r\n\r\nYes, just a suggestion to hear what people think.\r\n\r\n> For one, those details can easily be fished out of the received version message in the file.\r\n\r\nNote that I'm talking about the version of the *dumping* node, not of the peer we're connecting to (that may also be interesting of course, but is a bit harder as it means you only know the filename after receiving VERSION).\r\n\r\n> I also like the directory structure of one directory per peer in `.bitcoin/message_capture`\r\n\r\nIf the intent is really \"one directory per peer\", the port perhaps shouldn't be included (or at least not for incoming connections), as the outgoing TCP port is newly chosen for every connection.",
      "created_at" : "2021-01-22T19:33:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-765637994",
      "id" : 765637994,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2NTYzNzk5NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-22T19:33:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/765637994",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562901181"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562901181"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ah you caught me, I still do `cat out.json | jq` :)\r\n\r\nThanks for checking this, I'll fix it in the docs.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-22T20:45:42Z",
      "diff_hunk" : "@@ -0,0 +1,25 @@\n+# Per-Peer Message Capture\n+\n+## Purpose\n+\n+This feature allows for message capture on a per-peer basis.  It answers the simple question: \"Can I see what messages my node is sending and receiving?\"\n+\n+## Usage and Functionality\n+\n+* Run `bitcoind` with the `-capturemessages` option.\n+* Look in the `message_capture` folder in your datadir.\n+  * Typically this will be `~/.bitcoin/message_capture`.\n+  * See that there are many folders inside, one for each peer names with its IP address and port.\n+  * Inside each peer's folder there are two `.dat` files: one is for received messages (`msgs_recv.dat`) and the other is for sent messages (`msgs_sent.dat`).\n+* Run `contrib/message-capture/message-capture-parser.py` with the proper arguments.\n+  * See the `-h` option for help.\n+  * To see all messages, both sent and received, for all peers use:\n+    ```\n+    ./contrib/message-capture/message-capture-parser.py -o out.json \\\n+    ~/.bitcoin/message_capture/**/*.dat\n+    ```\n+  * Note:  The messages in the given `.dat` files will be interleaved in chronological order.  So, giving both received and sent `.dat` files (as above with `*.dat`) will result in all messages being interleaved in chronological order.\n+  * If an output file is not provided (i.e. the `-o` option is not used), then the output prints to `stdout`.\n+* View the resulting output.\n+  * The output file is `JSON` formatted.\n+  * Suggestion: use `jq` to view the output, with `jq out.json`",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562901181",
      "id" : 562901181,
      "in_reply_to_id" : 562208110,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjkwMTE4MQ==",
      "original_commit_id" : "a17b2509e0d7e7e05fd5600d5387608bb706ac0e",
      "original_line" : 25,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "contrib/message-capture/message-capture-docs.md",
      "position" : null,
      "pull_request_review_id" : 574607684,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562901181",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562914700"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562914700"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "s/file/disk/",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-22T21:15:02Z",
      "diff_hunk" : "@@ -521,6 +521,7 @@ void SetupServerArgs(NodeContext& node)\n     argsman.AddArg(\"-limitdescendantcount=<n>\", strprintf(\"Do not accept transactions if any ancestor would have <n> or more in-mempool descendants (default: %u)\", DEFAULT_DESCENDANT_LIMIT), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-limitdescendantsize=<n>\", strprintf(\"Do not accept transactions if any ancestor would have more than <n> kilobytes of in-mempool descendants (default: %u).\", DEFAULT_DESCENDANT_SIZE_LIMIT), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-addrmantest\", \"Allows to test address relay on localhost\", ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n+    argsman.AddArg(\"-capturemessages\", \"Capture all P2P messages to file\", ArgsManager::ALLOW_BOOL | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562914700",
      "id" : 562914700,
      "in_reply_to_id" : 562272863,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjkxNDcwMA==",
      "original_commit_id" : "e2b6430dcb50a4e90f70a3dcea693a6dc8112634",
      "original_line" : 524,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 574625372,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562914700",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562917209"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562917209"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think I'll keep DEBUG_ONLY unless having it is harmful for some reason.  I agree that it's very easy to remove later, and very difficult to add back.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-22T21:20:21Z",
      "diff_hunk" : "@@ -521,6 +521,7 @@ void SetupServerArgs(NodeContext& node)\n     argsman.AddArg(\"-limitdescendantcount=<n>\", strprintf(\"Do not accept transactions if any ancestor would have <n> or more in-mempool descendants (default: %u)\", DEFAULT_DESCENDANT_LIMIT), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-limitdescendantsize=<n>\", strprintf(\"Do not accept transactions if any ancestor would have more than <n> kilobytes of in-mempool descendants (default: %u).\", DEFAULT_DESCENDANT_SIZE_LIMIT), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-addrmantest\", \"Allows to test address relay on localhost\", ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n+    argsman.AddArg(\"-capturemessages\", \"Capture all P2P messages to file\", ArgsManager::ALLOW_BOOL | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562917209",
      "id" : 562917209,
      "in_reply_to_id" : 562272863,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjkxNzIwOQ==",
      "original_commit_id" : "e2b6430dcb50a4e90f70a3dcea693a6dc8112634",
      "original_line" : 524,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 574629424,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562917209",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562933835"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562933835"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I see this message dumping as a net_processing layer thing. It should be agnostic to the connection layer (eg if we eventually use BIP 151 or similar scheme, then the messages delivered to and sent from the net_processing layer shouldn't change). If you need the actual bytes sent on the wire, then tcpdump or similar might be more appropriate.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-22T21:50:04Z",
      "diff_hunk" : "@@ -4042,6 +4042,10 @@ bool PeerManagerImpl::ProcessMessages(CNode* pfrom, std::atomic<bool>& interrupt\n     }\n     CNetMessage& msg(msgs.front());\n \n+    if (gArgs.GetBoolArg(\"-capturemessages\", false)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562933835",
      "id" : 562933835,
      "in_reply_to_id" : 562273457,
      "line" : 4045,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjkzMzgzNQ==",
      "original_commit_id" : "e2b6430dcb50a4e90f70a3dcea693a6dc8112634",
      "original_line" : 4045,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 21,
      "pull_request_review_id" : 574647992,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562933835",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> why not capture messages after CNode::ReceiveMsgBytes?\r\n\r\nThis has been brought up a couple times now, and it's a great question, so it's worth a full response (that won't be buried in resolved conversations).\r\n\r\nMy priority in this PR is that the capture of messages always occurs in order from an _application layer_ perspective.  Because of this, I have to capture messages in the MessageHandler thread.\r\n\r\nIf I were to instead capture incoming messages in the SocketHandler thread, say, right after ReceiveMsgBytes, the following could possibly occur:\r\n\r\n* receive and capture message X\r\n* receive and capture message Y\r\n* send and capture message A\r\n\r\nwhereas on the processing side (since X and Y are in in the `vRecvMsg` queue before being processed), the node actually did the following:\r\n\r\n* process message X\r\n* respond with message A\r\n* process message Y\r\n\r\nSo the order would be broken.  Remember, this PR isn't just a fun replacement for wireshark.  The point is that someone improving/debugging/learning bitcoin's p2p protocol can see what's actually going on from the node's perspective, without having to worry about how the timing of the queues is complicating things.",
      "created_at" : "2021-01-22T21:50:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-765704796",
      "id" : 765704796,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2NTcwNDc5Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-22T21:50:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/765704796",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562934956"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562934956"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "As it stands, message capture always happens in the MessageHandler thread.  Unfortunately, functions in this thread span both net and net_processing.\r\n\r\nI've responded more fully below, https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-765704796",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-22T21:52:51Z",
      "diff_hunk" : "@@ -4042,6 +4042,10 @@ bool PeerManagerImpl::ProcessMessages(CNode* pfrom, std::atomic<bool>& interrupt\n     }\n     CNetMessage& msg(msgs.front());\n \n+    if (gArgs.GetBoolArg(\"-capturemessages\", false)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562934956",
      "id" : 562934956,
      "in_reply_to_id" : 562273457,
      "line" : 4045,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjkzNDk1Ng==",
      "original_commit_id" : "e2b6430dcb50a4e90f70a3dcea693a6dc8112634",
      "original_line" : 4045,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 21,
      "pull_request_review_id" : 574649483,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562934956",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@troygiorshev That's a great point. I was thinking that the difference between net-level and net_processing-level ordering would only be different interleaving across peers, but you're right to point out it even obscures the processing within one peer. I agree it's valuable to dump in processing order.\r\n",
      "created_at" : "2021-01-22T22:16:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-765715052",
      "id" : 765715052,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2NTcxNTA1Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-22T22:16:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/765715052",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562945472"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562945472"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I agree on all accounts: this is a naive solution but I'll leave an improvement for a future PR.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-22T22:19:04Z",
      "diff_hunk" : "@@ -0,0 +1,198 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message capture binary files.  To be used in conjunction with -capturemessages.\"\"\"\n+\n+import argparse\n+import os\n+import shutil\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List, Optional\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.messages import ser_uint256     # noqa: E402\n+from test_framework.p2p import MESSAGEMAP           # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+# The test framework classes stores hashes as large ints in many cases.\n+# These are variables of type uint256 in core.\n+# There isn't a way to distinguish between a large int and a large int that is actually a blob of bytes.\n+# As such, they are itemized here.\n+# Any variables with these names that are of type int are actually uint256 variables.\n+# (These can be easily found by looking for calls to deser_uint256, deser_uint256_vector, and uint256_from_str in messages.py)\n+HASH_INTS = [\n+    \"blockhash\",\n+    \"block_hash\",\n+    \"hash\",\n+    \"hashMerkleRoot\",\n+    \"hashPrevBlock\",\n+    \"hashstop\",\n+    \"prev_header\",\n+    \"sha256\",\n+    \"stop_hash\",\n+]\n+\n+HASH_INT_VECTORS = [\n+    \"hashes\",\n+    \"headers\",\n+    \"vHave\",\n+    \"vHash\",\n+]\n+\n+\n+class ProgressBar:\n+    def __init__(self, total: float):\n+        self.total = total\n+        self.running = 0\n+\n+    def set_progress(self, progress: float):\n+        cols = shutil.get_terminal_size()[0]\n+        if cols <= 12:\n+            return\n+        max_blocks = cols - 9\n+        num_blocks = int(max_blocks * progress)\n+        print('\\r[ {}{} ] {:3.0f}%'\n+              .format('#' * num_blocks,\n+                      ' ' * (max_blocks - num_blocks),\n+                      progress * 100),\n+              end ='')\n+\n+    def update(self, more: float):\n+        self.running += more\n+        self.set_progress(self.running / self.total)\n+\n+\n+def to_jsonable(obj: Any) -> Any:\n+    if hasattr(obj, \"__dict__\"):\n+        return obj.__dict__\n+    elif hasattr(obj, \"__slots__\"):\n+        ret = {}    # type: Any\n+        for slot in obj.__slots__:\n+            val = getattr(obj, slot, None)\n+            if slot in HASH_INTS and isinstance(val, int):\n+                ret[slot] = ser_uint256(val).hex()\n+            elif slot in HASH_INT_VECTORS and isinstance(val[0], int):\n+                ret[slot] = [ser_uint256(a).hex() for a in val]\n+            else:\n+                ret[slot] = to_jsonable(val)\n+        return ret\n+    elif isinstance(obj, list):\n+        return [to_jsonable(a) for a in obj]\n+    elif isinstance(obj, bytes):\n+        return obj.hex()\n+    else:\n+        return obj\n+\n+\n+def process_file(path: str, messages: List[Any], recv: bool, progress_bar: Optional[ProgressBar]) -> None:\n+    with open(path, 'rb') as f_in:\n+        if progress_bar:\n+            bytes_read = 0\n+\n+        while True:\n+            if progress_bar:\n+                # Update progress bar\n+                diff = f_in.tell() - bytes_read - 1\n+                progress_bar.update(diff)\n+                bytes_read = f_in.tell() - 1\n+            \n+            # Read the Header\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int\n+            msgtype = tmp_header.read(MSGTYPE_SIZE).split(b'\\x00', 1)[0]     # type: bytes\n+            length = int.from_bytes(tmp_header.read(LENGTH_SIZE), \"little\")  # type: int\n+\n+            # Determine message type\n+            if msgtype not in MESSAGEMAP:\n+                # For now just skip unrecognized messages\n+                f_in.seek(length, os.SEEK_CUR)\n+                print(f\"Skipping unrecognized message type {msgtype}\", file=sys.stderr)\n+                continue\n+            msg_ser = BytesIO(f_in.read(length))\n+            msg = MESSAGEMAP[msgtype]()\n+\n+            # Deserialize the message\n+            try:\n+                msg.deserialize(msg_ser)\n+            except KeyboardInterrupt:\n+                raise\n+            except Exception:\n+                # Message was bad, skip the rest of the file\n+                print(f\"Found broken message, skipping remainder of file: {path}\", file=sys.stderr)\n+                break\n+\n+            # Convert message to dictionary and add it to the messages dict\n+            msg_dict = {}\n+            msg_dict[\"msgtype\"] = getattr(msg, \"msgtype\", None).decode()\n+            msg_dict[\"direction\"] = \"recv\" if recv else \"sent\"\n+            msg_dict[\"time\"] = time\n+            msg_dict[\"size\"] = length   # \"size\" is less readable here, but more readable in the output\n+            if length:\n+                msg_dict[\"body\"] = to_jsonable(msg)\n+            messages.append(msg_dict)\n+\n+        if progress_bar:\n+            # Update the progress bar to the end of the current file\n+            # in case we exited the loop early\n+            f_in.seek(0, os.SEEK_END)   # Go to end of file\n+            diff = f_in.tell() - bytes_read - 1\n+            progress_bar.update(diff)\n+\n+\n+def main():\n+    \"\"\"Main\"\"\"\n+    parser = argparse.ArgumentParser(\n+        description=__doc__,\n+        epilog=\"EXAMPLE \\n\\t{0} -o out.json <data-dir>/message_capture/**/*.dat\".format(sys.argv[0]),\n+        formatter_class=argparse.RawTextHelpFormatter)\n+    parser.add_argument(\n+        \"capturepaths\",\n+        nargs='+',\n+        help=\"binary message capture files to parse.\")\n+    parser.add_argument(\n+        \"-o\", \"--output\",\n+        help=\"output file.  If unset print to stdout\")\n+    parser.add_argument(\n+        \"-n\", \"--no-progress-bar\",\n+        action='store_true',\n+        help=\"disable the progress bar.  Automatically set if the output is not a terminal\")\n+    args = parser.parse_args()\n+    capturepaths = [Path.cwd() / Path(capturepath) for capturepath in args.capturepaths]\n+    output = Path.cwd() / Path(args.output) if args.output else False\n+    use_progress_bar = (not args.no_progress_bar) and sys.stdout.isatty()\n+\n+    messages = []   # type: List[Any]\n+    if use_progress_bar:\n+        total_size = sum(capture.stat().st_size for capture in capturepaths)\n+        progress_bar = ProgressBar(total_size)\n+    else:\n+        progress_bar = None\n+\n+    for capture in capturepaths:\n+        process_file(str(capture), messages, \"recv\" in capture.stem, progress_bar)\n+\n+    messages.sort(key=lambda msg: msg['time'])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562945472",
      "id" : 562945472,
      "in_reply_to_id" : 562274872,
      "line" : 201,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mjk0NTQ3Mg==",
      "original_commit_id" : "d3353b507fe2a2c26a690186a6cd7ff4cee42ba0",
      "original_line" : 201,
      "original_position" : 185,
      "original_start_line" : null,
      "path" : "contrib/message-capture/message-capture-parser.py",
      "position" : 201,
      "pull_request_review_id" : 574662790,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562945472",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562954055"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562954055"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "You're right.  Because of how the capture is done in net.cpp, the length field is guaranteed to be correct.  (We'll never have a misalignment)  I'll change this to just skip the single message, and I'll insert an informative placeholder into the JSON.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-22T22:38:26Z",
      "diff_hunk" : "@@ -0,0 +1,198 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message capture binary files.  To be used in conjunction with -capturemessages.\"\"\"\n+\n+import argparse\n+import os\n+import shutil\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List, Optional\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.messages import ser_uint256     # noqa: E402\n+from test_framework.p2p import MESSAGEMAP           # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+# The test framework classes stores hashes as large ints in many cases.\n+# These are variables of type uint256 in core.\n+# There isn't a way to distinguish between a large int and a large int that is actually a blob of bytes.\n+# As such, they are itemized here.\n+# Any variables with these names that are of type int are actually uint256 variables.\n+# (These can be easily found by looking for calls to deser_uint256, deser_uint256_vector, and uint256_from_str in messages.py)\n+HASH_INTS = [\n+    \"blockhash\",\n+    \"block_hash\",\n+    \"hash\",\n+    \"hashMerkleRoot\",\n+    \"hashPrevBlock\",\n+    \"hashstop\",\n+    \"prev_header\",\n+    \"sha256\",\n+    \"stop_hash\",\n+]\n+\n+HASH_INT_VECTORS = [\n+    \"hashes\",\n+    \"headers\",\n+    \"vHave\",\n+    \"vHash\",\n+]\n+\n+\n+class ProgressBar:\n+    def __init__(self, total: float):\n+        self.total = total\n+        self.running = 0\n+\n+    def set_progress(self, progress: float):\n+        cols = shutil.get_terminal_size()[0]\n+        if cols <= 12:\n+            return\n+        max_blocks = cols - 9\n+        num_blocks = int(max_blocks * progress)\n+        print('\\r[ {}{} ] {:3.0f}%'\n+              .format('#' * num_blocks,\n+                      ' ' * (max_blocks - num_blocks),\n+                      progress * 100),\n+              end ='')\n+\n+    def update(self, more: float):\n+        self.running += more\n+        self.set_progress(self.running / self.total)\n+\n+\n+def to_jsonable(obj: Any) -> Any:\n+    if hasattr(obj, \"__dict__\"):\n+        return obj.__dict__\n+    elif hasattr(obj, \"__slots__\"):\n+        ret = {}    # type: Any\n+        for slot in obj.__slots__:\n+            val = getattr(obj, slot, None)\n+            if slot in HASH_INTS and isinstance(val, int):\n+                ret[slot] = ser_uint256(val).hex()\n+            elif slot in HASH_INT_VECTORS and isinstance(val[0], int):\n+                ret[slot] = [ser_uint256(a).hex() for a in val]\n+            else:\n+                ret[slot] = to_jsonable(val)\n+        return ret\n+    elif isinstance(obj, list):\n+        return [to_jsonable(a) for a in obj]\n+    elif isinstance(obj, bytes):\n+        return obj.hex()\n+    else:\n+        return obj\n+\n+\n+def process_file(path: str, messages: List[Any], recv: bool, progress_bar: Optional[ProgressBar]) -> None:\n+    with open(path, 'rb') as f_in:\n+        if progress_bar:\n+            bytes_read = 0\n+\n+        while True:\n+            if progress_bar:\n+                # Update progress bar\n+                diff = f_in.tell() - bytes_read - 1\n+                progress_bar.update(diff)\n+                bytes_read = f_in.tell() - 1\n+            \n+            # Read the Header\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int\n+            msgtype = tmp_header.read(MSGTYPE_SIZE).split(b'\\x00', 1)[0]     # type: bytes\n+            length = int.from_bytes(tmp_header.read(LENGTH_SIZE), \"little\")  # type: int\n+\n+            # Determine message type\n+            if msgtype not in MESSAGEMAP:\n+                # For now just skip unrecognized messages\n+                f_in.seek(length, os.SEEK_CUR)\n+                print(f\"Skipping unrecognized message type {msgtype}\", file=sys.stderr)\n+                continue\n+            msg_ser = BytesIO(f_in.read(length))\n+            msg = MESSAGEMAP[msgtype]()\n+\n+            # Deserialize the message\n+            try:\n+                msg.deserialize(msg_ser)\n+            except KeyboardInterrupt:\n+                raise\n+            except Exception:\n+                # Message was bad, skip the rest of the file\n+                print(f\"Found broken message, skipping remainder of file: {path}\", file=sys.stderr)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562954055",
      "id" : 562954055,
      "in_reply_to_id" : 562284378,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mjk1NDA1NQ==",
      "original_commit_id" : "a17b2509e0d7e7e05fd5600d5387608bb706ac0e",
      "original_line" : 132,
      "original_position" : 132,
      "original_start_line" : null,
      "path" : "contrib/message-capture/message-capture-parser.py",
      "position" : null,
      "pull_request_review_id" : 574674065,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562954055",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562954574"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562954574"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You could still include the command name (if printable), and a hexdump of the payload.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-22T22:39:59Z",
      "diff_hunk" : "@@ -0,0 +1,198 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message capture binary files.  To be used in conjunction with -capturemessages.\"\"\"\n+\n+import argparse\n+import os\n+import shutil\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List, Optional\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.messages import ser_uint256     # noqa: E402\n+from test_framework.p2p import MESSAGEMAP           # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+# The test framework classes stores hashes as large ints in many cases.\n+# These are variables of type uint256 in core.\n+# There isn't a way to distinguish between a large int and a large int that is actually a blob of bytes.\n+# As such, they are itemized here.\n+# Any variables with these names that are of type int are actually uint256 variables.\n+# (These can be easily found by looking for calls to deser_uint256, deser_uint256_vector, and uint256_from_str in messages.py)\n+HASH_INTS = [\n+    \"blockhash\",\n+    \"block_hash\",\n+    \"hash\",\n+    \"hashMerkleRoot\",\n+    \"hashPrevBlock\",\n+    \"hashstop\",\n+    \"prev_header\",\n+    \"sha256\",\n+    \"stop_hash\",\n+]\n+\n+HASH_INT_VECTORS = [\n+    \"hashes\",\n+    \"headers\",\n+    \"vHave\",\n+    \"vHash\",\n+]\n+\n+\n+class ProgressBar:\n+    def __init__(self, total: float):\n+        self.total = total\n+        self.running = 0\n+\n+    def set_progress(self, progress: float):\n+        cols = shutil.get_terminal_size()[0]\n+        if cols <= 12:\n+            return\n+        max_blocks = cols - 9\n+        num_blocks = int(max_blocks * progress)\n+        print('\\r[ {}{} ] {:3.0f}%'\n+              .format('#' * num_blocks,\n+                      ' ' * (max_blocks - num_blocks),\n+                      progress * 100),\n+              end ='')\n+\n+    def update(self, more: float):\n+        self.running += more\n+        self.set_progress(self.running / self.total)\n+\n+\n+def to_jsonable(obj: Any) -> Any:\n+    if hasattr(obj, \"__dict__\"):\n+        return obj.__dict__\n+    elif hasattr(obj, \"__slots__\"):\n+        ret = {}    # type: Any\n+        for slot in obj.__slots__:\n+            val = getattr(obj, slot, None)\n+            if slot in HASH_INTS and isinstance(val, int):\n+                ret[slot] = ser_uint256(val).hex()\n+            elif slot in HASH_INT_VECTORS and isinstance(val[0], int):\n+                ret[slot] = [ser_uint256(a).hex() for a in val]\n+            else:\n+                ret[slot] = to_jsonable(val)\n+        return ret\n+    elif isinstance(obj, list):\n+        return [to_jsonable(a) for a in obj]\n+    elif isinstance(obj, bytes):\n+        return obj.hex()\n+    else:\n+        return obj\n+\n+\n+def process_file(path: str, messages: List[Any], recv: bool, progress_bar: Optional[ProgressBar]) -> None:\n+    with open(path, 'rb') as f_in:\n+        if progress_bar:\n+            bytes_read = 0\n+\n+        while True:\n+            if progress_bar:\n+                # Update progress bar\n+                diff = f_in.tell() - bytes_read - 1\n+                progress_bar.update(diff)\n+                bytes_read = f_in.tell() - 1\n+            \n+            # Read the Header\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            time = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int\n+            msgtype = tmp_header.read(MSGTYPE_SIZE).split(b'\\x00', 1)[0]     # type: bytes\n+            length = int.from_bytes(tmp_header.read(LENGTH_SIZE), \"little\")  # type: int\n+\n+            # Determine message type\n+            if msgtype not in MESSAGEMAP:\n+                # For now just skip unrecognized messages\n+                f_in.seek(length, os.SEEK_CUR)\n+                print(f\"Skipping unrecognized message type {msgtype}\", file=sys.stderr)\n+                continue\n+            msg_ser = BytesIO(f_in.read(length))\n+            msg = MESSAGEMAP[msgtype]()\n+\n+            # Deserialize the message\n+            try:\n+                msg.deserialize(msg_ser)\n+            except KeyboardInterrupt:\n+                raise\n+            except Exception:\n+                # Message was bad, skip the rest of the file\n+                print(f\"Found broken message, skipping remainder of file: {path}\", file=sys.stderr)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562954574",
      "id" : 562954574,
      "in_reply_to_id" : 562284378,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mjk1NDU3NA==",
      "original_commit_id" : "a17b2509e0d7e7e05fd5600d5387608bb706ac0e",
      "original_line" : 132,
      "original_position" : 132,
      "original_start_line" : null,
      "path" : "contrib/message-capture/message-capture-parser.py",
      "position" : null,
      "pull_request_review_id" : 574674710,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/562954574",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r563025936"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/563025936"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: Maybe add a small comment here that this function captures the message at process time, not socket receive/send time. Nothing fancy, just a oneline comment to sum up https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-765704796\r\n\r\nNot only to document the expected behavior, but also to avoid people to \"optimize\" away this call to `GetTime` with the rationale that it doesn't matter and the message receive time can be used. See also https://github.com/bitcoin/bitcoin/pull/19509#discussion_r457076718\r\n",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-23T06:17:14Z",
      "diff_hunk" : "@@ -2933,3 +2932,27 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void CaptureMessage(const CAddress& addr, const std::string& msg_type, const Span<const unsigned char>& data, bool is_incoming)\n+{\n+    auto now = GetTime<std::chrono::microseconds>();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r563025936",
      "id" : 563025936,
      "line" : 2942,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MzAyNTkzNg==",
      "original_commit_id" : "a17b2509e0d7e7e05fd5600d5387608bb706ac0e",
      "original_line" : 2942,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 44,
      "pull_request_review_id" : 574740233,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/563025936",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r563189778"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/563189778"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I agree that this is fragile, but I'm not sure exactly what you mean about removing them.  We don't really have a uint256 object in python.  Adding one would unfortunately mean rewriting a LOT of our testing framework...",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-23T19:27:52Z",
      "diff_hunk" : "@@ -0,0 +1,198 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Parse message capture binary files.  To be used in conjunction with -capturemessages.\"\"\"\n+\n+import argparse\n+import os\n+import shutil\n+import sys\n+from io import BytesIO\n+import json\n+from pathlib import Path\n+from typing import Any, List, Optional\n+\n+sys.path.append(os.path.join(os.path.dirname(__file__), '../../test/functional'))\n+\n+from test_framework.messages import ser_uint256     # noqa: E402\n+from test_framework.p2p import MESSAGEMAP           # noqa: E402\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+# The test framework classes stores hashes as large ints in many cases.\n+# These are variables of type uint256 in core.\n+# There isn't a way to distinguish between a large int and a large int that is actually a blob of bytes.\n+# As such, they are itemized here.\n+# Any variables with these names that are of type int are actually uint256 variables.\n+# (These can be easily found by looking for calls to deser_uint256, deser_uint256_vector, and uint256_from_str in messages.py)\n+HASH_INTS = [\n+    \"blockhash\",\n+    \"block_hash\",\n+    \"hash\",\n+    \"hashMerkleRoot\",\n+    \"hashPrevBlock\",\n+    \"hashstop\",\n+    \"prev_header\",\n+    \"sha256\",\n+    \"stop_hash\",\n+]\n+\n+HASH_INT_VECTORS = [\n+    \"hashes\",\n+    \"headers\",\n+    \"vHave\",\n+    \"vHash\",\n+]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r563189778",
      "id" : 563189778,
      "in_reply_to_id" : 562524979,
      "line" : 48,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MzE4OTc3OA==",
      "original_commit_id" : "a17b2509e0d7e7e05fd5600d5387608bb706ac0e",
      "original_line" : 48,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "contrib/message-capture/message-capture-parser.py",
      "position" : 48,
      "pull_request_review_id" : 574870616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/563189778",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r563190145"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/563190145"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ah, `remainder` is actually just the remainder of the 12 msgtype bytes after the first null.  In most cases it's just a few null bytes.  I added this in response to a suggestion to check that after the first null byte in the msgtype, all further bytes are null.\r\n\r\nEffectively these few lines should do the same job as CMessageHeader::IsCommandValid.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-23T19:32:04Z",
      "diff_hunk" : "@@ -0,0 +1,76 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test per-peer message capture capability.\n+\n+Additionally, the output of contrib/message-capture/message-capture-parser.py should be verified manually.\n+\"\"\"\n+\n+import glob\n+from io import BytesIO\n+import os\n+\n+from test_framework.p2p import P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+def mini_parser(dat_file):\n+    \"\"\"Parse a data file created by CaptureMessage.\n+\n+    From the data file we'll only check the structure.\n+\n+    We won't care about things like:\n+    - Deserializing the payload of the message\n+        - This is managed by the deserialize methods in test_framework.messages\n+    - The order of the messages\n+        - There's no reason why we can't, say, change the order of the messages in the handshake\n+    - Message Type\n+        - We can add new message types\n+\n+    We're ignoring these because they're simply too brittle to test here.\n+    \"\"\"\n+    with open(dat_file, 'rb') as f_in:\n+        # This should have at least one message in it\n+        assert(os.fstat(f_in.fileno()).st_size >= TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+        while True:\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            _ = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int\n+            raw_msgtype = tmp_header.read(MSGTYPE_SIZE)\n+            msgtype = raw_msgtype.split(b'\\x00', 1)[0]     # type: bytes\n+            remainder =  raw_msgtype.split(b'\\x00', 1)[1]\n+            assert(len(msgtype) > 0)\n+            assert(msgtype.decode().isprintable())\n+            assert(len(remainder) == 0 or not remainder.decode().isprintable())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r563190145",
      "id" : 563190145,
      "in_reply_to_id" : 562545025,
      "line" : 51,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MzE5MDE0NQ==",
      "original_commit_id" : "a17b2509e0d7e7e05fd5600d5387608bb706ac0e",
      "original_line" : 51,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "test/functional/p2p_message_capture.py",
      "position" : 51,
      "pull_request_review_id" : 574870881,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/563190145",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> is really nice to be able to have the messages in correct order without having to correlate timestamps from two different files to produce an \"ordered\" file covering the entire flow.\r\n\r\nThis is already done for you by the parser, just give it both files and the messages will be interleaved automatically in the output file.  If I'm understanding you correctly, the following should do what you're looking for:\r\n\r\n`./message-capture-parser.py <folder>/*.dat -o out.json`\r\n\r\nThat said...\r\n\r\n> I think there is an elegance to having exactly 1 file = 1 session.\r\n\r\nI agree completely, I'll figure this out!",
      "created_at" : "2021-01-23T19:50:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-766168963",
      "id" : 766168963,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2NjE2ODk2Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-23T19:50:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/766168963",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r563199123"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/563199123"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good idea, thanks",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-01-23T21:02:55Z",
      "diff_hunk" : "@@ -0,0 +1,76 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test per-peer message capture capability.\n+\n+Additionally, the output of contrib/message-capture/message-capture-parser.py should be verified manually.\n+\"\"\"\n+\n+import glob\n+from io import BytesIO\n+import os\n+\n+from test_framework.p2p import P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+def mini_parser(dat_file):\n+    \"\"\"Parse a data file created by CaptureMessage.\n+\n+    From the data file we'll only check the structure.\n+\n+    We won't care about things like:\n+    - Deserializing the payload of the message\n+        - This is managed by the deserialize methods in test_framework.messages\n+    - The order of the messages\n+        - There's no reason why we can't, say, change the order of the messages in the handshake\n+    - Message Type\n+        - We can add new message types\n+\n+    We're ignoring these because they're simply too brittle to test here.\n+    \"\"\"\n+    with open(dat_file, 'rb') as f_in:\n+        # This should have at least one message in it\n+        assert(os.fstat(f_in.fileno()).st_size >= TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+        while True:\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            _ = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int\n+            raw_msgtype = tmp_header.read(MSGTYPE_SIZE)\n+            msgtype = raw_msgtype.split(b'\\x00', 1)[0]     # type: bytes\n+            remainder =  raw_msgtype.split(b'\\x00', 1)[1]\n+            assert(len(msgtype) > 0)\n+            assert(msgtype.decode().isprintable())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r563199123",
      "id" : 563199123,
      "in_reply_to_id" : 562543791,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MzE5OTEyMw==",
      "original_commit_id" : "a17b2509e0d7e7e05fd5600d5387608bb706ac0e",
      "original_line" : 50,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "test/functional/p2p_message_capture.py",
      "position" : null,
      "pull_request_review_id" : 574876575,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-23T21:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/563199123",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`git range-diff master a17b250 bff7c66`\r\n\r\n* Message capture now more gracefully handles unrecognized and corrupted messages\r\n* Corrected typo in docs\r\n* Added comment to clarify how timestamps are being used here\r\n* A couple small improvements to the test\r\n\r\nThanks so much for the review everyone!\r\n\r\nUp soon: 1 file = 1 session",
      "created_at" : "2021-01-23T21:17:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-766180700",
      "id" : 766180700,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2NjE4MDcwMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-23T21:17:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/766180700",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-ACK bff7c66e67aa2f18ef70139338643656a54444fe only some minor changes: ð\r\n\r\n* doc fixups\r\n* append messages in the python parser even when the msg type is unknown or something can not be decoded\r\n\r\n<details><summary>Show signature and timestamp</summary>\r\n\r\nSignature:\r\n\r\n```\r\n-----BEGIN PGP SIGNED MESSAGE-----\r\nHash: SHA512\r\n\r\nre-ACK bff7c66e67aa2f18ef70139338643656a54444fe only some minor changes: ð\r\n\r\n* doc fixups\r\n* append messages in the python parser even when the msg type is unknown or something can not be decoded\r\n-----BEGIN PGP SIGNATURE-----\r\n\r\niQGzBAEBCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\r\npUhNwgwAsIB9TNhIdWgBLKYoNkJpnwXmAPbL/OAR3t+csB3wjowlJQMz9UijiMPN\r\nH/EzFMGiWMQoDgfxBMewFNXtBetGBzdQHHO9kGk7S0uulqj4S6Tg1WAWrfSOPhbI\r\ncSDuE8XSsPXq1qEpVS5NiVjsB5IJiVyER7LqSEnMp/iemdpgCIWfvxiJzaJNXbkj\r\nijCLQ3+2D7TX/e+N8iyHyIBnC/NbTGp8fzim7AoRf6O42NFWy7CVmM2aSu5qpW5B\r\n7nxTuWff66xBAnGwCEOLgfbm3G96ZgBqXGrBXCfL5GNIVTqNTDblX08cfoyMLqdv\r\nInGH+Qdz1ObG7tqY3TRq88U8Jgl+qm1N4Yi63lg2LISAL7r/qwAeQcyk/JiEsN8g\r\n8cCVCLkTd3BPKsHb4O+ItsfLCg4xkqSPogLML+FjNj1ppDKxo/rPPrdV7Ss04lbo\r\n5f4UbCSI9WMLMS+v2ZYSASW/4CXVXKF/bgAjzxv3VYK90+ITKnIoQcBjOZv5myGc\r\nZkcqkx7K\r\n=FpGK\r\n-----END PGP SIGNATURE-----\r\n```\r\n\r\n[Timestamp of file with hash `1aec4b471c3da64520ce75cb6750abae42d383f6093d1a0c1987e5b405b08997  -`](https://opentimestamps.org/info/?004f70656e54696d657374616d7073000050726f6f6600bf89e2e884e8929401081aec4b471c3da64520ce75cb6750abae42d383f6093d1a0c1987e5b405b08997f010ed000fb79e3d9792bd83c75276e67d8708fff0101c3c1b7447a654e253bfe4b2b388c24e08f120d1288561989a73084e325bdb543c21a177385af3181a39879ec230f60bbc0bad08f120259ceb048188758f76b2c4b7fced24fcc98738e8288077674740753e19e2bbd508f12011f25703e0326583336d7b54b5c464a9917eff8e853063c4cb29293ca85a6ff208f0208637c16b579b03823fd6b7236145c46b094f975b3c3c46fd1b03b9f73616fb1208f104600d5696f008c0ea01cc92b5d2c90083dfe30d2ef90c8e2e2d68747470733a2f2f616c6963652e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267fff0102f2b788d3ea97cdb8706c87025ef0beb08f120702532fc23145888a6f56e6c8855ecf11c939ad3a034f6333794ee5ddbc2dc0a08f120d3646ca389c547021f2b16e64edc6482502b9a7f55619d1326fc4197044e2acd08f104600d5696f008c5fe007d3c3c26fc0083dfe30d2ef90c8e2c2b68747470733a2f2f626f622e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267fff010d1456c29591f5bc44feae85438b6919f08f12095b5290ec43303fb8dac959291d477aefbebf57895a4f7afb51fa470cf223f0708f120f1c6d1d13d2c85fdccb106ad0a8e99c410019f9b76d96c69f3f6568981303b6208f0205ceddbf8b6c368f8438d1fa4d940938a6329b91bc43b5ce72ecc0d38fa186f8208f0206998052fe4ee5728b2e1385b9a9768b29746b270365e53712a2dbbb84d11c4be08f104600d5697f008ad27a1136a65e70a0083dfe30d2ef90c8e292868747470733a2f2f66696e6e65792e63616c656e6461722e657465726e69747977616c6c2e636f6df010e3b9c1408ea89f8d06096c5240f8e72f08f104600d5696f00822b449ea9c4f6fb60083dfe30d2ef90c8e232268747470733a2f2f6274632e63616c656e6461722e636174616c6c6178792e636f6d)\r\n\r\n</details>\r\n",
      "created_at" : "2021-01-24T11:14:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-766330486",
      "id" : 766330486,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2NjMzMDQ4Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-24T11:14:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/766330486",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Still need to do **a lot** of playing around with this. Interested if you have given any thought @troygiorshev on what questions this tool can easily answer (without additional digging) and what is possible for future improvements/future PRs. Don't want to derail review of this PR though so set up a StackExchange [question](https://bitcoin.stackexchange.com/questions/101799/how-can-i-obtain-a-better-understanding-of-the-p2p-messages-between-my-full-node).",
      "created_at" : "2021-01-24T14:01:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-766352948",
      "id" : 766352948,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2NjM1Mjk0OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-24T14:01:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/766352948",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/16323900?v=4",
         "events_url" : "https://api.github.com/users/michaelfolkson/events{/privacy}",
         "followers_url" : "https://api.github.com/users/michaelfolkson/followers",
         "following_url" : "https://api.github.com/users/michaelfolkson/following{/other_user}",
         "gists_url" : "https://api.github.com/users/michaelfolkson/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/michaelfolkson",
         "id" : 16323900,
         "login" : "michaelfolkson",
         "node_id" : "MDQ6VXNlcjE2MzIzOTAw",
         "organizations_url" : "https://api.github.com/users/michaelfolkson/orgs",
         "received_events_url" : "https://api.github.com/users/michaelfolkson/received_events",
         "repos_url" : "https://api.github.com/users/michaelfolkson/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/michaelfolkson/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/michaelfolkson/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/michaelfolkson"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The nit here can be addressed, once you have to rebase: https://github.com/bitcoin/bitcoin/pull/19509#discussion_r562515326",
      "created_at" : "2021-02-02T10:18:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-771530227",
      "id" : 771530227,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3MTUzMDIyNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-02T10:18:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/771530227",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Up soon: 1 file = 1 session\r\n\r\n@troygiorshev Are you still planning to do this? ",
      "created_at" : "2021-02-02T11:35:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-771574041",
      "id" : 771574041,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3MTU3NDA0MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-02T11:35:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/771574041",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK bff7c66e67aa2f18ef70139338643656a54444fe\r\n\r\nThis isn't part of the public interface, so the file layout can be changed in a follow-up.",
      "created_at" : "2021-02-02T12:01:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-771587318",
      "id" : 771587318,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3MTU4NzMxOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-02T12:01:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/771587318",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r568553627"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/568553627"
         }
      },
      "author_association" : "MEMBER",
      "body" : "should probably just check that all are zero",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-02-02T12:12:58Z",
      "diff_hunk" : "@@ -0,0 +1,76 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test per-peer message capture capability.\n+\n+Additionally, the output of contrib/message-capture/message-capture-parser.py should be verified manually.\n+\"\"\"\n+\n+import glob\n+from io import BytesIO\n+import os\n+\n+from test_framework.p2p import P2PDataStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+def mini_parser(dat_file):\n+    \"\"\"Parse a data file created by CaptureMessage.\n+\n+    From the data file we'll only check the structure.\n+\n+    We won't care about things like:\n+    - Deserializing the payload of the message\n+        - This is managed by the deserialize methods in test_framework.messages\n+    - The order of the messages\n+        - There's no reason why we can't, say, change the order of the messages in the handshake\n+    - Message Type\n+        - We can add new message types\n+\n+    We're ignoring these because they're simply too brittle to test here.\n+    \"\"\"\n+    with open(dat_file, 'rb') as f_in:\n+        # This should have at least one message in it\n+        assert(os.fstat(f_in.fileno()).st_size >= TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+        while True:\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            _ = int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int\n+            raw_msgtype = tmp_header.read(MSGTYPE_SIZE)\n+            msgtype = raw_msgtype.split(b'\\x00', 1)[0]     # type: bytes\n+            remainder =  raw_msgtype.split(b'\\x00', 1)[1]\n+            assert(len(msgtype) > 0)\n+            assert(msgtype.decode().isprintable())\n+            assert(len(remainder) == 0 or not remainder.decode().isprintable())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r568553627",
      "id" : 568553627,
      "in_reply_to_id" : 562545025,
      "line" : 51,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2ODU1MzYyNw==",
      "original_commit_id" : "a17b2509e0d7e7e05fd5600d5387608bb706ac0e",
      "original_line" : 51,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "test/functional/p2p_message_capture.py",
      "position" : 51,
      "pull_request_review_id" : 581279397,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-02T12:12:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/568553627",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r571454691"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/571454691"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Not sure if this is the right place to ask, but when I'm running `vulture` against this file, it complains:\r\n\r\n```\r\nbitcoin/test/functional/p2p_message_capture.py:45: invalid syntax at \"int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int\"\r\n```\r\n\r\nIs that a bug in `vulture` or a problem in the code? If I assign the return value of `from_bytes` to a variable, it passes",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-02-06T16:26:49Z",
      "diff_hunk" : "@@ -0,0 +1,76 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test per-peer message capture capability.\n+\n+Additionally, the output of contrib/message-capture/message-capture-parser.py should be verified manually.\n+\"\"\"\n+\n+import glob\n+from io import BytesIO\n+import os\n+\n+from test_framework.p2p import P2PDataStore, MESSAGEMAP\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+def mini_parser(dat_file):\n+    \"\"\"Parse a data file created by CaptureMessage.\n+\n+    From the data file we'll only check the structure.\n+\n+    We won't care about things like:\n+    - Deserializing the payload of the message\n+        - This is managed by the deserialize methods in test_framework.messages\n+    - The order of the messages\n+        - There's no reason why we can't, say, change the order of the messages in the handshake\n+    - Message Type\n+        - We can add new message types\n+\n+    We're ignoring these because they're simply too brittle to test here.\n+    \"\"\"\n+    with open(dat_file, 'rb') as f_in:\n+        # This should have at least one message in it\n+        assert(os.fstat(f_in.fileno()).st_size >= TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+        while True:\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r571454691",
      "id" : 571454691,
      "line" : 45,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTQ1NDY5MQ==",
      "original_commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "original_line" : 45,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "test/functional/p2p_message_capture.py",
      "position" : 45,
      "pull_request_review_id" : 584895703,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T16:26:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/571454691",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/425166?v=4",
         "events_url" : "https://api.github.com/users/flack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/flack/followers",
         "following_url" : "https://api.github.com/users/flack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/flack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/flack",
         "id" : 425166,
         "login" : "flack",
         "node_id" : "MDQ6VXNlcjQyNTE2Ng==",
         "organizations_url" : "https://api.github.com/users/flack/orgs",
         "received_events_url" : "https://api.github.com/users/flack/received_events",
         "repos_url" : "https://api.github.com/users/flack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/flack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/flack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/flack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r571512679"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/571512679"
         }
      },
      "author_association" : "NONE",
      "body" : "I think it is a problem in the code. The return value of `from_bytes` is not being used.",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-02-07T01:19:40Z",
      "diff_hunk" : "@@ -0,0 +1,76 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test per-peer message capture capability.\n+\n+Additionally, the output of contrib/message-capture/message-capture-parser.py should be verified manually.\n+\"\"\"\n+\n+import glob\n+from io import BytesIO\n+import os\n+\n+from test_framework.p2p import P2PDataStore, MESSAGEMAP\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+def mini_parser(dat_file):\n+    \"\"\"Parse a data file created by CaptureMessage.\n+\n+    From the data file we'll only check the structure.\n+\n+    We won't care about things like:\n+    - Deserializing the payload of the message\n+        - This is managed by the deserialize methods in test_framework.messages\n+    - The order of the messages\n+        - There's no reason why we can't, say, change the order of the messages in the handshake\n+    - Message Type\n+        - We can add new message types\n+\n+    We're ignoring these because they're simply too brittle to test here.\n+    \"\"\"\n+    with open(dat_file, 'rb') as f_in:\n+        # This should have at least one message in it\n+        assert(os.fstat(f_in.fileno()).st_size >= TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+        while True:\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r571512679",
      "id" : 571512679,
      "in_reply_to_id" : 571454691,
      "line" : 45,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTUxMjY3OQ==",
      "original_commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "original_line" : 45,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "test/functional/p2p_message_capture.py",
      "position" : 45,
      "pull_request_review_id" : 584931312,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-07T01:19:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/571512679",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r571674446"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/571674446"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I guess the fix is:\r\n\r\n```diff\r\n-            int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int\r\n+            tmp_header.read(TIME_SIZE)  # skip over the timestamp field\r\n```\r\n",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-02-07T19:25:52Z",
      "diff_hunk" : "@@ -0,0 +1,76 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test per-peer message capture capability.\n+\n+Additionally, the output of contrib/message-capture/message-capture-parser.py should be verified manually.\n+\"\"\"\n+\n+import glob\n+from io import BytesIO\n+import os\n+\n+from test_framework.p2p import P2PDataStore, MESSAGEMAP\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+def mini_parser(dat_file):\n+    \"\"\"Parse a data file created by CaptureMessage.\n+\n+    From the data file we'll only check the structure.\n+\n+    We won't care about things like:\n+    - Deserializing the payload of the message\n+        - This is managed by the deserialize methods in test_framework.messages\n+    - The order of the messages\n+        - There's no reason why we can't, say, change the order of the messages in the handshake\n+    - Message Type\n+        - We can add new message types\n+\n+    We're ignoring these because they're simply too brittle to test here.\n+    \"\"\"\n+    with open(dat_file, 'rb') as f_in:\n+        # This should have at least one message in it\n+        assert(os.fstat(f_in.fileno()).st_size >= TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+        while True:\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r571674446",
      "id" : 571674446,
      "in_reply_to_id" : 571454691,
      "line" : 45,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTY3NDQ0Ng==",
      "original_commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "original_line" : 45,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "test/functional/p2p_message_capture.py",
      "position" : 45,
      "pull_request_review_id" : 585059577,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-07T19:25:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/571674446",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r571822986"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/571822986"
         }
      },
      "author_association" : "MEMBER",
      "body" : "#21107 ",
      "commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "created_at" : "2021-02-08T07:17:22Z",
      "diff_hunk" : "@@ -0,0 +1,76 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test per-peer message capture capability.\n+\n+Additionally, the output of contrib/message-capture/message-capture-parser.py should be verified manually.\n+\"\"\"\n+\n+import glob\n+from io import BytesIO\n+import os\n+\n+from test_framework.p2p import P2PDataStore, MESSAGEMAP\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+TIME_SIZE = 8\n+LENGTH_SIZE = 4\n+MSGTYPE_SIZE = 12\n+\n+def mini_parser(dat_file):\n+    \"\"\"Parse a data file created by CaptureMessage.\n+\n+    From the data file we'll only check the structure.\n+\n+    We won't care about things like:\n+    - Deserializing the payload of the message\n+        - This is managed by the deserialize methods in test_framework.messages\n+    - The order of the messages\n+        - There's no reason why we can't, say, change the order of the messages in the handshake\n+    - Message Type\n+        - We can add new message types\n+\n+    We're ignoring these because they're simply too brittle to test here.\n+    \"\"\"\n+    with open(dat_file, 'rb') as f_in:\n+        # This should have at least one message in it\n+        assert(os.fstat(f_in.fileno()).st_size >= TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+        while True:\n+            tmp_header_raw = f_in.read(TIME_SIZE + LENGTH_SIZE + MSGTYPE_SIZE)\n+            if not tmp_header_raw:\n+                break\n+            tmp_header = BytesIO(tmp_header_raw)\n+            int.from_bytes(tmp_header.read(TIME_SIZE), \"little\")      # type: int",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#discussion_r571822986",
      "id" : 571822986,
      "in_reply_to_id" : 571454691,
      "line" : 45,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTgyMjk4Ng==",
      "original_commit_id" : "bff7c66e67aa2f18ef70139338643656a54444fe",
      "original_line" : 45,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "test/functional/p2p_message_capture.py",
      "position" : 45,
      "pull_request_review_id" : 585210151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19509",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-08T07:17:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/571822986",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I ran the message-capture-parser.py and received the following error:\r\n\r\n```\r\nError:\r\nTraceback (most recent call last):\r\n  File \"./message-capture-parser.py\", line 214, in <module>\r\n    main()\r\n  File \"./message-capture-parser.py\", line 199, in main\r\n    process_file(str(capture), messages, \"recv\" in capture.stem, progress_bar)\r\n  File \"./message-capture-parser.py\", line 159, in process_file\r\n    msg_dict[\"body\"] = to_jsonable(msg)\r\n  File \"./message-capture-parser.py\", line 82, in to_jsonable\r\n    elif slot in HASH_INT_VECTORS and isinstance(val[0], int):\r\nIndexError: list index out of range\r\n```\r\n\r\nSo I changed the line 82\r\n`elif slot in HASH_INT_VECTORS and isinstance(val[0], int):`\r\nto\r\n`elif isinstance(val, list) and len(val) > 0 and slot in HASH_INT_VECTORS and isinstance(val[0], int):`\r\n\r\nThe script worked after this change.\r\n\r\nThe reason of the error is the _val_ variable had the value [] and when accessing _val[0]_ the script crashed.\r\nThe error happened with following values for the msgtype and for the type of the obj variable (in to_jsonable() function):\r\n\r\n```\r\nmsgtype: 'tx'       - obj type: <class 'test_framework.messages.CTxWitness'> \r\nmsgtype: 'headers'  - obj type: <class 'test_framework.messages.msg_headers'>,\r\nmsgtype: 'blocktxn' - obj type: <class 'test_framework.messages.CTxWitness'> \r\nmsgtype: 'block'    - obj type: <class 'test_framework.messages.CTxWitness'>\r\n```\r\n\r\nI tested it on Ubuntu 20.04 on VMWare.\r\nThe command used was `./message-capture-parser.py -o out2.json ~/.bitcoin/message_capture/**/*.dat`\r\n",
      "created_at" : "2021-02-10T07:21:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-776502093",
      "id" : 776502093,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3NjUwMjA5Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-10T19:58:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/776502093",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2694753?v=4",
         "events_url" : "https://api.github.com/users/leonardojobim/events{/privacy}",
         "followers_url" : "https://api.github.com/users/leonardojobim/followers",
         "following_url" : "https://api.github.com/users/leonardojobim/following{/other_user}",
         "gists_url" : "https://api.github.com/users/leonardojobim/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/leonardojobim",
         "id" : 2694753,
         "login" : "leonardojobim",
         "node_id" : "MDQ6VXNlcjI2OTQ3NTM=",
         "organizations_url" : "https://api.github.com/users/leonardojobim/orgs",
         "received_events_url" : "https://api.github.com/users/leonardojobim/received_events",
         "repos_url" : "https://api.github.com/users/leonardojobim/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/leonardojobim/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/leonardojobim/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/leonardojobim"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Nice find @leonardojobim! You could also test for the list's non-emptiness by checking its booleanness, which is maybe more pythonic:\r\n\r\n```python\r\nelif isinstance(val, list) and val and slot in HASH_INT_VECTORS and isinstance(val[0], int):\r\n```\r\n\r\nDo you mind opening a PR for this?",
      "created_at" : "2021-02-18T10:42:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-781252090",
      "id" : 781252090,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19509",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc4MTI1MjA5MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-18T10:42:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/781252090",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   }
]
