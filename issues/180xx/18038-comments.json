[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #18807 ([WIP] unbroadcast follow-ups by amitiuttarwar)\n* #18781 (Add templated GetRandDuration<> by MarcoFalke)\n* #18764 (refactor: test: replace inv type magic numbers by constants by theStack)\n* #18446 (test: Add test for wtxid transaction relay by fjahr)\n* #18261 (Erlay: bandwidth-efficient transaction relay protocol by naumenkogs)\n* #18044 (Use wtxid for transaction relay by sdaftuar)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-01-31T08:39:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-580639076",
      "id" : 580639076,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MDYzOTA3Ng==",
      "updated_at" : "2020-04-29T05:04:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/580639076",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2020-02-18T02:53:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-587249206",
      "id" : 587249206,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4NzI0OTIwNg==",
      "updated_at" : "2020-02-18T02:53:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/587249206",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "travis failure seems unrelated- `feature_fee_estimation.py` ",
      "created_at" : "2020-02-27T20:14:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-592155950",
      "id" : 592155950,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MjE1NTk1MA==",
      "updated_at" : "2020-02-27T20:14:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/592155950",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "It could be a crash, because node1 stops to log anything at all",
      "created_at" : "2020-02-27T20:43:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-592167518",
      "id" : 592167518,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MjE2NzUxOA==",
      "updated_at" : "2020-02-27T20:43:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/592167518",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r385368573"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385368573"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why is this not saved to disk? It seems that on restart this set is cleared regardless of whether the tx was sent out.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-02-27T21:00:46Z",
      "diff_hunk" : "@@ -534,6 +534,10 @@ class CTxMemPool\n     const setEntries & GetMemPoolParents(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n     const setEntries & GetMemPoolChildren(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n     uint64_t CalculateDescendantMaximum(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n+\n+    // track locally submitted transactions & periodically retry initial broadcast\n+    std::set<uint256> m_unbroadcast_txids;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r385368573",
      "id" : 385368573,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM2ODU3Mw==",
      "original_commit_id" : "66ddec88f59b32928495767daa548dc41558d56c",
      "original_line" : 539,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 365993014,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385368573",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r385795095"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385795095"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The comment is incorrect, since a tx is *not* removed when it is not sent, e.g. because it was not found.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-02-28T16:31:36Z",
      "diff_hunk" : "@@ -1590,6 +1590,11 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n             if (mi != mapRelay.end()) {\n                 connman->PushMessage(pfrom, msgMaker.Make(nSendFlags, NetMsgType::TX, *mi->second));\n                 push = true;\n+                // Once a peer requests GETDATA for a txn, we deem initial broadcast a success",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r385795095",
      "id" : 385795095,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc5NTA5NQ==",
      "original_commit_id" : "66ec5571ad49b68366e4607cf0b671231083757e",
      "original_line" : 1593,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 365993014,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385795095",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r385795542"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385795542"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why is the tx not removed when it was initially sent out after 15 minutes, e.g. when it was removed from mapRelay and then relayed from the mempool.\r\n\r\nI think this code should go down into the `if(push)` branch",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-02-28T16:32:32Z",
      "diff_hunk" : "@@ -1590,6 +1590,11 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n             if (mi != mapRelay.end()) {\n                 connman->PushMessage(pfrom, msgMaker.Make(nSendFlags, NetMsgType::TX, *mi->second));\n                 push = true;\n+                // Once a peer requests GETDATA for a txn, we deem initial broadcast a success\n+                int num = mempool.m_unbroadcast_txids.erase(inv.hash);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r385795542",
      "id" : 385795542,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc5NTU0Mg==",
      "original_commit_id" : "66ec5571ad49b68366e4607cf0b671231083757e",
      "original_line" : 1594,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 365993014,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385795542",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r385795926"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385795926"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        LogPrint(BCLog::NET, \"Removed %i from m_unbroadcast_txids before tx was sent out. \\n\", hash.GetHex());\r\n```",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-02-28T16:33:19Z",
      "diff_hunk" : "@@ -416,6 +416,10 @@ void CTxMemPool::removeUnchecked(txiter it, MemPoolRemovalReason reason)\n     for (const CTxIn& txin : it->GetTx().vin)\n         mapNextTx.erase(txin.prevout);\n \n+    if (mempool.m_unbroadcast_txids.erase(hash)) {\n+        LogPrint(BCLog::NET, \"Removed %i from m_unbroadcast_txids before GETDATA was received. \\n\", hash.GetHex());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r385795926",
      "id" : 385795926,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc5NTkyNg==",
      "original_commit_id" : "66ec5571ad49b68366e4607cf0b671231083757e",
      "original_line" : 420,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 365993014,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385795926",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r385798846"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385798846"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    scheduler.scheduleEvery([]{this->AttemptInitialBroadcast();}, REATTEMPT_BROADCAST_INTERVAL.count() );\r\n```\r\n\r\n",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-02-28T16:38:26Z",
      "diff_hunk" : "@@ -2332,6 +2332,9 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n     // Dump network addresses\n     scheduler.scheduleEvery(std::bind(&CConnman::DumpAddresses, this), DUMP_PEERS_INTERVAL * 1000);\n \n+    // Attempt to broadcast transactions that have not yet been acknowledged by the network\n+    scheduler.scheduleEvery(std::bind(&CConnman::AttemptInitialBroadcast, this), REATTEMPT_BROADCAST_INTERVAL.count() );",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r385798846",
      "id" : 385798846,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc5ODg0Ng==",
      "original_commit_id" : "1a1a30cc4adbbcccfbb073fbf8ae9df1090a2996",
      "original_line" : 2336,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 366530279,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385798846",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r385818114"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385818114"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "great point. originally I was thinking of doing as a follow up PR (see [here](https://gist.github.com/amitiuttarwar/b592ee410e1f02ac0d44fcbed4621dba#follow-up-prs)), but now that this unbroadcast logic is broken out into its own PR I agree it makes sense here. I'll implement.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-02-28T17:15:38Z",
      "diff_hunk" : "@@ -534,6 +534,10 @@ class CTxMemPool\n     const setEntries & GetMemPoolParents(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n     const setEntries & GetMemPoolChildren(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n     uint64_t CalculateDescendantMaximum(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n+\n+    // track locally submitted transactions & periodically retry initial broadcast\n+    std::set<uint256> m_unbroadcast_txids;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r385818114",
      "id" : 385818114,
      "in_reply_to_id" : 385368573,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTgxODExNA==",
      "original_commit_id" : "66ddec88f59b32928495767daa548dc41558d56c",
      "original_line" : 539,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 366556224,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385818114",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r385860440"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385860440"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is not frequency 1/day (as the PR post says). It's a value between 0 and 24 hours, with an average of 12 hours. You probably want to do 12*60*60 + GetRand(12*60*60) or something like that?",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-02-28T18:44:44Z",
      "diff_hunk" : "@@ -1982,7 +1982,7 @@ void CWallet::ResendWalletTransactions()\n     // that these are our transactions.\n     if (GetTime() < nNextResend || !fBroadcastTransactions) return;\n     bool fFirst = (nNextResend == 0);\n-    nNextResend = GetTime() + GetRand(30 * 60);\n+    nNextResend = GetTime() + GetRand(24 * 60 * 60);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r385860440",
      "id" : 385860440,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTg2MDQ0MA==",
      "original_commit_id" : "66ddec88f59b32928495767daa548dc41558d56c",
      "original_line" : 1985,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 366607338,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385860440",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r385865086"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385865086"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "How do you know that it won't be rejected due to \"filterInventoryKnown\"?\r\nWhat is the rationale here?",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-02-28T18:54:54Z",
      "diff_hunk" : "@@ -780,6 +780,14 @@ void PeerLogicValidation::InitializeNode(CNode *pnode) {\n         PushNodeVersion(pnode, connman, GetTime());\n }\n \n+void PeerLogicValidation::QueueUnbroadcastTxs(CNode* pnode)\n+{\n+    for(const uint256& txid : mempool.m_unbroadcast_txids){\n+        CInv inv(MSG_TX, txid);\n+        pnode->PushInventory(inv);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r385865086",
      "id" : 385865086,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTg2NTA4Ng==",
      "original_commit_id" : "66ddec88f59b32928495767daa548dc41558d56c",
      "original_line" : 795,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 366607338,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385865086",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r386613286"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386613286"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It might. Which upholds the same guarantees as the previous logic it's replacing.\r\n\r\nOn current master, wallet transactions get rebroadcast through a scheduler flow that makes its way to `ResendWalletTransactions`, which selects transactions to rebroadcast then invokes `SubmitMemoryPoolAndRelay`. This goes to `BroadcastTransaction`, which checks ATMP then relays via `RelayTransaction`, which uses the `CNode#PushInventory` function that only adds the hash if its not contained in `filterInventoryKnown`. \r\n\r\nThis PR changes the initial parts of the flow... so `BroadcastTransaction` adds the transaction to `mempool.m_unbroadcast_txids`, then there is a scheduled job to periodically `AttemptInitialBroadcast`, but the behavior is matched where the locally-submitted transactions would be reattempted to send to the network, filtered for the connections that were already tried, and sent out to new connections.\r\n\r\nChanging that behavior could be desirable for robustness but of course reduces privacy. So out of scope for this PR. If you think it may be desirable, I'd be happy to think it through / talk about it more, we can open a new issue. (I'm working on the assumption that current delivery guarantees are sufficient). ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-02T19:50:48Z",
      "diff_hunk" : "@@ -780,6 +780,14 @@ void PeerLogicValidation::InitializeNode(CNode *pnode) {\n         PushNodeVersion(pnode, connman, GetTime());\n }\n \n+void PeerLogicValidation::QueueUnbroadcastTxs(CNode* pnode)\n+{\n+    for(const uint256& txid : mempool.m_unbroadcast_txids){\n+        CInv inv(MSG_TX, txid);\n+        pnode->PushInventory(inv);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r386613286",
      "id" : 386613286,
      "in_reply_to_id" : 385865086,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYxMzI4Ng==",
      "original_commit_id" : "66ddec88f59b32928495767daa548dc41558d56c",
      "original_line" : 795,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 367480404,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386613286",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r386732669"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386732669"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`12*60*60 + GetRand(12*60*60)` would get an average of 24 hours with a range of 12-36",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-03T00:27:53Z",
      "diff_hunk" : "@@ -1982,7 +1982,7 @@ void CWallet::ResendWalletTransactions()\n     // that these are our transactions.\n     if (GetTime() < nNextResend || !fBroadcastTransactions) return;\n     bool fFirst = (nNextResend == 0);\n-    nNextResend = GetTime() + GetRand(30 * 60);\n+    nNextResend = GetTime() + GetRand(24 * 60 * 60);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r386732669",
      "id" : 386732669,
      "in_reply_to_id" : 385860440,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjczMjY2OQ==",
      "original_commit_id" : "66ddec88f59b32928495767daa548dc41558d56c",
      "original_line" : 1985,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 367627078,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386732669",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r386781925"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386781925"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "you are right, this is a mistake. thanks ðð½",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-03T03:33:35Z",
      "diff_hunk" : "@@ -1590,6 +1590,11 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n             if (mi != mapRelay.end()) {\n                 connman->PushMessage(pfrom, msgMaker.Make(nSendFlags, NetMsgType::TX, *mi->second));\n                 push = true;\n+                // Once a peer requests GETDATA for a txn, we deem initial broadcast a success\n+                int num = mempool.m_unbroadcast_txids.erase(inv.hash);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r386781925",
      "id" : 386781925,
      "in_reply_to_id" : 385795542,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njc4MTkyNQ==",
      "original_commit_id" : "66ec5571ad49b68366e4607cf0b671231083757e",
      "original_line" : 1594,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 367683008,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386781925",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r387124518"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387124518"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "@ajtowns yeah, that's what would be closer to 1/day, right? Not sure what you meant to say.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-03T16:07:11Z",
      "diff_hunk" : "@@ -1982,7 +1982,7 @@ void CWallet::ResendWalletTransactions()\n     // that these are our transactions.\n     if (GetTime() < nNextResend || !fBroadcastTransactions) return;\n     bool fFirst = (nNextResend == 0);\n-    nNextResend = GetTime() + GetRand(30 * 60);\n+    nNextResend = GetTime() + GetRand(24 * 60 * 60);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r387124518",
      "id" : 387124518,
      "in_reply_to_id" : 385860440,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzEyNDUxOA==",
      "original_commit_id" : "66ddec88f59b32928495767daa548dc41558d56c",
      "original_line" : 1985,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 368110911,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387124518",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r387131829"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387131829"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ah I see. Just want to be clear that if the network is not really used, the bloom filter doesn't roll and transaction may be not rebroadcast in days.\r\nIf that's what you have in mind when designing the whole thing, let's just leave a comment that this can happen.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-03T16:17:25Z",
      "diff_hunk" : "@@ -780,6 +780,14 @@ void PeerLogicValidation::InitializeNode(CNode *pnode) {\n         PushNodeVersion(pnode, connman, GetTime());\n }\n \n+void PeerLogicValidation::QueueUnbroadcastTxs(CNode* pnode)\n+{\n+    for(const uint256& txid : mempool.m_unbroadcast_txids){\n+        CInv inv(MSG_TX, txid);\n+        pnode->PushInventory(inv);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r387131829",
      "id" : 387131829,
      "in_reply_to_id" : 385865086,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzEzMTgyOQ==",
      "original_commit_id" : "66ddec88f59b32928495767daa548dc41558d56c",
      "original_line" : 795,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 368120220,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387131829",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r387426782"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387426782"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Oh my god. `12*60*60 + GetRand(24*60*60)` was what I was trying to type; min of 12h, max of 36h, average of 24h.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-04T03:08:30Z",
      "diff_hunk" : "@@ -1982,7 +1982,7 @@ void CWallet::ResendWalletTransactions()\n     // that these are our transactions.\n     if (GetTime() < nNextResend || !fBroadcastTransactions) return;\n     bool fFirst = (nNextResend == 0);\n-    nNextResend = GetTime() + GetRand(30 * 60);\n+    nNextResend = GetTime() + GetRand(24 * 60 * 60);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r387426782",
      "id" : 387426782,
      "in_reply_to_id" : 385860440,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQyNjc4Mg==",
      "original_commit_id" : "66ddec88f59b32928495767daa548dc41558d56c",
      "original_line" : 1985,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 368478382,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387426782",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r387431128"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387431128"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The `filterInventoryKnown` is per-peer though, so it just won't be rebroadcast to a peer that already knew about it somehow; but it'll stay in the unbroadcast set and be retried for other peers until a getdata actually makes its way through (or until it gets dropped from the mempool)? If all of your peers ignore your INV and don't request a GETDATA, you'll not send more INVs until you find a new peer, but... even if you did, those peers would probably still not send a GETDATA anyway, so what else would you do?",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-04T03:28:20Z",
      "diff_hunk" : "@@ -780,6 +780,14 @@ void PeerLogicValidation::InitializeNode(CNode *pnode) {\n         PushNodeVersion(pnode, connman, GetTime());\n }\n \n+void PeerLogicValidation::QueueUnbroadcastTxs(CNode* pnode)\n+{\n+    for(const uint256& txid : mempool.m_unbroadcast_txids){\n+        CInv inv(MSG_TX, txid);\n+        pnode->PushInventory(inv);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r387431128",
      "id" : 387431128,
      "in_reply_to_id" : 385865086,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQzMTEyOA==",
      "original_commit_id" : "66ddec88f59b32928495767daa548dc41558d56c",
      "original_line" : 795,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 368483385,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387431128",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r387431682"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387431682"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`m_unbroadcast_txids` declaration is missing the `GUARDED_BY(cs)` thread safety annotation, and I think the errors adding that turns up indicates there's more locking needed which probably explains the node segfaulting in travis.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-04T03:30:54Z",
      "diff_hunk" : "@@ -534,6 +534,10 @@ class CTxMemPool\n     const setEntries & GetMemPoolParents(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n     const setEntries & GetMemPoolChildren(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n     uint64_t CalculateDescendantMaximum(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n+\n+    // track locally submitted transactions & periodically retry initial broadcast\n+    std::set<uint256> m_unbroadcast_txids;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r387431682",
      "id" : 387431682,
      "in_reply_to_id" : 385368573,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQzMTY4Mg==",
      "original_commit_id" : "66ddec88f59b32928495767daa548dc41558d56c",
      "original_line" : 539,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 368484015,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387431682",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r387662775"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387662775"
         }
      },
      "author_association" : "MEMBER",
      "body" : "While I couldn't come up with a privacy-leaking attack based on this being a constant, I'd still suggest to make the delay random to avoid network-wide synchronized events that don't need to be synchronized",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-04T13:24:02Z",
      "diff_hunk" : "@@ -48,6 +48,9 @@ static_assert(MINIUPNPC_API_VERSION >= 10, \"miniUPnPc API version >= 10 assumed\"\n // Dump addresses to peers.dat every 15 minutes (900s)\n static constexpr int DUMP_PEERS_INTERVAL = 15 * 60;\n \n+// Attempt initial broadcast of locally submitted txns every 10 minutes.\n+static constexpr std::chrono::milliseconds REATTEMPT_BROADCAST_INTERVAL = std::chrono::milliseconds(10 * 60 * 1000);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r387662775",
      "id" : 387662775,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzY2Mjc3NQ==",
      "original_commit_id" : "66ddec88f59b32928495767daa548dc41558d56c",
      "original_line" : 52,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 366530279,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387662775",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r387705673"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387705673"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Agree, I think we should do what you just suggested.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-04T14:35:45Z",
      "diff_hunk" : "@@ -1982,7 +1982,7 @@ void CWallet::ResendWalletTransactions()\n     // that these are our transactions.\n     if (GetTime() < nNextResend || !fBroadcastTransactions) return;\n     bool fFirst = (nNextResend == 0);\n-    nNextResend = GetTime() + GetRand(30 * 60);\n+    nNextResend = GetTime() + GetRand(24 * 60 * 60);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r387705673",
      "id" : 387705673,
      "in_reply_to_id" : 385860440,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzcwNTY3Mw==",
      "original_commit_id" : "66ddec88f59b32928495767daa548dc41558d56c",
      "original_line" : 1985,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 368828617,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387705673",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r387750082"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387750082"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe it's the naming that confuses me. It's called \"rebroadcast\", not \"consider to rebroadcast\".\r\n>even if you did, those peers would probably still not send a GETDATA anyway\r\n\r\nNot sure about that. If transaction expires from a mempool, and there's not much activity on-chain, filter would still prevent us from re-announcing it. The correspondence between the two is questionable.\r\n\r\nBut yeah, if that's only my own confusion, I don't care about just keeping it this way without any comments.\r\n\r\n",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-04T15:40:29Z",
      "diff_hunk" : "@@ -780,6 +780,14 @@ void PeerLogicValidation::InitializeNode(CNode *pnode) {\n         PushNodeVersion(pnode, connman, GetTime());\n }\n \n+void PeerLogicValidation::QueueUnbroadcastTxs(CNode* pnode)\n+{\n+    for(const uint256& txid : mempool.m_unbroadcast_txids){\n+        CInv inv(MSG_TX, txid);\n+        pnode->PushInventory(inv);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r387750082",
      "id" : 387750082,
      "in_reply_to_id" : 385865086,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc1MDA4Mg==",
      "original_commit_id" : "66ddec88f59b32928495767daa548dc41558d56c",
      "original_line" : 795,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 368886517,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387750082",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2020-03-05T13:33:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-595231541",
      "id" : 595231541,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NTIzMTU0MQ==",
      "updated_at" : "2020-03-05T13:33:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/595231541",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r393293074"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393293074"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Have you weighted implications of wtxid-relay (#18044) ? I think you will need to track both txid/wtxid for backward-compability with non-upgraded nodes.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-16T20:31:56Z",
      "diff_hunk" : "@@ -534,6 +534,10 @@ class CTxMemPool\n     const setEntries & GetMemPoolParents(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n     const setEntries & GetMemPoolChildren(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n     uint64_t CalculateDescendantMaximum(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n+\n+    // track locally submitted transactions & periodically retry initial broadcast\n+    std::set<uint256> m_unbroadcast_txids;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r393293074",
      "id" : 393293074,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzI5MzA3NA==",
      "original_commit_id" : "66ec5571ad49b68366e4607cf0b671231083757e",
      "original_line" : 539,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 375561005,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393293074",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r393297027"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393297027"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "\"periodically (REATTEMPT_BROADCAST_INTERVAL)\"",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-16T20:40:29Z",
      "diff_hunk" : "@@ -534,6 +534,10 @@ class CTxMemPool\n     const setEntries & GetMemPoolParents(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n     const setEntries & GetMemPoolChildren(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n     uint64_t CalculateDescendantMaximum(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n+\n+    // track locally submitted transactions & periodically retry initial broadcast",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r393297027",
      "id" : 393297027,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzI5NzAyNw==",
      "original_commit_id" : "66ec5571ad49b68366e4607cf0b671231083757e",
      "original_line" : 537,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 375561005,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393297027",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r393946770"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393946770"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "this is the best option I've been able to identify for how to check if we are at the end of the file. would love to hear about any cleaner solutions.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-17T20:22:46Z",
      "diff_hunk" : "@@ -5045,12 +5046,30 @@ bool LoadMempool(CTxMemPool& pool)\n         for (const auto& i : mapDeltas) {\n             pool.PrioritiseTransaction(i.first, i.second);\n         }\n+\n+        // check if there are unbroadcast transactions\n+        bool has_unbroadcast_txns = false;\n+\n+        try {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r393946770",
      "id" : 393946770,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk0Njc3MA==",
      "original_commit_id" : "3d185eda3c6d449e080b749acfb4986e6f88e203",
      "original_line" : 5053,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 376376840,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393946770",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r393955311"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393955311"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "- added logic to save unbroadcast set to disk\r\n- added thread safety annotation & missing locks from lots of call sites ð\r\n\r\nthank you both for this feedback ðð½\r\nwould love further review on the added logic ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-17T20:39:14Z",
      "diff_hunk" : "@@ -534,6 +534,10 @@ class CTxMemPool\n     const setEntries & GetMemPoolParents(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n     const setEntries & GetMemPoolChildren(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n     uint64_t CalculateDescendantMaximum(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n+\n+    // track locally submitted transactions & periodically retry initial broadcast\n+    std::set<uint256> m_unbroadcast_txids;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r393955311",
      "id" : 393955311,
      "in_reply_to_id" : 385368573,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk1NTMxMQ==",
      "original_commit_id" : "66ddec88f59b32928495767daa548dc41558d56c",
      "original_line" : 539,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 376387657,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393955311",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r393957572"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393957572"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't fully understand what you mean here. Are you pointing out that there are other ways the transaction gets removed from the set?\r\n\r\nI updated to: \"We intepret processing a GETDATA for a transaction as a successful initial broadcast and remove it from our unbroadcast set.\" \r\n\r\nDoes that seem reasonable? Or am I still missing the point? \r\n",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-17T20:43:04Z",
      "diff_hunk" : "@@ -1590,6 +1590,11 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n             if (mi != mapRelay.end()) {\n                 connman->PushMessage(pfrom, msgMaker.Make(nSendFlags, NetMsgType::TX, *mi->second));\n                 push = true;\n+                // Once a peer requests GETDATA for a txn, we deem initial broadcast a success",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r393957572",
      "id" : 393957572,
      "in_reply_to_id" : 385795095,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk1NzU3Mg==",
      "original_commit_id" : "66ec5571ad49b68366e4607cf0b671231083757e",
      "original_line" : 1593,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 376390280,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393957572",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r393957842"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393957842"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed. Thanks again.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-17T20:43:33Z",
      "diff_hunk" : "@@ -1590,6 +1590,11 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n             if (mi != mapRelay.end()) {\n                 connman->PushMessage(pfrom, msgMaker.Make(nSendFlags, NetMsgType::TX, *mi->second));\n                 push = true;\n+                // Once a peer requests GETDATA for a txn, we deem initial broadcast a success\n+                int num = mempool.m_unbroadcast_txids.erase(inv.hash);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r393957842",
      "id" : 393957842,
      "in_reply_to_id" : 385795542,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk1Nzg0Mg==",
      "original_commit_id" : "66ec5571ad49b68366e4607cf0b671231083757e",
      "original_line" : 1594,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 376390633,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393957842",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r393959353"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393959353"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I updated it to \"from m_unbroadcast_txids before confirmation that txn was sent out\", but I feel uncertain... saying \"before GETDATA was received\" seems more clear & specific than \"confirmation that txn was sent out\". Could you explain further why you didn't like it? \r\n\r\nis this related to [this](https://github.com/bitcoin/bitcoin/pull/18038#discussion_r385795095)?",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-17T20:46:24Z",
      "diff_hunk" : "@@ -416,6 +416,10 @@ void CTxMemPool::removeUnchecked(txiter it, MemPoolRemovalReason reason)\n     for (const CTxIn& txin : it->GetTx().vin)\n         mapNextTx.erase(txin.prevout);\n \n+    if (mempool.m_unbroadcast_txids.erase(hash)) {\n+        LogPrint(BCLog::NET, \"Removed %i from m_unbroadcast_txids before GETDATA was received. \\n\", hash.GetHex());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r393959353",
      "id" : 393959353,
      "in_reply_to_id" : 385795926,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk1OTM1Mw==",
      "original_commit_id" : "66ec5571ad49b68366e4607cf0b671231083757e",
      "original_line" : 420,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 376392446,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393959353",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r393961149"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393961149"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "updated.\r\n\r\nfunny to update the code to match the comment language rather than vice versa ð but I don't have a strong preference around 12-36hrs vs 0-24hrs, both have small tradeoffs. ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-17T20:49:44Z",
      "diff_hunk" : "@@ -1982,7 +1982,7 @@ void CWallet::ResendWalletTransactions()\n     // that these are our transactions.\n     if (GetTime() < nNextResend || !fBroadcastTransactions) return;\n     bool fFirst = (nNextResend == 0);\n-    nNextResend = GetTime() + GetRand(30 * 60);\n+    nNextResend = GetTime() + GetRand(24 * 60 * 60);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r393961149",
      "id" : 393961149,
      "in_reply_to_id" : 385860440,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk2MTE0OQ==",
      "original_commit_id" : "66ddec88f59b32928495767daa548dc41558d56c",
      "original_line" : 1985,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 376394643,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393961149",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r393968358"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393968358"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Maybe it's the naming that confuses me. It's called \"rebroadcast\", not \"consider to rebroadcast\".\r\n\r\nthe language I'm introducing is \"unbroadcast\", which means consider it as initial broadcast. but there are these interactions with `filterInventoryKnown` to consider in different cases. \r\n\r\nI added some comments [here](https://github.com/bitcoin/bitcoin/pull/18038/files#diff-eff7adeaec73a769788bb78858815c91R782) in an attempt to make this more apparent. \r\n\r\ngoing to resolve this conversation, but @naumenkogs let me know if you think this is something we need to more carefully consider in regards to this PR. ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-17T21:01:56Z",
      "diff_hunk" : "@@ -780,6 +780,14 @@ void PeerLogicValidation::InitializeNode(CNode *pnode) {\n         PushNodeVersion(pnode, connman, GetTime());\n }\n \n+void PeerLogicValidation::QueueUnbroadcastTxs(CNode* pnode)\n+{\n+    for(const uint256& txid : mempool.m_unbroadcast_txids){\n+        CInv inv(MSG_TX, txid);\n+        pnode->PushInventory(inv);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r393968358",
      "id" : 393968358,
      "in_reply_to_id" : 385865086,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk2ODM1OA==",
      "original_commit_id" : "66ddec88f59b32928495767daa548dc41558d56c",
      "original_line" : 795,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 376402597,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393968358",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "looks like I have severely aggravated Travis. whoops ð. looking into it. ",
      "created_at" : "2020-03-17T21:14:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-600304555",
      "id" : 600304555,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwMDMwNDU1NQ==",
      "updated_at" : "2020-03-17T21:14:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/600304555",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r393982029"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393982029"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Needs rebase to make the `const CTxMemPool&` non-const",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-17T21:30:03Z",
      "diff_hunk" : "@@ -1605,7 +1622,21 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n                     push = true;\n                 }\n             }\n-            if (!push) {\n+\n+            if (push) {\n+                int num = 0;\n+\n+                // We intepret processing a GETDATA for a transaction as a successful initial broadcast\n+                // and remove it from our unbroadcast set.\n+                {\n+                    LOCK(mempool.cs);\n+                    num = mempool.m_unbroadcast_txids.erase(inv.hash);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r393982029",
      "id" : 393982029,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk4MjAyOQ==",
      "original_commit_id" : "3d185eda3c6d449e080b749acfb4986e6f88e203",
      "original_line" : 1633,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 376419558,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393982029",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r393995780"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393995780"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "updated. although I was surprised to find out I had to pass \"this\" through in the capture list. ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-17T22:00:51Z",
      "diff_hunk" : "@@ -2332,6 +2332,9 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n     // Dump network addresses\n     scheduler.scheduleEvery(std::bind(&CConnman::DumpAddresses, this), DUMP_PEERS_INTERVAL * 1000);\n \n+    // Attempt to broadcast transactions that have not yet been acknowledged by the network\n+    scheduler.scheduleEvery(std::bind(&CConnman::AttemptInitialBroadcast, this), REATTEMPT_BROADCAST_INTERVAL.count() );",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r393995780",
      "id" : 393995780,
      "in_reply_to_id" : 385798846,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk5NTc4MA==",
      "original_commit_id" : "1a1a30cc4adbbcccfbb073fbf8ae9df1090a2996",
      "original_line" : 2336,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 376435905,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393995780",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394003478"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394003478"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ah, I thought through the possible privacy leaks but didn't think about weird circumstances that could lead to synchronized network-wide events. \r\n\r\nupdated reattempts to be between 10-15 minutes, chosen every time a node starts up.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-17T22:20:12Z",
      "diff_hunk" : "@@ -48,6 +48,9 @@ static_assert(MINIUPNPC_API_VERSION >= 10, \"miniUPnPc API version >= 10 assumed\"\n // Dump addresses to peers.dat every 15 minutes (900s)\n static constexpr int DUMP_PEERS_INTERVAL = 15 * 60;\n \n+// Attempt initial broadcast of locally submitted txns every 10 minutes.\n+static constexpr std::chrono::milliseconds REATTEMPT_BROADCAST_INTERVAL = std::chrono::milliseconds(10 * 60 * 1000);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394003478",
      "id" : 394003478,
      "in_reply_to_id" : 387662775,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDAwMzQ3OA==",
      "original_commit_id" : "66ddec88f59b32928495767daa548dc41558d56c",
      "original_line" : 52,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 376445015,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394003478",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394005374"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394005374"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "thanks!",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-17T22:24:54Z",
      "diff_hunk" : "@@ -1605,7 +1622,21 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n                     push = true;\n                 }\n             }\n-            if (!push) {\n+\n+            if (push) {\n+                int num = 0;\n+\n+                // We intepret processing a GETDATA for a transaction as a successful initial broadcast\n+                // and remove it from our unbroadcast set.\n+                {\n+                    LOCK(mempool.cs);\n+                    num = mempool.m_unbroadcast_txids.erase(inv.hash);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394005374",
      "id" : 394005374,
      "in_reply_to_id" : 393982029,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDAwNTM3NA==",
      "original_commit_id" : "3d185eda3c6d449e080b749acfb4986e6f88e203",
      "original_line" : 1633,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 376447137,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394005374",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394006471"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394006471"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ah, good point. will think this through. thanks! ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-17T22:27:44Z",
      "diff_hunk" : "@@ -534,6 +534,10 @@ class CTxMemPool\n     const setEntries & GetMemPoolParents(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n     const setEntries & GetMemPoolChildren(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n     uint64_t CalculateDescendantMaximum(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n+\n+    // track locally submitted transactions & periodically retry initial broadcast\n+    std::set<uint256> m_unbroadcast_txids;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394006471",
      "id" : 394006471,
      "in_reply_to_id" : 393293074,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDAwNjQ3MQ==",
      "original_commit_id" : "66ec5571ad49b68366e4607cf0b671231083757e",
      "original_line" : 539,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 376448339,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394006471",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394006704"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394006704"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "going to pass on this one, especially since I removed the constant for some variability in intervals.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-17T22:28:21Z",
      "diff_hunk" : "@@ -534,6 +534,10 @@ class CTxMemPool\n     const setEntries & GetMemPoolParents(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n     const setEntries & GetMemPoolChildren(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n     uint64_t CalculateDescendantMaximum(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n+\n+    // track locally submitted transactions & periodically retry initial broadcast",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394006704",
      "id" : 394006704,
      "in_reply_to_id" : 393297027,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDAwNjcwNA==",
      "original_commit_id" : "66ec5571ad49b68366e4607cf0b671231083757e",
      "original_line" : 537,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 376449063,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394006704",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@ariard \r\n\r\n> If I understand well this PR, it introduces a initial-broadcast reattempt mechanism through mempool tracking and GETDATA monitoring. Compare to wallet rebroadcast, the safety catch of new one isn't confirmation-based but network-based so once you have reasonable propagation (reasonable=1) you stop initial-broadcast. \r\n\r\nYup. \r\n\r\n> But I don't grasp where the privacy win is in itself, I would say that's a reliability improvement against network unknowns\r\n\r\n**The privacy improvement is due to wallet rebroadcasts being less frequent.** Updated to ~1/day (between 12-36 hrs) instead of ~1/15 mins (between 0-30mins). The current wallet rebroadcast logic deanonymizes the sender, but is important to ensure the initial delivery in some cases. So, we extract the two functions.\r\n\r\nAlso updated OP to try to make this clearer. \r\n\r\n@gmaxwell summarizes the motivation pretty well [here](https://github.com/bitcoin/bitcoin/pull/16698#issuecomment-571399346): \r\n> Has anyone considered significantly increasing the time between rebroadcasts as an additional change (and one that could go in separately much faster)? Particularly once you've performed one successful broadcast per execution additional rebroadcasts usually do nothing except leak data to attackers that frequently reconnect to you-- you won't resend to a host you've sent to before, and its not usually useful to do so. This wouldn't obviate the need to be more intelligent, but it would reduce the bleeding and also make it more acceptable for the rest of the change to be more approximate.\r\n\r\nand in regards to the attack vector,\r\n>  (maybe even a slight worsening because now a spying node only have to be connected to you for REATTEMPT_BROADCAST_INTERVAL instead of ~1/30min, which decrease attacker deployment cost ?)\r\n\r\nBecause of `filterInventoryKnown` logic, its not quite that the attacker needs to be connected to you for that long, but rather that they would need to open a new connection to you during that window of time. Also, my understanding is that the conditions would need to be such that you didn't receive any `GETDATAs` back from any peers in regards to this txn, because otherwise it would be removed from the set. So we'd need: 1. victim sends txn to attacker, 2. attacker doesn't acknowledge with `GETDATA` but notes down txn hash, 3. somehow (either intentional or unintentional) ensure no other peers send back `GETDATA` for the txn 4. open a new connection before next broadcast attempt. Then the attacker can confirm that the victim is the source for that transaction. \r\n\r\nDoes that logic make sense to you? Please poke holes at it :) Or let me know if you have any questions.\r\n\r\nAlso, relevant conversation in this comment thread [here](https://github.com/bitcoin/bitcoin/pull/16698#discussion_r348840194), which I know you've seen but might be worth re-visiting. \r\n\r\n",
      "created_at" : "2020-03-18T00:08:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-600359498",
      "id" : 600359498,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwMDM1OTQ5OA==",
      "updated_at" : "2020-03-18T00:08:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/600359498",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Changed title to indicate that this only improves *wallet* privacy",
      "created_at" : "2020-03-18T15:18:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-600683350",
      "id" : 600683350,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwMDY4MzM1MA==",
      "updated_at" : "2020-03-18T15:18:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/600683350",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394440617"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394440617"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit 77748da2269bd7f2304ebc3b8616d3a584e7c65f:\r\n\r\nCan be written shorter as\r\n```suggestion\r\n                if (WITH_LOCK(mempool.cs, return mempool.m_unbroadcast_txids.erase(inv.hash);)) {\r\n```",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-18T15:36:32Z",
      "diff_hunk" : "@@ -1605,7 +1605,21 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n                     push = true;\n                 }\n             }\n-            if (!push) {\n+\n+            if (push) {\n+                int num = 0;\n+\n+                // We intepret processing a GETDATA for a transaction as a successful initial broadcast\n+                // and remove it from our unbroadcast set.\n+                {\n+                    LOCK(mempool.cs);\n+                    num = mempool.m_unbroadcast_txids.erase(inv.hash);\n+                }\n+\n+                if (num) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394440617",
      "id" : 394440617,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ0MDYxNw==",
      "original_commit_id" : "77748da2269bd7f2304ebc3b8616d3a584e7c65f",
      "original_line" : 1631,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 376984420,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394440617",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394443323"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394443323"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit 77748da:\r\n\r\nPlease use `node.mempool` and not the global",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-18T15:40:03Z",
      "diff_hunk" : "@@ -78,6 +78,10 @@ TransactionError BroadcastTransaction(NodeContext& node, const CTransactionRef t\n     }\n \n     if (relay) {\n+        // the mempool tracks locally submitted transactions to make a\n+        // best-effort of initial broadcast\n+        WITH_LOCK(mempool.cs, mempool.m_unbroadcast_txids.insert(hashTx));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394443323",
      "id" : 394443323,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ0MzMyMw==",
      "original_commit_id" : "77748da2269bd7f2304ebc3b8616d3a584e7c65f",
      "original_line" : 83,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/node/transaction.cpp",
      "position" : null,
      "pull_request_review_id" : 376984420,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394443323",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394455686"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394455686"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit 2f3f449dc9c89420a444cc8263c5a5fe537a475b:\r\n\r\nI still haven't figured out  a way to exploit this for privacy leaks, but making each node pick a unique fingerprint (heartbeat between 10-15 minutes) doesn't seem too great. Sometimes nodes offer a tor p2p interface and a clearnet p2p interface and ideally those should be uncorrelated. Obviously horribly broken in the current p2p implementation, but we shouldn't make it worse, I think.\r\n\r\nSo what do you think about just scheduling this once here and then reschedule this at the end of the `AttemptInitialBroadcast` function?\r\n\r\nSomething like\r\n\r\n```cpp\r\nvoid CConnman::ScheduleNextInitialBroadcast(CScheduler& s) const\r\n{\r\n const auto delta = std::chrono::minutes{10} + GetRandMicros(std::chrono::minutes{5});\r\n s.schedule([&]{this->AttemptInitialBroadcast(s);}, delta);\r\n}",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-18T15:55:31Z",
      "diff_hunk" : "@@ -2345,6 +2342,11 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n     // Dump network addresses\n     scheduler.scheduleEvery([this] { DumpAddresses(); }, DUMP_PEERS_INTERVAL);\n \n+    // Periodically attempt to broadcast transactions that have not yet been acknowledged by the network\n+    // To ensure impossibility of network-wide synchronization event, stagger retry intervals between 10-15 minutes.\n+    std::chrono::seconds reattempt_broadcast_interval = std::chrono::seconds(10*60 + GetRand(5*60));\n+    scheduler.scheduleEvery([this]{this->AttemptInitialBroadcast();}, std::chrono::milliseconds(reattempt_broadcast_interval));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394455686",
      "id" : 394455686,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ1NTY4Ng==",
      "original_commit_id" : "2f3f449dc9c89420a444cc8263c5a5fe537a475b",
      "original_line" : 2348,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 376984420,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394455686",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394459225"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394459225"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit 2f3f449dc9c89420a444cc8263c5a5fe537a475b:\r\n\r\nstyle nit. Can be a reference because it is never null\r\n```suggestion\r\nvoid PeerLogicValidation::QueueUnbroadcastTxs(CNode& pnode)\r\n```",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-18T15:59:39Z",
      "diff_hunk" : "@@ -779,6 +779,23 @@ void PeerLogicValidation::InitializeNode(CNode *pnode) {\n         PushNodeVersion(pnode, connman, GetTime());\n }\n \n+// We don't force an attempt to relay unbroadcast txns by directly adding them\n+// to setInventoryTxToSend, but instead pass to PushInventory which checks\n+// filterInventoryKnown.\n+//\n+// Passing txns through the bloom filter has a stronger privacy model, but weaker\n+// delivery guarantees. Under certain network & node conditions, it may still\n+// take an extended period of time for the transaction to be initially broadcast\n+// to the network.\n+void PeerLogicValidation::QueueUnbroadcastTxs(CNode* pnode)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394459225",
      "id" : 394459225,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ1OTIyNQ==",
      "original_commit_id" : "2f3f449dc9c89420a444cc8263c5a5fe537a475b",
      "original_line" : 790,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 376984420,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394459225",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394459527"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394459527"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit 2f3f449dc9c89420a444cc8263c5a5fe537a475b:\r\n\r\nPlease use m_mempool and not the global.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-18T16:00:01Z",
      "diff_hunk" : "@@ -779,6 +779,23 @@ void PeerLogicValidation::InitializeNode(CNode *pnode) {\n         PushNodeVersion(pnode, connman, GetTime());\n }\n \n+// We don't force an attempt to relay unbroadcast txns by directly adding them\n+// to setInventoryTxToSend, but instead pass to PushInventory which checks\n+// filterInventoryKnown.\n+//\n+// Passing txns through the bloom filter has a stronger privacy model, but weaker\n+// delivery guarantees. Under certain network & node conditions, it may still\n+// take an extended period of time for the transaction to be initially broadcast\n+// to the network.\n+void PeerLogicValidation::QueueUnbroadcastTxs(CNode* pnode)\n+{\n+    LOCK(mempool.cs);\n+    for(const uint256& txid : mempool.m_unbroadcast_txids){",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394459527",
      "id" : 394459527,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ1OTUyNw==",
      "original_commit_id" : "2f3f449dc9c89420a444cc8263c5a5fe537a475b",
      "original_line" : 793,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 376984420,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394459527",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394470334"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394470334"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit 2f3f449:\r\n\r\nI don't understand this comment, why would it have weaker delivery guarantees? Is it the bloom filter false positive rate?",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-18T16:14:58Z",
      "diff_hunk" : "@@ -779,6 +779,23 @@ void PeerLogicValidation::InitializeNode(CNode *pnode) {\n         PushNodeVersion(pnode, connman, GetTime());\n }\n \n+// We don't force an attempt to relay unbroadcast txns by directly adding them\n+// to setInventoryTxToSend, but instead pass to PushInventory which checks\n+// filterInventoryKnown.\n+//\n+// Passing txns through the bloom filter has a stronger privacy model, but weaker\n+// delivery guarantees. Under certain network & node conditions, it may still\n+// take an extended period of time for the transaction to be initially broadcast\n+// to the network.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394470334",
      "id" : 394470334,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ3MDMzNA==",
      "original_commit_id" : "2f3f449dc9c89420a444cc8263c5a5fe537a475b",
      "original_line" : 789,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 376984420,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394470334",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394470902"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394470902"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit 2f3f449:\r\n\r\nCan be const?\r\n\r\n```suggestion\r\n    void QueueUnbroadcastTxs(CNode& node) const override;\r\n```",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-18T16:15:44Z",
      "diff_hunk" : "@@ -75,7 +75,8 @@ class PeerLogicValidation final : public CValidationInterface, public NetEventsI\n     void CheckForStaleTipAndEvictPeers(const Consensus::Params &consensusParams);\n     /** If we have extra outbound peers, try to disconnect the one with the oldest block announcement */\n     void EvictExtraOutboundPeers(int64_t time_in_seconds) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n-\n+    /** Retrieve unbroadcast transactions from the mempool and possibly send to pnode */\n+    void QueueUnbroadcastTxs(CNode* pnode) override;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394470902",
      "id" : 394470902,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ3MDkwMg==",
      "original_commit_id" : "2f3f449dc9c89420a444cc8263c5a5fe537a475b",
      "original_line" : 79,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net_processing.h",
      "position" : null,
      "pull_request_review_id" : 376984420,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394470902",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394474255"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394474255"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit f40f6875f5570cb25882d8a04a6cbeb61ee7366d:\r\n\r\nStyle nit. Could add trailing comma for symmetry, git blame, and code formatters?\r\n\r\n```suggestion\r\n        hex_str_to_bytes,\r\n```",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-18T16:20:35Z",
      "diff_hunk" : "@@ -0,0 +1,121 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+from io import BytesIO\n+import time\n+\n+from test_framework.blocktools import create_block, create_coinbase\n+from test_framework.messages import ToHex, CTransaction\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+        assert_equal,\n+        disconnect_nodes,\n+        connect_nodes,\n+        create_confirmed_utxos,\n+        wait_until,\n+        hex_str_to_bytes",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394474255",
      "id" : 394474255,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ3NDI1NQ==",
      "original_commit_id" : "f40f6875f5570cb25882d8a04a6cbeb61ee7366d",
      "original_line" : 21,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : null,
      "pull_request_review_id" : 376984420,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394474255",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394475575"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394475575"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit f40f6875f5570cb25882d8a04a6cbeb61ee7366d:\r\n\r\nI think assert is a statement, not a function, so should be without `()`\r\n```suggestion\r\n        assert wallet_tx_hsh not in mempool\r\n```",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-18T16:22:27Z",
      "diff_hunk" : "@@ -0,0 +1,121 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+from io import BytesIO\n+import time\n+\n+from test_framework.blocktools import create_block, create_coinbase\n+from test_framework.messages import ToHex, CTransaction\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+        assert_equal,\n+        disconnect_nodes,\n+        connect_nodes,\n+        create_confirmed_utxos,\n+        wait_until,\n+        hex_str_to_bytes\n+)\n+\n+class MempoolUnbroadcastTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.test_broadcast()\n+        self.test_txn_removal()\n+\n+    def test_broadcast(self):\n+        self.log.info(\"Test that mempool reattempts delivery of locally submitted transaction\")\n+        node = self.nodes[0]\n+\n+        min_relay_fee = node.getnetworkinfo()[\"relayfee\"]\n+        utxos = create_confirmed_utxos(min_relay_fee, node, 10)\n+\n+        disconnect_nodes(node, 1)\n+\n+        self.log.info(\"Generate transactions that only node 0 knows about\")\n+        # generate a wallet txn\n+        addr = node.getnewaddress()\n+        wallet_tx_hsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # generate a txn using sendrawtransaction\n+        us0 = utxos.pop()\n+        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n+        outputs = {addr: 0.0001}\n+        tx = node.createrawtransaction(inputs, outputs)\n+        node.settxfee(min_relay_fee)\n+        txF = node.fundrawtransaction(tx)\n+        txFS = node.signrawtransactionwithwallet(txF['hex'])\n+        rpc_tx_hsh = node.sendrawtransaction(txFS['hex'])  # txhsh in hex\n+\n+        # check that second node doesn't have these two txns\n+        mempool = self.nodes[1].getrawmempool()\n+        assert(rpc_tx_hsh not in mempool)\n+        assert(wallet_tx_hsh not in mempool)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394475575",
      "id" : 394475575,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ3NTU3NQ==",
      "original_commit_id" : "f40f6875f5570cb25882d8a04a6cbeb61ee7366d",
      "original_line" : 62,
      "original_position" : 62,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : null,
      "pull_request_review_id" : 376984420,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394475575",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394476596"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394476596"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit f40f6875f5570cb25882d8a04a6cbeb61ee7366d:\r\n\r\nCould do the same test again with a `self.nodes[0].restart_node()` added here?\r\n\r\nThis way it will test to persist txs on disk.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-18T16:23:54Z",
      "diff_hunk" : "@@ -0,0 +1,121 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+from io import BytesIO\n+import time\n+\n+from test_framework.blocktools import create_block, create_coinbase\n+from test_framework.messages import ToHex, CTransaction\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+        assert_equal,\n+        disconnect_nodes,\n+        connect_nodes,\n+        create_confirmed_utxos,\n+        wait_until,\n+        hex_str_to_bytes\n+)\n+\n+class MempoolUnbroadcastTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.test_broadcast()\n+        self.test_txn_removal()\n+\n+    def test_broadcast(self):\n+        self.log.info(\"Test that mempool reattempts delivery of locally submitted transaction\")\n+        node = self.nodes[0]\n+\n+        min_relay_fee = node.getnetworkinfo()[\"relayfee\"]\n+        utxos = create_confirmed_utxos(min_relay_fee, node, 10)\n+\n+        disconnect_nodes(node, 1)\n+\n+        self.log.info(\"Generate transactions that only node 0 knows about\")\n+        # generate a wallet txn\n+        addr = node.getnewaddress()\n+        wallet_tx_hsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # generate a txn using sendrawtransaction\n+        us0 = utxos.pop()\n+        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n+        outputs = {addr: 0.0001}\n+        tx = node.createrawtransaction(inputs, outputs)\n+        node.settxfee(min_relay_fee)\n+        txF = node.fundrawtransaction(tx)\n+        txFS = node.signrawtransactionwithwallet(txF['hex'])\n+        rpc_tx_hsh = node.sendrawtransaction(txFS['hex'])  # txhsh in hex\n+\n+        # check that second node doesn't have these two txns\n+        mempool = self.nodes[1].getrawmempool()\n+        assert(rpc_tx_hsh not in mempool)\n+        assert(wallet_tx_hsh not in mempool)\n+\n+        self.log.info(\"Reconnect nodes & check if they are sent to node 1\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394476596",
      "id" : 394476596,
      "line" : 64,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ3NjU5Ng==",
      "original_commit_id" : "f40f6875f5570cb25882d8a04a6cbeb61ee7366d",
      "original_line" : 64,
      "original_position" : 64,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : 64,
      "pull_request_review_id" : 376984420,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394476596",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394478852"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394478852"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit f40f6875f5570cb25882d8a04a6cbeb61ee7366d:\r\n\r\nCan be shorter, because self.sync_mempools() does the same, I think\r\n```suggestion\r\n        self.sync_mempools()\r\n```",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-18T16:27:01Z",
      "diff_hunk" : "@@ -0,0 +1,121 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+from io import BytesIO\n+import time\n+\n+from test_framework.blocktools import create_block, create_coinbase\n+from test_framework.messages import ToHex, CTransaction\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+        assert_equal,\n+        disconnect_nodes,\n+        connect_nodes,\n+        create_confirmed_utxos,\n+        wait_until,\n+        hex_str_to_bytes\n+)\n+\n+class MempoolUnbroadcastTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.test_broadcast()\n+        self.test_txn_removal()\n+\n+    def test_broadcast(self):\n+        self.log.info(\"Test that mempool reattempts delivery of locally submitted transaction\")\n+        node = self.nodes[0]\n+\n+        min_relay_fee = node.getnetworkinfo()[\"relayfee\"]\n+        utxos = create_confirmed_utxos(min_relay_fee, node, 10)\n+\n+        disconnect_nodes(node, 1)\n+\n+        self.log.info(\"Generate transactions that only node 0 knows about\")\n+        # generate a wallet txn\n+        addr = node.getnewaddress()\n+        wallet_tx_hsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # generate a txn using sendrawtransaction\n+        us0 = utxos.pop()\n+        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n+        outputs = {addr: 0.0001}\n+        tx = node.createrawtransaction(inputs, outputs)\n+        node.settxfee(min_relay_fee)\n+        txF = node.fundrawtransaction(tx)\n+        txFS = node.signrawtransactionwithwallet(txF['hex'])\n+        rpc_tx_hsh = node.sendrawtransaction(txFS['hex'])  # txhsh in hex\n+\n+        # check that second node doesn't have these two txns\n+        mempool = self.nodes[1].getrawmempool()\n+        assert(rpc_tx_hsh not in mempool)\n+        assert(wallet_tx_hsh not in mempool)\n+\n+        self.log.info(\"Reconnect nodes & check if they are sent to node 1\")\n+        connect_nodes(node, 1)\n+\n+        # fast forward into the future & ensure that the second node has the txns\n+        node.mockscheduler(15*60) # 15 min in seconds\n+        wait_until(lambda: len(self.nodes[1].getrawmempool()) == 2, timeout=30)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394478852",
      "id" : 394478852,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ3ODg1Mg==",
      "original_commit_id" : "f40f6875f5570cb25882d8a04a6cbeb61ee7366d",
      "original_line" : 69,
      "original_position" : 69,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : null,
      "pull_request_review_id" : 376984420,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394478852",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394480786"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394480786"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit f40f687:\r\n\r\nDoes the block need to be created manually? What about a simple two-liner?\r\n\r\n```\r\nself.nodes[0].sendtoaddress()\r\nself.nodes[0].generate(1)\r\n```\r\n\r\nAlternatively, if you want to test both wallet txs and rpc txs, you could factor out the tx-creation code from the previous test case into a new helper function and call it here.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-18T16:29:47Z",
      "diff_hunk" : "@@ -0,0 +1,121 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+from io import BytesIO\n+import time\n+\n+from test_framework.blocktools import create_block, create_coinbase\n+from test_framework.messages import ToHex, CTransaction\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+        assert_equal,\n+        disconnect_nodes,\n+        connect_nodes,\n+        create_confirmed_utxos,\n+        wait_until,\n+        hex_str_to_bytes\n+)\n+\n+class MempoolUnbroadcastTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.test_broadcast()\n+        self.test_txn_removal()\n+\n+    def test_broadcast(self):\n+        self.log.info(\"Test that mempool reattempts delivery of locally submitted transaction\")\n+        node = self.nodes[0]\n+\n+        min_relay_fee = node.getnetworkinfo()[\"relayfee\"]\n+        utxos = create_confirmed_utxos(min_relay_fee, node, 10)\n+\n+        disconnect_nodes(node, 1)\n+\n+        self.log.info(\"Generate transactions that only node 0 knows about\")\n+        # generate a wallet txn\n+        addr = node.getnewaddress()\n+        wallet_tx_hsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # generate a txn using sendrawtransaction\n+        us0 = utxos.pop()\n+        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n+        outputs = {addr: 0.0001}\n+        tx = node.createrawtransaction(inputs, outputs)\n+        node.settxfee(min_relay_fee)\n+        txF = node.fundrawtransaction(tx)\n+        txFS = node.signrawtransactionwithwallet(txF['hex'])\n+        rpc_tx_hsh = node.sendrawtransaction(txFS['hex'])  # txhsh in hex\n+\n+        # check that second node doesn't have these two txns\n+        mempool = self.nodes[1].getrawmempool()\n+        assert(rpc_tx_hsh not in mempool)\n+        assert(wallet_tx_hsh not in mempool)\n+\n+        self.log.info(\"Reconnect nodes & check if they are sent to node 1\")\n+        connect_nodes(node, 1)\n+\n+        # fast forward into the future & ensure that the second node has the txns\n+        node.mockscheduler(15*60) # 15 min in seconds\n+        wait_until(lambda: len(self.nodes[1].getrawmempool()) == 2, timeout=30)\n+        mempool = self.nodes[1].getrawmempool()\n+        assert(rpc_tx_hsh in mempool)\n+        assert(wallet_tx_hsh in mempool)\n+\n+        self.log.info(\"Add another connection & ensure transactions aren't broadcast again\")\n+\n+        conn = node.add_p2p_connection(P2PTxInvStore())\n+        node.mockscheduler(15*60)\n+        time.sleep(5)\n+        assert_equal(len(conn.get_invs()), 0)\n+\n+    def test_txn_removal(self):\n+        self.log.info(\"Test that transactions removed from mempool are removed from unbroadcast set\")\n+        node = self.nodes[0]\n+        disconnect_nodes(node, 1)\n+\n+        min_relay_fee = node.getnetworkinfo()[\"relayfee\"]\n+        utxos = create_confirmed_utxos(min_relay_fee, node, 10)\n+\n+        # create a transaction & submit to node\n+        # since the node doesn't have any connections, it will not receive\n+        # any GETDATAs & thus the transaction will remain in the unbroadcast set.\n+        utxo = utxos.pop()\n+        outputs = { node.getnewaddress() : 0.0001 }\n+        inputs = [{'txid': utxo['txid'], 'vout': utxo['vout']}]\n+        raw_tx_hex = node.createrawtransaction(inputs, outputs)\n+        signed_tx = node.signrawtransactionwithwallet(raw_tx_hex)\n+        txhsh = node.sendrawtransaction(hexstring=signed_tx['hex'], maxfeerate=0)\n+\n+        # mine a block with that transaction\n+        block = create_block(int(node.getbestblockhash(), 16), create_coinbase(node.getblockcount() + 1))\n+        tx = CTransaction()\n+        tx.deserialize(BytesIO(hex_str_to_bytes(signed_tx['hex'])))\n+        block.vtx.append(tx)\n+        block.rehash()\n+        block.hashMerkleRoot = block.calc_merkle_root()\n+        block.solve()\n+        node.submitblock(ToHex(block))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394480786",
      "id" : 394480786,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ4MDc4Ng==",
      "original_commit_id" : "f40f6875f5570cb25882d8a04a6cbeb61ee7366d",
      "original_line" : 107,
      "original_position" : 107,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : null,
      "pull_request_review_id" : 376984420,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394480786",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394483205"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394483205"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit b0f6a238335d96c9f5f7c2b83aabd56ab4f47a71:\r\n\r\nWhy is this needed?\r\n\r\nI think you can just go ahead and assume that the set was serialized. If it wasn't it will result in a one-time `LogPrintf` that the mempool data couldn't be deserialized. I think this is fine if it is mentioned in the release notes or as a code comment or not at all.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-18T16:33:27Z",
      "diff_hunk" : "@@ -5045,12 +5046,30 @@ bool LoadMempool(CTxMemPool& pool)\n         for (const auto& i : mapDeltas) {\n             pool.PrioritiseTransaction(i.first, i.second);\n         }\n+\n+        // check if there are unbroadcast transactions\n+        bool has_unbroadcast_txns = false;\n+\n+        try {\n+            file >> has_unbroadcast_txns;\n+        } catch (const std::exception &e) {\n+            // eof gets set when we try to read the end of the file\n+            // so specifically catch expected error and move on.\n+            if (!file.eof()) throw e;\n+        }\n+\n+        if (has_unbroadcast_txns) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394483205",
      "id" : 394483205,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ4MzIwNQ==",
      "original_commit_id" : "b0f6a238335d96c9f5f7c2b83aabd56ab4f47a71",
      "original_line" : 5061,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 376984420,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394483205",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394502466"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394502466"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Although this is supposed to happen extremely rare, I think Marco's comment is very valid. I agree with his suggestion.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-18T17:01:38Z",
      "diff_hunk" : "@@ -2345,6 +2342,11 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n     // Dump network addresses\n     scheduler.scheduleEvery([this] { DumpAddresses(); }, DUMP_PEERS_INTERVAL);\n \n+    // Periodically attempt to broadcast transactions that have not yet been acknowledged by the network\n+    // To ensure impossibility of network-wide synchronization event, stagger retry intervals between 10-15 minutes.\n+    std::chrono::seconds reattempt_broadcast_interval = std::chrono::seconds(10*60 + GetRand(5*60));\n+    scheduler.scheduleEvery([this]{this->AttemptInitialBroadcast();}, std::chrono::milliseconds(reattempt_broadcast_interval));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394502466",
      "id" : 394502466,
      "in_reply_to_id" : 394455686,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUwMjQ2Ng==",
      "original_commit_id" : "2f3f449dc9c89420a444cc8263c5a5fe537a475b",
      "original_line" : 2348,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 377062629,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394502466",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394518591"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394518591"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@amitiuttarwar Since this is a new file, you might want to run [`black`](https://black.readthedocs.io/en/stable/) on the entire file to get proper formatting which addresses MarcoFalke's nit and all other formatting nits :)",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-18T17:26:33Z",
      "diff_hunk" : "@@ -0,0 +1,121 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+from io import BytesIO\n+import time\n+\n+from test_framework.blocktools import create_block, create_coinbase\n+from test_framework.messages import ToHex, CTransaction\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+        assert_equal,\n+        disconnect_nodes,\n+        connect_nodes,\n+        create_confirmed_utxos,\n+        wait_until,\n+        hex_str_to_bytes",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394518591",
      "id" : 394518591,
      "in_reply_to_id" : 394474255,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUxODU5MQ==",
      "original_commit_id" : "f40f6875f5570cb25882d8a04a6cbeb61ee7366d",
      "original_line" : 21,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : null,
      "pull_request_review_id" : 377083258,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394518591",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394518928"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394518928"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@amitiuttarwar Same goes for this one: `black` on the entire file to get proper formatting for free :)",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-18T17:27:02Z",
      "diff_hunk" : "@@ -0,0 +1,121 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+from io import BytesIO\n+import time\n+\n+from test_framework.blocktools import create_block, create_coinbase\n+from test_framework.messages import ToHex, CTransaction\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+        assert_equal,\n+        disconnect_nodes,\n+        connect_nodes,\n+        create_confirmed_utxos,\n+        wait_until,\n+        hex_str_to_bytes\n+)\n+\n+class MempoolUnbroadcastTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.test_broadcast()\n+        self.test_txn_removal()\n+\n+    def test_broadcast(self):\n+        self.log.info(\"Test that mempool reattempts delivery of locally submitted transaction\")\n+        node = self.nodes[0]\n+\n+        min_relay_fee = node.getnetworkinfo()[\"relayfee\"]\n+        utxos = create_confirmed_utxos(min_relay_fee, node, 10)\n+\n+        disconnect_nodes(node, 1)\n+\n+        self.log.info(\"Generate transactions that only node 0 knows about\")\n+        # generate a wallet txn\n+        addr = node.getnewaddress()\n+        wallet_tx_hsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # generate a txn using sendrawtransaction\n+        us0 = utxos.pop()\n+        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n+        outputs = {addr: 0.0001}\n+        tx = node.createrawtransaction(inputs, outputs)\n+        node.settxfee(min_relay_fee)\n+        txF = node.fundrawtransaction(tx)\n+        txFS = node.signrawtransactionwithwallet(txF['hex'])\n+        rpc_tx_hsh = node.sendrawtransaction(txFS['hex'])  # txhsh in hex\n+\n+        # check that second node doesn't have these two txns\n+        mempool = self.nodes[1].getrawmempool()\n+        assert(rpc_tx_hsh not in mempool)\n+        assert(wallet_tx_hsh not in mempool)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394518928",
      "id" : 394518928,
      "in_reply_to_id" : 394475575,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUxODkyOA==",
      "original_commit_id" : "f40f6875f5570cb25882d8a04a6cbeb61ee7366d",
      "original_line" : 62,
      "original_position" : 62,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : null,
      "pull_request_review_id" : 377083258,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394518928",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394540166"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394540166"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@practicalswift \r\nStyle is subjective and we allow the pull request author to pick the style, as long as it is reasonable. We don't require a specific python formatter. While black or yapf (https://github.com/bitcoin/bitcoin/blob/master/.style.yapf) or the built-in formatter of your editor can be used, they are not mandatory.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-18T18:01:03Z",
      "diff_hunk" : "@@ -0,0 +1,121 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+from io import BytesIO\n+import time\n+\n+from test_framework.blocktools import create_block, create_coinbase\n+from test_framework.messages import ToHex, CTransaction\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+        assert_equal,\n+        disconnect_nodes,\n+        connect_nodes,\n+        create_confirmed_utxos,\n+        wait_until,\n+        hex_str_to_bytes",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394540166",
      "id" : 394540166,
      "in_reply_to_id" : 394474255,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU0MDE2Ng==",
      "original_commit_id" : "f40f6875f5570cb25882d8a04a6cbeb61ee7366d",
      "original_line" : 21,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : null,
      "pull_request_review_id" : 377110505,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394540166",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394608061"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394608061"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke Have I claimed anything else? :)  This is _your_ style nit - I'm just suggesting a way to address it automatically :)",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-18T20:05:30Z",
      "diff_hunk" : "@@ -0,0 +1,121 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+from io import BytesIO\n+import time\n+\n+from test_framework.blocktools import create_block, create_coinbase\n+from test_framework.messages import ToHex, CTransaction\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+        assert_equal,\n+        disconnect_nodes,\n+        connect_nodes,\n+        create_confirmed_utxos,\n+        wait_until,\n+        hex_str_to_bytes",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r394608061",
      "id" : 394608061,
      "in_reply_to_id" : 394474255,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDYwODA2MQ==",
      "original_commit_id" : "f40f6875f5570cb25882d8a04a6cbeb61ee7366d",
      "original_line" : 21,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : null,
      "pull_request_review_id" : 377195882,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394608061",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r395248783"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/395248783"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "See https://github.com/ariard/bitcoin/commit/2d8ae9a838f5c6ec43db15a7bd36554c351b7442, I find a bit weird to schedule a mempool task from connection manager instead of message processing layer. It should achieve the same goal while removing one new method (or have you already considered this and turn away for a good reason) ?",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-19T18:52:25Z",
      "diff_hunk" : "@@ -2345,6 +2342,11 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n     // Dump network addresses\n     scheduler.scheduleEvery([this] { DumpAddresses(); }, DUMP_PEERS_INTERVAL);\n \n+    // Periodically attempt to broadcast transactions that have not yet been acknowledged by the network\n+    // To ensure impossibility of network-wide synchronization event, stagger retry intervals between 10-15 minutes.\n+    std::chrono::seconds reattempt_broadcast_interval = std::chrono::seconds(10*60 + GetRand(5*60));\n+    scheduler.scheduleEvery([this]{this->AttemptInitialBroadcast();}, std::chrono::milliseconds(reattempt_broadcast_interval));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r395248783",
      "id" : 395248783,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTI0ODc4Mw==",
      "original_commit_id" : "2f3f449dc9c89420a444cc8263c5a5fe537a475b",
      "original_line" : 2348,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 378004299,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/395248783",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Does that logic make sense to you? Please poke holes at it :) Or let me know if you have any questions.\r\n\r\nI think we agree, missed inventory filter implications at first, maybe should get some message in your first commit to track goal aimed:\r\n\r\n\"Previously, in case of rebroadcast, a spying node may learn transaction\r\norigin if it was connected to the node during a ~1/15min period.\r\n\r\nNow, mempool is tracking locally submitted transactions. At servicing\r\nGETDATA for an announced local transaction for at least one peer, tracking\r\nis erased. If no GETDATA is processed before mempool initial-broadcast\r\nreattempt period expires, a new announcement is made to every peer. Due\r\nto inventory filter, this is only effective for new peers since last period\r\nexpiration. Transaction origin privacy would only be worsened if a) among\r\nnew nodes there is a spying one b) no honest/reliable peers reported back\r\na GETDATA. Given the mempool rebroadcast period length, if b) occurs, that\r\nwould be a clue of bigger concern.\r\n\r\nThis doesn't improve initial-broadcast privacy where a spying node\r\nis already connected to the node before transaction first announcement.\"\r\n\r\n(but if b) occurs that's a reliability improvement IMO)",
      "created_at" : "2020-03-19T19:15:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-601366971",
      "id" : 601366971,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwMTM2Njk3MQ==",
      "updated_at" : "2020-03-19T19:20:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/601366971",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r396720480"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/396720480"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "no, simpler.. just mean some transactions will get filtered & not relayed because of `filterInventoryKnown`. this was a result of the confusion & conversation in https://github.com/bitcoin/bitcoin/pull/18038#discussion_r385865086. \r\n\r\nbut maybe without that context this comment is misleading? appreciate any feedback on how to clarify. right now I'm thinking of just deleting the second paragraph. ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-23T19:57:29Z",
      "diff_hunk" : "@@ -779,6 +779,23 @@ void PeerLogicValidation::InitializeNode(CNode *pnode) {\n         PushNodeVersion(pnode, connman, GetTime());\n }\n \n+// We don't force an attempt to relay unbroadcast txns by directly adding them\n+// to setInventoryTxToSend, but instead pass to PushInventory which checks\n+// filterInventoryKnown.\n+//\n+// Passing txns through the bloom filter has a stronger privacy model, but weaker\n+// delivery guarantees. Under certain network & node conditions, it may still\n+// take an extended period of time for the transaction to be initially broadcast\n+// to the network.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r396720480",
      "id" : 396720480,
      "in_reply_to_id" : 394470334,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjcyMDQ4MA==",
      "original_commit_id" : "2f3f449dc9c89420a444cc8263c5a5fe537a475b",
      "original_line" : 789,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 379776210,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/396720480",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r396721669"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/396721669"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why would `filterInventoryKnown` return a match when the transaction was initially never sent out to that peer?",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-23T19:59:40Z",
      "diff_hunk" : "@@ -779,6 +779,23 @@ void PeerLogicValidation::InitializeNode(CNode *pnode) {\n         PushNodeVersion(pnode, connman, GetTime());\n }\n \n+// We don't force an attempt to relay unbroadcast txns by directly adding them\n+// to setInventoryTxToSend, but instead pass to PushInventory which checks\n+// filterInventoryKnown.\n+//\n+// Passing txns through the bloom filter has a stronger privacy model, but weaker\n+// delivery guarantees. Under certain network & node conditions, it may still\n+// take an extended period of time for the transaction to be initially broadcast\n+// to the network.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r396721669",
      "id" : 396721669,
      "in_reply_to_id" : 394470334,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjcyMTY2OQ==",
      "original_commit_id" : "2f3f449dc9c89420a444cc8263c5a5fe537a475b",
      "original_line" : 789,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 379777685,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/396721669",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r396788390"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/396788390"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "eg. if you disconnect wifi & submit a txn to your mempool. code will add to the bloom filters but the transaction never actually went anywhere ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-23T22:13:42Z",
      "diff_hunk" : "@@ -779,6 +779,23 @@ void PeerLogicValidation::InitializeNode(CNode *pnode) {\n         PushNodeVersion(pnode, connman, GetTime());\n }\n \n+// We don't force an attempt to relay unbroadcast txns by directly adding them\n+// to setInventoryTxToSend, but instead pass to PushInventory which checks\n+// filterInventoryKnown.\n+//\n+// Passing txns through the bloom filter has a stronger privacy model, but weaker\n+// delivery guarantees. Under certain network & node conditions, it may still\n+// take an extended period of time for the transaction to be initially broadcast\n+// to the network.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r396788390",
      "id" : 396788390,
      "in_reply_to_id" : 394470334,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc4ODM5MA==",
      "original_commit_id" : "2f3f449dc9c89420a444cc8263c5a5fe537a475b",
      "original_line" : 789,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 379861725,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/396788390",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r397477029"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397477029"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "so, are you proposing \r\n- remove writing the boolean `has_unbroadcast_txns` to the file [here](https://github.com/bitcoin/bitcoin/pull/18038/files#diff-24efdb00bfbe56b140fb006b562cc70bR5121)\r\n- remove try block above, just leave the `file>>pool.m_unbroadcast_txids;` code below \r\n- if there are no `m_unbroadcast_txids`, there will be a `LogPrintf` that \"Failed to deserialize mempool data on disk. Continuing anyway\", and code moves on? \r\n\r\nif I am interpreting correctly.... I find that to be very misleading user output. And I'd expect it to happen frequently since the unbroadcast set is more of a safety mechanism and hopefully nodes aren't often shutting down without their local transactions being broadcast to the network. So I'm not really seeing the reasoning / benefits. But maybe I'm misunderstanding your suggestion.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-24T21:38:06Z",
      "diff_hunk" : "@@ -5045,12 +5046,30 @@ bool LoadMempool(CTxMemPool& pool)\n         for (const auto& i : mapDeltas) {\n             pool.PrioritiseTransaction(i.first, i.second);\n         }\n+\n+        // check if there are unbroadcast transactions\n+        bool has_unbroadcast_txns = false;\n+\n+        try {\n+            file >> has_unbroadcast_txns;\n+        } catch (const std::exception &e) {\n+            // eof gets set when we try to read the end of the file\n+            // so specifically catch expected error and move on.\n+            if (!file.eof()) throw e;\n+        }\n+\n+        if (has_unbroadcast_txns) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r397477029",
      "id" : 397477029,
      "in_reply_to_id" : 394483205,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQ3NzAyOQ==",
      "original_commit_id" : "b0f6a238335d96c9f5f7c2b83aabd56ab4f47a71",
      "original_line" : 5061,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 380715909,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397477029",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r397535101"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397535101"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "yeah great point. p2p fingerprints are never good. thanks for pointing out. \r\n\r\nhaving `AttemptInitialBroadcast` call `ScheduleNextInitialBroadcast` to schedule the next `AttemptInitialBroadcast` seems a bit much to me (and I'd have to pass the scheduler through anyways), so I'll just schedule the next invocation at the end of the function itself. ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-25T00:05:58Z",
      "diff_hunk" : "@@ -2345,6 +2342,11 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n     // Dump network addresses\n     scheduler.scheduleEvery([this] { DumpAddresses(); }, DUMP_PEERS_INTERVAL);\n \n+    // Periodically attempt to broadcast transactions that have not yet been acknowledged by the network\n+    // To ensure impossibility of network-wide synchronization event, stagger retry intervals between 10-15 minutes.\n+    std::chrono::seconds reattempt_broadcast_interval = std::chrono::seconds(10*60 + GetRand(5*60));\n+    scheduler.scheduleEvery([this]{this->AttemptInitialBroadcast();}, std::chrono::milliseconds(reattempt_broadcast_interval));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r397535101",
      "id" : 397535101,
      "in_reply_to_id" : 394455686,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzUzNTEwMQ==",
      "original_commit_id" : "2f3f449dc9c89420a444cc8263c5a5fe537a475b",
      "original_line" : 2348,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 380779869,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397535101",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r397536773"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397536773"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The logprint should only happen on node update. A serialized empty set is hopefully different from no serialized set.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-25T00:11:11Z",
      "diff_hunk" : "@@ -5045,12 +5046,30 @@ bool LoadMempool(CTxMemPool& pool)\n         for (const auto& i : mapDeltas) {\n             pool.PrioritiseTransaction(i.first, i.second);\n         }\n+\n+        // check if there are unbroadcast transactions\n+        bool has_unbroadcast_txns = false;\n+\n+        try {\n+            file >> has_unbroadcast_txns;\n+        } catch (const std::exception &e) {\n+            // eof gets set when we try to read the end of the file\n+            // so specifically catch expected error and move on.\n+            if (!file.eof()) throw e;\n+        }\n+\n+        if (has_unbroadcast_txns) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r397536773",
      "id" : 397536773,
      "in_reply_to_id" : 394483205,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzUzNjc3Mw==",
      "original_commit_id" : "b0f6a238335d96c9f5f7c2b83aabd56ab4f47a71",
      "original_line" : 5061,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 380781575,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397536773",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r397537337"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397537337"
         }
      },
      "author_association" : "MEMBER",
      "body" : "See here:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/5236b2e267a58870239673c7ec85e5df0cb8fc8e/src/serialize.h#L972",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-25T00:12:58Z",
      "diff_hunk" : "@@ -5045,12 +5046,30 @@ bool LoadMempool(CTxMemPool& pool)\n         for (const auto& i : mapDeltas) {\n             pool.PrioritiseTransaction(i.first, i.second);\n         }\n+\n+        // check if there are unbroadcast transactions\n+        bool has_unbroadcast_txns = false;\n+\n+        try {\n+            file >> has_unbroadcast_txns;\n+        } catch (const std::exception &e) {\n+            // eof gets set when we try to read the end of the file\n+            // so specifically catch expected error and move on.\n+            if (!file.eof()) throw e;\n+        }\n+\n+        if (has_unbroadcast_txns) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r397537337",
      "id" : 397537337,
      "in_reply_to_id" : 394483205,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzUzNzMzNw==",
      "original_commit_id" : "b0f6a238335d96c9f5f7c2b83aabd56ab4f47a71",
      "original_line" : 5061,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 380782148,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397537337",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r397549618"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397549618"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yeah, so in normal case we'll get this error once: when the node is updated to use this code, and attempts to use the file from previous runs. Which is, yeah, not ideal, but probably fine.\r\nIf you'd really want to avoid that, I'd rather add versioning of the file, rather than having bools like that you suggest.\r\n(See how we do versioning in peers.dat AddrMan serialization if interested)",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-25T00:55:31Z",
      "diff_hunk" : "@@ -5045,12 +5046,30 @@ bool LoadMempool(CTxMemPool& pool)\n         for (const auto& i : mapDeltas) {\n             pool.PrioritiseTransaction(i.first, i.second);\n         }\n+\n+        // check if there are unbroadcast transactions\n+        bool has_unbroadcast_txns = false;\n+\n+        try {\n+            file >> has_unbroadcast_txns;\n+        } catch (const std::exception &e) {\n+            // eof gets set when we try to read the end of the file\n+            // so specifically catch expected error and move on.\n+            if (!file.eof()) throw e;\n+        }\n+\n+        if (has_unbroadcast_txns) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r397549618",
      "id" : 397549618,
      "in_reply_to_id" : 394483205,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU0OTYxOA==",
      "original_commit_id" : "b0f6a238335d96c9f5f7c2b83aabd56ab4f47a71",
      "original_line" : 5061,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 380795029,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397549618",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r397914899"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397914899"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This file is already versioned, but the version shouldn't be bumped because that will silently drop *all* transactions of the mempool",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-25T14:49:41Z",
      "diff_hunk" : "@@ -5045,12 +5046,30 @@ bool LoadMempool(CTxMemPool& pool)\n         for (const auto& i : mapDeltas) {\n             pool.PrioritiseTransaction(i.first, i.second);\n         }\n+\n+        // check if there are unbroadcast transactions\n+        bool has_unbroadcast_txns = false;\n+\n+        try {\n+            file >> has_unbroadcast_txns;\n+        } catch (const std::exception &e) {\n+            // eof gets set when we try to read the end of the file\n+            // so specifically catch expected error and move on.\n+            if (!file.eof()) throw e;\n+        }\n+\n+        if (has_unbroadcast_txns) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r397914899",
      "id" : 397914899,
      "in_reply_to_id" : 394483205,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkxNDg5OQ==",
      "original_commit_id" : "b0f6a238335d96c9f5f7c2b83aabd56ab4f47a71",
      "original_line" : 5061,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 381222756,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397914899",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r397970619"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397970619"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why does it have to drop all transactions? The new code can just be aware of the previous version, and not attempt to read unbroadcast_txs in that case, but just carefully read all old transactions (the advantage over this current PR is that no error is thrown/logged).",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-25T15:58:40Z",
      "diff_hunk" : "@@ -5045,12 +5046,30 @@ bool LoadMempool(CTxMemPool& pool)\n         for (const auto& i : mapDeltas) {\n             pool.PrioritiseTransaction(i.first, i.second);\n         }\n+\n+        // check if there are unbroadcast transactions\n+        bool has_unbroadcast_txns = false;\n+\n+        try {\n+            file >> has_unbroadcast_txns;\n+        } catch (const std::exception &e) {\n+            // eof gets set when we try to read the end of the file\n+            // so specifically catch expected error and move on.\n+            if (!file.eof()) throw e;\n+        }\n+\n+        if (has_unbroadcast_txns) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r397970619",
      "id" : 397970619,
      "in_reply_to_id" : 394483205,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk3MDYxOQ==",
      "original_commit_id" : "b0f6a238335d96c9f5f7c2b83aabd56ab4f47a71",
      "original_line" : 5061,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 381293207,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397970619",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r397982629"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397982629"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Why does it have to drop all transactions?\r\n\r\nWhen bumping the version here and assuming the code is merged into 0.21.0, then reading a mempool.dat created by Bitcoin Core 0.21.0 will fail completely on a Bitcoin Core 0.20.0, because the code is already released and the logic of that code is to drop all transactions when the version is not equal to 1.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-25T16:14:03Z",
      "diff_hunk" : "@@ -5045,12 +5046,30 @@ bool LoadMempool(CTxMemPool& pool)\n         for (const auto& i : mapDeltas) {\n             pool.PrioritiseTransaction(i.first, i.second);\n         }\n+\n+        // check if there are unbroadcast transactions\n+        bool has_unbroadcast_txns = false;\n+\n+        try {\n+            file >> has_unbroadcast_txns;\n+        } catch (const std::exception &e) {\n+            // eof gets set when we try to read the end of the file\n+            // so specifically catch expected error and move on.\n+            if (!file.eof()) throw e;\n+        }\n+\n+        if (has_unbroadcast_txns) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r397982629",
      "id" : 397982629,
      "in_reply_to_id" : 394483205,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk4MjYyOQ==",
      "original_commit_id" : "b0f6a238335d96c9f5f7c2b83aabd56ab4f47a71",
      "original_line" : 5061,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 381307997,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397982629",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r397986621"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397986621"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "True. But who would use a mempool.dat from 0.21 on 0.20 node? I would say the most common scenario is opposite, upgrading from 0.20 to 0.21.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-25T16:19:19Z",
      "diff_hunk" : "@@ -5045,12 +5046,30 @@ bool LoadMempool(CTxMemPool& pool)\n         for (const auto& i : mapDeltas) {\n             pool.PrioritiseTransaction(i.first, i.second);\n         }\n+\n+        // check if there are unbroadcast transactions\n+        bool has_unbroadcast_txns = false;\n+\n+        try {\n+            file >> has_unbroadcast_txns;\n+        } catch (const std::exception &e) {\n+            // eof gets set when we try to read the end of the file\n+            // so specifically catch expected error and move on.\n+            if (!file.eof()) throw e;\n+        }\n+\n+        if (has_unbroadcast_txns) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r397986621",
      "id" : 397986621,
      "in_reply_to_id" : 394483205,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk4NjYyMQ==",
      "original_commit_id" : "b0f6a238335d96c9f5f7c2b83aabd56ab4f47a71",
      "original_line" : 5061,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 381312926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397986621",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r397989382"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397989382"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Miners might want to upgrade, test the new version for a bit and then downgrade temporarily because they noticed an RPC breaking change. They should be able to continue mining on the txs they had before. For many users, a version upgrade/downgrade is the only time they restart the node. So this is the only time when this code is run and can provide them with value. If the code fails to be useful in the only use-case we might as well remove it altogether. ;)",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-25T16:22:58Z",
      "diff_hunk" : "@@ -5045,12 +5046,30 @@ bool LoadMempool(CTxMemPool& pool)\n         for (const auto& i : mapDeltas) {\n             pool.PrioritiseTransaction(i.first, i.second);\n         }\n+\n+        // check if there are unbroadcast transactions\n+        bool has_unbroadcast_txns = false;\n+\n+        try {\n+            file >> has_unbroadcast_txns;\n+        } catch (const std::exception &e) {\n+            // eof gets set when we try to read the end of the file\n+            // so specifically catch expected error and move on.\n+            if (!file.eof()) throw e;\n+        }\n+\n+        if (has_unbroadcast_txns) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r397989382",
      "id" : 397989382,
      "in_reply_to_id" : 394483205,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk4OTM4Mg==",
      "original_commit_id" : "b0f6a238335d96c9f5f7c2b83aabd56ab4f47a71",
      "original_line" : 5061,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 381316387,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397989382",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r397990626"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397990626"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If you guys think that a try-catch is useful to avoid the debug LogPrint, fine. I am ok with that too. But I don't see a reason for this boolean.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-25T16:24:34Z",
      "diff_hunk" : "@@ -5045,12 +5046,30 @@ bool LoadMempool(CTxMemPool& pool)\n         for (const auto& i : mapDeltas) {\n             pool.PrioritiseTransaction(i.first, i.second);\n         }\n+\n+        // check if there are unbroadcast transactions\n+        bool has_unbroadcast_txns = false;\n+\n+        try {\n+            file >> has_unbroadcast_txns;\n+        } catch (const std::exception &e) {\n+            // eof gets set when we try to read the end of the file\n+            // so specifically catch expected error and move on.\n+            if (!file.eof()) throw e;\n+        }\n+\n+        if (has_unbroadcast_txns) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r397990626",
      "id" : 397990626,
      "in_reply_to_id" : 394483205,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk5MDYyNg==",
      "original_commit_id" : "b0f6a238335d96c9f5f7c2b83aabd56ab4f47a71",
      "original_line" : 5061,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 381317881,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397990626",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r397996259"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397996259"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I also don't see a good reason for this boolean.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-25T16:31:58Z",
      "diff_hunk" : "@@ -5045,12 +5046,30 @@ bool LoadMempool(CTxMemPool& pool)\n         for (const auto& i : mapDeltas) {\n             pool.PrioritiseTransaction(i.first, i.second);\n         }\n+\n+        // check if there are unbroadcast transactions\n+        bool has_unbroadcast_txns = false;\n+\n+        try {\n+            file >> has_unbroadcast_txns;\n+        } catch (const std::exception &e) {\n+            // eof gets set when we try to read the end of the file\n+            // so specifically catch expected error and move on.\n+            if (!file.eof()) throw e;\n+        }\n+\n+        if (has_unbroadcast_txns) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r397996259",
      "id" : 397996259,
      "in_reply_to_id" : 394483205,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk5NjI1OQ==",
      "original_commit_id" : "b0f6a238335d96c9f5f7c2b83aabd56ab4f47a71",
      "original_line" : 5061,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 381324723,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397996259",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r398190554"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398190554"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ok! I'm following now. I wasn't aware of the serialization logic. I'll remove the bool & try-catch as well. thanks!",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-25T21:47:21Z",
      "diff_hunk" : "@@ -5045,12 +5046,30 @@ bool LoadMempool(CTxMemPool& pool)\n         for (const auto& i : mapDeltas) {\n             pool.PrioritiseTransaction(i.first, i.second);\n         }\n+\n+        // check if there are unbroadcast transactions\n+        bool has_unbroadcast_txns = false;\n+\n+        try {\n+            file >> has_unbroadcast_txns;\n+        } catch (const std::exception &e) {\n+            // eof gets set when we try to read the end of the file\n+            // so specifically catch expected error and move on.\n+            if (!file.eof()) throw e;\n+        }\n+\n+        if (has_unbroadcast_txns) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r398190554",
      "id" : 398190554,
      "in_reply_to_id" : 394483205,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODE5MDU1NA==",
      "original_commit_id" : "b0f6a238335d96c9f5f7c2b83aabd56ab4f47a71",
      "original_line" : 5061,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 381561194,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398190554",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r398192894"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398192894"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "this is awesome! thanks for the patch. I was also realizing there's a simpler flow via `RelayTransaction`, but I agree that kicking off the process in `PeerLogicValidation` constructor makes more sense conceptually than `CConnman::Start`. Also I like your rename to `ReattemptInitialBroadcast`, small change but makes intentions more obvious. Thank you! ðð½",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-25T21:52:07Z",
      "diff_hunk" : "@@ -2345,6 +2342,11 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n     // Dump network addresses\n     scheduler.scheduleEvery([this] { DumpAddresses(); }, DUMP_PEERS_INTERVAL);\n \n+    // Periodically attempt to broadcast transactions that have not yet been acknowledged by the network\n+    // To ensure impossibility of network-wide synchronization event, stagger retry intervals between 10-15 minutes.\n+    std::chrono::seconds reattempt_broadcast_interval = std::chrono::seconds(10*60 + GetRand(5*60));\n+    scheduler.scheduleEvery([this]{this->AttemptInitialBroadcast();}, std::chrono::milliseconds(reattempt_broadcast_interval));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r398192894",
      "id" : 398192894,
      "in_reply_to_id" : 395248783,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODE5Mjg5NA==",
      "original_commit_id" : "2f3f449dc9c89420a444cc8263c5a5fe537a475b",
      "original_line" : 2348,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 381563859,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398192894",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r398637924"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398637924"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Indeed nice patch @ariard ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-26T14:56:13Z",
      "diff_hunk" : "@@ -2345,6 +2342,11 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n     // Dump network addresses\n     scheduler.scheduleEvery([this] { DumpAddresses(); }, DUMP_PEERS_INTERVAL);\n \n+    // Periodically attempt to broadcast transactions that have not yet been acknowledged by the network\n+    // To ensure impossibility of network-wide synchronization event, stagger retry intervals between 10-15 minutes.\n+    std::chrono::seconds reattempt_broadcast_interval = std::chrono::seconds(10*60 + GetRand(5*60));\n+    scheduler.scheduleEvery([this]{this->AttemptInitialBroadcast();}, std::chrono::milliseconds(reattempt_broadcast_interval));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r398637924",
      "id" : 398637924,
      "in_reply_to_id" : 395248783,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYzNzkyNA==",
      "original_commit_id" : "2f3f449dc9c89420a444cc8263c5a5fe537a475b",
      "original_line" : 2348,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 382092222,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398637924",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r398721924"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398721924"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "pass on this one. the `num` var gets compiled out regardless, and I personally think its much clearer to have it broken out, and helps indicate that erasing returns a number thats evaluated for the if statement",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-26T16:41:11Z",
      "diff_hunk" : "@@ -1605,7 +1605,21 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n                     push = true;\n                 }\n             }\n-            if (!push) {\n+\n+            if (push) {\n+                int num = 0;\n+\n+                // We intepret processing a GETDATA for a transaction as a successful initial broadcast\n+                // and remove it from our unbroadcast set.\n+                {\n+                    LOCK(mempool.cs);\n+                    num = mempool.m_unbroadcast_txids.erase(inv.hash);\n+                }\n+\n+                if (num) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r398721924",
      "id" : 398721924,
      "in_reply_to_id" : 394440617,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcyMTkyNA==",
      "original_commit_id" : "77748da2269bd7f2304ebc3b8616d3a584e7c65f",
      "original_line" : 1631,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 382197900,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398721924",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r398722015"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398722015"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "fixed ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-26T16:41:20Z",
      "diff_hunk" : "@@ -78,6 +78,10 @@ TransactionError BroadcastTransaction(NodeContext& node, const CTransactionRef t\n     }\n \n     if (relay) {\n+        // the mempool tracks locally submitted transactions to make a\n+        // best-effort of initial broadcast\n+        WITH_LOCK(mempool.cs, mempool.m_unbroadcast_txids.insert(hashTx));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r398722015",
      "id" : 398722015,
      "in_reply_to_id" : 394443323,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcyMjAxNQ==",
      "original_commit_id" : "77748da2269bd7f2304ebc3b8616d3a584e7c65f",
      "original_line" : 83,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/node/transaction.cpp",
      "position" : null,
      "pull_request_review_id" : 382198019,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398722015",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r398722892"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398722892"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "fixed. thanks!",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-26T16:42:29Z",
      "diff_hunk" : "@@ -2345,6 +2342,11 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n     // Dump network addresses\n     scheduler.scheduleEvery([this] { DumpAddresses(); }, DUMP_PEERS_INTERVAL);\n \n+    // Periodically attempt to broadcast transactions that have not yet been acknowledged by the network\n+    // To ensure impossibility of network-wide synchronization event, stagger retry intervals between 10-15 minutes.\n+    std::chrono::seconds reattempt_broadcast_interval = std::chrono::seconds(10*60 + GetRand(5*60));\n+    scheduler.scheduleEvery([this]{this->AttemptInitialBroadcast();}, std::chrono::milliseconds(reattempt_broadcast_interval));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r398722892",
      "id" : 398722892,
      "in_reply_to_id" : 394455686,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcyMjg5Mg==",
      "original_commit_id" : "2f3f449dc9c89420a444cc8263c5a5fe537a475b",
      "original_line" : 2348,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 382199085,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398722892",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r398724101"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398724101"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "method no longer exists, but pass by reference for `ReattemptInitialBroadcast`",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-26T16:44:06Z",
      "diff_hunk" : "@@ -779,6 +779,23 @@ void PeerLogicValidation::InitializeNode(CNode *pnode) {\n         PushNodeVersion(pnode, connman, GetTime());\n }\n \n+// We don't force an attempt to relay unbroadcast txns by directly adding them\n+// to setInventoryTxToSend, but instead pass to PushInventory which checks\n+// filterInventoryKnown.\n+//\n+// Passing txns through the bloom filter has a stronger privacy model, but weaker\n+// delivery guarantees. Under certain network & node conditions, it may still\n+// take an extended period of time for the transaction to be initially broadcast\n+// to the network.\n+void PeerLogicValidation::QueueUnbroadcastTxs(CNode* pnode)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r398724101",
      "id" : 398724101,
      "in_reply_to_id" : 394459225,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcyNDEwMQ==",
      "original_commit_id" : "2f3f449dc9c89420a444cc8263c5a5fe537a475b",
      "original_line" : 790,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 382200605,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398724101",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r398724543"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398724543"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "method no longer exists, but fixed in `ReattemptInitialBroadcast`",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-26T16:44:38Z",
      "diff_hunk" : "@@ -779,6 +779,23 @@ void PeerLogicValidation::InitializeNode(CNode *pnode) {\n         PushNodeVersion(pnode, connman, GetTime());\n }\n \n+// We don't force an attempt to relay unbroadcast txns by directly adding them\n+// to setInventoryTxToSend, but instead pass to PushInventory which checks\n+// filterInventoryKnown.\n+//\n+// Passing txns through the bloom filter has a stronger privacy model, but weaker\n+// delivery guarantees. Under certain network & node conditions, it may still\n+// take an extended period of time for the transaction to be initially broadcast\n+// to the network.\n+void PeerLogicValidation::QueueUnbroadcastTxs(CNode* pnode)\n+{\n+    LOCK(mempool.cs);\n+    for(const uint256& txid : mempool.m_unbroadcast_txids){",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r398724543",
      "id" : 398724543,
      "in_reply_to_id" : 394459527,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcyNDU0Mw==",
      "original_commit_id" : "2f3f449dc9c89420a444cc8263c5a5fe537a475b",
      "original_line" : 793,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 382201094,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398724543",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r398726113"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398726113"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "updated this so comment above `ReattemptInitialBroadcast` just notes that unbroadcast txs will be passed through `filterInventoryKnown`. Leaving the tradeoff analysis for reviewers / future people writing code. ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-26T16:46:43Z",
      "diff_hunk" : "@@ -779,6 +779,23 @@ void PeerLogicValidation::InitializeNode(CNode *pnode) {\n         PushNodeVersion(pnode, connman, GetTime());\n }\n \n+// We don't force an attempt to relay unbroadcast txns by directly adding them\n+// to setInventoryTxToSend, but instead pass to PushInventory which checks\n+// filterInventoryKnown.\n+//\n+// Passing txns through the bloom filter has a stronger privacy model, but weaker\n+// delivery guarantees. Under certain network & node conditions, it may still\n+// take an extended period of time for the transaction to be initially broadcast\n+// to the network.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r398726113",
      "id" : 398726113,
      "in_reply_to_id" : 394470334,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcyNjExMw==",
      "original_commit_id" : "2f3f449dc9c89420a444cc8263c5a5fe537a475b",
      "original_line" : 789,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 382203055,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398726113",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r398726490"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398726490"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Method no longer exists but made `ReattemptInitialBroadcast` const. ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-26T16:47:10Z",
      "diff_hunk" : "@@ -75,7 +75,8 @@ class PeerLogicValidation final : public CValidationInterface, public NetEventsI\n     void CheckForStaleTipAndEvictPeers(const Consensus::Params &consensusParams);\n     /** If we have extra outbound peers, try to disconnect the one with the oldest block announcement */\n     void EvictExtraOutboundPeers(int64_t time_in_seconds) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n-\n+    /** Retrieve unbroadcast transactions from the mempool and possibly send to pnode */\n+    void QueueUnbroadcastTxs(CNode* pnode) override;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r398726490",
      "id" : 398726490,
      "in_reply_to_id" : 394470902,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcyNjQ5MA==",
      "original_commit_id" : "2f3f449dc9c89420a444cc8263c5a5fe537a475b",
      "original_line" : 79,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net_processing.h",
      "position" : null,
      "pull_request_review_id" : 382203505,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398726490",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r398727249"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398727249"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "fixed! thanks for the style tips ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-26T16:48:12Z",
      "diff_hunk" : "@@ -0,0 +1,121 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+from io import BytesIO\n+import time\n+\n+from test_framework.blocktools import create_block, create_coinbase\n+from test_framework.messages import ToHex, CTransaction\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+        assert_equal,\n+        disconnect_nodes,\n+        connect_nodes,\n+        create_confirmed_utxos,\n+        wait_until,\n+        hex_str_to_bytes",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r398727249",
      "id" : 398727249,
      "in_reply_to_id" : 394474255,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcyNzI0OQ==",
      "original_commit_id" : "f40f6875f5570cb25882d8a04a6cbeb61ee7366d",
      "original_line" : 21,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : null,
      "pull_request_review_id" : 382204460,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398727249",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r398727457"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398727457"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "fixed ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-26T16:48:30Z",
      "diff_hunk" : "@@ -0,0 +1,121 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+from io import BytesIO\n+import time\n+\n+from test_framework.blocktools import create_block, create_coinbase\n+from test_framework.messages import ToHex, CTransaction\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+        assert_equal,\n+        disconnect_nodes,\n+        connect_nodes,\n+        create_confirmed_utxos,\n+        wait_until,\n+        hex_str_to_bytes\n+)\n+\n+class MempoolUnbroadcastTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.test_broadcast()\n+        self.test_txn_removal()\n+\n+    def test_broadcast(self):\n+        self.log.info(\"Test that mempool reattempts delivery of locally submitted transaction\")\n+        node = self.nodes[0]\n+\n+        min_relay_fee = node.getnetworkinfo()[\"relayfee\"]\n+        utxos = create_confirmed_utxos(min_relay_fee, node, 10)\n+\n+        disconnect_nodes(node, 1)\n+\n+        self.log.info(\"Generate transactions that only node 0 knows about\")\n+        # generate a wallet txn\n+        addr = node.getnewaddress()\n+        wallet_tx_hsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # generate a txn using sendrawtransaction\n+        us0 = utxos.pop()\n+        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n+        outputs = {addr: 0.0001}\n+        tx = node.createrawtransaction(inputs, outputs)\n+        node.settxfee(min_relay_fee)\n+        txF = node.fundrawtransaction(tx)\n+        txFS = node.signrawtransactionwithwallet(txF['hex'])\n+        rpc_tx_hsh = node.sendrawtransaction(txFS['hex'])  # txhsh in hex\n+\n+        # check that second node doesn't have these two txns\n+        mempool = self.nodes[1].getrawmempool()\n+        assert(rpc_tx_hsh not in mempool)\n+        assert(wallet_tx_hsh not in mempool)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r398727457",
      "id" : 398727457,
      "in_reply_to_id" : 394475575,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcyNzQ1Nw==",
      "original_commit_id" : "f40f6875f5570cb25882d8a04a6cbeb61ee7366d",
      "original_line" : 62,
      "original_position" : 62,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : null,
      "pull_request_review_id" : 382204741,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398727457",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r398727723"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398727723"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "good idea! updated.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-26T16:48:46Z",
      "diff_hunk" : "@@ -0,0 +1,121 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+from io import BytesIO\n+import time\n+\n+from test_framework.blocktools import create_block, create_coinbase\n+from test_framework.messages import ToHex, CTransaction\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+        assert_equal,\n+        disconnect_nodes,\n+        connect_nodes,\n+        create_confirmed_utxos,\n+        wait_until,\n+        hex_str_to_bytes\n+)\n+\n+class MempoolUnbroadcastTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.test_broadcast()\n+        self.test_txn_removal()\n+\n+    def test_broadcast(self):\n+        self.log.info(\"Test that mempool reattempts delivery of locally submitted transaction\")\n+        node = self.nodes[0]\n+\n+        min_relay_fee = node.getnetworkinfo()[\"relayfee\"]\n+        utxos = create_confirmed_utxos(min_relay_fee, node, 10)\n+\n+        disconnect_nodes(node, 1)\n+\n+        self.log.info(\"Generate transactions that only node 0 knows about\")\n+        # generate a wallet txn\n+        addr = node.getnewaddress()\n+        wallet_tx_hsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # generate a txn using sendrawtransaction\n+        us0 = utxos.pop()\n+        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n+        outputs = {addr: 0.0001}\n+        tx = node.createrawtransaction(inputs, outputs)\n+        node.settxfee(min_relay_fee)\n+        txF = node.fundrawtransaction(tx)\n+        txFS = node.signrawtransactionwithwallet(txF['hex'])\n+        rpc_tx_hsh = node.sendrawtransaction(txFS['hex'])  # txhsh in hex\n+\n+        # check that second node doesn't have these two txns\n+        mempool = self.nodes[1].getrawmempool()\n+        assert(rpc_tx_hsh not in mempool)\n+        assert(wallet_tx_hsh not in mempool)\n+\n+        self.log.info(\"Reconnect nodes & check if they are sent to node 1\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r398727723",
      "id" : 398727723,
      "in_reply_to_id" : 394476596,
      "line" : 64,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcyNzcyMw==",
      "original_commit_id" : "f40f6875f5570cb25882d8a04a6cbeb61ee7366d",
      "original_line" : 64,
      "original_position" : 64,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : 64,
      "pull_request_review_id" : 382204980,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398727723",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r398727977"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398727977"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "updated ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-26T16:49:04Z",
      "diff_hunk" : "@@ -0,0 +1,121 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+from io import BytesIO\n+import time\n+\n+from test_framework.blocktools import create_block, create_coinbase\n+from test_framework.messages import ToHex, CTransaction\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+        assert_equal,\n+        disconnect_nodes,\n+        connect_nodes,\n+        create_confirmed_utxos,\n+        wait_until,\n+        hex_str_to_bytes\n+)\n+\n+class MempoolUnbroadcastTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.test_broadcast()\n+        self.test_txn_removal()\n+\n+    def test_broadcast(self):\n+        self.log.info(\"Test that mempool reattempts delivery of locally submitted transaction\")\n+        node = self.nodes[0]\n+\n+        min_relay_fee = node.getnetworkinfo()[\"relayfee\"]\n+        utxos = create_confirmed_utxos(min_relay_fee, node, 10)\n+\n+        disconnect_nodes(node, 1)\n+\n+        self.log.info(\"Generate transactions that only node 0 knows about\")\n+        # generate a wallet txn\n+        addr = node.getnewaddress()\n+        wallet_tx_hsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # generate a txn using sendrawtransaction\n+        us0 = utxos.pop()\n+        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n+        outputs = {addr: 0.0001}\n+        tx = node.createrawtransaction(inputs, outputs)\n+        node.settxfee(min_relay_fee)\n+        txF = node.fundrawtransaction(tx)\n+        txFS = node.signrawtransactionwithwallet(txF['hex'])\n+        rpc_tx_hsh = node.sendrawtransaction(txFS['hex'])  # txhsh in hex\n+\n+        # check that second node doesn't have these two txns\n+        mempool = self.nodes[1].getrawmempool()\n+        assert(rpc_tx_hsh not in mempool)\n+        assert(wallet_tx_hsh not in mempool)\n+\n+        self.log.info(\"Reconnect nodes & check if they are sent to node 1\")\n+        connect_nodes(node, 1)\n+\n+        # fast forward into the future & ensure that the second node has the txns\n+        node.mockscheduler(15*60) # 15 min in seconds\n+        wait_until(lambda: len(self.nodes[1].getrawmempool()) == 2, timeout=30)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r398727977",
      "id" : 398727977,
      "in_reply_to_id" : 394478852,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcyNzk3Nw==",
      "original_commit_id" : "f40f6875f5570cb25882d8a04a6cbeb61ee7366d",
      "original_line" : 69,
      "original_position" : 69,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : null,
      "pull_request_review_id" : 382205284,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398727977",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r398729959"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398729959"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ahahhahaha omg I'm glad its been a while since I wrote this test & I don't remember how long I spent figuring out how to manually make the txn and block ð\r\n\r\ntwo-liner is much cleaner. I feel comfortable with the coverage of wallet & rpc from previous test.\r\n\r\nthanks! ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-26T16:51:39Z",
      "diff_hunk" : "@@ -0,0 +1,121 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+from io import BytesIO\n+import time\n+\n+from test_framework.blocktools import create_block, create_coinbase\n+from test_framework.messages import ToHex, CTransaction\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+        assert_equal,\n+        disconnect_nodes,\n+        connect_nodes,\n+        create_confirmed_utxos,\n+        wait_until,\n+        hex_str_to_bytes\n+)\n+\n+class MempoolUnbroadcastTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.test_broadcast()\n+        self.test_txn_removal()\n+\n+    def test_broadcast(self):\n+        self.log.info(\"Test that mempool reattempts delivery of locally submitted transaction\")\n+        node = self.nodes[0]\n+\n+        min_relay_fee = node.getnetworkinfo()[\"relayfee\"]\n+        utxos = create_confirmed_utxos(min_relay_fee, node, 10)\n+\n+        disconnect_nodes(node, 1)\n+\n+        self.log.info(\"Generate transactions that only node 0 knows about\")\n+        # generate a wallet txn\n+        addr = node.getnewaddress()\n+        wallet_tx_hsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # generate a txn using sendrawtransaction\n+        us0 = utxos.pop()\n+        inputs = [{ \"txid\" : us0[\"txid\"], \"vout\" : us0[\"vout\"]}]\n+        outputs = {addr: 0.0001}\n+        tx = node.createrawtransaction(inputs, outputs)\n+        node.settxfee(min_relay_fee)\n+        txF = node.fundrawtransaction(tx)\n+        txFS = node.signrawtransactionwithwallet(txF['hex'])\n+        rpc_tx_hsh = node.sendrawtransaction(txFS['hex'])  # txhsh in hex\n+\n+        # check that second node doesn't have these two txns\n+        mempool = self.nodes[1].getrawmempool()\n+        assert(rpc_tx_hsh not in mempool)\n+        assert(wallet_tx_hsh not in mempool)\n+\n+        self.log.info(\"Reconnect nodes & check if they are sent to node 1\")\n+        connect_nodes(node, 1)\n+\n+        # fast forward into the future & ensure that the second node has the txns\n+        node.mockscheduler(15*60) # 15 min in seconds\n+        wait_until(lambda: len(self.nodes[1].getrawmempool()) == 2, timeout=30)\n+        mempool = self.nodes[1].getrawmempool()\n+        assert(rpc_tx_hsh in mempool)\n+        assert(wallet_tx_hsh in mempool)\n+\n+        self.log.info(\"Add another connection & ensure transactions aren't broadcast again\")\n+\n+        conn = node.add_p2p_connection(P2PTxInvStore())\n+        node.mockscheduler(15*60)\n+        time.sleep(5)\n+        assert_equal(len(conn.get_invs()), 0)\n+\n+    def test_txn_removal(self):\n+        self.log.info(\"Test that transactions removed from mempool are removed from unbroadcast set\")\n+        node = self.nodes[0]\n+        disconnect_nodes(node, 1)\n+\n+        min_relay_fee = node.getnetworkinfo()[\"relayfee\"]\n+        utxos = create_confirmed_utxos(min_relay_fee, node, 10)\n+\n+        # create a transaction & submit to node\n+        # since the node doesn't have any connections, it will not receive\n+        # any GETDATAs & thus the transaction will remain in the unbroadcast set.\n+        utxo = utxos.pop()\n+        outputs = { node.getnewaddress() : 0.0001 }\n+        inputs = [{'txid': utxo['txid'], 'vout': utxo['vout']}]\n+        raw_tx_hex = node.createrawtransaction(inputs, outputs)\n+        signed_tx = node.signrawtransactionwithwallet(raw_tx_hex)\n+        txhsh = node.sendrawtransaction(hexstring=signed_tx['hex'], maxfeerate=0)\n+\n+        # mine a block with that transaction\n+        block = create_block(int(node.getbestblockhash(), 16), create_coinbase(node.getblockcount() + 1))\n+        tx = CTransaction()\n+        tx.deserialize(BytesIO(hex_str_to_bytes(signed_tx['hex'])))\n+        block.vtx.append(tx)\n+        block.rehash()\n+        block.hashMerkleRoot = block.calc_merkle_root()\n+        block.solve()\n+        node.submitblock(ToHex(block))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r398729959",
      "id" : 398729959,
      "in_reply_to_id" : 394480786,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcyOTk1OQ==",
      "original_commit_id" : "f40f6875f5570cb25882d8a04a6cbeb61ee7366d",
      "original_line" : 107,
      "original_position" : 107,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : null,
      "pull_request_review_id" : 382207805,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398729959",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r398730247"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398730247"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "fixed! thanks again",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-26T16:52:01Z",
      "diff_hunk" : "@@ -5045,12 +5046,30 @@ bool LoadMempool(CTxMemPool& pool)\n         for (const auto& i : mapDeltas) {\n             pool.PrioritiseTransaction(i.first, i.second);\n         }\n+\n+        // check if there are unbroadcast transactions\n+        bool has_unbroadcast_txns = false;\n+\n+        try {\n+            file >> has_unbroadcast_txns;\n+        } catch (const std::exception &e) {\n+            // eof gets set when we try to read the end of the file\n+            // so specifically catch expected error and move on.\n+            if (!file.eof()) throw e;\n+        }\n+\n+        if (has_unbroadcast_txns) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r398730247",
      "id" : 398730247,
      "in_reply_to_id" : 394483205,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODczMDI0Nw==",
      "original_commit_id" : "b0f6a238335d96c9f5f7c2b83aabd56ab4f47a71",
      "original_line" : 5061,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 382208138,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398730247",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r398730775"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398730775"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "incorporated. thanks again! ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-26T16:52:43Z",
      "diff_hunk" : "@@ -2345,6 +2342,11 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n     // Dump network addresses\n     scheduler.scheduleEvery([this] { DumpAddresses(); }, DUMP_PEERS_INTERVAL);\n \n+    // Periodically attempt to broadcast transactions that have not yet been acknowledged by the network\n+    // To ensure impossibility of network-wide synchronization event, stagger retry intervals between 10-15 minutes.\n+    std::chrono::seconds reattempt_broadcast_interval = std::chrono::seconds(10*60 + GetRand(5*60));\n+    scheduler.scheduleEvery([this]{this->AttemptInitialBroadcast();}, std::chrono::milliseconds(reattempt_broadcast_interval));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r398730775",
      "id" : 398730775,
      "in_reply_to_id" : 395248783,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODczMDc3NQ==",
      "original_commit_id" : "2f3f449dc9c89420a444cc8263c5a5fe537a475b",
      "original_line" : 2348,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 382208774,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398730775",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "thank you for the thoughtful reviews! pushed changes incorporating the feedback. \r\n\r\ncurrently looking into CI failures. appveyor is failing on `feature_versionbits_warning.py`, but travis is failing on `mempool_persist`, so I'm investigating. ",
      "created_at" : "2020-03-26T22:35:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-604722444",
      "id" : 604722444,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwNDcyMjQ0NA==",
      "updated_at" : "2020-03-26T22:35:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/604722444",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Previous runs: \r\n* https://ci.appveyor.com/project/DrahtBot/bitcoin/builds/31747734\r\n* https://travis-ci.org/github/bitcoin/bitcoin/builds/667378104\r\n\r\nI think they are intermittent failures, so I am going to re-run this pull\r\n\r\nOpen-Close to re-run ci. See https://github.com/bitcoin/bitcoin/issues/15847#issuecomment-487591130",
      "created_at" : "2020-03-27T00:32:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-604755044",
      "id" : 604755044,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwNDc1NTA0NA==",
      "updated_at" : "2020-03-27T00:32:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/604755044",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "the travis valgrind build is failing on `p2p_permissions` test. \r\n\r\ntrying to make sense of the logs... looks like node1 has an unclean shutdown, possibly because the RPC is attempted to be stopped more than once? \r\nI'm a bit confused because it looks like  `test_framework/authproxy.py` is throwing a `ConnectionResetError` from `_request`, but that method should be catching the error? but I think its thrown for a second time in the `except` block.\r\n\r\ntrying to figure out if this is related to my changes. [earlier in this PR](https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-592167518) what first looked like an unrelated failure to me was actually related because of issues with my lock logic. this time doesn't look like either node is crashing. from what I can discern, looks like node1 having an unclean shutdown because of a failure in an http request. which leads me to thinking its test flakiness.\r\n\r\n@MarcoFalke - thoughts? ",
      "created_at" : "2020-03-30T18:28:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-606165779",
      "id" : 606165779,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwNjE2NTc3OQ==",
      "updated_at" : "2020-03-30T18:38:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/606165779",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@ariard - addressing your 2 outstanding review comments\r\n\r\nRE: wtxid - there is some additional code needed to support unbroadcast set & wtxid relay. I'll work on the patch & depending on timing around which PR is ready for merge first, include the patch here or offer it on the other PR. Thanks again for pointing that out :) \r\n\r\nRE: `filterInventoryKnown` - to make this easier to realize, I mention in a comment above `ReattemptInitialBroadcast`. However, I'm hesitant to impose too much interpretation in the code comments or commit messages, because I want to encourage independent thinking that might conflict with or challenge my own interpretation. Also because there are so many interactions it's kind of impossible to encapsulate them all, and they will also change over time.\r\n\r\nTo be more specific..\r\n> If no GETDATA is processed before mempool initial-broadcast\r\nreattempt period expires, a new announcement is made to every peer. Due\r\nto inventory filter, this is only effective for new peers since last period\r\nexpiration.\r\n\r\nThis is the normal condition, but iirc `filterInventoryKnown` is cleared out based on number of transactions, so maybe under super high traffic network conditions, an announcement is resent to the same peer? \r\n\r\nAnd in regards to the second part of your comment, I don't quite follow..\r\n> Transaction origin privacy would only be worsened if a) among\r\nnew nodes there is a spying one \r\n\r\nSay you have a set of unbroadcast transactions. You attempt initial broadcast, but your wifi is disconnected so they don't go anywhere, but get inserted into `filterInventoryKnown` for your existing connections. A malicious node connects to you. `ReattemptInitialBroadcast` is triggered & you send your wallet transaction to this node. At that time, the node cannot identify that is your transaction with certainty. For it to carry out an attack, it needs to be the ONLY node you submitted the transaction to. Which is possible, but a specific subset of this condition.\r\n\r\n> b) no honest/reliable peers reported back\r\na GETDATA. Given the mempool rebroadcast period length, if b) occurs, that\r\nwould be a clue of bigger concern.\r\n(but if b) occurs that's a reliability improvement IMO)\r\n\r\nso, there are two main reasons a node wouldn't report back a `GETDATA`. Either network issues (it didn't receive announcement, you didn't receive the `GETDATA`). Or it is malicious. If it is occurring because of network issues, it makes sense to try again. Is this the reliability improvement that you are talking about? because thats the main point of this PR :) ",
      "created_at" : "2020-03-30T19:18:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-606190183",
      "id" : 606190183,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwNjE5MDE4Mw==",
      "updated_at" : "2020-03-30T22:14:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/606190183",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r400569145"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400569145"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "from https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-606190183\r\n\r\nRE: wtxid - there is some additional code needed to support unbroadcast set & wtxid relay. I'll work on the patch & depending on timing around which PR is ready for merge first, include the patch here or offer it on the other PR. Thanks again for pointing that out :)",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-03-31T00:14:40Z",
      "diff_hunk" : "@@ -534,6 +534,10 @@ class CTxMemPool\n     const setEntries & GetMemPoolParents(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n     const setEntries & GetMemPoolChildren(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n     uint64_t CalculateDescendantMaximum(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n+\n+    // track locally submitted transactions & periodically retry initial broadcast\n+    std::set<uint256> m_unbroadcast_txids;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r400569145",
      "id" : 400569145,
      "in_reply_to_id" : 393293074,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU2OTE0NQ==",
      "original_commit_id" : "66ec5571ad49b68366e4607cf0b671231083757e",
      "original_line" : 539,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 384319528,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400569145",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ok! travis is green, all current review comments are addressed. \r\n\r\nthis PR is ready for another round of review! \r\nthanks in advance :) ",
      "created_at" : "2020-03-31T00:16:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-606320113",
      "id" : 606320113,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwNjMyMDExMw==",
      "updated_at" : "2020-03-31T00:16:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/606320113",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Do we have any numbers on how important wallet rebroadcasting is? I have a small concern that stopping the \"fast\" initial broadcast after a single successful transmission may sometimes not be enough (e.g. the peer it's sent to goes offline before forwarding it further). This seems unlikely to happen (both we only submitting once, and them failing immediately afterwards), and even if it happens, it wouldn't be a disaster as the once per day rebroadcast would still occur.\r\n\r\nBesides that, concept and code review ACK.",
      "created_at" : "2020-04-02T02:39:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-607588970",
      "id" : 607588970,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwNzU4ODk3MA==",
      "updated_at" : "2020-04-02T02:41:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/607588970",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r402295168"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/402295168"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The same std::chrono value used inside ReattemptInitialBroadcast, maybe this justifies making a constant?",
      "commit_id" : "6307582b4d30167a931678d12e99a00a0e75e81a",
      "created_at" : "2020-04-02T13:03:07Z",
      "diff_hunk" : "@@ -1128,6 +1143,9 @@ PeerLogicValidation::PeerLogicValidation(CConnman* connmanIn, BanMan* banman, CS\n     // timer.\n     static_assert(EXTRA_PEER_CHECK_INTERVAL < STALE_CHECK_INTERVAL, \"peer eviction timer should be less than stale tip check timer\");\n     scheduler.scheduleEvery([this, consensusParams] { this->CheckForStaleTipAndEvictPeers(consensusParams); }, std::chrono::seconds{EXTRA_PEER_CHECK_INTERVAL});\n+\n+    const std::chrono::milliseconds delta = std::chrono::milliseconds(10 * 60 * 1000 + GetRand(5 * 60 * 1000));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r402295168",
      "id" : 402295168,
      "line" : 1147,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI5NTE2OA==",
      "original_commit_id" : "6307582b4d30167a931678d12e99a00a0e75e81a",
      "original_line" : 1147,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 27,
      "pull_request_review_id" : 386402686,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T13:03:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/402295168",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r402301857"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/402301857"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't understand why this condition matters.\r\nI can think about 2 attack vectors:\r\n1. Traditional privacy problem, where someone GETDATAs to probe if you have a transaction. If we remove the condition in this case, no extra privacy leak happens.\r\n2. Where someone preventing you from rebroadcast by sending this unsolicited GETDATA. I'm not sure this is a valid concern and a practical scenario. Were you thinking about this?\r\n\r\nAlso, regrading where push is coming from: afaik mapRelay is not reliable (would it even work in rebroadcast case?), and the second condition is... complicated. \r\n\r\nAnyway, can we at least document why this flag is checked?",
      "commit_id" : "6307582b4d30167a931678d12e99a00a0e75e81a",
      "created_at" : "2020-04-02T13:13:41Z",
      "diff_hunk" : "@@ -1605,7 +1623,15 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n                     push = true;\n                 }\n             }\n-            if (!push) {\n+\n+            if (push) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r402301857",
      "id" : 402301857,
      "line" : 1627,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMwMTg1Nw==",
      "original_commit_id" : "6307582b4d30167a931678d12e99a00a0e75e81a",
      "original_line" : 1627,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 47,
      "pull_request_review_id" : 386411392,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T13:13:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/402301857",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r402304496"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/402304496"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Oh I see you removed REATTEMPT_BROADCAST_INTERVAL, well. Feel free to close this one then.",
      "commit_id" : "6307582b4d30167a931678d12e99a00a0e75e81a",
      "created_at" : "2020-04-02T13:17:36Z",
      "diff_hunk" : "@@ -1128,6 +1143,9 @@ PeerLogicValidation::PeerLogicValidation(CConnman* connmanIn, BanMan* banman, CS\n     // timer.\n     static_assert(EXTRA_PEER_CHECK_INTERVAL < STALE_CHECK_INTERVAL, \"peer eviction timer should be less than stale tip check timer\");\n     scheduler.scheduleEvery([this, consensusParams] { this->CheckForStaleTipAndEvictPeers(consensusParams); }, std::chrono::seconds{EXTRA_PEER_CHECK_INTERVAL});\n+\n+    const std::chrono::milliseconds delta = std::chrono::milliseconds(10 * 60 * 1000 + GetRand(5 * 60 * 1000));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r402304496",
      "id" : 402304496,
      "in_reply_to_id" : 402295168,
      "line" : 1147,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMwNDQ5Ng==",
      "original_commit_id" : "6307582b4d30167a931678d12e99a00a0e75e81a",
      "original_line" : 1147,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 27,
      "pull_request_review_id" : 386414871,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T13:17:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/402304496",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Code review re-ACK",
      "created_at" : "2020-04-02T19:19:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-608054603",
      "id" : 608054603,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwODA1NDYwMw==",
      "updated_at" : "2020-04-02T19:19:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/608054603",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "thanks for the review @sipa! \r\n\r\nunfortunately, I don't have any real-life numbers of wallet rebroadcast usage for getting a transaction initially broadcast. I'd love relevant data. (anyone reading this... ) please let me know if you have any ideas of how I could get relevant info. \r\n\r\nI've mostly been operating in theoretical possibility space & have come to the same conclusion- the likelihood seems slim & there's an additional safety net. in this implementation, it'd be possible to increase the guarantee (eg. ensure we fulfill two `GETDATA` requests instead of one), but the tradeoff hasn't seemed worth it. ",
      "created_at" : "2020-04-02T22:17:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-608120418",
      "id" : 608120418,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwODEyMDQxOA==",
      "updated_at" : "2020-04-02T22:17:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/608120418",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r407647622"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407647622"
         }
      },
      "author_association" : "MEMBER",
      "body" : "e82fdd329c812623c6e8a9022322fe43e1000c5b\r\n\r\n```suggestion\r\n                    LogPrint(BCLog::NET, \"Removed %i from the set of unbroadcast txs\\n\", inv.hash.GetHex());\r\n```\r\n\r\nAny reason for the trailing whitespace?\r\n\r\nAlso, leaking source code names into the debug log might cause parse issues when the symbol is renamed",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-13T18:47:25Z",
      "diff_hunk" : "@@ -1605,7 +1605,15 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n                     push = true;\n                 }\n             }\n-            if (!push) {\n+\n+            if (push) {\n+                // We intepret processing a GETDATA for a transaction as a successful initial broadcast\n+                // and remove it from our unbroadcast set.\n+                int num = WITH_LOCK(mempool.cs, return mempool.m_unbroadcast_txids.erase(inv.hash););\n+                if (num) {\n+                    LogPrint(BCLog::NET, \"Removed %i from m_unbroadcast_txids \\n\", inv.hash.GetHex());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r407647622",
      "id" : 407647622,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY0NzYyMg==",
      "original_commit_id" : "e82fdd329c812623c6e8a9022322fe43e1000c5b",
      "original_line" : 1614,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 392350586,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407647622",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r407648006"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407648006"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        LogPrint(BCLog::NET, \"Removed %i from set of unbroadcast txs before confirmation that txn was sent out\\n\", hash.GetHex());\r\n```\r\n\r\nSame",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-13T18:48:03Z",
      "diff_hunk" : "@@ -417,6 +417,10 @@ void CTxMemPool::removeUnchecked(txiter it, MemPoolRemovalReason reason)\n     for (const CTxIn& txin : it->GetTx().vin)\n         mapNextTx.erase(txin.prevout);\n \n+    if (mempool.m_unbroadcast_txids.erase(hash)) {\n+        LogPrint(BCLog::NET, \"Removed %i from m_unbroadcast_txids before confirmation that txn was sent out. \\n\", hash.GetHex());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r407648006",
      "id" : 407648006,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY0ODAwNg==",
      "original_commit_id" : "e82fdd329c812623c6e8a9022322fe43e1000c5b",
      "original_line" : 421,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 392350586,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407648006",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r407648718"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407648718"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This should probably be a doxygen comment. See the developer notes on how to get one.\r\n```suggestion\r\n    /** track locally submitted transactions & periodically retry initial broadcast */\r\n```",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-13T18:49:09Z",
      "diff_hunk" : "@@ -533,6 +533,10 @@ class CTxMemPool\n     const setEntries & GetMemPoolParents(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n     const setEntries & GetMemPoolChildren(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n     uint64_t CalculateDescendantMaximum(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n+\n+    // track locally submitted transactions & periodically retry initial broadcast",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r407648718",
      "id" : 407648718,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY0ODcxOA==",
      "original_commit_id" : "e82fdd329c812623c6e8a9022322fe43e1000c5b",
      "original_line" : 537,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 392350586,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407648718",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r407652787"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407652787"
         }
      },
      "author_association" : "MEMBER",
      "body" : "a11968c8780424ddb0fd01341101bb28ff6953a8\r\n\r\nSorry, I still don't understand why this comment is relevant to rebroadcasting. I remember in an earlier discussion you mentioned that a user might disconnect their wifi. A tx might get added to filterInventoryKnown, but then never sent out.\r\n\r\nI don't think this is true. Either, we reconnect the wifi and be still connected to the peer, in which case we can push the inv out and wait for them to request the tx. Or, we drop the peer (either because the wifi isn't turned on again, or it took us too long to do so), in which case a new peer will pop up and they will receive the inv (after 10-15 minutes).",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-13T18:56:47Z",
      "diff_hunk" : "@@ -779,6 +779,21 @@ void PeerLogicValidation::InitializeNode(CNode *pnode) {\n         PushNodeVersion(pnode, connman, GetTime());\n }\n \n+// Note: unbroadcast transactions will be filtered through filterInventoryKnown",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r407652787",
      "id" : 407652787,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY1Mjc4Nw==",
      "original_commit_id" : "a11968c8780424ddb0fd01341101bb28ff6953a8",
      "original_line" : 782,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 392350586,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407652787",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r407655025"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407655025"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    const std::chrono::milliseconds delta = std::chrono::minutes{10} + GetRandMillis(std::chrono::minutes{5});\r\n```\r\n\r\nYou might have to add `GetRandMillis` by copying from `GetRandMicros`.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-13T19:00:39Z",
      "diff_hunk" : "@@ -779,6 +779,21 @@ void PeerLogicValidation::InitializeNode(CNode *pnode) {\n         PushNodeVersion(pnode, connman, GetTime());\n }\n \n+// Note: unbroadcast transactions will be filtered through filterInventoryKnown\n+void PeerLogicValidation::ReattemptInitialBroadcast(CScheduler& scheduler) const\n+{\n+    std::set<uint256> unbroadcast_txids;\n+    WITH_LOCK(m_mempool.cs, unbroadcast_txids = m_mempool.m_unbroadcast_txids);\n+\n+    for (const uint256& txid : unbroadcast_txids) {\n+        RelayTransaction(txid, *connman);\n+    }\n+\n+    // schedule next run for 10-15 minutes in the future\n+    const std::chrono::milliseconds delta = std::chrono::milliseconds(10 * 60 * 1000 + GetRand(5 * 60 * 1000));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r407655025",
      "id" : 407655025,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY1NTAyNQ==",
      "original_commit_id" : "a11968c8780424ddb0fd01341101bb28ff6953a8",
      "original_line" : 793,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 392350586,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407655025",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r407664223"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407664223"
         }
      },
      "author_association" : "MEMBER",
      "body" : "6307582b4d30167a931678d12e99a00a0e75e81a\r\n\r\nThis is not safe. You are erasing the existing content of the `m_unbroadcast_txids`",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-13T19:18:00Z",
      "diff_hunk" : "@@ -5023,12 +5024,19 @@ bool LoadMempool(CTxMemPool& pool)\n         for (const auto& i : mapDeltas) {\n             pool.PrioritiseTransaction(i.first, i.second);\n         }\n+\n+        {\n+            LOCK(pool.cs);\n+            file >> pool.m_unbroadcast_txids;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r407664223",
      "id" : 407664223,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY2NDIyMw==",
      "original_commit_id" : "6307582b4d30167a931678d12e99a00a0e75e81a",
      "original_line" : 5030,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 392350586,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407664223",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r407665982"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407665982"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is racy and you might end up with zombie txids here that are never removed because the corresponding mempool tx has not been written to disk",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-13T19:21:04Z",
      "diff_hunk" : "@@ -5072,6 +5080,13 @@ bool DumpMempool(const CTxMemPool& pool)\n         }\n \n         file << mapDeltas;\n+\n+        {\n+            LOCK(pool.cs);\n+            LogPrintf(\"Writing %d unbroadcast transactions to disk.\\n\", pool.m_unbroadcast_txids.size());\n+            file << pool.m_unbroadcast_txids;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r407665982",
      "id" : 407665982,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY2NTk4Mg==",
      "original_commit_id" : "6307582b4d30167a931678d12e99a00a0e75e81a",
      "original_line" : 5087,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 392350586,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/407665982",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r409150876"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/409150876"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is there a reason this is categorized as a NET log? I think it makes more sense as a MEMPOOL, or even uncategorized as a `LogPrintf()`.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-15T21:41:43Z",
      "diff_hunk" : "@@ -417,6 +417,10 @@ void CTxMemPool::removeUnchecked(txiter it, MemPoolRemovalReason reason)\n     for (const CTxIn& txin : it->GetTx().vin)\n         mapNextTx.erase(txin.prevout);\n \n+    if (mempool.m_unbroadcast_txids.erase(hash)) {\n+        LogPrint(BCLog::NET, \"Removed %i from m_unbroadcast_txids before confirmation that txn was sent out. \\n\", hash.GetHex());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r409150876",
      "id" : 409150876,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE1MDg3Ng==",
      "original_commit_id" : "6307582b4d30167a931678d12e99a00a0e75e81a",
      "original_line" : 421,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 394155715,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/409150876",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r409151246"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/409151246"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Agree that it's better to avoid using variable names in logs.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-15T21:42:29Z",
      "diff_hunk" : "@@ -417,6 +417,10 @@ void CTxMemPool::removeUnchecked(txiter it, MemPoolRemovalReason reason)\n     for (const CTxIn& txin : it->GetTx().vin)\n         mapNextTx.erase(txin.prevout);\n \n+    if (mempool.m_unbroadcast_txids.erase(hash)) {\n+        LogPrint(BCLog::NET, \"Removed %i from m_unbroadcast_txids before confirmation that txn was sent out. \\n\", hash.GetHex());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r409151246",
      "id" : 409151246,
      "in_reply_to_id" : 407648006,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE1MTI0Ng==",
      "original_commit_id" : "e82fdd329c812623c6e8a9022322fe43e1000c5b",
      "original_line" : 421,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 394155715,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/409151246",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r409152838"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/409152838"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I also think this whitespace is ugly, but I think you can leave removing it for another time!",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-15T21:45:58Z",
      "diff_hunk" : "@@ -1644,17 +1644,6 @@ void CConnman::ThreadDNSAddressSeed()\n     LogPrintf(\"%d addresses found from DNS seeds\\n\", found);\n }\n \n-",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r409152838",
      "id" : 409152838,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE1MjgzOA==",
      "original_commit_id" : "6307582b4d30167a931678d12e99a00a0e75e81a",
      "original_line" : 1647,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 394155715,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/409152838",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r409159855"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/409159855"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I agree with Marco that this comment can just be removed.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-15T22:01:06Z",
      "diff_hunk" : "@@ -779,6 +779,21 @@ void PeerLogicValidation::InitializeNode(CNode *pnode) {\n         PushNodeVersion(pnode, connman, GetTime());\n }\n \n+// Note: unbroadcast transactions will be filtered through filterInventoryKnown",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r409159855",
      "id" : 409159855,
      "in_reply_to_id" : 407652787,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE1OTg1NQ==",
      "original_commit_id" : "a11968c8780424ddb0fd01341101bb28ff6953a8",
      "original_line" : 782,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 394155715,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/409159855",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r409163442"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/409163442"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I prefer all classes in the framework to have a docstring, even if it's very simple. This one would be something like:\r\n\r\n\"A P2PInterface which stores a count of how many times each txid has been announced\"",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-15T22:08:42Z",
      "diff_hunk" : "@@ -606,3 +606,19 @@ def send_txs_and_test(self, txs, node, *, success=True, expect_disconnect=False,\n                 # Check that none of the txs are now in the mempool\n                 for tx in txs:\n                     assert tx.hash not in raw_mempool, \"{} tx found in mempool\".format(tx.hash)\n+\n+class P2PTxInvStore(P2PInterface):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r409163442",
      "id" : 409163442,
      "line" : 613,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE2MzQ0Mg==",
      "original_commit_id" : "6307582b4d30167a931678d12e99a00a0e75e81a",
      "original_line" : 613,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/mininode.py",
      "position" : 17,
      "pull_request_review_id" : 394155715,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/409163442",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r409164540"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/409164540"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can we import `MSG_TX` from `.messages` and `if i.type == MSG_TX` to remove the magic 1 number?",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-15T22:11:29Z",
      "diff_hunk" : "@@ -606,3 +606,19 @@ def send_txs_and_test(self, txs, node, *, success=True, expect_disconnect=False,\n                 # Check that none of the txs are now in the mempool\n                 for tx in txs:\n                     assert tx.hash not in raw_mempool, \"{} tx found in mempool\".format(tx.hash)\n+\n+class P2PTxInvStore(P2PInterface):\n+    def __init__(self):\n+        super().__init__()\n+        self.tx_invs_received = defaultdict(int)\n+\n+    def on_inv(self, message):\n+        # Store how many times invs have been received for each tx.\n+        for i in message.inv:\n+            if i.type == 1:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r409164540",
      "id" : 409164540,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE2NDU0MA==",
      "original_commit_id" : "6307582b4d30167a931678d12e99a00a0e75e81a",
      "original_line" : 618,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/mininode.py",
      "position" : null,
      "pull_request_review_id" : 394155715,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/409164540",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r409165264"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/409165264"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: sort :stuck_out_tongue: ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-15T22:13:22Z",
      "diff_hunk" : "@@ -0,0 +1,104 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+import time\n+\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    disconnect_nodes,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r409165264",
      "id" : 409165264,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE2NTI2NA==",
      "original_commit_id" : "6307582b4d30167a931678d12e99a00a0e75e81a",
      "original_line" : 14,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : null,
      "pull_request_review_id" : 394155715,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/409165264",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r409166712"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/409166712"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: could declare these two times as constants.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-15T22:17:04Z",
      "diff_hunk" : "@@ -779,6 +779,21 @@ void PeerLogicValidation::InitializeNode(CNode *pnode) {\n         PushNodeVersion(pnode, connman, GetTime());\n }\n \n+// Note: unbroadcast transactions will be filtered through filterInventoryKnown\n+void PeerLogicValidation::ReattemptInitialBroadcast(CScheduler& scheduler) const\n+{\n+    std::set<uint256> unbroadcast_txids;\n+    WITH_LOCK(m_mempool.cs, unbroadcast_txids = m_mempool.m_unbroadcast_txids);\n+\n+    for (const uint256& txid : unbroadcast_txids) {\n+        RelayTransaction(txid, *connman);\n+    }\n+\n+    // schedule next run for 10-15 minutes in the future\n+    const std::chrono::milliseconds delta = std::chrono::milliseconds(10 * 60 * 1000 + GetRand(5 * 60 * 1000));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r409166712",
      "id" : 409166712,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE2NjcxMg==",
      "original_commit_id" : "6307582b4d30167a931678d12e99a00a0e75e81a",
      "original_line" : 793,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 394155715,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/409166712",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r409168043"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/409168043"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think this is true. You added a `P2PTxInvStore` in `test_broadcast()` which I think is still connected.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-15T22:20:26Z",
      "diff_hunk" : "@@ -0,0 +1,104 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+import time\n+\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    disconnect_nodes,\n+    connect_nodes,\n+    create_confirmed_utxos,\n+)\n+\n+\n+class MempoolUnbroadcastTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.test_broadcast()\n+        self.test_txn_removal()\n+\n+    def test_broadcast(self):\n+        self.log.info(\"Test that mempool reattempts delivery of locally submitted transaction\")\n+        node = self.nodes[0]\n+\n+        min_relay_fee = node.getnetworkinfo()[\"relayfee\"]\n+        utxos = create_confirmed_utxos(min_relay_fee, node, 10)\n+\n+        disconnect_nodes(node, 1)\n+\n+        self.log.info(\"Generate transactions that only node 0 knows about\")\n+\n+        # generate a wallet txn\n+        addr = node.getnewaddress()\n+        wallet_tx_hsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # generate a txn using sendrawtransaction\n+        us0 = utxos.pop()\n+        inputs = [{\"txid\": us0[\"txid\"], \"vout\": us0[\"vout\"]}]\n+        outputs = {addr: 0.0001}\n+        tx = node.createrawtransaction(inputs, outputs)\n+        node.settxfee(min_relay_fee)\n+        txF = node.fundrawtransaction(tx)\n+        txFS = node.signrawtransactionwithwallet(txF[\"hex\"])\n+        rpc_tx_hsh = node.sendrawtransaction(txFS[\"hex\"])\n+\n+        # check that second node doesn't have these two txns\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh not in mempool\n+        assert wallet_tx_hsh not in mempool\n+\n+        # ensure that unbroadcast txs are persisted to mempool.dat\n+        self.restart_node(0)\n+\n+        self.log.info(\"Reconnect nodes & check if they are sent to node 1\")\n+        connect_nodes(node, 1)\n+\n+        # fast forward into the future & ensure that the second node has the txns\n+        node.mockscheduler(15 * 60)  # 15 min in seconds\n+        self.sync_mempools(timeout=30)\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh in mempool\n+        assert wallet_tx_hsh in mempool\n+\n+        self.log.info(\"Add another connection & ensure transactions aren't broadcast again\")\n+\n+        conn = node.add_p2p_connection(P2PTxInvStore())\n+        node.mockscheduler(15 * 60)\n+        time.sleep(5)\n+        assert_equal(len(conn.get_invs()), 0)\n+\n+    def test_txn_removal(self):\n+        self.log.info(\"Test that transactions removed from mempool are removed from unbroadcast set\")\n+        node = self.nodes[0]\n+        disconnect_nodes(node, 1)\n+\n+        # since the node doesn't have any connections, it will not receive",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r409168043",
      "id" : 409168043,
      "line" : 87,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE2ODA0Mw==",
      "original_commit_id" : "6307582b4d30167a931678d12e99a00a0e75e81a",
      "original_line" : 87,
      "original_position" : 86,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : 87,
      "pull_request_review_id" : 394155715,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/409168043",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r409169031"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/409169031"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You can also verify this by using `assert_debug_log()` to check that the \"Removed %i from m_unbroadcast_txids before confirmation that txn was sent out\" log has been printed. That might be simpler than connected a new peer.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-15T22:23:01Z",
      "diff_hunk" : "@@ -0,0 +1,104 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+import time\n+\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    disconnect_nodes,\n+    connect_nodes,\n+    create_confirmed_utxos,\n+)\n+\n+\n+class MempoolUnbroadcastTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.test_broadcast()\n+        self.test_txn_removal()\n+\n+    def test_broadcast(self):\n+        self.log.info(\"Test that mempool reattempts delivery of locally submitted transaction\")\n+        node = self.nodes[0]\n+\n+        min_relay_fee = node.getnetworkinfo()[\"relayfee\"]\n+        utxos = create_confirmed_utxos(min_relay_fee, node, 10)\n+\n+        disconnect_nodes(node, 1)\n+\n+        self.log.info(\"Generate transactions that only node 0 knows about\")\n+\n+        # generate a wallet txn\n+        addr = node.getnewaddress()\n+        wallet_tx_hsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # generate a txn using sendrawtransaction\n+        us0 = utxos.pop()\n+        inputs = [{\"txid\": us0[\"txid\"], \"vout\": us0[\"vout\"]}]\n+        outputs = {addr: 0.0001}\n+        tx = node.createrawtransaction(inputs, outputs)\n+        node.settxfee(min_relay_fee)\n+        txF = node.fundrawtransaction(tx)\n+        txFS = node.signrawtransactionwithwallet(txF[\"hex\"])\n+        rpc_tx_hsh = node.sendrawtransaction(txFS[\"hex\"])\n+\n+        # check that second node doesn't have these two txns\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh not in mempool\n+        assert wallet_tx_hsh not in mempool\n+\n+        # ensure that unbroadcast txs are persisted to mempool.dat\n+        self.restart_node(0)\n+\n+        self.log.info(\"Reconnect nodes & check if they are sent to node 1\")\n+        connect_nodes(node, 1)\n+\n+        # fast forward into the future & ensure that the second node has the txns\n+        node.mockscheduler(15 * 60)  # 15 min in seconds\n+        self.sync_mempools(timeout=30)\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh in mempool\n+        assert wallet_tx_hsh in mempool\n+\n+        self.log.info(\"Add another connection & ensure transactions aren't broadcast again\")\n+\n+        conn = node.add_p2p_connection(P2PTxInvStore())\n+        node.mockscheduler(15 * 60)\n+        time.sleep(5)\n+        assert_equal(len(conn.get_invs()), 0)\n+\n+    def test_txn_removal(self):\n+        self.log.info(\"Test that transactions removed from mempool are removed from unbroadcast set\")\n+        node = self.nodes[0]\n+        disconnect_nodes(node, 1)\n+\n+        # since the node doesn't have any connections, it will not receive\n+        # any GETDATAs & thus the transaction will remain in the unbroadcast set.\n+        addr = node.getnewaddress()\n+        txhsh = node.sendtoaddress(addr, 0.0001)\n+        self.nodes[0].generate(1)\n+\n+        # add a connection to node\n+        conn = node.add_p2p_connection(P2PTxInvStore())\n+\n+        # the transaction should have been removed from the unbroadcast set\n+        # since it was removed from the mempool for MemPoolRemovalReason::BLOCK.\n+        # verify by checking it isn't broadcast to the node's new connection.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r409169031",
      "id" : 409169031,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE2OTAzMQ==",
      "original_commit_id" : "6307582b4d30167a931678d12e99a00a0e75e81a",
      "original_line" : 97,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : null,
      "pull_request_review_id" : 394155715,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/409169031",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r409177251"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/409177251"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> but the version shouldn't be bumped because that will silently drop all transactions of the mempool\r\n\r\n@MarcoFalke - this is interesting. It means if we ever have to bump the version number we'd have to do something like:\r\n\r\n- Bitcoin Core version X only understands mempool.dat v1\r\n- add mempool.dat v2 parsing logic in Bitcoin Core version X+1\r\n- add mempoo.dat v2 writing logic in Bitcoin Core version X+2\r\n\r\nI think to avoid the debug LogPrint we can wrap the m_unbroadcast_txids parsing in its own try-except. Something like:\r\n\r\n```\r\n        try {\r\n            LOCK(pool.cs);\r\n            file >> pool.m_unbroadcast_txids;\r\n            unbroadcast = pool.m_unbroadcast_txids.size();\r\n        } catch (const std::exception& e) {\r\n            // mempool.dat files created prior to v0.21 will not have an\r\n            // unbroadcast set. No need to log a failure if parsing fails\r\n            // here.\r\n        }\r\n```",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-15T22:44:29Z",
      "diff_hunk" : "@@ -5045,12 +5046,30 @@ bool LoadMempool(CTxMemPool& pool)\n         for (const auto& i : mapDeltas) {\n             pool.PrioritiseTransaction(i.first, i.second);\n         }\n+\n+        // check if there are unbroadcast transactions\n+        bool has_unbroadcast_txns = false;\n+\n+        try {\n+            file >> has_unbroadcast_txns;\n+        } catch (const std::exception &e) {\n+            // eof gets set when we try to read the end of the file\n+            // so specifically catch expected error and move on.\n+            if (!file.eof()) throw e;\n+        }\n+\n+        if (has_unbroadcast_txns) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r409177251",
      "id" : 409177251,
      "in_reply_to_id" : 394483205,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE3NzI1MQ==",
      "original_commit_id" : "b0f6a238335d96c9f5f7c2b83aabd56ab4f47a71",
      "original_line" : 5061,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 394155715,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/409177251",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r409179516"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/409179516"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I agree. All of the data should be brought out of the mempool under one lock. Make a local `std::set<uint256>` and populate it under the same lock as `mapDeltas` and `vinfo` get populated.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-15T22:50:23Z",
      "diff_hunk" : "@@ -5072,6 +5080,13 @@ bool DumpMempool(const CTxMemPool& pool)\n         }\n \n         file << mapDeltas;\n+\n+        {\n+            LOCK(pool.cs);\n+            LogPrintf(\"Writing %d unbroadcast transactions to disk.\\n\", pool.m_unbroadcast_txids.size());\n+            file << pool.m_unbroadcast_txids;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r409179516",
      "id" : 409179516,
      "in_reply_to_id" : 407665982,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE3OTUxNg==",
      "original_commit_id" : "6307582b4d30167a931678d12e99a00a0e75e81a",
      "original_line" : 5087,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 394187999,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/409179516",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r409186292"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/409186292"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Our guidelines say that whitespace may be fixed up when the line is touched for other reasons. I doubt anyone is going to touch an empty line any time soon. It seems fine to remove an empty line in net.cpp in a pull request that modifies p2p code.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-15T23:10:07Z",
      "diff_hunk" : "@@ -1644,17 +1644,6 @@ void CConnman::ThreadDNSAddressSeed()\n     LogPrintf(\"%d addresses found from DNS seeds\\n\", found);\n }\n \n-",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r409186292",
      "id" : 409186292,
      "in_reply_to_id" : 409152838,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE4NjI5Mg==",
      "original_commit_id" : "6307582b4d30167a931678d12e99a00a0e75e81a",
      "original_line" : 1647,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 394195837,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/409186292",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> this PR adds local data that identifies your own transactions (mempool.dat unbroadcast set and debug logs). I think that's fine - if your bitcoin datadir is compromised you probably have bigger problems.\r\n\r\nAll the information should already be accessible today in wallet.dat, and debug.log, so this is not getting worse.",
      "created_at" : "2020-04-15T23:13:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-614325394",
      "id" : 614325394,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxNDMyNTM5NA==",
      "updated_at" : "2020-04-15T23:13:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/614325394",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> All the information should already be accessible today in wallet.dat, and debug.log, so this is not getting worse.\r\n\r\nwallet.dat could be stored externally, and without wallet logging enabled I don't think debug.log will indicate which transactions are yours. But like I said, I don't think it's a big concern.",
      "created_at" : "2020-04-16T02:23:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-614376730",
      "id" : 614376730,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxNDM3NjczMA==",
      "updated_at" : "2020-04-16T02:23:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/614376730",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "With wallet logging disabled, the tx source is still leaked through ATMP logging, validationinterface logging, RPC logging and NET logging. You'd probably have to pass -nodebuglogfile to make sure nothing is leaked.",
      "created_at" : "2020-04-16T11:46:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-614602524",
      "id" : 614602524,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxNDYwMjUyNA==",
      "updated_at" : "2020-04-16T11:46:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/614602524",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r409782771"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/409782771"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Touching a file in a commit for no other reason than to remove the whitespace doesn't make any sense! I'm surprised that you would think otherwise.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-16T19:01:29Z",
      "diff_hunk" : "@@ -1644,17 +1644,6 @@ void CConnman::ThreadDNSAddressSeed()\n     LogPrintf(\"%d addresses found from DNS seeds\\n\", found);\n }\n \n-",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r409782771",
      "id" : 409782771,
      "in_reply_to_id" : 409152838,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc4Mjc3MQ==",
      "original_commit_id" : "6307582b4d30167a931678d12e99a00a0e75e81a",
      "original_line" : 1647,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 394917749,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/409782771",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "The underlying assumption here seems to be that all nodes are online 24/7 (or at least several days after a tx broadcast). I have heard from some users that they have a node on their laptop that is not online often but when they want to send a tx they launch it, wait for it to sync, and then broadcast the tx before shutting it down again. Should such a usage pattern be taken into consideration or should it be ignored?",
      "created_at" : "2020-04-23T12:56:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-618387031",
      "id" : 618387031,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxODM4NzAzMQ==",
      "updated_at" : "2020-04-23T12:56:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/618387031",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@fjahr Can you explain why this is the underlying assumption? A node on a laptop should work fine wiht this. In fact this improves the user experience on exactly such systems.",
      "created_at" : "2020-04-23T13:05:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-618391912",
      "id" : 618391912,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxODM5MTkxMg==",
      "updated_at" : "2020-04-23T13:05:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/618391912",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> @fjahr Can you explain why this is the underlying assumption? A node on a laptop should work fine wiht this. In fact this improves the user experience on exactly such systems.\r\n\r\nThe way I understand the logic it seems like if a first attempt at broadcasting the tx fails, the user would need to remember that and relaunch their node ~24h later to retry which may be inconvenient compared to keeping the node running for another hour for 1-2 more retries. But maybe I am getting it wrong, I have not reviewed the code yet.",
      "created_at" : "2020-04-23T13:10:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-618394374",
      "id" : 618394374,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxODM5NDM3NA==",
      "updated_at" : "2020-04-23T13:10:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/618394374",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I don't think we can trivially solve the case where you have only connections to malicious nodes that pretend to want your transaction, but then drop it on the floor.\r\n\r\nAre you saying that waiting another hour after start-up could improve the peers you have and they'd be less like to drop your txs on the floor?",
      "created_at" : "2020-04-23T13:21:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-618396450",
      "id" : 618396450,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxODM5NjQ1MA==",
      "updated_at" : "2020-04-23T13:21:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/618396450",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I guess I just misunderstood the unbroadcast logic and it's differences to the old wallet rebroadcast, now that I am reviewing the code it makes more sense and I see how it's not an issue for these types of users.",
      "created_at" : "2020-04-23T14:04:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-618412982",
      "id" : 618412982,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxODQxMjk4Mg==",
      "updated_at" : "2020-04-23T14:04:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/618412982",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r413989313"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/413989313"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "fixed",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-23T17:32:01Z",
      "diff_hunk" : "@@ -1605,7 +1605,15 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n                     push = true;\n                 }\n             }\n-            if (!push) {\n+\n+            if (push) {\n+                // We intepret processing a GETDATA for a transaction as a successful initial broadcast\n+                // and remove it from our unbroadcast set.\n+                int num = WITH_LOCK(mempool.cs, return mempool.m_unbroadcast_txids.erase(inv.hash););\n+                if (num) {\n+                    LogPrint(BCLog::NET, \"Removed %i from m_unbroadcast_txids \\n\", inv.hash.GetHex());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r413989313",
      "id" : 413989313,
      "in_reply_to_id" : 407647622,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk4OTMxMw==",
      "original_commit_id" : "e82fdd329c812623c6e8a9022322fe43e1000c5b",
      "original_line" : 1614,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 399323862,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/413989313",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r413989766"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/413989766"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "fixed",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-23T17:32:44Z",
      "diff_hunk" : "@@ -417,6 +417,10 @@ void CTxMemPool::removeUnchecked(txiter it, MemPoolRemovalReason reason)\n     for (const CTxIn& txin : it->GetTx().vin)\n         mapNextTx.erase(txin.prevout);\n \n+    if (mempool.m_unbroadcast_txids.erase(hash)) {\n+        LogPrint(BCLog::NET, \"Removed %i from m_unbroadcast_txids before confirmation that txn was sent out. \\n\", hash.GetHex());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r413989766",
      "id" : 413989766,
      "in_reply_to_id" : 407648006,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk4OTc2Ng==",
      "original_commit_id" : "e82fdd329c812623c6e8a9022322fe43e1000c5b",
      "original_line" : 421,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 399324418,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/413989766",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r413992829"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/413992829"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "fixed & added doxygen comments for new methods I introduced into txmempool ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-23T17:37:22Z",
      "diff_hunk" : "@@ -533,6 +533,10 @@ class CTxMemPool\n     const setEntries & GetMemPoolParents(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n     const setEntries & GetMemPoolChildren(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n     uint64_t CalculateDescendantMaximum(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n+\n+    // track locally submitted transactions & periodically retry initial broadcast",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r413992829",
      "id" : 413992829,
      "in_reply_to_id" : 407648718,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk5MjgyOQ==",
      "original_commit_id" : "e82fdd329c812623c6e8a9022322fe43e1000c5b",
      "original_line" : 537,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 399327980,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/413992829",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r413993391"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/413993391"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> we reconnect the wifi and be still connected to the peer, in which case we can push the inv out and wait for them to request the tx. \r\n\r\nah, I didn't realize. thanks! \r\n\r\nremoved the comment. ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-23T17:38:18Z",
      "diff_hunk" : "@@ -779,6 +779,21 @@ void PeerLogicValidation::InitializeNode(CNode *pnode) {\n         PushNodeVersion(pnode, connman, GetTime());\n }\n \n+// Note: unbroadcast transactions will be filtered through filterInventoryKnown",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r413993391",
      "id" : 413993391,
      "in_reply_to_id" : 407652787,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk5MzM5MQ==",
      "original_commit_id" : "a11968c8780424ddb0fd01341101bb28ff6953a8",
      "original_line" : 782,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 399328696,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/413993391",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r413994990"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/413994990"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "added the method `GetRandMillis` & updated here. I was thinking might make sense to have a template for the different chrono types? I haven't looked into it yet but you mentioned that it wouldn't work? ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-23T17:40:46Z",
      "diff_hunk" : "@@ -779,6 +779,21 @@ void PeerLogicValidation::InitializeNode(CNode *pnode) {\n         PushNodeVersion(pnode, connman, GetTime());\n }\n \n+// Note: unbroadcast transactions will be filtered through filterInventoryKnown\n+void PeerLogicValidation::ReattemptInitialBroadcast(CScheduler& scheduler) const\n+{\n+    std::set<uint256> unbroadcast_txids;\n+    WITH_LOCK(m_mempool.cs, unbroadcast_txids = m_mempool.m_unbroadcast_txids);\n+\n+    for (const uint256& txid : unbroadcast_txids) {\n+        RelayTransaction(txid, *connman);\n+    }\n+\n+    // schedule next run for 10-15 minutes in the future\n+    const std::chrono::milliseconds delta = std::chrono::milliseconds(10 * 60 * 1000 + GetRand(5 * 60 * 1000));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r413994990",
      "id" : 413994990,
      "in_reply_to_id" : 407655025,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk5NDk5MA==",
      "original_commit_id" : "a11968c8780424ddb0fd01341101bb28ff6953a8",
      "original_line" : 793,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 399330622,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/413994990",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r413996219"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/413996219"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ah, thanks for catching. fixed via new mempool methods",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-23T17:42:24Z",
      "diff_hunk" : "@@ -5023,12 +5024,19 @@ bool LoadMempool(CTxMemPool& pool)\n         for (const auto& i : mapDeltas) {\n             pool.PrioritiseTransaction(i.first, i.second);\n         }\n+\n+        {\n+            LOCK(pool.cs);\n+            file >> pool.m_unbroadcast_txids;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r413996219",
      "id" : 413996219,
      "in_reply_to_id" : 407664223,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk5NjIxOQ==",
      "original_commit_id" : "6307582b4d30167a931678d12e99a00a0e75e81a",
      "original_line" : 5030,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 399331946,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/413996219",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r413996603"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/413996603"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "oops. thanks for catching. fixed ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-23T17:42:58Z",
      "diff_hunk" : "@@ -5072,6 +5080,13 @@ bool DumpMempool(const CTxMemPool& pool)\n         }\n \n         file << mapDeltas;\n+\n+        {\n+            LOCK(pool.cs);\n+            LogPrintf(\"Writing %d unbroadcast transactions to disk.\\n\", pool.m_unbroadcast_txids.size());\n+            file << pool.m_unbroadcast_txids;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r413996603",
      "id" : 413996603,
      "in_reply_to_id" : 407665982,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk5NjYwMw==",
      "original_commit_id" : "6307582b4d30167a931678d12e99a00a0e75e81a",
      "original_line" : 5087,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 399332415,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/413996603",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r413996903"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/413996903"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "historic that I didn't notice. fixed now",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-23T17:43:26Z",
      "diff_hunk" : "@@ -417,6 +417,10 @@ void CTxMemPool::removeUnchecked(txiter it, MemPoolRemovalReason reason)\n     for (const CTxIn& txin : it->GetTx().vin)\n         mapNextTx.erase(txin.prevout);\n \n+    if (mempool.m_unbroadcast_txids.erase(hash)) {\n+        LogPrint(BCLog::NET, \"Removed %i from m_unbroadcast_txids before confirmation that txn was sent out. \\n\", hash.GetHex());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r413996903",
      "id" : 413996903,
      "in_reply_to_id" : 409150876,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk5NjkwMw==",
      "original_commit_id" : "6307582b4d30167a931678d12e99a00a0e75e81a",
      "original_line" : 421,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 399332800,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/413996903",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r413997604"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/413997604"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ð¢\r\n\r\nunfortunately I can't disagree that its silly to touch a file _just_ to remove whitespace.\r\n\r\nempty lines in net.cpp... I will be back for you! ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-23T17:44:31Z",
      "diff_hunk" : "@@ -1644,17 +1644,6 @@ void CConnman::ThreadDNSAddressSeed()\n     LogPrintf(\"%d addresses found from DNS seeds\\n\", found);\n }\n \n-",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r413997604",
      "id" : 413997604,
      "in_reply_to_id" : 409152838,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk5NzYwNA==",
      "original_commit_id" : "6307582b4d30167a931678d12e99a00a0e75e81a",
      "original_line" : 1647,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 399333580,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/413997604",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r413997770"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/413997770"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-23T17:44:49Z",
      "diff_hunk" : "@@ -606,3 +606,19 @@ def send_txs_and_test(self, txs, node, *, success=True, expect_disconnect=False,\n                 # Check that none of the txs are now in the mempool\n                 for tx in txs:\n                     assert tx.hash not in raw_mempool, \"{} tx found in mempool\".format(tx.hash)\n+\n+class P2PTxInvStore(P2PInterface):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r413997770",
      "id" : 413997770,
      "in_reply_to_id" : 409163442,
      "line" : 613,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk5Nzc3MA==",
      "original_commit_id" : "6307582b4d30167a931678d12e99a00a0e75e81a",
      "original_line" : 613,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/mininode.py",
      "position" : 17,
      "pull_request_review_id" : 399333794,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/413997770",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r413999950"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/413999950"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "turns out, `MSG_TX` was already imported. fixed.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-23T17:47:57Z",
      "diff_hunk" : "@@ -606,3 +606,19 @@ def send_txs_and_test(self, txs, node, *, success=True, expect_disconnect=False,\n                 # Check that none of the txs are now in the mempool\n                 for tx in txs:\n                     assert tx.hash not in raw_mempool, \"{} tx found in mempool\".format(tx.hash)\n+\n+class P2PTxInvStore(P2PInterface):\n+    def __init__(self):\n+        super().__init__()\n+        self.tx_invs_received = defaultdict(int)\n+\n+    def on_inv(self, message):\n+        # Store how many times invs have been received for each tx.\n+        for i in message.inv:\n+            if i.type == 1:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r413999950",
      "id" : 413999950,
      "in_reply_to_id" : 409164540,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk5OTk1MA==",
      "original_commit_id" : "6307582b4d30167a931678d12e99a00a0e75e81a",
      "original_line" : 618,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/mininode.py",
      "position" : null,
      "pull_request_review_id" : 399336207,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/413999950",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414000297"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414000297"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "fixed",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-23T17:48:29Z",
      "diff_hunk" : "@@ -0,0 +1,104 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+import time\n+\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    disconnect_nodes,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414000297",
      "id" : 414000297,
      "in_reply_to_id" : 409165264,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDAwMDI5Nw==",
      "original_commit_id" : "6307582b4d30167a931678d12e99a00a0e75e81a",
      "original_line" : 14,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : null,
      "pull_request_review_id" : 399336574,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414000297",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414000987"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414000987"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "pass on this one, I pulled `delta` out for readability, but breaking into two constants seems a bit overkill to me",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-23T17:49:33Z",
      "diff_hunk" : "@@ -779,6 +779,21 @@ void PeerLogicValidation::InitializeNode(CNode *pnode) {\n         PushNodeVersion(pnode, connman, GetTime());\n }\n \n+// Note: unbroadcast transactions will be filtered through filterInventoryKnown\n+void PeerLogicValidation::ReattemptInitialBroadcast(CScheduler& scheduler) const\n+{\n+    std::set<uint256> unbroadcast_txids;\n+    WITH_LOCK(m_mempool.cs, unbroadcast_txids = m_mempool.m_unbroadcast_txids);\n+\n+    for (const uint256& txid : unbroadcast_txids) {\n+        RelayTransaction(txid, *connman);\n+    }\n+\n+    // schedule next run for 10-15 minutes in the future\n+    const std::chrono::milliseconds delta = std::chrono::milliseconds(10 * 60 * 1000 + GetRand(5 * 60 * 1000));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414000987",
      "id" : 414000987,
      "in_reply_to_id" : 409166712,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDAwMDk4Nw==",
      "original_commit_id" : "6307582b4d30167a931678d12e99a00a0e75e81a",
      "original_line" : 793,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 399337388,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414000987",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414004345"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414004345"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "good point! looks like since `P2PTxInvStore` overwrites the `on_inv` function, it doesn't send back a `GETDATA`, so the relevant piece of functionality from a connection isn't triggered.\r\n\r\nfor this PR, I added a line to `disconnect_p2ps` so the expectations make more sense (making the comment true). \r\n\r\nbut I do think its confusing that `P2PTxInvStore` inherits from `P2PInterface` but abandons this one piece of functionality. I'm thinking as a small followup I can have `P2PTxInvStore` call through to the parent `on_inv` after it stores the txid to behave more as expected. what do you think?  ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-23T17:54:17Z",
      "diff_hunk" : "@@ -0,0 +1,104 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+import time\n+\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    disconnect_nodes,\n+    connect_nodes,\n+    create_confirmed_utxos,\n+)\n+\n+\n+class MempoolUnbroadcastTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.test_broadcast()\n+        self.test_txn_removal()\n+\n+    def test_broadcast(self):\n+        self.log.info(\"Test that mempool reattempts delivery of locally submitted transaction\")\n+        node = self.nodes[0]\n+\n+        min_relay_fee = node.getnetworkinfo()[\"relayfee\"]\n+        utxos = create_confirmed_utxos(min_relay_fee, node, 10)\n+\n+        disconnect_nodes(node, 1)\n+\n+        self.log.info(\"Generate transactions that only node 0 knows about\")\n+\n+        # generate a wallet txn\n+        addr = node.getnewaddress()\n+        wallet_tx_hsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # generate a txn using sendrawtransaction\n+        us0 = utxos.pop()\n+        inputs = [{\"txid\": us0[\"txid\"], \"vout\": us0[\"vout\"]}]\n+        outputs = {addr: 0.0001}\n+        tx = node.createrawtransaction(inputs, outputs)\n+        node.settxfee(min_relay_fee)\n+        txF = node.fundrawtransaction(tx)\n+        txFS = node.signrawtransactionwithwallet(txF[\"hex\"])\n+        rpc_tx_hsh = node.sendrawtransaction(txFS[\"hex\"])\n+\n+        # check that second node doesn't have these two txns\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh not in mempool\n+        assert wallet_tx_hsh not in mempool\n+\n+        # ensure that unbroadcast txs are persisted to mempool.dat\n+        self.restart_node(0)\n+\n+        self.log.info(\"Reconnect nodes & check if they are sent to node 1\")\n+        connect_nodes(node, 1)\n+\n+        # fast forward into the future & ensure that the second node has the txns\n+        node.mockscheduler(15 * 60)  # 15 min in seconds\n+        self.sync_mempools(timeout=30)\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh in mempool\n+        assert wallet_tx_hsh in mempool\n+\n+        self.log.info(\"Add another connection & ensure transactions aren't broadcast again\")\n+\n+        conn = node.add_p2p_connection(P2PTxInvStore())\n+        node.mockscheduler(15 * 60)\n+        time.sleep(5)\n+        assert_equal(len(conn.get_invs()), 0)\n+\n+    def test_txn_removal(self):\n+        self.log.info(\"Test that transactions removed from mempool are removed from unbroadcast set\")\n+        node = self.nodes[0]\n+        disconnect_nodes(node, 1)\n+\n+        # since the node doesn't have any connections, it will not receive",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414004345",
      "id" : 414004345,
      "in_reply_to_id" : 409168043,
      "line" : 87,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDAwNDM0NQ==",
      "original_commit_id" : "6307582b4d30167a931678d12e99a00a0e75e81a",
      "original_line" : 87,
      "original_position" : 86,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : 87,
      "pull_request_review_id" : 399341162,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414004345",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414004728"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414004728"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "seems more straightforward so I updated",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-23T17:54:54Z",
      "diff_hunk" : "@@ -0,0 +1,104 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+import time\n+\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    disconnect_nodes,\n+    connect_nodes,\n+    create_confirmed_utxos,\n+)\n+\n+\n+class MempoolUnbroadcastTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.test_broadcast()\n+        self.test_txn_removal()\n+\n+    def test_broadcast(self):\n+        self.log.info(\"Test that mempool reattempts delivery of locally submitted transaction\")\n+        node = self.nodes[0]\n+\n+        min_relay_fee = node.getnetworkinfo()[\"relayfee\"]\n+        utxos = create_confirmed_utxos(min_relay_fee, node, 10)\n+\n+        disconnect_nodes(node, 1)\n+\n+        self.log.info(\"Generate transactions that only node 0 knows about\")\n+\n+        # generate a wallet txn\n+        addr = node.getnewaddress()\n+        wallet_tx_hsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # generate a txn using sendrawtransaction\n+        us0 = utxos.pop()\n+        inputs = [{\"txid\": us0[\"txid\"], \"vout\": us0[\"vout\"]}]\n+        outputs = {addr: 0.0001}\n+        tx = node.createrawtransaction(inputs, outputs)\n+        node.settxfee(min_relay_fee)\n+        txF = node.fundrawtransaction(tx)\n+        txFS = node.signrawtransactionwithwallet(txF[\"hex\"])\n+        rpc_tx_hsh = node.sendrawtransaction(txFS[\"hex\"])\n+\n+        # check that second node doesn't have these two txns\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh not in mempool\n+        assert wallet_tx_hsh not in mempool\n+\n+        # ensure that unbroadcast txs are persisted to mempool.dat\n+        self.restart_node(0)\n+\n+        self.log.info(\"Reconnect nodes & check if they are sent to node 1\")\n+        connect_nodes(node, 1)\n+\n+        # fast forward into the future & ensure that the second node has the txns\n+        node.mockscheduler(15 * 60)  # 15 min in seconds\n+        self.sync_mempools(timeout=30)\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh in mempool\n+        assert wallet_tx_hsh in mempool\n+\n+        self.log.info(\"Add another connection & ensure transactions aren't broadcast again\")\n+\n+        conn = node.add_p2p_connection(P2PTxInvStore())\n+        node.mockscheduler(15 * 60)\n+        time.sleep(5)\n+        assert_equal(len(conn.get_invs()), 0)\n+\n+    def test_txn_removal(self):\n+        self.log.info(\"Test that transactions removed from mempool are removed from unbroadcast set\")\n+        node = self.nodes[0]\n+        disconnect_nodes(node, 1)\n+\n+        # since the node doesn't have any connections, it will not receive\n+        # any GETDATAs & thus the transaction will remain in the unbroadcast set.\n+        addr = node.getnewaddress()\n+        txhsh = node.sendtoaddress(addr, 0.0001)\n+        self.nodes[0].generate(1)\n+\n+        # add a connection to node\n+        conn = node.add_p2p_connection(P2PTxInvStore())\n+\n+        # the transaction should have been removed from the unbroadcast set\n+        # since it was removed from the mempool for MemPoolRemovalReason::BLOCK.\n+        # verify by checking it isn't broadcast to the node's new connection.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414004728",
      "id" : 414004728,
      "in_reply_to_id" : 409169031,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDAwNDcyOA==",
      "original_commit_id" : "6307582b4d30167a931678d12e99a00a0e75e81a",
      "original_line" : 97,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : null,
      "pull_request_review_id" : 399341640,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414004728",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414007402"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414007402"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> I think to avoid the debug LogPrint we can wrap the m_unbroadcast_txids parsing in its own try-except\r\n\r\nI considered doing this but decided not to because a one-time error message (with functionality working fine) seems more desirable than a nested try / catch statement that would probably live in the code for a very long time.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-23T17:58:51Z",
      "diff_hunk" : "@@ -5045,12 +5046,30 @@ bool LoadMempool(CTxMemPool& pool)\n         for (const auto& i : mapDeltas) {\n             pool.PrioritiseTransaction(i.first, i.second);\n         }\n+\n+        // check if there are unbroadcast transactions\n+        bool has_unbroadcast_txns = false;\n+\n+        try {\n+            file >> has_unbroadcast_txns;\n+        } catch (const std::exception &e) {\n+            // eof gets set when we try to read the end of the file\n+            // so specifically catch expected error and move on.\n+            if (!file.eof()) throw e;\n+        }\n+\n+        if (has_unbroadcast_txns) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414007402",
      "id" : 414007402,
      "in_reply_to_id" : 394483205,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDAwNzQwMg==",
      "original_commit_id" : "b0f6a238335d96c9f5f7c2b83aabd56ab4f47a71",
      "original_line" : 5061,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 399344643,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414007402",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414010082"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414010082"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "also added to the docstring at the top of the file.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-23T18:02:43Z",
      "diff_hunk" : "@@ -606,3 +606,19 @@ def send_txs_and_test(self, txs, node, *, success=True, expect_disconnect=False,\n                 # Check that none of the txs are now in the mempool\n                 for tx in txs:\n                     assert tx.hash not in raw_mempool, \"{} tx found in mempool\".format(tx.hash)\n+\n+class P2PTxInvStore(P2PInterface):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414010082",
      "id" : 414010082,
      "in_reply_to_id" : 409163442,
      "line" : 613,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDAxMDA4Mg==",
      "original_commit_id" : "6307582b4d30167a931678d12e99a00a0e75e81a",
      "original_line" : 613,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/mininode.py",
      "position" : 17,
      "pull_request_review_id" : 399347773,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414010082",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "thanks for the reviews @MarcoFalke, @jnewbery & @fjahr \r\n\r\nI've addressed all review comments. Fixed the issues with raciness around dumping & loading unbroadcast set to `mempool.dat`. Updated so `m_unbroadcast_txids` is private & exposes public methods to add / remove / get the set. And a bunch of small nit fixes. \r\n\r\n@fjahr \r\n> The underlying assumption here seems to be that all nodes are online 24/7 \r\n\r\n>  it seems like if a first attempt at broadcasting the tx fails, the user would need to remember that and relaunch their node ~24h later to retry\r\n\r\n>  now that I am reviewing the code it makes more sense\r\n\r\nok, maybe you're clear now but just incase / for other reviewers..\r\n\r\nif we were to simply bump the wallet rebroadcast from ~1/30 min to ~1/day, we would have exactly the problem you describe. so we introduce the idea of the \"unbroadcast\" set to the mempool. instead of using wallet \"rebroadcast\" logic to do best effort of first delivery, we now use the mempool \"unbroadcast\" logic to serve this function. it does work a bit differently (tries more frequently & keeps trying until a `GETDATA` is received or txn is removed from mempool for a different reason), so reviewers should be critical about the changes.",
      "created_at" : "2020-04-23T18:23:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-618569598",
      "id" : 618569598,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxODU2OTU5OA==",
      "updated_at" : "2020-04-23T18:23:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/618569598",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414048438"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414048438"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This doesn't work. You can try by modifying the string above\r\n\r\nThe type needs to be an array",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-23T19:01:14Z",
      "diff_hunk" : "@@ -0,0 +1,99 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+import time\n+\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    connect_nodes,\n+    create_confirmed_utxos,\n+    disconnect_nodes,\n+)\n+\n+\n+class MempoolUnbroadcastTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.test_broadcast()\n+        self.test_txn_removal()\n+\n+    def test_broadcast(self):\n+        self.log.info(\"Test that mempool reattempts delivery of locally submitted transaction\")\n+        node = self.nodes[0]\n+\n+        min_relay_fee = node.getnetworkinfo()[\"relayfee\"]\n+        utxos = create_confirmed_utxos(min_relay_fee, node, 10)\n+\n+        disconnect_nodes(node, 1)\n+\n+        self.log.info(\"Generate transactions that only node 0 knows about\")\n+\n+        # generate a wallet txn\n+        addr = node.getnewaddress()\n+        wallet_tx_hsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # generate a txn using sendrawtransaction\n+        us0 = utxos.pop()\n+        inputs = [{\"txid\": us0[\"txid\"], \"vout\": us0[\"vout\"]}]\n+        outputs = {addr: 0.0001}\n+        tx = node.createrawtransaction(inputs, outputs)\n+        node.settxfee(min_relay_fee)\n+        txF = node.fundrawtransaction(tx)\n+        txFS = node.signrawtransactionwithwallet(txF[\"hex\"])\n+        rpc_tx_hsh = node.sendrawtransaction(txFS[\"hex\"])\n+\n+        # check that second node doesn't have these two txns\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh not in mempool\n+        assert wallet_tx_hsh not in mempool\n+\n+        # ensure that unbroadcast txs are persisted to mempool.dat\n+        self.restart_node(0)\n+\n+        self.log.info(\"Reconnect nodes & check if they are sent to node 1\")\n+        connect_nodes(node, 1)\n+\n+        # fast forward into the future & ensure that the second node has the txns\n+        node.mockscheduler(15 * 60)  # 15 min in seconds\n+        self.sync_mempools(timeout=30)\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh in mempool\n+        assert wallet_tx_hsh in mempool\n+\n+        self.log.info(\"Add another connection & ensure transactions aren't broadcast again\")\n+\n+        conn = node.add_p2p_connection(P2PTxInvStore())\n+        node.mockscheduler(15 * 60)\n+        time.sleep(5)\n+        assert_equal(len(conn.get_invs()), 0)\n+\n+    def test_txn_removal(self):\n+        self.log.info(\"Test that transactions removed from mempool are removed from unbroadcast set\")\n+        node = self.nodes[0]\n+        disconnect_nodes(node, 1)\n+        node.disconnect_p2ps\n+\n+        # since the node doesn't have any connections, it will not receive\n+        # any GETDATAs & thus the transaction will remain in the unbroadcast set.\n+        addr = node.getnewaddress()\n+        txhsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # check transaction was removed from unbroadcast set due to presence in\n+        # a block\n+        removal_reason = \"Removed {} from set of unbroadcast txns before confirmation that txn was sent out.\".format(txhsh)\n+        with node.assert_debug_log(expected_msgs=removal_reason):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414048438",
      "id" : 414048438,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDA0ODQzOA==",
      "original_commit_id" : "c365159b8922320ba542db97a43ae72a177380bb",
      "original_line" : 95,
      "original_position" : 95,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : null,
      "pull_request_review_id" : 399391005,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414048438",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414049819"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414049819"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Please use the same for consistency. Either by copy-pasting from above or by putting the two lines into a function",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-23T19:03:27Z",
      "diff_hunk" : "@@ -1128,6 +1141,9 @@ PeerLogicValidation::PeerLogicValidation(CConnman* connmanIn, BanMan* banman, CS\n     // timer.\n     static_assert(EXTRA_PEER_CHECK_INTERVAL < STALE_CHECK_INTERVAL, \"peer eviction timer should be less than stale tip check timer\");\n     scheduler.scheduleEvery([this, consensusParams] { this->CheckForStaleTipAndEvictPeers(consensusParams); }, std::chrono::seconds{EXTRA_PEER_CHECK_INTERVAL});\n+\n+    const std::chrono::milliseconds delta = std::chrono::milliseconds(10 * 60 * 1000 + GetRand(5 * 60 * 1000));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414049819",
      "id" : 414049819,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDA0OTgxOQ==",
      "original_commit_id" : "c365159b8922320ba542db97a43ae72a177380bb",
      "original_line" : 1145,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 399392664,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414049819",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414055529"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414055529"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Any reason why these are inline? I think we don't that elsewhere.\r\n\r\nAlso, it might be good to move the implementation of this one to the cpp file, so that logging doesn't have to be included in the header and compiled on every include.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-23T19:12:28Z",
      "diff_hunk" : "@@ -698,6 +702,28 @@ class CTxMemPool\n \n     size_t DynamicMemoryUsage() const;\n \n+    /** Adds a transaction to the unbroadcast set */\n+    inline void AddUnbroadcastTx(const uint256& txid) {\n+        LOCK(cs);\n+        m_unbroadcast_txids.insert(txid);\n+    }\n+\n+    /** Removes a transaction from the unbroadcast set */\n+    inline void RemoveUnbroadcastTx(const uint256& txid, const bool unchecked = false) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414055529",
      "id" : 414055529,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDA1NTUyOQ==",
      "original_commit_id" : "c365159b8922320ba542db97a43ae72a177380bb",
      "original_line" : 712,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 399398995,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414055529",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK c365159b8922320ba542db97a43ae72a177380bb ð\r\n\r\n<details><summary>Show signature and timestamp</summary>\r\n\r\nSignature:\r\n\r\n```\r\n-----BEGIN PGP SIGNED MESSAGE-----\r\nHash: SHA512\r\n\r\nACK c365159b8922320ba542db97a43ae72a177380bb ð\r\n-----BEGIN PGP SIGNATURE-----\r\n\r\niQGzBAEBCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\r\npUi5TQv/UfFNEB6lDNi7ZjPTVQhYPj6JQsYc9pN6r8vGARGWt22PX9t2epW4/WRQ\r\nGWyfjg+uSl3LQYBc1+GZZe2l0uxzH4bbLEN7fL0JxWqnTTboretkD/XEFO36jjGD\r\nXOfzExoOKprAXx1TA1GQqqPyWQy3B+TCIxEHYpJxuQJ2iHKYoBwuqMGV1HHQHRiM\r\nq84fIho0WpgB7hNr56f7IqgdSEhSzIMA7UCJGdo2cnlQJf0CYspPmnx0biRkbZa9\r\n8rYul+/cVI9EICVL/ZZ5Ab61QrqtVncm7fBo+zG/KkXIHKrTEmDfnrLsB0YCtwhM\r\nC9prYyQDLAJ5PreYZZbC7sdzn8IbC/wsdKVK+z2gx7fmGFRp+Zuxtag70+LSxNCn\r\n8vAwGow0d2QIxBDUKHAGpkjg98XAMP5ZWPHDCM2Ky22wvoPSpIV8c+Q0uEf1eSMF\r\nE45fpdbik5tUi2ntm0TXdTwunnWQIJdlY4TocFdF+9ZzyM3vOgcEOrRDYzh47xzQ\r\nMIWA8UcU\r\n=Um+Y\r\n-----END PGP SIGNATURE-----\r\n```\r\n\r\n[Timestamp of file with hash `40fb7d6151b1989018740bdc8a2582d53f1b63f76e24b76af6cb200fb664ce36  -`](https://opentimestamps.org/info/?004f70656e54696d657374616d7073000050726f6f6600bf89e2e884e89294010840fb7d6151b1989018740bdc8a2582d53f1b63f76e24b76af6cb200fb664ce36f010e2683a013c695a12c9f531ae86cec25c08fff010409417f2723ec4e799cea896a37b282208f1203923e58117f21ea80f7420291741bb679eea3507273fd10eabb5d41f89b429cd08f1045ea1e8acf0082b9535e64c18d6ed0083dfe30d2ef90c8e2e2d68747470733a2f2f616c6963652e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267fff01048ec8caa5acc6b0132e5539af88d27f008f1045ea1e8adf008cc7e5aafa13e9cf80083dfe30d2ef90c8e292868747470733a2f2f66696e6e65792e63616c656e6461722e657465726e69747977616c6c2e636f6dfff010591ee08a12d514da0ccabb27a302d4c608f1045ea1e8acf00888d38dd43bd5d96a0083dfe30d2ef90c8e2c2b68747470733a2f2f626f622e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267f010ce109f2dbcf5feed50bb49df1ca2a81908f1045ea1e8acf0082593b8088186da2b0083dfe30d2ef90c8e232268747470733a2f2f6274632e63616c656e6461722e636174616c6c6178792e636f6d)\r\n\r\n</details>\r\n",
      "created_at" : "2020-04-23T19:12:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-618603179",
      "id" : 618603179,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxODYwMzE3OQ==",
      "updated_at" : "2020-04-23T19:12:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/618603179",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414065418"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414065418"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "thought it was more efficient since these functions are so simple. \r\n\r\nwe don't have inline functions in txmempool, but there are plenty scattered around the codebase. \r\n\r\nð RE logging. I can def move this function to the cpp. Do you prefer I move them all? ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-23T19:28:45Z",
      "diff_hunk" : "@@ -698,6 +702,28 @@ class CTxMemPool\n \n     size_t DynamicMemoryUsage() const;\n \n+    /** Adds a transaction to the unbroadcast set */\n+    inline void AddUnbroadcastTx(const uint256& txid) {\n+        LOCK(cs);\n+        m_unbroadcast_txids.insert(txid);\n+    }\n+\n+    /** Removes a transaction from the unbroadcast set */\n+    inline void RemoveUnbroadcastTx(const uint256& txid, const bool unchecked = false) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414065418",
      "id" : 414065418,
      "in_reply_to_id" : 414055529,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDA2NTQxOA==",
      "original_commit_id" : "c365159b8922320ba542db97a43ae72a177380bb",
      "original_line" : 712,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 399410174,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414065418",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414069725"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414069725"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The others can stay, but I think the `inline` keyword is still not needed? (With \"inline\" I meant \"`inline`\" (the keyword))",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-23T19:35:46Z",
      "diff_hunk" : "@@ -698,6 +702,28 @@ class CTxMemPool\n \n     size_t DynamicMemoryUsage() const;\n \n+    /** Adds a transaction to the unbroadcast set */\n+    inline void AddUnbroadcastTx(const uint256& txid) {\n+        LOCK(cs);\n+        m_unbroadcast_txids.insert(txid);\n+    }\n+\n+    /** Removes a transaction from the unbroadcast set */\n+    inline void RemoveUnbroadcastTx(const uint256& txid, const bool unchecked = false) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414069725",
      "id" : 414069725,
      "in_reply_to_id" : 414055529,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDA2OTcyNQ==",
      "original_commit_id" : "c365159b8922320ba542db97a43ae72a177380bb",
      "original_line" : 712,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 399415067,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414069725",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414085582"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414085582"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "oh interesting.. reading around, seems like `inline` keyword is just a compiler hint & usually the compiler will deduce when necessary? the code compiles fine when I remove them. is there any harm in leaving it in? on the flip, is there any time they *should* be used? ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-23T20:01:17Z",
      "diff_hunk" : "@@ -698,6 +702,28 @@ class CTxMemPool\n \n     size_t DynamicMemoryUsage() const;\n \n+    /** Adds a transaction to the unbroadcast set */\n+    inline void AddUnbroadcastTx(const uint256& txid) {\n+        LOCK(cs);\n+        m_unbroadcast_txids.insert(txid);\n+    }\n+\n+    /** Removes a transaction from the unbroadcast set */\n+    inline void RemoveUnbroadcastTx(const uint256& txid, const bool unchecked = false) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414085582",
      "id" : 414085582,
      "in_reply_to_id" : 414055529,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDA4NTU4Mg==",
      "original_commit_id" : "c365159b8922320ba542db97a43ae72a177380bb",
      "original_line" : 712,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 399433007,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414085582",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414091130"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414091130"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@amitiuttarwar `inline` has two independent effects:\r\n* A hint to the compiler that it should try inlining the function (both in C and C++). Modern compilers will do this automatically in many cases, with or without the keyword.\r\n* Indicating that this symbol may appear in multiple modules (but they will all be identical). This is only in C++, and makes it possible to have code in header files (as it will end up in every module that includes it). Member functions defined in classes *always* have this implicitly, no need to add the \"inline\" keyword for it (unless you also want to hinting effect above).\r\n\r\nSo the only time you *have to* use `inline` is for functions in headers files that are not member functions.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-23T20:10:58Z",
      "diff_hunk" : "@@ -698,6 +702,28 @@ class CTxMemPool\n \n     size_t DynamicMemoryUsage() const;\n \n+    /** Adds a transaction to the unbroadcast set */\n+    inline void AddUnbroadcastTx(const uint256& txid) {\n+        LOCK(cs);\n+        m_unbroadcast_txids.insert(txid);\n+    }\n+\n+    /** Removes a transaction from the unbroadcast set */\n+    inline void RemoveUnbroadcastTx(const uint256& txid, const bool unchecked = false) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414091130",
      "id" : 414091130,
      "in_reply_to_id" : 414055529,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDA5MTEzMA==",
      "original_commit_id" : "c365159b8922320ba542db97a43ae72a177380bb",
      "original_line" : 712,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 399439596,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414091130",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414099396"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414099396"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@amitiuttarwar Done here: #18751 ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-23T20:24:52Z",
      "diff_hunk" : "@@ -779,6 +779,21 @@ void PeerLogicValidation::InitializeNode(CNode *pnode) {\n         PushNodeVersion(pnode, connman, GetTime());\n }\n \n+// Note: unbroadcast transactions will be filtered through filterInventoryKnown\n+void PeerLogicValidation::ReattemptInitialBroadcast(CScheduler& scheduler) const\n+{\n+    std::set<uint256> unbroadcast_txids;\n+    WITH_LOCK(m_mempool.cs, unbroadcast_txids = m_mempool.m_unbroadcast_txids);\n+\n+    for (const uint256& txid : unbroadcast_txids) {\n+        RelayTransaction(txid, *connman);\n+    }\n+\n+    // schedule next run for 10-15 minutes in the future\n+    const std::chrono::milliseconds delta = std::chrono::milliseconds(10 * 60 * 1000 + GetRand(5 * 60 * 1000));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414099396",
      "id" : 414099396,
      "in_reply_to_id" : 407655025,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDA5OTM5Ng==",
      "original_commit_id" : "a11968c8780424ddb0fd01341101bb28ff6953a8",
      "original_line" : 793,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 399448740,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414099396",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414131405"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414131405"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ah okay, this is very helpful. I think I'm understanding- its a clue to the compiler to try expanding in line, as well as an indicator that the symbol defined in more than one translation unit are the same, which the compiler can enforce. when a member function is defined, not just declared, within the class definition- the compiler automatically interprets this as an inline member function. so, the keyword `inline` in the implementation I have here is redundant. ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-23T21:18:53Z",
      "diff_hunk" : "@@ -698,6 +702,28 @@ class CTxMemPool\n \n     size_t DynamicMemoryUsage() const;\n \n+    /** Adds a transaction to the unbroadcast set */\n+    inline void AddUnbroadcastTx(const uint256& txid) {\n+        LOCK(cs);\n+        m_unbroadcast_txids.insert(txid);\n+    }\n+\n+    /** Removes a transaction from the unbroadcast set */\n+    inline void RemoveUnbroadcastTx(const uint256& txid, const bool unchecked = false) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414131405",
      "id" : 414131405,
      "in_reply_to_id" : 414055529,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDEzMTQwNQ==",
      "original_commit_id" : "c365159b8922320ba542db97a43ae72a177380bb",
      "original_line" : 712,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 399484608,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414131405",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414134271"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414134271"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "but, since I'm pulling out the definition of `RemoveUnbroadcastTx` to `txmempool.cpp`, it will no longer be automatically inlined. So, adding `inline` there would be a hint to the compiler to inline the function at the call sites, but the compiler might do it anyway / ignore. \r\n\r\nis this sounding correct?",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-23T21:24:10Z",
      "diff_hunk" : "@@ -698,6 +702,28 @@ class CTxMemPool\n \n     size_t DynamicMemoryUsage() const;\n \n+    /** Adds a transaction to the unbroadcast set */\n+    inline void AddUnbroadcastTx(const uint256& txid) {\n+        LOCK(cs);\n+        m_unbroadcast_txids.insert(txid);\n+    }\n+\n+    /** Removes a transaction from the unbroadcast set */\n+    inline void RemoveUnbroadcastTx(const uint256& txid, const bool unchecked = false) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414134271",
      "id" : 414134271,
      "in_reply_to_id" : 414055529,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDEzNDI3MQ==",
      "original_commit_id" : "c365159b8922320ba542db97a43ae72a177380bb",
      "original_line" : 712,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 399487760,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414134271",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414134919"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414134919"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> that the symbol defined in more than one translation unit are the same\r\n\r\nNot just that they're the same; that they may occur in multiple translation units in the first place. Without `inline` (or a member being defined in a class body), you will get a linker error if you define the same symbol in multiple translation units.\r\n\r\nUnless (there's always an unless...), it's in an anonymous namespace as well (or `static` for globals). In *that* case, every translation unit will get its own individual copy, which won't be seen as conflicting by the linker at all - but they also won't get deduplicated.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-23T21:25:21Z",
      "diff_hunk" : "@@ -698,6 +702,28 @@ class CTxMemPool\n \n     size_t DynamicMemoryUsage() const;\n \n+    /** Adds a transaction to the unbroadcast set */\n+    inline void AddUnbroadcastTx(const uint256& txid) {\n+        LOCK(cs);\n+        m_unbroadcast_txids.insert(txid);\n+    }\n+\n+    /** Removes a transaction from the unbroadcast set */\n+    inline void RemoveUnbroadcastTx(const uint256& txid, const bool unchecked = false) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414134919",
      "id" : 414134919,
      "in_reply_to_id" : 414055529,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDEzNDkxOQ==",
      "original_commit_id" : "c365159b8922320ba542db97a43ae72a177380bb",
      "original_line" : 712,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 399488475,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414134919",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414137349"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414137349"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Once you've moved the function definition to the .cpp file, it can only get inlined anymore inside the txmempool.cpp translation unit (until we enable LTO, which we currently don't do by default or in releases). With or without `inline`, it will still get inlined there, and with or without `inline` it won't get inlined elsewhere. Adding the keyword may still make it a stronger hint to the compiler to do so - unsure.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-23T21:30:00Z",
      "diff_hunk" : "@@ -698,6 +702,28 @@ class CTxMemPool\n \n     size_t DynamicMemoryUsage() const;\n \n+    /** Adds a transaction to the unbroadcast set */\n+    inline void AddUnbroadcastTx(const uint256& txid) {\n+        LOCK(cs);\n+        m_unbroadcast_txids.insert(txid);\n+    }\n+\n+    /** Removes a transaction from the unbroadcast set */\n+    inline void RemoveUnbroadcastTx(const uint256& txid, const bool unchecked = false) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414137349",
      "id" : 414137349,
      "in_reply_to_id" : 414055529,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDEzNzM0OQ==",
      "original_commit_id" : "c365159b8922320ba542db97a43ae72a177380bb",
      "original_line" : 712,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 399491141,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414137349",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414141955"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414141955"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ok ya, got the part where `inline` indicates permission for same symbol in multiple translation units. the part about `inline` in `.cpp` being limited to the file unless the optimization is enabled makes sense. and the special case for anonymous namespace is ð¤¯ and I'm going to go have to learn / tinker more ð \r\n\r\nbut first I'm going to push fixups. thanks so much for these explanations! I'm learning a lot :) ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-23T21:38:52Z",
      "diff_hunk" : "@@ -698,6 +702,28 @@ class CTxMemPool\n \n     size_t DynamicMemoryUsage() const;\n \n+    /** Adds a transaction to the unbroadcast set */\n+    inline void AddUnbroadcastTx(const uint256& txid) {\n+        LOCK(cs);\n+        m_unbroadcast_txids.insert(txid);\n+    }\n+\n+    /** Removes a transaction from the unbroadcast set */\n+    inline void RemoveUnbroadcastTx(const uint256& txid, const bool unchecked = false) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414141955",
      "id" : 414141955,
      "in_reply_to_id" : 414055529,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE0MTk1NQ==",
      "original_commit_id" : "c365159b8922320ba542db97a43ae72a177380bb",
      "original_line" : 712,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 399495962,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414141955",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414147048"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414147048"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "good catch. fixed",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-23T21:48:43Z",
      "diff_hunk" : "@@ -0,0 +1,99 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+import time\n+\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    connect_nodes,\n+    create_confirmed_utxos,\n+    disconnect_nodes,\n+)\n+\n+\n+class MempoolUnbroadcastTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.test_broadcast()\n+        self.test_txn_removal()\n+\n+    def test_broadcast(self):\n+        self.log.info(\"Test that mempool reattempts delivery of locally submitted transaction\")\n+        node = self.nodes[0]\n+\n+        min_relay_fee = node.getnetworkinfo()[\"relayfee\"]\n+        utxos = create_confirmed_utxos(min_relay_fee, node, 10)\n+\n+        disconnect_nodes(node, 1)\n+\n+        self.log.info(\"Generate transactions that only node 0 knows about\")\n+\n+        # generate a wallet txn\n+        addr = node.getnewaddress()\n+        wallet_tx_hsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # generate a txn using sendrawtransaction\n+        us0 = utxos.pop()\n+        inputs = [{\"txid\": us0[\"txid\"], \"vout\": us0[\"vout\"]}]\n+        outputs = {addr: 0.0001}\n+        tx = node.createrawtransaction(inputs, outputs)\n+        node.settxfee(min_relay_fee)\n+        txF = node.fundrawtransaction(tx)\n+        txFS = node.signrawtransactionwithwallet(txF[\"hex\"])\n+        rpc_tx_hsh = node.sendrawtransaction(txFS[\"hex\"])\n+\n+        # check that second node doesn't have these two txns\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh not in mempool\n+        assert wallet_tx_hsh not in mempool\n+\n+        # ensure that unbroadcast txs are persisted to mempool.dat\n+        self.restart_node(0)\n+\n+        self.log.info(\"Reconnect nodes & check if they are sent to node 1\")\n+        connect_nodes(node, 1)\n+\n+        # fast forward into the future & ensure that the second node has the txns\n+        node.mockscheduler(15 * 60)  # 15 min in seconds\n+        self.sync_mempools(timeout=30)\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh in mempool\n+        assert wallet_tx_hsh in mempool\n+\n+        self.log.info(\"Add another connection & ensure transactions aren't broadcast again\")\n+\n+        conn = node.add_p2p_connection(P2PTxInvStore())\n+        node.mockscheduler(15 * 60)\n+        time.sleep(5)\n+        assert_equal(len(conn.get_invs()), 0)\n+\n+    def test_txn_removal(self):\n+        self.log.info(\"Test that transactions removed from mempool are removed from unbroadcast set\")\n+        node = self.nodes[0]\n+        disconnect_nodes(node, 1)\n+        node.disconnect_p2ps\n+\n+        # since the node doesn't have any connections, it will not receive\n+        # any GETDATAs & thus the transaction will remain in the unbroadcast set.\n+        addr = node.getnewaddress()\n+        txhsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # check transaction was removed from unbroadcast set due to presence in\n+        # a block\n+        removal_reason = \"Removed {} from set of unbroadcast txns before confirmation that txn was sent out.\".format(txhsh)\n+        with node.assert_debug_log(expected_msgs=removal_reason):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414147048",
      "id" : 414147048,
      "in_reply_to_id" : 414048438,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE0NzA0OA==",
      "original_commit_id" : "c365159b8922320ba542db97a43ae72a177380bb",
      "original_line" : 95,
      "original_position" : 95,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : null,
      "pull_request_review_id" : 399501354,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414147048",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414147133"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414147133"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "fixed",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-23T21:48:52Z",
      "diff_hunk" : "@@ -1128,6 +1141,9 @@ PeerLogicValidation::PeerLogicValidation(CConnman* connmanIn, BanMan* banman, CS\n     // timer.\n     static_assert(EXTRA_PEER_CHECK_INTERVAL < STALE_CHECK_INTERVAL, \"peer eviction timer should be less than stale tip check timer\");\n     scheduler.scheduleEvery([this, consensusParams] { this->CheckForStaleTipAndEvictPeers(consensusParams); }, std::chrono::seconds{EXTRA_PEER_CHECK_INTERVAL});\n+\n+    const std::chrono::milliseconds delta = std::chrono::milliseconds(10 * 60 * 1000 + GetRand(5 * 60 * 1000));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414147133",
      "id" : 414147133,
      "in_reply_to_id" : 414049819,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE0NzEzMw==",
      "original_commit_id" : "c365159b8922320ba542db97a43ae72a177380bb",
      "original_line" : 1145,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 399501426,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:48:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414147133",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414147829"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414147829"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "removed `inline` keywords, moved `RemoveUnbroadcastTx` function definition to `txmempool.cpp` & removed including `logging.h` in the header.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-23T21:50:17Z",
      "diff_hunk" : "@@ -698,6 +702,28 @@ class CTxMemPool\n \n     size_t DynamicMemoryUsage() const;\n \n+    /** Adds a transaction to the unbroadcast set */\n+    inline void AddUnbroadcastTx(const uint256& txid) {\n+        LOCK(cs);\n+        m_unbroadcast_txids.insert(txid);\n+    }\n+\n+    /** Removes a transaction from the unbroadcast set */\n+    inline void RemoveUnbroadcastTx(const uint256& txid, const bool unchecked = false) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414147829",
      "id" : 414147829,
      "in_reply_to_id" : 414055529,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE0NzgyOQ==",
      "original_commit_id" : "c365159b8922320ba542db97a43ae72a177380bb",
      "original_line" : 712,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 399502206,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T21:50:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414147829",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 50fc4df6c4e8a84bdda13ade7bed7a2131796f00, I think this is ready for merge now ð»\r\n\r\n<details><summary>Show signature and timestamp</summary>\r\n\r\nSignature:\r\n\r\n```\r\n-----BEGIN PGP SIGNED MESSAGE-----\r\nHash: SHA512\r\n\r\nACK 50fc4df6c4e8a84bdda13ade7bed7a2131796f00, I think this is ready for merge now ð»\r\n-----BEGIN PGP SIGNATURE-----\r\n\r\niQGzBAEBCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\r\npUirugv7BJubk3aTH2GX+7nvWrieZDFLtNjEb/auwRu/Jbr65RbmVDuMXLwYoOpJ\r\nGYTvWwFz24vA1SUvduymfoYx2wm2IoDlscWld3BHRQ7CLWN0pl5QZMmmaSEcIQ73\r\nGN+RxCSHC2rUlfHNlRa0z9ftsmxj4NXvITuC267Icm8ncxXRBUqAUI52Tdhoebhi\r\najCe4O0ELW8bm+QfhRQAZLDBEn9ozIkr1PF07GGpWK0l0ocXjJXvx9C6kh0Dk6/K\r\nTjag22/C9USANwlNQM5ylZQAFjIvg4NrCW5YNsosD9fGG48CwHEGGIsjZdK83HLp\r\n+b/RiVqdgUEy0xIMVA/h8rzg9WIrw1wF30N8ojifoIXksBy6xiOacNNWbjMyZl5k\r\nEwQe39TciWyiC4SavgApLaNEm2O89F1ioFdEOBSuD1zTvk0NhESUcBP2c0t/QA55\r\nX2EG6E1+QqXh2QHD4FxUY2Ilc3FYLoxjXtZn0hXeYvVVRt5WVjZ8lKCmHAsSQQSD\r\nuEtIKPHC\r\n=fzbr\r\n-----END PGP SIGNATURE-----\r\n```\r\n\r\n[Timestamp of file with hash `a0ea0b9710aa41df23da3ac2e0fb074613017836932762a951df4f9384b87eae  -`](https://opentimestamps.org/info/?004f70656e54696d657374616d7073000050726f6f6600bf89e2e884e892940108a0ea0b9710aa41df23da3ac2e0fb074613017836932762a951df4f9384b87eaef0105025a8021dc2c2315d82d1f96dc2055108fff01046b71e4070b48b582eb70f06d2194bb308f1045ea21534f008ca729738be4b1c8e0083dfe30d2ef90c8e292868747470733a2f2f66696e6e65792e63616c656e6461722e657465726e69747977616c6c2e636f6dfff0108744f8f3a20804c399e58b313b89f62f08f1045ea21533f008877d2aebe4f45bd50083dfe30d2ef90c8e2e2d68747470733a2f2f616c6963652e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267fff010b327fd88d445d5b6e37878a59cb9920d08f1045ea21533f008a1b1d6736f96e9040083dfe30d2ef90c8e2c2b68747470733a2f2f626f622e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267f010b8397b10e27c6b6d22896ce9c5dad31f08f1045ea21533f0085875f262085e79a10083dfe30d2ef90c8e232268747470733a2f2f6274632e63616c656e6461722e636174616c6c6178792e636f6d)\r\n\r\n</details>\r\n",
      "created_at" : "2020-04-23T22:22:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-618702204",
      "id" : 618702204,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxODcwMjIwNA==",
      "updated_at" : "2020-04-23T22:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/618702204",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414172020"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414172020"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Perhaps this section for deserializing unbroadcast txids can be moved to a separate `try` ... `catch` block, so that the normal \"Imported ...\" message appears rather than a deserialization error?",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-23T22:42:39Z",
      "diff_hunk" : "@@ -5023,12 +5024,21 @@ bool LoadMempool(CTxMemPool& pool)\n         for (const auto& i : mapDeltas) {\n             pool.PrioritiseTransaction(i.first, i.second);\n         }\n+\n+        std::set<uint256> unbroadcast_txids;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414172020",
      "id" : 414172020,
      "line" : 5028,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE3MjAyMA==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 5028,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 13,
      "pull_request_review_id" : 399527313,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T22:42:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414172020",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414195526"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414195526"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "is this in regards to preventing the one-time error when upgrading? or more general possible errors?",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-23T23:41:57Z",
      "diff_hunk" : "@@ -5023,12 +5024,21 @@ bool LoadMempool(CTxMemPool& pool)\n         for (const auto& i : mapDeltas) {\n             pool.PrioritiseTransaction(i.first, i.second);\n         }\n+\n+        std::set<uint256> unbroadcast_txids;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414195526",
      "id" : 414195526,
      "in_reply_to_id" : 414172020,
      "line" : 5028,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE5NTUyNg==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 5028,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 13,
      "pull_request_review_id" : 399550267,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T23:42:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414195526",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414199728"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414199728"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah, it seems the return value of LoadMempool is actually ignored in case of failure, so it's indeed just a warning issue. It would seem cleaner that LoadMempool returns either returns true for successfully loaded (whether unbroadcast_txids was present or not), and false + empty mempool otherwise. That's just code esthetics though, no need to address it here.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-23T23:53:24Z",
      "diff_hunk" : "@@ -5023,12 +5024,21 @@ bool LoadMempool(CTxMemPool& pool)\n         for (const auto& i : mapDeltas) {\n             pool.PrioritiseTransaction(i.first, i.second);\n         }\n+\n+        std::set<uint256> unbroadcast_txids;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414199728",
      "id" : 414199728,
      "in_reply_to_id" : 414172020,
      "line" : 5028,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE5OTcyOA==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 5028,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 13,
      "pull_request_review_id" : 399554031,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-23T23:53:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414199728",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-24T01:12:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-618748286",
      "id" : 618748286,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxODc0ODI4Ng==",
      "updated_at" : "2020-04-24T01:12:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/618748286",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@fjahr @naumenkogs @jnewbery @ariard Maybe one more re-ACK to push this over the finish line? :pray: \r\n\r\nMerging this early gives more time to test while it is in master until the release of 0.21.0",
      "created_at" : "2020-04-24T12:01:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-618968618",
      "id" : 618968618,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxODk2ODYxOA==",
      "updated_at" : "2020-04-24T12:01:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/618968618",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414575673"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414575673"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Imagine in future we will not care about privacy here (e.g., use Tor or whatnot), and allow `push` for unsolicited GETDATA.\r\nThen, if the condition for rebroadcast is still `if (push)` it would be trivial to censor a transaction by sending unsolicited GETDATA. It means that with this code, effectiveness of rebroadcast depend on this privacy behaviour we have.\r\nI'm afraid that this non-obvious relation might screw us up in future. I wish we documented this more, maybe in the comment right above.\r\nI'm fine with keeping it this way too, just want to raise some awareness here.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-24T13:28:11Z",
      "diff_hunk" : "@@ -1605,7 +1622,13 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n                     push = true;\n                 }\n             }\n-            if (!push) {\n+\n+            if (push) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414575673",
      "id" : 414575673,
      "line" : 1626,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU3NTY3Mw==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 1626,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 46,
      "pull_request_review_id" : 399945469,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-24T13:28:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414575673",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "utACK 50fc4df",
      "created_at" : "2020-04-24T13:35:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-619014282",
      "id" : 619014282,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxOTAxNDI4Mg==",
      "updated_at" : "2020-04-24T13:35:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/619014282",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414583726"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414583726"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sorry, I don't follow. How would a node send GETDATA without knowing the txid? Also, how would it censor (prevent you other connections from sending a GETDATA) by just sending a GETDATA?",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-24T13:39:46Z",
      "diff_hunk" : "@@ -1605,7 +1622,13 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n                     push = true;\n                 }\n             }\n-            if (!push) {\n+\n+            if (push) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414583726",
      "id" : 414583726,
      "in_reply_to_id" : 414575673,
      "line" : 1626,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU4MzcyNg==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 1626,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 46,
      "pull_request_review_id" : 399955102,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-24T13:39:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414583726",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414729953"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414729953"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "You are missing the parenthesis behind the function call: `node.disconnect_p2ps()` so this line is not doing the disconnecting at the moment. So the comment is indeed wrong and it just \"accidentally\" works because `P2PTxInvStore` doesn't send a `GETDATA`. I think I would expect it to send a `GETDATA` because it is part of the framework now, but in general, I think the `P2PInterface` is there so you can override the behavior to be what you need so I don't have a strong feeling about it. If it was part of the test I would say it doesn't matter but because it moves to the framework, slight preference to call the super behavior.\r\n\r\nEDIT: For reference, I mean this line: https://github.com/bitcoin/bitcoin/pull/18038/files#diff-5e6f5e6aab04f82ec4b58148c4bdec72R85 the linking isn't working properly because I commented on an outdated conversation.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-24T17:07:51Z",
      "diff_hunk" : "@@ -0,0 +1,104 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+import time\n+\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    disconnect_nodes,\n+    connect_nodes,\n+    create_confirmed_utxos,\n+)\n+\n+\n+class MempoolUnbroadcastTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.test_broadcast()\n+        self.test_txn_removal()\n+\n+    def test_broadcast(self):\n+        self.log.info(\"Test that mempool reattempts delivery of locally submitted transaction\")\n+        node = self.nodes[0]\n+\n+        min_relay_fee = node.getnetworkinfo()[\"relayfee\"]\n+        utxos = create_confirmed_utxos(min_relay_fee, node, 10)\n+\n+        disconnect_nodes(node, 1)\n+\n+        self.log.info(\"Generate transactions that only node 0 knows about\")\n+\n+        # generate a wallet txn\n+        addr = node.getnewaddress()\n+        wallet_tx_hsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # generate a txn using sendrawtransaction\n+        us0 = utxos.pop()\n+        inputs = [{\"txid\": us0[\"txid\"], \"vout\": us0[\"vout\"]}]\n+        outputs = {addr: 0.0001}\n+        tx = node.createrawtransaction(inputs, outputs)\n+        node.settxfee(min_relay_fee)\n+        txF = node.fundrawtransaction(tx)\n+        txFS = node.signrawtransactionwithwallet(txF[\"hex\"])\n+        rpc_tx_hsh = node.sendrawtransaction(txFS[\"hex\"])\n+\n+        # check that second node doesn't have these two txns\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh not in mempool\n+        assert wallet_tx_hsh not in mempool\n+\n+        # ensure that unbroadcast txs are persisted to mempool.dat\n+        self.restart_node(0)\n+\n+        self.log.info(\"Reconnect nodes & check if they are sent to node 1\")\n+        connect_nodes(node, 1)\n+\n+        # fast forward into the future & ensure that the second node has the txns\n+        node.mockscheduler(15 * 60)  # 15 min in seconds\n+        self.sync_mempools(timeout=30)\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh in mempool\n+        assert wallet_tx_hsh in mempool\n+\n+        self.log.info(\"Add another connection & ensure transactions aren't broadcast again\")\n+\n+        conn = node.add_p2p_connection(P2PTxInvStore())\n+        node.mockscheduler(15 * 60)\n+        time.sleep(5)\n+        assert_equal(len(conn.get_invs()), 0)\n+\n+    def test_txn_removal(self):\n+        self.log.info(\"Test that transactions removed from mempool are removed from unbroadcast set\")\n+        node = self.nodes[0]\n+        disconnect_nodes(node, 1)\n+\n+        # since the node doesn't have any connections, it will not receive",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414729953",
      "id" : 414729953,
      "in_reply_to_id" : 409168043,
      "line" : 87,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDcyOTk1Mw==",
      "original_commit_id" : "6307582b4d30167a931678d12e99a00a0e75e81a",
      "original_line" : 87,
      "original_position" : 86,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : 87,
      "pull_request_review_id" : 400124132,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-24T17:47:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414729953",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414839572"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414839572"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm not fully following either, but a couple of points to highlight: \r\n- lets distinguish *unbroadcast* from *rebroadcast*. unbroadcast is extra attempts at successful initial broadcast. rebroadcast is repeated broadcasts (from the POV of the node, which cannot know full picture). \r\n- in this implementation, if victim sends INV to only one peer, peer is adversarial, replies back with GETDATA but doesn't propagate it out to the network -> victim removes from unbroadcast set & doesn't retry until ~1 day later when `ResendWalletTransactions` is triggered. so, prevents txn from making it out to mempool for a day.\r\n- @naumenkogs do you think unsolicited GETDATA messages would change this? ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-24T20:20:36Z",
      "diff_hunk" : "@@ -1605,7 +1622,13 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n                     push = true;\n                 }\n             }\n-            if (!push) {\n+\n+            if (push) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414839572",
      "id" : 414839572,
      "in_reply_to_id" : 414575673,
      "line" : 1626,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgzOTU3Mg==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 1626,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 46,
      "pull_request_review_id" : 400245266,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-24T20:20:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414839572",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414841223"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414841223"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ð¤¦ââï¸ sigh. thanks for catching! \r\n\r\nya I agree with the reasoning of in test vs framework. I'll do a small followup to add parens & have `P2PTxInvStore` call through super. ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-24T20:23:50Z",
      "diff_hunk" : "@@ -0,0 +1,104 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+import time\n+\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    disconnect_nodes,\n+    connect_nodes,\n+    create_confirmed_utxos,\n+)\n+\n+\n+class MempoolUnbroadcastTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.test_broadcast()\n+        self.test_txn_removal()\n+\n+    def test_broadcast(self):\n+        self.log.info(\"Test that mempool reattempts delivery of locally submitted transaction\")\n+        node = self.nodes[0]\n+\n+        min_relay_fee = node.getnetworkinfo()[\"relayfee\"]\n+        utxos = create_confirmed_utxos(min_relay_fee, node, 10)\n+\n+        disconnect_nodes(node, 1)\n+\n+        self.log.info(\"Generate transactions that only node 0 knows about\")\n+\n+        # generate a wallet txn\n+        addr = node.getnewaddress()\n+        wallet_tx_hsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # generate a txn using sendrawtransaction\n+        us0 = utxos.pop()\n+        inputs = [{\"txid\": us0[\"txid\"], \"vout\": us0[\"vout\"]}]\n+        outputs = {addr: 0.0001}\n+        tx = node.createrawtransaction(inputs, outputs)\n+        node.settxfee(min_relay_fee)\n+        txF = node.fundrawtransaction(tx)\n+        txFS = node.signrawtransactionwithwallet(txF[\"hex\"])\n+        rpc_tx_hsh = node.sendrawtransaction(txFS[\"hex\"])\n+\n+        # check that second node doesn't have these two txns\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh not in mempool\n+        assert wallet_tx_hsh not in mempool\n+\n+        # ensure that unbroadcast txs are persisted to mempool.dat\n+        self.restart_node(0)\n+\n+        self.log.info(\"Reconnect nodes & check if they are sent to node 1\")\n+        connect_nodes(node, 1)\n+\n+        # fast forward into the future & ensure that the second node has the txns\n+        node.mockscheduler(15 * 60)  # 15 min in seconds\n+        self.sync_mempools(timeout=30)\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh in mempool\n+        assert wallet_tx_hsh in mempool\n+\n+        self.log.info(\"Add another connection & ensure transactions aren't broadcast again\")\n+\n+        conn = node.add_p2p_connection(P2PTxInvStore())\n+        node.mockscheduler(15 * 60)\n+        time.sleep(5)\n+        assert_equal(len(conn.get_invs()), 0)\n+\n+    def test_txn_removal(self):\n+        self.log.info(\"Test that transactions removed from mempool are removed from unbroadcast set\")\n+        node = self.nodes[0]\n+        disconnect_nodes(node, 1)\n+\n+        # since the node doesn't have any connections, it will not receive",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414841223",
      "id" : 414841223,
      "in_reply_to_id" : 409168043,
      "line" : 87,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg0MTIyMw==",
      "original_commit_id" : "6307582b4d30167a931678d12e99a00a0e75e81a",
      "original_line" : 87,
      "original_position" : 86,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : 87,
      "pull_request_review_id" : 400247080,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-24T20:23:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414841223",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414866281"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414866281"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Imagine a lightning node submits a tx, but it is offline, and will be online in 30 minutes to relay it from Unbroadcast.\r\nNow an attacker connect to the victim once they got online, and send GETDATA for that transaction (before a victim broadcasts from unbroadcast).\r\n\r\nRight now, it will be ignored, because it's unsolicited (for privacy reasons!).\r\nIf we discard those privacy reasons, and now forget about this *inherent unbroadcast behaviour*, and allow unsolicited GETDATA, an attacker will be able to prevent us from broadcasting a tx, by removing a tx from unbroadcast.\r\n\r\nAnd yeah, one day for lightning is pretty bad, you will simply loose money in most of the implementations today.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-24T21:13:03Z",
      "diff_hunk" : "@@ -1605,7 +1622,13 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n                     push = true;\n                 }\n             }\n-            if (!push) {\n+\n+            if (push) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414866281",
      "id" : 414866281,
      "in_reply_to_id" : 414575673,
      "line" : 1626,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg2NjI4MQ==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 1626,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 46,
      "pull_request_review_id" : 400273957,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-24T21:13:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414866281",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414913018"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414913018"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes that's a good point, in LN there is class of transaction where txid is known from remote party due to the fact they counter-sign them (HTLC-timeout) but honest party have to broadcast with time-constrain to avoid any risk of money-loss.\r\n\r\nRight now most of implementations are pretty aggressive at triggering rebroadcast at every block, i.e calling again `sendrawtransaction` which isn't great for privacy and this may change in the future. That said, often offline nodes, like mobile, won't use core as a backend and broadcast directly their transaction on the p2p layer or submit to a third-party server. Routing nodes assumed to run core, should rebroadcast at every block so it would override some attacker messing with their unbroadcast logic.\r\n\r\nI think adopting wtxid would solve this issue because counterparty won't know about witness, at least for LN. But I agree, we should document this to keep track (add a comment commit on top or as a follow-up)",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-24T23:14:40Z",
      "diff_hunk" : "@@ -1605,7 +1622,13 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n                     push = true;\n                 }\n             }\n-            if (!push) {\n+\n+            if (push) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414913018",
      "id" : 414913018,
      "in_reply_to_id" : 414575673,
      "line" : 1626,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDkxMzAxOA==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 1626,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 46,
      "pull_request_review_id" : 400319437,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-24T23:14:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414913018",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414914956"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414914956"
         }
      },
      "author_association" : "MEMBER",
      "body" : "A simpler fix would be to add a one-line check that `pfrom` is outbound, no?",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-24T23:21:07Z",
      "diff_hunk" : "@@ -1605,7 +1622,13 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n                     push = true;\n                 }\n             }\n-            if (!push) {\n+\n+            if (push) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414914956",
      "id" : 414914956,
      "in_reply_to_id" : 414575673,
      "line" : 1626,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDkxNDk1Ng==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 1626,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 46,
      "pull_request_review_id" : 400321111,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-24T23:21:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414914956",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414920979"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414920979"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "89eeb4a\r\n\r\nShould we annotate this new methods `EXCLUSIVE_LOCKS_REQUIRED(cs_main, cs)` to increase confidence that lock order is preserved ? (like some of them are called from node helpers code and we may refactor lock tacking there at some point)",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-24T23:42:02Z",
      "diff_hunk" : "@@ -698,6 +701,21 @@ class CTxMemPool\n \n     size_t DynamicMemoryUsage() const;\n \n+    /** Adds a transaction to the unbroadcast set */\n+    void AddUnbroadcastTx(const uint256& txid) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414920979",
      "id" : 414920979,
      "line" : 705,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDkyMDk3OQ==",
      "original_commit_id" : "89eeb4a3335f8e871cc3f5286af4546dff66172a",
      "original_line" : 705,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : 15,
      "pull_request_review_id" : 400325919,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-25T00:23:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414920979",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414923208"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414923208"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "e25e42f\r\n\r\nYou could have comment that rational of recursively calling `scheduleFromNow` is to get a different `delta` every time and that way avoid an observable reattempt-period fingerprint.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-24T23:49:56Z",
      "diff_hunk" : "@@ -779,6 +779,19 @@ void PeerLogicValidation::InitializeNode(CNode *pnode) {\n         PushNodeVersion(pnode, connman, GetTime());\n }\n \n+void PeerLogicValidation::ReattemptInitialBroadcast(CScheduler& scheduler) const\n+{\n+    std::set<uint256> unbroadcast_txids = m_mempool.GetUnbroadcastTxs();\n+\n+    for (const uint256& txid : unbroadcast_txids) {\n+        RelayTransaction(txid, *connman);\n+    }\n+\n+    // schedule next run for 10-15 minutes in the future",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414923208",
      "id" : 414923208,
      "line" : 790,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDkyMzIwOA==",
      "original_commit_id" : "e25e42f20a3aa39651fbc1f9fa3df1a49f1f5868",
      "original_line" : 790,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 12,
      "pull_request_review_id" : 400325919,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-25T00:23:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414923208",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414923848"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414923848"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "dc1da48\r\n\r\n@MarcoFalke should we add a release note for this, I mean that's a substantial wallet behavior change and people may have stuff depending on this ? ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-24T23:52:16Z",
      "diff_hunk" : "@@ -1978,7 +1978,8 @@ void CWallet::ResendWalletTransactions()\n     // that these are our transactions.\n     if (GetTime() < nNextResend || !fBroadcastTransactions) return;\n     bool fFirst = (nNextResend == 0);\n-    nNextResend = GetTime() + GetRand(30 * 60);\n+    // resend 12-36 hours from now, ~1 day on average.\n+    nNextResend = GetTime() + (12 * 60 * 60) + GetRand(24 * 60 * 60);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414923848",
      "id" : 414923848,
      "line" : 1982,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDkyMzg0OA==",
      "original_commit_id" : "dc1da48dc5e5526215561311c184a8cbc345ecdc",
      "original_line" : 1982,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 6,
      "pull_request_review_id" : 400325919,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-25T00:23:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414923848",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414934194"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414934194"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think that's okay as a fix, it won't degrade the reliability improvement of aimed by this PR because we already announce sooner to outbound. But we should document better these maybe-cases of time-sensitive tx propagation obstruction (both at p2p/mempool layers) like last thread on ml shows.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-25T00:31:59Z",
      "diff_hunk" : "@@ -1605,7 +1622,13 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n                     push = true;\n                 }\n             }\n-            if (!push) {\n+\n+            if (push) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414934194",
      "id" : 414934194,
      "in_reply_to_id" : 414575673,
      "line" : 1626,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDkzNDE5NA==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 1626,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 46,
      "pull_request_review_id" : 400335588,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-25T00:32:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414934194",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414944454"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414944454"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "yeah definitely. I'm planning to add a release note as a follow up.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-25T01:20:40Z",
      "diff_hunk" : "@@ -1978,7 +1978,8 @@ void CWallet::ResendWalletTransactions()\n     // that these are our transactions.\n     if (GetTime() < nNextResend || !fBroadcastTransactions) return;\n     bool fFirst = (nNextResend == 0);\n-    nNextResend = GetTime() + GetRand(30 * 60);\n+    // resend 12-36 hours from now, ~1 day on average.\n+    nNextResend = GetTime() + (12 * 60 * 60) + GetRand(24 * 60 * 60);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414944454",
      "id" : 414944454,
      "in_reply_to_id" : 414923848,
      "line" : 1982,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDk0NDQ1NA==",
      "original_commit_id" : "dc1da48dc5e5526215561311c184a8cbc345ecdc",
      "original_line" : 1982,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 6,
      "pull_request_review_id" : 400341889,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-25T01:20:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/414944454",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r415376599"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415376599"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In e25e42f, would suggest replacing the two instances of `const std::chrono::milliseconds delta = std::chrono::minutes{10} + GetRandMillis(std::chrono::minutes{5});` and their associated comments, with a well-named function that can be called directly within each `scheduleFromNow`. The function could be Doxygen-commented with @ariard's https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414923208 above.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-26T18:58:10Z",
      "diff_hunk" : "@@ -779,6 +779,19 @@ void PeerLogicValidation::InitializeNode(CNode *pnode) {\n         PushNodeVersion(pnode, connman, GetTime());\n }\n \n+void PeerLogicValidation::ReattemptInitialBroadcast(CScheduler& scheduler) const\n+{\n+    std::set<uint256> unbroadcast_txids = m_mempool.GetUnbroadcastTxs();\n+\n+    for (const uint256& txid : unbroadcast_txids) {\n+        RelayTransaction(txid, *connman);\n+    }\n+\n+    // schedule next run for 10-15 minutes in the future\n+    const std::chrono::milliseconds delta = std::chrono::minutes{10} + GetRandMillis(std::chrono::minutes{5});\n+    scheduler.scheduleFromNow([&] { ReattemptInitialBroadcast(scheduler); }, delta);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r415376599",
      "id" : 415376599,
      "line" : 792,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTM3NjU5OQ==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 792,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 14,
      "pull_request_review_id" : 400536876,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-27T12:38:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415376599",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r415707349"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415707349"
         }
      },
      "author_association" : "MEMBER",
      "body" : "297a178 suggestion\r\n```diff\r\n+MAX_INITIAL_BROADCAST_DELAY = 15 * 60  # 15 minutes in seconds\r\n \r\n class MempoolUnbroadcastTest(BitcoinTestFramework):\r\n     def set_test_params(self):\r\n@@ -65,7 +66,7 @@ class MempoolUnbroadcastTest(BitcoinTestFramework):\r\n         connect_nodes(node, 1)\r\n \r\n         # fast forward into the future & ensure that the second node has the txns\r\n-        node.mockscheduler(15 * 60)  # 15 min in seconds\r\n+        node.mockscheduler(MAX_INITIAL_BROADCAST_DELAY)  # 15 min in seconds\r\n         self.sync_mempools(timeout=30)\r\n         mempool = self.nodes[1].getrawmempool()\r\n         assert rpc_tx_hsh in mempool\r\n@@ -74,7 +75,7 @@ class MempoolUnbroadcastTest(BitcoinTestFramework):\r\n         self.log.info(\"Add another connection & ensure transactions aren't broadcast again\")\r\n \r\n         conn = node.add_p2p_connection(P2PTxInvStore())\r\n-        node.mockscheduler(15 * 60)\r\n+        node.mockscheduler(MAX_INITIAL_BROADCAST_DELAY)\r\n         time.sleep(5)\r\n```",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-27T10:46:29Z",
      "diff_hunk" : "@@ -0,0 +1,99 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+import time\n+\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    connect_nodes,\n+    create_confirmed_utxos,\n+    disconnect_nodes,\n+)\n+\n+\n+class MempoolUnbroadcastTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.test_broadcast()\n+        self.test_txn_removal()\n+\n+    def test_broadcast(self):\n+        self.log.info(\"Test that mempool reattempts delivery of locally submitted transaction\")\n+        node = self.nodes[0]\n+\n+        min_relay_fee = node.getnetworkinfo()[\"relayfee\"]\n+        utxos = create_confirmed_utxos(min_relay_fee, node, 10)\n+\n+        disconnect_nodes(node, 1)\n+\n+        self.log.info(\"Generate transactions that only node 0 knows about\")\n+\n+        # generate a wallet txn\n+        addr = node.getnewaddress()\n+        wallet_tx_hsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # generate a txn using sendrawtransaction\n+        us0 = utxos.pop()\n+        inputs = [{\"txid\": us0[\"txid\"], \"vout\": us0[\"vout\"]}]\n+        outputs = {addr: 0.0001}\n+        tx = node.createrawtransaction(inputs, outputs)\n+        node.settxfee(min_relay_fee)\n+        txF = node.fundrawtransaction(tx)\n+        txFS = node.signrawtransactionwithwallet(txF[\"hex\"])\n+        rpc_tx_hsh = node.sendrawtransaction(txFS[\"hex\"])\n+\n+        # check that second node doesn't have these two txns\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh not in mempool\n+        assert wallet_tx_hsh not in mempool\n+\n+        # ensure that unbroadcast txs are persisted to mempool.dat\n+        self.restart_node(0)\n+\n+        self.log.info(\"Reconnect nodes & check if they are sent to node 1\")\n+        connect_nodes(node, 1)\n+\n+        # fast forward into the future & ensure that the second node has the txns\n+        node.mockscheduler(15 * 60)  # 15 min in seconds",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r415707349",
      "id" : 415707349,
      "line" : 68,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTcwNzM0OQ==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 68,
      "original_position" : 68,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : 68,
      "pull_request_review_id" : 400536876,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-27T12:38:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415707349",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r415708579"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415708579"
         }
      },
      "author_association" : "MEMBER",
      "body" : "297a178 is the 5 second sleep necessary? It adds 50% to the run time of this file which appears to pass reliably without it. If it is needed, could add a comment explaining why?",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-27T10:48:21Z",
      "diff_hunk" : "@@ -0,0 +1,99 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+import time\n+\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    connect_nodes,\n+    create_confirmed_utxos,\n+    disconnect_nodes,\n+)\n+\n+\n+class MempoolUnbroadcastTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.test_broadcast()\n+        self.test_txn_removal()\n+\n+    def test_broadcast(self):\n+        self.log.info(\"Test that mempool reattempts delivery of locally submitted transaction\")\n+        node = self.nodes[0]\n+\n+        min_relay_fee = node.getnetworkinfo()[\"relayfee\"]\n+        utxos = create_confirmed_utxos(min_relay_fee, node, 10)\n+\n+        disconnect_nodes(node, 1)\n+\n+        self.log.info(\"Generate transactions that only node 0 knows about\")\n+\n+        # generate a wallet txn\n+        addr = node.getnewaddress()\n+        wallet_tx_hsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # generate a txn using sendrawtransaction\n+        us0 = utxos.pop()\n+        inputs = [{\"txid\": us0[\"txid\"], \"vout\": us0[\"vout\"]}]\n+        outputs = {addr: 0.0001}\n+        tx = node.createrawtransaction(inputs, outputs)\n+        node.settxfee(min_relay_fee)\n+        txF = node.fundrawtransaction(tx)\n+        txFS = node.signrawtransactionwithwallet(txF[\"hex\"])\n+        rpc_tx_hsh = node.sendrawtransaction(txFS[\"hex\"])\n+\n+        # check that second node doesn't have these two txns\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh not in mempool\n+        assert wallet_tx_hsh not in mempool\n+\n+        # ensure that unbroadcast txs are persisted to mempool.dat\n+        self.restart_node(0)\n+\n+        self.log.info(\"Reconnect nodes & check if they are sent to node 1\")\n+        connect_nodes(node, 1)\n+\n+        # fast forward into the future & ensure that the second node has the txns\n+        node.mockscheduler(15 * 60)  # 15 min in seconds\n+        self.sync_mempools(timeout=30)\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh in mempool\n+        assert wallet_tx_hsh in mempool\n+\n+        self.log.info(\"Add another connection & ensure transactions aren't broadcast again\")\n+\n+        conn = node.add_p2p_connection(P2PTxInvStore())\n+        node.mockscheduler(15 * 60)\n+        time.sleep(5)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r415708579",
      "id" : 415708579,
      "line" : 78,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTcwODU3OQ==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 78,
      "original_position" : 78,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : 78,
      "pull_request_review_id" : 400536876,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-27T12:38:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415708579",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r415709839"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415709839"
         }
      },
      "author_association" : "MEMBER",
      "body" : "297a178 this looks like a bug?\r\n```diff\r\n-        node.disconnect_p2ps\r\n+        node.disconnect_p2ps()\r\n```",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-27T10:50:29Z",
      "diff_hunk" : "@@ -0,0 +1,99 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+import time\n+\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    connect_nodes,\n+    create_confirmed_utxos,\n+    disconnect_nodes,\n+)\n+\n+\n+class MempoolUnbroadcastTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.test_broadcast()\n+        self.test_txn_removal()\n+\n+    def test_broadcast(self):\n+        self.log.info(\"Test that mempool reattempts delivery of locally submitted transaction\")\n+        node = self.nodes[0]\n+\n+        min_relay_fee = node.getnetworkinfo()[\"relayfee\"]\n+        utxos = create_confirmed_utxos(min_relay_fee, node, 10)\n+\n+        disconnect_nodes(node, 1)\n+\n+        self.log.info(\"Generate transactions that only node 0 knows about\")\n+\n+        # generate a wallet txn\n+        addr = node.getnewaddress()\n+        wallet_tx_hsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # generate a txn using sendrawtransaction\n+        us0 = utxos.pop()\n+        inputs = [{\"txid\": us0[\"txid\"], \"vout\": us0[\"vout\"]}]\n+        outputs = {addr: 0.0001}\n+        tx = node.createrawtransaction(inputs, outputs)\n+        node.settxfee(min_relay_fee)\n+        txF = node.fundrawtransaction(tx)\n+        txFS = node.signrawtransactionwithwallet(txF[\"hex\"])\n+        rpc_tx_hsh = node.sendrawtransaction(txFS[\"hex\"])\n+\n+        # check that second node doesn't have these two txns\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh not in mempool\n+        assert wallet_tx_hsh not in mempool\n+\n+        # ensure that unbroadcast txs are persisted to mempool.dat\n+        self.restart_node(0)\n+\n+        self.log.info(\"Reconnect nodes & check if they are sent to node 1\")\n+        connect_nodes(node, 1)\n+\n+        # fast forward into the future & ensure that the second node has the txns\n+        node.mockscheduler(15 * 60)  # 15 min in seconds\n+        self.sync_mempools(timeout=30)\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh in mempool\n+        assert wallet_tx_hsh in mempool\n+\n+        self.log.info(\"Add another connection & ensure transactions aren't broadcast again\")\n+\n+        conn = node.add_p2p_connection(P2PTxInvStore())\n+        node.mockscheduler(15 * 60)\n+        time.sleep(5)\n+        assert_equal(len(conn.get_invs()), 0)\n+\n+    def test_txn_removal(self):\n+        self.log.info(\"Test that transactions removed from mempool are removed from unbroadcast set\")\n+        node = self.nodes[0]\n+        disconnect_nodes(node, 1)\n+        node.disconnect_p2ps",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r415709839",
      "id" : 415709839,
      "line" : 85,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTcwOTgzOQ==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 85,
      "original_position" : 85,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : 85,
      "pull_request_review_id" : 400536876,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-27T12:38:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415709839",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r415750840"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415750840"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In dc1da48 I think a test is missing here to check that the transaction is not rebroadcast the first 12 hours.\r\n```python\r\n        # Check transaction is rebroadcast in 12-36 hour time interval.\r\n        time_now = int(time.time())\r\n\r\n        self.log.info(\"Bump time 12 hours from now, check transaction is not yet rebroadcast\")\r\n        rebroadcast_time = time_now  + (12 * 60 * 60)\r\n        node.setmocktime(rebroadcast_time)\r\n        assert_equal(node.p2ps[1].tx_invs_received[txid], 0)\r\n\r\n        self.log.info(\"Bump time 36 hours from now, check transaction is rebroadcast\")\r\n        rebroadcast_time = time_now + (36 * 60 * 60)\r\n        node.setmocktime(rebroadcast_time)\r\n        wait_until(lambda: node.p2ps[1].tx_invs_received[txid] >= 1, lock=mininode_lock)\r\n```",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-27T11:58:33Z",
      "diff_hunk" : "@@ -69,9 +54,10 @@ def run_test(self):\n         node.p2ps[1].sync_with_ping()\n         assert_equal(node.p2ps[1].tx_invs_received[txid], 0)\n \n-        self.log.info(\"Transaction should be rebroadcast after 30 minutes\")\n-        # Use mocktime and give an extra 5 minutes to be sure.\n-        rebroadcast_time = int(time.time()) + 41 * 60\n+        self.log.info(\"Bump time & check that transaction is rebroadcast\")\n+        # Transaction should be rebroadcast approximately 24 hours in the future,\n+        # but can range from 12-36. So bump 36 hours to be sure.\n+        rebroadcast_time = int(time.time()) + 36 * 60 * 60",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r415750840",
      "id" : 415750840,
      "line" : 60,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc1MDg0MA==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 60,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 59,
      "pull_request_review_id" : 400536876,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-27T12:38:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415750840",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r415780848"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415780848"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> [89eeb4a](https://github.com/bitcoin/bitcoin/commit/89eeb4a3335f8e871cc3f5286af4546dff66172a)\r\n> \r\n> Should we annotate this new methods `EXCLUSIVE_LOCKS_REQUIRED(cs_main, cs)` to increase confidence that lock order is preserved ? (like some of them are called from node helpers code and we may refactor lock tacking there at some point)\r\n\r\nWas asking myself this as well.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-27T12:45:41Z",
      "diff_hunk" : "@@ -698,6 +701,21 @@ class CTxMemPool\n \n     size_t DynamicMemoryUsage() const;\n \n+    /** Adds a transaction to the unbroadcast set */\n+    void AddUnbroadcastTx(const uint256& txid) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r415780848",
      "id" : 415780848,
      "in_reply_to_id" : 414920979,
      "line" : 705,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc4MDg0OA==",
      "original_commit_id" : "89eeb4a3335f8e871cc3f5286af4546dff66172a",
      "original_line" : 705,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : 15,
      "pull_request_review_id" : 400914880,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-27T12:45:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415780848",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r415783405"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415783405"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Enforcing lock order with annotations has never been done in the past. This is generally a layer violation, see also https://github.com/bitcoin/bitcoin/pull/18458#issuecomment-605657525",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-27T12:49:21Z",
      "diff_hunk" : "@@ -698,6 +701,21 @@ class CTxMemPool\n \n     size_t DynamicMemoryUsage() const;\n \n+    /** Adds a transaction to the unbroadcast set */\n+    void AddUnbroadcastTx(const uint256& txid) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r415783405",
      "id" : 415783405,
      "in_reply_to_id" : 414920979,
      "line" : 705,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc4MzQwNQ==",
      "original_commit_id" : "89eeb4a3335f8e871cc3f5286af4546dff66172a",
      "original_line" : 705,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : 15,
      "pull_request_review_id" : 400917754,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-27T12:49:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/415783405",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416826914"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416826914"
         }
      },
      "author_association" : "MEMBER",
      "body" : "For follow-up PR: I think it should now be possible to remove the `nLastResend` logic, since we'd always expect there to be a block in the 12-36 hours since the last rebroadcast attempt.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-28T18:20:28Z",
      "diff_hunk" : "@@ -1978,7 +1978,8 @@ void CWallet::ResendWalletTransactions()\n     // that these are our transactions.\n     if (GetTime() < nNextResend || !fBroadcastTransactions) return;\n     bool fFirst = (nNextResend == 0);\n-    nNextResend = GetTime() + GetRand(30 * 60);\n+    // resend 12-36 hours from now, ~1 day on average.\n+    nNextResend = GetTime() + (12 * 60 * 60) + GetRand(24 * 60 * 60);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416826914",
      "id" : 416826914,
      "line" : 1982,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjgyNjkxNA==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 1982,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 6,
      "pull_request_review_id" : 402096591,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-28T19:33:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416826914",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416834316"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416834316"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think it's to give the scheduler thread time to wake and call `ReattemptInitialBroadcast()` again. If you remove the sleep, then the transaction could potentially be broadcast after the assert_equal below and the test wouldn't test that the tx isn't being unbroadcast.\r\n\r\nI think the sleep could be a bit shorter, and a comment wouldn't harm, but only if the PR is being retouched.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-28T18:32:02Z",
      "diff_hunk" : "@@ -0,0 +1,99 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+import time\n+\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    connect_nodes,\n+    create_confirmed_utxos,\n+    disconnect_nodes,\n+)\n+\n+\n+class MempoolUnbroadcastTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.test_broadcast()\n+        self.test_txn_removal()\n+\n+    def test_broadcast(self):\n+        self.log.info(\"Test that mempool reattempts delivery of locally submitted transaction\")\n+        node = self.nodes[0]\n+\n+        min_relay_fee = node.getnetworkinfo()[\"relayfee\"]\n+        utxos = create_confirmed_utxos(min_relay_fee, node, 10)\n+\n+        disconnect_nodes(node, 1)\n+\n+        self.log.info(\"Generate transactions that only node 0 knows about\")\n+\n+        # generate a wallet txn\n+        addr = node.getnewaddress()\n+        wallet_tx_hsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # generate a txn using sendrawtransaction\n+        us0 = utxos.pop()\n+        inputs = [{\"txid\": us0[\"txid\"], \"vout\": us0[\"vout\"]}]\n+        outputs = {addr: 0.0001}\n+        tx = node.createrawtransaction(inputs, outputs)\n+        node.settxfee(min_relay_fee)\n+        txF = node.fundrawtransaction(tx)\n+        txFS = node.signrawtransactionwithwallet(txF[\"hex\"])\n+        rpc_tx_hsh = node.sendrawtransaction(txFS[\"hex\"])\n+\n+        # check that second node doesn't have these two txns\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh not in mempool\n+        assert wallet_tx_hsh not in mempool\n+\n+        # ensure that unbroadcast txs are persisted to mempool.dat\n+        self.restart_node(0)\n+\n+        self.log.info(\"Reconnect nodes & check if they are sent to node 1\")\n+        connect_nodes(node, 1)\n+\n+        # fast forward into the future & ensure that the second node has the txns\n+        node.mockscheduler(15 * 60)  # 15 min in seconds\n+        self.sync_mempools(timeout=30)\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh in mempool\n+        assert wallet_tx_hsh in mempool\n+\n+        self.log.info(\"Add another connection & ensure transactions aren't broadcast again\")\n+\n+        conn = node.add_p2p_connection(P2PTxInvStore())\n+        node.mockscheduler(15 * 60)\n+        time.sleep(5)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416834316",
      "id" : 416834316,
      "in_reply_to_id" : 415708579,
      "line" : 78,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjgzNDMxNg==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 78,
      "original_position" : 78,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : 78,
      "pull_request_review_id" : 402096591,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-28T19:33:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416834316",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416837031"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416837031"
         }
      },
      "author_association" : "MEMBER",
      "body" : "When you're retouching this, I suggest moving the disconnection logic to the end of `test_broadcast()`, so that each sub-test starts with the same state (no connections). It's not a problem now, but in larger test files where there are many subtests, lingering state between subtests makes debugging more difficult.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-28T18:36:32Z",
      "diff_hunk" : "@@ -0,0 +1,99 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+import time\n+\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    connect_nodes,\n+    create_confirmed_utxos,\n+    disconnect_nodes,\n+)\n+\n+\n+class MempoolUnbroadcastTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.test_broadcast()\n+        self.test_txn_removal()\n+\n+    def test_broadcast(self):\n+        self.log.info(\"Test that mempool reattempts delivery of locally submitted transaction\")\n+        node = self.nodes[0]\n+\n+        min_relay_fee = node.getnetworkinfo()[\"relayfee\"]\n+        utxos = create_confirmed_utxos(min_relay_fee, node, 10)\n+\n+        disconnect_nodes(node, 1)\n+\n+        self.log.info(\"Generate transactions that only node 0 knows about\")\n+\n+        # generate a wallet txn\n+        addr = node.getnewaddress()\n+        wallet_tx_hsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # generate a txn using sendrawtransaction\n+        us0 = utxos.pop()\n+        inputs = [{\"txid\": us0[\"txid\"], \"vout\": us0[\"vout\"]}]\n+        outputs = {addr: 0.0001}\n+        tx = node.createrawtransaction(inputs, outputs)\n+        node.settxfee(min_relay_fee)\n+        txF = node.fundrawtransaction(tx)\n+        txFS = node.signrawtransactionwithwallet(txF[\"hex\"])\n+        rpc_tx_hsh = node.sendrawtransaction(txFS[\"hex\"])\n+\n+        # check that second node doesn't have these two txns\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh not in mempool\n+        assert wallet_tx_hsh not in mempool\n+\n+        # ensure that unbroadcast txs are persisted to mempool.dat\n+        self.restart_node(0)\n+\n+        self.log.info(\"Reconnect nodes & check if they are sent to node 1\")\n+        connect_nodes(node, 1)\n+\n+        # fast forward into the future & ensure that the second node has the txns\n+        node.mockscheduler(15 * 60)  # 15 min in seconds\n+        self.sync_mempools(timeout=30)\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh in mempool\n+        assert wallet_tx_hsh in mempool\n+\n+        self.log.info(\"Add another connection & ensure transactions aren't broadcast again\")\n+\n+        conn = node.add_p2p_connection(P2PTxInvStore())\n+        node.mockscheduler(15 * 60)\n+        time.sleep(5)\n+        assert_equal(len(conn.get_invs()), 0)\n+\n+    def test_txn_removal(self):\n+        self.log.info(\"Test that transactions removed from mempool are removed from unbroadcast set\")\n+        node = self.nodes[0]\n+        disconnect_nodes(node, 1)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416837031",
      "id" : 416837031,
      "line" : 84,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjgzNzAzMQ==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 84,
      "original_position" : 84,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : 84,
      "pull_request_review_id" : 402096591,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-28T19:33:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416837031",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416837980"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416837980"
         }
      },
      "author_association" : "MEMBER",
      "body" : "(for a future PR) it'd be a nice enhancement to update:\r\n\r\n- the `getmempoolinfo` RPC to show an unbroadcast count\r\n- the `getrawmempool` RPCs to show an unbroadcast flag for each transaction\r\n\r\nThat'd make it easier to test this directly rather than through log-parsing.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-28T18:38:07Z",
      "diff_hunk" : "@@ -0,0 +1,99 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+import time\n+\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    connect_nodes,\n+    create_confirmed_utxos,\n+    disconnect_nodes,\n+)\n+\n+\n+class MempoolUnbroadcastTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.test_broadcast()\n+        self.test_txn_removal()\n+\n+    def test_broadcast(self):\n+        self.log.info(\"Test that mempool reattempts delivery of locally submitted transaction\")\n+        node = self.nodes[0]\n+\n+        min_relay_fee = node.getnetworkinfo()[\"relayfee\"]\n+        utxos = create_confirmed_utxos(min_relay_fee, node, 10)\n+\n+        disconnect_nodes(node, 1)\n+\n+        self.log.info(\"Generate transactions that only node 0 knows about\")\n+\n+        # generate a wallet txn\n+        addr = node.getnewaddress()\n+        wallet_tx_hsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # generate a txn using sendrawtransaction\n+        us0 = utxos.pop()\n+        inputs = [{\"txid\": us0[\"txid\"], \"vout\": us0[\"vout\"]}]\n+        outputs = {addr: 0.0001}\n+        tx = node.createrawtransaction(inputs, outputs)\n+        node.settxfee(min_relay_fee)\n+        txF = node.fundrawtransaction(tx)\n+        txFS = node.signrawtransactionwithwallet(txF[\"hex\"])\n+        rpc_tx_hsh = node.sendrawtransaction(txFS[\"hex\"])\n+\n+        # check that second node doesn't have these two txns\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh not in mempool\n+        assert wallet_tx_hsh not in mempool\n+\n+        # ensure that unbroadcast txs are persisted to mempool.dat\n+        self.restart_node(0)\n+\n+        self.log.info(\"Reconnect nodes & check if they are sent to node 1\")\n+        connect_nodes(node, 1)\n+\n+        # fast forward into the future & ensure that the second node has the txns\n+        node.mockscheduler(15 * 60)  # 15 min in seconds\n+        self.sync_mempools(timeout=30)\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh in mempool\n+        assert wallet_tx_hsh in mempool\n+\n+        self.log.info(\"Add another connection & ensure transactions aren't broadcast again\")\n+\n+        conn = node.add_p2p_connection(P2PTxInvStore())\n+        node.mockscheduler(15 * 60)\n+        time.sleep(5)\n+        assert_equal(len(conn.get_invs()), 0)\n+\n+    def test_txn_removal(self):\n+        self.log.info(\"Test that transactions removed from mempool are removed from unbroadcast set\")\n+        node = self.nodes[0]\n+        disconnect_nodes(node, 1)\n+        node.disconnect_p2ps\n+\n+        # since the node doesn't have any connections, it will not receive\n+        # any GETDATAs & thus the transaction will remain in the unbroadcast set.\n+        addr = node.getnewaddress()\n+        txhsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # check transaction was removed from unbroadcast set due to presence in\n+        # a block\n+        removal_reason = \"Removed {} from set of unbroadcast txns before confirmation that txn was sent out\".format(txhsh)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416837980",
      "id" : 416837980,
      "line" : 94,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjgzNzk4MA==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 94,
      "original_position" : 94,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : 94,
      "pull_request_review_id" : 402096591,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-28T19:33:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416837980",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416861609"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416861609"
         }
      },
      "author_association" : "MEMBER",
      "body" : "For a follow-up, I think we should sanity check that the transaction still exists in the mempool before rebroadcasting. If not, delete the entry from the unbroadcast set.\r\n\r\nIf we don't do this, then a logic error where the entry isn't removed from the unbroadcast set when the tx is removed from the mempool turns into a memory leak and a network spam.\r\n\r\n(Removal logic in removeUnchecked() is pretty straightforward and looks fine in this PR, but adding this extra check does no harm. It'd prevent a bug like https://github.com/bitcoin/bitcoin/pull/18038#discussion_r407665982 from causing eternal network spam)",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-28T19:18:29Z",
      "diff_hunk" : "@@ -779,6 +779,19 @@ void PeerLogicValidation::InitializeNode(CNode *pnode) {\n         PushNodeVersion(pnode, connman, GetTime());\n }\n \n+void PeerLogicValidation::ReattemptInitialBroadcast(CScheduler& scheduler) const\n+{\n+    std::set<uint256> unbroadcast_txids = m_mempool.GetUnbroadcastTxs();\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416861609",
      "id" : 416861609,
      "line" : 785,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjg2MTYwOQ==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 785,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 7,
      "pull_request_review_id" : 402096591,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-28T19:33:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416861609",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416862364"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416862364"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this could be an unordered_set for constant-time insertion/lookup, but the size is going to be so small that it doesn't matter.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-28T19:19:48Z",
      "diff_hunk" : "@@ -549,6 +549,9 @@ class CTxMemPool\n \n     std::vector<indexed_transaction_set::const_iterator> GetSortedDepthAndScore() const EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n+    /** track locally submitted transactions to periodically retry initial broadcast */\n+    std::set<uint256> m_unbroadcast_txids GUARDED_BY(cs);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416862364",
      "id" : 416862364,
      "line" : 553,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjg2MjM2NA==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 553,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : 5,
      "pull_request_review_id" : 402096591,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-28T19:33:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416862364",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416941785"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416941785"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ð added in https://github.com/bitcoin/bitcoin/pull/18807/commits/b5bb038f0eae2eefb923343fdb05b3992c32c208",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-28T21:42:35Z",
      "diff_hunk" : "@@ -779,6 +779,19 @@ void PeerLogicValidation::InitializeNode(CNode *pnode) {\n         PushNodeVersion(pnode, connman, GetTime());\n }\n \n+void PeerLogicValidation::ReattemptInitialBroadcast(CScheduler& scheduler) const\n+{\n+    std::set<uint256> unbroadcast_txids = m_mempool.GetUnbroadcastTxs();\n+\n+    for (const uint256& txid : unbroadcast_txids) {\n+        RelayTransaction(txid, *connman);\n+    }\n+\n+    // schedule next run for 10-15 minutes in the future",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416941785",
      "id" : 416941785,
      "in_reply_to_id" : 414923208,
      "line" : 790,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk0MTc4NQ==",
      "original_commit_id" : "e25e42f20a3aa39651fbc1f9fa3df1a49f1f5868",
      "original_line" : 790,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 12,
      "pull_request_review_id" : 402233875,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-28T21:42:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416941785",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416942057"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416942057"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "added here: https://github.com/bitcoin/bitcoin/pull/18807/commits/bff4e9a5005409811e3f48c8d8877d63b32c9054",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-28T21:43:09Z",
      "diff_hunk" : "@@ -1978,7 +1978,8 @@ void CWallet::ResendWalletTransactions()\n     // that these are our transactions.\n     if (GetTime() < nNextResend || !fBroadcastTransactions) return;\n     bool fFirst = (nNextResend == 0);\n-    nNextResend = GetTime() + GetRand(30 * 60);\n+    // resend 12-36 hours from now, ~1 day on average.\n+    nNextResend = GetTime() + (12 * 60 * 60) + GetRand(24 * 60 * 60);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416942057",
      "id" : 416942057,
      "in_reply_to_id" : 414923848,
      "line" : 1982,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk0MjA1Nw==",
      "original_commit_id" : "dc1da48dc5e5526215561311c184a8cbc345ecdc",
      "original_line" : 1982,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 6,
      "pull_request_review_id" : 402234182,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-28T21:43:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416942057",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416944577"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416944577"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "fixed here: https://github.com/bitcoin/bitcoin/pull/18807/commits/97f15b487f064cf359e8042afa25a5d0fb88bf8c ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-28T21:48:27Z",
      "diff_hunk" : "@@ -0,0 +1,104 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+import time\n+\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    disconnect_nodes,\n+    connect_nodes,\n+    create_confirmed_utxos,\n+)\n+\n+\n+class MempoolUnbroadcastTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.test_broadcast()\n+        self.test_txn_removal()\n+\n+    def test_broadcast(self):\n+        self.log.info(\"Test that mempool reattempts delivery of locally submitted transaction\")\n+        node = self.nodes[0]\n+\n+        min_relay_fee = node.getnetworkinfo()[\"relayfee\"]\n+        utxos = create_confirmed_utxos(min_relay_fee, node, 10)\n+\n+        disconnect_nodes(node, 1)\n+\n+        self.log.info(\"Generate transactions that only node 0 knows about\")\n+\n+        # generate a wallet txn\n+        addr = node.getnewaddress()\n+        wallet_tx_hsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # generate a txn using sendrawtransaction\n+        us0 = utxos.pop()\n+        inputs = [{\"txid\": us0[\"txid\"], \"vout\": us0[\"vout\"]}]\n+        outputs = {addr: 0.0001}\n+        tx = node.createrawtransaction(inputs, outputs)\n+        node.settxfee(min_relay_fee)\n+        txF = node.fundrawtransaction(tx)\n+        txFS = node.signrawtransactionwithwallet(txF[\"hex\"])\n+        rpc_tx_hsh = node.sendrawtransaction(txFS[\"hex\"])\n+\n+        # check that second node doesn't have these two txns\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh not in mempool\n+        assert wallet_tx_hsh not in mempool\n+\n+        # ensure that unbroadcast txs are persisted to mempool.dat\n+        self.restart_node(0)\n+\n+        self.log.info(\"Reconnect nodes & check if they are sent to node 1\")\n+        connect_nodes(node, 1)\n+\n+        # fast forward into the future & ensure that the second node has the txns\n+        node.mockscheduler(15 * 60)  # 15 min in seconds\n+        self.sync_mempools(timeout=30)\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh in mempool\n+        assert wallet_tx_hsh in mempool\n+\n+        self.log.info(\"Add another connection & ensure transactions aren't broadcast again\")\n+\n+        conn = node.add_p2p_connection(P2PTxInvStore())\n+        node.mockscheduler(15 * 60)\n+        time.sleep(5)\n+        assert_equal(len(conn.get_invs()), 0)\n+\n+    def test_txn_removal(self):\n+        self.log.info(\"Test that transactions removed from mempool are removed from unbroadcast set\")\n+        node = self.nodes[0]\n+        disconnect_nodes(node, 1)\n+\n+        # since the node doesn't have any connections, it will not receive",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416944577",
      "id" : 416944577,
      "in_reply_to_id" : 409168043,
      "line" : 87,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk0NDU3Nw==",
      "original_commit_id" : "6307582b4d30167a931678d12e99a00a0e75e81a",
      "original_line" : 87,
      "original_position" : 86,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : 87,
      "pull_request_review_id" : 402237060,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-28T21:48:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416944577",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416944839"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416944839"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "yes, see https://github.com/bitcoin/bitcoin/pull/18038#discussion_r414729953.\r\nfixed in https://github.com/bitcoin/bitcoin/pull/18807/commits/97f15b487f064cf359e8042afa25a5d0fb88bf8c.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-28T21:49:03Z",
      "diff_hunk" : "@@ -0,0 +1,99 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+import time\n+\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    connect_nodes,\n+    create_confirmed_utxos,\n+    disconnect_nodes,\n+)\n+\n+\n+class MempoolUnbroadcastTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.test_broadcast()\n+        self.test_txn_removal()\n+\n+    def test_broadcast(self):\n+        self.log.info(\"Test that mempool reattempts delivery of locally submitted transaction\")\n+        node = self.nodes[0]\n+\n+        min_relay_fee = node.getnetworkinfo()[\"relayfee\"]\n+        utxos = create_confirmed_utxos(min_relay_fee, node, 10)\n+\n+        disconnect_nodes(node, 1)\n+\n+        self.log.info(\"Generate transactions that only node 0 knows about\")\n+\n+        # generate a wallet txn\n+        addr = node.getnewaddress()\n+        wallet_tx_hsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # generate a txn using sendrawtransaction\n+        us0 = utxos.pop()\n+        inputs = [{\"txid\": us0[\"txid\"], \"vout\": us0[\"vout\"]}]\n+        outputs = {addr: 0.0001}\n+        tx = node.createrawtransaction(inputs, outputs)\n+        node.settxfee(min_relay_fee)\n+        txF = node.fundrawtransaction(tx)\n+        txFS = node.signrawtransactionwithwallet(txF[\"hex\"])\n+        rpc_tx_hsh = node.sendrawtransaction(txFS[\"hex\"])\n+\n+        # check that second node doesn't have these two txns\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh not in mempool\n+        assert wallet_tx_hsh not in mempool\n+\n+        # ensure that unbroadcast txs are persisted to mempool.dat\n+        self.restart_node(0)\n+\n+        self.log.info(\"Reconnect nodes & check if they are sent to node 1\")\n+        connect_nodes(node, 1)\n+\n+        # fast forward into the future & ensure that the second node has the txns\n+        node.mockscheduler(15 * 60)  # 15 min in seconds\n+        self.sync_mempools(timeout=30)\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh in mempool\n+        assert wallet_tx_hsh in mempool\n+\n+        self.log.info(\"Add another connection & ensure transactions aren't broadcast again\")\n+\n+        conn = node.add_p2p_connection(P2PTxInvStore())\n+        node.mockscheduler(15 * 60)\n+        time.sleep(5)\n+        assert_equal(len(conn.get_invs()), 0)\n+\n+    def test_txn_removal(self):\n+        self.log.info(\"Test that transactions removed from mempool are removed from unbroadcast set\")\n+        node = self.nodes[0]\n+        disconnect_nodes(node, 1)\n+        node.disconnect_p2ps",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416944839",
      "id" : 416944839,
      "in_reply_to_id" : 415709839,
      "line" : 85,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk0NDgzOQ==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 85,
      "original_position" : 85,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : 85,
      "pull_request_review_id" : 402237368,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-28T21:49:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416944839",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416945180"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416945180"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "taken in https://github.com/bitcoin/bitcoin/pull/18807/commits/97f15b487f064cf359e8042afa25a5d0fb88bf8c (PR #18807)",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-28T21:49:48Z",
      "diff_hunk" : "@@ -0,0 +1,99 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+import time\n+\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    connect_nodes,\n+    create_confirmed_utxos,\n+    disconnect_nodes,\n+)\n+\n+\n+class MempoolUnbroadcastTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.test_broadcast()\n+        self.test_txn_removal()\n+\n+    def test_broadcast(self):\n+        self.log.info(\"Test that mempool reattempts delivery of locally submitted transaction\")\n+        node = self.nodes[0]\n+\n+        min_relay_fee = node.getnetworkinfo()[\"relayfee\"]\n+        utxos = create_confirmed_utxos(min_relay_fee, node, 10)\n+\n+        disconnect_nodes(node, 1)\n+\n+        self.log.info(\"Generate transactions that only node 0 knows about\")\n+\n+        # generate a wallet txn\n+        addr = node.getnewaddress()\n+        wallet_tx_hsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # generate a txn using sendrawtransaction\n+        us0 = utxos.pop()\n+        inputs = [{\"txid\": us0[\"txid\"], \"vout\": us0[\"vout\"]}]\n+        outputs = {addr: 0.0001}\n+        tx = node.createrawtransaction(inputs, outputs)\n+        node.settxfee(min_relay_fee)\n+        txF = node.fundrawtransaction(tx)\n+        txFS = node.signrawtransactionwithwallet(txF[\"hex\"])\n+        rpc_tx_hsh = node.sendrawtransaction(txFS[\"hex\"])\n+\n+        # check that second node doesn't have these two txns\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh not in mempool\n+        assert wallet_tx_hsh not in mempool\n+\n+        # ensure that unbroadcast txs are persisted to mempool.dat\n+        self.restart_node(0)\n+\n+        self.log.info(\"Reconnect nodes & check if they are sent to node 1\")\n+        connect_nodes(node, 1)\n+\n+        # fast forward into the future & ensure that the second node has the txns\n+        node.mockscheduler(15 * 60)  # 15 min in seconds",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416945180",
      "id" : 416945180,
      "in_reply_to_id" : 415707349,
      "line" : 68,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk0NTE4MA==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 68,
      "original_position" : 68,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : 68,
      "pull_request_review_id" : 402237797,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-28T21:51:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416945180",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416946204"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416946204"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "yup. reduced sleep and added comment here: 97f15b487f064cf359e8042afa25a5d0fb88bf8c (PR #18807)",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-28T21:52:13Z",
      "diff_hunk" : "@@ -0,0 +1,99 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+import time\n+\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    connect_nodes,\n+    create_confirmed_utxos,\n+    disconnect_nodes,\n+)\n+\n+\n+class MempoolUnbroadcastTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.test_broadcast()\n+        self.test_txn_removal()\n+\n+    def test_broadcast(self):\n+        self.log.info(\"Test that mempool reattempts delivery of locally submitted transaction\")\n+        node = self.nodes[0]\n+\n+        min_relay_fee = node.getnetworkinfo()[\"relayfee\"]\n+        utxos = create_confirmed_utxos(min_relay_fee, node, 10)\n+\n+        disconnect_nodes(node, 1)\n+\n+        self.log.info(\"Generate transactions that only node 0 knows about\")\n+\n+        # generate a wallet txn\n+        addr = node.getnewaddress()\n+        wallet_tx_hsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # generate a txn using sendrawtransaction\n+        us0 = utxos.pop()\n+        inputs = [{\"txid\": us0[\"txid\"], \"vout\": us0[\"vout\"]}]\n+        outputs = {addr: 0.0001}\n+        tx = node.createrawtransaction(inputs, outputs)\n+        node.settxfee(min_relay_fee)\n+        txF = node.fundrawtransaction(tx)\n+        txFS = node.signrawtransactionwithwallet(txF[\"hex\"])\n+        rpc_tx_hsh = node.sendrawtransaction(txFS[\"hex\"])\n+\n+        # check that second node doesn't have these two txns\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh not in mempool\n+        assert wallet_tx_hsh not in mempool\n+\n+        # ensure that unbroadcast txs are persisted to mempool.dat\n+        self.restart_node(0)\n+\n+        self.log.info(\"Reconnect nodes & check if they are sent to node 1\")\n+        connect_nodes(node, 1)\n+\n+        # fast forward into the future & ensure that the second node has the txns\n+        node.mockscheduler(15 * 60)  # 15 min in seconds\n+        self.sync_mempools(timeout=30)\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh in mempool\n+        assert wallet_tx_hsh in mempool\n+\n+        self.log.info(\"Add another connection & ensure transactions aren't broadcast again\")\n+\n+        conn = node.add_p2p_connection(P2PTxInvStore())\n+        node.mockscheduler(15 * 60)\n+        time.sleep(5)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416946204",
      "id" : 416946204,
      "in_reply_to_id" : 415708579,
      "line" : 78,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk0NjIwNA==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 78,
      "original_position" : 78,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : 78,
      "pull_request_review_id" : 402239018,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-28T21:52:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416946204",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416946573"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416946573"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "thanks! added test here: e77984eaeb1fc10d66e64574f006c2781b38fec7 (PR#18807)",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-28T21:53:01Z",
      "diff_hunk" : "@@ -69,9 +54,10 @@ def run_test(self):\n         node.p2ps[1].sync_with_ping()\n         assert_equal(node.p2ps[1].tx_invs_received[txid], 0)\n \n-        self.log.info(\"Transaction should be rebroadcast after 30 minutes\")\n-        # Use mocktime and give an extra 5 minutes to be sure.\n-        rebroadcast_time = int(time.time()) + 41 * 60\n+        self.log.info(\"Bump time & check that transaction is rebroadcast\")\n+        # Transaction should be rebroadcast approximately 24 hours in the future,\n+        # but can range from 12-36. So bump 36 hours to be sure.\n+        rebroadcast_time = int(time.time()) + 36 * 60 * 60",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416946573",
      "id" : 416946573,
      "in_reply_to_id" : 415750840,
      "line" : 60,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk0NjU3Mw==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 60,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 59,
      "pull_request_review_id" : 402239476,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-28T21:53:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416946573",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416946993"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416946993"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "thanks for the suggestion but I am a pass. I tried it out and it comes out to be about double the code overall, and a lot of passing the scheduler around.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-28T21:53:59Z",
      "diff_hunk" : "@@ -779,6 +779,19 @@ void PeerLogicValidation::InitializeNode(CNode *pnode) {\n         PushNodeVersion(pnode, connman, GetTime());\n }\n \n+void PeerLogicValidation::ReattemptInitialBroadcast(CScheduler& scheduler) const\n+{\n+    std::set<uint256> unbroadcast_txids = m_mempool.GetUnbroadcastTxs();\n+\n+    for (const uint256& txid : unbroadcast_txids) {\n+        RelayTransaction(txid, *connman);\n+    }\n+\n+    // schedule next run for 10-15 minutes in the future\n+    const std::chrono::milliseconds delta = std::chrono::minutes{10} + GetRandMillis(std::chrono::minutes{5});\n+    scheduler.scheduleFromNow([&] { ReattemptInitialBroadcast(scheduler); }, delta);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416946993",
      "id" : 416946993,
      "in_reply_to_id" : 415376599,
      "line" : 792,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk0Njk5Mw==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 792,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 14,
      "pull_request_review_id" : 402239987,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-28T21:53:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416946993",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416947490"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416947490"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "yes good point. noted here https://github.com/bitcoin/bitcoin/pull/18807#issue-410374742 and will incorporate into the follow-up. resolving this comment in favor of tracking there.\r\n\r\nthanks!  ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-28T21:55:04Z",
      "diff_hunk" : "@@ -1978,7 +1978,8 @@ void CWallet::ResendWalletTransactions()\n     // that these are our transactions.\n     if (GetTime() < nNextResend || !fBroadcastTransactions) return;\n     bool fFirst = (nNextResend == 0);\n-    nNextResend = GetTime() + GetRand(30 * 60);\n+    // resend 12-36 hours from now, ~1 day on average.\n+    nNextResend = GetTime() + (12 * 60 * 60) + GetRand(24 * 60 * 60);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416947490",
      "id" : 416947490,
      "in_reply_to_id" : 416826914,
      "line" : 1982,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk0NzQ5MA==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 1982,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 6,
      "pull_request_review_id" : 402240574,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-28T21:55:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416947490",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416947934"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416947934"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "makes sense. updated here: 97f15b487f064cf359e8042afa25a5d0fb88bf8c (PR #18807) and will keep in mind when writing future tests. ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-28T21:56:00Z",
      "diff_hunk" : "@@ -0,0 +1,99 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+import time\n+\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    connect_nodes,\n+    create_confirmed_utxos,\n+    disconnect_nodes,\n+)\n+\n+\n+class MempoolUnbroadcastTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.test_broadcast()\n+        self.test_txn_removal()\n+\n+    def test_broadcast(self):\n+        self.log.info(\"Test that mempool reattempts delivery of locally submitted transaction\")\n+        node = self.nodes[0]\n+\n+        min_relay_fee = node.getnetworkinfo()[\"relayfee\"]\n+        utxos = create_confirmed_utxos(min_relay_fee, node, 10)\n+\n+        disconnect_nodes(node, 1)\n+\n+        self.log.info(\"Generate transactions that only node 0 knows about\")\n+\n+        # generate a wallet txn\n+        addr = node.getnewaddress()\n+        wallet_tx_hsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # generate a txn using sendrawtransaction\n+        us0 = utxos.pop()\n+        inputs = [{\"txid\": us0[\"txid\"], \"vout\": us0[\"vout\"]}]\n+        outputs = {addr: 0.0001}\n+        tx = node.createrawtransaction(inputs, outputs)\n+        node.settxfee(min_relay_fee)\n+        txF = node.fundrawtransaction(tx)\n+        txFS = node.signrawtransactionwithwallet(txF[\"hex\"])\n+        rpc_tx_hsh = node.sendrawtransaction(txFS[\"hex\"])\n+\n+        # check that second node doesn't have these two txns\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh not in mempool\n+        assert wallet_tx_hsh not in mempool\n+\n+        # ensure that unbroadcast txs are persisted to mempool.dat\n+        self.restart_node(0)\n+\n+        self.log.info(\"Reconnect nodes & check if they are sent to node 1\")\n+        connect_nodes(node, 1)\n+\n+        # fast forward into the future & ensure that the second node has the txns\n+        node.mockscheduler(15 * 60)  # 15 min in seconds\n+        self.sync_mempools(timeout=30)\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh in mempool\n+        assert wallet_tx_hsh in mempool\n+\n+        self.log.info(\"Add another connection & ensure transactions aren't broadcast again\")\n+\n+        conn = node.add_p2p_connection(P2PTxInvStore())\n+        node.mockscheduler(15 * 60)\n+        time.sleep(5)\n+        assert_equal(len(conn.get_invs()), 0)\n+\n+    def test_txn_removal(self):\n+        self.log.info(\"Test that transactions removed from mempool are removed from unbroadcast set\")\n+        node = self.nodes[0]\n+        disconnect_nodes(node, 1)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416947934",
      "id" : 416947934,
      "in_reply_to_id" : 416837031,
      "line" : 84,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk0NzkzNA==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 84,
      "original_position" : 84,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : 84,
      "pull_request_review_id" : 402241053,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-28T21:56:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416947934",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416948901"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416948901"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "yeah totally agree. also was planning this for follow up. I've noted as a todo here: https://github.com/bitcoin/bitcoin/pull/18807#issue-410374742. Resolving this conversation and will track there.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-28T21:58:01Z",
      "diff_hunk" : "@@ -779,6 +779,19 @@ void PeerLogicValidation::InitializeNode(CNode *pnode) {\n         PushNodeVersion(pnode, connman, GetTime());\n }\n \n+void PeerLogicValidation::ReattemptInitialBroadcast(CScheduler& scheduler) const\n+{\n+    std::set<uint256> unbroadcast_txids = m_mempool.GetUnbroadcastTxs();\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416948901",
      "id" : 416948901,
      "in_reply_to_id" : 416861609,
      "line" : 785,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk0ODkwMQ==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 785,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 7,
      "pull_request_review_id" : 402242154,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-28T21:58:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416948901",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416949893"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416949893"
         }
      },
      "author_association" : "MEMBER",
      "body" : "thanks @amitiuttarwar ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-28T22:00:14Z",
      "diff_hunk" : "@@ -69,9 +54,10 @@ def run_test(self):\n         node.p2ps[1].sync_with_ping()\n         assert_equal(node.p2ps[1].tx_invs_received[txid], 0)\n \n-        self.log.info(\"Transaction should be rebroadcast after 30 minutes\")\n-        # Use mocktime and give an extra 5 minutes to be sure.\n-        rebroadcast_time = int(time.time()) + 41 * 60\n+        self.log.info(\"Bump time & check that transaction is rebroadcast\")\n+        # Transaction should be rebroadcast approximately 24 hours in the future,\n+        # but can range from 12-36. So bump 36 hours to be sure.\n+        rebroadcast_time = int(time.time()) + 36 * 60 * 60",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416949893",
      "id" : 416949893,
      "in_reply_to_id" : 415750840,
      "line" : 60,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk0OTg5Mw==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 60,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 59,
      "pull_request_review_id" : 402243342,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-28T22:00:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416949893",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416950770"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416950770"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "good idea! def seems useful to expose some unbroadcast info via the RPCs. I've added it to the follow up todos here: https://github.com/bitcoin/bitcoin/pull/18807#issue-410374742.\r\n\r\nbut not sure how what you're proposing would lead to being able to change this test? because this test is verifying the _reason_ the txn was removed from unbroadcast set. If we just check that its no longer in the set, we don't know if its because of another reason like processing a `GETDATA` ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-28T22:02:09Z",
      "diff_hunk" : "@@ -0,0 +1,99 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+import time\n+\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    connect_nodes,\n+    create_confirmed_utxos,\n+    disconnect_nodes,\n+)\n+\n+\n+class MempoolUnbroadcastTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.test_broadcast()\n+        self.test_txn_removal()\n+\n+    def test_broadcast(self):\n+        self.log.info(\"Test that mempool reattempts delivery of locally submitted transaction\")\n+        node = self.nodes[0]\n+\n+        min_relay_fee = node.getnetworkinfo()[\"relayfee\"]\n+        utxos = create_confirmed_utxos(min_relay_fee, node, 10)\n+\n+        disconnect_nodes(node, 1)\n+\n+        self.log.info(\"Generate transactions that only node 0 knows about\")\n+\n+        # generate a wallet txn\n+        addr = node.getnewaddress()\n+        wallet_tx_hsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # generate a txn using sendrawtransaction\n+        us0 = utxos.pop()\n+        inputs = [{\"txid\": us0[\"txid\"], \"vout\": us0[\"vout\"]}]\n+        outputs = {addr: 0.0001}\n+        tx = node.createrawtransaction(inputs, outputs)\n+        node.settxfee(min_relay_fee)\n+        txF = node.fundrawtransaction(tx)\n+        txFS = node.signrawtransactionwithwallet(txF[\"hex\"])\n+        rpc_tx_hsh = node.sendrawtransaction(txFS[\"hex\"])\n+\n+        # check that second node doesn't have these two txns\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh not in mempool\n+        assert wallet_tx_hsh not in mempool\n+\n+        # ensure that unbroadcast txs are persisted to mempool.dat\n+        self.restart_node(0)\n+\n+        self.log.info(\"Reconnect nodes & check if they are sent to node 1\")\n+        connect_nodes(node, 1)\n+\n+        # fast forward into the future & ensure that the second node has the txns\n+        node.mockscheduler(15 * 60)  # 15 min in seconds\n+        self.sync_mempools(timeout=30)\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh in mempool\n+        assert wallet_tx_hsh in mempool\n+\n+        self.log.info(\"Add another connection & ensure transactions aren't broadcast again\")\n+\n+        conn = node.add_p2p_connection(P2PTxInvStore())\n+        node.mockscheduler(15 * 60)\n+        time.sleep(5)\n+        assert_equal(len(conn.get_invs()), 0)\n+\n+    def test_txn_removal(self):\n+        self.log.info(\"Test that transactions removed from mempool are removed from unbroadcast set\")\n+        node = self.nodes[0]\n+        disconnect_nodes(node, 1)\n+        node.disconnect_p2ps\n+\n+        # since the node doesn't have any connections, it will not receive\n+        # any GETDATAs & thus the transaction will remain in the unbroadcast set.\n+        addr = node.getnewaddress()\n+        txhsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # check transaction was removed from unbroadcast set due to presence in\n+        # a block\n+        removal_reason = \"Removed {} from set of unbroadcast txns before confirmation that txn was sent out\".format(txhsh)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416950770",
      "id" : 416950770,
      "in_reply_to_id" : 416837980,
      "line" : 94,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk1MDc3MA==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 94,
      "original_position" : 94,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : 94,
      "pull_request_review_id" : 402244273,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-28T22:02:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416950770",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "thank you for the reviews everyone! ð \r\n\r\nThe current tip `50fc4df` currently has 6 ACKs on it, so I've opened #18807 to address the last bits. \r\n\r\n@jonatack \r\n\r\n> ISTM #16698 (comment) should be mentioned up-front in the PR description as well as a co-author mention in the relevant commit\r\n\r\nIâve updated the PR description to reflect this but I disagree that a co-author mention is necessary in this case. Crediting in-depth conceptual review would be quite a tall task given how helpful people are around here :) \r\n\r\n> if the work in @ariardâs commit 2d8ae9a was used, it would be kind to pull in the commit\r\n\r\nAgree here. I reached out to @ariard yesterday to ask if heâd like to be added as a co-author & expressed preferring not to invalidate the ACKs. \r\n\r\n> Last but not least, the resend timer has not been changed since e89b9f6 e.g. way back to 2011 or earlier. It seems best to not rush, and to document and preserve the most salient points of the discussion in the code and tests.\r\n\r\nI agree that we should not rush. We are changing a core behavior of the wallet and P2P around how transactions are being broadcast. Having critical review analyze different possible repercussions of this functionality is extremely important. So many thanks to all of the reviewers who have thought critically about these changes ð \r\n\r\nI also agree in the value of documentation and testing. I have incorporated the outstanding feedback in the #18807 . I would strongly prefer not to consume reviewersâ time with a re-ACK so hoping further clean-up items can go there.\r\n",
      "created_at" : "2020-04-28T22:11:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-620881993",
      "id" : 620881993,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMDg4MTk5Mw==",
      "updated_at" : "2020-04-28T22:11:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/620881993",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416958964"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416958964"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ah, that makes sense. enforces the same uniqueness guarantees that I need, but the ordering is unnecessary.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-28T22:20:51Z",
      "diff_hunk" : "@@ -549,6 +549,9 @@ class CTxMemPool\n \n     std::vector<indexed_transaction_set::const_iterator> GetSortedDepthAndScore() const EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n+    /** track locally submitted transactions to periodically retry initial broadcast */\n+    std::set<uint256> m_unbroadcast_txids GUARDED_BY(cs);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r416958964",
      "id" : 416958964,
      "in_reply_to_id" : 416862364,
      "line" : 553,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk1ODk2NA==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 553,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : 5,
      "pull_request_review_id" : 402253753,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-28T22:20:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/416958964",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks @amitiuttarwar :+1:",
      "created_at" : "2020-04-28T22:25:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-620887240",
      "id" : 620887240,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMDg4NzI0MA==",
      "updated_at" : "2020-04-28T22:25:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/620887240",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r417012141"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417012141"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "we don't acquire `cs_main` lock for this function, so I don't understand how this comment is applicable? ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-29T00:57:16Z",
      "diff_hunk" : "@@ -698,6 +701,21 @@ class CTxMemPool\n \n     size_t DynamicMemoryUsage() const;\n \n+    /** Adds a transaction to the unbroadcast set */\n+    void AddUnbroadcastTx(const uint256& txid) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r417012141",
      "id" : 417012141,
      "in_reply_to_id" : 414920979,
      "line" : 705,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzAxMjE0MQ==",
      "original_commit_id" : "89eeb4a3335f8e871cc3f5286af4546dff66172a",
      "original_line" : 705,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : 15,
      "pull_request_review_id" : 402309743,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T00:57:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417012141",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r417017563"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417017563"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If you disconnect all P2P connections, then there's no peer to send a GETDATA.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-29T01:20:08Z",
      "diff_hunk" : "@@ -0,0 +1,99 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+import time\n+\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    connect_nodes,\n+    create_confirmed_utxos,\n+    disconnect_nodes,\n+)\n+\n+\n+class MempoolUnbroadcastTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.test_broadcast()\n+        self.test_txn_removal()\n+\n+    def test_broadcast(self):\n+        self.log.info(\"Test that mempool reattempts delivery of locally submitted transaction\")\n+        node = self.nodes[0]\n+\n+        min_relay_fee = node.getnetworkinfo()[\"relayfee\"]\n+        utxos = create_confirmed_utxos(min_relay_fee, node, 10)\n+\n+        disconnect_nodes(node, 1)\n+\n+        self.log.info(\"Generate transactions that only node 0 knows about\")\n+\n+        # generate a wallet txn\n+        addr = node.getnewaddress()\n+        wallet_tx_hsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # generate a txn using sendrawtransaction\n+        us0 = utxos.pop()\n+        inputs = [{\"txid\": us0[\"txid\"], \"vout\": us0[\"vout\"]}]\n+        outputs = {addr: 0.0001}\n+        tx = node.createrawtransaction(inputs, outputs)\n+        node.settxfee(min_relay_fee)\n+        txF = node.fundrawtransaction(tx)\n+        txFS = node.signrawtransactionwithwallet(txF[\"hex\"])\n+        rpc_tx_hsh = node.sendrawtransaction(txFS[\"hex\"])\n+\n+        # check that second node doesn't have these two txns\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh not in mempool\n+        assert wallet_tx_hsh not in mempool\n+\n+        # ensure that unbroadcast txs are persisted to mempool.dat\n+        self.restart_node(0)\n+\n+        self.log.info(\"Reconnect nodes & check if they are sent to node 1\")\n+        connect_nodes(node, 1)\n+\n+        # fast forward into the future & ensure that the second node has the txns\n+        node.mockscheduler(15 * 60)  # 15 min in seconds\n+        self.sync_mempools(timeout=30)\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh in mempool\n+        assert wallet_tx_hsh in mempool\n+\n+        self.log.info(\"Add another connection & ensure transactions aren't broadcast again\")\n+\n+        conn = node.add_p2p_connection(P2PTxInvStore())\n+        node.mockscheduler(15 * 60)\n+        time.sleep(5)\n+        assert_equal(len(conn.get_invs()), 0)\n+\n+    def test_txn_removal(self):\n+        self.log.info(\"Test that transactions removed from mempool are removed from unbroadcast set\")\n+        node = self.nodes[0]\n+        disconnect_nodes(node, 1)\n+        node.disconnect_p2ps\n+\n+        # since the node doesn't have any connections, it will not receive\n+        # any GETDATAs & thus the transaction will remain in the unbroadcast set.\n+        addr = node.getnewaddress()\n+        txhsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # check transaction was removed from unbroadcast set due to presence in\n+        # a block\n+        removal_reason = \"Removed {} from set of unbroadcast txns before confirmation that txn was sent out\".format(txhsh)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r417017563",
      "id" : 417017563,
      "in_reply_to_id" : 416837980,
      "line" : 94,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzAxNzU2Mw==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 94,
      "original_position" : 94,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : 94,
      "pull_request_review_id" : 402315249,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T01:20:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417017563",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r417018771"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417018771"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe the comments were not about lock order, but whether the cs_main lock is needed as per #14963? :thinking: \r\n\r\nHaven't thought about this, but if I had to guess, I'd say no.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-29T01:25:12Z",
      "diff_hunk" : "@@ -698,6 +701,21 @@ class CTxMemPool\n \n     size_t DynamicMemoryUsage() const;\n \n+    /** Adds a transaction to the unbroadcast set */\n+    void AddUnbroadcastTx(const uint256& txid) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r417018771",
      "id" : 417018771,
      "in_reply_to_id" : 414920979,
      "line" : 705,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzAxODc3MQ==",
      "original_commit_id" : "89eeb4a3335f8e871cc3f5286af4546dff66172a",
      "original_line" : 705,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : 15,
      "pull_request_review_id" : 402316467,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T01:25:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417018771",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r417024192"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417024192"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "in that case yes (assuming the test actually works and you don't accidentally write a bug like I did :)) \r\n\r\nwhat I'm trying to get at is that the log parsing tests the expectation more directly by confirming the reason for removal. the removal reasons / code pathways are simple enough right now, but over time they might change and if we were just checking for removal the test might not fail even though the expectations have changed. \r\n\r\nanyway, I don't think this is a big deal? we could even test both in the follow-up =P \r\nI'm going to resolve this conversation, but feel free to lmk if you feel strongly.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-29T01:48:40Z",
      "diff_hunk" : "@@ -0,0 +1,99 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that the mempool ensures transaction delivery by periodically sending\n+to peers until a GETDATA is received.\"\"\"\n+\n+import time\n+\n+from test_framework.mininode import P2PTxInvStore\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    connect_nodes,\n+    create_confirmed_utxos,\n+    disconnect_nodes,\n+)\n+\n+\n+class MempoolUnbroadcastTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.test_broadcast()\n+        self.test_txn_removal()\n+\n+    def test_broadcast(self):\n+        self.log.info(\"Test that mempool reattempts delivery of locally submitted transaction\")\n+        node = self.nodes[0]\n+\n+        min_relay_fee = node.getnetworkinfo()[\"relayfee\"]\n+        utxos = create_confirmed_utxos(min_relay_fee, node, 10)\n+\n+        disconnect_nodes(node, 1)\n+\n+        self.log.info(\"Generate transactions that only node 0 knows about\")\n+\n+        # generate a wallet txn\n+        addr = node.getnewaddress()\n+        wallet_tx_hsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # generate a txn using sendrawtransaction\n+        us0 = utxos.pop()\n+        inputs = [{\"txid\": us0[\"txid\"], \"vout\": us0[\"vout\"]}]\n+        outputs = {addr: 0.0001}\n+        tx = node.createrawtransaction(inputs, outputs)\n+        node.settxfee(min_relay_fee)\n+        txF = node.fundrawtransaction(tx)\n+        txFS = node.signrawtransactionwithwallet(txF[\"hex\"])\n+        rpc_tx_hsh = node.sendrawtransaction(txFS[\"hex\"])\n+\n+        # check that second node doesn't have these two txns\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh not in mempool\n+        assert wallet_tx_hsh not in mempool\n+\n+        # ensure that unbroadcast txs are persisted to mempool.dat\n+        self.restart_node(0)\n+\n+        self.log.info(\"Reconnect nodes & check if they are sent to node 1\")\n+        connect_nodes(node, 1)\n+\n+        # fast forward into the future & ensure that the second node has the txns\n+        node.mockscheduler(15 * 60)  # 15 min in seconds\n+        self.sync_mempools(timeout=30)\n+        mempool = self.nodes[1].getrawmempool()\n+        assert rpc_tx_hsh in mempool\n+        assert wallet_tx_hsh in mempool\n+\n+        self.log.info(\"Add another connection & ensure transactions aren't broadcast again\")\n+\n+        conn = node.add_p2p_connection(P2PTxInvStore())\n+        node.mockscheduler(15 * 60)\n+        time.sleep(5)\n+        assert_equal(len(conn.get_invs()), 0)\n+\n+    def test_txn_removal(self):\n+        self.log.info(\"Test that transactions removed from mempool are removed from unbroadcast set\")\n+        node = self.nodes[0]\n+        disconnect_nodes(node, 1)\n+        node.disconnect_p2ps\n+\n+        # since the node doesn't have any connections, it will not receive\n+        # any GETDATAs & thus the transaction will remain in the unbroadcast set.\n+        addr = node.getnewaddress()\n+        txhsh = node.sendtoaddress(addr, 0.0001)\n+\n+        # check transaction was removed from unbroadcast set due to presence in\n+        # a block\n+        removal_reason = \"Removed {} from set of unbroadcast txns before confirmation that txn was sent out\".format(txhsh)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r417024192",
      "id" : 417024192,
      "in_reply_to_id" : 416837980,
      "line" : 94,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzAyNDE5Mg==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 94,
      "original_position" : 94,
      "original_start_line" : null,
      "path" : "test/functional/mempool_unbroadcast.py",
      "position" : 94,
      "pull_request_review_id" : 402322059,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T01:48:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417024192",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r417031606"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417031606"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ok, updating to check `pfrom` is from outbound sounds good to me. increases delivery guarantee for the general case too. I added this to the todo list on follow ups pr https://github.com/bitcoin/bitcoin/pull/18807#issue-410374742. code is just 1 line change, but I want to make sure to update other relevant comments to clarify its removed via _outbound_ getdata & hopefully add a test case. \r\n\r\nI'm going to resolve this comment here. thanks!",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-29T02:19:49Z",
      "diff_hunk" : "@@ -1605,7 +1622,13 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n                     push = true;\n                 }\n             }\n-            if (!push) {\n+\n+            if (push) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r417031606",
      "id" : 417031606,
      "in_reply_to_id" : 414575673,
      "line" : 1626,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzAzMTYwNg==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 1626,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 46,
      "pull_request_review_id" : 402329176,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T02:19:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417031606",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r417093232"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417093232"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "If I add `time.sleep(10)` before or after `connect_nodes`, then the test fails locally for me (the mempool for node 2 has 6, instead of the expected 5 transactions).\r\n\r\nDoes this test depend on particular timings (e.g. node 1 doesn't have time to relay the transaction to node 2 before the nodes are all shut down)?  If so, in a future change would it make sense to either (i) document the necessary timing assumptions, or (ii) update the test to depend less on particular timings?",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-29T06:31:56Z",
      "diff_hunk" : "@@ -80,6 +83,11 @@ def run_test(self):\n         assert_greater_than_or_equal(tx_creation_time, tx_creation_time_lower)\n         assert_greater_than_or_equal(tx_creation_time_higher, tx_creation_time)\n \n+        # disconnect nodes & make a txn that remains in the unbroadcast set.\n+        disconnect_nodes(self.nodes[0], 2)\n+        self.nodes[0].sendtoaddress(self.nodes[2].getnewaddress(), Decimal(\"12\"))\n+        connect_nodes(self.nodes[0], 2)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r417093232",
      "id" : 417093232,
      "line" : 89,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzA5MzIzMg==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 89,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "test/functional/mempool_persist.py",
      "position" : 21,
      "pull_request_review_id" : 402392804,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T06:54:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417093232",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/63171930?v=4",
         "events_url" : "https://api.github.com/users/robot-visions/events{/privacy}",
         "followers_url" : "https://api.github.com/users/robot-visions/followers",
         "following_url" : "https://api.github.com/users/robot-visions/following{/other_user}",
         "gists_url" : "https://api.github.com/users/robot-visions/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/robot-visions",
         "id" : 63171930,
         "login" : "robot-visions",
         "node_id" : "MDQ6VXNlcjYzMTcxOTMw",
         "organizations_url" : "https://api.github.com/users/robot-visions/orgs",
         "received_events_url" : "https://api.github.com/users/robot-visions/received_events",
         "repos_url" : "https://api.github.com/users/robot-visions/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/robot-visions/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/robot-visions/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/robot-visions"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r417408126"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417408126"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm not sure this is actually testing anything. If you bump the mocktime and then immediately assert that you haven't received the tx, you haven't given the scheduler any time to do anything.",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-29T15:31:00Z",
      "diff_hunk" : "@@ -69,9 +54,10 @@ def run_test(self):\n         node.p2ps[1].sync_with_ping()\n         assert_equal(node.p2ps[1].tx_invs_received[txid], 0)\n \n-        self.log.info(\"Transaction should be rebroadcast after 30 minutes\")\n-        # Use mocktime and give an extra 5 minutes to be sure.\n-        rebroadcast_time = int(time.time()) + 41 * 60\n+        self.log.info(\"Bump time & check that transaction is rebroadcast\")\n+        # Transaction should be rebroadcast approximately 24 hours in the future,\n+        # but can range from 12-36. So bump 36 hours to be sure.\n+        rebroadcast_time = int(time.time()) + 36 * 60 * 60",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r417408126",
      "id" : 417408126,
      "in_reply_to_id" : 415750840,
      "line" : 60,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQwODEyNg==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 60,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 59,
      "pull_request_review_id" : 402785608,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T15:31:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417408126",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r417509808"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417509808"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ah, based on another review comment or two, ended up implementing here 191fc04e9bb99589f204ccfceece7d715a82f4c0 (PR #18807)",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-04-29T18:04:20Z",
      "diff_hunk" : "@@ -5045,12 +5046,30 @@ bool LoadMempool(CTxMemPool& pool)\n         for (const auto& i : mapDeltas) {\n             pool.PrioritiseTransaction(i.first, i.second);\n         }\n+\n+        // check if there are unbroadcast transactions\n+        bool has_unbroadcast_txns = false;\n+\n+        try {\n+            file >> has_unbroadcast_txns;\n+        } catch (const std::exception &e) {\n+            // eof gets set when we try to read the end of the file\n+            // so specifically catch expected error and move on.\n+            if (!file.eof()) throw e;\n+        }\n+\n+        if (has_unbroadcast_txns) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r417509808",
      "id" : 417509808,
      "in_reply_to_id" : 394483205,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzUwOTgwOA==",
      "original_commit_id" : "b0f6a238335d96c9f5f7c2b83aabd56ab4f47a71",
      "original_line" : 5061,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 402912180,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-29T18:04:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/417509808",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The rebroadcast behaviour changes for own wallets connected on the p2p interface, as opposed to local wallets or wallets connected on the rpc interface.\r\n\r\nFor context, see the IRC log: https://bitcoincore.reviews/18038.html",
      "created_at" : "2020-04-29T19:56:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-621429126",
      "id" : 621429126,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMTQyOTEyNg==",
      "updated_at" : "2020-04-29T19:57:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/621429126",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r418699291"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/418699291"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "on further thought, I don't think it makes sense to only remove unbroadcast txns on receiving `GETDATA` from outbound peers. \r\n\r\nthis relies on the expectation that outbound peers get the txn before inbound peers (otherwise they might relay), which isn't necessarily true in edge cases. if we were to implement, I'd want to add logic to remove from unbroadcast set if we receive an `inv` from a peer. However, doing all this seems unnecessary right now, especially considering the greater direction of this project (#16698).",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-05-01T19:27:34Z",
      "diff_hunk" : "@@ -1605,7 +1622,13 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n                     push = true;\n                 }\n             }\n-            if (!push) {\n+\n+            if (push) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r418699291",
      "id" : 418699291,
      "in_reply_to_id" : 414575673,
      "line" : 1626,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY5OTI5MQ==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 1626,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 46,
      "pull_request_review_id" : 404353590,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-01T19:27:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/418699291",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r418754629"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/418754629"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "good catch! this is a bug. line 87 isn't actually disconnecting the two nodes because its passing `node_num` of `2` rather than `1`\r\n\r\nI've added commit 41fd9c1b7b372d7769e005db1d92000c0373651e on the follow-up PR #18807 to fix this issue.\r\n\r\nthank you! ",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-05-01T21:55:21Z",
      "diff_hunk" : "@@ -80,6 +83,11 @@ def run_test(self):\n         assert_greater_than_or_equal(tx_creation_time, tx_creation_time_lower)\n         assert_greater_than_or_equal(tx_creation_time_higher, tx_creation_time)\n \n+        # disconnect nodes & make a txn that remains in the unbroadcast set.\n+        disconnect_nodes(self.nodes[0], 2)\n+        self.nodes[0].sendtoaddress(self.nodes[2].getnewaddress(), Decimal(\"12\"))\n+        connect_nodes(self.nodes[0], 2)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r418754629",
      "id" : 418754629,
      "in_reply_to_id" : 417093232,
      "line" : 89,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc1NDYyOQ==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 89,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "test/functional/mempool_persist.py",
      "position" : 21,
      "pull_request_review_id" : 404420321,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-01T21:55:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/418754629",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r418864246"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/418864246"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Confirmed that with 41fd9c1b7b372d7769e005db1d92000c0373651e the test passes even with random `time.sleep(10)` thrown.  Thanks for updating!",
      "commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "created_at" : "2020-05-02T03:33:34Z",
      "diff_hunk" : "@@ -80,6 +83,11 @@ def run_test(self):\n         assert_greater_than_or_equal(tx_creation_time, tx_creation_time_lower)\n         assert_greater_than_or_equal(tx_creation_time_higher, tx_creation_time)\n \n+        # disconnect nodes & make a txn that remains in the unbroadcast set.\n+        disconnect_nodes(self.nodes[0], 2)\n+        self.nodes[0].sendtoaddress(self.nodes[2].getnewaddress(), Decimal(\"12\"))\n+        connect_nodes(self.nodes[0], 2)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r418864246",
      "id" : 418864246,
      "in_reply_to_id" : 417093232,
      "line" : 89,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODg2NDI0Ng==",
      "original_commit_id" : "50fc4df6c4e8a84bdda13ade7bed7a2131796f00",
      "original_line" : 89,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "test/functional/mempool_persist.py",
      "position" : 21,
      "pull_request_review_id" : 404496517,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-02T03:33:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/418864246",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/63171930?v=4",
         "events_url" : "https://api.github.com/users/robot-visions/events{/privacy}",
         "followers_url" : "https://api.github.com/users/robot-visions/followers",
         "following_url" : "https://api.github.com/users/robot-visions/following{/other_user}",
         "gists_url" : "https://api.github.com/users/robot-visions/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/robot-visions",
         "id" : 63171930,
         "login" : "robot-visions",
         "node_id" : "MDQ6VXNlcjYzMTcxOTMw",
         "organizations_url" : "https://api.github.com/users/robot-visions/orgs",
         "received_events_url" : "https://api.github.com/users/robot-visions/received_events",
         "repos_url" : "https://api.github.com/users/robot-visions/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/robot-visions/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/robot-visions/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/robot-visions"
      }
   }
]
