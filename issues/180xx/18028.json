{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "While testing #18026 @fanquake had a transient error in rpc_rawtransaction.py where combinerawtransaction failed. The inputs to combinerawtransaction were two partial transactions:\r\n\r\n```\r\n0200000000010104d5aa747ccd13d493aa4bf33b71752f23ef2c2fcff094d0d35aaa87aa4a0b260000000000ffffffff01c0ac0d0d00000000160014ec9331188271ac1a2629108e3ae0cde4589a0a4a0400473044022035e173a3fe3b7019dc8d4457f588711adf3453ff28df630db0dd720b5ed9fd0e022034b118b826af7f10fd4c197b69ffc0e6391b746f40fdf50f08dc95bf3fd657e1010047522103d23bb22861a28722b924c48169a969aff7d1c2ae121a8c7bbabbfb203acff9032103aee7be172b78cc85b65059408c320a9988a6bdba9580666facc1f4f16ee75ea552ae00000000\r\n\r\n0200000000010104d5aa747ccd13d493aa4bf33b71752f23ef2c2fcff094d0d35aaa87aa4a0b260000000000ffffffff01c0ac0d0d00000000160014ec9331188271ac1a2629108e3ae0cde4589a0a4a040047304402201a91b10bc44d9ad9a0b57fde36ff776585de71e9b4625803d43507589f31c53d02205bb0f42bafe669b6e144d3bdb235b5d3333dc478636a1d1c6ee2e2160ad28f49010047522103d23bb22861a28722b924c48169a969aff7d1c2ae121a8c7bbabbfb203acff9032103aee7be172b78cc85b65059408c320a9988a6bdba9580666facc1f4f16ee75ea552ae00000000\r\n```\r\n\r\nBut the first first of these decodes \"incorrectly\" as:\r\n\r\n```\r\n{\r\n  \"txid\": \"90839dcde19bb9578ebcdf34ddea1eee5936fb8a17b5b1d36e9e7a1cd2093123\",\r\n  \"hash\": \"90839dcde19bb9578ebcdf34ddea1eee5936fb8a17b5b1d36e9e7a1cd2093123\",\r\n  \"version\": 2,\r\n  \"size\": 231,\r\n  \"vsize\": 231,\r\n  \"weight\": 924,\r\n  \"locktime\": 0,\r\n  \"vin\": [\r\n  ],\r\n  \"vout\": [\r\n    {\r\n      \"value\": 14269334974.70452737,\r\n      \"n\": 0,\r\n      \"scriptPubKey\": {\r\n        \"asm\": \"OP_ADD OP_HASH256 f33b71752f23ef2c2fcff094d0d35aaa87aa4a0b260000000000ffffffff01c0ac0d0d00000000160014ec9331188271ac1a2629108e3ae0cde4589a0a4a0400473044022035e173a3fe3b OP_2OVER dc8d4457f588711adf3453ff28df630db0dd720b5ed9fd0e02 34b118b826af7f10fd4c197b69ffc0e6391b746f40fdf50f08dc95bf3fd657e1 0 522103d23bb22861a28722b924c48169a969aff7d1c2ae121a8c7bbabbfb203acff9032103aee7be172b78cc85b65059408c320a9988a6bdba9580666facc1f4f16ee75ea552ae\",\r\n        \"hex\": \"93aa4bf33b71752f23ef2c2fcff094d0d35aaa87aa4a0b260000000000ffffffff01c0ac0d0d00000000160014ec9331188271ac1a2629108e3ae0cde4589a0a4a0400473044022035e173a3fe3b7019dc8d4457f588711adf3453ff28df630db0dd720b5ed9fd0e022034b118b826af7f10fd4c197b69ffc0e6391b746f40fdf50f08dc95bf3fd657e1010047522103d23bb22861a28722b924c48169a969aff7d1c2ae121a8c7bbabbfb203acff9032103aee7be172b78cc85b65059408c320a9988a6bdba9580666facc1f4f16ee75ea552ae\",\r\n        \"type\": \"nonstandard\"\r\n      }\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\nbecause the flag gets decoded as \"00\" - no inputs, \"01\" - one output, the vin count and the last 15 bytes of the input txid get decoded as the output amount, and the sixteenth last byte of the input txid happens to be `0xd4` and there happen to be that many bytes left prior to the final sequence number, so it decodes successfully as a witlessness transaction, and everything breaks.\r\n\r\nFor short transactions (less than 282 bytes or 564 hex digits) that's a 1-in-256 chance of failure. (For longer transactions it's a 1-in-16M chance of failure or less, so that's probably no big deal)",
   "closed_at" : "2022-08-04T09:29:13Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
      "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
      "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/MarcoFalke",
      "id" : 6399679,
      "login" : "MarcoFalke",
      "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
      "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
      "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
      "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/MarcoFalke"
   },
   "comments" : 3,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18028/comments",
   "created_at" : "2020-01-30T09:02:34Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18028/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/18028",
   "id" : 557352742,
   "labels" : [
      {
         "color" : "FBBAAB",
         "default" : false,
         "description" : null,
         "id" : 64585,
         "name" : "Bug",
         "node_id" : "MDU6TGFiZWw2NDU4NQ==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18028/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDU6SXNzdWU1NTczNTI3NDI=",
   "number" : 18028,
   "performed_via_github_app" : null,
   "reactions" : {
      "+1" : 0,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 0,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18028/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "state_reason" : "completed",
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18028/timeline",
   "title" : "Some transactions can't be decoded from hex strings",
   "updated_at" : "2022-08-04T09:29:13Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18028",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
      "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
      "followers_url" : "https://api.github.com/users/ajtowns/followers",
      "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
      "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/ajtowns",
      "id" : 127186,
      "login" : "ajtowns",
      "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
      "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
      "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
      "repos_url" : "https://api.github.com/users/ajtowns/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/ajtowns"
   }
}
