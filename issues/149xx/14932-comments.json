[
   {
      "author_association" : "MEMBER",
      "body" : "Would adding levelDB/UTXO-set corruption to the test make sense?",
      "created_at" : "2018-12-12T04:21:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14932#issuecomment-446457036",
      "id" : 446457036,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14932",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NjQ1NzAzNg==",
      "updated_at" : "2018-12-12T04:21:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/446457036",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Do we really want to report on mempool.dat corruption?  The right thing to do, I think, is to just ignore it.  Usually the txn will be out of date anyways.  This would also potentially reduce our ability to change the format in the future: it would be totally reasonable for a major version to just not support the prior's mempool.dat format but not nice to pop up pointless warnings.\r\n\r\nAny of the blokchain stuff sure... but mempool and peers are pretty ephemeral.",
      "created_at" : "2018-12-12T04:52:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14932#issuecomment-446461661",
      "id" : 446461661,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14932",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NjQ2MTY2MQ==",
      "updated_at" : "2018-12-12T04:52:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/446461661",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Tend to agree with @gmaxwell, maybe turn this into a Blocks/UTXO-set corruption detection pull?",
      "created_at" : "2018-12-12T05:57:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14932#issuecomment-446472247",
      "id" : 446472247,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14932",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NjQ3MjI0Nw==",
      "updated_at" : "2018-12-12T05:57:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/446472247",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> it would be totally reasonable for a major version to just not support the prior's mempool.dat format but not nice to pop up pointless warnings.\r\n\r\nNot sure how this is done right now, but could treat this case separately; have an header with version number and ignore newer versions. Warn only when the format claims to be the old version and mis-parses.\r\n\r\nBut from a user perspective I agree with you, that corruption in ephemeral files (mempool, peers, ...) should be logged but not pop up a worrying warning. This is what the log is for.",
      "created_at" : "2018-12-12T09:36:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14932#issuecomment-446522805",
      "id" : 446522805,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14932",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NjUyMjgwNQ==",
      "updated_at" : "2018-12-12T09:36:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/446522805",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The first thing that is serialized is the version. If we change the format and don't bump the version, it is a bug in our code. Warning on that would at least point out the bug.",
      "created_at" : "2018-12-12T17:19:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14932#issuecomment-446669550",
      "id" : 446669550,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14932",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NjY2OTU1MA==",
      "updated_at" : "2018-12-12T17:19:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/446669550",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--2502f1a698b3751726fa55edcda76cd3-->\n\n### Coverage\n\n| Coverage  | Change ([pull 14932](https://drahtbot.github.io/reports/coverage/bitcoin/bitcoin/14932/total.coverage/index.html)) | Reference ([master](https://drahtbot.github.io/reports/coverage/bitcoin/bitcoin/master/total.coverage/index.html))   |\n|-----------|-------------------------|--------------------|\n| Lines     | -0.0344 %            | 87.2941 %        |\n| Functions | -0.0302 %            | 84.3495 %        |\n| Branches  | -0.0221 %            | 51.3853 %        |\n\n<sup>Updated at: 2018-12-12T17:35:06.827752.</sup>\n",
      "created_at" : "2018-12-12T17:35:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14932#issuecomment-446674826",
      "id" : 446674826,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14932",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NjY3NDgyNg==",
      "updated_at" : "2018-12-12T17:35:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/446674826",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Still, as a matter of ui principle, we should probably not warn users on anything that isn't important to them and/or does not require action on their part. And I /think/ mempool doesn't fit this criteria (thought I could be convinced otherwise).  -- thanks for the point about versions, though.\r\n\r\nI can't tell you how many times I've given tech support to a user and encountered something like \"I reindexed this piece of junk three times taking a whole day each time and was still getting my logs flooed with errors! (ERROR: AcceptToMemoryPool: inputs already spent). Next I deleted all .dat files,  and I'm not seeing those errors (thank god!) but it seems to be downloading the blockchain again and I can no longer see any of my coins or addresses. How do I get it to show my balance again?\"\r\n\r\nThings like the mempool are a cache, if the cache is corrupted, we should probably flush it and move on without bothering the user.  If we wanted to create some kind of support information screen with a \"support code\" that is just some hex representation of a bitfield that sets bits for things like \"I dumped my mempool dat\" but isn't at risk of freaking out a user, that would be fine...\r\n\r\nI just really worry about sending users down a hypochondriac rathole where they ultimately waste time or even corrupt their data because of a harmless state they didn't need to do anything about. ... since I've seen it too many times. ",
      "created_at" : "2018-12-12T17:38:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14932#issuecomment-446675886",
      "id" : 446675886,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14932",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NjY3NTg4Ng==",
      "updated_at" : "2018-12-12T17:39:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/446675886",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14932#discussion_r241271150"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14932"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/241271150"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The detail error message varies on different OS (Linux: `iostream error`, Windows: `iostream stream error`).",
      "commit_id" : "9aaf300143c3e380a91412930a37c1f3a807260c",
      "created_at" : "2018-12-13T04:49:49Z",
      "diff_hunk" : "@@ -0,0 +1,32 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2014-2018 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test reported errors on file corruption.\n+\n+See doc/files.md for a list of files.\n+\"\"\"\n+\n+import os\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+\n+\n+class FileCorruptionTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        self.log.info('Test file corruption on mempool.dat')\n+        mempool_dat_path = os.path.join(self.nodes[0].datadir, 'regtest', 'mempool.dat')\n+        self.stop_nodes()\n+        with open(mempool_dat_path, 'rb+') as mempool_dat:\n+            mempool_dat.seek(9)\n+            mempool_dat.write(b'ff')\n+        with self.nodes[0].assert_debug_log(expected_msgs=['Failed to deserialize mempool data on disk']):\n+            self.start_nodes()\n+        self.stop_node(0, expected_stderr='Warning: Failed to deserialize mempool data on disk: CAutoFile::read: end of file: iostream error. Continuing anyway.')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14932#discussion_r241271150",
      "id" : 241271150,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MTI3MTE1MA==",
      "original_commit_id" : "9aaf300143c3e380a91412930a37c1f3a807260c",
      "original_position" : 28,
      "path" : "test/functional/feature_file_corruption.py",
      "position" : 28,
      "pull_request_review_id" : 184500561,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14932",
      "updated_at" : "2018-12-13T04:49:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/241271150",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "node_id" : "MDQ6VXNlcjExMTU0MTE4",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "We'd need to be careful on a version bump, as number 2 is already used for Knots / #9422",
      "created_at" : "2018-12-20T05:44:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14932#issuecomment-448880964",
      "id" : 448880964,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14932",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0ODg4MDk2NA==",
      "updated_at" : "2018-12-20T05:44:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/448880964",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   }
]
