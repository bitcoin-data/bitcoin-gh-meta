[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#11652](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/11652.html) (Add missing locks: validation.cpp + related by practicalswift)\n* [#10443](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/10443.html) (Add fee_est tool for debugging fee estimation code by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2018-12-15T00:27:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14963#issuecomment-447517912",
      "id" : 447517912,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14963",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NzUxNzkxMg==",
      "updated_at" : "2019-01-10T19:12:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/447517912",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r241935565"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/241935565"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`rading it` -> `reading from it`",
      "commit_id" : "fa5e373365b8e88fc9894f53f618d3e89f1bec14",
      "created_at" : "2018-12-15T02:56:37Z",
      "diff_hunk" : "@@ -210,9 +210,17 @@ class CChainState {\n     bool RollforwardBlock(const CBlockIndex* pindex, CCoinsViewCache& inputs, const CChainParams& params) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n } g_chainstate;\n \n-\n-\n-CCriticalSection cs_main;\n+/**\n+ * Mutex to guard access to validation specific variables, such as reading\n+ * or changing the chainstate.\n+ *\n+ * This must also be locked when updating the transaction pool, e.g. on\n+ * AcceptToMemoryPool.\n+ *\n+ * The transaction pool has a separate lock to allow rading it and the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r241935565",
      "id" : 241935565,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MTkzNTU2NQ==",
      "original_commit_id" : "fa5ed69b0255fe1ac308bb78c8534261736be9e6",
      "original_position" : 14,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 185339741,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963",
      "updated_at" : "2018-12-22T14:23:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/241935565",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/2287825?v=4",
         "events_url" : "https://api.github.com/users/ch4ot1c/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ch4ot1c/followers",
         "following_url" : "https://api.github.com/users/ch4ot1c/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ch4ot1c/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ch4ot1c",
         "id" : 2287825,
         "login" : "ch4ot1c",
         "node_id" : "MDQ6VXNlcjIyODc4MjU=",
         "organizations_url" : "https://api.github.com/users/ch4ot1c/orgs",
         "received_events_url" : "https://api.github.com/users/ch4ot1c/received_events",
         "repos_url" : "https://api.github.com/users/ch4ot1c/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ch4ot1c/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ch4ot1c/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ch4ot1c"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r241935575"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/241935575"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`such as` -> `in cases such as`?",
      "commit_id" : "fa5e373365b8e88fc9894f53f618d3e89f1bec14",
      "created_at" : "2018-12-15T02:57:02Z",
      "diff_hunk" : "@@ -210,9 +210,17 @@ class CChainState {\n     bool RollforwardBlock(const CBlockIndex* pindex, CCoinsViewCache& inputs, const CChainParams& params) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n } g_chainstate;\n \n-\n-\n-CCriticalSection cs_main;\n+/**\n+ * Mutex to guard access to validation specific variables, such as reading",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r241935575",
      "id" : 241935575,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MTkzNTU3NQ==",
      "original_commit_id" : "fa5ed69b0255fe1ac308bb78c8534261736be9e6",
      "original_position" : 8,
      "path" : "src/validation.cpp",
      "position" : 17,
      "pull_request_review_id" : 185339741,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963",
      "updated_at" : "2018-12-22T14:23:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/241935575",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/2287825?v=4",
         "events_url" : "https://api.github.com/users/ch4ot1c/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ch4ot1c/followers",
         "following_url" : "https://api.github.com/users/ch4ot1c/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ch4ot1c/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ch4ot1c",
         "id" : 2287825,
         "login" : "ch4ot1c",
         "node_id" : "MDQ6VXNlcjIyODc4MjU=",
         "organizations_url" : "https://api.github.com/users/ch4ot1c/orgs",
         "received_events_url" : "https://api.github.com/users/ch4ot1c/received_events",
         "repos_url" : "https://api.github.com/users/ch4ot1c/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ch4ot1c/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ch4ot1c/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ch4ot1c"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r241951769"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/241951769"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`... should be locked before in addition ...`",
      "commit_id" : "fa5e373365b8e88fc9894f53f618d3e89f1bec14",
      "created_at" : "2018-12-15T14:53:20Z",
      "diff_hunk" : "@@ -485,7 +485,13 @@ class CTxMemPool\n         >\n     > indexed_transaction_set;\n \n-    mutable CCriticalSection cs;\n+    /**\n+     * Mutex that guards reads.\n+     *\n+     * The validation mutex cs_main should be locked in addition to this lock",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r241951769",
      "id" : 241951769,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MTk1MTc2OQ==",
      "original_commit_id" : "fa5ed69b0255fe1ac308bb78c8534261736be9e6",
      "original_position" : 8,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 185357193,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963",
      "updated_at" : "2018-12-22T14:23:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/241951769",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r241951778"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/241951778"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`Recursive mutex ...`",
      "commit_id" : "fa5e373365b8e88fc9894f53f618d3e89f1bec14",
      "created_at" : "2018-12-15T14:53:34Z",
      "diff_hunk" : "@@ -485,7 +485,13 @@ class CTxMemPool\n         >\n     > indexed_transaction_set;\n \n-    mutable CCriticalSection cs;\n+    /**\n+     * Mutex that guards reads.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r241951778",
      "id" : 241951778,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MTk1MTc3OA==",
      "original_commit_id" : "fa5ed69b0255fe1ac308bb78c8534261736be9e6",
      "original_position" : 6,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 185357193,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963",
      "updated_at" : "2018-12-22T14:23:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/241951778",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r241951799"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/241951799"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`Recursive mutex to ...`",
      "commit_id" : "fa5e373365b8e88fc9894f53f618d3e89f1bec14",
      "created_at" : "2018-12-15T14:54:30Z",
      "diff_hunk" : "@@ -210,9 +210,17 @@ class CChainState {\n     bool RollforwardBlock(const CBlockIndex* pindex, CCoinsViewCache& inputs, const CChainParams& params) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n } g_chainstate;\n \n-\n-\n-CCriticalSection cs_main;\n+/**\n+ * Mutex to guard access to validation specific variables, such as reading",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r241951799",
      "id" : 241951799,
      "in_reply_to_id" : 241935575,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MTk1MTc5OQ==",
      "original_commit_id" : "fa5ed69b0255fe1ac308bb78c8534261736be9e6",
      "original_position" : 8,
      "path" : "src/validation.cpp",
      "position" : 17,
      "pull_request_review_id" : 185357193,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963",
      "updated_at" : "2018-12-22T14:23:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/241951799",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r242212328"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242212328"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Recursive is already clear from the variable type and I plan to make it non-recursive",
      "commit_id" : "fa5e373365b8e88fc9894f53f618d3e89f1bec14",
      "created_at" : "2018-12-17T16:15:31Z",
      "diff_hunk" : "@@ -485,7 +485,13 @@ class CTxMemPool\n         >\n     > indexed_transaction_set;\n \n-    mutable CCriticalSection cs;\n+    /**\n+     * Mutex that guards reads.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r242212328",
      "id" : 242212328,
      "in_reply_to_id" : 241951778,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MjIxMjMyOA==",
      "original_commit_id" : "fa5ed69b0255fe1ac308bb78c8534261736be9e6",
      "original_position" : 6,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 185671226,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963",
      "updated_at" : "2018-12-22T14:23:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242212328",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Fixed up some of the language. Any suggestions for the pull request subject line?",
      "created_at" : "2018-12-17T16:17:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14963#issuecomment-447903209",
      "id" : 447903209,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14963",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NzkwMzIwOQ==",
      "updated_at" : "2018-12-17T16:17:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/447903209",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think the most important change is ```mempool: Add missing locks to `cs_main` ```, the remaining change is a consequence of that.\r\n\r\nCould also say:\r\n - only tests are affected\r\n - fix related annotations and improve documentation",
      "created_at" : "2018-12-17T16:26:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14963#issuecomment-447906421",
      "id" : 447906421,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14963",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NzkwNjQyMQ==",
      "updated_at" : "2018-12-17T16:26:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/447906421",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r242236689"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242236689"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"doc: Add comment to cs_main and mempool::cs\" (fa64bb42e97b6c6c58e83badca88d386f99dbcd2)\r\n\r\nWould suggest moving the test and bench changes in this commit into a different commit, since they aren't really what you'd normally think of as documentation changes.",
      "commit_id" : "fa5e373365b8e88fc9894f53f618d3e89f1bec14",
      "created_at" : "2018-12-17T17:13:23Z",
      "diff_hunk" : "@@ -108,7 +108,7 @@ static void MempoolEviction(benchmark::State& state)\n     tx7.vout[1].nValue = 10 * COIN;\n \n     CTxMemPool pool;\n-    LOCK(pool.cs);\n+    LOCK2(cs_main, pool.cs);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r242236689",
      "id" : 242236689,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MjIzNjY4OQ==",
      "original_commit_id" : "fa64bb42e97b6c6c58e83badca88d386f99dbcd2",
      "original_position" : 14,
      "path" : "src/bench/mempool_eviction.cpp",
      "position" : 14,
      "pull_request_review_id" : 185701209,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963",
      "updated_at" : "2018-12-22T14:23:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242236689",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r242267088"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242267088"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"doc: Add comment to cs_main and mempool::cs\" (fa64bb42e97b6c6c58e83badca88d386f99dbcd2)\r\n\r\nI would say \"may also need to be locked\" instead of \"must also be locked\", and add \"see CTxMemPool::cs comment for details.\"",
      "commit_id" : "fa5e373365b8e88fc9894f53f618d3e89f1bec14",
      "created_at" : "2018-12-17T18:39:05Z",
      "diff_hunk" : "@@ -210,9 +210,17 @@ class CChainState {\n     bool RollforwardBlock(const CBlockIndex* pindex, CCoinsViewCache& inputs, const CChainParams& params) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n } g_chainstate;\n \n-\n-\n-CCriticalSection cs_main;\n+/**\n+ * Mutex to guard access to validation specific variables, such as reading\n+ * or changing the chainstate.\n+ *\n+ * This must also be locked when updating the transaction pool, e.g. on",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r242267088",
      "id" : 242267088,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MjI2NzA4OA==",
      "original_commit_id" : "fa64bb42e97b6c6c58e83badca88d386f99dbcd2",
      "original_position" : 11,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 185701209,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963",
      "updated_at" : "2018-12-22T14:23:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242267088",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r242268194"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242268194"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"doc: Add comment to cs_main and mempool::cs\" (fa64bb42e97b6c6c58e83badca88d386f99dbcd2)\r\n\r\nI think making a comparison to read/write locks makes this more confusing than it needs to be. Read locks normally are shared, not exclusive. And the requirement to lock `cs_main` for write access seems too broad, and doesn't give a justification.\r\n\r\nI would suggest a comment that just says when you need to lock the mutexes and why:\r\n\r\n```c++\r\n/**\r\n * This mutex needs to be locked when accessing mapTx.\r\n *\r\n * @par Relationship to cs_main\r\n * Locking both mempool.cs and cs_main gives a view of the mempool which is\r\n * compatible with the current chain tip. To guarantee this, both mutexes need\r\n * to be locked when adding transactions to the mempool or changing the\r\n * chain tip. But locking mempool.cs by itself is sufficient for reading\r\n * transactions from the mempool, or removing transactions from it.\r\n */\r\n```",
      "commit_id" : "fa5e373365b8e88fc9894f53f618d3e89f1bec14",
      "created_at" : "2018-12-17T18:42:17Z",
      "diff_hunk" : "@@ -485,7 +485,13 @@ class CTxMemPool\n         >\n     > indexed_transaction_set;\n \n-    mutable CCriticalSection cs;\n+    /**\n+     * Mutex that guards reads.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r242268194",
      "id" : 242268194,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MjI2ODE5NA==",
      "original_commit_id" : "fa64bb42e97b6c6c58e83badca88d386f99dbcd2",
      "original_position" : 6,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 185701209,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963",
      "updated_at" : "2018-12-22T14:23:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242268194",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r242291099"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242291099"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "fa5e373365b8e88fc9894f53f618d3e89f1bec14",
      "created_at" : "2018-12-17T19:46:45Z",
      "diff_hunk" : "@@ -210,9 +210,17 @@ class CChainState {\n     bool RollforwardBlock(const CBlockIndex* pindex, CCoinsViewCache& inputs, const CChainParams& params) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n } g_chainstate;\n \n-\n-\n-CCriticalSection cs_main;\n+/**\n+ * Mutex to guard access to validation specific variables, such as reading\n+ * or changing the chainstate.\n+ *\n+ * This must also be locked when updating the transaction pool, e.g. on",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r242291099",
      "id" : 242291099,
      "in_reply_to_id" : 242267088,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MjI5MTA5OQ==",
      "original_commit_id" : "fa64bb42e97b6c6c58e83badca88d386f99dbcd2",
      "original_position" : 11,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 185767304,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963",
      "updated_at" : "2018-12-22T14:23:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242291099",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r242291161"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242291161"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "fa5e373365b8e88fc9894f53f618d3e89f1bec14",
      "created_at" : "2018-12-17T19:46:57Z",
      "diff_hunk" : "@@ -108,7 +108,7 @@ static void MempoolEviction(benchmark::State& state)\n     tx7.vout[1].nValue = 10 * COIN;\n \n     CTxMemPool pool;\n-    LOCK(pool.cs);\n+    LOCK2(cs_main, pool.cs);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r242291161",
      "id" : 242291161,
      "in_reply_to_id" : 242236689,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MjI5MTE2MQ==",
      "original_commit_id" : "fa64bb42e97b6c6c58e83badca88d386f99dbcd2",
      "original_position" : 14,
      "path" : "src/bench/mempool_eviction.cpp",
      "position" : 14,
      "pull_request_review_id" : 185767388,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963",
      "updated_at" : "2018-12-22T14:23:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242291161",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r242291441"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242291441"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It could also be used to guard other members, like prioritization data, no?",
      "commit_id" : "fa5e373365b8e88fc9894f53f618d3e89f1bec14",
      "created_at" : "2018-12-17T19:47:55Z",
      "diff_hunk" : "@@ -485,7 +485,13 @@ class CTxMemPool\n         >\n     > indexed_transaction_set;\n \n-    mutable CCriticalSection cs;\n+    /**\n+     * Mutex that guards reads.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r242291441",
      "id" : 242291441,
      "in_reply_to_id" : 242268194,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MjI5MTQ0MQ==",
      "original_commit_id" : "fa64bb42e97b6c6c58e83badca88d386f99dbcd2",
      "original_position" : 6,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 185767765,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963",
      "updated_at" : "2018-12-22T14:23:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242291441",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r242291477"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242291477"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Otherwise done",
      "commit_id" : "fa5e373365b8e88fc9894f53f618d3e89f1bec14",
      "created_at" : "2018-12-17T19:48:01Z",
      "diff_hunk" : "@@ -485,7 +485,13 @@ class CTxMemPool\n         >\n     > indexed_transaction_set;\n \n-    mutable CCriticalSection cs;\n+    /**\n+     * Mutex that guards reads.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r242291477",
      "id" : 242291477,
      "in_reply_to_id" : 242268194,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MjI5MTQ3Nw==",
      "original_commit_id" : "fa64bb42e97b6c6c58e83badca88d386f99dbcd2",
      "original_position" : 6,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 185767813,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963",
      "updated_at" : "2018-12-22T14:23:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242291477",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK",
      "created_at" : "2018-12-19T10:01:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14963#issuecomment-448538104",
      "id" : 448538104,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14963",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0ODUzODEwNA==",
      "updated_at" : "2018-12-19T10:01:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/448538104",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r243029441"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/243029441"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This comment comes from https://github.com/bitcoin/bitcoin/pull/14963#discussion_r242268194 and I think it is still ok as a description of how the code currently works. But talking to @morcos, @sdaftuar, and you Monday, it sounds like this is not actually how things are intended to work. After that conversation, I think the following might be more accurate:\r\n\r\n```c++\r\n/**\r\n * This mutex needs to be locked when accessing `mapTx` or other members\r\n * that are guarded by it.\r\n *\r\n * @par Consistency guarantees\r\n *\r\n * By design, it is guaranteed that:\r\n *\r\n * 1. Locking both `cs_main` and `mempool.cs` will give a view of mempool\r\n *    that is consistent with current chain tip (`chainActive` and\r\n *    `pcoinsTip`) and is fully populated. Fully populated means that if the\r\n *    current active chain is missing transactions that were present in a\r\n *    previously active chain, all the missing transactions will have been\r\n *    re-added to the mempool and should be present if they meet size and\r\n *    consistency constraints.\r\n *\r\n * 2. Locking `mempool.cs` without `cs_main` will give a view of a mempool\r\n *    consistent with some chain that was active since `cs_main` was last\r\n *    locked, and that is fully populated as described above. It is ok for\r\n *    code that only needs to query or remove transactions from the mempool\r\n *    to lock just `mempool.cs` without `cs_main`.\r\n *\r\n * To provide these guarantees, it is necessary to lock both `cs_main` and\r\n * `mempool.cs` whenever adding transactions to the mempool and whenever\r\n * changing the chain tip. It's necessary to keep both mutexes locked until\r\n * the mempool is consistent with the new chain tip and fully populated.\r\n *\r\n * @par Consistency bug\r\n *\r\n * The second guarantee above is not currently enforced, but\r\n * https://github.com/bitcoin/bitcoin/pull/14193 will fix it. No known code\r\n * in bitcoin currently depends on second guarantee, but it is important to\r\n * fix for third party code that needs be able to frequently poll the\r\n * mempool without locking `cs_main` and without encountering missing\r\n * transactions during reorgs.\r\n */\r\n```",
      "commit_id" : "fa5e373365b8e88fc9894f53f618d3e89f1bec14",
      "created_at" : "2018-12-19T18:38:30Z",
      "diff_hunk" : "@@ -485,7 +485,18 @@ class CTxMemPool\n         >\n     > indexed_transaction_set;\n \n-    mutable CCriticalSection cs;\n+    /**\n+     * This mutex needs to be locked when accessing mapTx or other members that\n+     * are guarded by it.\n+     *\n+     * @par Relationship to cs_main\n+     * Locking both mempool.cs and cs_main gives a view of the mempool which is\n+     * compatible with the current chain tip. To guarantee this, both mutexes need\n+     * to be locked when adding transactions to the mempool or changing the\n+     * chain tip. But locking mempool.cs by itself is sufficient for reading\n+     * transactions from the mempool, or removing transactions from it.\n+     */\n+    mutable RecursiveMutex cs;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r243029441",
      "id" : 243029441,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MzAyOTQ0MQ==",
      "original_commit_id" : "fa5c7671aa4c916b191d0423309f89b69568c7f9",
      "original_position" : 16,
      "path" : "src/txmempool.h",
      "position" : 41,
      "pull_request_review_id" : 186690650,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963",
      "updated_at" : "2018-12-22T14:23:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/243029441",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r243029879"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/243029879"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Should say \"may also need to be locked\" instead of \"may also be locked\".",
      "commit_id" : "fa5e373365b8e88fc9894f53f618d3e89f1bec14",
      "created_at" : "2018-12-19T18:39:52Z",
      "diff_hunk" : "@@ -210,9 +210,17 @@ class CChainState {\n     bool RollforwardBlock(const CBlockIndex* pindex, CCoinsViewCache& inputs, const CChainParams& params) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n } g_chainstate;\n \n-\n-\n-CCriticalSection cs_main;\n+/**\n+ * Mutex to guard access to validation specific variables, such as reading\n+ * or changing the chainstate.\n+ *\n+ * This may also be locked when updating the transaction pool, e.g. on",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r243029879",
      "id" : 243029879,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MzAyOTg3OQ==",
      "original_commit_id" : "fa5c7671aa4c916b191d0423309f89b69568c7f9",
      "original_position" : 11,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 186690650,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963",
      "updated_at" : "2018-12-22T14:23:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/243029879",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r243040235"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/243040235"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Wow, excellent write-up. Will pull that in to replace my clumsy explanation",
      "commit_id" : "fa5e373365b8e88fc9894f53f618d3e89f1bec14",
      "created_at" : "2018-12-19T19:11:26Z",
      "diff_hunk" : "@@ -485,7 +485,18 @@ class CTxMemPool\n         >\n     > indexed_transaction_set;\n \n-    mutable CCriticalSection cs;\n+    /**\n+     * This mutex needs to be locked when accessing mapTx or other members that\n+     * are guarded by it.\n+     *\n+     * @par Relationship to cs_main\n+     * Locking both mempool.cs and cs_main gives a view of the mempool which is\n+     * compatible with the current chain tip. To guarantee this, both mutexes need\n+     * to be locked when adding transactions to the mempool or changing the\n+     * chain tip. But locking mempool.cs by itself is sufficient for reading\n+     * transactions from the mempool, or removing transactions from it.\n+     */\n+    mutable RecursiveMutex cs;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r243040235",
      "id" : 243040235,
      "in_reply_to_id" : 243029441,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MzA0MDIzNQ==",
      "original_commit_id" : "fa5c7671aa4c916b191d0423309f89b69568c7f9",
      "original_position" : 16,
      "path" : "src/txmempool.h",
      "position" : 41,
      "pull_request_review_id" : 186704080,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963",
      "updated_at" : "2018-12-22T14:23:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/243040235",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r245482016"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245482016"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Changer order of `cs` and `cs_main` here to make locking order consistent?",
      "commit_id" : "fa5e373365b8e88fc9894f53f618d3e89f1bec14",
      "created_at" : "2019-01-05T16:36:06Z",
      "diff_hunk" : "@@ -541,8 +577,8 @@ class CTxMemPool\n     // Note that addUnchecked is ONLY called from ATMP outside of tests\n     // and any other callers may break wallet's in-mempool tracking (due to\n     // lack of CValidationInterface::TransactionAddedToMempool callbacks).\n-    void addUnchecked(const CTxMemPoolEntry& entry, bool validFeeEstimate = true) EXCLUSIVE_LOCKS_REQUIRED(cs);\n-    void addUnchecked(const CTxMemPoolEntry& entry, setEntries& setAncestors, bool validFeeEstimate = true) EXCLUSIVE_LOCKS_REQUIRED(cs);\n+    void addUnchecked(const CTxMemPoolEntry& entry, bool validFeeEstimate = true) EXCLUSIVE_LOCKS_REQUIRED(cs, cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r245482016",
      "id" : 245482016,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NTQ4MjAxNg==",
      "original_commit_id" : "fa5e373365b8e88fc9894f53f618d3e89f1bec14",
      "original_position" : 51,
      "path" : "src/txmempool.h",
      "position" : 51,
      "pull_request_review_id" : 189601492,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963",
      "updated_at" : "2019-01-05T16:36:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245482016",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r245482021"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245482021"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Changer order of `cs` and `cs_main` here to make locking order consistent?",
      "commit_id" : "fa5e373365b8e88fc9894f53f618d3e89f1bec14",
      "created_at" : "2019-01-05T16:36:13Z",
      "diff_hunk" : "@@ -541,8 +577,8 @@ class CTxMemPool\n     // Note that addUnchecked is ONLY called from ATMP outside of tests\n     // and any other callers may break wallet's in-mempool tracking (due to\n     // lack of CValidationInterface::TransactionAddedToMempool callbacks).\n-    void addUnchecked(const CTxMemPoolEntry& entry, bool validFeeEstimate = true) EXCLUSIVE_LOCKS_REQUIRED(cs);\n-    void addUnchecked(const CTxMemPoolEntry& entry, setEntries& setAncestors, bool validFeeEstimate = true) EXCLUSIVE_LOCKS_REQUIRED(cs);\n+    void addUnchecked(const CTxMemPoolEntry& entry, bool validFeeEstimate = true) EXCLUSIVE_LOCKS_REQUIRED(cs, cs_main);\n+    void addUnchecked(const CTxMemPoolEntry& entry, setEntries& setAncestors, bool validFeeEstimate = true) EXCLUSIVE_LOCKS_REQUIRED(cs, cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r245482021",
      "id" : 245482021,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NTQ4MjAyMQ==",
      "original_commit_id" : "fa5e373365b8e88fc9894f53f618d3e89f1bec14",
      "original_position" : 52,
      "path" : "src/txmempool.h",
      "position" : 52,
      "pull_request_review_id" : 189601492,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963",
      "updated_at" : "2019-01-05T16:36:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245482021",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK fa5e373365b8e88fc9894f53f618d3e89f1bec14 modulo nits",
      "created_at" : "2019-01-05T16:36:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14963#issuecomment-451669782",
      "id" : 451669782,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14963",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1MTY2OTc4Mg==",
      "updated_at" : "2019-01-05T16:36:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/451669782",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r248006724"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/248006724"
         }
      },
      "author_association" : "MEMBER",
      "body" : "We call the \"transaction pool\" the \"mempool\" in so many places in this file, I find the usage of \"transaction pool\" to be odd...",
      "commit_id" : "fa5e373365b8e88fc9894f53f618d3e89f1bec14",
      "created_at" : "2019-01-15T18:19:04Z",
      "diff_hunk" : "@@ -210,9 +210,17 @@ class CChainState {\n     bool RollforwardBlock(const CBlockIndex* pindex, CCoinsViewCache& inputs, const CChainParams& params) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n } g_chainstate;\n \n-\n-\n-CCriticalSection cs_main;\n+/**\n+ * Mutex to guard access to validation specific variables, such as reading\n+ * or changing the chainstate.\n+ *\n+ * This may also need to be locked when updating the transaction pool, e.g. on",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14963#discussion_r248006724",
      "id" : 248006724,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0ODAwNjcyNA==",
      "original_commit_id" : "fa5c346c5a336ccdce8e50befb53746c280f053e",
      "original_position" : 11,
      "path" : "src/validation.cpp",
      "position" : 20,
      "pull_request_review_id" : 192791917,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14963",
      "updated_at" : "2019-01-15T18:38:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/248006724",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   }
]
