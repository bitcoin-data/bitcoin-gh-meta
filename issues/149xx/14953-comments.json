[
   {
      "author_association" : "MEMBER",
      "body" : "This seems overkill, as most tests are single-threaded. The multi-threaded test could just have one RNG per thread?\r\n\r\nBy that I mean having an explicit \"FastRandomContext rng(true);\" in each of the threads.",
      "created_at" : "2018-12-13T19:36:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14953#issuecomment-447093412",
      "id" : 447093412,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14953",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NzA5MzQxMg==",
      "updated_at" : "2018-12-13T19:40:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/447093412",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The alternative you suggest (only give each thread their own randomness context when they are multithreaded) would involve (re)writing the `InsecureRandRange` helpers. I'd prefer to just add the thread_local keyword unless there are observable performance regressions.",
      "created_at" : "2018-12-13T19:54:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14953#issuecomment-447099142",
      "id" : 447099142,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14953",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NzA5OTE0Mg==",
      "updated_at" : "2018-12-13T19:54:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/447099142",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Oh, I forgot about the wrappers for the global test RNG. Objection withdrawn.",
      "created_at" : "2018-12-13T19:55:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14953#issuecomment-447099394",
      "id" : 447099394,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14953",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NzA5OTM5NA==",
      "updated_at" : "2018-12-13T19:55:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/447099394",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK",
      "created_at" : "2018-12-13T21:18:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14953#issuecomment-447124239",
      "id" : 447124239,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14953",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NzEyNDIzOQ==",
      "updated_at" : "2018-12-13T21:18:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/447124239",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#14464](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14464.html) (refactor: make checkqueue manage the threads by itself (also removed some boost dependencies) by ken2812221)\n* [#14193](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14193.html) (validation: Add missing mempool locks by MarcoFalke)\n* [#13804](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/13804.html) (WIP: Transaction Pool Layer by MarcoFalke)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2018-12-13T21:39:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14953#issuecomment-447130212",
      "id" : 447130212,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14953",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NzEzMDIxMg==",
      "updated_at" : "2018-12-13T21:39:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/447130212",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "No idea if this is significant, but mentioning just in case:\r\n\r\nThread-local support used to be optional before this (was only used in sync.h in debug mode optionally). This change ignores `HAVE_THREAD_LOCAL` and makes it mandatory.",
      "created_at" : "2018-12-15T07:28:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14953#issuecomment-447545253",
      "id" : 447545253,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14953",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NzU0NTI1Mw==",
      "updated_at" : "2018-12-15T07:28:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/447545253",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Should those tests perhaps fail explicitly, like in `sync.cpp`?\r\n```\r\n#if !defined(HAVE_THREAD_LOCAL)\r\nstatic_assert(false, \"thread_local is not supported\");\r\n#endif\r\n```\r\nOr should we make it mandatory in `./configure`?\r\n\r\nSome earlier related discussion:\r\n* https://github.com/bitcoin/bitcoin/pull/13168#issuecomment-389957916\r\n* https://github.com/bitcoin/bitcoin/pull/11722\r\n\r\nWe bumped the requirement from `g++ 4.7` to `g++ 4.8` in https://github.com/bitcoin/bitcoin/pull/11755\r\n\r\n@theuni wrote there:\r\n> thread_local was also off-limits due to missing support in osx's clang. It's been added as of XCode 8 on September 13, 2016. I'm uneasy with that as a minimum requirement.\r\n\r\nFrom [Apple docs](https://developer.apple.com/library/archive/documentation/DeveloperTools/Conceptual/WhatsNewXcode/Chapters/xcode_8_0.html#//apple_ref/doc/uid/TP40004635-SW1):  \"Xcode 8.1 requires a Mac running macOS 10.11.5 or later\". We still support [macOS 10.10](https://github.com/chaincoin/chaincoin/pull/573). We could consider bumping that to 10.11.5, or accept that some tests won't run.\r\n\r\n> Additionally, last time I checked this, the use of thread_local causes new symbols to be pulled in from glibc on Linux, meaning that we would lose back-compat with older versions. I'd have to re-test to see where the break lies.\r\n\r\nSo perhaps this depends on if we drop e.g. Ubuntu Trusty 14.04 in the next release.",
      "created_at" : "2018-12-15T10:37:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14953#issuecomment-447558439",
      "id" : 447558439,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14953",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NzU1ODQzOQ==",
      "updated_at" : "2018-12-15T10:54:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/447558439",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "`thread_local` was added in C++11, which we require right now and we are about to switch to C++14 soon, so a compiler not supporting it shouldn't be a problem.",
      "created_at" : "2018-12-16T17:52:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14953#issuecomment-447662551",
      "id" : 447662551,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14953",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NzY2MjU1MQ==",
      "updated_at" : "2018-12-16T17:52:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/447662551",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke That reasoning seems backwards. We identify what C++ version (and features) we can use based on the platforms we want to support. I don't mean to say that this particular change is a problem, but just because we're considering C++14 does not mean we should drop support for every platform that doesn't support every feature from C++11 or C++14.\n\nDoes this mean we have now removed support for OSX 10.10 for the unit tests with this change?",
      "created_at" : "2018-12-16T18:42:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14953#issuecomment-447665955",
      "id" : 447665955,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14953",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NzY2NTk1NQ==",
      "updated_at" : "2018-12-16T18:42:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/447665955",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "It would be easier to decide which C++11 (or C++14) features are acceptable to use when there was a guideline/process that defines compatibility requirements we want to achieve.",
      "created_at" : "2018-12-17T00:50:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14953#issuecomment-447692615",
      "id" : 447692615,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14953",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NzY5MjYxNQ==",
      "updated_at" : "2018-12-17T00:50:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/447692615",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> We identify what C++ version (and features) we can use based on the platforms we want to support.\r\n\r\nIt's probably a bit of both. It's easier to support older platforms if it only causes minor inconveniences.\r\n\r\nThis change indeed breaks macOS 10.10 support for the unit tests. Afaik it takes a patch with an `ifdef` to restore support for the majority of tests. @jonasschnelli might be able to confirm since he has VMs with older macOS versions.",
      "created_at" : "2018-12-17T14:54:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14953#issuecomment-447872878",
      "id" : 447872878,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14953",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0Nzg3Mjg3OA==",
      "updated_at" : "2018-12-17T14:54:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/447872878",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   }
]
