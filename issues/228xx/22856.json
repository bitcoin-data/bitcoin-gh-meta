{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "This fixes issues with `ComplexMempool` benchmark introduced in [#17292](https://github.com/bitcoin/bitcoin/pull/17292) , this stress test benchmarks performance of ancestor and descendant tracking of mempool graph algorithms on a complex Mempool. \r\n\r\nThis Benchmark first creates 100 base transactions and stores them in `available_coins` vector. `available_coins` is used for selecting ancestor transactions while creating 800 new transactions. For this a random transaction is picked from `available_coins` and some of its outputs are mapped to the inputs of the new transaction being created. \r\n\r\nNow in case we exhaust all the outputs of an entry in `available_coins` then we need to remove it from `available_coins` before the next iteration of choosing a potential ancestor , it is now implemented with this patch.\r\n\r\n As the index of the entry is randomly chosen from `available_coins` , In order to remove it from the vector , if index of the selected entry is not at the end of `available_coins` vector , it is swapped with the entry at the back of the vector , then the entry at the end of `available_coins` is popped out.\r\n\r\nEarlier the code responsible for constructing outputs of the newly created transaction was inside the loop used for assigning ancestors to the transaction , which does some unnecessary work as it creates outputs of the transaction again and again , now it is moved out of the loop so outputs of the transaction are created just once before adding it to the final list of the transactions created. This one is a minor change to save some computation.\r\n\r\n These changes have changed the `ComplexMempool` benchmark results on `bitcoin:master` as follows : \r\n\r\n**Before** \r\n\r\n>  \r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|      232,881,625.00 |                4.29 |    0.7% |      2.55 | `ComplexMemPool`\r\n\r\n**After**\r\n\r\n>  \r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|      497,275,135.00 |                2.01 |    0.5% |      5.49 | `ComplexMemPool`\r\n\r\n",
   "closed_at" : "2021-12-07T09:47:07Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
      "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
      "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/MarcoFalke",
      "id" : 6399679,
      "login" : "MarcoFalke",
      "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
      "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
      "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
      "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/MarcoFalke"
   },
   "comments" : 5,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22856/comments",
   "created_at" : "2021-09-01T17:53:34Z",
   "draft" : false,
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22856/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/22856",
   "id" : 985431845,
   "labels" : [
      {
         "color" : "d4c5f9",
         "default" : false,
         "description" : null,
         "id" : 62963516,
         "name" : "Tests",
         "node_id" : "MDU6TGFiZWw2Mjk2MzUxNg==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22856/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDExOlB1bGxSZXF1ZXN0NzI0NzI3NTA3",
   "number" : 22856,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/22856.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22856",
      "merged_at" : "2021-12-07T09:47:06Z",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/22856.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22856"
   },
   "reactions" : {
      "+1" : 0,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 0,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22856/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22856/timeline",
   "title" : "test: Fix bug in transaction generation in ComplexMempool benchmark",
   "updated_at" : "2021-12-07T09:47:07Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22856",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/60062252?v=4",
      "events_url" : "https://api.github.com/users/shoryak/events{/privacy}",
      "followers_url" : "https://api.github.com/users/shoryak/followers",
      "following_url" : "https://api.github.com/users/shoryak/following{/other_user}",
      "gists_url" : "https://api.github.com/users/shoryak/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/shoryak",
      "id" : 60062252,
      "login" : "shoryak",
      "node_id" : "MDQ6VXNlcjYwMDYyMjUy",
      "organizations_url" : "https://api.github.com/users/shoryak/orgs",
      "received_events_url" : "https://api.github.com/users/shoryak/received_events",
      "repos_url" : "https://api.github.com/users/shoryak/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/shoryak/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/shoryak/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/shoryak"
   }
}
