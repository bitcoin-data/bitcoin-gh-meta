[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#22976](https://github.com/bitcoin/bitcoin/pull/22976) (scripted-diff: Rename overloaded int GetArg to GetIntArg by ryanofsky)\n* [#22955](https://github.com/bitcoin/bitcoin/pull/22955) (p2p: Rename fBlocksOnly, Add test by MarcoFalke)\n* [#22777](https://github.com/bitcoin/bitcoin/pull/22777) (net processing: don't request tx relay on feeler connections by jnewbery)\n* [#22677](https://github.com/bitcoin/bitcoin/pull/22677) (cut the validation <-> txmempool circular dependency by glozow)\n* [#22564](https://github.com/bitcoin/bitcoin/pull/22564) ([WIP] refactor: Move mutable globals cleared in `::UnloadBlockIndex` to `BlockManager` by dongcarl)\n* [#22340](https://github.com/bitcoin/bitcoin/pull/22340) (p2p: Use legacy relaying to download blocks in blocks-only mode by dergoegge)\n* [#21527](https://github.com/bitcoin/bitcoin/pull/21527) (net_processing: lock clean up by ajtowns)\n* [#20799](https://github.com/bitcoin/bitcoin/pull/20799) (net processing: Only support version 2 compact blocks by jnewbery)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-08-31T19:43:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22850#issuecomment-909555946",
      "id" : 909555946,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22850",
      "node_id" : "IC_kwDOABII5842Nrjq",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-16T00:17:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/909555946",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22850#discussion_r700952750"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700952750"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Wouldn't the same check be needed for `BLOCKTXN`?",
      "commit_id" : "0e07e48a3b049eaa1c7b779187e56cf7ea85ead9",
      "created_at" : "2021-09-02T10:24:02Z",
      "diff_hunk" : "@@ -3396,8 +3415,8 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n \n     if (msg_type == NetMsgType::CMPCTBLOCK)\n     {\n-        // Ignore cmpctblock received while importing\n-        if (fImporting || fReindex) {\n+        // Ignore cmpctblock received while importing, or when there is no mempool\n+        if (fImporting || fReindex || !m_mempool) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22850#discussion_r700952750",
      "id" : 700952750,
      "line" : 3419,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMDk1Mjc1MA==",
      "original_commit_id" : "0e07e48a3b049eaa1c7b779187e56cf7ea85ead9",
      "original_line" : 3419,
      "original_position" : 222,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 222,
      "pull_request_review_id" : 744885059,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22850",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-02T10:50:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700952750",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22850#discussion_r700954602"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700954602"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Wouldn't it be safer to set the block to nullptr when the mempool is nullptr?",
      "commit_id" : "0e07e48a3b049eaa1c7b779187e56cf7ea85ead9",
      "created_at" : "2021-09-02T10:26:53Z",
      "diff_hunk" : "@@ -867,7 +867,7 @@ bool PeerManagerImpl::BlockRequested(NodeId nodeid, const CBlockIndex& block, st\n     RemoveBlockRequest(hash);\n \n     std::list<QueuedBlock>::iterator it = state->vBlocksInFlight.insert(state->vBlocksInFlight.end(),\n-            {&block, std::unique_ptr<PartiallyDownloadedBlock>(pit ? new PartiallyDownloadedBlock(&m_mempool) : nullptr)});\n+            {&block, std::unique_ptr<PartiallyDownloadedBlock>(pit ? new PartiallyDownloadedBlock(m_mempool) : nullptr)});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22850#discussion_r700954602",
      "id" : 700954602,
      "line" : 870,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMDk1NDYwMg==",
      "original_commit_id" : "0e07e48a3b049eaa1c7b779187e56cf7ea85ead9",
      "original_line" : 870,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 23,
      "pull_request_review_id" : 744885059,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22850",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-02T10:50:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700954602",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22850#discussion_r700958398"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700958398"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If you pick this suggestion, you can also add a separate commit to document the expectation that `PartiallyDownloadedBlock` assumes a reference (doesn't accept nullptr) and that `InitData` without a pool is UB/Crash.\r\n\r\n```diff\r\ndiff --git a/src/blockencodings.cpp b/src/blockencodings.cpp\r\nindex aa111b5939..8f77c4afd6 100644\r\n--- a/src/blockencodings.cpp\r\n+++ b/src/blockencodings.cpp\r\n@@ -45,8 +45,9 @@ uint64_t CBlockHeaderAndShortTxIDs::GetShortID(const uint256& txhash) const {\r\n }\r\n \r\n \r\n-\r\n-ReadStatus PartiallyDownloadedBlock::InitData(const CBlockHeaderAndShortTxIDs& cmpctblock, const std::vector<std::pair<uint256, CTransactionRef>>& extra_txn) {\r\n+ReadStatus PartiallyDownloadedBlock::InitData(const CBlockHeaderAndShortTxIDs& cmpctblock, const std::vector<std::pair<uint256, CTransactionRef>>& extra_txn)\r\n+{\r\n+    Assert(pool);\r\n     if (cmpctblock.header.IsNull() || (cmpctblock.shorttxids.empty() && cmpctblock.prefilledtxn.empty()))\r\n         return READ_STATUS_INVALID;\r\n     if (cmpctblock.shorttxids.size() + cmpctblock.prefilledtxn.size() > MAX_BLOCK_WEIGHT / MIN_SERIALIZABLE_TRANSACTION_WEIGHT)\r\ndiff --git a/src/blockencodings.h b/src/blockencodings.h\r\nindex 326db1b4a7..ce3284bfd5 100644\r\n--- a/src/blockencodings.h\r\n+++ b/src/blockencodings.h\r\n@@ -6,6 +6,7 @@\r\n #define BITCOIN_BLOCKENCODINGS_H\r\n \r\n #include <primitives/block.h>\r\n+#include <util/check.h>\r\n \r\n \r\n class CTxMemPool;\r\n@@ -127,9 +128,10 @@ protected:\r\n     std::vector<CTransactionRef> txn_available;\r\n     size_t prefilled_count = 0, mempool_count = 0, extra_count = 0;\r\n     const CTxMemPool* pool;\r\n+\r\n public:\r\n     CBlockHeader header;\r\n-    explicit PartiallyDownloadedBlock(CTxMemPool* poolIn) : pool(poolIn) {}\r\n+    explicit PartiallyDownloadedBlock(CTxMemPool* poolIn) : pool(Assume(poolIn)) {}\r\n \r\n     // extra_txn is a list of extra transactions to look at, in <witness hash, reference> form\r\n     ReadStatus InitData(const CBlockHeaderAndShortTxIDs& cmpctblock, const std::vector<std::pair<uint256, CTransactionRef>>& extra_txn);\r\n",
      "commit_id" : "0e07e48a3b049eaa1c7b779187e56cf7ea85ead9",
      "created_at" : "2021-09-02T10:32:42Z",
      "diff_hunk" : "@@ -867,7 +867,7 @@ bool PeerManagerImpl::BlockRequested(NodeId nodeid, const CBlockIndex& block, st\n     RemoveBlockRequest(hash);\n \n     std::list<QueuedBlock>::iterator it = state->vBlocksInFlight.insert(state->vBlocksInFlight.end(),\n-            {&block, std::unique_ptr<PartiallyDownloadedBlock>(pit ? new PartiallyDownloadedBlock(&m_mempool) : nullptr)});\n+            {&block, std::unique_ptr<PartiallyDownloadedBlock>(pit ? new PartiallyDownloadedBlock(m_mempool) : nullptr)});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22850#discussion_r700958398",
      "id" : 700958398,
      "in_reply_to_id" : 700954602,
      "line" : 870,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMDk1ODM5OA==",
      "original_commit_id" : "0e07e48a3b049eaa1c7b779187e56cf7ea85ead9",
      "original_line" : 870,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 23,
      "pull_request_review_id" : 744885059,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22850",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-02T10:50:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700958398",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22850#discussion_r700966796"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700966796"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    if (!Assume(m_mempool)) return false;\r\n```\r\n\r\nIt would be nice if this function wasn't called when no mempool exists. If you agree, I think it makes sense to skip calling this function when txs aren't expected at all:\r\n\r\n```diff\r\ndiff --git a/src/net_processing.cpp b/src/net_processing.cpp\r\nindex 3ad34e83ba..68e381db60 100644\r\n--- a/src/net_processing.cpp\r\n+++ b/src/net_processing.cpp\r\n@@ -2949,16 +2949,17 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\r\n                     best_block = &inv.hash;\r\n                 }\r\n             } else if (inv.IsGenTxMsg()) {\r\n+                if (fBlocksOnly) {\r\n+                    LogPrint(BCLog::NET, \"transaction (%s) inv sent in violation of protocol, disconnecting peer=%d\\n\", inv.hash.ToString(), pfrom.GetId());\r\n+                    pfrom.fDisconnect = true;\r\n+                    return;\r\n+                }\r\n                 const GenTxid gtxid = ToGenTxid(inv);\r\n                 const bool fAlreadyHave = AlreadyHaveTx(gtxid);\r\n                 LogPrint(BCLog::NET, \"got inv: %s  %s peer=%d\\n\", inv.ToString(), fAlreadyHave ? \"have\" : \"new\", pfrom.GetId());\r\n \r\n                 pfrom.AddKnownTx(inv.hash);\r\n-                if (fBlocksOnly) {\r\n-                    LogPrint(BCLog::NET, \"transaction (%s) inv sent in violation of protocol, disconnecting peer=%d\\n\", inv.hash.ToString(), pfrom.GetId());\r\n-                    pfrom.fDisconnect = true;\r\n-                    return;\r\n-                } else if (!fAlreadyHave && !m_chainman.ActiveChainstate().IsInitialBlockDownload()) {\r\n+                if (!fAlreadyHave && !m_chainman.ActiveChainstate().IsInitialBlockDownload()) {\r\n                     AddTxAnnouncement(pfrom, gtxid, current_time);\r\n                 }\r\n             } else {\r\n```\r\n\r\nShould be done in a separate commit, or even separate pull",
      "commit_id" : "0e07e48a3b049eaa1c7b779187e56cf7ea85ead9",
      "created_at" : "2021-09-02T10:45:02Z",
      "diff_hunk" : "@@ -1632,6 +1640,8 @@ void PeerManagerImpl::BlockChecked(const CBlock& block, const BlockValidationSta\n \n bool PeerManagerImpl::AlreadyHaveTx(const GenTxid& gtxid)\n {\n+    if (!m_mempool) return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22850#discussion_r700966796",
      "id" : 700966796,
      "line" : 1643,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMDk2Njc5Ng==",
      "original_commit_id" : "0e07e48a3b049eaa1c7b779187e56cf7ea85ead9",
      "original_line" : 1643,
      "original_position" : 90,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 90,
      "pull_request_review_id" : 744885059,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22850",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-02T10:50:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700966796",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2021-09-05T12:02:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22850#issuecomment-913141417",
      "id" : 913141417,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22850",
      "node_id" : "IC_kwDOABII5842bW6p",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-05T12:02:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/913141417",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-09-16T16:01:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22850#issuecomment-921031369",
      "id" : 921031369,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22850",
      "node_id" : "IC_kwDOABII58425dLJ",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-16T16:01:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/921031369",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22850#discussion_r712296435"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/712296435"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done in #23042 ",
      "commit_id" : "0e07e48a3b049eaa1c7b779187e56cf7ea85ead9",
      "created_at" : "2021-09-20T15:48:50Z",
      "diff_hunk" : "@@ -1632,6 +1640,8 @@ void PeerManagerImpl::BlockChecked(const CBlock& block, const BlockValidationSta\n \n bool PeerManagerImpl::AlreadyHaveTx(const GenTxid& gtxid)\n {\n+    if (!m_mempool) return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22850#discussion_r712296435",
      "id" : 712296435,
      "in_reply_to_id" : 700966796,
      "line" : 1643,
      "node_id" : "PRRC_kwDOABII584qdMfz",
      "original_commit_id" : "0e07e48a3b049eaa1c7b779187e56cf7ea85ead9",
      "original_line" : 1643,
      "original_position" : 90,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 90,
      "pull_request_review_id" : 758809145,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22850",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-20T15:48:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/712296435",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2021-09-28T08:55:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22850#issuecomment-928992191",
      "id" : 928992191,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22850",
      "node_id" : "IC_kwDOABII5843X0u_",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-28T08:55:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/928992191",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "If the `-nomempool` setting is too abstract (or controversial), I think the changes make a lot of sense on their own.\r\n\r\nRemoving the requirement of PeerManager to hold a reference to a mempool makes (unit/fuzz) testing easier if there is a test that doesn't need the mempool. Also, it makes the coupling of CTxMemPool and PeerManager a bit more loose. (Maybe that additional motivation can be included in the OP)\r\n\r\nMoreover, the mempool is already treated optional in pretty much every other part of the codebase (validation, RPC, ...), so doing it consistently is preferable.",
      "created_at" : "2021-12-22T14:28:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22850#issuecomment-999617795",
      "id" : 999617795,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22850",
      "node_id" : "IC_kwDOABII5847lPUD",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 1,
         "heart" : 1,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 2,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/999617795/reactions"
      },
      "updated_at" : "2021-12-22T14:28:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/999617795",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--13523179cfe9479db18ec6c5d236f789-->There hasn't been much activity lately and the patch still needs rebase. What is the status here?\r\n\r\n* Is it still relevant? â¡ï¸ Please solve the conflicts to make it ready for review and to ensure the CI passes.\r\n* Is it no longer relevant? â¡ï¸ Please close.\r\n* Did the author lose interest or time to work on this? â¡ï¸ Please close it and mark it 'Up for grabs' with the label, so that it can be picked up in the future.\r\n",
      "created_at" : "2022-01-03T09:11:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22850#issuecomment-1003955921",
      "id" : 1003955921,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22850",
      "node_id" : "IC_kwDOABII58471ybR",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1003955921/reactions"
      },
      "updated_at" : "2022-01-03T09:11:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1003955921",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22850#discussion_r851160935"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/851160935"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This sentence is difficult to understand. Perhaps \"If this peer has relay permissions and we have a mempool, allow transactions announcements.\"",
      "commit_id" : "0e07e48a3b049eaa1c7b779187e56cf7ea85ead9",
      "created_at" : "2022-04-15T09:00:30Z",
      "diff_hunk" : "@@ -2913,8 +2931,9 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // block-relay-only peer\n         bool fBlocksOnly = m_ignore_incoming_txs || (pfrom.m_tx_relay == nullptr);\n \n-        // Allow peers with relay permission to send data other than blocks in blocks only mode\n-        if (pfrom.HasPermission(NetPermissionFlags::Relay)) {\n+        // Allow peers with relay permission to send data other than blocks in blocks only mode, and if",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22850#discussion_r851160935",
      "id" : 851160935,
      "line" : 2934,
      "node_id" : "PRRC_kwDOABII584yu69n",
      "original_commit_id" : "0e07e48a3b049eaa1c7b779187e56cf7ea85ead9",
      "original_line" : 2934,
      "original_position" : 177,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 177,
      "pull_request_review_id" : 943276882,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/851160935/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-15T09:02:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/851160935",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22850#discussion_r851161298"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22850"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/851161298"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Since you're touching this line, consider changing the parameter name to `mempool`, to match the member variable name `m_mempool`. Same for the `PeerManager` ctor.",
      "commit_id" : "0e07e48a3b049eaa1c7b779187e56cf7ea85ead9",
      "created_at" : "2022-04-15T09:01:12Z",
      "diff_hunk" : "@@ -1421,14 +1429,14 @@ bool PeerManagerImpl::BlockRequestAllowed(const CBlockIndex* pindex)\n \n std::unique_ptr<PeerManager> PeerManager::make(const CChainParams& chainparams, CConnman& connman, CAddrMan& addrman,\n                                                BanMan* banman, ChainstateManager& chainman,\n-                                               CTxMemPool& pool, bool ignore_incoming_txs)\n+                                               CTxMemPool* pool, bool ignore_incoming_txs)\n {\n     return std::make_unique<PeerManagerImpl>(chainparams, connman, addrman, banman, chainman, pool, ignore_incoming_txs);\n }\n \n PeerManagerImpl::PeerManagerImpl(const CChainParams& chainparams, CConnman& connman, CAddrMan& addrman,\n                                  BanMan* banman, ChainstateManager& chainman,\n-                                 CTxMemPool& pool, bool ignore_incoming_txs)\n+                                 CTxMemPool* pool, bool ignore_incoming_txs)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22850#discussion_r851161298",
      "id" : 851161298,
      "line" : 1439,
      "node_id" : "PRRC_kwDOABII584yu7DS",
      "original_commit_id" : "0e07e48a3b049eaa1c7b779187e56cf7ea85ead9",
      "original_line" : 1439,
      "original_position" : 82,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 82,
      "pull_request_review_id" : 943276882,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22850",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/851161298/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-15T09:02:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/851161298",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--13523179cfe9479db18ec6c5d236f789-->There hasn't been much activity lately and the patch still needs rebase. What is the status here?\n\n* Is it still relevant? â¡ï¸ Please solve the conflicts to make it ready for review and to ensure the CI passes.\n* Is it no longer relevant? â¡ï¸ Please close.\n* Did the author lose interest or time to work on this? â¡ï¸ Please close it and mark it 'Up for grabs' with the label, so that it can be picked up in the future.\n",
      "created_at" : "2022-07-25T07:41:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22850#issuecomment-1193697185",
      "id" : 1193697185,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22850",
      "node_id" : "IC_kwDOABII585HJl-h",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1193697185/reactions"
      },
      "updated_at" : "2022-07-25T07:41:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1193697185",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "There is certainly agreement that this is a change we want to make, but this PR has been dead for some time (and multiple pings). Closing and marking as up for grabs.",
      "created_at" : "2022-10-02T14:47:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22850#issuecomment-1264660842",
      "id" : 1264660842,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22850",
      "node_id" : "IC_kwDOABII585LYTFq",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1264660842/reactions"
      },
      "updated_at" : "2022-10-02T14:47:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1264660842",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   }
]
