[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#22087](https://github.com/bitcoin/bitcoin/pull/22087) (Validate port numbers by amadeuszpawlik)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-08-30T00:18:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-907908544",
      "id" : 907908544,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII5842HZXA",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-14T23:10:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/907908544",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r698233066"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/698233066"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The file is .2 MB, so I am wondering if there is a way to generate it with a few lines of python? Can `addpeeraddress` fill the tried table?",
      "commit_id" : "c8a603590697004e2759dbdf971b5f40041342d7",
      "created_at" : "2021-08-30T06:45:27Z",
      "diff_hunk" : "@@ -38,6 +41,10 @@ class AsmapTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.num_nodes = 1\n \n+    def set_peers_dat(self):\n+        peers_data = os.path.join(os.path.dirname(os.path.realpath(__file__)), 'data/peers.dat')\n+        shutil.copyfile(peers_data, os.path.join(self.datadir, 'peers.dat'))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r698233066",
      "id" : 698233066,
      "line" : 46,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5ODIzMzA2Ng==",
      "original_commit_id" : "6d9da9bc9695ba262d36d444bffce87e0f2481cc",
      "original_line" : 46,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "test/functional/feature_asmap.py",
      "position" : 18,
      "pull_request_review_id" : 741320625,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-30T06:45:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/698233066",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r698235542"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/698235542"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Didn't immediately see how to add tried entries programmatically but I think the file can be much smaller if concept ack.",
      "commit_id" : "c8a603590697004e2759dbdf971b5f40041342d7",
      "created_at" : "2021-08-30T06:50:22Z",
      "diff_hunk" : "@@ -38,6 +41,10 @@ class AsmapTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.num_nodes = 1\n \n+    def set_peers_dat(self):\n+        peers_data = os.path.join(os.path.dirname(os.path.realpath(__file__)), 'data/peers.dat')\n+        shutil.copyfile(peers_data, os.path.join(self.datadir, 'peers.dat'))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r698235542",
      "id" : 698235542,
      "in_reply_to_id" : 698233066,
      "line" : 46,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5ODIzNTU0Mg==",
      "original_commit_id" : "6d9da9bc9695ba262d36d444bffce87e0f2481cc",
      "original_line" : 46,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "test/functional/feature_asmap.py",
      "position" : 18,
      "pull_request_review_id" : 741323656,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-30T06:50:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/698235542",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r698262027"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/698262027"
         }
      },
      "author_association" : "MEMBER",
      "body" : "An alternative is always to add the data to https://github.com/bitcoin-core/qa-assets, which doesn't slow down the main repo clone at all.",
      "commit_id" : "c8a603590697004e2759dbdf971b5f40041342d7",
      "created_at" : "2021-08-30T07:36:54Z",
      "diff_hunk" : "@@ -38,6 +41,10 @@ class AsmapTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.num_nodes = 1\n \n+    def set_peers_dat(self):\n+        peers_data = os.path.join(os.path.dirname(os.path.realpath(__file__)), 'data/peers.dat')\n+        shutil.copyfile(peers_data, os.path.join(self.datadir, 'peers.dat'))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r698262027",
      "id" : 698262027,
      "in_reply_to_id" : 698233066,
      "line" : 46,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5ODI2MjAyNw==",
      "original_commit_id" : "6d9da9bc9695ba262d36d444bffce87e0f2481cc",
      "original_line" : 46,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "test/functional/feature_asmap.py",
      "position" : 18,
      "pull_request_review_id" : 741358818,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-30T07:37:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/698262027",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r698317771"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/698317771"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Reduced the `peers.dat` size 20x while still ensuring the test passes/fails\r\n\r\nbefore\r\n```\r\n236 KB\r\nAddrman checks started: new 3157, tried 96, total 3253\r\n```\r\nafter\r\n```\r\n11.9 KB\r\nAddrman checks started: new 95, tried 3, total 98\r\n```\r\n\r\nFiles in `test/functional/data` for me locally\r\n```\r\n$ ls -l test/functional/data\r\n-rw-r--r-- 1 88238 Jun  5 16:07 blockheader_testnet3.hex\r\n-rw-r--r-- 1  8056 Aug 28 23:27 invalid_txs.py\r\n-rw-r--r-- 1 12137 Aug 30 11:12 peers.dat\r\ndrwxr-xr-x 2  4096 Aug 19 14:46 __pycache__\r\n-rw-r--r-- 1  3431 Jun  5 16:07 rpc_bip67.json\r\n-rw-r--r-- 1 57899 Jun  5 16:07 rpc_getblockstats.json\r\n-rw-r--r-- 1 47236 Jun  5 16:07 rpc_psbt.json\r\n```\r\n\r\n",
      "commit_id" : "2fb6933d19007613a25d56f18a767c8d2c6ef2be",
      "created_at" : "2021-08-30T09:01:19Z",
      "diff_hunk" : "@@ -38,6 +41,10 @@ class AsmapTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.num_nodes = 1\n \n+    def set_peers_dat(self):\n+        peers_data = os.path.join(os.path.dirname(os.path.realpath(__file__)), 'data/peers.dat')\n+        shutil.copyfile(peers_data, os.path.join(self.datadir, 'peers.dat'))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r698317771",
      "id" : 698317771,
      "in_reply_to_id" : 698233066,
      "line" : 49,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5ODMxNzc3MQ==",
      "original_commit_id" : "6d9da9bc9695ba262d36d444bffce87e0f2481cc",
      "original_line" : 49,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "test/functional/feature_asmap.py",
      "position" : 26,
      "pull_request_review_id" : 741430423,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-30T09:17:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/698317771",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r698318885"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/698318885"
         }
      },
      "author_association" : "MEMBER",
      "body" : "(The new -checkaddrman option and logging is super helpful :)",
      "commit_id" : "2fb6933d19007613a25d56f18a767c8d2c6ef2be",
      "created_at" : "2021-08-30T09:02:58Z",
      "diff_hunk" : "@@ -38,6 +41,10 @@ class AsmapTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.num_nodes = 1\n \n+    def set_peers_dat(self):\n+        peers_data = os.path.join(os.path.dirname(os.path.realpath(__file__)), 'data/peers.dat')\n+        shutil.copyfile(peers_data, os.path.join(self.datadir, 'peers.dat'))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r698318885",
      "id" : 698318885,
      "in_reply_to_id" : 698233066,
      "line" : 49,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5ODMxODg4NQ==",
      "original_commit_id" : "6d9da9bc9695ba262d36d444bffce87e0f2481cc",
      "original_line" : 49,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "test/functional/feature_asmap.py",
      "position" : 26,
      "pull_request_review_id" : 741431851,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-30T09:02:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/698318885",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Re-pushed with a 20x smaller `peers.dat` containing 95 new and 3 tried entries (we need a few entries in the tried table for the asmap/addrman regression test) along with some docs per `git diff c8a6035 792c9c2`.\r\n",
      "created_at" : "2021-08-30T10:44:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-908238584",
      "id" : 908238584,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII5842Ip74",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-30T10:44:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/908238584",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Maybe still include docs on how to generate the file? (See also https://github.com/bitcoin/bitcoin/pull/16796#pullrequestreview-285574484)\r\nCan be in the commit message or a separate file.",
      "created_at" : "2021-08-30T13:03:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-908323916",
      "id" : 908323916,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII5842I-xM",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-30T13:03:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/908323916",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Maybe still include docs on how to generate the file? (See also [#16796 (review)](https://github.com/bitcoin/bitcoin/pull/16796#pullrequestreview-285574484))\r\n> Can be in the commit message or a separate file.\r\n\r\nGood idea. Done in the commit message.",
      "created_at" : "2021-08-30T18:41:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-908591411",
      "id" : 908591411,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII5842KAEz",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-31T07:20:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/908591411",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "concept ACK, thanks for adding tests. I think squashing cf90c5a7d5116468d42a812d5eed93a2ac56a248 & 80dbd9b0f46f2b12a9e6359e1aaf4c706b57f20b would make sense, because the functional test seems like the easiest way to verify the contents of the `peers.dat` file. ",
      "created_at" : "2021-08-31T20:52:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-909627569",
      "id" : 909627569,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII5842N9Cx",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-31T20:52:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/909627569",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r701895523"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701895523"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why making this assignment twice? The line `node.addrman->m_asmap = asmap;` is literally repeated? I think it could be done afterwards?",
      "commit_id" : "d5070688feb68fac59b076411f1d84131726098e",
      "created_at" : "2021-09-03T13:33:51Z",
      "diff_hunk" : "@@ -1184,10 +1213,12 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n         } else {\n             // Addrman can be in an inconsistent state after failure, reset it\n             node.addrman = std::make_unique<CAddrMan>(/* deterministic */ false, /* consistency_check_ratio */ check_addrman);\n+            node.addrman->m_asmap = asmap;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r701895523",
      "id" : 701895523,
      "line" : 1216,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMTg5NTUyMw==",
      "original_commit_id" : "0cdfe7fc9040bcecc6cb71c455b386659a8340fa",
      "original_line" : 1216,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 47,
      "pull_request_review_id" : 746112693,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-03T13:33:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701895523",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r701896544"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701896544"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah, I realized that's the whole point of this commit.",
      "commit_id" : "d5070688feb68fac59b076411f1d84131726098e",
      "created_at" : "2021-09-03T13:35:14Z",
      "diff_hunk" : "@@ -1184,10 +1213,12 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n         } else {\n             // Addrman can be in an inconsistent state after failure, reset it\n             node.addrman = std::make_unique<CAddrMan>(/* deterministic */ false, /* consistency_check_ratio */ check_addrman);\n+            node.addrman->m_asmap = asmap;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r701896544",
      "id" : 701896544,
      "in_reply_to_id" : 701895523,
      "line" : 1216,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMTg5NjU0NA==",
      "original_commit_id" : "0cdfe7fc9040bcecc6cb71c455b386659a8340fa",
      "original_line" : 1216,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 47,
      "pull_request_review_id" : 746114121,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-03T13:35:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701896544",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I think squashing [cf90c5a](https://github.com/bitcoin/bitcoin/commit/cf90c5a7d5116468d42a812d5eed93a2ac56a248) & [80dbd9b](https://github.com/bitcoin/bitcoin/commit/80dbd9b0f46f2b12a9e6359e1aaf4c706b57f20b) would make sense, because the functional test seems like the easiest way to verify the contents of the `peers.dat` file.\r\n\r\nThey began as the same commit together, then I realized that it makes more sense for them to be separate:\r\n\r\n- the file addition is a standalone change that can be used for other tests (I have some ideas)\r\n- so that people can find the data file commit easily, see its documentation, how it was generated, maybe generate a new one (more addresses, or with tor v2 peers, etc.), or perhaps to revert it someday if we have a way to call `CAddrMan::MakeTried()` from the tests to move addresses into the tried table or to mock it\r\n- the commit messages are very different\r\n\r\nThe easiest way to test the peers.dat file is to copy it to a datadir, start a node, and run commands on it like `-addrinfo`, `getnodeaddresses`, etc. Edit: added \"how to test\" info to the commit message.",
      "created_at" : "2021-09-03T15:08:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-912608978",
      "id" : 912608978,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII5842ZU7S",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-10T14:04:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/912608978",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-09-06T10:57:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-913554583",
      "id" : 913554583,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII5842c7yX",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-06T10:57:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/913554583",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased, improved the commit messages, added additional test coverage, and renamed the test file to `feature_addrman_asmap.py`. Updated the PR title and description.",
      "created_at" : "2021-09-06T12:42:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-913619889",
      "id" : 913619889,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII5842dLux",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-06T12:44:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/913619889",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-09-08T07:52:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-915004722",
      "id" : 915004722,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII5842id0y",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-08T07:52:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/915004722",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased and merged the addrman and asmap tests into one test file.",
      "created_at" : "2021-09-08T15:11:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-915326635",
      "id" : 915326635,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII5842jsar",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-08T15:11:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/915326635",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r704550576"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/704550576"
         }
      },
      "author_association" : "MEMBER",
      "body" : "An alternative to adding a binary file would be to hack something together with the `serialize_addrman` function in this file",
      "commit_id" : "4cda5cf42118bcaf15ea3951d5189af8db6aa365",
      "created_at" : "2021-09-08T15:48:01Z",
      "diff_hunk" : "@@ -0,0 +1,184 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020-2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test addrman/checkaddrman/asmap functionality.\"\"\"\n+\n+import os\n+import shutil\n+import struct\n+\n+from test_framework.messages import ser_uint256, hash256\n+from test_framework.p2p import MAGIC_BYTES\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+DEFAULT_ASMAP_FILENAME = \"ip_asn.map\"  # defined in src/init.cpp\n+ASMAP = \"../../src/test/data/asmap.raw\"  # path to unit test skeleton asmap\n+VERSION = \"fec61fa21a9f46f3b17bdcd660d7f4cd90b966aad3aec593c99b35f0aca15853\"\n+\n+\n+def expected_messages(filename):\n+    return [\n+        f'Opened asmap file \"{filename}\" (59 bytes) from disk',\n+        f\"Using asmap version {VERSION} for IP bucketing\",\n+    ]\n+\n+\n+def serialize_addrman(*, format=1, lowest_compatible=3):\n+    new = []\n+    tried = []\n+    INCOMPATIBILITY_BASE = 32\n+    r = MAGIC_BYTES[\"regtest\"]\n+    r += struct.pack(\"B\", format)\n+    r += struct.pack(\"B\", INCOMPATIBILITY_BASE + lowest_compatible)\n+    r += ser_uint256(1)\n+    r += struct.pack(\"i\", len(new))\n+    r += struct.pack(\"i\", len(tried))\n+    ADDRMAN_NEW_BUCKET_COUNT = 1 << 10\n+    r += struct.pack(\"i\", ADDRMAN_NEW_BUCKET_COUNT ^ (1 << 30))\n+    for _ in range(ADDRMAN_NEW_BUCKET_COUNT):\n+        r += struct.pack(\"i\", 0)\n+    checksum = hash256(r)\n+    r += checksum\n+    return r\n+\n+\n+def write_addrman(peers_dat, **kwargs):\n+    with open(peers_dat, \"wb\") as f:\n+        f.write(serialize_addrman(**kwargs))\n+\n+\n+class AddrmanAsmapTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+\n+    def set_peers_dat(self):\n+        \"\"\"Copy a peers.dat containing tried table entries into the data directory.\"\"\"\n+        peers_data = os.path.join(os.path.dirname(os.path.realpath(__file__)), \"data/peers.dat\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r704550576",
      "id" : 704550576,
      "line" : 59,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNDU1MDU3Ng==",
      "original_commit_id" : "4cda5cf42118bcaf15ea3951d5189af8db6aa365",
      "original_line" : 59,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "test/functional/feature_addrman_asmap.py",
      "position" : 59,
      "pull_request_review_id" : 749323336,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-08T15:48:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/704550576",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r705086054"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/705086054"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I agree, it would be a logical next step if this is merged but this can do the job for now.\r\n\r\n(For now I think it's fundamental to have these regression tests in place quickly, given the number of recent bugs that escaped review, the reproducible criticality of the last bug that this adds a test for, and the addrman/asmap refactoring taking place.)",
      "commit_id" : "b549fc53a35759876e416751c0093aa6205b6b48",
      "created_at" : "2021-09-09T08:01:33Z",
      "diff_hunk" : "@@ -0,0 +1,184 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020-2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test addrman/checkaddrman/asmap functionality.\"\"\"\n+\n+import os\n+import shutil\n+import struct\n+\n+from test_framework.messages import ser_uint256, hash256\n+from test_framework.p2p import MAGIC_BYTES\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+DEFAULT_ASMAP_FILENAME = \"ip_asn.map\"  # defined in src/init.cpp\n+ASMAP = \"../../src/test/data/asmap.raw\"  # path to unit test skeleton asmap\n+VERSION = \"fec61fa21a9f46f3b17bdcd660d7f4cd90b966aad3aec593c99b35f0aca15853\"\n+\n+\n+def expected_messages(filename):\n+    return [\n+        f'Opened asmap file \"{filename}\" (59 bytes) from disk',\n+        f\"Using asmap version {VERSION} for IP bucketing\",\n+    ]\n+\n+\n+def serialize_addrman(*, format=1, lowest_compatible=3):\n+    new = []\n+    tried = []\n+    INCOMPATIBILITY_BASE = 32\n+    r = MAGIC_BYTES[\"regtest\"]\n+    r += struct.pack(\"B\", format)\n+    r += struct.pack(\"B\", INCOMPATIBILITY_BASE + lowest_compatible)\n+    r += ser_uint256(1)\n+    r += struct.pack(\"i\", len(new))\n+    r += struct.pack(\"i\", len(tried))\n+    ADDRMAN_NEW_BUCKET_COUNT = 1 << 10\n+    r += struct.pack(\"i\", ADDRMAN_NEW_BUCKET_COUNT ^ (1 << 30))\n+    for _ in range(ADDRMAN_NEW_BUCKET_COUNT):\n+        r += struct.pack(\"i\", 0)\n+    checksum = hash256(r)\n+    r += checksum\n+    return r\n+\n+\n+def write_addrman(peers_dat, **kwargs):\n+    with open(peers_dat, \"wb\") as f:\n+        f.write(serialize_addrman(**kwargs))\n+\n+\n+class AddrmanAsmapTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+\n+    def set_peers_dat(self):\n+        \"\"\"Copy a peers.dat containing tried table entries into the data directory.\"\"\"\n+        peers_data = os.path.join(os.path.dirname(os.path.realpath(__file__)), \"data/peers.dat\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r705086054",
      "id" : 705086054,
      "in_reply_to_id" : 704550576,
      "line" : 59,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNTA4NjA1NA==",
      "original_commit_id" : "4cda5cf42118bcaf15ea3951d5189af8db6aa365",
      "original_line" : 59,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "test/functional/feature_addrman_asmap.py",
      "position" : 59,
      "pull_request_review_id" : 750010565,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-09T08:01:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/705086054",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Sorry, needs rebase again. Maybe split out the merge of the two files into a separate pull, or at least the first commit? Review of the later commits will be easier after getting the full picture first.",
      "created_at" : "2021-09-10T09:45:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-916776358",
      "id" : 916776358,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII5842pOWm",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-10T09:45:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/916776358",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-09-10T10:03:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-916786907",
      "id" : 916786907,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII5842pQ7b",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-10T10:03:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/916786907",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Sorry, needs rebase again.\n\nIt's all good, this was the merge order that made sense to me.",
      "created_at" : "2021-09-10T10:37:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-916806485",
      "id" : 916806485,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII5842pVtV",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-10T10:37:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/916806485",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r706154132"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706154132"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm not sure mentioning initialization order here is needed/wanted, as `-checkaddrman` is just a generic check for corruption. I also don't think we should leak implementation details like `CAddrman::Check()`. Naming the function doesn't add value, and it's the kind of thing that just becomes outdated / needs changing again in a change like #22872.",
      "commit_id" : "b549fc53a35759876e416751c0093aa6205b6b48",
      "created_at" : "2021-09-10T12:50:20Z",
      "diff_hunk" : "@@ -12,7 +12,10 @@\n \n 3. `bitcoind -asmap=<relative path>`, using the unit test skeleton asmap\n \n-4. `bitcoind -asmap/-asmap=` with no file specified, using the default asmap\n+4. `bitcoind -asmap/-asmap=` with no file specified, using the default asmap,\n+    combined with `-checkaddrman=1` as a regression test to ensure the correct\n+    order of asmap/addrman initialization on bitcoind startup, failing which\n+    the addrman tried table became corrupted and CAddrman::Check() aborted.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r706154132",
      "id" : 706154132,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNjE1NDEzMg==",
      "original_commit_id" : "916d54ac4569a9d462c40224724bf6027c349963",
      "original_line" : 18,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "test/functional/feature_asmap.py",
      "position" : null,
      "pull_request_review_id" : 751374672,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-10T13:19:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706154132",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r706167603"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706167603"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 0ab75d87b7ff1cb6ebb69ffe68342b88403230b9: This commit is confusing because it adds an addrman test to `feature_asmap.py`, which from what I can see is basically the same test that is [already in feature_addrman.py](https://github.com/bitcoin/bitcoin/blob/053a5fc7d912d597cd6dc7376b479420d1eae1c0/test/functional/feature_addrman.py#L82), with the addition of `-checkaddrman`, so isn't actually asmap specific? Later in this PR the two files get merged together, so either this new version or the existing version essentially gets deleted. Why not just add `-checkaddrman` to the existing test after the merge, rather than another commit which is essentially duplicate code.",
      "commit_id" : "b549fc53a35759876e416751c0093aa6205b6b48",
      "created_at" : "2021-09-10T13:09:31Z",
      "diff_hunk" : "@@ -98,6 +100,14 @@ def test_empty_asmap(self):\n         self.node.assert_start_raises_init_error(extra_args=['-asmap'], expected_msg=msg)\n         os.remove(self.default_asmap)\n \n+    def test_missing_peers_dat_with_addrman_checks(self):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r706167603",
      "id" : 706167603,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNjE2NzYwMw==",
      "original_commit_id" : "0ab75d87b7ff1cb6ebb69ffe68342b88403230b9",
      "original_line" : 103,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "test/functional/feature_asmap.py",
      "position" : null,
      "pull_request_review_id" : 751374672,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-10T13:19:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706167603",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : ">> Rebased and merged the addrman and asmap tests into one test file.\r\n\r\n> Why? We are actively untangling addrman and asmap functionality, so I'm not sure why it now makes sense to combine the addrman and asmap functional tests into one place. This seems like the opposite of what we should be doing. cc @jnewbery.\r\n\r\nI agree. The main benefit of modularizing our components is the ability to then test them in isolation.",
      "created_at" : "2021-09-10T13:24:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-916902316",
      "id" : 916902316,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII5842ptGs",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-10T13:24:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/916902316",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r706184008"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706184008"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This commit was earlier.\r\n\r\nThe goal was to have minimum regression tests in place before the fix, or all the refactoring, or at least as soon as possible, to reduce the chance of accidentally adding more critical bugs.\r\n\r\nI'm trying to catch up to a moving target and may slim this back down to just the first regression test.",
      "commit_id" : "b549fc53a35759876e416751c0093aa6205b6b48",
      "created_at" : "2021-09-10T13:31:27Z",
      "diff_hunk" : "@@ -98,6 +100,14 @@ def test_empty_asmap(self):\n         self.node.assert_start_raises_init_error(extra_args=['-asmap'], expected_msg=msg)\n         os.remove(self.default_asmap)\n \n+    def test_missing_peers_dat_with_addrman_checks(self):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r706184008",
      "id" : 706184008,
      "in_reply_to_id" : 706167603,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNjE4NDAwOA==",
      "original_commit_id" : "0ab75d87b7ff1cb6ebb69ffe68342b88403230b9",
      "original_line" : 103,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "test/functional/feature_asmap.py",
      "position" : null,
      "pull_request_review_id" : 751414503,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-10T13:31:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706184008",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> > > Rebased and merged the addrman and asmap tests into one test file.\r\n> \r\n> > Why? We are actively untangling addrman and asmap functionality, so I'm not sure why it now makes sense to combine the addrman and asmap functional tests into one place. This seems like the opposite of what we should be doing. cc @jnewbery.\r\n> \r\n> I agree. The main benefit of modularizing our components is the ability to then test them in isolation.\r\n\r\nThe untested interaction between addrman and asmap was the source of (one of the) most critical bugs we've seen in a good while, so it makes sense to test that interaction -- at least during the refactoring.  The two files don't have to be consolidated, but they do have a lot in common--including mocking an addrman, which could be the first step to not needing a `peers.dat` test file. It's also quicker and easier to manually run one test file than two on these refactorings, and at the moment I have to cherry-pick these tests onto each addrman/asmap PR branch.",
      "created_at" : "2021-09-10T13:34:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-916908896",
      "id" : 916908896,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII5842putg",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-10T13:49:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/916908896",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r706190957"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706190957"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I agree, and all this is removed in the commit that consolidates the tests.",
      "commit_id" : "b549fc53a35759876e416751c0093aa6205b6b48",
      "created_at" : "2021-09-10T13:40:37Z",
      "diff_hunk" : "@@ -12,7 +12,10 @@\n \n 3. `bitcoind -asmap=<relative path>`, using the unit test skeleton asmap\n \n-4. `bitcoind -asmap/-asmap=` with no file specified, using the default asmap\n+4. `bitcoind -asmap/-asmap=` with no file specified, using the default asmap,\n+    combined with `-checkaddrman=1` as a regression test to ensure the correct\n+    order of asmap/addrman initialization on bitcoind startup, failing which\n+    the addrman tried table became corrupted and CAddrman::Check() aborted.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r706190957",
      "id" : 706190957,
      "in_reply_to_id" : 706154132,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNjE5MDk1Nw==",
      "original_commit_id" : "916d54ac4569a9d462c40224724bf6027c349963",
      "original_line" : 18,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "test/functional/feature_asmap.py",
      "position" : null,
      "pull_request_review_id" : 751423973,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-10T13:40:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706190957",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "If people don't like merging the two files, but you need access to addrman mocking, one solution would be to import the `write_addrman` helper into the asmap test.",
      "created_at" : "2021-09-10T13:48:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-916918240",
      "id" : 916918240,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII5842pw_g",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-10T13:48:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/916918240",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK - I'm surprised and disconcerted that some minimal version of this wasn't packaged with #22791, which would've allowed unambiguous demonstration of the fix.",
      "created_at" : "2021-09-10T14:27:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-916947058",
      "id" : 916947058,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII5842p4By",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-10T14:27:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/916947058",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r706229663"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706229663"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done, slimmed down the doc.\r\n\r\n```diff\r\n 4. `bitcoind -asmap/-asmap=` with no file specified, using the default asmap\r\n+    combined with `-checkaddrman=1`\r\n```\r\n",
      "commit_id" : "22a17be0b9b56e0b35cfc5d1376e51b1e6dc0ed6",
      "created_at" : "2021-09-10T14:29:49Z",
      "diff_hunk" : "@@ -12,7 +12,10 @@\n \n 3. `bitcoind -asmap=<relative path>`, using the unit test skeleton asmap\n \n-4. `bitcoind -asmap/-asmap=` with no file specified, using the default asmap\n+4. `bitcoind -asmap/-asmap=` with no file specified, using the default asmap,\n+    combined with `-checkaddrman=1` as a regression test to ensure the correct\n+    order of asmap/addrman initialization on bitcoind startup, failing which\n+    the addrman tried table became corrupted and CAddrman::Check() aborted.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r706229663",
      "id" : 706229663,
      "in_reply_to_id" : 706154132,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNjIyOTY2Mw==",
      "original_commit_id" : "916d54ac4569a9d462c40224724bf6027c349963",
      "original_line" : 18,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "test/functional/feature_asmap.py",
      "position" : null,
      "pull_request_review_id" : 751476541,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-10T14:29:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706229663",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r706229906"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706229906"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Dropped",
      "commit_id" : "22a17be0b9b56e0b35cfc5d1376e51b1e6dc0ed6",
      "created_at" : "2021-09-10T14:30:04Z",
      "diff_hunk" : "@@ -98,6 +100,14 @@ def test_empty_asmap(self):\n         self.node.assert_start_raises_init_error(extra_args=['-asmap'], expected_msg=msg)\n         os.remove(self.default_asmap)\n \n+    def test_missing_peers_dat_with_addrman_checks(self):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r706229906",
      "id" : 706229906,
      "in_reply_to_id" : 706167603,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNjIyOTkwNg==",
      "original_commit_id" : "0ab75d87b7ff1cb6ebb69ffe68342b88403230b9",
      "original_line" : 103,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "test/functional/feature_asmap.py",
      "position" : null,
      "pull_request_review_id" : 751476834,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-10T14:30:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706229906",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Concept ACK - I'm surprised and disconcerted that some minimal version of this wasn't packaged with #22791, which would've allowed unambiguous demonstration of the fix.\r\n\r\nI agree. Writing a regression test is the first step to take after finding and reproducing a severe bug.\r\n\r\nSlimmed this pull down to the original two commits that focus on regression test coverage for the issue. The additional addrman test coverage can be done in a follow-up.\r\n\r\nPer the PR description:\r\n\r\nHow to reproduce the bug\r\n- `git checkout 181a1207`, build, and launch bitcoind with the `-asmap` and `-checkaddrman=1` configuration options enabled\r\n- restart bitcoind\r\n- bitcoind aborts on the second call to the addrman consistency checks in `CAddrMan::Check()`\r\n\r\nHow to test the test\r\n- `git checkout 181a1207`, build, and run `test/functional/feature_asmap.py`. Output:\r\n\r\n```\r\nAssertionError: Unexpected stderr bitcoind: ./addrman.h:739: void CAddrMan::Check() const: Assertion `false' failed.\r\n```",
      "created_at" : "2021-09-10T14:36:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-916953660",
      "id" : 916953660,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII5842p5o8",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-10T15:25:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/916953660",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r706261953"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706261953"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Obviously not a blocker, but if the file is removed after this is merged, then it would be better to not commit it in the first place and use `serialize_addrman` (or similar) from the beginning.",
      "commit_id" : "22a17be0b9b56e0b35cfc5d1376e51b1e6dc0ed6",
      "created_at" : "2021-09-10T15:10:57Z",
      "diff_hunk" : "@@ -0,0 +1,184 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020-2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test addrman/checkaddrman/asmap functionality.\"\"\"\n+\n+import os\n+import shutil\n+import struct\n+\n+from test_framework.messages import ser_uint256, hash256\n+from test_framework.p2p import MAGIC_BYTES\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+DEFAULT_ASMAP_FILENAME = \"ip_asn.map\"  # defined in src/init.cpp\n+ASMAP = \"../../src/test/data/asmap.raw\"  # path to unit test skeleton asmap\n+VERSION = \"fec61fa21a9f46f3b17bdcd660d7f4cd90b966aad3aec593c99b35f0aca15853\"\n+\n+\n+def expected_messages(filename):\n+    return [\n+        f'Opened asmap file \"{filename}\" (59 bytes) from disk',\n+        f\"Using asmap version {VERSION} for IP bucketing\",\n+    ]\n+\n+\n+def serialize_addrman(*, format=1, lowest_compatible=3):\n+    new = []\n+    tried = []\n+    INCOMPATIBILITY_BASE = 32\n+    r = MAGIC_BYTES[\"regtest\"]\n+    r += struct.pack(\"B\", format)\n+    r += struct.pack(\"B\", INCOMPATIBILITY_BASE + lowest_compatible)\n+    r += ser_uint256(1)\n+    r += struct.pack(\"i\", len(new))\n+    r += struct.pack(\"i\", len(tried))\n+    ADDRMAN_NEW_BUCKET_COUNT = 1 << 10\n+    r += struct.pack(\"i\", ADDRMAN_NEW_BUCKET_COUNT ^ (1 << 30))\n+    for _ in range(ADDRMAN_NEW_BUCKET_COUNT):\n+        r += struct.pack(\"i\", 0)\n+    checksum = hash256(r)\n+    r += checksum\n+    return r\n+\n+\n+def write_addrman(peers_dat, **kwargs):\n+    with open(peers_dat, \"wb\") as f:\n+        f.write(serialize_addrman(**kwargs))\n+\n+\n+class AddrmanAsmapTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+\n+    def set_peers_dat(self):\n+        \"\"\"Copy a peers.dat containing tried table entries into the data directory.\"\"\"\n+        peers_data = os.path.join(os.path.dirname(os.path.realpath(__file__)), \"data/peers.dat\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r706261953",
      "id" : 706261953,
      "in_reply_to_id" : 704550576,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNjI2MTk1Mw==",
      "original_commit_id" : "4cda5cf42118bcaf15ea3951d5189af8db6aa365",
      "original_line" : 59,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "test/functional/feature_addrman_asmap.py",
      "position" : null,
      "pull_request_review_id" : 751520000,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-10T15:10:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706261953",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r706272259"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706272259"
         }
      },
      "author_association" : "MEMBER",
      "body" : "+1 to approach of `serialize_addrman` function.",
      "commit_id" : "22a17be0b9b56e0b35cfc5d1376e51b1e6dc0ed6",
      "created_at" : "2021-09-10T15:24:42Z",
      "diff_hunk" : "@@ -0,0 +1,184 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020-2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test addrman/checkaddrman/asmap functionality.\"\"\"\n+\n+import os\n+import shutil\n+import struct\n+\n+from test_framework.messages import ser_uint256, hash256\n+from test_framework.p2p import MAGIC_BYTES\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+DEFAULT_ASMAP_FILENAME = \"ip_asn.map\"  # defined in src/init.cpp\n+ASMAP = \"../../src/test/data/asmap.raw\"  # path to unit test skeleton asmap\n+VERSION = \"fec61fa21a9f46f3b17bdcd660d7f4cd90b966aad3aec593c99b35f0aca15853\"\n+\n+\n+def expected_messages(filename):\n+    return [\n+        f'Opened asmap file \"{filename}\" (59 bytes) from disk',\n+        f\"Using asmap version {VERSION} for IP bucketing\",\n+    ]\n+\n+\n+def serialize_addrman(*, format=1, lowest_compatible=3):\n+    new = []\n+    tried = []\n+    INCOMPATIBILITY_BASE = 32\n+    r = MAGIC_BYTES[\"regtest\"]\n+    r += struct.pack(\"B\", format)\n+    r += struct.pack(\"B\", INCOMPATIBILITY_BASE + lowest_compatible)\n+    r += ser_uint256(1)\n+    r += struct.pack(\"i\", len(new))\n+    r += struct.pack(\"i\", len(tried))\n+    ADDRMAN_NEW_BUCKET_COUNT = 1 << 10\n+    r += struct.pack(\"i\", ADDRMAN_NEW_BUCKET_COUNT ^ (1 << 30))\n+    for _ in range(ADDRMAN_NEW_BUCKET_COUNT):\n+        r += struct.pack(\"i\", 0)\n+    checksum = hash256(r)\n+    r += checksum\n+    return r\n+\n+\n+def write_addrman(peers_dat, **kwargs):\n+    with open(peers_dat, \"wb\") as f:\n+        f.write(serialize_addrman(**kwargs))\n+\n+\n+class AddrmanAsmapTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+\n+    def set_peers_dat(self):\n+        \"\"\"Copy a peers.dat containing tried table entries into the data directory.\"\"\"\n+        peers_data = os.path.join(os.path.dirname(os.path.realpath(__file__)), \"data/peers.dat\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r706272259",
      "id" : 706272259,
      "in_reply_to_id" : 704550576,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNjI3MjI1OQ==",
      "original_commit_id" : "4cda5cf42118bcaf15ea3951d5189af8db6aa365",
      "original_line" : 59,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "test/functional/feature_addrman_asmap.py",
      "position" : null,
      "pull_request_review_id" : 751533679,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-10T15:24:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706272259",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r706283142"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706283142"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Happy to look at it as a follow-up (or leave it for someone), but this does the job and by common sense ought to have been the first step in a responsible fix (or at least part of it), rather than ignored after https://github.com/bitcoin/bitcoin/pull/22791#issuecomment-907856179 while embarking on many refactoring and changes, no matter how desirable they may have been. Foot-dragging and bikeshedding doesn't seem appropriate here compared to the gravity of the bug that is covered.",
      "commit_id" : "22a17be0b9b56e0b35cfc5d1376e51b1e6dc0ed6",
      "created_at" : "2021-09-10T15:39:27Z",
      "diff_hunk" : "@@ -0,0 +1,184 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020-2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test addrman/checkaddrman/asmap functionality.\"\"\"\n+\n+import os\n+import shutil\n+import struct\n+\n+from test_framework.messages import ser_uint256, hash256\n+from test_framework.p2p import MAGIC_BYTES\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+DEFAULT_ASMAP_FILENAME = \"ip_asn.map\"  # defined in src/init.cpp\n+ASMAP = \"../../src/test/data/asmap.raw\"  # path to unit test skeleton asmap\n+VERSION = \"fec61fa21a9f46f3b17bdcd660d7f4cd90b966aad3aec593c99b35f0aca15853\"\n+\n+\n+def expected_messages(filename):\n+    return [\n+        f'Opened asmap file \"{filename}\" (59 bytes) from disk',\n+        f\"Using asmap version {VERSION} for IP bucketing\",\n+    ]\n+\n+\n+def serialize_addrman(*, format=1, lowest_compatible=3):\n+    new = []\n+    tried = []\n+    INCOMPATIBILITY_BASE = 32\n+    r = MAGIC_BYTES[\"regtest\"]\n+    r += struct.pack(\"B\", format)\n+    r += struct.pack(\"B\", INCOMPATIBILITY_BASE + lowest_compatible)\n+    r += ser_uint256(1)\n+    r += struct.pack(\"i\", len(new))\n+    r += struct.pack(\"i\", len(tried))\n+    ADDRMAN_NEW_BUCKET_COUNT = 1 << 10\n+    r += struct.pack(\"i\", ADDRMAN_NEW_BUCKET_COUNT ^ (1 << 30))\n+    for _ in range(ADDRMAN_NEW_BUCKET_COUNT):\n+        r += struct.pack(\"i\", 0)\n+    checksum = hash256(r)\n+    r += checksum\n+    return r\n+\n+\n+def write_addrman(peers_dat, **kwargs):\n+    with open(peers_dat, \"wb\") as f:\n+        f.write(serialize_addrman(**kwargs))\n+\n+\n+class AddrmanAsmapTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+\n+    def set_peers_dat(self):\n+        \"\"\"Copy a peers.dat containing tried table entries into the data directory.\"\"\"\n+        peers_data = os.path.join(os.path.dirname(os.path.realpath(__file__)), \"data/peers.dat\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r706283142",
      "id" : 706283142,
      "in_reply_to_id" : 704550576,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNjI4MzE0Mg==",
      "original_commit_id" : "4cda5cf42118bcaf15ea3951d5189af8db6aa365",
      "original_line" : 59,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "test/functional/feature_addrman_asmap.py",
      "position" : null,
      "pull_request_review_id" : 751547894,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-10T15:39:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706283142",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r706299669"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706299669"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Happy to look at it as a follow-up (or leave it for someone)\r\n\r\nHappy to propose an alternative that uses `serialize_addrman`, if you don't want to do it here. I just think that we shouldn't be adding binary files to the git repo, especially short-lived ones, when it can be avoided. Personally I'd like to see both approaches, so that they can be compared and the best one be picked. Though, again, not a blocker. If this gets review, I am happy to merge nonetheless.\r\n\r\n> while embarking on many refactoring\r\n\r\nI am not aware of any refactoring changes that have been merged in the meantime after the bug was discovered.\r\n\r\n> gravity of the bug that is covered\r\n\r\nI agree that test coverage for that is badly needed. However, the existence of a regression test doesn't mean it should be merged without review. (At least I couldn't find any review ACKs on this pull). \r\n\r\n",
      "commit_id" : "22a17be0b9b56e0b35cfc5d1376e51b1e6dc0ed6",
      "created_at" : "2021-09-10T16:02:41Z",
      "diff_hunk" : "@@ -0,0 +1,184 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020-2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test addrman/checkaddrman/asmap functionality.\"\"\"\n+\n+import os\n+import shutil\n+import struct\n+\n+from test_framework.messages import ser_uint256, hash256\n+from test_framework.p2p import MAGIC_BYTES\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+DEFAULT_ASMAP_FILENAME = \"ip_asn.map\"  # defined in src/init.cpp\n+ASMAP = \"../../src/test/data/asmap.raw\"  # path to unit test skeleton asmap\n+VERSION = \"fec61fa21a9f46f3b17bdcd660d7f4cd90b966aad3aec593c99b35f0aca15853\"\n+\n+\n+def expected_messages(filename):\n+    return [\n+        f'Opened asmap file \"{filename}\" (59 bytes) from disk',\n+        f\"Using asmap version {VERSION} for IP bucketing\",\n+    ]\n+\n+\n+def serialize_addrman(*, format=1, lowest_compatible=3):\n+    new = []\n+    tried = []\n+    INCOMPATIBILITY_BASE = 32\n+    r = MAGIC_BYTES[\"regtest\"]\n+    r += struct.pack(\"B\", format)\n+    r += struct.pack(\"B\", INCOMPATIBILITY_BASE + lowest_compatible)\n+    r += ser_uint256(1)\n+    r += struct.pack(\"i\", len(new))\n+    r += struct.pack(\"i\", len(tried))\n+    ADDRMAN_NEW_BUCKET_COUNT = 1 << 10\n+    r += struct.pack(\"i\", ADDRMAN_NEW_BUCKET_COUNT ^ (1 << 30))\n+    for _ in range(ADDRMAN_NEW_BUCKET_COUNT):\n+        r += struct.pack(\"i\", 0)\n+    checksum = hash256(r)\n+    r += checksum\n+    return r\n+\n+\n+def write_addrman(peers_dat, **kwargs):\n+    with open(peers_dat, \"wb\") as f:\n+        f.write(serialize_addrman(**kwargs))\n+\n+\n+class AddrmanAsmapTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+\n+    def set_peers_dat(self):\n+        \"\"\"Copy a peers.dat containing tried table entries into the data directory.\"\"\"\n+        peers_data = os.path.join(os.path.dirname(os.path.realpath(__file__)), \"data/peers.dat\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r706299669",
      "id" : 706299669,
      "in_reply_to_id" : 704550576,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNjI5OTY2OQ==",
      "original_commit_id" : "4cda5cf42118bcaf15ea3951d5189af8db6aa365",
      "original_line" : 59,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "test/functional/feature_addrman_asmap.py",
      "position" : null,
      "pull_request_review_id" : 751569373,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-10T16:02:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706299669",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r706313089"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706313089"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> I am not aware of any refactoring changes that have been merged in the meantime after the bug was discovered.\r\n\r\nInstead of a straight revert, or simple reordering, #22791 was a larger than necessary diff with no accompanying tests.",
      "commit_id" : "22a17be0b9b56e0b35cfc5d1376e51b1e6dc0ed6",
      "created_at" : "2021-09-10T16:23:21Z",
      "diff_hunk" : "@@ -0,0 +1,184 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2020-2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test addrman/checkaddrman/asmap functionality.\"\"\"\n+\n+import os\n+import shutil\n+import struct\n+\n+from test_framework.messages import ser_uint256, hash256\n+from test_framework.p2p import MAGIC_BYTES\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+DEFAULT_ASMAP_FILENAME = \"ip_asn.map\"  # defined in src/init.cpp\n+ASMAP = \"../../src/test/data/asmap.raw\"  # path to unit test skeleton asmap\n+VERSION = \"fec61fa21a9f46f3b17bdcd660d7f4cd90b966aad3aec593c99b35f0aca15853\"\n+\n+\n+def expected_messages(filename):\n+    return [\n+        f'Opened asmap file \"{filename}\" (59 bytes) from disk',\n+        f\"Using asmap version {VERSION} for IP bucketing\",\n+    ]\n+\n+\n+def serialize_addrman(*, format=1, lowest_compatible=3):\n+    new = []\n+    tried = []\n+    INCOMPATIBILITY_BASE = 32\n+    r = MAGIC_BYTES[\"regtest\"]\n+    r += struct.pack(\"B\", format)\n+    r += struct.pack(\"B\", INCOMPATIBILITY_BASE + lowest_compatible)\n+    r += ser_uint256(1)\n+    r += struct.pack(\"i\", len(new))\n+    r += struct.pack(\"i\", len(tried))\n+    ADDRMAN_NEW_BUCKET_COUNT = 1 << 10\n+    r += struct.pack(\"i\", ADDRMAN_NEW_BUCKET_COUNT ^ (1 << 30))\n+    for _ in range(ADDRMAN_NEW_BUCKET_COUNT):\n+        r += struct.pack(\"i\", 0)\n+    checksum = hash256(r)\n+    r += checksum\n+    return r\n+\n+\n+def write_addrman(peers_dat, **kwargs):\n+    with open(peers_dat, \"wb\") as f:\n+        f.write(serialize_addrman(**kwargs))\n+\n+\n+class AddrmanAsmapTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+\n+    def set_peers_dat(self):\n+        \"\"\"Copy a peers.dat containing tried table entries into the data directory.\"\"\"\n+        peers_data = os.path.join(os.path.dirname(os.path.realpath(__file__)), \"data/peers.dat\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r706313089",
      "id" : 706313089,
      "in_reply_to_id" : 704550576,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNjMxMzA4OQ==",
      "original_commit_id" : "4cda5cf42118bcaf15ea3951d5189af8db6aa365",
      "original_line" : 59,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "test/functional/feature_addrman_asmap.py",
      "position" : null,
      "pull_request_review_id" : 751587226,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-10T16:23:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/706313089",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 22a17be0b9b56e0b35cfc5d1376e51b1e6dc0ed6 ([`jamesob/ackr/22831.1.jonatack.test_bugfix_addrman_trie`](https://github.com/jamesob/bitcoin/tree/ackr/22831.1.jonatack.test_bugfix_addrman_trie))\r\n\r\nChangeset looks like a minimal way to distinguish that the bug fixed in #22791 is actually fixed. I\r\n\r\n- `git checkout 181a1207; make ...; git checkout 22a17be0b9b56e0b35cfc5d1376e51b1e6dc0ed6`\r\n- `./test/functional/feature_asmap.py`, observed failure.\r\n- `git checkout master; make ...; git checkout 22a17be0b9b56e0b35cfc5d1376e51b1e6dc0ed6`\r\n- `./test/functional/feature_asmap.py`, ensured pass.\r\n",
      "created_at" : "2021-09-10T16:34:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-917042685",
      "id" : 917042685,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII5842qPX9",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-10T16:34:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/917042685",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> looks like a **minimal** way to distinguish that the bug fixed in #22791 is actually fixed\r\n\r\nShouldn't a single address in Tried in an otherwise empty addrman be the minimal way to test this? (instead of 96 addresses in new and 3 in tried)",
      "created_at" : "2021-09-10T22:07:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-917241738",
      "id" : 917241738,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII5842q_-K",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-10T22:07:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/917241738",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "tACK 22a17be0b9b56e0b35cfc5d1376e51b1e6dc0ed6\r\n\r\nTested against `master`and this PR - passing as expected\r\nTested against 181a1207ba6bd179d181f3e2534ef8676565ce72 - failing with the expected error",
      "created_at" : "2021-09-12T16:32:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-917667967",
      "id" : 917667967,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII5842soB_",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-12T16:32:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/917667967",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10667901?v=4",
         "events_url" : "https://api.github.com/users/ben-kaufman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ben-kaufman/followers",
         "following_url" : "https://api.github.com/users/ben-kaufman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ben-kaufman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ben-kaufman",
         "id" : 10667901,
         "login" : "ben-kaufman",
         "node_id" : "MDQ6VXNlcjEwNjY3OTAx",
         "organizations_url" : "https://api.github.com/users/ben-kaufman/orgs",
         "received_events_url" : "https://api.github.com/users/ben-kaufman/received_events",
         "repos_url" : "https://api.github.com/users/ben-kaufman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ben-kaufman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ben-kaufman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ben-kaufman"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've seen multiple mentions that the bug this PR is providing regression testing for is \"critical\", \"severe\" and \"(one of the) most critical bugs we've seen in a good while\". I just want to provide some perspective. When considering the severity of bugs I'm generally taking two things into account. The impact: what does it cause & how bad is it, and the scope: how many users does it effect. There are other factors that can be considered, i.e how easy is it to exploit, how often does it occur, how hard is it to (covertly) patch etc, but just considering impact and scope at a high level do a pretty good job of determining what needs to be done, and how quickly. High impact + big scope = critical / severe.\r\n\r\nThings I consider to be high impact would be remote code execution, (remote) node crashing, something that would result in a loss of user funds, BTC printing, networking splitting, DDOS etc. When it comes to scope, it's basically the larger the proportion of the existing network that the issue effects, the bigger the scope. So, a trivial to exploit, node crashing bug, that effects the last few major versions deployed on the network, is critical/severe. This is the kind of bug that once discovered, is generally patched quickly (and likely covertly), new releases are then made available, and the true impact of the issue may not become public for some time after that, maybe many years.\r\n\r\nThe addrman/asmap initialisation order bug fixed by #22791, is, in my opinion, not only low impact, but also low in scope. For most users (let alone developers running master), the impact of losing your `peers.dat` is probably more of an annoyance, than a critical issue. As for scope, this bug existed only in master, for ~2 weeks (the time between #22697 and #22791), and would only be seen when using -asmap, which is still fairly new / experimental.\r\n\r\nI think this perspective is important because it can determine how we fix bugs. In this case, the bug is already fixed, and this PR is adding regression testing (which is important!). However given the impact and scope are low, there isn't any sort of rush to get this regression testing added that we can't do it \"right\" the first time.\r\n\r\nIn this case, \"right\", in my opinion, is writing some python to generate the `peers.dat` needed for the test (potentially utilising code that already exists in the `feature_addrman.py` test), rather than adding a new binary file (which is generated in a fairly adhoc way) to the repo, just to likely delete it shortly after. Writing new code to assist in generating `peers.dat` files will also be useful in the future, as more comprehensive tests are added. This opinion seems to be shared by at least a few of the other reviewers.",
      "created_at" : "2021-09-13T03:51:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-917815184",
      "id" : 917815184,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII5842tL-Q",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-13T03:51:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/917815184",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 22a17be\r\n\r\nI mainly tested that the tests introduced here are actually effective. Checked that it would fail on the mentioned commit hash in PR description and passes on master. The mentioned testing steps were quite helpful.\r\n\r\nI've read up on the contexts of the mentioned PRs and the mentioned issue. I have no opinion on the severity of this bug, especially since it's been patched. As mentioned in the PR description, regardless of the severity, regression tests here are still a nice-to-have.\r\n\r\n@fanquake \r\n> \"In this case, \"right\", in my opinion, is writing some python to generate the peers.dat needed for the test (potentially utilising code that already exists in the feature_addrman.py test)\"\r\n\r\nThis would be quite useful, for a variety of contexts. Seems most appropriate as a follow-up or just on its own as an independent PR?",
      "created_at" : "2021-09-13T09:02:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-917985286",
      "id" : 917985286,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII5842t1gG",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-13T09:02:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/917985286",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23396902?v=4",
         "events_url" : "https://api.github.com/users/jarolrod/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jarolrod/followers",
         "following_url" : "https://api.github.com/users/jarolrod/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jarolrod/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jarolrod",
         "id" : 23396902,
         "login" : "jarolrod",
         "node_id" : "MDQ6VXNlcjIzMzk2OTAy",
         "organizations_url" : "https://api.github.com/users/jarolrod/orgs",
         "received_events_url" : "https://api.github.com/users/jarolrod/received_events",
         "repos_url" : "https://api.github.com/users/jarolrod/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jarolrod/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jarolrod/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jarolrod"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Two points:\r\nI don't think that the bug specifically corrupts the tried tables: when peers.dat is deserialized without an asmap, and only later an asmap is loaded,  both entries from new and tried will be in incorrect buckets with respect to that asmap. It just so happens that `CAddrman::Check_()` checks whether tried entries are in their appropiate bucket, while it doesn't do the same for new.\r\n\r\n>In this case, \"right\", in my opinion, is writing some python to generate the peers.dat needed for the test\r\n\r\nAn alternative approach might be to expand the test-only RPC `-addpeeraddress` with an optional arg to promote to tried (by calling `Good()` after `Add()`). That way, one could add addresses to the tried tables directly in functional tests and let bitcoind do the serialization to `peers.dat`. Though I'm not sure if this would have many applications beyond this issue, since most of the tried logic is already covered via unit tests.",
      "created_at" : "2021-09-13T09:47:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-918021820",
      "id" : 918021820,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII5842t-a8",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-13T09:47:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/918021820",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> The addrman/asmap initialisation order bug fixed by #22791, is, in my opinion, not only low impact, but also low in scope.\r\n\r\nI totally agree @fanquake's assessment. I obviously can't be totally unbiased since I introduced the initialization order bug in #22697. However, I have discovered/fixed/reviewed fixes for bugs of the type that @fanquake mentions (DDoS, remote crashing, funds loss, etc) in released code, and I can objectively say that this bug doesn't match the severity of those. If I had to characterize the severity/type of the bug, I'd say it's much closer to issues like #21584 and #22467. They're certainly bugs that need to be fixed in master before the next release, but it's totally inaccurate to claim it's \"(one of the) most critical bugs we've seen in a good while\".\r\n\r\n> Update: The bug was patched in another PR, #22791 (which also proceeded to do further refactoring)\r\n\r\n(@jonatack)\r\nhttps://github.com/bitcoin/bitcoin/pull/22831#issue-722006280\r\n\r\n> Instead of a straight revert, or simple reordering, #22791 was a larger than necessary diff with no accompanying tests.\r\n\r\n(@jamesob)\r\nhttps://github.com/bitcoin/bitcoin/pull/22831#discussion_r706313089\r\n\r\nThere seems to be some confusion around the fix in #22791. The initialization order bug that #22791 fixed was introduced in #22697. However, the conditions for that bug have existed since #16702, when `m_asmap` was introduced as a mutable public data member of `CAddrMan`. That PR changed `CAddrMan`'s initialization to be two-phase: first the object is constructed, and later on, external code mutates `CAddrMan`'s internal `m_asmap` data member. If any public methods are called on `CAddrMan` between those two phases, its internal invariants may be invalidated. Therefore, #22791 fixed not just the proximal cause of the bug (initialization order), but also the ultimate cause (bad encapsulation and partially-initalized objects) by making that member const and private. Just changing the initialization order would be a partial fix, rather than eliminating a whole class of bugs.\r\n\r\n> The suggestions in #22791 (review) were also essentially ignored.\r\n\r\n(@jonatack)\r\nhttps://github.com/bitcoin/bitcoin/pull/22791#issuecomment-917108864\r\n\r\nThis is simply untrue. I welcomed the comments here: https://github.com/bitcoin/bitcoin/pull/22791#issuecomment-905462254 and offered to incorporate them into the PR. Instead of that, this PR was opened, which was essentially a competing/conficting PR with only the partial fix. It's a bit difficult to see the history of this PR since the description has been edited 20 times in the two weeks that it's been open, but this was originally opened as a conflicting PR with #22791.\r\n\r\nHaving two conflicting PRs to fix the same issue seemed unnecessarily confusing for reviewers, so I continued to focus my efforts on #22791. I'm still a concept ACK for increasing the test coverage of asmap/addrman, but I don't see why there's a strict necessity for that to be included in the same PR as the fix, especially when multiple reviewers have raised concerns over the approach of the tests in this PR.\r\n\r\nUnfortunately, this PR has become very charged and politicized, with reasonable technical points raised by very experienced contributors (https://github.com/bitcoin/bitcoin/pull/22831#discussion_r704550576) being rejected out of hand as \"foot-dragging and bikeshedding\". I'd encourage everyone to take a deep breath and remember that we're all on the same team, and everyone is here to improve the project.\r\n\r\n> An alternative approach might be to expand the test-only RPC -addpeeraddress with an optional arg to promote to tried (by calling Good() after Add()). That way, one could add addresses to the tried tables directly in functional tests and let bitcoind do the serialization to peers.dat.\r\n\r\n@mzumsande\r\n\r\nI agree that this is the easiest way. It's a couple of lines change to update `addpeeraddress` to allow addresses to be added to the tried table, and ~10 lines to update the test to use that new functionality. I have a demonstration branch here: https://github.com/jnewbery/bitcoin/tree/2021-09-test-addrman-restart. @jonatack - feel free to take what you need from there if you think it's useful.",
      "created_at" : "2021-09-13T11:18:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-918092775",
      "id" : 918092775,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII5842uPvn",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-13T15:58:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/918092775",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK 22a17be0b9b56e0b35cfc5d1376e51b1e6dc0ed6\r\nIt tests what it needs to test. I think it's good to have a test here. Would have been good to have it part of the original fix.\r\n\r\nI agree with @fanquake's remark about the criticality of this issue being somewhat overstated. This needs to be fixed, for sure, but losing peers.dat is not the end of the world. It's not a \"everyone needs to panic\" level issue in itself.\r\n\r\nThe lesson to be learned is: review changes to bitcoind/bitcoin-qt's initialization sequence carefully. Historically it has been a big source of subtle bugs. This one was *far* from obvious. I hope the refactoring helps making initialization dependencies more clear in the long run to make it less of a mine field.\r\n\r\n> In this case, \"right\", in my opinion, is writing some python to generate the peers.dat needed for the test (potentially utilising code that already exists in the feature_addrman.py test), rather than adding a new binary file (which is generated in a fairly adhoc way) to the repo, just to likely delete it shortly after.\r\n\r\nThis would be better, but is also quite a bit of further work. I think it's somewhat unfair to expect this from @jonatack just for reporting the issue! Someone could work on this, but in the meantime it is good to have a test in place.\r\n\r\nI agree with the general sentiment that we don't want large binary files to blow up the repository. But a 12kB binary file is not enough to reject it IMO.",
      "created_at" : "2021-09-13T11:25:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-918098033",
      "id" : 918098033,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII5842uRBx",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-13T11:27:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/918098033",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "If this will be merged, it would be good to update the title first, which mentions \"bugfix\", but the code changes are adding a test.\r\n\r\nAlso the description could be shortened to not explain what the fix in anther pull did.",
      "created_at" : "2021-09-13T11:29:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-918100552",
      "id" : 918100552,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII5842uRpI",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-13T11:29:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/918100552",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "\"You say it, you own it\" is an expression that comes up time after time over the decades and why, when no test seemed forthcoming after my review feedback, I proposed one. It's as simple as that. If other people owning their suggestions leads to improvement, that's great! This is about Bitcoin; \"do no harm\" and collaborating to strengthen its robustness is the goal. I'll try these ideas, thank you :+1: ",
      "created_at" : "2021-09-14T09:18:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-918971146",
      "id" : 918971146,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII5842xmMK",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-14T09:18:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/918971146",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thank you very much to @jamesob, @rajarshimaitra, @benthecarman, @ben-kaufman, @jarolrod, @laanwj, and @vasild for the tested review ACKs.  Updated the approach and pull title/description per review feedback.",
      "created_at" : "2021-09-14T12:40:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-919111191",
      "id" : 919111191,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII5842yIYX",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-14T12:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/919111191",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r708255435"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708255435"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit in the second commit:\r\n\r\nMaybe assert on the longer string \"Addrman checks started: new 1, tried 1, total 2\" to clarify that this is triggered by the addrman check? Either in addition or as replacement for the comment below, which is not verified by the test itself.",
      "commit_id" : "4de3271b1cb65111ea4b37d8fa9791aa0cd63b81",
      "created_at" : "2021-09-14T13:13:45Z",
      "diff_hunk" : "@@ -262,6 +263,12 @@ def test_addpeeraddress(self):\n         assert_equal(node.addpeeraddress(address=\"1.2.3.4\", port=8333), {\"success\": False})\n         assert_equal(len(node.getnodeaddresses(count=0)), 1)\n \n+        self.log.debug('Test adding a second address to the tried table')\n+        assert_equal(node.addpeeraddress(address=\"1.2.3.0\", port=8333, tried=True), {\"success\": True})\n+        with node.assert_debug_log(expected_msgs=[\"new 1, tried 1, total 2\"]):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r708255435",
      "id" : 708255435,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584qNx7L",
      "original_commit_id" : "8c41132419c9ab4a70a15d967366bb6fb22b2642",
      "original_line" : 268,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "test/functional/rpc_net.py",
      "position" : null,
      "pull_request_review_id" : 753926434,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-14T13:17:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708255435",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r708257988"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708257988"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit in the last commit:\r\n\r\nMaybe the same here with \"Addrman checks started: new 2, tried 2, total 4\"",
      "commit_id" : "4de3271b1cb65111ea4b37d8fa9791aa0cd63b81",
      "created_at" : "2021-09-14T13:16:40Z",
      "diff_hunk" : "@@ -72,6 +80,15 @@ def test_default_asmap(self):\n                 self.start_node(0, [arg])\n         os.remove(self.default_asmap)\n \n+    def test_asmap_interaction_with_addrman_containing_entries(self):\n+        self.log.info('Test bitcoind -asmap with an addrman containing new and tried entries')\n+        self.fill_addrman(node_id=0)\n+        self.stop_node(0)\n+        shutil.copyfile(self.asmap_raw, self.default_asmap)\n+        self.start_node(0, [\"-asmap\", \"-checkaddrman=1\"])\n+        self.node.getnodeaddresses()  # getnodeaddresses re-runs the addrman checks",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r708257988",
      "id" : 708257988,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584qNyjE",
      "original_commit_id" : "55d1411a161d17757b61270a85626a62c3d63085",
      "original_line" : 89,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "test/functional/feature_asmap.py",
      "position" : null,
      "pull_request_review_id" : 753926434,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-14T13:17:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708257988",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r708262037"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708262037"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I held off because that aspect of the logging may change in #22872, but that pull can update the test too, so ok taking your feedback.",
      "commit_id" : "4de3271b1cb65111ea4b37d8fa9791aa0cd63b81",
      "created_at" : "2021-09-14T13:21:03Z",
      "diff_hunk" : "@@ -262,6 +263,12 @@ def test_addpeeraddress(self):\n         assert_equal(node.addpeeraddress(address=\"1.2.3.4\", port=8333), {\"success\": False})\n         assert_equal(len(node.getnodeaddresses(count=0)), 1)\n \n+        self.log.debug('Test adding a second address to the tried table')\n+        assert_equal(node.addpeeraddress(address=\"1.2.3.0\", port=8333, tried=True), {\"success\": True})\n+        with node.assert_debug_log(expected_msgs=[\"new 1, tried 1, total 2\"]):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r708262037",
      "id" : 708262037,
      "in_reply_to_id" : 708255435,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584qNziV",
      "original_commit_id" : "8c41132419c9ab4a70a15d967366bb6fb22b2642",
      "original_line" : 268,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "test/functional/rpc_net.py",
      "position" : null,
      "pull_request_review_id" : 753935728,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-14T13:21:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708262037",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r708269446"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708269446"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: there's nothing wrong with declaring and setting a local `tried` variable at the top of the function, but standard best practice would be to declare the variable where it's needed (https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-introduce / https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rnr-top), or better yet, don't even use a local variable and just test `request.params[2].isTrue()` directly below.",
      "commit_id" : "4de3271b1cb65111ea4b37d8fa9791aa0cd63b81",
      "created_at" : "2021-09-14T13:28:41Z",
      "diff_hunk" : "@@ -941,6 +942,7 @@ static RPCHelpMan addpeeraddress()\n \n     const std::string& addr_string{request.params[0].get_str()};\n     const uint16_t port{static_cast<uint16_t>(request.params[1].get_int())};\n+    const bool tried{request.params[2].isTrue()};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r708269446",
      "id" : 708269446,
      "line" : 945,
      "node_id" : "PRRC_kwDOABII584qN1WG",
      "original_commit_id" : "55d1411a161d17757b61270a85626a62c3d63085",
      "original_line" : 945,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : 23,
      "pull_request_review_id" : 753945815,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-14T13:41:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708269446",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r708273009"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708273009"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done",
      "commit_id" : "4de3271b1cb65111ea4b37d8fa9791aa0cd63b81",
      "created_at" : "2021-09-14T13:32:25Z",
      "diff_hunk" : "@@ -72,6 +80,15 @@ def test_default_asmap(self):\n                 self.start_node(0, [arg])\n         os.remove(self.default_asmap)\n \n+    def test_asmap_interaction_with_addrman_containing_entries(self):\n+        self.log.info('Test bitcoind -asmap with an addrman containing new and tried entries')\n+        self.fill_addrman(node_id=0)\n+        self.stop_node(0)\n+        shutil.copyfile(self.asmap_raw, self.default_asmap)\n+        self.start_node(0, [\"-asmap\", \"-checkaddrman=1\"])\n+        self.node.getnodeaddresses()  # getnodeaddresses re-runs the addrman checks",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r708273009",
      "id" : 708273009,
      "in_reply_to_id" : 708257988,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584qN2Nx",
      "original_commit_id" : "55d1411a161d17757b61270a85626a62c3d63085",
      "original_line" : 89,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "test/functional/feature_asmap.py",
      "position" : null,
      "pull_request_review_id" : 753950763,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-14T13:32:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708273009",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r708273165"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708273165"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done",
      "commit_id" : "4de3271b1cb65111ea4b37d8fa9791aa0cd63b81",
      "created_at" : "2021-09-14T13:32:33Z",
      "diff_hunk" : "@@ -262,6 +263,12 @@ def test_addpeeraddress(self):\n         assert_equal(node.addpeeraddress(address=\"1.2.3.4\", port=8333), {\"success\": False})\n         assert_equal(len(node.getnodeaddresses(count=0)), 1)\n \n+        self.log.debug('Test adding a second address to the tried table')\n+        assert_equal(node.addpeeraddress(address=\"1.2.3.0\", port=8333, tried=True), {\"success\": True})\n+        with node.assert_debug_log(expected_msgs=[\"new 1, tried 1, total 2\"]):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r708273165",
      "id" : 708273165,
      "in_reply_to_id" : 708255435,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584qN2QN",
      "original_commit_id" : "8c41132419c9ab4a70a15d967366bb6fb22b2642",
      "original_line" : 268,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "test/functional/rpc_net.py",
      "position" : null,
      "pull_request_review_id" : 753950958,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-14T13:32:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708273165",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r708277493"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708277493"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Note that the addresses will get added to the new/tried table according to the asmap that was loaded in the previous subtest, which is currently `test_default_asmap()`. If the ordering of the tests changes, then the asmap used for the previous test may be different from this, and the addresses wouldn't necessarily be rebucketed in the same locations.",
      "commit_id" : "4de3271b1cb65111ea4b37d8fa9791aa0cd63b81",
      "created_at" : "2021-09-14T13:37:00Z",
      "diff_hunk" : "@@ -72,6 +80,15 @@ def test_default_asmap(self):\n                 self.start_node(0, [arg])\n         os.remove(self.default_asmap)\n \n+    def test_asmap_interaction_with_addrman_containing_entries(self):\n+        self.log.info('Test bitcoind -asmap with an addrman containing new and tried entries')\n+        self.fill_addrman(node_id=0)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r708277493",
      "id" : 708277493,
      "line" : 85,
      "node_id" : "PRRC_kwDOABII584qN3T1",
      "original_commit_id" : "55d1411a161d17757b61270a85626a62c3d63085",
      "original_line" : 85,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "test/functional/feature_asmap.py",
      "position" : 33,
      "pull_request_review_id" : 753945815,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-14T13:38:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708277493",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r708284288"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708284288"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good point. Do you think this would be worthwhile?\r\n```diff\r\n     def test_asmap_interaction_with_addrman_containing_entries(self):\r\n         self.log.info(\"Test bitcoind -asmap with an addrman containing new and tried entries\")\r\n-        self.fill_addrman(node_id=0)\r\n         self.stop_node(0)\r\n         shutil.copyfile(self.asmap_raw, self.default_asmap)\r\n         self.start_node(0, [\"-asmap\", \"-checkaddrman=1\"])\r\n+        self.fill_addrman(node_id=0)\r\n+        self.restart_node(0, [\"-asmap\", \"-checkaddrman=1\"])\r\n         with self.node.assert_debug_log(expected_msgs=[\"Addrman checks started: new 2, tried 2, total 4\"]):\r\n             self.node.getnodeaddresses()  # getnodeaddresses re-runs the addrman checks\r\n```\r\n",
      "commit_id" : "d58681743a3ea99814c2c77ad8b7a4ea6ca3e14b",
      "created_at" : "2021-09-14T13:43:59Z",
      "diff_hunk" : "@@ -72,6 +80,15 @@ def test_default_asmap(self):\n                 self.start_node(0, [arg])\n         os.remove(self.default_asmap)\n \n+    def test_asmap_interaction_with_addrman_containing_entries(self):\n+        self.log.info('Test bitcoind -asmap with an addrman containing new and tried entries')\n+        self.fill_addrman(node_id=0)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r708284288",
      "id" : 708284288,
      "in_reply_to_id" : 708277493,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584qN4-A",
      "original_commit_id" : "55d1411a161d17757b61270a85626a62c3d63085",
      "original_line" : 85,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "test/functional/feature_asmap.py",
      "position" : null,
      "pull_request_review_id" : 753966429,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-14T14:25:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708284288",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r708289804"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708289804"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That's true. It's subjective, but giving each of the params a name together in one place seems to make the code easier to understand in this case.",
      "commit_id" : "4de3271b1cb65111ea4b37d8fa9791aa0cd63b81",
      "created_at" : "2021-09-14T13:49:30Z",
      "diff_hunk" : "@@ -941,6 +942,7 @@ static RPCHelpMan addpeeraddress()\n \n     const std::string& addr_string{request.params[0].get_str()};\n     const uint16_t port{static_cast<uint16_t>(request.params[1].get_int())};\n+    const bool tried{request.params[2].isTrue()};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r708289804",
      "id" : 708289804,
      "in_reply_to_id" : 708269446,
      "line" : 945,
      "node_id" : "PRRC_kwDOABII584qN6UM",
      "original_commit_id" : "55d1411a161d17757b61270a85626a62c3d63085",
      "original_line" : 945,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : 23,
      "pull_request_review_id" : 753973898,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-14T13:49:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708289804",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r708302639"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708302639"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm mildly worried this assert could be racy. Saw it fail once with 2 != 1 today. At the same time, it would be nice to assert on something in addition to the logging.",
      "commit_id" : "d58681743a3ea99814c2c77ad8b7a4ea6ca3e14b",
      "created_at" : "2021-09-14T14:02:11Z",
      "diff_hunk" : "@@ -262,6 +263,12 @@ def test_addpeeraddress(self):\n         assert_equal(node.addpeeraddress(address=\"1.2.3.4\", port=8333), {\"success\": False})\n         assert_equal(len(node.getnodeaddresses(count=0)), 1)\n \n+        self.log.debug(\"Test adding a second address to the tried table\")\n+        assert_equal(node.addpeeraddress(address=\"1.2.3.0\", port=8333, tried=True), {\"success\": True})\n+        with node.assert_debug_log(expected_msgs=[\"Addrman checks started: new 1, tried 1, total 2\"]):\n+            addrs = node.getnodeaddresses(count=0)  # getnodeaddresses re-runs the addrman checks\n+            assert_equal(len(addrs), 2)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r708302639",
      "id" : 708302639,
      "line" : 270,
      "node_id" : "PRRC_kwDOABII584qN9cv",
      "original_commit_id" : "4de3271b1cb65111ea4b37d8fa9791aa0cd63b81",
      "original_line" : 270,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "test/functional/rpc_net.py",
      "position" : 16,
      "pull_request_review_id" : 753991370,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-14T14:04:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708302639",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r708331770"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708331770"
         }
      },
      "author_association" : "MEMBER",
      "body" : "updated",
      "commit_id" : "d58681743a3ea99814c2c77ad8b7a4ea6ca3e14b",
      "created_at" : "2021-09-14T14:30:38Z",
      "diff_hunk" : "@@ -72,6 +80,15 @@ def test_default_asmap(self):\n                 self.start_node(0, [arg])\n         os.remove(self.default_asmap)\n \n+    def test_asmap_interaction_with_addrman_containing_entries(self):\n+        self.log.info('Test bitcoind -asmap with an addrman containing new and tried entries')\n+        self.fill_addrman(node_id=0)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r708331770",
      "id" : 708331770,
      "in_reply_to_id" : 708277493,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584qOEj6",
      "original_commit_id" : "55d1411a161d17757b61270a85626a62c3d63085",
      "original_line" : 85,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "test/functional/feature_asmap.py",
      "position" : null,
      "pull_request_review_id" : 754031338,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-14T14:30:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708331770",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r708343343"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708343343"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sure. It's a style nit. Feel free to ignore.",
      "commit_id" : "d58681743a3ea99814c2c77ad8b7a4ea6ca3e14b",
      "created_at" : "2021-09-14T14:42:17Z",
      "diff_hunk" : "@@ -941,6 +942,7 @@ static RPCHelpMan addpeeraddress()\n \n     const std::string& addr_string{request.params[0].get_str()};\n     const uint16_t port{static_cast<uint16_t>(request.params[1].get_int())};\n+    const bool tried{request.params[2].isTrue()};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r708343343",
      "id" : 708343343,
      "in_reply_to_id" : 708269446,
      "line" : 945,
      "node_id" : "PRRC_kwDOABII584qOHYv",
      "original_commit_id" : "55d1411a161d17757b61270a85626a62c3d63085",
      "original_line" : 945,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : 23,
      "pull_request_review_id" : 754046944,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-14T14:42:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708343343",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r708344003"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708344003"
         }
      },
      "author_association" : "MEMBER",
      "body" : ":+1: that would make the subtests independent",
      "commit_id" : "d58681743a3ea99814c2c77ad8b7a4ea6ca3e14b",
      "created_at" : "2021-09-14T14:42:59Z",
      "diff_hunk" : "@@ -72,6 +80,15 @@ def test_default_asmap(self):\n                 self.start_node(0, [arg])\n         os.remove(self.default_asmap)\n \n+    def test_asmap_interaction_with_addrman_containing_entries(self):\n+        self.log.info('Test bitcoind -asmap with an addrman containing new and tried entries')\n+        self.fill_addrman(node_id=0)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r708344003",
      "id" : 708344003,
      "in_reply_to_id" : 708277493,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584qOHjD",
      "original_commit_id" : "55d1411a161d17757b61270a85626a62c3d63085",
      "original_line" : 85,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "test/functional/feature_asmap.py",
      "position" : null,
      "pull_request_review_id" : 754047885,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-14T14:43:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708344003",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r708352287"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708352287"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`1.2.3.0` is the same /16 as `1.2.3.4`, and when using `addpeeraddress()`, the source address is set to the destination address. That means that `1.2.3.0` will be placed in the same new bucket as `1.2.3.4`, and has a 1/64 chance of the bucket position colliding (depending on what addrman's nKey has been set to). If that happens, then `1.2.3.0` won't be added to addrman.\r\n\r\nYou can reduce the chance of a collision by using an address from a different /16.",
      "commit_id" : "d58681743a3ea99814c2c77ad8b7a4ea6ca3e14b",
      "created_at" : "2021-09-14T14:51:16Z",
      "diff_hunk" : "@@ -262,6 +263,12 @@ def test_addpeeraddress(self):\n         assert_equal(node.addpeeraddress(address=\"1.2.3.4\", port=8333), {\"success\": False})\n         assert_equal(len(node.getnodeaddresses(count=0)), 1)\n \n+        self.log.debug(\"Test adding a second address to the tried table\")\n+        assert_equal(node.addpeeraddress(address=\"1.2.3.0\", port=8333, tried=True), {\"success\": True})\n+        with node.assert_debug_log(expected_msgs=[\"Addrman checks started: new 1, tried 1, total 2\"]):\n+            addrs = node.getnodeaddresses(count=0)  # getnodeaddresses re-runs the addrman checks\n+            assert_equal(len(addrs), 2)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r708352287",
      "id" : 708352287,
      "in_reply_to_id" : 708302639,
      "line" : 270,
      "node_id" : "PRRC_kwDOABII584qOJkf",
      "original_commit_id" : "4de3271b1cb65111ea4b37d8fa9791aa0cd63b81",
      "original_line" : 270,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "test/functional/rpc_net.py",
      "position" : 16,
      "pull_request_review_id" : 754058779,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-14T14:51:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708352287",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r708355795"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708355795"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Excellent, thank you! Updating.",
      "commit_id" : "d58681743a3ea99814c2c77ad8b7a4ea6ca3e14b",
      "created_at" : "2021-09-14T14:54:47Z",
      "diff_hunk" : "@@ -262,6 +263,12 @@ def test_addpeeraddress(self):\n         assert_equal(node.addpeeraddress(address=\"1.2.3.4\", port=8333), {\"success\": False})\n         assert_equal(len(node.getnodeaddresses(count=0)), 1)\n \n+        self.log.debug(\"Test adding a second address to the tried table\")\n+        assert_equal(node.addpeeraddress(address=\"1.2.3.0\", port=8333, tried=True), {\"success\": True})\n+        with node.assert_debug_log(expected_msgs=[\"Addrman checks started: new 1, tried 1, total 2\"]):\n+            addrs = node.getnodeaddresses(count=0)  # getnodeaddresses re-runs the addrman checks\n+            assert_equal(len(addrs), 2)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r708355795",
      "id" : 708355795,
      "in_reply_to_id" : 708302639,
      "line" : 270,
      "node_id" : "PRRC_kwDOABII584qOKbT",
      "original_commit_id" : "4de3271b1cb65111ea4b37d8fa9791aa0cd63b81",
      "original_line" : 270,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "test/functional/rpc_net.py",
      "position" : 16,
      "pull_request_review_id" : 754063504,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-14T14:54:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708355795",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r708739832"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708739832"
         }
      },
      "author_association" : "MEMBER",
      "body" : "just a suggestion, the first part of the comment doesn't add much\r\n\r\n```suggestion\r\n                // Attempt to move the address to the \"tried\" table.\r\n```",
      "commit_id" : "d58681743a3ea99814c2c77ad8b7a4ea6ca3e14b",
      "created_at" : "2021-09-14T23:58:53Z",
      "diff_hunk" : "@@ -951,7 +953,13 @@ static RPCHelpMan addpeeraddress()\n         address.nTime = GetAdjustedTime();\n         // The source address is set equal to the address. This is equivalent to the peer\n         // announcing itself.\n-        if (node.addrman->Add({address}, address)) success = true;\n+        if (node.addrman->Add({address}, address)) {\n+            success = true;\n+            if (tried) {\n+                // Mark entry as good and possibly move it to the \"tried\" addresses table.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r708739832",
      "id" : 708739832,
      "line" : 959,
      "node_id" : "PRRC_kwDOABII584qPoL4",
      "original_commit_id" : "d58681743a3ea99814c2c77ad8b7a4ea6ca3e14b",
      "original_line" : 959,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : 35,
      "pull_request_review_id" : 754550579,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-15T00:18:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708739832",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r708744420"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708744420"
         }
      },
      "author_association" : "MEMBER",
      "body" : "could be nice to pull out the `(with a different /16)` from the log & add a comment with the reasoning of why (so it maps to a different bucket) as described in https://github.com/bitcoin/bitcoin/pull/22831#discussion_r708352287",
      "commit_id" : "d58681743a3ea99814c2c77ad8b7a4ea6ca3e14b",
      "created_at" : "2021-09-15T00:12:48Z",
      "diff_hunk" : "@@ -262,6 +263,12 @@ def test_addpeeraddress(self):\n         assert_equal(node.addpeeraddress(address=\"1.2.3.4\", port=8333), {\"success\": False})\n         assert_equal(len(node.getnodeaddresses(count=0)), 1)\n \n+        self.log.debug(\"Test adding a second address (with a different /16) to the tried table\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r708744420",
      "id" : 708744420,
      "line" : 266,
      "node_id" : "PRRC_kwDOABII584qPpTk",
      "original_commit_id" : "d58681743a3ea99814c2c77ad8b7a4ea6ca3e14b",
      "original_line" : 266,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "test/functional/rpc_net.py",
      "position" : 12,
      "pull_request_review_id" : 754550579,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-15T00:18:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/708744420",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Tested ACK d58681743a3ea99814c2c77ad8b7a4ea6ca3e14b\r\n\r\nI verified that `peers.dat`, which is now created at runtime, leads to `Check()` errors in 181a1207ba6bd179d181f3e2534ef8676565ce72 with the toy asmap `ip_asn.map`. ",
      "created_at" : "2021-09-15T12:34:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-919978968",
      "id" : 919978968,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII58421cPY",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-15T12:34:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/919978968",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r709144653"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709144653"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this may still fail with a probability of 1/2^16 = 1/65536 since there could still be bucket/position collisions.",
      "commit_id" : "d58681743a3ea99814c2c77ad8b7a4ea6ca3e14b",
      "created_at" : "2021-09-15T12:40:32Z",
      "diff_hunk" : "@@ -262,6 +263,12 @@ def test_addpeeraddress(self):\n         assert_equal(node.addpeeraddress(address=\"1.2.3.4\", port=8333), {\"success\": False})\n         assert_equal(len(node.getnodeaddresses(count=0)), 1)\n \n+        self.log.debug(\"Test adding a second address to the tried table\")\n+        assert_equal(node.addpeeraddress(address=\"1.2.3.0\", port=8333, tried=True), {\"success\": True})\n+        with node.assert_debug_log(expected_msgs=[\"Addrman checks started: new 1, tried 1, total 2\"]):\n+            addrs = node.getnodeaddresses(count=0)  # getnodeaddresses re-runs the addrman checks\n+            assert_equal(len(addrs), 2)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r709144653",
      "id" : 709144653,
      "in_reply_to_id" : 708302639,
      "line" : 270,
      "node_id" : "PRRC_kwDOABII584qRLBN",
      "original_commit_id" : "4de3271b1cb65111ea4b37d8fa9791aa0cd63b81",
      "original_line" : 270,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "test/functional/rpc_net.py",
      "position" : 16,
      "pull_request_review_id" : 755063184,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-15T12:40:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709144653",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r709171663"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709171663"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sounds good. WDYT:\r\n```diff\r\ndiff --git a/src/rpc/net.cpp b/src/rpc/net.cpp\r\nindex f7b6a2a333..227eec722f 100644\r\n--- a/src/rpc/net.cpp\r\n+++ b/src/rpc/net.cpp\r\n@@ -956,7 +956,7 @@ static RPCHelpMan addpeeraddress()\r\n         if (node.addrman->Add({address}, address)) {\r\n             success = true;\r\n             if (tried) {\r\n-                // Mark entry as good and possibly move it to the \"tried\" addresses table.\r\n+                // Attempt to move the address to the tried addresses table.\r\n                 node.addrman->Good(address);\r\n             }\r\n         }\r\ndiff --git a/test/functional/rpc_net.py b/test/functional/rpc_net.py\r\nindex e2dfa3ea23..1b468aec22 100755\r\n--- a/test/functional/rpc_net.py\r\n+++ b/test/functional/rpc_net.py\r\n@@ -254,16 +254,24 @@ class NetTest(BitcoinTestFramework):\r\n \r\n         self.log.debug(\"Test that adding a valid address succeeds\")\r\n         assert_equal(node.addpeeraddress(address=\"1.2.3.4\", port=8333), {\"success\": True})\r\n-        addrs = node.getnodeaddresses(count=0)\r\n-        assert_equal(len(addrs), 1)\r\n-        assert_equal(addrs[0][\"address\"], \"1.2.3.4\")\r\n-        assert_equal(addrs[0][\"port\"], 8333)\r\n+        with node.assert_debug_log(expected_msgs=[\"Addrman checks started: new 1, tried 0, total 1\"]):\r\n+            addrs = node.getnodeaddresses(count=0)\r\n+            assert_equal(len(addrs), 1)\r\n+            assert_equal(addrs[0][\"address\"], \"1.2.3.4\")\r\n+            assert_equal(addrs[0][\"port\"], 8333)\r\n \r\n         self.log.debug(\"Test that adding the same address again when already present fails\")\r\n         assert_equal(node.addpeeraddress(address=\"1.2.3.4\", port=8333), {\"success\": False})\r\n         assert_equal(len(node.getnodeaddresses(count=0)), 1)\r\n \r\n-        self.log.debug(\"Test adding a second address (with a different /16) to the tried table\")\r\n+        # RPC addpeeraddress sets the source address equal to the destination address.\r\n+        # If addresses with the same /16 are passed to it, they will be placed in the\r\n+        # same new bucket and have a 1/64 chance of the bucket positions colliding\r\n+        # (depending on the value of nKey in the addrman), in which case the new\r\n+        # address won't be added to the addrman.  Therefore, reduce the chance of a\r\n+        # collision by using an address from a different /16.  There may still remain\r\n+        # a 1/2^16 = 1/65536 probability of bucket/position collisions.\r\n+        self.log.debug(\"Test adding a second address to the tried table\")\r\n         assert_equal(node.addpeeraddress(address=\"2.0.0.0\", port=8333, tried=True), {\"success\": True})\r\n         with node.assert_debug_log(expected_msgs=[\"Addrman checks started: new 1, tried 1, total 2\"]):\r\n             addrs = node.getnodeaddresses(count=0)  # getnodeaddresses re-runs the addrman checks\r\n```\r\n",
      "commit_id" : "d58681743a3ea99814c2c77ad8b7a4ea6ca3e14b",
      "created_at" : "2021-09-15T13:12:01Z",
      "diff_hunk" : "@@ -262,6 +263,12 @@ def test_addpeeraddress(self):\n         assert_equal(node.addpeeraddress(address=\"1.2.3.4\", port=8333), {\"success\": False})\n         assert_equal(len(node.getnodeaddresses(count=0)), 1)\n \n+        self.log.debug(\"Test adding a second address to the tried table\")\n+        assert_equal(node.addpeeraddress(address=\"1.2.3.0\", port=8333, tried=True), {\"success\": True})\n+        with node.assert_debug_log(expected_msgs=[\"Addrman checks started: new 1, tried 1, total 2\"]):\n+            addrs = node.getnodeaddresses(count=0)  # getnodeaddresses re-runs the addrman checks\n+            assert_equal(len(addrs), 2)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r709171663",
      "id" : 709171663,
      "in_reply_to_id" : 708302639,
      "line" : 270,
      "node_id" : "PRRC_kwDOABII584qRRnP",
      "original_commit_id" : "4de3271b1cb65111ea4b37d8fa9791aa0cd63b81",
      "original_line" : 270,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "test/functional/rpc_net.py",
      "position" : 16,
      "pull_request_review_id" : 755099466,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-15T13:12:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709171663",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r709174093"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709174093"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oops, meant to post it here. SGTM, what do you think: https://github.com/bitcoin/bitcoin/pull/22831#discussion_r709171663",
      "commit_id" : "d58681743a3ea99814c2c77ad8b7a4ea6ca3e14b",
      "created_at" : "2021-09-15T13:14:43Z",
      "diff_hunk" : "@@ -262,6 +263,12 @@ def test_addpeeraddress(self):\n         assert_equal(node.addpeeraddress(address=\"1.2.3.4\", port=8333), {\"success\": False})\n         assert_equal(len(node.getnodeaddresses(count=0)), 1)\n \n+        self.log.debug(\"Test adding a second address (with a different /16) to the tried table\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r709174093",
      "id" : 709174093,
      "in_reply_to_id" : 708744420,
      "line" : 266,
      "node_id" : "PRRC_kwDOABII584qRSNN",
      "original_commit_id" : "d58681743a3ea99814c2c77ad8b7a4ea6ca3e14b",
      "original_line" : 266,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "test/functional/rpc_net.py",
      "position" : 12,
      "pull_request_review_id" : 755102800,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-15T13:14:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709174093",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r709174486"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709174486"
         }
      },
      "author_association" : "MEMBER",
      "body" : "thanks for the feedback, done",
      "commit_id" : "d58681743a3ea99814c2c77ad8b7a4ea6ca3e14b",
      "created_at" : "2021-09-15T13:15:07Z",
      "diff_hunk" : "@@ -951,7 +953,13 @@ static RPCHelpMan addpeeraddress()\n         address.nTime = GetAdjustedTime();\n         // The source address is set equal to the address. This is equivalent to the peer\n         // announcing itself.\n-        if (node.addrman->Add({address}, address)) success = true;\n+        if (node.addrman->Add({address}, address)) {\n+            success = true;\n+            if (tried) {\n+                // Mark entry as good and possibly move it to the \"tried\" addresses table.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r709174486",
      "id" : 709174486,
      "in_reply_to_id" : 708739832,
      "line" : 959,
      "node_id" : "PRRC_kwDOABII584qRSTW",
      "original_commit_id" : "d58681743a3ea99814c2c77ad8b7a4ea6ca3e14b",
      "original_line" : 959,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : 35,
      "pull_request_review_id" : 755103316,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-15T13:15:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709174486",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r709175866"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709175866"
         }
      },
      "author_association" : "MEMBER",
      "body" : "(an alternative could be to merge the first valid address test with the \"tried\" test) ",
      "commit_id" : "d58681743a3ea99814c2c77ad8b7a4ea6ca3e14b",
      "created_at" : "2021-09-15T13:16:39Z",
      "diff_hunk" : "@@ -262,6 +263,12 @@ def test_addpeeraddress(self):\n         assert_equal(node.addpeeraddress(address=\"1.2.3.4\", port=8333), {\"success\": False})\n         assert_equal(len(node.getnodeaddresses(count=0)), 1)\n \n+        self.log.debug(\"Test adding a second address to the tried table\")\n+        assert_equal(node.addpeeraddress(address=\"1.2.3.0\", port=8333, tried=True), {\"success\": True})\n+        with node.assert_debug_log(expected_msgs=[\"Addrman checks started: new 1, tried 1, total 2\"]):\n+            addrs = node.getnodeaddresses(count=0)  # getnodeaddresses re-runs the addrman checks\n+            assert_equal(len(addrs), 2)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r709175866",
      "id" : 709175866,
      "in_reply_to_id" : 708302639,
      "line" : 270,
      "node_id" : "PRRC_kwDOABII584qRSo6",
      "original_commit_id" : "4de3271b1cb65111ea4b37d8fa9791aa0cd63b81",
      "original_line" : 270,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "test/functional/rpc_net.py",
      "position" : 16,
      "pull_request_review_id" : 755105199,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-15T13:16:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709175866",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r709175988"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709175988"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "or maybe first add an addr to tried, and the next one to new - then new collisions wouldn't be an issue.",
      "commit_id" : "d58681743a3ea99814c2c77ad8b7a4ea6ca3e14b",
      "created_at" : "2021-09-15T13:16:47Z",
      "diff_hunk" : "@@ -262,6 +263,12 @@ def test_addpeeraddress(self):\n         assert_equal(node.addpeeraddress(address=\"1.2.3.4\", port=8333), {\"success\": False})\n         assert_equal(len(node.getnodeaddresses(count=0)), 1)\n \n+        self.log.debug(\"Test adding a second address to the tried table\")\n+        assert_equal(node.addpeeraddress(address=\"1.2.3.0\", port=8333, tried=True), {\"success\": True})\n+        with node.assert_debug_log(expected_msgs=[\"Addrman checks started: new 1, tried 1, total 2\"]):\n+            addrs = node.getnodeaddresses(count=0)  # getnodeaddresses re-runs the addrman checks\n+            assert_equal(len(addrs), 2)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r709175988",
      "id" : 709175988,
      "in_reply_to_id" : 708302639,
      "line" : 270,
      "node_id" : "PRRC_kwDOABII584qRSq0",
      "original_commit_id" : "4de3271b1cb65111ea4b37d8fa9791aa0cd63b81",
      "original_line" : 270,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "test/functional/rpc_net.py",
      "position" : 16,
      "pull_request_review_id" : 755105376,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-15T13:16:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709175988",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r709183857"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709183857"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@mzumsande done",
      "commit_id" : "d58681743a3ea99814c2c77ad8b7a4ea6ca3e14b",
      "created_at" : "2021-09-15T13:25:19Z",
      "diff_hunk" : "@@ -262,6 +263,12 @@ def test_addpeeraddress(self):\n         assert_equal(node.addpeeraddress(address=\"1.2.3.4\", port=8333), {\"success\": False})\n         assert_equal(len(node.getnodeaddresses(count=0)), 1)\n \n+        self.log.debug(\"Test adding a second address to the tried table\")\n+        assert_equal(node.addpeeraddress(address=\"1.2.3.0\", port=8333, tried=True), {\"success\": True})\n+        with node.assert_debug_log(expected_msgs=[\"Addrman checks started: new 1, tried 1, total 2\"]):\n+            addrs = node.getnodeaddresses(count=0)  # getnodeaddresses re-runs the addrman checks\n+            assert_equal(len(addrs), 2)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r709183857",
      "id" : 709183857,
      "in_reply_to_id" : 708302639,
      "line" : 270,
      "node_id" : "PRRC_kwDOABII584qRUlx",
      "original_commit_id" : "4de3271b1cb65111ea4b37d8fa9791aa0cd63b81",
      "original_line" : 270,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "test/functional/rpc_net.py",
      "position" : 16,
      "pull_request_review_id" : 755116035,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-15T13:25:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709183857",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r709214655"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709214655"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hmm, unfortunately this issue also seems to be possible in the regression test commit where 4 addrs are added. ",
      "commit_id" : "d58681743a3ea99814c2c77ad8b7a4ea6ca3e14b",
      "created_at" : "2021-09-15T13:56:56Z",
      "diff_hunk" : "@@ -262,6 +263,12 @@ def test_addpeeraddress(self):\n         assert_equal(node.addpeeraddress(address=\"1.2.3.4\", port=8333), {\"success\": False})\n         assert_equal(len(node.getnodeaddresses(count=0)), 1)\n \n+        self.log.debug(\"Test adding a second address to the tried table\")\n+        assert_equal(node.addpeeraddress(address=\"1.2.3.0\", port=8333, tried=True), {\"success\": True})\n+        with node.assert_debug_log(expected_msgs=[\"Addrman checks started: new 1, tried 1, total 2\"]):\n+            addrs = node.getnodeaddresses(count=0)  # getnodeaddresses re-runs the addrman checks\n+            assert_equal(len(addrs), 2)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r709214655",
      "id" : 709214655,
      "in_reply_to_id" : 708302639,
      "line" : 270,
      "node_id" : "PRRC_kwDOABII584qRcG_",
      "original_commit_id" : "4de3271b1cb65111ea4b37d8fa9791aa0cd63b81",
      "original_line" : 270,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "test/functional/rpc_net.py",
      "position" : 16,
      "pull_request_review_id" : 755157596,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-15T13:57:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709214655",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r709256205"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709256205"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good catch -- inversed the order.",
      "commit_id" : "cdaab90662a54e331de0e49a89596bbb94a8ac45",
      "created_at" : "2021-09-15T14:39:21Z",
      "diff_hunk" : "@@ -262,6 +263,12 @@ def test_addpeeraddress(self):\n         assert_equal(node.addpeeraddress(address=\"1.2.3.4\", port=8333), {\"success\": False})\n         assert_equal(len(node.getnodeaddresses(count=0)), 1)\n \n+        self.log.debug(\"Test adding a second address to the tried table\")\n+        assert_equal(node.addpeeraddress(address=\"1.2.3.0\", port=8333, tried=True), {\"success\": True})\n+        with node.assert_debug_log(expected_msgs=[\"Addrman checks started: new 1, tried 1, total 2\"]):\n+            addrs = node.getnodeaddresses(count=0)  # getnodeaddresses re-runs the addrman checks\n+            assert_equal(len(addrs), 2)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r709256205",
      "id" : 709256205,
      "in_reply_to_id" : 708302639,
      "line" : 280,
      "node_id" : "PRRC_kwDOABII584qRmQN",
      "original_commit_id" : "4de3271b1cb65111ea4b37d8fa9791aa0cd63b81",
      "original_line" : 280,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "test/functional/rpc_net.py",
      "position" : 47,
      "pull_request_review_id" : 755215075,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-15T14:39:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709256205",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Very good suggestions (thanks!) Updated per `git diff d586817 cdaab90` along with further test improvements.\r\n\r\n<details><summary>diff</summary><p>\r\n\r\n```diff\r\ndiff --git a/src/rpc/net.cpp b/src/rpc/net.cpp\r\nindex f7b6a2a333..227eec722f 100644\r\n--- a/src/rpc/net.cpp\r\n+++ b/src/rpc/net.cpp\r\n@@ -956,7 +956,7 @@ static RPCHelpMan addpeeraddress()\r\n         if (node.addrman->Add({address}, address)) {\r\n             success = true;\r\n             if (tried) {\r\n-                // Mark entry as good and possibly move it to the \"tried\" addresses table.\r\n+                // Attempt to move the address to the tried addresses table.\r\n                 node.addrman->Good(address);\r\n             }\r\n         }\r\ndiff --git a/test/functional/feature_asmap.py b/test/functional/feature_asmap.py\r\nindex 46d55077d7..2dc1e3a7cb 100755\r\n--- a/test/functional/feature_asmap.py\r\n+++ b/test/functional/feature_asmap.py\r\n@@ -14,7 +14,7 @@ Verify node behaviour and debug log when launching bitcoind in these cases:\r\n \r\n 4. `bitcoind -asmap/-asmap=` with no file specified, using the default asmap\r\n \r\n-5. `bitcoind -asmap` with an addrman containing new and tried entries\r\n+5. `bitcoind -asmap` restart with an addrman containing new and tried entries\r\n \r\n 6. `bitcoind -asmap` with no file specified and a missing default asmap file\r\n \r\n@@ -42,8 +42,8 @@ class AsmapTest(BitcoinTestFramework):\r\n         self.extra_args = [[\"-checkaddrman=1\"]]  # Do addrman checks on all operations.\r\n \r\n     def fill_addrman(self, node_id):\r\n-        \"\"\"Add 2 new addresses and 2 tried addresses to the addrman.\"\"\"\r\n-        for addr, tried in [[0, False], [1, False], [2, True], [3, True]]:\r\n+        \"\"\"Add 2 tried addresses to the addrman, followed by 2 new addresses.\"\"\"\r\n+        for addr, tried in [[0, True], [1, True], [2, False], [3, False]]:\r\n             self.nodes[node_id].addpeeraddress(address=f\"101.{addr}.0.0\", tried=tried, port=8333)\r\n \r\n     def test_without_asmap_arg(self):\r\n@@ -81,13 +81,18 @@ class AsmapTest(BitcoinTestFramework):\r\n         os.remove(self.default_asmap)\r\n \r\n     def test_asmap_interaction_with_addrman_containing_entries(self):\r\n-        self.log.info(\"Test bitcoind -asmap with an addrman containing new and tried entries\")\r\n+        self.log.info(\"Test bitcoind -asmap restart with addrman containing new and tried entries\")\r\n         self.stop_node(0)\r\n         shutil.copyfile(self.asmap_raw, self.default_asmap)\r\n         self.start_node(0, [\"-asmap\", \"-checkaddrman=1\"])\r\n         self.fill_addrman(node_id=0)\r\n         self.restart_node(0, [\"-asmap\", \"-checkaddrman=1\"])\r\n-        with self.node.assert_debug_log(expected_msgs=[\"Addrman checks started: new 2, tried 2, total 4\"]):\r\n+        with self.node.assert_debug_log(\r\n+            expected_msgs=[\r\n+                \"Addrman checks started: new 2, tried 2, total 4\",\r\n+                \"Addrman checks completed successfully\",\r\n+            ]\r\n+        ):\r\n             self.node.getnodeaddresses()  # getnodeaddresses re-runs the addrman checks\r\n         os.remove(self.default_asmap)\r\n \r\ndiff --git a/test/functional/rpc_net.py b/test/functional/rpc_net.py\r\nindex e2dfa3ea23..4f5d8ce241 100755\r\n--- a/test/functional/rpc_net.py\r\n+++ b/test/functional/rpc_net.py\r\n@@ -239,6 +239,14 @@ class NetTest(BitcoinTestFramework):\r\n         assert_raises_rpc_error(-8, \"Network not recognized: Foo\", self.nodes[0].getnodeaddresses, 1, \"Foo\")\r\n \r\n     def test_addpeeraddress(self):\r\n+        \"\"\"RPC addpeeraddress sets the source address equal to the destination address.\r\n+        If an address with the same /16 as an existing new entry is passed, it will be\r\n+        placed in the same new bucket and have a 1/64 chance of the bucket positions\r\n+        colliding (depending on the value of nKey in the addrman), in which case the\r\n+        new address won't be added.  The probability of collision can be reduced to\r\n+        1/2^16 = 1/65536 by using an address from a different /16.  We avoid this here\r\n+        by first testing adding a tried table entry before testing adding a new table one.\r\n+        \"\"\"\r\n         self.log.info(\"Test addpeeraddress\")\r\n         self.restart_node(1, [\"-checkaddrman=1\"])\r\n         node = self.nodes[1]\r\n@@ -252,19 +260,21 @@ class NetTest(BitcoinTestFramework):\r\n         assert_equal(node.addpeeraddress(address=\"\", port=8333), {\"success\": False})\r\n         assert_equal(node.getnodeaddresses(count=0), [])\r\n \r\n-        self.log.debug(\"Test that adding a valid address succeeds\")\r\n-        assert_equal(node.addpeeraddress(address=\"1.2.3.4\", port=8333), {\"success\": True})\r\n-        addrs = node.getnodeaddresses(count=0)\r\n-        assert_equal(len(addrs), 1)\r\n-        assert_equal(addrs[0][\"address\"], \"1.2.3.4\")\r\n-        assert_equal(addrs[0][\"port\"], 8333)\r\n+        self.log.debug(\"Test that adding a valid address to the tried table succeeds\")\r\n+        assert_equal(node.addpeeraddress(address=\"1.2.3.4\", tried=True, port=8333), {\"success\": True})\r\n+        with node.assert_debug_log(expected_msgs=[\"Addrman checks started: new 0, tried 1, total 1\"]):\r\n+            addrs = node.getnodeaddresses(count=0)  # getnodeaddresses re-runs the addrman checks\r\n+            assert_equal(len(addrs), 1)\r\n+            assert_equal(addrs[0][\"address\"], \"1.2.3.4\")\r\n+            assert_equal(addrs[0][\"port\"], 8333)\r\n \r\n-        self.log.debug(\"Test that adding the same address again when already present fails\")\r\n-        assert_equal(node.addpeeraddress(address=\"1.2.3.4\", port=8333), {\"success\": False})\r\n+        self.log.debug(\"Test that adding an already-present tried address to the new and tried tables fails\")\r\n+        for value in [True, False]:\r\n+            assert_equal(node.addpeeraddress(address=\"1.2.3.4\", tried=value, port=8333), {\"success\": False})\r\n         assert_equal(len(node.getnodeaddresses(count=0)), 1)\r\n \r\n-        self.log.debug(\"Test adding a second address (with a different /16) to the tried table\")\r\n-        assert_equal(node.addpeeraddress(address=\"2.0.0.0\", port=8333, tried=True), {\"success\": True})\r\n+        self.log.debug(\"Test that adding a second address, this time to the new table, succeeds\")\r\n+        assert_equal(node.addpeeraddress(address=\"2.0.0.0\", port=8333), {\"success\": True})\r\n         with node.assert_debug_log(expected_msgs=[\"Addrman checks started: new 1, tried 1, total 2\"]):\r\n             addrs = node.getnodeaddresses(count=0)  # getnodeaddresses re-runs the addrman checks\r\n```\r\n</p></details>\r\n",
      "created_at" : "2021-09-15T14:43:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-920084245",
      "id" : 920084245,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII5842118V",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-15T14:43:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/920084245",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r709260434"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709260434"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done!",
      "commit_id" : "cdaab90662a54e331de0e49a89596bbb94a8ac45",
      "created_at" : "2021-09-15T14:43:42Z",
      "diff_hunk" : "@@ -262,6 +263,12 @@ def test_addpeeraddress(self):\n         assert_equal(node.addpeeraddress(address=\"1.2.3.4\", port=8333), {\"success\": False})\n         assert_equal(len(node.getnodeaddresses(count=0)), 1)\n \n+        self.log.debug(\"Test adding a second address (with a different /16) to the tried table\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r709260434",
      "id" : 709260434,
      "in_reply_to_id" : 708744420,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584qRnSS",
      "original_commit_id" : "d58681743a3ea99814c2c77ad8b7a4ea6ca3e14b",
      "original_line" : 266,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "test/functional/rpc_net.py",
      "position" : null,
      "pull_request_review_id" : 755220887,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-15T14:43:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/709260434",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK cdaab90662a54e331de0e49a89596bbb94a8ac45\r\n\r\nThis isn't a blocker, but I've never liked relying too heavily on the `assert_debug_log()` pattern in the functional tests. It's essentially asserting that a specific line of code is hit, which couples the functional tests very closely with the implementation. Ideally, the functional tests would test the functionality, and the implementation could be changed without having to update the tests.\r\n\r\nIn this case, we could extend the `getnodeaddresses` RPC to return whether the address is in the tried or new table, and (if it's in the new table) its refcount. That'd allow us to more closely test the contents of the addrman using a public interface.\r\n\r\nLike I said, not a blocker for this PR, but perhaps something to consider as a potential follow-up.",
      "created_at" : "2021-09-15T16:57:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-920199755",
      "id" : 920199755,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII58422SJL",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-15T16:57:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/920199755",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jnewbery Agree--that sounds like a good idea for a possible follow-up.  Edit: proposed in #23035.",
      "created_at" : "2021-09-15T17:18:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-920214881",
      "id" : 920214881,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII58422V1h",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-19T14:40:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/920214881",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r710894714"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/710894714"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "If this nondeterminism turns out to be a problem also in other cases, then I guess a new option `bitcoind -addrmandeterministic` could be introduced which creates a deterministic addrman.",
      "commit_id" : "cdaab90662a54e331de0e49a89596bbb94a8ac45",
      "created_at" : "2021-09-17T09:17:55Z",
      "diff_hunk" : "@@ -239,7 +239,16 @@ def test_getnodeaddresses(self):\n         assert_raises_rpc_error(-8, \"Network not recognized: Foo\", self.nodes[0].getnodeaddresses, 1, \"Foo\")\n \n     def test_addpeeraddress(self):\n+        \"\"\"RPC addpeeraddress sets the source address equal to the destination address.\n+        If an address with the same /16 as an existing new entry is passed, it will be\n+        placed in the same new bucket and have a 1/64 chance of the bucket positions\n+        colliding (depending on the value of nKey in the addrman), in which case the\n+        new address won't be added.  The probability of collision can be reduced to\n+        1/2^16 = 1/65536 by using an address from a different /16.  We avoid this here\n+        by first testing adding a tried table entry before testing adding a new table one.\n+        \"\"\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r710894714",
      "id" : 710894714,
      "line" : 249,
      "node_id" : "PRRC_kwDOABII584qX2R6",
      "original_commit_id" : "cdaab90662a54e331de0e49a89596bbb94a8ac45",
      "original_line" : 249,
      "original_position" : 11,
      "original_start_line" : 242,
      "path" : "test/functional/rpc_net.py",
      "position" : 11,
      "pull_request_review_id" : 757247685,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : 242,
      "start_side" : "RIGHT",
      "updated_at" : "2021-09-17T11:57:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/710894714",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r710899130"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/710899130"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "We don't check the contents of `addrs[]` here, but checked it above. If the reason for this is that the order is undeterministic, then I guess it can be sorted and then checked that it contains `1.2.3.4` and `2.0.0.0`.",
      "commit_id" : "cdaab90662a54e331de0e49a89596bbb94a8ac45",
      "created_at" : "2021-09-17T09:24:15Z",
      "diff_hunk" : "@@ -251,17 +260,25 @@ def test_addpeeraddress(self):\n         assert_equal(node.addpeeraddress(address=\"\", port=8333), {\"success\": False})\n         assert_equal(node.getnodeaddresses(count=0), [])\n \n-        self.log.debug(\"Test that adding a valid address succeeds\")\n-        assert_equal(node.addpeeraddress(address=\"1.2.3.4\", port=8333), {\"success\": True})\n-        addrs = node.getnodeaddresses(count=0)\n-        assert_equal(len(addrs), 1)\n-        assert_equal(addrs[0][\"address\"], \"1.2.3.4\")\n-        assert_equal(addrs[0][\"port\"], 8333)\n-\n-        self.log.debug(\"Test that adding the same address again when already present fails\")\n-        assert_equal(node.addpeeraddress(address=\"1.2.3.4\", port=8333), {\"success\": False})\n+        self.log.debug(\"Test that adding a valid address to the tried table succeeds\")\n+        assert_equal(node.addpeeraddress(address=\"1.2.3.4\", tried=True, port=8333), {\"success\": True})\n+        with node.assert_debug_log(expected_msgs=[\"Addrman checks started: new 0, tried 1, total 1\"]):\n+            addrs = node.getnodeaddresses(count=0)  # getnodeaddresses re-runs the addrman checks\n+            assert_equal(len(addrs), 1)\n+            assert_equal(addrs[0][\"address\"], \"1.2.3.4\")\n+            assert_equal(addrs[0][\"port\"], 8333)\n+\n+        self.log.debug(\"Test that adding an already-present tried address to the new and tried tables fails\")\n+        for value in [True, False]:\n+            assert_equal(node.addpeeraddress(address=\"1.2.3.4\", tried=value, port=8333), {\"success\": False})\n         assert_equal(len(node.getnodeaddresses(count=0)), 1)\n \n+        self.log.debug(\"Test that adding a second address, this time to the new table, succeeds\")\n+        assert_equal(node.addpeeraddress(address=\"2.0.0.0\", port=8333), {\"success\": True})\n+        with node.assert_debug_log(expected_msgs=[\"Addrman checks started: new 1, tried 1, total 2\"]):\n+            addrs = node.getnodeaddresses(count=0)  # getnodeaddresses re-runs the addrman checks\n+            assert_equal(len(addrs), 2)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r710899130",
      "id" : 710899130,
      "line" : 280,
      "node_id" : "PRRC_kwDOABII584qX3W6",
      "original_commit_id" : "cdaab90662a54e331de0e49a89596bbb94a8ac45",
      "original_line" : 280,
      "original_position" : 47,
      "original_start_line" : 278,
      "path" : "test/functional/rpc_net.py",
      "position" : 47,
      "pull_request_review_id" : 757247685,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : 278,
      "start_side" : "RIGHT",
      "updated_at" : "2021-09-17T11:57:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/710899130",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r711026507"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711026507"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, sort or make a set. Can do in the follow-up suggested in https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-920199755.",
      "commit_id" : "cdaab90662a54e331de0e49a89596bbb94a8ac45",
      "created_at" : "2021-09-17T12:48:25Z",
      "diff_hunk" : "@@ -251,17 +260,25 @@ def test_addpeeraddress(self):\n         assert_equal(node.addpeeraddress(address=\"\", port=8333), {\"success\": False})\n         assert_equal(node.getnodeaddresses(count=0), [])\n \n-        self.log.debug(\"Test that adding a valid address succeeds\")\n-        assert_equal(node.addpeeraddress(address=\"1.2.3.4\", port=8333), {\"success\": True})\n-        addrs = node.getnodeaddresses(count=0)\n-        assert_equal(len(addrs), 1)\n-        assert_equal(addrs[0][\"address\"], \"1.2.3.4\")\n-        assert_equal(addrs[0][\"port\"], 8333)\n-\n-        self.log.debug(\"Test that adding the same address again when already present fails\")\n-        assert_equal(node.addpeeraddress(address=\"1.2.3.4\", port=8333), {\"success\": False})\n+        self.log.debug(\"Test that adding a valid address to the tried table succeeds\")\n+        assert_equal(node.addpeeraddress(address=\"1.2.3.4\", tried=True, port=8333), {\"success\": True})\n+        with node.assert_debug_log(expected_msgs=[\"Addrman checks started: new 0, tried 1, total 1\"]):\n+            addrs = node.getnodeaddresses(count=0)  # getnodeaddresses re-runs the addrman checks\n+            assert_equal(len(addrs), 1)\n+            assert_equal(addrs[0][\"address\"], \"1.2.3.4\")\n+            assert_equal(addrs[0][\"port\"], 8333)\n+\n+        self.log.debug(\"Test that adding an already-present tried address to the new and tried tables fails\")\n+        for value in [True, False]:\n+            assert_equal(node.addpeeraddress(address=\"1.2.3.4\", tried=value, port=8333), {\"success\": False})\n         assert_equal(len(node.getnodeaddresses(count=0)), 1)\n \n+        self.log.debug(\"Test that adding a second address, this time to the new table, succeeds\")\n+        assert_equal(node.addpeeraddress(address=\"2.0.0.0\", port=8333), {\"success\": True})\n+        with node.assert_debug_log(expected_msgs=[\"Addrman checks started: new 1, tried 1, total 2\"]):\n+            addrs = node.getnodeaddresses(count=0)  # getnodeaddresses re-runs the addrman checks\n+            assert_equal(len(addrs), 2)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r711026507",
      "id" : 711026507,
      "in_reply_to_id" : 710899130,
      "line" : 280,
      "node_id" : "PRRC_kwDOABII584qYWdL",
      "original_commit_id" : "cdaab90662a54e331de0e49a89596bbb94a8ac45",
      "original_line" : 280,
      "original_position" : 47,
      "original_start_line" : 278,
      "path" : "test/functional/rpc_net.py",
      "position" : 47,
      "pull_request_review_id" : 757422705,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : 278,
      "start_side" : "RIGHT",
      "updated_at" : "2021-09-17T12:48:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711026507",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r711755108"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711755108"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done in #23035.",
      "commit_id" : "cdaab90662a54e331de0e49a89596bbb94a8ac45",
      "created_at" : "2021-09-19T14:39:46Z",
      "diff_hunk" : "@@ -251,17 +260,25 @@ def test_addpeeraddress(self):\n         assert_equal(node.addpeeraddress(address=\"\", port=8333), {\"success\": False})\n         assert_equal(node.getnodeaddresses(count=0), [])\n \n-        self.log.debug(\"Test that adding a valid address succeeds\")\n-        assert_equal(node.addpeeraddress(address=\"1.2.3.4\", port=8333), {\"success\": True})\n-        addrs = node.getnodeaddresses(count=0)\n-        assert_equal(len(addrs), 1)\n-        assert_equal(addrs[0][\"address\"], \"1.2.3.4\")\n-        assert_equal(addrs[0][\"port\"], 8333)\n-\n-        self.log.debug(\"Test that adding the same address again when already present fails\")\n-        assert_equal(node.addpeeraddress(address=\"1.2.3.4\", port=8333), {\"success\": False})\n+        self.log.debug(\"Test that adding a valid address to the tried table succeeds\")\n+        assert_equal(node.addpeeraddress(address=\"1.2.3.4\", tried=True, port=8333), {\"success\": True})\n+        with node.assert_debug_log(expected_msgs=[\"Addrman checks started: new 0, tried 1, total 1\"]):\n+            addrs = node.getnodeaddresses(count=0)  # getnodeaddresses re-runs the addrman checks\n+            assert_equal(len(addrs), 1)\n+            assert_equal(addrs[0][\"address\"], \"1.2.3.4\")\n+            assert_equal(addrs[0][\"port\"], 8333)\n+\n+        self.log.debug(\"Test that adding an already-present tried address to the new and tried tables fails\")\n+        for value in [True, False]:\n+            assert_equal(node.addpeeraddress(address=\"1.2.3.4\", tried=value, port=8333), {\"success\": False})\n         assert_equal(len(node.getnodeaddresses(count=0)), 1)\n \n+        self.log.debug(\"Test that adding a second address, this time to the new table, succeeds\")\n+        assert_equal(node.addpeeraddress(address=\"2.0.0.0\", port=8333), {\"success\": True})\n+        with node.assert_debug_log(expected_msgs=[\"Addrman checks started: new 1, tried 1, total 2\"]):\n+            addrs = node.getnodeaddresses(count=0)  # getnodeaddresses re-runs the addrman checks\n+            assert_equal(len(addrs), 2)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#discussion_r711755108",
      "id" : 711755108,
      "in_reply_to_id" : 710899130,
      "line" : 280,
      "node_id" : "PRRC_kwDOABII584qbIVk",
      "original_commit_id" : "cdaab90662a54e331de0e49a89596bbb94a8ac45",
      "original_line" : 280,
      "original_position" : 47,
      "original_start_line" : 278,
      "path" : "test/functional/rpc_net.py",
      "position" : 47,
      "pull_request_review_id" : 758156688,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22831",
      "side" : "RIGHT",
      "start_line" : 278,
      "start_side" : "RIGHT",
      "updated_at" : "2021-09-19T14:39:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711755108",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This seems ready for merge.",
      "created_at" : "2021-09-20T16:24:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-923081352",
      "id" : 923081352,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII5843BRqI",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-20T16:24:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/923081352",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "re-ACK cdaab90662a54e331de0e49a89596bbb94a8ac45 (based on code review of diff to d586817)",
      "created_at" : "2021-09-20T17:19:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-923124016",
      "id" : 923124016,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII5843BcEw",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-20T17:19:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/923124016",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Therefore, #22791 fixed not just the proximal cause of the bug (initialization order), but also the ultimate cause (bad encapsulation and partially-initalized objects) by making that member const and private. Just changing the initialization order would be a partial fix, rather than eliminating a whole class of bugs.\r\n\r\nI don't want to belabor drama here, but there is a categorical difference between (i) extant bugs and (ii) footgun conditions that might lead to a bug. One case requires a clear and immediate fix (and if feasible an accompanying test) and the other can be responsibly treated in a number of ways with varying rapidity.\r\n\r\n> I'd encourage everyone to take a deep breath and remember that we're all on the same team, and everyone is here to improve the project.\r\n\r\nWhile I appreciate the sentiment here, this is a controversial, security-critical project that is likely to someday experience subversion, overt or otherwise. Consequently we should be eager to recognize and address process failures, and we should certainly not be gunshy about adding test coverage, whether or not its implementation is ideal.",
      "created_at" : "2021-09-20T19:16:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-923207453",
      "id" : 923207453,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII5843Bwcd",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-20T19:16:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/923207453",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for adjusting this to use `addpeeraddress` (and hashing out the non-determinism issues that came with it).\r\n\r\nConcept ACK (didn't re-review)",
      "created_at" : "2021-09-21T07:34:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-923717891",
      "id" : 923717891,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII5843DtED",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-21T07:34:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/923717891",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jamesob - I'm not going to continue the discussion of process in this PR, since I think we're basically going in circles at this point. However, I do want to respond to your final point:\r\n\r\n> we should certainly not be gunshy about adding test coverage, whether or not its implementation is ideal.\r\n\r\nI totally disagree with this. Our standards for test code should be as high as for code in the product itself, since all code (test or production) carries an ongoing maintenance cost. If a proposed test [introduces difficult-to-maintain binary files](https://github.com/bitcoin/bitcoin/pull/22831#discussion_r704550576) or [intermittently fails](https://github.com/bitcoin/bitcoin/pull/22831#discussion_r708302639), then those issues absolutely should be brought up in review and resolved before merge. I agree with @fanquake's assessment here:\r\n\r\n> I think this perspective is important because it can determine how we fix bugs. In this case, the bug is already fixed, and this PR is adding regression testing (which is important!). However given the impact and scope are low, there isn't any sort of rush to get this regression testing added that we can't do it \"right\" the first time.\r\n\r\nThere's no rush here. A merge-first-fix-later attitude increases the overall cost of this code and transfers that cost onto developers who'll have to maintain/modify the tests later.",
      "created_at" : "2021-09-21T08:25:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-923753972",
      "id" : 923753972,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22831",
      "node_id" : "IC_kwDOABII5843D130",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-21T08:25:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/923753972",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   }
]
