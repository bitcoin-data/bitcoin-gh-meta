[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#15719](https://github.com/bitcoin/bitcoin/pull/15719) (Wallet passive startup by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-09-04T15:21:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22868#issuecomment-912990892",
      "id" : 912990892,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22868",
      "node_id" : "IC_kwDOABII5842ayKs",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/912990892/reactions"
      },
      "updated_at" : "2021-11-09T10:36:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/912990892",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Why this change is safe?",
      "created_at" : "2021-09-07T18:55:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22868#issuecomment-914545809",
      "id" : 914545809,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22868",
      "node_id" : "IC_kwDOABII5842gtyR",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-07T18:55:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/914545809",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@hebasto what is the concern? The lock can be acquired inside the load handler. This change also avoids recursive locks on `cs_wallet`.",
      "created_at" : "2021-09-07T20:31:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22868#issuecomment-914610671",
      "id" : 914610671,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22868",
      "node_id" : "IC_kwDOABII5842g9nv",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-07T20:31:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/914610671",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> what is the concern?\r\n\r\nThis does seem probably safe, but it would save reviewers some effort to know when the lock was added, when it stopped being necessary, and the specific reason why it was necessary whenever it was needed (for example whether it was avoiding deadlocks or asserts by acquiring recursive locks in a consistent order, or whether it was avoiding race condition.) This information could go in the PR description.\r\n\r\nOne concern might be that one of the `wallet_load_fns` callbacks could call a wallet method and acquire cs_wallet mutex *after* context.wallets_mutex, and maybe this would be in inconsistent order.",
      "created_at" : "2021-09-08T20:39:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22868#issuecomment-915553755",
      "id" : 915553755,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22868",
      "node_id" : "IC_kwDOABII5842kj3b",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-08T20:39:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/915553755",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ryanofsky \r\n\r\n> but it would save reviewers some effort to know when the lock was added, when it stopped being necessary\r\n\r\nMy bad for not writing this, I went thru history before making the change, will redo and update this.\r\n\r\n> One concern might be that one of the `wallet_load_fns` callbacks could call a wallet method and acquire cs_wallet mutex _after_ context.wallets_mutex, and maybe this would be in inconsistent order.\r\n\r\nWould be bad to lock one `cs_wallet` after `wallets_mutex`? In master that already happens but works because `cs_wallet` is recursive. Couldn't find more cases of cs_wallet -> wallets_mutex lock order.",
      "created_at" : "2021-09-11T22:12:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22868#issuecomment-917493065",
      "id" : 917493065,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22868",
      "node_id" : "IC_kwDOABII5842r9VJ",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-11T22:14:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/917493065",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ryanofsky see https://github.com/bitcoin/bitcoin/pull/11634/files#r227725517 for when the lock was added and @practicalswift submitted a similar change #14560 but @MarcoFalke rejected it.",
      "created_at" : "2021-09-12T20:49:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22868#issuecomment-917707805",
      "id" : 917707805,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22868",
      "node_id" : "IC_kwDOABII5842sxwd",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-12T21:23:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/917707805",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ryanofsky thanks! You might want to see https://github.com/bitcoin-core/gui/pull/417/commits/c09fd3acb9aee9245a033e9d7251cd29de1d24bb, it needs this change otherwise it deadlocks.",
      "created_at" : "2021-09-24T15:08:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22868#issuecomment-926702933",
      "id" : 926702933,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22868",
      "node_id" : "IC_kwDOABII5843PF1V",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-24T15:08:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/926702933",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-09-30T20:30:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22868#issuecomment-931642508",
      "id" : 931642508,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22868",
      "node_id" : "IC_kwDOABII5843h7yM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/931642508/reactions"
      },
      "updated_at" : "2021-09-30T20:30:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/931642508",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> @ryanofsky thanks! You might want to see [bitcoin-core/gui@c09fd3a](https://github.com/bitcoin-core/gui/commit/c09fd3acb9aee9245a033e9d7251cd29de1d24bb), it needs this change otherwise it deadlocks.\r\n\r\nThanks! That also looks like a good change. Is there a PR or issue this is all a part of?",
      "created_at" : "2021-11-08T17:05:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22868#issuecomment-963370968",
      "id" : 963370968,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22868",
      "node_id" : "IC_kwDOABII5845a9_Y",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/963370968/reactions"
      },
      "updated_at" : "2021-11-08T17:05:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/963370968",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ryanofsky yes, https://github.com/bitcoin-core/gui/pull/417\r\n\r\nEdit: I guess I have to rebase.",
      "created_at" : "2021-11-08T17:07:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22868#issuecomment-963372763",
      "id" : 963372763,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22868",
      "node_id" : "IC_kwDOABII5845a-bb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/963372763/reactions"
      },
      "updated_at" : "2021-11-08T17:07:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/963372763",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased due to trivial conflict with #23123.",
      "created_at" : "2021-11-08T22:00:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22868#issuecomment-963612615",
      "id" : 963612615,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22868",
      "node_id" : "IC_kwDOABII5845b4_H",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/963612615/reactions"
      },
      "updated_at" : "2021-11-08T22:00:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/963612615",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> But in the future, GUI code could do arbitrary things in its `wallet_load_fns` handler, and maybe it will call a wallet function and lock `cs_wallet` in one. In that case the lock order would be `wallets_mutex` first then `cs_wallet` second\r\n\r\nThis is already the case and it is where the GUI models are filled.\r\n\r\n@meshcollider @ryanofsky updated OP, added `wallets_mutex` comment as suggested.\r\n\r\nAlso rebased.",
      "created_at" : "2021-11-22T09:38:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22868#issuecomment-975333091",
      "id" : 975333091,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22868",
      "node_id" : "IC_kwDOABII5846Imbj",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/975333091/reactions"
      },
      "updated_at" : "2021-11-22T09:43:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/975333091",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "PR description doesn't seem totally accurate, from https://github.com/bitcoin/bitcoin/pull/22868#issue-987214408\r\n\r\n> Don't have `cs_wallet` locked while calling each `context.wallet_load_fns`. A load handler can always lock `cs_wallet` if needed.\r\n> \r\n> The lock was added in [1c7e25d](https://github.com/bitcoin/bitcoin/commit/1c7e25db0c898abc9968ab487b254454b709e628) to satisfy TSAN. With [44c430f](https://github.com/bitcoin/bitcoin/commit/44c430ffac940e1d1dd7f5939a495470bc694489) most of the code requiring the lock is in `CWallet::AttachChain`. A comment is added to warn about wallets_mutex and cs_wallet lock ordering.\r\n\r\nIf my understanding of https://github.com/bitcoin/bitcoin/pull/11634/files#r227725517 is correct, then the lock was not added to satsify TSAN but was added to satisfy clang annotations. I think you could summarize this by saying that this LOCK(cs_wallet) was correctly added in #11634, but it became no longer unnecessary after #20773 when code requiring the lock was moved to the new `AttachChain` method. \r\n\r\nAlso it now seems like the motivation for this change is not just removing an unnecessary lock, but reversing the 1. cs_wallet 2. wallets_mutex lock order so it can now be 1. wallets_mutex 2. cs_wallet, because upcoming GUI PR https://github.com/bitcoin-core/gui/pull/417 needs this",
      "created_at" : "2021-11-24T05:15:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22868#issuecomment-977540267",
      "id" : 977540267,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22868",
      "node_id" : "IC_kwDOABII5846RBSr",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/977540267/reactions"
      },
      "updated_at" : "2021-11-24T05:15:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/977540267",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22868#discussion_r756020059"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22868"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/756020059"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Haven't tried, but would there be any point in using `EXCLUDES` / `LOCKS_EXCLUDED` (or `REQUIRES(!mutex)` with `-Wthread-safety-negative`) annotations to enforce this?",
      "commit_id" : "f13a22a631efe01e1fbae4ae78a4901d14ebda3c",
      "created_at" : "2021-11-24T12:34:13Z",
      "diff_hunk" : "@@ -34,6 +34,8 @@ using LoadWalletFn = std::function<void(std::unique_ptr<interfaces::Wallet> wall\n struct WalletContext {\n     interfaces::Chain* chain{nullptr};\n     ArgsManager* args{nullptr}; // Currently a raw pointer because the memory is not managed by this struct\n+    // It is unsafe to lock this after locking a CWallet::cs_wallet mutex because\n+    // this could introduce inconsistent lock ordering and cause deadlocks.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22868#discussion_r756020059",
      "id" : 756020059,
      "line" : 38,
      "node_id" : "PRRC_kwDOABII584tD_Nb",
      "original_commit_id" : "f13a22a631efe01e1fbae4ae78a4901d14ebda3c",
      "original_line" : 38,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/context.h",
      "position" : 5,
      "pull_request_review_id" : 814836904,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22868",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/756020059/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-24T12:37:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/756020059",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   }
]
