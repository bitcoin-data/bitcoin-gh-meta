[
   {
      "author_association" : "MEMBER",
      "body" : "Same on debian:sid (ports)\r\n\r\n```\r\nmake[4]: Entering directory '/home/test/bitcoin/build/bitcoin-riscv64-linux-gnu/src'\r\n============================================================================\r\nTestsuite summary for Bitcoin Core 0.19.99\r\n============================================================================\r\n# TOTAL: 0\r\n# PASS:  0\r\n# SKIP:  0\r\n# XFAIL: 0\r\n# FAIL:  0\r\n# XPASS: 0\r\n# ERROR: 0\r\n============================================================================\r\nmake[4]: Leaving directory '/home/test/bitcoin/build/bitcoin-riscv64-linux-gnu/src'\r\nRunning tests: addrman_tests from test/addrman_tests.cpp\r\nRunning tests: amount_tests from test/amount_tests.cpp\r\nRunning tests: allocator_tests from test/allocator_tests.cpp\r\nRunning tests: base32_tests from test/base32_tests.cpp\r\nRunning tests: base58_tests from test/base58_tests.cpp\r\nRunning tests: base64_tests from test/base64_tests.cpp\r\nRunning tests: bech32_tests from test/bech32_tests.cpp\r\nRunning tests: bip32_tests from test/bip32_tests.cpp\r\nRunning tests: blockchain_tests from test/blockchain_tests.cpp\r\nRunning tests: blockencodings_tests from test/blockencodings_tests.cpp\r\nRunning tests: blockfilter_tests from test/blockfilter_tests.cpp\r\nRunning tests: blockfilter_index_tests from test/blockfilter_index_tests.cpp\r\nRunning tests: bloom_tests from test/bloom_tests.cpp\r\nRunning tests: bswap_tests from test/bswap_tests.cpp\r\nRunning tests: checkqueue_tests from test/checkqueue_tests.cpp\r\nRunning tests: coins_tests from test/coins_tests.cpp\r\nRunning tests: compilerbug_tests from test/compilerbug_tests.cpp\r\nRunning tests: compress_tests from test/compress_tests.cpp\r\nRunning tests: crypto_tests from test/crypto_tests.cpp\r\nRunning tests: cuckoocache_tests from test/cuckoocache_tests.cpp\r\nRunning tests: denialofservice_tests from test/denialofservice_tests.cpp\r\nRunning tests: descriptor_tests from test/descriptor_tests.cpp\r\nRunning tests: flatfile_tests from test/flatfile_tests.cpp\r\nRunning tests: fs_tests from test/fs_tests.cpp\r\nRunning tests: getarg_tests from test/getarg_tests.cpp\r\nRunning tests: hash_tests from test/hash_tests.cpp\r\nRunning tests: key_io_tests from test/key_io_tests.cpp\r\nRunning tests: key_tests from test/key_tests.cpp\r\nRunning tests: limitedmap_tests from test/limitedmap_tests.cpp\r\nRunning tests: logging_tests from test/logging_tests.cpp\r\nRunning tests: dbwrapper_tests from test/dbwrapper_tests.cpp\r\nRunning tests: validation_tests from test/validation_tests.cpp\r\nRunning tests: mempool_tests from test/mempool_tests.cpp\r\nRunning tests: merkle_tests from test/merkle_tests.cpp\r\nRunning tests: merkleblock_tests from test/merkleblock_tests.cpp\r\nRunning tests: miner_tests from test/miner_tests.cpp\r\nRunning tests: multisig_tests from test/multisig_tests.cpp\r\nRunning tests: net_tests from test/net_tests.cpp\r\nRunning tests: netbase_tests from test/netbase_tests.cpp\r\nRunning tests: pmt_tests from test/pmt_tests.cpp\r\nRunning tests: policyestimator_tests from test/policyestimator_tests.cpp\r\nRunning tests: pow_tests from test/pow_tests.cpp\r\nRunning tests: prevector_tests from test/prevector_tests.cpp\r\nRunning tests: raii_event_tests from test/raii_event_tests.cpp\r\nRunning tests: random_tests from test/random_tests.cpp\r\nRunning tests: reverselock_tests from test/reverselock_tests.cpp\r\nRunning tests: rpc_tests from test/rpc_tests.cpp\r\nRunning tests: sanity_tests from test/sanity_tests.cpp\r\nRunning tests: scheduler_tests from test/scheduler_tests.cpp\r\nRunning tests: script_p2sh_tests from test/script_p2sh_tests.cpp\r\nRunning tests: script_tests from test/script_tests.cpp\r\nRunning tests: script_standard_tests from test/script_standard_tests.cpp\r\nRunning tests: scriptnum_tests from test/scriptnum_tests.cpp\r\nRunning tests: serialize_tests from test/serialize_tests.cpp\r\nRunning tests: settings_tests from test/settings_tests.cpp\r\nRunning tests: sighash_tests from test/sighash_tests.cpp\r\nRunning tests: sigopcount_tests from test/sigopcount_tests.cpp\r\nRunning tests: skiplist_tests from test/skiplist_tests.cpp\r\nRunning tests: streams_tests from test/streams_tests.cpp\r\nRunning tests: sync_tests from test/sync_tests.cpp\r\nRunning tests: util_threadnames_tests from test/util_threadnames_tests.cpp\r\nRunning tests: timedata_tests from test/timedata_tests.cpp\r\nRunning tests: torcontrol_tests from test/torcontrol_tests.cpp\r\nRunning tests: transaction_tests from test/transaction_tests.cpp\r\nRunning tests: txindex_tests from test/txindex_tests.cpp\r\nRunning tests: txvalidation_tests from test/txvalidation_tests.cpp\r\nRunning tests: txvalidationcache_tests from test/txvalidationcache_tests.cpp\r\nRunning tests: uint256_tests from test/uint256_tests.cpp\r\nRunning tests: util_tests from test/util_tests.cpp\r\nRunning tests: validation_block_tests from test/validation_block_tests.cpp\r\nRunning tests: validation_flush_tests from test/validation_flush_tests.cpp\r\nRunning 1 test case...\r\nTest cases order is shuffled using seed: 902477190\r\nEntering test module \"Bitcoin Core Test Suite\"\r\ntest/validation_flush_tests.cpp(12): Entering test suite \"validation_flush_tests\"\r\ntest/validation_flush_tests.cpp(19): Entering test case \"getcoinscachesizestate\"\r\n2020-02-11T00:10:09Z Seed: Setting random seed for current tests to RANDOM_CTX_SEED=96807d9fd7f28bc0da6041aeaf760a509ee36b39cfa80ed6d37f4abb89713310\r\n2020-02-11T00:10:09Z Bitcoin Core version v0.19.99.0-55ece5fe2-dirty (release build)\r\n2020-02-11T00:10:09Z Using 16 MiB out of 32/2 requested for signature cache, able to store 524288 elements\r\n2020-02-11T00:10:09Z Using 16 MiB out of 32/2 requested for script execution cache, able to store 524288 elements\r\n2020-02-11T00:10:09Z Opened LevelDB successfully\r\n2020-02-11T00:10:09Z Wrote new obfuscate key for /tmp/test_common_Bitcoin Core/3944085796/chainstate: 2f91067c72122910\r\n2020-02-11T00:10:09Z Using obfuscation key for /tmp/test_common_Bitcoin Core/3944085796/chainstate: 2f91067c72122910\r\nCCoinsViewCache memory usage: 32\r\nCCoinsViewCache memory usage: 336\r\nCCoinsViewCache memory usage: 544\r\nCCoinsViewCache memory usage: 752\r\nCCoinsViewCache memory usage: 960\r\ntest/validation_flush_tests.cpp(99): error: in \"validation_flush_tests/getcoinscachesizestate\": check chainstate.GetCoinsCacheSizeState(tx_pool, MAX_COINS_CACHE_BYTES, 0) == CoinsCacheSizeState::OK has failed [1 != 0]\r\nCCoinsViewCache memory usage: 1168\r\n2020-02-11T00:10:09Z Cache size (1168) exceeds total space (1024)\r\n2020-02-11T00:10:09Z Cache size (1168) exceeds total space (1024)\r\nCCoinsViewCache memory usage: 1376\r\nCCoinsViewCache memory usage: 1584\r\nCCoinsViewCache memory usage: 1792\r\nCCoinsViewCache memory usage: 2000\r\nCoinsTip usage percentage: 0.976562\r\n2020-02-11T00:10:09Z Cache size (218768) exceeds total space (1024)\r\nCCoinsViewCache memory usage: 8896\r\n2020-02-11T00:10:09Z Cache size (8896) exceeds total space (1024)\r\ntest/validation_flush_tests.cpp(19): Leaving test case \"getcoinscachesizestate\"; testing time: 204280us\r\ntest/validation_flush_tests.cpp(12): Leaving test suite \"validation_flush_tests\"; testing time: 205321us\r\nLeaving test module \"Bitcoin Core Test Suite\"; testing time: 206834us\r\n\r\n*** 1 failure is detected in the test module \"Bitcoin Core Test Suite\"\r\nmake[3]: *** [Makefile:17898: test/validation_flush_tests.cpp.test] Error 1\r\nmake[3]: *** Waiting for unfinished jobs....\r\nmake[3]: Leaving directory '/home/test/bitcoin/build/bitcoin-riscv64-linux-gnu/src'\r\nmake[2]: *** [Makefile:16441: check-am] Error 2\r\nmake[2]: Leaving directory '/home/test/bitcoin/build/bitcoin-riscv64-linux-gnu/src'\r\nmake[1]: *** [Makefile:16126: check-recursive] Error 1\r\nmake[1]: Leaving directory '/home/test/bitcoin/build/bitcoin-riscv64-linux-gnu/src'\r\nmake: *** [Makefile:790: check-recursive] Error 1",
      "created_at" : "2020-02-11T00:17:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/18111#issuecomment-584422802",
      "id" : 584422802,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18111",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4NDQyMjgwMg==",
      "updated_at" : "2020-02-11T00:17:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/584422802",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for reporting.\r\n\r\nIt seems like quite a fragile test, depending specifically the dynamic memory use of structures. This can definitely differ per platform, or compiler/library versions especially when using C++ stdlib or boost data structures.",
      "created_at" : "2020-02-11T13:07:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/18111#issuecomment-584625615",
      "id" : 584625615,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18111",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4NDYyNTYxNQ==",
      "updated_at" : "2020-02-11T13:07:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/584625615",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The failing test part is\r\n```c++\r\n    constexpr int COINS_UNTIL_CRITICAL = is_64_bit ? 4 : 5;\r\n\r\n    for (int i{0}; i < COINS_UNTIL_CRITICAL; ++i) {\r\n        COutPoint res = add_coin(view);\r\n        print_view_mem_usage(view);\r\n        BOOST_CHECK_EQUAL(view.AccessCoin(res).DynamicMemoryUsage(), COIN_SIZE);\r\n        BOOST_CHECK_EQUAL(\r\n            chainstate.GetCoinsCacheSizeState(tx_pool, MAX_COINS_CACHE_BYTES, /*max_mempool_size_bytes*/ 0),\r\n            CoinsCacheSizeState::OK);\r\n    }\r\n```\r\n\r\nThis is the progression (of the 5 loop passes) in the passing circumstances (e.g.g amd64 Ubuntu 18.04):\r\n```\r\nCCoinsViewCache memory usage: 32\r\nCCoinsViewCache memory usage: 256\r\nCCoinsViewCache memory usage: 464\r\nCCoinsViewCache memory usage: 704\r\nCCoinsViewCache memory usage: 912\r\n```\r\n\r\nThis is the progression in the failing circumstances (RV64 fedora rawhide):\r\n```\r\nCCoinsViewCache memory usage: 32\r\nCCoinsViewCache memory usage: 336\r\nCCoinsViewCache memory usage: 544\r\nCCoinsViewCache memory usage: 752\r\nCCoinsViewCache memory usage: 960\r\n```\r\n\r\n960 is larger than the `large_threshold` so `hainstate.GetCoinsCacheSizeState` returns `CoinsCacheSizeState::LARGE` instead of `CoinsCacheSizeState::OK`\r\n\r\nOne level deeper;\r\n```\r\n2020-02-11T14:32:06Z DynamicMemoryUsage 32 0 -> 32\r\n2020-02-11T14:32:06Z DynamicMemoryUsage 176 80 -> 256\r\n2020-02-11T14:32:06Z DynamicMemoryUsage 304 160 -> 464\r\n2020-02-11T14:32:06Z DynamicMemoryUsage 464 240 -> 704\r\n2020-02-11T14:32:06Z DynamicMemoryUsage 592 320 -> 912\r\n```\r\n```\r\n2020-02-11T14:31:19Z DynamicMemoryUsage 32 0 -> 32            \r\n2020-02-11T14:31:19Z DynamicMemoryUsage 256 80 -> 336                                                   \r\n2020-02-11T14:31:19Z DynamicMemoryUsage 384 160 -> 544            \r\n2020-02-11T14:31:19Z DynamicMemoryUsage 512 240 -> 752        \r\n2020-02-11T14:31:19Z DynamicMemoryUsage 640 320 -> 960        \r\n```\r\n\r\n`memusage::DynamicUsage(cacheCoins)` is responsible for the divergence. So the difference is in `DynamicUsage(const std::unordered_map`.\r\n",
      "created_at" : "2020-02-11T13:38:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/18111#issuecomment-584638002",
      "id" : 584638002,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18111",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4NDYzODAwMg==",
      "updated_at" : "2020-02-11T14:39:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/584638002",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This is interesting, I added instrumentation to `static inline size_t DynamicUsage(const std::unordered_map<X, Y, Z>& m)`:\r\n- `sizeof(unordered_node<std::pair<const X, Y> >)` stays the same\r\n- `m.size()` stays the same\r\n- `sizeof(void*)` stays the same (obvs)\r\n- `m.bucket_count()` is the factor that changes\r\n\r\nHere's `bucket_count()` per iteration, before and after:\r\n```\r\nbefore after delta\r\n1      1     0      +0 bytes\r\n3      13    10     +80 bytes\r\n3      13    10     +80 bytes\r\n7      13    6      +48 bytes\r\n7      13    6      +48 bytes\r\n```\r\nThis explains the difference in memory usage notes in previous post.\r\n\r\nSo it looks like the bucket allocation is done in coarser chunks \"optimistically\". A difference in stdc++ behavior.\r\n",
      "created_at" : "2020-02-11T16:10:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/18111#issuecomment-584712873",
      "id" : 584712873,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18111",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4NDcxMjg3Mw==",
      "updated_at" : "2020-02-11T16:10:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/584712873",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "What is the test testing exactly? @jamesob \r\n\r\n",
      "created_at" : "2020-02-11T17:09:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/18111#issuecomment-584743050",
      "id" : 584743050,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18111",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4NDc0MzA1MA==",
      "updated_at" : "2020-02-11T17:09:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/584743050",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I also saw a failure on x86_64:\r\n\r\n\r\n```\r\nRunning 1 test case...\r\n\r\nEntering test module \"Bitcoin Core Test Suite\"\r\n\r\n../../src/test/validation_flush_tests.cpp(12): Entering test suite \"validation_flush_tests\"\r\n\r\n../../src/test/validation_flush_tests.cpp(19): Entering test case \"getcoinscachesizestate\"\r\n\r\n2020-02-18T01:15:33Z Seed: Setting random seed for current tests to RANDOM_CTX_SEED=3dc88853ef5f7e3ba8b13ea59166ea781e275e7b00f4b9dd3156fc3e66834f11\r\n\r\n2020-02-18T01:15:33Z Bitcoin Core version v0.19.99.0-unk (release build)\r\n\r\n2020-02-18T01:15:33Z Using 16 MiB out of 32/2 requested for signature cache, able to store 524288 elements\r\n\r\n2020-02-18T01:15:33Z Using 16 MiB out of 32/2 requested for script execution cache, able to store 524288 elements\r\n\r\n2020-02-18T01:15:33Z Opened LevelDB successfully\r\n\r\n2020-02-18T01:15:33Z Wrote new obfuscate key for /tmp/test_common_Bitcoin Core/3560114667/chainstate: 5c21e65492dd3c16\r\n\r\n2020-02-18T01:15:33Z Using obfuscation key for /tmp/test_common_Bitcoin Core/3560114667/chainstate: 5c21e65492dd3c16\r\n\r\nCCoinsViewCache memory usage: 32\r\n\r\nCCoinsViewCache memory usage: 336\r\n\r\nCCoinsViewCache memory usage: 544\r\n\r\nCCoinsViewCache memory usage: 752\r\n\r\nCCoinsViewCache memory usage: 960\r\n\r\n../../src/test/validation_flush_tests.cpp(99): error: in \"validation_flush_tests/getcoinscachesizestate\": check chainstate.GetCoinsCacheSizeState(tx_pool, MAX_COINS_CACHE_BYTES, 0) == CoinsCacheSizeState::OK has failed [1 != 0]\r\n\r\nCCoinsViewCache memory usage: 1168\r\n\r\n2020-02-18T01:15:33Z Cache size (1168) exceeds total space (1024)\r\n\r\n2020-02-18T01:15:33Z Cache size (1168) exceeds total space (1024)\r\n\r\nCCoinsViewCache memory usage: 1376\r\n\r\nCCoinsViewCache memory usage: 1584\r\n\r\nCCoinsViewCache memory usage: 1792\r\n\r\nCCoinsViewCache memory usage: 2000\r\n\r\nCoinsTip usage percentage: 0.976562\r\n\r\n2020-02-18T01:15:33Z Cache size (218768) exceeds total space (1024)\r\n\r\nCCoinsViewCache memory usage: 8896\r\n\r\n2020-02-18T01:15:33Z Cache size (8896) exceeds total space (1024)\r\n\r\n../../src/test/validation_flush_tests.cpp(19): Leaving test case \"getcoinscachesizestate\"; testing time: 32889us\r\n\r\n../../src/test/validation_flush_tests.cpp(12): Leaving test suite \"validation_flush_tests\"; testing time: 32903us\r\n\r\nLeaving test module \"Bitcoin Core Test Suite\"; testing time: 32948us\r\n\r\n*** 1 failure is detected in the test module \"Bitcoin Core Test Suite\"",
      "created_at" : "2020-02-18T01:56:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/18111#issuecomment-587236953",
      "id" : 587236953,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18111",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4NzIzNjk1Mw==",
      "updated_at" : "2020-02-18T01:56:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/587236953",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Oops, just seeing this. This is supposed to give us a comprehensive understanding of when coins cache flushes happen, but (as you can probably already see) the test is particularly narrow and brittle. I had to special-case out certain architectures, and now I guess the newer version of libstdc++ has created an additional case that allocates buckets differently.\r\n\r\nFor posterity, this test was introduced in https://github.com/bitcoin/bitcoin/pull/16945. @ryanofsky was rightly concerned that the test was too finicky, but my rationale for including it is here: https://github.com/bitcoin/bitcoin/pull/16945#issuecomment-566752559\r\n\r\nA few options here: \r\n- we can special-case test behavior based upon the `bucket_count()` @laanwj mentioned above,\r\n- we can remove the test altogether,\r\n- we can make the test less specific (i.e. just fill the cache with a bunch of entries and make sure we hit the highest severity cache state).\r\n\r\nI'm probably for the third option.",
      "created_at" : "2020-02-18T19:35:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/18111#issuecomment-587717283",
      "id" : 587717283,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18111",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4NzcxNzI4Mw==",
      "updated_at" : "2020-02-18T19:36:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/587717283",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Agree that the third option to loosen up the test a bit and not depend on compiler or library internals makes sense.",
      "created_at" : "2020-02-18T19:41:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/18111#issuecomment-587725884",
      "id" : 587725884,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18111",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4NzcyNTg4NA==",
      "updated_at" : "2020-02-18T19:41:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/587725884",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
