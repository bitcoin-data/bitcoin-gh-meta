{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "This adds a `-daemonwait` flag that does the same as `-daemon` except that it, from a user perspective, backgrounds the process only after initialization is complete. This is similar to the behaviour of some other software such as c-lightning.\r\n\r\nThis can be useful when the process launching bitcoind wants to guarantee that either the RPC server is running, or that initialization failed, before continuing. The exit code indicates the initialization result.\r\n\r\nThe use of the libc function `daemon()` is replaced by a custom implementation which is inspired by the [glibc implementation](https://github.com/lattera/glibc/blob/master/misc/daemon.c#L44), but which also creates a pipe from the child to the parent process for communication.\r\n\r\nAn additional advantage of having our own `daemon()` implementation is that no MACOS-specific pragmas are needed anymore to silence a deprecation warning.\r\n\r\nTODO:\r\n\r\n- [x] Factor out `token_read` and `token_write` to an utility, and use  them in `shutdown.cpp` as wellâthis is exactly the same kind of communication mechanism.\r\n\r\n    - [x] RAII-ify pipe endpoints.\r\n\r\n- [x] Improve granularity of the `configure.ac` checks. This currently  still checks for the function `daemon()` which makes no sense as  it's not used. It should check for individual functions such as\r\n  `fork()` and `setsid()` etcâthe former being required, the second optional.\r\n\r\n- [-] ~~Signal propagation during initialization: if say, pressing Ctrl-C during `-daemonwait` it would be good to pass this SIGINT on to the child process instead of detaching the parent process and letting the child run free.~~ This is not necessary, see https://github.com/bitcoin/bitcoin/pull/21007#issuecomment-769007341.\r\n\r\nFuture:\r\n\r\n- Consider if it makes sense to use this in the RPC tests (there would be no more need for \"is RPC ready\" polling loops). I think this is out of scope for this PR.",
   "closed_at" : "2021-03-11T14:28:27Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
      "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
      "followers_url" : "https://api.github.com/users/laanwj/followers",
      "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/laanwj",
      "id" : 126646,
      "login" : "laanwj",
      "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
      "organizations_url" : "https://api.github.com/users/laanwj/orgs",
      "received_events_url" : "https://api.github.com/users/laanwj/received_events",
      "repos_url" : "https://api.github.com/users/laanwj/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/laanwj"
   },
   "comments" : 25,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21007/comments",
   "created_at" : "2021-01-25T22:06:34Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21007/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/21007",
   "id" : 793761007,
   "labels" : [
      {
         "color" : "d2db6d",
         "default" : false,
         "description" : "",
         "id" : 493267104,
         "name" : "Needs release note",
         "node_id" : "MDU6TGFiZWw0OTMyNjcxMDQ=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20release%20note"
      },
      {
         "color" : "5319e7",
         "default" : false,
         "description" : "",
         "id" : 241832923,
         "name" : "Utils/log/libs",
         "node_id" : "MDU6TGFiZWwyNDE4MzI5MjM=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Utils/log/libs"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21007/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDExOlB1bGxSZXF1ZXN0NTYxMzk0MDUw",
   "number" : 21007,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/21007.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21007",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/21007.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21007"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "bitcoind: Add -daemonwait option to wait for initialization",
   "updated_at" : "2021-03-11T14:28:54Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21007",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
      "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
      "followers_url" : "https://api.github.com/users/laanwj/followers",
      "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/laanwj",
      "id" : 126646,
      "login" : "laanwj",
      "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
      "organizations_url" : "https://api.github.com/users/laanwj/orgs",
      "received_events_url" : "https://api.github.com/users/laanwj/received_events",
      "repos_url" : "https://api.github.com/users/laanwj/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/laanwj"
   }
}
