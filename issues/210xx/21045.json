{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "In m4 builds we have the --disable-hardening switch that can be given in `./configure` to turn off randomized addresses. This PR provides a simple way of turning off randomized addresses in MSVC builds.\r\n\r\nThis PR:\r\n* Adds this option the common-init project file so that it can be globally set across the project\r\n* Documents this switch in msvc build readme\r\n\r\nI have run the following test to verify this works\r\n\r\nI ran the msvc build with `<RandomizedBaseAddress>true</RandomizedBaseAddress>` then checked `bitcoind.exe` and `bitcoin-cli.exe` with `dumpbin.exe`:\r\n\r\nbitcoind\r\n```\r\n> .\\dumpbin.exe /headers src/bitcoind.exe\r\nMicrosoft (R) COFF/PE Dumper Version 14.16.27045.0\r\n...\r\nOPTIONAL HEADER VALUES\r\n             20B magic # (PE32+)\r\n           14.28 linker version\r\n          AE4600 size of code\r\n          345C00 size of initialized data\r\n               0 size of uninitialized data\r\n          6BED74 entry point (00000001406BED74) mainCRTStartup\r\n            1000 base of code\r\n       140000000 image base (0000000140000000 to 0000000140E2DFFF)\r\n            1000 section alignment\r\n             200 file alignment\r\n            6.00 operating system version\r\n            0.00 image version\r\n            6.00 subsystem version\r\n               0 Win32 version\r\n          E2E000 size of image\r\n             400 size of headers\r\n               0 checksum\r\n               3 subsystem (Windows CUI)\r\n            8160 DLL characteristics\r\n                   High Entropy Virtual Addresses\r\n                   Dynamic base\r\n                   NX compatible\r\n                   Terminal Server Aware\r\n```\r\n\r\nbitcoin-cli\r\n```\r\n> .\\dumpbin.exe /headers src/bitcoin-cli.exe\r\nMicrosoft (R) COFF/PE Dumper Version 14.16.27045.0\r\n...\r\nOPTIONAL HEADER VALUES\r\n             20B magic # (PE32+)\r\n           14.28 linker version\r\n          1E3E00 size of code\r\n           92C00 size of initialized data\r\n               0 size of uninitialized data\r\n          104384 entry point (0000000140104384) mainCRTStartup\r\n            1000 base of code\r\n       140000000 image base (0000000140000000 to 0000000140279FFF)\r\n            1000 section alignment\r\n             200 file alignment\r\n            6.00 operating system version\r\n            0.00 image version\r\n            6.00 subsystem version\r\n               0 Win32 version\r\n          27A000 size of image\r\n             400 size of headers\r\n               0 checksum\r\n               3 subsystem (Windows CUI)\r\n            8160 DLL characteristics\r\n                   High Entropy Virtual Addresses\r\n                   Dynamic base\r\n                   NX compatible\r\n                   Terminal Server Aware\r\n```\r\n\r\nThen I built with `<RandomizedBaseAddress>false</RandomizedBaseAddress>` then checked `bitcoind.exe` and `bitcoin-cli.exe` with `dumpbin.exe` and observed that `Dynamic base` was longer listed in `OPTIONAL HEADER VALUES`\r\n\r\nbitcoind\r\n```\r\nPS C:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\Community\\VC\\Tools\\MSVC\\14.16.27023\\bin\\HostX64\\x64> .\\dumpbin.exe /headers C:\\Users\\e0\\Documents\\GitHub\\bitcoin021noaslr/src/bitcoind.exe\r\nMicrosoft (R) COFF/PE Dumper Version 14.16.27045.0\r\n...\r\nOPTIONAL HEADER VALUES\r\n             20B magic # (PE32+)\r\n           14.28 linker version\r\n          AE4600 size of code\r\n          33FE00 size of initialized data\r\n               0 size of uninitialized data\r\n          6BED74 entry point (00000001406BED74) mainCRTStartup\r\n            1000 base of code\r\n       140000000 image base (0000000140000000 to 0000000140E27FFF)\r\n            1000 section alignment\r\n             200 file alignment\r\n            6.00 operating system version\r\n            0.00 image version\r\n            6.00 subsystem version\r\n               0 Win32 version\r\n          E28000 size of image\r\n             400 size of headers\r\n               0 checksum\r\n               3 subsystem (Windows CUI)\r\n            8120 DLL characteristics\r\n                   High Entropy Virtual Addresses\r\n                   NX compatible\r\n                   Terminal Server Aware\r\n```\r\n\r\nbitcoin-cli\r\n```\r\n> .\\dumpbin.exe /headers src/bitcoin-cli.exe\r\nMicrosoft (R) COFF/PE Dumper Version 14.16.27045.0\r\n...\r\nOPTIONAL HEADER VALUES\r\n             20B magic # (PE32+)\r\n           14.28 linker version\r\n          1E3E00 size of code\r\n           90C00 size of initialized data\r\n               0 size of uninitialized data\r\n          104384 entry point (0000000140104384) mainCRTStartup\r\n            1000 base of code\r\n       140000000 image base (0000000140000000 to 0000000140277FFF)\r\n            1000 section alignment\r\n             200 file alignment\r\n            6.00 operating system version\r\n            0.00 image version\r\n            6.00 subsystem version\r\n               0 Win32 version\r\n          278000 size of image\r\n             400 size of headers\r\n               0 checksum\r\n               3 subsystem (Windows CUI)\r\n            8120 DLL characteristics\r\n                   High Entropy Virtual Addresses\r\n                   NX compatible\r\n                   Terminal Server Aware\r\n```\r\n",
   "closed_at" : "2021-04-29T20:14:58Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
      "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
      "followers_url" : "https://api.github.com/users/laanwj/followers",
      "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/laanwj",
      "id" : 126646,
      "login" : "laanwj",
      "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
      "organizations_url" : "https://api.github.com/users/laanwj/orgs",
      "received_events_url" : "https://api.github.com/users/laanwj/received_events",
      "repos_url" : "https://api.github.com/users/laanwj/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/laanwj"
   },
   "comments" : 7,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21045/comments",
   "created_at" : "2021-02-01T02:03:20Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21045/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/21045",
   "id" : 797887008,
   "labels" : [
      {
         "color" : "5319e7",
         "default" : false,
         "description" : null,
         "id" : 61889416,
         "name" : "Build system",
         "node_id" : "MDU6TGFiZWw2MTg4OTQxNg==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Build%20system"
      },
      {
         "color" : "884400",
         "default" : false,
         "description" : null,
         "id" : 234877,
         "name" : "Windows",
         "node_id" : "MDU6TGFiZWwyMzQ4Nzc=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Windows"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21045/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDExOlB1bGxSZXF1ZXN0NTY0Nzg4MjIz",
   "number" : 21045,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/21045.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21045",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/21045.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21045"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "build: adds switch to enable/disable randomized base address in MSVC builds",
   "updated_at" : "2021-04-29T20:14:58Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21045",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=4",
      "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
      "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
      "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
      "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/EthanHeilman",
      "id" : 274814,
      "login" : "EthanHeilman",
      "node_id" : "MDQ6VXNlcjI3NDgxNA==",
      "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
      "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
      "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/EthanHeilman"
   }
}
