{
   "active_lock_reason" : "resolved",
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "During coin selection, there are various places where we need to have a feerate. We need the feerate for the transaction itself, the discard fee rate, and long term feerate. Fetching these each time we need them can lead to a race condition where two feerates that should be the same are actually different. One particular instance where this can happen is during the loop in `CreateTransactionInternal`. After inputs are chosen, the expected transaction fee is calculated using a newly fetched feerate. If `pick_new_inputs == false`, the loop will go again with the assumption that the fee for the transaction remains the same. However because the feerate is fetched again, it is possible that it actually isn't and this causes coin selection to fail.\r\n\r\nInstead of fetching the feerate each time it is needed, we fetch them all at once at the top of `CreateTransactionInternal`, store them in `CoinSelectionParams`, and use them where needed.\r\n\r\nWhile some of these fee rates probably don't need this caching, I've done it for consistency and the guarantee that they remain the same.\r\n\r\nFixes #19229",
   "closed_at" : "2021-03-17T00:15:02Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/3211283?v=4",
      "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
      "followers_url" : "https://api.github.com/users/meshcollider/followers",
      "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
      "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/meshcollider",
      "id" : 3211283,
      "login" : "meshcollider",
      "node_id" : "MDQ6VXNlcjMyMTEyODM=",
      "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
      "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
      "repos_url" : "https://api.github.com/users/meshcollider/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/meshcollider"
   },
   "comments" : 12,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21083/comments",
   "created_at" : "2021-02-05T00:34:08Z",
   "draft" : false,
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21083/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/21083",
   "id" : 801741392,
   "labels" : [
      {
         "color" : "08a781",
         "default" : false,
         "description" : null,
         "id" : 149424,
         "name" : "Wallet",
         "node_id" : "MDU6TGFiZWwxNDk0MjQ=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21083/labels{/name}",
   "locked" : true,
   "milestone" : {
      "closed_at" : "2021-06-16T06:18:23Z",
      "closed_issues" : 13,
      "created_at" : "2020-10-20T10:10:58Z",
      "creator" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      },
      "description" : null,
      "due_on" : null,
      "html_url" : "https://github.com/bitcoin/bitcoin/milestone/50",
      "id" : 6011082,
      "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/milestones/50/labels",
      "node_id" : "MDk6TWlsZXN0b25lNjAxMTA4Mg==",
      "number" : 50,
      "open_issues" : 0,
      "state" : "closed",
      "title" : "0.21.1",
      "updated_at" : "2021-06-16T06:18:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/milestones/50"
   },
   "node_id" : "MDExOlB1bGxSZXF1ZXN0NTY4MDA0NTY1",
   "number" : 21083,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/21083.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21083",
      "merged_at" : "2021-03-17T00:15:02Z",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/21083.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083"
   },
   "reactions" : {
      "+1" : 0,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 0,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21083/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "state_reason" : null,
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21083/timeline",
   "title" : "wallet: Avoid requesting fee rates multiple times during coin selection",
   "updated_at" : "2022-08-16T17:07:12Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21083",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
      "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
      "followers_url" : "https://api.github.com/users/achow101/followers",
      "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/achow101",
      "id" : 3782274,
      "login" : "achow101",
      "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
      "organizations_url" : "https://api.github.com/users/achow101/orgs",
      "received_events_url" : "https://api.github.com/users/achow101/received_events",
      "repos_url" : "https://api.github.com/users/achow101/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/achow101"
   }
}
