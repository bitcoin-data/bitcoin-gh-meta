{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "I'm working on a project on MacOS that makes RPC calls using the Rust [bitcoincore-rpc crate](https://crates.io/crates/bitcoincore-rpc), against the bitcoind prebuilt binary available [here](https://bitcoincore.org/bin/bitcoin-core-23.0/bitcoin-23.0-x86_64-apple-darwin.tar.gz).\r\n\r\nSome RPC calls succeed, but some fail with this error:\r\n\r\n```\r\nError: Rpc(JsonRpc(Transport(SocketError(Os { code: 35, kind: WouldBlock, message: \"Resource temporarily unavailable\" }))))\r\n```\r\n\r\nAfter much debugging, we found that when we used the version of `bitcoind` provided by [homebrew](https://brew.sh/), the exact same sequence of RPC calls would succeed. We were able to reproduce this on both an x86 mac and an ARM mac.\r\n\r\nWe haven't been able to figure out what the disparity is, but looking at the homebrew [bitcoind formula defiinition](https://github.com/Homebrew/homebrew-core/blob/HEAD/Formula/bitcoin.rb) might provide some clues.\r\n\r\nIn particular:\r\n\r\n```\r\n  def install\r\n    system \"./autogen.sh\"\r\n    system \"./configure\", *std_configure_args,\r\n                          \"--disable-dependency-tracking\",\r\n                          \"--disable-silent-rules\",\r\n                          \"--with-boost-libdir=#{Formula[\"boost@1.76\"].opt_lib}\"\r\n    system \"make\", \"install\"\r\n    pkgshare.install \"share/rpcauth\"\r\n  end\r\n```\r\n\r\nIt looks like homebrew is passing additional arguments to `configure`, `std_configure_args`, and is using a version of boost built by homebrew. I tried using `brew install -s boost@1.76 bitcoind`, to see if this also produced a binary that worked, and it did. The logs from that build are available [here](https://github.com/casey/homebrew-bitcoind-build-logs).\r\n\r\nI've run into similar problems like this one a few times before, i.e., RPC calls to bitcoind failing on MacOS due to inscrutable I/O errors. One time, I was able to fix it by increasing the open file limit using `ulimit -n BIG_NUMBER`, but that doesn't seem to work here.\r\n\r\nMy best guess is that the homebrew poeople have gotten pretty good at configuring packages on MacOS, and they're passing some flag, or using a patched version of boost, or linking it differently, such that the binary they produce isn't affected by this issue.",
   "closed_at" : "2022-10-26T23:14:33Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
      "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
      "followers_url" : "https://api.github.com/users/achow101/followers",
      "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/achow101",
      "id" : 3782274,
      "login" : "achow101",
      "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
      "organizations_url" : "https://api.github.com/users/achow101/orgs",
      "received_events_url" : "https://api.github.com/users/achow101/received_events",
      "repos_url" : "https://api.github.com/users/achow101/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/achow101"
   },
   "comments" : 16,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25724/comments",
   "created_at" : "2022-07-27T21:30:51Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25724/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/25724",
   "id" : 1320141793,
   "labels" : [
      {
         "color" : "FBBAAB",
         "default" : false,
         "description" : null,
         "id" : 64585,
         "name" : "Bug",
         "node_id" : "MDU6TGFiZWw2NDU4NQ==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug"
      },
      {
         "color" : "660000",
         "default" : false,
         "description" : "",
         "id" : 234879,
         "name" : "macOS",
         "node_id" : "MDU6TGFiZWwyMzQ4Nzk=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/macOS"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25724/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "I_kwDOABII585Or8Ph",
   "number" : 25724,
   "performed_via_github_app" : null,
   "reactions" : {
      "+1" : 1,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 1,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25724/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "state_reason" : "completed",
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25724/timeline",
   "title" : "MacOS: `importdescriptors` RPC call very slow with release and source-built binaries, but fast for homebrew binaries",
   "updated_at" : "2022-10-26T23:14:33Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25724",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/1945?v=4",
      "events_url" : "https://api.github.com/users/casey/events{/privacy}",
      "followers_url" : "https://api.github.com/users/casey/followers",
      "following_url" : "https://api.github.com/users/casey/following{/other_user}",
      "gists_url" : "https://api.github.com/users/casey/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/casey",
      "id" : 1945,
      "login" : "casey",
      "node_id" : "MDQ6VXNlcjE5NDU=",
      "organizations_url" : "https://api.github.com/users/casey/orgs",
      "received_events_url" : "https://api.github.com/users/casey/received_events",
      "repos_url" : "https://api.github.com/users/casey/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/casey/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/casey/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/casey"
   }
}
