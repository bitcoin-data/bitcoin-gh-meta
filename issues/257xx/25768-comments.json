[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#24683](https://github.com/bitcoin/bitcoin/pull/24683) (Add and use ForEachWallet by promag)\n* [#20892](https://github.com/bitcoin/bitcoin/pull/20892) (tests: Run both descriptor and legacy tests within a single test invocation by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-08-02T02:59:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#issuecomment-1201959223",
      "id" : 1201959223,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25768",
      "node_id" : "IC_kwDOABII585HpHE3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1201959223/reactions"
      },
      "updated_at" : "2022-08-31T05:43:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1201959223",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r940399989"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/940399989"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Question: Is this test meant to fail without the first commit?",
      "commit_id" : "b11cceaf16a6a674122947a5f12bfb00a75382fe",
      "created_at" : "2022-08-08T15:52:24Z",
      "diff_hunk" : "@@ -74,6 +79,41 @@ def run_test(self):\n         node.setmocktime(now + 36 * 60 * 60 + 600)\n         peer_second.wait_for_broadcast([txid])\n \n+        self.log.info(\"Chain of unconfirmed not-in-mempool txs are rebroadcast\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r940399989",
      "id" : 940399989,
      "line" : 82,
      "node_id" : "PRRC_kwDOABII5844DV11",
      "original_commit_id" : "b11cceaf16a6a674122947a5f12bfb00a75382fe",
      "original_line" : 82,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 29,
      "pull_request_review_id" : 1065412993,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/940399989/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-08T15:52:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/940399989",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r940414500"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/940414500"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes",
      "commit_id" : "b11cceaf16a6a674122947a5f12bfb00a75382fe",
      "created_at" : "2022-08-08T16:04:10Z",
      "diff_hunk" : "@@ -74,6 +79,41 @@ def run_test(self):\n         node.setmocktime(now + 36 * 60 * 60 + 600)\n         peer_second.wait_for_broadcast([txid])\n \n+        self.log.info(\"Chain of unconfirmed not-in-mempool txs are rebroadcast\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r940414500",
      "id" : 940414500,
      "in_reply_to_id" : 940399989,
      "line" : 82,
      "node_id" : "PRRC_kwDOABII5844DZYk",
      "original_commit_id" : "b11cceaf16a6a674122947a5f12bfb00a75382fe",
      "original_line" : 82,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 29,
      "pull_request_review_id" : 1065431869,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/940414500/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-08T16:04:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/940414500",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r947369069"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/947369069"
         }
      },
      "author_association" : "NONE",
      "body" : "nit: not sure if we need `pos` here doesn't seem to be used",
      "commit_id" : "b11cceaf16a6a674122947a5f12bfb00a75382fe",
      "created_at" : "2022-08-17T01:20:16Z",
      "diff_hunk" : "@@ -1818,32 +1818,37 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n     return result;\n }\n \n+std::vector<CWalletTx*> CWallet::GetSortedTxs()\n+{\n+    AssertLockHeld(cs_wallet);\n+    // Sort pending transactions based on their initial wallet insertion order\n+    std::map<int64_t, CWalletTx*> sorted_txs;\n+    for (auto& [wtxid, wtx] : mapWallet) {\n+        assert(wtx.GetHash() == wtxid);\n+        sorted_txs.insert(std::make_pair(wtx.nOrderPos, &wtx));\n+    }\n+    std::vector<CWalletTx*> out;\n+    for (auto [pos, wtx] : sorted_txs) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r947369069",
      "id" : 947369069,
      "line" : 1831,
      "node_id" : "PRRC_kwDOABII5844d7Rt",
      "original_commit_id" : "b11cceaf16a6a674122947a5f12bfb00a75382fe",
      "original_line" : 1831,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 14,
      "pull_request_review_id" : 1074932972,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/947369069/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-17T01:20:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/947369069",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15950706?v=4",
         "events_url" : "https://api.github.com/users/kevkevinpal/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kevkevinpal/followers",
         "following_url" : "https://api.github.com/users/kevkevinpal/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kevkevinpal/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kevkevinpal",
         "id" : 15950706,
         "login" : "kevkevinpal",
         "node_id" : "MDQ6VXNlcjE1OTUwNzA2",
         "organizations_url" : "https://api.github.com/users/kevkevinpal/orgs",
         "received_events_url" : "https://api.github.com/users/kevkevinpal/received_events",
         "repos_url" : "https://api.github.com/users/kevkevinpal/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kevkevinpal/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kevkevinpal/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kevkevinpal"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Concept ACK\r\nwas able to run the functional test on my local and it ran fine, still want to test on regtest but still new to the project so still learning",
      "created_at" : "2022-08-17T01:22:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#issuecomment-1217349939",
      "id" : 1217349939,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25768",
      "node_id" : "IC_kwDOABII585Ij0kz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1217349939/reactions"
      },
      "updated_at" : "2022-08-17T01:22:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1217349939",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15950706?v=4",
         "events_url" : "https://api.github.com/users/kevkevinpal/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kevkevinpal/followers",
         "following_url" : "https://api.github.com/users/kevkevinpal/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kevkevinpal/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kevkevinpal",
         "id" : 15950706,
         "login" : "kevkevinpal",
         "node_id" : "MDQ6VXNlcjE1OTUwNzA2",
         "organizations_url" : "https://api.github.com/users/kevkevinpal/orgs",
         "received_events_url" : "https://api.github.com/users/kevkevinpal/received_events",
         "repos_url" : "https://api.github.com/users/kevkevinpal/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kevkevinpal/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kevkevinpal/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kevkevinpal"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r949264337"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/949264337"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's passing for me on master :thinking: ",
      "commit_id" : "901b8645fe51c498fd6f14149da08589e34488aa",
      "created_at" : "2022-08-18T15:06:48Z",
      "diff_hunk" : "@@ -74,6 +79,41 @@ def run_test(self):\n         node.setmocktime(now + 36 * 60 * 60 + 600)\n         peer_second.wait_for_broadcast([txid])\n \n+        self.log.info(\"Chain of unconfirmed not-in-mempool txs are rebroadcast\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r949264337",
      "id" : 949264337,
      "in_reply_to_id" : 940399989,
      "line" : 82,
      "node_id" : "PRRC_kwDOABII5844lJ_R",
      "original_commit_id" : "b11cceaf16a6a674122947a5f12bfb00a75382fe",
      "original_line" : 82,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 29,
      "pull_request_review_id" : 1077536943,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/949264337/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-18T15:06:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/949264337",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r949281171"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/949281171"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Since master has `mapWallet` as a `std::unsorted_map`, this will now only fail randomly on it. It should fail half of the time, on average. I don't know how we can guarantee that the child will come before the parent in an unsorted map.",
      "commit_id" : "901b8645fe51c498fd6f14149da08589e34488aa",
      "created_at" : "2022-08-18T15:17:36Z",
      "diff_hunk" : "@@ -74,6 +79,41 @@ def run_test(self):\n         node.setmocktime(now + 36 * 60 * 60 + 600)\n         peer_second.wait_for_broadcast([txid])\n \n+        self.log.info(\"Chain of unconfirmed not-in-mempool txs are rebroadcast\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r949281171",
      "id" : 949281171,
      "in_reply_to_id" : 940399989,
      "line" : 82,
      "node_id" : "PRRC_kwDOABII5844lOGT",
      "original_commit_id" : "b11cceaf16a6a674122947a5f12bfb00a75382fe",
      "original_line" : 82,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 29,
      "pull_request_review_id" : 1077559871,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/949281171/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-18T15:17:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/949281171",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r949294145"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/949294145"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've removed the \"make a spend that will come before\" and updated the comment to explain that.",
      "commit_id" : "901b8645fe51c498fd6f14149da08589e34488aa",
      "created_at" : "2022-08-18T15:26:48Z",
      "diff_hunk" : "@@ -74,6 +79,41 @@ def run_test(self):\n         node.setmocktime(now + 36 * 60 * 60 + 600)\n         peer_second.wait_for_broadcast([txid])\n \n+        self.log.info(\"Chain of unconfirmed not-in-mempool txs are rebroadcast\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r949294145",
      "id" : 949294145,
      "in_reply_to_id" : 940399989,
      "line" : 82,
      "node_id" : "PRRC_kwDOABII5844lRRB",
      "original_commit_id" : "b11cceaf16a6a674122947a5f12bfb00a75382fe",
      "original_line" : 82,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 29,
      "pull_request_review_id" : 1077575374,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/949294145/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-18T15:26:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/949294145",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r949294456"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/949294456"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "901b8645fe51c498fd6f14149da08589e34488aa",
      "created_at" : "2022-08-18T15:27:02Z",
      "diff_hunk" : "@@ -1818,32 +1818,37 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n     return result;\n }\n \n+std::vector<CWalletTx*> CWallet::GetSortedTxs()\n+{\n+    AssertLockHeld(cs_wallet);\n+    // Sort pending transactions based on their initial wallet insertion order\n+    std::map<int64_t, CWalletTx*> sorted_txs;\n+    for (auto& [wtxid, wtx] : mapWallet) {\n+        assert(wtx.GetHash() == wtxid);\n+        sorted_txs.insert(std::make_pair(wtx.nOrderPos, &wtx));\n+    }\n+    std::vector<CWalletTx*> out;\n+    for (auto [pos, wtx] : sorted_txs) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r949294456",
      "id" : 949294456,
      "in_reply_to_id" : 947369069,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5844lRV4",
      "original_commit_id" : "b11cceaf16a6a674122947a5f12bfb00a75382fe",
      "original_line" : 1831,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1077575775,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/949294456/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-18T15:27:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/949294456",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r949309147"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/949309147"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Hm, I see what you're saying about `std::unsorted_map` and it makes sense to me, but I've run the test >20 times and haven't gotten a failure yet...",
      "commit_id" : "901b8645fe51c498fd6f14149da08589e34488aa",
      "created_at" : "2022-08-18T15:39:43Z",
      "diff_hunk" : "@@ -74,6 +79,41 @@ def run_test(self):\n         node.setmocktime(now + 36 * 60 * 60 + 600)\n         peer_second.wait_for_broadcast([txid])\n \n+        self.log.info(\"Chain of unconfirmed not-in-mempool txs are rebroadcast\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r949309147",
      "id" : 949309147,
      "in_reply_to_id" : 940399989,
      "line" : 82,
      "node_id" : "PRRC_kwDOABII5844lU7b",
      "original_commit_id" : "b11cceaf16a6a674122947a5f12bfb00a75382fe",
      "original_line" : 82,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 29,
      "pull_request_review_id" : 1077596699,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/949309147/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-18T15:39:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/949309147",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r949359987"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/949359987"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Found a bug in the test. It should fail intermittently on master now",
      "commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "created_at" : "2022-08-18T16:26:54Z",
      "diff_hunk" : "@@ -74,6 +79,41 @@ def run_test(self):\n         node.setmocktime(now + 36 * 60 * 60 + 600)\n         peer_second.wait_for_broadcast([txid])\n \n+        self.log.info(\"Chain of unconfirmed not-in-mempool txs are rebroadcast\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r949359987",
      "id" : 949359987,
      "in_reply_to_id" : 940399989,
      "line" : 82,
      "node_id" : "PRRC_kwDOABII5844lhVz",
      "original_commit_id" : "b11cceaf16a6a674122947a5f12bfb00a75382fe",
      "original_line" : 82,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 29,
      "pull_request_review_id" : 1077665110,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/949359987/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-18T16:26:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/949359987",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r949367933"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/949367933"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Aha, fails intermittently on master for me now :) thanks!",
      "commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "created_at" : "2022-08-18T16:34:16Z",
      "diff_hunk" : "@@ -74,6 +79,41 @@ def run_test(self):\n         node.setmocktime(now + 36 * 60 * 60 + 600)\n         peer_second.wait_for_broadcast([txid])\n \n+        self.log.info(\"Chain of unconfirmed not-in-mempool txs are rebroadcast\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r949367933",
      "id" : 949367933,
      "in_reply_to_id" : 940399989,
      "line" : 82,
      "node_id" : "PRRC_kwDOABII5844ljR9",
      "original_commit_id" : "b11cceaf16a6a674122947a5f12bfb00a75382fe",
      "original_line" : 82,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 29,
      "pull_request_review_id" : 1077676409,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/949367933/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-18T16:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/949367933",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r949431753"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/949431753"
         }
      },
      "author_association" : "NONE",
      "body" : "I'm seeing the test fail intermittently on commit [e40ddf3](https://github.com/bitcoin/bitcoin/pull/25768/commits/e40ddf36bed81bdf28d386eb961c9ed22b69e207) does that sound right or should the test only fail on the master branch",
      "commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "created_at" : "2022-08-18T17:48:45Z",
      "diff_hunk" : "@@ -74,6 +79,41 @@ def run_test(self):\n         node.setmocktime(now + 36 * 60 * 60 + 600)\n         peer_second.wait_for_broadcast([txid])\n \n+        self.log.info(\"Chain of unconfirmed not-in-mempool txs are rebroadcast\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r949431753",
      "id" : 949431753,
      "in_reply_to_id" : 940399989,
      "line" : 82,
      "node_id" : "PRRC_kwDOABII5844ly3J",
      "original_commit_id" : "b11cceaf16a6a674122947a5f12bfb00a75382fe",
      "original_line" : 82,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 29,
      "pull_request_review_id" : 1077766051,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/949431753/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-18T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/949431753",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15950706?v=4",
         "events_url" : "https://api.github.com/users/kevkevinpal/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kevkevinpal/followers",
         "following_url" : "https://api.github.com/users/kevkevinpal/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kevkevinpal/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kevkevinpal",
         "id" : 15950706,
         "login" : "kevkevinpal",
         "node_id" : "MDQ6VXNlcjE1OTUwNzA2",
         "organizations_url" : "https://api.github.com/users/kevkevinpal/orgs",
         "received_events_url" : "https://api.github.com/users/kevkevinpal/received_events",
         "repos_url" : "https://api.github.com/users/kevkevinpal/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kevkevinpal/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kevkevinpal/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kevkevinpal"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r949457466"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/949457466"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It should only fail on master. It should not fail on this PR. Make sure that you've compiled this PR before running the test.",
      "commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "created_at" : "2022-08-18T18:20:51Z",
      "diff_hunk" : "@@ -74,6 +79,41 @@ def run_test(self):\n         node.setmocktime(now + 36 * 60 * 60 + 600)\n         peer_second.wait_for_broadcast([txid])\n \n+        self.log.info(\"Chain of unconfirmed not-in-mempool txs are rebroadcast\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r949457466",
      "id" : 949457466,
      "in_reply_to_id" : 940399989,
      "line" : 82,
      "node_id" : "PRRC_kwDOABII5844l5I6",
      "original_commit_id" : "b11cceaf16a6a674122947a5f12bfb00a75382fe",
      "original_line" : 82,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 29,
      "pull_request_review_id" : 1077802478,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/949457466/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-18T18:20:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/949457466",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r949600989"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/949600989"
         }
      },
      "author_association" : "NONE",
      "body" : "hmm I think I've compiled it correctly (still new to the repo so might be doing it incorrectly), this is what I did\r\n\r\n```\r\ngit fetch origin pull/25768/head:PR25768\r\ngit checkout  PR25768\r\n./autogen.sh\r\n./configure\r\nmake clean\r\nmake -j \"$(($(sysctl -n hw.physicalcpu)+1))\"\r\n./test/functional/wallet_resendwallettransactions.py\r\n```\r\n\r\nThis is the error I see after I run the test, sometimes it passes\r\n\r\n```\r\n2022-08-18T20:38:25.914000Z TestFramework (INFO): Initializing test directory /var/folders/9g/cvx014yx4dq5lwl_x5zvn_j80000gn/T/bitcoin_func_test_43xe3o56\r\n2022-08-18T20:38:28.879000Z TestFramework (INFO): Create a new transaction and wait until it's broadcast\r\n2022-08-18T20:38:29.627000Z TestFramework (INFO): Create a block\r\n2022-08-18T20:38:29.634000Z TestFramework (INFO): Bump time & check that transaction is rebroadcast\r\n2022-08-18T20:38:29.905000Z TestFramework (INFO): Chain of unconfirmed not-in-mempool txs are rebroadcast\r\n2022-08-18T20:38:31.037000Z TestFramework (ERROR): Assertion failed\r\nTraceback (most recent call last):\r\n  File \"/Users/kevkevin/DEVDIR/bitcoin/test/functional/test_framework/test_framework.py\", line 133, in main\r\n    self.run_test()\r\n  File \"/Users/kevkevin/DEVDIR/bitcoin/./test/functional/wallet_resendwallettransactions.py\", line 107, in run_test\r\n    assert_raises_rpc_error(-5, \"Transaction not in mempool\", node.getmempoolentry, txid)\r\n  File \"/Users/kevkevin/DEVDIR/bitcoin/test/functional/test_framework/util.py\", line 126, in assert_raises_rpc_error\r\n    assert try_rpc(code, message, fun, *args, **kwds), \"No exception raised\"\r\nAssertionError: No exception raised\r\n2022-08-18T20:38:31.089000Z TestFramework (INFO): Stopping nodes\r\n2022-08-18T20:38:31.508000Z TestFramework (WARNING): Not cleaning up dir /var/folders/9g/cvx014yx4dq5lwl_x5zvn_j80000gn/T/bitcoin_func_test_43xe3o56\r\n2022-08-18T20:38:31.508000Z TestFramework (ERROR): Test failed. Test logging available at /var/folders/9g/cvx014yx4dq5lwl_x5zvn_j80000gn/T/bitcoin_func_test_43xe3o56/test_framework.log\r\n2022-08-18T20:38:31.508000Z TestFramework (ERROR):\r\n2022-08-18T20:38:31.509000Z TestFramework (ERROR): Hint: Call /Users/kevkevin/DEVDIR/bitcoin/test/functional/combine_logs.py '/var/folders/9g/cvx014yx4dq5lwl_x5zvn_j80000gn/T/bitcoin_func_test_43xe3o56' to consolidate all logs\r\n2022-08-18T20:38:31.509000Z TestFramework (ERROR):\r\n2022-08-18T20:38:31.509000Z TestFramework (ERROR): If this failure happened unexpectedly or intermittently, please file a bug and provide a link or upload of the combined log.\r\n2022-08-18T20:38:31.509000Z TestFramework (ERROR): https://github.com/bitcoin/bitcoin/issues\r\n2022-08-18T20:38:31.509000Z TestFramework (ERROR):\r\n```\r\n\r\nrunning on MacOs Monterey Version 12.3.1 ",
      "commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "created_at" : "2022-08-18T21:04:47Z",
      "diff_hunk" : "@@ -74,6 +79,41 @@ def run_test(self):\n         node.setmocktime(now + 36 * 60 * 60 + 600)\n         peer_second.wait_for_broadcast([txid])\n \n+        self.log.info(\"Chain of unconfirmed not-in-mempool txs are rebroadcast\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r949600989",
      "id" : 949600989,
      "in_reply_to_id" : 940399989,
      "line" : 82,
      "node_id" : "PRRC_kwDOABII5844mcLd",
      "original_commit_id" : "b11cceaf16a6a674122947a5f12bfb00a75382fe",
      "original_line" : 82,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 29,
      "pull_request_review_id" : 1078006899,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/949600989/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-18T21:04:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/949600989",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15950706?v=4",
         "events_url" : "https://api.github.com/users/kevkevinpal/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kevkevinpal/followers",
         "following_url" : "https://api.github.com/users/kevkevinpal/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kevkevinpal/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kevkevinpal",
         "id" : 15950706,
         "login" : "kevkevinpal",
         "node_id" : "MDQ6VXNlcjE1OTUwNzA2",
         "organizations_url" : "https://api.github.com/users/kevkevinpal/orgs",
         "received_events_url" : "https://api.github.com/users/kevkevinpal/received_events",
         "repos_url" : "https://api.github.com/users/kevkevinpal/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kevkevinpal/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kevkevinpal/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kevkevinpal"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r949625730"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/949625730"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm not seeing that error even when running on a loop.",
      "commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "created_at" : "2022-08-18T21:40:44Z",
      "diff_hunk" : "@@ -74,6 +79,41 @@ def run_test(self):\n         node.setmocktime(now + 36 * 60 * 60 + 600)\n         peer_second.wait_for_broadcast([txid])\n \n+        self.log.info(\"Chain of unconfirmed not-in-mempool txs are rebroadcast\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r949625730",
      "id" : 949625730,
      "in_reply_to_id" : 940399989,
      "line" : 82,
      "node_id" : "PRRC_kwDOABII5844miOC",
      "original_commit_id" : "b11cceaf16a6a674122947a5f12bfb00a75382fe",
      "original_line" : 82,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 29,
      "pull_request_review_id" : 1078043153,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/949625730/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-18T21:40:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/949625730",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r949920275"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/949920275"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> git checkout  PR25768\r\n\r\nCan you check that `git log -1` prints the correct hash, or alternatively just checkout the correct hash directly? Also, make sure that the working tree is clean.\r\n\r\n```\r\ngit fetch origin e40ddf36bed81bdf28d386eb961c9ed22b69e207\r\ngit checkout e40ddf36bed81bdf28d386eb961c9ed22b69e207\r\ngit reset --hard HEAD # warning!! wipes unstaged changes in the tree if there still are some",
      "commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "created_at" : "2022-08-19T08:10:41Z",
      "diff_hunk" : "@@ -74,6 +79,41 @@ def run_test(self):\n         node.setmocktime(now + 36 * 60 * 60 + 600)\n         peer_second.wait_for_broadcast([txid])\n \n+        self.log.info(\"Chain of unconfirmed not-in-mempool txs are rebroadcast\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r949920275",
      "id" : 949920275,
      "in_reply_to_id" : 940399989,
      "line" : 82,
      "node_id" : "PRRC_kwDOABII5844nqIT",
      "original_commit_id" : "b11cceaf16a6a674122947a5f12bfb00a75382fe",
      "original_line" : 82,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 29,
      "pull_request_review_id" : 1078443840,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/949920275/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-19T08:10:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/949920275",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r950239284"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950239284"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Perhaps it's worth doing the test with, say, 10 parent-child pairs? That would catch this bug more reliably without needing to run the test multiple times.",
      "commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "created_at" : "2022-08-19T14:18:07Z",
      "diff_hunk" : "@@ -27,7 +29,10 @@ def run_test(self):\n         peer_first = node.add_p2p_connection(P2PTxInvStore())\n \n         self.log.info(\"Create a new transaction and wait until it's broadcast\")\n-        txid = node.sendtoaddress(node.getnewaddress(), 1)\n+        unspent = node.listunspent()\n+        parent_utxo = unspent[0]\n+        indep_utxo = unspent[1]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r950239284",
      "id" : 950239284,
      "line" : 34,
      "node_id" : "PRRC_kwDOABII5844o4A0",
      "original_commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "original_line" : 34,
      "original_position" : 20,
      "original_start_line" : 33,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 20,
      "pull_request_review_id" : 1078630992,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950239284/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 33,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-22T08:59:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950239284",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r950722047"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950722047"
         }
      },
      "author_association" : "NONE",
      "body" : "Sorry, I don't understand the need for `assert(wtx.GetHash() == wtxid);`. In which case can this `assert` fails? Only when the data is corrupted?",
      "commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "created_at" : "2022-08-20T17:37:16Z",
      "diff_hunk" : "@@ -1818,32 +1818,37 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n     return result;\n }\n \n+std::vector<CWalletTx*> CWallet::GetSortedTxs()\n+{\n+    AssertLockHeld(cs_wallet);\n+    // Sort pending transactions based on their initial wallet insertion order\n+    std::map<int64_t, CWalletTx*> sorted_txs;\n+    for (auto& [wtxid, wtx] : mapWallet) {\n+        assert(wtx.GetHash() == wtxid);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r950722047",
      "id" : 950722047,
      "line" : 1827,
      "node_id" : "PRRC_kwDOABII5844qt3_",
      "original_commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "original_line" : 1827,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 10,
      "pull_request_review_id" : 1079561177,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950722047/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-20T17:43:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950722047",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/54557628?v=4",
         "events_url" : "https://api.github.com/users/Riahiamirreza/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Riahiamirreza/followers",
         "following_url" : "https://api.github.com/users/Riahiamirreza/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Riahiamirreza/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Riahiamirreza",
         "id" : 54557628,
         "login" : "Riahiamirreza",
         "node_id" : "MDQ6VXNlcjU0NTU3NjI4",
         "organizations_url" : "https://api.github.com/users/Riahiamirreza/orgs",
         "received_events_url" : "https://api.github.com/users/Riahiamirreza/received_events",
         "repos_url" : "https://api.github.com/users/Riahiamirreza/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Riahiamirreza/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Riahiamirreza/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Riahiamirreza"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r950729044"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950729044"
         }
      },
      "author_association" : "MEMBER",
      "body" : "There is never a *need* for an assert. Assertions verify assumptions about the codebase, and should only fail if something you believe to be impossible in the codebase to be the case. It should *never* trigger, unless there is a bug in the code.\r\n\r\nBy writing this, the code author signals to readers of the code \"here you can assume that wtxid is always equal to `wtx.GetHash()`\". Further, this is verified during all tests, so we know it is also true for all scenarios any test case runs through.",
      "commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "created_at" : "2022-08-20T18:54:38Z",
      "diff_hunk" : "@@ -1818,32 +1818,37 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n     return result;\n }\n \n+std::vector<CWalletTx*> CWallet::GetSortedTxs()\n+{\n+    AssertLockHeld(cs_wallet);\n+    // Sort pending transactions based on their initial wallet insertion order\n+    std::map<int64_t, CWalletTx*> sorted_txs;\n+    for (auto& [wtxid, wtx] : mapWallet) {\n+        assert(wtx.GetHash() == wtxid);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r950729044",
      "id" : 950729044,
      "in_reply_to_id" : 950722047,
      "line" : 1827,
      "node_id" : "PRRC_kwDOABII5844qvlU",
      "original_commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "original_line" : 1827,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 10,
      "pull_request_review_id" : 1079568640,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950729044/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-20T18:54:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950729044",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r950765131"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950765131"
         }
      },
      "author_association" : "NONE",
      "body" : "still getting the error and I am able to see I'm on the correct commit with `git log -1` and tried thee commands you posted aswell, I'll try and dig deeper to see what may be the issue",
      "commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "created_at" : "2022-08-21T00:33:24Z",
      "diff_hunk" : "@@ -74,6 +79,41 @@ def run_test(self):\n         node.setmocktime(now + 36 * 60 * 60 + 600)\n         peer_second.wait_for_broadcast([txid])\n \n+        self.log.info(\"Chain of unconfirmed not-in-mempool txs are rebroadcast\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r950765131",
      "id" : 950765131,
      "in_reply_to_id" : 940399989,
      "line" : 82,
      "node_id" : "PRRC_kwDOABII5844q4ZL",
      "original_commit_id" : "b11cceaf16a6a674122947a5f12bfb00a75382fe",
      "original_line" : 82,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 29,
      "pull_request_review_id" : 1079602666,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950765131/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-21T00:33:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950765131",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15950706?v=4",
         "events_url" : "https://api.github.com/users/kevkevinpal/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kevkevinpal/followers",
         "following_url" : "https://api.github.com/users/kevkevinpal/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kevkevinpal/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kevkevinpal",
         "id" : 15950706,
         "login" : "kevkevinpal",
         "node_id" : "MDQ6VXNlcjE1OTUwNzA2",
         "organizations_url" : "https://api.github.com/users/kevkevinpal/orgs",
         "received_events_url" : "https://api.github.com/users/kevkevinpal/received_events",
         "repos_url" : "https://api.github.com/users/kevkevinpal/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kevkevinpal/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kevkevinpal/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kevkevinpal"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r950773406"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950773406"
         }
      },
      "author_association" : "NONE",
      "body" : "not exactly sure what happened but after rebuilding master then rebuilding this PR's branch twice the test passes now sorry for any confusion",
      "commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "created_at" : "2022-08-21T01:50:28Z",
      "diff_hunk" : "@@ -74,6 +79,41 @@ def run_test(self):\n         node.setmocktime(now + 36 * 60 * 60 + 600)\n         peer_second.wait_for_broadcast([txid])\n \n+        self.log.info(\"Chain of unconfirmed not-in-mempool txs are rebroadcast\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r950773406",
      "id" : 950773406,
      "in_reply_to_id" : 940399989,
      "line" : 82,
      "node_id" : "PRRC_kwDOABII5844q6ae",
      "original_commit_id" : "b11cceaf16a6a674122947a5f12bfb00a75382fe",
      "original_line" : 82,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 29,
      "pull_request_review_id" : 1079611195,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950773406/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-21T01:50:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950773406",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15950706?v=4",
         "events_url" : "https://api.github.com/users/kevkevinpal/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kevkevinpal/followers",
         "following_url" : "https://api.github.com/users/kevkevinpal/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kevkevinpal/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kevkevinpal",
         "id" : 15950706,
         "login" : "kevkevinpal",
         "node_id" : "MDQ6VXNlcjE1OTUwNzA2",
         "organizations_url" : "https://api.github.com/users/kevkevinpal/orgs",
         "received_events_url" : "https://api.github.com/users/kevkevinpal/received_events",
         "repos_url" : "https://api.github.com/users/kevkevinpal/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kevkevinpal/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kevkevinpal/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kevkevinpal"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Would you explain what is the difference between `ResendWalletTransactions` and `ReacceptWalletTransactions`?  As you said `ResendWalletTransactions` is used for normal rebroadcasting and `ReacceptWalletTransactions` is used for rebroadcasting on loading. I'm not sure what do you mean by \"loading\", you mean something like reindex or reorg?",
      "created_at" : "2022-08-21T16:27:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#issuecomment-1221578223",
      "id" : 1221578223,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25768",
      "node_id" : "IC_kwDOABII585Iz83v",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1221578223/reactions"
      },
      "updated_at" : "2022-08-21T16:27:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1221578223",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/54557628?v=4",
         "events_url" : "https://api.github.com/users/Riahiamirreza/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Riahiamirreza/followers",
         "following_url" : "https://api.github.com/users/Riahiamirreza/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Riahiamirreza/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Riahiamirreza",
         "id" : 54557628,
         "login" : "Riahiamirreza",
         "node_id" : "MDQ6VXNlcjU0NTU3NjI4",
         "organizations_url" : "https://api.github.com/users/Riahiamirreza/orgs",
         "received_events_url" : "https://api.github.com/users/Riahiamirreza/received_events",
         "repos_url" : "https://api.github.com/users/Riahiamirreza/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Riahiamirreza/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Riahiamirreza/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Riahiamirreza"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I'm not sure what do you mean by \"loading\", you mean something like reindex or reorg?\r\n\r\n\"Loading\" as in when the wallet is read from disk and loaded into memory.",
      "created_at" : "2022-08-21T16:36:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#issuecomment-1221579652",
      "id" : 1221579652,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25768",
      "node_id" : "IC_kwDOABII585Iz9OE",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1221579652/reactions"
      },
      "updated_at" : "2022-08-21T16:36:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1221579652",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "So what is the difference between rebroadcasting when loading and in normal cases?",
      "created_at" : "2022-08-21T16:55:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#issuecomment-1221582628",
      "id" : 1221582628,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25768",
      "node_id" : "IC_kwDOABII585Iz98k",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1221582628/reactions"
      },
      "updated_at" : "2022-08-21T16:55:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1221582628",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/54557628?v=4",
         "events_url" : "https://api.github.com/users/Riahiamirreza/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Riahiamirreza/followers",
         "following_url" : "https://api.github.com/users/Riahiamirreza/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Riahiamirreza/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Riahiamirreza",
         "id" : 54557628,
         "login" : "Riahiamirreza",
         "node_id" : "MDQ6VXNlcjU0NTU3NjI4",
         "organizations_url" : "https://api.github.com/users/Riahiamirreza/orgs",
         "received_events_url" : "https://api.github.com/users/Riahiamirreza/received_events",
         "repos_url" : "https://api.github.com/users/Riahiamirreza/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Riahiamirreza/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Riahiamirreza/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Riahiamirreza"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "There are differences in which transactions will be considered for rebroadcasting. On load, all non-abandoned transactions will be rebroadcast. The periodic rebroadcast will only rebroadcast those that are more than 5 minutes older than the most recent block.",
      "created_at" : "2022-08-21T17:04:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#issuecomment-1221583997",
      "id" : 1221583997,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25768",
      "node_id" : "IC_kwDOABII585Iz-R9",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1221583997/reactions"
      },
      "updated_at" : "2022-08-21T17:04:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1221583997",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r951186151"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951186151"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Wait, I see this is just moved and not new, but is this key wtxid or txid? Or does the \"w\" mean wallet instead of witness?\r\n\r\nIf it's wtxid, this assertion could fail when wtxid != txid since `CWalletTx::GetHash()` calls `tx->GetHash()`. But AFAICT it is a txid, so should be called txid instead? https://github.com/bitcoin/bitcoin/blob/02aefa169a9e6ed12c7bd8f3392adcd073d8d56b/src/wallet/wallet.cpp#L956-L971",
      "commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "created_at" : "2022-08-22T08:59:00Z",
      "diff_hunk" : "@@ -1818,32 +1818,37 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n     return result;\n }\n \n+std::vector<CWalletTx*> CWallet::GetSortedTxs()\n+{\n+    AssertLockHeld(cs_wallet);\n+    // Sort pending transactions based on their initial wallet insertion order\n+    std::map<int64_t, CWalletTx*> sorted_txs;\n+    for (auto& [wtxid, wtx] : mapWallet) {\n+        assert(wtx.GetHash() == wtxid);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r951186151",
      "id" : 951186151,
      "in_reply_to_id" : 950722047,
      "line" : 1827,
      "node_id" : "PRRC_kwDOABII5844sfLn",
      "original_commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "original_line" : 1827,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 10,
      "pull_request_review_id" : 1078630992,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951186151/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-22T09:00:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951186151",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r951620089"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951620089"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The \"w\" refers to \"wallet\".",
      "commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "created_at" : "2022-08-22T16:04:59Z",
      "diff_hunk" : "@@ -1818,32 +1818,37 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n     return result;\n }\n \n+std::vector<CWalletTx*> CWallet::GetSortedTxs()\n+{\n+    AssertLockHeld(cs_wallet);\n+    // Sort pending transactions based on their initial wallet insertion order\n+    std::map<int64_t, CWalletTx*> sorted_txs;\n+    for (auto& [wtxid, wtx] : mapWallet) {\n+        assert(wtx.GetHash() == wtxid);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r951620089",
      "id" : 951620089,
      "in_reply_to_id" : 950722047,
      "line" : 1827,
      "node_id" : "PRRC_kwDOABII5844uJH5",
      "original_commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "original_line" : 1827,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 10,
      "pull_request_review_id" : 1080759984,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951620089/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-22T16:05:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/951620089",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r953495707"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953495707"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is it good time to rename it to `wallet_txid` for clarification?\r\nWithout @glozow comment, i would just assume w stands for witness without any doubt...",
      "commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "created_at" : "2022-08-24T08:18:43Z",
      "diff_hunk" : "@@ -1818,32 +1818,37 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n     return result;\n }\n \n+std::vector<CWalletTx*> CWallet::GetSortedTxs()\n+{\n+    AssertLockHeld(cs_wallet);\n+    // Sort pending transactions based on their initial wallet insertion order\n+    std::map<int64_t, CWalletTx*> sorted_txs;\n+    for (auto& [wtxid, wtx] : mapWallet) {\n+        assert(wtx.GetHash() == wtxid);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r953495707",
      "id" : 953495707,
      "in_reply_to_id" : 950722047,
      "line" : 1827,
      "node_id" : "PRRC_kwDOABII58441TCb",
      "original_commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "original_line" : 1827,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 10,
      "pull_request_review_id" : 1083364044,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953495707/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-24T08:18:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953495707",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r953506952"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953506952"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This comment on scheduling the resending logic at 1 sec after the startup seems to be visible in the `StartWallets()` function, rather than in `ResendWalletTransactions()`'s `nNextResend` timepoint setting.\r\n\r\nSo maybe this comment should point to this part of the code instead?\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/713ea7a4181f411949a3e9bb9a358533388b1159/src/wallet/load.cpp#L154\r\n",
      "commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "created_at" : "2022-08-24T08:29:39Z",
      "diff_hunk" : "@@ -27,7 +29,10 @@ def run_test(self):\n         peer_first = node.add_p2p_connection(P2PTxInvStore())\n \n         self.log.info(\"Create a new transaction and wait until it's broadcast\")\n-        txid = node.sendtoaddress(node.getnewaddress(), 1)\n+        unspent = node.listunspent()\n+        parent_utxo = unspent[0]\n+        indep_utxo = unspent[1]\n+        txid = node.send(outputs=[{node.getnewaddress(): 1}], options={\"inputs\": [parent_utxo]})[\"txid\"]\n \n         # Wallet rebroadcast is first scheduled 1 sec after startup (see\n         # nNextResend in ResendWalletTransactions()). Tell scheduler to call",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r953506952",
      "id" : 953506952,
      "line" : 38,
      "node_id" : "PRRC_kwDOABII58441VyI",
      "original_commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "original_line" : 38,
      "original_position" : 24,
      "original_start_line" : 37,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 24,
      "pull_request_review_id" : 1083379726,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953506952/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 37,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-24T10:07:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953506952",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r953507075"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953507075"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "When looking at `CWallet::GetTxDepthInMainChain`, if `nDepth == 0`, isn't that equivalent to `!wtx->IsConfirmed() && !wtx->IsConflicted()`, which in turn in combination with `!wtx->isAbandoned()` is equivalent to `!wtx->IsUnconfirmed()` - am I missing something? (I know this is moved code)\r\n```suggestion\r\n        if (!wtx->IsCoinBase() && !wtx->IsUnconfirmed()) {\r\n```",
      "commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "created_at" : "2022-08-24T08:29:46Z",
      "diff_hunk" : "@@ -1818,32 +1818,37 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n     return result;\n }\n \n+std::vector<CWalletTx*> CWallet::GetSortedTxs()\n+{\n+    AssertLockHeld(cs_wallet);\n+    // Sort pending transactions based on their initial wallet insertion order\n+    std::map<int64_t, CWalletTx*> sorted_txs;\n+    for (auto& [wtxid, wtx] : mapWallet) {\n+        assert(wtx.GetHash() == wtxid);\n+        sorted_txs.insert(std::make_pair(wtx.nOrderPos, &wtx));\n+    }\n+    std::vector<CWalletTx*> out;\n+    for (auto [_, wtx] : sorted_txs) {\n+        out.push_back(wtx);\n+    }\n+    return out;\n+}\n+\n void CWallet::ReacceptWalletTransactions()\n {\n     // If transactions aren't being broadcasted, don't let them into local mempool either\n     if (!fBroadcastTransactions)\n         return;\n-    std::map<int64_t, CWalletTx*> mapSorted;\n \n-    // Sort pending wallet transactions based on their initial wallet insertion order\n-    for (std::pair<const uint256, CWalletTx>& item : mapWallet) {\n-        const uint256& wtxid = item.first;\n-        CWalletTx& wtx = item.second;\n-        assert(wtx.GetHash() == wtxid);\n-\n-        int nDepth = GetTxDepthInMainChain(wtx);\n+    // Try to add wallet transactions to memory pool\n+    for (auto wtx : GetSortedTxs()) {\n+        int nDepth = GetTxDepthInMainChain(*wtx);\n \n-        if (!wtx.IsCoinBase() && (nDepth == 0 && !wtx.isAbandoned())) {\n-            mapSorted.insert(std::make_pair(wtx.nOrderPos, &wtx));\n+        if (!wtx->IsCoinBase() && (nDepth == 0 && !wtx->isAbandoned())) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r953507075",
      "id" : 953507075,
      "line" : 1847,
      "node_id" : "PRRC_kwDOABII58441V0D",
      "original_commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "original_line" : 1847,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 40,
      "pull_request_review_id" : 1083379894,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953507075/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-24T08:45:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953507075",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r953510641"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953510641"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should we specify in variable name what kind of sorting is applied?",
      "commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "created_at" : "2022-08-24T08:33:06Z",
      "diff_hunk" : "@@ -1818,32 +1818,37 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n     return result;\n }\n \n+std::vector<CWalletTx*> CWallet::GetSortedTxs()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r953510641",
      "id" : 953510641,
      "line" : 1821,
      "node_id" : "PRRC_kwDOABII58441Wrx",
      "original_commit_id" : "9a556564e9dc64ae0ad723c78da33d0c982f006f",
      "original_line" : 1821,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 4,
      "pull_request_review_id" : 1083384871,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953510641/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-24T08:33:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953510641",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r953517049"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953517049"
         }
      },
      "author_association" : "MEMBER",
      "body" : "\"and relay\"?",
      "commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "created_at" : "2022-08-24T08:39:20Z",
      "diff_hunk" : "@@ -1914,15 +1919,14 @@ void CWallet::ResendWalletTransactions()\n     { // cs_wallet scope\n         LOCK(cs_wallet);\n \n-        // Relay transactions\n-        for (std::pair<const uint256, CWalletTx>& item : mapWallet) {\n-            CWalletTx& wtx = item.second;\n+        // Try to add wallet transactions to memory pool",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r953517049",
      "id" : 953517049,
      "line" : 1922,
      "node_id" : "PRRC_kwDOABII58441YP5",
      "original_commit_id" : "9a556564e9dc64ae0ad723c78da33d0c982f006f",
      "original_line" : 1922,
      "original_position" : 62,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 62,
      "pull_request_review_id" : 1083393818,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953517049/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-24T08:39:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953517049",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r953521903"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953521903"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I was about to add the same suggestion ð ",
      "commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "created_at" : "2022-08-24T08:43:59Z",
      "diff_hunk" : "@@ -1818,32 +1818,37 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n     return result;\n }\n \n+std::vector<CWalletTx*> CWallet::GetSortedTxs()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r953521903",
      "id" : 953521903,
      "in_reply_to_id" : 953510641,
      "line" : 1821,
      "node_id" : "PRRC_kwDOABII58441Zbv",
      "original_commit_id" : "9a556564e9dc64ae0ad723c78da33d0c982f006f",
      "original_line" : 1821,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 4,
      "pull_request_review_id" : 1083379894,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953521903/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-24T08:45:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953521903",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> This PR resolves this issue by refactoring ReacceptWalletTransactions sorting code into a separate function, then using that function in both ReacceptWalletTransactions and ResendWalletTransactions so that both functions will sort the transactions in the same order before processing for rebroadcast.\r\n\r\nIs it possible to shuffle transactions before `SubmitTxMemoryPoolAndRelay` rebroadcasting using [`std::shuffle`](https://en.cppreference.com/w/cpp/algorithm/random_shuffle)? Since only wallet txs are rebroadcasted which is a separate privacy issue, we could at least hide the order in which they were inserted in wallet db.",
      "created_at" : "2022-08-24T09:03:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#issuecomment-1225441024",
      "id" : 1225441024,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25768",
      "node_id" : "IC_kwDOABII585JCr8A",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1225441024/reactions"
      },
      "updated_at" : "2022-08-24T09:14:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1225441024",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/94559964?v=4",
         "events_url" : "https://api.github.com/users/1440000bytes/events{/privacy}",
         "followers_url" : "https://api.github.com/users/1440000bytes/followers",
         "following_url" : "https://api.github.com/users/1440000bytes/following{/other_user}",
         "gists_url" : "https://api.github.com/users/1440000bytes/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/1440000bytes",
         "id" : 94559964,
         "login" : "1440000bytes",
         "node_id" : "U_kgDOBaLe3A",
         "organizations_url" : "https://api.github.com/users/1440000bytes/orgs",
         "received_events_url" : "https://api.github.com/users/1440000bytes/received_events",
         "repos_url" : "https://api.github.com/users/1440000bytes/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/1440000bytes/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/1440000bytes/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/1440000bytes"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r953605477"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953605477"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I am a bit confused on the intermittent test failure occurring here, maybe I am missing something.\r\n\r\nIsn't sorting the order by wallet insertion index is what this PR fixes? So why would it still fail to reboadcast if `child.txid() < parent.txid()`? \r\n\r\nAlso, does it make sense to have some unit testing to ensure this behavior of the `GetSorted()` function itself?  ",
      "commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "created_at" : "2022-08-24T10:05:30Z",
      "diff_hunk" : "@@ -74,6 +79,41 @@ def run_test(self):\n         node.setmocktime(now + 36 * 60 * 60 + 600)\n         peer_second.wait_for_broadcast([txid])\n \n+        self.log.info(\"Chain of unconfirmed not-in-mempool txs are rebroadcast\")\n+        # Ideally we would add a transaction that would spend the existing transaction and also be\n+        # in mapWallet before it. However mapWallet is a std::unsorted_map which means that it is\n+        # hard for us to externally construct such a transaction. So we will ignore that fact and\n+        # rely on the fact that because there are only two items in mapWallet, 50% of the time the\n+        # child will be placed before the parent in mapWallet. The incorrect behavior that this\n+        # test tries to catch should thus fail intermittently at a rate of 50%.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r953605477",
      "id" : 953605477,
      "line" : 88,
      "node_id" : "PRRC_kwDOABII58441t1l",
      "original_commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "original_line" : 88,
      "original_position" : 35,
      "original_start_line" : 83,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 35,
      "pull_request_review_id" : 1083379726,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953605477/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 83,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-24T10:07:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953605477",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r953795948"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953795948"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: could use a one-liner which imo is equally readable?\r\n```suggestion\r\n        parent_utxo, indep_utxo = node.listunspent()[:2]\r\n```",
      "commit_id" : "71b7709fa075dc4c9b55bb07304687724f67f0cb",
      "created_at" : "2022-08-24T13:22:24Z",
      "diff_hunk" : "@@ -27,7 +29,10 @@ def run_test(self):\n         peer_first = node.add_p2p_connection(P2PTxInvStore())\n \n         self.log.info(\"Create a new transaction and wait until it's broadcast\")\n-        txid = node.sendtoaddress(node.getnewaddress(), 1)\n+        unspent = node.listunspent()\n+        parent_utxo = unspent[0]\n+        indep_utxo = unspent[1]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r953795948",
      "id" : 953795948,
      "line" : 34,
      "node_id" : "PRRC_kwDOABII58442cVs",
      "original_commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "original_line" : 34,
      "original_position" : 20,
      "original_start_line" : 32,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 26,
      "pull_request_review_id" : 1083803936,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953795948/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 32,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-25T17:16:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953795948",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r953832319"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953832319"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: `DEFAULT_MEMPOOL_EXPIRY_HOURS` is defined in `test/functional/mempool_expiry.py`. Similarly to #25810, could move that to `messages.py` and have the benefit of using a named var instead of a less obvious literal?",
      "commit_id" : "71b7709fa075dc4c9b55bb07304687724f67f0cb",
      "created_at" : "2022-08-24T13:52:24Z",
      "diff_hunk" : "@@ -74,6 +79,41 @@ def run_test(self):\n         node.setmocktime(now + 36 * 60 * 60 + 600)\n         peer_second.wait_for_broadcast([txid])\n \n+        self.log.info(\"Chain of unconfirmed not-in-mempool txs are rebroadcast\")\n+        # Ideally we would add a transaction that would spend the existing transaction and also be\n+        # in mapWallet before it. However mapWallet is a std::unsorted_map which means that it is\n+        # hard for us to externally construct such a transaction. So we will ignore that fact and\n+        # rely on the fact that because there are only two items in mapWallet, 50% of the time the\n+        # child will be placed before the parent in mapWallet. The incorrect behavior that this\n+        # test tries to catch should thus fail intermittently at a rate of 50%.\n+        send_res = node.send(outputs=[{node.getnewaddress(): 0.5}], options={\"inputs\": [{\"txid\":txid, \"vout\":0}], \"add_to_wallet\": False})\n+        child_txid = send_res[\"txid\"]\n+        node.sendrawtransaction(send_res[\"hex\"])\n+        entry_time = node.getmempoolentry(child_txid)[\"time\"]\n+\n+        block_time = entry_time + 6 * 60\n+        node.setmocktime(block_time)\n+        block = create_block(int(node.getbestblockhash(), 16), create_coinbase(node.getblockcount() + 1), block_time)\n+        block.solve()\n+        node.submitblock(block.serialize().hex())\n+        node.syncwithvalidationinterfacequeue()\n+\n+        # Evict these txs from the mempool\n+        evict_time = block_time + 60 * 60 * 336 + 5",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r953832319",
      "id" : 953832319,
      "line" : 109,
      "node_id" : "PRRC_kwDOABII58442lN_",
      "original_commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "original_line" : 109,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 86,
      "pull_request_review_id" : 1083803936,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953832319/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-25T17:16:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953832319",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r953893376"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953893376"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: perhaps useful to explain the `36` literal?\r\n```suggestion\r\n            node.setmocktime(evict_time + 36 * 60 * 60)  # 36h is the upper limit in CWallet::ResendWalletTransactions()`\r\n```",
      "commit_id" : "71b7709fa075dc4c9b55bb07304687724f67f0cb",
      "created_at" : "2022-08-24T14:42:39Z",
      "diff_hunk" : "@@ -74,6 +79,41 @@ def run_test(self):\n         node.setmocktime(now + 36 * 60 * 60 + 600)\n         peer_second.wait_for_broadcast([txid])\n \n+        self.log.info(\"Chain of unconfirmed not-in-mempool txs are rebroadcast\")\n+        # Ideally we would add a transaction that would spend the existing transaction and also be\n+        # in mapWallet before it. However mapWallet is a std::unsorted_map which means that it is\n+        # hard for us to externally construct such a transaction. So we will ignore that fact and\n+        # rely on the fact that because there are only two items in mapWallet, 50% of the time the\n+        # child will be placed before the parent in mapWallet. The incorrect behavior that this\n+        # test tries to catch should thus fail intermittently at a rate of 50%.\n+        send_res = node.send(outputs=[{node.getnewaddress(): 0.5}], options={\"inputs\": [{\"txid\":txid, \"vout\":0}], \"add_to_wallet\": False})\n+        child_txid = send_res[\"txid\"]\n+        node.sendrawtransaction(send_res[\"hex\"])\n+        entry_time = node.getmempoolentry(child_txid)[\"time\"]\n+\n+        block_time = entry_time + 6 * 60\n+        node.setmocktime(block_time)\n+        block = create_block(int(node.getbestblockhash(), 16), create_coinbase(node.getblockcount() + 1), block_time)\n+        block.solve()\n+        node.submitblock(block.serialize().hex())\n+        node.syncwithvalidationinterfacequeue()\n+\n+        # Evict these txs from the mempool\n+        evict_time = block_time + 60 * 60 * 336 + 5\n+        node.setmocktime(evict_time)\n+        indep_send = node.send(outputs=[{node.getnewaddress(): 1}], options={\"inputs\": [indep_utxo]})\n+        node.syncwithvalidationinterfacequeue()\n+        node.getmempoolentry(indep_send[\"txid\"])\n+        assert_raises_rpc_error(-5, \"Transaction not in mempool\", node.getmempoolentry, txid)\n+        assert_raises_rpc_error(-5, \"Transaction not in mempool\", node.getmempoolentry, child_txid)\n+\n+        # Rebroadcast and check that parent and child are both in the mempool\n+        with node.assert_debug_log(['ResendWalletTransactions: resubmit 2 unconfirmed transactions']):\n+            node.setmocktime(evict_time + 36 * 60 * 60)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r953893376",
      "id" : 953893376,
      "line" : 119,
      "node_id" : "PRRC_kwDOABII584420IA",
      "original_commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "original_line" : 119,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 96,
      "pull_request_review_id" : 1083803936,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953893376/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-25T17:16:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953893376",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r953921759"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953921759"
         }
      },
      "author_association" : "NONE",
      "body" : "The variable name also confused me , +1 to renaming it ",
      "commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "created_at" : "2022-08-24T15:06:01Z",
      "diff_hunk" : "@@ -1818,32 +1818,37 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n     return result;\n }\n \n+std::vector<CWalletTx*> CWallet::GetSortedTxs()\n+{\n+    AssertLockHeld(cs_wallet);\n+    // Sort pending transactions based on their initial wallet insertion order\n+    std::map<int64_t, CWalletTx*> sorted_txs;\n+    for (auto& [wtxid, wtx] : mapWallet) {\n+        assert(wtx.GetHash() == wtxid);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r953921759",
      "id" : 953921759,
      "in_reply_to_id" : 950722047,
      "line" : 1827,
      "node_id" : "PRRC_kwDOABII584427Df",
      "original_commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "original_line" : 1827,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 10,
      "pull_request_review_id" : 1083987653,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953921759/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-24T15:06:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953921759",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/87907936?v=4",
         "events_url" : "https://api.github.com/users/hernanmarino/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hernanmarino/followers",
         "following_url" : "https://api.github.com/users/hernanmarino/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hernanmarino/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hernanmarino",
         "id" : 87907936,
         "login" : "hernanmarino",
         "node_id" : "MDQ6VXNlcjg3OTA3OTM2",
         "organizations_url" : "https://api.github.com/users/hernanmarino/orgs",
         "received_events_url" : "https://api.github.com/users/hernanmarino/received_events",
         "repos_url" : "https://api.github.com/users/hernanmarino/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hernanmarino/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hernanmarino/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hernanmarino"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r953921801"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953921801"
         }
      },
      "author_association" : "NONE",
      "body" : "I got the same confusion before reading the entire thread, thought it came from witness...",
      "commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "created_at" : "2022-08-24T15:06:02Z",
      "diff_hunk" : "@@ -1818,32 +1818,37 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n     return result;\n }\n \n+std::vector<CWalletTx*> CWallet::GetSortedTxs()\n+{\n+    AssertLockHeld(cs_wallet);\n+    // Sort pending transactions based on their initial wallet insertion order\n+    std::map<int64_t, CWalletTx*> sorted_txs;\n+    for (auto& [wtxid, wtx] : mapWallet) {\n+        assert(wtx.GetHash() == wtxid);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r953921801",
      "id" : 953921801,
      "in_reply_to_id" : 950722047,
      "line" : 1827,
      "node_id" : "PRRC_kwDOABII584427EJ",
      "original_commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "original_line" : 1827,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 10,
      "pull_request_review_id" : 1083987709,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953921801/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-24T15:06:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953921801",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/110166421?v=4",
         "events_url" : "https://api.github.com/users/pablomartin4btc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pablomartin4btc/followers",
         "following_url" : "https://api.github.com/users/pablomartin4btc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pablomartin4btc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pablomartin4btc",
         "id" : 110166421,
         "login" : "pablomartin4btc",
         "node_id" : "U_kgDOBpEBlQ",
         "organizations_url" : "https://api.github.com/users/pablomartin4btc/orgs",
         "received_events_url" : "https://api.github.com/users/pablomartin4btc/received_events",
         "repos_url" : "https://api.github.com/users/pablomartin4btc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pablomartin4btc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pablomartin4btc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pablomartin4btc"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Is it possible to shuffle transactions before `SubmitTxMemoryPoolAndRelay` rebroadcasting using [`std::shuffle`](https://en.cppreference.com/w/cpp/algorithm/random_shuffle)? Since only wallet txs are rebroadcasted which is a separate privacy issue, we could at least hide the order in which they were inserted in wallet db.\r\n\r\nNo. Shuffling is the reason we have this issue in the first place (there is no order in an unsorted map so iterating it is basically the same as iterating a shuffled list). I don't think the insertion order is a privacy leak since it's the same order as when the transactions were originally broadcast which is public information to anyone that's connected to the network. Additionally, this is not a unilateral broadcast - it is up to the mempool relay code to determine when, how, and which transactions are actually rebroadcast. Only transactions that are not already in the mempool will be rebroadcast.",
      "created_at" : "2022-08-24T15:54:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#issuecomment-1225914465",
      "id" : 1225914465,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25768",
      "node_id" : "IC_kwDOABII585JEfhh",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1225914465/reactions"
      },
      "updated_at" : "2022-08-24T15:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1225914465",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r953985890"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953985890"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The variable names `wtxid` and `wtx` are used very frequently throughout the wallet code to refer to wallet transactions and their txids. If people find this confusing, then I think it would be more appropriate to have a scripted-diff PR rename all of those rather than renaming each individual instance that occurs in a PR.",
      "commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "created_at" : "2022-08-24T15:56:34Z",
      "diff_hunk" : "@@ -1818,32 +1818,37 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n     return result;\n }\n \n+std::vector<CWalletTx*> CWallet::GetSortedTxs()\n+{\n+    AssertLockHeld(cs_wallet);\n+    // Sort pending transactions based on their initial wallet insertion order\n+    std::map<int64_t, CWalletTx*> sorted_txs;\n+    for (auto& [wtxid, wtx] : mapWallet) {\n+        assert(wtx.GetHash() == wtxid);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r953985890",
      "id" : 953985890,
      "in_reply_to_id" : 950722047,
      "line" : 1827,
      "node_id" : "PRRC_kwDOABII58443Kti",
      "original_commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "original_line" : 1827,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 10,
      "pull_request_review_id" : 1084077199,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953985890/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-24T15:56:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953985890",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r953995963"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953995963"
         }
      },
      "author_association" : "NONE",
      "body" : "you meant the variable? the change is on `void CWallet::ResendWalletTransactions()`.",
      "commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "created_at" : "2022-08-24T16:05:19Z",
      "diff_hunk" : "@@ -1914,15 +1919,14 @@ void CWallet::ResendWalletTransactions()\n     { // cs_wallet scope\n         LOCK(cs_wallet);\n \n-        // Relay transactions\n-        for (std::pair<const uint256, CWalletTx>& item : mapWallet) {\n-            CWalletTx& wtx = item.second;\n+        // Try to add wallet transactions to memory pool",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r953995963",
      "id" : 953995963,
      "in_reply_to_id" : 953517049,
      "line" : 1922,
      "node_id" : "PRRC_kwDOABII58443NK7",
      "original_commit_id" : "9a556564e9dc64ae0ad723c78da33d0c982f006f",
      "original_line" : 1922,
      "original_position" : 62,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 62,
      "pull_request_review_id" : 1084090764,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953995963/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-24T16:05:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/953995963",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/110166421?v=4",
         "events_url" : "https://api.github.com/users/pablomartin4btc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pablomartin4btc/followers",
         "following_url" : "https://api.github.com/users/pablomartin4btc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pablomartin4btc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pablomartin4btc",
         "id" : 110166421,
         "login" : "pablomartin4btc",
         "node_id" : "U_kgDOBpEBlQ",
         "organizations_url" : "https://api.github.com/users/pablomartin4btc/orgs",
         "received_events_url" : "https://api.github.com/users/pablomartin4btc/received_events",
         "repos_url" : "https://api.github.com/users/pablomartin4btc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pablomartin4btc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pablomartin4btc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pablomartin4btc"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r954000712"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954000712"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, those should be equivalent. Will do if I need to re-push.",
      "commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "created_at" : "2022-08-24T16:09:37Z",
      "diff_hunk" : "@@ -1818,32 +1818,37 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n     return result;\n }\n \n+std::vector<CWalletTx*> CWallet::GetSortedTxs()\n+{\n+    AssertLockHeld(cs_wallet);\n+    // Sort pending transactions based on their initial wallet insertion order\n+    std::map<int64_t, CWalletTx*> sorted_txs;\n+    for (auto& [wtxid, wtx] : mapWallet) {\n+        assert(wtx.GetHash() == wtxid);\n+        sorted_txs.insert(std::make_pair(wtx.nOrderPos, &wtx));\n+    }\n+    std::vector<CWalletTx*> out;\n+    for (auto [_, wtx] : sorted_txs) {\n+        out.push_back(wtx);\n+    }\n+    return out;\n+}\n+\n void CWallet::ReacceptWalletTransactions()\n {\n     // If transactions aren't being broadcasted, don't let them into local mempool either\n     if (!fBroadcastTransactions)\n         return;\n-    std::map<int64_t, CWalletTx*> mapSorted;\n \n-    // Sort pending wallet transactions based on their initial wallet insertion order\n-    for (std::pair<const uint256, CWalletTx>& item : mapWallet) {\n-        const uint256& wtxid = item.first;\n-        CWalletTx& wtx = item.second;\n-        assert(wtx.GetHash() == wtxid);\n-\n-        int nDepth = GetTxDepthInMainChain(wtx);\n+    // Try to add wallet transactions to memory pool\n+    for (auto wtx : GetSortedTxs()) {\n+        int nDepth = GetTxDepthInMainChain(*wtx);\n \n-        if (!wtx.IsCoinBase() && (nDepth == 0 && !wtx.isAbandoned())) {\n-            mapSorted.insert(std::make_pair(wtx.nOrderPos, &wtx));\n+        if (!wtx->IsCoinBase() && (nDepth == 0 && !wtx->isAbandoned())) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r954000712",
      "id" : 954000712,
      "in_reply_to_id" : 953507075,
      "line" : 1847,
      "node_id" : "PRRC_kwDOABII58443OVI",
      "original_commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "original_line" : 1847,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 40,
      "pull_request_review_id" : 1084097496,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954000712/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-24T16:09:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954000712",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r954007405"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954007405"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Isn't sorting the order by wallet insertion index is what this PR fixes? So why would it still fail to reboadcast if `child.txid() < parent.txid()`?\r\n\r\nThe comment is talking about the code before this PR and how the test tries to catch it, not that this test should fail intermittently after the PR.\r\n\r\n> Also, does it make sense to have some unit testing to ensure this behavior of the `GetSorted()` function itself?\r\n\r\nThere are already tests for the underlying `wtxOrdered` itself (or tests that end up testing that behavior, although perhaps not specifically).",
      "commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "created_at" : "2022-08-24T16:16:00Z",
      "diff_hunk" : "@@ -74,6 +79,41 @@ def run_test(self):\n         node.setmocktime(now + 36 * 60 * 60 + 600)\n         peer_second.wait_for_broadcast([txid])\n \n+        self.log.info(\"Chain of unconfirmed not-in-mempool txs are rebroadcast\")\n+        # Ideally we would add a transaction that would spend the existing transaction and also be\n+        # in mapWallet before it. However mapWallet is a std::unsorted_map which means that it is\n+        # hard for us to externally construct such a transaction. So we will ignore that fact and\n+        # rely on the fact that because there are only two items in mapWallet, 50% of the time the\n+        # child will be placed before the parent in mapWallet. The incorrect behavior that this\n+        # test tries to catch should thus fail intermittently at a rate of 50%.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r954007405",
      "id" : 954007405,
      "in_reply_to_id" : 953605477,
      "line" : 88,
      "node_id" : "PRRC_kwDOABII58443P9t",
      "original_commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "original_line" : 88,
      "original_position" : 35,
      "original_start_line" : 83,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 35,
      "pull_request_review_id" : 1084108351,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954007405/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 83,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-24T16:16:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954007405",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> No. Shuffling is the reason we have this issue in the first place (there is no order in an unsorted map so iterating it is basically the same as iterating a shuffled list). \r\n\r\nI was suggesting to shuffle the sorted list before rebroadcast. So we have all the transactions we need but do not relay in that order.\r\n\r\n> I don't think the insertion order is a privacy leak since it's the same order as when the transactions were originally broadcast which is public information to anyone that's connected to the network.\r\n\r\nIn that case, feel free to ignore my suggestion. ",
      "created_at" : "2022-08-24T16:22:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#issuecomment-1225951484",
      "id" : 1225951484,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25768",
      "node_id" : "IC_kwDOABII585JEoj8",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1225951484/reactions"
      },
      "updated_at" : "2022-08-24T16:22:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1225951484",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/94559964?v=4",
         "events_url" : "https://api.github.com/users/1440000bytes/events{/privacy}",
         "followers_url" : "https://api.github.com/users/1440000bytes/followers",
         "following_url" : "https://api.github.com/users/1440000bytes/following{/other_user}",
         "gists_url" : "https://api.github.com/users/1440000bytes/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/1440000bytes",
         "id" : 94559964,
         "login" : "1440000bytes",
         "node_id" : "U_kgDOBaLe3A",
         "organizations_url" : "https://api.github.com/users/1440000bytes/orgs",
         "received_events_url" : "https://api.github.com/users/1440000bytes/received_events",
         "repos_url" : "https://api.github.com/users/1440000bytes/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/1440000bytes/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/1440000bytes/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/1440000bytes"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2022-08-24T16:23:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#issuecomment-1225951698",
      "id" : 1225951698,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25768",
      "node_id" : "IC_kwDOABII585JEonS",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1225951698/reactions"
      },
      "updated_at" : "2022-08-24T16:23:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1225951698",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/94559964?v=4",
         "events_url" : "https://api.github.com/users/1440000bytes/events{/privacy}",
         "followers_url" : "https://api.github.com/users/1440000bytes/followers",
         "following_url" : "https://api.github.com/users/1440000bytes/following{/other_user}",
         "gists_url" : "https://api.github.com/users/1440000bytes/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/1440000bytes",
         "id" : 94559964,
         "login" : "1440000bytes",
         "node_id" : "U_kgDOBaLe3A",
         "organizations_url" : "https://api.github.com/users/1440000bytes/orgs",
         "received_events_url" : "https://api.github.com/users/1440000bytes/received_events",
         "repos_url" : "https://api.github.com/users/1440000bytes/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/1440000bytes/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/1440000bytes/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/1440000bytes"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I was suggesting to shuffle the sorted list before rebroadcast. So we have all the transactions we need but do not relay in that order.\r\n\r\nShuffling after sorting would just undo the sorting. Sorting is not used for filtering; it is used because we need to have the transactions in order. Specifically parent transactions must be rebroadcast before child transactions, and that specific order can be obtained through the insertion order.\r\n\r\nWhile we could do something more complicated like actually building packages so that the actually order dependent things are grouped together, and then shuffling the packages, but I don't see the benefit in doing that. That might actually harm privacy because we would be broadcasting transactions that are related to each other at the same time, but only those transactions that are related to our wallet. Since a package that the wallet builds may exclude other transactions in the package that the mempool would know about, we could essentially be telling other nodes some of the scripts that our wallet is watching for as they could then look at what the rebroadcast package has that the rest of the package in the mempool does not.",
      "created_at" : "2022-08-24T16:34:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#issuecomment-1225965812",
      "id" : 1225965812,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25768",
      "node_id" : "IC_kwDOABII585JEsD0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1225965812/reactions"
      },
      "updated_at" : "2022-08-24T16:34:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1225965812",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r954040401"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954040401"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "So that means the code should not fail intermittently?? I will double check again that I am testing the correct binary, but I thoughts that's expected behavior from the comment.. ",
      "commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "created_at" : "2022-08-24T16:49:06Z",
      "diff_hunk" : "@@ -74,6 +79,41 @@ def run_test(self):\n         node.setmocktime(now + 36 * 60 * 60 + 600)\n         peer_second.wait_for_broadcast([txid])\n \n+        self.log.info(\"Chain of unconfirmed not-in-mempool txs are rebroadcast\")\n+        # Ideally we would add a transaction that would spend the existing transaction and also be\n+        # in mapWallet before it. However mapWallet is a std::unsorted_map which means that it is\n+        # hard for us to externally construct such a transaction. So we will ignore that fact and\n+        # rely on the fact that because there are only two items in mapWallet, 50% of the time the\n+        # child will be placed before the parent in mapWallet. The incorrect behavior that this\n+        # test tries to catch should thus fail intermittently at a rate of 50%.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r954040401",
      "id" : 954040401,
      "in_reply_to_id" : 953605477,
      "line" : 88,
      "node_id" : "PRRC_kwDOABII58443YBR",
      "original_commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "original_line" : 88,
      "original_position" : 35,
      "original_start_line" : 83,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 35,
      "pull_request_review_id" : 1084184375,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954040401/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 83,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-24T16:49:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954040401",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r954046581"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954046581"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It should only fail intermittently on master.",
      "commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "created_at" : "2022-08-24T16:54:43Z",
      "diff_hunk" : "@@ -74,6 +79,41 @@ def run_test(self):\n         node.setmocktime(now + 36 * 60 * 60 + 600)\n         peer_second.wait_for_broadcast([txid])\n \n+        self.log.info(\"Chain of unconfirmed not-in-mempool txs are rebroadcast\")\n+        # Ideally we would add a transaction that would spend the existing transaction and also be\n+        # in mapWallet before it. However mapWallet is a std::unsorted_map which means that it is\n+        # hard for us to externally construct such a transaction. So we will ignore that fact and\n+        # rely on the fact that because there are only two items in mapWallet, 50% of the time the\n+        # child will be placed before the parent in mapWallet. The incorrect behavior that this\n+        # test tries to catch should thus fail intermittently at a rate of 50%.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r954046581",
      "id" : 954046581,
      "in_reply_to_id" : 953605477,
      "line" : 88,
      "node_id" : "PRRC_kwDOABII58443Zh1",
      "original_commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "original_line" : 88,
      "original_position" : 35,
      "original_start_line" : 83,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 35,
      "pull_request_review_id" : 1084197557,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954046581/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 83,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-24T16:54:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954046581",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Based on some discussions during the PR review club today, I've made several changes to this PR. The first is that `ResendWalletTransaction` and `ReacceptWalletTransactions` are now combined into a single function `ResubmitWalletTranasctions`. There were some subtle differences between the two functions that are being preserved by using two optional parameters. The first difference is that `ReacceptWalletTransactions` would not actually ask the mempool to relay the transactions (there is a parameter for relay in `SubmitTxMemoryPoolAndRelay` that was different in both). There is a parameter `relay` with a default of `true` to handle that. The second is that `ResendWalletTransactions` would look chain status (is ibd, reindexing, etc.) and transaction time in order to determine whether to try submitting a transaction, whereas `ReacceptWalletTransactions` would not. To match the `ReaccpetWalletTransactions` behavior, a `force` option with a default of `false` is added that will bypass those checks.\r\n\r\nAdditionally, `nNextResend` was initialized the first time `ResendWalletTransactions` was run. As the new `ResubmitWalletTransactions` is always run on start, I've removed from the test the need to force it to be run as well as the handling around not actually trying to resend during that first run (we want to do the reaccept behavior in that first run). I've also removed `GetSortedTxs` and have instead taken the suggestion of filtering then sorting the transactions. This is done by inserting the `CWalletTx`s that we want to submit into a `std::set` with a custom comparator that uses `CWalletTx.nOrderPos` to determine the sort order.\r\n\r\nLastly I've updated the test to reliably fail on master. I found that `listreceivedbyaddress` and related RPCs will output txids in the order that they are found in `mapWallet`. The new test will use that to check if the child is positioned before the parent, and if it is not, it will remake the child until it does.",
      "created_at" : "2022-08-24T21:52:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#issuecomment-1226444094",
      "id" : 1226444094,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25768",
      "node_id" : "IC_kwDOABII585JGg0-",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1226444094/reactions"
      },
      "updated_at" : "2022-08-24T21:53:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1226444094",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r954331424"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954331424"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The comment is removed now that this behavior is no longer needed.",
      "commit_id" : "fee0dea1b1e32832dc5efca3621cfc8ba7c6c8f9",
      "created_at" : "2022-08-24T21:53:32Z",
      "diff_hunk" : "@@ -27,7 +29,10 @@ def run_test(self):\n         peer_first = node.add_p2p_connection(P2PTxInvStore())\n \n         self.log.info(\"Create a new transaction and wait until it's broadcast\")\n-        txid = node.sendtoaddress(node.getnewaddress(), 1)\n+        unspent = node.listunspent()\n+        parent_utxo = unspent[0]\n+        indep_utxo = unspent[1]\n+        txid = node.send(outputs=[{node.getnewaddress(): 1}], options={\"inputs\": [parent_utxo]})[\"txid\"]\n \n         # Wallet rebroadcast is first scheduled 1 sec after startup (see\n         # nNextResend in ResendWalletTransactions()). Tell scheduler to call",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r954331424",
      "id" : 954331424,
      "in_reply_to_id" : 953506952,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58444fEg",
      "original_commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "original_line" : 38,
      "original_position" : 24,
      "original_start_line" : 37,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : null,
      "pull_request_review_id" : 1084554689,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954331424/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-24T21:53:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954331424",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r954331626"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954331626"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "fee0dea1b1e32832dc5efca3621cfc8ba7c6c8f9",
      "created_at" : "2022-08-24T21:53:52Z",
      "diff_hunk" : "@@ -1818,32 +1818,37 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n     return result;\n }\n \n+std::vector<CWalletTx*> CWallet::GetSortedTxs()\n+{\n+    AssertLockHeld(cs_wallet);\n+    // Sort pending transactions based on their initial wallet insertion order\n+    std::map<int64_t, CWalletTx*> sorted_txs;\n+    for (auto& [wtxid, wtx] : mapWallet) {\n+        assert(wtx.GetHash() == wtxid);\n+        sorted_txs.insert(std::make_pair(wtx.nOrderPos, &wtx));\n+    }\n+    std::vector<CWalletTx*> out;\n+    for (auto [_, wtx] : sorted_txs) {\n+        out.push_back(wtx);\n+    }\n+    return out;\n+}\n+\n void CWallet::ReacceptWalletTransactions()\n {\n     // If transactions aren't being broadcasted, don't let them into local mempool either\n     if (!fBroadcastTransactions)\n         return;\n-    std::map<int64_t, CWalletTx*> mapSorted;\n \n-    // Sort pending wallet transactions based on their initial wallet insertion order\n-    for (std::pair<const uint256, CWalletTx>& item : mapWallet) {\n-        const uint256& wtxid = item.first;\n-        CWalletTx& wtx = item.second;\n-        assert(wtx.GetHash() == wtxid);\n-\n-        int nDepth = GetTxDepthInMainChain(wtx);\n+    // Try to add wallet transactions to memory pool\n+    for (auto wtx : GetSortedTxs()) {\n+        int nDepth = GetTxDepthInMainChain(*wtx);\n \n-        if (!wtx.IsCoinBase() && (nDepth == 0 && !wtx.isAbandoned())) {\n-            mapSorted.insert(std::make_pair(wtx.nOrderPos, &wtx));\n+        if (!wtx->IsCoinBase() && (nDepth == 0 && !wtx->isAbandoned())) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r954331626",
      "id" : 954331626,
      "in_reply_to_id" : 953507075,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58444fHq",
      "original_commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "original_line" : 1847,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1084554952,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954331626/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-24T21:53:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954331626",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r954332841"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954332841"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "fee0dea1b1e32832dc5efca3621cfc8ba7c6c8f9",
      "created_at" : "2022-08-24T21:55:45Z",
      "diff_hunk" : "@@ -1914,15 +1919,14 @@ void CWallet::ResendWalletTransactions()\n     { // cs_wallet scope\n         LOCK(cs_wallet);\n \n-        // Relay transactions\n-        for (std::pair<const uint256, CWalletTx>& item : mapWallet) {\n-            CWalletTx& wtx = item.second;\n+        // Try to add wallet transactions to memory pool",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r954332841",
      "id" : 954332841,
      "in_reply_to_id" : 953517049,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58444fap",
      "original_commit_id" : "9a556564e9dc64ae0ad723c78da33d0c982f006f",
      "original_line" : 1922,
      "original_position" : 62,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1084556488,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954332841/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-24T21:55:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954332841",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r954332953"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954332953"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The function has ended up being removed.",
      "commit_id" : "fee0dea1b1e32832dc5efca3621cfc8ba7c6c8f9",
      "created_at" : "2022-08-24T21:55:57Z",
      "diff_hunk" : "@@ -1818,32 +1818,37 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n     return result;\n }\n \n+std::vector<CWalletTx*> CWallet::GetSortedTxs()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r954332953",
      "id" : 954332953,
      "in_reply_to_id" : 953510641,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58444fcZ",
      "original_commit_id" : "9a556564e9dc64ae0ad723c78da33d0c982f006f",
      "original_line" : 1821,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1084556628,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954332953/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-24T21:55:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954332953",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r954333221"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954333221"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've reimplemented the test so that it always fails on master.",
      "commit_id" : "fee0dea1b1e32832dc5efca3621cfc8ba7c6c8f9",
      "created_at" : "2022-08-24T21:56:21Z",
      "diff_hunk" : "@@ -27,7 +29,10 @@ def run_test(self):\n         peer_first = node.add_p2p_connection(P2PTxInvStore())\n \n         self.log.info(\"Create a new transaction and wait until it's broadcast\")\n-        txid = node.sendtoaddress(node.getnewaddress(), 1)\n+        unspent = node.listunspent()\n+        parent_utxo = unspent[0]\n+        indep_utxo = unspent[1]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r954333221",
      "id" : 954333221,
      "in_reply_to_id" : 950239284,
      "line" : 34,
      "node_id" : "PRRC_kwDOABII58444fgl",
      "original_commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "original_line" : 34,
      "original_position" : 20,
      "original_start_line" : 33,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 26,
      "pull_request_review_id" : 1084556947,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954333221/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 33,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-24T21:56:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954333221",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r954333296"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954333296"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Renamed to `txid`.",
      "commit_id" : "fee0dea1b1e32832dc5efca3621cfc8ba7c6c8f9",
      "created_at" : "2022-08-24T21:56:29Z",
      "diff_hunk" : "@@ -1818,32 +1818,37 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n     return result;\n }\n \n+std::vector<CWalletTx*> CWallet::GetSortedTxs()\n+{\n+    AssertLockHeld(cs_wallet);\n+    // Sort pending transactions based on their initial wallet insertion order\n+    std::map<int64_t, CWalletTx*> sorted_txs;\n+    for (auto& [wtxid, wtx] : mapWallet) {\n+        assert(wtx.GetHash() == wtxid);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r954333296",
      "id" : 954333296,
      "in_reply_to_id" : 950722047,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58444fhw",
      "original_commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "original_line" : 1827,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1084557038,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954333296/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-24T21:56:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954333296",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r954595959"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954595959"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'd say this comment is now slightly outdated. My first thought was \"so all those calls with force=true will spam now?\". Then I realized they all have `relay=false`.\r\n\r\nI think extending this comment would improve readability. Might as well document what force does exactly (in broader terms is fine).",
      "commit_id" : "fee0dea1b1e32832dc5efca3621cfc8ba7c6c8f9",
      "created_at" : "2022-08-25T07:27:12Z",
      "diff_hunk" : "@@ -1886,43 +1858,57 @@ std::set<uint256> CWallet::GetTxConflicts(const CWalletTx& wtx) const\n     return result;\n }\n \n-// Rebroadcast transactions from the wallet. We do this on a random timer\n-// to slightly obfuscate which transactions come from our wallet.\n+// Resubmit transactions from the wallet to the mempool, optionally asking the\n+// mempool to relay them. On startup, we will do this for all unconfirmed\n+// transactions but will not ask the mempool to relay them. Otherwise this\n+// function is called periodically in order to relay our unconfirmed txs.\n+// We do this on a random timer to slightly obfuscate which transactions\n+// come from our wallet.\n //\n // Ideally, we'd only resend transactions that we think should have been\n // mined in the most recent block. Any transaction that wasn't in the top\n // blockweight of transactions in the mempool shouldn't have been mined,\n // and so is probably just sitting in the mempool waiting to be confirmed.\n // Rebroadcasting does nothing to speed up confirmation and only damages\n // privacy.\n-void CWallet::ResendWalletTransactions()\n+void CWallet::ResubmitWalletTransactions(bool relay, bool force)\n {\n+    // Don't attempt to resubmit if the wallet is configured to not broadcast,\n+    // even if forcing.\n+    if (!fBroadcastTransactions) return;\n+\n     // During reindex, importing and IBD, old wallet transactions become",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r954595959",
      "id" : 954595959,
      "line" : 1880,
      "node_id" : "PRRC_kwDOABII58445fp3",
      "original_commit_id" : "bec0579357daebb420d0249caf4665428221a61f",
      "original_line" : 1880,
      "original_position" : 61,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 61,
      "pull_request_review_id" : 1084916987,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954595959/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-25T07:27:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954595959",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r954600083"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954600083"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It took me some time to realize why it's safe. I think it's worth expanding `On startup, we will do this for all unconfirmed // transactions but will not ask the mempool to relay them.` saying it protects privacy as a side effect?\r\n",
      "commit_id" : "fee0dea1b1e32832dc5efca3621cfc8ba7c6c8f9",
      "created_at" : "2022-08-25T07:31:49Z",
      "diff_hunk" : "@@ -1886,43 +1858,57 @@ std::set<uint256> CWallet::GetTxConflicts(const CWalletTx& wtx) const\n     return result;\n }\n \n-// Rebroadcast transactions from the wallet. We do this on a random timer\n-// to slightly obfuscate which transactions come from our wallet.\n+// Resubmit transactions from the wallet to the mempool, optionally asking the\n+// mempool to relay them. On startup, we will do this for all unconfirmed\n+// transactions but will not ask the mempool to relay them. Otherwise this\n+// function is called periodically in order to relay our unconfirmed txs.\n+// We do this on a random timer to slightly obfuscate which transactions\n+// come from our wallet.\n //\n // Ideally, we'd only resend transactions that we think should have been\n // mined in the most recent block. Any transaction that wasn't in the top\n // blockweight of transactions in the mempool shouldn't have been mined,\n // and so is probably just sitting in the mempool waiting to be confirmed.\n // Rebroadcasting does nothing to speed up confirmation and only damages\n // privacy.\n-void CWallet::ResendWalletTransactions()\n+void CWallet::ResubmitWalletTransactions(bool relay, bool force)\n {\n+    // Don't attempt to resubmit if the wallet is configured to not broadcast,\n+    // even if forcing.\n+    if (!fBroadcastTransactions) return;\n+\n     // During reindex, importing and IBD, old wallet transactions become\n     // unconfirmed. Don't resend them as that would spam other nodes.\n-    if (!chain().isReadyToBroadcast()) return;\n+    if (!force && !chain().isReadyToBroadcast()) return;\n \n     // Do this infrequently and randomly to avoid giving away\n     // that these are our transactions.\n-    if (GetTime() < nNextResend || !fBroadcastTransactions) return;\n-    bool fFirst = (nNextResend == 0);\n+    if (!force && GetTime() < nNextResend) return;\n     // resend 12-36 hours from now, ~1 day on average.\n     nNextResend = GetTime() + (12 * 60 * 60) + GetRand(24 * 60 * 60);\n-    if (fFirst) return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r954600083",
      "id" : 954600083,
      "line" : 1910,
      "node_id" : "PRRC_kwDOABII58445gqT",
      "original_commit_id" : "bec0579357daebb420d0249caf4665428221a61f",
      "original_line" : 1910,
      "original_position" : 73,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 73,
      "pull_request_review_id" : 1084922850,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954600083/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-25T07:31:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954600083",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r954605982"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954605982"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Slightly off-topic, is this code prone to privacy leaks? Imagine a fork appearing: one (empty) block with a timestamp in the past. Would many own transactions get rebroadcast? If yes, i assume other nodes won't forward them because they had them already, and it becomes apparent who is the source?",
      "commit_id" : "fee0dea1b1e32832dc5efca3621cfc8ba7c6c8f9",
      "created_at" : "2022-08-25T07:38:14Z",
      "diff_hunk" : "@@ -1886,43 +1858,57 @@ std::set<uint256> CWallet::GetTxConflicts(const CWalletTx& wtx) const\n     return result;\n }\n \n-// Rebroadcast transactions from the wallet. We do this on a random timer\n-// to slightly obfuscate which transactions come from our wallet.\n+// Resubmit transactions from the wallet to the mempool, optionally asking the\n+// mempool to relay them. On startup, we will do this for all unconfirmed\n+// transactions but will not ask the mempool to relay them. Otherwise this\n+// function is called periodically in order to relay our unconfirmed txs.\n+// We do this on a random timer to slightly obfuscate which transactions\n+// come from our wallet.\n //\n // Ideally, we'd only resend transactions that we think should have been\n // mined in the most recent block. Any transaction that wasn't in the top\n // blockweight of transactions in the mempool shouldn't have been mined,\n // and so is probably just sitting in the mempool waiting to be confirmed.\n // Rebroadcasting does nothing to speed up confirmation and only damages\n // privacy.\n-void CWallet::ResendWalletTransactions()\n+void CWallet::ResubmitWalletTransactions(bool relay, bool force)\n {\n+    // Don't attempt to resubmit if the wallet is configured to not broadcast,\n+    // even if forcing.\n+    if (!fBroadcastTransactions) return;\n+\n     // During reindex, importing and IBD, old wallet transactions become\n     // unconfirmed. Don't resend them as that would spam other nodes.\n-    if (!chain().isReadyToBroadcast()) return;\n+    if (!force && !chain().isReadyToBroadcast()) return;\n \n     // Do this infrequently and randomly to avoid giving away\n     // that these are our transactions.\n-    if (GetTime() < nNextResend || !fBroadcastTransactions) return;\n-    bool fFirst = (nNextResend == 0);\n+    if (!force && GetTime() < nNextResend) return;\n     // resend 12-36 hours from now, ~1 day on average.\n     nNextResend = GetTime() + (12 * 60 * 60) + GetRand(24 * 60 * 60);\n-    if (fFirst) return;\n \n     int submitted_tx_count = 0;\n \n     { // cs_wallet scope\n         LOCK(cs_wallet);\n \n-        // Relay transactions\n-        for (std::pair<const uint256, CWalletTx>& item : mapWallet) {\n-            CWalletTx& wtx = item.second;\n-            // Attempt to rebroadcast all txes more than 5 minutes older than\n-            // the last block. SubmitTxMemoryPoolAndRelay() will not rebroadcast\n-            // any confirmed or conflicting txs.\n-            if (wtx.nTimeReceived > m_best_block_time - 5 * 60) continue;\n+        // First filter for the transactions we want to rebroadcast.\n+        // We use a set with WalletTxOrderComparator so that rebroadcasting occurs in insertion order\n+        std::set<CWalletTx*, WalletTxOrderComparator> to_submit;\n+        for (auto& [txid, wtx] : mapWallet) {\n+            // Only rebroadcast unconfirmed txs\n+            if (!wtx.isUnconfirmed()) continue;\n+\n+            // For periodic rebroadcast (force == false),\n+            // attempt to rebroadcast all txes more than 5 minutes older than\n+            // the last block.\n+            if (!force && wtx.nTimeReceived > m_best_block_time - 5 * 60) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r954605982",
      "id" : 954605982,
      "line" : 1905,
      "node_id" : "PRRC_kwDOABII58445iGe",
      "original_commit_id" : "bec0579357daebb420d0249caf4665428221a61f",
      "original_line" : 1905,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 97,
      "pull_request_review_id" : 1084935398,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954605982/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-25T07:38:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/954605982",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955059960"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955059960"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I might be wrong, but I thought we write bool variables with an `f` prefix, so should this be `frelay`? ",
      "commit_id" : "71b7709fa075dc4c9b55bb07304687724f67f0cb",
      "created_at" : "2022-08-25T14:44:01Z",
      "diff_hunk" : "@@ -1886,43 +1858,57 @@ std::set<uint256> CWallet::GetTxConflicts(const CWalletTx& wtx) const\n     return result;\n }\n \n-// Rebroadcast transactions from the wallet. We do this on a random timer\n-// to slightly obfuscate which transactions come from our wallet.\n+// Resubmit transactions from the wallet to the mempool, optionally asking the\n+// mempool to relay them. On startup, we will do this for all unconfirmed\n+// transactions but will not ask the mempool to relay them. Otherwise this\n+// function is called periodically in order to relay our unconfirmed txs.\n+// We do this on a random timer to slightly obfuscate which transactions\n+// come from our wallet.\n //\n // Ideally, we'd only resend transactions that we think should have been\n // mined in the most recent block. Any transaction that wasn't in the top\n // blockweight of transactions in the mempool shouldn't have been mined,\n // and so is probably just sitting in the mempool waiting to be confirmed.\n // Rebroadcasting does nothing to speed up confirmation and only damages\n // privacy.\n-void CWallet::ResendWalletTransactions()\n+void CWallet::ResubmitWalletTransactions(bool relay, bool force)\n {\n+    // Don't attempt to resubmit if the wallet is configured to not broadcast,\n+    // even if forcing.\n+    if (!fBroadcastTransactions) return;\n+\n     // During reindex, importing and IBD, old wallet transactions become\n     // unconfirmed. Don't resend them as that would spam other nodes.\n-    if (!chain().isReadyToBroadcast()) return;\n+    if (!force && !chain().isReadyToBroadcast()) return;\n \n     // Do this infrequently and randomly to avoid giving away\n     // that these are our transactions.\n-    if (GetTime() < nNextResend || !fBroadcastTransactions) return;\n-    bool fFirst = (nNextResend == 0);\n+    if (!force && GetTime() < nNextResend) return;\n     // resend 12-36 hours from now, ~1 day on average.\n     nNextResend = GetTime() + (12 * 60 * 60) + GetRand(24 * 60 * 60);\n-    if (fFirst) return;\n \n     int submitted_tx_count = 0;\n \n     { // cs_wallet scope\n         LOCK(cs_wallet);\n \n-        // Relay transactions\n-        for (std::pair<const uint256, CWalletTx>& item : mapWallet) {\n-            CWalletTx& wtx = item.second;\n-            // Attempt to rebroadcast all txes more than 5 minutes older than\n-            // the last block. SubmitTxMemoryPoolAndRelay() will not rebroadcast\n-            // any confirmed or conflicting txs.\n-            if (wtx.nTimeReceived > m_best_block_time - 5 * 60) continue;\n+        // First filter for the transactions we want to rebroadcast.\n+        // We use a set with WalletTxOrderComparator so that rebroadcasting occurs in insertion order\n+        std::set<CWalletTx*, WalletTxOrderComparator> to_submit;\n+        for (auto& [txid, wtx] : mapWallet) {\n+            // Only rebroadcast unconfirmed txs\n+            if (!wtx.isUnconfirmed()) continue;\n+\n+            // For periodic rebroadcast (force == false),\n+            // attempt to rebroadcast all txes more than 5 minutes older than\n+            // the last block.\n+            if (!force && wtx.nTimeReceived > m_best_block_time - 5 * 60) continue;\n+            to_submit.insert(&wtx);\n+        }\n+        // Now try submitting the transactions to the memory pool and (optionally) relay them.\n+        for (auto wtx : to_submit) {\n             std::string unused_err_string;\n-            if (SubmitTxMemoryPoolAndRelay(wtx, unused_err_string, true)) ++submitted_tx_count;\n+            if (SubmitTxMemoryPoolAndRelay(*wtx, unused_err_string, relay)) ++submitted_tx_count;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955059960",
      "id" : 955059960,
      "line" : 1924,
      "node_id" : "PRRC_kwDOABII58447Q74",
      "original_commit_id" : "fee0dea1b1e32832dc5efca3621cfc8ba7c6c8f9",
      "original_line" : 1924,
      "original_position" : 104,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 117,
      "pull_request_review_id" : 1085585668,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955059960/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-25T15:09:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955059960",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955066271"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955066271"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think so. Your own transactions would be submitted to your node's mempool first, and only if it does not know about those transactions will it try to broadcast them.",
      "commit_id" : "71b7709fa075dc4c9b55bb07304687724f67f0cb",
      "created_at" : "2022-08-25T14:48:57Z",
      "diff_hunk" : "@@ -1886,43 +1858,57 @@ std::set<uint256> CWallet::GetTxConflicts(const CWalletTx& wtx) const\n     return result;\n }\n \n-// Rebroadcast transactions from the wallet. We do this on a random timer\n-// to slightly obfuscate which transactions come from our wallet.\n+// Resubmit transactions from the wallet to the mempool, optionally asking the\n+// mempool to relay them. On startup, we will do this for all unconfirmed\n+// transactions but will not ask the mempool to relay them. Otherwise this\n+// function is called periodically in order to relay our unconfirmed txs.\n+// We do this on a random timer to slightly obfuscate which transactions\n+// come from our wallet.\n //\n // Ideally, we'd only resend transactions that we think should have been\n // mined in the most recent block. Any transaction that wasn't in the top\n // blockweight of transactions in the mempool shouldn't have been mined,\n // and so is probably just sitting in the mempool waiting to be confirmed.\n // Rebroadcasting does nothing to speed up confirmation and only damages\n // privacy.\n-void CWallet::ResendWalletTransactions()\n+void CWallet::ResubmitWalletTransactions(bool relay, bool force)\n {\n+    // Don't attempt to resubmit if the wallet is configured to not broadcast,\n+    // even if forcing.\n+    if (!fBroadcastTransactions) return;\n+\n     // During reindex, importing and IBD, old wallet transactions become\n     // unconfirmed. Don't resend them as that would spam other nodes.\n-    if (!chain().isReadyToBroadcast()) return;\n+    if (!force && !chain().isReadyToBroadcast()) return;\n \n     // Do this infrequently and randomly to avoid giving away\n     // that these are our transactions.\n-    if (GetTime() < nNextResend || !fBroadcastTransactions) return;\n-    bool fFirst = (nNextResend == 0);\n+    if (!force && GetTime() < nNextResend) return;\n     // resend 12-36 hours from now, ~1 day on average.\n     nNextResend = GetTime() + (12 * 60 * 60) + GetRand(24 * 60 * 60);\n-    if (fFirst) return;\n \n     int submitted_tx_count = 0;\n \n     { // cs_wallet scope\n         LOCK(cs_wallet);\n \n-        // Relay transactions\n-        for (std::pair<const uint256, CWalletTx>& item : mapWallet) {\n-            CWalletTx& wtx = item.second;\n-            // Attempt to rebroadcast all txes more than 5 minutes older than\n-            // the last block. SubmitTxMemoryPoolAndRelay() will not rebroadcast\n-            // any confirmed or conflicting txs.\n-            if (wtx.nTimeReceived > m_best_block_time - 5 * 60) continue;\n+        // First filter for the transactions we want to rebroadcast.\n+        // We use a set with WalletTxOrderComparator so that rebroadcasting occurs in insertion order\n+        std::set<CWalletTx*, WalletTxOrderComparator> to_submit;\n+        for (auto& [txid, wtx] : mapWallet) {\n+            // Only rebroadcast unconfirmed txs\n+            if (!wtx.isUnconfirmed()) continue;\n+\n+            // For periodic rebroadcast (force == false),\n+            // attempt to rebroadcast all txes more than 5 minutes older than\n+            // the last block.\n+            if (!force && wtx.nTimeReceived > m_best_block_time - 5 * 60) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955066271",
      "id" : 955066271,
      "in_reply_to_id" : 954605982,
      "line" : 1918,
      "node_id" : "PRRC_kwDOABII58447Sef",
      "original_commit_id" : "bec0579357daebb420d0249caf4665428221a61f",
      "original_line" : 1918,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 110,
      "pull_request_review_id" : 1085594854,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955066271/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-25T14:48:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955066271",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955075029"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955075029"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe this is simpler when written as `mockscheduler(600)`? ",
      "commit_id" : "71b7709fa075dc4c9b55bb07304687724f67f0cb",
      "created_at" : "2022-08-25T14:55:37Z",
      "diff_hunk" : "@@ -66,14 +66,61 @@ def run_test(self):\n         self.log.info(\"Bump time & check that transaction is rebroadcast\")\n         # Transaction should be rebroadcast approximately 24 hours in the future,\n         # but can range from 12-36. So bump 36 hours to be sure.\n-        with node.assert_debug_log(['ResendWalletTransactions: resubmit 1 unconfirmed transactions']):\n+        with node.assert_debug_log(['resubmit 1 unconfirmed transactions']):\n             node.setmocktime(now + 36 * 60 * 60)\n             # Tell scheduler to call MaybeResendWalletTxn now.\n             node.mockscheduler(1)\n         # Give some time for trickle to occur\n         node.setmocktime(now + 36 * 60 * 60 + 600)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955075029",
      "id" : 955075029,
      "line" : 74,
      "node_id" : "PRRC_kwDOABII58447UnV",
      "original_commit_id" : "fee0dea1b1e32832dc5efca3621cfc8ba7c6c8f9",
      "original_line" : 74,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 51,
      "pull_request_review_id" : 1085585668,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955075029/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-25T15:09:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955075029",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955107397"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955107397"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've expanded the comment and also added `relay` to the check. This way we guarantee that we won't spam if we want to relay, regardless of `force`.",
      "commit_id" : "71b7709fa075dc4c9b55bb07304687724f67f0cb",
      "created_at" : "2022-08-25T15:23:05Z",
      "diff_hunk" : "@@ -1886,43 +1858,57 @@ std::set<uint256> CWallet::GetTxConflicts(const CWalletTx& wtx) const\n     return result;\n }\n \n-// Rebroadcast transactions from the wallet. We do this on a random timer\n-// to slightly obfuscate which transactions come from our wallet.\n+// Resubmit transactions from the wallet to the mempool, optionally asking the\n+// mempool to relay them. On startup, we will do this for all unconfirmed\n+// transactions but will not ask the mempool to relay them. Otherwise this\n+// function is called periodically in order to relay our unconfirmed txs.\n+// We do this on a random timer to slightly obfuscate which transactions\n+// come from our wallet.\n //\n // Ideally, we'd only resend transactions that we think should have been\n // mined in the most recent block. Any transaction that wasn't in the top\n // blockweight of transactions in the mempool shouldn't have been mined,\n // and so is probably just sitting in the mempool waiting to be confirmed.\n // Rebroadcasting does nothing to speed up confirmation and only damages\n // privacy.\n-void CWallet::ResendWalletTransactions()\n+void CWallet::ResubmitWalletTransactions(bool relay, bool force)\n {\n+    // Don't attempt to resubmit if the wallet is configured to not broadcast,\n+    // even if forcing.\n+    if (!fBroadcastTransactions) return;\n+\n     // During reindex, importing and IBD, old wallet transactions become",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955107397",
      "id" : 955107397,
      "in_reply_to_id" : 954595959,
      "line" : 1892,
      "node_id" : "PRRC_kwDOABII58447chF",
      "original_commit_id" : "bec0579357daebb420d0249caf4665428221a61f",
      "original_line" : 1892,
      "original_position" : 61,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 73,
      "pull_request_review_id" : 1085658350,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955107397/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-25T15:23:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955107397",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955107531"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955107531"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "71b7709fa075dc4c9b55bb07304687724f67f0cb",
      "created_at" : "2022-08-25T15:23:10Z",
      "diff_hunk" : "@@ -1886,43 +1858,57 @@ std::set<uint256> CWallet::GetTxConflicts(const CWalletTx& wtx) const\n     return result;\n }\n \n-// Rebroadcast transactions from the wallet. We do this on a random timer\n-// to slightly obfuscate which transactions come from our wallet.\n+// Resubmit transactions from the wallet to the mempool, optionally asking the\n+// mempool to relay them. On startup, we will do this for all unconfirmed\n+// transactions but will not ask the mempool to relay them. Otherwise this\n+// function is called periodically in order to relay our unconfirmed txs.\n+// We do this on a random timer to slightly obfuscate which transactions\n+// come from our wallet.\n //\n // Ideally, we'd only resend transactions that we think should have been\n // mined in the most recent block. Any transaction that wasn't in the top\n // blockweight of transactions in the mempool shouldn't have been mined,\n // and so is probably just sitting in the mempool waiting to be confirmed.\n // Rebroadcasting does nothing to speed up confirmation and only damages\n // privacy.\n-void CWallet::ResendWalletTransactions()\n+void CWallet::ResubmitWalletTransactions(bool relay, bool force)\n {\n+    // Don't attempt to resubmit if the wallet is configured to not broadcast,\n+    // even if forcing.\n+    if (!fBroadcastTransactions) return;\n+\n     // During reindex, importing and IBD, old wallet transactions become\n     // unconfirmed. Don't resend them as that would spam other nodes.\n-    if (!chain().isReadyToBroadcast()) return;\n+    if (!force && !chain().isReadyToBroadcast()) return;\n \n     // Do this infrequently and randomly to avoid giving away\n     // that these are our transactions.\n-    if (GetTime() < nNextResend || !fBroadcastTransactions) return;\n-    bool fFirst = (nNextResend == 0);\n+    if (!force && GetTime() < nNextResend) return;\n     // resend 12-36 hours from now, ~1 day on average.\n     nNextResend = GetTime() + (12 * 60 * 60) + GetRand(24 * 60 * 60);\n-    if (fFirst) return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955107531",
      "id" : 955107531,
      "in_reply_to_id" : 954600083,
      "line" : 1910,
      "node_id" : "PRRC_kwDOABII58447cjL",
      "original_commit_id" : "bec0579357daebb420d0249caf4665428221a61f",
      "original_line" : 1910,
      "original_position" : 73,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 86,
      "pull_request_review_id" : 1085658480,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955107531/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-25T15:23:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955107531",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955108860"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955108860"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No. We have had a new style in effect for the past several years. It only applies to new code, so a bunch of the old code written under the old style is still around.",
      "commit_id" : "71b7709fa075dc4c9b55bb07304687724f67f0cb",
      "created_at" : "2022-08-25T15:24:10Z",
      "diff_hunk" : "@@ -1886,43 +1858,57 @@ std::set<uint256> CWallet::GetTxConflicts(const CWalletTx& wtx) const\n     return result;\n }\n \n-// Rebroadcast transactions from the wallet. We do this on a random timer\n-// to slightly obfuscate which transactions come from our wallet.\n+// Resubmit transactions from the wallet to the mempool, optionally asking the\n+// mempool to relay them. On startup, we will do this for all unconfirmed\n+// transactions but will not ask the mempool to relay them. Otherwise this\n+// function is called periodically in order to relay our unconfirmed txs.\n+// We do this on a random timer to slightly obfuscate which transactions\n+// come from our wallet.\n //\n // Ideally, we'd only resend transactions that we think should have been\n // mined in the most recent block. Any transaction that wasn't in the top\n // blockweight of transactions in the mempool shouldn't have been mined,\n // and so is probably just sitting in the mempool waiting to be confirmed.\n // Rebroadcasting does nothing to speed up confirmation and only damages\n // privacy.\n-void CWallet::ResendWalletTransactions()\n+void CWallet::ResubmitWalletTransactions(bool relay, bool force)\n {\n+    // Don't attempt to resubmit if the wallet is configured to not broadcast,\n+    // even if forcing.\n+    if (!fBroadcastTransactions) return;\n+\n     // During reindex, importing and IBD, old wallet transactions become\n     // unconfirmed. Don't resend them as that would spam other nodes.\n-    if (!chain().isReadyToBroadcast()) return;\n+    if (!force && !chain().isReadyToBroadcast()) return;\n \n     // Do this infrequently and randomly to avoid giving away\n     // that these are our transactions.\n-    if (GetTime() < nNextResend || !fBroadcastTransactions) return;\n-    bool fFirst = (nNextResend == 0);\n+    if (!force && GetTime() < nNextResend) return;\n     // resend 12-36 hours from now, ~1 day on average.\n     nNextResend = GetTime() + (12 * 60 * 60) + GetRand(24 * 60 * 60);\n-    if (fFirst) return;\n \n     int submitted_tx_count = 0;\n \n     { // cs_wallet scope\n         LOCK(cs_wallet);\n \n-        // Relay transactions\n-        for (std::pair<const uint256, CWalletTx>& item : mapWallet) {\n-            CWalletTx& wtx = item.second;\n-            // Attempt to rebroadcast all txes more than 5 minutes older than\n-            // the last block. SubmitTxMemoryPoolAndRelay() will not rebroadcast\n-            // any confirmed or conflicting txs.\n-            if (wtx.nTimeReceived > m_best_block_time - 5 * 60) continue;\n+        // First filter for the transactions we want to rebroadcast.\n+        // We use a set with WalletTxOrderComparator so that rebroadcasting occurs in insertion order\n+        std::set<CWalletTx*, WalletTxOrderComparator> to_submit;\n+        for (auto& [txid, wtx] : mapWallet) {\n+            // Only rebroadcast unconfirmed txs\n+            if (!wtx.isUnconfirmed()) continue;\n+\n+            // For periodic rebroadcast (force == false),\n+            // attempt to rebroadcast all txes more than 5 minutes older than\n+            // the last block.\n+            if (!force && wtx.nTimeReceived > m_best_block_time - 5 * 60) continue;\n+            to_submit.insert(&wtx);\n+        }\n+        // Now try submitting the transactions to the memory pool and (optionally) relay them.\n+        for (auto wtx : to_submit) {\n             std::string unused_err_string;\n-            if (SubmitTxMemoryPoolAndRelay(wtx, unused_err_string, true)) ++submitted_tx_count;\n+            if (SubmitTxMemoryPoolAndRelay(*wtx, unused_err_string, relay)) ++submitted_tx_count;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955108860",
      "id" : 955108860,
      "in_reply_to_id" : 955059960,
      "line" : 1924,
      "node_id" : "PRRC_kwDOABII58447c38",
      "original_commit_id" : "fee0dea1b1e32832dc5efca3621cfc8ba7c6c8f9",
      "original_line" : 1924,
      "original_position" : 104,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 117,
      "pull_request_review_id" : 1085660027,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955108860/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-25T15:24:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955108860",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955111328"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955111328"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`mockscheduler` does not change the mocked time.",
      "commit_id" : "71b7709fa075dc4c9b55bb07304687724f67f0cb",
      "created_at" : "2022-08-25T15:25:53Z",
      "diff_hunk" : "@@ -66,14 +66,61 @@ def run_test(self):\n         self.log.info(\"Bump time & check that transaction is rebroadcast\")\n         # Transaction should be rebroadcast approximately 24 hours in the future,\n         # but can range from 12-36. So bump 36 hours to be sure.\n-        with node.assert_debug_log(['ResendWalletTransactions: resubmit 1 unconfirmed transactions']):\n+        with node.assert_debug_log(['resubmit 1 unconfirmed transactions']):\n             node.setmocktime(now + 36 * 60 * 60)\n             # Tell scheduler to call MaybeResendWalletTxn now.\n             node.mockscheduler(1)\n         # Give some time for trickle to occur\n         node.setmocktime(now + 36 * 60 * 60 + 600)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955111328",
      "id" : 955111328,
      "in_reply_to_id" : 955075029,
      "line" : 74,
      "node_id" : "PRRC_kwDOABII58447deg",
      "original_commit_id" : "fee0dea1b1e32832dc5efca3621cfc8ba7c6c8f9",
      "original_line" : 74,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 51,
      "pull_request_review_id" : 1085663881,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955111328/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-25T15:25:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955111328",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955161231"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955161231"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good catch that `!IsCoinBase()` is redundant in combination with `!IsUnconfirmed()` ð ",
      "commit_id" : "71b7709fa075dc4c9b55bb07304687724f67f0cb",
      "created_at" : "2022-08-25T16:05:00Z",
      "diff_hunk" : "@@ -1818,32 +1818,37 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n     return result;\n }\n \n+std::vector<CWalletTx*> CWallet::GetSortedTxs()\n+{\n+    AssertLockHeld(cs_wallet);\n+    // Sort pending transactions based on their initial wallet insertion order\n+    std::map<int64_t, CWalletTx*> sorted_txs;\n+    for (auto& [wtxid, wtx] : mapWallet) {\n+        assert(wtx.GetHash() == wtxid);\n+        sorted_txs.insert(std::make_pair(wtx.nOrderPos, &wtx));\n+    }\n+    std::vector<CWalletTx*> out;\n+    for (auto [_, wtx] : sorted_txs) {\n+        out.push_back(wtx);\n+    }\n+    return out;\n+}\n+\n void CWallet::ReacceptWalletTransactions()\n {\n     // If transactions aren't being broadcasted, don't let them into local mempool either\n     if (!fBroadcastTransactions)\n         return;\n-    std::map<int64_t, CWalletTx*> mapSorted;\n \n-    // Sort pending wallet transactions based on their initial wallet insertion order\n-    for (std::pair<const uint256, CWalletTx>& item : mapWallet) {\n-        const uint256& wtxid = item.first;\n-        CWalletTx& wtx = item.second;\n-        assert(wtx.GetHash() == wtxid);\n-\n-        int nDepth = GetTxDepthInMainChain(wtx);\n+    // Try to add wallet transactions to memory pool\n+    for (auto wtx : GetSortedTxs()) {\n+        int nDepth = GetTxDepthInMainChain(*wtx);\n \n-        if (!wtx.IsCoinBase() && (nDepth == 0 && !wtx.isAbandoned())) {\n-            mapSorted.insert(std::make_pair(wtx.nOrderPos, &wtx));\n+        if (!wtx->IsCoinBase() && (nDepth == 0 && !wtx->isAbandoned())) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955161231",
      "id" : 955161231,
      "in_reply_to_id" : 953507075,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58447pqP",
      "original_commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "original_line" : 1847,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1083803936,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955161231/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-25T17:16:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955161231",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955165088"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955165088"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: intuitively I'd expect a `force` parameter to not respect flags like `fBroadcastTransactions`. I think something like `force_ready` would make it more obvious that this is not an absolute force. Probably personal preference?\r\n```suggestion\r\nvoid CWallet::ResubmitWalletTransactions(bool relay, bool force_ready)\r\n```",
      "commit_id" : "71b7709fa075dc4c9b55bb07304687724f67f0cb",
      "created_at" : "2022-08-25T16:07:57Z",
      "diff_hunk" : "@@ -1886,43 +1858,70 @@ std::set<uint256> CWallet::GetTxConflicts(const CWalletTx& wtx) const\n     return result;\n }\n \n-// Rebroadcast transactions from the wallet. We do this on a random timer\n-// to slightly obfuscate which transactions come from our wallet.\n+// Resubmit transactions from the wallet to the mempool, optionally asking the\n+// mempool to relay them. On startup, we will do this for all unconfirmed\n+// transactions but will not ask the mempool to relay them. We do this on startup\n+// to ensure that our own mempool is aware of our transactions, and to also\n+// initialize nNextResend so that the actual rebroadcast is scheduled. There\n+// is a privacy side effect here as not broadcasting on startup also means that we won't\n+// inform the world of our wallet's state, particularly if the wallet (or node) is not\n+// yet synced.\n+//\n+// Otherwise this function is called periodically in order to relay our unconfirmed txs.\n+// We do this on a random timer to slightly obfuscate which transactions\n+// come from our wallet.\n //\n // Ideally, we'd only resend transactions that we think should have been\n // mined in the most recent block. Any transaction that wasn't in the top\n // blockweight of transactions in the mempool shouldn't have been mined,\n // and so is probably just sitting in the mempool waiting to be confirmed.\n // Rebroadcasting does nothing to speed up confirmation and only damages\n // privacy.\n-void CWallet::ResendWalletTransactions()\n+//\n+// The `force` option results in all unconfirmed transactions being submitted to\n+// the mempool. This does not necessarily result in those transactions being relayed,\n+// that depends on the `relay` option. Periodic rebroadcast uses the pattern\n+// relay=true force=false (also the default values), while loading into the mempool\n+// (on start, or after import) uses relay=false force=true.\n+void CWallet::ResubmitWalletTransactions(bool relay, bool force)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955165088",
      "id" : 955165088,
      "line" : 1886,
      "node_id" : "PRRC_kwDOABII58447qmg",
      "original_commit_id" : "71b7709fa075dc4c9b55bb07304687724f67f0cb",
      "original_line" : 1886,
      "original_position" : 67,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 67,
      "pull_request_review_id" : 1083803936,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955165088/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-25T17:16:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955165088",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955182098"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955182098"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: I think this comment is confusing, from just this I'd think the below code _only_ executes for  periodic rebroadcast.\r\n\r\n```suggestion\r\n            // Attempt to rebroadcast all txes more than 5 minutes older than\r\n            // the last block, or all txes if force is true.\r\n```",
      "commit_id" : "71b7709fa075dc4c9b55bb07304687724f67f0cb",
      "created_at" : "2022-08-25T16:20:42Z",
      "diff_hunk" : "@@ -1886,43 +1858,70 @@ std::set<uint256> CWallet::GetTxConflicts(const CWalletTx& wtx) const\n     return result;\n }\n \n-// Rebroadcast transactions from the wallet. We do this on a random timer\n-// to slightly obfuscate which transactions come from our wallet.\n+// Resubmit transactions from the wallet to the mempool, optionally asking the\n+// mempool to relay them. On startup, we will do this for all unconfirmed\n+// transactions but will not ask the mempool to relay them. We do this on startup\n+// to ensure that our own mempool is aware of our transactions, and to also\n+// initialize nNextResend so that the actual rebroadcast is scheduled. There\n+// is a privacy side effect here as not broadcasting on startup also means that we won't\n+// inform the world of our wallet's state, particularly if the wallet (or node) is not\n+// yet synced.\n+//\n+// Otherwise this function is called periodically in order to relay our unconfirmed txs.\n+// We do this on a random timer to slightly obfuscate which transactions\n+// come from our wallet.\n //\n // Ideally, we'd only resend transactions that we think should have been\n // mined in the most recent block. Any transaction that wasn't in the top\n // blockweight of transactions in the mempool shouldn't have been mined,\n // and so is probably just sitting in the mempool waiting to be confirmed.\n // Rebroadcasting does nothing to speed up confirmation and only damages\n // privacy.\n-void CWallet::ResendWalletTransactions()\n+//\n+// The `force` option results in all unconfirmed transactions being submitted to\n+// the mempool. This does not necessarily result in those transactions being relayed,\n+// that depends on the `relay` option. Periodic rebroadcast uses the pattern\n+// relay=true force=false (also the default values), while loading into the mempool\n+// (on start, or after import) uses relay=false force=true.\n+void CWallet::ResubmitWalletTransactions(bool relay, bool force)\n {\n+    // Don't attempt to resubmit if the wallet is configured to not broadcast,\n+    // even if forcing.\n+    if (!fBroadcastTransactions) return;\n+\n     // During reindex, importing and IBD, old wallet transactions become\n     // unconfirmed. Don't resend them as that would spam other nodes.\n-    if (!chain().isReadyToBroadcast()) return;\n+    // We only allow forcing mempool submission when not relaying to avoid this spam.\n+    if (!force && relay && !chain().isReadyToBroadcast()) return;\n \n     // Do this infrequently and randomly to avoid giving away\n     // that these are our transactions.\n-    if (GetTime() < nNextResend || !fBroadcastTransactions) return;\n-    bool fFirst = (nNextResend == 0);\n+    if (!force && GetTime() < nNextResend) return;\n     // resend 12-36 hours from now, ~1 day on average.\n     nNextResend = GetTime() + (12 * 60 * 60) + GetRand(24 * 60 * 60);\n-    if (fFirst) return;\n \n     int submitted_tx_count = 0;\n \n     { // cs_wallet scope\n         LOCK(cs_wallet);\n \n-        // Relay transactions\n-        for (std::pair<const uint256, CWalletTx>& item : mapWallet) {\n-            CWalletTx& wtx = item.second;\n-            // Attempt to rebroadcast all txes more than 5 minutes older than\n-            // the last block. SubmitTxMemoryPoolAndRelay() will not rebroadcast\n-            // any confirmed or conflicting txs.\n-            if (wtx.nTimeReceived > m_best_block_time - 5 * 60) continue;\n+        // First filter for the transactions we want to rebroadcast.\n+        // We use a set with WalletTxOrderComparator so that rebroadcasting occurs in insertion order\n+        std::set<CWalletTx*, WalletTxOrderComparator> to_submit;\n+        for (auto& [txid, wtx] : mapWallet) {\n+            // Only rebroadcast unconfirmed txs\n+            if (!wtx.isUnconfirmed()) continue;\n+\n+            // For periodic rebroadcast (force == false),\n+            // attempt to rebroadcast all txes more than 5 minutes older than\n+            // the last block.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955182098",
      "id" : 955182098,
      "line" : 1917,
      "node_id" : "PRRC_kwDOABII58447uwS",
      "original_commit_id" : "71b7709fa075dc4c9b55bb07304687724f67f0cb",
      "original_line" : 1917,
      "original_position" : 109,
      "original_start_line" : 1915,
      "path" : "src/wallet/wallet.cpp",
      "position" : 109,
      "pull_request_review_id" : 1083803936,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955182098/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1915,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-25T17:16:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955182098",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955188975"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955188975"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: while you're touching this docstring and fn, worth slapping in a TODO here for increased visibility?",
      "commit_id" : "71b7709fa075dc4c9b55bb07304687724f67f0cb",
      "created_at" : "2022-08-25T16:27:44Z",
      "diff_hunk" : "@@ -1886,43 +1858,70 @@ std::set<uint256> CWallet::GetTxConflicts(const CWalletTx& wtx) const\n     return result;\n }\n \n-// Rebroadcast transactions from the wallet. We do this on a random timer\n-// to slightly obfuscate which transactions come from our wallet.\n+// Resubmit transactions from the wallet to the mempool, optionally asking the\n+// mempool to relay them. On startup, we will do this for all unconfirmed\n+// transactions but will not ask the mempool to relay them. We do this on startup\n+// to ensure that our own mempool is aware of our transactions, and to also\n+// initialize nNextResend so that the actual rebroadcast is scheduled. There\n+// is a privacy side effect here as not broadcasting on startup also means that we won't\n+// inform the world of our wallet's state, particularly if the wallet (or node) is not\n+// yet synced.\n+//\n+// Otherwise this function is called periodically in order to relay our unconfirmed txs.\n+// We do this on a random timer to slightly obfuscate which transactions\n+// come from our wallet.\n //\n // Ideally, we'd only resend transactions that we think should have been",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955188975",
      "id" : 955188975,
      "line" : 1874,
      "node_id" : "PRRC_kwDOABII58447wbv",
      "original_commit_id" : "71b7709fa075dc4c9b55bb07304687724f67f0cb",
      "original_line" : 1874,
      "original_position" : 54,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 54,
      "pull_request_review_id" : 1083803936,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955188975/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-25T17:16:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955188975",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955229056"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955229056"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "What do you think about a lambda function instead? Quite a bit less code, and imo about equally readable? As long as we're not using this comparator anywhere else the lambda would have my preference, but I'm okay with the current implementation too.\r\n\r\n<details>\r\n<summary> git diff </summary>\r\n\r\n```diff\r\ndiff --git a/src/wallet/transaction.h b/src/wallet/transaction.h\r\nindex 27983e356..c36cbeb23 100644\r\n--- a/src/wallet/transaction.h\r\n+++ b/src/wallet/transaction.h\r\n@@ -306,12 +306,6 @@ public:\r\n     void operator=(CWalletTx const &x) = delete;\r\n };\r\n \r\n-struct WalletTxOrderComparator {\r\n-    bool operator()(const CWalletTx* a, const CWalletTx* b) const\r\n-    {\r\n-        return a->nOrderPos < b->nOrderPos;\r\n-    }\r\n-};\r\n } // namespace wallet\r\n \r\n #endif // BITCOIN_WALLET_TRANSACTION_H\r\ndiff --git a/src/wallet/wallet.cpp b/src/wallet/wallet.cpp\r\nindex 69957ed9e..ad20f332a 100644\r\n--- a/src/wallet/wallet.cpp\r\n+++ b/src/wallet/wallet.cpp\r\n@@ -1906,8 +1906,9 @@ void CWallet::ResubmitWalletTransactions(bool relay, bool force)\r\n         LOCK(cs_wallet);\r\n \r\n         // First filter for the transactions we want to rebroadcast.\r\n-        // We use a set with WalletTxOrderComparator so that rebroadcasting occurs in insertion order\r\n-        std::set<CWalletTx*, WalletTxOrderComparator> to_submit;\r\n+        // We use a set ordered by nOrderPos so that rebroadcasting occurs in insertion order\r\n+        auto cmp = [](const CWalletTx* a, const CWalletTx* b) { return a->nOrderPos < b->nOrderPos; };\r\n+        std::set<CWalletTx*, decltype(cmp)> to_submit(cmp);\r\n         for (auto& [txid, wtx] : mapWallet) {\r\n             // Only rebroadcast unconfirmed txs\r\n             if (!wtx.isUnconfirmed()) continue;\r\n```\r\n\r\n</details>",
      "commit_id" : "71b7709fa075dc4c9b55bb07304687724f67f0cb",
      "created_at" : "2022-08-25T17:13:17Z",
      "diff_hunk" : "@@ -305,6 +305,13 @@ class CWalletTx\n     CWalletTx(CWalletTx const &) = delete;\n     void operator=(CWalletTx const &x) = delete;\n };\n+\n+struct WalletTxOrderComparator {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955229056",
      "id" : 955229056,
      "line" : 309,
      "node_id" : "PRRC_kwDOABII584476OA",
      "original_commit_id" : "71b7709fa075dc4c9b55bb07304687724f67f0cb",
      "original_line" : 309,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/transaction.h",
      "position" : 5,
      "pull_request_review_id" : 1083803936,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955229056/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-25T17:16:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955229056",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955250267"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955250267"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think the comparator might actually be useful in other places too.",
      "commit_id" : "71b7709fa075dc4c9b55bb07304687724f67f0cb",
      "created_at" : "2022-08-25T17:38:05Z",
      "diff_hunk" : "@@ -305,6 +305,13 @@ class CWalletTx\n     CWalletTx(CWalletTx const &) = delete;\n     void operator=(CWalletTx const &x) = delete;\n };\n+\n+struct WalletTxOrderComparator {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955250267",
      "id" : 955250267,
      "in_reply_to_id" : 955229056,
      "line" : 309,
      "node_id" : "PRRC_kwDOABII58447_Zb",
      "original_commit_id" : "71b7709fa075dc4c9b55bb07304687724f67f0cb",
      "original_line" : 309,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/transaction.h",
      "position" : 5,
      "pull_request_review_id" : 1085857075,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955250267/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-25T17:38:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955250267",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955349275"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955349275"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit, this is the only call site that takes advantage of default arguments, so making this change would allow this method to not need default arguments. (Personally, I dislike default arguments unless there's a good reason for them.)\r\n```suggestion\r\n        pwallet->ResubmitWalletTransactions(/*relay=*/true, /*force=*/false);\r\n```",
      "commit_id" : "3405f3eed5cf841b23a569b64a376c2e5b5026cd",
      "created_at" : "2022-08-25T19:32:30Z",
      "diff_hunk" : "@@ -1936,7 +1935,7 @@ void CWallet::ResendWalletTransactions()\n void MaybeResendWalletTxs(WalletContext& context)\n {\n     for (const std::shared_ptr<CWallet>& pwallet : GetWallets(context)) {\n-        pwallet->ResendWalletTransactions();\n+        pwallet->ResubmitWalletTransactions();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955349275",
      "id" : 955349275,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58448Xkb",
      "original_commit_id" : "71b7709fa075dc4c9b55bb07304687724f67f0cb",
      "original_line" : 1976,
      "original_position" : 126,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1086006476,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955349275/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-29T15:44:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955349275",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955402239"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955402239"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I agree that `force` implies that more will happen than actually does, but I couldn't think of anything better to call it. I don't think `force_ready` is any clearer.",
      "commit_id" : "789b78430b8ecb149e5f4835493f525849db516c",
      "created_at" : "2022-08-25T20:37:52Z",
      "diff_hunk" : "@@ -1886,43 +1858,70 @@ std::set<uint256> CWallet::GetTxConflicts(const CWalletTx& wtx) const\n     return result;\n }\n \n-// Rebroadcast transactions from the wallet. We do this on a random timer\n-// to slightly obfuscate which transactions come from our wallet.\n+// Resubmit transactions from the wallet to the mempool, optionally asking the\n+// mempool to relay them. On startup, we will do this for all unconfirmed\n+// transactions but will not ask the mempool to relay them. We do this on startup\n+// to ensure that our own mempool is aware of our transactions, and to also\n+// initialize nNextResend so that the actual rebroadcast is scheduled. There\n+// is a privacy side effect here as not broadcasting on startup also means that we won't\n+// inform the world of our wallet's state, particularly if the wallet (or node) is not\n+// yet synced.\n+//\n+// Otherwise this function is called periodically in order to relay our unconfirmed txs.\n+// We do this on a random timer to slightly obfuscate which transactions\n+// come from our wallet.\n //\n // Ideally, we'd only resend transactions that we think should have been\n // mined in the most recent block. Any transaction that wasn't in the top\n // blockweight of transactions in the mempool shouldn't have been mined,\n // and so is probably just sitting in the mempool waiting to be confirmed.\n // Rebroadcasting does nothing to speed up confirmation and only damages\n // privacy.\n-void CWallet::ResendWalletTransactions()\n+//\n+// The `force` option results in all unconfirmed transactions being submitted to\n+// the mempool. This does not necessarily result in those transactions being relayed,\n+// that depends on the `relay` option. Periodic rebroadcast uses the pattern\n+// relay=true force=false (also the default values), while loading into the mempool\n+// (on start, or after import) uses relay=false force=true.\n+void CWallet::ResubmitWalletTransactions(bool relay, bool force)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955402239",
      "id" : 955402239,
      "in_reply_to_id" : 955165088,
      "line" : 1924,
      "node_id" : "PRRC_kwDOABII58448kf_",
      "original_commit_id" : "71b7709fa075dc4c9b55bb07304687724f67f0cb",
      "original_line" : 1924,
      "original_position" : 67,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 68,
      "pull_request_review_id" : 1086082896,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955402239/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-25T20:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955402239",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955405099"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955405099"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "789b78430b8ecb149e5f4835493f525849db516c",
      "created_at" : "2022-08-25T20:41:47Z",
      "diff_hunk" : "@@ -27,7 +29,10 @@ def run_test(self):\n         peer_first = node.add_p2p_connection(P2PTxInvStore())\n \n         self.log.info(\"Create a new transaction and wait until it's broadcast\")\n-        txid = node.sendtoaddress(node.getnewaddress(), 1)\n+        unspent = node.listunspent()\n+        parent_utxo = unspent[0]\n+        indep_utxo = unspent[1]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955405099",
      "id" : 955405099,
      "in_reply_to_id" : 953795948,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58448lMr",
      "original_commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "original_line" : 34,
      "original_position" : 20,
      "original_start_line" : 32,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : null,
      "pull_request_review_id" : 1086086977,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955405099/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-25T20:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955405099",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955405145"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955405145"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "789b78430b8ecb149e5f4835493f525849db516c",
      "created_at" : "2022-08-25T20:41:52Z",
      "diff_hunk" : "@@ -74,6 +79,41 @@ def run_test(self):\n         node.setmocktime(now + 36 * 60 * 60 + 600)\n         peer_second.wait_for_broadcast([txid])\n \n+        self.log.info(\"Chain of unconfirmed not-in-mempool txs are rebroadcast\")\n+        # Ideally we would add a transaction that would spend the existing transaction and also be\n+        # in mapWallet before it. However mapWallet is a std::unsorted_map which means that it is\n+        # hard for us to externally construct such a transaction. So we will ignore that fact and\n+        # rely on the fact that because there are only two items in mapWallet, 50% of the time the\n+        # child will be placed before the parent in mapWallet. The incorrect behavior that this\n+        # test tries to catch should thus fail intermittently at a rate of 50%.\n+        send_res = node.send(outputs=[{node.getnewaddress(): 0.5}], options={\"inputs\": [{\"txid\":txid, \"vout\":0}], \"add_to_wallet\": False})\n+        child_txid = send_res[\"txid\"]\n+        node.sendrawtransaction(send_res[\"hex\"])\n+        entry_time = node.getmempoolentry(child_txid)[\"time\"]\n+\n+        block_time = entry_time + 6 * 60\n+        node.setmocktime(block_time)\n+        block = create_block(int(node.getbestblockhash(), 16), create_coinbase(node.getblockcount() + 1), block_time)\n+        block.solve()\n+        node.submitblock(block.serialize().hex())\n+        node.syncwithvalidationinterfacequeue()\n+\n+        # Evict these txs from the mempool\n+        evict_time = block_time + 60 * 60 * 336 + 5",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955405145",
      "id" : 955405145,
      "in_reply_to_id" : 953832319,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58448lNZ",
      "original_commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "original_line" : 109,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : null,
      "pull_request_review_id" : 1086087046,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955405145/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-25T20:41:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955405145",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955405255"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955405255"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "789b78430b8ecb149e5f4835493f525849db516c",
      "created_at" : "2022-08-25T20:42:01Z",
      "diff_hunk" : "@@ -74,6 +79,41 @@ def run_test(self):\n         node.setmocktime(now + 36 * 60 * 60 + 600)\n         peer_second.wait_for_broadcast([txid])\n \n+        self.log.info(\"Chain of unconfirmed not-in-mempool txs are rebroadcast\")\n+        # Ideally we would add a transaction that would spend the existing transaction and also be\n+        # in mapWallet before it. However mapWallet is a std::unsorted_map which means that it is\n+        # hard for us to externally construct such a transaction. So we will ignore that fact and\n+        # rely on the fact that because there are only two items in mapWallet, 50% of the time the\n+        # child will be placed before the parent in mapWallet. The incorrect behavior that this\n+        # test tries to catch should thus fail intermittently at a rate of 50%.\n+        send_res = node.send(outputs=[{node.getnewaddress(): 0.5}], options={\"inputs\": [{\"txid\":txid, \"vout\":0}], \"add_to_wallet\": False})\n+        child_txid = send_res[\"txid\"]\n+        node.sendrawtransaction(send_res[\"hex\"])\n+        entry_time = node.getmempoolentry(child_txid)[\"time\"]\n+\n+        block_time = entry_time + 6 * 60\n+        node.setmocktime(block_time)\n+        block = create_block(int(node.getbestblockhash(), 16), create_coinbase(node.getblockcount() + 1), block_time)\n+        block.solve()\n+        node.submitblock(block.serialize().hex())\n+        node.syncwithvalidationinterfacequeue()\n+\n+        # Evict these txs from the mempool\n+        evict_time = block_time + 60 * 60 * 336 + 5\n+        node.setmocktime(evict_time)\n+        indep_send = node.send(outputs=[{node.getnewaddress(): 1}], options={\"inputs\": [indep_utxo]})\n+        node.syncwithvalidationinterfacequeue()\n+        node.getmempoolentry(indep_send[\"txid\"])\n+        assert_raises_rpc_error(-5, \"Transaction not in mempool\", node.getmempoolentry, txid)\n+        assert_raises_rpc_error(-5, \"Transaction not in mempool\", node.getmempoolentry, child_txid)\n+\n+        # Rebroadcast and check that parent and child are both in the mempool\n+        with node.assert_debug_log(['ResendWalletTransactions: resubmit 2 unconfirmed transactions']):\n+            node.setmocktime(evict_time + 36 * 60 * 60)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955405255",
      "id" : 955405255,
      "in_reply_to_id" : 953893376,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58448lPH",
      "original_commit_id" : "e40ddf36bed81bdf28d386eb961c9ed22b69e207",
      "original_line" : 119,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : null,
      "pull_request_review_id" : 1086087191,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955405255/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-25T20:42:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955405255",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955405296"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955405296"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "789b78430b8ecb149e5f4835493f525849db516c",
      "created_at" : "2022-08-25T20:42:06Z",
      "diff_hunk" : "@@ -1886,43 +1858,70 @@ std::set<uint256> CWallet::GetTxConflicts(const CWalletTx& wtx) const\n     return result;\n }\n \n-// Rebroadcast transactions from the wallet. We do this on a random timer\n-// to slightly obfuscate which transactions come from our wallet.\n+// Resubmit transactions from the wallet to the mempool, optionally asking the\n+// mempool to relay them. On startup, we will do this for all unconfirmed\n+// transactions but will not ask the mempool to relay them. We do this on startup\n+// to ensure that our own mempool is aware of our transactions, and to also\n+// initialize nNextResend so that the actual rebroadcast is scheduled. There\n+// is a privacy side effect here as not broadcasting on startup also means that we won't\n+// inform the world of our wallet's state, particularly if the wallet (or node) is not\n+// yet synced.\n+//\n+// Otherwise this function is called periodically in order to relay our unconfirmed txs.\n+// We do this on a random timer to slightly obfuscate which transactions\n+// come from our wallet.\n //\n // Ideally, we'd only resend transactions that we think should have been\n // mined in the most recent block. Any transaction that wasn't in the top\n // blockweight of transactions in the mempool shouldn't have been mined,\n // and so is probably just sitting in the mempool waiting to be confirmed.\n // Rebroadcasting does nothing to speed up confirmation and only damages\n // privacy.\n-void CWallet::ResendWalletTransactions()\n+//\n+// The `force` option results in all unconfirmed transactions being submitted to\n+// the mempool. This does not necessarily result in those transactions being relayed,\n+// that depends on the `relay` option. Periodic rebroadcast uses the pattern\n+// relay=true force=false (also the default values), while loading into the mempool\n+// (on start, or after import) uses relay=false force=true.\n+void CWallet::ResubmitWalletTransactions(bool relay, bool force)\n {\n+    // Don't attempt to resubmit if the wallet is configured to not broadcast,\n+    // even if forcing.\n+    if (!fBroadcastTransactions) return;\n+\n     // During reindex, importing and IBD, old wallet transactions become\n     // unconfirmed. Don't resend them as that would spam other nodes.\n-    if (!chain().isReadyToBroadcast()) return;\n+    // We only allow forcing mempool submission when not relaying to avoid this spam.\n+    if (!force && relay && !chain().isReadyToBroadcast()) return;\n \n     // Do this infrequently and randomly to avoid giving away\n     // that these are our transactions.\n-    if (GetTime() < nNextResend || !fBroadcastTransactions) return;\n-    bool fFirst = (nNextResend == 0);\n+    if (!force && GetTime() < nNextResend) return;\n     // resend 12-36 hours from now, ~1 day on average.\n     nNextResend = GetTime() + (12 * 60 * 60) + GetRand(24 * 60 * 60);\n-    if (fFirst) return;\n \n     int submitted_tx_count = 0;\n \n     { // cs_wallet scope\n         LOCK(cs_wallet);\n \n-        // Relay transactions\n-        for (std::pair<const uint256, CWalletTx>& item : mapWallet) {\n-            CWalletTx& wtx = item.second;\n-            // Attempt to rebroadcast all txes more than 5 minutes older than\n-            // the last block. SubmitTxMemoryPoolAndRelay() will not rebroadcast\n-            // any confirmed or conflicting txs.\n-            if (wtx.nTimeReceived > m_best_block_time - 5 * 60) continue;\n+        // First filter for the transactions we want to rebroadcast.\n+        // We use a set with WalletTxOrderComparator so that rebroadcasting occurs in insertion order\n+        std::set<CWalletTx*, WalletTxOrderComparator> to_submit;\n+        for (auto& [txid, wtx] : mapWallet) {\n+            // Only rebroadcast unconfirmed txs\n+            if (!wtx.isUnconfirmed()) continue;\n+\n+            // For periodic rebroadcast (force == false),\n+            // attempt to rebroadcast all txes more than 5 minutes older than\n+            // the last block.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955405296",
      "id" : 955405296,
      "in_reply_to_id" : 955182098,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58448lPw",
      "original_commit_id" : "71b7709fa075dc4c9b55bb07304687724f67f0cb",
      "original_line" : 1917,
      "original_position" : 109,
      "original_start_line" : 1915,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1086087261,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955405296/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-25T20:42:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955405296",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955405384"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955405384"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "789b78430b8ecb149e5f4835493f525849db516c",
      "created_at" : "2022-08-25T20:42:11Z",
      "diff_hunk" : "@@ -1886,43 +1858,70 @@ std::set<uint256> CWallet::GetTxConflicts(const CWalletTx& wtx) const\n     return result;\n }\n \n-// Rebroadcast transactions from the wallet. We do this on a random timer\n-// to slightly obfuscate which transactions come from our wallet.\n+// Resubmit transactions from the wallet to the mempool, optionally asking the\n+// mempool to relay them. On startup, we will do this for all unconfirmed\n+// transactions but will not ask the mempool to relay them. We do this on startup\n+// to ensure that our own mempool is aware of our transactions, and to also\n+// initialize nNextResend so that the actual rebroadcast is scheduled. There\n+// is a privacy side effect here as not broadcasting on startup also means that we won't\n+// inform the world of our wallet's state, particularly if the wallet (or node) is not\n+// yet synced.\n+//\n+// Otherwise this function is called periodically in order to relay our unconfirmed txs.\n+// We do this on a random timer to slightly obfuscate which transactions\n+// come from our wallet.\n //\n // Ideally, we'd only resend transactions that we think should have been",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955405384",
      "id" : 955405384,
      "in_reply_to_id" : 955188975,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58448lRI",
      "original_commit_id" : "71b7709fa075dc4c9b55bb07304687724f67f0cb",
      "original_line" : 1874,
      "original_position" : 54,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1086087347,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955405384/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-25T20:42:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955405384",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955848588"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955848588"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Right, thank you.",
      "commit_id" : "789b78430b8ecb149e5f4835493f525849db516c",
      "created_at" : "2022-08-26T09:22:53Z",
      "diff_hunk" : "@@ -1886,43 +1858,57 @@ std::set<uint256> CWallet::GetTxConflicts(const CWalletTx& wtx) const\n     return result;\n }\n \n-// Rebroadcast transactions from the wallet. We do this on a random timer\n-// to slightly obfuscate which transactions come from our wallet.\n+// Resubmit transactions from the wallet to the mempool, optionally asking the\n+// mempool to relay them. On startup, we will do this for all unconfirmed\n+// transactions but will not ask the mempool to relay them. Otherwise this\n+// function is called periodically in order to relay our unconfirmed txs.\n+// We do this on a random timer to slightly obfuscate which transactions\n+// come from our wallet.\n //\n // Ideally, we'd only resend transactions that we think should have been\n // mined in the most recent block. Any transaction that wasn't in the top\n // blockweight of transactions in the mempool shouldn't have been mined,\n // and so is probably just sitting in the mempool waiting to be confirmed.\n // Rebroadcasting does nothing to speed up confirmation and only damages\n // privacy.\n-void CWallet::ResendWalletTransactions()\n+void CWallet::ResubmitWalletTransactions(bool relay, bool force)\n {\n+    // Don't attempt to resubmit if the wallet is configured to not broadcast,\n+    // even if forcing.\n+    if (!fBroadcastTransactions) return;\n+\n     // During reindex, importing and IBD, old wallet transactions become\n     // unconfirmed. Don't resend them as that would spam other nodes.\n-    if (!chain().isReadyToBroadcast()) return;\n+    if (!force && !chain().isReadyToBroadcast()) return;\n \n     // Do this infrequently and randomly to avoid giving away\n     // that these are our transactions.\n-    if (GetTime() < nNextResend || !fBroadcastTransactions) return;\n-    bool fFirst = (nNextResend == 0);\n+    if (!force && GetTime() < nNextResend) return;\n     // resend 12-36 hours from now, ~1 day on average.\n     nNextResend = GetTime() + (12 * 60 * 60) + GetRand(24 * 60 * 60);\n-    if (fFirst) return;\n \n     int submitted_tx_count = 0;\n \n     { // cs_wallet scope\n         LOCK(cs_wallet);\n \n-        // Relay transactions\n-        for (std::pair<const uint256, CWalletTx>& item : mapWallet) {\n-            CWalletTx& wtx = item.second;\n-            // Attempt to rebroadcast all txes more than 5 minutes older than\n-            // the last block. SubmitTxMemoryPoolAndRelay() will not rebroadcast\n-            // any confirmed or conflicting txs.\n-            if (wtx.nTimeReceived > m_best_block_time - 5 * 60) continue;\n+        // First filter for the transactions we want to rebroadcast.\n+        // We use a set with WalletTxOrderComparator so that rebroadcasting occurs in insertion order\n+        std::set<CWalletTx*, WalletTxOrderComparator> to_submit;\n+        for (auto& [txid, wtx] : mapWallet) {\n+            // Only rebroadcast unconfirmed txs\n+            if (!wtx.isUnconfirmed()) continue;\n+\n+            // For periodic rebroadcast (force == false),\n+            // attempt to rebroadcast all txes more than 5 minutes older than\n+            // the last block.\n+            if (!force && wtx.nTimeReceived > m_best_block_time - 5 * 60) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955848588",
      "id" : 955848588,
      "in_reply_to_id" : 954605982,
      "line" : 1955,
      "node_id" : "PRRC_kwDOABII5844-ReM",
      "original_commit_id" : "bec0579357daebb420d0249caf4665428221a61f",
      "original_line" : 1955,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 110,
      "pull_request_review_id" : 1086675667,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955848588/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-26T09:22:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955848588",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955876726"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955876726"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`the parent transaction before the parent transaction`?",
      "commit_id" : "789b78430b8ecb149e5f4835493f525849db516c",
      "created_at" : "2022-08-26T09:55:01Z",
      "diff_hunk" : "@@ -68,6 +73,53 @@ def run_test(self):\n         node.setmocktime(now + 36 * 60 * 60 + 600)\n         peer_second.wait_for_broadcast([txid])\n \n+        self.log.info(\"Chain of unconfirmed not-in-mempool txs are rebroadcast\")\n+        # This tests that the node broadcasts the parent transaction before the parent transaction.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r955876726",
      "id" : 955876726,
      "line" : 77,
      "node_id" : "PRRC_kwDOABII5844-YV2",
      "original_commit_id" : "789b78430b8ecb149e5f4835493f525849db516c",
      "original_line" : 77,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 32,
      "pull_request_review_id" : 1086715232,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955876726/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-26T09:55:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/955876726",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r956149136"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/956149136"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: perhaps this first sentence should live in `wallet.h`?",
      "commit_id" : "3405f3eed5cf841b23a569b64a376c2e5b5026cd",
      "created_at" : "2022-08-26T15:13:10Z",
      "diff_hunk" : "@@ -1924,43 +1896,69 @@ std::set<uint256> CWallet::GetTxConflicts(const CWalletTx& wtx) const\n     return result;\n }\n \n-// Rebroadcast transactions from the wallet. We do this on a random timer\n-// to slightly obfuscate which transactions come from our wallet.\n+// Resubmit transactions from the wallet to the mempool, optionally asking the\n+// mempool to relay them. On startup, we will do this for all unconfirmed",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r956149136",
      "id" : 956149136,
      "line" : 1901,
      "node_id" : "PRRC_kwDOABII5844_a2Q",
      "original_commit_id" : "789b78430b8ecb149e5f4835493f525849db516c",
      "original_line" : 1901,
      "original_position" : 42,
      "original_start_line" : 1899,
      "path" : "src/wallet/wallet.cpp",
      "position" : 42,
      "pull_request_review_id" : 1087116790,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/956149136/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1900,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-05T12:00:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/956149136",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r956195855"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/956195855"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oops, fixed.",
      "commit_id" : "748d5c75d60505a3d84d36782f5cf4949224e103",
      "created_at" : "2022-08-26T16:07:22Z",
      "diff_hunk" : "@@ -68,6 +73,53 @@ def run_test(self):\n         node.setmocktime(now + 36 * 60 * 60 + 600)\n         peer_second.wait_for_broadcast([txid])\n \n+        self.log.info(\"Chain of unconfirmed not-in-mempool txs are rebroadcast\")\n+        # This tests that the node broadcasts the parent transaction before the parent transaction.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r956195855",
      "id" : 956195855,
      "in_reply_to_id" : 955876726,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5844_mQP",
      "original_commit_id" : "789b78430b8ecb149e5f4835493f525849db516c",
      "original_line" : 77,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : null,
      "pull_request_review_id" : 1087184718,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/956195855/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-26T16:07:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/956195855",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-08-26T22:25:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#issuecomment-1229010971",
      "id" : 1229010971,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25768",
      "node_id" : "IC_kwDOABII585JQTgb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1229010971/reactions"
      },
      "updated_at" : "2022-08-26T22:25:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1229010971",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r956937924"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/956937924"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: I think `the previous behavior` stuff belongs to the commit message, not to the file content.",
      "commit_id" : "748d5c75d60505a3d84d36782f5cf4949224e103",
      "created_at" : "2022-08-29T06:29:06Z",
      "diff_hunk" : "@@ -68,6 +73,53 @@ def run_test(self):\n         node.setmocktime(now + 36 * 60 * 60 + 600)\n         peer_second.wait_for_broadcast([txid])\n \n+        self.log.info(\"Chain of unconfirmed not-in-mempool txs are rebroadcast\")\n+        # This tests that the node broadcasts the parent transaction before the child transaction.\n+        # The previous behavior is that the rebroadcasting would simply iterate mapWallet. As",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r956937924",
      "id" : 956937924,
      "line" : 78,
      "node_id" : "PRRC_kwDOABII5845CbbE",
      "original_commit_id" : "748d5c75d60505a3d84d36782f5cf4949224e103",
      "original_line" : 78,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 33,
      "pull_request_review_id" : 1088126712,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/956937924/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-29T06:29:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/956937924",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r957563605"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/957563605"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "3405f3eed5cf841b23a569b64a376c2e5b5026cd",
      "created_at" : "2022-08-29T16:41:56Z",
      "diff_hunk" : "@@ -68,6 +73,53 @@ def run_test(self):\n         node.setmocktime(now + 36 * 60 * 60 + 600)\n         peer_second.wait_for_broadcast([txid])\n \n+        self.log.info(\"Chain of unconfirmed not-in-mempool txs are rebroadcast\")\n+        # This tests that the node broadcasts the parent transaction before the child transaction.\n+        # The previous behavior is that the rebroadcasting would simply iterate mapWallet. As",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r957563605",
      "id" : 957563605,
      "in_reply_to_id" : 956937924,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845E0LV",
      "original_commit_id" : "748d5c75d60505a3d84d36782f5cf4949224e103",
      "original_line" : 78,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : null,
      "pull_request_review_id" : 1089022321,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/957563605/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-29T16:41:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/957563605",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r957563733"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/957563733"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Removed the default arguments.",
      "commit_id" : "3405f3eed5cf841b23a569b64a376c2e5b5026cd",
      "created_at" : "2022-08-29T16:42:06Z",
      "diff_hunk" : "@@ -1936,7 +1935,7 @@ void CWallet::ResendWalletTransactions()\n void MaybeResendWalletTxs(WalletContext& context)\n {\n     for (const std::shared_ptr<CWallet>& pwallet : GetWallets(context)) {\n-        pwallet->ResendWalletTransactions();\n+        pwallet->ResubmitWalletTransactions();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r957563733",
      "id" : 957563733,
      "in_reply_to_id" : 955349275,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845E0NV",
      "original_commit_id" : "71b7709fa075dc4c9b55bb07304687724f67f0cb",
      "original_line" : 1976,
      "original_position" : 126,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1089022534,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/957563733/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-29T16:42:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/957563733",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 3405f3eed5cf841b23a569b64a376c2e5b5026cd",
      "created_at" : "2022-08-30T06:19:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#issuecomment-1231196093",
      "id" : 1231196093,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25768",
      "node_id" : "IC_kwDOABII585JYo-9",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1231196093/reactions"
      },
      "updated_at" : "2022-08-30T06:19:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1231196093",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r958425911"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958425911"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "At this point of the review, this is just a minor nit but code would be a bit clearer in this way:\r\n```c++\r\nif (!force) {\r\n    // During reindex, importing and IBD, old wallet transactions become\r\n    // unconfirmed. Don't resend them as that would spam other nodes.\r\n    // We only allow forcing mempool submission when not relaying to avoid this spam.\r\n    if (relay && !chain().isReadyToBroadcast()) return;\r\n\r\n    // Do this infrequently and randomly to avoid giving away\r\n    // that these are our transactions.\r\n    if (GetTime() < nNextResend) return;\r\n}\r\n```",
      "commit_id" : "3405f3eed5cf841b23a569b64a376c2e5b5026cd",
      "created_at" : "2022-08-30T12:38:18Z",
      "diff_hunk" : "@@ -1925,43 +1897,69 @@ std::set<uint256> CWallet::GetTxConflicts(const CWalletTx& wtx) const\n     return result;\n }\n \n-// Rebroadcast transactions from the wallet. We do this on a random timer\n-// to slightly obfuscate which transactions come from our wallet.\n+// Resubmit transactions from the wallet to the mempool, optionally asking the\n+// mempool to relay them. On startup, we will do this for all unconfirmed\n+// transactions but will not ask the mempool to relay them. We do this on startup\n+// to ensure that our own mempool is aware of our transactions, and to also\n+// initialize nNextResend so that the actual rebroadcast is scheduled. There\n+// is a privacy side effect here as not broadcasting on startup also means that we won't\n+// inform the world of our wallet's state, particularly if the wallet (or node) is not\n+// yet synced.\n+//\n+// Otherwise this function is called periodically in order to relay our unconfirmed txs.\n+// We do this on a random timer to slightly obfuscate which transactions\n+// come from our wallet.\n //\n-// Ideally, we'd only resend transactions that we think should have been\n+// TODO: Ideally, we'd only resend transactions that we think should have been\n // mined in the most recent block. Any transaction that wasn't in the top\n // blockweight of transactions in the mempool shouldn't have been mined,\n // and so is probably just sitting in the mempool waiting to be confirmed.\n // Rebroadcasting does nothing to speed up confirmation and only damages\n // privacy.\n-void CWallet::ResendWalletTransactions()\n+//\n+// The `force` option results in all unconfirmed transactions being submitted to\n+// the mempool. This does not necessarily result in those transactions being relayed,\n+// that depends on the `relay` option. Periodic rebroadcast uses the pattern\n+// relay=true force=false (also the default values), while loading into the mempool\n+// (on start, or after import) uses relay=false force=true.\n+void CWallet::ResubmitWalletTransactions(bool relay, bool force)\n {\n+    // Don't attempt to resubmit if the wallet is configured to not broadcast,\n+    // even if forcing.\n+    if (!fBroadcastTransactions) return;\n+\n     // During reindex, importing and IBD, old wallet transactions become\n     // unconfirmed. Don't resend them as that would spam other nodes.\n-    if (!chain().isReadyToBroadcast()) return;\n+    // We only allow forcing mempool submission when not relaying to avoid this spam.\n+    if (!force && relay && !chain().isReadyToBroadcast()) return;\n \n     // Do this infrequently and randomly to avoid giving away\n     // that these are our transactions.\n-    if (GetTime() < nNextResend || !fBroadcastTransactions) return;\n-    bool fFirst = (nNextResend == 0);\n+    if (!force && GetTime() < nNextResend) return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r958425911",
      "id" : 958425911,
      "line" : 1938,
      "node_id" : "PRRC_kwDOABII5845IGs3",
      "original_commit_id" : "10d91c5abe9ed7dcc237c9d52c588e7d26e162a4",
      "original_line" : 1938,
      "original_position" : 84,
      "original_start_line" : 1931,
      "path" : "src/wallet/wallet.cpp",
      "position" : 84,
      "pull_request_review_id" : 1090238146,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958425911/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1931,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-30T12:56:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958425911",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r958562071"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958562071"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can you explain why this is needed? Generally this is only needed when forcing the wallet to receive all in-flight mempool notifications. However, there is no wallet call that follows. Also, there is no `m_best_block_time` update.",
      "commit_id" : "3405f3eed5cf841b23a569b64a376c2e5b5026cd",
      "created_at" : "2022-08-30T14:31:52Z",
      "diff_hunk" : "@@ -66,14 +65,57 @@ def run_test(self):\n         self.log.info(\"Bump time & check that transaction is rebroadcast\")\n         # Transaction should be rebroadcast approximately 24 hours in the future,\n         # but can range from 12-36. So bump 36 hours to be sure.\n-        with node.assert_debug_log(['ResendWalletTransactions: resubmit 1 unconfirmed transactions']):\n+        with node.assert_debug_log(['resubmit 1 unconfirmed transactions']):\n             node.setmocktime(now + 36 * 60 * 60)\n             # Tell scheduler to call MaybeResendWalletTxs now.\n             node.mockscheduler(60)\n         # Give some time for trickle to occur\n         node.setmocktime(now + 36 * 60 * 60 + 600)\n         peer_second.wait_for_broadcast([txid])\n \n+        self.log.info(\"Chain of unconfirmed not-in-mempool txs are rebroadcast\")\n+        # This tests that the node broadcasts the parent transaction before the child transaction.\n+        # To test that scenario, we need a method to reliably get a child transaction placed\n+        # in mapWallet positioned before the parent. We cannot predict the position in mapWallet,\n+        # but we can observe it using listreceivedbyaddress and other related RPCs.\n+        #\n+        # So we will create the child transaction, use listreceivedbyaddress to see what the\n+        # ordering of mapWallet is, if the child is not before the parent, we will create a new\n+        # child (via bumpfee) and remove the old child (via removeprunedfunds) until we get the\n+        # ordering of child before parent.\n+        child_txid = node.send(outputs=[{addr: 0.5}], options={\"inputs\": [{\"txid\":txid, \"vout\":0}]})[\"txid\"]\n+        while True:\n+            txids = node.listreceivedbyaddress(minconf=0, address_filter=addr)[0][\"txids\"]\n+            if txids == [child_txid, txid]:\n+                break\n+            bumped = node.bumpfee(child_txid)\n+            node.removeprunedfunds(child_txid)\n+            child_txid = bumped[\"txid\"]\n+        entry_time = node.getmempoolentry(child_txid)[\"time\"]\n+\n+        block_time = entry_time + 6 * 60\n+        node.setmocktime(block_time)\n+        block = create_block(int(node.getbestblockhash(), 16), create_coinbase(node.getblockcount() + 1), block_time)\n+        block.solve()\n+        node.submitblock(block.serialize().hex())\n+        node.syncwithvalidationinterfacequeue()\n+\n+        # Evict these txs from the mempool\n+        evict_time = block_time + 60 * 60 * DEFAULT_MEMPOOL_EXPIRY_HOURS + 5\n+        node.setmocktime(evict_time)\n+        indep_send = node.send(outputs=[{node.getnewaddress(): 1}], options={\"inputs\": [indep_utxo]})\n+        node.syncwithvalidationinterfacequeue()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r958562071",
      "id" : 958562071,
      "line" : 107,
      "node_id" : "PRRC_kwDOABII5845In8X",
      "original_commit_id" : "3405f3eed5cf841b23a569b64a376c2e5b5026cd",
      "original_line" : 107,
      "original_position" : 86,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 86,
      "pull_request_review_id" : 1090438016,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958562071/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-30T14:40:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958562071",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r958566606"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958566606"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can you explain why this is needed? Maybe duplicate the comment \"Set correct m_best_block_time\" from above?",
      "commit_id" : "3405f3eed5cf841b23a569b64a376c2e5b5026cd",
      "created_at" : "2022-08-30T14:35:27Z",
      "diff_hunk" : "@@ -66,14 +65,57 @@ def run_test(self):\n         self.log.info(\"Bump time & check that transaction is rebroadcast\")\n         # Transaction should be rebroadcast approximately 24 hours in the future,\n         # but can range from 12-36. So bump 36 hours to be sure.\n-        with node.assert_debug_log(['ResendWalletTransactions: resubmit 1 unconfirmed transactions']):\n+        with node.assert_debug_log(['resubmit 1 unconfirmed transactions']):\n             node.setmocktime(now + 36 * 60 * 60)\n             # Tell scheduler to call MaybeResendWalletTxs now.\n             node.mockscheduler(60)\n         # Give some time for trickle to occur\n         node.setmocktime(now + 36 * 60 * 60 + 600)\n         peer_second.wait_for_broadcast([txid])\n \n+        self.log.info(\"Chain of unconfirmed not-in-mempool txs are rebroadcast\")\n+        # This tests that the node broadcasts the parent transaction before the child transaction.\n+        # To test that scenario, we need a method to reliably get a child transaction placed\n+        # in mapWallet positioned before the parent. We cannot predict the position in mapWallet,\n+        # but we can observe it using listreceivedbyaddress and other related RPCs.\n+        #\n+        # So we will create the child transaction, use listreceivedbyaddress to see what the\n+        # ordering of mapWallet is, if the child is not before the parent, we will create a new\n+        # child (via bumpfee) and remove the old child (via removeprunedfunds) until we get the\n+        # ordering of child before parent.\n+        child_txid = node.send(outputs=[{addr: 0.5}], options={\"inputs\": [{\"txid\":txid, \"vout\":0}]})[\"txid\"]\n+        while True:\n+            txids = node.listreceivedbyaddress(minconf=0, address_filter=addr)[0][\"txids\"]\n+            if txids == [child_txid, txid]:\n+                break\n+            bumped = node.bumpfee(child_txid)\n+            node.removeprunedfunds(child_txid)\n+            child_txid = bumped[\"txid\"]\n+        entry_time = node.getmempoolentry(child_txid)[\"time\"]\n+\n+        block_time = entry_time + 6 * 60\n+        node.setmocktime(block_time)\n+        block = create_block(int(node.getbestblockhash(), 16), create_coinbase(node.getblockcount() + 1), block_time)\n+        block.solve()\n+        node.submitblock(block.serialize().hex())\n+        node.syncwithvalidationinterfacequeue()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r958566606",
      "id" : 958566606,
      "line" : 101,
      "node_id" : "PRRC_kwDOABII5845IpDO",
      "original_commit_id" : "3405f3eed5cf841b23a569b64a376c2e5b5026cd",
      "original_line" : 101,
      "original_position" : 80,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 80,
      "pull_request_review_id" : 1090438016,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958566606/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-30T14:40:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958566606",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r958571943"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958571943"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n// relay=true force=false, while loading into the mempool\r\n```",
      "commit_id" : "3405f3eed5cf841b23a569b64a376c2e5b5026cd",
      "created_at" : "2022-08-30T14:39:38Z",
      "diff_hunk" : "@@ -1925,43 +1897,69 @@ std::set<uint256> CWallet::GetTxConflicts(const CWalletTx& wtx) const\n     return result;\n }\n \n-// Rebroadcast transactions from the wallet. We do this on a random timer\n-// to slightly obfuscate which transactions come from our wallet.\n+// Resubmit transactions from the wallet to the mempool, optionally asking the\n+// mempool to relay them. On startup, we will do this for all unconfirmed\n+// transactions but will not ask the mempool to relay them. We do this on startup\n+// to ensure that our own mempool is aware of our transactions, and to also\n+// initialize nNextResend so that the actual rebroadcast is scheduled. There\n+// is a privacy side effect here as not broadcasting on startup also means that we won't\n+// inform the world of our wallet's state, particularly if the wallet (or node) is not\n+// yet synced.\n+//\n+// Otherwise this function is called periodically in order to relay our unconfirmed txs.\n+// We do this on a random timer to slightly obfuscate which transactions\n+// come from our wallet.\n //\n-// Ideally, we'd only resend transactions that we think should have been\n+// TODO: Ideally, we'd only resend transactions that we think should have been\n // mined in the most recent block. Any transaction that wasn't in the top\n // blockweight of transactions in the mempool shouldn't have been mined,\n // and so is probably just sitting in the mempool waiting to be confirmed.\n // Rebroadcasting does nothing to speed up confirmation and only damages\n // privacy.\n-void CWallet::ResendWalletTransactions()\n+//\n+// The `force` option results in all unconfirmed transactions being submitted to\n+// the mempool. This does not necessarily result in those transactions being relayed,\n+// that depends on the `relay` option. Periodic rebroadcast uses the pattern\n+// relay=true force=false (also the default values), while loading into the mempool",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r958571943",
      "id" : 958571943,
      "line" : 1923,
      "node_id" : "PRRC_kwDOABII5845IqWn",
      "original_commit_id" : "3405f3eed5cf841b23a569b64a376c2e5b5026cd",
      "original_line" : 1923,
      "original_position" : 66,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 66,
      "pull_request_review_id" : 1090438016,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958571943/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-30T14:40:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958571943",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r958572522"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958572522"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n            // Attempt to rebroadcast all txes more than 5 minutes older than\r\n```\r\n\r\nAny reason that this `A` changed into `a`?",
      "commit_id" : "3405f3eed5cf841b23a569b64a376c2e5b5026cd",
      "created_at" : "2022-08-30T14:40:08Z",
      "diff_hunk" : "@@ -1925,43 +1897,69 @@ std::set<uint256> CWallet::GetTxConflicts(const CWalletTx& wtx) const\n     return result;\n }\n \n-// Rebroadcast transactions from the wallet. We do this on a random timer\n-// to slightly obfuscate which transactions come from our wallet.\n+// Resubmit transactions from the wallet to the mempool, optionally asking the\n+// mempool to relay them. On startup, we will do this for all unconfirmed\n+// transactions but will not ask the mempool to relay them. We do this on startup\n+// to ensure that our own mempool is aware of our transactions, and to also\n+// initialize nNextResend so that the actual rebroadcast is scheduled. There\n+// is a privacy side effect here as not broadcasting on startup also means that we won't\n+// inform the world of our wallet's state, particularly if the wallet (or node) is not\n+// yet synced.\n+//\n+// Otherwise this function is called periodically in order to relay our unconfirmed txs.\n+// We do this on a random timer to slightly obfuscate which transactions\n+// come from our wallet.\n //\n-// Ideally, we'd only resend transactions that we think should have been\n+// TODO: Ideally, we'd only resend transactions that we think should have been\n // mined in the most recent block. Any transaction that wasn't in the top\n // blockweight of transactions in the mempool shouldn't have been mined,\n // and so is probably just sitting in the mempool waiting to be confirmed.\n // Rebroadcasting does nothing to speed up confirmation and only damages\n // privacy.\n-void CWallet::ResendWalletTransactions()\n+//\n+// The `force` option results in all unconfirmed transactions being submitted to\n+// the mempool. This does not necessarily result in those transactions being relayed,\n+// that depends on the `relay` option. Periodic rebroadcast uses the pattern\n+// relay=true force=false (also the default values), while loading into the mempool\n+// (on start, or after import) uses relay=false force=true.\n+void CWallet::ResubmitWalletTransactions(bool relay, bool force)\n {\n+    // Don't attempt to resubmit if the wallet is configured to not broadcast,\n+    // even if forcing.\n+    if (!fBroadcastTransactions) return;\n+\n     // During reindex, importing and IBD, old wallet transactions become\n     // unconfirmed. Don't resend them as that would spam other nodes.\n-    if (!chain().isReadyToBroadcast()) return;\n+    // We only allow forcing mempool submission when not relaying to avoid this spam.\n+    if (!force && relay && !chain().isReadyToBroadcast()) return;\n \n     // Do this infrequently and randomly to avoid giving away\n     // that these are our transactions.\n-    if (GetTime() < nNextResend || !fBroadcastTransactions) return;\n-    bool fFirst = (nNextResend == 0);\n+    if (!force && GetTime() < nNextResend) return;\n     // resend 12-36 hours from now, ~1 day on average.\n     nNextResend = GetTime() + (12 * 60 * 60) + GetRand(24 * 60 * 60);\n-    if (fFirst) return;\n \n     int submitted_tx_count = 0;\n \n     { // cs_wallet scope\n         LOCK(cs_wallet);\n \n-        // Relay transactions\n-        for (std::pair<const uint256, CWalletTx>& item : mapWallet) {\n-            CWalletTx& wtx = item.second;\n-            // Attempt to rebroadcast all txes more than 5 minutes older than\n-            // the last block. SubmitTxMemoryPoolAndRelay() will not rebroadcast\n-            // any confirmed or conflicting txs.\n-            if (wtx.nTimeReceived > m_best_block_time - 5 * 60) continue;\n+        // First filter for the transactions we want to rebroadcast.\n+        // We use a set with WalletTxOrderComparator so that rebroadcasting occurs in insertion order\n+        std::set<CWalletTx*, WalletTxOrderComparator> to_submit;\n+        for (auto& [txid, wtx] : mapWallet) {\n+            // Only rebroadcast unconfirmed txs\n+            if (!wtx.isUnconfirmed()) continue;\n+\n+            // attempt to rebroadcast all txes more than 5 minutes older than",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r958572522",
      "id" : 958572522,
      "line" : 1954,
      "node_id" : "PRRC_kwDOABII5845Iqfq",
      "original_commit_id" : "3405f3eed5cf841b23a569b64a376c2e5b5026cd",
      "original_line" : 1954,
      "original_position" : 108,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 108,
      "pull_request_review_id" : 1090438016,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958572522/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-30T14:40:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958572522",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r958746874"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958746874"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Also, there is no `m_best_block_time` update.\r\n\r\nWhy not? IIRC this was done in order to update `m_best_block_time` so that the transaction would be properly evicted later.",
      "commit_id" : "3405f3eed5cf841b23a569b64a376c2e5b5026cd",
      "created_at" : "2022-08-30T17:22:57Z",
      "diff_hunk" : "@@ -66,14 +65,57 @@ def run_test(self):\n         self.log.info(\"Bump time & check that transaction is rebroadcast\")\n         # Transaction should be rebroadcast approximately 24 hours in the future,\n         # but can range from 12-36. So bump 36 hours to be sure.\n-        with node.assert_debug_log(['ResendWalletTransactions: resubmit 1 unconfirmed transactions']):\n+        with node.assert_debug_log(['resubmit 1 unconfirmed transactions']):\n             node.setmocktime(now + 36 * 60 * 60)\n             # Tell scheduler to call MaybeResendWalletTxs now.\n             node.mockscheduler(60)\n         # Give some time for trickle to occur\n         node.setmocktime(now + 36 * 60 * 60 + 600)\n         peer_second.wait_for_broadcast([txid])\n \n+        self.log.info(\"Chain of unconfirmed not-in-mempool txs are rebroadcast\")\n+        # This tests that the node broadcasts the parent transaction before the child transaction.\n+        # To test that scenario, we need a method to reliably get a child transaction placed\n+        # in mapWallet positioned before the parent. We cannot predict the position in mapWallet,\n+        # but we can observe it using listreceivedbyaddress and other related RPCs.\n+        #\n+        # So we will create the child transaction, use listreceivedbyaddress to see what the\n+        # ordering of mapWallet is, if the child is not before the parent, we will create a new\n+        # child (via bumpfee) and remove the old child (via removeprunedfunds) until we get the\n+        # ordering of child before parent.\n+        child_txid = node.send(outputs=[{addr: 0.5}], options={\"inputs\": [{\"txid\":txid, \"vout\":0}]})[\"txid\"]\n+        while True:\n+            txids = node.listreceivedbyaddress(minconf=0, address_filter=addr)[0][\"txids\"]\n+            if txids == [child_txid, txid]:\n+                break\n+            bumped = node.bumpfee(child_txid)\n+            node.removeprunedfunds(child_txid)\n+            child_txid = bumped[\"txid\"]\n+        entry_time = node.getmempoolentry(child_txid)[\"time\"]\n+\n+        block_time = entry_time + 6 * 60\n+        node.setmocktime(block_time)\n+        block = create_block(int(node.getbestblockhash(), 16), create_coinbase(node.getblockcount() + 1), block_time)\n+        block.solve()\n+        node.submitblock(block.serialize().hex())\n+        node.syncwithvalidationinterfacequeue()\n+\n+        # Evict these txs from the mempool\n+        evict_time = block_time + 60 * 60 * DEFAULT_MEMPOOL_EXPIRY_HOURS + 5\n+        node.setmocktime(evict_time)\n+        indep_send = node.send(outputs=[{node.getnewaddress(): 1}], options={\"inputs\": [indep_utxo]})\n+        node.syncwithvalidationinterfacequeue()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r958746874",
      "id" : 958746874,
      "in_reply_to_id" : 958562071,
      "line" : 107,
      "node_id" : "PRRC_kwDOABII5845JVD6",
      "original_commit_id" : "3405f3eed5cf841b23a569b64a376c2e5b5026cd",
      "original_line" : 107,
      "original_position" : 86,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 86,
      "pull_request_review_id" : 1090705743,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958746874/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-30T17:22:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958746874",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r958748595"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958748595"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The transaction is evicted from the mempool, not the wallet. (Only the wallet has an `m_best_block_time`)\r\n\r\nAlso, there is no new best block, so `m_best_block_time` won't be updated either way.",
      "commit_id" : "3405f3eed5cf841b23a569b64a376c2e5b5026cd",
      "created_at" : "2022-08-30T17:24:56Z",
      "diff_hunk" : "@@ -66,14 +65,57 @@ def run_test(self):\n         self.log.info(\"Bump time & check that transaction is rebroadcast\")\n         # Transaction should be rebroadcast approximately 24 hours in the future,\n         # but can range from 12-36. So bump 36 hours to be sure.\n-        with node.assert_debug_log(['ResendWalletTransactions: resubmit 1 unconfirmed transactions']):\n+        with node.assert_debug_log(['resubmit 1 unconfirmed transactions']):\n             node.setmocktime(now + 36 * 60 * 60)\n             # Tell scheduler to call MaybeResendWalletTxs now.\n             node.mockscheduler(60)\n         # Give some time for trickle to occur\n         node.setmocktime(now + 36 * 60 * 60 + 600)\n         peer_second.wait_for_broadcast([txid])\n \n+        self.log.info(\"Chain of unconfirmed not-in-mempool txs are rebroadcast\")\n+        # This tests that the node broadcasts the parent transaction before the child transaction.\n+        # To test that scenario, we need a method to reliably get a child transaction placed\n+        # in mapWallet positioned before the parent. We cannot predict the position in mapWallet,\n+        # but we can observe it using listreceivedbyaddress and other related RPCs.\n+        #\n+        # So we will create the child transaction, use listreceivedbyaddress to see what the\n+        # ordering of mapWallet is, if the child is not before the parent, we will create a new\n+        # child (via bumpfee) and remove the old child (via removeprunedfunds) until we get the\n+        # ordering of child before parent.\n+        child_txid = node.send(outputs=[{addr: 0.5}], options={\"inputs\": [{\"txid\":txid, \"vout\":0}]})[\"txid\"]\n+        while True:\n+            txids = node.listreceivedbyaddress(minconf=0, address_filter=addr)[0][\"txids\"]\n+            if txids == [child_txid, txid]:\n+                break\n+            bumped = node.bumpfee(child_txid)\n+            node.removeprunedfunds(child_txid)\n+            child_txid = bumped[\"txid\"]\n+        entry_time = node.getmempoolentry(child_txid)[\"time\"]\n+\n+        block_time = entry_time + 6 * 60\n+        node.setmocktime(block_time)\n+        block = create_block(int(node.getbestblockhash(), 16), create_coinbase(node.getblockcount() + 1), block_time)\n+        block.solve()\n+        node.submitblock(block.serialize().hex())\n+        node.syncwithvalidationinterfacequeue()\n+\n+        # Evict these txs from the mempool\n+        evict_time = block_time + 60 * 60 * DEFAULT_MEMPOOL_EXPIRY_HOURS + 5\n+        node.setmocktime(evict_time)\n+        indep_send = node.send(outputs=[{node.getnewaddress(): 1}], options={\"inputs\": [indep_utxo]})\n+        node.syncwithvalidationinterfacequeue()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r958748595",
      "id" : 958748595,
      "in_reply_to_id" : 958562071,
      "line" : 107,
      "node_id" : "PRRC_kwDOABII5845JVez",
      "original_commit_id" : "3405f3eed5cf841b23a569b64a376c2e5b5026cd",
      "original_line" : 107,
      "original_position" : 86,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 86,
      "pull_request_review_id" : 1090708240,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958748595/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-30T17:24:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958748595",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r958764740"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958764740"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oh, wrong line. I think this `syncwithvalidationinterfacequeue` is probably unneeded.",
      "commit_id" : "3405f3eed5cf841b23a569b64a376c2e5b5026cd",
      "created_at" : "2022-08-30T17:43:21Z",
      "diff_hunk" : "@@ -66,14 +65,57 @@ def run_test(self):\n         self.log.info(\"Bump time & check that transaction is rebroadcast\")\n         # Transaction should be rebroadcast approximately 24 hours in the future,\n         # but can range from 12-36. So bump 36 hours to be sure.\n-        with node.assert_debug_log(['ResendWalletTransactions: resubmit 1 unconfirmed transactions']):\n+        with node.assert_debug_log(['resubmit 1 unconfirmed transactions']):\n             node.setmocktime(now + 36 * 60 * 60)\n             # Tell scheduler to call MaybeResendWalletTxs now.\n             node.mockscheduler(60)\n         # Give some time for trickle to occur\n         node.setmocktime(now + 36 * 60 * 60 + 600)\n         peer_second.wait_for_broadcast([txid])\n \n+        self.log.info(\"Chain of unconfirmed not-in-mempool txs are rebroadcast\")\n+        # This tests that the node broadcasts the parent transaction before the child transaction.\n+        # To test that scenario, we need a method to reliably get a child transaction placed\n+        # in mapWallet positioned before the parent. We cannot predict the position in mapWallet,\n+        # but we can observe it using listreceivedbyaddress and other related RPCs.\n+        #\n+        # So we will create the child transaction, use listreceivedbyaddress to see what the\n+        # ordering of mapWallet is, if the child is not before the parent, we will create a new\n+        # child (via bumpfee) and remove the old child (via removeprunedfunds) until we get the\n+        # ordering of child before parent.\n+        child_txid = node.send(outputs=[{addr: 0.5}], options={\"inputs\": [{\"txid\":txid, \"vout\":0}]})[\"txid\"]\n+        while True:\n+            txids = node.listreceivedbyaddress(minconf=0, address_filter=addr)[0][\"txids\"]\n+            if txids == [child_txid, txid]:\n+                break\n+            bumped = node.bumpfee(child_txid)\n+            node.removeprunedfunds(child_txid)\n+            child_txid = bumped[\"txid\"]\n+        entry_time = node.getmempoolentry(child_txid)[\"time\"]\n+\n+        block_time = entry_time + 6 * 60\n+        node.setmocktime(block_time)\n+        block = create_block(int(node.getbestblockhash(), 16), create_coinbase(node.getblockcount() + 1), block_time)\n+        block.solve()\n+        node.submitblock(block.serialize().hex())\n+        node.syncwithvalidationinterfacequeue()\n+\n+        # Evict these txs from the mempool\n+        evict_time = block_time + 60 * 60 * DEFAULT_MEMPOOL_EXPIRY_HOURS + 5\n+        node.setmocktime(evict_time)\n+        indep_send = node.send(outputs=[{node.getnewaddress(): 1}], options={\"inputs\": [indep_utxo]})\n+        node.syncwithvalidationinterfacequeue()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r958764740",
      "id" : 958764740,
      "in_reply_to_id" : 958562071,
      "line" : 107,
      "node_id" : "PRRC_kwDOABII5845JZbE",
      "original_commit_id" : "3405f3eed5cf841b23a569b64a376c2e5b5026cd",
      "original_line" : 107,
      "original_position" : 86,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : 86,
      "pull_request_review_id" : 1090731869,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958764740/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-30T17:43:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958764740",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r962828563"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/962828563"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think both these checks would be more appropriate in `MaybeResendWalletTxs()` since they're more scheduling-like in nature. It would also address furszy's comment them since we don't need to check for `force` anymore (it's always True there). If you do this, you probably also want to duplicate `if (!fBroadcastTransactions)` there since it's a very cheap check and we could avoid iterating over the wallets.\r\n\r\nUnfortunately, we still need the `force` parameter when iterating over the transactions, otherwise `ResubmitWalletTransactions()`'s signature could have been simplified.",
      "commit_id" : "3405f3eed5cf841b23a569b64a376c2e5b5026cd",
      "created_at" : "2022-09-05T11:59:26Z",
      "diff_hunk" : "@@ -1925,43 +1897,69 @@ std::set<uint256> CWallet::GetTxConflicts(const CWalletTx& wtx) const\n     return result;\n }\n \n-// Rebroadcast transactions from the wallet. We do this on a random timer\n-// to slightly obfuscate which transactions come from our wallet.\n+// Resubmit transactions from the wallet to the mempool, optionally asking the\n+// mempool to relay them. On startup, we will do this for all unconfirmed\n+// transactions but will not ask the mempool to relay them. We do this on startup\n+// to ensure that our own mempool is aware of our transactions, and to also\n+// initialize nNextResend so that the actual rebroadcast is scheduled. There\n+// is a privacy side effect here as not broadcasting on startup also means that we won't\n+// inform the world of our wallet's state, particularly if the wallet (or node) is not\n+// yet synced.\n+//\n+// Otherwise this function is called periodically in order to relay our unconfirmed txs.\n+// We do this on a random timer to slightly obfuscate which transactions\n+// come from our wallet.\n //\n-// Ideally, we'd only resend transactions that we think should have been\n+// TODO: Ideally, we'd only resend transactions that we think should have been\n // mined in the most recent block. Any transaction that wasn't in the top\n // blockweight of transactions in the mempool shouldn't have been mined,\n // and so is probably just sitting in the mempool waiting to be confirmed.\n // Rebroadcasting does nothing to speed up confirmation and only damages\n // privacy.\n-void CWallet::ResendWalletTransactions()\n+//\n+// The `force` option results in all unconfirmed transactions being submitted to\n+// the mempool. This does not necessarily result in those transactions being relayed,\n+// that depends on the `relay` option. Periodic rebroadcast uses the pattern\n+// relay=true force=false (also the default values), while loading into the mempool\n+// (on start, or after import) uses relay=false force=true.\n+void CWallet::ResubmitWalletTransactions(bool relay, bool force)\n {\n+    // Don't attempt to resubmit if the wallet is configured to not broadcast,\n+    // even if forcing.\n+    if (!fBroadcastTransactions) return;\n+\n     // During reindex, importing and IBD, old wallet transactions become\n     // unconfirmed. Don't resend them as that would spam other nodes.\n-    if (!chain().isReadyToBroadcast()) return;\n+    // We only allow forcing mempool submission when not relaying to avoid this spam.\n+    if (!force && relay && !chain().isReadyToBroadcast()) return;\n \n     // Do this infrequently and randomly to avoid giving away\n     // that these are our transactions.\n-    if (GetTime() < nNextResend || !fBroadcastTransactions) return;\n-    bool fFirst = (nNextResend == 0);\n+    if (!force && GetTime() < nNextResend) return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r962828563",
      "id" : 962828563,
      "in_reply_to_id" : 958425911,
      "line" : 1938,
      "node_id" : "PRRC_kwDOABII5845Y5kT",
      "original_commit_id" : "10d91c5abe9ed7dcc237c9d52c588e7d26e162a4",
      "original_line" : 1938,
      "original_position" : 84,
      "original_start_line" : 1931,
      "path" : "src/wallet/wallet.cpp",
      "position" : 84,
      "pull_request_review_id" : 1087116790,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/962828563/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1931,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-05T12:01:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/962828563",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r975155047"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/975155047"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The locks are no longer needed and can be removed",
      "commit_id" : "3405f3eed5cf841b23a569b64a376c2e5b5026cd",
      "created_at" : "2022-09-20T10:09:23Z",
      "diff_hunk" : "@@ -295,7 +295,7 @@ RPCHelpMan importaddress()\n         RescanWallet(*pwallet, reserver);\n         {\n             LOCK(pwallet->cs_wallet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#discussion_r975155047",
      "id" : 975155047,
      "line" : 297,
      "node_id" : "PRRC_kwDOABII5846H69n",
      "original_commit_id" : "3405f3eed5cf841b23a569b64a376c2e5b5026cd",
      "original_line" : 297,
      "original_position" : 3,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/backup.cpp",
      "position" : 3,
      "pull_request_review_id" : 1113527156,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25768",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/975155047/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-20T10:09:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/975155047",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "If a user calls `importaddress` every 6 hours, this will block any p2p relay from ever happening?",
      "created_at" : "2022-09-20T16:40:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#issuecomment-1252619427",
      "id" : 1252619427,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25768",
      "node_id" : "IC_kwDOABII585KqXSj",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1252619427/reactions"
      },
      "updated_at" : "2022-09-20T16:40:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1252619427",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> If a user calls importaddress every 6 hours, this will block any p2p relay from ever happening?\r\n\r\nI addressed that in #26205",
      "created_at" : "2022-09-29T17:05:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25768#issuecomment-1262560534",
      "id" : 1262560534,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25768",
      "node_id" : "IC_kwDOABII585LQSUW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1262560534/reactions"
      },
      "updated_at" : "2022-09-29T17:05:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1262560534",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   }
]
