[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [achow101](https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1338162621) |\n| Stale ACK | [Xekyo](https://github.com/bitcoin/bitcoin/pull/25729#pullrequestreview-1065721188), [furszy](https://github.com/bitcoin/bitcoin/pull/25729#pullrequestreview-1188765351) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#26560](https://github.com/bitcoin/bitcoin/pull/26560) (wallet: bugfix, invalid CoinsResult cached total amount by furszy)\n* [#25806](https://github.com/bitcoin/bitcoin/pull/25806) (wallet: group outputs only once, decouple it from Coin Selection by furszy)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2022-07-28T15:56:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1198340570",
      "id" : 1198340570,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585HbTna",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1198340570/reactions"
      },
      "updated_at" : "2022-12-05T21:06:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1198340570",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "It shouldn't be necessary to pass an entire CMutableTransaction to SelectCoins. CoinSelectionParams already has the information about the sizes of the rest of the transaction, modulo the change output. So a calculation can be done with that information.\r\n\r\nAdditionally, depending on the algorithm used, there may or may not be a change output, so it's size will need to be accounted for in each size calculation.",
      "created_at" : "2022-07-28T17:20:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1198428003",
      "id" : 1198428003,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585Hbo9j",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1198428003/reactions"
      },
      "updated_at" : "2022-07-28T17:20:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1198428003",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thank you for the feedback @achow101.\r\nSizes in the `CoinSelectionParams` appear to be in \"bytes\" and not in \"weight\", so I'm not sure how to use them as the multiplier of each field hasn't been taken into account, unless I'm mistaken.\r\n\r\n> Additionally, depending on the algorithm used, there may or may not be a change output, so it's size will need to be accounted for in each size calculation.\r\n\r\nI'll look into that thanks.",
      "created_at" : "2022-07-28T18:38:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1198504505",
      "id" : 1198504505,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585Hb7o5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1198504505/reactions"
      },
      "updated_at" : "2022-07-28T18:39:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1198504505",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The size is always vsize, so multiplyging by WITNESS_SCALE_FACTOR is sufficient to convert to weight. There will be some rounding error, but vsize always rounds up, so weight calculated in that way will always be a slight overestimate.",
      "created_at" : "2022-07-28T18:44:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1198508956",
      "id" : 1198508956,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585Hb8uc",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1198508956/reactions"
      },
      "updated_at" : "2022-07-28T18:44:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1198508956",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I've removed the need for a dummy transaction.\r\nThough I'm not sure how to include the change output in the size calculation yet.",
      "created_at" : "2022-07-28T21:40:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1198660495",
      "id" : 1198660495,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585HchuP",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1198660495/reactions"
      },
      "updated_at" : "2022-07-28T21:40:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1198660495",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r932703415"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/932703415"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Can directly use `coin.input_bytes` instead of calculating the size again.",
      "commit_id" : "627b715f9da819ee0789a593c2a89737b5d8e941",
      "created_at" : "2022-07-28T21:43:13Z",
      "diff_hunk" : "@@ -516,14 +516,32 @@ std::optional<SelectionResult> ChooseSelectionResult(const CWallet& wallet, cons\n         results.push_back(*srd_result);\n     }\n \n-    if (results.size() == 0) {\n+    if (results.empty()) {\n         // No solution found\n         return std::nullopt;\n     }\n \n+    std::vector<SelectionResult> eligible_results;\n+    for (const auto& result : results) {\n+        int weight = coin_selection_params.tx_noinputs_size * WITNESS_SCALE_FACTOR;\n+        for (const auto& coin : result.GetInputSet()) {\n+            weight += CalculateMaximumSignedInputSize(coin.txout, &wallet, &coin_control) * WITNESS_SCALE_FACTOR;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r932703415",
      "id" : 932703415,
      "line" : 528,
      "node_id" : "PRRC_kwDOABII5843l-y3",
      "original_commit_id" : "627b715f9da819ee0789a593c2a89737b5d8e941",
      "original_line" : 528,
      "original_position" : 58,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 58,
      "pull_request_review_id" : 1054799836,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/932703415/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-28T21:44:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/932703415",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r932718807"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/932718807"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks, that's much better.",
      "commit_id" : "0741aaad37ffa4929e36c8dc761c2a7051170eea",
      "created_at" : "2022-07-28T22:11:16Z",
      "diff_hunk" : "@@ -516,14 +516,32 @@ std::optional<SelectionResult> ChooseSelectionResult(const CWallet& wallet, cons\n         results.push_back(*srd_result);\n     }\n \n-    if (results.size() == 0) {\n+    if (results.empty()) {\n         // No solution found\n         return std::nullopt;\n     }\n \n+    std::vector<SelectionResult> eligible_results;\n+    for (const auto& result : results) {\n+        int weight = coin_selection_params.tx_noinputs_size * WITNESS_SCALE_FACTOR;\n+        for (const auto& coin : result.GetInputSet()) {\n+            weight += CalculateMaximumSignedInputSize(coin.txout, &wallet, &coin_control) * WITNESS_SCALE_FACTOR;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r932718807",
      "id" : 932718807,
      "in_reply_to_id" : 932703415,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5843mCjX",
      "original_commit_id" : "627b715f9da819ee0789a593c2a89737b5d8e941",
      "original_line" : 528,
      "original_position" : 58,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 1054821588,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/932718807/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-28T22:11:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/932718807",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Pinging you @Xekyo as you commented on the issue recently.",
      "created_at" : "2022-08-03T15:15:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1204085880",
      "id" : 1204085880,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585HxOR4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1204085880/reactions"
      },
      "updated_at" : "2022-08-05T08:32:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1204085880",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Cool, thank you for working on this. This PR as it is would get us almost all the way there as it should ensure that any coin selection results that exceeded the weight limit get filtered out before we do our final pick out of the selection candidates. Now we'll succeed at building a transaction if there is at least one selection result that doesn't exceed the weight limit, where we might have failed previously if that solution had the best waste score (and that would be the case at a low feerate, as a higher total input weight would get preferred).\r\n\r\n----\r\n\r\nI was pondering whether this would fail to find an existing solution in any scenario. I came up with this:\r\n\r\nSend â¿49.5 at a low feerate from a UXTO pool with\r\nâ¢ 10,000â¯P2PKH inputs of â¿0.04\r\nâ¢ 1,455 P2WPKH inputs of â¿0.034\r\n\r\nExplanation:\r\nâ¢ The UTXO pool has enough funds to pay for the transaction\r\nâ¢ At a negligible `not_input_size`, a standard transaction can have about ~675 P2PKH inputs, but 1470â¯P2WPKH inputs\r\nâ¢ With the above UTXOs, it would take 1,238 P2PKH inputs to pay for the transaction (which would exceed the limit by far), and it awould take 1,456 P2WPKH inputs to pay for the transaction (but there are too few)\r\nâ Only an input set from mixed inputs that is almost exclusively composed from P2WPKH inputs (and a single digit number of P2PKH inputs) would result in a standard transaction\r\n\r\nI don't think that any of our coin selection approaches would find such an input set, even if we added backtracking to BnB when the standard weight limit is exceeded. I figure that to succeed in this edge-case we would need an explicit mechanism to replace the inputs with the lowest value per weight once we exceed the standard weight limit. E.g. adding a heap to SRD that sorts the input set by `effectiveValue/weight`. I think this is out of scope though.\r\n\r\n\r\n------\r\n\r\n\r\nApproach ACK, will have to get back to review the code more carefully.",
      "created_at" : "2022-08-04T22:28:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1205831596",
      "id" : 1205831596,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585H34es",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1205831596/reactions"
      },
      "updated_at" : "2022-08-04T22:28:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1205831596",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased because of silent merge conflict.",
      "created_at" : "2022-08-08T09:03:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1207859533",
      "id" : 1207859533,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585H_nlN",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1207859533/reactions"
      },
      "updated_at" : "2022-08-08T09:03:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1207859533",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Send â¿49.5 at a low feerate from a UXTO pool with\r\n> â¢ 10,000â¯P2PKH inputs of â¿0.04\r\n> â¢ 1,455 P2WPKH inputs of â¿0.034\r\n\r\nI tested this case with the following code and the coin selector did not find a result as you said @Xekyo.\r\n\r\n```cpp\r\n{\r\n    // Send â¿49.5 at a low feerate from a UXTO pool with\r\n    // 10,000â¯P2PKH inputs of â¿0.04\r\n    // 1,455 P2WPKH inputs of â¿0.034\r\n\r\n    std::unique_ptr<CWallet> wallet = std::make_unique<CWallet>(m_node.chain.get(), \"\", m_args, CreateMockWalletDatabase());\r\n    wallet->LoadWallet();\r\n    LOCK(wallet->cs_wallet);\r\n    wallet->SetupLegacyScriptPubKeyMan();\r\n\r\n    CoinsResult available_coins;\r\n    for (int j = 0; j < 10000; ++j) {\r\n        add_coin(available_coins, *wallet, CAmount(0.04 * COIN), CFeeRate(0), 144, false, 0, true);\r\n    }\r\n\r\n    for (int j = 0; j < 1455; ++j) {\r\n        add_coin(available_coins, *wallet, CAmount(0.034 * COIN), CFeeRate(0), 144, false, 0, true);\r\n    }\r\n\r\n    const auto result = SelectCoins(*wallet, available_coins, target, cc, cs_params);\r\n    BOOST_CHECK(result);\r\n}\r\n```",
      "created_at" : "2022-08-08T09:08:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1207863706",
      "id" : 1207863706,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585H_oma",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1207863706/reactions"
      },
      "updated_at" : "2022-08-08T09:08:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1207863706",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r940619491"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/940619491"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`Insufficient funds` might be a confusing error message since the wallet would also report having sufficient funds at the same time. Perhaps we could return a more specific error, if the last attempt returns from `eligible_results` being empty e.g. `Cannot fund transaction, wallet too fragmented`.",
      "commit_id" : "c166411dad1f4cdaa61f70b92728ecebfc3fc749",
      "created_at" : "2022-08-08T20:05:57Z",
      "diff_hunk" : "@@ -980,7 +980,7 @@ def test_transaction_too_large(self):\n             outputs[recipient.getnewaddress()] = 0.1\n         wallet.sendmany(\"\", outputs)\n         self.generate(self.nodes[0], 10)\n-        assert_raises_rpc_error(-4, \"Transaction too large\", recipient.fundrawtransaction, rawtx)\n+        assert_raises_rpc_error(-4, \"Insufficient funds\", recipient.fundrawtransaction, rawtx)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r940619491",
      "id" : 940619491,
      "line" : 983,
      "node_id" : "PRRC_kwDOABII5844ELbj",
      "original_commit_id" : "c166411dad1f4cdaa61f70b92728ecebfc3fc749",
      "original_line" : 983,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/rpc_fundrawtransaction.py",
      "position" : 5,
      "pull_request_review_id" : 1065721188,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/940619491/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-08T20:16:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/940619491",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r940621174"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/940621174"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Perhaps we could store some âresult hintâ when we get into this if-block on a coin selection attempt that we could later use to inform the result message.",
      "commit_id" : "c166411dad1f4cdaa61f70b92728ecebfc3fc749",
      "created_at" : "2022-08-08T20:08:12Z",
      "diff_hunk" : "@@ -518,14 +520,27 @@ std::optional<SelectionResult> ChooseSelectionResult(const CWallet& wallet, cons\n         results.push_back(*srd_result);\n     }\n \n-    if (results.size() == 0) {\n+    if (results.empty()) {\n         // No solution found\n         return std::nullopt;\n     }\n \n+    std::vector<SelectionResult> eligible_results;\n+    std::copy_if(results.begin(), results.end(), std::back_inserter(eligible_results), [coin_selection_params](const SelectionResult& result) {\n+        const int weight = std::accumulate(result.GetInputSet().begin(), result.GetInputSet().end(), static_cast<int>(coin_selection_params.tx_noinputs_size * WITNESS_SCALE_FACTOR), [](int acc, const auto& coin) {\n+            return acc + coin.input_bytes * WITNESS_SCALE_FACTOR;\n+        });\n+\n+        return weight <= static_cast<int>(MAX_STANDARD_TX_WEIGHT);\n+    });\n+\n+    if (eligible_results.empty()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r940621174",
      "id" : 940621174,
      "line" : 537,
      "node_id" : "PRRC_kwDOABII5844EL12",
      "original_commit_id" : "c166411dad1f4cdaa61f70b92728ecebfc3fc749",
      "original_line" : 537,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 31,
      "pull_request_review_id" : 1065721188,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/940621174/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-08T20:16:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/940621174",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r941824885"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/941824885"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Here's my attempt a3dece4e41de7bd5e118278abf09abcd2fcb4922.",
      "commit_id" : "a3dece4e41de7bd5e118278abf09abcd2fcb4922",
      "created_at" : "2022-08-09T21:37:14Z",
      "diff_hunk" : "@@ -518,14 +520,27 @@ std::optional<SelectionResult> ChooseSelectionResult(const CWallet& wallet, cons\n         results.push_back(*srd_result);\n     }\n \n-    if (results.size() == 0) {\n+    if (results.empty()) {\n         // No solution found\n         return std::nullopt;\n     }\n \n+    std::vector<SelectionResult> eligible_results;\n+    std::copy_if(results.begin(), results.end(), std::back_inserter(eligible_results), [coin_selection_params](const SelectionResult& result) {\n+        const int weight = std::accumulate(result.GetInputSet().begin(), result.GetInputSet().end(), static_cast<int>(coin_selection_params.tx_noinputs_size * WITNESS_SCALE_FACTOR), [](int acc, const auto& coin) {\n+            return acc + coin.input_bytes * WITNESS_SCALE_FACTOR;\n+        });\n+\n+        return weight <= static_cast<int>(MAX_STANDARD_TX_WEIGHT);\n+    });\n+\n+    if (eligible_results.empty()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r941824885",
      "id" : 941824885,
      "in_reply_to_id" : 940621174,
      "line" : 560,
      "node_id" : "PRRC_kwDOABII5844Ixt1",
      "original_commit_id" : "c166411dad1f4cdaa61f70b92728ecebfc3fc749",
      "original_line" : 560,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 242,
      "pull_request_review_id" : 1067413121,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/941824885/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-09T21:37:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/941824885",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I have rebased this PR on top of #25734 (slightly rebased because of merge conflicts of the original PR).\r\nAdded a3dece4e41de7bd5e118278abf09abcd2fcb4922 to show a more specific error message when the transaction weight is exceeded during the coin selection.",
      "created_at" : "2022-08-09T21:39:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1209921138",
      "id" : 1209921138,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585IHe5y",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1209921138/reactions"
      },
      "updated_at" : "2022-08-09T21:39:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1209921138",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "About the specific error messages topic, I don't think that passing an enum reference to the function is the best solution. We have the `util::Result` class to cover this purpose (more info in #25218 and #25721)\r\n\r\nPlus, some notes about this in case you haven't seen them:\r\n\r\n* I have decoupled the preset inputs fetching block of code from `SelectCoins` and added `util::Result` class connection with proper error descriptions in #25685.\r\n(the error descriptions there are not due \"Insufficient Funds\", that was wrong).\r\n\r\n* And then have #25806, which has 3b3054f9 which basically adds `util::Result` error support to the entire `SelectCoins` function (which is what I would say that you actually need here).\r\n\r\nSo, would suggest to either cherry-pick 3b3054f9 here, so can return the error string (returning an empty string if the error is \"Insufficient Funds\" so there aren't changes out of the scope of the PR and you can still return the specific error) or, if you don't want it, maybe leave the proper error description point for a follow-up PR and only focus on the functionality here.",
      "created_at" : "2022-08-09T22:45:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1209966225",
      "id" : 1209966225,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585IHp6R",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1209966225/reactions"
      },
      "updated_at" : "2022-08-09T23:12:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1209966225",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thank you @furszy for your comments!\r\nI'll probably wait until #25806 and #25734 are merged before continuing working on this error message commit and will drop a3dece4e41de7bd5e118278abf09abcd2fcb4922 in the meantime.\r\nI rebased it again since #25734 just got rebased.",
      "created_at" : "2022-08-10T16:02:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1210915414",
      "id" : 1210915414,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585ILRpW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1210915414/reactions"
      },
      "updated_at" : "2022-08-10T16:02:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1210915414",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r974690021"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974690021"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`tx_noinputs_size` is 0 when we are subtracting the fee from the outputs, so using it here may not always result in the correct calculation.",
      "commit_id" : "c9c55455a942165ef0220a430a986c4655ece528",
      "created_at" : "2022-09-19T21:06:01Z",
      "diff_hunk" : "@@ -531,14 +533,27 @@ std::optional<SelectionResult> ChooseSelectionResult(const CWallet& wallet, cons\n         results.push_back(*srd_result);\n     }\n \n-    if (results.size() == 0) {\n+    if (results.empty()) {\n         // No solution found\n         return std::nullopt;\n     }\n \n+    std::vector<SelectionResult> eligible_results;\n+    std::copy_if(results.begin(), results.end(), std::back_inserter(eligible_results), [coin_selection_params](const SelectionResult& result) {\n+        const int weight = std::accumulate(result.GetInputSet().begin(), result.GetInputSet().end(), static_cast<int>(coin_selection_params.tx_noinputs_size * WITNESS_SCALE_FACTOR), [](int acc, const auto& coin) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r974690021",
      "id" : 974690021,
      "line" : 543,
      "node_id" : "PRRC_kwDOABII5846GJbl",
      "original_commit_id" : "c9c55455a942165ef0220a430a986c4655ece528",
      "original_line" : 543,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 24,
      "pull_request_review_id" : 1112881164,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974690021/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-19T21:06:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974690021",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r974696402"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974696402"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Since sizes are already being hardcoded above for `change_output_size` and `change_spend_size`, I think it's fine to hard code this as well instead of having to create an entire wallet just to fetch a single destination in order to get this size, where accuracy also doesn't really matter.",
      "commit_id" : "c9c55455a942165ef0220a430a986c4655ece528",
      "created_at" : "2022-09-19T21:15:20Z",
      "diff_hunk" : "@@ -917,5 +917,176 @@ BOOST_AUTO_TEST_CASE(effective_value_test)\n     BOOST_CHECK_EQUAL(output5.GetEffectiveValue(), nValue); // The effective value should be equal to the absolute value if input_bytes is -1\n }\n \n+BOOST_AUTO_TEST_CASE(check_max_weight)\n+{\n+    const CAmount target = 49.5L * COIN;\n+    CCoinControl cc;\n+\n+    std::unique_ptr<CWallet> tmpWallet = std::make_unique<CWallet>(m_node.chain.get(), \"\", m_args, CreateMockWalletDatabase());\n+    tmpWallet->LoadWallet();\n+    LOCK(tmpWallet->cs_wallet);\n+    tmpWallet->SetupLegacyScriptPubKeyMan();\n+\n+    const auto op_dest = tmpWallet->GetNewDestination(OutputType::BECH32, \"\");\n+    BOOST_ASSERT(op_dest);\n+    const auto scriptPubKey = GetScriptForDestination(op_dest.value());\n+    const auto txout = CTxOut(target, scriptPubKey);\n+\n+    FastRandomContext rand;\n+    CoinSelectionParams cs_params{\n+        rand,\n+        /*change_output_size=*/34,\n+        /*change_spend_size=*/148,\n+        /*min_change_target=*/CENT,\n+        /*effective_feerate=*/CFeeRate(0),\n+        /*long_term_feerate=*/CFeeRate(0),\n+        /*discard_feerate=*/CFeeRate(0),\n+        /*tx_noinputs_size=*/static_cast<size_t>(10) + GetSerializeSize(txout, PROTOCOL_VERSION), // static header size + output size",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r974696402",
      "id" : 974696402,
      "line" : 944,
      "node_id" : "PRRC_kwDOABII5846GK_S",
      "original_commit_id" : "c9c55455a942165ef0220a430a986c4655ece528",
      "original_line" : 944,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : 28,
      "pull_request_review_id" : 1112890070,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974696402/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-19T21:18:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974696402",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r974697055"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974697055"
         }
      },
      "author_association" : "MEMBER",
      "body" : "While these values don't particularly matter, they should probably match the p2wpkh sizes rather than the p2pkh.\r\n\r\n```suggestion\r\n        /*change_output_size=*/31,\r\n        /*change_spend_size=*/68,\r\n```",
      "commit_id" : "c9c55455a942165ef0220a430a986c4655ece528",
      "created_at" : "2022-09-19T21:16:19Z",
      "diff_hunk" : "@@ -917,5 +917,176 @@ BOOST_AUTO_TEST_CASE(effective_value_test)\n     BOOST_CHECK_EQUAL(output5.GetEffectiveValue(), nValue); // The effective value should be equal to the absolute value if input_bytes is -1\n }\n \n+BOOST_AUTO_TEST_CASE(check_max_weight)\n+{\n+    const CAmount target = 49.5L * COIN;\n+    CCoinControl cc;\n+\n+    std::unique_ptr<CWallet> tmpWallet = std::make_unique<CWallet>(m_node.chain.get(), \"\", m_args, CreateMockWalletDatabase());\n+    tmpWallet->LoadWallet();\n+    LOCK(tmpWallet->cs_wallet);\n+    tmpWallet->SetupLegacyScriptPubKeyMan();\n+\n+    const auto op_dest = tmpWallet->GetNewDestination(OutputType::BECH32, \"\");\n+    BOOST_ASSERT(op_dest);\n+    const auto scriptPubKey = GetScriptForDestination(op_dest.value());\n+    const auto txout = CTxOut(target, scriptPubKey);\n+\n+    FastRandomContext rand;\n+    CoinSelectionParams cs_params{\n+        rand,\n+        /*change_output_size=*/34,\n+        /*change_spend_size=*/148,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r974697055",
      "id" : 974697055,
      "line" : 939,
      "node_id" : "PRRC_kwDOABII5846GLJf",
      "original_commit_id" : "c9c55455a942165ef0220a430a986c4655ece528",
      "original_line" : 939,
      "original_position" : 23,
      "original_start_line" : 938,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : 23,
      "pull_request_review_id" : 1112890070,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974697055/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 938,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-19T21:18:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974697055",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r974697295"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974697295"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Let's avoid making LegacySPKMs in tests which are not specifically testing that behavior.",
      "commit_id" : "c9c55455a942165ef0220a430a986c4655ece528",
      "created_at" : "2022-09-19T21:16:43Z",
      "diff_hunk" : "@@ -917,5 +917,176 @@ BOOST_AUTO_TEST_CASE(effective_value_test)\n     BOOST_CHECK_EQUAL(output5.GetEffectiveValue(), nValue); // The effective value should be equal to the absolute value if input_bytes is -1\n }\n \n+BOOST_AUTO_TEST_CASE(check_max_weight)\n+{\n+    const CAmount target = 49.5L * COIN;\n+    CCoinControl cc;\n+\n+    std::unique_ptr<CWallet> tmpWallet = std::make_unique<CWallet>(m_node.chain.get(), \"\", m_args, CreateMockWalletDatabase());\n+    tmpWallet->LoadWallet();\n+    LOCK(tmpWallet->cs_wallet);\n+    tmpWallet->SetupLegacyScriptPubKeyMan();\n+\n+    const auto op_dest = tmpWallet->GetNewDestination(OutputType::BECH32, \"\");\n+    BOOST_ASSERT(op_dest);\n+    const auto scriptPubKey = GetScriptForDestination(op_dest.value());\n+    const auto txout = CTxOut(target, scriptPubKey);\n+\n+    FastRandomContext rand;\n+    CoinSelectionParams cs_params{\n+        rand,\n+        /*change_output_size=*/34,\n+        /*change_spend_size=*/148,\n+        /*min_change_target=*/CENT,\n+        /*effective_feerate=*/CFeeRate(0),\n+        /*long_term_feerate=*/CFeeRate(0),\n+        /*discard_feerate=*/CFeeRate(0),\n+        /*tx_noinputs_size=*/static_cast<size_t>(10) + GetSerializeSize(txout, PROTOCOL_VERSION), // static header size + output size\n+        /*avoid_partial=*/false,\n+    };\n+\n+    CMutableTransaction txDummy;\n+    txDummy.vout.push_back(txout);\n+\n+    {\n+        // Scenario 1:\n+        // The actor starts with 1x 50.0 BTC and 1000x 0.05 BTC (100.0 BTC total) unspent outputs\n+        // Then tries to spend 49.5 BTC\n+        // The 50.0 BTC output should be selected, because the transaction would otherwise be too large\n+\n+        std::unique_ptr<CWallet> wallet = std::make_unique<CWallet>(m_node.chain.get(), \"\", m_args, CreateMockWalletDatabase());\n+        wallet->LoadWallet();\n+        LOCK(wallet->cs_wallet);\n+        wallet->SetupLegacyScriptPubKeyMan();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r974697295",
      "id" : 974697295,
      "line" : 960,
      "node_id" : "PRRC_kwDOABII5846GLNP",
      "original_commit_id" : "c9c55455a942165ef0220a430a986c4655ece528",
      "original_line" : 960,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : 44,
      "pull_request_review_id" : 1112890070,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974697295/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-19T21:18:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974697295",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r974698104"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974698104"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ISTM these tests could be deduplicated intoa helper function with each scenario just being a set of parameters as each test case does basically the same thing but with slightly different params.",
      "commit_id" : "c9c55455a942165ef0220a430a986c4655ece528",
      "created_at" : "2022-09-19T21:18:00Z",
      "diff_hunk" : "@@ -917,5 +917,176 @@ BOOST_AUTO_TEST_CASE(effective_value_test)\n     BOOST_CHECK_EQUAL(output5.GetEffectiveValue(), nValue); // The effective value should be equal to the absolute value if input_bytes is -1\n }\n \n+BOOST_AUTO_TEST_CASE(check_max_weight)\n+{\n+    const CAmount target = 49.5L * COIN;\n+    CCoinControl cc;\n+\n+    std::unique_ptr<CWallet> tmpWallet = std::make_unique<CWallet>(m_node.chain.get(), \"\", m_args, CreateMockWalletDatabase());\n+    tmpWallet->LoadWallet();\n+    LOCK(tmpWallet->cs_wallet);\n+    tmpWallet->SetupLegacyScriptPubKeyMan();\n+\n+    const auto op_dest = tmpWallet->GetNewDestination(OutputType::BECH32, \"\");\n+    BOOST_ASSERT(op_dest);\n+    const auto scriptPubKey = GetScriptForDestination(op_dest.value());\n+    const auto txout = CTxOut(target, scriptPubKey);\n+\n+    FastRandomContext rand;\n+    CoinSelectionParams cs_params{\n+        rand,\n+        /*change_output_size=*/34,\n+        /*change_spend_size=*/148,\n+        /*min_change_target=*/CENT,\n+        /*effective_feerate=*/CFeeRate(0),\n+        /*long_term_feerate=*/CFeeRate(0),\n+        /*discard_feerate=*/CFeeRate(0),\n+        /*tx_noinputs_size=*/static_cast<size_t>(10) + GetSerializeSize(txout, PROTOCOL_VERSION), // static header size + output size\n+        /*avoid_partial=*/false,\n+    };\n+\n+    CMutableTransaction txDummy;\n+    txDummy.vout.push_back(txout);\n+\n+    {\n+        // Scenario 1:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r974698104",
      "id" : 974698104,
      "line" : 952,
      "node_id" : "PRRC_kwDOABII5846GLZ4",
      "original_commit_id" : "c9c55455a942165ef0220a430a986c4655ece528",
      "original_line" : 952,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : 36,
      "pull_request_review_id" : 1112890070,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974698104/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-19T21:18:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974698104",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r974698287"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974698287"
         }
      },
      "author_association" : "MEMBER",
      "body" : "A comment for this test case would be nice.",
      "commit_id" : "c9c55455a942165ef0220a430a986c4655ece528",
      "created_at" : "2022-09-19T21:18:20Z",
      "diff_hunk" : "@@ -917,5 +917,176 @@ BOOST_AUTO_TEST_CASE(effective_value_test)\n     BOOST_CHECK_EQUAL(output5.GetEffectiveValue(), nValue); // The effective value should be equal to the absolute value if input_bytes is -1\n }\n \n+BOOST_AUTO_TEST_CASE(check_max_weight)\n+{\n+    const CAmount target = 49.5L * COIN;\n+    CCoinControl cc;\n+\n+    std::unique_ptr<CWallet> tmpWallet = std::make_unique<CWallet>(m_node.chain.get(), \"\", m_args, CreateMockWalletDatabase());\n+    tmpWallet->LoadWallet();\n+    LOCK(tmpWallet->cs_wallet);\n+    tmpWallet->SetupLegacyScriptPubKeyMan();\n+\n+    const auto op_dest = tmpWallet->GetNewDestination(OutputType::BECH32, \"\");\n+    BOOST_ASSERT(op_dest);\n+    const auto scriptPubKey = GetScriptForDestination(op_dest.value());\n+    const auto txout = CTxOut(target, scriptPubKey);\n+\n+    FastRandomContext rand;\n+    CoinSelectionParams cs_params{\n+        rand,\n+        /*change_output_size=*/34,\n+        /*change_spend_size=*/148,\n+        /*min_change_target=*/CENT,\n+        /*effective_feerate=*/CFeeRate(0),\n+        /*long_term_feerate=*/CFeeRate(0),\n+        /*discard_feerate=*/CFeeRate(0),\n+        /*tx_noinputs_size=*/static_cast<size_t>(10) + GetSerializeSize(txout, PROTOCOL_VERSION), // static header size + output size\n+        /*avoid_partial=*/false,\n+    };\n+\n+    CMutableTransaction txDummy;\n+    txDummy.vout.push_back(txout);\n+\n+    {\n+        // Scenario 1:\n+        // The actor starts with 1x 50.0 BTC and 1000x 0.05 BTC (100.0 BTC total) unspent outputs\n+        // Then tries to spend 49.5 BTC\n+        // The 50.0 BTC output should be selected, because the transaction would otherwise be too large\n+\n+        std::unique_ptr<CWallet> wallet = std::make_unique<CWallet>(m_node.chain.get(), \"\", m_args, CreateMockWalletDatabase());\n+        wallet->LoadWallet();\n+        LOCK(wallet->cs_wallet);\n+        wallet->SetupLegacyScriptPubKeyMan();\n+\n+        CoinsResult available_coins;\n+        for (int j = 0; j < 1000; ++j) {\n+            add_coin(available_coins, *wallet, CAmount(0.05 * COIN), CFeeRate(0), 144, false, 0, true);\n+        }\n+\n+        add_coin(available_coins, *wallet, CAmount(50 * COIN), CFeeRate(0), 144, false, 0, true);\n+\n+        // Perform selection\n+        const auto result = SelectCoins(*wallet, available_coins, target, cc, cs_params);\n+        BOOST_CHECK(result);\n+        const bool has_50_coin = std::any_of(result->GetInputSet().begin(), result->GetInputSet().end(), [](const auto& coin) {\n+            return coin.GetEffectiveValue() == 50 * COIN;\n+        });\n+        BOOST_CHECK(has_50_coin);\n+        txDummy.vin.clear();\n+        for (const auto& coin : result->GetInputSet()) {\n+            txDummy.vin.push_back(CTxIn(coin.outpoint, CScript(), 0));\n+        }\n+        const auto txSize = CalculateMaximumSignedTxSize(CTransaction(txDummy), wallet.get(), &cc);\n+        BOOST_CHECK_LE(txSize.weight, MAX_STANDARD_TX_WEIGHT);\n+\n+        BOOST_CHECK_GE(result->GetSelectedValue(), target);\n+    }\n+\n+    {\n+        // Scenario 2:\n+\n+        // The actor starts with 500x 0.1 BTC and 1000x 0.05 BTC (100.0 BTC total) unspent outputs\n+        // Then tries to spend 49.5 BTC\n+        // A combination of coins should be selected, such that the created transaction is not too large\n+        std::unique_ptr<CWallet> wallet = std::make_unique<CWallet>(m_node.chain.get(), \"\", m_args, CreateMockWalletDatabase());\n+        wallet->LoadWallet();\n+        LOCK(wallet->cs_wallet);\n+        wallet->SetupLegacyScriptPubKeyMan();\n+\n+        CoinsResult available_coins;\n+        for (int j = 0; j < 500; ++j) {\n+            add_coin(available_coins, *wallet, CAmount(0.1 * COIN), CFeeRate(0), 144, false, 0, true);\n+        }\n+        for (int j = 0; j < 1000; ++j) {\n+            add_coin(available_coins, *wallet, CAmount(0.05 * COIN), CFeeRate(0), 144, false, 0, true);\n+        }\n+\n+        // Perform selection\n+        const auto result = SelectCoins(*wallet, available_coins, target, cc, cs_params);\n+        BOOST_CHECK(result);\n+        const bool has_0_1_coin = std::any_of(result->GetInputSet().begin(), result->GetInputSet().end(), [](const auto& coin) {\n+            return coin.GetEffectiveValue() == 0.1 * COIN;\n+        });\n+        const bool has_0_05_coin = std::any_of(result->GetInputSet().begin(), result->GetInputSet().end(), [](const auto& coin) {\n+            return coin.GetEffectiveValue() == 0.05 * COIN;\n+        });\n+        const bool has_not_50_coin = std::any_of(result->GetInputSet().begin(), result->GetInputSet().end(), [](const auto& coin) {\n+            return coin.GetEffectiveValue() != 50 * COIN;\n+        });\n+        BOOST_CHECK(has_0_1_coin);\n+        BOOST_CHECK(has_0_05_coin);\n+        BOOST_CHECK(has_not_50_coin);\n+        txDummy.vin.clear();\n+        for (const auto& coin : result->GetInputSet()) {\n+            txDummy.vin.push_back(CTxIn(coin.outpoint, CScript(), 0));\n+        }\n+        const auto txSize = CalculateMaximumSignedTxSize(CTransaction(txDummy), wallet.get(), &cc);\n+        BOOST_CHECK_LE(txSize.weight, MAX_STANDARD_TX_WEIGHT);\n+        BOOST_CHECK_GE(result->GetSelectedValue(), target);\n+    }\n+\n+    {\n+        // Scenario 3 (available as RPC test):\n+\n+        // The actor starts with 1x 50.0 BTC, 500x 0.1 BTC and 1000x 0.05 BTC (150.0 BTC total) unspent outputs\n+        // Then tries to spend 49.5 BTC\n+        // A combination of coins should be selected, such that the created transaction is not too large\n+        std::unique_ptr<CWallet> wallet = std::make_unique<CWallet>(m_node.chain.get(), \"\", m_args, CreateMockWalletDatabase());\n+        wallet->LoadWallet();\n+        LOCK(wallet->cs_wallet);\n+        wallet->SetupLegacyScriptPubKeyMan();\n+\n+        CoinsResult available_coins;\n+        for (int j = 0; j < 1000; ++j) {\n+            add_coin(available_coins, *wallet, CAmount(0.05 * COIN), CFeeRate(0), 144, false, 0, true);\n+        }\n+        for (int j = 0; j < 500; ++j) {\n+            add_coin(available_coins, *wallet, CAmount(0.1 * COIN), CFeeRate(0), 144, false, 0, true);\n+        }\n+        add_coin(available_coins, *wallet, CAmount(50 * COIN), CFeeRate(0), 144, false, 0, true);\n+\n+        // Perform selection\n+        const auto result = SelectCoins(*wallet, available_coins, target, cc, cs_params);\n+        BOOST_CHECK(result);\n+        const bool has_0_1_coin = std::any_of(result->GetInputSet().begin(), result->GetInputSet().end(), [](const auto& coin) {\n+            return coin.GetEffectiveValue() == 0.1 * COIN;\n+        });\n+        const bool has_0_05_coin = std::any_of(result->GetInputSet().begin(), result->GetInputSet().end(), [](const auto& coin) {\n+            return coin.GetEffectiveValue() == 0.05 * COIN;\n+        });\n+        const bool has_not_50_coin = std::any_of(result->GetInputSet().begin(), result->GetInputSet().end(), [](const auto& coin) {\n+            return coin.GetEffectiveValue() != 50 * COIN;\n+        });\n+        BOOST_CHECK(has_0_1_coin);\n+        BOOST_CHECK(has_0_05_coin);\n+        BOOST_CHECK(has_not_50_coin);\n+\n+        txDummy.vin.clear();\n+        for (const auto& coin : result->GetInputSet()) {\n+            txDummy.vin.push_back(CTxIn(coin.outpoint, CScript(), 0));\n+        }\n+        const auto txSize = CalculateMaximumSignedTxSize(CTransaction(txDummy), wallet.get(), &cc);\n+        BOOST_CHECK_LE(txSize.weight, MAX_STANDARD_TX_WEIGHT);\n+        BOOST_CHECK_GE(result->GetSelectedValue(), target);\n+    }\n+\n+    {\n+        std::unique_ptr<CWallet> wallet = std::make_unique<CWallet>(m_node.chain.get(), \"\", m_args, CreateMockWalletDatabase());\n+        wallet->LoadWallet();\n+        LOCK(wallet->cs_wallet);\n+        wallet->SetupLegacyScriptPubKeyMan();\n+\n+        CoinsResult available_coins;\n+        for (int j = 0; j < 3000; ++j) {\n+            add_coin(available_coins, *wallet, CAmount(0.017 * COIN), CFeeRate(0), 144, false, 0, true);\n+        }\n+\n+        // Perform selection\n+        const auto result = SelectCoins(*wallet, available_coins, target, cc, cs_params);\n+        BOOST_CHECK(!result);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r974698287",
      "id" : 974698287,
      "line" : 1087,
      "node_id" : "PRRC_kwDOABII5846GLcv",
      "original_commit_id" : "c9c55455a942165ef0220a430a986c4655ece528",
      "original_line" : 1087,
      "original_position" : 171,
      "original_start_line" : 1075,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : 171,
      "pull_request_review_id" : 1112890070,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974698287/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1075,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-19T21:18:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/974698287",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r975280056"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/975280056"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Do you know how I can take this into account? I did hear you say \"fuck\" on your stream VOD while reviewing this so I guess that's not trivial?",
      "commit_id" : "32a233773b4536aadecd00a52c897614dc9981b8",
      "created_at" : "2022-09-20T12:11:25Z",
      "diff_hunk" : "@@ -531,14 +533,27 @@ std::optional<SelectionResult> ChooseSelectionResult(const CWallet& wallet, cons\n         results.push_back(*srd_result);\n     }\n \n-    if (results.size() == 0) {\n+    if (results.empty()) {\n         // No solution found\n         return std::nullopt;\n     }\n \n+    std::vector<SelectionResult> eligible_results;\n+    std::copy_if(results.begin(), results.end(), std::back_inserter(eligible_results), [coin_selection_params](const SelectionResult& result) {\n+        const int weight = std::accumulate(result.GetInputSet().begin(), result.GetInputSet().end(), static_cast<int>(coin_selection_params.tx_noinputs_size * WITNESS_SCALE_FACTOR), [](int acc, const auto& coin) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r975280056",
      "id" : 975280056,
      "in_reply_to_id" : 974690021,
      "line" : 543,
      "node_id" : "PRRC_kwDOABII5846IZe4",
      "original_commit_id" : "c9c55455a942165ef0220a430a986c4655ece528",
      "original_line" : 543,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 24,
      "pull_request_review_id" : 1113694871,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/975280056/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-20T12:11:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/975280056",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I refactored the tests and changed the values a bit because I switched from a legacy wallet to a descriptor wallet.\r\nAlso documented the last test.",
      "created_at" : "2022-09-20T12:12:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1252266338",
      "id" : 1252266338,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585KpBFi",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1252266338/reactions"
      },
      "updated_at" : "2022-09-20T12:12:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1252266338",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r975531803"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/975531803"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The easiest way to handle this is to change when and how `tx_noinputs_size` is calculated and used. Essentially you need to find everywhere that `tx_noinputs_size` is being set/updated and make sure that the places that use `tx_noinputs_size` for calculations treat it as if it were 0 when SFFO. I don't think this should be too difficult as it is only used within `CreateTransactionInternal` and only for calculating `not_input_fees`.",
      "commit_id" : "32a233773b4536aadecd00a52c897614dc9981b8",
      "created_at" : "2022-09-20T15:38:23Z",
      "diff_hunk" : "@@ -531,14 +533,27 @@ std::optional<SelectionResult> ChooseSelectionResult(const CWallet& wallet, cons\n         results.push_back(*srd_result);\n     }\n \n-    if (results.size() == 0) {\n+    if (results.empty()) {\n         // No solution found\n         return std::nullopt;\n     }\n \n+    std::vector<SelectionResult> eligible_results;\n+    std::copy_if(results.begin(), results.end(), std::back_inserter(eligible_results), [coin_selection_params](const SelectionResult& result) {\n+        const int weight = std::accumulate(result.GetInputSet().begin(), result.GetInputSet().end(), static_cast<int>(coin_selection_params.tx_noinputs_size * WITNESS_SCALE_FACTOR), [](int acc, const auto& coin) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r975531803",
      "id" : 975531803,
      "in_reply_to_id" : 974690021,
      "line" : 543,
      "node_id" : "PRRC_kwDOABII5846JW8b",
      "original_commit_id" : "c9c55455a942165ef0220a430a986c4655ece528",
      "original_line" : 543,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 24,
      "pull_request_review_id" : 1114065744,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/975531803/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-20T15:38:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/975531803",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r975778219"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/975778219"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I am not surprised that `not_input_fees` would be zero in case of SFFO, but quite surprised that `tx_noinputs_size` would be 0, though. Just given the variable name, I would have expected it to simply be the size of the recipient outputs plus header data, regardless of who pays the fees. Would it perhaps be doable to fix the behavior in that direction, to reduce future developer surprise?",
      "commit_id" : "32a233773b4536aadecd00a52c897614dc9981b8",
      "created_at" : "2022-09-20T20:18:30Z",
      "diff_hunk" : "@@ -531,14 +533,27 @@ std::optional<SelectionResult> ChooseSelectionResult(const CWallet& wallet, cons\n         results.push_back(*srd_result);\n     }\n \n-    if (results.size() == 0) {\n+    if (results.empty()) {\n         // No solution found\n         return std::nullopt;\n     }\n \n+    std::vector<SelectionResult> eligible_results;\n+    std::copy_if(results.begin(), results.end(), std::back_inserter(eligible_results), [coin_selection_params](const SelectionResult& result) {\n+        const int weight = std::accumulate(result.GetInputSet().begin(), result.GetInputSet().end(), static_cast<int>(coin_selection_params.tx_noinputs_size * WITNESS_SCALE_FACTOR), [](int acc, const auto& coin) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r975778219",
      "id" : 975778219,
      "in_reply_to_id" : 974690021,
      "line" : 543,
      "node_id" : "PRRC_kwDOABII5846KTGr",
      "original_commit_id" : "c9c55455a942165ef0220a430a986c4655ece528",
      "original_line" : 543,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 24,
      "pull_request_review_id" : 1114424003,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/975778219/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-20T20:18:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/975778219",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r983304809"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983304809"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I applied your advice @achow101 here: https://github.com/bitcoin/bitcoin/compare/32a233773b4536aadecd00a52c897614dc9981b8..9421f362d5e0c6d4c7fe047a23ef7e0676f380b9.\r\nIs this right?\r\n\r\nAlso, maybe we could make `tx_noinputs_size` private and have a getter that returns 0 in case of SFFO?",
      "commit_id" : "9421f362d5e0c6d4c7fe047a23ef7e0676f380b9",
      "created_at" : "2022-09-29T09:32:03Z",
      "diff_hunk" : "@@ -531,14 +533,27 @@ std::optional<SelectionResult> ChooseSelectionResult(const CWallet& wallet, cons\n         results.push_back(*srd_result);\n     }\n \n-    if (results.size() == 0) {\n+    if (results.empty()) {\n         // No solution found\n         return std::nullopt;\n     }\n \n+    std::vector<SelectionResult> eligible_results;\n+    std::copy_if(results.begin(), results.end(), std::back_inserter(eligible_results), [coin_selection_params](const SelectionResult& result) {\n+        const int weight = std::accumulate(result.GetInputSet().begin(), result.GetInputSet().end(), static_cast<int>(coin_selection_params.tx_noinputs_size * WITNESS_SCALE_FACTOR), [](int acc, const auto& coin) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r983304809",
      "id" : 983304809,
      "in_reply_to_id" : 974690021,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5846nApp",
      "original_commit_id" : "c9c55455a942165ef0220a430a986c4655ece528",
      "original_line" : 543,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 1124960121,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983304809/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-29T09:32:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983304809",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-10-04T09:47:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1266686260",
      "id" : 1266686260,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585LgBk0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1266686260/reactions"
      },
      "updated_at" : "2022-10-04T09:47:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1266686260",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r989588845"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/989588845"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No, that's not what I meant.\r\n\r\nWhat you've done is no different from how it was before. My point was that you need to be using the non-inputs size always, not set it to 0 for SFFO. This size is typically tracked by `tx_noinputs_size`, but it gets set to 0 when SFFO. So you need to find everywhere else (generally in `CreateTransactionInternal`) that `tx_noinputs_size` is used, change it so that it is always calculated, and change the places that expected it to be 0 for SFFO to still use 0 (e.g. with a ternary).",
      "commit_id" : "8d8757c2635de9a7bdeef9220e094230f3e84ee5",
      "created_at" : "2022-10-07T01:03:58Z",
      "diff_hunk" : "@@ -531,14 +533,27 @@ std::optional<SelectionResult> ChooseSelectionResult(const CWallet& wallet, cons\n         results.push_back(*srd_result);\n     }\n \n-    if (results.size() == 0) {\n+    if (results.empty()) {\n         // No solution found\n         return std::nullopt;\n     }\n \n+    std::vector<SelectionResult> eligible_results;\n+    std::copy_if(results.begin(), results.end(), std::back_inserter(eligible_results), [coin_selection_params](const SelectionResult& result) {\n+        const int weight = std::accumulate(result.GetInputSet().begin(), result.GetInputSet().end(), static_cast<int>(coin_selection_params.tx_noinputs_size * WITNESS_SCALE_FACTOR), [](int acc, const auto& coin) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r989588845",
      "id" : 989588845,
      "in_reply_to_id" : 974690021,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5846--1t",
      "original_commit_id" : "c9c55455a942165ef0220a430a986c4655ece528",
      "original_line" : 543,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 1133781288,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/989588845/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-07T01:03:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/989588845",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r989824305"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/989824305"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah okay my bad. I pushed it, should be good?",
      "commit_id" : "fc5219f51813b6e9c128d6bc0cc70c63a5edce48",
      "created_at" : "2022-10-07T08:20:21Z",
      "diff_hunk" : "@@ -531,14 +533,27 @@ std::optional<SelectionResult> ChooseSelectionResult(const CWallet& wallet, cons\n         results.push_back(*srd_result);\n     }\n \n-    if (results.size() == 0) {\n+    if (results.empty()) {\n         // No solution found\n         return std::nullopt;\n     }\n \n+    std::vector<SelectionResult> eligible_results;\n+    std::copy_if(results.begin(), results.end(), std::back_inserter(eligible_results), [coin_selection_params](const SelectionResult& result) {\n+        const int weight = std::accumulate(result.GetInputSet().begin(), result.GetInputSet().end(), static_cast<int>(coin_selection_params.tx_noinputs_size * WITNESS_SCALE_FACTOR), [](int acc, const auto& coin) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r989824305",
      "id" : 989824305,
      "in_reply_to_id" : 974690021,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5846_4Ux",
      "original_commit_id" : "c9c55455a942165ef0220a430a986c4655ece528",
      "original_line" : 543,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 1134096222,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/989824305/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-07T08:20:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/989824305",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r1009765407"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1009765407"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In dbeddc1f7f43c6df293133cd2b12a7187c0e321e \"wallet: Check max tx weight in coin selector\"\r\n\r\nWe still need to calculate the weight correctly even when subtracting the fee from outputs, so this should not be checking that.\r\n\r\n```suggestion\r\n        const auto initWeight{coin_selection_params.tx_noinputs_size * WITNESS_SCALE_FACTOR};\r\n```",
      "commit_id" : "fc5219f51813b6e9c128d6bc0cc70c63a5edce48",
      "created_at" : "2022-10-31T19:03:51Z",
      "diff_hunk" : "@@ -511,14 +513,28 @@ std::optional<SelectionResult> ChooseSelectionResult(const CWallet& wallet, cons\n         results.push_back(*srd_result);\n     }\n \n-    if (results.size() == 0) {\n+    if (results.empty()) {\n         // No solution found\n         return std::nullopt;\n     }\n \n+    std::vector<SelectionResult> eligible_results;\n+    std::copy_if(results.begin(), results.end(), std::back_inserter(eligible_results), [coin_selection_params](const SelectionResult& result) {\n+        const auto initWeight{coin_selection_params.m_subtract_fee_outputs ? 0 : coin_selection_params.tx_noinputs_size * WITNESS_SCALE_FACTOR};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r1009765407",
      "id" : 1009765407,
      "line" : 523,
      "node_id" : "PRRC_kwDOABII5848L8wf",
      "original_commit_id" : "dbeddc1f7f43c6df293133cd2b12a7187c0e321e",
      "original_line" : 523,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 24,
      "pull_request_review_id" : 1162398609,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1009765407/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-31T19:21:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1009765407",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r1009772089"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1009772089"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In fc5219f51813b6e9c128d6bc0cc70c63a5edce48 \"test: Check max transaction weight in CoinSelection\"\r\n\r\nIt's not clear to my why we shouldn't expect the 50 Coin to be picked? ISTM Random selection should eventually find the 50 Coin single input solution and go with that.",
      "commit_id" : "fc5219f51813b6e9c128d6bc0cc70c63a5edce48",
      "created_at" : "2022-10-31T19:12:35Z",
      "diff_hunk" : "@@ -922,6 +922,169 @@ BOOST_AUTO_TEST_CASE(effective_value_test)\n     BOOST_CHECK_EQUAL(output5.GetEffectiveValue(), nValue); // The effective value should be equal to the absolute value if input_bytes is -1\n }\n \n+static std::optional<SelectionResult> select_coins(const CAmount& target, const CoinSelectionParams& cs_params, const CCoinControl& cc, std::function<CoinsResult(CWallet&)> coin_setup, interfaces::Chain* chain, const ArgsManager& args)\n+{\n+    std::unique_ptr<CWallet> wallet = std::make_unique<CWallet>(chain, \"\", args, CreateMockWalletDatabase());\n+    wallet->LoadWallet();\n+    LOCK(wallet->cs_wallet);\n+    wallet->SetWalletFlag(WALLET_FLAG_DESCRIPTORS);\n+    wallet->SetupDescriptorScriptPubKeyMans();\n+\n+    auto available_coins = coin_setup(*wallet);\n+\n+    const auto result = SelectCoins(*wallet, available_coins, target, cc, cs_params);\n+    if (result) {\n+        const auto signedTxSize = 10 + 34 + 68 * result->GetInputSet().size(); // static header size + output size + inputs size (P2WPKH)\n+        BOOST_CHECK_LE(signedTxSize * WITNESS_SCALE_FACTOR, MAX_STANDARD_TX_WEIGHT);\n+\n+        BOOST_CHECK_GE(result->GetSelectedValue(), target);\n+    }\n+    return result;\n+}\n+\n+BOOST_AUTO_TEST_CASE(check_max_weight)\n+{\n+    const CAmount target = 49.5L * COIN;\n+    CCoinControl cc;\n+\n+    FastRandomContext rand;\n+    CoinSelectionParams cs_params{\n+        rand,\n+        /*change_output_size=*/34,\n+        /*change_spend_size=*/68,\n+        /*min_change_target=*/CENT,\n+        /*effective_feerate=*/CFeeRate(0),\n+        /*long_term_feerate=*/CFeeRate(0),\n+        /*discard_feerate=*/CFeeRate(0),\n+        /*tx_noinputs_size=*/10 + 34, // static header size + output size\n+        /*avoid_partial=*/false,\n+    };\n+\n+    auto chain{m_node.chain.get()};\n+\n+    {\n+        // Scenario 1:\n+        // The actor starts with 1x 50.0 BTC and 1515x 0.033 BTC (~100.0 BTC total) unspent outputs\n+        // Then tries to spend 49.5 BTC\n+        // The 50.0 BTC output should be selected, because the transaction would otherwise be too large\n+\n+        // Perform selection\n+\n+        const auto result = select_coins(\n+            target, cs_params, cc, [&](CWallet& wallet) {\n+                CoinsResult available_coins;\n+                for (int j = 0; j < 1500; ++j) {\n+                    add_coin(available_coins, wallet, CAmount(0.033 * COIN), CFeeRate(0), 144, false, 0, true);\n+                }\n+\n+                add_coin(available_coins, wallet, CAmount(50 * COIN), CFeeRate(0), 144, false, 0, true);\n+                return available_coins;\n+            },\n+            chain, m_args);\n+\n+        BOOST_CHECK(result);\n+        const bool has_50_coin = std::any_of(result->GetInputSet().begin(), result->GetInputSet().end(), [](const auto& coin) {\n+            return coin.GetEffectiveValue() == 50 * COIN;\n+        });\n+        BOOST_CHECK(has_50_coin);\n+    }\n+\n+    {\n+        // Scenario 2:\n+\n+        // The actor starts with 400x 0.0625 BTC and 2000x 0.025 BTC (75.0 BTC total) unspent outputs\n+        // Then tries to spend 49.5 BTC\n+        // A combination of coins should be selected, such that the created transaction is not too large\n+\n+        // Perform selection\n+        const auto result = select_coins(\n+            target, cs_params, cc, [&](CWallet& wallet) {\n+                CoinsResult available_coins;\n+                for (int j = 0; j < 400; ++j) {\n+                    add_coin(available_coins, wallet, CAmount(0.0625 * COIN), CFeeRate(0), 144, false, 0, true);\n+                }\n+                for (int j = 0; j < 2000; ++j) {\n+                    add_coin(available_coins, wallet, CAmount(0.025 * COIN), CFeeRate(0), 144, false, 0, true);\n+                }\n+                return available_coins;\n+            },\n+            chain, m_args);\n+\n+        const bool has_0_0625_coin = std::any_of(result->GetInputSet().begin(), result->GetInputSet().end(), [](const auto& coin) {\n+            return coin.GetEffectiveValue() == 0.0625 * COIN;\n+        });\n+        const bool has_0_025_coin = std::any_of(result->GetInputSet().begin(), result->GetInputSet().end(), [](const auto& coin) {\n+            return coin.GetEffectiveValue() == 0.025 * COIN;\n+        });\n+        const bool has_not_50_coin = std::any_of(result->GetInputSet().begin(), result->GetInputSet().end(), [](const auto& coin) {\n+            return coin.GetEffectiveValue() != 50 * COIN;\n+        });\n+        BOOST_CHECK(has_0_0625_coin);\n+        BOOST_CHECK(has_0_025_coin);\n+        BOOST_CHECK(has_not_50_coin);\n+    }\n+\n+    {\n+        // Scenario 3 (available as RPC test):\n+\n+        // The actor starts with 1x 50.0 BTC, 400x 0.0625 BTC and 2000x 0.025 BTC (125.0 BTC total) unspent outputs\n+        // Then tries to spend 49.5 BTC\n+        // A combination of coins should be selected, such that the created transaction is not too large\n+\n+        // Perform selection\n+        const auto result = select_coins(\n+            target, cs_params, cc, [&](CWallet& wallet) {\n+                CoinsResult available_coins;\n+                for (int j = 0; j < 400; ++j) {\n+                    add_coin(available_coins, wallet, CAmount(0.0625 * COIN), CFeeRate(0), 144, false, 0, true);\n+                }\n+                for (int j = 0; j < 2000; ++j) {\n+                    add_coin(available_coins, wallet, CAmount(0.025 * COIN), CFeeRate(0), 144, false, 0, true);\n+                }\n+                add_coin(available_coins, wallet, CAmount(50 * COIN), CFeeRate(0), 144, false, 0, true);\n+                return available_coins;\n+            },\n+            chain, m_args);\n+\n+        // Perform selection\n+        const bool has_0_025_coin = std::any_of(result->GetInputSet().begin(), result->GetInputSet().end(), [](const auto& coin) {\n+            return coin.GetEffectiveValue() == 0.025 * COIN;\n+        });\n+        const bool has_0_0625_coin = std::any_of(result->GetInputSet().begin(), result->GetInputSet().end(), [](const auto& coin) {\n+            return coin.GetEffectiveValue() == 0.0625 * COIN;\n+        });\n+        const bool has_not_50_coin = std::any_of(result->GetInputSet().begin(), result->GetInputSet().end(), [](const auto& coin) {\n+            return coin.GetEffectiveValue() != 50 * COIN;\n+        });",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r1009772089",
      "id" : 1009772089,
      "line" : 1058,
      "node_id" : "PRRC_kwDOABII5848L-Y5",
      "original_commit_id" : "fc5219f51813b6e9c128d6bc0cc70c63a5edce48",
      "original_line" : 1058,
      "original_position" : 137,
      "original_start_line" : 1056,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : 137,
      "pull_request_review_id" : 1162398609,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1009772089/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1056,
      "start_side" : "RIGHT",
      "updated_at" : "2022-10-31T19:21:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1009772089",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r1009779128"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1009779128"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In fc5219f51813b6e9c128d6bc0cc70c63a5edce48 \"test: Check max transaction weight in CoinSelection\"\r\n\r\nThe comment says 1515, but this is only 1500? It seems like 1500 works anyways.",
      "commit_id" : "fc5219f51813b6e9c128d6bc0cc70c63a5edce48",
      "created_at" : "2022-10-31T19:20:59Z",
      "diff_hunk" : "@@ -922,6 +922,169 @@ BOOST_AUTO_TEST_CASE(effective_value_test)\n     BOOST_CHECK_EQUAL(output5.GetEffectiveValue(), nValue); // The effective value should be equal to the absolute value if input_bytes is -1\n }\n \n+static std::optional<SelectionResult> select_coins(const CAmount& target, const CoinSelectionParams& cs_params, const CCoinControl& cc, std::function<CoinsResult(CWallet&)> coin_setup, interfaces::Chain* chain, const ArgsManager& args)\n+{\n+    std::unique_ptr<CWallet> wallet = std::make_unique<CWallet>(chain, \"\", args, CreateMockWalletDatabase());\n+    wallet->LoadWallet();\n+    LOCK(wallet->cs_wallet);\n+    wallet->SetWalletFlag(WALLET_FLAG_DESCRIPTORS);\n+    wallet->SetupDescriptorScriptPubKeyMans();\n+\n+    auto available_coins = coin_setup(*wallet);\n+\n+    const auto result = SelectCoins(*wallet, available_coins, target, cc, cs_params);\n+    if (result) {\n+        const auto signedTxSize = 10 + 34 + 68 * result->GetInputSet().size(); // static header size + output size + inputs size (P2WPKH)\n+        BOOST_CHECK_LE(signedTxSize * WITNESS_SCALE_FACTOR, MAX_STANDARD_TX_WEIGHT);\n+\n+        BOOST_CHECK_GE(result->GetSelectedValue(), target);\n+    }\n+    return result;\n+}\n+\n+BOOST_AUTO_TEST_CASE(check_max_weight)\n+{\n+    const CAmount target = 49.5L * COIN;\n+    CCoinControl cc;\n+\n+    FastRandomContext rand;\n+    CoinSelectionParams cs_params{\n+        rand,\n+        /*change_output_size=*/34,\n+        /*change_spend_size=*/68,\n+        /*min_change_target=*/CENT,\n+        /*effective_feerate=*/CFeeRate(0),\n+        /*long_term_feerate=*/CFeeRate(0),\n+        /*discard_feerate=*/CFeeRate(0),\n+        /*tx_noinputs_size=*/10 + 34, // static header size + output size\n+        /*avoid_partial=*/false,\n+    };\n+\n+    auto chain{m_node.chain.get()};\n+\n+    {\n+        // Scenario 1:\n+        // The actor starts with 1x 50.0 BTC and 1515x 0.033 BTC (~100.0 BTC total) unspent outputs\n+        // Then tries to spend 49.5 BTC\n+        // The 50.0 BTC output should be selected, because the transaction would otherwise be too large\n+\n+        // Perform selection\n+\n+        const auto result = select_coins(\n+            target, cs_params, cc, [&](CWallet& wallet) {\n+                CoinsResult available_coins;\n+                for (int j = 0; j < 1500; ++j) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r1009779128",
      "id" : 1009779128,
      "line" : 976,
      "node_id" : "PRRC_kwDOABII5848MAG4",
      "original_commit_id" : "fc5219f51813b6e9c128d6bc0cc70c63a5edce48",
      "original_line" : 976,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : 55,
      "pull_request_review_id" : 1162398609,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1009779128/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-31T19:21:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1009779128",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r1010370693"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1010370693"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Right, I removed the check. The two other coins should always be present though.",
      "commit_id" : "65d0401f8d93960f2d40df1880afdecc08ae1633",
      "created_at" : "2022-11-01T12:28:09Z",
      "diff_hunk" : "@@ -922,6 +922,169 @@ BOOST_AUTO_TEST_CASE(effective_value_test)\n     BOOST_CHECK_EQUAL(output5.GetEffectiveValue(), nValue); // The effective value should be equal to the absolute value if input_bytes is -1\n }\n \n+static std::optional<SelectionResult> select_coins(const CAmount& target, const CoinSelectionParams& cs_params, const CCoinControl& cc, std::function<CoinsResult(CWallet&)> coin_setup, interfaces::Chain* chain, const ArgsManager& args)\n+{\n+    std::unique_ptr<CWallet> wallet = std::make_unique<CWallet>(chain, \"\", args, CreateMockWalletDatabase());\n+    wallet->LoadWallet();\n+    LOCK(wallet->cs_wallet);\n+    wallet->SetWalletFlag(WALLET_FLAG_DESCRIPTORS);\n+    wallet->SetupDescriptorScriptPubKeyMans();\n+\n+    auto available_coins = coin_setup(*wallet);\n+\n+    const auto result = SelectCoins(*wallet, available_coins, target, cc, cs_params);\n+    if (result) {\n+        const auto signedTxSize = 10 + 34 + 68 * result->GetInputSet().size(); // static header size + output size + inputs size (P2WPKH)\n+        BOOST_CHECK_LE(signedTxSize * WITNESS_SCALE_FACTOR, MAX_STANDARD_TX_WEIGHT);\n+\n+        BOOST_CHECK_GE(result->GetSelectedValue(), target);\n+    }\n+    return result;\n+}\n+\n+BOOST_AUTO_TEST_CASE(check_max_weight)\n+{\n+    const CAmount target = 49.5L * COIN;\n+    CCoinControl cc;\n+\n+    FastRandomContext rand;\n+    CoinSelectionParams cs_params{\n+        rand,\n+        /*change_output_size=*/34,\n+        /*change_spend_size=*/68,\n+        /*min_change_target=*/CENT,\n+        /*effective_feerate=*/CFeeRate(0),\n+        /*long_term_feerate=*/CFeeRate(0),\n+        /*discard_feerate=*/CFeeRate(0),\n+        /*tx_noinputs_size=*/10 + 34, // static header size + output size\n+        /*avoid_partial=*/false,\n+    };\n+\n+    auto chain{m_node.chain.get()};\n+\n+    {\n+        // Scenario 1:\n+        // The actor starts with 1x 50.0 BTC and 1515x 0.033 BTC (~100.0 BTC total) unspent outputs\n+        // Then tries to spend 49.5 BTC\n+        // The 50.0 BTC output should be selected, because the transaction would otherwise be too large\n+\n+        // Perform selection\n+\n+        const auto result = select_coins(\n+            target, cs_params, cc, [&](CWallet& wallet) {\n+                CoinsResult available_coins;\n+                for (int j = 0; j < 1500; ++j) {\n+                    add_coin(available_coins, wallet, CAmount(0.033 * COIN), CFeeRate(0), 144, false, 0, true);\n+                }\n+\n+                add_coin(available_coins, wallet, CAmount(50 * COIN), CFeeRate(0), 144, false, 0, true);\n+                return available_coins;\n+            },\n+            chain, m_args);\n+\n+        BOOST_CHECK(result);\n+        const bool has_50_coin = std::any_of(result->GetInputSet().begin(), result->GetInputSet().end(), [](const auto& coin) {\n+            return coin.GetEffectiveValue() == 50 * COIN;\n+        });\n+        BOOST_CHECK(has_50_coin);\n+    }\n+\n+    {\n+        // Scenario 2:\n+\n+        // The actor starts with 400x 0.0625 BTC and 2000x 0.025 BTC (75.0 BTC total) unspent outputs\n+        // Then tries to spend 49.5 BTC\n+        // A combination of coins should be selected, such that the created transaction is not too large\n+\n+        // Perform selection\n+        const auto result = select_coins(\n+            target, cs_params, cc, [&](CWallet& wallet) {\n+                CoinsResult available_coins;\n+                for (int j = 0; j < 400; ++j) {\n+                    add_coin(available_coins, wallet, CAmount(0.0625 * COIN), CFeeRate(0), 144, false, 0, true);\n+                }\n+                for (int j = 0; j < 2000; ++j) {\n+                    add_coin(available_coins, wallet, CAmount(0.025 * COIN), CFeeRate(0), 144, false, 0, true);\n+                }\n+                return available_coins;\n+            },\n+            chain, m_args);\n+\n+        const bool has_0_0625_coin = std::any_of(result->GetInputSet().begin(), result->GetInputSet().end(), [](const auto& coin) {\n+            return coin.GetEffectiveValue() == 0.0625 * COIN;\n+        });\n+        const bool has_0_025_coin = std::any_of(result->GetInputSet().begin(), result->GetInputSet().end(), [](const auto& coin) {\n+            return coin.GetEffectiveValue() == 0.025 * COIN;\n+        });\n+        const bool has_not_50_coin = std::any_of(result->GetInputSet().begin(), result->GetInputSet().end(), [](const auto& coin) {\n+            return coin.GetEffectiveValue() != 50 * COIN;\n+        });\n+        BOOST_CHECK(has_0_0625_coin);\n+        BOOST_CHECK(has_0_025_coin);\n+        BOOST_CHECK(has_not_50_coin);\n+    }\n+\n+    {\n+        // Scenario 3 (available as RPC test):\n+\n+        // The actor starts with 1x 50.0 BTC, 400x 0.0625 BTC and 2000x 0.025 BTC (125.0 BTC total) unspent outputs\n+        // Then tries to spend 49.5 BTC\n+        // A combination of coins should be selected, such that the created transaction is not too large\n+\n+        // Perform selection\n+        const auto result = select_coins(\n+            target, cs_params, cc, [&](CWallet& wallet) {\n+                CoinsResult available_coins;\n+                for (int j = 0; j < 400; ++j) {\n+                    add_coin(available_coins, wallet, CAmount(0.0625 * COIN), CFeeRate(0), 144, false, 0, true);\n+                }\n+                for (int j = 0; j < 2000; ++j) {\n+                    add_coin(available_coins, wallet, CAmount(0.025 * COIN), CFeeRate(0), 144, false, 0, true);\n+                }\n+                add_coin(available_coins, wallet, CAmount(50 * COIN), CFeeRate(0), 144, false, 0, true);\n+                return available_coins;\n+            },\n+            chain, m_args);\n+\n+        // Perform selection\n+        const bool has_0_025_coin = std::any_of(result->GetInputSet().begin(), result->GetInputSet().end(), [](const auto& coin) {\n+            return coin.GetEffectiveValue() == 0.025 * COIN;\n+        });\n+        const bool has_0_0625_coin = std::any_of(result->GetInputSet().begin(), result->GetInputSet().end(), [](const auto& coin) {\n+            return coin.GetEffectiveValue() == 0.0625 * COIN;\n+        });\n+        const bool has_not_50_coin = std::any_of(result->GetInputSet().begin(), result->GetInputSet().end(), [](const auto& coin) {\n+            return coin.GetEffectiveValue() != 50 * COIN;\n+        });",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r1010370693",
      "id" : 1010370693,
      "in_reply_to_id" : 1009772089,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848OQiF",
      "original_commit_id" : "fc5219f51813b6e9c128d6bc0cc70c63a5edce48",
      "original_line" : 1058,
      "original_position" : 137,
      "original_start_line" : 1056,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1163252317,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1010370693/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-11-01T12:28:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1010370693",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks @achow101 I addressed your comments and added you as co-author.",
      "created_at" : "2022-11-01T12:30:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1298441120",
      "id" : 1298441120,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585NZKOg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1298441120/reactions"
      },
      "updated_at" : "2022-11-01T12:30:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1298441120",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased and solved silent merge conflicts.",
      "created_at" : "2022-11-01T13:36:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1298520112",
      "id" : 1298520112,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585NZdgw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1298520112/reactions"
      },
      "updated_at" : "2022-11-01T13:57:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1298520112",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r1010816801"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1010816801"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 54ecb044c0ebf40ec06bd192725d6f49dcff90ff \"test: Check max transaction weight in CoinSelection\"\r\n\r\nIt's not clear to me how this scenario is materially different from scenario 2. It just adds the 50 Coin UTXO and I'm not sure what that actually adds to the test?\r\n\r\nAdditionally, this will fail 1 in 2401 runs as the 50 Coin could be chosen as a single input solution. This would then fail the checks.",
      "commit_id" : "54ecb044c0ebf40ec06bd192725d6f49dcff90ff",
      "created_at" : "2022-11-01T19:23:31Z",
      "diff_hunk" : "@@ -930,6 +931,157 @@ BOOST_AUTO_TEST_CASE(effective_value_test)\n     BOOST_CHECK_EQUAL(output5.GetEffectiveValue(), nValue); // The effective value should be equal to the absolute value if input_bytes is -1\n }\n \n+static std::optional<SelectionResult> select_coins(const CAmount& target, const CoinSelectionParams& cs_params, const CCoinControl& cc, std::function<CoinsResult(CWallet&)> coin_setup, interfaces::Chain* chain, const ArgsManager& args)\n+{\n+    std::unique_ptr<CWallet> wallet = std::make_unique<CWallet>(chain, \"\", args, CreateMockWalletDatabase());\n+    wallet->LoadWallet();\n+    LOCK(wallet->cs_wallet);\n+    wallet->SetWalletFlag(WALLET_FLAG_DESCRIPTORS);\n+    wallet->SetupDescriptorScriptPubKeyMans();\n+\n+    auto available_coins = coin_setup(*wallet);\n+\n+    const auto result = SelectCoins(*wallet, available_coins, /*pre_set_inputs=*/ {}, target, cc, cs_params);\n+    if (result) {\n+        const auto signedTxSize = 10 + 34 + 68 * result->GetInputSet().size(); // static header size + output size + inputs size (P2WPKH)\n+        BOOST_CHECK_LE(signedTxSize * WITNESS_SCALE_FACTOR, MAX_STANDARD_TX_WEIGHT);\n+\n+        BOOST_CHECK_GE(result->GetSelectedValue(), target);\n+    }\n+    return result;\n+}\n+\n+static bool has_coin(const CoinSet& set, CAmount amount)\n+{\n+    return std::any_of(set.begin(), set.end(), [&](const auto& coin) { return coin.GetEffectiveValue() == amount; });\n+}\n+\n+\n+static bool has_not_coin(const CoinSet& set, CAmount amount)\n+{\n+    return std::none_of(set.begin(), set.end(), [&](const auto& coin) { return coin.GetEffectiveValue() == amount; });\n+}\n+\n+BOOST_AUTO_TEST_CASE(check_max_weight)\n+{\n+    const CAmount target = 49.5L * COIN;\n+    CCoinControl cc;\n+\n+    FastRandomContext rand;\n+    CoinSelectionParams cs_params{\n+        rand,\n+        /*change_output_size=*/34,\n+        /*change_spend_size=*/68,\n+        /*min_change_target=*/CENT,\n+        /*effective_feerate=*/CFeeRate(0),\n+        /*long_term_feerate=*/CFeeRate(0),\n+        /*discard_feerate=*/CFeeRate(0),\n+        /*tx_noinputs_size=*/10 + 34, // static header size + output size\n+        /*avoid_partial=*/false,\n+    };\n+\n+    auto chain{m_node.chain.get()};\n+\n+    {\n+        // Scenario 1:\n+        // The actor starts with 1x 50.0 BTC and 1515x 0.033 BTC (~100.0 BTC total) unspent outputs\n+        // Then tries to spend 49.5 BTC\n+        // The 50.0 BTC output should be selected, because the transaction would otherwise be too large\n+\n+        // Perform selection\n+\n+        const auto result = select_coins(\n+            target, cs_params, cc, [&](CWallet& wallet) {\n+                CoinsResult available_coins;\n+                for (int j = 0; j < 1515; ++j) {\n+                    add_coin(available_coins, wallet, CAmount(0.033 * COIN), CFeeRate(0), 144, false, 0, true);\n+                }\n+\n+                add_coin(available_coins, wallet, CAmount(50 * COIN), CFeeRate(0), 144, false, 0, true);\n+                return available_coins;\n+            },\n+            chain, m_args);\n+\n+        BOOST_CHECK(result);\n+        BOOST_CHECK(has_coin(result->GetInputSet(), CAmount(50 * COIN)));\n+    }\n+\n+    {\n+        // Scenario 2:\n+\n+        // The actor starts with 400x 0.0625 BTC and 2000x 0.025 BTC (75.0 BTC total) unspent outputs\n+        // Then tries to spend 49.5 BTC\n+        // A combination of coins should be selected, such that the created transaction is not too large\n+\n+        // Perform selection\n+        const auto result = select_coins(\n+            target, cs_params, cc, [&](CWallet& wallet) {\n+                CoinsResult available_coins;\n+                for (int j = 0; j < 400; ++j) {\n+                    add_coin(available_coins, wallet, CAmount(0.0625 * COIN), CFeeRate(0), 144, false, 0, true);\n+                }\n+                for (int j = 0; j < 2000; ++j) {\n+                    add_coin(available_coins, wallet, CAmount(0.025 * COIN), CFeeRate(0), 144, false, 0, true);\n+                }\n+                return available_coins;\n+            },\n+            chain, m_args);\n+\n+        BOOST_CHECK(has_coin(result->GetInputSet(), CAmount(0.0625 * COIN)));\n+        BOOST_CHECK(has_coin(result->GetInputSet(), CAmount(0.025 * COIN)));\n+        BOOST_CHECK(has_not_coin(result->GetInputSet(), CAmount(50 * COIN)));\n+    }\n+\n+    {\n+        // Scenario 3 (available as RPC test):\n+\n+        // The actor starts with 1x 50.0 BTC, 400x 0.0625 BTC and 2000x 0.025 BTC (125.0 BTC total) unspent outputs\n+        // Then tries to spend 49.5 BTC\n+        // A combination of coins should be selected, such that the created transaction is not too large\n+\n+        // Perform selection\n+        const auto result = select_coins(\n+            target, cs_params, cc, [&](CWallet& wallet) {\n+                CoinsResult available_coins;\n+                for (int j = 0; j < 400; ++j) {\n+                    add_coin(available_coins, wallet, CAmount(0.0625 * COIN), CFeeRate(0), 144, false, 0, true);\n+                }\n+                for (int j = 0; j < 2000; ++j) {\n+                    add_coin(available_coins, wallet, CAmount(0.025 * COIN), CFeeRate(0), 144, false, 0, true);\n+                }\n+                add_coin(available_coins, wallet, CAmount(50 * COIN), CFeeRate(0), 144, false, 0, true);\n+                return available_coins;\n+            },\n+            chain, m_args);\n+\n+        BOOST_CHECK(has_coin(result->GetInputSet(), CAmount(0.025 * COIN)));\n+        BOOST_CHECK(has_coin(result->GetInputSet(), CAmount(0.0625 * COIN)));\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r1010816801",
      "id" : 1010816801,
      "line" : 1059,
      "node_id" : "PRRC_kwDOABII5848P9ch",
      "original_commit_id" : "54ecb044c0ebf40ec06bd192725d6f49dcff90ff",
      "original_line" : 1059,
      "original_position" : 137,
      "original_start_line" : 1036,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : 137,
      "pull_request_review_id" : 1163923073,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1010816801/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1036,
      "start_side" : "RIGHT",
      "updated_at" : "2022-11-01T19:23:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1010816801",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r1011541069"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011541069"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, I removed it.",
      "commit_id" : "ffd744f9a0391beda6bb98de1d4e851fc6ca7ca4",
      "created_at" : "2022-11-02T10:39:43Z",
      "diff_hunk" : "@@ -930,6 +931,157 @@ BOOST_AUTO_TEST_CASE(effective_value_test)\n     BOOST_CHECK_EQUAL(output5.GetEffectiveValue(), nValue); // The effective value should be equal to the absolute value if input_bytes is -1\n }\n \n+static std::optional<SelectionResult> select_coins(const CAmount& target, const CoinSelectionParams& cs_params, const CCoinControl& cc, std::function<CoinsResult(CWallet&)> coin_setup, interfaces::Chain* chain, const ArgsManager& args)\n+{\n+    std::unique_ptr<CWallet> wallet = std::make_unique<CWallet>(chain, \"\", args, CreateMockWalletDatabase());\n+    wallet->LoadWallet();\n+    LOCK(wallet->cs_wallet);\n+    wallet->SetWalletFlag(WALLET_FLAG_DESCRIPTORS);\n+    wallet->SetupDescriptorScriptPubKeyMans();\n+\n+    auto available_coins = coin_setup(*wallet);\n+\n+    const auto result = SelectCoins(*wallet, available_coins, /*pre_set_inputs=*/ {}, target, cc, cs_params);\n+    if (result) {\n+        const auto signedTxSize = 10 + 34 + 68 * result->GetInputSet().size(); // static header size + output size + inputs size (P2WPKH)\n+        BOOST_CHECK_LE(signedTxSize * WITNESS_SCALE_FACTOR, MAX_STANDARD_TX_WEIGHT);\n+\n+        BOOST_CHECK_GE(result->GetSelectedValue(), target);\n+    }\n+    return result;\n+}\n+\n+static bool has_coin(const CoinSet& set, CAmount amount)\n+{\n+    return std::any_of(set.begin(), set.end(), [&](const auto& coin) { return coin.GetEffectiveValue() == amount; });\n+}\n+\n+\n+static bool has_not_coin(const CoinSet& set, CAmount amount)\n+{\n+    return std::none_of(set.begin(), set.end(), [&](const auto& coin) { return coin.GetEffectiveValue() == amount; });\n+}\n+\n+BOOST_AUTO_TEST_CASE(check_max_weight)\n+{\n+    const CAmount target = 49.5L * COIN;\n+    CCoinControl cc;\n+\n+    FastRandomContext rand;\n+    CoinSelectionParams cs_params{\n+        rand,\n+        /*change_output_size=*/34,\n+        /*change_spend_size=*/68,\n+        /*min_change_target=*/CENT,\n+        /*effective_feerate=*/CFeeRate(0),\n+        /*long_term_feerate=*/CFeeRate(0),\n+        /*discard_feerate=*/CFeeRate(0),\n+        /*tx_noinputs_size=*/10 + 34, // static header size + output size\n+        /*avoid_partial=*/false,\n+    };\n+\n+    auto chain{m_node.chain.get()};\n+\n+    {\n+        // Scenario 1:\n+        // The actor starts with 1x 50.0 BTC and 1515x 0.033 BTC (~100.0 BTC total) unspent outputs\n+        // Then tries to spend 49.5 BTC\n+        // The 50.0 BTC output should be selected, because the transaction would otherwise be too large\n+\n+        // Perform selection\n+\n+        const auto result = select_coins(\n+            target, cs_params, cc, [&](CWallet& wallet) {\n+                CoinsResult available_coins;\n+                for (int j = 0; j < 1515; ++j) {\n+                    add_coin(available_coins, wallet, CAmount(0.033 * COIN), CFeeRate(0), 144, false, 0, true);\n+                }\n+\n+                add_coin(available_coins, wallet, CAmount(50 * COIN), CFeeRate(0), 144, false, 0, true);\n+                return available_coins;\n+            },\n+            chain, m_args);\n+\n+        BOOST_CHECK(result);\n+        BOOST_CHECK(has_coin(result->GetInputSet(), CAmount(50 * COIN)));\n+    }\n+\n+    {\n+        // Scenario 2:\n+\n+        // The actor starts with 400x 0.0625 BTC and 2000x 0.025 BTC (75.0 BTC total) unspent outputs\n+        // Then tries to spend 49.5 BTC\n+        // A combination of coins should be selected, such that the created transaction is not too large\n+\n+        // Perform selection\n+        const auto result = select_coins(\n+            target, cs_params, cc, [&](CWallet& wallet) {\n+                CoinsResult available_coins;\n+                for (int j = 0; j < 400; ++j) {\n+                    add_coin(available_coins, wallet, CAmount(0.0625 * COIN), CFeeRate(0), 144, false, 0, true);\n+                }\n+                for (int j = 0; j < 2000; ++j) {\n+                    add_coin(available_coins, wallet, CAmount(0.025 * COIN), CFeeRate(0), 144, false, 0, true);\n+                }\n+                return available_coins;\n+            },\n+            chain, m_args);\n+\n+        BOOST_CHECK(has_coin(result->GetInputSet(), CAmount(0.0625 * COIN)));\n+        BOOST_CHECK(has_coin(result->GetInputSet(), CAmount(0.025 * COIN)));\n+        BOOST_CHECK(has_not_coin(result->GetInputSet(), CAmount(50 * COIN)));\n+    }\n+\n+    {\n+        // Scenario 3 (available as RPC test):\n+\n+        // The actor starts with 1x 50.0 BTC, 400x 0.0625 BTC and 2000x 0.025 BTC (125.0 BTC total) unspent outputs\n+        // Then tries to spend 49.5 BTC\n+        // A combination of coins should be selected, such that the created transaction is not too large\n+\n+        // Perform selection\n+        const auto result = select_coins(\n+            target, cs_params, cc, [&](CWallet& wallet) {\n+                CoinsResult available_coins;\n+                for (int j = 0; j < 400; ++j) {\n+                    add_coin(available_coins, wallet, CAmount(0.0625 * COIN), CFeeRate(0), 144, false, 0, true);\n+                }\n+                for (int j = 0; j < 2000; ++j) {\n+                    add_coin(available_coins, wallet, CAmount(0.025 * COIN), CFeeRate(0), 144, false, 0, true);\n+                }\n+                add_coin(available_coins, wallet, CAmount(50 * COIN), CFeeRate(0), 144, false, 0, true);\n+                return available_coins;\n+            },\n+            chain, m_args);\n+\n+        BOOST_CHECK(has_coin(result->GetInputSet(), CAmount(0.025 * COIN)));\n+        BOOST_CHECK(has_coin(result->GetInputSet(), CAmount(0.0625 * COIN)));\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r1011541069",
      "id" : 1011541069,
      "in_reply_to_id" : 1010816801,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848SuRN",
      "original_commit_id" : "54ecb044c0ebf40ec06bd192725d6f49dcff90ff",
      "original_line" : 1026,
      "original_position" : 137,
      "original_start_line" : 1036,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1164965997,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011541069/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-11-02T10:39:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011541069",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Removed scenario 3 and removed unnecessary check in scenario 2 (https://github.com/bitcoin/bitcoin/compare/54ecb044c0ebf40ec06bd192725d6f49dcff90ff..ffd744f9a0391beda6bb98de1d4e851fc6ca7ca4)",
      "created_at" : "2022-11-02T10:39:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1300016347",
      "id" : 1300016347,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585NfKzb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1300016347/reactions"
      },
      "updated_at" : "2022-11-02T10:39:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1300016347",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "~~Rebased to fix CI `p2p_sendtxrcncl.py` failure.~~ didn't seem to work :neutral_face: ",
      "created_at" : "2022-11-03T20:52:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1302650406",
      "id" : 1302650406,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585NpN4m",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1302650406/reactions"
      },
      "updated_at" : "2022-11-05T17:25:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1302650406",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK b763b072cec235d397fae4dafc6a69f5902eb3f6",
      "created_at" : "2022-11-09T19:23:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1309249448",
      "id" : 1309249448,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585OCY-o",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1309249448/reactions"
      },
      "updated_at" : "2022-11-09T19:23:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1309249448",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r1025436595"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1025436595"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Instead of doing this entire for-loop accumulation, what about adding a field `m_weight_sum` to `OutputGroup`?\r\n\r\nInitializing it to `coin_selection_params.tx_noinputs_size * WITNESS_SCALE_FACTOR` in the constructor and increasing it at every output insertion (inside `OutputGroup::Insert`).\r\n\r\nSo, when `SelectionResult::AddInput` gets called, you already have the total weight for each output group. And can just sum it up inside another cache field there.",
      "commit_id" : "b763b072cec235d397fae4dafc6a69f5902eb3f6",
      "created_at" : "2022-11-17T16:42:28Z",
      "diff_hunk" : "@@ -557,14 +559,28 @@ std::optional<SelectionResult> ChooseSelectionResult(const CWallet& wallet, cons\n         results.push_back(*srd_result);\n     }\n \n-    if (results.size() == 0) {\n+    if (results.empty()) {\n         // No solution found\n         return std::nullopt;\n     }\n \n+    std::vector<SelectionResult> eligible_results;\n+    std::copy_if(results.begin(), results.end(), std::back_inserter(eligible_results), [coin_selection_params](const SelectionResult& result) {\n+        const auto initWeight{coin_selection_params.tx_noinputs_size * WITNESS_SCALE_FACTOR};\n+        const int weight = std::accumulate(result.GetInputSet().begin(), result.GetInputSet().end(), static_cast<int>(initWeight), [](int acc, const auto& coin) {\n+            return acc + coin.input_bytes * WITNESS_SCALE_FACTOR;\n+        });",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r1025436595",
      "id" : 1025436595,
      "line" : 572,
      "node_id" : "PRRC_kwDOABII5849Huuz",
      "original_commit_id" : "dc9bce1866f1cce851a216d2c7bfd7a890c27006",
      "original_line" : 572,
      "original_position" : 27,
      "original_start_line" : 569,
      "path" : "src/wallet/spend.cpp",
      "position" : 27,
      "pull_request_review_id" : 1184675586,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1025436595/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 569,
      "start_side" : "RIGHT",
      "updated_at" : "2022-11-17T16:46:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1025436595",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks @furszy, I've implemented your suggestion: https://github.com/bitcoin/bitcoin/compare/b763b072cec235d397fae4dafc6a69f5902eb3f6..119fea975463b05d9a2dddbb36db17b2c91ef880.\r\n\r\nIt appears to be slightly faster:\r\n\r\n### Before (dc9bce1866f1cce851a216d2c7bfd7a890c27006)\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|        1,614,196.00 |              619.50 |    0.6% |   11,151,218.00 |    3,710,976.00 |  3.005 |   1,995,456.00 |    0.3% |      0.02 | `CoinSelection`\r\n\r\n### Current (98efb22650c803c3bd4c094d58ef7ba16b77fee2)\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|        1,466,341.00 |              681.97 |    0.6% |   11,176,762.00 |    3,358,752.00 |  3.328 |   1,897,839.00 |    0.3% |      0.02 | `CoinSelection`\r\n\r\nI've updated the PR description's benchmarks.\r\n\r\nI also realized that in the previous commit the weight could go in the negatives because `coin.input_bytes` is equal to `-1` for external inputs and I simply summed this number, I fixed it.",
      "created_at" : "2022-11-17T19:54:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1319128835",
      "id" : 1319128835,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585OoE8D",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1319128835/reactions"
      },
      "updated_at" : "2022-11-17T20:02:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1319128835",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I also realized that in the previous commit the weight could go in the negatives because coin.input_bytes is equal to -1 for external inputs and I simply summed this number, I fixed it.\r\n\r\nHmm, that shouldn't be happening. We do have a check inside the preset inputs fetching function that throws an error if `input_bytes == -1`. Maybe what your wallet is trying to spend is a not solvable coin owned by the wallet.",
      "created_at" : "2022-11-18T12:42:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1319946720",
      "id" : 1319946720,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585OrMng",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1319946720/reactions"
      },
      "updated_at" : "2022-11-18T12:42:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1319946720",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Sorry @furszy I meant that the weight could be negative in other tests, which probably used external coins. My test was not affected.",
      "created_at" : "2022-11-18T14:05:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1320037373",
      "id" : 1320037373,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585Oriv9",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1320037373/reactions"
      },
      "updated_at" : "2022-11-18T14:05:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1320037373",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 3474b5f7684cacd0c098a11c95079e29f5e905b4",
      "created_at" : "2022-11-18T16:27:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1320249915",
      "id" : 1320249915,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585OsWo7",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1320249915/reactions"
      },
      "updated_at" : "2022-11-18T16:27:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1320249915",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks @achow101. @furszy suggested to me in private that the WITNESS_SCALE_FACTOR may not be correctly applied tough. I drafted a quick diff here: \r\nhttps://gist.github.com/aureleoules/8a7cfcd93a66b70eecc74e7a6692d300\r\n\r\nWould you agree?",
      "created_at" : "2022-11-18T16:33:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1320256469",
      "id" : 1320256469,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585OsYPV",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1320256469/reactions"
      },
      "updated_at" : "2022-11-18T16:33:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1320256469",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "No, it is correct as it is now. Converting vbytes to weight is always just multiply by WITNESS_SCALE_FACTOR. It doesn't matter what the script type is.",
      "created_at" : "2022-11-18T17:11:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1320299997",
      "id" : 1320299997,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585Osi3d",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1320299997/reactions"
      },
      "updated_at" : "2022-11-18T17:11:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1320299997",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Okay great thank you!",
      "created_at" : "2022-11-18T17:14:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1320303731",
      "id" : 1320303731,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585Osjxz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1320303731/reactions"
      },
      "updated_at" : "2022-11-18T17:14:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1320303731",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r1027150572"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1027150572"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should be `std::max(coin.input_bytes, 0)`.\r\n\r\nOtherwise, this entire sum will be 0 most of the time (it's taking the smaller value between `input_bytes` and 0).",
      "commit_id" : "3474b5f7684cacd0c098a11c95079e29f5e905b4",
      "created_at" : "2022-11-19T22:11:47Z",
      "diff_hunk" : "@@ -436,18 +441,25 @@ void SelectionResult::Clear()\n {\n     m_selected_inputs.clear();\n     m_waste.reset();\n+    m_weight = 0;\n }\n \n void SelectionResult::AddInput(const OutputGroup& group)\n {\n     util::insert(m_selected_inputs, group.m_outputs);\n     m_use_effective = !group.m_subtract_fee_outputs;\n+\n+    m_weight += group.m_weight;\n }\n \n void SelectionResult::AddInputs(const std::set<COutput>& inputs, bool subtract_fee_outputs)\n {\n     util::insert(m_selected_inputs, inputs);\n     m_use_effective = !subtract_fee_outputs;\n+\n+    m_weight += std::accumulate(inputs.cbegin(), inputs.cend(), 0, [](int sum, const auto& coin) {\n+        return sum + std::min(coin.input_bytes, 0) * WITNESS_SCALE_FACTOR;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r1027150572",
      "id" : 1027150572,
      "line" : 461,
      "node_id" : "PRRC_kwDOABII5849ORLs",
      "original_commit_id" : "070ca66bd56c434bef42eb4b00a2a6d4c6a0eccf",
      "original_line" : 461,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.cpp",
      "position" : 40,
      "pull_request_review_id" : 1187128851,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1027150572/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-19T22:12:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1027150572",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r1027158991"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1027158991"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Right thanks, I confused myself. Pushed.",
      "commit_id" : "30b71d1f0ea7e8b69b069713b66e45d472373832",
      "created_at" : "2022-11-19T23:27:33Z",
      "diff_hunk" : "@@ -436,18 +441,25 @@ void SelectionResult::Clear()\n {\n     m_selected_inputs.clear();\n     m_waste.reset();\n+    m_weight = 0;\n }\n \n void SelectionResult::AddInput(const OutputGroup& group)\n {\n     util::insert(m_selected_inputs, group.m_outputs);\n     m_use_effective = !group.m_subtract_fee_outputs;\n+\n+    m_weight += group.m_weight;\n }\n \n void SelectionResult::AddInputs(const std::set<COutput>& inputs, bool subtract_fee_outputs)\n {\n     util::insert(m_selected_inputs, inputs);\n     m_use_effective = !subtract_fee_outputs;\n+\n+    m_weight += std::accumulate(inputs.cbegin(), inputs.cend(), 0, [](int sum, const auto& coin) {\n+        return sum + std::min(coin.input_bytes, 0) * WITNESS_SCALE_FACTOR;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r1027158991",
      "id" : 1027158991,
      "in_reply_to_id" : 1027150572,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5849OTPP",
      "original_commit_id" : "070ca66bd56c434bef42eb4b00a2a6d4c6a0eccf",
      "original_line" : 461,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.cpp",
      "position" : null,
      "pull_request_review_id" : 1187139258,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1027158991/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-19T23:27:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1027158991",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r1028395564"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1028395564"
         }
      },
      "author_association" : "MEMBER",
      "body" : "As `std::copy_if` is a no-op if the vector is empty, could remove these lines.",
      "commit_id" : "30b71d1f0ea7e8b69b069713b66e45d472373832",
      "created_at" : "2022-11-21T18:29:09Z",
      "diff_hunk" : "@@ -557,14 +559,24 @@ std::optional<SelectionResult> ChooseSelectionResult(const CWallet& wallet, cons\n         results.push_back(*srd_result);\n     }\n \n-    if (results.size() == 0) {\n+    if (results.empty()) {\n         // No solution found\n         return std::nullopt;\n     }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r1028395564",
      "id" : 1028395564,
      "line" : 565,
      "node_id" : "PRRC_kwDOABII5849TBIs",
      "original_commit_id" : "645dd063207d1193c3f244667ba0a70c7621a7d9",
      "original_line" : 565,
      "original_position" : 20,
      "original_start_line" : 562,
      "path" : "src/wallet/spend.cpp",
      "position" : 20,
      "pull_request_review_id" : 1188765351,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1028395564/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 562,
      "start_side" : "RIGHT",
      "updated_at" : "2022-11-21T18:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1028395564",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r1028401487"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1028401487"
         }
      },
      "author_association" : "MEMBER",
      "body" : "As this is expecting to find one single output, might be better to do:\r\n\r\n```c++\r\nconst auto& inputs = result->GetInputSet();\r\nBOOST_CHECK_EQUAL(inputs.size(), 1);\r\nBOOST_CHECK_EQUAL(inputs.begin()->GetEffectiveValue(), 50 * COIN);\r\n```",
      "commit_id" : "30b71d1f0ea7e8b69b069713b66e45d472373832",
      "created_at" : "2022-11-21T18:36:19Z",
      "diff_hunk" : "@@ -930,6 +931,124 @@ BOOST_AUTO_TEST_CASE(effective_value_test)\n     BOOST_CHECK_EQUAL(output5.GetEffectiveValue(), nValue); // The effective value should be equal to the absolute value if input_bytes is -1\n }\n \n+static std::optional<SelectionResult> select_coins(const CAmount& target, const CoinSelectionParams& cs_params, const CCoinControl& cc, std::function<CoinsResult(CWallet&)> coin_setup, interfaces::Chain* chain, const ArgsManager& args)\n+{\n+    std::unique_ptr<CWallet> wallet = std::make_unique<CWallet>(chain, \"\", args, CreateMockWalletDatabase());\n+    wallet->LoadWallet();\n+    LOCK(wallet->cs_wallet);\n+    wallet->SetWalletFlag(WALLET_FLAG_DESCRIPTORS);\n+    wallet->SetupDescriptorScriptPubKeyMans();\n+\n+    auto available_coins = coin_setup(*wallet);\n+\n+    const auto result = SelectCoins(*wallet, available_coins, /*pre_set_inputs=*/ {}, target, cc, cs_params);\n+    if (result) {\n+        const auto signedTxSize = 10 + 34 + 68 * result->GetInputSet().size(); // static header size + output size + inputs size (P2WPKH)\n+        BOOST_CHECK_LE(signedTxSize * WITNESS_SCALE_FACTOR, MAX_STANDARD_TX_WEIGHT);\n+\n+        BOOST_CHECK_GE(result->GetSelectedValue(), target);\n+    }\n+    return result;\n+}\n+\n+static bool has_coin(const CoinSet& set, CAmount amount)\n+{\n+    return std::any_of(set.begin(), set.end(), [&](const auto& coin) { return coin.GetEffectiveValue() == amount; });\n+}\n+\n+BOOST_AUTO_TEST_CASE(check_max_weight)\n+{\n+    const CAmount target = 49.5L * COIN;\n+    CCoinControl cc;\n+\n+    FastRandomContext rand;\n+    CoinSelectionParams cs_params{\n+        rand,\n+        /*change_output_size=*/34,\n+        /*change_spend_size=*/68,\n+        /*min_change_target=*/CENT,\n+        /*effective_feerate=*/CFeeRate(0),\n+        /*long_term_feerate=*/CFeeRate(0),\n+        /*discard_feerate=*/CFeeRate(0),\n+        /*tx_noinputs_size=*/10 + 34, // static header size + output size\n+        /*avoid_partial=*/false,\n+    };\n+\n+    auto chain{m_node.chain.get()};\n+\n+    {\n+        // Scenario 1:\n+        // The actor starts with 1x 50.0 BTC and 1515x 0.033 BTC (~100.0 BTC total) unspent outputs\n+        // Then tries to spend 49.5 BTC\n+        // The 50.0 BTC output should be selected, because the transaction would otherwise be too large\n+\n+        // Perform selection\n+\n+        const auto result = select_coins(\n+            target, cs_params, cc, [&](CWallet& wallet) {\n+                CoinsResult available_coins;\n+                for (int j = 0; j < 1515; ++j) {\n+                    add_coin(available_coins, wallet, CAmount(0.033 * COIN), CFeeRate(0), 144, false, 0, true);\n+                }\n+\n+                add_coin(available_coins, wallet, CAmount(50 * COIN), CFeeRate(0), 144, false, 0, true);\n+                return available_coins;\n+            },\n+            chain, m_args);\n+\n+        BOOST_CHECK(result);\n+        BOOST_CHECK(has_coin(result->GetInputSet(), CAmount(50 * COIN)));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r1028401487",
      "id" : 1028401487,
      "line" : 1000,
      "node_id" : "PRRC_kwDOABII5849TClP",
      "original_commit_id" : "30b71d1f0ea7e8b69b069713b66e45d472373832",
      "original_line" : 1000,
      "original_position" : 78,
      "original_start_line" : null,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : 78,
      "pull_request_review_id" : 1188765351,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1028401487/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-21T18:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1028401487",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r1028425231"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1028425231"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It appears that there is more than 1 coin selected (hundreds), I'm guessing this is because of UTXO consolidation?\r\nThe 50 BTC coin will always be in the input set though.",
      "commit_id" : "30b71d1f0ea7e8b69b069713b66e45d472373832",
      "created_at" : "2022-11-21T19:06:03Z",
      "diff_hunk" : "@@ -930,6 +931,124 @@ BOOST_AUTO_TEST_CASE(effective_value_test)\n     BOOST_CHECK_EQUAL(output5.GetEffectiveValue(), nValue); // The effective value should be equal to the absolute value if input_bytes is -1\n }\n \n+static std::optional<SelectionResult> select_coins(const CAmount& target, const CoinSelectionParams& cs_params, const CCoinControl& cc, std::function<CoinsResult(CWallet&)> coin_setup, interfaces::Chain* chain, const ArgsManager& args)\n+{\n+    std::unique_ptr<CWallet> wallet = std::make_unique<CWallet>(chain, \"\", args, CreateMockWalletDatabase());\n+    wallet->LoadWallet();\n+    LOCK(wallet->cs_wallet);\n+    wallet->SetWalletFlag(WALLET_FLAG_DESCRIPTORS);\n+    wallet->SetupDescriptorScriptPubKeyMans();\n+\n+    auto available_coins = coin_setup(*wallet);\n+\n+    const auto result = SelectCoins(*wallet, available_coins, /*pre_set_inputs=*/ {}, target, cc, cs_params);\n+    if (result) {\n+        const auto signedTxSize = 10 + 34 + 68 * result->GetInputSet().size(); // static header size + output size + inputs size (P2WPKH)\n+        BOOST_CHECK_LE(signedTxSize * WITNESS_SCALE_FACTOR, MAX_STANDARD_TX_WEIGHT);\n+\n+        BOOST_CHECK_GE(result->GetSelectedValue(), target);\n+    }\n+    return result;\n+}\n+\n+static bool has_coin(const CoinSet& set, CAmount amount)\n+{\n+    return std::any_of(set.begin(), set.end(), [&](const auto& coin) { return coin.GetEffectiveValue() == amount; });\n+}\n+\n+BOOST_AUTO_TEST_CASE(check_max_weight)\n+{\n+    const CAmount target = 49.5L * COIN;\n+    CCoinControl cc;\n+\n+    FastRandomContext rand;\n+    CoinSelectionParams cs_params{\n+        rand,\n+        /*change_output_size=*/34,\n+        /*change_spend_size=*/68,\n+        /*min_change_target=*/CENT,\n+        /*effective_feerate=*/CFeeRate(0),\n+        /*long_term_feerate=*/CFeeRate(0),\n+        /*discard_feerate=*/CFeeRate(0),\n+        /*tx_noinputs_size=*/10 + 34, // static header size + output size\n+        /*avoid_partial=*/false,\n+    };\n+\n+    auto chain{m_node.chain.get()};\n+\n+    {\n+        // Scenario 1:\n+        // The actor starts with 1x 50.0 BTC and 1515x 0.033 BTC (~100.0 BTC total) unspent outputs\n+        // Then tries to spend 49.5 BTC\n+        // The 50.0 BTC output should be selected, because the transaction would otherwise be too large\n+\n+        // Perform selection\n+\n+        const auto result = select_coins(\n+            target, cs_params, cc, [&](CWallet& wallet) {\n+                CoinsResult available_coins;\n+                for (int j = 0; j < 1515; ++j) {\n+                    add_coin(available_coins, wallet, CAmount(0.033 * COIN), CFeeRate(0), 144, false, 0, true);\n+                }\n+\n+                add_coin(available_coins, wallet, CAmount(50 * COIN), CFeeRate(0), 144, false, 0, true);\n+                return available_coins;\n+            },\n+            chain, m_args);\n+\n+        BOOST_CHECK(result);\n+        BOOST_CHECK(has_coin(result->GetInputSet(), CAmount(50 * COIN)));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r1028425231",
      "id" : 1028425231,
      "in_reply_to_id" : 1028401487,
      "line" : 1000,
      "node_id" : "PRRC_kwDOABII5849TIYP",
      "original_commit_id" : "30b71d1f0ea7e8b69b069713b66e45d472373832",
      "original_line" : 1000,
      "original_position" : 78,
      "original_start_line" : null,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : 78,
      "pull_request_review_id" : 1188807554,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1028425231/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-21T19:06:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1028425231",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r1028426001"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1028426001"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Leaving the `results.empty())` check would also avoid creating the `eligible_results` no?",
      "commit_id" : "30b71d1f0ea7e8b69b069713b66e45d472373832",
      "created_at" : "2022-11-21T19:07:01Z",
      "diff_hunk" : "@@ -557,14 +559,24 @@ std::optional<SelectionResult> ChooseSelectionResult(const CWallet& wallet, cons\n         results.push_back(*srd_result);\n     }\n \n-    if (results.size() == 0) {\n+    if (results.empty()) {\n         // No solution found\n         return std::nullopt;\n     }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r1028426001",
      "id" : 1028426001,
      "in_reply_to_id" : 1028395564,
      "line" : 565,
      "node_id" : "PRRC_kwDOABII5849TIkR",
      "original_commit_id" : "645dd063207d1193c3f244667ba0a70c7621a7d9",
      "original_line" : 565,
      "original_position" : 20,
      "original_start_line" : 562,
      "path" : "src/wallet/spend.cpp",
      "position" : 20,
      "pull_request_review_id" : 1188808603,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1028426001/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 562,
      "start_side" : "RIGHT",
      "updated_at" : "2022-11-21T19:07:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1028426001",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r1029305468"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1029305468"
         }
      },
      "author_association" : "MEMBER",
      "body" : "yes, would only avoid the empty vector initialization.",
      "commit_id" : "30b71d1f0ea7e8b69b069713b66e45d472373832",
      "created_at" : "2022-11-22T13:07:38Z",
      "diff_hunk" : "@@ -557,14 +559,24 @@ std::optional<SelectionResult> ChooseSelectionResult(const CWallet& wallet, cons\n         results.push_back(*srd_result);\n     }\n \n-    if (results.size() == 0) {\n+    if (results.empty()) {\n         // No solution found\n         return std::nullopt;\n     }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r1029305468",
      "id" : 1029305468,
      "in_reply_to_id" : 1028395564,
      "line" : 565,
      "node_id" : "PRRC_kwDOABII5849WfR8",
      "original_commit_id" : "645dd063207d1193c3f244667ba0a70c7621a7d9",
      "original_line" : 565,
      "original_position" : 20,
      "original_start_line" : 562,
      "path" : "src/wallet/spend.cpp",
      "position" : 20,
      "pull_request_review_id" : 1190017336,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1029305468/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 562,
      "start_side" : "RIGHT",
      "updated_at" : "2022-11-22T13:07:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1029305468",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r1029324367"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1029324367"
         }
      },
      "author_association" : "MEMBER",
      "body" : "hmm, privacy wise, sounds odd to add hundreds of UTXO from different external sources when the target amount is being covered only by one of them.. the rest are not needed, they are just leaking information about the wallet and making the tx bigger.\r\n\r\nWill give it a look. It's not something that should block this PR, just a parallel investigation.",
      "commit_id" : "30b71d1f0ea7e8b69b069713b66e45d472373832",
      "created_at" : "2022-11-22T13:25:48Z",
      "diff_hunk" : "@@ -930,6 +931,124 @@ BOOST_AUTO_TEST_CASE(effective_value_test)\n     BOOST_CHECK_EQUAL(output5.GetEffectiveValue(), nValue); // The effective value should be equal to the absolute value if input_bytes is -1\n }\n \n+static std::optional<SelectionResult> select_coins(const CAmount& target, const CoinSelectionParams& cs_params, const CCoinControl& cc, std::function<CoinsResult(CWallet&)> coin_setup, interfaces::Chain* chain, const ArgsManager& args)\n+{\n+    std::unique_ptr<CWallet> wallet = std::make_unique<CWallet>(chain, \"\", args, CreateMockWalletDatabase());\n+    wallet->LoadWallet();\n+    LOCK(wallet->cs_wallet);\n+    wallet->SetWalletFlag(WALLET_FLAG_DESCRIPTORS);\n+    wallet->SetupDescriptorScriptPubKeyMans();\n+\n+    auto available_coins = coin_setup(*wallet);\n+\n+    const auto result = SelectCoins(*wallet, available_coins, /*pre_set_inputs=*/ {}, target, cc, cs_params);\n+    if (result) {\n+        const auto signedTxSize = 10 + 34 + 68 * result->GetInputSet().size(); // static header size + output size + inputs size (P2WPKH)\n+        BOOST_CHECK_LE(signedTxSize * WITNESS_SCALE_FACTOR, MAX_STANDARD_TX_WEIGHT);\n+\n+        BOOST_CHECK_GE(result->GetSelectedValue(), target);\n+    }\n+    return result;\n+}\n+\n+static bool has_coin(const CoinSet& set, CAmount amount)\n+{\n+    return std::any_of(set.begin(), set.end(), [&](const auto& coin) { return coin.GetEffectiveValue() == amount; });\n+}\n+\n+BOOST_AUTO_TEST_CASE(check_max_weight)\n+{\n+    const CAmount target = 49.5L * COIN;\n+    CCoinControl cc;\n+\n+    FastRandomContext rand;\n+    CoinSelectionParams cs_params{\n+        rand,\n+        /*change_output_size=*/34,\n+        /*change_spend_size=*/68,\n+        /*min_change_target=*/CENT,\n+        /*effective_feerate=*/CFeeRate(0),\n+        /*long_term_feerate=*/CFeeRate(0),\n+        /*discard_feerate=*/CFeeRate(0),\n+        /*tx_noinputs_size=*/10 + 34, // static header size + output size\n+        /*avoid_partial=*/false,\n+    };\n+\n+    auto chain{m_node.chain.get()};\n+\n+    {\n+        // Scenario 1:\n+        // The actor starts with 1x 50.0 BTC and 1515x 0.033 BTC (~100.0 BTC total) unspent outputs\n+        // Then tries to spend 49.5 BTC\n+        // The 50.0 BTC output should be selected, because the transaction would otherwise be too large\n+\n+        // Perform selection\n+\n+        const auto result = select_coins(\n+            target, cs_params, cc, [&](CWallet& wallet) {\n+                CoinsResult available_coins;\n+                for (int j = 0; j < 1515; ++j) {\n+                    add_coin(available_coins, wallet, CAmount(0.033 * COIN), CFeeRate(0), 144, false, 0, true);\n+                }\n+\n+                add_coin(available_coins, wallet, CAmount(50 * COIN), CFeeRate(0), 144, false, 0, true);\n+                return available_coins;\n+            },\n+            chain, m_args);\n+\n+        BOOST_CHECK(result);\n+        BOOST_CHECK(has_coin(result->GetInputSet(), CAmount(50 * COIN)));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r1029324367",
      "id" : 1029324367,
      "in_reply_to_id" : 1028401487,
      "line" : 1000,
      "node_id" : "PRRC_kwDOABII5849Wj5P",
      "original_commit_id" : "30b71d1f0ea7e8b69b069713b66e45d472373832",
      "original_line" : 1000,
      "original_position" : 78,
      "original_start_line" : null,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : 78,
      "pull_request_review_id" : 1190045295,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1029324367/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-22T13:25:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1029324367",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 30b71d1f0ea7e8b69b069713b66e45d472373832",
      "created_at" : "2022-11-23T19:08:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1325540412",
      "id" : 1325540412,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585PAiQ8",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1325540412/reactions"
      },
      "updated_at" : "2022-11-23T19:08:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1325540412",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2022-12-05T18:19:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1337896418",
      "id" : 1337896418,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585Pvq3i",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1337896418/reactions"
      },
      "updated_at" : "2022-12-05T18:19:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1337896418",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased",
      "created_at" : "2022-12-05T18:34:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1337912900",
      "id" : 1337912900,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585Pvu5E",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1337912900/reactions"
      },
      "updated_at" : "2022-12-05T18:34:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1337912900",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "reACK c7c7ee9d0b2d7b303b9300f941e37e09e7d8d8b6",
      "created_at" : "2022-12-05T21:06:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#issuecomment-1338162621",
      "id" : 1338162621,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25729",
      "node_id" : "IC_kwDOABII585Pwr29",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1338162621/reactions"
      },
      "updated_at" : "2022-12-05T21:06:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1338162621",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r1040604667"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1040604667"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "While this is fine for the purposes of this PR, the weight here is not always precise due to rounding error of `input_bytes`.\r\n\r\nIdeally, we would store the actual weight in `COutput` and just take it from there. I realise, this might be out of scope for this PR. But maybe we can add a warning in code for future devs and create an issue in this repo?",
      "commit_id" : "c7c7ee9d0b2d7b303b9300f941e37e09e7d8d8b6",
      "created_at" : "2022-12-06T07:45:27Z",
      "diff_hunk" : "@@ -354,6 +355,10 @@ void OutputGroup::Insert(const COutput& output, size_t ancestors, size_t descend\n     // descendants is the count as seen from the top ancestor, not the descendants as seen from the\n     // coin itself; thus, this value is counted as the max, not the sum\n     m_descendants = std::max(m_descendants, descendants);\n+\n+    if (output.input_bytes > 0) {\n+        m_weight += output.input_bytes * WITNESS_SCALE_FACTOR;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r1040604667",
      "id" : 1040604667,
      "line" : 360,
      "node_id" : "PRRC_kwDOABII584-Bl37",
      "original_commit_id" : "6b563cae92957dc30dc35103a7c321fdb0115ef3",
      "original_line" : 360,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.cpp",
      "position" : 14,
      "pull_request_review_id" : 1206046383,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1040604667/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-06T07:45:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1040604667",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r1041002372"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1041002372"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> the weight here is not always precise due to rounding error of input_bytes\r\n\r\nCould elaborate, since both `COutput::input_bytes` and `WITNESS_SCALE_FACTOR` are integer ?",
      "commit_id" : "c7c7ee9d0b2d7b303b9300f941e37e09e7d8d8b6",
      "created_at" : "2022-12-06T13:52:22Z",
      "diff_hunk" : "@@ -354,6 +355,10 @@ void OutputGroup::Insert(const COutput& output, size_t ancestors, size_t descend\n     // descendants is the count as seen from the top ancestor, not the descendants as seen from the\n     // coin itself; thus, this value is counted as the max, not the sum\n     m_descendants = std::max(m_descendants, descendants);\n+\n+    if (output.input_bytes > 0) {\n+        m_weight += output.input_bytes * WITNESS_SCALE_FACTOR;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r1041002372",
      "id" : 1041002372,
      "in_reply_to_id" : 1040604667,
      "line" : 360,
      "node_id" : "PRRC_kwDOABII584-DG-E",
      "original_commit_id" : "6b563cae92957dc30dc35103a7c321fdb0115ef3",
      "original_line" : 360,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.cpp",
      "position" : 14,
      "pull_request_review_id" : 1206636495,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1041002372/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-06T13:52:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1041002372",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/94266259?v=4",
         "events_url" : "https://api.github.com/users/w0xlt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/w0xlt/followers",
         "following_url" : "https://api.github.com/users/w0xlt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/w0xlt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/w0xlt",
         "id" : 94266259,
         "login" : "w0xlt",
         "node_id" : "U_kgDOBZ5jkw",
         "organizations_url" : "https://api.github.com/users/w0xlt/orgs",
         "received_events_url" : "https://api.github.com/users/w0xlt/received_events",
         "repos_url" : "https://api.github.com/users/w0xlt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/w0xlt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/w0xlt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/w0xlt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r1041078282"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1041078282"
         }
      },
      "author_association" : "MEMBER",
      "body" : "could:\r\n```suggestion\r\n    const CAmount not_input_fees = coin_selection_params.m_subtract_fee_outputs ? 0 : coin_selection_params.m_effective_feerate.GetFee(coin_selection_params.tx_noinputs_size);\r\n```",
      "commit_id" : "c7c7ee9d0b2d7b303b9300f941e37e09e7d8d8b6",
      "created_at" : "2022-12-06T14:53:12Z",
      "diff_hunk" : "@@ -888,7 +897,7 @@ static util::Result<CreatedTransactionResult> CreateTransactionInternal(\n     }\n \n     // Include the fees for things that aren't inputs, excluding the change output\n-    const CAmount not_input_fees = coin_selection_params.m_effective_feerate.GetFee(coin_selection_params.tx_noinputs_size);\n+    const CAmount not_input_fees = coin_selection_params.m_effective_feerate.GetFee(coin_selection_params.m_subtract_fee_outputs ? 0 : coin_selection_params.tx_noinputs_size);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25729#discussion_r1041078282",
      "id" : 1041078282,
      "line" : 900,
      "node_id" : "PRRC_kwDOABII584-DZgK",
      "original_commit_id" : "c7c7ee9d0b2d7b303b9300f941e37e09e7d8d8b6",
      "original_line" : 900,
      "original_position" : 68,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 68,
      "pull_request_review_id" : 1206746957,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25729",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1041078282/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-06T14:54:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1041078282",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   }
]
