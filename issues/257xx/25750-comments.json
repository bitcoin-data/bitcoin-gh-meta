[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#25021](https://github.com/bitcoin/bitcoin/pull/25021) (test: fix intermittent wallet_encryption failures on win64 task by jonatack)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-07-31T19:55:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25750#issuecomment-1200489111",
      "id" : 1200489111,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25750",
      "node_id" : "IC_kwDOABII585HjgKX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1200489111/reactions"
      },
      "updated_at" : "2022-08-10T17:26:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1200489111",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25750#discussion_r943625467"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25750"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943625467"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "From the discussion in https://github.com/bitcoin/bitcoin/issues/25482#issuecomment-1204388474 it seems that `time()` and `std::chrono` can deviate a bit on both Windows and Linux and that is the root of the problem. We only observe a problem on Windows because it happens that Python's `time.time()` uses one on Windows and the other on Linux. But we are not guaranteed that it will be like that forever. E.g. future Python on Linux may start to behave as the Python on Windows.\r\n\r\nIs the above correct? If yes, then it would be better to fix this test in platform agnostic way.",
      "commit_id" : "faa2df9cd3e19e9a5104614485fa19d4383a407f",
      "created_at" : "2022-08-11T15:29:58Z",
      "diff_hunk" : "@@ -78,8 +79,13 @@ def run_test(self):\n         MAX_VALUE = 100000000\n         expected_time = int(time.time()) + MAX_VALUE - 600\n         self.nodes[0].walletpassphrase(passphrase2, MAX_VALUE - 600)\n-        # give buffer for walletpassphrase, since it iterates over all encrypted keys\n+        # Calculate the expected timeout after the walletpassphrase call, since\n+        # it iterates over all encrypted keys\n         expected_time_with_buffer = time.time() + MAX_VALUE - 600\n+        if sys.platform == \"win32\":",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25750#discussion_r943625467",
      "id" : 943625467,
      "line" : 85,
      "node_id" : "PRRC_kwDOABII5844PpT7",
      "original_commit_id" : "faa2df9cd3e19e9a5104614485fa19d4383a407f",
      "original_line" : 85,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "test/functional/wallet_encryption.py",
      "position" : 16,
      "pull_request_review_id" : 1069921394,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25750",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943625467/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-11T15:29:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943625467",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25750#discussion_r943638841"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25750"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943638841"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No, I still fail to see how this bug exits in the first place.\r\n\r\nWe know:\r\n* It has only been observed on Windows MSVC, after commit 0000a63689036dc4368d04c0648a55fdf507932f\r\n* It has never been observed on any other OS or a different compiler. Though, that doesn't mean the bug doesn't exist on Windows with clang or gcc, or on Linux with a different setting.\r\n* After commit 0000a63689036dc4368d04c0648a55fdf507932f, both python `time.time()` and MSVC `std::chrono` use the same source for time (precise file time). So commit 0000a63689036dc4368d04c0648a55fdf507932f should have *fixed* the issue (if it existed before), not *introduce* it\r\n* The issue shouldn't be reproducible on systems where `time()` is *behind* `std::chrono::system_clock`. I've observed the `time()` to be behind by usually 1/2/6 ms on Linux. While this lag wouldn't lead to any test failues, commit 0000a63689036dc4368d04c0648a55fdf507932f removed the lag on Linux.",
      "commit_id" : "faa2df9cd3e19e9a5104614485fa19d4383a407f",
      "created_at" : "2022-08-11T15:42:42Z",
      "diff_hunk" : "@@ -78,8 +79,13 @@ def run_test(self):\n         MAX_VALUE = 100000000\n         expected_time = int(time.time()) + MAX_VALUE - 600\n         self.nodes[0].walletpassphrase(passphrase2, MAX_VALUE - 600)\n-        # give buffer for walletpassphrase, since it iterates over all encrypted keys\n+        # Calculate the expected timeout after the walletpassphrase call, since\n+        # it iterates over all encrypted keys\n         expected_time_with_buffer = time.time() + MAX_VALUE - 600\n+        if sys.platform == \"win32\":",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25750#discussion_r943638841",
      "id" : 943638841,
      "in_reply_to_id" : 943625467,
      "line" : 85,
      "node_id" : "PRRC_kwDOABII5844Psk5",
      "original_commit_id" : "faa2df9cd3e19e9a5104614485fa19d4383a407f",
      "original_line" : 85,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "test/functional/wallet_encryption.py",
      "position" : 16,
      "pull_request_review_id" : 1069940392,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25750",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943638841/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-11T15:42:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943638841",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> One speculation about the cause: maybe this is a rounding bug?\r\n\r\nI don't think so. floor and cast do the same thing, see https://github.com/bitcoin/bitcoin/pull/25021#issuecomment-1126944095",
      "created_at" : "2022-08-19T08:48:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25750#issuecomment-1220418738",
      "id" : 1220418738,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25750",
      "node_id" : "IC_kwDOABII585Ivhyy",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1220418738/reactions"
      },
      "updated_at" : "2022-08-19T08:48:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1220418738",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
