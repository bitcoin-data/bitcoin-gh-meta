[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25778#discussion_r937542523"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/937542523"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Now the fuzz target has some shallow bugs. For example, `GetAmount` fail to get coin value. I guess that's because I simply add newly constructed tx out to outpoints, so `CCoinsViewMemPool::GetCoin` cannot find the outpoint in mempool.\r\n\r\n```log\r\ntest/fuzz/tx_pool.cpp:164 operator(): Assertion `amount_view.GetCoin(outpoint, c)' failed.\r\n==3026798== ERROR: libFuzzer: deadly signal\r\n    #0 0x5609ccdba680 in __sanitizer_print_stack_trace (/home/ubuntu/bitcoin/src/test/fuzz/fuzz+0xfd7680)\r\n    #1 0x5609ccd66988 in fuzzer::PrintStackTrace() (/home/ubuntu/bitcoin/src/test/fuzz/fuzz+0xf83988)\r\n    #2 0x5609ccd4bad3 in fuzzer::Fuzzer::CrashCallback() (/home/ubuntu/bitcoin/src/test/fuzz/fuzz+0xf68ad3)\r\n    #3 0x7f173207341f  (/lib/x86_64-linux-gnu/libpthread.so.0+0x1441f)\r\n    #4 0x7f1731cd900a in __libc_signal_restore_set /build/glibc-SzIz7B/glibc-2.31/signal/../sysdeps/unix/sysv/linux/internal-signals.h:86:3\r\n    #5 0x7f1731cd900a in raise /build/glibc-SzIz7B/glibc-2.31/signal/../sysdeps/unix/sysv/linux/raise.c:48:3\r\n    #6 0x7f1731cb8858 in abort /build/glibc-SzIz7B/glibc-2.31/stdlib/abort.c:79:7\r\n    #7 0x5609cf0fa49d in assertion_fail(char const*, int, char const*, char const*) src/util/check.cpp:13:5\r\n    #8 0x5609cd319c02 in bool&& inline_assertion_check<true, bool>(bool&&, char const*, int, char const*, char const*) src/./util/check.h:67:13\r\n    #9 0x5609cd5cbdda in (anonymous namespace)::tx_pool_standard_fuzz_target(Span<unsigned char const>)::$_4::operator()(COutPoint const&) const src/test/fuzz/tx_pool.cpp:164:9\r\n    #10 0x5609cd5cc62a in (anonymous namespace)::tx_pool_standard_fuzz_target(Span<unsigned char const>)::$_5::operator()() const src/test/fuzz/tx_pool.cpp:198:34\r\n```\r\n\r\nThere are at least two different ways to fix the assert:\r\n * extend the outpoints_* datastructures with the amount and use that directly\r\n * add a new datastructure to keep track of amounts and modify GetAmount to use that",
      "commit_id" : "dfad3761565180f020eb160f78ae541f156be9c9",
      "created_at" : "2022-08-04T09:10:44Z",
      "diff_hunk" : "@@ -177,45 +178,54 @@ FUZZ_TARGET_INIT(tx_pool_standard, initialize_tx_pool)\n         Assert(!outpoints_supply.empty());\n \n         // Create transaction to add to the mempool\n-        const CTransactionRef tx = [&] {\n-            CMutableTransaction tx_mut;\n-            tx_mut.nVersion = CTransaction::CURRENT_VERSION;\n-            tx_mut.nLockTime = fuzzed_data_provider.ConsumeBool() ? 0 : fuzzed_data_provider.ConsumeIntegral<uint32_t>();\n-            const auto num_in = fuzzed_data_provider.ConsumeIntegralInRange<int>(1, outpoints_rbf.size());\n-            const auto num_out = fuzzed_data_provider.ConsumeIntegralInRange<int>(1, outpoints_rbf.size() * 2);\n-\n-            CAmount amount_in{0};\n-            for (int i = 0; i < num_in; ++i) {\n-                // Pop random outpoint\n-                auto pop = outpoints_rbf.begin();\n-                std::advance(pop, fuzzed_data_provider.ConsumeIntegralInRange<size_t>(0, outpoints_rbf.size() - 1));\n-                const auto outpoint = *pop;\n-                outpoints_rbf.erase(pop);\n-                amount_in += GetAmount(outpoint);\n-\n-                // Create input\n-                const auto sequence = ConsumeSequence(fuzzed_data_provider);\n-                const auto script_sig = CScript{};\n-                const auto script_wit_stack = std::vector<std::vector<uint8_t>>{WITNESS_STACK_ELEM_OP_TRUE};\n-                CTxIn in;\n-                in.prevout = outpoint;\n-                in.nSequence = sequence;\n-                in.scriptSig = script_sig;\n-                in.scriptWitness.stack = script_wit_stack;\n-\n-                tx_mut.vin.push_back(in);\n-            }\n-            const auto amount_fee = fuzzed_data_provider.ConsumeIntegralInRange<CAmount>(-1000, amount_in);\n-            const auto amount_out = (amount_in - amount_fee) / num_out;\n-            for (int i = 0; i < num_out; ++i) {\n-                tx_mut.vout.emplace_back(amount_out, P2WSH_OP_TRUE);\n-            }\n-            const auto tx = MakeTransactionRef(tx_mut);\n-            // Restore previously removed outpoints\n-            for (const auto& in : tx->vin) {\n-                Assert(outpoints_rbf.insert(in.prevout).second);\n+        const Package package = [&] {\n+            auto n_tx = fuzzed_data_provider.ConsumeIntegralInRange<uint32_t>(1, MAX_PACKAGE_COUNT + 5);\n+            Package txs;\n+            while (n_tx--) {\n+                CMutableTransaction tx_mut;\n+                tx_mut.nVersion = CTransaction::CURRENT_VERSION;\n+                tx_mut.nLockTime = fuzzed_data_provider.ConsumeBool() ? 0 : fuzzed_data_provider.ConsumeIntegral<uint32_t>();\n+                const auto num_in = fuzzed_data_provider.ConsumeIntegralInRange<int>(1, outpoints_rbf.size());\n+                const auto num_out = fuzzed_data_provider.ConsumeIntegralInRange<int>(1, outpoints_rbf.size() * 2);\n+\n+                CAmount amount_in{0};\n+                for (int i = 0; i < num_in; ++i) {\n+                    // Pop random outpoint\n+                    auto pop = outpoints_rbf.begin();\n+                    std::advance(pop, fuzzed_data_provider.ConsumeIntegralInRange<size_t>(0, outpoints_rbf.size() - 1));\n+                    const auto outpoint = *pop;\n+                    outpoints_rbf.erase(pop);\n+                    amount_in += GetAmount(outpoint);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25778#discussion_r937542523",
      "id" : 937542523,
      "line" : 198,
      "node_id" : "PRRC_kwDOABII58434cN7",
      "original_commit_id" : "c157a6ca57cd4c1392ad82b85d4b1df0b7d23e11",
      "original_line" : 198,
      "original_position" : 66,
      "original_start_line" : null,
      "path" : "src/test/fuzz/tx_pool.cpp",
      "position" : 75,
      "pull_request_review_id" : 1061550477,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/937542523/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-04T14:51:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/937542523",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/24590067?v=4",
         "events_url" : "https://api.github.com/users/chinggg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/chinggg/followers",
         "following_url" : "https://api.github.com/users/chinggg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/chinggg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/chinggg",
         "id" : 24590067,
         "login" : "chinggg",
         "node_id" : "MDQ6VXNlcjI0NTkwMDY3",
         "organizations_url" : "https://api.github.com/users/chinggg/orgs",
         "received_events_url" : "https://api.github.com/users/chinggg/received_events",
         "repos_url" : "https://api.github.com/users/chinggg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/chinggg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/chinggg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/chinggg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25778#discussion_r938398224"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/938398224"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This assertion failure is solved in https://github.com/bitcoin/bitcoin/commit/c157a6ca57cd4c1392ad82b85d4b1df0b7d23e11, by changing `amount_view` to be non-const and calling `amount_view.PackageAddTransaction(tx);` after each tx is constructed.",
      "commit_id" : "6ca7fcf2247ed7067ebaf3ee8dc325d49142d666",
      "created_at" : "2022-08-05T02:47:29Z",
      "diff_hunk" : "@@ -177,45 +178,54 @@ FUZZ_TARGET_INIT(tx_pool_standard, initialize_tx_pool)\n         Assert(!outpoints_supply.empty());\n \n         // Create transaction to add to the mempool\n-        const CTransactionRef tx = [&] {\n-            CMutableTransaction tx_mut;\n-            tx_mut.nVersion = CTransaction::CURRENT_VERSION;\n-            tx_mut.nLockTime = fuzzed_data_provider.ConsumeBool() ? 0 : fuzzed_data_provider.ConsumeIntegral<uint32_t>();\n-            const auto num_in = fuzzed_data_provider.ConsumeIntegralInRange<int>(1, outpoints_rbf.size());\n-            const auto num_out = fuzzed_data_provider.ConsumeIntegralInRange<int>(1, outpoints_rbf.size() * 2);\n-\n-            CAmount amount_in{0};\n-            for (int i = 0; i < num_in; ++i) {\n-                // Pop random outpoint\n-                auto pop = outpoints_rbf.begin();\n-                std::advance(pop, fuzzed_data_provider.ConsumeIntegralInRange<size_t>(0, outpoints_rbf.size() - 1));\n-                const auto outpoint = *pop;\n-                outpoints_rbf.erase(pop);\n-                amount_in += GetAmount(outpoint);\n-\n-                // Create input\n-                const auto sequence = ConsumeSequence(fuzzed_data_provider);\n-                const auto script_sig = CScript{};\n-                const auto script_wit_stack = std::vector<std::vector<uint8_t>>{WITNESS_STACK_ELEM_OP_TRUE};\n-                CTxIn in;\n-                in.prevout = outpoint;\n-                in.nSequence = sequence;\n-                in.scriptSig = script_sig;\n-                in.scriptWitness.stack = script_wit_stack;\n-\n-                tx_mut.vin.push_back(in);\n-            }\n-            const auto amount_fee = fuzzed_data_provider.ConsumeIntegralInRange<CAmount>(-1000, amount_in);\n-            const auto amount_out = (amount_in - amount_fee) / num_out;\n-            for (int i = 0; i < num_out; ++i) {\n-                tx_mut.vout.emplace_back(amount_out, P2WSH_OP_TRUE);\n-            }\n-            const auto tx = MakeTransactionRef(tx_mut);\n-            // Restore previously removed outpoints\n-            for (const auto& in : tx->vin) {\n-                Assert(outpoints_rbf.insert(in.prevout).second);\n+        const Package package = [&] {\n+            auto n_tx = fuzzed_data_provider.ConsumeIntegralInRange<uint32_t>(1, MAX_PACKAGE_COUNT + 5);\n+            Package txs;\n+            while (n_tx--) {\n+                CMutableTransaction tx_mut;\n+                tx_mut.nVersion = CTransaction::CURRENT_VERSION;\n+                tx_mut.nLockTime = fuzzed_data_provider.ConsumeBool() ? 0 : fuzzed_data_provider.ConsumeIntegral<uint32_t>();\n+                const auto num_in = fuzzed_data_provider.ConsumeIntegralInRange<int>(1, outpoints_rbf.size());\n+                const auto num_out = fuzzed_data_provider.ConsumeIntegralInRange<int>(1, outpoints_rbf.size() * 2);\n+\n+                CAmount amount_in{0};\n+                for (int i = 0; i < num_in; ++i) {\n+                    // Pop random outpoint\n+                    auto pop = outpoints_rbf.begin();\n+                    std::advance(pop, fuzzed_data_provider.ConsumeIntegralInRange<size_t>(0, outpoints_rbf.size() - 1));\n+                    const auto outpoint = *pop;\n+                    outpoints_rbf.erase(pop);\n+                    amount_in += GetAmount(outpoint);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25778#discussion_r938398224",
      "id" : 938398224,
      "in_reply_to_id" : 937542523,
      "line" : 199,
      "node_id" : "PRRC_kwDOABII58437tIQ",
      "original_commit_id" : "c157a6ca57cd4c1392ad82b85d4b1df0b7d23e11",
      "original_line" : 199,
      "original_position" : 66,
      "original_start_line" : null,
      "path" : "src/test/fuzz/tx_pool.cpp",
      "position" : 76,
      "pull_request_review_id" : 1062783428,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/938398224/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-06T04:11:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/938398224",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/24590067?v=4",
         "events_url" : "https://api.github.com/users/chinggg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/chinggg/followers",
         "following_url" : "https://api.github.com/users/chinggg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/chinggg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/chinggg",
         "id" : 24590067,
         "login" : "chinggg",
         "node_id" : "MDQ6VXNlcjI0NTkwMDY3",
         "organizations_url" : "https://api.github.com/users/chinggg/orgs",
         "received_events_url" : "https://api.github.com/users/chinggg/received_events",
         "repos_url" : "https://api.github.com/users/chinggg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/chinggg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/chinggg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/chinggg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25778#discussion_r938403815"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/938403815"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Another bug assert violation happens in `insert_tx`.\r\n\r\n```log\r\ntest/fuzz/tx_pool.cpp:308 operator(): Assertion `set.get().emplace(tx.GetHash(), i).second' failed.\r\n==3192931== ERROR: libFuzzer: deadly signal\r\n    #0 0x55c5a9cbf680 in __sanitizer_print_stack_trace (/home/ubuntu/bitcoin/src/test/fuzz/fuzz+0xfd7680)\r\n    #1 0x55c5a9c6b988 in fuzzer::PrintStackTrace() (/home/ubuntu/bitcoin/src/test/fuzz/fuzz+0xf83988)\r\n    #2 0x55c5a9c50ad3 in fuzzer::Fuzzer::CrashCallback() (/home/ubuntu/bitcoin/src/test/fuzz/fuzz+0xf68ad3)\r\n    #3 0x7f666ad8a41f  (/lib/x86_64-linux-gnu/libpthread.so.0+0x1441f)\r\n    #4 0x7f666a9f000a in __libc_signal_restore_set /build/glibc-SzIz7B/glibc-2.31/signal/../sysdeps/unix/sysv/linux/internal-signals.h:86:3\r\n    #5 0x7f666a9f000a in raise /build/glibc-SzIz7B/glibc-2.31/signal/../sysdeps/unix/sysv/linux/raise.c:48:3\r\n    #6 0x7f666a9cf858 in abort /build/glibc-SzIz7B/glibc-2.31/stdlib/abort.c:79:7\r\n    #7 0x55c5abfff51d in assertion_fail(char const*, int, char const*, char const*) src/util/check.cpp:13:5\r\n    #8 0x55c5aa21ec02 in bool&& inline_assertion_check<true, bool>(bool&&, char const*, int, char const*, char const*) src/./util/check.h:67:13\r\n    #9 0x55c5aa4d3759 in auto (anonymous namespace)::tx_pool_standard_fuzz_target(Span<unsigned char const>)::$_1::operator()<CTransaction>(std::vector<std::reference_wrapper<std::set<COutPoint, std::less<COutPoint>, std::allocator<COutPoint> > >, std::allocator<std::reference_wrapper<std::set<COutPoint, std::less<COutPoint>, std::allocator<COutPoint> > > > >, std::vector<std::reference_wrapper<std::set<COutPoint, std::less<COutPoint>, std::allocator<COutPoint> > >, std::allocator<std::reference_wrapper<std::set<COutPoint, std::less<COutPoint>, std::allocator<COutPoint> > > > >, CTransaction const&) const src/test/fuzz/tx_pool.cpp:308:21\r\n    #10 0x55c5aa4cdf0a in (anonymous namespace)::tx_pool_standard_fuzz_target(Span<unsigned char const>) src/test/fuzz/tx_pool.cpp:327:17\r\n```\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/master/src/test/fuzz/tx_pool.cpp#L271-L296\r\n\r\nI am not sure about what the loops are doing. Maybe `outpoint_rbf` should not be modified when constructing transactions.",
      "commit_id" : "dfad3761565180f020eb160f78ae541f156be9c9",
      "created_at" : "2022-08-05T03:03:24Z",
      "diff_hunk" : "@@ -239,33 +251,52 @@ FUZZ_TARGET_INIT(tx_pool_standard, initialize_tx_pool)\n         RegisterSharedValidationInterface(txr);\n         const bool bypass_limits = fuzzed_data_provider.ConsumeBool();\n \n-        // Make sure ProcessNewPackage on one transaction works.\n-        // The result is not guaranteed to be the same as what is returned by ATMP.\n-        const auto result_package = WITH_LOCK(::cs_main,\n-                                    return ProcessNewPackage(chainstate, tx_pool, {tx}, true));\n-        // If something went wrong due to a package-specific policy, it might not return a\n-        // validation result for the transaction.\n-        if (result_package.m_state.GetResult() != PackageValidationResult::PCKG_POLICY) {\n-            auto it = result_package.m_tx_results.find(tx->GetWitnessHash());\n-            Assert(it != result_package.m_tx_results.end());\n-            Assert(it->second.m_result_type == MempoolAcceptResult::ResultType::VALID ||\n-                   it->second.m_result_type == MempoolAcceptResult::ResultType::INVALID);\n+\n+        bool accepted{true};\n+        for (const auto& tx : package) {\n+            const bool submit_standalone{\n+                // A package must have at least 2 txs, so size-1 packages can only be submitted standalone\n+                package.size() == 1 ||\n+                fuzzed_data_provider.ConsumeBool()};\n+            if (submit_standalone) {\n+                const auto result_single{WITH_LOCK(::cs_main, return AcceptToMemoryPool(chainstate, tx, GetTime(), bypass_limits, /*test_accept=*/false))};\n+                const bool accepted_single{result_single.m_result_type == MempoolAcceptResult::ResultType::VALID};\n+                accepted &= accepted_single;\n+            }\n         }\n \n-        const auto res = WITH_LOCK(::cs_main, return AcceptToMemoryPool(chainstate, tx, GetTime(), bypass_limits, /*test_accept=*/false));\n-        const bool accepted = res.m_result_type == MempoolAcceptResult::ResultType::VALID;\n+        if (package.size() >= 2) {\n+            // Submit the remainder of the package.\n+            // For now, every package has only one tx , so this submits the whole\n+            // package again.\n+            const auto result_package{WITH_LOCK(::cs_main, return ProcessNewPackage(chainstate, tx_pool, package, /*test_accept=*/false))};\n+            accepted = result_package.m_state.IsValid();\n+            Assert(accepted != result_package.m_state.IsInvalid());\n+            // If something went wrong due to a package-specific policy, it might not return a\n+            // validation result for the transaction.\n+            if (result_package.m_state.GetResult() != PackageValidationResult::PCKG_POLICY) {\n+                for (const auto& tx_res : result_package.m_tx_results) {\n+                    Assert(tx_res.second.m_result_type == MempoolAcceptResult::ResultType::VALID ||\n+                           tx_res.second.m_result_type == MempoolAcceptResult::ResultType::INVALID);\n+                }\n+            }\n+            if (accepted) {\n+                Assert(result_package.m_tx_results.size() == package.size());\n+                for (const auto& tx_res : result_package.m_tx_results) {\n+                    Assert(tx_res.second.m_result_type == MempoolAcceptResult::ResultType::VALID);\n+                }\n+            }\n+        }\n         SyncWithValidationInterfaceQueue();\n         UnregisterSharedValidationInterface(txr);\n-\n         Assert(accepted != added.empty());\n-        Assert(accepted == res.m_state.IsValid());\n-        Assert(accepted != res.m_state.IsInvalid());\n         if (accepted) {\n-            Assert(added.size() == 1); // For now, no package acceptance\n-            Assert(tx == *added.begin());\n+            Assert(Package(added.begin(), added.end()) == package);\n         } else {\n-            // Do not consider rejected transaction removed\n-            removed.erase(tx);\n+            // Do not consider rejected transactions removed\n+            for (const auto& tx : package) {\n+                removed.erase(tx);\n+            }\n         }\n \n         // Helper to insert spent and created outpoints of a tx into collections",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25778#discussion_r938403815",
      "id" : 938403815,
      "line" : 303,
      "node_id" : "PRRC_kwDOABII58437ufn",
      "original_commit_id" : "c157a6ca57cd4c1392ad82b85d4b1df0b7d23e11",
      "original_line" : 303,
      "original_position" : 194,
      "original_start_line" : null,
      "path" : "src/test/fuzz/tx_pool.cpp",
      "position" : 204,
      "pull_request_review_id" : 1062790474,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/938403815/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-05T03:09:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/938403815",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/24590067?v=4",
         "events_url" : "https://api.github.com/users/chinggg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/chinggg/followers",
         "following_url" : "https://api.github.com/users/chinggg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/chinggg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/chinggg",
         "id" : 24590067,
         "login" : "chinggg",
         "node_id" : "MDQ6VXNlcjI0NTkwMDY3",
         "organizations_url" : "https://api.github.com/users/chinggg/orgs",
         "received_events_url" : "https://api.github.com/users/chinggg/received_events",
         "repos_url" : "https://api.github.com/users/chinggg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/chinggg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/chinggg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/chinggg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25778#discussion_r939467868"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/939467868"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The assertion `result_package.m_tx_results.size() == package.size()` failed quickly. I debug the testcase and it seems results.size() < package.size().\r\n\r\n```\r\ntest/fuzz/tx_pool.cpp:286 tx_pool_standard_fuzz_target: Assertion `result_package.m_tx_results.size() == package.size()' failed.\r\n==3398073== ERROR: libFuzzer: deadly signal\r\n    #0 0x55e1fcaec680 in __sanitizer_print_stack_trace (/home/ubuntu/bitcoin/src/test/fuzz/fuzz+0xfd8680)\r\n    #1 0x55e1fca98988 in fuzzer::PrintStackTrace() (/home/ubuntu/bitcoin/src/test/fuzz/fuzz+0xf84988)\r\n    #2 0x55e1fca7dad3 in fuzzer::Fuzzer::CrashCallback() (/home/ubuntu/bitcoin/src/test/fuzz/fuzz+0xf69ad3)\r\n    #3 0x7ff789c3741f  (/lib/x86_64-linux-gnu/libpthread.so.0+0x1441f)\r\n    #4 0x7ff78989d00a in __libc_signal_restore_set /build/glibc-SzIz7B/glibc-2.31/signal/../sysdeps/unix/sysv/linux/internal-signals.h:86:3\r\n    #5 0x7ff78989d00a in raise /build/glibc-SzIz7B/glibc-2.31/signal/../sysdeps/unix/sysv/linux/raise.c:48:3\r\n    #6 0x7ff78987c858 in abort /build/glibc-SzIz7B/glibc-2.31/stdlib/abort.c:79:7\r\n    #7 0x55e1fee2dc3d in assertion_fail(char const*, int, char const*, char const*) src/util/check.cpp:13:5\r\n    #8 0x55e1fd04bc02 in bool&& inline_assertion_check<true, bool>(bool&&, char const*, int, char const*, char const*) src/./util/check.h:67:13\r\n    #9 0x55e1fd2f9f0b in (anonymous namespace)::tx_pool_standard_fuzz_target(Span<unsigned char const>) src/test/fuzz/tx_pool.cpp:286:17\r\n```",
      "commit_id" : "6ca7fcf2247ed7067ebaf3ee8dc325d49142d666",
      "created_at" : "2022-08-06T02:11:23Z",
      "diff_hunk" : "@@ -239,33 +253,52 @@ FUZZ_TARGET_INIT(tx_pool_standard, initialize_tx_pool)\n         RegisterSharedValidationInterface(txr);\n         const bool bypass_limits = fuzzed_data_provider.ConsumeBool();\n \n-        // Make sure ProcessNewPackage on one transaction works.\n-        // The result is not guaranteed to be the same as what is returned by ATMP.\n-        const auto result_package = WITH_LOCK(::cs_main,\n-                                    return ProcessNewPackage(chainstate, tx_pool, {tx}, true));\n-        // If something went wrong due to a package-specific policy, it might not return a\n-        // validation result for the transaction.\n-        if (result_package.m_state.GetResult() != PackageValidationResult::PCKG_POLICY) {\n-            auto it = result_package.m_tx_results.find(tx->GetWitnessHash());\n-            Assert(it != result_package.m_tx_results.end());\n-            Assert(it->second.m_result_type == MempoolAcceptResult::ResultType::VALID ||\n-                   it->second.m_result_type == MempoolAcceptResult::ResultType::INVALID);\n+\n+        bool accepted{true};\n+        for (const auto& tx : package) {\n+            const bool submit_standalone{\n+                // A package must have at least 2 txs, so size-1 packages can only be submitted standalone\n+                package.size() == 1 ||\n+                fuzzed_data_provider.ConsumeBool()};\n+            if (submit_standalone) {\n+                const auto result_single{WITH_LOCK(::cs_main, return AcceptToMemoryPool(chainstate, tx, GetTime(), bypass_limits, /*test_accept=*/false))};\n+                const bool accepted_single{result_single.m_result_type == MempoolAcceptResult::ResultType::VALID};\n+                accepted &= accepted_single;\n+            }\n         }\n \n-        const auto res = WITH_LOCK(::cs_main, return AcceptToMemoryPool(chainstate, tx, GetTime(), bypass_limits, /*test_accept=*/false));\n-        const bool accepted = res.m_result_type == MempoolAcceptResult::ResultType::VALID;\n+        if (package.size() >= 2) {\n+            // Submit the remainder of the package.\n+            // For now, every package has only one tx , so this submits the whole\n+            // package again.\n+            const auto result_package{WITH_LOCK(::cs_main, return ProcessNewPackage(chainstate, tx_pool, package, /*test_accept=*/false))};\n+            accepted = result_package.m_state.IsValid();\n+            Assert(accepted != result_package.m_state.IsInvalid());\n+            // If something went wrong due to a package-specific policy, it might not return a\n+            // validation result for the transaction.\n+            if (result_package.m_state.GetResult() != PackageValidationResult::PCKG_POLICY) {\n+                for (const auto& tx_res : result_package.m_tx_results) {\n+                    Assert(tx_res.second.m_result_type == MempoolAcceptResult::ResultType::VALID ||\n+                           tx_res.second.m_result_type == MempoolAcceptResult::ResultType::INVALID);\n+                }\n+            }\n+            if (accepted) {\n+                Assert(result_package.m_tx_results.size() == package.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25778#discussion_r939467868",
      "id" : 939467868,
      "line" : 286,
      "node_id" : "PRRC_kwDOABII5843_yRc",
      "original_commit_id" : "6ca7fcf2247ed7067ebaf3ee8dc325d49142d666",
      "original_line" : 286,
      "original_position" : 180,
      "original_start_line" : null,
      "path" : "src/test/fuzz/tx_pool.cpp",
      "position" : 180,
      "pull_request_review_id" : 1064253935,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/939467868/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-06T04:09:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/939467868",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/24590067?v=4",
         "events_url" : "https://api.github.com/users/chinggg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/chinggg/followers",
         "following_url" : "https://api.github.com/users/chinggg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/chinggg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/chinggg",
         "id" : 24590067,
         "login" : "chinggg",
         "node_id" : "MDQ6VXNlcjI0NTkwMDY3",
         "organizations_url" : "https://api.github.com/users/chinggg/orgs",
         "received_events_url" : "https://api.github.com/users/chinggg/received_events",
         "repos_url" : "https://api.github.com/users/chinggg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/chinggg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/chinggg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/chinggg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25778#discussion_r939467929"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/939467929"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is solved in https://github.com/bitcoin/bitcoin/commit/6ca7fcf2247ed7067ebaf3ee8dc325d49142d666 by use a new copy of `outpoint_rbf` in the loop.",
      "commit_id" : "6ca7fcf2247ed7067ebaf3ee8dc325d49142d666",
      "created_at" : "2022-08-06T02:12:24Z",
      "diff_hunk" : "@@ -239,33 +251,52 @@ FUZZ_TARGET_INIT(tx_pool_standard, initialize_tx_pool)\n         RegisterSharedValidationInterface(txr);\n         const bool bypass_limits = fuzzed_data_provider.ConsumeBool();\n \n-        // Make sure ProcessNewPackage on one transaction works.\n-        // The result is not guaranteed to be the same as what is returned by ATMP.\n-        const auto result_package = WITH_LOCK(::cs_main,\n-                                    return ProcessNewPackage(chainstate, tx_pool, {tx}, true));\n-        // If something went wrong due to a package-specific policy, it might not return a\n-        // validation result for the transaction.\n-        if (result_package.m_state.GetResult() != PackageValidationResult::PCKG_POLICY) {\n-            auto it = result_package.m_tx_results.find(tx->GetWitnessHash());\n-            Assert(it != result_package.m_tx_results.end());\n-            Assert(it->second.m_result_type == MempoolAcceptResult::ResultType::VALID ||\n-                   it->second.m_result_type == MempoolAcceptResult::ResultType::INVALID);\n+\n+        bool accepted{true};\n+        for (const auto& tx : package) {\n+            const bool submit_standalone{\n+                // A package must have at least 2 txs, so size-1 packages can only be submitted standalone\n+                package.size() == 1 ||\n+                fuzzed_data_provider.ConsumeBool()};\n+            if (submit_standalone) {\n+                const auto result_single{WITH_LOCK(::cs_main, return AcceptToMemoryPool(chainstate, tx, GetTime(), bypass_limits, /*test_accept=*/false))};\n+                const bool accepted_single{result_single.m_result_type == MempoolAcceptResult::ResultType::VALID};\n+                accepted &= accepted_single;\n+            }\n         }\n \n-        const auto res = WITH_LOCK(::cs_main, return AcceptToMemoryPool(chainstate, tx, GetTime(), bypass_limits, /*test_accept=*/false));\n-        const bool accepted = res.m_result_type == MempoolAcceptResult::ResultType::VALID;\n+        if (package.size() >= 2) {\n+            // Submit the remainder of the package.\n+            // For now, every package has only one tx , so this submits the whole\n+            // package again.\n+            const auto result_package{WITH_LOCK(::cs_main, return ProcessNewPackage(chainstate, tx_pool, package, /*test_accept=*/false))};\n+            accepted = result_package.m_state.IsValid();\n+            Assert(accepted != result_package.m_state.IsInvalid());\n+            // If something went wrong due to a package-specific policy, it might not return a\n+            // validation result for the transaction.\n+            if (result_package.m_state.GetResult() != PackageValidationResult::PCKG_POLICY) {\n+                for (const auto& tx_res : result_package.m_tx_results) {\n+                    Assert(tx_res.second.m_result_type == MempoolAcceptResult::ResultType::VALID ||\n+                           tx_res.second.m_result_type == MempoolAcceptResult::ResultType::INVALID);\n+                }\n+            }\n+            if (accepted) {\n+                Assert(result_package.m_tx_results.size() == package.size());\n+                for (const auto& tx_res : result_package.m_tx_results) {\n+                    Assert(tx_res.second.m_result_type == MempoolAcceptResult::ResultType::VALID);\n+                }\n+            }\n+        }\n         SyncWithValidationInterfaceQueue();\n         UnregisterSharedValidationInterface(txr);\n-\n         Assert(accepted != added.empty());\n-        Assert(accepted == res.m_state.IsValid());\n-        Assert(accepted != res.m_state.IsInvalid());\n         if (accepted) {\n-            Assert(added.size() == 1); // For now, no package acceptance\n-            Assert(tx == *added.begin());\n+            Assert(Package(added.begin(), added.end()) == package);\n         } else {\n-            // Do not consider rejected transaction removed\n-            removed.erase(tx);\n+            // Do not consider rejected transactions removed\n+            for (const auto& tx : package) {\n+                removed.erase(tx);\n+            }\n         }\n \n         // Helper to insert spent and created outpoints of a tx into collections",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25778#discussion_r939467929",
      "id" : 939467929,
      "in_reply_to_id" : 938403815,
      "line" : 304,
      "node_id" : "PRRC_kwDOABII5843_ySZ",
      "original_commit_id" : "c157a6ca57cd4c1392ad82b85d4b1df0b7d23e11",
      "original_line" : 304,
      "original_position" : 194,
      "original_start_line" : null,
      "path" : "src/test/fuzz/tx_pool.cpp",
      "position" : 205,
      "pull_request_review_id" : 1064254021,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/939467929/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-06T02:12:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/939467929",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/24590067?v=4",
         "events_url" : "https://api.github.com/users/chinggg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/chinggg/followers",
         "following_url" : "https://api.github.com/users/chinggg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/chinggg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/chinggg",
         "id" : 24590067,
         "login" : "chinggg",
         "node_id" : "MDQ6VXNlcjI0NTkwMDY3",
         "organizations_url" : "https://api.github.com/users/chinggg/orgs",
         "received_events_url" : "https://api.github.com/users/chinggg/received_events",
         "repos_url" : "https://api.github.com/users/chinggg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/chinggg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/chinggg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/chinggg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25778#discussion_r939572574"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/939572574"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ok, that is probably my fault. I wrote the fuzz code without reading the validation code. I should read more about the interface and the meaning of valid/invalid in the context of packages. Apparently we can't deduce any meaningful information useful for fuzzing from the result. So for now I'd suggest to remove the failing Asserts.\r\n\r\nMoreover, the \"tracking\" code seems not prepared for packages. I think it can be fixed by tracking the history of added/removed transactions chronologically. (That is, switching the two std::set into one std::vector)\r\n\r\nSee this diff:\r\n\r\n```diff\r\ndiff --git a/src/test/fuzz/tx_pool.cpp b/src/test/fuzz/tx_pool.cpp\r\nindex c38e3420f6..b01b4f978a 100644\r\n--- a/src/test/fuzz/tx_pool.cpp\r\n+++ b/src/test/fuzz/tx_pool.cpp\r\n@@ -70,6 +70,24 @@ struct TransactionsDelta final : public CValidationInterface {\r\n     }\r\n };\r\n \r\n+struct TransactionsHistory final : public CValidationInterface {\r\n+    std::vector<std::tuple<bool, CTransactionRef>>& m_history;\r\n+\r\n+    explicit TransactionsHistory(std::vector<std::tuple<bool, CTransactionRef>>& h)\r\n+        : m_history{h} {}\r\n+\r\n+    void TransactionAddedToMempool(const CTransactionRef& tx, uint64_t /* mempool_sequence */) override\r\n+    {\r\n+        m_history.emplace_back(true, tx);\r\n+    }\r\n+\r\n+    void TransactionRemovedFromMempool(const CTransactionRef& tx, MemPoolRemovalReason reason, uint64_t /* mempool_sequence */) override\r\n+    {\r\n+        if (reason != MemPoolRemovalReason::SIZELIMIT)\r\n+            m_history.emplace_back(false, tx);\r\n+    }\r\n+};\r\n+\r\n void SetMempoolConstraints(ArgsManager& args, FuzzedDataProvider& fuzzed_data_provider)\r\n {\r\n     args.ForceSetArg(\"-limitancestorcount\",\r\n@@ -247,9 +265,8 @@ FUZZ_TARGET_INIT(tx_pool_standard, initialize_tx_pool)\r\n         }\r\n \r\n         // Remember all removed and added transactions\r\n-        std::set<CTransactionRef> removed;\r\n-        std::set<CTransactionRef> added;\r\n-        auto txr = std::make_shared<TransactionsDelta>(removed, added);\r\n+        std::vector<std::tuple<bool, CTransactionRef>> history;\r\n+        auto txr = std::make_shared<TransactionsHistory>(history);\r\n         RegisterSharedValidationInterface(txr);\r\n         const bool bypass_limits = fuzzed_data_provider.ConsumeBool();\r\n \r\n@@ -283,7 +300,6 @@ FUZZ_TARGET_INIT(tx_pool_standard, initialize_tx_pool)\r\n                 }\r\n             }\r\n             if (accepted) {\r\n-                Assert(result_package.m_tx_results.size() == package.size());\r\n                 for (const auto& tx_res : result_package.m_tx_results) {\r\n                     Assert(tx_res.second.m_result_type == MempoolAcceptResult::ResultType::VALID);\r\n                 }\r\n@@ -291,15 +307,6 @@ FUZZ_TARGET_INIT(tx_pool_standard, initialize_tx_pool)\r\n         }\r\n         SyncWithValidationInterfaceQueue();\r\n         UnregisterSharedValidationInterface(txr);\r\n-        Assert(accepted != added.empty());\r\n-        if (accepted) {\r\n-            Assert(Package(added.begin(), added.end()) == package);\r\n-        } else {\r\n-            // Do not consider rejected transactions removed\r\n-            for (const auto& tx : package) {\r\n-                removed.erase(tx);\r\n-            }\r\n-        }\r\n \r\n         // Helper to insert spent and created outpoints of a tx into collections\r\n         using Sets = std::vector<std::reference_wrapper<std::set<COutPoint>>>;\r\n@@ -317,16 +324,17 @@ FUZZ_TARGET_INIT(tx_pool_standard, initialize_tx_pool)\r\n         };\r\n         // Add created outpoints, remove spent outpoints\r\n         {\r\n+            for (const auto& [added,tx]:history){\r\n             // Outpoints that no longer exist at all\r\n             std::set<COutPoint> consumed_erased;\r\n             // Outpoints that no longer count toward the total supply\r\n             std::set<COutPoint> consumed_supply;\r\n-            for (const auto& removed_tx : removed) {\r\n-                insert_tx(/*created_by_tx=*/{consumed_erased}, /*consumed_by_tx=*/{outpoints_supply}, /*tx=*/*removed_tx);\r\n-            }\r\n-            for (const auto& added_tx : added) {\r\n-                insert_tx(/*created_by_tx=*/{outpoints_supply, outpoints_rbf}, /*consumed_by_tx=*/{consumed_supply}, /*tx=*/*added_tx);\r\n+            if (added) {\r\n+                insert_tx(/*created_by_tx=*/{outpoints_supply, outpoints_rbf}, /*consumed_by_tx=*/{consumed_supply}, /*tx=*/*tx);\r\n+            } else {\r\n+                insert_tx(/*created_by_tx=*/{consumed_erased}, /*consumed_by_tx=*/{outpoints_supply}, /*tx=*/*tx);\r\n             }\r\n+\r\n             for (const auto& p : consumed_erased) {\r\n                 Assert(outpoints_supply.erase(p) == 1);\r\n                 Assert(outpoints_rbf.erase(p) == 1);\r\n@@ -334,6 +342,7 @@ FUZZ_TARGET_INIT(tx_pool_standard, initialize_tx_pool)\r\n             for (const auto& p : consumed_supply) {\r\n                 Assert(outpoints_supply.erase(p) == 1);\r\n             }\r\n+            }\r\n         }\r\n     }\r\n     Finish(fuzzed_data_provider, tx_pool, chainstate);\r\n```\r\n\r\nHowever, now I am running into an assert in validation, which might be an actual bug :smiling_face_with_tear: ",
      "commit_id" : "6ca7fcf2247ed7067ebaf3ee8dc325d49142d666",
      "created_at" : "2022-08-06T20:29:39Z",
      "diff_hunk" : "@@ -239,33 +253,52 @@ FUZZ_TARGET_INIT(tx_pool_standard, initialize_tx_pool)\n         RegisterSharedValidationInterface(txr);\n         const bool bypass_limits = fuzzed_data_provider.ConsumeBool();\n \n-        // Make sure ProcessNewPackage on one transaction works.\n-        // The result is not guaranteed to be the same as what is returned by ATMP.\n-        const auto result_package = WITH_LOCK(::cs_main,\n-                                    return ProcessNewPackage(chainstate, tx_pool, {tx}, true));\n-        // If something went wrong due to a package-specific policy, it might not return a\n-        // validation result for the transaction.\n-        if (result_package.m_state.GetResult() != PackageValidationResult::PCKG_POLICY) {\n-            auto it = result_package.m_tx_results.find(tx->GetWitnessHash());\n-            Assert(it != result_package.m_tx_results.end());\n-            Assert(it->second.m_result_type == MempoolAcceptResult::ResultType::VALID ||\n-                   it->second.m_result_type == MempoolAcceptResult::ResultType::INVALID);\n+\n+        bool accepted{true};\n+        for (const auto& tx : package) {\n+            const bool submit_standalone{\n+                // A package must have at least 2 txs, so size-1 packages can only be submitted standalone\n+                package.size() == 1 ||\n+                fuzzed_data_provider.ConsumeBool()};\n+            if (submit_standalone) {\n+                const auto result_single{WITH_LOCK(::cs_main, return AcceptToMemoryPool(chainstate, tx, GetTime(), bypass_limits, /*test_accept=*/false))};\n+                const bool accepted_single{result_single.m_result_type == MempoolAcceptResult::ResultType::VALID};\n+                accepted &= accepted_single;\n+            }\n         }\n \n-        const auto res = WITH_LOCK(::cs_main, return AcceptToMemoryPool(chainstate, tx, GetTime(), bypass_limits, /*test_accept=*/false));\n-        const bool accepted = res.m_result_type == MempoolAcceptResult::ResultType::VALID;\n+        if (package.size() >= 2) {\n+            // Submit the remainder of the package.\n+            // For now, every package has only one tx , so this submits the whole\n+            // package again.\n+            const auto result_package{WITH_LOCK(::cs_main, return ProcessNewPackage(chainstate, tx_pool, package, /*test_accept=*/false))};\n+            accepted = result_package.m_state.IsValid();\n+            Assert(accepted != result_package.m_state.IsInvalid());\n+            // If something went wrong due to a package-specific policy, it might not return a\n+            // validation result for the transaction.\n+            if (result_package.m_state.GetResult() != PackageValidationResult::PCKG_POLICY) {\n+                for (const auto& tx_res : result_package.m_tx_results) {\n+                    Assert(tx_res.second.m_result_type == MempoolAcceptResult::ResultType::VALID ||\n+                           tx_res.second.m_result_type == MempoolAcceptResult::ResultType::INVALID);\n+                }\n+            }\n+            if (accepted) {\n+                Assert(result_package.m_tx_results.size() == package.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25778#discussion_r939572574",
      "id" : 939572574,
      "in_reply_to_id" : 939467868,
      "line" : 286,
      "node_id" : "PRRC_kwDOABII5844AL1e",
      "original_commit_id" : "6ca7fcf2247ed7067ebaf3ee8dc325d49142d666",
      "original_line" : 286,
      "original_position" : 180,
      "original_start_line" : null,
      "path" : "src/test/fuzz/tx_pool.cpp",
      "position" : 180,
      "pull_request_review_id" : 1064346914,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/939572574/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-06T20:29:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/939572574",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25778#discussion_r944214026"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/944214026"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Sorry for the late response, your diff is applied in https://github.com/bitcoin/bitcoin/commit/08e5172fbc5c4f5032c10dde95d463e33b644e2a, with some formatting changes by clangd. I will try to find the reason of crash in `validation.cpp:414: bool CheckInputsFromMempoolAndCache(const CTransaction &, TxValidationState &, const CCoinsViewCache &, const CTxMemPool &, unsigned int, PrecomputedTransactionData &, CCoinsViewCache &): Assertion !coinFromUTXOSet.IsSpent()' failed`. It happens after 3 continues on breakpoint `tx_pool.cpp:291`\r\n\r\n```\r\n#10 0x5634390f86ad in CheckInputsFromMempoolAndCache(CTransaction const&, TxValidationState&, CCoinsViewCache const&, CTxMemPool const&, unsigned int, PrecomputedTransactionData&, CCoinsViewCache&) src/./src/validation.cpp:414:13\r\n#11 0x5634390f4729 in (anonymous namespace)::MemPoolAccept::ConsensusScriptChecks((anonymous namespace)::MemPoolAccept::ATMPArgs const&, (anonymous namespace)::MemPoolAccept::Workspace&) src/./src/validation.cpp:1040:10\r\n#12 0x563439100255 in (anonymous namespace)::MemPoolAccept::SubmitPackage((anonymous namespace)::MemPoolAccept::ATMPArgs const&, std::vector<(anonymous namespace)::MemPoolAccept::Workspace, std::allocator<(anonymous namespace)::MemPoolAccept::Workspace> >&, PackageValidationState&, std::map<uint256 const, MempoolAcceptResult const, std::less<uint256 const>, std::allocator<std::pair<uint256 const, MempoolAcceptResult const> > >&) src/./src/validation.cpp:1112:14\r\n#13 0x5634390fc3ee in (anonymous namespace)::MemPoolAccept::AcceptMultipleTransactions(std::vector<std::shared_ptr<CTransaction const>, std::allocator<std::shared_ptr<CTransaction const> > > const&, (anonymous namespace)::MemPoolAccept::ATMPArgs&) src/./src/validation.cpp:1273:10\r\n#14 0x5634390fe435 in (anonymous namespace)::MemPoolAccept::AcceptPackage(std::vector<std::shared_ptr<CTransaction const>, std::allocator<std::shared_ptr<CTransaction const> > > const&, (anonymous namespace)::MemPoolAccept::ATMPArgs&) src/./src/validation.cpp:1404:30\r\n#15 0x5634390a201c in ProcessNewPackage(CChainState&, CTxMemPool&, std::vector<std::shared_ptr<CTransaction const>, std::allocator<std::shared_ptr<CTransaction const> > > const&, bool)::$_2::operator()() const src/./src/validation.cpp:1458:59\r\n#16 0x5634390a187f in ProcessNewPackage(CChainState&, CTxMemPool&, std::vector<std::shared_ptr<CTransaction const>, std::allocator<std::shared_ptr<CTransaction const> > > const&, bool) src/./src/validation.cpp:1451:25\r\n#17 0x5634385288a5 in (anonymous namespace)::tx_pool_standard_fuzz_target(Span<unsigned char const>)::$_7::operator()() const src/./src/test/fuzz/tx_pool.cpp:291:39\r\n```",
      "commit_id" : "08e5172fbc5c4f5032c10dde95d463e33b644e2a",
      "created_at" : "2022-08-12T08:04:04Z",
      "diff_hunk" : "@@ -239,33 +253,52 @@ FUZZ_TARGET_INIT(tx_pool_standard, initialize_tx_pool)\n         RegisterSharedValidationInterface(txr);\n         const bool bypass_limits = fuzzed_data_provider.ConsumeBool();\n \n-        // Make sure ProcessNewPackage on one transaction works.\n-        // The result is not guaranteed to be the same as what is returned by ATMP.\n-        const auto result_package = WITH_LOCK(::cs_main,\n-                                    return ProcessNewPackage(chainstate, tx_pool, {tx}, true));\n-        // If something went wrong due to a package-specific policy, it might not return a\n-        // validation result for the transaction.\n-        if (result_package.m_state.GetResult() != PackageValidationResult::PCKG_POLICY) {\n-            auto it = result_package.m_tx_results.find(tx->GetWitnessHash());\n-            Assert(it != result_package.m_tx_results.end());\n-            Assert(it->second.m_result_type == MempoolAcceptResult::ResultType::VALID ||\n-                   it->second.m_result_type == MempoolAcceptResult::ResultType::INVALID);\n+\n+        bool accepted{true};\n+        for (const auto& tx : package) {\n+            const bool submit_standalone{\n+                // A package must have at least 2 txs, so size-1 packages can only be submitted standalone\n+                package.size() == 1 ||\n+                fuzzed_data_provider.ConsumeBool()};\n+            if (submit_standalone) {\n+                const auto result_single{WITH_LOCK(::cs_main, return AcceptToMemoryPool(chainstate, tx, GetTime(), bypass_limits, /*test_accept=*/false))};\n+                const bool accepted_single{result_single.m_result_type == MempoolAcceptResult::ResultType::VALID};\n+                accepted &= accepted_single;\n+            }\n         }\n \n-        const auto res = WITH_LOCK(::cs_main, return AcceptToMemoryPool(chainstate, tx, GetTime(), bypass_limits, /*test_accept=*/false));\n-        const bool accepted = res.m_result_type == MempoolAcceptResult::ResultType::VALID;\n+        if (package.size() >= 2) {\n+            // Submit the remainder of the package.\n+            // For now, every package has only one tx , so this submits the whole\n+            // package again.\n+            const auto result_package{WITH_LOCK(::cs_main, return ProcessNewPackage(chainstate, tx_pool, package, /*test_accept=*/false))};\n+            accepted = result_package.m_state.IsValid();\n+            Assert(accepted != result_package.m_state.IsInvalid());\n+            // If something went wrong due to a package-specific policy, it might not return a\n+            // validation result for the transaction.\n+            if (result_package.m_state.GetResult() != PackageValidationResult::PCKG_POLICY) {\n+                for (const auto& tx_res : result_package.m_tx_results) {\n+                    Assert(tx_res.second.m_result_type == MempoolAcceptResult::ResultType::VALID ||\n+                           tx_res.second.m_result_type == MempoolAcceptResult::ResultType::INVALID);\n+                }\n+            }\n+            if (accepted) {\n+                Assert(result_package.m_tx_results.size() == package.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25778#discussion_r944214026",
      "id" : 944214026,
      "in_reply_to_id" : 939467868,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5844R5AK",
      "original_commit_id" : "6ca7fcf2247ed7067ebaf3ee8dc325d49142d666",
      "original_line" : 286,
      "original_position" : 180,
      "original_start_line" : null,
      "path" : "src/test/fuzz/tx_pool.cpp",
      "position" : null,
      "pull_request_review_id" : 1070734307,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/944214026/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-12T08:19:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/944214026",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/24590067?v=4",
         "events_url" : "https://api.github.com/users/chinggg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/chinggg/followers",
         "following_url" : "https://api.github.com/users/chinggg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/chinggg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/chinggg",
         "id" : 24590067,
         "login" : "chinggg",
         "node_id" : "MDQ6VXNlcjI0NTkwMDY3",
         "organizations_url" : "https://api.github.com/users/chinggg/orgs",
         "received_events_url" : "https://api.github.com/users/chinggg/received_events",
         "repos_url" : "https://api.github.com/users/chinggg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/chinggg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/chinggg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/chinggg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25778#discussion_r944286689"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25778"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/944286689"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The crash happens when one of the tx finally get passed into `CheckInputsFromMempoolAndCache`, it assume that the tx is either a UTXO from mempool or UTXO set. The assert fails because `coinFromUTXOSet` is actually `coinEmpty`.",
      "commit_id" : "08e5172fbc5c4f5032c10dde95d463e33b644e2a",
      "created_at" : "2022-08-12T09:31:58Z",
      "diff_hunk" : "@@ -239,33 +253,52 @@ FUZZ_TARGET_INIT(tx_pool_standard, initialize_tx_pool)\n         RegisterSharedValidationInterface(txr);\n         const bool bypass_limits = fuzzed_data_provider.ConsumeBool();\n \n-        // Make sure ProcessNewPackage on one transaction works.\n-        // The result is not guaranteed to be the same as what is returned by ATMP.\n-        const auto result_package = WITH_LOCK(::cs_main,\n-                                    return ProcessNewPackage(chainstate, tx_pool, {tx}, true));\n-        // If something went wrong due to a package-specific policy, it might not return a\n-        // validation result for the transaction.\n-        if (result_package.m_state.GetResult() != PackageValidationResult::PCKG_POLICY) {\n-            auto it = result_package.m_tx_results.find(tx->GetWitnessHash());\n-            Assert(it != result_package.m_tx_results.end());\n-            Assert(it->second.m_result_type == MempoolAcceptResult::ResultType::VALID ||\n-                   it->second.m_result_type == MempoolAcceptResult::ResultType::INVALID);\n+\n+        bool accepted{true};\n+        for (const auto& tx : package) {\n+            const bool submit_standalone{\n+                // A package must have at least 2 txs, so size-1 packages can only be submitted standalone\n+                package.size() == 1 ||\n+                fuzzed_data_provider.ConsumeBool()};\n+            if (submit_standalone) {\n+                const auto result_single{WITH_LOCK(::cs_main, return AcceptToMemoryPool(chainstate, tx, GetTime(), bypass_limits, /*test_accept=*/false))};\n+                const bool accepted_single{result_single.m_result_type == MempoolAcceptResult::ResultType::VALID};\n+                accepted &= accepted_single;\n+            }\n         }\n \n-        const auto res = WITH_LOCK(::cs_main, return AcceptToMemoryPool(chainstate, tx, GetTime(), bypass_limits, /*test_accept=*/false));\n-        const bool accepted = res.m_result_type == MempoolAcceptResult::ResultType::VALID;\n+        if (package.size() >= 2) {\n+            // Submit the remainder of the package.\n+            // For now, every package has only one tx , so this submits the whole\n+            // package again.\n+            const auto result_package{WITH_LOCK(::cs_main, return ProcessNewPackage(chainstate, tx_pool, package, /*test_accept=*/false))};\n+            accepted = result_package.m_state.IsValid();\n+            Assert(accepted != result_package.m_state.IsInvalid());\n+            // If something went wrong due to a package-specific policy, it might not return a\n+            // validation result for the transaction.\n+            if (result_package.m_state.GetResult() != PackageValidationResult::PCKG_POLICY) {\n+                for (const auto& tx_res : result_package.m_tx_results) {\n+                    Assert(tx_res.second.m_result_type == MempoolAcceptResult::ResultType::VALID ||\n+                           tx_res.second.m_result_type == MempoolAcceptResult::ResultType::INVALID);\n+                }\n+            }\n+            if (accepted) {\n+                Assert(result_package.m_tx_results.size() == package.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25778#discussion_r944286689",
      "id" : 944286689,
      "in_reply_to_id" : 939467868,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5844SKvh",
      "original_commit_id" : "6ca7fcf2247ed7067ebaf3ee8dc325d49142d666",
      "original_line" : 286,
      "original_position" : 180,
      "original_start_line" : null,
      "path" : "src/test/fuzz/tx_pool.cpp",
      "position" : null,
      "pull_request_review_id" : 1070835963,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25778",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/944286689/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-12T09:31:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/944286689",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/24590067?v=4",
         "events_url" : "https://api.github.com/users/chinggg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/chinggg/followers",
         "following_url" : "https://api.github.com/users/chinggg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/chinggg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/chinggg",
         "id" : 24590067,
         "login" : "chinggg",
         "node_id" : "MDQ6VXNlcjI0NTkwMDY3",
         "organizations_url" : "https://api.github.com/users/chinggg/orgs",
         "received_events_url" : "https://api.github.com/users/chinggg/received_events",
         "repos_url" : "https://api.github.com/users/chinggg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/chinggg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/chinggg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/chinggg"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [glozow](https://github.com/bitcoin/bitcoin/pull/25778#pullrequestreview-1061546017) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#26758](https://github.com/bitcoin/bitcoin/pull/26758) (clang-tidy: Add `performance-no-automatic-move` check by hebasto)\n* [#26642](https://github.com/bitcoin/bitcoin/pull/26642) (clang-tidy: Add more `performance-*` checks and related fixes by hebasto)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2022-09-23T10:02:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25778#issuecomment-1256019633",
      "id" : 1256019633,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25778",
      "node_id" : "IC_kwDOABII585K3Vax",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 1,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1256019633/reactions"
      },
      "updated_at" : "2022-12-28T07:43:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1256019633",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@chinggg are you planning on following up with the [build failures here](https://github.com/bitcoin/bitcoin/pull/25778/checks?check_run_id=7802283103)?\r\n```bash\r\n/usr/bin/ccache clang++ -ftrivial-auto-var-init=pattern -std=c++17 -DHAVE_CONFIG_H -I. -I../src/config  -DABORT_ON_FAILED_ASSUME -fmacro-prefix-map=/tmp/cirrus-ci-build/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu=. -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=2 -DHAVE_BUILD_INFO -I. -I./minisketch/include -I./secp256k1/include -I./univalue/include  -I./leveldb/include  -fdebug-prefix-map=/tmp/cirrus-ci-build/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu=. -Wstack-protector -fstack-protector-all -fcf-protection=full -fstack-clash-protection -Wall -Wextra -Wgnu -Wformat -Wformat-security -Wvla -Wshadow-field -Wthread-safety -Wrange-loop-analysis -Wredundant-decls -Wunused-member-function -Wdate-time -Wconditional-uninitialized -Woverloaded-virtual -Wsuggest-override -Wunreachable-code-loop-increment -Wimplicit-fallthrough -Wdocumentation -Wno-unused-parameter -Wno-self-assign -Werror  -fsanitize=fuzzer,address,undefined,integer   -fPIE -g -O2 -c -o test/fuzz/fuzz-tx_pool.o `test -f 'test/fuzz/tx_pool.cpp' || echo './'`test/fuzz/tx_pool.cpp\r\ntest/fuzz/tx_pool.cpp:59:14: error: unused member function 'TransactionsDelta' [-Werror,-Wunused-member-function]\r\n    explicit TransactionsDelta(std::set<CTransactionRef>& r, std::set<CTransactionRef>& a)\r\n             ^\r\n1 error generated.\r\nmake[2]: *** [Makefile:16988: test/fuzz/fuzz-tx_pool.o] Error 1\r\n```",
      "created_at" : "2022-12-05T11:53:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25778#issuecomment-1337204374",
      "id" : 1337204374,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25778",
      "node_id" : "IC_kwDOABII585PtB6W",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1337204374/reactions"
      },
      "updated_at" : "2022-12-05T11:53:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1337204374",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think the build failures can be fixed, but then there will be fuzz failures and I never got around to fully debug this, as the package stuff is still being worked on as we speak",
      "created_at" : "2022-12-05T12:01:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25778#issuecomment-1337217140",
      "id" : 1337217140,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25778",
      "node_id" : "IC_kwDOABII585PtFB0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1337217140/reactions"
      },
      "updated_at" : "2022-12-05T12:01:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1337217140",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@fanquake Sorry for the late reply. I just built this code with `./configure --enable-debug --enable-fuzz --with-gui=no` and my compiler (clang++ 15) recognized this `unused member function 'TransactionsDelta'` as a warning instead of an error. \r\nFor the completion of this PR, we might wait for the progress of the new package relay feature. The original BIP PR https://github.com/bitcoin/bips/pull/1324 has been closed and it seems \"the updated proposal is going to be significantly different\"",
      "created_at" : "2022-12-06T07:33:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25778#issuecomment-1338905283",
      "id" : 1338905283,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25778",
      "node_id" : "IC_kwDOABII585PzhLD",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1338905283/reactions"
      },
      "updated_at" : "2022-12-06T07:33:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1338905283",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/24590067?v=4",
         "events_url" : "https://api.github.com/users/chinggg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/chinggg/followers",
         "following_url" : "https://api.github.com/users/chinggg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/chinggg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/chinggg",
         "id" : 24590067,
         "login" : "chinggg",
         "node_id" : "MDQ6VXNlcjI0NTkwMDY3",
         "organizations_url" : "https://api.github.com/users/chinggg/orgs",
         "received_events_url" : "https://api.github.com/users/chinggg/received_events",
         "repos_url" : "https://api.github.com/users/chinggg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/chinggg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/chinggg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/chinggg"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Ok. Should we close this for now then, and reopen when we actually know what we have to fuzz?",
      "created_at" : "2022-12-06T09:14:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25778#issuecomment-1339008563",
      "id" : 1339008563,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25778",
      "node_id" : "IC_kwDOABII585Pz6Yz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1339008563/reactions"
      },
      "updated_at" : "2022-12-06T09:14:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1339008563",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-01-11T16:02:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25778#issuecomment-1379029685",
      "id" : 1379029685,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25778",
      "node_id" : "IC_kwDOABII585SMlK1",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1379029685/reactions"
      },
      "updated_at" : "2023-01-11T16:02:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1379029685",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--13523179cfe9479db18ec6c5d236f789-->\nThere hasn't been much activity lately and the patch still needs rebase. What is the status here?\n\n* Is it still relevant? â¡ï¸ Please solve the conflicts to make it ready for review and to ensure the CI passes.\n* Is it no longer relevant? â¡ï¸ Please close.\n* Did the author lose interest or time to work on this? â¡ï¸ Please close it and mark it 'Up for grabs' with the label, so that it can be picked up in the future.\n",
      "created_at" : "2023-04-11T01:27:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25778#issuecomment-1502555335",
      "id" : 1502555335,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25778",
      "node_id" : "IC_kwDOABII585ZjyzH",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1502555335/reactions"
      },
      "updated_at" : "2023-04-11T01:27:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1502555335",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   }
]
