[
   {
      "author_association" : "MEMBER",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [1440000bytes](https://github.com/bitcoin/bitcoin/pull/25766#issuecomment-1201968867), [benthecarman](https://github.com/bitcoin/bitcoin/pull/25766#issuecomment-1201998688), [theStack](https://github.com/bitcoin/bitcoin/pull/25766#issuecomment-1207406215) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#27286](https://github.com/bitcoin/bitcoin/pull/27286) (wallet: Keep track of the wallet's own transaction outputs in memory by achow101)\n* [#26728](https://github.com/bitcoin/bitcoin/pull/26728) (wallet: Have the wallet store the key for automatically generated descriptors by achow101)\n* [#26596](https://github.com/bitcoin/bitcoin/pull/26596) (wallet: Migrate legacy wallets to descriptor wallets without requiring BDB by achow101)\n* [#25907](https://github.com/bitcoin/bitcoin/pull/25907) (wallet: rpc to add automatically generated descriptors by achow101)\n* [#25297](https://github.com/bitcoin/bitcoin/pull/25297) (wallet: group independent db writes on single batched db transaction by furszy)\n* [#24914](https://github.com/bitcoin/bitcoin/pull/24914) (wallet: Load database records in a particular order by achow101)\n* [#22341](https://github.com/bitcoin/bitcoin/pull/22341) (rpc: add getxpub by Sjors)\n* [#20892](https://github.com/bitcoin/bitcoin/pull/20892) (tests: Run both descriptor and legacy tests within a single test invocation by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2022-08-02T03:01:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25766#issuecomment-1201960247",
      "id" : 1201960247,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25766",
      "node_id" : "IC_kwDOABII585HpHU3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1201960247/reactions"
      },
      "updated_at" : "2023-04-21T06:00:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1201960247",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Concept ACK ",
      "created_at" : "2022-08-02T03:18:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25766#issuecomment-1201968867",
      "id" : 1201968867,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25766",
      "node_id" : "IC_kwDOABII585HpJbj",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1201968867/reactions"
      },
      "updated_at" : "2022-08-02T03:18:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1201968867",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10137?v=4",
         "events_url" : "https://api.github.com/users/ghost/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ghost/followers",
         "following_url" : "https://api.github.com/users/ghost/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ghost/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ghost",
         "id" : 10137,
         "login" : "ghost",
         "node_id" : "MDQ6VXNlcjEwMTM3",
         "organizations_url" : "https://api.github.com/users/ghost/orgs",
         "received_events_url" : "https://api.github.com/users/ghost/received_events",
         "repos_url" : "https://api.github.com/users/ghost/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ghost/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ghost/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ghost"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "\r\nConcept ACK\r\n\r\n",
      "created_at" : "2022-08-02T04:19:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25766#issuecomment-1201998688",
      "id" : 1201998688,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25766",
      "node_id" : "IC_kwDOABII585HpQtg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1201998688/reactions"
      },
      "updated_at" : "2022-08-02T04:19:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1201998688",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2022-08-07T13:13:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25766#issuecomment-1207406215",
      "id" : 1207406215,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25766",
      "node_id" : "IC_kwDOABII585H946H",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1207406215/reactions"
      },
      "updated_at" : "2022-08-07T13:13:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1207406215",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25766#discussion_r939681799"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/939681799"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If the deserialized signature doesn't have a size of 64 bytes, it would lead to a crash as the following assertion in `XOnlyPubKey::VerifySchnorr` will fail,\r\nhttps://github.com/bitcoin/bitcoin/blob/b1a2021f78099c17360dc2179cbcb948059b5969/src/pubkey.cpp#L208\r\ni.e. a signature size check before verifying should be added. As the same is needed below for `WALLETDESCRIPTORCKEY`, probably it would make sense to put the verification (including signature size check) into a helper function to deduplicate?",
      "commit_id" : "e6b2c43676690f67f15ec7b1e3016f0e79942fa8",
      "created_at" : "2022-08-07T15:04:51Z",
      "diff_hunk" : "@@ -480,10 +502,24 @@ ReadKeyValue(CWallet* pwallet, CDataStream& ssKey, CDataStream& ssValue,\n             if (!ssValue.eof()) {\n                 uint256 checksum;\n                 ssValue >> checksum;\n-                if ((checksum_valid = Hash(vchPrivKey) != checksum)) {\n+                if (Hash(vchPrivKey) != checksum) {\n                     strErr = \"Error reading wallet database: Encrypted key corrupt\";\n                     return false;\n                 }\n+\n+                // Get the signature and check it\n+                if (!ssValue.eof()) {\n+                    std::vector<unsigned char> sig;\n+                    ssValue >> sig;\n+                    // Our checksum is already the hash of the entire private key\n+                    // so we can just use it as our message\n+                    XOnlyPubKey xonly{vchPubKey};\n+                    if (!xonly.VerifySchnorr(checksum, sig)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25766#discussion_r939681799",
      "id" : 939681799,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5844AmgH",
      "original_commit_id" : "7cd6ff563649aba615ec6a24af5c4e5b22ac2292",
      "original_line" : 526,
      "original_position" : 81,
      "original_start_line" : 512,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 1064436269,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25766",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/939681799/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2022-08-07T15:15:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/939681799",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25766#discussion_r939682425"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/939682425"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Wondering if this change would better fit into the later commit 20451e785f6478b5daf3b06bb2f638bc3662cf9f (_\"wallet: Write encrypted key sig if it is not present\"_), where the same is (only) done for `DescriptorScriptPubKeyMan`?",
      "commit_id" : "e6b2c43676690f67f15ec7b1e3016f0e79942fa8",
      "created_at" : "2022-08-07T15:09:31Z",
      "diff_hunk" : "@@ -246,8 +246,14 @@ bool LegacyScriptPubKeyMan::CheckDecryptionKey(const CKeyingMaterial& master_key\n             if (fDecryptionThoroughlyChecked)\n                 break;\n             else {\n-                // Rewrite these encrypted keys with checksums\n-                batch.WriteCryptedKey(vchPubKey, vchCryptedSecret, mapKeyMetadata[vchPubKey.GetID()]);\n+                // Rewrite these encrypted keys with checksums and signatures\n+                uint256 enckey_hash = Hash(vchCryptedSecret);\n+                std::vector<unsigned char> sig(64);\n+                if (!key.SignSchnorr(enckey_hash, sig, nullptr, uint256())) {\n+                    keyFail = true;\n+                    break;\n+                }\n+                batch.WriteCryptedKey(vchPubKey, vchCryptedSecret, mapKeyMetadata[vchPubKey.GetID()], sig);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25766#discussion_r939682425",
      "id" : 939682425,
      "line" : 259,
      "node_id" : "PRRC_kwDOABII5844Amp5",
      "original_commit_id" : "7cd6ff563649aba615ec6a24af5c4e5b22ac2292",
      "original_line" : 259,
      "original_position" : 13,
      "original_start_line" : 249,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 13,
      "pull_request_review_id" : 1064436269,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25766",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/939682425/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 252,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2022-08-07T15:15:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/939682425",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I suspect this might actually make the problem worse. With this, a degree of trust in wallets having valid encrypted keys could develop, and it doesn't actually prevent the scam (the scammer just needs access to sufficient funds which remain not at risk).",
      "created_at" : "2022-08-10T00:34:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25766#issuecomment-1210022625",
      "id" : 1210022625,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25766",
      "node_id" : "IC_kwDOABII585IH3rh",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1210022625/reactions"
      },
      "updated_at" : "2022-08-10T00:34:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1210022625",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25766#discussion_r1086029546"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1086029546"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added that as well deduplicated.",
      "commit_id" : "e6b2c43676690f67f15ec7b1e3016f0e79942fa8",
      "created_at" : "2023-01-24T23:00:37Z",
      "diff_hunk" : "@@ -480,10 +502,24 @@ ReadKeyValue(CWallet* pwallet, CDataStream& ssKey, CDataStream& ssValue,\n             if (!ssValue.eof()) {\n                 uint256 checksum;\n                 ssValue >> checksum;\n-                if ((checksum_valid = Hash(vchPrivKey) != checksum)) {\n+                if (Hash(vchPrivKey) != checksum) {\n                     strErr = \"Error reading wallet database: Encrypted key corrupt\";\n                     return false;\n                 }\n+\n+                // Get the signature and check it\n+                if (!ssValue.eof()) {\n+                    std::vector<unsigned char> sig;\n+                    ssValue >> sig;\n+                    // Our checksum is already the hash of the entire private key\n+                    // so we can just use it as our message\n+                    XOnlyPubKey xonly{vchPubKey};\n+                    if (!xonly.VerifySchnorr(checksum, sig)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25766#discussion_r1086029546",
      "id" : 1086029546,
      "in_reply_to_id" : 939681799,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Au37q",
      "original_commit_id" : "7cd6ff563649aba615ec6a24af5c4e5b22ac2292",
      "original_line" : 526,
      "original_position" : 81,
      "original_start_line" : 512,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 1268457499,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25766",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1086029546/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-01-24T23:00:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1086029546",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25766#discussion_r1086030018"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25766"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1086030018"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No, it cannot be moved to later since `WriteCryptedKey` also changes in this commit. The later commit is for DescriptorSPKM only because it doesn't already have an existing upgrading mechanism that needed changes.",
      "commit_id" : "e6b2c43676690f67f15ec7b1e3016f0e79942fa8",
      "created_at" : "2023-01-24T23:01:23Z",
      "diff_hunk" : "@@ -246,8 +246,14 @@ bool LegacyScriptPubKeyMan::CheckDecryptionKey(const CKeyingMaterial& master_key\n             if (fDecryptionThoroughlyChecked)\n                 break;\n             else {\n-                // Rewrite these encrypted keys with checksums\n-                batch.WriteCryptedKey(vchPubKey, vchCryptedSecret, mapKeyMetadata[vchPubKey.GetID()]);\n+                // Rewrite these encrypted keys with checksums and signatures\n+                uint256 enckey_hash = Hash(vchCryptedSecret);\n+                std::vector<unsigned char> sig(64);\n+                if (!key.SignSchnorr(enckey_hash, sig, nullptr, uint256())) {\n+                    keyFail = true;\n+                    break;\n+                }\n+                batch.WriteCryptedKey(vchPubKey, vchCryptedSecret, mapKeyMetadata[vchPubKey.GetID()], sig);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25766#discussion_r1086030018",
      "id" : 1086030018,
      "in_reply_to_id" : 939682425,
      "line" : 259,
      "node_id" : "PRRC_kwDOABII585Au4DC",
      "original_commit_id" : "7cd6ff563649aba615ec6a24af5c4e5b22ac2292",
      "original_line" : 259,
      "original_position" : 13,
      "original_start_line" : 249,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 13,
      "pull_request_review_id" : 1268458119,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25766",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1086030018/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 252,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2023-01-24T23:01:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1086030018",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
