[
   {
      "author_association" : "MEMBER",
      "body" : "TODO: Add tests (Currently left out to avoid excessive merge conflicts with other pull requests touching the miner tests)",
      "created_at" : "2018-06-07T18:56:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13415#issuecomment-395528288",
      "id" : 395528288,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13415",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5NTUyODI4OA==",
      "updated_at" : "2018-06-07T18:56:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/395528288",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->Note to reviewers: This pull request conflicts with the following ones:\n\n* #13945 (Refactoring CRPCCommand with enum category by isghe)\n* #13864 (validation: Document where we are intentionally ignoring bool return values from validation related functions by practicalswift)\n* #13083 (Add compile time checking for cs_main runtime locking assertions by practicalswift)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2018-06-07T19:31:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13415#issuecomment-395538186",
      "id" : 395538186,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13415",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5NTUzODE4Ng==",
      "updated_at" : "2018-08-12T02:22:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/395538186",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13415#discussion_r193891047"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/193891047"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is this inverted?",
      "commit_id" : "28057de21a51d2162c46f3dee9bd16348c6bc484",
      "created_at" : "2018-06-07T21:14:27Z",
      "diff_hunk" : "@@ -258,6 +258,50 @@ static UniValue prioritisetransaction(const JSONRPCRequest& request)\n     return true;\n }\n \n+static UniValue testblocktemplatevalidity(const JSONRPCRequest& request)\n+{\n+    if (request.fHelp || request.params.size() != 1) {\n+        throw std::runtime_error(\n+            \"testblocktemplatevalidity <hexdata>\\n\"\n+            \"Decode the given hexdata as a block and return if it is a valid template to work on.\\n\"\n+            \"It des not check if the block has sufficient work.\\n\"\n+            \"The block must be built on top of the current tip.\\n\"\n+            \"\\nArguments:\\n\"\n+            \"1. \\\"hexdata\\\"      (string, required) The hex encoded block data.\\n\"\n+            \"\\nResult:\\n\"\n+            \" {\\n\"\n+            \"  \\\"block_hash\\\"     (string) The block hash in hex\\n\"\n+            \"  \\\"valid_template\\\" (boolean) If the block template is valid to work on\\n\"\n+            \"  \\\"invalid_msg\\\"    (string) Rejection string (only present when 'valid_template' is false)\\n\"\n+            \" }\\n\"\n+            \"\\nExamples:\\n\" +\n+            HelpExampleCli(\"testblocktemplatevalidity\", \"\\\"aabbcc\\\"\") +\n+            HelpExampleRpc(\"testblocktemplatevalidity\", \"\\\"aabbcc\\\"\"));\n+    }\n+\n+    CBlock block;\n+    if (!DecodeHexBlk(block, request.params[0].get_str())) {\n+        throw JSONRPCError(RPC_DESERIALIZATION_ERROR, \"Block decode failed\");\n+    }\n+\n+    LOCK(cs_main);\n+    CBlockIndex* const tip = ::chainActive.Tip();\n+\n+    // TestBlockValidity only supports blocks built on the current Tip\n+    if (block.hashPrevBlock != tip->GetBlockHash()) {\n+        throw JSONRPCError(RPC_VERIFY_ERROR, \"Must submit block that is built on the current tip (\" + tip->GetBlockHash().GetHex() + \")\");\n+    }\n+\n+    UniValue result(UniValue::VOBJ);\n+    result.pushKV(\"block_hash\", block.GetHash().GetHex());\n+    CValidationState state;\n+    bool valid_template = TestBlockValidity(state, Params(), block, /* pindexPrev */ tip, /* fCheckPOW */ false, /* fCheckMerkleRoot */ true);\n+    result.pushKV(\"valid_template\", valid_template);\n+    if (valid_template) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13415#discussion_r193891047",
      "id" : 193891047,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5Mzg5MTA0Nw==",
      "original_commit_id" : "fa040362cb3aa6c10a9dfde43258eec9563e3a83",
      "original_position" : 43,
      "path" : "src/rpc/mining.cpp",
      "position" : null,
      "pull_request_review_id" : 126959287,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13415",
      "updated_at" : "2018-08-15T19:44:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/193891047",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This is already supported via BIP 23 Block Proposals: https://github.com/bitcoin/bips/blob/master/bip-0023.mediawiki#Block_Proposal",
      "created_at" : "2018-06-07T21:18:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13415#issuecomment-395568443",
      "id" : 395568443,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13415",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5NTU2ODQ0Mw==",
      "updated_at" : "2018-06-07T21:18:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/395568443",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Right, looks like this is already implemented\r\nhttps://github.com/bitcoin/bitcoin/blob/56f69360dc98bd68704f19646a84d045788d199e/src/rpc/mining.cpp#L389-L416",
      "created_at" : "2018-06-10T11:29:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13415#issuecomment-396041837",
      "id" : 396041837,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13415",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5NjA0MTgzNw==",
      "updated_at" : "2018-06-10T11:29:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/396041837",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   }
]
