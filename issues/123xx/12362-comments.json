[
   {
      "author_association" : "MEMBER",
      "body" : "I've narrowed this down to commit 3448907a68e0f719be3bf82f4d321a30975d3539 (behaviour not seen in 7936446268e2f63baa855d694df0243924b7e1a9).",
      "created_at" : "2018-02-06T14:33:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/12362#issuecomment-363439994",
      "id" : 363439994,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12362",
      "updated_at" : "2018-02-06T14:33:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/363439994",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "It may be worth using addr2line to decode the backtrace, e.g. https://github.com/bitcoin/bitcoin/issues/9683#issuecomment-325012435",
      "created_at" : "2018-02-06T15:17:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/12362#issuecomment-363453929",
      "id" : 363453929,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12362",
      "updated_at" : "2018-02-06T15:17:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/363453929",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "If I drop commit https://github.com/bitcoin/bitcoin/commit/3448907a68e0f719be3bf82f4d321a30975d3539 I no longer see this error.\r\n\r\n`addr2line` shows:\r\n\r\n```\r\nÃ¢ÂÂ addr2line -f -e ../../src/bitcoind 0x773e9 0x2b9247 0x2afbf6 0x68c5c 0x3f3fb 0x3234f 0x3e019\r\n_ZN9__gnu_cxx13new_allocatorIN5boost10filesystem4pathEE8allocateEmPKv\r\n/usr/include/c++/5/ext/new_allocator.h:104\r\n_ZNSt6vectorINSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEESaIS5_EE9push_backEOS5_\r\n/usr/include/c++/5/bits/stl_vector.h:932\r\n_ZNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEaSEOS4_\r\n/usr/include/c++/5/bits/basic_string.h:589\r\n_Z8Shutdownv\r\n/home/ubuntu/bitcoin/src/init.cpp:278 (discriminator 4)\r\n_Z7AppInitiPPc\r\n/home/ubuntu/bitcoin/src/bitcoind.cpp:176\r\nmain\r\n/home/ubuntu/bitcoin/src/bitcoind.cpp:186\r\n_start\r\n??:?\r\n```",
      "created_at" : "2018-02-06T16:10:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/12362#issuecomment-363472547",
      "id" : 363472547,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12362",
      "updated_at" : "2018-02-06T16:10:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/363472547",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "> /home/ubuntu/bitcoin/src/init.cpp:278 (discriminator 4)\r\n\r\nI don't get it - is this the `LogPrintf(\"%s: done\\n\", __func__);` line?!",
      "created_at" : "2018-02-06T16:26:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/12362#issuecomment-363478818",
      "id" : 363478818,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12362",
      "updated_at" : "2018-02-06T16:27:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/363478818",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Its memory corruption, that just is where libc is finding out about the corruption, not where its happening.",
      "created_at" : "2018-02-06T16:28:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/12362#issuecomment-363479351",
      "id" : 363479351,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12362",
      "updated_at" : "2018-02-06T16:28:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/363479351",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've added print calls to the test case to narrow down where this is happening. So far I've observed it happening on the following lines:\r\n\r\n- `self.assert_start_raises_init_error(0, ['-wallet=w11'], 'Error loading wallet w11. -wallet filename must be a regular file.')`\r\n- `self.assert_start_raises_init_error(0, ['-walletdir=wallets'], 'Error: Specified -walletdir \"wallets\" is a relative path', cwd=data_dir())`\r\n- `self.assert_start_raises_init_error(0, ['-walletdir=' + not_a_dir], 'Error: Specified -walletdir \"' + not_a_dir + '\" is not a directory')`\r\n- `self.assert_start_raises_init_error(0, ['-wallet=w1', '-wallet=w1'], 'Error loading wallet w1. Duplicate -wallet filename specified.')`\r\n\r\nIt seems like many (all?) of the failures in `VerifyWallets()` can trigger this",
      "created_at" : "2018-02-06T16:40:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/12362#issuecomment-363483460",
      "id" : 363483460,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12362",
      "updated_at" : "2018-02-06T16:40:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/363483460",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "Hm, so (from those) it looks like a shutdown race in case of early termination due to a wallet parameter related error.",
      "created_at" : "2018-02-06T16:48:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/12362#issuecomment-363486802",
      "id" : 363486802,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12362",
      "updated_at" : "2018-02-06T16:48:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/363486802",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@TheBlueMatt has provided the following patch. I don't hit the error when I run with it:\r\n\r\n```\r\ndiff --git a/src/httpserver.cpp b/src/httpserver.cpp\r\nindex a022d220e..3faafad1e 100644\r\n--- a/src/httpserver.cpp\r\n+++ b/src/httpserver.cpp\r\n@@ -306,11 +306,13 @@ static void http_reject_request_cb(struct evhttp_request* req, void*)\r\n     evhttp_send_error(req, HTTP_SERVUNAVAIL, nullptr);\r\n }\r\n \r\n+std::atomic<int> threads_running(0);\r\n /** Event dispatcher thread */\r\n static bool ThreadHTTP(struct event_base* base, struct evhttp* http)\r\n {\r\n     RenameThread(\"bitcoin-http\");\r\n     LogPrint(BCLog::HTTP, \"Entering http event loop\\n\");\r\n+    threads_running++;\r\n     event_base_dispatch(base);\r\n     // Event loop will be interrupted by InterruptHTTPServer()\r\n     LogPrint(BCLog::HTTP, \"Exited http event loop\\n\");\r\n@@ -358,6 +360,7 @@ static bool HTTPBindAddresses(struct evhttp* http)\r\n /** Simple wrapper to set thread name and run work queue */\r\n static void HTTPWorkQueueRun(WorkQueue<HTTPClosure>* queue)\r\n {\r\n+    threads_running++;\r\n     RenameThread(\"bitcoin-httpworker\");\r\n     queue->Run();\r\n }\r\n@@ -468,6 +471,8 @@ bool StartHTTPServer()\r\n \r\n void InterruptHTTPServer()\r\n {\r\n+    int rpcThreads = std::max((long)gArgs.GetArg(\"-rpcthreads\", DEFAULT_HTTP_THREADS), 1L);\r\n+    while (threads_running != rpcThreads + 1) continue;\r\n     LogPrint(BCLog::HTTP, \"Interrupting HTTP server\\n\");\r\n     if (eventHTTP) {\r\n         // Unlisten sockets\r\n```",
      "created_at" : "2018-02-06T17:41:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/12362#issuecomment-363503855",
      "id" : 363503855,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12362",
      "updated_at" : "2018-02-06T17:41:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/363503855",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   }
]
