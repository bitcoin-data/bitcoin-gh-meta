[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r152377332"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152377332"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"[tests] Remove rpc property from TestNode in p2p-segwit.py\"\r\n\r\nDid you mean to s/node.p2p/p2p/ here and below?",
      "commit_id" : "e9dfa9bccc5cbb6096c60498651b451297f0a931",
      "created_at" : "2017-11-21T19:25:53Z",
      "diff_hunk" : "@@ -31,11 +31,38 @@ def get_virtual_size(witness_block):\n     vsize = int((3*base_size + total_size + 3)/4)\n     return vsize\n \n+def test_transaction_acceptance(node, p2p, tx, with_witness, accepted, reason=None):\n+    \"\"\"Send a transaction to the node and check that it's accepted to the mempool\n+\n+    - Submit the transaction over the p2p interface\n+    - use the getrawmempool rpc to check for acceptance.\"\"\"\n+    tx_message = msg_tx(tx)\n+    if with_witness:\n+        tx_message = msg_witness_tx(tx)\n+    p2p.send_message(tx_message)\n+    p2p.sync_with_ping()\n+    assert_equal(tx.hash in node.getrawmempool(), accepted)\n+    if (reason != None and not accepted):\n+        # Check the rejection reason as well.\n+        with mininode_lock:\n+            assert_equal(p2p.last_message[\"reject\"].reason, reason)\n+\n+def test_witness_block(node, p2p, block, accepted, with_witness=True):\n+    \"\"\"Send a block to the node and check that it's accepted\n+\n+    - Submit the block over the p2p interface\n+    - use the getbestblockhash rpc to check for acceptance.\"\"\"\n+    if with_witness:\n+        node.p2p.send_message(msg_witness_block(block))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r152377332",
      "id" : 152377332,
      "original_commit_id" : "ff3b19c608b465dd4af8a13280f92e5a91dd6b78",
      "original_position" : 26,
      "path" : "test/functional/p2p-segwit.py",
      "position" : null,
      "pull_request_review_id" : 78230563,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712",
      "updated_at" : "2017-11-28T17:47:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152377332",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r152378395"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152378395"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"[tests] Remove rpc property from TestNode in p2p-segwit.py\"\r\n\r\nDo you want to s/node.rpc/node/ here for consistency with test_transaction_acceptance? Another alternative which would also be nice would be to pass these functions just rpc objects instead of nodes.\r\n",
      "commit_id" : "e9dfa9bccc5cbb6096c60498651b451297f0a931",
      "created_at" : "2017-11-21T19:30:04Z",
      "diff_hunk" : "@@ -31,11 +31,38 @@ def get_virtual_size(witness_block):\n     vsize = int((3*base_size + total_size + 3)/4)\n     return vsize\n \n+def test_transaction_acceptance(node, p2p, tx, with_witness, accepted, reason=None):\n+    \"\"\"Send a transaction to the node and check that it's accepted to the mempool\n+\n+    - Submit the transaction over the p2p interface\n+    - use the getrawmempool rpc to check for acceptance.\"\"\"\n+    tx_message = msg_tx(tx)\n+    if with_witness:\n+        tx_message = msg_witness_tx(tx)\n+    p2p.send_message(tx_message)\n+    p2p.sync_with_ping()\n+    assert_equal(tx.hash in node.getrawmempool(), accepted)\n+    if (reason != None and not accepted):\n+        # Check the rejection reason as well.\n+        with mininode_lock:\n+            assert_equal(p2p.last_message[\"reject\"].reason, reason)\n+\n+def test_witness_block(node, p2p, block, accepted, with_witness=True):\n+    \"\"\"Send a block to the node and check that it's accepted\n+\n+    - Submit the block over the p2p interface\n+    - use the getbestblockhash rpc to check for acceptance.\"\"\"\n+    if with_witness:\n+        node.p2p.send_message(msg_witness_block(block))\n+    else:\n+        node.p2p.send_message(msg_block(block))\n+    p2p.sync_with_ping()\n+    assert_equal(node.rpc.getbestblockhash() == block.hash, accepted)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r152378395",
      "id" : 152378395,
      "original_commit_id" : "ff3b19c608b465dd4af8a13280f92e5a91dd6b78",
      "original_position" : 30,
      "path" : "test/functional/p2p-segwit.py",
      "position" : null,
      "pull_request_review_id" : 78230563,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712",
      "updated_at" : "2017-11-28T17:47:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152378395",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r152379930"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152379930"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "[tests] Remove rpc property from TestNode in p2p-segwit.py\r\n\r\nNot a comment on this PR but this whole test file is very repetitive. With a few lambdas / local helper functions it could probably be made a lot shorter and more readable.",
      "commit_id" : "e9dfa9bccc5cbb6096c60498651b451297f0a931",
      "created_at" : "2017-11-21T19:36:12Z",
      "diff_hunk" : "@@ -1818,45 +1824,45 @@ def test_non_standard_witness(self):\n         # Testing native P2WSH\n         # Witness stack size, excluding witnessScript, over 100 is non-standard\n         p2wsh_txs[0].wit.vtxinwit[0].scriptWitness.stack = [pad] * 101 + [scripts[0]]\n-        self.std_node.test_transaction_acceptance(p2wsh_txs[0], True, False, b'bad-witness-nonstandard')\n+        test_transaction_acceptance(self.nodes[1], self.std_node, p2wsh_txs[0], True, False, b'bad-witness-nonstandard')\n         # Non-standard nodes should accept\n-        self.test_node.test_transaction_acceptance(p2wsh_txs[0], True, True)\n+        test_transaction_acceptance(self.nodes[0], self.test_node, p2wsh_txs[0], True, True)\n \n         # Stack element size over 80 bytes is non-standard\n         p2wsh_txs[1].wit.vtxinwit[0].scriptWitness.stack = [pad * 81] * 100 + [scripts[1]]\n-        self.std_node.test_transaction_acceptance(p2wsh_txs[1], True, False, b'bad-witness-nonstandard')\n+        test_transaction_acceptance(self.nodes[1], self.std_node, p2wsh_txs[1], True, False, b'bad-witness-nonstandard')\n         # Non-standard nodes should accept\n-        self.test_node.test_transaction_acceptance(p2wsh_txs[1], True, True)\n+        test_transaction_acceptance(self.nodes[0], self.test_node, p2wsh_txs[1], True, True)\n         # Standard nodes should accept if element size is not over 80 bytes\n         p2wsh_txs[1].wit.vtxinwit[0].scriptWitness.stack = [pad * 80] * 100 + [scripts[1]]\n-        self.std_node.test_transaction_acceptance(p2wsh_txs[1], True, True)\n+        test_transaction_acceptance(self.nodes[1], self.std_node, p2wsh_txs[1], True, True)\n \n         # witnessScript size at 3600 bytes is standard\n         p2wsh_txs[2].wit.vtxinwit[0].scriptWitness.stack = [pad, pad, scripts[2]]\n-        self.test_node.test_transaction_acceptance(p2wsh_txs[2], True, True)\n-        self.std_node.test_transaction_acceptance(p2wsh_txs[2], True, True)\n+        test_transaction_acceptance(self.nodes[0], self.test_node, p2wsh_txs[2], True, True)\n+        test_transaction_acceptance(self.nodes[1], self.std_node, p2wsh_txs[2], True, True)\n \n         # witnessScript size at 3601 bytes is non-standard\n         p2wsh_txs[3].wit.vtxinwit[0].scriptWitness.stack = [pad, pad, pad, scripts[3]]\n-        self.std_node.test_transaction_acceptance(p2wsh_txs[3], True, False, b'bad-witness-nonstandard')\n+        test_transaction_acceptance(self.nodes[1], self.std_node, p2wsh_txs[3], True, False, b'bad-witness-nonstandard')\n         # Non-standard nodes should accept\n-        self.test_node.test_transaction_acceptance(p2wsh_txs[3], True, True)\n+        test_transaction_acceptance(self.nodes[0], self.test_node, p2wsh_txs[3], True, True)\n \n         # Repeating the same tests with P2SH-P2WSH\n         p2sh_txs[0].wit.vtxinwit[0].scriptWitness.stack = [pad] * 101 + [scripts[0]]\n-        self.std_node.test_transaction_acceptance(p2sh_txs[0], True, False, b'bad-witness-nonstandard')\n-        self.test_node.test_transaction_acceptance(p2sh_txs[0], True, True)\n+        test_transaction_acceptance(self.nodes[1], self.std_node, p2sh_txs[0], True, False, b'bad-witness-nonstandard')\n+        test_transaction_acceptance(self.nodes[0], self.test_node, p2sh_txs[0], True, True)\n         p2sh_txs[1].wit.vtxinwit[0].scriptWitness.stack = [pad * 81] * 100 + [scripts[1]]\n-        self.std_node.test_transaction_acceptance(p2sh_txs[1], True, False, b'bad-witness-nonstandard')\n-        self.test_node.test_transaction_acceptance(p2sh_txs[1], True, True)\n+        test_transaction_acceptance(self.nodes[1], self.std_node, p2sh_txs[1], True, False, b'bad-witness-nonstandard')\n+        test_transaction_acceptance(self.nodes[0], self.test_node, p2sh_txs[1], True, True)\n         p2sh_txs[1].wit.vtxinwit[0].scriptWitness.stack = [pad * 80] * 100 + [scripts[1]]\n-        self.std_node.test_transaction_acceptance(p2sh_txs[1], True, True)\n+        test_transaction_acceptance(self.nodes[1], self.std_node, p2sh_txs[1], True, True)\n         p2sh_txs[2].wit.vtxinwit[0].scriptWitness.stack = [pad, pad, scripts[2]]\n-        self.test_node.test_transaction_acceptance(p2sh_txs[2], True, True)\n-        self.std_node.test_transaction_acceptance(p2sh_txs[2], True, True)\n+        test_transaction_acceptance(self.nodes[0], self.test_node, p2sh_txs[2], True, True)\n+        test_transaction_acceptance(self.nodes[1], self.std_node, p2sh_txs[2], True, True)\n         p2sh_txs[3].wit.vtxinwit[0].scriptWitness.stack = [pad, pad, pad, scripts[3]]\n-        self.std_node.test_transaction_acceptance(p2sh_txs[3], True, False, b'bad-witness-nonstandard')\n-        self.test_node.test_transaction_acceptance(p2sh_txs[3], True, True)\n+        test_transaction_acceptance(self.nodes[1], self.std_node, p2sh_txs[3], True, False, b'bad-witness-nonstandard')\n+        test_transaction_acceptance(self.nodes[0], self.test_node, p2sh_txs[3], True, True)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r152379930",
      "id" : 152379930,
      "original_commit_id" : "ff3b19c608b465dd4af8a13280f92e5a91dd6b78",
      "original_position" : 835,
      "path" : "test/functional/p2p-segwit.py",
      "position" : null,
      "pull_request_review_id" : 78230563,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712",
      "updated_at" : "2017-11-28T17:47:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152379930",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r152382964"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152382964"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"[tests] instantiate NodeConnCB in TestNode\"\r\n\r\nCan similary control flow and revert this whole commit, see main comment.",
      "commit_id" : "e9dfa9bccc5cbb6096c60498651b451297f0a931",
      "created_at" : "2017-11-21T19:48:13Z",
      "diff_hunk" : "@@ -158,16 +158,20 @@ def node_encrypt_wallet(self, passphrase):\n         self.encryptwallet(passphrase)\n         self.wait_until_stopped()\n \n-    def add_p2p_connection(self, p2p_conn, **kwargs):\n+    def add_p2p_connection(self, p2p_conn_type, **kwargs):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r152382964",
      "id" : 152382964,
      "original_commit_id" : "fb8592236b8fae27609d87adbd4d09323d17c8f0",
      "original_position" : 5,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : null,
      "pull_request_review_id" : 78230563,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712",
      "updated_at" : "2017-11-28T17:47:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152382964",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r152404154"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152404154"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"[tests] Make NodeConnCB a subclass of NodeConn\"\r\n\r\nCan get rid of all these default parameters repeated so many times. See main comment.",
      "commit_id" : "e9dfa9bccc5cbb6096c60498651b451297f0a931",
      "created_at" : "2017-11-21T21:17:46Z",
      "diff_hunk" : "@@ -34,7 +35,7 @@\n # message is received from the node-under-test. Subclass NodeConnCB and\n # override the on_*() methods if you need custom behaviour.\n class BaseNode(NodeConnCB):\n-    def __init__(self):\n+    def __init__(self, dstaddr, dstport, net=\"regtest\", services=NODE_NETWORK, send_version=True):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r152404154",
      "id" : 152404154,
      "original_commit_id" : "40876ac740e79a8cf248bb099b7fe1a212a641ae",
      "original_position" : 13,
      "path" : "test/functional/example_test.py",
      "position" : null,
      "pull_request_review_id" : 78230563,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712",
      "updated_at" : "2017-11-28T17:47:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152404154",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks Russ. I much prefer your suggested way of passing the constructed NodeConnCB object to TestNode. I've incorporated your change and split the PR into smaller commits to aid reviewing.",
      "created_at" : "2017-11-23T15:37:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11712#issuecomment-346648643",
      "id" : 346648643,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11712",
      "updated_at" : "2017-11-23T15:37:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/346648643",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r153235647"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153235647"
         }
      },
      "author_association" : "MEMBER",
      "body" : "stylte-nit: Any reason for this change? I think the previous is easier to read python code.",
      "commit_id" : "e9dfa9bccc5cbb6096c60498651b451297f0a931",
      "created_at" : "2017-11-27T15:50:42Z",
      "diff_hunk" : "@@ -185,10 +184,8 @@ def p2p(self):\n     def disconnect_p2ps(self):\n         \"\"\"Close all p2p connections to the node.\"\"\"\n         for p in self.p2ps:\n-            # Connection could have already been closed by other end.\n-            if p.connection is not None:\n-                p.connection.disconnect_node()\n-        self.p2ps = []\n+            p.peer_disconnect()\n+        del self.p2ps[:]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r153235647",
      "id" : 153235647,
      "original_commit_id" : "4e8531ff2ddfb6649a5542b67c04fe8b170574ba",
      "original_position" : 38,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : 38,
      "pull_request_review_id" : 79212251,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712",
      "updated_at" : "2017-11-28T17:47:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153235647",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r153271032"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153271032"
         }
      },
      "author_association" : "MEMBER",
      "body" : "There's some discussion of the differences here: https://stackoverflow.com/questions/850795/different-ways-of-clearing-lists\r\n\r\nIf there was a different reference to this array, then `self.p2ps = []` wouldn't clear that array, it would just change `self.p2ps` to point to a new, empty array.\r\n\r\nPractically, there's not much difference, but I think I prefer `del self.p2ps[:]`. I actually got this from @ryanofsky's commit - perhaps he had a specific reason to make this change?",
      "commit_id" : "e9dfa9bccc5cbb6096c60498651b451297f0a931",
      "created_at" : "2017-11-27T17:45:32Z",
      "diff_hunk" : "@@ -185,10 +184,8 @@ def p2p(self):\n     def disconnect_p2ps(self):\n         \"\"\"Close all p2p connections to the node.\"\"\"\n         for p in self.p2ps:\n-            # Connection could have already been closed by other end.\n-            if p.connection is not None:\n-                p.connection.disconnect_node()\n-        self.p2ps = []\n+            p.peer_disconnect()\n+        del self.p2ps[:]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r153271032",
      "id" : 153271032,
      "in_reply_to_id" : 153235647,
      "original_commit_id" : "4e8531ff2ddfb6649a5542b67c04fe8b170574ba",
      "original_position" : 38,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : 38,
      "pull_request_review_id" : 79252831,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712",
      "updated_at" : "2017-11-28T17:47:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153271032",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r153308295"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153308295"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ok, fine to keep, since it is ever-so-slightly safer and already used by this syntax in `stop_node`",
      "commit_id" : "e9dfa9bccc5cbb6096c60498651b451297f0a931",
      "created_at" : "2017-11-27T20:08:09Z",
      "diff_hunk" : "@@ -185,10 +184,8 @@ def p2p(self):\n     def disconnect_p2ps(self):\n         \"\"\"Close all p2p connections to the node.\"\"\"\n         for p in self.p2ps:\n-            # Connection could have already been closed by other end.\n-            if p.connection is not None:\n-                p.connection.disconnect_node()\n-        self.p2ps = []\n+            p.peer_disconnect()\n+        del self.p2ps[:]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r153308295",
      "id" : 153308295,
      "in_reply_to_id" : 153235647,
      "original_commit_id" : "4e8531ff2ddfb6649a5542b67c04fe8b170574ba",
      "original_position" : 38,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : 38,
      "pull_request_review_id" : 79295452,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712",
      "updated_at" : "2017-11-28T17:47:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153308295",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r153311144"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153311144"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Main reason for suggesting this is that having multiple instances of the same list can make things confusing when you are debugging.",
      "commit_id" : "e9dfa9bccc5cbb6096c60498651b451297f0a931",
      "created_at" : "2017-11-27T20:19:46Z",
      "diff_hunk" : "@@ -185,10 +184,8 @@ def p2p(self):\n     def disconnect_p2ps(self):\n         \"\"\"Close all p2p connections to the node.\"\"\"\n         for p in self.p2ps:\n-            # Connection could have already been closed by other end.\n-            if p.connection is not None:\n-                p.connection.disconnect_node()\n-        self.p2ps = []\n+            p.peer_disconnect()\n+        del self.p2ps[:]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r153311144",
      "id" : 153311144,
      "in_reply_to_id" : 153235647,
      "original_commit_id" : "4e8531ff2ddfb6649a5542b67c04fe8b170574ba",
      "original_position" : 38,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : 38,
      "pull_request_review_id" : 79298616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712",
      "updated_at" : "2017-11-28T17:47:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153311144",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r153345038"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153345038"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"[tests] Tidy up mininode\"\r\n\r\nThink you missed the readble() function above. Would be good to note that is an asyncore callback like writeable().",
      "commit_id" : "e9dfa9bccc5cbb6096c60498651b451297f0a931",
      "created_at" : "2017-11-27T22:35:43Z",
      "diff_hunk" : "@@ -262,12 +264,18 @@ def readable(self):\n         return True\n \n     def handle_read(self):\n+        \"\"\"asyncore callback when data is read from the socket.\"\"\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r153345038",
      "id" : 153345038,
      "original_commit_id" : "e5e64d5843748f800a9081bf06f469ed326c0632",
      "original_position" : 37,
      "path" : "test/functional/test_framework/mininode.py",
      "position" : null,
      "pull_request_review_id" : 79336660,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712",
      "updated_at" : "2017-11-28T17:47:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153345038",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r153346353"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153346353"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"[tests] Tidy up mininode\"\r\n\r\nSeems like this method should begin with an underscore (like `_log_message` below), since this is part of the read handler, and not something that should be called externally. I also think a name like `_got_data` `_on_data` `_handle_data` `_process_messages` might be more descriptive since `read_message` suggests a method that blocks waiting for a message as opposed to a method handling incoming data.",
      "commit_id" : "e9dfa9bccc5cbb6096c60498651b451297f0a931",
      "created_at" : "2017-11-27T22:42:01Z",
      "diff_hunk" : "@@ -262,12 +264,18 @@ def readable(self):\n         return True\n \n     def handle_read(self):\n+        \"\"\"asyncore callback when data is read from the socket.\"\"\"\n         t = self.recv(8192)\n         if len(t) > 0:\n             self.recvbuf += t\n-            self.got_data()\n+            self.read_message()\n \n-    def got_data(self):\n+    def read_message(self):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r153346353",
      "id" : 153346353,
      "original_commit_id" : "e5e64d5843748f800a9081bf06f469ed326c0632",
      "original_position" : 45,
      "path" : "test/functional/test_framework/mininode.py",
      "position" : null,
      "pull_request_review_id" : 79336660,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712",
      "updated_at" : "2017-11-28T17:47:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153346353",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r153346970"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153346970"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"[tests] Tidy up mininode\"\r\n\r\nWould change \"a message\" to \"messages\" everywhere since this can parse more than just one message.",
      "commit_id" : "e9dfa9bccc5cbb6096c60498651b451297f0a931",
      "created_at" : "2017-11-27T22:44:47Z",
      "diff_hunk" : "@@ -262,12 +264,18 @@ def readable(self):\n         return True\n \n     def handle_read(self):\n+        \"\"\"asyncore callback when data is read from the socket.\"\"\"\n         t = self.recv(8192)\n         if len(t) > 0:\n             self.recvbuf += t\n-            self.got_data()\n+            self.read_message()\n \n-    def got_data(self):\n+    def read_message(self):\n+        \"\"\"Try to read a P2P message from the recv buffer.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r153346970",
      "id" : 153346970,
      "original_commit_id" : "e5e64d5843748f800a9081bf06f469ed326c0632",
      "original_position" : 46,
      "path" : "test/functional/test_framework/mininode.py",
      "position" : null,
      "pull_request_review_id" : 79336660,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712",
      "updated_at" : "2017-11-28T17:47:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153346970",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r153351274"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153351274"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"[tests] Make NodeConnCB a subclass of NodeConn\"\r\n\r\nMaybe keep assigning nServices/messages_count/last_message/ping_counter members that don't depend on connection information in `__init__` rather than `peer_connect`. This would mean you don't need to introduce a `NodeConnCB.peer_connect` method in this commit, and in the next commit it can be a shorter, more focused override. Just a suggestion, though, difference is minor.",
      "commit_id" : "e9dfa9bccc5cbb6096c60498651b451297f0a931",
      "created_at" : "2017-11-27T23:06:08Z",
      "diff_hunk" : "@@ -241,15 +258,19 @@ def _log_message(self, direction, msg):\n         logger.debug(log_message)\n \n \n-class NodeConnCB():\n-    \"\"\"Callback and helper functions for P2P connection to a bitcoind node.\n+class NodeConnCB(NodeConn):\n+    \"\"\"A high-level P2P interface class for communicating with a Bitcoin node.\n+\n+    This class provides high-level callbacks for processing P2P message\n+    payloads, as well as convenience methods for interacting with the\n+    node over P2P.\n \n     Individual testcases should subclass this and override the on_* methods\n-    if they want to alter message handling behaviour.\"\"\"\n-    def __init__(self):\n-        # Track whether we have a P2P connection open to the node\n-        self.connected = False\n-        self.connection = None\n+    if they want to alter message handling behaviour.\n+\n+    TODO: rename this class P2PInterface\"\"\"\n+    def peer_connect(self, *args, **kwargs):\n+        super().peer_connect(*args, **kwargs)\n \n         # Track number of messages of each type received and the most recent",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r153351274",
      "id" : 153351274,
      "original_commit_id" : "4e8531ff2ddfb6649a5542b67c04fe8b170574ba",
      "original_position" : 111,
      "path" : "test/functional/test_framework/mininode.py",
      "position" : null,
      "pull_request_review_id" : 79336660,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712",
      "updated_at" : "2017-11-28T17:47:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153351274",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r153561233"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153561233"
         }
      },
      "author_association" : "MEMBER",
      "body" : "We can actually just remove the `readable()` override entirely. From https://docs.python.org/3.6/library/asyncore.html#asyncore.dispatcher.readable : \"The default method simply returns True, indicating that by default, all channels will be interested in read events.\" so this override isn't actually doing anything.\r\n\r\nI'll update the commit.",
      "commit_id" : "e9dfa9bccc5cbb6096c60498651b451297f0a931",
      "created_at" : "2017-11-28T17:14:11Z",
      "diff_hunk" : "@@ -262,12 +264,18 @@ def readable(self):\n         return True\n \n     def handle_read(self):\n+        \"\"\"asyncore callback when data is read from the socket.\"\"\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r153561233",
      "id" : 153561233,
      "in_reply_to_id" : 153345038,
      "original_commit_id" : "e5e64d5843748f800a9081bf06f469ed326c0632",
      "original_position" : 37,
      "path" : "test/functional/test_framework/mininode.py",
      "position" : null,
      "pull_request_review_id" : 79584671,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712",
      "updated_at" : "2017-11-28T17:47:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153561233",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r153565721"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153565721"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Agree. Changed to `_on_data`.",
      "commit_id" : "e9dfa9bccc5cbb6096c60498651b451297f0a931",
      "created_at" : "2017-11-28T17:29:55Z",
      "diff_hunk" : "@@ -262,12 +264,18 @@ def readable(self):\n         return True\n \n     def handle_read(self):\n+        \"\"\"asyncore callback when data is read from the socket.\"\"\"\n         t = self.recv(8192)\n         if len(t) > 0:\n             self.recvbuf += t\n-            self.got_data()\n+            self.read_message()\n \n-    def got_data(self):\n+    def read_message(self):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r153565721",
      "id" : 153565721,
      "in_reply_to_id" : 153346353,
      "original_commit_id" : "e5e64d5843748f800a9081bf06f469ed326c0632",
      "original_position" : 45,
      "path" : "test/functional/test_framework/mininode.py",
      "position" : null,
      "pull_request_review_id" : 79589761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712",
      "updated_at" : "2017-11-28T17:47:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153565721",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r153565768"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153565768"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes. Fixed.",
      "commit_id" : "e9dfa9bccc5cbb6096c60498651b451297f0a931",
      "created_at" : "2017-11-28T17:30:03Z",
      "diff_hunk" : "@@ -262,12 +264,18 @@ def readable(self):\n         return True\n \n     def handle_read(self):\n+        \"\"\"asyncore callback when data is read from the socket.\"\"\"\n         t = self.recv(8192)\n         if len(t) > 0:\n             self.recvbuf += t\n-            self.got_data()\n+            self.read_message()\n \n-    def got_data(self):\n+    def read_message(self):\n+        \"\"\"Try to read a P2P message from the recv buffer.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r153565768",
      "id" : 153565768,
      "in_reply_to_id" : 153346970,
      "original_commit_id" : "e5e64d5843748f800a9081bf06f469ed326c0632",
      "original_position" : 46,
      "path" : "test/functional/test_framework/mininode.py",
      "position" : null,
      "pull_request_review_id" : 79589819,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712",
      "updated_at" : "2017-11-28T17:47:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153565768",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r153570501"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153570501"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Agree. Makes more sense. Thanks.",
      "commit_id" : "e9dfa9bccc5cbb6096c60498651b451297f0a931",
      "created_at" : "2017-11-28T17:47:53Z",
      "diff_hunk" : "@@ -241,15 +258,19 @@ def _log_message(self, direction, msg):\n         logger.debug(log_message)\n \n \n-class NodeConnCB():\n-    \"\"\"Callback and helper functions for P2P connection to a bitcoind node.\n+class NodeConnCB(NodeConn):\n+    \"\"\"A high-level P2P interface class for communicating with a Bitcoin node.\n+\n+    This class provides high-level callbacks for processing P2P message\n+    payloads, as well as convenience methods for interacting with the\n+    node over P2P.\n \n     Individual testcases should subclass this and override the on_* methods\n-    if they want to alter message handling behaviour.\"\"\"\n-    def __init__(self):\n-        # Track whether we have a P2P connection open to the node\n-        self.connected = False\n-        self.connection = None\n+    if they want to alter message handling behaviour.\n+\n+    TODO: rename this class P2PInterface\"\"\"\n+    def peer_connect(self, *args, **kwargs):\n+        super().peer_connect(*args, **kwargs)\n \n         # Track number of messages of each type received and the most recent",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r153570501",
      "id" : 153570501,
      "in_reply_to_id" : 153351274,
      "original_commit_id" : "4e8531ff2ddfb6649a5542b67c04fe8b170574ba",
      "original_position" : 111,
      "path" : "test/functional/test_framework/mininode.py",
      "position" : null,
      "pull_request_review_id" : 79595468,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712",
      "updated_at" : "2017-11-28T17:47:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153570501",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Addressed @ryanofsky's comments",
      "created_at" : "2017-11-28T17:48:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11712#issuecomment-347605979",
      "id" : 347605979,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11712",
      "updated_at" : "2017-11-28T17:48:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/347605979",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r153886852"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153886852"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: I'd rather do the opposite and disallow passing through unnamed args here. Forcing code to be explicit should be safer and ease future review, imo.\r\n\r\n ```py\r\ndef add_p2p_connection(self, p2p_conn, *, **kwargs)\r\n```",
      "commit_id" : "e9dfa9bccc5cbb6096c60498651b451297f0a931",
      "created_at" : "2017-11-29T19:14:19Z",
      "diff_hunk" : "@@ -158,7 +157,7 @@ def node_encrypt_wallet(self, passphrase):\n         self.encryptwallet(passphrase)\n         self.wait_until_stopped()\n \n-    def add_p2p_connection(self, p2p_conn, **kwargs):\n+    def add_p2p_connection(self, p2p_conn, *args, **kwargs):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r153886852",
      "id" : 153886852,
      "original_commit_id" : "dad596fc37c8733ab806a0aa4224ac437d37aee5",
      "original_position" : 13,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : 13,
      "pull_request_review_id" : 79963875,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712",
      "updated_at" : "2017-11-29T19:17:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153886852",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r153908010"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153908010"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "If the goal is to disallow unnamed arguments, this place to do is where the arguments are actually declared (in the peer_connect method). If you make that change here instead of there, you will be introducing an inconsistency between add_p2p_connection and peer_connect. It is better for testnode to just forward arguments on to peernode, instead making unnecessary assumptions about how it works internally and creating unnecessary differences. Forwarding *args and **kwargs is also idiomatic in python while forwarding just **kwargs is more unusual.",
      "commit_id" : "e9dfa9bccc5cbb6096c60498651b451297f0a931",
      "created_at" : "2017-11-29T20:37:18Z",
      "diff_hunk" : "@@ -158,7 +157,7 @@ def node_encrypt_wallet(self, passphrase):\n         self.encryptwallet(passphrase)\n         self.wait_until_stopped()\n \n-    def add_p2p_connection(self, p2p_conn, **kwargs):\n+    def add_p2p_connection(self, p2p_conn, *args, **kwargs):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r153908010",
      "id" : 153908010,
      "in_reply_to_id" : 153886852,
      "original_commit_id" : "dad596fc37c8733ab806a0aa4224ac437d37aee5",
      "original_position" : 13,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : 13,
      "pull_request_review_id" : 79988699,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712",
      "updated_at" : "2017-11-29T20:37:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153908010",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r153914112"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153914112"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think @ryanofsky is right - the right place for this is in `NodeConnCB.peer_connect()`. Can we leave that for a future PR?",
      "commit_id" : "e9dfa9bccc5cbb6096c60498651b451297f0a931",
      "created_at" : "2017-11-29T21:03:04Z",
      "diff_hunk" : "@@ -158,7 +157,7 @@ def node_encrypt_wallet(self, passphrase):\n         self.encryptwallet(passphrase)\n         self.wait_until_stopped()\n \n-    def add_p2p_connection(self, p2p_conn, **kwargs):\n+    def add_p2p_connection(self, p2p_conn, *args, **kwargs):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r153914112",
      "id" : 153914112,
      "in_reply_to_id" : 153886852,
      "original_commit_id" : "dad596fc37c8733ab806a0aa4224ac437d37aee5",
      "original_position" : 13,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : 13,
      "pull_request_review_id" : 79995954,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712",
      "updated_at" : "2017-11-29T21:03:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153914112",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r153919426"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153919426"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@jnewbery Sure, future PR sounds good.",
      "commit_id" : "e9dfa9bccc5cbb6096c60498651b451297f0a931",
      "created_at" : "2017-11-29T21:25:44Z",
      "diff_hunk" : "@@ -158,7 +157,7 @@ def node_encrypt_wallet(self, passphrase):\n         self.encryptwallet(passphrase)\n         self.wait_until_stopped()\n \n-    def add_p2p_connection(self, p2p_conn, **kwargs):\n+    def add_p2p_connection(self, p2p_conn, *args, **kwargs):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11712#discussion_r153919426",
      "id" : 153919426,
      "in_reply_to_id" : 153886852,
      "original_commit_id" : "dad596fc37c8733ab806a0aa4224ac437d37aee5",
      "original_position" : 13,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : 13,
      "pull_request_review_id" : 80002471,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11712",
      "updated_at" : "2017-11-29T21:25:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153919426",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
