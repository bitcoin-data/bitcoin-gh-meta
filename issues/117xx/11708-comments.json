[
   {
      "author_association" : "MEMBER",
      "body" : "NACK, redeemScript + scriptPubKey are sufficient information to know whether you are talking about P2SH-P2WSH, P2SH, P2WSH. Having one more \"witness script\" is just redundant information which can go wrong.\r\n\r\nIf you enter the witness script in \"redeemScript\" field, you can easily find out in code if it mean P2SH or Witness by comparing with the scriptPubKey, there is no ambiguity.\r\n",
      "created_at" : "2017-11-17T05:21:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#issuecomment-345148386",
      "id" : 345148386,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11708",
      "updated_at" : "2017-11-17T05:23:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/345148386",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "@NicolasDorier How so? The redeemscript only contains a hash of the witness script in the case of P2SH-P2WSH, which is not sufficient to sign with.\n\nIt would be possible to require passing only the witness script, and automatically also add the v0 P2WSH redeemscript (and any future versions?). But just the redeemscript is not enough.",
      "created_at" : "2017-11-17T05:35:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#issuecomment-345150004",
      "id" : 345150004,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11708",
      "updated_at" : "2017-11-17T05:35:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/345150004",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Indeed, IMO its much cleaner implementation and user experience to have the witnessScript provided in addition to the redeemScript, not only because that avoids the ambiguous witness version issue in a nice way but also because then it is clear to the user which script the redeemScript actually refers to (because the redeemScript output of other RPCs in general would refer to the wrapper P2SH redeemScript not the witnessScript which would introduce confusion).",
      "created_at" : "2017-11-17T06:18:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#issuecomment-345155716",
      "id" : 345155716,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11708",
      "updated_at" : "2017-11-17T06:20:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/345155716",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r151760982"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151760982"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Watch out with the indentation,... the `\\\"` result in one char. It may look unaligned in the source code but is aligned in the help output.",
      "commit_id" : "576624ce9567487f799d3a526b8f38b88c64ee80",
      "created_at" : "2017-11-17T18:48:26Z",
      "diff_hunk" : "@@ -2808,17 +2808,18 @@ UniValue listunspent(const JSONRPCRequest& request)\n             \"\\nResult\\n\"\n             \"[                   (array of json object)\\n\"\n             \"  {\\n\"\n-            \"    \\\"txid\\\" : \\\"txid\\\",          (string) the transaction id \\n\"\n-            \"    \\\"vout\\\" : n,               (numeric) the vout value\\n\"\n-            \"    \\\"address\\\" : \\\"address\\\",    (string) the bitcoin address\\n\"\n-            \"    \\\"account\\\" : \\\"account\\\",    (string) DEPRECATED. The associated account, or \\\"\\\" for the default account\\n\"\n-            \"    \\\"scriptPubKey\\\" : \\\"key\\\",   (string) the script key\\n\"\n-            \"    \\\"amount\\\" : x.xxx,         (numeric) the transaction output amount in \" + CURRENCY_UNIT + \"\\n\"\n-            \"    \\\"confirmations\\\" : n,      (numeric) The number of confirmations\\n\"\n-            \"    \\\"redeemScript\\\" : n        (string) The redeemScript if scriptPubKey is P2SH\\n\"\n-            \"    \\\"spendable\\\" : xxx,        (bool) Whether we have the private keys to spend this output\\n\"\n-            \"    \\\"solvable\\\" : xxx,         (bool) Whether we know how to spend this output, ignoring the lack of keys\\n\"\n-            \"    \\\"safe\\\" : xxx              (bool) Whether this output is considered safe to spend. Unconfirmed transactions\\n\"\n+            \"    \\\"txid\\\" : \\\"txid\\\",            (string) the transaction id \\n\"\n+            \"    \\\"vout\\\" : n,                   (numeric) the vout value\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r151760982",
      "id" : 151760982,
      "original_commit_id" : "9e5c9ebe0231d9030eaccc336560e3898cd61b7b",
      "original_position" : 16,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 77526827,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708",
      "updated_at" : "2018-02-15T05:28:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151760982",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r151789014"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151789014"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: replace 32 with `sizeof()`?",
      "commit_id" : "576624ce9567487f799d3a526b8f38b88c64ee80",
      "created_at" : "2017-11-17T21:04:34Z",
      "diff_hunk" : "@@ -2923,6 +2924,26 @@ UniValue listunspent(const JSONRPCRequest& request)\n                 CScript redeemScript;\n                 if (pwallet->GetCScript(hash, redeemScript)) {\n                     entry.push_back(Pair(\"redeemScript\", HexStr(redeemScript.begin(), redeemScript.end())));\n+                    CTxDestination witness_destination;\n+                    if(redeemScript.IsPayToWitnessScriptHash() && ExtractDestination(redeemScript, witness_destination)) {\n+                        const WitnessV0ScriptHash& whash = boost::get<WitnessV0ScriptHash>(witness_destination);\n+                        CScriptID id;\n+                        CRIPEMD160().Write(whash.begin(), 32).Finalize(id.begin());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r151789014",
      "id" : 151789014,
      "original_commit_id" : "9e5c9ebe0231d9030eaccc336560e3898cd61b7b",
      "original_position" : 38,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 77560641,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708",
      "updated_at" : "2018-02-15T05:28:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151789014",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. Can you add a test?",
      "created_at" : "2017-11-17T21:10:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#issuecomment-345366064",
      "id" : 345366064,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11708",
      "updated_at" : "2017-11-17T21:10:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/345366064",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jonasschnelli yep will do, see TODO section :) Just trying to work out the cleanest way to test it wrt all the existing tests in segwit.py",
      "created_at" : "2017-11-17T22:57:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#issuecomment-345388311",
      "id" : 345388311,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11708",
      "updated_at" : "2017-11-17T22:57:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/345388311",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r151832181"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151832181"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: the `whash.size()` should also go here... :P",
      "commit_id" : "576624ce9567487f799d3a526b8f38b88c64ee80",
      "created_at" : "2017-11-18T07:42:13Z",
      "diff_hunk" : "@@ -2923,6 +2924,26 @@ UniValue listunspent(const JSONRPCRequest& request)\n                 CScript redeemScript;\n                 if (pwallet->GetCScript(hash, redeemScript)) {\n                     entry.push_back(Pair(\"redeemScript\", HexStr(redeemScript.begin(), redeemScript.end())));\n+                    CTxDestination witness_destination;\n+                    if(redeemScript.IsPayToWitnessScriptHash() && ExtractDestination(redeemScript, witness_destination)) {\n+                        const WitnessV0ScriptHash& whash = boost::get<WitnessV0ScriptHash>(witness_destination);\n+                        CScriptID id;\n+                        CRIPEMD160().Write(whash.begin(), whash.size()).Finalize(id.begin());\n+                        CScript witnessScript;\n+                        if (pwallet->GetCScript(id, witnessScript)) {\n+                            entry.push_back(Pair(\"witnessScript\", HexStr(witnessScript.begin(), witnessScript.end())));\n+                        }\n+                    }\n+                }\n+            }\n+\n+            if (scriptPubKey.IsPayToWitnessScriptHash()) {\n+                const WitnessV0ScriptHash& whash = boost::get<WitnessV0ScriptHash>(address);\n+                CScriptID id;\n+                CRIPEMD160().Write(whash.begin(), 32).Finalize(id.begin());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r151832181",
      "id" : 151832181,
      "original_commit_id" : "a0b90c9edf7f3b0d7cbcad79533c4ff257610fa9",
      "original_position" : 50,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 77610319,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708",
      "updated_at" : "2018-02-15T05:28:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151832181",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r151832339"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151832339"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Heh missed that, thanks :P ",
      "commit_id" : "576624ce9567487f799d3a526b8f38b88c64ee80",
      "created_at" : "2017-11-18T07:52:49Z",
      "diff_hunk" : "@@ -2923,6 +2924,26 @@ UniValue listunspent(const JSONRPCRequest& request)\n                 CScript redeemScript;\n                 if (pwallet->GetCScript(hash, redeemScript)) {\n                     entry.push_back(Pair(\"redeemScript\", HexStr(redeemScript.begin(), redeemScript.end())));\n+                    CTxDestination witness_destination;\n+                    if(redeemScript.IsPayToWitnessScriptHash() && ExtractDestination(redeemScript, witness_destination)) {\n+                        const WitnessV0ScriptHash& whash = boost::get<WitnessV0ScriptHash>(witness_destination);\n+                        CScriptID id;\n+                        CRIPEMD160().Write(whash.begin(), whash.size()).Finalize(id.begin());\n+                        CScript witnessScript;\n+                        if (pwallet->GetCScript(id, witnessScript)) {\n+                            entry.push_back(Pair(\"witnessScript\", HexStr(witnessScript.begin(), witnessScript.end())));\n+                        }\n+                    }\n+                }\n+            }\n+\n+            if (scriptPubKey.IsPayToWitnessScriptHash()) {\n+                const WitnessV0ScriptHash& whash = boost::get<WitnessV0ScriptHash>(address);\n+                CScriptID id;\n+                CRIPEMD160().Write(whash.begin(), 32).Finalize(id.begin());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r151832339",
      "id" : 151832339,
      "in_reply_to_id" : 151832181,
      "original_commit_id" : "a0b90c9edf7f3b0d7cbcad79533c4ff257610fa9",
      "original_position" : 50,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 77610476,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708",
      "updated_at" : "2018-02-15T05:28:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151832339",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Test and release notes added, @jonasschnelli's nits addresses",
      "created_at" : "2017-11-18T10:24:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#issuecomment-345432938",
      "id" : 345432938,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11708",
      "updated_at" : "2017-11-18T10:24:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/345432938",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This is how I am doing with NBitcoin for long.\r\n\r\n@sipa if you have `redeemscript` and `scriptPubKey` you can know exactly wether redeemScript is a Segwit or P2SH redeem.\r\n\r\nIf `scriptPubKey` is P2WSH, then you know `redeemScript` is a segwit redeem.\r\n\r\nIf `scriptPubKey` is P2SH, you know `redeemScript` is either a P2SH redeem or a Segwit Redeem.\r\n\r\nIf `Hash(redeemScript) is contained inside scriptPubKey`, then it is a P2SH redeem else it is a segwit redeem. If it is a P2SH redeem, and inside is a segwit program, you must return error to the user.\r\n\r\nYou can then Hash(Hash(redeemScript)) and verify that it is indeed into `ScriptPubKey` to be sure the user did not messed up.\r\n\r\nYou can derive the P2SH redeem from the Segwit redeem, so no need to specify both.\r\n\r\nAgain, strong NACK on this one. This is not needed.",
      "created_at" : "2017-11-20T05:04:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#issuecomment-345592667",
      "id" : 345592667,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11708",
      "updated_at" : "2017-11-20T05:07:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/345592667",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "@NicolasDorier Ah, I'm using redeemscript exclusively for P2SH.\n\nYes, if you have the witness script, and can correctly guess it is a V0 P2WSH embedded in P2SH, you can derive the redeemscript.\n\nI'm not convinced guessing is the best approach.",
      "created_at" : "2017-11-20T05:08:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#issuecomment-345593132",
      "id" : 345593132,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11708",
      "updated_at" : "2017-11-20T05:08:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/345593132",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Well the thing is that this field is called `redeemScript` which does not suppose it is P2SH or Segwit redeem, and it does not have to.\r\n\r\nIf you insist having both redeem, then I would suggest to rename `redeemScript` as `p2shRedeem`.\r\n\r\nBut then, the logic of this RPC method will need to ensure that all, `witnessScript`, `p2shRedeem` and `scriptPubKey` are coherent.\r\n\r\nI am convinced specifying both is just wrong as there is no ambiguity, no way to guess incorrectly. Just more way for the user to get wrong and confused, and more code to ensure everything is coherent on both side.",
      "created_at" : "2017-11-20T05:11:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#issuecomment-345593451",
      "id" : 345593451,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11708",
      "updated_at" : "2017-11-20T05:18:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/345593451",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "@NicolasDorier That's the fair point, the naming would be inconsistent in that case.\r\n\r\nWe also don't actually need to distinguish for our implementation. @MeshCollider perhaps we can just permit redeemScript to be a list, in which case multiple scripts gets loaded with AddCScript?",
      "created_at" : "2017-11-20T06:59:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#issuecomment-345607577",
      "id" : 345607577,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11708",
      "updated_at" : "2017-11-20T06:59:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/345607577",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Yep I'm happy with that approach too, I just definitely want to avoid guessing the witness version as mentioned. Although re: terminology, I've only ever seen redeemScript used to refer exclusively to P2SH, even the [bitcoincore.org segwit wallet dev guide](http://bitcoincore.org/en/segwit_wallet_dev/) refers to the witness redeem script as witnessScript only.",
      "created_at" : "2017-11-20T11:19:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#issuecomment-345666863",
      "id" : 345666863,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11708",
      "updated_at" : "2017-11-20T11:19:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/345666863",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The fact that \"redeemScript\" can refer to all type of PS2SH*-P2WSH* redeems makes migration from P2SH to Segwit easier, as there is no additional fields to pass around that did not existed before.\r\n\r\nIn NBitcoin, there is a type called `ScriptCoin` which was used to represent a P2SH + Redeem. When I updated the library for  Segwit, I only needed to instruct my users that if they want to migrate to  P2SH-P2WSH they just need a different way of calculating the ScriptPubKey when generating a new address. The majority of their code did not changed. (No additional field, old non-segwit UTXO were still working fine, no additional type to know about, no if/else logic for handling both way in their code)\r\n\r\nThat said I would be fine with redeemScript being an array as well.",
      "created_at" : "2017-11-21T02:34:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#issuecomment-345897851",
      "id" : 345897851,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11708",
      "updated_at" : "2017-11-21T02:36:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/345897851",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've made the modification to include the witnessScript in a redeem script array in the case of P2SH-P2WSH, will squash those modification commits if that approach is acceptable",
      "created_at" : "2017-11-23T07:06:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#issuecomment-346543626",
      "id" : 346543626,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11708",
      "updated_at" : "2017-11-23T07:06:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/346543626",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r152906089"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152906089"
         }
      },
      "author_association" : "MEMBER",
      "body" : "you are not using that anymore",
      "commit_id" : "576624ce9567487f799d3a526b8f38b88c64ee80",
      "created_at" : "2017-11-24T06:58:31Z",
      "diff_hunk" : "@@ -669,6 +669,7 @@ UniValue signrawtransaction(const JSONRPCRequest& request)\n             \"         \\\"vout\\\":n,                  (numeric, required) The output number\\n\"\n             \"         \\\"scriptPubKey\\\": \\\"hex\\\",   (string, required) script key\\n\"\n             \"         \\\"redeemScript\\\": \\\"hex\\\",   (string, required for P2SH or P2WSH) redeem script\\n\"\n+            \"         \\\"witnessScript\\\": \\\"hex\\\",  (string, required for P2SH-P2WSH) witness script\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r152906089",
      "id" : 152906089,
      "original_commit_id" : "8cb0b73b723d01de60961f10fe7f93e7abf0ef9b",
      "original_position" : 13,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 78839631,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708",
      "updated_at" : "2018-02-15T05:28:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152906089",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r152906099"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152906099"
         }
      },
      "author_association" : "MEMBER",
      "body" : "you are not using that anymore",
      "commit_id" : "576624ce9567487f799d3a526b8f38b88c64ee80",
      "created_at" : "2017-11-24T06:58:37Z",
      "diff_hunk" : "@@ -650,7 +650,7 @@ UniValue signrawtransaction(const JSONRPCRequest& request)\n \n     if (request.fHelp || request.params.size() < 1 || request.params.size() > 4)\n         throw std::runtime_error(\n-            \"signrawtransaction \\\"hexstring\\\" ( [{\\\"txid\\\":\\\"id\\\",\\\"vout\\\":n,\\\"scriptPubKey\\\":\\\"hex\\\",\\\"redeemScript\\\":\\\"hex\\\"},...] [\\\"privatekey1\\\",...] sighashtype )\\n\"\n+            \"signrawtransaction \\\"hexstring\\\" ( [{\\\"txid\\\":\\\"id\\\",\\\"vout\\\":n,\\\"scriptPubKey\\\":\\\"hex\\\",\\\"redeemScript\\\":\\\"hex\\\",\\\"witnessScript\\\":\\\"hex\\\"},...] [\\\"privatekey1\\\",...] sighashtype )\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r152906099",
      "id" : 152906099,
      "original_commit_id" : "8cb0b73b723d01de60961f10fe7f93e7abf0ef9b",
      "original_position" : 5,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 78839644,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708",
      "updated_at" : "2018-02-15T05:28:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152906099",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Fixed, thanks @NicolasDorier \r\nSquashed fixups too",
      "created_at" : "2017-11-28T23:42:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#issuecomment-347702349",
      "id" : 347702349,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11708",
      "updated_at" : "2017-11-28T23:42:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/347702349",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r153685355"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153685355"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: check if the redeemScript[0] is the p2sh redeem.",
      "commit_id" : "576624ce9567487f799d3a526b8f38b88c64ee80",
      "created_at" : "2017-11-29T03:18:22Z",
      "diff_hunk" : "@@ -138,6 +139,35 @@ def run_test(self):\n         self.successful_signing_test()\n         self.script_verification_error_test()\n \n+        # Now test signing transaction to P2SH-P2WSH addresses without wallet\n+        # Create a new P2SH-P2WSH 1-of-1 multisig address:\n+        embedded_address = self.nodes[1].getnewaddress()\n+        embedded_pubkey = self.nodes[1].validateaddress(embedded_address)[\"pubkey\"]\n+        embedded_privkey = self.nodes[1].dumpprivkey(embedded_address)\n+        multisig_address = self.nodes[1].addmultisigaddress(1, [embedded_pubkey])\n+        p2sh_p2wsh_address = self.nodes[1].addwitnessaddress(multisig_address)\n+        witness_script = CScript([OP_1, hex_str_to_bytes(embedded_pubkey), OP_1, OP_CHECKMULTISIG])\n+\n+        # send transaction to P2SH-P2WSH 1-of-1 multisig address\n+        self.nodes[0].generate(101)\n+        tx_to_witness = self.nodes[0].createrawtransaction([self.nodes[0].listunspent()[0]], {p2sh_p2wsh_address: Decimal(\"49.999\")})\n+        signed_tx_to_witness = self.nodes[0].signrawtransaction(tx_to_witness)\n+        assert (\"errors\" not in signed_tx_to_witness or len([\"errors\"]) == 0)\n+        self.nodes[0].sendrawtransaction(signed_tx_to_witness[\"hex\"])\n+        self.nodes[0].generate(1)\n+        self.sync_all()\n+\n+        # Find the UTXO for the transaction node[1] should have received, check witnessScript matches\n+        unspent_output = self.nodes[1].listunspent(0, 999999, [p2sh_p2wsh_address])[0]\n+        assert_equal(unspent_output[\"redeemScript\"][1], bytes_to_hex_str(witness_script))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r153685355",
      "id" : 153685355,
      "original_commit_id" : "43fc622821b7524b681e3172bb20623ad27a9200",
      "original_position" : 39,
      "path" : "test/functional/signrawtransactions.py",
      "position" : null,
      "pull_request_review_id" : 79727211,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708",
      "updated_at" : "2018-02-15T05:28:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153685355",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK",
      "created_at" : "2017-11-29T03:25:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#issuecomment-347741428",
      "id" : 347741428,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11708",
      "updated_at" : "2017-11-29T03:25:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/347741428",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r156518971"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156518971"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "576624ce9567487f799d3a526b8f38b88c64ee80",
      "created_at" : "2017-12-12T22:49:57Z",
      "diff_hunk" : "@@ -138,6 +139,35 @@ def run_test(self):\n         self.successful_signing_test()\n         self.script_verification_error_test()\n \n+        # Now test signing transaction to P2SH-P2WSH addresses without wallet\n+        # Create a new P2SH-P2WSH 1-of-1 multisig address:\n+        embedded_address = self.nodes[1].getnewaddress()\n+        embedded_pubkey = self.nodes[1].validateaddress(embedded_address)[\"pubkey\"]\n+        embedded_privkey = self.nodes[1].dumpprivkey(embedded_address)\n+        multisig_address = self.nodes[1].addmultisigaddress(1, [embedded_pubkey])\n+        p2sh_p2wsh_address = self.nodes[1].addwitnessaddress(multisig_address)\n+        witness_script = CScript([OP_1, hex_str_to_bytes(embedded_pubkey), OP_1, OP_CHECKMULTISIG])\n+\n+        # send transaction to P2SH-P2WSH 1-of-1 multisig address\n+        self.nodes[0].generate(101)\n+        tx_to_witness = self.nodes[0].createrawtransaction([self.nodes[0].listunspent()[0]], {p2sh_p2wsh_address: Decimal(\"49.999\")})\n+        signed_tx_to_witness = self.nodes[0].signrawtransaction(tx_to_witness)\n+        assert (\"errors\" not in signed_tx_to_witness or len([\"errors\"]) == 0)\n+        self.nodes[0].sendrawtransaction(signed_tx_to_witness[\"hex\"])\n+        self.nodes[0].generate(1)\n+        self.sync_all()\n+\n+        # Find the UTXO for the transaction node[1] should have received, check witnessScript matches\n+        unspent_output = self.nodes[1].listunspent(0, 999999, [p2sh_p2wsh_address])[0]\n+        assert_equal(unspent_output[\"redeemScript\"][1], bytes_to_hex_str(witness_script))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r156518971",
      "id" : 156518971,
      "in_reply_to_id" : 153685355,
      "original_commit_id" : "43fc622821b7524b681e3172bb20623ad27a9200",
      "original_position" : 39,
      "path" : "test/functional/signrawtransactions.py",
      "position" : null,
      "pull_request_review_id" : 83010524,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708",
      "updated_at" : "2018-02-15T05:28:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156518971",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased and added the extra check as suggested by @NicolasDorier. That also fixed the unused OP_0 warning.",
      "created_at" : "2017-12-12T22:50:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#issuecomment-351221570",
      "id" : 351221570,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11708",
      "updated_at" : "2017-12-12T22:50:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/351221570",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "reACK",
      "created_at" : "2017-12-13T02:32:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#issuecomment-351262752",
      "id" : 351262752,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11708",
      "updated_at" : "2017-12-13T02:32:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/351262752",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Should passing a redeem script array to signrawtransaction be possible with bitcoin-cli? It looks this might not work currently because the param does not have an entry in vRPCConvertParams. You might be able to work around this with something like:\r\n\r\n```c++\r\nif (redeem_script.isStr() && !IsHex(redeem_script.get_str())) {\r\n    redeem_script.read(redeem_script.get_str().substr());\r\n    RPCTypeCheckArgument(redeem_script, UniValue::VARR);\r\n}\r\n```",
      "created_at" : "2017-12-13T16:17:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#issuecomment-351440892",
      "id" : 351440892,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11708",
      "updated_at" : "2017-12-13T16:17:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/351440892",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r156718884"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156718884"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Not directly related to this PR, but seems like it might good to return an error if this condition is false instead of skipping validation of the redeemscript parameter.",
      "commit_id" : "576624ce9567487f799d3a526b8f38b88c64ee80",
      "created_at" : "2017-12-13T16:58:08Z",
      "diff_hunk" : "@@ -825,17 +825,18 @@ UniValue signrawtransaction(const JSONRPCRequest& request)\n             // if redeemScript given and not using the local wallet (private keys\n             // given), add redeemScript to the tempKeystore so it can be signed:\n             if (fGivenKeys && (scriptPubKey.IsPayToScriptHash() || scriptPubKey.IsPayToWitnessScriptHash())) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r156718884",
      "id" : 156718884,
      "original_commit_id" : "82ef24d7f88c2b5ccfc2ff3697b7a11b68c06c2f",
      "original_position" : 12,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 83242943,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708",
      "updated_at" : "2018-02-15T05:28:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156718884",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r156719988"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156719988"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe drop this line. It prevents get_str() below from throwing an exception if the wrong type is passed.",
      "commit_id" : "576624ce9567487f799d3a526b8f38b88c64ee80",
      "created_at" : "2017-12-13T17:01:55Z",
      "diff_hunk" : "@@ -825,17 +825,18 @@ UniValue signrawtransaction(const JSONRPCRequest& request)\n             // if redeemScript given and not using the local wallet (private keys\n             // given), add redeemScript to the tempKeystore so it can be signed:\n             if (fGivenKeys && (scriptPubKey.IsPayToScriptHash() || scriptPubKey.IsPayToWitnessScriptHash())) {\n-                RPCTypeCheckObj(prevOut,\n-                    {\n-                        {\"txid\", UniValueType(UniValue::VSTR)},\n-                        {\"vout\", UniValueType(UniValue::VNUM)},\n-                        {\"scriptPubKey\", UniValueType(UniValue::VSTR)},\n-                        {\"redeemScript\", UniValueType(UniValue::VSTR)},\n-                    });\n-                UniValue v = find_value(prevOut, \"redeemScript\");\n-                if (!v.isNull()) {\n-                    std::vector<unsigned char> rsData(ParseHexV(v, \"redeemScript\"));\n-                    CScript redeemScript(rsData.begin(), rsData.end());\n+                UniValue rs = find_value(prevOut, \"redeemScript\");\n+                std::vector<UniValue> scripts;\n+                if (rs.getType() == UniValue::VSTR) {\n+                    scripts.push_back(rs);\n+                } else if (rs.getType() == UniValue::VARR) {\n+                    // If redeemScript is an array, iterate over all scripts provided\n+                    scripts = rs.getValues();\n+                }\n+                for (const UniValue& script : scripts) {\n+                    if (script.getType() != UniValue::VSTR) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r156719988",
      "id" : 156719988,
      "original_commit_id" : "82ef24d7f88c2b5ccfc2ff3697b7a11b68c06c2f",
      "original_position" : 33,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 83242943,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708",
      "updated_at" : "2018-02-15T05:28:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156719988",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r156725891"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156725891"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It might be good to explicitly say this will be an array for p2wsh and nested p2wsh outputs, a string for traditional p2sh outputs, and unset in other cases.",
      "commit_id" : "576624ce9567487f799d3a526b8f38b88c64ee80",
      "created_at" : "2017-12-13T17:22:00Z",
      "diff_hunk" : "@@ -2842,17 +2842,17 @@ UniValue listunspent(const JSONRPCRequest& request)\n             \"\\nResult\\n\"\n             \"[                   (array of json object)\\n\"\n             \"  {\\n\"\n-            \"    \\\"txid\\\" : \\\"txid\\\",          (string) the transaction id \\n\"\n-            \"    \\\"vout\\\" : n,               (numeric) the vout value\\n\"\n-            \"    \\\"address\\\" : \\\"address\\\",    (string) the bitcoin address\\n\"\n-            \"    \\\"account\\\" : \\\"account\\\",    (string) DEPRECATED. The associated account, or \\\"\\\" for the default account\\n\"\n-            \"    \\\"scriptPubKey\\\" : \\\"key\\\",   (string) the script key\\n\"\n-            \"    \\\"amount\\\" : x.xxx,         (numeric) the transaction output amount in \" + CURRENCY_UNIT + \"\\n\"\n-            \"    \\\"confirmations\\\" : n,      (numeric) The number of confirmations\\n\"\n-            \"    \\\"redeemScript\\\" : n        (string) The redeemScript if scriptPubKey is P2SH\\n\"\n-            \"    \\\"spendable\\\" : xxx,        (bool) Whether we have the private keys to spend this output\\n\"\n-            \"    \\\"solvable\\\" : xxx,         (bool) Whether we know how to spend this output, ignoring the lack of keys\\n\"\n-            \"    \\\"safe\\\" : xxx              (bool) Whether this output is considered safe to spend. Unconfirmed transactions\\n\"\n+            \"    \\\"txid\\\" : \\\"txid\\\",            (string) the transaction id \\n\"\n+            \"    \\\"vout\\\" : n,                 (numeric) the vout value\\n\"\n+            \"    \\\"address\\\" : \\\"address\\\",      (string) the bitcoin address\\n\"\n+            \"    \\\"account\\\" : \\\"account\\\",      (string) DEPRECATED. The associated account, or \\\"\\\" for the default account\\n\"\n+            \"    \\\"scriptPubKey\\\" : \\\"key\\\",     (string) the script key\\n\"\n+            \"    \\\"amount\\\" : x.xxx,           (numeric) the transaction output amount in \" + CURRENCY_UNIT + \"\\n\"\n+            \"    \\\"confirmations\\\" : n,        (numeric) The number of confirmations\\n\"\n+            \"    \\\"redeemScript\\\" : \\\"script\\\" | [\\\"script\\\", ... ],  (string or array) The redeemScript and/or witnessScript if using P2SH/P2WSH\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r156725891",
      "id" : 156725891,
      "original_commit_id" : "83a418da228f9c1c2759ecaf224f10ade406c489",
      "original_position" : 22,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 83242943,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708",
      "updated_at" : "2018-02-15T05:28:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156725891",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r156731671"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156731671"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "IIUC, this should never be false? Would be helpful to have a comment saying this, or else mentioning when it would be expected.",
      "commit_id" : "576624ce9567487f799d3a526b8f38b88c64ee80",
      "created_at" : "2017-12-13T17:43:17Z",
      "diff_hunk" : "@@ -2956,7 +2956,33 @@ UniValue listunspent(const JSONRPCRequest& request)\n                 const CScriptID& hash = boost::get<CScriptID>(address);\n                 CScript redeemScript;\n                 if (pwallet->GetCScript(hash, redeemScript)) {\n-                    entry.push_back(Pair(\"redeemScript\", HexStr(redeemScript.begin(), redeemScript.end())));\n+                    CTxDestination witness_destination;\n+                    if(redeemScript.IsPayToWitnessScriptHash() && ExtractDestination(redeemScript, witness_destination)) {\n+                        const WitnessV0ScriptHash& whash = boost::get<WitnessV0ScriptHash>(witness_destination);\n+                        CScriptID id;\n+                        CRIPEMD160().Write(whash.begin(), whash.size()).Finalize(id.begin());\n+                        CScript witnessScript;\n+                        // For compatibility with signrawtransaction, if we have both a witnessScript\n+                        // and redeemScript, return them in an array\n+                        UniValue scripts(UniValue::VARR);\n+                        scripts.push_back(HexStr(redeemScript.begin(), redeemScript.end()));\n+                        if (pwallet->GetCScript(id, witnessScript)) {\n+                            scripts.push_back(HexStr(witnessScript.begin(), witnessScript.end()));\n+                        }\n+                        entry.push_back(Pair(\"redeemScript\", scripts));\n+                    } else {\n+                        entry.push_back(Pair(\"redeemScript\", HexStr(redeemScript.begin(), redeemScript.end())));\n+                    }\n+                }\n+            }\n+\n+            if (scriptPubKey.IsPayToWitnessScriptHash()) {\n+                const WitnessV0ScriptHash& whash = boost::get<WitnessV0ScriptHash>(address);\n+                CScriptID id;\n+                CRIPEMD160().Write(whash.begin(), whash.size()).Finalize(id.begin());\n+                CScript witnessScript;\n+                if (pwallet->GetCScript(id, witnessScript)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r156731671",
      "id" : 156731671,
      "original_commit_id" : "83a418da228f9c1c2759ecaf224f10ade406c489",
      "original_position" : 59,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 83242943,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708",
      "updated_at" : "2018-02-15T05:28:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156731671",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This PR has two code review acks (from me and NicolasDorier) so maybe it is close to being merged. The remaining comments that haven't been responded to are minor and shouldn't hold this up.",
      "created_at" : "2017-12-18T14:09:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#issuecomment-352435455",
      "id" : 352435455,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11708",
      "updated_at" : "2017-12-18T14:09:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/352435455",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Addressed @ryanofsky feedback, thanks!",
      "created_at" : "2017-12-19T23:12:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#issuecomment-352915339",
      "id" : 352915339,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11708",
      "updated_at" : "2017-12-19T23:12:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/352915339",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r157901984"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157901984"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Missing error when not string or array? Suggestion (`scripts` is a vector of strings):\r\n```cpp\r\nif (rs.getType() == UniValue::VARR) {\r\n    for (auto r : rs.getValues()) {\r\n         scripts.push_back(r.get_str());\r\n    }\r\n} else {\r\n    scripts.push_back(rs.get_str());\r\n}\r\n```",
      "commit_id" : "576624ce9567487f799d3a526b8f38b88c64ee80",
      "created_at" : "2017-12-19T23:19:33Z",
      "diff_hunk" : "@@ -822,20 +822,23 @@ UniValue signrawtransaction(const JSONRPCRequest& request)\n                 view.AddCoin(out, std::move(newcoin), true);\n             }\n \n-            // if redeemScript given and not using the local wallet (private keys\n-            // given), add redeemScript to the tempKeystore so it can be signed:\n-            if (fGivenKeys && (scriptPubKey.IsPayToScriptHash() || scriptPubKey.IsPayToWitnessScriptHash())) {\n-                RPCTypeCheckObj(prevOut,\n-                    {\n-                        {\"txid\", UniValueType(UniValue::VSTR)},\n-                        {\"vout\", UniValueType(UniValue::VNUM)},\n-                        {\"scriptPubKey\", UniValueType(UniValue::VSTR)},\n-                        {\"redeemScript\", UniValueType(UniValue::VSTR)},\n-                    });\n-                UniValue v = find_value(prevOut, \"redeemScript\");\n-                if (!v.isNull()) {\n-                    std::vector<unsigned char> rsData(ParseHexV(v, \"redeemScript\"));\n-                    CScript redeemScript(rsData.begin(), rsData.end());\n+            // if redeemScript given add redeemScript to the tempKeystore so it can be signed:\n+            if (scriptPubKey.IsPayToScriptHash() || scriptPubKey.IsPayToWitnessScriptHash()) {\n+                UniValue rs = find_value(prevOut, \"redeemScript\");\n+                if (!fGivenKeys && rs != NullUniValue) {\n+                    // if private keys aren't given, assume we are using the local wallet, so we should not accept scripts\n+                    throw JSONRPCError(RPC_INVALID_PARAMETER, \"Scripts cannot be provided when using local wallet\");  \n+                }\n+                std::vector<UniValue> scripts;\n+                if (rs.getType() == UniValue::VSTR) {\n+                    scripts.push_back(rs);\n+                } else if (rs.getType() == UniValue::VARR) {\n+                    // If redeemScript is an array, iterate over all scripts provided\n+                    scripts = rs.getValues();\n+                }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r157901984",
      "id" : 157901984,
      "original_commit_id" : "5749f261df039d5b49e240b2e5d9e86e4d69b2a0",
      "original_position" : 40,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 84622752,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708",
      "updated_at" : "2018-02-15T05:28:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157901984",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r157913677"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157913677"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nice idea, done, thanks :)",
      "commit_id" : "576624ce9567487f799d3a526b8f38b88c64ee80",
      "created_at" : "2017-12-20T00:44:39Z",
      "diff_hunk" : "@@ -822,20 +822,23 @@ UniValue signrawtransaction(const JSONRPCRequest& request)\n                 view.AddCoin(out, std::move(newcoin), true);\n             }\n \n-            // if redeemScript given and not using the local wallet (private keys\n-            // given), add redeemScript to the tempKeystore so it can be signed:\n-            if (fGivenKeys && (scriptPubKey.IsPayToScriptHash() || scriptPubKey.IsPayToWitnessScriptHash())) {\n-                RPCTypeCheckObj(prevOut,\n-                    {\n-                        {\"txid\", UniValueType(UniValue::VSTR)},\n-                        {\"vout\", UniValueType(UniValue::VNUM)},\n-                        {\"scriptPubKey\", UniValueType(UniValue::VSTR)},\n-                        {\"redeemScript\", UniValueType(UniValue::VSTR)},\n-                    });\n-                UniValue v = find_value(prevOut, \"redeemScript\");\n-                if (!v.isNull()) {\n-                    std::vector<unsigned char> rsData(ParseHexV(v, \"redeemScript\"));\n-                    CScript redeemScript(rsData.begin(), rsData.end());\n+            // if redeemScript given add redeemScript to the tempKeystore so it can be signed:\n+            if (scriptPubKey.IsPayToScriptHash() || scriptPubKey.IsPayToWitnessScriptHash()) {\n+                UniValue rs = find_value(prevOut, \"redeemScript\");\n+                if (!fGivenKeys && rs != NullUniValue) {\n+                    // if private keys aren't given, assume we are using the local wallet, so we should not accept scripts\n+                    throw JSONRPCError(RPC_INVALID_PARAMETER, \"Scripts cannot be provided when using local wallet\");  \n+                }\n+                std::vector<UniValue> scripts;\n+                if (rs.getType() == UniValue::VSTR) {\n+                    scripts.push_back(rs);\n+                } else if (rs.getType() == UniValue::VARR) {\n+                    // If redeemScript is an array, iterate over all scripts provided\n+                    scripts = rs.getValues();\n+                }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r157913677",
      "id" : 157913677,
      "in_reply_to_id" : 157901984,
      "original_commit_id" : "5749f261df039d5b49e240b2e5d9e86e4d69b2a0",
      "original_position" : 40,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 84636306,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708",
      "updated_at" : "2018-02-15T05:28:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157913677",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Feedback addressed, fixup commits squashed into one cleanup commit",
      "created_at" : "2017-12-21T00:29:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#issuecomment-353222613",
      "id" : 353222613,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11708",
      "updated_at" : "2017-12-21T00:29:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/353222613",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r158171159"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158171159"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This `redeemScript` parameter was being silently ignored until now, because scripts are not used by signrawtransaction if no keys are passed in (the internal wallet is used instead). New code returns an error instead of silently ignoring it, so it was removed.",
      "commit_id" : "576624ce9567487f799d3a526b8f38b88c64ee80",
      "created_at" : "2017-12-21T00:30:43Z",
      "diff_hunk" : "@@ -180,7 +180,7 @@ def run_test(self):\n                 break\n \n         bal = self.nodes[0].getbalance()\n-        inputs = [{ \"txid\" : txId, \"vout\" : vout['n'], \"scriptPubKey\" : vout['scriptPubKey']['hex'], \"redeemScript\" : mSigObjValid['hex']}]\n+        inputs = [{ \"txid\" : txId, \"vout\" : vout['n'], \"scriptPubKey\" : vout['scriptPubKey']['hex']}]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r158171159",
      "id" : 158171159,
      "original_commit_id" : "50074643f20cc36e6ffbbec22f1c850c6e9a3207",
      "original_position" : 5,
      "path" : "test/functional/rawtransactions.py",
      "position" : null,
      "pull_request_review_id" : 84938577,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708",
      "updated_at" : "2018-02-15T05:28:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158171159",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r158310307"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158310307"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Could use const reference to avoid string copy here (though there are more copies below anyway).",
      "commit_id" : "576624ce9567487f799d3a526b8f38b88c64ee80",
      "created_at" : "2017-12-21T15:49:43Z",
      "diff_hunk" : "@@ -822,20 +822,27 @@ UniValue signrawtransaction(const JSONRPCRequest& request)\n                 view.AddCoin(out, std::move(newcoin), true);\n             }\n \n-            // if redeemScript given and not using the local wallet (private keys\n-            // given), add redeemScript to the tempKeystore so it can be signed:\n-            if (fGivenKeys && (scriptPubKey.IsPayToScriptHash() || scriptPubKey.IsPayToWitnessScriptHash())) {\n-                UniValue rs = find_value(prevOut, \"redeemScript\");\n-                std::vector<UniValue> scripts;\n-                if (rs.getType() == UniValue::VSTR) {\n-                    scripts.push_back(rs);\n-                } else if (rs.getType() == UniValue::VARR) {\n+            // if redeemScript given add redeemScript to the tempKeystore so it can be signed:\n+            UniValue rs = find_value(prevOut, \"redeemScript\");\n+            if (rs.getType() != UniValue::VNULL) {\n+                if (!(scriptPubKey.IsPayToScriptHash() || scriptPubKey.IsPayToWitnessScriptHash())) {\n+                    // if this isnt P2SH or P2WSH, scripts should not be provided\n+                    throw JSONRPCError(RPC_INVALID_PARAMETER, \"Scripts should not be provided if P2SH or P2WSH are not being used\");\n+                } else if (!fGivenKeys) {\n+                    // if private keys aren't given, assume we are using the local wallet, so we should not accept scripts\n+                    throw JSONRPCError(RPC_INVALID_PARAMETER, \"Scripts cannot be provided when using local wallet (no keys given)\");\n+                }\n+                std::vector<std::string> scripts;\n+                if (rs.getType() == UniValue::VARR) {\n                     // If redeemScript is an array, iterate over all scripts provided\n-                    scripts = rs.getValues();\n+                    for (auto r : rs.getValues()) {\n+                        scripts.push_back(r.get_str());\n+                    }\n+                } else {\n+                    scripts.push_back(rs.get_str());\n                 }\n-                for (const UniValue& script : scripts) {\n-                    if (script.getType() != UniValue::VSTR) continue;\n-                    std::vector<unsigned char> script_data(ParseHexV(script.get_str(), \"redeemScript\"));\n+                for (const std::string script : scripts) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r158310307",
      "id" : 158310307,
      "original_commit_id" : "50074643f20cc36e6ffbbec22f1c850c6e9a3207",
      "original_position" : 35,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 85101101,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708",
      "updated_at" : "2018-02-15T05:28:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158310307",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r158310778"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158310778"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Could use const auto& to avoid univalue copies",
      "commit_id" : "576624ce9567487f799d3a526b8f38b88c64ee80",
      "created_at" : "2017-12-21T15:51:23Z",
      "diff_hunk" : "@@ -822,20 +822,27 @@ UniValue signrawtransaction(const JSONRPCRequest& request)\n                 view.AddCoin(out, std::move(newcoin), true);\n             }\n \n-            // if redeemScript given and not using the local wallet (private keys\n-            // given), add redeemScript to the tempKeystore so it can be signed:\n-            if (fGivenKeys && (scriptPubKey.IsPayToScriptHash() || scriptPubKey.IsPayToWitnessScriptHash())) {\n-                UniValue rs = find_value(prevOut, \"redeemScript\");\n-                std::vector<UniValue> scripts;\n-                if (rs.getType() == UniValue::VSTR) {\n-                    scripts.push_back(rs);\n-                } else if (rs.getType() == UniValue::VARR) {\n+            // if redeemScript given add redeemScript to the tempKeystore so it can be signed:\n+            UniValue rs = find_value(prevOut, \"redeemScript\");\n+            if (rs.getType() != UniValue::VNULL) {\n+                if (!(scriptPubKey.IsPayToScriptHash() || scriptPubKey.IsPayToWitnessScriptHash())) {\n+                    // if this isnt P2SH or P2WSH, scripts should not be provided\n+                    throw JSONRPCError(RPC_INVALID_PARAMETER, \"Scripts should not be provided if P2SH or P2WSH are not being used\");\n+                } else if (!fGivenKeys) {\n+                    // if private keys aren't given, assume we are using the local wallet, so we should not accept scripts\n+                    throw JSONRPCError(RPC_INVALID_PARAMETER, \"Scripts cannot be provided when using local wallet (no keys given)\");\n+                }\n+                std::vector<std::string> scripts;\n+                if (rs.getType() == UniValue::VARR) {\n                     // If redeemScript is an array, iterate over all scripts provided\n-                    scripts = rs.getValues();\n+                    for (auto r : rs.getValues()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r158310778",
      "id" : 158310778,
      "original_commit_id" : "50074643f20cc36e6ffbbec22f1c850c6e9a3207",
      "original_position" : 26,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 85101101,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708",
      "updated_at" : "2018-02-15T05:28:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158310778",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r158313209"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158313209"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe s/should not accept/don't currently support accepting/. This seems more like a reasonable limitation of the current implementation than a desirable feature of it.",
      "commit_id" : "576624ce9567487f799d3a526b8f38b88c64ee80",
      "created_at" : "2017-12-21T16:00:19Z",
      "diff_hunk" : "@@ -822,20 +822,27 @@ UniValue signrawtransaction(const JSONRPCRequest& request)\n                 view.AddCoin(out, std::move(newcoin), true);\n             }\n \n-            // if redeemScript given and not using the local wallet (private keys\n-            // given), add redeemScript to the tempKeystore so it can be signed:\n-            if (fGivenKeys && (scriptPubKey.IsPayToScriptHash() || scriptPubKey.IsPayToWitnessScriptHash())) {\n-                UniValue rs = find_value(prevOut, \"redeemScript\");\n-                std::vector<UniValue> scripts;\n-                if (rs.getType() == UniValue::VSTR) {\n-                    scripts.push_back(rs);\n-                } else if (rs.getType() == UniValue::VARR) {\n+            // if redeemScript given add redeemScript to the tempKeystore so it can be signed:\n+            UniValue rs = find_value(prevOut, \"redeemScript\");\n+            if (rs.getType() != UniValue::VNULL) {\n+                if (!(scriptPubKey.IsPayToScriptHash() || scriptPubKey.IsPayToWitnessScriptHash())) {\n+                    // if this isnt P2SH or P2WSH, scripts should not be provided\n+                    throw JSONRPCError(RPC_INVALID_PARAMETER, \"Scripts should not be provided if P2SH or P2WSH are not being used\");\n+                } else if (!fGivenKeys) {\n+                    // if private keys aren't given, assume we are using the local wallet, so we should not accept scripts",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r158313209",
      "id" : 158313209,
      "original_commit_id" : "50074643f20cc36e6ffbbec22f1c850c6e9a3207",
      "original_position" : 19,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 85101101,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708",
      "updated_at" : "2018-02-15T05:28:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158313209",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Fixed @ryanofsky's comments, thanks :) Haven't tested CLI yet though",
      "created_at" : "2017-12-24T02:32:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#issuecomment-353761566",
      "id" : 353761566,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11708",
      "updated_at" : "2017-12-24T02:33:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/353761566",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased to fix merge conflict in rawtransactions.py",
      "created_at" : "2018-01-17T00:51:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#issuecomment-358157946",
      "id" : 358157946,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11708",
      "updated_at" : "2018-01-17T00:52:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/358157946",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "Concept ACK. Rebase/squash last commit?",
      "created_at" : "2018-02-12T23:53:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#issuecomment-365103590",
      "id" : 365103590,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11708",
      "updated_at" : "2018-02-12T23:53:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/365103590",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sipa done :)",
      "created_at" : "2018-02-13T08:10:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#issuecomment-365181850",
      "id" : 365181850,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11708",
      "updated_at" : "2018-02-13T08:10:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/365181850",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r172907581"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172907581"
         }
      },
      "author_association" : "MEMBER",
      "body" : "IIRC, Pair push_backs were just cleaned up... :/",
      "commit_id" : "576624ce9567487f799d3a526b8f38b88c64ee80",
      "created_at" : "2018-03-07T16:47:01Z",
      "diff_hunk" : "@@ -3017,7 +3017,34 @@ UniValue listunspent(const JSONRPCRequest& request)\n                 const CScriptID& hash = boost::get<CScriptID>(address);\n                 CScript redeemScript;\n                 if (pwallet->GetCScript(hash, redeemScript)) {\n-                    entry.pushKV(\"redeemScript\", HexStr(redeemScript.begin(), redeemScript.end()));\n+                    CTxDestination witness_destination;\n+                    if (redeemScript.IsPayToWitnessScriptHash() && ExtractDestination(redeemScript, witness_destination)) {\n+                        const WitnessV0ScriptHash& whash = boost::get<WitnessV0ScriptHash>(witness_destination);\n+                        CScriptID id;\n+                        CRIPEMD160().Write(whash.begin(), whash.size()).Finalize(id.begin());\n+                        CScript witnessScript;\n+                        // For compatibility with signrawtransaction, if we have both a witnessScript\n+                        // and redeemScript, return them in an array\n+                        UniValue scripts(UniValue::VARR);\n+                        scripts.push_back(HexStr(redeemScript.begin(), redeemScript.end()));\n+                        if (pwallet->GetCScript(id, witnessScript)) {\n+                            scripts.push_back(HexStr(witnessScript.begin(), witnessScript.end()));\n+                        }\n+                        entry.push_back(Pair(\"redeemScript\", scripts));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r172907581",
      "id" : 172907581,
      "original_commit_id" : "576624ce9567487f799d3a526b8f38b88c64ee80",
      "original_position" : 47,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 47,
      "pull_request_review_id" : 102006213,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708",
      "updated_at" : "2018-03-07T16:47:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172907581",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r173169372"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/173169372"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, this needs a large rebase and cleanup anyway now signrawtransaction was split up, things like this will be done at the same time when I get onto this",
      "commit_id" : "576624ce9567487f799d3a526b8f38b88c64ee80",
      "created_at" : "2018-03-08T14:16:47Z",
      "diff_hunk" : "@@ -3017,7 +3017,34 @@ UniValue listunspent(const JSONRPCRequest& request)\n                 const CScriptID& hash = boost::get<CScriptID>(address);\n                 CScript redeemScript;\n                 if (pwallet->GetCScript(hash, redeemScript)) {\n-                    entry.pushKV(\"redeemScript\", HexStr(redeemScript.begin(), redeemScript.end()));\n+                    CTxDestination witness_destination;\n+                    if (redeemScript.IsPayToWitnessScriptHash() && ExtractDestination(redeemScript, witness_destination)) {\n+                        const WitnessV0ScriptHash& whash = boost::get<WitnessV0ScriptHash>(witness_destination);\n+                        CScriptID id;\n+                        CRIPEMD160().Write(whash.begin(), whash.size()).Finalize(id.begin());\n+                        CScript witnessScript;\n+                        // For compatibility with signrawtransaction, if we have both a witnessScript\n+                        // and redeemScript, return them in an array\n+                        UniValue scripts(UniValue::VARR);\n+                        scripts.push_back(HexStr(redeemScript.begin(), redeemScript.end()));\n+                        if (pwallet->GetCScript(id, witnessScript)) {\n+                            scripts.push_back(HexStr(witnessScript.begin(), witnessScript.end()));\n+                        }\n+                        entry.push_back(Pair(\"redeemScript\", scripts));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r173169372",
      "id" : 173169372,
      "in_reply_to_id" : 172907581,
      "original_commit_id" : "576624ce9567487f799d3a526b8f38b88c64ee80",
      "original_position" : 47,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 47,
      "pull_request_review_id" : 102312267,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708",
      "updated_at" : "2018-03-08T14:16:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/173169372",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r173895182"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/173895182"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is there a reason to break the API here? Why not add a new key for the witnessScript?",
      "commit_id" : "576624ce9567487f799d3a526b8f38b88c64ee80",
      "created_at" : "2018-03-12T18:09:03Z",
      "diff_hunk" : "@@ -63,6 +63,14 @@ RPC changes\n \n - The `fundrawtransaction` rpc will reject the previously deprecated `reserveChangeKey` option.\n \n+- The `redeemScript` for each of the `prevtxs` given to `signrawtransaction` can now optionally be an array\n+  of scripts, so both the redeemScript and witnessScript for P2SH-P2WSH addresses can be passed in.\n+\n+- The `listunspent` output will now return an array of scripts as the `redeemScript` in the case of P2SH-P2WSH,\n+  for compatibility with the `signrawtransaction` change above. In other cases, `listunspent` will continue to return\n+  the only `redeemScript` as a string, as before.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r173895182",
      "id" : 173895182,
      "original_commit_id" : "576624ce9567487f799d3a526b8f38b88c64ee80",
      "original_position" : 9,
      "path" : "doc/release-notes.md",
      "position" : 9,
      "pull_request_review_id" : 103159352,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708",
      "updated_at" : "2018-03-12T18:09:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/173895182",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r173975419"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/173975419"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The API only breaks in the case of P2SH-P2WSH which was not supported at all before anyway. Adding a new key for witnessScript to listunspent would make its output incompatible with the signrawtransaction input which expects a list of scripts in this case",
      "commit_id" : "576624ce9567487f799d3a526b8f38b88c64ee80",
      "created_at" : "2018-03-12T23:13:46Z",
      "diff_hunk" : "@@ -63,6 +63,14 @@ RPC changes\n \n - The `fundrawtransaction` rpc will reject the previously deprecated `reserveChangeKey` option.\n \n+- The `redeemScript` for each of the `prevtxs` given to `signrawtransaction` can now optionally be an array\n+  of scripts, so both the redeemScript and witnessScript for P2SH-P2WSH addresses can be passed in.\n+\n+- The `listunspent` output will now return an array of scripts as the `redeemScript` in the case of P2SH-P2WSH,\n+  for compatibility with the `signrawtransaction` change above. In other cases, `listunspent` will continue to return\n+  the only `redeemScript` as a string, as before.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r173975419",
      "id" : 173975419,
      "in_reply_to_id" : 173895182,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3Mzk3NTQxOQ==",
      "original_commit_id" : "576624ce9567487f799d3a526b8f38b88c64ee80",
      "original_position" : 9,
      "path" : "doc/release-notes.md",
      "position" : 9,
      "pull_request_review_id" : 103252556,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708",
      "updated_at" : "2018-03-12T23:13:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/173975419",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Needs rebase",
      "created_at" : "2018-08-25T16:35:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#issuecomment-415981158",
      "id" : 415981158,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11708",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQxNTk4MTE1OA==",
      "updated_at" : "2018-08-25T16:35:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/415981158",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r214549024"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/214549024"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Typo found by `codespell`: Ã¢ÂÂisntÃ¢ÂÂ should be Ã¢ÂÂisnÃ¢ÂÂtÃ¢ÂÂ or Ã¢ÂÂis notÃ¢ÂÂ :-)",
      "commit_id" : "576624ce9567487f799d3a526b8f38b88c64ee80",
      "created_at" : "2018-09-02T18:25:47Z",
      "diff_hunk" : "@@ -833,20 +833,28 @@ UniValue signrawtransaction(const JSONRPCRequest& request)\n                 view.AddCoin(out, std::move(newcoin), true);\n             }\n \n-            // if redeemScript given and not using the local wallet (private keys\n-            // given), add redeemScript to the tempKeystore so it can be signed:\n-            if (fGivenKeys && (scriptPubKey.IsPayToScriptHash() || scriptPubKey.IsPayToWitnessScriptHash())) {\n-                RPCTypeCheckObj(prevOut,\n-                    {\n-                        {\"txid\", UniValueType(UniValue::VSTR)},\n-                        {\"vout\", UniValueType(UniValue::VNUM)},\n-                        {\"scriptPubKey\", UniValueType(UniValue::VSTR)},\n-                        {\"redeemScript\", UniValueType(UniValue::VSTR)},\n-                    });\n-                UniValue v = find_value(prevOut, \"redeemScript\");\n-                if (!v.isNull()) {\n-                    std::vector<unsigned char> rsData(ParseHexV(v, \"redeemScript\"));\n-                    CScript redeemScript(rsData.begin(), rsData.end());\n+            // if redeemScript given add redeemScript to the tempKeystore so it can be signed:\n+            UniValue rs = find_value(prevOut, \"redeemScript\");\n+            if (rs.getType() != UniValue::VNULL) {\n+                if (!(scriptPubKey.IsPayToScriptHash() || scriptPubKey.IsPayToWitnessScriptHash())) {\n+                    // if this isnt P2SH or P2WSH, scripts should not be provided",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r214549024",
      "id" : 214549024,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNDU0OTAyNA==",
      "original_commit_id" : "576624ce9567487f799d3a526b8f38b88c64ee80",
      "original_position" : 31,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : 31,
      "pull_request_review_id" : 151629121,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708",
      "updated_at" : "2018-09-02T18:25:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/214549024",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Closing this, replaced by #14481",
      "created_at" : "2018-10-15T05:49:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#issuecomment-429716224",
      "id" : 429716224,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11708",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyOTcxNjIyNA==",
      "updated_at" : "2018-10-15T05:49:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/429716224",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@fanquake This should be removed from 'In Progress' in 'Segwit' and https://github.com/bitcoin/bitcoin/pull/14481 perhaps added?",
      "created_at" : "2018-11-06T23:30:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#issuecomment-436447889",
      "id" : 436447889,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11708",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNjQ0Nzg4OQ==",
      "updated_at" : "2018-11-06T23:30:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/436447889",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/24482484?v=4",
         "events_url" : "https://api.github.com/users/Rspigler/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Rspigler/followers",
         "following_url" : "https://api.github.com/users/Rspigler/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Rspigler/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Rspigler",
         "id" : 24482484,
         "login" : "Rspigler",
         "node_id" : "MDQ6VXNlcjI0NDgyNDg0",
         "organizations_url" : "https://api.github.com/users/Rspigler/orgs",
         "received_events_url" : "https://api.github.com/users/Rspigler/received_events",
         "repos_url" : "https://api.github.com/users/Rspigler/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Rspigler/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Rspigler/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Rspigler"
      }
   }
]
