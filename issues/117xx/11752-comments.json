[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Note that in this case things aren't \"resynced over the network\" they are loaded back from disk. Sadly, not a ton do be done about this - trying to flush as we go would limit sync speed. Ideally we'd be looking at the memory pressure in systems to flush when necessary, or at least partially flush, but that's a rather large change.\n\nOn November 22, 2017 9:46:39 AM PST, PolarGo <notifications@github.com> wrote:\n>SITUATION:\n>After starting a fresh installed bitcoind it starts to sync blocks.\n>After several hours bitcoind abort with error \"out of memory\". The\n>machine I'm using has 1 GB RAM. I had no swap partition active.\n>\n>The process runs under runit; when it aborts it gets automatically\n>restarted.\n>\n>Now bitcoind starts re-syncing from the beginning, instead of starting\n>from where it left off.\n>\n>PROBLEM:\n>That creates a lot of unnecessary traffic (many GB) and unnecessary\n>time delay (many hours).\n>\n>EXPECTED:\n>After an error (in this case out of memory), bitcoind should start from\n>where it left of without wasting time and IP bandwidth.\n>\n>After I realized this, I added swap space, but still, everything has to\n>be resynced over the network.\n>\n>bitcoin 0.15\n>OS: void linux\n>RAM: 1GB\n>CPU: via-c7-D i686\n>\n>\n>\n>-- \n>You are receiving this because you are subscribed to this thread.\n>Reply to this email directly or view it on GitHub:\n>https://github.com/bitcoin/bitcoin/issues/11752\n",
      "created_at" : "2017-11-22T19:30:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/11752#issuecomment-346451391",
      "id" : 346451391,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11752",
      "updated_at" : "2017-11-22T19:30:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/346451391",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Starting again from the scratch has probably to do with corruptions or un-flushed data. Check or pastebin your `debug.log` for more details.\r\n\r\nIf you have only 1GB of memory, try reduce some parameters.\r\n`-dbcache=50`\r\n`-maxmempool=10`\r\n",
      "created_at" : "2017-11-22T19:30:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/11752#issuecomment-346451450",
      "id" : 346451450,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11752",
      "updated_at" : "2017-11-22T19:30:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/346451450",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Ok, maybe it didn't start from scratch; but it looks like it went back in time for more than a year (2013-05-22 => 2012-03-11).\r\n\r\nI wonder what the best course of action is: Just restart the process when it runs out of memory and don't add swap space. Or add swap space, but that will probably make things much slower?\r\n\r\nOnce all blocks are synced (and assumed that I run the node continuously) will it still run out of memory or is this just a special thing during initial syncing?\r\n\r\n-------------------\r\n\r\n2017-11-22 15:39:52 Error: Out of memory. Terminating.\r\n[...]\r\n2017-11-22 15:39:55 Bitcoin version v0.15.1.0-g7b57bc9\r\n2017-11-22 15:39:55 Assuming ancestors of block 0000000000000000003b9ce759c2a087d52abc4266f8f4ebd6d768b89defa50a have valid signatures.\r\n2017-11-22 15:39:55 Setting nMinimumChainWork=000000000000000000000000000000000000000000723d3581fe1bd55373540a\r\n[...]\r\n2017-11-22 15:39:58 Using 16 MiB out of 32/2 requested for signature cache, able to store 524288 elements\r\n2017-11-22 15:39:58 Using 16 MiB out of 32/2 requested for script execution cache, able to store 524288 elements\r\n2017-11-22 15:39:58 Using 0 threads for script verification\r\n2017-11-22 15:39:58 scheduler thread start\r\n[...]\r\n2017-11-22 15:39:58 * Using 440.0MiB for in-memory UTXO set (plus up to 286.1MiB of unused mempool space)\r\n2017-11-22 15:39:58 init message: Loading block index...\r\n2017-11-22 15:39:58 Opening LevelDB in /data/bitcoin/blocks/index\r\n2017-11-22 15:40:08 Opened LevelDB successfully\r\n2017-11-22 15:40:08 Using obfuscation key for /data/bitcoin/blocks/index: 0000000000000000\r\n2017-11-22 15:41:17 LoadBlockIndexDB: last block file = 62\r\n2017-11-22 15:41:17 LoadBlockIndexDB: last block file info: CBlockFileInfo(blocks=257, size=39918830, heights=237412...237699, time=**2013-05-22...2013-05-24**)\r\n2017-11-22 15:41:17 Checking all blk files are present...\r\n2017-11-22 15:41:17 LoadBlockIndexDB: transaction index disabled\r\n2017-11-22 15:41:17 Opening LevelDB in /data/bitcoin/chainstate\r\n2017-11-22 15:41:30 Opened LevelDB successfully\r\n2017-11-22 15:41:32 Using obfuscation key for /data/bitcoin/chainstate: d337b51226b6028e\r\n2017-11-22 15:41:32 Loaded best chain: hashBestChain=000000000000057da116560f22fbfbe62f365c7b92282a88894065566141a474 height=170672 date=2012-03-11 14:54:17 progress=0.009494\r\n2017-11-22 15:41:32 init message: Rewinding blocks...\r\n2017-11-22 15:41:43 init message: Verifying blocks...\r\n2017-11-22 15:41:43 Verifying last 6 blocks at level 3\r\n2017-11-22 15:41:43 [0%]...[16%]...[33%]...[50%]...[66%]...[83%]...[99%]...[DONE].\r\n2017-11-22 15:41:52 No coin database inconsistencies in last 7 blocks (329 transactions)\r\n2017-11-22 15:41:52  block index          113584ms\r\n2017-11-22 15:41:52 init message: Loading wallet...\r\n2017-11-22 15:41:52 nFileVersion = 150100\r\n2017-11-22 15:41:52 Keys: 2002 plaintext, 0 encrypted, 2002 w/ metadata, 2002 total\r\n2017-11-22 15:41:53  wallet                 1432ms\r\n2017-11-22 15:41:53 setKeyPool.size() = 2000\r\n2017-11-22 15:41:53 mapWallet.size() = 0\r\n2017-11-22 15:41:53 mapAddressBook.size() = 1\r\n2017-11-22 15:41:53 mapBlockIndex.size() = 495578\r\n2017-11-22 15:41:53 nBestHeight = 170672\r\n[...]\r\n2017-11-22 15:41:53 torcontrol thread start\r\n2017-11-22 15:41:56 Bound to [::]:8333\r\n2017-11-22 15:41:56 Bound to 0.0.0.0:8333\r\n2017-11-22 15:41:56 init message: Loading P2P addresses...\r\n2017-11-22 15:41:57 UpdateTip: new best=00000000000000059e8f079529be7ef2b0478b64f23bc35f4ff869adfc22e7b1 height=170673 version=0x00000001 log2_work=67.818878 tx=2595833 date='**2012-03-11 15:08:00**' progress=0.009495 cache=0.1MiB(518txo)\r\n",
      "created_at" : "2017-11-22T19:55:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/11752#issuecomment-346457326",
      "id" : 346457326,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11752",
      "updated_at" : "2017-11-22T19:55:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/346457326",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/33907525?v=4",
         "events_url" : "https://api.github.com/users/PolarGo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/PolarGo/followers",
         "following_url" : "https://api.github.com/users/PolarGo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/PolarGo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/PolarGo",
         "id" : 33907525,
         "login" : "PolarGo",
         "organizations_url" : "https://api.github.com/users/PolarGo/orgs",
         "received_events_url" : "https://api.github.com/users/PolarGo/received_events",
         "repos_url" : "https://api.github.com/users/PolarGo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/PolarGo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/PolarGo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/PolarGo"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "PS:\r\nand that is the last line before \"out of memory\":\r\n\r\n2017-11-22 15:39:52 UpdateTip: new best=00000000000000156d9f3470de536cf7163ff34a698831ebfd8de211ca192eb5 height=246038 version=0x00000002 log2_work=70.679583 tx=20547163 date='2013-07-11 13:41:25' progress=0.075154 cache=624.4MiB(6466675txo)\r\n",
      "created_at" : "2017-11-22T19:57:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/11752#issuecomment-346457885",
      "id" : 346457885,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11752",
      "updated_at" : "2017-11-22T19:57:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/346457885",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/33907525?v=4",
         "events_url" : "https://api.github.com/users/PolarGo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/PolarGo/followers",
         "following_url" : "https://api.github.com/users/PolarGo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/PolarGo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/PolarGo",
         "id" : 33907525,
         "login" : "PolarGo",
         "organizations_url" : "https://api.github.com/users/PolarGo/orgs",
         "received_events_url" : "https://api.github.com/users/PolarGo/received_events",
         "repos_url" : "https://api.github.com/users/PolarGo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/PolarGo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/PolarGo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/PolarGo"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Out of memory can cause corruptions. Just restating with runit is not a solution.\r\nWhat you need to do is reduce memory usage on your system. Remove all unnecessary applications and optimise bitcoin core.\r\n\r\nCreate a `bitcoin.conf` and add something like that into you config\r\n```conf\r\ndbcache=20\r\nmaxconnections=3\r\npar=2\r\nmaxmempool=50\r\n```\r\n\r\nThis should allow you to no longer run out of memory.",
      "created_at" : "2017-11-22T19:58:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/11752#issuecomment-346458242",
      "id" : 346458242,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11752",
      "updated_at" : "2017-11-22T19:58:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/346458242",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "ok, thanks, will try that.\r\n\r\nhowever, it's not hard for bitcoind to determine the amount of RAM in the system and adjust these values to some workable default values (like ones you just mentioned).",
      "created_at" : "2017-11-22T20:01:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/11752#issuecomment-346458830",
      "id" : 346458830,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11752",
      "updated_at" : "2017-11-22T20:01:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/346458830",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/33907525?v=4",
         "events_url" : "https://api.github.com/users/PolarGo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/PolarGo/followers",
         "following_url" : "https://api.github.com/users/PolarGo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/PolarGo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/PolarGo",
         "id" : 33907525,
         "login" : "PolarGo",
         "organizations_url" : "https://api.github.com/users/PolarGo/orgs",
         "received_events_url" : "https://api.github.com/users/PolarGo/received_events",
         "repos_url" : "https://api.github.com/users/PolarGo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/PolarGo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/PolarGo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/PolarGo"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Out of memory should absolutely never cause corruption! In case you run out of memory you will see it \"resync\" after restarting because of unflushed data which needs to be reconnected. As @jonasschnelli points out, try things to reduce memory usage. For further questions, please see the Bitcoin Stack Exchange.\n\nOn November 22, 2017 11:58:57 AM PST, Jonas Schnelli <notifications@github.com> wrote:\n>Out of memory can cause corruptions. Just restating with runit is not a\n>solution.\n>What you need to do is reduce memory usage on your system. Remove all\n>unnecessary applications and optimise bitcoin core.\n>\n>Create a `bitcoin.conf` and add something like that into you config\n>```conf\n>dbcache=20\n>maxconnections=3\n>par=2\n>maxmempool=50\n>```\n>\n>This should allow you to no longer run out of memory.\n>\n>-- \n>You are receiving this because you commented.\n>Reply to this email directly or view it on GitHub:\n>https://github.com/bitcoin/bitcoin/issues/11752#issuecomment-346458242\n",
      "created_at" : "2017-11-22T20:01:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/11752#issuecomment-346458912",
      "id" : 346458912,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11752",
      "updated_at" : "2017-11-22T20:01:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/346458912",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   }
]
