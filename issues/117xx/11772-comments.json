[
   {
      "author_association" : "MEMBER",
      "body" : "This requires rebase, but I'll leave it as it is until #11771 is reviewed/merged.",
      "created_at" : "2017-12-02T16:24:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11772#issuecomment-348702666",
      "id" : 348702666,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11772",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM0ODcwMjY2Ng==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/348702666/reactions"
      },
      "updated_at" : "2017-12-02T16:24:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/348702666",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11772#discussion_r158124110"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11772"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158124110"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"Change invalidblockrequest to use BitcoinTestFramework\"\r\n\r\nMaybe avoid 0x prefix here and above by calling int(hash, 16)",
      "commit_id" : "e97b113b049fa1ca7152373d6ea911d56bf7ef4e",
      "created_at" : "2017-12-20T20:09:47Z",
      "diff_hunk" : "@@ -11,68 +11,64 @@\n re-requested.\n \"\"\"\n import copy\n-import time\n \n from test_framework.blocktools import create_block, create_coinbase, create_transaction\n-from test_framework.comptool import RejectResult, TestInstance, TestManager\n from test_framework.messages import COIN\n-from test_framework.mininode import network_thread_start\n-from test_framework.test_framework import ComparisonTestFramework\n+from test_framework.mininode import network_thread_start, P2PStub\n+from test_framework.test_framework import BitcoinTestFramework\n from test_framework.util import assert_equal\n \n-class InvalidBlockRequestTest(ComparisonTestFramework):\n+class InvalidBlockRequestTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.num_nodes = 1\n         self.setup_clean_chain = True\n+        self.extra_args = [[\"-whitelist=127.0.0.1\"]]\n \n     def run_test(self):\n-        test = TestManager(self, self.options.tmpdir)\n-        test.add_all_connections(self.nodes)\n-        self.tip = None\n-        self.block_time = None\n+        # Add p2p connection to node0\n+        node = self.nodes[0]  # convenience reference to the node\n+        node.add_p2p_connection(P2PStub())\n+\n         network_thread_start()\n-        test.run()\n+        node.p2p.wait_for_verack()\n \n-    def get_tests(self):\n-        if self.tip is None:\n-            self.tip = int(\"0x\" + self.nodes[0].getbestblockhash(), 0)\n-        self.block_time = int(time.time()) + 1\n+        best_block = node.getblock(node.getbestblockhash())\n+        tip = int(\"0x\" + node.getbestblockhash(), 0)\n+        height = best_block[\"height\"] + 1\n+        block_time = best_block[\"time\"] + 1\n \n         self.log.info(\"Create a new block with an anyone-can-spend coinbase\")\n \n         height = 1\n-        block = create_block(self.tip, create_coinbase(height), self.block_time)\n-        self.block_time += 1\n+        block = create_block(tip, create_coinbase(height), block_time)\n+        block_time += 1\n         block.solve()\n         # Save the coinbase for later\n-        self.block1 = block\n-        self.tip = block.sha256\n+        block1 = block\n+        tip = block.sha256\n         height += 1\n-        yield TestInstance([[block, True]])\n+        node.p2p.send_blocks_and_test([block1], node, True)\n \n         self.log.info(\"Mature the block.\")\n+        node.generate(100)\n \n-        test = TestInstance(sync_every_block=False)\n-        for i in range(100):\n-            block = create_block(self.tip, create_coinbase(height), self.block_time)\n-            block.solve()\n-            self.tip = block.sha256\n-            self.block_time += 1\n-            test.blocks_and_transactions.append([block, True])\n-            height += 1\n-        yield test\n+        best_block = node.getblock(node.getbestblockhash())\n+        tip = int(\"0x\" + node.getbestblockhash(), 0)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11772#discussion_r158124110",
      "id" : 158124110,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1ODEyNDExMA==",
      "original_commit_id" : "62bb3a0892558cf8813a22e1bf7860598dde3441",
      "original_line" : 56,
      "original_position" : 74,
      "original_start_line" : null,
      "path" : "test/functional/invalidblockrequest.py",
      "position" : null,
      "pull_request_review_id" : 84883212,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11772",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158124110/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2018-02-14T00:04:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158124110",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This requires rebase now that #11771 has been merged.\r\n\r\nReview comments from @conscott to address in this PR:\r\n\r\n- [x] unused update to `block_time` variable can be removed (https://github.com/bitcoin/bitcoin/pull/11771#discussion_r167710791)\r\n- [x] unused update to `height` variable can be removed (https://github.com/bitcoin/bitcoin/pull/11771#pullrequestreview-95970049)\r\n- [x] `send_txs_and_test()` is never called with `sucess=True`. Either remove that variable or add a successful call to `send_txs_and_test()` to exercise code path (https://github.com/bitcoin/bitcoin/pull/11771#pullrequestreview-95979452)",
      "created_at" : "2018-02-13T13:59:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11772#issuecomment-365274328",
      "id" : 365274328,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11772",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM2NTI3NDMyOA==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/365274328/reactions"
      },
      "updated_at" : "2018-02-14T00:05:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/365274328",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks to @conscott for rebasing this and fixing up the remaining issues from #11771 and Russ's review comment.",
      "created_at" : "2018-02-14T00:05:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11772#issuecomment-365448850",
      "id" : 365448850,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11772",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM2NTQ0ODg1MA==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/365448850/reactions"
      },
      "updated_at" : "2018-02-14T00:05:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/365448850",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : ":+1: \r\n\r\nutACK https://github.com/bitcoin/bitcoin/pull/11772/commits/e97b113b049fa1ca7152373d6ea911d56bf7ef4e",
      "created_at" : "2018-02-14T22:57:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11772#issuecomment-365773014",
      "id" : 365773014,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11772",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM2NTc3MzAxNA==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/365773014/reactions"
      },
      "updated_at" : "2018-02-14T22:57:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/365773014",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK e97b113b049fa1ca7152373d6ea911d56bf7ef4e",
      "created_at" : "2018-03-13T20:56:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11772#issuecomment-372815370",
      "id" : 372815370,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11772",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM3MjgxNTM3MA==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/372815370/reactions"
      },
      "updated_at" : "2018-03-13T20:56:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/372815370",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Not an issue with your code, but __eq__() is not implemented for CTransaction, so the argument to assert is always true, since none of the tx objects are the same reference (they were copied).\r\n\r\nAgree - this assert: https://github.com/bitcoin/bitcoin/blob/00d1680498c5550e7db1f359202d3433a092fafd/test/functional/p2p_invalid_block.py#L83 should be removed in a future PR.",
      "created_at" : "2018-03-18T23:01:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11772#issuecomment-374062845",
      "id" : 374062845,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11772",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM3NDA2Mjg0NQ==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/374062845/reactions"
      },
      "updated_at" : "2018-03-18T23:01:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/374062845",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   }
]
