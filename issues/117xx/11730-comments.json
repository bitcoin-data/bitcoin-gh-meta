[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11730#discussion_r151881501"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11730"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151881501"
         }
      },
      "author_association" : "MEMBER",
      "body" : "trailing whitespace (reported by travis)",
      "commit_id" : "500cbb77bc7847431f4e9413ce34de7b7fa5ab01",
      "created_at" : "2017-11-19T22:59:47Z",
      "diff_hunk" : "@@ -3306,6 +3307,68 @@ UniValue bumpfee(const JSONRPCRequest& request)\n     return result;\n }\n \n+UniValue downgradewallet(const JSONRPCRequest& request)\n+{\n+    CWallet * const pwallet = GetWalletForJSONRPCRequest(request);\n+    if (!EnsureWalletIsAvailable(pwallet, request.fHelp)) {\n+        return NullUniValue;\n+    }\n+\n+    if (request.fHelp || request.params.size() != 1) {\n+        std::string msg = \"downgradewallet \\\"version\\\"\\n\"\n+            \"\\nDowngrades wallet for compatibilty with earlier versions. Requires a new wallet backup.\\n\"\n+\n+            \"\\nArguments:\\n\"\n+            \"1. \\\"version\\\"       (string, required) A previous version of Bitcoin Core\\n\"\n+            \n+            \"\\nSupported versions:\\n\"\n+            \"0.12 Removes HD seed. Generated addresses are preserved.\\n\"\n+            \"     Note that non-HD wallets currently can't be upgraded to HD.\\n\"\n+        ;\n+        throw std::runtime_error(msg);\n+    }\n+\n+    // Check version argument\n+    \n+    uint32_t version;\n+    std::string version_s = request.params[0].get_str(); \n+    std::smatch match;\n+    const std::regex regex(\"^(\\\\d+)\\\\.(\\\\d+)$\");\n+    if (std::regex_match (version_s, match, regex)) {\n+        uint32_t version_major = std::stoi(match[1]);\n+        uint32_t version_minor = std::stoi(match[2]);\n+        version = 1000000 * version_major + 10000 * version_minor;\n+    } else {\n+        throw JSONRPCError(RPC_INVALID_PARAMETER, \"Invalid version format, use e.g. 0.12\");\n+    }\n+    \n+    // Check against array of supported downgrade versions\n+    const std::array<uint32_t, 1> supported_versions = {{120000}};\n+    \n+    bool supported_version = std::any_of(supported_versions.begin(), supported_versions.end(), [&](uint32_t i) \n+    {\n+        return i == version;\n+    });\n+    ",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11730#discussion_r151881501",
      "id" : 151881501,
      "original_commit_id" : "500cbb77bc7847431f4e9413ce34de7b7fa5ab01",
      "original_position" : 54,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 54,
      "pull_request_review_id" : 77658861,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11730",
      "updated_at" : "2017-11-19T22:59:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151881501",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11730#discussion_r151881540"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11730"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151881540"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Not sure if you really require regex for this... although, not sure if there are downsides using regex.",
      "commit_id" : "500cbb77bc7847431f4e9413ce34de7b7fa5ab01",
      "created_at" : "2017-11-19T23:01:00Z",
      "diff_hunk" : "@@ -3306,6 +3307,68 @@ UniValue bumpfee(const JSONRPCRequest& request)\n     return result;\n }\n \n+UniValue downgradewallet(const JSONRPCRequest& request)\n+{\n+    CWallet * const pwallet = GetWalletForJSONRPCRequest(request);\n+    if (!EnsureWalletIsAvailable(pwallet, request.fHelp)) {\n+        return NullUniValue;\n+    }\n+\n+    if (request.fHelp || request.params.size() != 1) {\n+        std::string msg = \"downgradewallet \\\"version\\\"\\n\"\n+            \"\\nDowngrades wallet for compatibilty with earlier versions. Requires a new wallet backup.\\n\"\n+\n+            \"\\nArguments:\\n\"\n+            \"1. \\\"version\\\"       (string, required) A previous version of Bitcoin Core\\n\"\n+            \n+            \"\\nSupported versions:\\n\"\n+            \"0.12 Removes HD seed. Generated addresses are preserved.\\n\"\n+            \"     Note that non-HD wallets currently can't be upgraded to HD.\\n\"\n+        ;\n+        throw std::runtime_error(msg);\n+    }\n+\n+    // Check version argument\n+    \n+    uint32_t version;\n+    std::string version_s = request.params[0].get_str(); \n+    std::smatch match;\n+    const std::regex regex(\"^(\\\\d+)\\\\.(\\\\d+)$\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11730#discussion_r151881540",
      "id" : 151881540,
      "original_commit_id" : "500cbb77bc7847431f4e9413ce34de7b7fa5ab01",
      "original_position" : 38,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 38,
      "pull_request_review_id" : 77658910,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11730",
      "updated_at" : "2017-11-19T23:01:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151881540",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11730#discussion_r151881616"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11730"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151881616"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I guess this should give an error... (although this code parts is currently not reachable).",
      "commit_id" : "500cbb77bc7847431f4e9413ce34de7b7fa5ab01",
      "created_at" : "2017-11-19T23:03:37Z",
      "diff_hunk" : "@@ -3306,6 +3307,68 @@ UniValue bumpfee(const JSONRPCRequest& request)\n     return result;\n }\n \n+UniValue downgradewallet(const JSONRPCRequest& request)\n+{\n+    CWallet * const pwallet = GetWalletForJSONRPCRequest(request);\n+    if (!EnsureWalletIsAvailable(pwallet, request.fHelp)) {\n+        return NullUniValue;\n+    }\n+\n+    if (request.fHelp || request.params.size() != 1) {\n+        std::string msg = \"downgradewallet \\\"version\\\"\\n\"\n+            \"\\nDowngrades wallet for compatibilty with earlier versions. Requires a new wallet backup.\\n\"\n+\n+            \"\\nArguments:\\n\"\n+            \"1. \\\"version\\\"       (string, required) A previous version of Bitcoin Core\\n\"\n+            \n+            \"\\nSupported versions:\\n\"\n+            \"0.12 Removes HD seed. Generated addresses are preserved.\\n\"\n+            \"     Note that non-HD wallets currently can't be upgraded to HD.\\n\"\n+        ;\n+        throw std::runtime_error(msg);\n+    }\n+\n+    // Check version argument\n+    \n+    uint32_t version;\n+    std::string version_s = request.params[0].get_str(); \n+    std::smatch match;\n+    const std::regex regex(\"^(\\\\d+)\\\\.(\\\\d+)$\");\n+    if (std::regex_match (version_s, match, regex)) {\n+        uint32_t version_major = std::stoi(match[1]);\n+        uint32_t version_minor = std::stoi(match[2]);\n+        version = 1000000 * version_major + 10000 * version_minor;\n+    } else {\n+        throw JSONRPCError(RPC_INVALID_PARAMETER, \"Invalid version format, use e.g. 0.12\");\n+    }\n+    \n+    // Check against array of supported downgrade versions\n+    const std::array<uint32_t, 1> supported_versions = {{120000}};\n+    \n+    bool supported_version = std::any_of(supported_versions.begin(), supported_versions.end(), [&](uint32_t i) \n+    {\n+        return i == version;\n+    });\n+    \n+    if (!supported_version) {\n+        throw JSONRPCError(RPC_INVALID_PARAMETER, \"Wallet downgrade to \" + version_s + \" not supported\");\n+    }\n+    \n+    // Future code to downgrade to versions above 0.12 goes here.\n+\n+    if (version <= 120000) { // Downgrade to 0.12 (remove HD)\n+        // Check if HD seed exists\n+        if(pwallet->IsHDEnabled()) {\n+            // Delete hd key\n+            pwallet->DeleteHDChain(false);\n+        }\n+    }\n+    \n+    // Future code to downgrade to versions below 0.12 goes here.\n+\n+    return NullUniValue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11730#discussion_r151881616",
      "id" : 151881616,
      "original_commit_id" : "500cbb77bc7847431f4e9413ce34de7b7fa5ab01",
      "original_position" : 71,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 71,
      "pull_request_review_id" : 77658999,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11730",
      "updated_at" : "2017-11-19T23:03:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151881616",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Strong NACK. The use-cases for removing HD seed (mostly desire to have backups not permanently compromise funds) are all but fully addressed by #11085. As for removing SegWit, I'm not fully convinced it's the right direction, but if we do I think making it an external tool is the way to go - supporting downgrading wallets adds a ton of complexity that I don't think is realistically maintainable.\n\nOn November 19, 2017 10:05:10 AM PST, Sjors Provoost <notifications@github.com> wrote:\n>Fixes #11716.\n>\n>This adds a `walletdowngrade [version]` RPC method.\n>\n>It currently only supports downgrading to v0.12, which removes the HD\n>seed (without deleting previously generated keys). Once downgraded,\n>there's no way back, since there's currently no mechanism to upgrade\n>non-HD wallets.\n>\n>I don't know if v0.12 downgrade support is at all useful. If not, the\n>code can be reused for adding downgrade support for the upcoming\n>(perhaps more risky) SegWit related changes.\n>\n>Todo:\n>- [ ] actually test with v0.12 wallet\n>- [ ] add functional test\n>- [ ] add release note (?)\n>You can view, comment on, or merge this pull request online at:\n>\n>  https://github.com/bitcoin/bitcoin/pull/11730\n>\n>-- Commit Summary --\n>\n>  * [wallet] method to delete hdChain\n>  * [rpc] downgradewallet: allow downgrade to v0.12\n>\n>-- File Changes --\n>\n>    M src/wallet/rpcwallet.cpp (64)\n>    M src/wallet/wallet.cpp (12)\n>    M src/wallet/wallet.h (3)\n>\n>-- Patch Links --\n>\n>https://github.com/bitcoin/bitcoin/pull/11730.patch\n>https://github.com/bitcoin/bitcoin/pull/11730.diff\n>\n>-- \n>You are receiving this because you are subscribed to this thread.\n>Reply to this email directly or view it on GitHub:\n>https://github.com/bitcoin/bitcoin/pull/11730\n",
      "created_at" : "2017-11-19T23:05:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11730#issuecomment-345557893",
      "id" : 345557893,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11730",
      "updated_at" : "2017-11-19T23:05:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/345557893",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I don't think it really makes sense to try to support downgrades. In most cases, it would simply be impossible. Better to just restore `-usehd=0` (#11582).\r\n\r\nAs for Segwit changes, my understanding is that support for non-Segwit wallets will be retained.",
      "created_at" : "2017-11-19T23:06:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11730#issuecomment-345557931",
      "id" : 345557931,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11730",
      "updated_at" : "2017-11-19T23:06:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/345557931",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I'm unsure if downgrading should be offered... there are benefits using HD (backup situations).\r\nAlso, purely deleting the HD is probably not something we should do. If we going to use this, it should downgrade in a non-destructable way.",
      "created_at" : "2017-11-19T23:06:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11730#issuecomment-345557946",
      "id" : 345557946,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11730",
      "updated_at" : "2017-11-19T23:06:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/345557946",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "> Also, purely deleting the HD is probably not something we should do. If we going to use this, it should downgrade in a non-destructable way.\r\n\r\nOh man no please don't do this. If you really want to allow users to switch to non-HD key generation for some reason, just change the key generation. Start using the legacy key generation for new keys. Don't touch older keys.\r\n\r\nAll in all I'm kind of doubtful on the wallet downgrading thing. Seems a lot of extra functionality to support for little value, which will inherently be under-tested and code-rot as such. I'd prefer an external script for to handle the few cases where this is useful.",
      "created_at" : "2017-11-20T11:28:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11730#issuecomment-345669106",
      "id" : 345669106,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11730",
      "updated_at" : "2017-11-20T11:28:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/345669106",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11730#discussion_r151981987"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11730"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151981987"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I haven't figured out yet how to run a linter. [linter-gcc](https://atom.io/packages/linter-gcc) for Atom doesn't work out of the box.",
      "commit_id" : "500cbb77bc7847431f4e9413ce34de7b7fa5ab01",
      "created_at" : "2017-11-20T12:51:23Z",
      "diff_hunk" : "@@ -3306,6 +3307,68 @@ UniValue bumpfee(const JSONRPCRequest& request)\n     return result;\n }\n \n+UniValue downgradewallet(const JSONRPCRequest& request)\n+{\n+    CWallet * const pwallet = GetWalletForJSONRPCRequest(request);\n+    if (!EnsureWalletIsAvailable(pwallet, request.fHelp)) {\n+        return NullUniValue;\n+    }\n+\n+    if (request.fHelp || request.params.size() != 1) {\n+        std::string msg = \"downgradewallet \\\"version\\\"\\n\"\n+            \"\\nDowngrades wallet for compatibilty with earlier versions. Requires a new wallet backup.\\n\"\n+\n+            \"\\nArguments:\\n\"\n+            \"1. \\\"version\\\"       (string, required) A previous version of Bitcoin Core\\n\"\n+            \n+            \"\\nSupported versions:\\n\"\n+            \"0.12 Removes HD seed. Generated addresses are preserved.\\n\"\n+            \"     Note that non-HD wallets currently can't be upgraded to HD.\\n\"\n+        ;\n+        throw std::runtime_error(msg);\n+    }\n+\n+    // Check version argument\n+    \n+    uint32_t version;\n+    std::string version_s = request.params[0].get_str(); \n+    std::smatch match;\n+    const std::regex regex(\"^(\\\\d+)\\\\.(\\\\d+)$\");\n+    if (std::regex_match (version_s, match, regex)) {\n+        uint32_t version_major = std::stoi(match[1]);\n+        uint32_t version_minor = std::stoi(match[2]);\n+        version = 1000000 * version_major + 10000 * version_minor;\n+    } else {\n+        throw JSONRPCError(RPC_INVALID_PARAMETER, \"Invalid version format, use e.g. 0.12\");\n+    }\n+    \n+    // Check against array of supported downgrade versions\n+    const std::array<uint32_t, 1> supported_versions = {{120000}};\n+    \n+    bool supported_version = std::any_of(supported_versions.begin(), supported_versions.end(), [&](uint32_t i) \n+    {\n+        return i == version;\n+    });\n+    ",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11730#discussion_r151981987",
      "id" : 151981987,
      "in_reply_to_id" : 151881501,
      "original_commit_id" : "500cbb77bc7847431f4e9413ce34de7b7fa5ab01",
      "original_position" : 54,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 54,
      "pull_request_review_id" : 77772804,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11730",
      "updated_at" : "2017-11-20T12:51:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151981987",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11730#discussion_r151982321"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11730"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151982321"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Actually this is reachable, if the downgrade is successful. Some other RPC methods also return this, but I probably want it to say something a bit more useful.",
      "commit_id" : "500cbb77bc7847431f4e9413ce34de7b7fa5ab01",
      "created_at" : "2017-11-20T12:53:07Z",
      "diff_hunk" : "@@ -3306,6 +3307,68 @@ UniValue bumpfee(const JSONRPCRequest& request)\n     return result;\n }\n \n+UniValue downgradewallet(const JSONRPCRequest& request)\n+{\n+    CWallet * const pwallet = GetWalletForJSONRPCRequest(request);\n+    if (!EnsureWalletIsAvailable(pwallet, request.fHelp)) {\n+        return NullUniValue;\n+    }\n+\n+    if (request.fHelp || request.params.size() != 1) {\n+        std::string msg = \"downgradewallet \\\"version\\\"\\n\"\n+            \"\\nDowngrades wallet for compatibilty with earlier versions. Requires a new wallet backup.\\n\"\n+\n+            \"\\nArguments:\\n\"\n+            \"1. \\\"version\\\"       (string, required) A previous version of Bitcoin Core\\n\"\n+            \n+            \"\\nSupported versions:\\n\"\n+            \"0.12 Removes HD seed. Generated addresses are preserved.\\n\"\n+            \"     Note that non-HD wallets currently can't be upgraded to HD.\\n\"\n+        ;\n+        throw std::runtime_error(msg);\n+    }\n+\n+    // Check version argument\n+    \n+    uint32_t version;\n+    std::string version_s = request.params[0].get_str(); \n+    std::smatch match;\n+    const std::regex regex(\"^(\\\\d+)\\\\.(\\\\d+)$\");\n+    if (std::regex_match (version_s, match, regex)) {\n+        uint32_t version_major = std::stoi(match[1]);\n+        uint32_t version_minor = std::stoi(match[2]);\n+        version = 1000000 * version_major + 10000 * version_minor;\n+    } else {\n+        throw JSONRPCError(RPC_INVALID_PARAMETER, \"Invalid version format, use e.g. 0.12\");\n+    }\n+    \n+    // Check against array of supported downgrade versions\n+    const std::array<uint32_t, 1> supported_versions = {{120000}};\n+    \n+    bool supported_version = std::any_of(supported_versions.begin(), supported_versions.end(), [&](uint32_t i) \n+    {\n+        return i == version;\n+    });\n+    \n+    if (!supported_version) {\n+        throw JSONRPCError(RPC_INVALID_PARAMETER, \"Wallet downgrade to \" + version_s + \" not supported\");\n+    }\n+    \n+    // Future code to downgrade to versions above 0.12 goes here.\n+\n+    if (version <= 120000) { // Downgrade to 0.12 (remove HD)\n+        // Check if HD seed exists\n+        if(pwallet->IsHDEnabled()) {\n+            // Delete hd key\n+            pwallet->DeleteHDChain(false);\n+        }\n+    }\n+    \n+    // Future code to downgrade to versions below 0.12 goes here.\n+\n+    return NullUniValue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11730#discussion_r151982321",
      "id" : 151982321,
      "in_reply_to_id" : 151881616,
      "original_commit_id" : "500cbb77bc7847431f4e9413ce34de7b7fa5ab01",
      "original_position" : 71,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 71,
      "pull_request_review_id" : 77773181,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11730",
      "updated_at" : "2017-11-20T12:53:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151982321",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Alright, Github will keep this code around if there's ever a situation in the future where do want wallet downgrade functionality :-)",
      "created_at" : "2017-11-20T13:00:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11730#issuecomment-345688796",
      "id" : 345688796,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11730",
      "updated_at" : "2017-11-20T13:00:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/345688796",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   }
]
