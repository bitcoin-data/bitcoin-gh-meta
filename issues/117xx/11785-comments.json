[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Nice find. Thanks for reporting!",
      "created_at" : "2017-11-29T08:44:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11785#issuecomment-347791237",
      "id" : 347791237,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11785",
      "updated_at" : "2017-11-29T08:44:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/347791237",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "Thanks!\r\n\r\nIt's kind of disappointing that evhttp has no way to limit file descriptors. This is the so-manieth hack we need to accommodate it. It's also not very actively maintained so trying to push any fix upstream will take a long time, if ever. I sometimes wonder if moving to [libevhtp](https://github.com/criticalstack/libevhtp), which seems to be the quasi-standard for http servers on top of libevent, would solve these issues.",
      "created_at" : "2017-11-29T10:01:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11785#issuecomment-347810949",
      "id" : 347810949,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11785",
      "updated_at" : "2017-11-29T10:05:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/347810949",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Should we add a stress test to travis?",
      "created_at" : "2017-11-29T10:08:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11785#issuecomment-347812829",
      "id" : 347812829,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11785",
      "updated_at" : "2017-11-29T10:08:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/347812829",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@laanwj yes it is disappointing that there isn't a better API to manage this systemic issue in evhttp.\r\n\r\nEven more unfortunately, some configurations in Travis use an old version of libevent that doesn't have the bevcb callback or the ability to count added file descriptors. I've updated the pull request correspondingly. Protection is only available on newer libevents :(\r\n\r\nWhat programs are available in Travis? Various configurations of https://github.com/shekyan/slowhttptest would be good tests, for example\r\n\r\n```\r\nslowhttptest -c 40000 -r 1000 -u 'http://127.0.0.1:8332/rest/block/000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f.json'\r\n```",
      "created_at" : "2017-11-29T13:47:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11785#issuecomment-347864838",
      "id" : 347864838,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11785",
      "updated_at" : "2017-11-29T13:47:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/347864838",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/37696?v=4",
         "events_url" : "https://api.github.com/users/vii/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vii/followers",
         "following_url" : "https://api.github.com/users/vii/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vii/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vii",
         "id" : 37696,
         "login" : "vii",
         "organizations_url" : "https://api.github.com/users/vii/orgs",
         "received_events_url" : "https://api.github.com/users/vii/received_events",
         "repos_url" : "https://api.github.com/users/vii/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vii/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vii/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vii"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "> I've updated the pull request correspondingly. Protection is only available on newer libevents :(\r\n\r\nI think it would make sense to add a \"known issue\" to the release notes, recommending people that stumble on file descriptor problems while doing a lot of separate RPC requests to upgrade their libevent.\r\n\r\nFWIW minimum seems to be 2.1.4:\r\n```bash\r\n$ git tag --contains 0fa107d8cbc652dacb722fcf650bb6b3ffbe8dac\r\nrelease-2.1.4-alpha\r\nrelease-2.1.5-beta\r\nrelease-2.1.6-beta\r\nrelease-2.1.7-rc\r\nrelease-2.1.8-stable\r\n```",
      "created_at" : "2017-11-30T13:13:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11785#issuecomment-348184234",
      "id" : 348184234,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11785",
      "updated_at" : "2017-11-30T13:18:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/348184234",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "This was discussed on IRC and according to @theuni this doesn't fully solve the problem, unfortunately. He could still fairly easy crash the server with many connections. So it will have to be solved from inside libevent.",
      "created_at" : "2017-12-01T03:39:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11785#issuecomment-348393090",
      "id" : 348393090,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11785",
      "updated_at" : "2017-12-01T03:39:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/348393090",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Yes, I've spent the last 2 days trying to work out our best option here. The provided patch is a big help, but I think there are a few more things we can do, namely a libevent patch. I'll push up some more changes tomorrow and we can discuss what it makes sense to pull in.",
      "created_at" : "2017-12-01T05:02:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11785#issuecomment-348402130",
      "id" : 348402130,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11785",
      "updated_at" : "2017-12-01T05:02:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/348402130",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@theuni here is a libevent patch that provides sufficient functionality to constrain the number of file-descriptors to a tight bound: https://github.com/libevent/libevent/pull/578\r\n\r\nIn the meantime, as we work through the process to change libevent, the pull request here mitigates the original issue and defends against similar ones",
      "created_at" : "2017-12-01T13:29:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11785#issuecomment-348494814",
      "id" : 348494814,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11785",
      "updated_at" : "2017-12-01T13:30:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/348494814",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/37696?v=4",
         "events_url" : "https://api.github.com/users/vii/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vii/followers",
         "following_url" : "https://api.github.com/users/vii/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vii/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vii",
         "id" : 37696,
         "login" : "vii",
         "organizations_url" : "https://api.github.com/users/vii/orgs",
         "received_events_url" : "https://api.github.com/users/vii/received_events",
         "repos_url" : "https://api.github.com/users/vii/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vii/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vii/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vii"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@vii Nice work on the upstream patch. It'll be great to have a real solution for this.\r\n\r\nI have a few concerns about the approach here:\r\n-  event_base_get_num_events is not a great representative of the connection count, as our own timers and triggers will throw off the count\r\n- I think keep-alive connections need to be closed if they're re-used once the connection limit has been reached, otherwise it becomes trivial to monopolize the available slots.\r\n- It unfortunately doesn't help with libevent 2.0.x, which is by far the majority in the wild.\r\n\r\nI've adapted your approach and added in a few extras which manage to work-around the issue for libevent 2.0.x as well. With this, I'm unable to raise my fd count above the desired ceiling, no matter how hard I hammer.\r\n\r\nPlease have a look here and see what you think: https://github.com/theuni/bitcoin/commits/http-fd-limit. Note that there's an unlikely potential race at shutdown that I haven't yet addressed.",
      "created_at" : "2017-12-02T06:30:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11785#issuecomment-348672418",
      "id" : 348672418,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11785",
      "updated_at" : "2017-12-02T06:30:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/348672418",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "Great!\r\n\r\n> It unfortunately doesn't help with libevent 2.0.x, which is by far the majority in the wild.\r\n\r\nYes - it would be nice to have a (potentially messy) workaround for older libevent, and a clean solution for future upstream versions.\r\n",
      "created_at" : "2017-12-02T09:30:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11785#issuecomment-348680175",
      "id" : 348680175,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11785",
      "updated_at" : "2017-12-02T09:30:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/348680175",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@theuni - your patch looks great! I was cautious about modifying so much.\r\n\r\nGiven the discussion, I've reduced my pull request to the simple improvement of making sure to request as many file descriptors as possible.\r\n\r\nWith @theuni's improvement to only accept connections that have data on, honest HTTP connections will go into the connection limiter. However, I suspect adversaries using things like the slowloris attack (which send incomplete requests and then pause) will not be caught and will use resources. These can be controlled if the libevent request is included, but otherwise can be detected but not perfectly controlled using the approach in the first request, which binds to the rather toothless bevcb callback.\r\n\r\nOne way to look at this is that the root issue is that there is a process wide file-descriptor allocation defined in https://github.com/bitcoin/bitcoin/blob/master/src/init.cpp#L907 but the RPC interface isn't accounted for. Would be great to integrate @theuni's ConnectionLimiter into that!\r\n\r\nIs it worth defending against slowloris style attacks given the RPC interface is generally not accessible to adversaries?\r\n\r\nIn this pull request, his small change to request as many file-descriptors as possible should help mitigate the original issue on many default configurations (e.g. Ubuntu).",
      "created_at" : "2017-12-04T05:56:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11785#issuecomment-348867263",
      "id" : 348867263,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11785",
      "updated_at" : "2017-12-04T05:56:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/348867263",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/37696?v=4",
         "events_url" : "https://api.github.com/users/vii/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vii/followers",
         "following_url" : "https://api.github.com/users/vii/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vii/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vii",
         "id" : 37696,
         "login" : "vii",
         "organizations_url" : "https://api.github.com/users/vii/orgs",
         "received_events_url" : "https://api.github.com/users/vii/received_events",
         "repos_url" : "https://api.github.com/users/vii/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vii/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vii/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vii"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "this small change to request more file-descriptors does not depend on the libevent patch (which is making progress towards acceptance) but alleviates the issue in many configurations - except for deliberate attacks\r\n\r\nPlease review!\r\n\r\n",
      "created_at" : "2017-12-17T18:05:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11785#issuecomment-352273973",
      "id" : 352273973,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11785",
      "updated_at" : "2017-12-17T18:05:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/352273973",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/37696?v=4",
         "events_url" : "https://api.github.com/users/vii/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vii/followers",
         "following_url" : "https://api.github.com/users/vii/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vii/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vii",
         "id" : 37696,
         "login" : "vii",
         "organizations_url" : "https://api.github.com/users/vii/orgs",
         "received_events_url" : "https://api.github.com/users/vii/received_events",
         "repos_url" : "https://api.github.com/users/vii/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vii/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vii/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vii"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "the libevent change has been merged into that repo so we can have a complete fix https://github.com/libevent/libevent/pull/578 - but the limited PR here does not depend on it\r\n\r\nHappy to make a more complete fix if it would be reviewed!",
      "created_at" : "2017-12-18T03:55:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11785#issuecomment-352319936",
      "id" : 352319936,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11785",
      "updated_at" : "2017-12-18T03:55:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/352319936",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/37696?v=4",
         "events_url" : "https://api.github.com/users/vii/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vii/followers",
         "following_url" : "https://api.github.com/users/vii/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vii/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vii",
         "id" : 37696,
         "login" : "vii",
         "organizations_url" : "https://api.github.com/users/vii/orgs",
         "received_events_url" : "https://api.github.com/users/vii/received_events",
         "repos_url" : "https://api.github.com/users/vii/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vii/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vii/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vii"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@vii Great work on the upstream fix!\r\n\r\nI'll clean up my changes and PR them separately. I'll go ahead and work in the bevcb for supported versions, so that we can take advantage of that when possible.\r\n\r\nAs for raising the fd limit, I have mixed feelings. I worry that this will simply mask problems. I believe @gmaxwell was in favor, though.\r\n\r\n@gmaxwell: assuming we manage to contain this issue, do you still think maxing out the fd limit is beneficial?",
      "created_at" : "2017-12-20T22:50:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11785#issuecomment-353205900",
      "id" : 353205900,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11785",
      "updated_at" : "2017-12-20T22:50:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/353205900",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "the issue that it masks is that several usages of file-descriptors are not budgeted for in the process wide file-descriptor allocation defined in https://github.com/bitcoin/bitcoin/blob/master/src/init.cpp#L907 \r\n\r\nIt would be quite difficult to carefully audit for all usages of file-descriptors as library functions may use them for various purposes. Even once the budgeting is done, this will be helpful!\r\n\r\nPlease consider and merge",
      "created_at" : "2017-12-30T17:46:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11785#issuecomment-354558923",
      "id" : 354558923,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11785",
      "updated_at" : "2017-12-30T17:46:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/354558923",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/37696?v=4",
         "events_url" : "https://api.github.com/users/vii/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vii/followers",
         "following_url" : "https://api.github.com/users/vii/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vii/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vii",
         "id" : 37696,
         "login" : "vii",
         "organizations_url" : "https://api.github.com/users/vii/orgs",
         "received_events_url" : "https://api.github.com/users/vii/received_events",
         "repos_url" : "https://api.github.com/users/vii/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vii/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vii/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vii"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "What I'd like to know is how does other software handle this? Is it frowned upon for daemons to increase the file descriptor count without being asked? I thought the usual case for UNIX is to make changing resource limits up to the user/sysadmin, and changing them un-asked is deemed rude, but this might be different for file descriptors.\r\n",
      "created_at" : "2018-01-11T19:31:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11785#issuecomment-357036075",
      "id" : 357036075,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11785",
      "updated_at" : "2018-01-11T19:31:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/357036075",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@laanwj we are not attempting to change the maximum, just adjusting to use the maximum we are allowed\r\n\r\nNote here is some similar code in the wine project - rather more battlehardened but with the same effect on Linux\r\n\r\nhttps://source.winehq.org/source/libs/wine/loader.c#L661\r\n",
      "created_at" : "2018-01-30T04:30:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11785#issuecomment-361474071",
      "id" : 361474071,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11785",
      "updated_at" : "2018-01-30T04:30:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/361474071",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/37696?v=4",
         "events_url" : "https://api.github.com/users/vii/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vii/followers",
         "following_url" : "https://api.github.com/users/vii/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vii/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vii",
         "id" : 37696,
         "login" : "vii",
         "organizations_url" : "https://api.github.com/users/vii/orgs",
         "received_events_url" : "https://api.github.com/users/vii/received_events",
         "repos_url" : "https://api.github.com/users/vii/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vii/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vii/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vii"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@theuni brought this PR to my attention in a conversation we had earlier today. I was actually planning to implement the same behavior, for a completely different reason: I would like to increase the number of file descriptors that leveldb is allowed to use, because performance testing I have done makes me think that the low limit leveldb currently has is causing issues with which pages Linux decides to keep in the page cache. I think increasing the soft limit is safe and reasonable.",
      "created_at" : "2018-02-20T00:48:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11785#issuecomment-366836463",
      "id" : 366836463,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11785",
      "updated_at" : "2018-02-20T00:48:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/366836463",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "@eklitzke Is that an ACK on this?",
      "created_at" : "2018-03-05T21:23:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11785#issuecomment-370570757",
      "id" : 370570757,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11785",
      "updated_at" : "2018-03-05T21:23:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370570757",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--5d09a71f8925f3f132321140b44b946d-->The last travis run for this pull request was 215 days ago and is thus outdated. To trigger a fresh travis build, this pull request should be closed and re-opened.",
      "created_at" : "2018-07-20T20:30:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11785#issuecomment-406718512",
      "id" : 406718512,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11785",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwNjcxODUxMg==",
      "updated_at" : "2018-07-20T20:30:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/406718512",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2018-11-05T11:17:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11785#issuecomment-435839814",
      "id" : 435839814,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11785",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNTgzOTgxNA==",
      "updated_at" : "2018-11-05T11:17:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/435839814",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Closing this, reviewing and development bled out and a rebase has been necessary for months. Let me know if I should reopen it.",
      "created_at" : "2019-01-09T15:42:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11785#issuecomment-452742267",
      "id" : 452742267,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11785",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1Mjc0MjI2Nw==",
      "updated_at" : "2019-01-09T15:42:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/452742267",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
