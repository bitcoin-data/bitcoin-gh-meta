[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11363#discussion_r139849608"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11363"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/139849608"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "If socks negotiation fail then `hSocket` will not be `INVALID_SOCKET` which is a different behavior than before. This also indicates that there is a leak in master because `hSocket` is not freed?",
      "commit_id" : "3830b6e0659106458c941029f5b2e789e3cb38a3",
      "created_at" : "2017-09-20T00:19:30Z",
      "diff_hunk" : "@@ -554,8 +567,6 @@ bool ConnectThroughProxy(const proxyType &proxy, const std::string& strDest, int\n         if (!Socks5(strDest, (unsigned short)port, 0, hSocket))\n             return false;\n     }\n-\n-    hSocketRet = hSocket;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11363#discussion_r139849608",
      "id" : 139849608,
      "original_commit_id" : "3d91bc7aa4eb77da2bc0da52af1613071dce3dae",
      "original_position" : 58,
      "path" : "src/netbase.cpp",
      "position" : null,
      "pull_request_review_id" : 63838980,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11363",
      "updated_at" : "2017-12-12T20:31:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/139849608",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11363#discussion_r139859391"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11363"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/139859391"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nice Catch! Force-pushed the missing CloseSocket()s.\r\n```diff\r\ndiff --git a/src/netbase.cpp b/src/netbase.cpp\r\nindex 18763d2..4b72826 100644\r\n--- a/src/netbase.cpp\r\n+++ b/src/netbase.cpp\r\n@@ -561,11 +561,15 @@ bool ConnectThroughProxy(const proxyType &proxy, const std::string& strDest, int\r\n         ProxyCredentials random_auth;\r\n         static std::atomic_int counter(0);\r\n         random_auth.username = random_auth.password = strprintf(\"%i\", counter++);\r\n-        if (!Socks5(strDest, (unsigned short)port, &random_auth, hSocket))\r\n+        if (!Socks5(strDest, (unsigned short)port, &random_auth, hSocket)) {\r\n+            CloseSocket(hSocket);\r\n             return false;\r\n+        }\r\n     } else {\r\n-        if (!Socks5(strDest, (unsigned short)port, 0, hSocket))\r\n+        if (!Socks5(strDest, (unsigned short)port, 0, hSocket)) {\r\n+            CloseSocket(hSocket);\r\n             return false;\r\n+        }\r\n     }\r\n     return true;\r\n }\r\n```",
      "commit_id" : "3830b6e0659106458c941029f5b2e789e3cb38a3",
      "created_at" : "2017-09-20T01:51:52Z",
      "diff_hunk" : "@@ -554,8 +567,6 @@ bool ConnectThroughProxy(const proxyType &proxy, const std::string& strDest, int\n         if (!Socks5(strDest, (unsigned short)port, 0, hSocket))\n             return false;\n     }\n-\n-    hSocketRet = hSocket;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11363#discussion_r139859391",
      "id" : 139859391,
      "in_reply_to_id" : 139849608,
      "original_commit_id" : "3d91bc7aa4eb77da2bc0da52af1613071dce3dae",
      "original_position" : 58,
      "path" : "src/netbase.cpp",
      "position" : null,
      "pull_request_review_id" : 63849613,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11363",
      "updated_at" : "2017-12-12T20:31:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/139859391",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11363#discussion_r139928315"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11363"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/139928315"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`CloseSocket` sets `hSocket` to `INVALID_SOCKET` so this LGTM. I wonder if you could just `return CloseSocket(hSocket)`?",
      "commit_id" : "3830b6e0659106458c941029f5b2e789e3cb38a3",
      "created_at" : "2017-09-20T10:09:25Z",
      "diff_hunk" : "@@ -554,8 +567,6 @@ bool ConnectThroughProxy(const proxyType &proxy, const std::string& strDest, int\n         if (!Socks5(strDest, (unsigned short)port, 0, hSocket))\n             return false;\n     }\n-\n-    hSocketRet = hSocket;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11363#discussion_r139928315",
      "id" : 139928315,
      "in_reply_to_id" : 139849608,
      "original_commit_id" : "3d91bc7aa4eb77da2bc0da52af1613071dce3dae",
      "original_position" : 58,
      "path" : "src/netbase.cpp",
      "position" : null,
      "pull_request_review_id" : 63926872,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11363",
      "updated_at" : "2017-12-12T20:31:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/139928315",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11363#discussion_r140034168"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11363"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/140034168"
         }
      },
      "author_association" : "MEMBER",
      "body" : "CloseSocket's return value indicates whether the close succeeded or not, which would be true in this case. Not what we want :)",
      "commit_id" : "3830b6e0659106458c941029f5b2e789e3cb38a3",
      "created_at" : "2017-09-20T17:15:48Z",
      "diff_hunk" : "@@ -554,8 +567,6 @@ bool ConnectThroughProxy(const proxyType &proxy, const std::string& strDest, int\n         if (!Socks5(strDest, (unsigned short)port, 0, hSocket))\n             return false;\n     }\n-\n-    hSocketRet = hSocket;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11363#discussion_r140034168",
      "id" : 140034168,
      "in_reply_to_id" : 139849608,
      "original_commit_id" : "3d91bc7aa4eb77da2bc0da52af1613071dce3dae",
      "original_position" : 58,
      "path" : "src/netbase.cpp",
      "position" : null,
      "pull_request_review_id" : 64050499,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11363",
      "updated_at" : "2017-12-12T20:31:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/140034168",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11363#discussion_r140195540"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11363"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/140195540"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ahhh yeah... now I win the most stupid comment award.",
      "commit_id" : "3830b6e0659106458c941029f5b2e789e3cb38a3",
      "created_at" : "2017-09-21T09:44:39Z",
      "diff_hunk" : "@@ -554,8 +567,6 @@ bool ConnectThroughProxy(const proxyType &proxy, const std::string& strDest, int\n         if (!Socks5(strDest, (unsigned short)port, 0, hSocket))\n             return false;\n     }\n-\n-    hSocketRet = hSocket;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11363#discussion_r140195540",
      "id" : 140195540,
      "in_reply_to_id" : 139849608,
      "original_commit_id" : "3d91bc7aa4eb77da2bc0da52af1613071dce3dae",
      "original_position" : 58,
      "path" : "src/netbase.cpp",
      "position" : null,
      "pull_request_review_id" : 64230740,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11363",
      "updated_at" : "2017-12-12T20:31:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/140195540",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11363#discussion_r140263956"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11363"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/140263956"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Hah, no worries. We'll call it even for pointing out my mistake here",
      "commit_id" : "3830b6e0659106458c941029f5b2e789e3cb38a3",
      "created_at" : "2017-09-21T14:48:11Z",
      "diff_hunk" : "@@ -554,8 +567,6 @@ bool ConnectThroughProxy(const proxyType &proxy, const std::string& strDest, int\n         if (!Socks5(strDest, (unsigned short)port, 0, hSocket))\n             return false;\n     }\n-\n-    hSocketRet = hSocket;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11363#discussion_r140263956",
      "id" : 140263956,
      "in_reply_to_id" : 139849608,
      "original_commit_id" : "3d91bc7aa4eb77da2bc0da52af1613071dce3dae",
      "original_position" : 58,
      "path" : "src/netbase.cpp",
      "position" : null,
      "pull_request_review_id" : 64310753,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11363",
      "updated_at" : "2017-12-12T20:31:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/140263956",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased after #10663.\r\n\r\nAlso, changed from the last version: Rather than passing in a socket reference and returning a bool, CreateSocket() now returns a socket (which may be invalid) instead. That's much more straightforward, IMO, and matches the usage of socket().",
      "created_at" : "2017-09-28T18:12:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11363#issuecomment-332919589",
      "id" : 332919589,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11363",
      "updated_at" : "2017-09-28T18:12:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/332919589",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11363#discussion_r141762603"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11363"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141762603"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "You need to change the return values values of all the \"return false\"s in here - INVALID_SOCKET is (currently) ~0, so we will pretend the socket creation succeeded.",
      "commit_id" : "3830b6e0659106458c941029f5b2e789e3cb38a3",
      "created_at" : "2017-09-28T23:48:28Z",
      "diff_hunk" : "@@ -452,10 +452,8 @@ static bool Socks5(const std::string& strDest, int port, const ProxyCredentials\n     return true;\n }\n \n-bool ConnectSocketDirectly(const CService &addrConnect, SOCKET& hSocketRet, int nTimeout)\n+SOCKET CreateSocket(const CService &addrConnect)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11363#discussion_r141762603",
      "id" : 141762603,
      "original_commit_id" : "29e0a1605d557ba48c57bbc1dabccc6eed442311",
      "original_position" : 5,
      "path" : "src/netbase.cpp",
      "position" : 114,
      "pull_request_review_id" : 66029225,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11363",
      "updated_at" : "2017-12-12T20:31:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141762603",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11363#discussion_r141762847"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11363"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141762847"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "At the risk of making you redo a bunch of work, is it possible to const-ify the socket here and make the caller do the CloseSocket instead? Shits currently a maze and it'd be nice to clean it up sooner rather than try to follow it through the libevent changes.",
      "commit_id" : "3830b6e0659106458c941029f5b2e789e3cb38a3",
      "created_at" : "2017-09-28T23:50:23Z",
      "diff_hunk" : "@@ -479,9 +477,24 @@ bool ConnectSocketDirectly(const CService &addrConnect, SOCKET& hSocketRet, int\n     // Set to non-blocking\n     if (!SetSocketNonBlocking(hSocket, true)) {\n         CloseSocket(hSocket);\n-        return error(\"ConnectSocketDirectly: Setting socket to non-blocking failed, error %s\\n\", NetworkErrorString(WSAGetLastError()));\n+        error(\"ConnectSocketDirectly: Setting socket to non-blocking failed, error %s\\n\", NetworkErrorString(WSAGetLastError()));\n     }\n+    return hSocket;\n+}\n \n+bool ConnectSocketDirectly(const CService &addrConnect, SOCKET& hSocket, int nTimeout)\n+{\n+    struct sockaddr_storage sockaddr;\n+    socklen_t len = sizeof(sockaddr);\n+    if (hSocket == INVALID_SOCKET) {\n+        LogPrintf(\"Cannot connect to %s: invalid socket\\n\", addrConnect.ToString());\n+        return false;\n+    }\n+    if (!addrConnect.GetSockAddr((struct sockaddr*)&sockaddr, &len)) {\n+        LogPrintf(\"Cannot connect to %s: unsupported network\\n\", addrConnect.ToString());\n+        CloseSocket(hSocket);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11363#discussion_r141762847",
      "id" : 141762847,
      "original_commit_id" : "29e0a1605d557ba48c57bbc1dabccc6eed442311",
      "original_position" : 32,
      "path" : "src/netbase.cpp",
      "position" : null,
      "pull_request_review_id" : 66029225,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11363",
      "updated_at" : "2017-12-12T20:31:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141762847",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11363#discussion_r141764714"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11363"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141764714"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, don't know how I missed those.",
      "commit_id" : "3830b6e0659106458c941029f5b2e789e3cb38a3",
      "created_at" : "2017-09-29T00:07:35Z",
      "diff_hunk" : "@@ -452,10 +452,8 @@ static bool Socks5(const std::string& strDest, int port, const ProxyCredentials\n     return true;\n }\n \n-bool ConnectSocketDirectly(const CService &addrConnect, SOCKET& hSocketRet, int nTimeout)\n+SOCKET CreateSocket(const CService &addrConnect)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11363#discussion_r141764714",
      "id" : 141764714,
      "in_reply_to_id" : 141762603,
      "original_commit_id" : "29e0a1605d557ba48c57bbc1dabccc6eed442311",
      "original_position" : 5,
      "path" : "src/netbase.cpp",
      "position" : 114,
      "pull_request_review_id" : 66031489,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11363",
      "updated_at" : "2017-12-12T20:31:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141764714",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11363#discussion_r141765733"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11363"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141765733"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, that makes sense. Now that we don't have chained connect functions, it's much more clear what \"the caller\" means. The maze was only there because we had to close at all levels to be safe.\r\n\r\nWill do.",
      "commit_id" : "3830b6e0659106458c941029f5b2e789e3cb38a3",
      "created_at" : "2017-09-29T00:17:19Z",
      "diff_hunk" : "@@ -479,9 +477,24 @@ bool ConnectSocketDirectly(const CService &addrConnect, SOCKET& hSocketRet, int\n     // Set to non-blocking\n     if (!SetSocketNonBlocking(hSocket, true)) {\n         CloseSocket(hSocket);\n-        return error(\"ConnectSocketDirectly: Setting socket to non-blocking failed, error %s\\n\", NetworkErrorString(WSAGetLastError()));\n+        error(\"ConnectSocketDirectly: Setting socket to non-blocking failed, error %s\\n\", NetworkErrorString(WSAGetLastError()));\n     }\n+    return hSocket;\n+}\n \n+bool ConnectSocketDirectly(const CService &addrConnect, SOCKET& hSocket, int nTimeout)\n+{\n+    struct sockaddr_storage sockaddr;\n+    socklen_t len = sizeof(sockaddr);\n+    if (hSocket == INVALID_SOCKET) {\n+        LogPrintf(\"Cannot connect to %s: invalid socket\\n\", addrConnect.ToString());\n+        return false;\n+    }\n+    if (!addrConnect.GetSockAddr((struct sockaddr*)&sockaddr, &len)) {\n+        LogPrintf(\"Cannot connect to %s: unsupported network\\n\", addrConnect.ToString());\n+        CloseSocket(hSocket);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11363#discussion_r141765733",
      "id" : 141765733,
      "in_reply_to_id" : 141762847,
      "original_commit_id" : "29e0a1605d557ba48c57bbc1dabccc6eed442311",
      "original_position" : 32,
      "path" : "src/netbase.cpp",
      "position" : null,
      "pull_request_review_id" : 66032637,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11363",
      "updated_at" : "2017-12-12T20:31:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141765733",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased and fixed the check against the connect() return value, which was already wrong, but doesn't really matter because it's always detected on first use anyway.",
      "created_at" : "2017-11-07T21:22:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11363#issuecomment-342626470",
      "id" : 342626470,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11363",
      "updated_at" : "2017-11-07T21:22:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/342626470",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "utACK f766175ebe4400561f60b75b0ede4015003bad8c",
      "created_at" : "2017-11-07T21:23:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11363#issuecomment-342626592",
      "id" : 342626592,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11363",
      "updated_at" : "2017-11-07T21:23:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/342626592",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "This gives me a new warning:\r\n```\r\n/.../bitcoin/src/netbase.cpp:449:17: warning: comparison of integers of different signs: 'SOCKET' (aka 'unsigned int') and 'int' [-Wsign-compare]\r\n    if (hSocket == -1)\r\n        ~~~~~~~ ^  ~~\r\n1 warning generated.\r\n```",
      "created_at" : "2017-12-12T10:46:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11363#issuecomment-351014618",
      "id" : 351014618,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11363",
      "updated_at" : "2017-12-12T10:46:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/351014618",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11363#discussion_r156341473"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11363"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156341473"
         }
      },
      "author_association" : "OWNER",
      "body" : "NOSIGPIPE handling moved to `CreateSocket(addrBind)`?",
      "commit_id" : "3830b6e0659106458c941029f5b2e789e3cb38a3",
      "created_at" : "2017-12-12T11:37:08Z",
      "diff_hunk" : "@@ -2069,44 +2078,21 @@ bool CConnman::BindListenPort(const CService &addrBind, std::string& strError, b\n         return false;\n     }\n \n-    SOCKET hListenSocket = socket(((struct sockaddr*)&sockaddr)->sa_family, SOCK_STREAM, IPPROTO_TCP);\n+    SOCKET hListenSocket = CreateSocket(addrBind);\n     if (hListenSocket == INVALID_SOCKET)\n     {\n         strError = strprintf(\"Error: Couldn't open socket for incoming connections (socket returned error %s)\", NetworkErrorString(WSAGetLastError()));\n         LogPrintf(\"%s\\n\", strError);\n         return false;\n     }\n-    if (!IsSelectableSocket(hListenSocket))\n-    {\n-        strError = \"Error: Couldn't create a listenable socket for incoming connections\";\n-        LogPrintf(\"%s\\n\", strError);\n-        return false;\n-    }\n-\n-\n #ifndef WIN32\n-#ifdef SO_NOSIGPIPE\n-    // Different way of disabling SIGPIPE on BSD\n-    setsockopt(hListenSocket, SOL_SOCKET, SO_NOSIGPIPE, (void*)&nOne, sizeof(int));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11363#discussion_r156341473",
      "id" : 156341473,
      "original_commit_id" : "f766175ebe4400561f60b75b0ede4015003bad8c",
      "original_position" : 90,
      "path" : "src/net.cpp",
      "position" : 90,
      "pull_request_review_id" : 82801045,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11363",
      "updated_at" : "2017-12-12T20:31:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156341473",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11363#discussion_r156341683"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11363"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156341683"
         }
      },
      "author_association" : "OWNER",
      "body" : "Where did this move? The only remaining reference to TCP_NODELAY I see is in `SetSocketNoDelay`, which is called on accepted sockets only.",
      "commit_id" : "3830b6e0659106458c941029f5b2e789e3cb38a3",
      "created_at" : "2017-12-12T11:38:09Z",
      "diff_hunk" : "@@ -2069,44 +2078,21 @@ bool CConnman::BindListenPort(const CService &addrBind, std::string& strError, b\n         return false;\n     }\n \n-    SOCKET hListenSocket = socket(((struct sockaddr*)&sockaddr)->sa_family, SOCK_STREAM, IPPROTO_TCP);\n+    SOCKET hListenSocket = CreateSocket(addrBind);\n     if (hListenSocket == INVALID_SOCKET)\n     {\n         strError = strprintf(\"Error: Couldn't open socket for incoming connections (socket returned error %s)\", NetworkErrorString(WSAGetLastError()));\n         LogPrintf(\"%s\\n\", strError);\n         return false;\n     }\n-    if (!IsSelectableSocket(hListenSocket))\n-    {\n-        strError = \"Error: Couldn't create a listenable socket for incoming connections\";\n-        LogPrintf(\"%s\\n\", strError);\n-        return false;\n-    }\n-\n-\n #ifndef WIN32\n-#ifdef SO_NOSIGPIPE\n-    // Different way of disabling SIGPIPE on BSD\n-    setsockopt(hListenSocket, SOL_SOCKET, SO_NOSIGPIPE, (void*)&nOne, sizeof(int));\n-#endif\n     // Allow binding if the port is still in TIME_WAIT state after\n     // the program was closed and restarted.\n     setsockopt(hListenSocket, SOL_SOCKET, SO_REUSEADDR, (void*)&nOne, sizeof(int));\n-    // Disable Nagle's algorithm\n-    setsockopt(hListenSocket, IPPROTO_TCP, TCP_NODELAY, (void*)&nOne, sizeof(int));\n #else\n     setsockopt(hListenSocket, SOL_SOCKET, SO_REUSEADDR, (const char*)&nOne, sizeof(int));\n-    setsockopt(hListenSocket, IPPROTO_TCP, TCP_NODELAY, (const char*)&nOne, sizeof(int));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11363#discussion_r156341683",
      "id" : 156341683,
      "original_commit_id" : "f766175ebe4400561f60b75b0ede4015003bad8c",
      "original_position" : 99,
      "path" : "src/net.cpp",
      "position" : 99,
      "pull_request_review_id" : 82801266,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11363",
      "updated_at" : "2017-12-12T20:31:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156341683",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11363#discussion_r156466046"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11363"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156466046"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Its also called in netbase.cpp in CreateSocket, so should be set for outbound and inbound connection sockets, though not the listen socket, but that makes sense.",
      "commit_id" : "3830b6e0659106458c941029f5b2e789e3cb38a3",
      "created_at" : "2017-12-12T19:12:03Z",
      "diff_hunk" : "@@ -2069,44 +2078,21 @@ bool CConnman::BindListenPort(const CService &addrBind, std::string& strError, b\n         return false;\n     }\n \n-    SOCKET hListenSocket = socket(((struct sockaddr*)&sockaddr)->sa_family, SOCK_STREAM, IPPROTO_TCP);\n+    SOCKET hListenSocket = CreateSocket(addrBind);\n     if (hListenSocket == INVALID_SOCKET)\n     {\n         strError = strprintf(\"Error: Couldn't open socket for incoming connections (socket returned error %s)\", NetworkErrorString(WSAGetLastError()));\n         LogPrintf(\"%s\\n\", strError);\n         return false;\n     }\n-    if (!IsSelectableSocket(hListenSocket))\n-    {\n-        strError = \"Error: Couldn't create a listenable socket for incoming connections\";\n-        LogPrintf(\"%s\\n\", strError);\n-        return false;\n-    }\n-\n-\n #ifndef WIN32\n-#ifdef SO_NOSIGPIPE\n-    // Different way of disabling SIGPIPE on BSD\n-    setsockopt(hListenSocket, SOL_SOCKET, SO_NOSIGPIPE, (void*)&nOne, sizeof(int));\n-#endif\n     // Allow binding if the port is still in TIME_WAIT state after\n     // the program was closed and restarted.\n     setsockopt(hListenSocket, SOL_SOCKET, SO_REUSEADDR, (void*)&nOne, sizeof(int));\n-    // Disable Nagle's algorithm\n-    setsockopt(hListenSocket, IPPROTO_TCP, TCP_NODELAY, (void*)&nOne, sizeof(int));\n #else\n     setsockopt(hListenSocket, SOL_SOCKET, SO_REUSEADDR, (const char*)&nOne, sizeof(int));\n-    setsockopt(hListenSocket, IPPROTO_TCP, TCP_NODELAY, (const char*)&nOne, sizeof(int));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11363#discussion_r156466046",
      "id" : 156466046,
      "in_reply_to_id" : 156341683,
      "original_commit_id" : "f766175ebe4400561f60b75b0ede4015003bad8c",
      "original_position" : 99,
      "path" : "src/net.cpp",
      "position" : 99,
      "pull_request_review_id" : 82947689,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11363",
      "updated_at" : "2017-12-12T20:31:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156466046",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11363#discussion_r156466360"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11363"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156466360"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, I think part of the goal is to get random socket flag-fiddling things out of net and into netbase, its kinda split between both right now. @theuni ?",
      "commit_id" : "3830b6e0659106458c941029f5b2e789e3cb38a3",
      "created_at" : "2017-12-12T19:13:07Z",
      "diff_hunk" : "@@ -2069,44 +2078,21 @@ bool CConnman::BindListenPort(const CService &addrBind, std::string& strError, b\n         return false;\n     }\n \n-    SOCKET hListenSocket = socket(((struct sockaddr*)&sockaddr)->sa_family, SOCK_STREAM, IPPROTO_TCP);\n+    SOCKET hListenSocket = CreateSocket(addrBind);\n     if (hListenSocket == INVALID_SOCKET)\n     {\n         strError = strprintf(\"Error: Couldn't open socket for incoming connections (socket returned error %s)\", NetworkErrorString(WSAGetLastError()));\n         LogPrintf(\"%s\\n\", strError);\n         return false;\n     }\n-    if (!IsSelectableSocket(hListenSocket))\n-    {\n-        strError = \"Error: Couldn't create a listenable socket for incoming connections\";\n-        LogPrintf(\"%s\\n\", strError);\n-        return false;\n-    }\n-\n-\n #ifndef WIN32\n-#ifdef SO_NOSIGPIPE\n-    // Different way of disabling SIGPIPE on BSD\n-    setsockopt(hListenSocket, SOL_SOCKET, SO_NOSIGPIPE, (void*)&nOne, sizeof(int));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11363#discussion_r156466360",
      "id" : 156466360,
      "in_reply_to_id" : 156341473,
      "original_commit_id" : "f766175ebe4400561f60b75b0ede4015003bad8c",
      "original_position" : 90,
      "path" : "src/net.cpp",
      "position" : 90,
      "pull_request_review_id" : 82948033,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11363",
      "updated_at" : "2017-12-12T20:31:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156466360",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11363#discussion_r156482239"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11363"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156482239"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yep. If it's something we require for all sockets, imo it makes sense to do it in CreateSocket.",
      "commit_id" : "3830b6e0659106458c941029f5b2e789e3cb38a3",
      "created_at" : "2017-12-12T20:10:22Z",
      "diff_hunk" : "@@ -2069,44 +2078,21 @@ bool CConnman::BindListenPort(const CService &addrBind, std::string& strError, b\n         return false;\n     }\n \n-    SOCKET hListenSocket = socket(((struct sockaddr*)&sockaddr)->sa_family, SOCK_STREAM, IPPROTO_TCP);\n+    SOCKET hListenSocket = CreateSocket(addrBind);\n     if (hListenSocket == INVALID_SOCKET)\n     {\n         strError = strprintf(\"Error: Couldn't open socket for incoming connections (socket returned error %s)\", NetworkErrorString(WSAGetLastError()));\n         LogPrintf(\"%s\\n\", strError);\n         return false;\n     }\n-    if (!IsSelectableSocket(hListenSocket))\n-    {\n-        strError = \"Error: Couldn't create a listenable socket for incoming connections\";\n-        LogPrintf(\"%s\\n\", strError);\n-        return false;\n-    }\n-\n-\n #ifndef WIN32\n-#ifdef SO_NOSIGPIPE\n-    // Different way of disabling SIGPIPE on BSD\n-    setsockopt(hListenSocket, SOL_SOCKET, SO_NOSIGPIPE, (void*)&nOne, sizeof(int));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11363#discussion_r156482239",
      "id" : 156482239,
      "in_reply_to_id" : 156341473,
      "original_commit_id" : "f766175ebe4400561f60b75b0ede4015003bad8c",
      "original_position" : 90,
      "path" : "src/net.cpp",
      "position" : 90,
      "pull_request_review_id" : 82966375,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11363",
      "updated_at" : "2017-12-12T20:31:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156482239",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11363#discussion_r156483628"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11363"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156483628"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's set on the listen socket as well (which should pass it down to accepted sockets anyway), since BindListenPort now uses CreateSocket().",
      "commit_id" : "3830b6e0659106458c941029f5b2e789e3cb38a3",
      "created_at" : "2017-12-12T20:16:20Z",
      "diff_hunk" : "@@ -2069,44 +2078,21 @@ bool CConnman::BindListenPort(const CService &addrBind, std::string& strError, b\n         return false;\n     }\n \n-    SOCKET hListenSocket = socket(((struct sockaddr*)&sockaddr)->sa_family, SOCK_STREAM, IPPROTO_TCP);\n+    SOCKET hListenSocket = CreateSocket(addrBind);\n     if (hListenSocket == INVALID_SOCKET)\n     {\n         strError = strprintf(\"Error: Couldn't open socket for incoming connections (socket returned error %s)\", NetworkErrorString(WSAGetLastError()));\n         LogPrintf(\"%s\\n\", strError);\n         return false;\n     }\n-    if (!IsSelectableSocket(hListenSocket))\n-    {\n-        strError = \"Error: Couldn't create a listenable socket for incoming connections\";\n-        LogPrintf(\"%s\\n\", strError);\n-        return false;\n-    }\n-\n-\n #ifndef WIN32\n-#ifdef SO_NOSIGPIPE\n-    // Different way of disabling SIGPIPE on BSD\n-    setsockopt(hListenSocket, SOL_SOCKET, SO_NOSIGPIPE, (void*)&nOne, sizeof(int));\n-#endif\n     // Allow binding if the port is still in TIME_WAIT state after\n     // the program was closed and restarted.\n     setsockopt(hListenSocket, SOL_SOCKET, SO_REUSEADDR, (void*)&nOne, sizeof(int));\n-    // Disable Nagle's algorithm\n-    setsockopt(hListenSocket, IPPROTO_TCP, TCP_NODELAY, (void*)&nOne, sizeof(int));\n #else\n     setsockopt(hListenSocket, SOL_SOCKET, SO_REUSEADDR, (const char*)&nOne, sizeof(int));\n-    setsockopt(hListenSocket, IPPROTO_TCP, TCP_NODELAY, (const char*)&nOne, sizeof(int));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11363#discussion_r156483628",
      "id" : 156483628,
      "in_reply_to_id" : 156341683,
      "original_commit_id" : "f766175ebe4400561f60b75b0ede4015003bad8c",
      "original_position" : 99,
      "path" : "src/net.cpp",
      "position" : 99,
      "pull_request_review_id" : 82968063,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11363",
      "updated_at" : "2017-12-12T20:31:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156483628",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@laanwj Yes, thanks. Due to our SOCKET wrappers, we need to compare against INVALID_SOCKET rather than SOCKET_ERROR. Pushed the squashed change as it was very simple (it's actually just reverting a change from this PR, it was already correct in master).\r\n\r\nDiff from before: git diff f766175ebe44..3830b6e06591\r\n```patch\r\n\r\ndiff --git a/src/netbase.cpp b/src/netbase.cpp\r\nindex ba2c988..74ea6b1 100644\r\n--- a/src/netbase.cpp\r\n+++ b/src/netbase.cpp\r\n@@ -446,7 +446,7 @@ SOCKET CreateSocket(const CService &addrConnect)\r\n     }\r\n \r\n     SOCKET hSocket = socket(((struct sockaddr*)&sockaddr)->sa_family, SOCK_STREAM, IPPROTO_TCP);\r\n-    if (hSocket == SOCKET_ERROR)\r\n+    if (hSocket == INVALID_SOCKET)\r\n         return INVALID_SOCKET;\r\n \r\n     if (!IsSelectableSocket(hSocket)) {\r\n```",
      "created_at" : "2017-12-12T20:34:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11363#issuecomment-351185698",
      "id" : 351185698,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11363",
      "updated_at" : "2017-12-12T20:34:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/351185698",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "utACK 3830b6e0659106458c941029f5b2e789e3cb38a3",
      "created_at" : "2017-12-13T04:42:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11363#issuecomment-351280671",
      "id" : 351280671,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11363",
      "updated_at" : "2017-12-13T04:42:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/351280671",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
