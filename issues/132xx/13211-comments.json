[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Oh cool - if you are going to split into platform dependent code - you can post to a pthreads semaphore from a unix signal handler. \r\nWould also suggest that anyone waiting/reading from the semaphore/pipe immediately post/write back that way you could have multiple threads listening for shutdown as opposed to restricting it to only one as you do currently",
      "created_at" : "2018-05-10T17:40:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13211#issuecomment-388128166",
      "id" : 388128166,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13211",
      "updated_at" : "2018-05-10T17:40:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/388128166",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/195769?v=4",
         "events_url" : "https://api.github.com/users/skeees/events{/privacy}",
         "followers_url" : "https://api.github.com/users/skeees/followers",
         "following_url" : "https://api.github.com/users/skeees/following{/other_user}",
         "gists_url" : "https://api.github.com/users/skeees/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/skeees",
         "id" : 195769,
         "login" : "skeees",
         "organizations_url" : "https://api.github.com/users/skeees/orgs",
         "received_events_url" : "https://api.github.com/users/skeees/received_events",
         "repos_url" : "https://api.github.com/users/skeees/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/skeees/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/skeees/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/skeees"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : ">  you can post to a pthreads semaphore from a unix signal handler.\r\n\r\nI'm fairly sure none of the pthreads-api is signal safe, at least on all platforms.\r\n\r\n> Would also suggest that anyone waiting/reading from the semaphore/pipe immediately post/write back that way you could have multiple threads listening for shutdown as opposed to restricting it to only one as you do currently\r\n\r\nWe only need to wait for shutdown in one thread, so as I see it that additional complexity is not needed. If it happens to be needed in the future it can be added then.\r\n\r\nEdit: Travis issue is interesting though: looks like there is a race at shutdown where the HTTP server doesn't get to send back the reply to `stop()`. I'd be surprised if it is new in this pull, though it probably comes to the foreground due to the instant shutdown notification. I remember previous discussion about this in #11006 (esp. https://github.com/bitcoin/bitcoin/pull/11006#issuecomment-321373993).\r\n",
      "created_at" : "2018-05-10T17:43:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13211#issuecomment-388129054",
      "id" : 388129054,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13211",
      "updated_at" : "2018-05-10T17:58:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/388129054",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "Added a commit that reverts 793667a  (#11006) to hopefully make travis pass. Likely, this has to be conditional on libevent version to prevent adding a delay on shutdown in another place while fixing another.\r\n\r\nEdit: that worked locally, but not on travis- weird.",
      "created_at" : "2018-05-10T18:17:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13211#issuecomment-388139315",
      "id" : 388139315,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13211",
      "updated_at" : "2018-05-10T18:36:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/388139315",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe that shutdown is too quick, add 50ms delay? It failed on my machine occasionally",
      "created_at" : "2018-05-14T01:18:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13211#issuecomment-388671592",
      "id" : 388671592,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13211",
      "updated_at" : "2018-05-14T01:25:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/388671592",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Maybe that shutdown is too quick, add 50ms delay? It failed on my machine occasionally\r\n\r\nAdding a fixed delay is never a valid solution.",
      "created_at" : "2018-06-04T14:07:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13211#issuecomment-394367191",
      "id" : 394367191,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13211",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5NDM2NzE5MQ==",
      "updated_at" : "2018-06-04T14:07:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/394367191",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Once `StopHTTPServer` has been called in main thread ,the event loop in http thread exit. But http workqueue thread needs to use the event loop to call `evhttp_send_reply`, this could happen after the http thread event loop has already exit.\r\nhttps://github.com/bitcoin/bitcoin/blob/be27048a1842b76de5b230383c1466b72dfd8cc5/src/httpserver.cpp#L591",
      "created_at" : "2018-06-16T16:01:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13211#issuecomment-397821933",
      "id" : 397821933,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13211",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5NzgyMTkzMw==",
      "updated_at" : "2018-06-16T16:14:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/397821933",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "node_id" : "MDQ6VXNlcjExMTU0MTE4",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Closing this for now, I don't think it's that important, the current way works fine.",
      "created_at" : "2018-06-24T16:32:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13211#issuecomment-399769117",
      "id" : 399769117,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13211",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5OTc2OTExNw==",
      "updated_at" : "2018-06-24T16:32:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/399769117",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
