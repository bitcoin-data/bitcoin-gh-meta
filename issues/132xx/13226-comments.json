[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "/cc @achow101 this is the last of my BnB series",
      "created_at" : "2018-05-14T06:11:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13226#issuecomment-388707433",
      "id" : 388707433,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13226",
      "updated_at" : "2018-05-14T06:11:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/388707433",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13226#discussion_r187994502"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13226"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187994502"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I believe this is incorrect. This will set `curr_waste` to `candidate_waste` which we don't want.",
      "commit_id" : "c95aa437059c88fdacdff242175ca74477ea3e79",
      "created_at" : "2018-05-14T15:22:44Z",
      "diff_hunk" : "@@ -95,16 +95,15 @@ bool SelectCoinsBnB(std::vector<CInputCoin>& utxo_pool, const CAmount& target_va\n             (curr_waste > best_waste && (utxo_pool.at(0).fee - utxo_pool.at(0).long_term_fee) > 0)) { // Don't select things which we know will be more wasteful if the waste is increasing\n             backtrack = true;\n         } else if (curr_value >= actual_target) {       // Selected value is within range\n-            curr_waste += (curr_value - actual_target); // This is the excess value which is added to the waste for the below comparison\n+            CAmount candidate_waste = curr_waste + (curr_value - actual_target);\n             // Adding another UTXO after this check could bring the waste down if the long term fee is higher than the current fee.\n             // However we are not going to explore that because this optimization for the waste is only done when we have hit our target\n             // value. Adding any more UTXOs will be just burning the UTXO; it will go entirely to fees. Thus we aren't going to\n             // explore any more UTXOs to avoid burning money like that.\n-            if (curr_waste <= best_waste) {\n+            if (candidate_waste <= best_waste) {\n                 best_selection = curr_selection;\n-                best_waste = curr_waste;\n+                best_waste = curr_waste = candidate_waste;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13226#discussion_r187994502",
      "id" : 187994502,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4Nzk5NDUwMg==",
      "original_commit_id" : "d74e5837f15022b0fcd747a94c39747824c159bd",
      "original_position" : 14,
      "path" : "src/wallet/coinselection.cpp",
      "position" : null,
      "pull_request_review_id" : 119884195,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13226",
      "updated_at" : "2018-10-08T04:59:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/187994502",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13226#discussion_r188042571"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13226"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188042571"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed.",
      "commit_id" : "c95aa437059c88fdacdff242175ca74477ea3e79",
      "created_at" : "2018-05-14T17:54:22Z",
      "diff_hunk" : "@@ -95,16 +95,15 @@ bool SelectCoinsBnB(std::vector<CInputCoin>& utxo_pool, const CAmount& target_va\n             (curr_waste > best_waste && (utxo_pool.at(0).fee - utxo_pool.at(0).long_term_fee) > 0)) { // Don't select things which we know will be more wasteful if the waste is increasing\n             backtrack = true;\n         } else if (curr_value >= actual_target) {       // Selected value is within range\n-            curr_waste += (curr_value - actual_target); // This is the excess value which is added to the waste for the below comparison\n+            CAmount candidate_waste = curr_waste + (curr_value - actual_target);\n             // Adding another UTXO after this check could bring the waste down if the long term fee is higher than the current fee.\n             // However we are not going to explore that because this optimization for the waste is only done when we have hit our target\n             // value. Adding any more UTXOs will be just burning the UTXO; it will go entirely to fees. Thus we aren't going to\n             // explore any more UTXOs to avoid burning money like that.\n-            if (curr_waste <= best_waste) {\n+            if (candidate_waste <= best_waste) {\n                 best_selection = curr_selection;\n-                best_waste = curr_waste;\n+                best_waste = curr_waste = candidate_waste;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13226#discussion_r188042571",
      "id" : 188042571,
      "in_reply_to_id" : 187994502,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE4ODA0MjU3MQ==",
      "original_commit_id" : "d74e5837f15022b0fcd747a94c39747824c159bd",
      "original_position" : 14,
      "path" : "src/wallet/coinselection.cpp",
      "position" : null,
      "pull_request_review_id" : 119942299,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13226",
      "updated_at" : "2018-10-08T04:59:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/188042571",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased for #13691",
      "created_at" : "2018-07-23T01:19:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13226#issuecomment-406913364",
      "id" : 406913364,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13226",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwNjkxMzM2NA==",
      "updated_at" : "2018-07-23T01:19:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/406913364",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Dropped the second commit as insignificant, updated the description / benchmarks.",
      "created_at" : "2018-07-23T01:34:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13226#issuecomment-406914817",
      "id" : 406914817,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13226",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwNjkxNDgxNw==",
      "updated_at" : "2018-07-23T01:34:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/406914817",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13226#discussion_r223206454"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13226"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/223206454"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This will lead to an unsigned integer overflow in the case of `curr_index == 0`. Could change logic and ordering to avoid that?",
      "commit_id" : "c95aa437059c88fdacdff242175ca74477ea3e79",
      "created_at" : "2018-10-07T09:23:30Z",
      "diff_hunk" : "@@ -111,36 +110,37 @@ bool SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& target_v\n \n         // Backtracking, moving backwards\n         if (backtrack) {\n-            // Walk backwards to find the last included UTXO that still needs to have its omission branch traversed.\n-            while (!curr_selection.empty() && !curr_selection.back()) {\n-                curr_selection.pop_back();\n-                curr_available_value += utxo_pool.at(curr_selection.size()).effective_value;\n+            if (curr_selection.empty()) {\n+                // No branch is untraversed. All solutions searched\n+                break;\n             }\n \n-            if (curr_selection.empty()) { // We have walked back to the first utxo and no branch is untraversed. All solutions searched\n-                break;\n+            // Walk backwards to find the last included UTXO that still needs to have its omission branch traversed.\n+            for (--curr_index; curr_index > curr_selection.back(); --curr_index) {\n+                curr_available_value += utxo_pool.at(curr_index).effective_value;\n             }\n \n             // Output was included on previous iterations, try excluding now.\n-            curr_selection.back() = false;\n-            OutputGroup& utxo = utxo_pool.at(curr_selection.size() - 1);\n+            OutputGroup& utxo = utxo_pool.at(curr_index);\n             curr_value -= utxo.effective_value;\n             curr_waste -= utxo.fee - utxo.long_term_fee;\n+            curr_selection.pop_back();\n         } else { // Moving forwards, continuing down this branch\n-            OutputGroup& utxo = utxo_pool.at(curr_selection.size());\n+            OutputGroup& utxo = utxo_pool.at(curr_index);\n \n             // Remove this utxo from the curr_available_value utxo amount\n             curr_available_value -= utxo.effective_value;\n \n             // Avoid searching a branch if the previous UTXO has the same value and same waste and was excluded. Since the ratio of fee to\n             // long term fee is the same, we only need to check if one of those values match in order to know that the waste is the same.\n-            if (!curr_selection.empty() && !curr_selection.back() &&\n-                utxo.effective_value == utxo_pool.at(curr_selection.size() - 1).effective_value &&\n-                utxo.fee == utxo_pool.at(curr_selection.size() - 1).fee) {\n-                curr_selection.push_back(false);\n-            } else {\n+            size_t prev_index = curr_index - 1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13226#discussion_r223206454",
      "id" : 223206454,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMzIwNjQ1NA==",
      "original_commit_id" : "4c24e8ed78dee577a5c98318a1d8ea9a1b198474",
      "original_position" : 72,
      "path" : "src/wallet/coinselection.cpp",
      "position" : null,
      "pull_request_review_id" : 162283563,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13226",
      "updated_at" : "2018-10-08T04:59:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/223206454",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13226#discussion_r223248439"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13226"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/223248439"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fair enough, I moved the subtraction inline, which avoids storing the overflowed value in the 0 case, and is more consistent with prior implementation. Note the behavior is not changed as the 0 case also corresponded to `curr_selection` being empty.",
      "commit_id" : "c95aa437059c88fdacdff242175ca74477ea3e79",
      "created_at" : "2018-10-08T05:01:25Z",
      "diff_hunk" : "@@ -111,36 +110,37 @@ bool SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& target_v\n \n         // Backtracking, moving backwards\n         if (backtrack) {\n-            // Walk backwards to find the last included UTXO that still needs to have its omission branch traversed.\n-            while (!curr_selection.empty() && !curr_selection.back()) {\n-                curr_selection.pop_back();\n-                curr_available_value += utxo_pool.at(curr_selection.size()).effective_value;\n+            if (curr_selection.empty()) {\n+                // No branch is untraversed. All solutions searched\n+                break;\n             }\n \n-            if (curr_selection.empty()) { // We have walked back to the first utxo and no branch is untraversed. All solutions searched\n-                break;\n+            // Walk backwards to find the last included UTXO that still needs to have its omission branch traversed.\n+            for (--curr_index; curr_index > curr_selection.back(); --curr_index) {\n+                curr_available_value += utxo_pool.at(curr_index).effective_value;\n             }\n \n             // Output was included on previous iterations, try excluding now.\n-            curr_selection.back() = false;\n-            OutputGroup& utxo = utxo_pool.at(curr_selection.size() - 1);\n+            OutputGroup& utxo = utxo_pool.at(curr_index);\n             curr_value -= utxo.effective_value;\n             curr_waste -= utxo.fee - utxo.long_term_fee;\n+            curr_selection.pop_back();\n         } else { // Moving forwards, continuing down this branch\n-            OutputGroup& utxo = utxo_pool.at(curr_selection.size());\n+            OutputGroup& utxo = utxo_pool.at(curr_index);\n \n             // Remove this utxo from the curr_available_value utxo amount\n             curr_available_value -= utxo.effective_value;\n \n             // Avoid searching a branch if the previous UTXO has the same value and same waste and was excluded. Since the ratio of fee to\n             // long term fee is the same, we only need to check if one of those values match in order to know that the waste is the same.\n-            if (!curr_selection.empty() && !curr_selection.back() &&\n-                utxo.effective_value == utxo_pool.at(curr_selection.size() - 1).effective_value &&\n-                utxo.fee == utxo_pool.at(curr_selection.size() - 1).fee) {\n-                curr_selection.push_back(false);\n-            } else {\n+            size_t prev_index = curr_index - 1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13226#discussion_r223248439",
      "id" : 223248439,
      "in_reply_to_id" : 223206454,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyMzI0ODQzOQ==",
      "original_commit_id" : "4c24e8ed78dee577a5c98318a1d8ea9a1b198474",
      "original_position" : 72,
      "path" : "src/wallet/coinselection.cpp",
      "position" : null,
      "pull_request_review_id" : 162328917,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13226",
      "updated_at" : "2018-10-08T05:01:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/223248439",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Closing this given #13167 is closed, and optimizing coin selection perf isn't much of a priority.",
      "created_at" : "2019-05-28T21:09:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13226#issuecomment-496691108",
      "id" : 496691108,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13226",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5NjY5MTEwOA==",
      "updated_at" : "2019-05-28T21:09:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/496691108",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@Xekyo take a look",
      "created_at" : "2021-06-03T01:18:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13226#issuecomment-853488126",
      "id" : 853488126,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13226",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg1MzQ4ODEyNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-03T01:18:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/853488126",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-06-03T01:58:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13226#issuecomment-853501576",
      "id" : 853501576,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13226",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg1MzUwMTU3Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-03T01:58:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/853501576",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.",
      "created_at" : "2021-06-07T03:45:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13226#issuecomment-855553658",
      "id" : 855553658,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13226",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg1NTU1MzY1OA==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/855553658/reactions"
      },
      "updated_at" : "2022-03-01T07:23:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/855553658",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13226#discussion_r650218070"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13226"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650218070"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Optional: Please update comment to \"add omitted UTXOs back to lookahead before traversing the omission branch of last included UTXO\"",
      "commit_id" : "7714444c08ce103297508bd1fb4b08bc67f6f637",
      "created_at" : "2021-06-11T19:25:27Z",
      "diff_hunk" : "@@ -115,36 +114,35 @@ bool SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selectio\n \n         // Backtracking, moving backwards\n         if (backtrack) {\n-            // Walk backwards to find the last included UTXO that still needs to have its omission branch traversed.\n-            while (!curr_selection.empty() && !curr_selection.back()) {\n-                curr_selection.pop_back();\n-                curr_available_value += utxo_pool.at(curr_selection.size()).GetSelectionAmount();\n+            if (curr_selection.empty()) { // No branch is untraversed. All solutions searched\n+                break;\n             }\n \n-            if (curr_selection.empty()) { // We have walked back to the first utxo and no branch is untraversed. All solutions searched\n-                break;\n+            // Walk backwards to find the last included UTXO that still needs to have its omission branch traversed.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13226#discussion_r650218070",
      "id" : 650218070,
      "line" : 121,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDIxODA3MA==",
      "original_commit_id" : "7714444c08ce103297508bd1fb4b08bc67f6f637",
      "original_line" : 121,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.cpp",
      "position" : 45,
      "pull_request_review_id" : 682154733,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13226",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-11T19:51:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650218070",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13226#discussion_r650224527"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13226"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650224527"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Took me a bit to verify whether this is equivalent, but this does look correct to me. \r\n\r\nOptional: The comment about \"fee to long term fee\" threw me off at first, perhaps it would actually be clearer to drop the second sentence of the comment before the if-block.",
      "commit_id" : "7714444c08ce103297508bd1fb4b08bc67f6f637",
      "created_at" : "2021-06-11T19:39:08Z",
      "diff_hunk" : "@@ -115,36 +114,35 @@ bool SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selectio\n \n         // Backtracking, moving backwards\n         if (backtrack) {\n-            // Walk backwards to find the last included UTXO that still needs to have its omission branch traversed.\n-            while (!curr_selection.empty() && !curr_selection.back()) {\n-                curr_selection.pop_back();\n-                curr_available_value += utxo_pool.at(curr_selection.size()).GetSelectionAmount();\n+            if (curr_selection.empty()) { // No branch is untraversed. All solutions searched\n+                break;\n             }\n \n-            if (curr_selection.empty()) { // We have walked back to the first utxo and no branch is untraversed. All solutions searched\n-                break;\n+            // Walk backwards to find the last included UTXO that still needs to have its omission branch traversed.\n+            for (--curr_index; curr_index > curr_selection.back(); --curr_index) {\n+                curr_available_value += utxo_pool.at(curr_index).GetSelectionAmount();\n             }\n \n             // Output was included on previous iterations, try excluding now.\n-            curr_selection.back() = false;\n-            OutputGroup& utxo = utxo_pool.at(curr_selection.size() - 1);\n+            OutputGroup& utxo = utxo_pool.at(curr_index);\n             curr_value -= utxo.GetSelectionAmount();\n             curr_waste -= utxo.fee - utxo.long_term_fee;\n+            curr_selection.pop_back();\n         } else { // Moving forwards, continuing down this branch\n-            OutputGroup& utxo = utxo_pool.at(curr_selection.size());\n+            OutputGroup& utxo = utxo_pool.at(curr_index);\n \n             // Remove this utxo from the curr_available_value utxo amount\n             curr_available_value -= utxo.GetSelectionAmount();\n \n             // Avoid searching a branch if the previous UTXO has the same value and same waste and was excluded. Since the ratio of fee to\n             // long term fee is the same, we only need to check if one of those values match in order to know that the waste is the same.\n-            if (!curr_selection.empty() && !curr_selection.back() &&\n-                utxo.GetSelectionAmount() == utxo_pool.at(curr_selection.size() - 1).GetSelectionAmount() &&\n-                utxo.fee == utxo_pool.at(curr_selection.size() - 1).fee) {\n-                curr_selection.push_back(false);\n-            } else {\n+            if (curr_selection.empty() ||\n+                // The previous index is included and therefore not relevant for exclusion shortcut\n+                (curr_index - 1) == curr_selection.back() ||\n+                utxo.GetSelectionAmount() != utxo_pool.at(curr_index - 1).GetSelectionAmount() ||\n+                utxo.fee != utxo_pool.at(curr_index - 1).fee) {\n                 // Inclusion branch first (Largest First Exploration)\n-                curr_selection.push_back(true);\n+                curr_selection.push_back(curr_index);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13226#discussion_r650224527",
      "id" : 650224527,
      "line" : 145,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDIyNDUyNw==",
      "original_commit_id" : "7714444c08ce103297508bd1fb4b08bc67f6f637",
      "original_line" : 145,
      "original_position" : 78,
      "original_start_line" : 139,
      "path" : "src/wallet/coinselection.cpp",
      "position" : 78,
      "pull_request_review_id" : 682154733,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13226",
      "side" : "RIGHT",
      "start_line" : 139,
      "start_side" : "RIGHT",
      "updated_at" : "2021-06-11T19:51:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650224527",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13226#discussion_r650227356"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13226"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650227356"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Optional: given that we now have two indices incremented in this for-loop, perhaps rename `i` to `try` and `curr_index` to `utxo_pool_depth`.",
      "commit_id" : "7714444c08ce103297508bd1fb4b08bc67f6f637",
      "created_at" : "2021-06-11T19:45:17Z",
      "diff_hunk" : "@@ -84,11 +84,11 @@ bool SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selectio\n     std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n \n     CAmount curr_waste = 0;\n-    std::vector<bool> best_selection;\n+    std::vector<size_t> best_selection;\n     CAmount best_waste = MAX_MONEY;\n \n     // Depth First search loop for choosing the UTXOs\n-    for (size_t i = 0; i < TOTAL_TRIES; ++i) {\n+    for (size_t i = 0, curr_index = 0; i < TOTAL_TRIES; ++i, ++curr_index) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13226#discussion_r650227356",
      "id" : 650227356,
      "line" : 91,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDIyNzM1Ng==",
      "original_commit_id" : "7714444c08ce103297508bd1fb4b08bc67f6f637",
      "original_line" : 91,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.cpp",
      "position" : 19,
      "pull_request_review_id" : 682154733,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13226",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-11T19:51:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650227356",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Hi @Empact, are you still making progress on this, or would you be open to the idea of someone else adopting the PR? I was just considering amending my prior commentary after not looking at this for a while, but I would be happy to take a look at the failing check instead, if you aren't working on this anymore.",
      "created_at" : "2021-08-27T19:53:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13226#issuecomment-907440773",
      "id" : 907440773,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13226",
      "node_id" : "IC_kwDOABII5842FnKF",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-27T19:53:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/907440773",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Hey Mark, yes I'd like to pick it back up again - have been otherwise engaged for a while but I expect to have time next week.",
      "created_at" : "2021-08-28T01:50:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13226#issuecomment-907548417",
      "id" : 907548417,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13226",
      "node_id" : "IC_kwDOABII5842GBcB",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-28T01:50:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/907548417",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-12-09T17:11:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13226#issuecomment-990049986",
      "id" : 990049986,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13226",
      "node_id" : "IC_kwDOABII5847AvbC",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/990049986/reactions"
      },
      "updated_at" : "2021-12-09T17:11:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/990049986",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13226#discussion_r815838153"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13226"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/815838153"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done in https://github.com/bitcoin/bitcoin/pull/13226/commits/6a48916db5eee83dbff5069ffec9bb1331fd1420",
      "commit_id" : "e6b45f39457f5d52232faf5b9395b7420a52bdc5",
      "created_at" : "2022-02-28T12:18:09Z",
      "diff_hunk" : "@@ -115,36 +114,35 @@ bool SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selectio\n \n         // Backtracking, moving backwards\n         if (backtrack) {\n-            // Walk backwards to find the last included UTXO that still needs to have its omission branch traversed.\n-            while (!curr_selection.empty() && !curr_selection.back()) {\n-                curr_selection.pop_back();\n-                curr_available_value += utxo_pool.at(curr_selection.size()).GetSelectionAmount();\n+            if (curr_selection.empty()) { // No branch is untraversed. All solutions searched\n+                break;\n             }\n \n-            if (curr_selection.empty()) { // We have walked back to the first utxo and no branch is untraversed. All solutions searched\n-                break;\n+            // Walk backwards to find the last included UTXO that still needs to have its omission branch traversed.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13226#discussion_r815838153",
      "id" : 815838153,
      "in_reply_to_id" : 650218070,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584woLPJ",
      "original_commit_id" : "7714444c08ce103297508bd1fb4b08bc67f6f637",
      "original_line" : 121,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.cpp",
      "position" : null,
      "pull_request_review_id" : 895013394,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13226",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/815838153/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-28T12:18:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/815838153",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13226#discussion_r815847915"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13226"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/815847915"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah - as an aid to the reviewer, I'm applying De Morgan's law here.\r\n\r\nI left the comment but moved it to above the relevant check.",
      "commit_id" : "e6b45f39457f5d52232faf5b9395b7420a52bdc5",
      "created_at" : "2022-02-28T12:30:56Z",
      "diff_hunk" : "@@ -115,36 +114,35 @@ bool SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selectio\n \n         // Backtracking, moving backwards\n         if (backtrack) {\n-            // Walk backwards to find the last included UTXO that still needs to have its omission branch traversed.\n-            while (!curr_selection.empty() && !curr_selection.back()) {\n-                curr_selection.pop_back();\n-                curr_available_value += utxo_pool.at(curr_selection.size()).GetSelectionAmount();\n+            if (curr_selection.empty()) { // No branch is untraversed. All solutions searched\n+                break;\n             }\n \n-            if (curr_selection.empty()) { // We have walked back to the first utxo and no branch is untraversed. All solutions searched\n-                break;\n+            // Walk backwards to find the last included UTXO that still needs to have its omission branch traversed.\n+            for (--curr_index; curr_index > curr_selection.back(); --curr_index) {\n+                curr_available_value += utxo_pool.at(curr_index).GetSelectionAmount();\n             }\n \n             // Output was included on previous iterations, try excluding now.\n-            curr_selection.back() = false;\n-            OutputGroup& utxo = utxo_pool.at(curr_selection.size() - 1);\n+            OutputGroup& utxo = utxo_pool.at(curr_index);\n             curr_value -= utxo.GetSelectionAmount();\n             curr_waste -= utxo.fee - utxo.long_term_fee;\n+            curr_selection.pop_back();\n         } else { // Moving forwards, continuing down this branch\n-            OutputGroup& utxo = utxo_pool.at(curr_selection.size());\n+            OutputGroup& utxo = utxo_pool.at(curr_index);\n \n             // Remove this utxo from the curr_available_value utxo amount\n             curr_available_value -= utxo.GetSelectionAmount();\n \n             // Avoid searching a branch if the previous UTXO has the same value and same waste and was excluded. Since the ratio of fee to\n             // long term fee is the same, we only need to check if one of those values match in order to know that the waste is the same.\n-            if (!curr_selection.empty() && !curr_selection.back() &&\n-                utxo.GetSelectionAmount() == utxo_pool.at(curr_selection.size() - 1).GetSelectionAmount() &&\n-                utxo.fee == utxo_pool.at(curr_selection.size() - 1).fee) {\n-                curr_selection.push_back(false);\n-            } else {\n+            if (curr_selection.empty() ||\n+                // The previous index is included and therefore not relevant for exclusion shortcut\n+                (curr_index - 1) == curr_selection.back() ||\n+                utxo.GetSelectionAmount() != utxo_pool.at(curr_index - 1).GetSelectionAmount() ||\n+                utxo.fee != utxo_pool.at(curr_index - 1).fee) {\n                 // Inclusion branch first (Largest First Exploration)\n-                curr_selection.push_back(true);\n+                curr_selection.push_back(curr_index);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13226#discussion_r815847915",
      "id" : 815847915,
      "in_reply_to_id" : 650224527,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584woNnr",
      "original_commit_id" : "7714444c08ce103297508bd1fb4b08bc67f6f637",
      "original_line" : 145,
      "original_position" : 78,
      "original_start_line" : 139,
      "path" : "src/wallet/coinselection.cpp",
      "position" : null,
      "pull_request_review_id" : 895025733,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13226",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/815847915/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-02-28T12:30:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/815847915",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13226#discussion_r815848413"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13226"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/815848413"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done, though I went with `utxo_pool_index`, and `curr_try` as `try` is a keyword.",
      "commit_id" : "e6b45f39457f5d52232faf5b9395b7420a52bdc5",
      "created_at" : "2022-02-28T12:31:39Z",
      "diff_hunk" : "@@ -84,11 +84,11 @@ bool SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selectio\n     std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n \n     CAmount curr_waste = 0;\n-    std::vector<bool> best_selection;\n+    std::vector<size_t> best_selection;\n     CAmount best_waste = MAX_MONEY;\n \n     // Depth First search loop for choosing the UTXOs\n-    for (size_t i = 0; i < TOTAL_TRIES; ++i) {\n+    for (size_t i = 0, curr_index = 0; i < TOTAL_TRIES; ++i, ++curr_index) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13226#discussion_r815848413",
      "id" : 815848413,
      "in_reply_to_id" : 650227356,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584woNvd",
      "original_commit_id" : "7714444c08ce103297508bd1fb4b08bc67f6f637",
      "original_line" : 91,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.cpp",
      "position" : null,
      "pull_request_review_id" : 895026369,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13226",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/815848413/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-28T12:40:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/815848413",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK e6b45f39457f5d52232faf5b9395b7420a52bdc5",
      "created_at" : "2022-03-02T12:17:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13226#issuecomment-1056865328",
      "id" : 1056865328,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13226",
      "node_id" : "IC_kwDOABII584-_nww",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1056865328/reactions"
      },
      "updated_at" : "2022-03-02T12:17:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1056865328",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13226#discussion_r823845790"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13226"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/823845790"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in cec31e08ca64168fd084bc71ec250d8eaca99537:\r\n\r\nGiven that a big motivation here is to *not* allocate memory for every UTXO, we should probably remove this `reserve(utxo_pool.size())` line",
      "commit_id" : "e6b45f39457f5d52232faf5b9395b7420a52bdc5",
      "created_at" : "2022-03-10T15:30:30Z",
      "diff_hunk" : "@@ -67,7 +67,7 @@ std::optional<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_poo\n     SelectionResult result(selection_target);\n     CAmount curr_value = 0;\n \n-    std::vector<bool> curr_selection; // select the utxo at this index\n+    std::vector<size_t> curr_selection; // selected utxo indexes\n     curr_selection.reserve(utxo_pool.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13226#discussion_r823845790",
      "id" : 823845790,
      "line" : 71,
      "node_id" : "PRRC_kwDOABII584xGuOe",
      "original_commit_id" : "cec31e08ca64168fd084bc71ec250d8eaca99537",
      "original_line" : 71,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.cpp",
      "position" : 6,
      "pull_request_review_id" : 906015703,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13226",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/823845790/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-11T13:43:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/823845790",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13226#discussion_r824719881"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13226"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/824719881"
         }
      },
      "author_association" : "MEMBER",
      "body" : "33e8d4b4b8999d5f80227fa20bed7271ab0976bd should be squashed into cec31e08ca64168fd084bc71ec250d8eaca99537, it was confusing to me that we're introducing a new `curr_index` variable in one commit, and then renaming it 2 commits later",
      "commit_id" : "e6b45f39457f5d52232faf5b9395b7420a52bdc5",
      "created_at" : "2022-03-11T13:38:33Z",
      "diff_hunk" : "@@ -89,7 +89,7 @@ std::optional<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_poo\n     CAmount best_waste = MAX_MONEY;\n \n     // Depth First search loop for choosing the UTXOs\n-    for (size_t curr_try = 0, curr_index = 0; curr_try < TOTAL_TRIES; ++curr_try, ++curr_index) {\n+    for (size_t curr_try = 0, utxo_pool_index = 0; curr_try < TOTAL_TRIES; ++curr_try, ++utxo_pool_index) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13226#discussion_r824719881",
      "id" : 824719881,
      "line" : 92,
      "node_id" : "PRRC_kwDOABII584xKDoJ",
      "original_commit_id" : "33e8d4b4b8999d5f80227fa20bed7271ab0976bd",
      "original_line" : 92,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.cpp",
      "position" : 5,
      "pull_request_review_id" : 906015703,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13226",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/824719881/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-11T13:43:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/824719881",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13226#discussion_r824721948"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13226"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/824721948"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in cec31e08ca64168fd084bc71ec250d8eaca99537: could be worth adding this line as a sanity check?\r\n```suggestion\r\n            assert(utxo_pool_index == curr_selection.back());\r\n            OutputGroup& utxo = utxo_pool.at(utxo_pool_index);\r\n```",
      "commit_id" : "e6b45f39457f5d52232faf5b9395b7420a52bdc5",
      "created_at" : "2022-03-11T13:41:08Z",
      "diff_hunk" : "@@ -114,38 +113,37 @@ std::optional<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_poo\n             backtrack = true;\n         }\n \n-        // Backtracking, moving backwards\n-        if (backtrack) {\n-            // Walk backwards to find the last included UTXO that still needs to have its omission branch traversed.\n-            while (!curr_selection.empty() && !curr_selection.back()) {\n-                curr_selection.pop_back();\n-                curr_available_value += utxo_pool.at(curr_selection.size()).GetSelectionAmount();\n-            }\n-\n+        if (backtrack) { // Backtracking, moving backwards\n             if (curr_selection.empty()) { // We have walked back to the first utxo and no branch is untraversed. All solutions searched\n                 break;\n             }\n \n+            // Add omitted UTXOs back to lookahead before traversing the omission branch of last included UTXO.\n+            for (--utxo_pool_index; utxo_pool_index > curr_selection.back(); --utxo_pool_index) {\n+                curr_available_value += utxo_pool.at(utxo_pool_index).GetSelectionAmount();\n+            }\n+\n             // Output was included on previous iterations, try excluding now.\n-            curr_selection.back() = false;\n-            OutputGroup& utxo = utxo_pool.at(curr_selection.size() - 1);\n+            OutputGroup& utxo = utxo_pool.at(utxo_pool_index);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13226#discussion_r824721948",
      "id" : 824721948,
      "line" : 127,
      "node_id" : "PRRC_kwDOABII584xKEIc",
      "original_commit_id" : "e6b45f39457f5d52232faf5b9395b7420a52bdc5",
      "original_line" : 127,
      "original_position" : 62,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.cpp",
      "position" : 62,
      "pull_request_review_id" : 906015703,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13226",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/824721948/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-11T13:43:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/824721948",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13226#discussion_r824723233"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13226"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/824723233"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In cec31e08ca64168fd084bc71ec250d8eaca99537: I actually think the original condition for exclusion shortcut was clearer, and don't really see a reason to DeMorgans it",
      "commit_id" : "e6b45f39457f5d52232faf5b9395b7420a52bdc5",
      "created_at" : "2022-03-11T13:42:54Z",
      "diff_hunk" : "@@ -116,36 +115,36 @@ std::optional<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_poo\n \n         // Backtracking, moving backwards\n         if (backtrack) {\n-            // Walk backwards to find the last included UTXO that still needs to have its omission branch traversed.\n-            while (!curr_selection.empty() && !curr_selection.back()) {\n-                curr_selection.pop_back();\n-                curr_available_value += utxo_pool.at(curr_selection.size()).GetSelectionAmount();\n-            }\n-\n             if (curr_selection.empty()) { // We have walked back to the first utxo and no branch is untraversed. All solutions searched\n                 break;\n             }\n \n+            // Walk backwards to find the last included UTXO that still needs to have its omission branch traversed.\n+            for (--curr_index; curr_index > curr_selection.back(); --curr_index) {\n+                curr_available_value += utxo_pool.at(curr_index).GetSelectionAmount();\n+            }\n+\n             // Output was included on previous iterations, try excluding now.\n-            curr_selection.back() = false;\n-            OutputGroup& utxo = utxo_pool.at(curr_selection.size() - 1);\n+            OutputGroup& utxo = utxo_pool.at(curr_index);\n             curr_value -= utxo.GetSelectionAmount();\n             curr_waste -= utxo.fee - utxo.long_term_fee;\n+            curr_selection.pop_back();\n         } else { // Moving forwards, continuing down this branch\n-            OutputGroup& utxo = utxo_pool.at(curr_selection.size());\n+            OutputGroup& utxo = utxo_pool.at(curr_index);\n \n             // Remove this utxo from the curr_available_value utxo amount\n             curr_available_value -= utxo.GetSelectionAmount();\n \n             // Avoid searching a branch if the previous UTXO has the same value and same waste and was excluded. Since the ratio of fee to\n             // long term fee is the same, we only need to check if one of those values match in order to know that the waste is the same.\n-            if (!curr_selection.empty() && !curr_selection.back() &&\n-                utxo.GetSelectionAmount() == utxo_pool.at(curr_selection.size() - 1).GetSelectionAmount() &&\n-                utxo.fee == utxo_pool.at(curr_selection.size() - 1).fee) {\n-                curr_selection.push_back(false);\n-            } else {\n+            if (curr_selection.empty() ||\n+                // The previous index is included and therefore not relevant for exclusion shortcut\n+                (curr_index - 1) == curr_selection.back() ||\n+                utxo.GetSelectionAmount() != utxo_pool.at(curr_index - 1).GetSelectionAmount() ||\n+                utxo.fee != utxo_pool.at(curr_index - 1).fee)\n+            {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13226#discussion_r824723233",
      "id" : 824723233,
      "line" : 144,
      "node_id" : "PRRC_kwDOABII584xKEch",
      "original_commit_id" : "cec31e08ca64168fd084bc71ec250d8eaca99537",
      "original_line" : 145,
      "original_position" : 76,
      "original_start_line" : 142,
      "path" : "src/wallet/coinselection.cpp",
      "position" : 76,
      "pull_request_review_id" : 906015703,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13226",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/824723233/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "LEFT",
      "updated_at" : "2022-03-11T13:43:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/824723233",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13226#discussion_r825885400"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13226"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/825885400"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> don't really see a reason to DeMorgans it\r\n\r\nThe reason is that one of the cases is no longer acted on, since we don't track excluded utxos in `curr_selection`, so we only have a no-op in the \"positive\" case, hence the desire to invert the condition.",
      "commit_id" : "9d2005285c77f6c4148bccfa0b8b9135abfa021c",
      "created_at" : "2022-03-14T12:18:16Z",
      "diff_hunk" : "@@ -116,36 +115,36 @@ std::optional<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_poo\n \n         // Backtracking, moving backwards\n         if (backtrack) {\n-            // Walk backwards to find the last included UTXO that still needs to have its omission branch traversed.\n-            while (!curr_selection.empty() && !curr_selection.back()) {\n-                curr_selection.pop_back();\n-                curr_available_value += utxo_pool.at(curr_selection.size()).GetSelectionAmount();\n-            }\n-\n             if (curr_selection.empty()) { // We have walked back to the first utxo and no branch is untraversed. All solutions searched\n                 break;\n             }\n \n+            // Walk backwards to find the last included UTXO that still needs to have its omission branch traversed.\n+            for (--curr_index; curr_index > curr_selection.back(); --curr_index) {\n+                curr_available_value += utxo_pool.at(curr_index).GetSelectionAmount();\n+            }\n+\n             // Output was included on previous iterations, try excluding now.\n-            curr_selection.back() = false;\n-            OutputGroup& utxo = utxo_pool.at(curr_selection.size() - 1);\n+            OutputGroup& utxo = utxo_pool.at(curr_index);\n             curr_value -= utxo.GetSelectionAmount();\n             curr_waste -= utxo.fee - utxo.long_term_fee;\n+            curr_selection.pop_back();\n         } else { // Moving forwards, continuing down this branch\n-            OutputGroup& utxo = utxo_pool.at(curr_selection.size());\n+            OutputGroup& utxo = utxo_pool.at(curr_index);\n \n             // Remove this utxo from the curr_available_value utxo amount\n             curr_available_value -= utxo.GetSelectionAmount();\n \n             // Avoid searching a branch if the previous UTXO has the same value and same waste and was excluded. Since the ratio of fee to\n             // long term fee is the same, we only need to check if one of those values match in order to know that the waste is the same.\n-            if (!curr_selection.empty() && !curr_selection.back() &&\n-                utxo.GetSelectionAmount() == utxo_pool.at(curr_selection.size() - 1).GetSelectionAmount() &&\n-                utxo.fee == utxo_pool.at(curr_selection.size() - 1).fee) {\n-                curr_selection.push_back(false);\n-            } else {\n+            if (curr_selection.empty() ||\n+                // The previous index is included and therefore not relevant for exclusion shortcut\n+                (curr_index - 1) == curr_selection.back() ||\n+                utxo.GetSelectionAmount() != utxo_pool.at(curr_index - 1).GetSelectionAmount() ||\n+                utxo.fee != utxo_pool.at(curr_index - 1).fee)\n+            {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13226#discussion_r825885400",
      "id" : 825885400,
      "in_reply_to_id" : 824723233,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584xOgLY",
      "original_commit_id" : "cec31e08ca64168fd084bc71ec250d8eaca99537",
      "original_line" : 144,
      "original_position" : 76,
      "original_start_line" : 142,
      "path" : "src/wallet/coinselection.cpp",
      "position" : null,
      "pull_request_review_id" : 908698715,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13226",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/825885400/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "LEFT",
      "updated_at" : "2022-03-14T12:18:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/825885400",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13226#discussion_r825901286"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13226"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/825901286"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Okay, makes sense",
      "commit_id" : "9d2005285c77f6c4148bccfa0b8b9135abfa021c",
      "created_at" : "2022-03-14T12:37:29Z",
      "diff_hunk" : "@@ -116,36 +115,36 @@ std::optional<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_poo\n \n         // Backtracking, moving backwards\n         if (backtrack) {\n-            // Walk backwards to find the last included UTXO that still needs to have its omission branch traversed.\n-            while (!curr_selection.empty() && !curr_selection.back()) {\n-                curr_selection.pop_back();\n-                curr_available_value += utxo_pool.at(curr_selection.size()).GetSelectionAmount();\n-            }\n-\n             if (curr_selection.empty()) { // We have walked back to the first utxo and no branch is untraversed. All solutions searched\n                 break;\n             }\n \n+            // Walk backwards to find the last included UTXO that still needs to have its omission branch traversed.\n+            for (--curr_index; curr_index > curr_selection.back(); --curr_index) {\n+                curr_available_value += utxo_pool.at(curr_index).GetSelectionAmount();\n+            }\n+\n             // Output was included on previous iterations, try excluding now.\n-            curr_selection.back() = false;\n-            OutputGroup& utxo = utxo_pool.at(curr_selection.size() - 1);\n+            OutputGroup& utxo = utxo_pool.at(curr_index);\n             curr_value -= utxo.GetSelectionAmount();\n             curr_waste -= utxo.fee - utxo.long_term_fee;\n+            curr_selection.pop_back();\n         } else { // Moving forwards, continuing down this branch\n-            OutputGroup& utxo = utxo_pool.at(curr_selection.size());\n+            OutputGroup& utxo = utxo_pool.at(curr_index);\n \n             // Remove this utxo from the curr_available_value utxo amount\n             curr_available_value -= utxo.GetSelectionAmount();\n \n             // Avoid searching a branch if the previous UTXO has the same value and same waste and was excluded. Since the ratio of fee to\n             // long term fee is the same, we only need to check if one of those values match in order to know that the waste is the same.\n-            if (!curr_selection.empty() && !curr_selection.back() &&\n-                utxo.GetSelectionAmount() == utxo_pool.at(curr_selection.size() - 1).GetSelectionAmount() &&\n-                utxo.fee == utxo_pool.at(curr_selection.size() - 1).fee) {\n-                curr_selection.push_back(false);\n-            } else {\n+            if (curr_selection.empty() ||\n+                // The previous index is included and therefore not relevant for exclusion shortcut\n+                (curr_index - 1) == curr_selection.back() ||\n+                utxo.GetSelectionAmount() != utxo_pool.at(curr_index - 1).GetSelectionAmount() ||\n+                utxo.fee != utxo_pool.at(curr_index - 1).fee)\n+            {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13226#discussion_r825901286",
      "id" : 825901286,
      "in_reply_to_id" : 824723233,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584xOkDm",
      "original_commit_id" : "cec31e08ca64168fd084bc71ec250d8eaca99537",
      "original_line" : 144,
      "original_position" : 76,
      "original_start_line" : 142,
      "path" : "src/wallet/coinselection.cpp",
      "position" : null,
      "pull_request_review_id" : 908720974,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13226",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/825901286/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "LEFT",
      "updated_at" : "2022-03-14T12:37:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/825901286",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "reACK 9d2005285c77f6c4148bccfa0b8b9135abfa021c",
      "created_at" : "2022-03-18T20:29:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13226#issuecomment-1072774831",
      "id" : 1072774831,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13226",
      "node_id" : "IC_kwDOABII584_8T6v",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1072774831/reactions"
      },
      "updated_at" : "2022-03-18T20:29:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1072774831",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
