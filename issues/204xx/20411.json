{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "Inspired by theStack's in Per-Peer Message Capture [here](https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-727627176).  More context [here](https://github.com/bitcoin/bitcoin/pull/19509#issuecomment-729302211) and relevant BIPs are [BIP37](https://github.com/bitcoin/bips/blob/master/bip-0037.mediawiki?rgh-link-date=2020-11-15T19%3A59%3A03Z#Extensions_to_existing_messages) and [BIP60](https://github.com/bitcoin/bips/blob/master/bip-0060.mediawiki?rgh-link-date=2020-11-15T19%3A59%3A03Z) (draft).\r\n\r\nThere is a discrepancy in the implementation of our p2p protocol between bitcoind and the testing framework.  The fRelay field is an optional field at the end of a version message as of protocol version 70001. However, when deserializing a message in bitcoind, we don't check the version to see if it can have an fRelay field or not.  Instead we unconditionally attempt to deserialize into the field.\r\n\r\nThis commit brings the testing framework in line with the implementation in core.\r\n\r\nThis matters for a version message with the following fields:\r\n\r\nVersion = 60000\r\nfRelay = 1\r\n\r\nBitcoind would deserialize this into a version message with Version=60000 and fRelay=1, whereas (before this PR) our testing framework would deserialize this into a version message with Version=60000 and fRelay=0.\r\n\r\n~~Concept ACK needed.  Alternative: Change behavior in core?~~  Got a few ð ",
   "closed_at" : "2021-02-20T10:11:34Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
      "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
      "followers_url" : "https://api.github.com/users/jnewbery/followers",
      "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/jnewbery",
      "id" : 1063656,
      "login" : "jnewbery",
      "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
      "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
      "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
      "repos_url" : "https://api.github.com/users/jnewbery/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/jnewbery"
   },
   "comments" : 10,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20411/comments",
   "created_at" : "2020-11-18T01:01:06Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20411/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/20411",
   "id" : 745203505,
   "labels" : [
      {
         "color" : "cccccc",
         "default" : false,
         "description" : "",
         "id" : 955867938,
         "name" : "Needs rebase",
         "node_id" : "MDU6TGFiZWw5NTU4Njc5Mzg=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase"
      },
      {
         "color" : "d4c5f9",
         "default" : false,
         "description" : null,
         "id" : 62963516,
         "name" : "Tests",
         "node_id" : "MDU6TGFiZWw2Mjk2MzUxNg==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests"
      },
      {
         "color" : "99a810",
         "default" : false,
         "description" : null,
         "id" : 749416508,
         "name" : "Up for grabs",
         "node_id" : "MDU6TGFiZWw3NDk0MTY1MDg=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Up%20for%20grabs"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20411/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDExOlB1bGxSZXF1ZXN0NTIyODAzMzE3",
   "number" : 20411,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/20411.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20411",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/20411.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20411"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "test: Fix Version Message Deserialization Discrepancy",
   "updated_at" : "2021-02-20T10:13:51Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20411",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/5553787?v=4",
      "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
      "followers_url" : "https://api.github.com/users/troygiorshev/followers",
      "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
      "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/troygiorshev",
      "id" : 5553787,
      "login" : "troygiorshev",
      "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
      "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
      "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
      "repos_url" : "https://api.github.com/users/troygiorshev/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/troygiorshev"
   }
}
