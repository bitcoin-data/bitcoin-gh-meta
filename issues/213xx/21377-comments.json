[
   {
      "author_association" : "NONE",
      "body" : "+1",
      "created_at" : "2021-03-06T10:21:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-791908084",
      "id" : 791908084,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5MTkwODA4NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-06T10:21:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/791908084",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1369335?v=4",
         "events_url" : "https://api.github.com/users/evoskuil/events{/privacy}",
         "followers_url" : "https://api.github.com/users/evoskuil/followers",
         "following_url" : "https://api.github.com/users/evoskuil/following{/other_user}",
         "gists_url" : "https://api.github.com/users/evoskuil/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/evoskuil",
         "id" : 1369335,
         "login" : "evoskuil",
         "node_id" : "MDQ6VXNlcjEzNjkzMzU=",
         "organizations_url" : "https://api.github.com/users/evoskuil/orgs",
         "received_events_url" : "https://api.github.com/users/evoskuil/received_events",
         "repos_url" : "https://api.github.com/users/evoskuil/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/evoskuil/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/evoskuil/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/evoskuil"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2021-03-06T12:06:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-791925483",
      "id" : 791925483,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5MTkyNTQ4Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-06T12:06:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/791925483",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2021-03-06T12:41:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-791930950",
      "id" : 791930950,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5MTkzMDk1MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-06T12:41:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/791930950",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/16323900?v=4",
         "events_url" : "https://api.github.com/users/michaelfolkson/events{/privacy}",
         "followers_url" : "https://api.github.com/users/michaelfolkson/followers",
         "following_url" : "https://api.github.com/users/michaelfolkson/following{/other_user}",
         "gists_url" : "https://api.github.com/users/michaelfolkson/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/michaelfolkson",
         "id" : 16323900,
         "login" : "michaelfolkson",
         "node_id" : "MDQ6VXNlcjE2MzIzOTAw",
         "organizations_url" : "https://api.github.com/users/michaelfolkson/orgs",
         "received_events_url" : "https://api.github.com/users/michaelfolkson/received_events",
         "repos_url" : "https://api.github.com/users/michaelfolkson/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/michaelfolkson/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/michaelfolkson/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/michaelfolkson"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I take it that this PR doesn't preclude also migrating to BIP8-style height based activation?",
      "created_at" : "2021-03-06T14:14:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-791956464",
      "id" : 791956464,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5MTk1NjQ2NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-06T14:14:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/791956464",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/21371712?v=4",
         "events_url" : "https://api.github.com/users/roconnor-blockstream/events{/privacy}",
         "followers_url" : "https://api.github.com/users/roconnor-blockstream/followers",
         "following_url" : "https://api.github.com/users/roconnor-blockstream/following{/other_user}",
         "gists_url" : "https://api.github.com/users/roconnor-blockstream/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/roconnor-blockstream",
         "id" : 21371712,
         "login" : "roconnor-blockstream",
         "node_id" : "MDQ6VXNlcjIxMzcxNzEy",
         "organizations_url" : "https://api.github.com/users/roconnor-blockstream/orgs",
         "received_events_url" : "https://api.github.com/users/roconnor-blockstream/received_events",
         "repos_url" : "https://api.github.com/users/roconnor-blockstream/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/roconnor-blockstream/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/roconnor-blockstream/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/roconnor-blockstream"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I take it that this PR doesn't preclude also migrating to BIP8-style height based activation?\r\n\r\nConcept ACK but would much rather have height based activation",
      "created_at" : "2021-03-06T14:56:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-791967222",
      "id" : 791967222,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5MTk2NzIyMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-06T14:56:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/791967222",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r588896840"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588896840"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: Can we add empty `default` statement which does nothing but avoids compiler warning and possible errors in future?",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-06T15:47:50Z",
      "diff_hunk" : "@@ -14,6 +14,18 @@\n /* Define a virtual block time, one block per 10 minutes after Nov 14 2014, 0:55:36am */\n static int32_t TestTime(int nHeight) { return 1415926536 + 600 * nHeight; }\n \n+static const std::string StateName(ThresholdState state)\n+{\n+    switch (state) {\n+    case ThresholdState::DEFINED:   return \"DEFINED\";\n+    case ThresholdState::STARTED:   return \"STARTED\";\n+    case ThresholdState::LOCKED_IN: return \"LOCKED_IN\";\n+    case ThresholdState::ACTIVE:    return \"ACTIVE\";\n+    case ThresholdState::FAILED:    return \"FAILED\";\n+    } // no default case, so the compiler can warn about missing cases",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r588896840",
      "id" : 588896840,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4ODg5Njg0MA==",
      "original_commit_id" : "3ba9283a47ac358168db9db7840ae559f443486c",
      "original_line" : 25,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 605765962,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588896840",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK.\r\n\r\nIt does seem like there is a preference for height based activation as opposed to time.\r\n\r\ni'd further request that -- to the extent this is getting BIP'd, that the activation date must not be within the range of the provided interval or we introduce some other sort of quantization / min interval parameter (e.g., every 3 block-months there is a new-rule activation window and we use the next one, or the activation blocks is something like  `current + max(2016*N, earliest - current)`.",
      "created_at" : "2021-03-06T16:35:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-791985294",
      "id" : 791985294,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5MTk4NTI5NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-06T16:35:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/791985294",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't know (though I can guess) why people are trying to refer to BIP 9 now instead of BIP 8, especially as height based activation seems the superior option.\r\n\r\nAs a reminder, there have been community IRC meetings (which many Core contributors attended and disclosed their views) where there was broad consensus on using revised BIP 8 e.g. http://gnusha.org/taproot-activation/2021-02-02.log\r\n\r\nRusty's [conclusion](https://bitcoinhackers.org/@rusty/105664386728806153) post that meeting was \"Unanimous support for BIP 8. RIP BIP 9.\"\r\n\r\nThe outline of the various proposals used BIP 8 rather than BIP 9: https://en.bitcoin.it/wiki/Taproot_activation_proposals\r\n\r\nAnd various media articles reporting on the discussion referred to BIP 8 rather than BIP 9.\r\n\r\nThough I don't expect it to scupper the momentum this promising proposal is generating if people want to call this BIP 9 (or do mental gymnastics by opening a new BIP) please be clear on why it doesn't fit within the template of BIP 8.\r\n\r\nOther than that, I am delighted with the progress this proposal is making and having a PR up in such quick time really is great, so many thanks for your work on this.\r\n\r\nedit: Thinking about this more I don't think it would be mental gymnastics to open a new BIP for \"Speedy trial\" especially if it doesn't fit cleanly into a more flexible BIP 8. New BIP or more flexible BIP 8. BIP 9 is dead and if \"Speedy trial\" could be used for other soft forks it shouldn't be included in the Taproot BIPs.",
      "created_at" : "2021-03-06T16:48:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-791987546",
      "id" : 791987546,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5MTk4NzU0Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-06T18:27:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/791987546",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/16323900?v=4",
         "events_url" : "https://api.github.com/users/michaelfolkson/events{/privacy}",
         "followers_url" : "https://api.github.com/users/michaelfolkson/followers",
         "following_url" : "https://api.github.com/users/michaelfolkson/following{/other_user}",
         "gists_url" : "https://api.github.com/users/michaelfolkson/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/michaelfolkson",
         "id" : 16323900,
         "login" : "michaelfolkson",
         "node_id" : "MDQ6VXNlcjE2MzIzOTAw",
         "organizations_url" : "https://api.github.com/users/michaelfolkson/orgs",
         "received_events_url" : "https://api.github.com/users/michaelfolkson/received_events",
         "repos_url" : "https://api.github.com/users/michaelfolkson/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/michaelfolkson/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/michaelfolkson/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/michaelfolkson"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I believe the best way to proceed would be to rebase a BIP8-height PR on top of this PR.  Once this PR is merged, we have the ability to produce an acceptable set of parameters for speedy trial.  If then the subsequent BIP8-height PR is merged afterwards then we get, what I believe to be, a superior set of activation parameters, but if the BIP8-height subsequent PR fails for whatever reason, that is okay.\r\n\r\nI'm anticipating test cases added to this PR that would in turn be valuable for the BIP8-height PR, and the BIP8-height speedy trial will need an analogous `activation_height` field as well.",
      "created_at" : "2021-03-06T16:57:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-791989090",
      "id" : 791989090,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5MTk4OTA5MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-06T16:57:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/791989090",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/21371712?v=4",
         "events_url" : "https://api.github.com/users/roconnor-blockstream/events{/privacy}",
         "followers_url" : "https://api.github.com/users/roconnor-blockstream/followers",
         "following_url" : "https://api.github.com/users/roconnor-blockstream/following{/other_user}",
         "gists_url" : "https://api.github.com/users/roconnor-blockstream/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/roconnor-blockstream",
         "id" : 21371712,
         "login" : "roconnor-blockstream",
         "node_id" : "MDQ6VXNlcjIxMzcxNzEy",
         "organizations_url" : "https://api.github.com/users/roconnor-blockstream/orgs",
         "received_events_url" : "https://api.github.com/users/roconnor-blockstream/received_events",
         "repos_url" : "https://api.github.com/users/roconnor-blockstream/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/roconnor-blockstream/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/roconnor-blockstream/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/roconnor-blockstream"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r588906179"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588906179"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That's exactly what the *lack* of default case here does.\n\nIf a case is missed, the compiler will warn.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-06T17:14:09Z",
      "diff_hunk" : "@@ -14,6 +14,18 @@\n /* Define a virtual block time, one block per 10 minutes after Nov 14 2014, 0:55:36am */\n static int32_t TestTime(int nHeight) { return 1415926536 + 600 * nHeight; }\n \n+static const std::string StateName(ThresholdState state)\n+{\n+    switch (state) {\n+    case ThresholdState::DEFINED:   return \"DEFINED\";\n+    case ThresholdState::STARTED:   return \"STARTED\";\n+    case ThresholdState::LOCKED_IN: return \"LOCKED_IN\";\n+    case ThresholdState::ACTIVE:    return \"ACTIVE\";\n+    case ThresholdState::FAILED:    return \"FAILED\";\n+    } // no default case, so the compiler can warn about missing cases",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r588906179",
      "id" : 588906179,
      "in_reply_to_id" : 588896840,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4ODkwNjE3OQ==",
      "original_commit_id" : "3ba9283a47ac358168db9db7840ae559f443486c",
      "original_line" : 25,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 605772138,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588906179",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #21401 (Refactor versionbits deployments to avoid potential uninitialized variables by achow101)\n* #19573 (Replace unused BIP 9 logic with draft BIP 8 by luke-jr)\n* #17783 (util: Fix -norpcwhitelist, -norpcallowip, and similar corner case behavior by ryanofsky)\n* #17581 (refactor: Remove settings merge reverse precedence code by ryanofsky)\n* #17580 (refactor: Add ALLOW_LIST flags and enforce usage in CheckArgFlags by ryanofsky)\n* #17493 (util: Forbid ambiguous multiple assignments in config file by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-03-06T18:35:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-792012294",
      "id" : 792012294,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5MjAxMjI5NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-13T15:03:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/792012294",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@roconnor-blockstream that sounds like one reasonable plan of attack -- merging this now is a concrete step, patching to use height can occur independently. I do fear there would not be consensus on a non-height based activation proposal, so it may be important to not rest on laurels for accepting those changes.\r\n\r\n\r\nMaking the case for BIP8 merge first then these changes, the BIP8 code is much more reviewed presently (with no code nacks, just conceptual ones?) and it may be a better utilization of developer time to rebase this onto BIP8.\r\n\r\nI think it would be best to hear from @luke-jr and @ajtowns on their preference as they seem to be primary contributors on the implementation/review of both.",
      "created_at" : "2021-03-06T19:36:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-792036920",
      "id" : 792036920,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5MjAzNjkyMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-06T19:36:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/792036920",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Once this PR is merged, we have the ability to produce an acceptable set of parameters for speedy trial. If then the subsequent BIP8-height PR is merged afterwards\r\n\r\nThis seems dangerous as we could have people compile and start running after the activation params are merged, merging a following change to the params could cause people to be running different activation logic (one time based, one hieght based).",
      "created_at" : "2021-03-06T20:35:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-792049634",
      "id" : 792049634,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5MjA0OTYzNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-06T20:35:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/792049634",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r588928891"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588928891"
         }
      },
      "author_association" : "NONE",
      "body" : "This bothered be too. IMO better to use `default`. Enums are bounded. The default state can reasonably be either `ACTIVE` or `FAILED`. This can be future-proofed by using a `static_asset` on the enum, which documents the assumption and guarantees catching it at compile time. Warnings arenât nearly as safe. ",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-06T20:44:03Z",
      "diff_hunk" : "@@ -14,6 +14,18 @@\n /* Define a virtual block time, one block per 10 minutes after Nov 14 2014, 0:55:36am */\n static int32_t TestTime(int nHeight) { return 1415926536 + 600 * nHeight; }\n \n+static const std::string StateName(ThresholdState state)\n+{\n+    switch (state) {\n+    case ThresholdState::DEFINED:   return \"DEFINED\";\n+    case ThresholdState::STARTED:   return \"STARTED\";\n+    case ThresholdState::LOCKED_IN: return \"LOCKED_IN\";\n+    case ThresholdState::ACTIVE:    return \"ACTIVE\";\n+    case ThresholdState::FAILED:    return \"FAILED\";\n+    } // no default case, so the compiler can warn about missing cases",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r588928891",
      "id" : 588928891,
      "in_reply_to_id" : 588896840,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4ODkyODg5MQ==",
      "original_commit_id" : "3ba9283a47ac358168db9db7840ae559f443486c",
      "original_line" : 25,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 605786493,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588928891",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1369335?v=4",
         "events_url" : "https://api.github.com/users/evoskuil/events{/privacy}",
         "followers_url" : "https://api.github.com/users/evoskuil/followers",
         "following_url" : "https://api.github.com/users/evoskuil/following{/other_user}",
         "gists_url" : "https://api.github.com/users/evoskuil/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/evoskuil",
         "id" : 1369335,
         "login" : "evoskuil",
         "node_id" : "MDQ6VXNlcjEzNjkzMzU=",
         "organizations_url" : "https://api.github.com/users/evoskuil/orgs",
         "received_events_url" : "https://api.github.com/users/evoskuil/received_events",
         "repos_url" : "https://api.github.com/users/evoskuil/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/evoskuil/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/evoskuil/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/evoskuil"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@benthecarman.  Not to worry this PR doesn't have activation parameters in it.  I would expect merger of activation parameters to be delayed until after a BIP8-height PR is done consideration.\r\n\r\nThat being said, I've chatted a bit with @achow101 and it may be the case that a BIP8-min-activation-height PR ends up being easier to implement as a stand alone PR rather than on top of this one.  There are issues with merging, and backporting etc.  So I'm going to stop myself from further back-seat deving and let the pros figure out the best way to hammer out PRs.",
      "created_at" : "2021-03-06T20:48:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-792052121",
      "id" : 792052121,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5MjA1MjEyMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-06T20:48:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/792052121",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/21371712?v=4",
         "events_url" : "https://api.github.com/users/roconnor-blockstream/events{/privacy}",
         "followers_url" : "https://api.github.com/users/roconnor-blockstream/followers",
         "following_url" : "https://api.github.com/users/roconnor-blockstream/following{/other_user}",
         "gists_url" : "https://api.github.com/users/roconnor-blockstream/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/roconnor-blockstream",
         "id" : 21371712,
         "login" : "roconnor-blockstream",
         "node_id" : "MDQ6VXNlcjIxMzcxNzEy",
         "organizations_url" : "https://api.github.com/users/roconnor-blockstream/orgs",
         "received_events_url" : "https://api.github.com/users/roconnor-blockstream/received_events",
         "repos_url" : "https://api.github.com/users/roconnor-blockstream/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/roconnor-blockstream/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/roconnor-blockstream/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/roconnor-blockstream"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Making the case for BIP8 merge first then these changes, the BIP8 code is much more reviewed presently (with no code nacks, just conceptual ones?) and it may be a better utilization of developer time to rebase this onto BIP8.\r\n\r\nI don't think the BIP8 code is adequately reviewed yet -- we had an off-by-one bug that would have left lot=true and lot=false nodes out of consensus found this past week, that wasn't discovered by reviewers or the automated tests. (Currently it isn't a clean merge either)\r\n\r\nThe main benefits of bip8 are lockinontimeout=true related -- that it specifies the option at all, and that it's height based, so loss of hashpower (due to miners preferring a chain that is invalid according to lockinontimeout=true) doesn't reduce the number of retarget periods available for activation. So I don't think there's any real benefits to doing this via bip8 rather than bip9 as far as the \"Speedy trial\" itself goes; but if bip8/height based code is thoroughly reviewed and ready to merge prior to setting activation parameters, that seems fine too as far as I can see.",
      "created_at" : "2021-03-06T22:17:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-792072779",
      "id" : 792072779,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5MjA3Mjc3OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-06T22:17:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/792072779",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I don't think the BIP8 code is adequately reviewed yet -- we had an off-by-one bug that would have left lot=true and lot=false nodes out of consensus found this past week, that wasn't discovered by reviewers or the automated tests. \r\n\r\n@ajtowns: Are you referring to a bug Sjors [found](https://github.com/bitcoin/bitcoin/pull/21334) in the tests? That is hardly a consensus bug for LOT=true and LOT=false nodes on mainnet but you are right to say it wasn't yet ready to be merged. I have since recommended it be closed as some have expressed that they would not merge it with any LOT code (even if dead code).",
      "created_at" : "2021-03-06T22:34:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-792077708",
      "id" : 792077708,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5MjA3NzcwOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-06T22:34:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/792077708",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/16323900?v=4",
         "events_url" : "https://api.github.com/users/michaelfolkson/events{/privacy}",
         "followers_url" : "https://api.github.com/users/michaelfolkson/followers",
         "following_url" : "https://api.github.com/users/michaelfolkson/following{/other_user}",
         "gists_url" : "https://api.github.com/users/michaelfolkson/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/michaelfolkson",
         "id" : 16323900,
         "login" : "michaelfolkson",
         "node_id" : "MDQ6VXNlcjE2MzIzOTAw",
         "organizations_url" : "https://api.github.com/users/michaelfolkson/orgs",
         "received_events_url" : "https://api.github.com/users/michaelfolkson/received_events",
         "repos_url" : "https://api.github.com/users/michaelfolkson/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/michaelfolkson/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/michaelfolkson/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/michaelfolkson"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@michaelfolkson No, that one [wasn't a bug](https://github.com/bitcoin/bitcoin/pull/19573#discussion_r586323690). I'm referring to [this one](https://github.com/bitcoin/bitcoin/pull/19573#discussion_r584741118).",
      "created_at" : "2021-03-06T23:05:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-792104652",
      "id" : 792104652,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5MjEwNDY1Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-06T23:05:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/792104652",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK.  Thank you, @ajtowns!  I'm happy to see that the change really is minimal.\r\n\r\nDo I understand correctly from reading the code that activation will occur in the first block of the next retarget period after the `activation_time`?  E.g., if the minimum activation time just passed but the height is 1234, the first block where taproot's rules are enforced still won't be until height 2016?  That seems fine to me for the sake of code simplicity, but it does mean that, if it looks like `activation_time` is going to fall near a retarget block, we'll have to communicate that taproot could either happen tomorrow or two weeks from now.  Maybe to avoid that communication challenge, it'd be better to use a height?\r\n\r\n@michaelfolkson \r\n\r\n> I don't know (though I can guess) why people are trying to refer to BIP 9 now instead of BIP 8, especially as height based activation seems the superior option.\r\n\r\nAs mentioned in [my email](https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2021-March/018583.html), I thought basing the proposal on the existing BIP9 code in Bitcoin Core (as done in this PR) would be the smallest change and so fastest to get reviewed, merged, and released.  Since the goal of the Speedy Trial proposal is speed (with safety), that seems highly advantageous to me.\r\n\r\nI completely agree that using block heights for the `start` and `timeout` parameters has advantages for this proposal (giving miners a known number of signaling periods) and that, as also mentioned in my email, getting BIP8 included in the code now would have advantages if Speedy Trial fails and we decide to use BIP8 as originally imagined for a follow-up activation attempt.\r\n\r\nMy preference would be for whatever solution is most preferred by reviewers.",
      "created_at" : "2021-03-07T05:27:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-792220340",
      "id" : 792220340,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5MjIyMDM0MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-07T05:27:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/792220340",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/61096?v=4",
         "events_url" : "https://api.github.com/users/harding/events{/privacy}",
         "followers_url" : "https://api.github.com/users/harding/followers",
         "following_url" : "https://api.github.com/users/harding/following{/other_user}",
         "gists_url" : "https://api.github.com/users/harding/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/harding",
         "id" : 61096,
         "login" : "harding",
         "node_id" : "MDQ6VXNlcjYxMDk2",
         "organizations_url" : "https://api.github.com/users/harding/orgs",
         "received_events_url" : "https://api.github.com/users/harding/received_events",
         "repos_url" : "https://api.github.com/users/harding/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/harding/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/harding/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/harding"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r588997369"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588997369"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It's already safe as a missing default case will simply cause the `return \"\"` after the switch to execute. The only time the return value of this function is used is to print a message if a test case is already failing, so the consequences of having an empty string are trivial -- CI is already failing at that point. Additionally, we bump those missing-case warnings to errors (`-Werror=switch`) when configured with enable-werror and I think we have that enabled on most CI builds (all except for win64?).",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-07T09:00:47Z",
      "diff_hunk" : "@@ -14,6 +14,18 @@\n /* Define a virtual block time, one block per 10 minutes after Nov 14 2014, 0:55:36am */\n static int32_t TestTime(int nHeight) { return 1415926536 + 600 * nHeight; }\n \n+static const std::string StateName(ThresholdState state)\n+{\n+    switch (state) {\n+    case ThresholdState::DEFINED:   return \"DEFINED\";\n+    case ThresholdState::STARTED:   return \"STARTED\";\n+    case ThresholdState::LOCKED_IN: return \"LOCKED_IN\";\n+    case ThresholdState::ACTIVE:    return \"ACTIVE\";\n+    case ThresholdState::FAILED:    return \"FAILED\";\n+    } // no default case, so the compiler can warn about missing cases",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r588997369",
      "id" : 588997369,
      "in_reply_to_id" : 588896840,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4ODk5NzM2OQ==",
      "original_commit_id" : "3ba9283a47ac358168db9db7840ae559f443486c",
      "original_line" : 25,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 605823592,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/588997369",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r589001603"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/589001603"
         }
      },
      "author_association" : "NONE",
      "body" : "No worries, I agree itâs a nit. Just donât like to rely on comments and warnings.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-07T09:35:06Z",
      "diff_hunk" : "@@ -14,6 +14,18 @@\n /* Define a virtual block time, one block per 10 minutes after Nov 14 2014, 0:55:36am */\n static int32_t TestTime(int nHeight) { return 1415926536 + 600 * nHeight; }\n \n+static const std::string StateName(ThresholdState state)\n+{\n+    switch (state) {\n+    case ThresholdState::DEFINED:   return \"DEFINED\";\n+    case ThresholdState::STARTED:   return \"STARTED\";\n+    case ThresholdState::LOCKED_IN: return \"LOCKED_IN\";\n+    case ThresholdState::ACTIVE:    return \"ACTIVE\";\n+    case ThresholdState::FAILED:    return \"FAILED\";\n+    } // no default case, so the compiler can warn about missing cases",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r589001603",
      "id" : 589001603,
      "in_reply_to_id" : 588896840,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4OTAwMTYwMw==",
      "original_commit_id" : "3ba9283a47ac358168db9db7840ae559f443486c",
      "original_line" : 25,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 605826456,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/589001603",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1369335?v=4",
         "events_url" : "https://api.github.com/users/evoskuil/events{/privacy}",
         "followers_url" : "https://api.github.com/users/evoskuil/followers",
         "following_url" : "https://api.github.com/users/evoskuil/following{/other_user}",
         "gists_url" : "https://api.github.com/users/evoskuil/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/evoskuil",
         "id" : 1369335,
         "login" : "evoskuil",
         "node_id" : "MDQ6VXNlcjEzNjkzMzU=",
         "organizations_url" : "https://api.github.com/users/evoskuil/orgs",
         "received_events_url" : "https://api.github.com/users/evoskuil/received_events",
         "repos_url" : "https://api.github.com/users/evoskuil/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/evoskuil/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/evoskuil/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/evoskuil"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "concept ACK.",
      "created_at" : "2021-03-07T14:37:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-792289266",
      "id" : 792289266,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5MjI4OTI2Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-07T14:37:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/792289266",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/30683012?v=4",
         "events_url" : "https://api.github.com/users/MaxHillebrand/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MaxHillebrand/followers",
         "following_url" : "https://api.github.com/users/MaxHillebrand/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MaxHillebrand/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MaxHillebrand",
         "id" : 30683012,
         "login" : "MaxHillebrand",
         "node_id" : "MDQ6VXNlcjMwNjgzMDEy",
         "organizations_url" : "https://api.github.com/users/MaxHillebrand/orgs",
         "received_events_url" : "https://api.github.com/users/MaxHillebrand/received_events",
         "repos_url" : "https://api.github.com/users/MaxHillebrand/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MaxHillebrand/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MaxHillebrand/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MaxHillebrand"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r589056828"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/589056828"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Note that the first two commits of this PR have already been merged, in #21334.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-07T16:47:51Z",
      "diff_hunk" : "@@ -14,6 +14,18 @@\n /* Define a virtual block time, one block per 10 minutes after Nov 14 2014, 0:55:36am */\n static int32_t TestTime(int nHeight) { return 1415926536 + 600 * nHeight; }\n \n+static const std::string StateName(ThresholdState state)\n+{\n+    switch (state) {\n+    case ThresholdState::DEFINED:   return \"DEFINED\";\n+    case ThresholdState::STARTED:   return \"STARTED\";\n+    case ThresholdState::LOCKED_IN: return \"LOCKED_IN\";\n+    case ThresholdState::ACTIVE:    return \"ACTIVE\";\n+    case ThresholdState::FAILED:    return \"FAILED\";\n+    } // no default case, so the compiler can warn about missing cases",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r589056828",
      "id" : 589056828,
      "in_reply_to_id" : 588896840,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4OTA1NjgyOA==",
      "original_commit_id" : "3ba9283a47ac358168db9db7840ae559f443486c",
      "original_line" : 25,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 605864163,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/589056828",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r589057339"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/589057339"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe add a note here to never change this unless all soft forks are burried. Alternatively maybe we should have a separate variable for this speedy trial.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-07T16:51:20Z",
      "diff_hunk" : "@@ -80,7 +80,7 @@ class CMainParams : public CChainParams {\n         consensus.nPowTargetSpacing = 10 * 60;\n         consensus.fPowAllowMinDifficultyBlocks = false;\n         consensus.fPowNoRetargeting = false;\n-        consensus.nRuleChangeActivationThreshold = 1916; // 95% of 2016\n+        consensus.nRuleChangeActivationThreshold = 1815; // 90% of 2016",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r589057339",
      "id" : 589057339,
      "line" : 81,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4OTA1NzMzOQ==",
      "original_commit_id" : "d614299d6db82e15cdd6ae3c116b8b063ed4d0f4",
      "original_line" : 81,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/chainparams.cpp",
      "position" : 5,
      "pull_request_review_id" : 605864461,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/589057339",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK for speedy trial support. However I'm not convinced we should permanently drop the BIP9 threshold to 90%.\r\n\r\n@JeremyRubin wrote:\r\n\r\n> merging this now is a concrete step, patching to use height can occur independently\r\n\r\nI'm fine with a height based approach too; slightly more code changes, but it seems easier to communicate when things happen. I also agree with Jeremy's point. Nothing here is set in stone until we actually apply it to Taproot (or another soft fork).\r\n\r\nThere is one downside though, in addition to more review work: other implementations probably already have BIP 9 code ready to go. Although compared to implementing all of Taproot this is not a big deal (and without implementing Taproot they can't verify the new consensus rules anyway). \r\n\r\n> Making the case for BIP8 merge first then these changes, the BIP8 code is much more reviewed presently (with no code nacks, just conceptual ones?)\r\n\r\nFor me that's only an option if the `LOT=true` stuff is stripped from that PR.\r\n\r\nIt doesn't seem terribly complicated to cherry-pick 9762562cc6a2c771ad0ddfb055ea17b90085425c, bcec418304ea3dd524cb3591e4af1b77a04cc968 (though I suggest a fresh BIP for the speedy trial) and a few more.",
      "created_at" : "2021-03-07T17:19:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-792313943",
      "id" : 792313943,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5MjMxMzk0Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-07T17:39:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/792313943",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r589061372"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/589061372"
         }
      },
      "author_association" : "MEMBER",
      "body" : "We could add `reduced_threshold` which, if non-zero, overrides `nRuleChangeActivationThreshold`.\r\n",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-07T17:25:10Z",
      "diff_hunk" : "@@ -29,6 +29,8 @@ struct BIP9Deployment {\n     int64_t nStartTime;\n     /** Timeout/expiry MedianTime for the deployment attempt. */\n     int64_t nTimeout;\n+    /** If lock in occurs, delay activation until at least this time. */\n+    int64_t activation_time;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r589061372",
      "id" : 589061372,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4OTA2MTM3Mg==",
      "original_commit_id" : "d614299d6db82e15cdd6ae3c116b8b063ed4d0f4",
      "original_line" : 33,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/consensus/params.h",
      "position" : null,
      "pull_request_review_id" : 605867244,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/589061372",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> but it does mean that, if it looks like `activation_time` is going to fall near a retarget block, we'll have to communicate that taproot could either happen tomorrow or two weeks from now.\r\n\r\nI think it's worse than that -- if `activation_time` falls very near a retarget block, I think you could have the eleven last blocks of the retarget period have timestamps (relative to `activation_time`) like:  `-3000, -2400, -1800, -1200, -600, 0, 600, 1200, 1800, 2400, 3000` giving the last block a median time which satisfies `MedianTimePast() >= activation_time`, so the next block would switch to ACTIVE and people would likely start transacting with taproot, perhaps even racing to get a tx in the first block as some did with segwit, and setting nlocktime to ensure their transaction isn't mined early and the funds stolen.\r\n\r\nHowever in that case a 2 block reorg could change the last block's timestamp to `-400` (still greater than the mediantime of the prior block which is likely -600), which would change its median time from `0` to `-400`, which would then cause the new first block of the next period to still be in state LOCKED_IN. At that point replaying the taproot-using transactions people had sent prior to the reorg would allow funds to be stolen as taproot is not yet active after the reorg, and nlocktime would not have protected you.\r\n\r\n(EDIT: fixed mediantime rules misinterpretation -- blocks must have a timestamp greater than the previous block's mediantime; block's mediantime does include their own timestamp. And add the following...)\r\n\r\nI think the conclusion from this is just \"the height at which you transition from LOCKED_IN to ACTIVE must be fully determined as soon as you transition from STARTED to LOCKED_IN\". That way the entire LOCKED_IN period has to be reorged if you want to steal funds protected by both nlocktime and the new rules.",
      "created_at" : "2021-03-08T02:58:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-792425221",
      "id" : 792425221,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5MjQyNTIyMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-09T10:05:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/792425221",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Bumped to `min_activation_height` instead of `activation_time`; also helps github notice that #21334 already merged.",
      "created_at" : "2021-03-08T03:27:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-792435198",
      "id" : 792435198,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5MjQzNTE5OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-08T03:27:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/792435198",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Shameless plug for #19013 which adds backwards compatibility testing for v0.21; this should be useful when testing soft fork deployment.",
      "created_at" : "2021-03-08T09:38:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-792623013",
      "id" : 792623013,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5MjYyMzAxMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-08T09:38:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/792623013",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "based on the reasoning here: https://gist.github.com/michaelfolkson/92899f27f1ab30aa2ebee82314f8fe7f#gistcomment-3658078 I have very limited concerns around using start/stop times (could be wrong)\r\n\r\n@ajtowns that's a great point -- MTP just has ambiguity baked into it, and we should prefer heights for the activation point.\r\n",
      "created_at" : "2021-03-08T20:28:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-793053309",
      "id" : 793053309,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5MzA1MzMwOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-08T20:28:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/793053309",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r589726673"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/589726673"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think we can worry about genericity if we ever need to add 2 simultaneous vbit releases... which I've heard rumor not too many people think we'd be likely to ever do that (although I think it is fine)",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-08T20:29:51Z",
      "diff_hunk" : "@@ -29,6 +29,8 @@ struct BIP9Deployment {\n     int64_t nStartTime;\n     /** Timeout/expiry MedianTime for the deployment attempt. */\n     int64_t nTimeout;\n+    /** If lock in occurs, delay activation until at least this time. */\n+    int64_t activation_time;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r589726673",
      "id" : 589726673,
      "in_reply_to_id" : 589061372,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4OTcyNjY3Mw==",
      "original_commit_id" : "d614299d6db82e15cdd6ae3c116b8b063ed4d0f4",
      "original_line" : 33,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/consensus/params.h",
      "position" : null,
      "pull_request_review_id" : 606680467,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/589726673",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased on top of versionbits fuzzing harness changes in #21380 -- this captures a bunch of the \"it's not really bip9 anymore\" refactoring, without getting too hard to read, and should vastly improve test coverage.",
      "created_at" : "2021-03-09T09:56:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-793645727",
      "id" : 793645727,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5MzY0NTcyNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-09T09:56:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/793645727",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r590256395"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/590256395"
         }
      },
      "author_association" : "MEMBER",
      "body" : "IIUC with the latest change, `nRuleChangeActivationThreshold` is only used for the \"the might be an unknown rule change\" warning system. Each deployment now has its own threshold.\r\n",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-09T11:29:00Z",
      "diff_hunk" : "@@ -29,6 +29,8 @@ struct BIP9Deployment {\n     int64_t nStartTime;\n     /** Timeout/expiry MedianTime for the deployment attempt. */\n     int64_t nTimeout;\n+    /** If lock in occurs, delay activation until at least this time. */\n+    int64_t activation_time;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r590256395",
      "id" : 590256395,
      "in_reply_to_id" : 589061372,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MDI1NjM5NQ==",
      "original_commit_id" : "d614299d6db82e15cdd6ae3c116b8b063ed4d0f4",
      "original_line" : 33,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/consensus/params.h",
      "position" : null,
      "pull_request_review_id" : 607299505,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/590256395",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r590318601"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/590318601"
         }
      },
      "author_association" : "MEMBER",
      "body" : "See also https://github.com/bitcoin/bitcoin/pull/21392/commits/9e50401c8a593c569f586786d84554c027fd8e8d which in addition lowers the warning threshold even further.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-09T12:27:36Z",
      "diff_hunk" : "@@ -29,6 +29,8 @@ struct BIP9Deployment {\n     int64_t nStartTime;\n     /** Timeout/expiry MedianTime for the deployment attempt. */\n     int64_t nTimeout;\n+    /** If lock in occurs, delay activation until at least this time. */\n+    int64_t activation_time;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r590318601",
      "id" : 590318601,
      "in_reply_to_id" : 589061372,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MDMxODYwMQ==",
      "original_commit_id" : "d614299d6db82e15cdd6ae3c116b8b063ed4d0f4",
      "original_line" : 33,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/consensus/params.h",
      "position" : null,
      "pull_request_review_id" : 607347155,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/590318601",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think a fully height based approach is easier to reason about, so I'm going to review #21392 first.",
      "created_at" : "2021-03-09T12:32:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-793818708",
      "id" : 793818708,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5MzgxODcwOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-09T12:32:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/793818708",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "#21380 updated to just provide a fuzz test and not do the refactoring, so this now also avoids refactoring -- it adds support for `min_activation_height`, adds support for the unit and fuzz tests to validate behaviour, and drops the threshold from 95% to 90%.",
      "created_at" : "2021-03-16T14:59:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-800333719",
      "id" : 800333719,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwMDMzMzcxOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-16T14:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/800333719",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "concept ACK, I agree with @harding's line of reasoning:\r\n\r\n> As mentioned in my email, I thought basing the proposal on the existing BIP9 code in Bitcoin Core (as done in this PR) would be the smallest change and so fastest to get reviewed, merged, and released. Since the goal of the Speedy Trial proposal is speed (with safety), that seems highly advantageous to me.\r\n\r\nCombined with how minimal this change is- the bulk of this PR is tests, the changes in the source code are +26/-4 lines over 2 commits.\r\n\r\nI've taken a first pass and it all looks reasonable, but I plan to do a full review soon. These changes are simple but I'm currently trying to gain the appropriate codebase context.",
      "created_at" : "2021-03-16T21:14:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-800610436",
      "id" : 800610436,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwMDYxMDQzNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-16T21:14:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/800610436",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept NACK to MTP.",
      "created_at" : "2021-03-18T19:12:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-802217810",
      "id" : 802217810,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwMjIxNzgxMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-18T19:12:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/802217810",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't have a strong view but it appears that @achow101 in https://github.com/bitcoin/bitcoin/pull/21392 and just by reading the comments in this PR @luke-jr @benthecarman @JeremyRubin @Sjors @roconnor-blockstream @harding all have a preference for a fully height based approach over any use of MTP.\r\n\r\nIf that isn't the case please correct me. And if anyone else has a view on entirely block height versus some limited use of MTP can you post it on IRC (##taproot-activation)?\r\n\r\nThe fuzzing [PR](https://github.com/bitcoin/bitcoin/pull/21380) looks very cool. On that PR @MarcoFalke also expresses an [expectation](https://github.com/bitcoin/bitcoin/pull/21380#pullrequestreview-613159162) that activation will be based on block heights.\r\n\r\nedit: Some additional comments from today's [Core dev meeting](http://www.erisian.com.au/bitcoin-core-dev/log-2021-03-18.html)\r\n\r\n\"it comes down to mtp vs block height\" @achow101 \r\n\r\n\"the main difference between these two PRs are using block height vs MTP \" @amitiuttarwar\r\n\r\n\"with mtp, we run the risk of losing 2 signaling periods. with already few signaling periods, this has the possibility of failing to activate due to bad luck\" @achow101\r\n\r\n\"the property that achow101's PR improves is a fixed (number) of signals\" @JeremyRubin\r\n",
      "created_at" : "2021-03-18T22:04:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-802336038",
      "id" : 802336038,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwMjMzNjAzOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-18T22:32:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/802336038",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/16323900?v=4",
         "events_url" : "https://api.github.com/users/michaelfolkson/events{/privacy}",
         "followers_url" : "https://api.github.com/users/michaelfolkson/followers",
         "following_url" : "https://api.github.com/users/michaelfolkson/following{/other_user}",
         "gists_url" : "https://api.github.com/users/michaelfolkson/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/michaelfolkson",
         "id" : 16323900,
         "login" : "michaelfolkson",
         "node_id" : "MDQ6VXNlcjE2MzIzOTAw",
         "organizations_url" : "https://api.github.com/users/michaelfolkson/orgs",
         "received_events_url" : "https://api.github.com/users/michaelfolkson/received_events",
         "repos_url" : "https://api.github.com/users/michaelfolkson/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/michaelfolkson/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/michaelfolkson/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/michaelfolkson"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I have a preference for fully height based design, correct. But I think that given the code base as it stands today, and comparing the diffs across the PR, and the tight timeline desired from merge to release using MTP really is a decent option, especially since the bulk of the code is already more widely tested. Longer term it makes sense to fully develop and test height based -- whether we do that, I don't know.\r\n\r\n@MarcoFalke's comment is a slight misunderstanding I believe of how the fuzzer simulates time; I recall AJ saying (somewhere) that block times are steady interval in the fuzzing so that it doesn't matter (can't find that comment now tho). Is that correct?\r\n\r\nI also emphasized numerous times in the meeting that I think for the purposes of a 3 month ST, forecasting to be a mid-period start/stopheight means that drift is very unlikely to hurt us, so the notion that we're \"risking two periods\" is a bit moot to me.\r\n\r\nThe counterarguments can be made that we have bigger issues to solve for if we miss two periods as a result of a hashrate decrease (where did the hashrate go -- we probably wouldn't want to activate if we're missing a big chunk of hashrate contemporaneously anyways) and that on the flip side, a hashrate increase would yield in the block heights going by more quickly which means there is less real time to coordinate enabling signaling. There are pros and cons either way, I think that height is superior longer term, but in this case I don't think there is sufficient technical risk to disqualify this PR as an activation method in favor of start/stop height.\r\n\r\n@luke-jr I would appreciate if you could justify your concept NACK more explicitly as I do not understand your concern.\r\n\r\n\r\n@amitiuttarwar made a great point in the meeting\r\n> my two cents: I don't think either PR is close to being RFM, both need significantly more review. looks like #21392 is currently failing CI. If the goal is to quickly merge with safety, I think #21377 makes more sense (as I stated on the PR)\r\n\r\nRough consensus and running code -- it seems to me that this is closer to a mergeable state. If there's a strong reason to the contrary, or if people decide to invest the requisite energy to get #21392 reviewed and RTM before then ok.",
      "created_at" : "2021-03-18T23:53:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-802396191",
      "id" : 802396191,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwMjM5NjE5MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-18T23:54:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/802396191",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@JeremyRubin 's comment above pretty much matches my opinion -- heights seem better in the long term, and are much better if there's a risk of a UASF ending up with a minority hashrate and not being abandoned. But neither of those are concerns here; and making a small modification to bip9 seems a lot easier to get right on a tight deadline to me.",
      "created_at" : "2021-03-19T00:41:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-802418304",
      "id" : 802418304,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwMjQxODMwNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-19T00:41:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/802418304",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased for updates to fuzzer, removed redundant override of `MinActivationHeight` for `WarningBitsConditionChecker`.",
      "created_at" : "2021-03-19T07:40:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-802622490",
      "id" : 802622490,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwMjYyMjQ5MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-19T07:40:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/802622490",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "If we're in agreement (which we appear to be) that a fully height based approach over any use of MTP is superior (and an alternative PR has implemented it) going for the inferior option to meet a deadline doesn't seem optimal to me. We don't have much wiggle room with regards to timings if we want activation pre December but we have enough to ensure the superior option is implemented imo. Especially as fully height based isn't a huge change.",
      "created_at" : "2021-03-19T19:59:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-803084612",
      "id" : 803084612,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwMzA4NDYxMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-19T19:59:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/803084612",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/16323900?v=4",
         "events_url" : "https://api.github.com/users/michaelfolkson/events{/privacy}",
         "followers_url" : "https://api.github.com/users/michaelfolkson/followers",
         "following_url" : "https://api.github.com/users/michaelfolkson/following{/other_user}",
         "gists_url" : "https://api.github.com/users/michaelfolkson/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/michaelfolkson",
         "id" : 16323900,
         "login" : "michaelfolkson",
         "node_id" : "MDQ6VXNlcjE2MzIzOTAw",
         "organizations_url" : "https://api.github.com/users/michaelfolkson/orgs",
         "received_events_url" : "https://api.github.com/users/michaelfolkson/received_events",
         "repos_url" : "https://api.github.com/users/michaelfolkson/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/michaelfolkson/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/michaelfolkson/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/michaelfolkson"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Can you rebase on master to drop the fuzzer commit?",
      "created_at" : "2021-03-20T12:57:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-803314548",
      "id" : 803314548,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwMzMxNDU0OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-20T12:57:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/803314548",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r598109083"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598109083"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Would it make sense to always set `min_activation_height` to a retarget boundary (and assert that)?",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-20T13:00:14Z",
      "diff_hunk" : "@@ -29,6 +29,11 @@ struct BIP9Deployment {\n     int64_t nStartTime;\n     /** Timeout/expiry MedianTime for the deployment attempt. */\n     int64_t nTimeout;\n+    /** If lock in occurs, delay activation until at least this block\n+     *  height.  Note that activation will only occur on a retarget\n+     *  boundary.\n+     */\n+    int min_activation_height{0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r598109083",
      "id" : 598109083,
      "line" : 36,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODEwOTA4Mw==",
      "original_commit_id" : "5dcc8f70e4e50a3f70d3c1155c9b53c5cff60040",
      "original_line" : 36,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/consensus/params.h",
      "position" : 8,
      "pull_request_review_id" : 616910768,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598109083",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r598167203"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598167203"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "If it's not on a retarget boundary, it will be treated as if it were at the next higher retarget boundary; so would be misleading but not actually buggy. Added a sanity check to versionbits_tests.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-20T22:25:50Z",
      "diff_hunk" : "@@ -29,6 +29,11 @@ struct BIP9Deployment {\n     int64_t nStartTime;\n     /** Timeout/expiry MedianTime for the deployment attempt. */\n     int64_t nTimeout;\n+    /** If lock in occurs, delay activation until at least this block\n+     *  height.  Note that activation will only occur on a retarget\n+     *  boundary.\n+     */\n+    int min_activation_height{0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r598167203",
      "id" : 598167203,
      "in_reply_to_id" : 598109083,
      "line" : 36,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODE2NzIwMw==",
      "original_commit_id" : "5dcc8f70e4e50a3f70d3c1155c9b53c5cff60040",
      "original_line" : 36,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/consensus/params.h",
      "position" : 8,
      "pull_request_review_id" : 616948568,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598167203",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased now that fuzzer is merged; added fuzzing of min_activation_height even in always/never active cases; added sanity check of settings via unit test; added min_activation_height to getblockchaininfo output.",
      "created_at" : "2021-03-21T02:58:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-803503626",
      "id" : 803503626,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwMzUwMzYyNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-21T02:58:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/803503626",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r598589081"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598589081"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is there a reason that this isn't pure virtual (when the other simple getter functions are)?\r\n\r\n```suggestion\r\n    virtual int MinActivationHeight(const Consensus::Params& params) const =0;\r\n```",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-22T10:22:12Z",
      "diff_hunk" : "@@ -57,6 +57,7 @@ class AbstractThresholdConditionChecker {\n     virtual bool Condition(const CBlockIndex* pindex, const Consensus::Params& params) const =0;\n     virtual int64_t BeginTime(const Consensus::Params& params) const =0;\n     virtual int64_t EndTime(const Consensus::Params& params) const =0;\n+    virtual int MinActivationHeight(const Consensus::Params& params) const { return 0; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r598589081",
      "id" : 598589081,
      "line" : 60,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODU4OTA4MQ==",
      "original_commit_id" : "85485fb1abb4fc241548fa65c26f7a6f6f6e2423",
      "original_line" : 60,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/versionbits.h",
      "position" : 13,
      "pull_request_review_id" : 617356651,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598589081",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r598896420"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598896420"
         }
      },
      "author_association" : "MEMBER",
      "body" : "With this bip9-amended model, there is no such thing as a \"max_activation_height\" ? Either we reach  LOCKED_IN state during the starttime/timeout range and delay activation until a _fixed point_ or we fail back to FAILED ? Fixed point can be time-based or height-based but in anycase this is not an _activation window_ with lower/upper bounds. \r\n\r\nTo clear this potential ambiguity, I think this variable should just be called `activation_height` and the delayed semantic be documented around ThresholdState::ACTIVE as its state transition condition isn't true anymore.\r\n\r\nFurther, consensus risks around this variable setting should be documented.\r\n\r\nLet's say you have client version=X reach locked_in at block height T, and activation height is scheduled for block height T+N. If a client version=Y is deployed with same activation logic but activation height M, with M < N, it will start to enforce taproot rules at height M.\r\n\r\nDo you have a risk of chain split between X and Y as this latter client version will consider invalid-taproot block between M and N as valid ?",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-22T16:47:15Z",
      "diff_hunk" : "@@ -29,6 +29,11 @@ struct BIP9Deployment {\n     int64_t nStartTime;\n     /** Timeout/expiry MedianTime for the deployment attempt. */\n     int64_t nTimeout;\n+    /** If lock in occurs, delay activation until at least this block\n+     *  height.  Note that activation will only occur on a retarget\n+     *  boundary.\n+     */\n+    int min_activation_height{0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r598896420",
      "id" : 598896420,
      "line" : 36,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODg5NjQyMA==",
      "original_commit_id" : "85485fb1abb4fc241548fa65c26f7a6f6f6e2423",
      "original_line" : 36,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/consensus/params.h",
      "position" : 8,
      "pull_request_review_id" : 617754202,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598896420",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r598900096"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598900096"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Note, think to update `getblockchaininfo` documentation around \"height\" in consequence.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-22T16:51:26Z",
      "diff_hunk" : "@@ -1258,6 +1258,9 @@ static void BIP9SoftForkDescPushBack(UniValue& softforks, const std::string &nam\n         statsUV.pushKV(\"possible\", statsStruct.possible);\n         bip9.pushKV(\"statistics\", statsUV);\n     }\n+    if (consensusParams.vDeployments[id].min_activation_height != 0) {\n+        bip9.pushKV(\"min_activation_height\", consensusParams.vDeployments[id].min_activation_height);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r598900096",
      "id" : 598900096,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODkwMDA5Ng==",
      "original_commit_id" : "85485fb1abb4fc241548fa65c26f7a6f6f6e2423",
      "original_line" : 1260,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 617754202,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598900096",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r599202432"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/599202432"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "None of the others have reasonable defaults, but min activation height does. Also, having min activation height default to zero means the condition checker maintains the same behaviour if left as default, which then allows the tests to be patched independently to test the new behaviours, and also means there's no change needed to the warning checker in validation.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-23T02:25:11Z",
      "diff_hunk" : "@@ -57,6 +57,7 @@ class AbstractThresholdConditionChecker {\n     virtual bool Condition(const CBlockIndex* pindex, const Consensus::Params& params) const =0;\n     virtual int64_t BeginTime(const Consensus::Params& params) const =0;\n     virtual int64_t EndTime(const Consensus::Params& params) const =0;\n+    virtual int MinActivationHeight(const Consensus::Params& params) const { return 0; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r599202432",
      "id" : 599202432,
      "in_reply_to_id" : 598589081,
      "line" : 60,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5OTIwMjQzMg==",
      "original_commit_id" : "85485fb1abb4fc241548fa65c26f7a6f6f6e2423",
      "original_line" : 60,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/versionbits.h",
      "position" : 13,
      "pull_request_review_id" : 618153470,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/599202432",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Ideally, height-based locked_in parameters would be better, as consensus rules around MTP are quite loose. AFAIU, it doesn't prevent a coalition of miners to scale down their mined blocks `nTime` to MTP + 1, thus preventing to reach a bip9 starttime at the expected real-world time\r\n\r\nSince it uses median time past, you'd need to be doing that for 6 out of every 11 blocks, which would require >50% of hashpower, and you'd have to take care to not manipulate the nTime of the first and last block of each retarget period so as not to make difficulty skyrocket; but you'd only need 10% of hashpower to block signalling.\r\n\r\nLosing hashpower was the concern for MTP with bip148, and it could be a theoretical concern here too -- if you lost 75% of hashpower, then instead of 14 weeks between timeout and starttime resulting in 6 or 7 retarget periods, it could result in just 1 or 2 retarget periods. But provided no new rules are added to cause blocks to be considered invalid (such as the required signalling rule in bip148), there's no reason to expect a drastic loss of hashpower.\r\n\r\nBut as you point out, in any event, we'd learn something new, and could try again afterwards taking that new knowledge into account.",
      "created_at" : "2021-03-23T02:40:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-804539447",
      "id" : 804539447,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwNDUzOTQ0Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-23T02:40:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/804539447",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r599222357"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/599222357"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It's a **minimum** activation height, because activation could be later than that if min_activation_height is reached prior to  timeout MTP being reached. With a fast enough increase in hashrate, you could probably reach any reasonable min_activation_height prior to timeout MTP being reached; and of course min_activation_height could be deliberately set in prior to or in the middle of the signalling period.\r\n\r\nminimum activation height is a fixed value, not a delta; so for your example, if client version X specifies min_activation_height H1 and version Y specifies min_activation_height H2 with H2<H1 then you'd expect Y to be enforcing different rules between H2..H1, because that's what you've told it to do. The only time they'd agree on the rules is if lockin occurs at a height >= H1-2016.\r\n\r\nAny change to deployment parameters can cause a change to what a client considers to be a valid block, and cause a consensus split; this isn't any different to changing the bit, starttime, timeout, period or threshold...",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-23T02:50:45Z",
      "diff_hunk" : "@@ -29,6 +29,11 @@ struct BIP9Deployment {\n     int64_t nStartTime;\n     /** Timeout/expiry MedianTime for the deployment attempt. */\n     int64_t nTimeout;\n+    /** If lock in occurs, delay activation until at least this block\n+     *  height.  Note that activation will only occur on a retarget\n+     *  boundary.\n+     */\n+    int min_activation_height{0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r599222357",
      "id" : 599222357,
      "in_reply_to_id" : 598896420,
      "line" : 36,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5OTIyMjM1Nw==",
      "original_commit_id" : "85485fb1abb4fc241548fa65c26f7a6f6f6e2423",
      "original_line" : 36,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/consensus/params.h",
      "position" : 8,
      "pull_request_review_id" : 618162744,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/599222357",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r600070455"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600070455"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"tests: test versionbits delayed activation\"\r\n\r\nAdd a comment: \"round up to the next strictly larger multiple of 1000\"?",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-24T00:49:42Z",
      "diff_hunk" : "@@ -77,14 +85,16 @@ class VersionBitsTester\n     int num;\n \n public:\n-    VersionBitsTester() : num(0) {}\n+    VersionBitsTester() : num(1000) {}\n \n     VersionBitsTester& Reset() {\n+        num = num - (num % 1000) + 1000;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r600070455",
      "id" : 600070455,
      "line" : 91,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMDA3MDQ1NQ==",
      "original_commit_id" : "aed054ff35fde8183c07cfcafec3403a72c36d29",
      "original_line" : 91,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 41,
      "pull_request_review_id" : 619211686,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600070455",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r600075060"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600075060"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"tests: test versionbits delayed activation\"\r\n\r\nNit: WEirD CapiTAlIZatIoN",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-24T00:57:31Z",
      "diff_hunk" : "@@ -226,6 +260,13 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n         // Make sure that no deployment tries to set an invalid bit.\n         BOOST_CHECK_EQUAL(bitmask & ~(uint32_t)VERSIONBITS_TOP_MASK, bitmask);\n \n+        // Check min_activation_height is on a retarget boundary\n+        BOOST_CHECK_EQUAL(mainnetParams.vDeployments[i].min_activation_height % mainnetParams.nMinerConfirmationWindow, 0);\n+        // Check min_activation_height is 0 for ALWayS_ACTIVE and never active deployments",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r600075060",
      "id" : 600075060,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMDA3NTA2MA==",
      "original_commit_id" : "aed054ff35fde8183c07cfcafec3403a72c36d29",
      "original_line" : 265,
      "original_position" : 139,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 619211686,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600075060",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r600211411"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600211411"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Added docs for `min_activation_height` field; the docs for `height` don't need updating?",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-24T06:45:17Z",
      "diff_hunk" : "@@ -1258,6 +1258,9 @@ static void BIP9SoftForkDescPushBack(UniValue& softforks, const std::string &nam\n         statsUV.pushKV(\"possible\", statsStruct.possible);\n         bip9.pushKV(\"statistics\", statsUV);\n     }\n+    if (consensusParams.vDeployments[id].min_activation_height != 0) {\n+        bip9.pushKV(\"min_activation_height\", consensusParams.vDeployments[id].min_activation_height);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r600211411",
      "id" : 600211411,
      "in_reply_to_id" : 598900096,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMDIxMTQxMQ==",
      "original_commit_id" : "85485fb1abb4fc241548fa65c26f7a6f6f6e2423",
      "original_line" : 1260,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 619371524,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600211411",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r600211628"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600211628"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Added a comment, though not that",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-24T06:45:41Z",
      "diff_hunk" : "@@ -77,14 +85,16 @@ class VersionBitsTester\n     int num;\n \n public:\n-    VersionBitsTester() : num(0) {}\n+    VersionBitsTester() : num(1000) {}\n \n     VersionBitsTester& Reset() {\n+        num = num - (num % 1000) + 1000;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r600211628",
      "id" : 600211628,
      "in_reply_to_id" : 600070455,
      "line" : 91,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMDIxMTYyOA==",
      "original_commit_id" : "aed054ff35fde8183c07cfcafec3403a72c36d29",
      "original_line" : 91,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 41,
      "pull_request_review_id" : 619371737,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600211628",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r600211807"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600211807"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Should've bought the dip while you could, now it's all uppercase.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-24T06:46:09Z",
      "diff_hunk" : "@@ -226,6 +260,13 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n         // Make sure that no deployment tries to set an invalid bit.\n         BOOST_CHECK_EQUAL(bitmask & ~(uint32_t)VERSIONBITS_TOP_MASK, bitmask);\n \n+        // Check min_activation_height is on a retarget boundary\n+        BOOST_CHECK_EQUAL(mainnetParams.vDeployments[i].min_activation_height % mainnetParams.nMinerConfirmationWindow, 0);\n+        // Check min_activation_height is 0 for ALWayS_ACTIVE and never active deployments",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r600211807",
      "id" : 600211807,
      "in_reply_to_id" : 600075060,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMDIxMTgwNw==",
      "original_commit_id" : "aed054ff35fde8183c07cfcafec3403a72c36d29",
      "original_line" : 265,
      "original_position" : 139,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 619371969,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600211807",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased on top of #21489 merge.",
      "created_at" : "2021-03-24T06:46:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-805547342",
      "id" : 805547342,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwNTU0NzM0Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-24T06:46:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/805547342",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r600425852"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600425852"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can be fixed (in a follow-up refactor) with commit 2be730c31de5e1496d893d2fe121af70879ceadf + commit 50eb7f0b28ff1afb816c49870344f0a210b6be6e",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-24T12:20:36Z",
      "diff_hunk" : "@@ -80,7 +80,7 @@ class CMainParams : public CChainParams {\n         consensus.nPowTargetSpacing = 10 * 60;\n         consensus.fPowAllowMinDifficultyBlocks = false;\n         consensus.fPowNoRetargeting = false;\n-        consensus.nRuleChangeActivationThreshold = 1916; // 95% of 2016\n+        consensus.nRuleChangeActivationThreshold = 1815; // 90% of 2016",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r600425852",
      "id" : 600425852,
      "in_reply_to_id" : 589057339,
      "line" : 81,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMDQyNTg1Mg==",
      "original_commit_id" : "d614299d6db82e15cdd6ae3c116b8b063ed4d0f4",
      "original_line" : 81,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/chainparams.cpp",
      "position" : 5,
      "pull_request_review_id" : 619649659,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T08:33:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600425852",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r600685950"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600685950"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> It's a minimum activation height, because activation could be later than that if min_activation_height is reached prior to timeout MTP being reached. With a fast enough increase in hashrate, you could probably reach any reasonable min_activation_height prior to timeout MTP being reached; and of course min_activation_height could be deliberately set in prior to or in the middle of the signalling period.\r\n\r\nRight, that said if you want to achieve ST goal's of backend delay, you should have a retarget period buffer between expected height of timeout and min_activation_height to swallow even a doubling of hashrate, or any other kind of scaling factor we deem *physically* unlikely to happen. Though this conversation belongs more to activation parameters selection. I agree, this logic could serve beyond ST-style of deployment.\r\n\r\n> minimum activation height is a fixed value, not a delta; so for your example, if client version X specifies min_activation_height H1 and version Y specifies min_activation_height H2 with H2<H1 then you'd expect Y to be enforcing different rules between H2..H1, because that's what you've told it to do. The only time they'd agree on the rules is if lockin occurs at a height >= H1-2016.\r\n\r\nI'm just concerned about successfully LOCKED_IN then having uasf folks bothered by the backend delay and willingly to fasten activation by tweaking `min_activation_height`. I'm not sure the immutable semantic of `min_activation_height` is that much understood. Though there is a thousand ways to fork yourself of the network if you have the intent, we can't prevent all of them to happen...\r\n\r\n>  Any change to deployment parameters can cause a change to what a client considers to be a valid block, and cause a consensus split; this isn't any different to changing the bit, starttime, timeout, period or     threshold...\r\n\r\nYes, but I think \"Once activation parameters have been released for a consensus change, they MUST NOT be changed to avoid risks of consensus split until reaching a final deployment state\" on top `BIP9Deployment` is good practice. Future code reviewers might not be as much familiar than us w.r.t to those consensus subtleties.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-24T17:06:08Z",
      "diff_hunk" : "@@ -29,6 +29,11 @@ struct BIP9Deployment {\n     int64_t nStartTime;\n     /** Timeout/expiry MedianTime for the deployment attempt. */\n     int64_t nTimeout;\n+    /** If lock in occurs, delay activation until at least this block\n+     *  height.  Note that activation will only occur on a retarget\n+     *  boundary.\n+     */\n+    int min_activation_height{0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r600685950",
      "id" : 600685950,
      "in_reply_to_id" : 598896420,
      "line" : 36,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMDY4NTk1MA==",
      "original_commit_id" : "85485fb1abb4fc241548fa65c26f7a6f6f6e2423",
      "original_line" : 36,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/consensus/params.h",
      "position" : 8,
      "pull_request_review_id" : 619994681,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600685950",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Approach NACK. \r\n\r\nWe need to focus review effort on a single Speedy Trial PR at this stage. Although AJ has done as much as anyone to advance Taproot activation with all sorts of contributions (conceptual, code, tests, fuzzing) I am at a loss as to why to choose a PR with a mix of block height and MTP over a [PR](https://github.com/bitcoin/bitcoin/pull/21392) with a consistent use of block height.\r\n\r\nI have attempted to summarize the discussion on block height versus mix of block height and MTP [here](https://bitcoin.stackexchange.com/questions/103854/should-block-height-or-mtp-or-a-mixture-of-both-be-used-in-a-soft-fork-activatio). To me a consistent use of block height is a no brainer. If that needs a little more review and testing so be it. (I'm not convinced it does btw, I find it much easier to reason and think about edge cases with entirely block height than a mixture. It is a slightly larger code diff, that is true.)\r\n\r\nI also have no idea why block height versus mix of block height and MTP has any impact whatsoever on UASF plans. It doesn't seem to impact the difficulty of implementing a competing compatible UASF and any possible \"marketing\" gain for a UASF seems illusory.\r\n\r\nDisclosure: I have been happy to work on a UASF project in the recent past when there seemed little chance of progress with Taproot activation in Core. I would also consider doing so again in future depending on the circumstances.\r\n\r\nI hope we can choose a Speedy Trial PR as soon as possible to focus all review effort on it. If this PR is chosen over Andrew's PR I will disagree with that decision but I will live with it. I think it will be the inferior choice (assuming a new rationale isn't explained to me) but I don't think it will cause any material problems with activation.\r\n",
      "created_at" : "2021-03-25T20:25:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-807422992",
      "id" : 807422992,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwNzQyMjk5Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-25T20:25:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/807422992",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/16323900?v=4",
         "events_url" : "https://api.github.com/users/michaelfolkson/events{/privacy}",
         "followers_url" : "https://api.github.com/users/michaelfolkson/followers",
         "following_url" : "https://api.github.com/users/michaelfolkson/following{/other_user}",
         "gists_url" : "https://api.github.com/users/michaelfolkson/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/michaelfolkson",
         "id" : 16323900,
         "login" : "michaelfolkson",
         "node_id" : "MDQ6VXNlcjE2MzIzOTAw",
         "organizations_url" : "https://api.github.com/users/michaelfolkson/orgs",
         "received_events_url" : "https://api.github.com/users/michaelfolkson/received_events",
         "repos_url" : "https://api.github.com/users/michaelfolkson/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/michaelfolkson/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/michaelfolkson/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/michaelfolkson"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r601818493"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/601818493"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ACK using 1815 as the constant.\r\n\r\n1814 has lower error from 90% than 1815, but previously we used 1916 which has greater error from 95% than 1915 but is the smallest exceeds threshold number, so we continue the same precedent (not that it matters much). ",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-25T20:30:38Z",
      "diff_hunk" : "@@ -78,16 +78,18 @@ class CMainParams : public CChainParams {\n         consensus.nPowTargetSpacing = 10 * 60;\n         consensus.fPowAllowMinDifficultyBlocks = false;\n         consensus.fPowNoRetargeting = false;\n-        consensus.nRuleChangeActivationThreshold = 1916; // 95% of 2016\n+        consensus.nRuleChangeActivationThreshold = 1815; // 90% of 2016",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r601818493",
      "id" : 601818493,
      "line" : 81,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMTgxODQ5Mw==",
      "original_commit_id" : "4c7d858167a7f8cd4cb6b09787f07929d2abc3a1",
      "original_line" : 81,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/chainparams.cpp",
      "position" : 5,
      "pull_request_review_id" : 621552055,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/601818493",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Code Review ACK  4c7d858",
      "created_at" : "2021-03-25T21:09:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-807493104",
      "id" : 807493104,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwNzQ5MzEwNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-25T21:09:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/807493104",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "What am I doing wrong that I can't get minimum_activation_height to have any effect on regtest?\r\n\r\n<details>\r\n\r\n```diff\r\ndiff --git a/src/chainparams.cpp b/src/chainparams.cpp\r\nindex 40c58f0e67..73be5d3d6d 100644\r\n--- a/src/chainparams.cpp\r\n+++ b/src/chainparams.cpp\r\n@@ -412,7 +412,7 @@ public:\r\n         consensus.vDeployments[Consensus::DEPLOYMENT_TAPROOT].bit = 2;\r\n         consensus.vDeployments[Consensus::DEPLOYMENT_TAPROOT].nStartTime = Consensus::BIP9Deployment::ALWAYS_ACTIVE;\r\n         consensus.vDeployments[Consensus::DEPLOYMENT_TAPROOT].nTimeout = Consensus::BIP9Deployment::NO_TIMEOUT;\r\n-        consensus.vDeployments[Consensus::DEPLOYMENT_TAPROOT].min_activation_height = 0; // No activation delay\r\n+        consensus.vDeployments[Consensus::DEPLOYMENT_TAPROOT].min_activation_height = 576; // No activation delay\r\n \r\n         consensus.nMinimumChainWork = uint256{};\r\n         consensus.defaultAssumeValid = uint256{};\r\n```\r\n\r\n    $ make\r\n    [...]\r\n\r\n    $ src/bitcoind -regtest -daemon -vbparams=taproot:1:1932252724\r\n    [...]\r\n\r\n    $ src/bitcoin-cli -regtest getblockchaininfo | jq .blocks,.softforks.taproot\r\n    0\r\n    {\r\n      \"type\": \"bip9\",\r\n      \"bip9\": {\r\n        \"status\": \"defined\",\r\n        \"start_time\": 1,\r\n        \"timeout\": 1932252724,\r\n        \"since\": 0\r\n      },\r\n      \"active\": false\r\n    }\r\n\r\nI'm expecting to see a `min_activation_height` field in the `getblockchaininfo` results, as my reading of the code says it should be there for cases where the min activation is greater than zero.\r\n\r\n</details>\r\n\r\nIt'd be nice if `-vbparams` here took a fourth argument for the minimum activation height, similar to in #21392 , so recompiling (and whatever mistake I'm making there) wouldn't be necessary.",
      "created_at" : "2021-03-26T01:29:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-807862730",
      "id" : 807862730,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwNzg2MjczMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-26T01:29:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/807862730",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/61096?v=4",
         "events_url" : "https://api.github.com/users/harding/events{/privacy}",
         "followers_url" : "https://api.github.com/users/harding/followers",
         "following_url" : "https://api.github.com/users/harding/following{/other_user}",
         "gists_url" : "https://api.github.com/users/harding/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/harding",
         "id" : 61096,
         "login" : "harding",
         "node_id" : "MDQ6VXNlcjYxMDk2",
         "organizations_url" : "https://api.github.com/users/harding/orgs",
         "received_events_url" : "https://api.github.com/users/harding/received_events",
         "repos_url" : "https://api.github.com/users/harding/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/harding/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/harding/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/harding"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@harding The `-vbparams` setting happens in `UpdateVersionBitsParameters` which sets it back to 0 -- https://github.com/bitcoin/bitcoin/pull/21377/files#diff-ff53e63501a5e89fd650b378c9708274df8ad5d38fcffa6c64be417c4d438b6dR483",
      "created_at" : "2021-03-26T02:50:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-807897019",
      "id" : 807897019,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwNzg5NzAxOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-26T02:50:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/807897019",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Changed from \"delayed activation\" to \"delayed lock in\" -- that is, transitions go from STARTED to DELAYED to LOCKED_IN to ACTIVE, with LOCKED_IN not being entered until MTP passes min_lock_in_time. This fixes [the problem noted earlier](https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-792425221) while retaining the ability to know 2016 blocks in advance when activation will occur.\r\n\r\nUsing MTP timestamps for activation retains compatible with deployments for testnet and signet, where block heights are unpredictable (for testnet) or inconsistent (different custom signets will not have common block heights).\r\n\r\nExtends the ComputeBlockVersion unit tests to test all deployments across all chains. Adds an optional parameter to `-vbparams` to allow testing, and uses that parameter in the unit tests.\r\n\r\nNote that this approach can also be used to make bip-148/bip-91 style mandatory signalling compatible with MTP-based activation; see https://github.com/ajtowns/bitcoin/commits/202103-bip9-uasf for a branch that adds a `LAST_CHANCE` signalling phased that will always be reached just prior to failure, so can be used for mandatory signalling to guarantee lock in.",
      "created_at" : "2021-03-28T04:45:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-808843817",
      "id" : 808843817,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwODg0MzgxNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-28T04:45:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/808843817",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Approach NACK\r\n\r\nAt this point, it seems like this PR has gotten more complicated due to MTP and reviewing this is going to be more complicated due to the edge cases around MTP. When this used a minimum activation height, I would have agreed that this would be easier and faster to review, but now that it has reverted to using a minimum (lock in) time, I am not comfortable with this approach anymore. While I agree that MTP is conceptually easier to work with, practically it has many edge cases and gotchas that I don't think we should continue forward with using MTP. Heights are strictly easier to understand. The only edge cases to consider are off by one errors and not miners screwing with timestamps.\r\n\r\n> Using MTP timestamps for activation retains compatible with deployments for testnet and signet, where block heights are unpredictable (for testnet)\r\n\r\nI agree that using MTP for testnet is better, but I don't think that is important enough to block the use of heights for mainnet. I also think that testnet3 should be abandoned at this point, but that's a discussion for another place and time.\r\n\r\n> or inconsistent (different custom signets will not have common block heights).\r\n\r\nI think that either approach is incompatible with custom signets. I don't think it makes sense that every signet would also have the same start time and timeout time, especially for signets that are created afterwards. It would make more sense to refactor the parameter setting and allow for the custom signets to set their own activation parameters, regardless of height or MTP.",
      "created_at" : "2021-03-28T14:02:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-808901334",
      "id" : 808901334,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwODkwMTMzNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-28T14:02:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/808901334",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> It would make more sense to refactor the parameter setting and allow for the custom signets to set their own activation parameters, regardless of height or MTP.\r\n\r\nwouldn't that mean that you can never bury a deployment again because there could be some signet where it hasn't activated yet? ",
      "created_at" : "2021-03-28T14:48:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-808907022",
      "id" : 808907022,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwODkwNzAyMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-28T14:48:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/808907022",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/425166?v=4",
         "events_url" : "https://api.github.com/users/flack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/flack/followers",
         "following_url" : "https://api.github.com/users/flack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/flack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/flack",
         "id" : 425166,
         "login" : "flack",
         "node_id" : "MDQ6VXNlcjQyNTE2Ng==",
         "organizations_url" : "https://api.github.com/users/flack/orgs",
         "received_events_url" : "https://api.github.com/users/flack/received_events",
         "repos_url" : "https://api.github.com/users/flack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/flack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/flack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/flack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ajtowns \r\n\r\n> Transitions go from STARTED to DELAYED to LOCKED_IN to ACTIVE, with LOCKED_IN not being entered until MTP passes min_lock_in_time. This fixes the problem noted earlier while retaining] the ability to know 2016 blocks in advance when activation will occur.\r\n\r\nI like that.  I think it does a better job of communicating to users what state the deployment is in and, by virtue of `min_lock_in_time` being a time, gives a more reliable and easier to understand estimate of when activation will happen (e.g. \"`min_lock_in_time` + 10 - 24 days with high confidence\" instead of using heights, where it could be as much as \"140 to 220 days\").\r\n\r\n> Adds an optional parameter to -vbparams to allow testing, and uses that parameter in the unit tests.\r\n\r\nThank you!\r\n\r\n@achow101 \r\n\r\n> it seems like this PR has gotten more complicated due to MTP\r\n\r\nHaving reviewed both (as of last week), I thought this was moderately simpler than yours.  I skimmed the rebase diff and don't think the last push increases complexity (indeed, I think it simplifies it from the earlier `minimum_activation_height` change.\r\n\r\n> MTP [...] practically has many edge cases and gotchas [and] I don't think we should continue forward with using MTP. Heights are strictly easier to understand.\r\n\r\nWhat edge cases does MTP have for a deployment such as this where there's no mandatory signaling or mandatory activation?  MTP abuse generally assumes miner adversity (usually at least enough miners to execute a selfish mining attack, e.g. ~30%) but a mere 15% of miners opposed to Speedy Trial should be able to prevent its activation by following the allowed protocol.\r\n\r\nHeights may be easier to reason about in some ways, but they don't directly provide the most important assurance we want in a Speedy Trial activation: that we will have a certain minimum amount of **time** to get many nodes upgraded to enforce taproot when it activates.  As far as I'm aware, miners screwing with time stamps---at a level less than that necessary to produce a time warp attack[1]---can only delay a deployment of this PR as written, and only at cost to the miners in the form of needing to do more PoW.  I think that's fine; we can be a little bit more patient.  But for a height-based activation, miners can accelerate the deployment either non-deliberately (e.g. because BTC price increases lead to increased mining) or deliberately (again at the cost of doing more PoW); I think that's an acceptable risk, but to my mind it's not as good as the assurance MTP can bring us.\r\n\r\nAgain, if there's an MTP edge case that applies to this PR that I'm not aware of, I'd certainly be interested in learning about it.  Overall, I feel this latest update improves this PR to where I slightly prefer it over height-based activation (although I'm still fine with either approach).\r\n\r\n[1] Time warp attacks break important properties of both MTP-based and height-based activation mechanisms; it also breaks important fundamental properties of Bitcoin.  Given that, I don't think we need to consider it here: I think miners know that trying a time warp attack on mainnet could easily lead to a PoW algorithm change.",
      "created_at" : "2021-03-28T17:51:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-808931894",
      "id" : 808931894,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwODkzMTg5NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-28T17:51:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/808931894",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/61096?v=4",
         "events_url" : "https://api.github.com/users/harding/events{/privacy}",
         "followers_url" : "https://api.github.com/users/harding/followers",
         "following_url" : "https://api.github.com/users/harding/following{/other_user}",
         "gists_url" : "https://api.github.com/users/harding/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/harding",
         "id" : 61096,
         "login" : "harding",
         "node_id" : "MDQ6VXNlcjYxMDk2",
         "organizations_url" : "https://api.github.com/users/harding/orgs",
         "received_events_url" : "https://api.github.com/users/harding/received_events",
         "repos_url" : "https://api.github.com/users/harding/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/harding/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/harding/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/harding"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> wouldn't that mean that you can never bury a deployment again because there could be some signet where it hasn't activated yet?\r\n\r\nNot necessarily. A deployment can be buried in one chain and not in another. With #19438, I think it would also be trivial to have a deployment buried in one chain and not in another.\r\n\r\n> What edge cases does MTP have for a deployment such as this where there's no mandatory signaling or mandatory activation? MTP abuse generally assumes miner adversity (usually at least enough miners to execute a selfish mining attack, e.g. ~30%) but a mere 15% of miners opposed to Speedy Trial should be able to prevent its activation by following the allowed protocol.\r\n\r\nSure, but my main concern is about analyzing the correctness of the code around these scenarios. I am sure that the code can handle those situations correctly, but when reviewing it, it is harder to analyze and conclude that all of the state transitions that are based around MTP are safe. It is easier to do this analysis for height based deployments.",
      "created_at" : "2021-03-28T21:27:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-808962043",
      "id" : 808962043,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwODk2MjA0Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-28T21:27:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/808962043",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@flack \r\n\r\n> wouldn't that mean that you can never bury a deployment again because there could be some signet where it hasn't activated yet?\r\n\r\nThe only plausible way I've come up with for burying deployments on signet is via MTP -- ie, declare that a soft-fork is unconditionally active on signet once the MTP passes some point, probably the MTP at which it activated on mainnet plus some delay; perhaps something like:\r\n\r\n```c++\r\nconstexpr uint32_t ACTIVATION_MTP_THRESHOLD = 500000000;\r\nbool DeploymentActiveAt(block, params, dep) {\r\n    int h = params.DeploymentHeight(dep);\r\n    return (h < ACTIVATION_MTP_THRESHOLD ? block.nHeight >= h : block.GetMedianTimePast() >= h);\r\n}\r\n```\r\n\r\nFor custom signets that have chosen to activate the soft fork already, that's fine, because it's a soft fork the old blocks will still be valid even if they use rules that won't be enforced on a `-reindex` or by a new node doing IBD, and because blocks are signed, there is no risk of a reorg stealing funds. For custom signets that have not already activated the soft fork, it's fine as long as either miners upgrade to the new software before the signet flag day activation, or as long as the soft fork is safe and miners are not doing something like `-acceptnonstdtxn` so they won't mine blocks that are invalid under the new rules.\r\n\r\n@achow101 \r\n\r\n> It would make more sense to refactor the parameter setting and allow for the custom signets to set their own activation parameters, regardless of height or MTP.\r\n\r\nI don't think that's feasible from a usability standpoint: to use a custom signet you would have to define all the consensus parameters for all post-taproot forks, and do so in a way that's exactly compatible with all the other users of that custom signet.\r\n\r\nUsing MTP-based signalling allows a signet to be upgraded to a new soft fork simply by the signet miners signalling, with no action required by users at all beyond running an updated binary, which I don't think is achievable otherwise. (At minimum you'd need to update your config to set a \"activate this deployment early\" flag for each deployment on each custom signet)\r\n\r\n> Not necessarily. A deployment can be buried in one chain and not in another. With #19438, I think it would also be trivial to have a deployment buried in one chain and not in another.\r\n\r\nThe latter part of that is not true -- #19438 differentiates buried and signalled deployments by data type, which is constant for all chains at compile time.\r\n\r\nBut the point of burying deployments is so that we don't need to keep dealing with conditional activation -- eg, we don't need to support the possibility that segwit is activated but p2sh is not. We don't want to force ourselves to maintain those code paths to support random custom signets.",
      "created_at" : "2021-03-29T01:49:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-809011351",
      "id" : 809011351,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwOTAxMTM1MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-29T01:49:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/809011351",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r603311737"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/603311737"
         }
      },
      "author_association" : "MEMBER",
      "body" : "can be `static`",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-29T13:50:58Z",
      "diff_hunk" : "@@ -242,81 +302,123 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n     }\n }\n \n-BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n+void check_computeblockversion(const Consensus::Params& params, Consensus::DeploymentPos dep)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r603311737",
      "id" : 603311737,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMzMxMTczNw==",
      "original_commit_id" : "f720a0b45ad98f76f77dd50bf2495772412adb06",
      "original_line" : 305,
      "original_position" : 194,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 623252155,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/603311737",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r603470760"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/603470760"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"tests: test ComputeBlockVersion for all deployments\"\r\n\r\nNit: comment outdated now",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-29T17:13:58Z",
      "diff_hunk" : "@@ -244,45 +244,72 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n \n void check_computeblockversion(const Consensus::Params& params, Consensus::DeploymentPos dep)\n {\n+    // This implicitly uses versionbitscache, so clear it every time\n+    versionbitscache.Clear();\n+\n     // Check that ComputeBlockVersion will set the appropriate bit correctly\n \n     // Use the TESTDUMMY deployment for testing purposes.\n     int64_t bit = params.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].bit;\n     int64_t nStartTime = params.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nStartTime;\n     int64_t nTimeout = params.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nTimeout;\n \n-    assert(nStartTime < nTimeout);\n+    // should not be any signalling for first block\n+    BOOST_CHECK_EQUAL(ComputeBlockVersion(nullptr, params), VERSIONBITS_TOP_BITS);\n+\n+    // always active deployments shouldn't need to be tested further\n+    if (nStartTime == Consensus::BIP9Deployment::ALWAYS_ACTIVE) return;\n+\n+    BOOST_REQUIRE(nStartTime < nTimeout);\n+    BOOST_REQUIRE(nStartTime >= 0);\n+    BOOST_REQUIRE(nTimeout <= std::numeric_limits<uint32_t>::max() || nTimeout == Consensus::BIP9Deployment::NO_TIMEOUT);\n+    BOOST_REQUIRE(0 <= bit && bit < 32);\n+    BOOST_REQUIRE(((1 << bit) & VERSIONBITS_TOP_MASK) == 0);\n \n     // In the first chain, test that the bit is set by CBV until it has failed.\n     // In the second chain, test the bit is set by CBV while STARTED and\n     // LOCKED-IN, and then no longer set while ACTIVE.\n     VersionBitsTester firstChain, secondChain;\n \n     // Start generating blocks before nStartTime",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r603470760",
      "id" : 603470760,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMzQ3MDc2MA==",
      "original_commit_id" : "72ef629f1aa8f8673bf8cc815547efd95ac77f67",
      "original_line" : 274,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 623464640,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/603470760",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r603475179"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/603475179"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is there a reason that these are `vDeployments[Consensus::DEPLOYMENT_TESTDUMMY]` and not `vDeployments[dep]`?",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-29T17:20:48Z",
      "diff_hunk" : "@@ -242,81 +302,123 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n     }\n }\n \n-BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n+void check_computeblockversion(const Consensus::Params& params, Consensus::DeploymentPos dep)\n {\n+    // This implicitly uses versionbitscache, so clear it every time\n+    versionbitscache.Clear();\n+\n     // Check that ComputeBlockVersion will set the appropriate bit correctly\n-    // on mainnet.\n-    const auto chainParams = CreateChainParams(*m_node.args, CBaseChainParams::MAIN);\n-    const Consensus::Params &mainnetParams = chainParams->GetConsensus();\n \n     // Use the TESTDUMMY deployment for testing purposes.\n-    int64_t bit = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].bit;\n-    int64_t nStartTime = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nStartTime;\n-    int64_t nTimeout = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nTimeout;\n+    int64_t bit = params.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].bit;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r603475179",
      "id" : 603475179,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMzQ3NTE3OQ==",
      "original_commit_id" : "f720a0b45ad98f76f77dd50bf2495772412adb06",
      "original_line" : 313,
      "original_position" : 208,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 623252155,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/603475179",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r603502659"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/603502659"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"versionbits: Add support for delayed lock in\"\r\n\r\nWhy do we know min_lock_in_time == 0?",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-29T18:03:21Z",
      "diff_hunk" : "@@ -2456,6 +2464,7 @@ static void UpdateTip(CTxMemPool& mempool, const CBlockIndex* pindexNew, const C\n             WarningBitsConditionChecker checker(bit);\n             ThresholdState state = checker.GetStateFor(pindex, chainParams.GetConsensus(), warningcache[bit]);\n             if (state == ThresholdState::ACTIVE || state == ThresholdState::LOCKED_IN) {\n+                // DELAYED unreachable since min_lock_in_time = 0",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r603502659",
      "id" : 603502659,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMzUwMjY1OQ==",
      "original_commit_id" : "c7c8bfaf9ed3b4c72e378b2717cdd337370f74f9",
      "original_line" : 2467,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 623464640,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/603502659",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r603504786"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/603504786"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"versionbits: Add support for delayed lock in\"\r\n\r\nVery nitty: use the exact same expression as above here?\r\n\r\n```\r\nstateNext = (pindexPrev->GetMedianTimePast() < min_lock_in_time ? ThresholdState::DELAYED : ThresholdState::LOCKED_IN);\r\n```\r\n\r\nYou could even use switch case fallthrough, but I don't think that contributes to readability...",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-29T18:06:37Z",
      "diff_hunk" : "@@ -73,6 +74,12 @@ ThresholdState AbstractThresholdConditionChecker::GetStateFor(const CBlockIndex*\n                     pindexCount = pindexCount->pprev;\n                 }\n                 if (count >= nThreshold) {\n+                    stateNext = (pindexPrev->GetMedianTimePast() < min_lock_in_time ? ThresholdState::DELAYED : ThresholdState::LOCKED_IN);\n+                }\n+                break;\n+            }\n+            case ThresholdState::DELAYED: {\n+                if (min_lock_in_time <= pindexPrev->GetMedianTimePast()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r603504786",
      "id" : 603504786,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMzUwNDc4Ng==",
      "original_commit_id" : "c7c8bfaf9ed3b4c72e378b2717cdd337370f74f9",
      "original_line" : 82,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/versionbits.cpp",
      "position" : null,
      "pull_request_review_id" : 623464640,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/603504786",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r603507963"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/603507963"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"versionbits: Add support for delayed lock in\"\r\n\r\nMaybe mention that the DELAYED state may be skipped entirely if the threshold is reached after min_lockin_time?",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-29T18:11:36Z",
      "diff_hunk" : "@@ -25,7 +25,8 @@ static const int32_t VERSIONBITS_NUM_BITS = 29;\n enum class ThresholdState {\n     DEFINED,   // First state that each softfork starts out as. The genesis block is by definition in this state for each deployment.\n     STARTED,   // For blocks past the starttime.\n-    LOCKED_IN, // For one retarget period after the first retarget period with STARTED blocks of which at least threshold have the associated bit set in nVersion.\n+    DELAYED,   // Between the first STARTED period where threshold is reached, until min_lockin_time is reached",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r603507963",
      "id" : 603507963,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMzUwNzk2Mw==",
      "original_commit_id" : "c7c8bfaf9ed3b4c72e378b2717cdd337370f74f9",
      "original_line" : 28,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/versionbits.h",
      "position" : null,
      "pull_request_review_id" : 623464640,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/603507963",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r603521398"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/603521398"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"tests: pull ComputeBlockVersion test into its own function\"\r\n\r\n@jnewbery Indeed, looks like it's only ever testing DEPLOYMENT_TESTDUMMY.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-29T18:33:09Z",
      "diff_hunk" : "@@ -242,81 +302,123 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n     }\n }\n \n-BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n+void check_computeblockversion(const Consensus::Params& params, Consensus::DeploymentPos dep)\n {\n+    // This implicitly uses versionbitscache, so clear it every time\n+    versionbitscache.Clear();\n+\n     // Check that ComputeBlockVersion will set the appropriate bit correctly\n-    // on mainnet.\n-    const auto chainParams = CreateChainParams(*m_node.args, CBaseChainParams::MAIN);\n-    const Consensus::Params &mainnetParams = chainParams->GetConsensus();\n \n     // Use the TESTDUMMY deployment for testing purposes.\n-    int64_t bit = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].bit;\n-    int64_t nStartTime = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nStartTime;\n-    int64_t nTimeout = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nTimeout;\n+    int64_t bit = params.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].bit;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r603521398",
      "id" : 603521398,
      "in_reply_to_id" : 603475179,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMzUyMTM5OA==",
      "original_commit_id" : "f720a0b45ad98f76f77dd50bf2495772412adb06",
      "original_line" : 313,
      "original_position" : 208,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 623464640,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/603521398",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r603539842"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/603539842"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"fuzz: test versionbits delayed lock in\"\r\n\r\nIn case `case ThresholdState::FAILED` you want to check that `exp_state` isn't `ThresholdState::DELAYED` either (I think the current fuzz code won't prevent a transition DELAYED->FAILED).",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-29T19:01:35Z",
      "diff_hunk" : "@@ -305,10 +308,19 @@ FUZZ_TARGET_INIT(versionbits, initialize)\n             assert(exp_state == ThresholdState::DEFINED);\n         }\n         break;\n+    case ThresholdState::DELAYED:\n     case ThresholdState::LOCKED_IN:\n-        assert(exp_state == ThresholdState::STARTED);\n-        assert(current_block->GetMedianTimePast() < checker.m_end);\n-        assert(blocks_sig >= threshold);\n+        if (state == ThresholdState::DELAYED) {\n+            assert(current_block->GetMedianTimePast() < min_lock_in_time);\n+        } else {\n+            assert(min_lock_in_time <= current_block->GetMedianTimePast());\n+        }\n+        if (exp_state == ThresholdState::STARTED) {\n+            assert(blocks_sig >= threshold);\n+            assert(current_block->GetMedianTimePast() < checker.m_end);\n+        } else {\n+            assert(exp_state == ThresholdState::DELAYED);\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r603539842",
      "id" : 603539842,
      "line" : 311,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMzUzOTg0Mg==",
      "original_commit_id" : "97baea8ac33f2fb9a2959f81602ab068c5e7e1ca",
      "original_line" : 311,
      "original_position" : 54,
      "original_start_line" : null,
      "path" : "src/test/fuzz/versionbits.cpp",
      "position" : 90,
      "pull_request_review_id" : 623464640,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/603539842",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I believe this is the intended state machine:\r\n\r\n\r\n![states](https://user-images.githubusercontent.com/548488/112888562-596a7380-9089-11eb-8375-4de3bf07c1b5.png)\r\n\r\nTo generate:\r\n\r\n```sh\r\n$ dot -Tpng >states.png\r\ndigraph versionbits {\r\n    defined [shape=box,label=\"DEFINED\"];\r\n    started [shape=box,label=\"STARTED\"];\r\n    failed [shape=box,label=\"FAILED\"];\r\n    locked [shape=box,label=\"LOCKED_IN\"];\r\n    delayed [shape=box,label=\"DELAYED\"];\r\n    active [shape=box,label=\"ACTIVE\"];\r\n\r\n    defined -> defined [label=\"time < begin\\ntime < end\"];\r\n    defined -> started [label=\"time >= begin\\ntime < end\"];\r\n    defined -> failed [label=\"time >= end\"];\r\n    started -> started [label=\"time < end\\nsig < thresh\"];\r\n    started -> failed [label=\"time >= end\\n\"];\r\n    started -> delayed [label=\"time < end\\nsig >= thresh\\ntime < min_lock\"];\r\n    started -> locked [label=\"time < end\\nsig >= thresh\\ntime >= min_lock\"];\r\n    delayed -> delayed [label=\"time < min_lock\"];\r\n    delayed -> locked [label=\"time >= min_lock\"];\r\n    locked -> active [label=\"always\"];\r\n    active -> active [label=\"always\"];\r\n    failed -> failed [label=\"always\"];\r\n}\r\n```",
      "created_at" : "2021-03-29T19:22:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-809646100",
      "id" : 809646100,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwOTY0NjEwMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-30T01:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/809646100",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "When this was updated I was originally a bit frustrated since the addition of the DELAYED state + switch to all MTP invalidates the ACKs on this PR.\r\n\r\nHowever, now that I understand @ajtowns reasoning around signet compatibility, I see the merit with this approach and retract my earlier preference for height based ST. With regards to review burden, I still think this is slightly easier to reason about & a smaller diff, but I think we've accepted the risks of delaying the proposed release schedule in favor of creating a more robust mechanism. As a [Signet Operator](https://twitter.com/JeremyRubin/status/1339699281192656897)*, a pure MTP design should make it easier for me to activate taproot for users of my network. \r\n\r\nMy only critique of the modified design is that it might be nice to accommodate a min number of signal periods (e.g., 6) so that signets with 1 hour block rate would have sufficient time to activate. 1 hour isn't crazy for a signet because such blocks are seen somewhat often on the network, so a long-delay signet might have utility for testing infrastructure robustness.\r\n\r\nI don't think this is a show-stopping issue for merging this code as-is, because the min number of signal periods functionality can be added later relatively easily without affecting any ongoing release (just default set it to 0).\r\n\r\n\r\n\\* my signet is currently crashed, hope to bring it online soon when I can add disk space...",
      "created_at" : "2021-03-29T20:57:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-809708651",
      "id" : 809708651,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwOTcwODY1MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-29T20:57:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/809708651",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "You may also want to rebase to fix the Android ARM build (#21541).",
      "created_at" : "2021-03-29T21:12:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-809717610",
      "id" : 809717610,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwOTcxNzYxMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-29T21:12:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/809717610",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r603724066"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/603724066"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nope, must have missed replacing all those in some rebase/redraft or another.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-30T01:48:53Z",
      "diff_hunk" : "@@ -242,81 +302,123 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n     }\n }\n \n-BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n+void check_computeblockversion(const Consensus::Params& params, Consensus::DeploymentPos dep)\n {\n+    // This implicitly uses versionbitscache, so clear it every time\n+    versionbitscache.Clear();\n+\n     // Check that ComputeBlockVersion will set the appropriate bit correctly\n-    // on mainnet.\n-    const auto chainParams = CreateChainParams(*m_node.args, CBaseChainParams::MAIN);\n-    const Consensus::Params &mainnetParams = chainParams->GetConsensus();\n \n     // Use the TESTDUMMY deployment for testing purposes.\n-    int64_t bit = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].bit;\n-    int64_t nStartTime = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nStartTime;\n-    int64_t nTimeout = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nTimeout;\n+    int64_t bit = params.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].bit;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r603724066",
      "id" : 603724066,
      "in_reply_to_id" : 603475179,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMzcyNDA2Ng==",
      "original_commit_id" : "f720a0b45ad98f76f77dd50bf2495772412adb06",
      "original_line" : 313,
      "original_position" : 208,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 623778523,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/603724066",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r603726994"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/603726994"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Because WarningBitsConditionChecker doesn't override MinLockInTime() so uses the default from AbstractThresholdConditionChecker which always returns 0. Will change the comment to refer to MinLockInTime instead of min_lock_in_time.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-30T01:58:15Z",
      "diff_hunk" : "@@ -2456,6 +2464,7 @@ static void UpdateTip(CTxMemPool& mempool, const CBlockIndex* pindexNew, const C\n             WarningBitsConditionChecker checker(bit);\n             ThresholdState state = checker.GetStateFor(pindex, chainParams.GetConsensus(), warningcache[bit]);\n             if (state == ThresholdState::ACTIVE || state == ThresholdState::LOCKED_IN) {\n+                // DELAYED unreachable since min_lock_in_time = 0",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r603726994",
      "id" : 603726994,
      "in_reply_to_id" : 603502659,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMzcyNjk5NA==",
      "original_commit_id" : "c7c8bfaf9ed3b4c72e378b2717cdd337370f74f9",
      "original_line" : 2467,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 623781905,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/603726994",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r603735149"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/603735149"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ah, I updated that for LAST_CHANCE in https://github.com/ajtowns/bitcoin/commits/202103-bip9-uasf but didn't backfill to here.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-30T02:25:27Z",
      "diff_hunk" : "@@ -305,10 +308,19 @@ FUZZ_TARGET_INIT(versionbits, initialize)\n             assert(exp_state == ThresholdState::DEFINED);\n         }\n         break;\n+    case ThresholdState::DELAYED:\n     case ThresholdState::LOCKED_IN:\n-        assert(exp_state == ThresholdState::STARTED);\n-        assert(current_block->GetMedianTimePast() < checker.m_end);\n-        assert(blocks_sig >= threshold);\n+        if (state == ThresholdState::DELAYED) {\n+            assert(current_block->GetMedianTimePast() < min_lock_in_time);\n+        } else {\n+            assert(min_lock_in_time <= current_block->GetMedianTimePast());\n+        }\n+        if (exp_state == ThresholdState::STARTED) {\n+            assert(blocks_sig >= threshold);\n+            assert(current_block->GetMedianTimePast() < checker.m_end);\n+        } else {\n+            assert(exp_state == ThresholdState::DELAYED);\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r603735149",
      "id" : 603735149,
      "in_reply_to_id" : 603539842,
      "line" : 311,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMzczNTE0OQ==",
      "original_commit_id" : "97baea8ac33f2fb9a2959f81602ab068c5e7e1ca",
      "original_line" : 311,
      "original_position" : 54,
      "original_start_line" : null,
      "path" : "src/test/fuzz/versionbits.cpp",
      "position" : 90,
      "pull_request_review_id" : 623791457,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/603735149",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : ">  a pure MTP design should make it easier for me to activate taproot for users of my network\r\n\r\nNote -- taproot is already active on any signet; activation on signet is only a concern for any future soft forks (eg CTV).",
      "created_at" : "2021-03-30T02:28:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-809857392",
      "id" : 809857392,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwOTg1NzM5Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-30T02:28:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/809857392",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Bumped for 21541 and addressed review comments.",
      "created_at" : "2021-03-30T02:33:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-809858941",
      "id" : 809858941,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwOTg1ODk0MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-30T02:33:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/809858941",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@jnewbery\r\n\r\n>  I wonder if those first three commits should be pulled out into a separate PR?\r\n\r\nThe could be, but they aren't terribly compatible with #21392 which stops checking ComputeBlockVersion behaviour against mainnet, and has a bunch of other changes to the ComputeBlockVersion test in order to convert from mtp to heights.",
      "created_at" : "2021-03-30T02:51:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-809865193",
      "id" : 809865193,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwOTg2NTE5Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-30T02:51:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/809865193",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r603766900"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/603766900"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Âµnit: grammar a weird",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-30T04:14:14Z",
      "diff_hunk" : "@@ -302,17 +330,29 @@ static void check_computeblockversion(const Consensus::Params& params, Consensus\n         nHeight += 1;\n     }\n \n-    nTime = nTimeout;\n-    // FAILED is only triggered at the end of a period, so CBV should be setting\n-    // the bit until the period transition.\n-    for (uint32_t i = 0; i < params.nMinerConfirmationWindow - 1; i++) {\n+    if (nTimeout != Consensus::BIP9Deployment::NO_TIMEOUT) {\n+        // cannot reach NO_TIMEOUT a uint32_t",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r603766900",
      "id" : 603766900,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMzc2NjkwMA==",
      "original_commit_id" : "754ab11f2085a0c5e417cfbba80cd024fc8ea67a",
      "original_line" : 334,
      "original_position" : 101,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 623827450,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/603766900",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r603774698"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/603774698"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: this comment seems to apply to `TestActiveLockedIn`, not `TestLockedInDelayed`.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-30T04:36:30Z",
      "diff_hunk" : "@@ -151,6 +191,11 @@ class VersionBitsTester\n     VersionBitsTester& TestActive() { return TestState(ThresholdState::ACTIVE); }\n     VersionBitsTester& TestFailed() { return TestState(ThresholdState::FAILED); }\n \n+    // non-delayed should be active; delayed should still be locked in",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r603774698",
      "id" : 603774698,
      "line" : 182,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMzc3NDY5OA==",
      "original_commit_id" : "8c63862471ccfc61142a7f62aaf6f2778ff810ab",
      "original_line" : 182,
      "original_position" : 106,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 130,
      "pull_request_review_id" : 623827450,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/603774698",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I'd like to rescind my [previous Approach NACK](https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-807422992)\r\n\r\nIt was given in the spirit of wanting all review to be focused on a single Speedy Trial PR (something I think should be top priority above all else) rather than two PRs, thinking an alternative PR (#21392) was better placed to be merged and personal preference too.\r\n\r\nHowever, I am less sure the alternative PR stands a better chance of being merged at this point. And my personal preference for the alternative PR is not strong enough to Approach NACK this PR otherwise.\r\n\r\nHence, Approach ACK for this PR. My preference is #21392 but (to the extent I can) I won't stand in the way of this PR being merged if it can be.\r\n\r\n",
      "created_at" : "2021-03-30T15:46:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-810372505",
      "id" : 810372505,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMDM3MjUwNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-30T15:46:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/810372505",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/16323900?v=4",
         "events_url" : "https://api.github.com/users/michaelfolkson/events{/privacy}",
         "followers_url" : "https://api.github.com/users/michaelfolkson/followers",
         "following_url" : "https://api.github.com/users/michaelfolkson/following{/other_user}",
         "gists_url" : "https://api.github.com/users/michaelfolkson/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/michaelfolkson",
         "id" : 16323900,
         "login" : "michaelfolkson",
         "node_id" : "MDQ6VXNlcjE2MzIzOTAw",
         "organizations_url" : "https://api.github.com/users/michaelfolkson/orgs",
         "received_events_url" : "https://api.github.com/users/michaelfolkson/received_events",
         "repos_url" : "https://api.github.com/users/michaelfolkson/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/michaelfolkson/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/michaelfolkson/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/michaelfolkson"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r604268301"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/604268301"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I couldn't even fit all the words I needed a uint32_t.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-03-30T16:49:58Z",
      "diff_hunk" : "@@ -302,17 +330,29 @@ static void check_computeblockversion(const Consensus::Params& params, Consensus\n         nHeight += 1;\n     }\n \n-    nTime = nTimeout;\n-    // FAILED is only triggered at the end of a period, so CBV should be setting\n-    // the bit until the period transition.\n-    for (uint32_t i = 0; i < params.nMinerConfirmationWindow - 1; i++) {\n+    if (nTimeout != Consensus::BIP9Deployment::NO_TIMEOUT) {\n+        // cannot reach NO_TIMEOUT a uint32_t",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r604268301",
      "id" : 604268301,
      "in_reply_to_id" : 603766900,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNDI2ODMwMQ==",
      "original_commit_id" : "754ab11f2085a0c5e417cfbba80cd024fc8ea67a",
      "original_line" : 334,
      "original_position" : 101,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 624490909,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/604268301",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> My only critique of the modified design is that it might be nice to accommodate a min number of signal periods (e.g., 6) so that signets with 1 hour block rate would have sufficient time to activate. 1 hour isn't crazy for a signet because [...]\r\n\r\nI'm not sure that a 1 hour block rate isn't crazy -- `nPowTargetSpacing` is still 10min, so your difficulty would keep getting automatically lowered unless you had bursts of blocks to compensate so that the average rate hits 10min every 2 weeks. If you have bursts like that to maintain difficulty anyway, you can just use them to get signalling done in a normal timeframe.\r\n\r\nBut ignoring that, I think an easy fix would be to lower signet's `nMinerConfirmationWindow` from 2016 to 288; that way normal signets can activate changes in four days instead of four weeks; and even a 1-hour-per-block signet that wasn't willing to do bursts wouldn't need to to take much longer than a month either (<12 days to hit a 288-block boundary, ~12 days to signal, ~12 days to lock in, so <36 days total).",
      "created_at" : "2021-03-31T09:50:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-810934977",
      "id" : 810934977,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMDkzNDk3Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-31T09:50:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/810934977",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@ajtowns i thought you could set arbitrary block rates for signet?",
      "created_at" : "2021-03-31T16:50:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-811247130",
      "id" : 811247130,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMTI0NzEzMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-31T16:50:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/811247130",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> @ajtowns i thought you could set arbitrary block rates for signet?\r\n\r\nThe only signet consensus parameter you can change (without everyone recompiling) is the block challenge. The old miner script used to let you target a block rate, but that would have an impact on difficulty that might be annoying to manage, so the new one lets you target a difficulty (`--nbits`) and adjusts the block rate to match; when you hit your difficulty target, it'll just average out at ~10min per block.",
      "created_at" : "2021-04-01T12:44:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-811881601",
      "id" : 811881601,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMTg4MTYwMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-01T12:44:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/811881601",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I believe this is the intended state machine:\r\n\r\nYeah. It's somewhat more complicted than it could be because it's maintaining some of the complexities of the bip9 state machine. It could be simplified a bit by dropping the DEFINED->FAILED case and not ignoring signalling from the last STARTED period:\r\n\r\n![image](https://user-images.githubusercontent.com/127186/113322089-9b303e00-9357-11eb-80d3-d3f8b7860f4b.png)\r\n\r\nExcepting the addition of the DELAYED state, that pretty much makes it the same as the corresponding [bip8 diagram](https://github.com/bitcoin/bitcoin/pull/21392#issuecomment-809850058), as bip8 has already made those changes compared to bip9.\r\n\r\n```dot\r\ndigraph versionbits {\r\n    defined [shape=box,label=\"DEFINED\"];\r\n    started [shape=box,label=\"STARTED\"];\r\n    failed [shape=box,label=\"FAILED\"];\r\n    locked [shape=box,label=\"LOCKED_IN\"];\r\n    delayed [shape=box,label=\"DELAYED\"];\r\n    active [shape=box,label=\"ACTIVE\"];\r\n\r\n    delayorlock [shape=circle,label=\"\"];\r\n\r\n    edge [weight=1];\r\n    defined -> defined [label=\"time < begin\"];\r\n    started -> started [label=\"nsig < thresh\\ntime < end\"];\r\n    active -> active [label=\"always\"];\r\n    failed -> failed [label=\"always\"];\r\n    delayed -> delayorlock [label=\"always\"];\r\n\r\n    edge [weight=100];\r\n    defined -> started [label=\"time >= begin\"];\r\n    started -> failed [label=\"nsig < thresh\\ntime >= end\\n\"];\r\n\r\n    started -> delayorlock [label=\"nsig >= thresh\"];\r\n    delayorlock -> delayed [label=\"time < min_lock\"];\r\n    delayorlock -> locked [label=\"time >= min_lock\"];\r\n\r\n    locked -> active [label=\"always\"];\r\n\r\n    { rank=same; delayed delayorlock }\r\n}\r\n```",
      "created_at" : "2021-04-01T16:26:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-812023131",
      "id" : 812023131,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMjAyMzEzMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-01T16:26:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/812023131",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r605875072"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/605875072"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should this say median time not a block timestamp (`nTime`) ?\r\n\r\nIIUC correctly the problem mentions [here](https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-792425221) is solved for the following rational. If a reorg occurs across a retarget period with new block timestamps rolling back the median time, the LOCKED_IN period serves a safety buffer until ACTIVATION ? If so that would be great to document it somewhere.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-01T18:50:22Z",
      "diff_hunk" : "@@ -29,6 +29,11 @@ struct BIP9Deployment {\n     int64_t nStartTime;\n     /** Timeout/expiry MedianTime for the deployment attempt. */\n     int64_t nTimeout;\n+    /** Delay lock in occuring until at least this timestamp.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r605875072",
      "id" : 605875072,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNTg3NTA3Mg==",
      "original_commit_id" : "e12a22a0fd9d18bde1cffc6f919b58f77cf83236",
      "original_line" : 32,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/consensus/params.h",
      "position" : null,
      "pull_request_review_id" : 626556829,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/605875072",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I was confused how it would be possible to go directly from `DEFINED`->`FAILED` without passing through `STARTED` in @sipa's state machine here: https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-809646100  Seems only possible if \"end\" is before \"begin\"?\r\n\r\n@ajtowns drops it here (mentions it is due to BIP9?) https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-812023131\r\nShould `STARTED` -> `delayorlock` be defined as \"nsig >= thresh & time <= end\" ?\r\n\r\n\r\n",
      "created_at" : "2021-04-02T21:08:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-812716425",
      "id" : 812716425,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMjcxNjQyNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-02T21:08:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/812716425",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/24482484?v=4",
         "events_url" : "https://api.github.com/users/Rspigler/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Rspigler/followers",
         "following_url" : "https://api.github.com/users/Rspigler/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Rspigler/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Rspigler",
         "id" : 24482484,
         "login" : "Rspigler",
         "node_id" : "MDQ6VXNlcjI0NDgyNDg0",
         "organizations_url" : "https://api.github.com/users/Rspigler/orgs",
         "received_events_url" : "https://api.github.com/users/Rspigler/received_events",
         "repos_url" : "https://api.github.com/users/Rspigler/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Rspigler/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Rspigler/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Rspigler"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "If it is currently not possible to bury/flag-day activate/vb signal at different heights/times in signet, it seems that this should be made possible via command line options, not by preferring MTP over height based vb code (or the other way round).\r\n\r\nAlso, I fail to see how MTP solves an issue that height based can't. Let's assume the signet default params for deployment mention a start and end parameter for a soft-fork, but someone wants to start a signet with the softfork always active. This can only be fixed by supplying modified source/binaries or by allowing the users/miners to pick the vbparams at runtime. It can't be fixed by using MTP over height (or the other way round).",
      "created_at" : "2021-04-04T12:03:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-813021596",
      "id" : 813021596,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMzAyMTU5Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-04T12:03:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/813021596",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "the benefit of MTP is not needing to disseminate additional parameters per-signet for activation. If you upgrade to the latest bitcoin-core with a new Soft fork deployment, your existing config file (with whatever signetchallenge) will be able to activate without further configuration.\r\n\r\nthis is not possible with height.",
      "created_at" : "2021-04-04T20:32:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-813095313",
      "id" : 813095313,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMzA5NTMxMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-04T20:32:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/813095313",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "If Signet is going to become a reason to choose inferior consensus code for mainnet, then we should revert Signet.",
      "created_at" : "2021-04-04T21:08:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-813099418",
      "id" : 813099418,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMzA5OTQxOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-04T21:08:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/813099418",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "it's also true for testnet",
      "created_at" : "2021-04-04T21:21:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-813101166",
      "id" : 813101166,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMzEwMTE2Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-04T21:21:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/813101166",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I don't think signet should be a consideration for MTP vs height, since taproot is already activated on signet, and there's no indication that ST will be used in the future.",
      "created_at" : "2021-04-04T22:06:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-813106382",
      "id" : 813106382,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMzEwNjM4Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-04T22:06:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/813106382",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/24482484?v=4",
         "events_url" : "https://api.github.com/users/Rspigler/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Rspigler/followers",
         "following_url" : "https://api.github.com/users/Rspigler/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Rspigler/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Rspigler",
         "id" : 24482484,
         "login" : "Rspigler",
         "node_id" : "MDQ6VXNlcjI0NDgyNDg0",
         "organizations_url" : "https://api.github.com/users/Rspigler/orgs",
         "received_events_url" : "https://api.github.com/users/Rspigler/received_events",
         "repos_url" : "https://api.github.com/users/Rspigler/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Rspigler/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Rspigler/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Rspigler"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> this is not possible with height.\r\n\r\nIs it really that much work to check the place where you copied the signetchallenge to also copy the vbparams? You'll have to do that anyway, otherwise you won't know if your signet picked always active, flag day, or signalling activation.",
      "created_at" : "2021-04-05T06:06:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-813208375",
      "id" : 813208375,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMzIwODM3NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-05T06:06:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/813208375",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "apologies, I just am not going to be awake for a 3am IRC meeting my time, so dropping my feedback here:\r\n\r\nI'm unconvinced by the arguments set out here for MTP: the one thing you *do* get is testnet being an activation testing ground for the MTP-based implementation. Other than that it's a wash, or it seems to be a net negative for clarity and testing. \r\n\r\nIf signets require a little more config data to be passed around, so be it. We should not be tying mainnet safety to configs of these networks. Based on my years of experience any proper operation of a \"non-official\" signet-like chain will be carting around a config file anyways.\r\n\r\nfwiw I'm deferring proper review of a PR until I think we can approach consensus on this topic. I think this can be solved provided the review burden of both is similar in magnitude.",
      "created_at" : "2021-04-06T05:30:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-813833780",
      "id" : 813833780,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMzgzMzc4MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-06T05:32:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/813833780",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@MarcoFalke\r\n\r\n> Also, I fail to see how MTP solves an issue that height based can't. Let's assume the signet default params for deployment mention a start and end parameter for a soft-fork, but someone wants to start a signet with the softfork always active. This can only be fixed by supplying modified source/binaries or by allowing the users/miners to pick the vbparams at runtime. It can't be fixed by using MTP over height (or the other way round).\r\n\r\nThe issue for signet that MTP signalling solves that height based signalling doesn't is allowing multiple signets to operate with the same fixed-at-compile-time parameters. That avoids having to have every user of every signet add custom command line parameters that will change over the lifetime of the signet (as additional soft forks are deployed/activated).\r\n\r\nWith MTP signalling, if you want a non-buried soft fork \"always active\" on a new signet, you create the signet and mine 3 periods worth of blocks, signalling in the second period -- no need for anyone to set vbparams. (For a soft fork that's buried via MTP, you simply need to get MTP past the burial MTP, so likely only need to mine two or three blocks if you're creating a new signet for an already buried fork)\r\n\r\nIf you're adding height-based params to signetchallenge, you're making the challenge incompatible with existing nodes (that obviously don't support parsing and removing the vbparams from the challenge), but you're also requiring the challenge to change with each new soft fork: you'll need to add 'anyprevout=height' one day, then 'ctv=height' some other day, then 'consensuscleanup=height' some other day, and can't remove any of them, even after they're buried on mainnet. And you're also providing an extra way for people to make consensus-breaking mistakes, in hard to detect ways -- currently if you get the signet challenge wrong you'll just end up having a different network magic and not connect to the signet at all, but with optional parameters added you can't do the same, since you want to be backwards compatible by allowing the optional values to be missing.\r\n\r\n@Rspigler \r\n\r\n> I don't think signet should be a consideration for MTP vs height, since taproot is already activated on signet, and there's no indication that ST will be used in the future.\r\n\r\nIf we're not trying to use this as a stepping stone for future activations, then it would make sense to keep the changes for ST as simple as possible, and sticking with MTP is the smaller and more easily backportable set of changes...\r\n\r\nEven restricting the analysis purely to the effect on mainnet, and ignoring testing, implementation or backporting complexity, [I think MTP is superior](https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2021-April/018728.html); if it were blocking the ability to reasonably do a UASF then that would still be a showstopper, but as per the [LAST_CHANCE](https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-808843817) comments above, I don't see any reason why that would be the case.",
      "created_at" : "2021-04-06T07:31:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-813896241",
      "id" : 813896241,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMzg5NjI0MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-06T07:31:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/813896241",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think that the `min_lock_in_time` should be reverted to `min_activation_height`. As noted on [the mailing list](https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2021-April/018740.html), `min_lock_in_time` adds an additional 14 day uncertainty to the true activation time, whereas predicting the time for `min_activation_height` to be reached only gets better as that height approaches. A good enough prediction of the actual activation time can be known several days or weeks ahead. With `min_lock_in_time`, miners could also manipulate timestamps to introduce uncertainty in the activation time.\r\n\r\nAlthough I think that block heights is technically superior, many of the specific things that it guarantees are still provided by an MTP implementation probabilistically and some changes can be made to provide the same guarantees. With that in mind, I would like to see that the `DEFINED->FAILED` transition is removed and the unconditional `STARTED->FAILED` when the timeout is reached. This would make it more like BIP 8 where at least one signaling period is guaranteed, and if the timeout falls in the middle of a signaling period, then that period will still count towards the activation.",
      "created_at" : "2021-04-06T23:20:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-814494847",
      "id" : 814494847,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxNDQ5NDg0Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-06T23:29:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/814494847",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "~@achow101 what would you say to at the point of lock_in a height is projected out to estimate a date based on 9.5 minute blocks? Or something like that... it works for signets fine as well, and then you avoid the +/- issue at the actual turn on point?~",
      "created_at" : "2021-04-06T23:40:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-814501264",
      "id" : 814501264,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxNDUwMTI2NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-06T23:47:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/814501264",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Ah also noting that min_activation_height should be compatible with signet no matter what it is set to (edit: most simply, 0), unlike startheight/stopheight so it doesn't matter that much!",
      "created_at" : "2021-04-06T23:41:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-814501789",
      "id" : 814501789,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxNDUwMTc4OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-06T23:47:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/814501789",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Although I think that block heights is technically superior, many of the specific things that it guarantees are still provided by an MTP implementation probabilistically and some changes can be made to provide the same guarantees. With that in mind, I would like to see that the DEFINED->FAILED transition is removed and the unconditional STARTED->FAILED when the timeout is reached. This would make it more like BIP 8 where at least one signaling period is guaranteed, and if the timeout falls in the middle of a signaling period, then that period will still count towards the activation.\r\n\r\n@achow101 would the LAST_CHANCE https://github.com/ajtowns/bitcoin/commits/202103-bip9-uasf solution work for the guaranteed at least 1 signal period? ",
      "created_at" : "2021-04-07T00:36:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-814519697",
      "id" : 814519697,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxNDUxOTY5Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-07T00:36:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/814519697",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> @achow101 would the LAST_CHANCE https://github.com/ajtowns/bitcoin/commits/202103-bip9-uasf solution work for the guaranteed at least 1 signal period?\r\n\r\nOriginally this paragraph suggested that, but @ajtowns pointed out that changing these state transitions achieves the same effect. I prefer changing these transitions rather than adding a new state as these were part of BIP 8 and are thus already (partially) understood. However I think it is important to add LAST_CHANCE later since it enables a UASF.",
      "created_at" : "2021-04-07T01:01:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-814527139",
      "id" : 814527139,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxNDUyNzEzOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-07T01:01:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/814527139",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Updates as per [achow101's suggestions](https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-814494847) -- switches back from fully-mtp-based to using min_activation_height, and drops bip9's \"fail immediately when timeout passes\" handling (also adds a NEVER_ACTIVE special case, since the lack of an immediate failure mode means you can't just use a super-early timeout for that purpose anymore).\r\n\r\nI believe this should capture the updated state machine:\r\n\r\n![image](https://user-images.githubusercontent.com/127186/113842362-f342c680-97d5-11eb-89ea-15dd3c114a46.png)\r\n\r\n[EDIT: note that these all map attributes of the last block in a period to the activation state of all blocks in the next period. Replace \"time\" by \"previous block's time\" and \"height + 1\" by \"height\" to map attributes of the first block in a period to the activation state of all blocks in the same period]\r\n\r\nI believe this backports to 0.21 cleanly (on top of #21614 anyway).\r\n\r\n(CI is currently timing out on the fuzzer run)",
      "created_at" : "2021-04-07T09:36:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-814768715",
      "id" : 814768715,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxNDc2ODcxNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-12T01:32:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/814768715",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r608755079"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/608755079"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: Might be worth adding a comment saying `pindexPrev->nHeight + 1` is used so we measure the current block height, and not the previous block's height",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-07T15:21:24Z",
      "diff_hunk" : "@@ -74,12 +74,16 @@ ThresholdState AbstractThresholdConditionChecker::GetStateFor(const CBlockIndex*\n                 }\n                 if (count >= nThreshold) {\n                     stateNext = ThresholdState::LOCKED_IN;\n+                } else if (pindexPrev->GetMedianTimePast() >= nTimeTimeout) {\n+                    stateNext = ThresholdState::FAILED;\n                 }\n                 break;\n             }\n             case ThresholdState::LOCKED_IN: {\n-                // Always progresses into ACTIVE.\n-                stateNext = ThresholdState::ACTIVE;\n+                // Progresses into ACTIVE provided activation height will have been reached.\n+                if (pindexPrev->nHeight + 1 >= min_activation_height) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r608755079",
      "id" : 608755079,
      "line" : 84,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODc1NTA3OQ==",
      "original_commit_id" : "be7d1368d8e98b6f9f692289b7d25ac369bf2984",
      "original_line" : 84,
      "original_position" : 53,
      "original_start_line" : null,
      "path" : "src/versionbits.cpp",
      "position" : 53,
      "pull_request_review_id" : 630144865,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/608755079",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r608871691"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/608871691"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In aa6a95de12b265cd3dc16b2d1303b89a20331a56 \"versionbits: Add support for delayed activation after lockin\"\r\n\r\nThis could also check that all of the parameters are valid. That would be `>=0` for all of them and `nStartTime` and `nTimeout` are either `-1` (or `-2` when it is introduced). And that `min_activation_height` falls on a retarget boundary.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-07T17:54:49Z",
      "diff_hunk" : "@@ -492,22 +503,26 @@ void CRegTestParams::UpdateActivationParametersFromArgs(const ArgsManager& args)\n     for (const std::string& strDeployment : args.GetArgs(\"-vbparams\")) {\n         std::vector<std::string> vDeploymentParams;\n         boost::split(vDeploymentParams, strDeployment, boost::is_any_of(\":\"));\n-        if (vDeploymentParams.size() != 3) {\n-            throw std::runtime_error(\"Version bits parameters malformed, expecting deployment:start:end\");\n+        if (vDeploymentParams.size() < 3 || 4 < vDeploymentParams.size()) {\n+            throw std::runtime_error(\"Version bits parameters malformed, expecting deployment:start:end[:min_activation_height]\");\n         }\n         int64_t nStartTime, nTimeout;\n+        int min_activation_height = 0;\n         if (!ParseInt64(vDeploymentParams[1], &nStartTime)) {\n             throw std::runtime_error(strprintf(\"Invalid nStartTime (%s)\", vDeploymentParams[1]));\n         }\n         if (!ParseInt64(vDeploymentParams[2], &nTimeout)) {\n             throw std::runtime_error(strprintf(\"Invalid nTimeout (%s)\", vDeploymentParams[2]));\n         }\n+        if (vDeploymentParams.size() >= 4 && !ParseInt32(vDeploymentParams[3], &min_activation_height)) {\n+            throw std::runtime_error(strprintf(\"Invalid min_activation_height (%s)\", vDeploymentParams[3]));\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r608871691",
      "id" : 608871691,
      "line" : 519,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODg3MTY5MQ==",
      "original_commit_id" : "aa6a95de12b265cd3dc16b2d1303b89a20331a56",
      "original_line" : 519,
      "original_position" : 91,
      "original_start_line" : null,
      "path" : "src/chainparams.cpp",
      "position" : 117,
      "pull_request_review_id" : 630322175,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/608871691",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r608873198"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/608873198"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In c7008a1a07ae8bd8dfb9c2001a4fdef6e08eb395 \"versionbits: Add explicit NEVER_ACTIVE deployments\"\r\n\r\nCould add `assert(!never_active_test)` in `case ThresholdState::STARTED`.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-07T17:56:53Z",
      "diff_hunk" : "@@ -323,7 +322,7 @@ FUZZ_TARGET_INIT(versionbits, initialize)\n         assert(exp_state == ThresholdState::ACTIVE || exp_state == ThresholdState::LOCKED_IN);\n         break;\n     case ThresholdState::FAILED:\n-        assert(current_block->GetMedianTimePast() >= checker.m_end);\n+        assert(never_active_test || current_block->GetMedianTimePast() >= checker.m_end);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r608873198",
      "id" : 608873198,
      "line" : 318,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODg3MzE5OA==",
      "original_commit_id" : "c7008a1a07ae8bd8dfb9c2001a4fdef6e08eb395",
      "original_line" : 318,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/test/fuzz/versionbits.cpp",
      "position" : 99,
      "pull_request_review_id" : 630322175,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/608873198",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r608881332"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/608881332"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In e94fc819d8a996ce3690274c307c537329dfb95b \"tests: test versionbits delayed activation\"\r\n\r\nHow come `min_activation_height` is set so high? By my calculation, it only needs to be at least 576.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-07T18:09:13Z",
      "diff_hunk" : "@@ -394,6 +444,16 @@ BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n             check_computeblockversion(chainParams->GetConsensus(), static_cast<Consensus::DeploymentPos>(i));\n         }\n     }\n+\n+    {\n+        // Use regtest/testdummy to ensure we always exercise the\n+        // min_lock_in_time test, even if we're not using that in a\n+        // live deployment\n+        ArgsManager args;\n+        args.ForceSetArg(\"-vbparams\", \"testdummy:1199145601:1230767999:403200\"); // January 1, 2008 - December 31, 2008, min act height 403200",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r608881332",
      "id" : 608881332,
      "line" : 465,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwODg4MTMzMg==",
      "original_commit_id" : "e94fc819d8a996ce3690274c307c537329dfb95b",
      "original_line" : 465,
      "original_position" : 183,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 471,
      "pull_request_review_id" : 630322175,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/608881332",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609061269"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609061269"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"tests: test ComputeBlockVersion for all deployments\"\r\n\r\nI don't understand this comment.  (1) in this generalized check for all deployments, the \"bit we're testing happens to be bit 28\" isn't the case; (2) the exact comparison on the next line is run several times prior to here without this comment.  Was there maybe an additional check here that got deleted?",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-07T20:52:26Z",
      "diff_hunk" : "@@ -244,44 +244,72 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n \n static void check_computeblockversion(const Consensus::Params& params, Consensus::DeploymentPos dep)\n {\n+    // This implicitly uses versionbitscache, so clear it every time\n+    versionbitscache.Clear();\n+\n     // Check that ComputeBlockVersion will set the appropriate bit correctly\n \n     int64_t bit = params.vDeployments[dep].bit;\n     int64_t nStartTime = params.vDeployments[dep].nStartTime;\n     int64_t nTimeout = params.vDeployments[dep].nTimeout;\n \n-    assert(nStartTime < nTimeout);\n+    // should not be any signalling for first block\n+    BOOST_CHECK_EQUAL(ComputeBlockVersion(nullptr, params), VERSIONBITS_TOP_BITS);\n+\n+    // always active deployments shouldn't need to be tested further\n+    if (nStartTime == Consensus::BIP9Deployment::ALWAYS_ACTIVE) return;\n+\n+    BOOST_REQUIRE(nStartTime < nTimeout);\n+    BOOST_REQUIRE(nStartTime >= 0);\n+    BOOST_REQUIRE(nTimeout <= std::numeric_limits<uint32_t>::max() || nTimeout == Consensus::BIP9Deployment::NO_TIMEOUT);\n+    BOOST_REQUIRE(0 <= bit && bit < 32);\n+    BOOST_REQUIRE(((1 << bit) & VERSIONBITS_TOP_MASK) == 0);\n \n     // In the first chain, test that the bit is set by CBV until it has failed.\n     // In the second chain, test the bit is set by CBV while STARTED and\n     // LOCKED-IN, and then no longer set while ACTIVE.\n     VersionBitsTester firstChain, secondChain;\n \n-    // Start generating blocks before nStartTime\n-    int64_t nTime = nStartTime - 1;\n+    int64_t nTime = nStartTime;\n \n-    // Before MedianTimePast of the chain has crossed nStartTime, the bit\n-    // should not be set.\n     CBlockIndex *lastBlock = nullptr;\n-    lastBlock = firstChain.Mine(params.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\n \n-    // Mine more blocks (4 less than the adjustment period) at the old time, and check that CBV isn't setting the bit yet.\n-    for (uint32_t i = 1; i < params.nMinerConfirmationWindow - 4; i++) {\n-        lastBlock = firstChain.Mine(params.nMinerConfirmationWindow + i, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-        // This works because VERSIONBITS_LAST_OLD_BLOCK_VERSION happens\n-        // to be 4, and the bit we're testing happens to be bit 28.\n+    // Before MedianTimePast of the chain has crossed nStartTime, the bit\n+    // should not be set.\n+    if (nTime == 0) {\n+        // since CBlockIndex::nTime is uint32_t we can't represent any\n+        // earlier time, so will transition from DEFINED to STARTED at the\n+        // end of the first period by mining blocks at nTime == 0\n+        lastBlock = firstChain.Mine(params.nMinerConfirmationWindow - 1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n         BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\n-    }\n-    // Now mine 5 more blocks at the start time -- MTP should not have passed yet, so\n-    // CBV should still not yet set the bit.\n-    nTime = nStartTime;\n-    for (uint32_t i = params.nMinerConfirmationWindow - 4; i <= params.nMinerConfirmationWindow; i++) {\n-        lastBlock = firstChain.Mine(params.nMinerConfirmationWindow + i, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+        lastBlock = firstChain.Mine(params.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+        BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\n+        // then we'll keep mining at nStartTime...\n+    } else {\n+        // use a time 1s earlier than start time to check we stay DEFINED\n+        --nTime;\n+\n+        // Start generating blocks before nStartTime\n+        lastBlock = firstChain.Mine(params.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n         BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\n+\n+        // Mine more blocks (4 less than the adjustment period) at the old time, and check that CBV isn't setting the bit yet.\n+        for (uint32_t i = 1; i < params.nMinerConfirmationWindow - 4; i++) {\n+            lastBlock = firstChain.Mine(params.nMinerConfirmationWindow + i, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+            // This works because VERSIONBITS_LAST_OLD_BLOCK_VERSION happens\n+            // to be 4, and the bit we're testing happens to be bit 28.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609061269",
      "id" : 609061269,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTA2MTI2OQ==",
      "original_commit_id" : "754ab11f2085a0c5e417cfbba80cd024fc8ea67a",
      "original_line" : 300,
      "original_position" : 75,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 630578463,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609061269",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/61096?v=4",
         "events_url" : "https://api.github.com/users/harding/events{/privacy}",
         "followers_url" : "https://api.github.com/users/harding/followers",
         "following_url" : "https://api.github.com/users/harding/following{/other_user}",
         "gists_url" : "https://api.github.com/users/harding/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/harding",
         "id" : 61096,
         "login" : "harding",
         "node_id" : "MDQ6VXNlcjYxMDk2",
         "organizations_url" : "https://api.github.com/users/harding/orgs",
         "received_events_url" : "https://api.github.com/users/harding/received_events",
         "repos_url" : "https://api.github.com/users/harding/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/harding/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/harding/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/harding"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609160925"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609160925"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "To make sure that it doesn't blow up when a mainnet deployment is configured with a similarly high min_activation_height and it's tested.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T00:31:23Z",
      "diff_hunk" : "@@ -394,6 +444,16 @@ BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n             check_computeblockversion(chainParams->GetConsensus(), static_cast<Consensus::DeploymentPos>(i));\n         }\n     }\n+\n+    {\n+        // Use regtest/testdummy to ensure we always exercise the\n+        // min_lock_in_time test, even if we're not using that in a\n+        // live deployment\n+        ArgsManager args;\n+        args.ForceSetArg(\"-vbparams\", \"testdummy:1199145601:1230767999:403200\"); // January 1, 2008 - December 31, 2008, min act height 403200",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609160925",
      "id" : 609160925,
      "in_reply_to_id" : 608881332,
      "line" : 465,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTE2MDkyNQ==",
      "original_commit_id" : "e94fc819d8a996ce3690274c307c537329dfb95b",
      "original_line" : 465,
      "original_position" : 183,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 471,
      "pull_request_review_id" : 630888733,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609160925",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609215677"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609215677"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> I'm just concerned about successfully LOCKED_IN then having uasf folks bothered by the backend delay and willingly to fasten activation by tweaking min_activation_height\r\n\r\nI don't think there's any community concerns with the backend delay. Making sure economic majority activates is in everyone's interests.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T02:20:46Z",
      "diff_hunk" : "@@ -29,6 +29,11 @@ struct BIP9Deployment {\n     int64_t nStartTime;\n     /** Timeout/expiry MedianTime for the deployment attempt. */\n     int64_t nTimeout;\n+    /** If lock in occurs, delay activation until at least this block\n+     *  height.  Note that activation will only occur on a retarget\n+     *  boundary.\n+     */\n+    int min_activation_height{0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609215677",
      "id" : 609215677,
      "in_reply_to_id" : 598896420,
      "line" : 36,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTIxNTY3Nw==",
      "original_commit_id" : "85485fb1abb4fc241548fa65c26f7a6f6f6e2423",
      "original_line" : 36,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/consensus/params.h",
      "position" : 8,
      "pull_request_review_id" : 630925413,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609215677",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609215864"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609215864"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The `if (never_active_test)` block at the end asserts both `state` and `exp_state` are always FAILED so that's already covered (likewise for `always_active_test`).\r\n\r\n(This is just a probably-too-clever way of writing `if (!never_active_test) { assert(MTP >= m_end); }`)",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T02:21:03Z",
      "diff_hunk" : "@@ -323,7 +322,7 @@ FUZZ_TARGET_INIT(versionbits, initialize)\n         assert(exp_state == ThresholdState::ACTIVE || exp_state == ThresholdState::LOCKED_IN);\n         break;\n     case ThresholdState::FAILED:\n-        assert(current_block->GetMedianTimePast() >= checker.m_end);\n+        assert(never_active_test || current_block->GetMedianTimePast() >= checker.m_end);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609215864",
      "id" : 609215864,
      "in_reply_to_id" : 608873198,
      "line" : 318,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTIxNTg2NA==",
      "original_commit_id" : "c7008a1a07ae8bd8dfb9c2001a4fdef6e08eb395",
      "original_line" : 318,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/test/fuzz/versionbits.cpp",
      "position" : 99,
      "pull_request_review_id" : 630925517,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609215864",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609219209"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609219209"
         }
      },
      "author_association" : "MEMBER",
      "body" : "why not just return the variable consistently? 0 is fine?",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T02:27:04Z",
      "diff_hunk" : "@@ -1258,6 +1258,9 @@ static void BIP9SoftForkDescPushBack(UniValue& softforks, const std::string &nam\n         statsUV.pushKV(\"possible\", statsStruct.possible);\n         bip9.pushKV(\"statistics\", statsUV);\n     }\n+    if (consensusParams.vDeployments[id].min_activation_height != 0) {\n+        bip9.pushKV(\"min_activation_height\", consensusParams.vDeployments[id].min_activation_height);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609219209",
      "id" : 609219209,
      "in_reply_to_id" : 598900096,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTIxOTIwOQ==",
      "original_commit_id" : "85485fb1abb4fc241548fa65c26f7a6f6f6e2423",
      "original_line" : 1260,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 630927641,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609219209",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609220309"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609220309"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In the context of \"will the next connected block have active X\" the comment seems clear enough to me?",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T02:28:47Z",
      "diff_hunk" : "@@ -74,12 +74,16 @@ ThresholdState AbstractThresholdConditionChecker::GetStateFor(const CBlockIndex*\n                 }\n                 if (count >= nThreshold) {\n                     stateNext = ThresholdState::LOCKED_IN;\n+                } else if (pindexPrev->GetMedianTimePast() >= nTimeTimeout) {\n+                    stateNext = ThresholdState::FAILED;\n                 }\n                 break;\n             }\n             case ThresholdState::LOCKED_IN: {\n-                // Always progresses into ACTIVE.\n-                stateNext = ThresholdState::ACTIVE;\n+                // Progresses into ACTIVE provided activation height will have been reached.\n+                if (pindexPrev->nHeight + 1 >= min_activation_height) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609220309",
      "id" : 609220309,
      "in_reply_to_id" : 608755079,
      "line" : 84,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTIyMDMwOQ==",
      "original_commit_id" : "be7d1368d8e98b6f9f692289b7d25ac369bf2984",
      "original_line" : 84,
      "original_position" : 53,
      "original_start_line" : null,
      "path" : "src/versionbits.cpp",
      "position" : 53,
      "pull_request_review_id" : 630927641,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609220309",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609222402"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609222402"
         }
      },
      "author_association" : "MEMBER",
      "body" : "was `num` never modified before?",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T02:32:58Z",
      "diff_hunk" : "@@ -77,14 +85,18 @@ class VersionBitsTester\n     int num;\n \n public:\n-    VersionBitsTester() : num(0) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609222402",
      "id" : 609222402,
      "line" : 80,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTIyMjQwMg==",
      "original_commit_id" : "e94fc819d8a996ce3690274c307c537329dfb95b",
      "original_line" : 80,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 36,
      "pull_request_review_id" : 630927641,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609222402",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609239397"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609239397"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "There was (and is) a `num++` at the end of `TestState` and `TestStateSinceHeight` ",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T03:06:20Z",
      "diff_hunk" : "@@ -77,14 +85,18 @@ class VersionBitsTester\n     int num;\n \n public:\n-    VersionBitsTester() : num(0) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609239397",
      "id" : 609239397,
      "in_reply_to_id" : 609222402,
      "line" : 80,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTIzOTM5Nw==",
      "original_commit_id" : "e94fc819d8a996ce3690274c307c537329dfb95b",
      "original_line" : 80,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 36,
      "pull_request_review_id" : 630940997,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609239397",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609518002"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609518002"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This comment is a bit stranded. It was previously a comment for the entire function. Perhaps it could be moved up to be a doxygen comment for the function.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T09:47:05Z",
      "diff_hunk" : "@@ -242,81 +275,121 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n     }\n }\n \n-BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n+static void check_computeblockversion(const Consensus::Params& params, Consensus::DeploymentPos dep)\n {\n+    // This implicitly uses versionbitscache, so clear it every time\n+    versionbitscache.Clear();\n+\n     // Check that ComputeBlockVersion will set the appropriate bit correctly",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609518002",
      "id" : 609518002,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTUxODAwMg==",
      "original_commit_id" : "be7d1368d8e98b6f9f692289b7d25ac369bf2984",
      "original_line" : 283,
      "original_position" : 242,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 631193936,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609518002",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609521864"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609521864"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Any reason not to make this more tightly bounded:\r\n\r\n```suggestion\r\n    BOOST_REQUIRE(0 <= bit && bit < 29);\r\n```\r\n\r\nor even:\r\n\r\n```suggestion\r\n    BOOST_REQUIRE(0 <= bit && bit < VERSIONBITS_NUM_BITS);\r\n```",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T09:51:14Z",
      "diff_hunk" : "@@ -242,81 +275,121 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n     }\n }\n \n-BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n+static void check_computeblockversion(const Consensus::Params& params, Consensus::DeploymentPos dep)\n {\n+    // This implicitly uses versionbitscache, so clear it every time\n+    versionbitscache.Clear();\n+\n     // Check that ComputeBlockVersion will set the appropriate bit correctly\n-    // on mainnet.\n-    const auto chainParams = CreateChainParams(*m_node.args, CBaseChainParams::MAIN);\n-    const Consensus::Params &mainnetParams = chainParams->GetConsensus();\n \n-    // Use the TESTDUMMY deployment for testing purposes.\n-    int64_t bit = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].bit;\n-    int64_t nStartTime = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nStartTime;\n-    int64_t nTimeout = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nTimeout;\n+    int64_t bit = params.vDeployments[dep].bit;\n+    int64_t nStartTime = params.vDeployments[dep].nStartTime;\n+    int64_t nTimeout = params.vDeployments[dep].nTimeout;\n+    int min_activation_height = params.vDeployments[dep].min_activation_height;\n \n-    assert(nStartTime < nTimeout);\n+    // should not be any signalling for first block\n+    BOOST_CHECK_EQUAL(ComputeBlockVersion(nullptr, params), VERSIONBITS_TOP_BITS);\n+\n+    // always/never active deployments shouldn't need to be tested further\n+    if (nStartTime == Consensus::BIP9Deployment::ALWAYS_ACTIVE) return;\n+    if (nStartTime == Consensus::BIP9Deployment::NEVER_ACTIVE) return;\n+\n+    BOOST_REQUIRE(nStartTime < nTimeout);\n+    BOOST_REQUIRE(nStartTime >= 0);\n+    BOOST_REQUIRE(nTimeout <= std::numeric_limits<uint32_t>::max() || nTimeout == Consensus::BIP9Deployment::NO_TIMEOUT);\n+    BOOST_REQUIRE(0 <= bit && bit < 32);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609521864",
      "id" : 609521864,
      "line" : 314,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTUyMTg2NA==",
      "original_commit_id" : "be7d1368d8e98b6f9f692289b7d25ac369bf2984",
      "original_line" : 314,
      "original_position" : 267,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 273,
      "pull_request_review_id" : 631193936,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609521864",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609525131"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609525131"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`1 << bit` (or `1<<bit`) is used all over this test. Consider making an alias for readability:\r\n\r\n```\r\n    uint32_t deployment_mask{1 << bit};\r\n```",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T09:55:04Z",
      "diff_hunk" : "@@ -242,81 +275,121 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n     }\n }\n \n-BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n+static void check_computeblockversion(const Consensus::Params& params, Consensus::DeploymentPos dep)\n {\n+    // This implicitly uses versionbitscache, so clear it every time\n+    versionbitscache.Clear();\n+\n     // Check that ComputeBlockVersion will set the appropriate bit correctly\n-    // on mainnet.\n-    const auto chainParams = CreateChainParams(*m_node.args, CBaseChainParams::MAIN);\n-    const Consensus::Params &mainnetParams = chainParams->GetConsensus();\n \n-    // Use the TESTDUMMY deployment for testing purposes.\n-    int64_t bit = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].bit;\n-    int64_t nStartTime = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nStartTime;\n-    int64_t nTimeout = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nTimeout;\n+    int64_t bit = params.vDeployments[dep].bit;\n+    int64_t nStartTime = params.vDeployments[dep].nStartTime;\n+    int64_t nTimeout = params.vDeployments[dep].nTimeout;\n+    int min_activation_height = params.vDeployments[dep].min_activation_height;\n \n-    assert(nStartTime < nTimeout);\n+    // should not be any signalling for first block\n+    BOOST_CHECK_EQUAL(ComputeBlockVersion(nullptr, params), VERSIONBITS_TOP_BITS);\n+\n+    // always/never active deployments shouldn't need to be tested further\n+    if (nStartTime == Consensus::BIP9Deployment::ALWAYS_ACTIVE) return;\n+    if (nStartTime == Consensus::BIP9Deployment::NEVER_ACTIVE) return;\n+\n+    BOOST_REQUIRE(nStartTime < nTimeout);\n+    BOOST_REQUIRE(nStartTime >= 0);\n+    BOOST_REQUIRE(nTimeout <= std::numeric_limits<uint32_t>::max() || nTimeout == Consensus::BIP9Deployment::NO_TIMEOUT);\n+    BOOST_REQUIRE(0 <= bit && bit < 32);\n+    BOOST_REQUIRE(((1 << bit) & VERSIONBITS_TOP_MASK) == 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609525131",
      "id" : 609525131,
      "line" : 315,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTUyNTEzMQ==",
      "original_commit_id" : "be7d1368d8e98b6f9f692289b7d25ac369bf2984",
      "original_line" : 315,
      "original_position" : 268,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 274,
      "pull_request_review_id" : 631193936,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609525131",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609525635"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609525635"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If you're touching this:\r\n\r\n```suggestion\r\n    const CBlockIndex* lastBlock = nullptr;\r\n```",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T09:55:37Z",
      "diff_hunk" : "@@ -242,81 +275,121 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n     }\n }\n \n-BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n+static void check_computeblockversion(const Consensus::Params& params, Consensus::DeploymentPos dep)\n {\n+    // This implicitly uses versionbitscache, so clear it every time\n+    versionbitscache.Clear();\n+\n     // Check that ComputeBlockVersion will set the appropriate bit correctly\n-    // on mainnet.\n-    const auto chainParams = CreateChainParams(*m_node.args, CBaseChainParams::MAIN);\n-    const Consensus::Params &mainnetParams = chainParams->GetConsensus();\n \n-    // Use the TESTDUMMY deployment for testing purposes.\n-    int64_t bit = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].bit;\n-    int64_t nStartTime = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nStartTime;\n-    int64_t nTimeout = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nTimeout;\n+    int64_t bit = params.vDeployments[dep].bit;\n+    int64_t nStartTime = params.vDeployments[dep].nStartTime;\n+    int64_t nTimeout = params.vDeployments[dep].nTimeout;\n+    int min_activation_height = params.vDeployments[dep].min_activation_height;\n \n-    assert(nStartTime < nTimeout);\n+    // should not be any signalling for first block\n+    BOOST_CHECK_EQUAL(ComputeBlockVersion(nullptr, params), VERSIONBITS_TOP_BITS);\n+\n+    // always/never active deployments shouldn't need to be tested further\n+    if (nStartTime == Consensus::BIP9Deployment::ALWAYS_ACTIVE) return;\n+    if (nStartTime == Consensus::BIP9Deployment::NEVER_ACTIVE) return;\n+\n+    BOOST_REQUIRE(nStartTime < nTimeout);\n+    BOOST_REQUIRE(nStartTime >= 0);\n+    BOOST_REQUIRE(nTimeout <= std::numeric_limits<uint32_t>::max() || nTimeout == Consensus::BIP9Deployment::NO_TIMEOUT);\n+    BOOST_REQUIRE(0 <= bit && bit < 32);\n+    BOOST_REQUIRE(((1 << bit) & VERSIONBITS_TOP_MASK) == 0);\n+    BOOST_REQUIRE(min_activation_height >= 0);\n+    BOOST_REQUIRE_EQUAL(min_activation_height % params.nMinerConfirmationWindow, 0);\n \n     // In the first chain, test that the bit is set by CBV until it has failed.\n     // In the second chain, test the bit is set by CBV while STARTED and\n     // LOCKED-IN, and then no longer set while ACTIVE.\n     VersionBitsTester firstChain, secondChain;\n \n-    // Start generating blocks before nStartTime\n-    int64_t nTime = nStartTime - 1;\n+    int64_t nTime = nStartTime;\n+\n+    const CBlockIndex *lastBlock = nullptr;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609525635",
      "id" : 609525635,
      "line" : 326,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTUyNTYzNQ==",
      "original_commit_id" : "be7d1368d8e98b6f9f692289b7d25ac369bf2984",
      "original_line" : 326,
      "original_position" : 281,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 287,
      "pull_request_review_id" : 631193936,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609525635",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609527793"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609527793"
         }
      },
      "author_association" : "MEMBER",
      "body" : "\"the bit we're testing happens to be bit 28.\"\r\n\r\nNot true!",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T09:58:23Z",
      "diff_hunk" : "@@ -242,81 +275,121 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n     }\n }\n \n-BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n+static void check_computeblockversion(const Consensus::Params& params, Consensus::DeploymentPos dep)\n {\n+    // This implicitly uses versionbitscache, so clear it every time\n+    versionbitscache.Clear();\n+\n     // Check that ComputeBlockVersion will set the appropriate bit correctly\n-    // on mainnet.\n-    const auto chainParams = CreateChainParams(*m_node.args, CBaseChainParams::MAIN);\n-    const Consensus::Params &mainnetParams = chainParams->GetConsensus();\n \n-    // Use the TESTDUMMY deployment for testing purposes.\n-    int64_t bit = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].bit;\n-    int64_t nStartTime = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nStartTime;\n-    int64_t nTimeout = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nTimeout;\n+    int64_t bit = params.vDeployments[dep].bit;\n+    int64_t nStartTime = params.vDeployments[dep].nStartTime;\n+    int64_t nTimeout = params.vDeployments[dep].nTimeout;\n+    int min_activation_height = params.vDeployments[dep].min_activation_height;\n \n-    assert(nStartTime < nTimeout);\n+    // should not be any signalling for first block\n+    BOOST_CHECK_EQUAL(ComputeBlockVersion(nullptr, params), VERSIONBITS_TOP_BITS);\n+\n+    // always/never active deployments shouldn't need to be tested further\n+    if (nStartTime == Consensus::BIP9Deployment::ALWAYS_ACTIVE) return;\n+    if (nStartTime == Consensus::BIP9Deployment::NEVER_ACTIVE) return;\n+\n+    BOOST_REQUIRE(nStartTime < nTimeout);\n+    BOOST_REQUIRE(nStartTime >= 0);\n+    BOOST_REQUIRE(nTimeout <= std::numeric_limits<uint32_t>::max() || nTimeout == Consensus::BIP9Deployment::NO_TIMEOUT);\n+    BOOST_REQUIRE(0 <= bit && bit < 32);\n+    BOOST_REQUIRE(((1 << bit) & VERSIONBITS_TOP_MASK) == 0);\n+    BOOST_REQUIRE(min_activation_height >= 0);\n+    BOOST_REQUIRE_EQUAL(min_activation_height % params.nMinerConfirmationWindow, 0);\n \n     // In the first chain, test that the bit is set by CBV until it has failed.\n     // In the second chain, test the bit is set by CBV while STARTED and\n     // LOCKED-IN, and then no longer set while ACTIVE.\n     VersionBitsTester firstChain, secondChain;\n \n-    // Start generating blocks before nStartTime\n-    int64_t nTime = nStartTime - 1;\n+    int64_t nTime = nStartTime;\n+\n+    const CBlockIndex *lastBlock = nullptr;\n \n     // Before MedianTimePast of the chain has crossed nStartTime, the bit\n     // should not be set.\n-    CBlockIndex *lastBlock = nullptr;\n-    lastBlock = firstChain.Mine(mainnetParams.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit), 0);\n-\n-    // Mine more blocks (4 less than the adjustment period) at the old time, and check that CBV isn't setting the bit yet.\n-    for (uint32_t i = 1; i < mainnetParams.nMinerConfirmationWindow - 4; i++) {\n-        lastBlock = firstChain.Mine(mainnetParams.nMinerConfirmationWindow + i, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-        // This works because VERSIONBITS_LAST_OLD_BLOCK_VERSION happens\n-        // to be 4, and the bit we're testing happens to be bit 28.\n-        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit), 0);\n-    }\n-    // Now mine 5 more blocks at the start time -- MTP should not have passed yet, so\n-    // CBV should still not yet set the bit.\n-    nTime = nStartTime;\n-    for (uint32_t i = mainnetParams.nMinerConfirmationWindow - 4; i <= mainnetParams.nMinerConfirmationWindow; i++) {\n-        lastBlock = firstChain.Mine(mainnetParams.nMinerConfirmationWindow + i, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit), 0);\n+    if (nTime == 0) {\n+        // since CBlockIndex::nTime is uint32_t we can't represent any\n+        // earlier time, so will transition from DEFINED to STARTED at the\n+        // end of the first period by mining blocks at nTime == 0\n+        lastBlock = firstChain.Mine(params.nMinerConfirmationWindow - 1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\n+        lastBlock = firstChain.Mine(params.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+        BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\n+        // then we'll keep mining at nStartTime...\n+    } else {\n+        // use a time 1s earlier than start time to check we stay DEFINED\n+        --nTime;\n+\n+        // Start generating blocks before nStartTime\n+        lastBlock = firstChain.Mine(params.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\n+\n+        // Mine more blocks (4 less than the adjustment period) at the old time, and check that CBV isn't setting the bit yet.\n+        for (uint32_t i = 1; i < params.nMinerConfirmationWindow - 4; i++) {\n+            lastBlock = firstChain.Mine(params.nMinerConfirmationWindow + i, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+            // This works because VERSIONBITS_LAST_OLD_BLOCK_VERSION happens\n+            // to be 4, and the bit we're testing happens to be bit 28.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609527793",
      "id" : 609527793,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTUyNzc5Mw==",
      "original_commit_id" : "be7d1368d8e98b6f9f692289b7d25ac369bf2984",
      "original_line" : 337,
      "original_position" : 323,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 631193936,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609527793",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609530120"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609530120"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe mine up to `params.nMinerConfirmationWindow * 3 - 1` here and verify that we stay in DEFINED, and then the next block (below) transitions us to STARTED.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T10:01:17Z",
      "diff_hunk" : "@@ -242,81 +275,121 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n     }\n }\n \n-BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n+static void check_computeblockversion(const Consensus::Params& params, Consensus::DeploymentPos dep)\n {\n+    // This implicitly uses versionbitscache, so clear it every time\n+    versionbitscache.Clear();\n+\n     // Check that ComputeBlockVersion will set the appropriate bit correctly\n-    // on mainnet.\n-    const auto chainParams = CreateChainParams(*m_node.args, CBaseChainParams::MAIN);\n-    const Consensus::Params &mainnetParams = chainParams->GetConsensus();\n \n-    // Use the TESTDUMMY deployment for testing purposes.\n-    int64_t bit = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].bit;\n-    int64_t nStartTime = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nStartTime;\n-    int64_t nTimeout = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nTimeout;\n+    int64_t bit = params.vDeployments[dep].bit;\n+    int64_t nStartTime = params.vDeployments[dep].nStartTime;\n+    int64_t nTimeout = params.vDeployments[dep].nTimeout;\n+    int min_activation_height = params.vDeployments[dep].min_activation_height;\n \n-    assert(nStartTime < nTimeout);\n+    // should not be any signalling for first block\n+    BOOST_CHECK_EQUAL(ComputeBlockVersion(nullptr, params), VERSIONBITS_TOP_BITS);\n+\n+    // always/never active deployments shouldn't need to be tested further\n+    if (nStartTime == Consensus::BIP9Deployment::ALWAYS_ACTIVE) return;\n+    if (nStartTime == Consensus::BIP9Deployment::NEVER_ACTIVE) return;\n+\n+    BOOST_REQUIRE(nStartTime < nTimeout);\n+    BOOST_REQUIRE(nStartTime >= 0);\n+    BOOST_REQUIRE(nTimeout <= std::numeric_limits<uint32_t>::max() || nTimeout == Consensus::BIP9Deployment::NO_TIMEOUT);\n+    BOOST_REQUIRE(0 <= bit && bit < 32);\n+    BOOST_REQUIRE(((1 << bit) & VERSIONBITS_TOP_MASK) == 0);\n+    BOOST_REQUIRE(min_activation_height >= 0);\n+    BOOST_REQUIRE_EQUAL(min_activation_height % params.nMinerConfirmationWindow, 0);\n \n     // In the first chain, test that the bit is set by CBV until it has failed.\n     // In the second chain, test the bit is set by CBV while STARTED and\n     // LOCKED-IN, and then no longer set while ACTIVE.\n     VersionBitsTester firstChain, secondChain;\n \n-    // Start generating blocks before nStartTime\n-    int64_t nTime = nStartTime - 1;\n+    int64_t nTime = nStartTime;\n+\n+    const CBlockIndex *lastBlock = nullptr;\n \n     // Before MedianTimePast of the chain has crossed nStartTime, the bit\n     // should not be set.\n-    CBlockIndex *lastBlock = nullptr;\n-    lastBlock = firstChain.Mine(mainnetParams.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit), 0);\n-\n-    // Mine more blocks (4 less than the adjustment period) at the old time, and check that CBV isn't setting the bit yet.\n-    for (uint32_t i = 1; i < mainnetParams.nMinerConfirmationWindow - 4; i++) {\n-        lastBlock = firstChain.Mine(mainnetParams.nMinerConfirmationWindow + i, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-        // This works because VERSIONBITS_LAST_OLD_BLOCK_VERSION happens\n-        // to be 4, and the bit we're testing happens to be bit 28.\n-        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit), 0);\n-    }\n-    // Now mine 5 more blocks at the start time -- MTP should not have passed yet, so\n-    // CBV should still not yet set the bit.\n-    nTime = nStartTime;\n-    for (uint32_t i = mainnetParams.nMinerConfirmationWindow - 4; i <= mainnetParams.nMinerConfirmationWindow; i++) {\n-        lastBlock = firstChain.Mine(mainnetParams.nMinerConfirmationWindow + i, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit), 0);\n+    if (nTime == 0) {\n+        // since CBlockIndex::nTime is uint32_t we can't represent any\n+        // earlier time, so will transition from DEFINED to STARTED at the\n+        // end of the first period by mining blocks at nTime == 0\n+        lastBlock = firstChain.Mine(params.nMinerConfirmationWindow - 1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\n+        lastBlock = firstChain.Mine(params.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+        BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\n+        // then we'll keep mining at nStartTime...\n+    } else {\n+        // use a time 1s earlier than start time to check we stay DEFINED\n+        --nTime;\n+\n+        // Start generating blocks before nStartTime\n+        lastBlock = firstChain.Mine(params.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\n+\n+        // Mine more blocks (4 less than the adjustment period) at the old time, and check that CBV isn't setting the bit yet.\n+        for (uint32_t i = 1; i < params.nMinerConfirmationWindow - 4; i++) {\n+            lastBlock = firstChain.Mine(params.nMinerConfirmationWindow + i, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+            // This works because VERSIONBITS_LAST_OLD_BLOCK_VERSION happens\n+            // to be 4, and the bit we're testing happens to be bit 28.\n+            BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\n+        }\n+        // Now mine 5 more blocks at the start time -- MTP should not have passed yet, so\n+        // CBV should still not yet set the bit.\n+        nTime = nStartTime;\n+        for (uint32_t i = params.nMinerConfirmationWindow - 4; i <= params.nMinerConfirmationWindow; i++) {\n+            lastBlock = firstChain.Mine(params.nMinerConfirmationWindow + i, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+            BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\n+        }\n+        // Next we will advance to the next period and transition to STARTED,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609530120",
      "id" : 609530120,
      "line" : 359,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTUzMDEyMA==",
      "original_commit_id" : "be7d1368d8e98b6f9f692289b7d25ac369bf2984",
      "original_line" : 359,
      "original_position" : 333,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 337,
      "pull_request_review_id" : 631193936,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609530120",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609536999"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609536999"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's pretty confusing that this test is using these `VersionBitsTester` objects, which have their own activation parameters, but the thing that's actually being tested is the global `versionbitscache` state. In fact, these `VersionBitsTester` objects are only being used for their `Mine()` method. I think this code would be a lot clearer if that was pulled out into a utility function.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T10:09:40Z",
      "diff_hunk" : "@@ -242,81 +275,121 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n     }\n }\n \n-BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n+static void check_computeblockversion(const Consensus::Params& params, Consensus::DeploymentPos dep)\n {\n+    // This implicitly uses versionbitscache, so clear it every time\n+    versionbitscache.Clear();\n+\n     // Check that ComputeBlockVersion will set the appropriate bit correctly\n-    // on mainnet.\n-    const auto chainParams = CreateChainParams(*m_node.args, CBaseChainParams::MAIN);\n-    const Consensus::Params &mainnetParams = chainParams->GetConsensus();\n \n-    // Use the TESTDUMMY deployment for testing purposes.\n-    int64_t bit = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].bit;\n-    int64_t nStartTime = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nStartTime;\n-    int64_t nTimeout = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nTimeout;\n+    int64_t bit = params.vDeployments[dep].bit;\n+    int64_t nStartTime = params.vDeployments[dep].nStartTime;\n+    int64_t nTimeout = params.vDeployments[dep].nTimeout;\n+    int min_activation_height = params.vDeployments[dep].min_activation_height;\n \n-    assert(nStartTime < nTimeout);\n+    // should not be any signalling for first block\n+    BOOST_CHECK_EQUAL(ComputeBlockVersion(nullptr, params), VERSIONBITS_TOP_BITS);\n+\n+    // always/never active deployments shouldn't need to be tested further\n+    if (nStartTime == Consensus::BIP9Deployment::ALWAYS_ACTIVE) return;\n+    if (nStartTime == Consensus::BIP9Deployment::NEVER_ACTIVE) return;\n+\n+    BOOST_REQUIRE(nStartTime < nTimeout);\n+    BOOST_REQUIRE(nStartTime >= 0);\n+    BOOST_REQUIRE(nTimeout <= std::numeric_limits<uint32_t>::max() || nTimeout == Consensus::BIP9Deployment::NO_TIMEOUT);\n+    BOOST_REQUIRE(0 <= bit && bit < 32);\n+    BOOST_REQUIRE(((1 << bit) & VERSIONBITS_TOP_MASK) == 0);\n+    BOOST_REQUIRE(min_activation_height >= 0);\n+    BOOST_REQUIRE_EQUAL(min_activation_height % params.nMinerConfirmationWindow, 0);\n \n     // In the first chain, test that the bit is set by CBV until it has failed.\n     // In the second chain, test the bit is set by CBV while STARTED and\n     // LOCKED-IN, and then no longer set while ACTIVE.\n     VersionBitsTester firstChain, secondChain;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609536999",
      "id" : 609536999,
      "line" : 322,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTUzNjk5OQ==",
      "original_commit_id" : "be7d1368d8e98b6f9f692289b7d25ac369bf2984",
      "original_line" : 322,
      "original_position" : 275,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 281,
      "pull_request_review_id" : 631193936,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609536999",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609557291"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609557291"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Perhaps out of scope here, but I find that the bit masking in these checks is a little difficult to read and detracts from the intent of the test by emphasizing the syntax rather than the meaning. May be worth pulling out the checks into a utility:\r\n\r\n<details>\r\n<summary>diff</summary>\r\n\r\n```diff\r\ndiff --git a/src/test/versionbits_tests.cpp b/src/test/versionbits_tests.cpp\r\nindex 5f53da8aff..f952935e58 100644\r\n--- a/src/test/versionbits_tests.cpp\r\n+++ b/src/test/versionbits_tests.cpp\r\n@@ -275,6 +275,31 @@ BOOST_AUTO_TEST_CASE(versionbits_sanity)\r\n     }\r\n }\r\n \r\n+static bool check_bit_set(const CBlockIndex* lastBlock, const Consensus::Params& params, int64_t bit)\r\n+{\r\n+    if ((ComputeBlockVersion(lastBlock, params) & (1 << bit)) == 0) {\r\n+        BOOST_ERROR(\"version bit not set!\");\r\n+        return false;\r\n+    }\r\n+    if ((ComputeBlockVersion(lastBlock, params) & VERSIONBITS_TOP_MASK) != VERSIONBITS_TOP_BITS) {\r\n+        BOOST_ERROR(\"versionbits top mask not set!\");\r\n+        return false;\r\n+    }\r\n+    return true;\r\n+}\r\n+\r\n+static bool check_bit_unset(const CBlockIndex* lastBlock, const Consensus::Params& params, int64_t bit)\r\n+{\r\n+    if ((ComputeBlockVersion(lastBlock, params) & (1 << bit)) != 0) {\r\n+        BOOST_ERROR(\"version bit set!\");\r\n+        return false;\r\n+    }\r\n+    if ((ComputeBlockVersion(lastBlock, params) & VERSIONBITS_TOP_MASK) != VERSIONBITS_TOP_BITS) {\r\n+        BOOST_ERROR(\"versionbits top mask not set!\");\r\n+        return false;\r\n+    }\r\n+    return true;\r\n+}\r\n static void check_computeblockversion(const Consensus::Params& params, Consensus::DeploymentPos dep)\r\n {\r\n     // This implicitly uses versionbitscache, so clear it every time\r\n@@ -318,9 +343,10 @@ static void check_computeblockversion(const Consensus::Params& params, Consensus\r\n         // earlier time, so will transition from DEFINED to STARTED at the\r\n         // end of the first period by mining blocks at nTime == 0\r\n         lastBlock = firstChain.Mine(params.nMinerConfirmationWindow - 1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\r\n-        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\r\n+        BOOST_CHECK(check_bit_unset(lastBlock, params, bit));\r\n+\r\n         lastBlock = firstChain.Mine(params.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\r\n-        BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\r\n+        BOOST_CHECK(check_bit_set(lastBlock, params, bit));\r\n         // then we'll keep mining at nStartTime...\r\n     } else {\r\n         // use a time 1s earlier than start time to check we stay DEFINED\r\n@@ -328,30 +354,28 @@ static void check_computeblockversion(const Consensus::Params& params, Consensus\r\n \r\n         // Start generating blocks before nStartTime\r\n         lastBlock = firstChain.Mine(params.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\r\n-        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\r\n+        BOOST_CHECK(check_bit_unset(lastBlock, params, bit));\r\n \r\n         // Mine more blocks (4 less than the adjustment period) at the old time, and check that CBV isn't setting the bit yet.\r\n         for (uint32_t i = 1; i < params.nMinerConfirmationWindow - 4; i++) {\r\n             lastBlock = firstChain.Mine(params.nMinerConfirmationWindow + i, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\r\n             // This works because VERSIONBITS_LAST_OLD_BLOCK_VERSION happens\r\n             // to be 4, and the bit we're testing happens to be bit 28.\r\n-            BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\r\n+            BOOST_CHECK(check_bit_unset(lastBlock, params, bit));\r\n         }\r\n         // Now mine 5 more blocks at the start time -- MTP should not have passed yet, so\r\n         // CBV should still not yet set the bit.\r\n         nTime = nStartTime;\r\n         for (uint32_t i = params.nMinerConfirmationWindow - 4; i <= params.nMinerConfirmationWindow; i++) {\r\n             lastBlock = firstChain.Mine(params.nMinerConfirmationWindow + i, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\r\n-            BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\r\n+            BOOST_CHECK(check_bit_unset(lastBlock, params, bit));\r\n         }\r\n         // Next we will advance to the next period and transition to STARTED,\r\n     }\r\n \r\n     lastBlock = firstChain.Mine(params.nMinerConfirmationWindow * 3, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\r\n     // so ComputeBlockVersion should now set the bit,\r\n-    BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\r\n-    // and should also be using the VERSIONBITS_TOP_BITS.\r\n-    BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & VERSIONBITS_TOP_MASK, VERSIONBITS_TOP_BITS);\r\n+    BOOST_CHECK(check_bit_set(lastBlock, params, bit));\r\n \r\n     // Check that ComputeBlockVersion will set the bit until nTimeout\r\n     nTime += 600;\r\n@@ -360,8 +384,7 @@ static void check_computeblockversion(const Consensus::Params& params, Consensus\r\n     // These blocks are all before nTimeout is reached.\r\n     while (nTime < nTimeout && blocksToMine > 0) {\r\n         lastBlock = firstChain.Mine(nHeight+1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\r\n-        BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\r\n-        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & VERSIONBITS_TOP_MASK, VERSIONBITS_TOP_BITS);\r\n+        BOOST_CHECK(check_bit_set(lastBlock, params, bit));\r\n         blocksToMine--;\r\n         nTime += 600;\r\n         nHeight += 1;\r\n@@ -375,7 +398,7 @@ static void check_computeblockversion(const Consensus::Params& params, Consensus\r\n         // finish the last period before we start timing out\r\n         while (nHeight % params.nMinerConfirmationWindow != 0) {\r\n             lastBlock = firstChain.Mine(nHeight+1, nTime - 1, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\r\n-            BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\r\n+            BOOST_CHECK(check_bit_set(lastBlock, params, bit));\r\n             nHeight += 1;\r\n         }\r\n \r\n@@ -383,12 +406,12 @@ static void check_computeblockversion(const Consensus::Params& params, Consensus\r\n         // the bit until the period transition.\r\n         for (uint32_t i = 0; i < params.nMinerConfirmationWindow - 1; i++) {\r\n             lastBlock = firstChain.Mine(nHeight+1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\r\n-            BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\r\n+            BOOST_CHECK(check_bit_set(lastBlock, params, bit));\r\n             nHeight += 1;\r\n         }\r\n         // The next block should trigger no longer setting the bit.\r\n         lastBlock = firstChain.Mine(nHeight+1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\r\n-        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\r\n+        BOOST_CHECK(check_bit_unset(lastBlock, params, bit));\r\n     }\r\n \r\n     // On a new chain:\r\n@@ -399,25 +422,26 @@ static void check_computeblockversion(const Consensus::Params& params, Consensus\r\n     // Mine one period worth of blocks, and check that the bit will be on for the\r\n     // next period.\r\n     lastBlock = secondChain.Mine(params.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\r\n-    BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\r\n+    BOOST_CHECK(check_bit_set(lastBlock, params, bit));\r\n \r\n     // Mine another period worth of blocks, signaling the new bit.\r\n     lastBlock = secondChain.Mine(params.nMinerConfirmationWindow * 2, nTime, VERSIONBITS_TOP_BITS | (1<<bit)).Tip();\r\n     // After one period of setting the bit on each block, it should have locked in.\r\n     // We keep setting the bit for one more period though, until activation.\r\n-    BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\r\n+    BOOST_CHECK(check_bit_set(lastBlock, params, bit));\r\n \r\n     // Now check that we keep mining the block until the end of this period, and\r\n     // then stop at the beginning of the next period.\r\n     lastBlock = secondChain.Mine((params.nMinerConfirmationWindow * 3) - 1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\r\n-    BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1 << bit)) != 0);\r\n+    BOOST_CHECK(check_bit_set(lastBlock, params, bit));\r\n+\r\n     lastBlock = secondChain.Mine(params.nMinerConfirmationWindow * 3, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\r\n \r\n     if (lastBlock->nHeight + 1 < min_activation_height) {\r\n         lastBlock = secondChain.Mine(min_activation_height, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\r\n     }\r\n \r\n-    BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\r\n+    BOOST_CHECK(check_bit_unset(lastBlock, params, bit));\r\n }\r\n```\r\n\r\n</details>",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T10:37:57Z",
      "diff_hunk" : "@@ -242,81 +275,121 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n     }\n }\n \n-BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n+static void check_computeblockversion(const Consensus::Params& params, Consensus::DeploymentPos dep)\n {\n+    // This implicitly uses versionbitscache, so clear it every time\n+    versionbitscache.Clear();\n+\n     // Check that ComputeBlockVersion will set the appropriate bit correctly\n-    // on mainnet.\n-    const auto chainParams = CreateChainParams(*m_node.args, CBaseChainParams::MAIN);\n-    const Consensus::Params &mainnetParams = chainParams->GetConsensus();\n \n-    // Use the TESTDUMMY deployment for testing purposes.\n-    int64_t bit = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].bit;\n-    int64_t nStartTime = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nStartTime;\n-    int64_t nTimeout = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nTimeout;\n+    int64_t bit = params.vDeployments[dep].bit;\n+    int64_t nStartTime = params.vDeployments[dep].nStartTime;\n+    int64_t nTimeout = params.vDeployments[dep].nTimeout;\n+    int min_activation_height = params.vDeployments[dep].min_activation_height;\n \n-    assert(nStartTime < nTimeout);\n+    // should not be any signalling for first block\n+    BOOST_CHECK_EQUAL(ComputeBlockVersion(nullptr, params), VERSIONBITS_TOP_BITS);\n+\n+    // always/never active deployments shouldn't need to be tested further\n+    if (nStartTime == Consensus::BIP9Deployment::ALWAYS_ACTIVE) return;\n+    if (nStartTime == Consensus::BIP9Deployment::NEVER_ACTIVE) return;\n+\n+    BOOST_REQUIRE(nStartTime < nTimeout);\n+    BOOST_REQUIRE(nStartTime >= 0);\n+    BOOST_REQUIRE(nTimeout <= std::numeric_limits<uint32_t>::max() || nTimeout == Consensus::BIP9Deployment::NO_TIMEOUT);\n+    BOOST_REQUIRE(0 <= bit && bit < 32);\n+    BOOST_REQUIRE(((1 << bit) & VERSIONBITS_TOP_MASK) == 0);\n+    BOOST_REQUIRE(min_activation_height >= 0);\n+    BOOST_REQUIRE_EQUAL(min_activation_height % params.nMinerConfirmationWindow, 0);\n \n     // In the first chain, test that the bit is set by CBV until it has failed.\n     // In the second chain, test the bit is set by CBV while STARTED and\n     // LOCKED-IN, and then no longer set while ACTIVE.\n     VersionBitsTester firstChain, secondChain;\n \n-    // Start generating blocks before nStartTime\n-    int64_t nTime = nStartTime - 1;\n+    int64_t nTime = nStartTime;\n+\n+    const CBlockIndex *lastBlock = nullptr;\n \n     // Before MedianTimePast of the chain has crossed nStartTime, the bit\n     // should not be set.\n-    CBlockIndex *lastBlock = nullptr;\n-    lastBlock = firstChain.Mine(mainnetParams.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit), 0);\n-\n-    // Mine more blocks (4 less than the adjustment period) at the old time, and check that CBV isn't setting the bit yet.\n-    for (uint32_t i = 1; i < mainnetParams.nMinerConfirmationWindow - 4; i++) {\n-        lastBlock = firstChain.Mine(mainnetParams.nMinerConfirmationWindow + i, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-        // This works because VERSIONBITS_LAST_OLD_BLOCK_VERSION happens\n-        // to be 4, and the bit we're testing happens to be bit 28.\n-        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit), 0);\n-    }\n-    // Now mine 5 more blocks at the start time -- MTP should not have passed yet, so\n-    // CBV should still not yet set the bit.\n-    nTime = nStartTime;\n-    for (uint32_t i = mainnetParams.nMinerConfirmationWindow - 4; i <= mainnetParams.nMinerConfirmationWindow; i++) {\n-        lastBlock = firstChain.Mine(mainnetParams.nMinerConfirmationWindow + i, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit), 0);\n+    if (nTime == 0) {\n+        // since CBlockIndex::nTime is uint32_t we can't represent any\n+        // earlier time, so will transition from DEFINED to STARTED at the\n+        // end of the first period by mining blocks at nTime == 0\n+        lastBlock = firstChain.Mine(params.nMinerConfirmationWindow - 1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609557291",
      "id" : 609557291,
      "line" : 335,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTU1NzI5MQ==",
      "original_commit_id" : "be7d1368d8e98b6f9f692289b7d25ac369bf2984",
      "original_line" : 335,
      "original_position" : 307,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 313,
      "pull_request_review_id" : 631193936,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609557291",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609558206"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609558206"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe worth splitting this function in two?",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T10:39:32Z",
      "diff_hunk" : "@@ -242,81 +275,121 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n     }\n }\n \n-BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n+static void check_computeblockversion(const Consensus::Params& params, Consensus::DeploymentPos dep)\n {\n+    // This implicitly uses versionbitscache, so clear it every time\n+    versionbitscache.Clear();\n+\n     // Check that ComputeBlockVersion will set the appropriate bit correctly\n-    // on mainnet.\n-    const auto chainParams = CreateChainParams(*m_node.args, CBaseChainParams::MAIN);\n-    const Consensus::Params &mainnetParams = chainParams->GetConsensus();\n \n-    // Use the TESTDUMMY deployment for testing purposes.\n-    int64_t bit = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].bit;\n-    int64_t nStartTime = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nStartTime;\n-    int64_t nTimeout = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nTimeout;\n+    int64_t bit = params.vDeployments[dep].bit;\n+    int64_t nStartTime = params.vDeployments[dep].nStartTime;\n+    int64_t nTimeout = params.vDeployments[dep].nTimeout;\n+    int min_activation_height = params.vDeployments[dep].min_activation_height;\n \n-    assert(nStartTime < nTimeout);\n+    // should not be any signalling for first block\n+    BOOST_CHECK_EQUAL(ComputeBlockVersion(nullptr, params), VERSIONBITS_TOP_BITS);\n+\n+    // always/never active deployments shouldn't need to be tested further\n+    if (nStartTime == Consensus::BIP9Deployment::ALWAYS_ACTIVE) return;\n+    if (nStartTime == Consensus::BIP9Deployment::NEVER_ACTIVE) return;\n+\n+    BOOST_REQUIRE(nStartTime < nTimeout);\n+    BOOST_REQUIRE(nStartTime >= 0);\n+    BOOST_REQUIRE(nTimeout <= std::numeric_limits<uint32_t>::max() || nTimeout == Consensus::BIP9Deployment::NO_TIMEOUT);\n+    BOOST_REQUIRE(0 <= bit && bit < 32);\n+    BOOST_REQUIRE(((1 << bit) & VERSIONBITS_TOP_MASK) == 0);\n+    BOOST_REQUIRE(min_activation_height >= 0);\n+    BOOST_REQUIRE_EQUAL(min_activation_height % params.nMinerConfirmationWindow, 0);\n \n     // In the first chain, test that the bit is set by CBV until it has failed.\n     // In the second chain, test the bit is set by CBV while STARTED and\n     // LOCKED-IN, and then no longer set while ACTIVE.\n     VersionBitsTester firstChain, secondChain;\n \n-    // Start generating blocks before nStartTime\n-    int64_t nTime = nStartTime - 1;\n+    int64_t nTime = nStartTime;\n+\n+    const CBlockIndex *lastBlock = nullptr;\n \n     // Before MedianTimePast of the chain has crossed nStartTime, the bit\n     // should not be set.\n-    CBlockIndex *lastBlock = nullptr;\n-    lastBlock = firstChain.Mine(mainnetParams.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit), 0);\n-\n-    // Mine more blocks (4 less than the adjustment period) at the old time, and check that CBV isn't setting the bit yet.\n-    for (uint32_t i = 1; i < mainnetParams.nMinerConfirmationWindow - 4; i++) {\n-        lastBlock = firstChain.Mine(mainnetParams.nMinerConfirmationWindow + i, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-        // This works because VERSIONBITS_LAST_OLD_BLOCK_VERSION happens\n-        // to be 4, and the bit we're testing happens to be bit 28.\n-        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit), 0);\n-    }\n-    // Now mine 5 more blocks at the start time -- MTP should not have passed yet, so\n-    // CBV should still not yet set the bit.\n-    nTime = nStartTime;\n-    for (uint32_t i = mainnetParams.nMinerConfirmationWindow - 4; i <= mainnetParams.nMinerConfirmationWindow; i++) {\n-        lastBlock = firstChain.Mine(mainnetParams.nMinerConfirmationWindow + i, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit), 0);\n+    if (nTime == 0) {\n+        // since CBlockIndex::nTime is uint32_t we can't represent any\n+        // earlier time, so will transition from DEFINED to STARTED at the\n+        // end of the first period by mining blocks at nTime == 0\n+        lastBlock = firstChain.Mine(params.nMinerConfirmationWindow - 1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\n+        lastBlock = firstChain.Mine(params.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+        BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\n+        // then we'll keep mining at nStartTime...\n+    } else {\n+        // use a time 1s earlier than start time to check we stay DEFINED\n+        --nTime;\n+\n+        // Start generating blocks before nStartTime\n+        lastBlock = firstChain.Mine(params.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\n+\n+        // Mine more blocks (4 less than the adjustment period) at the old time, and check that CBV isn't setting the bit yet.\n+        for (uint32_t i = 1; i < params.nMinerConfirmationWindow - 4; i++) {\n+            lastBlock = firstChain.Mine(params.nMinerConfirmationWindow + i, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+            // This works because VERSIONBITS_LAST_OLD_BLOCK_VERSION happens\n+            // to be 4, and the bit we're testing happens to be bit 28.\n+            BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\n+        }\n+        // Now mine 5 more blocks at the start time -- MTP should not have passed yet, so\n+        // CBV should still not yet set the bit.\n+        nTime = nStartTime;\n+        for (uint32_t i = params.nMinerConfirmationWindow - 4; i <= params.nMinerConfirmationWindow; i++) {\n+            lastBlock = firstChain.Mine(params.nMinerConfirmationWindow + i, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+            BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\n+        }\n+        // Next we will advance to the next period and transition to STARTED,\n     }\n \n-    // Advance to the next period and transition to STARTED,\n-    lastBlock = firstChain.Mine(mainnetParams.nMinerConfirmationWindow * 3, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+    lastBlock = firstChain.Mine(params.nMinerConfirmationWindow * 3, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n     // so ComputeBlockVersion should now set the bit,\n-    BOOST_CHECK((ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit)) != 0);\n+    BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\n     // and should also be using the VERSIONBITS_TOP_BITS.\n-    BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & VERSIONBITS_TOP_MASK, VERSIONBITS_TOP_BITS);\n+    BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & VERSIONBITS_TOP_MASK, VERSIONBITS_TOP_BITS);\n \n     // Check that ComputeBlockVersion will set the bit until nTimeout\n     nTime += 600;\n-    uint32_t blocksToMine = mainnetParams.nMinerConfirmationWindow * 2; // test blocks for up to 2 time periods\n-    uint32_t nHeight = mainnetParams.nMinerConfirmationWindow * 3;\n+    uint32_t blocksToMine = params.nMinerConfirmationWindow * 2; // test blocks for up to 2 time periods\n+    uint32_t nHeight = params.nMinerConfirmationWindow * 3;\n     // These blocks are all before nTimeout is reached.\n     while (nTime < nTimeout && blocksToMine > 0) {\n         lastBlock = firstChain.Mine(nHeight+1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-        BOOST_CHECK((ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit)) != 0);\n-        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & VERSIONBITS_TOP_MASK, VERSIONBITS_TOP_BITS);\n+        BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\n+        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & VERSIONBITS_TOP_MASK, VERSIONBITS_TOP_BITS);\n         blocksToMine--;\n         nTime += 600;\n         nHeight += 1;\n     }\n \n-    nTime = nTimeout;\n-    // FAILED is only triggered at the end of a period, so CBV should be setting\n-    // the bit until the period transition.\n-    for (uint32_t i = 0; i < mainnetParams.nMinerConfirmationWindow - 1; i++) {\n+    if (nTimeout != Consensus::BIP9Deployment::NO_TIMEOUT) {\n+        // cannot reach NO_TIMEOUT a uint32_t\n+\n+        nTime = nTimeout;\n+\n+        // finish the last period before we start timing out\n+        while (nHeight % params.nMinerConfirmationWindow != 0) {\n+            lastBlock = firstChain.Mine(nHeight+1, nTime - 1, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+            BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\n+            nHeight += 1;\n+        }\n+\n+        // FAILED is only triggered at the end of a period, so CBV should be setting\n+        // the bit until the period transition.\n+        for (uint32_t i = 0; i < params.nMinerConfirmationWindow - 1; i++) {\n+            lastBlock = firstChain.Mine(nHeight+1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+            BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\n+            nHeight += 1;\n+        }\n+        // The next block should trigger no longer setting the bit.\n         lastBlock = firstChain.Mine(nHeight+1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-        BOOST_CHECK((ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit)) != 0);\n-        nHeight += 1;\n+        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\n     }\n-    // The next block should trigger no longer setting the bit.\n-    lastBlock = firstChain.Mine(nHeight+1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit), 0);\n \n     // On a new chain:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609558206",
      "id" : 609558206,
      "line" : 406,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTU1ODIwNg==",
      "original_commit_id" : "be7d1368d8e98b6f9f692289b7d25ac369bf2984",
      "original_line" : 406,
      "original_position" : 397,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 401,
      "pull_request_review_id" : 631193936,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609558206",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609562526"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609562526"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        // min_activation_height test, even if we're not using that in a\r\n```",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T10:45:22Z",
      "diff_hunk" : "@@ -325,26 +398,57 @@ BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n \n     // Mine one period worth of blocks, and check that the bit will be on for the\n     // next period.\n-    lastBlock = secondChain.Mine(mainnetParams.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK((ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit)) != 0);\n+    lastBlock = secondChain.Mine(params.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+    BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\n \n     // Mine another period worth of blocks, signaling the new bit.\n-    lastBlock = secondChain.Mine(mainnetParams.nMinerConfirmationWindow * 2, nTime, VERSIONBITS_TOP_BITS | (1<<bit)).Tip();\n+    lastBlock = secondChain.Mine(params.nMinerConfirmationWindow * 2, nTime, VERSIONBITS_TOP_BITS | (1<<bit)).Tip();\n     // After one period of setting the bit on each block, it should have locked in.\n     // We keep setting the bit for one more period though, until activation.\n-    BOOST_CHECK((ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit)) != 0);\n+    BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\n \n     // Now check that we keep mining the block until the end of this period, and\n     // then stop at the beginning of the next period.\n-    lastBlock = secondChain.Mine((mainnetParams.nMinerConfirmationWindow * 3) - 1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK((ComputeBlockVersion(lastBlock, mainnetParams) & (1 << bit)) != 0);\n-    lastBlock = secondChain.Mine(mainnetParams.nMinerConfirmationWindow * 3, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit), 0);\n-\n-    // Finally, verify that after a soft fork has activated, CBV no longer uses\n-    // VERSIONBITS_LAST_OLD_BLOCK_VERSION.\n-    //BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & VERSIONBITS_TOP_MASK, VERSIONBITS_TOP_BITS);\n+    lastBlock = secondChain.Mine((params.nMinerConfirmationWindow * 3) - 1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+    BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1 << bit)) != 0);\n+    lastBlock = secondChain.Mine(params.nMinerConfirmationWindow * 3, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+\n+    if (lastBlock->nHeight + 1 < min_activation_height) {\n+        lastBlock = secondChain.Mine(min_activation_height, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+    }\n+\n+    BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\n }\n \n+BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n+{\n+    // check that any deployment on any chain can conceivably reach both\n+    // ACTIVE and FAILED states in roughly the way we expect\n+    for (const auto& chain_name : {CBaseChainParams::MAIN, CBaseChainParams::TESTNET, CBaseChainParams::SIGNET, CBaseChainParams::REGTEST}) {\n+        const auto chainParams = CreateChainParams(*m_node.args, chain_name);\n+        for (int i = 0; i < (int)Consensus::MAX_VERSION_BITS_DEPLOYMENTS; ++i) {\n+            check_computeblockversion(chainParams->GetConsensus(), static_cast<Consensus::DeploymentPos>(i));\n+        }\n+    }\n+\n+    {\n+        // Use regtest/testdummy to ensure we always exercise some\n+        // deployment that's not always/never active\n+        ArgsManager args;\n+        args.ForceSetArg(\"-vbparams\", \"testdummy:1199145601:1230767999\"); // January 1, 2008 - December 31, 2008\n+        const auto chainParams = CreateChainParams(args, CBaseChainParams::REGTEST);\n+        check_computeblockversion(chainParams->GetConsensus(), Consensus::DEPLOYMENT_TESTDUMMY);\n+    }\n+\n+    {\n+        // Use regtest/testdummy to ensure we always exercise the\n+        // min_lock_in_time test, even if we're not using that in a",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609562526",
      "id" : 609562526,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTU2MjUyNg==",
      "original_commit_id" : "be7d1368d8e98b6f9f692289b7d25ac369bf2984",
      "original_line" : 445,
      "original_position" : 459,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 631193936,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609562526",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609583897"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609583897"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Perhaps explicitly define `MinActivationHeight()` in the base `TestConditionChecker` class?",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T11:14:25Z",
      "diff_hunk" : "@@ -44,6 +44,12 @@ class TestConditionChecker : public AbstractThresholdConditionChecker\n     int GetStateSinceHeightFor(const CBlockIndex* pindexPrev) const { return AbstractThresholdConditionChecker::GetStateSinceHeightFor(pindexPrev, paramsDummy, cache); }\n };\n \n+class TestDelayedActivationConditionChecker : public TestConditionChecker\n+{\n+public:\n+    int MinActivationHeight(const Consensus::Params& params) const override { return 15000; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609583897",
      "id" : 609583897,
      "line" : 50,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTU4Mzg5Nw==",
      "original_commit_id" : "be7d1368d8e98b6f9f692289b7d25ac369bf2984",
      "original_line" : 50,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 7,
      "pull_request_review_id" : 631193936,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609583897",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609584779"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609584779"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe clearer to split this into `test_group` and `test_index` rather than have some magic 1000 value.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T11:15:36Z",
      "diff_hunk" : "@@ -77,14 +84,18 @@ class VersionBitsTester\n     int num;\n \n public:\n-    VersionBitsTester() : num(0) {}\n+    VersionBitsTester() : num(1000) {}\n \n     VersionBitsTester& Reset() {\n+        // Have each group of tests be counted by the 1000s part, starting at 1000\n+        num = num - (num % 1000) + 1000;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609584779",
      "id" : 609584779,
      "line" : 91,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTU4NDc3OQ==",
      "original_commit_id" : "be7d1368d8e98b6f9f692289b7d25ac369bf2984",
      "original_line" : 91,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 41,
      "pull_request_review_id" : 631193936,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609584779",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609585080"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609585080"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If you're touching this, might as well set `num` to have default initialization and remove the empty ctor.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T11:16:00Z",
      "diff_hunk" : "@@ -77,14 +84,18 @@ class VersionBitsTester\n     int num;\n \n public:\n-    VersionBitsTester() : num(0) {}\n+    VersionBitsTester() : num(1000) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609585080",
      "id" : 609585080,
      "line" : 87,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTU4NTA4MA==",
      "original_commit_id" : "be7d1368d8e98b6f9f692289b7d25ac369bf2984",
      "original_line" : 87,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 37,
      "pull_request_review_id" : 631193936,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609585080",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609591457"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609591457"
         }
      },
      "author_association" : "MEMBER",
      "body" : "There could be a test here that the bit continues to be signaled for multiple LOCKED_IN periods.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T11:25:17Z",
      "diff_hunk" : "@@ -325,26 +398,57 @@ BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n \n     // Mine one period worth of blocks, and check that the bit will be on for the\n     // next period.\n-    lastBlock = secondChain.Mine(mainnetParams.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK((ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit)) != 0);\n+    lastBlock = secondChain.Mine(params.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+    BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\n \n     // Mine another period worth of blocks, signaling the new bit.\n-    lastBlock = secondChain.Mine(mainnetParams.nMinerConfirmationWindow * 2, nTime, VERSIONBITS_TOP_BITS | (1<<bit)).Tip();\n+    lastBlock = secondChain.Mine(params.nMinerConfirmationWindow * 2, nTime, VERSIONBITS_TOP_BITS | (1<<bit)).Tip();\n     // After one period of setting the bit on each block, it should have locked in.\n     // We keep setting the bit for one more period though, until activation.\n-    BOOST_CHECK((ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit)) != 0);\n+    BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\n \n     // Now check that we keep mining the block until the end of this period, and\n     // then stop at the beginning of the next period.\n-    lastBlock = secondChain.Mine((mainnetParams.nMinerConfirmationWindow * 3) - 1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK((ComputeBlockVersion(lastBlock, mainnetParams) & (1 << bit)) != 0);\n-    lastBlock = secondChain.Mine(mainnetParams.nMinerConfirmationWindow * 3, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit), 0);\n-\n-    // Finally, verify that after a soft fork has activated, CBV no longer uses\n-    // VERSIONBITS_LAST_OLD_BLOCK_VERSION.\n-    //BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & VERSIONBITS_TOP_MASK, VERSIONBITS_TOP_BITS);\n+    lastBlock = secondChain.Mine((params.nMinerConfirmationWindow * 3) - 1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+    BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1 << bit)) != 0);\n+    lastBlock = secondChain.Mine(params.nMinerConfirmationWindow * 3, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+\n+    if (lastBlock->nHeight + 1 < min_activation_height) {\n+        lastBlock = secondChain.Mine(min_activation_height, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609591457",
      "id" : 609591457,
      "line" : 433,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTU5MTQ1Nw==",
      "original_commit_id" : "be7d1368d8e98b6f9f692289b7d25ac369bf2984",
      "original_line" : 433,
      "original_position" : 431,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 439,
      "pull_request_review_id" : 631193936,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609591457",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609613832"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609613832"
         }
      },
      "author_association" : "MEMBER",
      "body" : "What's the reason for this change (7000->8000)?",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T11:53:31Z",
      "diff_hunk" : "@@ -214,10 +235,15 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n                            .Mine(3000, TestTime(10000), 0).TestStarted().TestStateSinceHeight(3000)\n                            .Mine(4000, TestTime(10000), 0).TestStarted().TestStateSinceHeight(3000)\n                            .Mine(5000, TestTime(10000), 0).TestStarted().TestStateSinceHeight(3000)\n+                           .Mine(5999, TestTime(20000), 0).TestStarted().TestStateSinceHeight(3000)\n                            .Mine(6000, TestTime(20000), 0).TestFailed().TestStateSinceHeight(6000)\n-                           .Mine(7000, TestTime(20000), 0x100).TestFailed().TestStateSinceHeight(6000);\n+                           .Mine(8000, TestTime(20000), 0x100).TestFailed().TestStateSinceHeight(6000)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609613832",
      "id" : 609613832,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTYxMzgzMg==",
      "original_commit_id" : "be7d1368d8e98b6f9f692289b7d25ac369bf2984",
      "original_line" : 240,
      "original_position" : 208,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 631193936,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609613832",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "From @maaku on [using block height versus a mix of block height and MTP](https://github.com/bitcoin/bitcoin/pull/21393#issuecomment-815698514). Understandably he doesn't want to be involved. \r\n\r\n\"Segwit activation exposed a number of problems with the BIP9 activation state machine which was based on MTP windows. These concerns include:\r\n\r\nDifficulty of interfacing with in-parallel activation mechanisms like BIP148, BIP91, or the presumed future LOT=true UASF for taproot. (You may not like UASF. You may be against UASF and wish is never happened. Well reality doesn't care. There will be a UASF client, that is simply a fact. That cat is out of the bag. Our job is to make sure that UASF risks are minimized for the sake of the network, which height-based activation mechanisms do better. I'm not saying MTP can't be UASF compatible, I'm just saying it's way easier to avoid foot-gunning a UASF deployment with height-based windows. And while your inner schadenfreude might laugh at a UASF foot-gun, such a chain-splitting failure affects everyone.)\r\n\r\nPerverse timestamp-manipulation incentives for miners, who can use timestamp manipulation to slow or speed up MTP to delay or speed up the closing of an activation window. People rely on accurate MTP timestamps for things like lock times, and of course it affects difficulty adjustments, and so it is very bad for there to be incentives for miners to manipulate timestamps.\r\n\r\nTwo-week uncertainty over activation window start or end times based on alignment of 2016-block window with calendar dates. Makes it very difficult for people to schedule travel or events around a single likely activation date (+/- a day or two). This affects not just activation parties (which is a silly reason IMHO, even more so in the midst of a pandemic), but also mining and infrastructure organizations which will want staff at hand in case there are activation issues.\r\n\r\nBIP8 was specifically created to codify our lessons learned from activating segwit into a new activation protocol to be used in the next soft-fork. It got significant review 4 years ago and in the time since, and was strengthened by that review. There is no way that some new state machine for MTP-based activation could receive the same amount of review in the speedy trial timeline. We should use the reviewed mechanisms that are already in place (or very nearly so) and which incorporate lessons learned. If you think there are flaws in BIP8(LOT=false), then start working now on an alternative activation mechanism for the next soft-fork.\r\n\r\nEvery single one of the above points has been made on the mailing list or in relevant Github discussions. I don't think that any of them have been adequately addressed by MTP advocates. For example, pointing out that \"timewarp could cause more uncertainty than +/- 2 weeks\" ignores a few facts: (1) timewarp is NOT a normal condition and would itself be seen as an attack on the network; (2) timewarp would require the coordination of more miners than it would take to block taproot anyway; and (3) having monotonically decreasing estimation error without a two-week floor is critical to scheduling needs.\r\n\r\nI think many of us who were involved in that prior work that went into segwit lessons learned and BIP8 review are sitting around dumbfounded and speechless at what has happened. What is the point of doing all that advanced planning if it's immediately thrown away precisely when it is needed? I'm not surprised if Luke-Jr and Jorge seem obstinate on this. They've invested literally years on this problem so that we'd have a solution when it is needed, as it is now, and getting buy-in from the developers at the time... only to have all that casually thrown away. (Because of a freaking coin flip?)\"",
      "created_at" : "2021-04-08T12:30:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-815763961",
      "id" : 815763961,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxNTc2Mzk2MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-08T12:32:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/815763961",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/16323900?v=4",
         "events_url" : "https://api.github.com/users/michaelfolkson/events{/privacy}",
         "followers_url" : "https://api.github.com/users/michaelfolkson/followers",
         "following_url" : "https://api.github.com/users/michaelfolkson/following{/other_user}",
         "gists_url" : "https://api.github.com/users/michaelfolkson/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/michaelfolkson",
         "id" : 16323900,
         "login" : "michaelfolkson",
         "node_id" : "MDQ6VXNlcjE2MzIzOTAw",
         "organizations_url" : "https://api.github.com/users/michaelfolkson/orgs",
         "received_events_url" : "https://api.github.com/users/michaelfolkson/received_events",
         "repos_url" : "https://api.github.com/users/michaelfolkson/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/michaelfolkson/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/michaelfolkson/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/michaelfolkson"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609701806"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609701806"
         }
      },
      "author_association" : "MEMBER",
      "body" : "tests pass without this change included fwiw",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T13:29:48Z",
      "diff_hunk" : "@@ -214,10 +235,15 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n                            .Mine(3000, TestTime(10000), 0).TestStarted().TestStateSinceHeight(3000)\n                            .Mine(4000, TestTime(10000), 0).TestStarted().TestStateSinceHeight(3000)\n                            .Mine(5000, TestTime(10000), 0).TestStarted().TestStateSinceHeight(3000)\n+                           .Mine(5999, TestTime(20000), 0).TestStarted().TestStateSinceHeight(3000)\n                            .Mine(6000, TestTime(20000), 0).TestFailed().TestStateSinceHeight(6000)\n-                           .Mine(7000, TestTime(20000), 0x100).TestFailed().TestStateSinceHeight(6000);\n+                           .Mine(8000, TestTime(20000), 0x100).TestFailed().TestStateSinceHeight(6000)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609701806",
      "id" : 609701806,
      "in_reply_to_id" : 609613832,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTcwMTgwNg==",
      "original_commit_id" : "be7d1368d8e98b6f9f692289b7d25ac369bf2984",
      "original_line" : 240,
      "original_position" : 208,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 631396027,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609701806",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609711796"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609711796"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It's already checked via `BOOST_REQUIRE(((1 << bit) & VERSIONBITS_TOP_MASK) == 0);` -- the \"requires\" are there because the later checks will break if these aren't true; if it were possible for `bit` to be  `NUM_BITS` or greater, but not clash with `TOP_MASK` the other tests would be fine.\r\n\r\n(I had also thought `versionbits_sanity` was checking the bit was in `[0, NUM_BITS)` so didn't \"duplicate\" the test here, but it's not actually doing that -- perhaps I saw that in some patch implementing BIP320)",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T13:39:11Z",
      "diff_hunk" : "@@ -242,81 +275,121 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n     }\n }\n \n-BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n+static void check_computeblockversion(const Consensus::Params& params, Consensus::DeploymentPos dep)\n {\n+    // This implicitly uses versionbitscache, so clear it every time\n+    versionbitscache.Clear();\n+\n     // Check that ComputeBlockVersion will set the appropriate bit correctly\n-    // on mainnet.\n-    const auto chainParams = CreateChainParams(*m_node.args, CBaseChainParams::MAIN);\n-    const Consensus::Params &mainnetParams = chainParams->GetConsensus();\n \n-    // Use the TESTDUMMY deployment for testing purposes.\n-    int64_t bit = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].bit;\n-    int64_t nStartTime = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nStartTime;\n-    int64_t nTimeout = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nTimeout;\n+    int64_t bit = params.vDeployments[dep].bit;\n+    int64_t nStartTime = params.vDeployments[dep].nStartTime;\n+    int64_t nTimeout = params.vDeployments[dep].nTimeout;\n+    int min_activation_height = params.vDeployments[dep].min_activation_height;\n \n-    assert(nStartTime < nTimeout);\n+    // should not be any signalling for first block\n+    BOOST_CHECK_EQUAL(ComputeBlockVersion(nullptr, params), VERSIONBITS_TOP_BITS);\n+\n+    // always/never active deployments shouldn't need to be tested further\n+    if (nStartTime == Consensus::BIP9Deployment::ALWAYS_ACTIVE) return;\n+    if (nStartTime == Consensus::BIP9Deployment::NEVER_ACTIVE) return;\n+\n+    BOOST_REQUIRE(nStartTime < nTimeout);\n+    BOOST_REQUIRE(nStartTime >= 0);\n+    BOOST_REQUIRE(nTimeout <= std::numeric_limits<uint32_t>::max() || nTimeout == Consensus::BIP9Deployment::NO_TIMEOUT);\n+    BOOST_REQUIRE(0 <= bit && bit < 32);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609711796",
      "id" : 609711796,
      "in_reply_to_id" : 609521864,
      "line" : 314,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTcxMTc5Ng==",
      "original_commit_id" : "be7d1368d8e98b6f9f692289b7d25ac369bf2984",
      "original_line" : 314,
      "original_position" : 267,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 273,
      "pull_request_review_id" : 631406834,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609711796",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609716734"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609716734"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It gives it two periods in FAILED that are signalling instead of one to give it plenty of time to decide to switch to some other state if there's some bug that allows transitions out of FAILED. (If it were to go out of FAILED and back again, the StateSinceHeight check should catch that)",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T13:44:02Z",
      "diff_hunk" : "@@ -214,10 +235,15 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n                            .Mine(3000, TestTime(10000), 0).TestStarted().TestStateSinceHeight(3000)\n                            .Mine(4000, TestTime(10000), 0).TestStarted().TestStateSinceHeight(3000)\n                            .Mine(5000, TestTime(10000), 0).TestStarted().TestStateSinceHeight(3000)\n+                           .Mine(5999, TestTime(20000), 0).TestStarted().TestStateSinceHeight(3000)\n                            .Mine(6000, TestTime(20000), 0).TestFailed().TestStateSinceHeight(6000)\n-                           .Mine(7000, TestTime(20000), 0x100).TestFailed().TestStateSinceHeight(6000);\n+                           .Mine(8000, TestTime(20000), 0x100).TestFailed().TestStateSinceHeight(6000)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609716734",
      "id" : 609716734,
      "in_reply_to_id" : 609613832,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTcxNjczNA==",
      "original_commit_id" : "be7d1368d8e98b6f9f692289b7d25ac369bf2984",
      "original_line" : 240,
      "original_position" : 208,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 631412480,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609716734",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609719668"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609719668"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think there are plenty of things that could be a lot clearer in versionbits in general, and would like to start doing those refactors later, in PRs that don't have a need to be backported. So intending to leave these more general improvements for then -- please do remind when I forget!",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T13:46:50Z",
      "diff_hunk" : "@@ -242,81 +275,121 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n     }\n }\n \n-BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n+static void check_computeblockversion(const Consensus::Params& params, Consensus::DeploymentPos dep)\n {\n+    // This implicitly uses versionbitscache, so clear it every time\n+    versionbitscache.Clear();\n+\n     // Check that ComputeBlockVersion will set the appropriate bit correctly\n-    // on mainnet.\n-    const auto chainParams = CreateChainParams(*m_node.args, CBaseChainParams::MAIN);\n-    const Consensus::Params &mainnetParams = chainParams->GetConsensus();\n \n-    // Use the TESTDUMMY deployment for testing purposes.\n-    int64_t bit = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].bit;\n-    int64_t nStartTime = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nStartTime;\n-    int64_t nTimeout = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nTimeout;\n+    int64_t bit = params.vDeployments[dep].bit;\n+    int64_t nStartTime = params.vDeployments[dep].nStartTime;\n+    int64_t nTimeout = params.vDeployments[dep].nTimeout;\n+    int min_activation_height = params.vDeployments[dep].min_activation_height;\n \n-    assert(nStartTime < nTimeout);\n+    // should not be any signalling for first block\n+    BOOST_CHECK_EQUAL(ComputeBlockVersion(nullptr, params), VERSIONBITS_TOP_BITS);\n+\n+    // always/never active deployments shouldn't need to be tested further\n+    if (nStartTime == Consensus::BIP9Deployment::ALWAYS_ACTIVE) return;\n+    if (nStartTime == Consensus::BIP9Deployment::NEVER_ACTIVE) return;\n+\n+    BOOST_REQUIRE(nStartTime < nTimeout);\n+    BOOST_REQUIRE(nStartTime >= 0);\n+    BOOST_REQUIRE(nTimeout <= std::numeric_limits<uint32_t>::max() || nTimeout == Consensus::BIP9Deployment::NO_TIMEOUT);\n+    BOOST_REQUIRE(0 <= bit && bit < 32);\n+    BOOST_REQUIRE(((1 << bit) & VERSIONBITS_TOP_MASK) == 0);\n+    BOOST_REQUIRE(min_activation_height >= 0);\n+    BOOST_REQUIRE_EQUAL(min_activation_height % params.nMinerConfirmationWindow, 0);\n \n     // In the first chain, test that the bit is set by CBV until it has failed.\n     // In the second chain, test the bit is set by CBV while STARTED and\n     // LOCKED-IN, and then no longer set while ACTIVE.\n     VersionBitsTester firstChain, secondChain;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609719668",
      "id" : 609719668,
      "in_reply_to_id" : 609536999,
      "line" : 322,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTcxOTY2OA==",
      "original_commit_id" : "be7d1368d8e98b6f9f692289b7d25ac369bf2984",
      "original_line" : 322,
      "original_position" : 275,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 281,
      "pull_request_review_id" : 631415771,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609719668",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609728435"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609728435"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit ccfe854884276fbdd2ddbcc65689dbd3306f6332 \"versionbits: simplify state transitions\"\r\n\r\nIf I restore the logic to go straight to FAILED here, the unit tests don't complain.  I didn't try with the fuzz tester.  Maybe a chance to expand the tests here?",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T13:55:29Z",
      "diff_hunk" : "@@ -57,18 +57,12 @@ ThresholdState AbstractThresholdConditionChecker::GetStateFor(const CBlockIndex*\n \n         switch (state) {\n             case ThresholdState::DEFINED: {\n-                if (pindexPrev->GetMedianTimePast() >= nTimeTimeout) {\n-                    stateNext = ThresholdState::FAILED;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609728435",
      "id" : 609728435,
      "line" : 55,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTcyODQzNQ==",
      "original_commit_id" : "ccfe854884276fbdd2ddbcc65689dbd3306f6332",
      "original_line" : 55,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/versionbits.cpp",
      "position" : 25,
      "pull_request_review_id" : 630578463,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609728435",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/61096?v=4",
         "events_url" : "https://api.github.com/users/harding/events{/privacy}",
         "followers_url" : "https://api.github.com/users/harding/followers",
         "following_url" : "https://api.github.com/users/harding/following{/other_user}",
         "gists_url" : "https://api.github.com/users/harding/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/harding",
         "id" : 61096,
         "login" : "harding",
         "node_id" : "MDQ6VXNlcjYxMDk2",
         "organizations_url" : "https://api.github.com/users/harding/orgs",
         "received_events_url" : "https://api.github.com/users/harding/received_events",
         "repos_url" : "https://api.github.com/users/harding/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/harding/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/harding/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/harding"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609742049"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609742049"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'll commit to reviewing those PRs -- please remind me if I forget to do that :)",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T14:08:31Z",
      "diff_hunk" : "@@ -242,81 +275,121 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n     }\n }\n \n-BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n+static void check_computeblockversion(const Consensus::Params& params, Consensus::DeploymentPos dep)\n {\n+    // This implicitly uses versionbitscache, so clear it every time\n+    versionbitscache.Clear();\n+\n     // Check that ComputeBlockVersion will set the appropriate bit correctly\n-    // on mainnet.\n-    const auto chainParams = CreateChainParams(*m_node.args, CBaseChainParams::MAIN);\n-    const Consensus::Params &mainnetParams = chainParams->GetConsensus();\n \n-    // Use the TESTDUMMY deployment for testing purposes.\n-    int64_t bit = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].bit;\n-    int64_t nStartTime = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nStartTime;\n-    int64_t nTimeout = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nTimeout;\n+    int64_t bit = params.vDeployments[dep].bit;\n+    int64_t nStartTime = params.vDeployments[dep].nStartTime;\n+    int64_t nTimeout = params.vDeployments[dep].nTimeout;\n+    int min_activation_height = params.vDeployments[dep].min_activation_height;\n \n-    assert(nStartTime < nTimeout);\n+    // should not be any signalling for first block\n+    BOOST_CHECK_EQUAL(ComputeBlockVersion(nullptr, params), VERSIONBITS_TOP_BITS);\n+\n+    // always/never active deployments shouldn't need to be tested further\n+    if (nStartTime == Consensus::BIP9Deployment::ALWAYS_ACTIVE) return;\n+    if (nStartTime == Consensus::BIP9Deployment::NEVER_ACTIVE) return;\n+\n+    BOOST_REQUIRE(nStartTime < nTimeout);\n+    BOOST_REQUIRE(nStartTime >= 0);\n+    BOOST_REQUIRE(nTimeout <= std::numeric_limits<uint32_t>::max() || nTimeout == Consensus::BIP9Deployment::NO_TIMEOUT);\n+    BOOST_REQUIRE(0 <= bit && bit < 32);\n+    BOOST_REQUIRE(((1 << bit) & VERSIONBITS_TOP_MASK) == 0);\n+    BOOST_REQUIRE(min_activation_height >= 0);\n+    BOOST_REQUIRE_EQUAL(min_activation_height % params.nMinerConfirmationWindow, 0);\n \n     // In the first chain, test that the bit is set by CBV until it has failed.\n     // In the second chain, test the bit is set by CBV while STARTED and\n     // LOCKED-IN, and then no longer set while ACTIVE.\n     VersionBitsTester firstChain, secondChain;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609742049",
      "id" : 609742049,
      "in_reply_to_id" : 609536999,
      "line" : 322,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTc0MjA0OQ==",
      "original_commit_id" : "be7d1368d8e98b6f9f692289b7d25ac369bf2984",
      "original_line" : 322,
      "original_position" : 275,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 281,
      "pull_request_review_id" : 631442045,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609742049",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609746692"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609746692"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Seems reasonable, although it may be worth explicitly commenting that:\r\n\r\n```diff\r\ndiff --git a/src/test/versionbits_tests.cpp b/src/test/versionbits_tests.cpp\r\nindex 5f53da8aff..19bf3f948f 100644\r\n--- a/src/test/versionbits_tests.cpp\r\n+++ b/src/test/versionbits_tests.cpp\r\n@@ -237,7 +237,8 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\r\n                            .Mine(5000, TestTime(10000), 0).TestStarted().TestStateSinceHeight(3000)\r\n                            .Mine(5999, TestTime(20000), 0).TestStarted().TestStateSinceHeight(3000)\r\n                            .Mine(6000, TestTime(20000), 0).TestFailed().TestStateSinceHeight(6000)\r\n-                           .Mine(8000, TestTime(20000), 0x100).TestFailed().TestStateSinceHeight(6000)\r\n+                           .Mine(7000, TestTime(20000), 0x100).TestFailed().TestStateSinceHeight(6000)\r\n+                           .Mine(8000, TestTime(20000), 0x100).TestFailed().TestStateSinceHeight(6000) // Make sure we don't transition out of FAILED\r\n         ;\r\n     }\r\n }\r\n```",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T14:13:09Z",
      "diff_hunk" : "@@ -214,10 +235,15 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n                            .Mine(3000, TestTime(10000), 0).TestStarted().TestStateSinceHeight(3000)\n                            .Mine(4000, TestTime(10000), 0).TestStarted().TestStateSinceHeight(3000)\n                            .Mine(5000, TestTime(10000), 0).TestStarted().TestStateSinceHeight(3000)\n+                           .Mine(5999, TestTime(20000), 0).TestStarted().TestStateSinceHeight(3000)\n                            .Mine(6000, TestTime(20000), 0).TestFailed().TestStateSinceHeight(6000)\n-                           .Mine(7000, TestTime(20000), 0x100).TestFailed().TestStateSinceHeight(6000);\n+                           .Mine(8000, TestTime(20000), 0x100).TestFailed().TestStateSinceHeight(6000)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609746692",
      "id" : 609746692,
      "in_reply_to_id" : 609613832,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTc0NjY5Mg==",
      "original_commit_id" : "be7d1368d8e98b6f9f692289b7d25ac369bf2984",
      "original_line" : 240,
      "original_position" : 208,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 631447714,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609746692",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609769760"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609769760"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes this needs coverage. I was unable to coax any other phony successful tests by modifying relevant changes in the code.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T14:35:17Z",
      "diff_hunk" : "@@ -57,18 +57,12 @@ ThresholdState AbstractThresholdConditionChecker::GetStateFor(const CBlockIndex*\n \n         switch (state) {\n             case ThresholdState::DEFINED: {\n-                if (pindexPrev->GetMedianTimePast() >= nTimeTimeout) {\n-                    stateNext = ThresholdState::FAILED;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609769760",
      "id" : 609769760,
      "in_reply_to_id" : 609728435,
      "line" : 55,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTc2OTc2MA==",
      "original_commit_id" : "ccfe854884276fbdd2ddbcc65689dbd3306f6332",
      "original_line" : 55,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/versionbits.cpp",
      "position" : 25,
      "pull_request_review_id" : 631475115,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609769760",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609810008"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609810008"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good catch! I think this oughta do it:\r\n\r\n```diff\r\ndiff --git a/src/test/versionbits_tests.cpp b/src/test/versionbits_tests.cpp\r\nindex 5f53da8aff..57d9f1bedf 100644\r\n--- a/src/test/versionbits_tests.cpp\r\n+++ b/src/test/versionbits_tests.cpp\r\n@@ -200,6 +200,15 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\r\n                            .Mine(3000, TestTime(20000), 0).TestFailed().TestStateSinceHeight(3000) // 50 old blocks (so 899 out of the past 1000)\r\n                            .Mine(4000, TestTime(20010), 0x100).TestFailed().TestStateSinceHeight(3000)\r\n \r\n+        // DEFINED -> STARTED after timeout reached -> FAILED\r\n+                           .Reset().TestDefined().TestStateSinceHeight(0)\r\n+                           .Mine(1, TestTime(1), 0).TestDefined().TestStateSinceHeight(0)\r\n+                           .Mine(1000, TestTime(10000) - 1, 0x100).TestDefined().TestStateSinceHeight(0) // One second more and it would be started\r\n+                           .Mine(1999, TestTime(20000), 0).TestDefined().TestStateSinceHeight(0) // Still not started\r\n+                           .Mine(2000, TestTime(20000), 0).TestStarted().TestStateSinceHeight(2000) // Skip straight to the timeout MTP. We guarantee one period of started\r\n+                           .Mine(2999, TestTime(30000), 0).TestStarted().TestStateSinceHeight(2000) // 999 new blocks\r\n+                           .Mine(3000, TestTime(30000), 0).TestFailed().TestStateSinceHeight(3000) // ... and fail\r\n+\r\n         // DEFINED -> STARTED -> LOCKEDIN after timeout reached -> ACTIVE\r\n                            .Reset().TestDefined().TestStateSinceHeight(0)\r\n                            .Mine(1, TestTime(1), 0).TestDefined().TestStateSinceHeight(0)\r\n```",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T15:14:06Z",
      "diff_hunk" : "@@ -57,18 +57,12 @@ ThresholdState AbstractThresholdConditionChecker::GetStateFor(const CBlockIndex*\n \n         switch (state) {\n             case ThresholdState::DEFINED: {\n-                if (pindexPrev->GetMedianTimePast() >= nTimeTimeout) {\n-                    stateNext = ThresholdState::FAILED;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609810008",
      "id" : 609810008,
      "in_reply_to_id" : 609728435,
      "line" : 55,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTgxMDAwOA==",
      "original_commit_id" : "ccfe854884276fbdd2ddbcc65689dbd3306f6332",
      "original_line" : 55,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/versionbits.cpp",
      "position" : 25,
      "pull_request_review_id" : 631522625,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609810008",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609938756"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609938756"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I :+1: the sentiment that it's confusing, but think it's clear enough in this case.\r\n\r\nIn #21392 there were a lot of examples of `pindexPrev->nHeight + 1 < min_activation_height` which I wanted documented better. Despite being the negation, is a lot harder to understand when the transition was happening because it was in states with multiple possible transitions, and the clause was guarding a state transition that becomes *impossible* rather than one that becomes *possible*. As such, even if this code contained an off-by-one error in the logic, it would only result in one additional period of LOCKED_IN as opposed to a failure to activate.\r\n\r\nThat said, there's no off-by-one error here AFAICT :)",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T17:33:55Z",
      "diff_hunk" : "@@ -74,12 +74,16 @@ ThresholdState AbstractThresholdConditionChecker::GetStateFor(const CBlockIndex*\n                 }\n                 if (count >= nThreshold) {\n                     stateNext = ThresholdState::LOCKED_IN;\n+                } else if (pindexPrev->GetMedianTimePast() >= nTimeTimeout) {\n+                    stateNext = ThresholdState::FAILED;\n                 }\n                 break;\n             }\n             case ThresholdState::LOCKED_IN: {\n-                // Always progresses into ACTIVE.\n-                stateNext = ThresholdState::ACTIVE;\n+                // Progresses into ACTIVE provided activation height will have been reached.\n+                if (pindexPrev->nHeight + 1 >= min_activation_height) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609938756",
      "id" : 609938756,
      "in_reply_to_id" : 608755079,
      "line" : 84,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTkzODc1Ng==",
      "original_commit_id" : "be7d1368d8e98b6f9f692289b7d25ac369bf2984",
      "original_line" : 84,
      "original_position" : 53,
      "original_start_line" : null,
      "path" : "src/versionbits.cpp",
      "position" : 53,
      "pull_request_review_id" : 631667143,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609938756",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609941607"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609941607"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Noting that MinActivationHeight=0, even though it is a height, is easily compatible with any Signet MTP configuration activation parameters (it's just disabling the delay between locked-in and active, which is OK for a signet since it is managed by a signer anyways).",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T17:37:17Z",
      "diff_hunk" : "@@ -57,6 +57,7 @@ class AbstractThresholdConditionChecker {\n     virtual bool Condition(const CBlockIndex* pindex, const Consensus::Params& params) const =0;\n     virtual int64_t BeginTime(const Consensus::Params& params) const =0;\n     virtual int64_t EndTime(const Consensus::Params& params) const =0;\n+    virtual int MinActivationHeight(const Consensus::Params& params) const { return 0; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609941607",
      "id" : 609941607,
      "in_reply_to_id" : 598589081,
      "line" : 60,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTk0MTYwNw==",
      "original_commit_id" : "85485fb1abb4fc241548fa65c26f7a6f6f6e2423",
      "original_line" : 60,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/versionbits.h",
      "position" : 13,
      "pull_request_review_id" : 631670361,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609941607",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609955206"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609955206"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Noting that this check is required before computing on the bit (https://en.cppreference.com/w/cpp/language/operator_arithmetic):\r\n\r\n> In any case, if the value of the right operand is negative or is greater or equal to the number of bits in the promoted left operand, the behavior is undefined. \r\n\r\nThis also impacts where, if taken, https://github.com/bitcoin/bitcoin/pull/21377/commits/754ab11f2085a0c5e417cfbba80cd024fc8ea67a#r609525131 should be created.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T17:52:48Z",
      "diff_hunk" : "@@ -242,81 +275,121 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n     }\n }\n \n-BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n+static void check_computeblockversion(const Consensus::Params& params, Consensus::DeploymentPos dep)\n {\n+    // This implicitly uses versionbitscache, so clear it every time\n+    versionbitscache.Clear();\n+\n     // Check that ComputeBlockVersion will set the appropriate bit correctly\n-    // on mainnet.\n-    const auto chainParams = CreateChainParams(*m_node.args, CBaseChainParams::MAIN);\n-    const Consensus::Params &mainnetParams = chainParams->GetConsensus();\n \n-    // Use the TESTDUMMY deployment for testing purposes.\n-    int64_t bit = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].bit;\n-    int64_t nStartTime = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nStartTime;\n-    int64_t nTimeout = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nTimeout;\n+    int64_t bit = params.vDeployments[dep].bit;\n+    int64_t nStartTime = params.vDeployments[dep].nStartTime;\n+    int64_t nTimeout = params.vDeployments[dep].nTimeout;\n+    int min_activation_height = params.vDeployments[dep].min_activation_height;\n \n-    assert(nStartTime < nTimeout);\n+    // should not be any signalling for first block\n+    BOOST_CHECK_EQUAL(ComputeBlockVersion(nullptr, params), VERSIONBITS_TOP_BITS);\n+\n+    // always/never active deployments shouldn't need to be tested further\n+    if (nStartTime == Consensus::BIP9Deployment::ALWAYS_ACTIVE) return;\n+    if (nStartTime == Consensus::BIP9Deployment::NEVER_ACTIVE) return;\n+\n+    BOOST_REQUIRE(nStartTime < nTimeout);\n+    BOOST_REQUIRE(nStartTime >= 0);\n+    BOOST_REQUIRE(nTimeout <= std::numeric_limits<uint32_t>::max() || nTimeout == Consensus::BIP9Deployment::NO_TIMEOUT);\n+    BOOST_REQUIRE(0 <= bit && bit < 32);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609955206",
      "id" : 609955206,
      "in_reply_to_id" : 609521864,
      "line" : 314,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTk1NTIwNg==",
      "original_commit_id" : "be7d1368d8e98b6f9f692289b7d25ac369bf2984",
      "original_line" : 314,
      "original_position" : 267,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 273,
      "pull_request_review_id" : 631683707,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609955206",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609964911"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609964911"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think this is also desirable in the future in certain circumstances, and unlikely to be an issue for ST.\r\n\r\n1) For ST: The time is *really short*. Backing it up after lock in would be unfair to smaller miners (< 10% total hash) who need more time to upgrade, so it would run counter to norms...\r\n2) In the future: it would be possible to do a Long-Range-Activation, e.g. a ST but with min_active_height far in the future (e.g., 2 years). Once it is locked in, then developers can start working on broader ecosystem support & wallet software integration knowing when it will be available. Once that seems ready, it is a soft-fork to decrease the min_height in a future release (but it still should be signalled for, but even if it isn't decreasing it is just a flag day soft fork, not hard fork AFAIU). I think that sounds like too much unnecessary fuss, but I _could_ imagine it being used.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T18:04:01Z",
      "diff_hunk" : "@@ -29,6 +29,11 @@ struct BIP9Deployment {\n     int64_t nStartTime;\n     /** Timeout/expiry MedianTime for the deployment attempt. */\n     int64_t nTimeout;\n+    /** If lock in occurs, delay activation until at least this block\n+     *  height.  Note that activation will only occur on a retarget\n+     *  boundary.\n+     */\n+    int min_activation_height{0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609964911",
      "id" : 609964911,
      "in_reply_to_id" : 598896420,
      "line" : 36,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTk2NDkxMQ==",
      "original_commit_id" : "85485fb1abb4fc241548fa65c26f7a6f6f6e2423",
      "original_line" : 36,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/consensus/params.h",
      "position" : 8,
      "pull_request_review_id" : 631693396,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609964911",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609967118"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609967118"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : ":+1:  -- may as well always return it rather than having client software infer a value from absence.\r\n\r\nThis can be handled in a follow up PR IMO (which cleans up the BIP9 naming too, since we've diverged)",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T18:07:21Z",
      "diff_hunk" : "@@ -1258,6 +1258,9 @@ static void BIP9SoftForkDescPushBack(UniValue& softforks, const std::string &nam\n         statsUV.pushKV(\"possible\", statsStruct.possible);\n         bip9.pushKV(\"statistics\", statsUV);\n     }\n+    if (consensusParams.vDeployments[id].min_activation_height != 0) {\n+        bip9.pushKV(\"min_activation_height\", consensusParams.vDeployments[id].min_activation_height);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609967118",
      "id" : 609967118,
      "in_reply_to_id" : 598900096,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTk2NzExOA==",
      "original_commit_id" : "85485fb1abb4fc241548fa65c26f7a6f6f6e2423",
      "original_line" : 1260,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 631696171,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609967118",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609976108"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609976108"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Could be done, personally indifferent -- the main difference between why the others are explicit in `TestConditionChecker` and `MinActivationHeight` is not is that `MinActivationHeight` is defined to have a sane default function, whereas the others are not.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T18:17:40Z",
      "diff_hunk" : "@@ -44,6 +44,12 @@ class TestConditionChecker : public AbstractThresholdConditionChecker\n     int GetStateSinceHeightFor(const CBlockIndex* pindexPrev) const { return AbstractThresholdConditionChecker::GetStateSinceHeightFor(pindexPrev, paramsDummy, cache); }\n };\n \n+class TestDelayedActivationConditionChecker : public TestConditionChecker\n+{\n+public:\n+    int MinActivationHeight(const Consensus::Params& params) const override { return 15000; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609976108",
      "id" : 609976108,
      "in_reply_to_id" : 609583897,
      "line" : 50,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTk3NjEwOA==",
      "original_commit_id" : "be7d1368d8e98b6f9f692289b7d25ac369bf2984",
      "original_line" : 50,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 7,
      "pull_request_review_id" : 631704694,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609976108",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609979407"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609979407"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Should we not use 700000+? I can't see what would change between the two values, but if the goal is realism (maybe it runs too slowly :) )",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-08T18:21:24Z",
      "diff_hunk" : "@@ -394,6 +444,16 @@ BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n             check_computeblockversion(chainParams->GetConsensus(), static_cast<Consensus::DeploymentPos>(i));\n         }\n     }\n+\n+    {\n+        // Use regtest/testdummy to ensure we always exercise the\n+        // min_lock_in_time test, even if we're not using that in a\n+        // live deployment\n+        ArgsManager args;\n+        args.ForceSetArg(\"-vbparams\", \"testdummy:1199145601:1230767999:403200\"); // January 1, 2008 - December 31, 2008, min act height 403200",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r609979407",
      "id" : 609979407,
      "in_reply_to_id" : 608881332,
      "line" : 465,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwOTk3OTQwNw==",
      "original_commit_id" : "e94fc819d8a996ce3690274c307c537329dfb95b",
      "original_line" : 465,
      "original_position" : 183,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 471,
      "pull_request_review_id" : 631707777,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/609979407",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "CR-ACK be7d1368d8e98b6f9f692289b7d25ac369bf2984\r\n\r\n\r\nWill put some additional effort into futzing with the fuzzers and regtests and stuff before a tAck. Seems like there are some fuzzing edge cases that need better coverage, but overall looks great (and those can be added  as follow on commits).",
      "created_at" : "2021-04-08T18:32:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-816047040",
      "id" : 816047040,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxNjA0NzA0MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-08T18:32:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/816047040",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "It might be useful to adapt the functional tests from #21392 to BIP9. I made a _very_ rudimentary start here: https://github.com/Sjors/bitcoin/commits/2021/04/bip9_speedy_test",
      "created_at" : "2021-04-08T19:02:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-816070158",
      "id" : 816070158,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxNjA3MDE1OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-08T19:02:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/816070158",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611256065"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611256065"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "One way to manually run the fuzz tests without running fuzzing is something like this:\r\n\r\n```sh\r\nls ../../../qa-assets/fuzz_seed_corpus/versionbits/* --sort=s -r | \r\nwhile read a; do \r\n  if ! FUZZ=versionbits test/fuzz/fuzz < $a; then\r\n    echo $a;\r\n    echo 'base64:' $(base64 < $a);\r\n    break;\r\n  fi;\r\ndone\r\n```\r\n\r\n(that runs the versionbits fuzzer using the qa-assets seed corpus, in order of smallest seed to largest, and prints out the filename of the first failing seed; assumes you're in src/ already)\r\n\r\nWhen I run that with the DEFINED condition changed to `if (GetMedianTimePast >= nTimeTimeout) stateNext = FAILED; else if (GetMedianTimePast >= nTimeStart) stateNext = STARTED;`, I get:\r\n\r\n```\r\nfuzz: test/fuzz/versionbits.cpp:322: void (anonymous namespace)::versionbits_fuzz_target(FuzzBufferType): Assertion `exp_state == ThresholdState::FAILED' failed.\r\n../../../qa-assets/fuzz_seed_corpus/versionbits/ed29b8233d29abb3e0398be2221b9bdb8623daf6\r\nbase64: /5SUlL29vb29va0Axr3y\r\n```\r\n\r\nIf you don't want to download the [qa-assets repo](https://github.com/bitcoin-core/qa-assets/), you should be able to duplicate that specific error with `echo '/5SUlL29vb29va0Axr3y' | base64 -d | FUZZ=versionbits test/fuzz/fuzz`",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-11T22:43:01Z",
      "diff_hunk" : "@@ -57,18 +57,12 @@ ThresholdState AbstractThresholdConditionChecker::GetStateFor(const CBlockIndex*\n \n         switch (state) {\n             case ThresholdState::DEFINED: {\n-                if (pindexPrev->GetMedianTimePast() >= nTimeTimeout) {\n-                    stateNext = ThresholdState::FAILED;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611256065",
      "id" : 611256065,
      "in_reply_to_id" : 609728435,
      "line" : 55,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTI1NjA2NQ==",
      "original_commit_id" : "ccfe854884276fbdd2ddbcc65689dbd3306f6332",
      "original_line" : 55,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/versionbits.cpp",
      "position" : 25,
      "pull_request_review_id" : 633061012,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611256065",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611259210"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611259210"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oh, I later setup fuzz testing but I didn't come back to check this.  I've done that just now using libFuzz and I can confirm it quickly finds this deliberately-introduced problem.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-11T23:11:52Z",
      "diff_hunk" : "@@ -57,18 +57,12 @@ ThresholdState AbstractThresholdConditionChecker::GetStateFor(const CBlockIndex*\n \n         switch (state) {\n             case ThresholdState::DEFINED: {\n-                if (pindexPrev->GetMedianTimePast() >= nTimeTimeout) {\n-                    stateNext = ThresholdState::FAILED;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611259210",
      "id" : 611259210,
      "in_reply_to_id" : 609728435,
      "line" : 55,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTI1OTIxMA==",
      "original_commit_id" : "ccfe854884276fbdd2ddbcc65689dbd3306f6332",
      "original_line" : 55,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/versionbits.cpp",
      "position" : 25,
      "pull_request_review_id" : 633063538,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611259210",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/61096?v=4",
         "events_url" : "https://api.github.com/users/harding/events{/privacy}",
         "followers_url" : "https://api.github.com/users/harding/followers",
         "following_url" : "https://api.github.com/users/harding/following{/other_user}",
         "gists_url" : "https://api.github.com/users/harding/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/harding",
         "id" : 61096,
         "login" : "harding",
         "node_id" : "MDQ6VXNlcjYxMDk2",
         "organizations_url" : "https://api.github.com/users/harding/orgs",
         "received_events_url" : "https://api.github.com/users/harding/received_events",
         "repos_url" : "https://api.github.com/users/harding/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/harding/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/harding/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/harding"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611260422"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611260422"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think that justification is only relevant if ComputeBlockVersion would return LAST_OLD_BLOCK_VERSION when not setting a bit, but that logic was removed before 7575 was even merged; https://github.com/bitcoin/bitcoin/pull/7575#discussion-diff-54153581 and https://github.com/bitcoin/bitcoin/pull/7575#discussion-diff-55125020 are the relevant discussion points, I think. So the comment's never been relevant.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-11T23:22:06Z",
      "diff_hunk" : "@@ -242,81 +275,121 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n     }\n }\n \n-BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n+static void check_computeblockversion(const Consensus::Params& params, Consensus::DeploymentPos dep)\n {\n+    // This implicitly uses versionbitscache, so clear it every time\n+    versionbitscache.Clear();\n+\n     // Check that ComputeBlockVersion will set the appropriate bit correctly\n-    // on mainnet.\n-    const auto chainParams = CreateChainParams(*m_node.args, CBaseChainParams::MAIN);\n-    const Consensus::Params &mainnetParams = chainParams->GetConsensus();\n \n-    // Use the TESTDUMMY deployment for testing purposes.\n-    int64_t bit = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].bit;\n-    int64_t nStartTime = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nStartTime;\n-    int64_t nTimeout = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nTimeout;\n+    int64_t bit = params.vDeployments[dep].bit;\n+    int64_t nStartTime = params.vDeployments[dep].nStartTime;\n+    int64_t nTimeout = params.vDeployments[dep].nTimeout;\n+    int min_activation_height = params.vDeployments[dep].min_activation_height;\n \n-    assert(nStartTime < nTimeout);\n+    // should not be any signalling for first block\n+    BOOST_CHECK_EQUAL(ComputeBlockVersion(nullptr, params), VERSIONBITS_TOP_BITS);\n+\n+    // always/never active deployments shouldn't need to be tested further\n+    if (nStartTime == Consensus::BIP9Deployment::ALWAYS_ACTIVE) return;\n+    if (nStartTime == Consensus::BIP9Deployment::NEVER_ACTIVE) return;\n+\n+    BOOST_REQUIRE(nStartTime < nTimeout);\n+    BOOST_REQUIRE(nStartTime >= 0);\n+    BOOST_REQUIRE(nTimeout <= std::numeric_limits<uint32_t>::max() || nTimeout == Consensus::BIP9Deployment::NO_TIMEOUT);\n+    BOOST_REQUIRE(0 <= bit && bit < 32);\n+    BOOST_REQUIRE(((1 << bit) & VERSIONBITS_TOP_MASK) == 0);\n+    BOOST_REQUIRE(min_activation_height >= 0);\n+    BOOST_REQUIRE_EQUAL(min_activation_height % params.nMinerConfirmationWindow, 0);\n \n     // In the first chain, test that the bit is set by CBV until it has failed.\n     // In the second chain, test the bit is set by CBV while STARTED and\n     // LOCKED-IN, and then no longer set while ACTIVE.\n     VersionBitsTester firstChain, secondChain;\n \n-    // Start generating blocks before nStartTime\n-    int64_t nTime = nStartTime - 1;\n+    int64_t nTime = nStartTime;\n+\n+    const CBlockIndex *lastBlock = nullptr;\n \n     // Before MedianTimePast of the chain has crossed nStartTime, the bit\n     // should not be set.\n-    CBlockIndex *lastBlock = nullptr;\n-    lastBlock = firstChain.Mine(mainnetParams.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit), 0);\n-\n-    // Mine more blocks (4 less than the adjustment period) at the old time, and check that CBV isn't setting the bit yet.\n-    for (uint32_t i = 1; i < mainnetParams.nMinerConfirmationWindow - 4; i++) {\n-        lastBlock = firstChain.Mine(mainnetParams.nMinerConfirmationWindow + i, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-        // This works because VERSIONBITS_LAST_OLD_BLOCK_VERSION happens\n-        // to be 4, and the bit we're testing happens to be bit 28.\n-        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit), 0);\n-    }\n-    // Now mine 5 more blocks at the start time -- MTP should not have passed yet, so\n-    // CBV should still not yet set the bit.\n-    nTime = nStartTime;\n-    for (uint32_t i = mainnetParams.nMinerConfirmationWindow - 4; i <= mainnetParams.nMinerConfirmationWindow; i++) {\n-        lastBlock = firstChain.Mine(mainnetParams.nMinerConfirmationWindow + i, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit), 0);\n+    if (nTime == 0) {\n+        // since CBlockIndex::nTime is uint32_t we can't represent any\n+        // earlier time, so will transition from DEFINED to STARTED at the\n+        // end of the first period by mining blocks at nTime == 0\n+        lastBlock = firstChain.Mine(params.nMinerConfirmationWindow - 1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\n+        lastBlock = firstChain.Mine(params.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+        BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\n+        // then we'll keep mining at nStartTime...\n+    } else {\n+        // use a time 1s earlier than start time to check we stay DEFINED\n+        --nTime;\n+\n+        // Start generating blocks before nStartTime\n+        lastBlock = firstChain.Mine(params.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\n+\n+        // Mine more blocks (4 less than the adjustment period) at the old time, and check that CBV isn't setting the bit yet.\n+        for (uint32_t i = 1; i < params.nMinerConfirmationWindow - 4; i++) {\n+            lastBlock = firstChain.Mine(params.nMinerConfirmationWindow + i, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+            // This works because VERSIONBITS_LAST_OLD_BLOCK_VERSION happens\n+            // to be 4, and the bit we're testing happens to be bit 28.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611260422",
      "id" : 611260422,
      "in_reply_to_id" : 609527793,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTI2MDQyMg==",
      "original_commit_id" : "be7d1368d8e98b6f9f692289b7d25ac369bf2984",
      "original_line" : 337,
      "original_position" : 323,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 633064575,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611260422",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611277377"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611277377"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I adapted the old `DEFINED -> FAILED` test case to become `DEFINED -> STARTED after timeout reached -> FAILED` rather than taking the case above.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-12T01:18:28Z",
      "diff_hunk" : "@@ -57,18 +57,12 @@ ThresholdState AbstractThresholdConditionChecker::GetStateFor(const CBlockIndex*\n \n         switch (state) {\n             case ThresholdState::DEFINED: {\n-                if (pindexPrev->GetMedianTimePast() >= nTimeTimeout) {\n-                    stateNext = ThresholdState::FAILED;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611277377",
      "id" : 611277377,
      "in_reply_to_id" : 609728435,
      "line" : 55,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTI3NzM3Nw==",
      "original_commit_id" : "ccfe854884276fbdd2ddbcc65689dbd3306f6332",
      "original_line" : 55,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/versionbits.cpp",
      "position" : 25,
      "pull_request_review_id" : 633081276,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611277377",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611277521"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611277521"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Removed this comment. See https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611260422 for reasoning.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-12T01:19:14Z",
      "diff_hunk" : "@@ -244,44 +244,72 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n \n static void check_computeblockversion(const Consensus::Params& params, Consensus::DeploymentPos dep)\n {\n+    // This implicitly uses versionbitscache, so clear it every time\n+    versionbitscache.Clear();\n+\n     // Check that ComputeBlockVersion will set the appropriate bit correctly\n \n     int64_t bit = params.vDeployments[dep].bit;\n     int64_t nStartTime = params.vDeployments[dep].nStartTime;\n     int64_t nTimeout = params.vDeployments[dep].nTimeout;\n \n-    assert(nStartTime < nTimeout);\n+    // should not be any signalling for first block\n+    BOOST_CHECK_EQUAL(ComputeBlockVersion(nullptr, params), VERSIONBITS_TOP_BITS);\n+\n+    // always active deployments shouldn't need to be tested further\n+    if (nStartTime == Consensus::BIP9Deployment::ALWAYS_ACTIVE) return;\n+\n+    BOOST_REQUIRE(nStartTime < nTimeout);\n+    BOOST_REQUIRE(nStartTime >= 0);\n+    BOOST_REQUIRE(nTimeout <= std::numeric_limits<uint32_t>::max() || nTimeout == Consensus::BIP9Deployment::NO_TIMEOUT);\n+    BOOST_REQUIRE(0 <= bit && bit < 32);\n+    BOOST_REQUIRE(((1 << bit) & VERSIONBITS_TOP_MASK) == 0);\n \n     // In the first chain, test that the bit is set by CBV until it has failed.\n     // In the second chain, test the bit is set by CBV while STARTED and\n     // LOCKED-IN, and then no longer set while ACTIVE.\n     VersionBitsTester firstChain, secondChain;\n \n-    // Start generating blocks before nStartTime\n-    int64_t nTime = nStartTime - 1;\n+    int64_t nTime = nStartTime;\n \n-    // Before MedianTimePast of the chain has crossed nStartTime, the bit\n-    // should not be set.\n     CBlockIndex *lastBlock = nullptr;\n-    lastBlock = firstChain.Mine(params.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\n \n-    // Mine more blocks (4 less than the adjustment period) at the old time, and check that CBV isn't setting the bit yet.\n-    for (uint32_t i = 1; i < params.nMinerConfirmationWindow - 4; i++) {\n-        lastBlock = firstChain.Mine(params.nMinerConfirmationWindow + i, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-        // This works because VERSIONBITS_LAST_OLD_BLOCK_VERSION happens\n-        // to be 4, and the bit we're testing happens to be bit 28.\n+    // Before MedianTimePast of the chain has crossed nStartTime, the bit\n+    // should not be set.\n+    if (nTime == 0) {\n+        // since CBlockIndex::nTime is uint32_t we can't represent any\n+        // earlier time, so will transition from DEFINED to STARTED at the\n+        // end of the first period by mining blocks at nTime == 0\n+        lastBlock = firstChain.Mine(params.nMinerConfirmationWindow - 1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n         BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\n-    }\n-    // Now mine 5 more blocks at the start time -- MTP should not have passed yet, so\n-    // CBV should still not yet set the bit.\n-    nTime = nStartTime;\n-    for (uint32_t i = params.nMinerConfirmationWindow - 4; i <= params.nMinerConfirmationWindow; i++) {\n-        lastBlock = firstChain.Mine(params.nMinerConfirmationWindow + i, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+        lastBlock = firstChain.Mine(params.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+        BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\n+        // then we'll keep mining at nStartTime...\n+    } else {\n+        // use a time 1s earlier than start time to check we stay DEFINED\n+        --nTime;\n+\n+        // Start generating blocks before nStartTime\n+        lastBlock = firstChain.Mine(params.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n         BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\n+\n+        // Mine more blocks (4 less than the adjustment period) at the old time, and check that CBV isn't setting the bit yet.\n+        for (uint32_t i = 1; i < params.nMinerConfirmationWindow - 4; i++) {\n+            lastBlock = firstChain.Mine(params.nMinerConfirmationWindow + i, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+            // This works because VERSIONBITS_LAST_OLD_BLOCK_VERSION happens\n+            // to be 4, and the bit we're testing happens to be bit 28.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611277521",
      "id" : 611277521,
      "in_reply_to_id" : 609061269,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTI3NzUyMQ==",
      "original_commit_id" : "754ab11f2085a0c5e417cfbba80cd024fc8ea67a",
      "original_line" : 300,
      "original_position" : 75,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 633081437,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611277521",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611277740"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611277740"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Added 7000 back, bumped 8000 to 24000 as in some of the other cases and added a comment.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-12T01:20:19Z",
      "diff_hunk" : "@@ -214,10 +235,15 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n                            .Mine(3000, TestTime(10000), 0).TestStarted().TestStateSinceHeight(3000)\n                            .Mine(4000, TestTime(10000), 0).TestStarted().TestStateSinceHeight(3000)\n                            .Mine(5000, TestTime(10000), 0).TestStarted().TestStateSinceHeight(3000)\n+                           .Mine(5999, TestTime(20000), 0).TestStarted().TestStateSinceHeight(3000)\n                            .Mine(6000, TestTime(20000), 0).TestFailed().TestStateSinceHeight(6000)\n-                           .Mine(7000, TestTime(20000), 0x100).TestFailed().TestStateSinceHeight(6000);\n+                           .Mine(8000, TestTime(20000), 0x100).TestFailed().TestStateSinceHeight(6000)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611277740",
      "id" : 611277740,
      "in_reply_to_id" : 609613832,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTI3Nzc0MA==",
      "original_commit_id" : "be7d1368d8e98b6f9f692289b7d25ac369bf2984",
      "original_line" : 240,
      "original_position" : 208,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 633081671,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611277740",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611277821"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611277821"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Added a test that `min_act_height - 1` still signals.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-12T01:20:43Z",
      "diff_hunk" : "@@ -325,26 +398,57 @@ BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n \n     // Mine one period worth of blocks, and check that the bit will be on for the\n     // next period.\n-    lastBlock = secondChain.Mine(mainnetParams.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK((ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit)) != 0);\n+    lastBlock = secondChain.Mine(params.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+    BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\n \n     // Mine another period worth of blocks, signaling the new bit.\n-    lastBlock = secondChain.Mine(mainnetParams.nMinerConfirmationWindow * 2, nTime, VERSIONBITS_TOP_BITS | (1<<bit)).Tip();\n+    lastBlock = secondChain.Mine(params.nMinerConfirmationWindow * 2, nTime, VERSIONBITS_TOP_BITS | (1<<bit)).Tip();\n     // After one period of setting the bit on each block, it should have locked in.\n     // We keep setting the bit for one more period though, until activation.\n-    BOOST_CHECK((ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit)) != 0);\n+    BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\n \n     // Now check that we keep mining the block until the end of this period, and\n     // then stop at the beginning of the next period.\n-    lastBlock = secondChain.Mine((mainnetParams.nMinerConfirmationWindow * 3) - 1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK((ComputeBlockVersion(lastBlock, mainnetParams) & (1 << bit)) != 0);\n-    lastBlock = secondChain.Mine(mainnetParams.nMinerConfirmationWindow * 3, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit), 0);\n-\n-    // Finally, verify that after a soft fork has activated, CBV no longer uses\n-    // VERSIONBITS_LAST_OLD_BLOCK_VERSION.\n-    //BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & VERSIONBITS_TOP_MASK, VERSIONBITS_TOP_BITS);\n+    lastBlock = secondChain.Mine((params.nMinerConfirmationWindow * 3) - 1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+    BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1 << bit)) != 0);\n+    lastBlock = secondChain.Mine(params.nMinerConfirmationWindow * 3, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+\n+    if (lastBlock->nHeight + 1 < min_activation_height) {\n+        lastBlock = secondChain.Mine(min_activation_height, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611277821",
      "id" : 611277821,
      "in_reply_to_id" : 609591457,
      "line" : 433,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTI3NzgyMQ==",
      "original_commit_id" : "be7d1368d8e98b6f9f692289b7d25ac369bf2984",
      "original_line" : 433,
      "original_position" : 431,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 439,
      "pull_request_review_id" : 633081747,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611277821",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611277882"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611277882"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-12T01:21:01Z",
      "diff_hunk" : "@@ -325,26 +398,57 @@ BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n \n     // Mine one period worth of blocks, and check that the bit will be on for the\n     // next period.\n-    lastBlock = secondChain.Mine(mainnetParams.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK((ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit)) != 0);\n+    lastBlock = secondChain.Mine(params.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+    BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\n \n     // Mine another period worth of blocks, signaling the new bit.\n-    lastBlock = secondChain.Mine(mainnetParams.nMinerConfirmationWindow * 2, nTime, VERSIONBITS_TOP_BITS | (1<<bit)).Tip();\n+    lastBlock = secondChain.Mine(params.nMinerConfirmationWindow * 2, nTime, VERSIONBITS_TOP_BITS | (1<<bit)).Tip();\n     // After one period of setting the bit on each block, it should have locked in.\n     // We keep setting the bit for one more period though, until activation.\n-    BOOST_CHECK((ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit)) != 0);\n+    BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\n \n     // Now check that we keep mining the block until the end of this period, and\n     // then stop at the beginning of the next period.\n-    lastBlock = secondChain.Mine((mainnetParams.nMinerConfirmationWindow * 3) - 1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK((ComputeBlockVersion(lastBlock, mainnetParams) & (1 << bit)) != 0);\n-    lastBlock = secondChain.Mine(mainnetParams.nMinerConfirmationWindow * 3, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit), 0);\n-\n-    // Finally, verify that after a soft fork has activated, CBV no longer uses\n-    // VERSIONBITS_LAST_OLD_BLOCK_VERSION.\n-    //BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & VERSIONBITS_TOP_MASK, VERSIONBITS_TOP_BITS);\n+    lastBlock = secondChain.Mine((params.nMinerConfirmationWindow * 3) - 1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+    BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1 << bit)) != 0);\n+    lastBlock = secondChain.Mine(params.nMinerConfirmationWindow * 3, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+\n+    if (lastBlock->nHeight + 1 < min_activation_height) {\n+        lastBlock = secondChain.Mine(min_activation_height, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+    }\n+\n+    BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\n }\n \n+BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n+{\n+    // check that any deployment on any chain can conceivably reach both\n+    // ACTIVE and FAILED states in roughly the way we expect\n+    for (const auto& chain_name : {CBaseChainParams::MAIN, CBaseChainParams::TESTNET, CBaseChainParams::SIGNET, CBaseChainParams::REGTEST}) {\n+        const auto chainParams = CreateChainParams(*m_node.args, chain_name);\n+        for (int i = 0; i < (int)Consensus::MAX_VERSION_BITS_DEPLOYMENTS; ++i) {\n+            check_computeblockversion(chainParams->GetConsensus(), static_cast<Consensus::DeploymentPos>(i));\n+        }\n+    }\n+\n+    {\n+        // Use regtest/testdummy to ensure we always exercise some\n+        // deployment that's not always/never active\n+        ArgsManager args;\n+        args.ForceSetArg(\"-vbparams\", \"testdummy:1199145601:1230767999\"); // January 1, 2008 - December 31, 2008\n+        const auto chainParams = CreateChainParams(args, CBaseChainParams::REGTEST);\n+        check_computeblockversion(chainParams->GetConsensus(), Consensus::DEPLOYMENT_TESTDUMMY);\n+    }\n+\n+    {\n+        // Use regtest/testdummy to ensure we always exercise the\n+        // min_lock_in_time test, even if we're not using that in a",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611277882",
      "id" : 611277882,
      "in_reply_to_id" : 609562526,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTI3Nzg4Mg==",
      "original_commit_id" : "be7d1368d8e98b6f9f692289b7d25ac369bf2984",
      "original_line" : 445,
      "original_position" : 459,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 633081812,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611277882",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611277932"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611277932"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Removed this comment.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-12T01:21:28Z",
      "diff_hunk" : "@@ -242,81 +275,121 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n     }\n }\n \n-BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n+static void check_computeblockversion(const Consensus::Params& params, Consensus::DeploymentPos dep)\n {\n+    // This implicitly uses versionbitscache, so clear it every time\n+    versionbitscache.Clear();\n+\n     // Check that ComputeBlockVersion will set the appropriate bit correctly\n-    // on mainnet.\n-    const auto chainParams = CreateChainParams(*m_node.args, CBaseChainParams::MAIN);\n-    const Consensus::Params &mainnetParams = chainParams->GetConsensus();\n \n-    // Use the TESTDUMMY deployment for testing purposes.\n-    int64_t bit = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].bit;\n-    int64_t nStartTime = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nStartTime;\n-    int64_t nTimeout = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nTimeout;\n+    int64_t bit = params.vDeployments[dep].bit;\n+    int64_t nStartTime = params.vDeployments[dep].nStartTime;\n+    int64_t nTimeout = params.vDeployments[dep].nTimeout;\n+    int min_activation_height = params.vDeployments[dep].min_activation_height;\n \n-    assert(nStartTime < nTimeout);\n+    // should not be any signalling for first block\n+    BOOST_CHECK_EQUAL(ComputeBlockVersion(nullptr, params), VERSIONBITS_TOP_BITS);\n+\n+    // always/never active deployments shouldn't need to be tested further\n+    if (nStartTime == Consensus::BIP9Deployment::ALWAYS_ACTIVE) return;\n+    if (nStartTime == Consensus::BIP9Deployment::NEVER_ACTIVE) return;\n+\n+    BOOST_REQUIRE(nStartTime < nTimeout);\n+    BOOST_REQUIRE(nStartTime >= 0);\n+    BOOST_REQUIRE(nTimeout <= std::numeric_limits<uint32_t>::max() || nTimeout == Consensus::BIP9Deployment::NO_TIMEOUT);\n+    BOOST_REQUIRE(0 <= bit && bit < 32);\n+    BOOST_REQUIRE(((1 << bit) & VERSIONBITS_TOP_MASK) == 0);\n+    BOOST_REQUIRE(min_activation_height >= 0);\n+    BOOST_REQUIRE_EQUAL(min_activation_height % params.nMinerConfirmationWindow, 0);\n \n     // In the first chain, test that the bit is set by CBV until it has failed.\n     // In the second chain, test the bit is set by CBV while STARTED and\n     // LOCKED-IN, and then no longer set while ACTIVE.\n     VersionBitsTester firstChain, secondChain;\n \n-    // Start generating blocks before nStartTime\n-    int64_t nTime = nStartTime - 1;\n+    int64_t nTime = nStartTime;\n+\n+    const CBlockIndex *lastBlock = nullptr;\n \n     // Before MedianTimePast of the chain has crossed nStartTime, the bit\n     // should not be set.\n-    CBlockIndex *lastBlock = nullptr;\n-    lastBlock = firstChain.Mine(mainnetParams.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit), 0);\n-\n-    // Mine more blocks (4 less than the adjustment period) at the old time, and check that CBV isn't setting the bit yet.\n-    for (uint32_t i = 1; i < mainnetParams.nMinerConfirmationWindow - 4; i++) {\n-        lastBlock = firstChain.Mine(mainnetParams.nMinerConfirmationWindow + i, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-        // This works because VERSIONBITS_LAST_OLD_BLOCK_VERSION happens\n-        // to be 4, and the bit we're testing happens to be bit 28.\n-        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit), 0);\n-    }\n-    // Now mine 5 more blocks at the start time -- MTP should not have passed yet, so\n-    // CBV should still not yet set the bit.\n-    nTime = nStartTime;\n-    for (uint32_t i = mainnetParams.nMinerConfirmationWindow - 4; i <= mainnetParams.nMinerConfirmationWindow; i++) {\n-        lastBlock = firstChain.Mine(mainnetParams.nMinerConfirmationWindow + i, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit), 0);\n+    if (nTime == 0) {\n+        // since CBlockIndex::nTime is uint32_t we can't represent any\n+        // earlier time, so will transition from DEFINED to STARTED at the\n+        // end of the first period by mining blocks at nTime == 0\n+        lastBlock = firstChain.Mine(params.nMinerConfirmationWindow - 1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\n+        lastBlock = firstChain.Mine(params.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+        BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\n+        // then we'll keep mining at nStartTime...\n+    } else {\n+        // use a time 1s earlier than start time to check we stay DEFINED\n+        --nTime;\n+\n+        // Start generating blocks before nStartTime\n+        lastBlock = firstChain.Mine(params.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\n+\n+        // Mine more blocks (4 less than the adjustment period) at the old time, and check that CBV isn't setting the bit yet.\n+        for (uint32_t i = 1; i < params.nMinerConfirmationWindow - 4; i++) {\n+            lastBlock = firstChain.Mine(params.nMinerConfirmationWindow + i, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+            // This works because VERSIONBITS_LAST_OLD_BLOCK_VERSION happens\n+            // to be 4, and the bit we're testing happens to be bit 28.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611277932",
      "id" : 611277932,
      "in_reply_to_id" : 609527793,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTI3NzkzMg==",
      "original_commit_id" : "be7d1368d8e98b6f9f692289b7d25ac369bf2984",
      "original_line" : 337,
      "original_position" : 323,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 633081901,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611277932",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611277975"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611277975"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Moved",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-12T01:21:47Z",
      "diff_hunk" : "@@ -242,81 +275,121 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n     }\n }\n \n-BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n+static void check_computeblockversion(const Consensus::Params& params, Consensus::DeploymentPos dep)\n {\n+    // This implicitly uses versionbitscache, so clear it every time\n+    versionbitscache.Clear();\n+\n     // Check that ComputeBlockVersion will set the appropriate bit correctly",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611277975",
      "id" : 611277975,
      "in_reply_to_id" : 609518002,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTI3Nzk3NQ==",
      "original_commit_id" : "be7d1368d8e98b6f9f692289b7d25ac369bf2984",
      "original_line" : 283,
      "original_position" : 242,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 633081956,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611277975",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611278599"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611278599"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "576 to 400k is a factor of 700x, 400k to 700k is only an extra 73% -- if the test blows up from 2s to 1400s that's a huge problem, if it goes from 2s to 3.5s, meh. :) So leaving it as is; though you're right, 700k would have been a fine choice.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-12T01:25:20Z",
      "diff_hunk" : "@@ -394,6 +444,16 @@ BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n             check_computeblockversion(chainParams->GetConsensus(), static_cast<Consensus::DeploymentPos>(i));\n         }\n     }\n+\n+    {\n+        // Use regtest/testdummy to ensure we always exercise the\n+        // min_lock_in_time test, even if we're not using that in a\n+        // live deployment\n+        ArgsManager args;\n+        args.ForceSetArg(\"-vbparams\", \"testdummy:1199145601:1230767999:403200\"); // January 1, 2008 - December 31, 2008, min act height 403200",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611278599",
      "id" : 611278599,
      "in_reply_to_id" : 608881332,
      "line" : 465,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTI3ODU5OQ==",
      "original_commit_id" : "e94fc819d8a996ce3690274c307c537329dfb95b",
      "original_line" : 465,
      "original_position" : 183,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 471,
      "pull_request_review_id" : 633082714,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611278599",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611279642"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611279642"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Agree with the concept, but leaving this for now -- setting weird values on regtest shouldn't break anything given the fuzz tester already tests most of the weird cases.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-12T01:30:44Z",
      "diff_hunk" : "@@ -492,22 +503,26 @@ void CRegTestParams::UpdateActivationParametersFromArgs(const ArgsManager& args)\n     for (const std::string& strDeployment : args.GetArgs(\"-vbparams\")) {\n         std::vector<std::string> vDeploymentParams;\n         boost::split(vDeploymentParams, strDeployment, boost::is_any_of(\":\"));\n-        if (vDeploymentParams.size() != 3) {\n-            throw std::runtime_error(\"Version bits parameters malformed, expecting deployment:start:end\");\n+        if (vDeploymentParams.size() < 3 || 4 < vDeploymentParams.size()) {\n+            throw std::runtime_error(\"Version bits parameters malformed, expecting deployment:start:end[:min_activation_height]\");\n         }\n         int64_t nStartTime, nTimeout;\n+        int min_activation_height = 0;\n         if (!ParseInt64(vDeploymentParams[1], &nStartTime)) {\n             throw std::runtime_error(strprintf(\"Invalid nStartTime (%s)\", vDeploymentParams[1]));\n         }\n         if (!ParseInt64(vDeploymentParams[2], &nTimeout)) {\n             throw std::runtime_error(strprintf(\"Invalid nTimeout (%s)\", vDeploymentParams[2]));\n         }\n+        if (vDeploymentParams.size() >= 4 && !ParseInt32(vDeploymentParams[3], &min_activation_height)) {\n+            throw std::runtime_error(strprintf(\"Invalid min_activation_height (%s)\", vDeploymentParams[3]));\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611279642",
      "id" : 611279642,
      "in_reply_to_id" : 608871691,
      "line" : 519,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTI3OTY0Mg==",
      "original_commit_id" : "aa6a95de12b265cd3dc16b2d1303b89a20331a56",
      "original_line" : 519,
      "original_position" : 91,
      "original_start_line" : null,
      "path" : "src/chainparams.cpp",
      "position" : 117,
      "pull_request_review_id" : 633083920,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611279642",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611280260"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611280260"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "No longer relevant, but fwiw I was using \"timestamp\" in the sense of \"epoch timestamp, ie seconds since 1970\", not \"block timestamp, ie nTime value\".",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-12T01:34:24Z",
      "diff_hunk" : "@@ -29,6 +29,11 @@ struct BIP9Deployment {\n     int64_t nStartTime;\n     /** Timeout/expiry MedianTime for the deployment attempt. */\n     int64_t nTimeout;\n+    /** Delay lock in occuring until at least this timestamp.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611280260",
      "id" : 611280260,
      "in_reply_to_id" : 605875072,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTI4MDI2MA==",
      "original_commit_id" : "e12a22a0fd9d18bde1cffc6f919b58f77cf83236",
      "original_line" : 32,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/consensus/params.h",
      "position" : null,
      "pull_request_review_id" : 633084759,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611280260",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611280295"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611280295"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Replaced comment",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-12T01:34:41Z",
      "diff_hunk" : "@@ -302,17 +330,29 @@ static void check_computeblockversion(const Consensus::Params& params, Consensus\n         nHeight += 1;\n     }\n \n-    nTime = nTimeout;\n-    // FAILED is only triggered at the end of a period, so CBV should be setting\n-    // the bit until the period transition.\n-    for (uint32_t i = 0; i < params.nMinerConfirmationWindow - 1; i++) {\n+    if (nTimeout != Consensus::BIP9Deployment::NO_TIMEOUT) {\n+        // cannot reach NO_TIMEOUT a uint32_t",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611280295",
      "id" : 611280295,
      "in_reply_to_id" : 603766900,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTI4MDI5NQ==",
      "original_commit_id" : "754ab11f2085a0c5e417cfbba80cd024fc8ea67a",
      "original_line" : 334,
      "original_position" : 101,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 633084819,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611280295",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611283275"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611283275"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think it would be better for the `ConditionChecker` to not be abstract and just decode the `Consensus::Params` structure directly, so that tests just pass in different data, but are running the same chunks of code. Leaving this as-is until later refactoring either way though.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-12T01:48:36Z",
      "diff_hunk" : "@@ -44,6 +44,12 @@ class TestConditionChecker : public AbstractThresholdConditionChecker\n     int GetStateSinceHeightFor(const CBlockIndex* pindexPrev) const { return AbstractThresholdConditionChecker::GetStateSinceHeightFor(pindexPrev, paramsDummy, cache); }\n };\n \n+class TestDelayedActivationConditionChecker : public TestConditionChecker\n+{\n+public:\n+    int MinActivationHeight(const Consensus::Params& params) const override { return 15000; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611283275",
      "id" : 611283275,
      "in_reply_to_id" : 609583897,
      "line" : 50,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTI4MzI3NQ==",
      "original_commit_id" : "be7d1368d8e98b6f9f692289b7d25ac369bf2984",
      "original_line" : 50,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 7,
      "pull_request_review_id" : 633088085,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611283275",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611283703"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611283703"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This test is mostly just treating the underlying state as implied rather than matching it explicitly; I think that's something to reconsider more broadly as part of later refactoring (which ideally would also let ComputeBlockVersion be checked via fuzzing)",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-12T01:50:23Z",
      "diff_hunk" : "@@ -242,81 +275,121 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n     }\n }\n \n-BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n+static void check_computeblockversion(const Consensus::Params& params, Consensus::DeploymentPos dep)\n {\n+    // This implicitly uses versionbitscache, so clear it every time\n+    versionbitscache.Clear();\n+\n     // Check that ComputeBlockVersion will set the appropriate bit correctly\n-    // on mainnet.\n-    const auto chainParams = CreateChainParams(*m_node.args, CBaseChainParams::MAIN);\n-    const Consensus::Params &mainnetParams = chainParams->GetConsensus();\n \n-    // Use the TESTDUMMY deployment for testing purposes.\n-    int64_t bit = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].bit;\n-    int64_t nStartTime = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nStartTime;\n-    int64_t nTimeout = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nTimeout;\n+    int64_t bit = params.vDeployments[dep].bit;\n+    int64_t nStartTime = params.vDeployments[dep].nStartTime;\n+    int64_t nTimeout = params.vDeployments[dep].nTimeout;\n+    int min_activation_height = params.vDeployments[dep].min_activation_height;\n \n-    assert(nStartTime < nTimeout);\n+    // should not be any signalling for first block\n+    BOOST_CHECK_EQUAL(ComputeBlockVersion(nullptr, params), VERSIONBITS_TOP_BITS);\n+\n+    // always/never active deployments shouldn't need to be tested further\n+    if (nStartTime == Consensus::BIP9Deployment::ALWAYS_ACTIVE) return;\n+    if (nStartTime == Consensus::BIP9Deployment::NEVER_ACTIVE) return;\n+\n+    BOOST_REQUIRE(nStartTime < nTimeout);\n+    BOOST_REQUIRE(nStartTime >= 0);\n+    BOOST_REQUIRE(nTimeout <= std::numeric_limits<uint32_t>::max() || nTimeout == Consensus::BIP9Deployment::NO_TIMEOUT);\n+    BOOST_REQUIRE(0 <= bit && bit < 32);\n+    BOOST_REQUIRE(((1 << bit) & VERSIONBITS_TOP_MASK) == 0);\n+    BOOST_REQUIRE(min_activation_height >= 0);\n+    BOOST_REQUIRE_EQUAL(min_activation_height % params.nMinerConfirmationWindow, 0);\n \n     // In the first chain, test that the bit is set by CBV until it has failed.\n     // In the second chain, test the bit is set by CBV while STARTED and\n     // LOCKED-IN, and then no longer set while ACTIVE.\n     VersionBitsTester firstChain, secondChain;\n \n-    // Start generating blocks before nStartTime\n-    int64_t nTime = nStartTime - 1;\n+    int64_t nTime = nStartTime;\n+\n+    const CBlockIndex *lastBlock = nullptr;\n \n     // Before MedianTimePast of the chain has crossed nStartTime, the bit\n     // should not be set.\n-    CBlockIndex *lastBlock = nullptr;\n-    lastBlock = firstChain.Mine(mainnetParams.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit), 0);\n-\n-    // Mine more blocks (4 less than the adjustment period) at the old time, and check that CBV isn't setting the bit yet.\n-    for (uint32_t i = 1; i < mainnetParams.nMinerConfirmationWindow - 4; i++) {\n-        lastBlock = firstChain.Mine(mainnetParams.nMinerConfirmationWindow + i, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-        // This works because VERSIONBITS_LAST_OLD_BLOCK_VERSION happens\n-        // to be 4, and the bit we're testing happens to be bit 28.\n-        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit), 0);\n-    }\n-    // Now mine 5 more blocks at the start time -- MTP should not have passed yet, so\n-    // CBV should still not yet set the bit.\n-    nTime = nStartTime;\n-    for (uint32_t i = mainnetParams.nMinerConfirmationWindow - 4; i <= mainnetParams.nMinerConfirmationWindow; i++) {\n-        lastBlock = firstChain.Mine(mainnetParams.nMinerConfirmationWindow + i, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit), 0);\n+    if (nTime == 0) {\n+        // since CBlockIndex::nTime is uint32_t we can't represent any\n+        // earlier time, so will transition from DEFINED to STARTED at the\n+        // end of the first period by mining blocks at nTime == 0\n+        lastBlock = firstChain.Mine(params.nMinerConfirmationWindow - 1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\n+        lastBlock = firstChain.Mine(params.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+        BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\n+        // then we'll keep mining at nStartTime...\n+    } else {\n+        // use a time 1s earlier than start time to check we stay DEFINED\n+        --nTime;\n+\n+        // Start generating blocks before nStartTime\n+        lastBlock = firstChain.Mine(params.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\n+\n+        // Mine more blocks (4 less than the adjustment period) at the old time, and check that CBV isn't setting the bit yet.\n+        for (uint32_t i = 1; i < params.nMinerConfirmationWindow - 4; i++) {\n+            lastBlock = firstChain.Mine(params.nMinerConfirmationWindow + i, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+            // This works because VERSIONBITS_LAST_OLD_BLOCK_VERSION happens\n+            // to be 4, and the bit we're testing happens to be bit 28.\n+            BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\n+        }\n+        // Now mine 5 more blocks at the start time -- MTP should not have passed yet, so\n+        // CBV should still not yet set the bit.\n+        nTime = nStartTime;\n+        for (uint32_t i = params.nMinerConfirmationWindow - 4; i <= params.nMinerConfirmationWindow; i++) {\n+            lastBlock = firstChain.Mine(params.nMinerConfirmationWindow + i, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+            BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\n+        }\n+        // Next we will advance to the next period and transition to STARTED,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611283703",
      "id" : 611283703,
      "in_reply_to_id" : 609530120,
      "line" : 359,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTI4MzcwMw==",
      "original_commit_id" : "be7d1368d8e98b6f9f692289b7d25ac369bf2984",
      "original_line" : 359,
      "original_position" : 333,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 337,
      "pull_request_review_id" : 633088532,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T02:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611283703",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated for feedback, `git diff be7d136..ffe33df ` should be easy to follow if you'd reviewed the previous head.\r\n\r\n[EDIT: bumped the final commit with no changes and re-pushed so as to retrigger CI since the incident has apparently finished]",
      "created_at" : "2021-04-12T01:57:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-817427972",
      "id" : 817427972,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxNzQyNzk3Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-12T03:35:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/817427972",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Note that the comments from maaku [copied above](https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-815763961) have been [responded to](https://github.com/bitcoin/bitcoin/pull/21393#issuecomment-815777324) in the PR where they were originally posted.",
      "created_at" : "2021-04-12T02:41:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-817440221",
      "id" : 817440221,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxNzQ0MDIyMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-12T02:41:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/817440221",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-utACK https://github.com/bitcoin/bitcoin/pull/21377/commits/ffe33dfbd4c3b11e3475b022b6c1dd077613de79\r\n\r\nAPI changed to return min_height_activation regardless of value, other assorted comments. I'll verify the new test case triggers when mutating logic later today to change to a tACK",
      "created_at" : "2021-04-12T06:54:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-817538201",
      "id" : 817538201,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxNzUzODIwMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-12T06:54:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/817538201",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "tACK https://github.com/bitcoin/bitcoin/pull/21377/commits/ffe33dfbd4c3b11e3475b022b6c1dd077613de79\r\n\r\nI can't trigger any more mutation false-successful runs.",
      "created_at" : "2021-04-12T07:10:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-817547968",
      "id" : 817547968,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxNzU0Nzk2OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-12T07:10:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/817547968",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK ffe33dfbd4c3b11e3475b022b6c1dd077613de79\r\n\r\nVerified range-diff from be7d1368d8\r\n",
      "created_at" : "2021-04-12T07:24:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-817557579",
      "id" : 817557579,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxNzU1NzU3OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-12T07:24:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/817557579",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "review ACK ffe33dfbd4c3b11e3475b022b6c1dd077613de79 ð\r\n\r\nAlso checked that it addresses all my style feedback I left on the other pull ( https://github.com/bitcoin/bitcoin/pull/21392#pullrequestreview-621891984 )\r\n\r\n<details><summary>Show signature and timestamp</summary>\r\n\r\nSignature:\r\n\r\n```\r\n-----BEGIN PGP SIGNED MESSAGE-----\r\nHash: SHA512\r\n\r\nreview ACK ffe33dfbd4c3b11e3475b022b6c1dd077613de79 ð\r\n\r\nAlso checked that it addresses all my style feedback I left on the other pull ( https://github.com/bitcoin/bitcoin/pull/21392#pullrequestreview-621891984 )\r\n-----BEGIN PGP SIGNATURE-----\r\n\r\niQGzBAEBCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\r\npUjIiwv/elbuMaynxLCVMxZAuduzypZgl4ZM/6IysmHZSw9FxhYgXWih3UrIVlHG\r\njQpEqUorssfPE0dUeVNG7ToVCs9w5t+DSzJpKJUDzHsESnoXkxvZm/PqWc9q3+vr\r\nfVv3azJ6LOnyUmxBUy8vZf+FMck66cJq6VPhfG24kL57MgX24JRk8NT0swiuWLS9\r\nEkz1N2bSKB7iGeTyhLbyjrNiSNK29BUeT0dqKNTx2jqsnrDAyzD4skZLT8ZubWdY\r\nkW+njZwz2ZNvvs+ffHcG/EJpCeRAmlDBw+F6TD1bm+WilcmXY2bp9uLiUE1Uo2eR\r\nkPk2RlQxJtVDGwFpUfGYX7847eePYrMgUsDVsrSCkdqhHh+2UAwlyzqQrr0Z8lAS\r\nNF02RYBFcFmwbuJ2Z7+Fu5pvlqcZ4q9YHepj8R3BTHKJURCj6ss9FNby0mEUYdfJ\r\njF63r+KwMljW3jbox10SEe1T32MZHuOyu4VaBv+hs1Rjna9JgKbZQaHPo1pOAcid\r\nAlhYcuHs\r\n=pYnx\r\n-----END PGP SIGNATURE-----\r\n```\r\n\r\n[Timestamp of file with hash `9edb49a6fd6bab8f19ff268a5fde21eb741d236d3f07ee453643334bfb0a3cac  -`](https://opentimestamps.org/info/?004f70656e54696d657374616d7073000050726f6f6600bf89e2e884e8929401089edb49a6fd6bab8f19ff268a5fde21eb741d236d3f07ee453643334bfb0a3cacf0100355cb7bba556bb6eeb8dcc1f0c2946408fff0100b354a97dcb1aa69468ee0f2261cba8708f10460741771f00806619f5893e3d99e0083dfe30d2ef90c8e232268747470733a2f2f6274632e63616c656e6461722e636174616c6c6178792e636f6dfff0104df2b5011fc036698a62f85dc7478ac108f10460741771f008bcd90b6cf541cf390083dfe30d2ef90c8e2e2d68747470733a2f2f616c6963652e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267fff01078714792a928dc47e74ebad945157df108f10460740998f00821656bfb6019b1d20083dfe30d2ef90c8e292868747470733a2f2f66696e6e65792e63616c656e6461722e657465726e69747977616c6c2e636f6df010def9bf3f015fa5dc87a4d69569507d4b08f020b3a9d13f98c2f7e5dd175716fe704d5e5b2bd53c0b38d612e5c8d79210f794e208f10460741772f008890d822dd8e5e4fa0083dfe30d2ef90c8e2c2b68747470733a2f2f626f622e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267)\r\n\r\n</details>\r\n",
      "created_at" : "2021-04-12T09:49:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-817663996",
      "id" : 817663996,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxNzY2Mzk5Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-12T09:49:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/817663996",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611492633"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611492633"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit f054f6bcd2c2ce5fea84cf8681013f85a444e7ea:\r\n\r\nIt would be nice to check that no bits are re-used (within the same chain). I guess previously there was no test for this because BIP 9 allowed (though discouraged) this. With the changes here this should be disallowed because the transition to FAILED (on timeout) no longer takes precedence over STARTED/LOCKED_IN. So with the changes here all softforks on the same bit might overlap, even when non-overlapping start-end times are picked.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-12T10:00:52Z",
      "diff_hunk" : "@@ -325,26 +410,62 @@ BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n \n     // Mine one period worth of blocks, and check that the bit will be on for the\n     // next period.\n-    lastBlock = secondChain.Mine(mainnetParams.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK((ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit)) != 0);\n+    lastBlock = secondChain.Mine(params.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+    BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\n \n     // Mine another period worth of blocks, signaling the new bit.\n-    lastBlock = secondChain.Mine(mainnetParams.nMinerConfirmationWindow * 2, nTime, VERSIONBITS_TOP_BITS | (1<<bit)).Tip();\n+    lastBlock = secondChain.Mine(params.nMinerConfirmationWindow * 2, nTime, VERSIONBITS_TOP_BITS | (1<<bit)).Tip();\n     // After one period of setting the bit on each block, it should have locked in.\n     // We keep setting the bit for one more period though, until activation.\n-    BOOST_CHECK((ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit)) != 0);\n+    BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\n \n     // Now check that we keep mining the block until the end of this period, and\n     // then stop at the beginning of the next period.\n-    lastBlock = secondChain.Mine((mainnetParams.nMinerConfirmationWindow * 3) - 1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK((ComputeBlockVersion(lastBlock, mainnetParams) & (1 << bit)) != 0);\n-    lastBlock = secondChain.Mine(mainnetParams.nMinerConfirmationWindow * 3, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit), 0);\n-\n-    // Finally, verify that after a soft fork has activated, CBV no longer uses\n-    // VERSIONBITS_LAST_OLD_BLOCK_VERSION.\n-    //BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & VERSIONBITS_TOP_MASK, VERSIONBITS_TOP_BITS);\n+    lastBlock = secondChain.Mine((params.nMinerConfirmationWindow * 3) - 1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+    BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1 << bit)) != 0);\n+    lastBlock = secondChain.Mine(params.nMinerConfirmationWindow * 3, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+\n+    if (lastBlock->nHeight + 1 < min_activation_height) {\n+        // check signalling continues while min_activation_height is not reached\n+        lastBlock = secondChain.Mine(min_activation_height - 1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+        BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1 << bit)) != 0);\n+        // then reach min_activation_height, which was already REQUIRE'd to start a new period\n+        lastBlock = secondChain.Mine(min_activation_height, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+    }\n+\n+    // Check that we don't signal after activation\n+    BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\n }\n \n+BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n+{\n+    // check that any deployment on any chain can conceivably reach both\n+    // ACTIVE and FAILED states in roughly the way we expect\n+    for (const auto& chain_name : {CBaseChainParams::MAIN, CBaseChainParams::TESTNET, CBaseChainParams::SIGNET, CBaseChainParams::REGTEST}) {\n+        const auto chainParams = CreateChainParams(*m_node.args, chain_name);\n+        for (int i = 0; i < (int)Consensus::MAX_VERSION_BITS_DEPLOYMENTS; ++i) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611492633",
      "id" : 611492633,
      "line" : 446,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTQ5MjYzMw==",
      "original_commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "original_line" : 446,
      "original_position" : 452,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 452,
      "pull_request_review_id" : 633354024,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T12:35:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611492633",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611493576"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611493576"
         }
      },
      "author_association" : "MEMBER",
      "body" : "commit ffe33dfbd4c3b11e3475b022b6c1dd077613de79: While touching this line, maybe also add a link somewhere to the section \"Modified thresholds\" in https://github.com/bitcoin/bips/blob/master/bip-0009.mediawiki#support-for-future-changes ?",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-12T10:02:19Z",
      "diff_hunk" : "@@ -78,7 +78,7 @@ class CMainParams : public CChainParams {\n         consensus.nPowTargetSpacing = 10 * 60;\n         consensus.fPowAllowMinDifficultyBlocks = false;\n         consensus.fPowNoRetargeting = false;\n-        consensus.nRuleChangeActivationThreshold = 1916; // 95% of 2016\n+        consensus.nRuleChangeActivationThreshold = 1815; // 90% of 2016",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611493576",
      "id" : 611493576,
      "line" : 81,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTQ5MzU3Ng==",
      "original_commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "original_line" : 81,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/chainparams.cpp",
      "position" : 5,
      "pull_request_review_id" : 633355372,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T10:02:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611493576",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611701546"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611701546"
         }
      },
      "author_association" : "MEMBER",
      "body" : "63879f0a4760c0c0f784029849cb5d21ee088abb these can all be `const` (and eventually braced initialization to check for narrowing)\r\n```diff\r\n-    int64_t bit = params.vDeployments[dep].bit;\r\n-    int64_t nStartTime = params.vDeployments[dep].nStartTime;\r\n-    int64_t nTimeout = params.vDeployments[dep].nTimeout;\r\n+    const int64_t bit{params.vDeployments[dep].bit};\r\n+    const int64_t nStartTime{params.vDeployments[dep].nStartTime};\r\n+    const int64_t nTimeout{params.vDeployments[dep].nTimeout};\r\n```\r\n",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-12T14:53:22Z",
      "diff_hunk" : "@@ -242,81 +290,118 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n     }\n }\n \n-BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n+/** Check that ComputeBlockVersion will set the appropriate bit correctly */\n+static void check_computeblockversion(const Consensus::Params& params, Consensus::DeploymentPos dep)\n {\n-    // Check that ComputeBlockVersion will set the appropriate bit correctly\n-    // on mainnet.\n-    const auto chainParams = CreateChainParams(*m_node.args, CBaseChainParams::MAIN);\n-    const Consensus::Params &mainnetParams = chainParams->GetConsensus();\n+    // This implicitly uses versionbitscache, so clear it every time\n+    versionbitscache.Clear();\n+\n+    int64_t bit = params.vDeployments[dep].bit;\n+    int64_t nStartTime = params.vDeployments[dep].nStartTime;\n+    int64_t nTimeout = params.vDeployments[dep].nTimeout;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611701546",
      "id" : 611701546,
      "line" : 301,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTcwMTU0Ng==",
      "original_commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "original_line" : 301,
      "original_position" : 255,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 255,
      "pull_request_review_id" : 633636718,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T15:12:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611701546",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611704239"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611704239"
         }
      },
      "author_association" : "MEMBER",
      "body" : "63879f0a4760c0c0f784029849cb5d21ee088abb here and 593274445004506c921d5d851361aefb3434d744 lines 355 and 396, prefix iterator\r\n```suggestion\r\n        for (uint32_t i = 1; i < params.nMinerConfirmationWindow - 4; ++i) {\r\n```",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-12T14:56:20Z",
      "diff_hunk" : "@@ -242,81 +290,118 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n     }\n }\n \n-BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n+/** Check that ComputeBlockVersion will set the appropriate bit correctly */\n+static void check_computeblockversion(const Consensus::Params& params, Consensus::DeploymentPos dep)\n {\n-    // Check that ComputeBlockVersion will set the appropriate bit correctly\n-    // on mainnet.\n-    const auto chainParams = CreateChainParams(*m_node.args, CBaseChainParams::MAIN);\n-    const Consensus::Params &mainnetParams = chainParams->GetConsensus();\n+    // This implicitly uses versionbitscache, so clear it every time\n+    versionbitscache.Clear();\n+\n+    int64_t bit = params.vDeployments[dep].bit;\n+    int64_t nStartTime = params.vDeployments[dep].nStartTime;\n+    int64_t nTimeout = params.vDeployments[dep].nTimeout;\n+    int min_activation_height = params.vDeployments[dep].min_activation_height;\n+\n+    // should not be any signalling for first block\n+    BOOST_CHECK_EQUAL(ComputeBlockVersion(nullptr, params), VERSIONBITS_TOP_BITS);\n \n-    // Use the TESTDUMMY deployment for testing purposes.\n-    int64_t bit = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].bit;\n-    int64_t nStartTime = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nStartTime;\n-    int64_t nTimeout = mainnetParams.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nTimeout;\n+    // always/never active deployments shouldn't need to be tested further\n+    if (nStartTime == Consensus::BIP9Deployment::ALWAYS_ACTIVE) return;\n+    if (nStartTime == Consensus::BIP9Deployment::NEVER_ACTIVE) return;\n \n-    assert(nStartTime < nTimeout);\n+    BOOST_REQUIRE(nStartTime < nTimeout);\n+    BOOST_REQUIRE(nStartTime >= 0);\n+    BOOST_REQUIRE(nTimeout <= std::numeric_limits<uint32_t>::max() || nTimeout == Consensus::BIP9Deployment::NO_TIMEOUT);\n+    BOOST_REQUIRE(0 <= bit && bit < 32);\n+    BOOST_REQUIRE(((1 << bit) & VERSIONBITS_TOP_MASK) == 0);\n+    BOOST_REQUIRE(min_activation_height >= 0);\n+    BOOST_REQUIRE_EQUAL(min_activation_height % params.nMinerConfirmationWindow, 0);\n \n     // In the first chain, test that the bit is set by CBV until it has failed.\n     // In the second chain, test the bit is set by CBV while STARTED and\n     // LOCKED-IN, and then no longer set while ACTIVE.\n     VersionBitsTester firstChain, secondChain;\n \n-    // Start generating blocks before nStartTime\n-    int64_t nTime = nStartTime - 1;\n+    int64_t nTime = nStartTime;\n+\n+    const CBlockIndex *lastBlock = nullptr;\n \n     // Before MedianTimePast of the chain has crossed nStartTime, the bit\n     // should not be set.\n-    CBlockIndex *lastBlock = nullptr;\n-    lastBlock = firstChain.Mine(mainnetParams.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit), 0);\n-\n-    // Mine more blocks (4 less than the adjustment period) at the old time, and check that CBV isn't setting the bit yet.\n-    for (uint32_t i = 1; i < mainnetParams.nMinerConfirmationWindow - 4; i++) {\n-        lastBlock = firstChain.Mine(mainnetParams.nMinerConfirmationWindow + i, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-        // This works because VERSIONBITS_LAST_OLD_BLOCK_VERSION happens\n-        // to be 4, and the bit we're testing happens to be bit 28.\n-        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit), 0);\n-    }\n-    // Now mine 5 more blocks at the start time -- MTP should not have passed yet, so\n-    // CBV should still not yet set the bit.\n-    nTime = nStartTime;\n-    for (uint32_t i = mainnetParams.nMinerConfirmationWindow - 4; i <= mainnetParams.nMinerConfirmationWindow; i++) {\n-        lastBlock = firstChain.Mine(mainnetParams.nMinerConfirmationWindow + i, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit), 0);\n+    if (nTime == 0) {\n+        // since CBlockIndex::nTime is uint32_t we can't represent any\n+        // earlier time, so will transition from DEFINED to STARTED at the\n+        // end of the first period by mining blocks at nTime == 0\n+        lastBlock = firstChain.Mine(params.nMinerConfirmationWindow - 1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\n+        lastBlock = firstChain.Mine(params.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+        BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\n+        // then we'll keep mining at nStartTime...\n+    } else {\n+        // use a time 1s earlier than start time to check we stay DEFINED\n+        --nTime;\n+\n+        // Start generating blocks before nStartTime\n+        lastBlock = firstChain.Mine(params.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+        BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\n+\n+        // Mine more blocks (4 less than the adjustment period) at the old time, and check that CBV isn't setting the bit yet.\n+        for (uint32_t i = 1; i < params.nMinerConfirmationWindow - 4; i++) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611704239",
      "id" : 611704239,
      "line" : 348,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTcwNDIzOQ==",
      "original_commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "original_line" : 348,
      "original_position" : 326,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 326,
      "pull_request_review_id" : 633636718,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T15:19:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611704239",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611717732"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611717732"
         }
      },
      "author_association" : "MEMBER",
      "body" : "593274445004506c921d5d851361aefb3434d744 https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#es49-if-you-must-use-a-cast-use-a-named-cast\r\n```suggestion\r\n        for (int i = 0; i < static_cast<int>(Consensus::MAX_VERSION_BITS_DEPLOYMENTS); ++i) {\r\n```",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-12T15:11:36Z",
      "diff_hunk" : "@@ -325,26 +410,62 @@ BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n \n     // Mine one period worth of blocks, and check that the bit will be on for the\n     // next period.\n-    lastBlock = secondChain.Mine(mainnetParams.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK((ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit)) != 0);\n+    lastBlock = secondChain.Mine(params.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+    BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\n \n     // Mine another period worth of blocks, signaling the new bit.\n-    lastBlock = secondChain.Mine(mainnetParams.nMinerConfirmationWindow * 2, nTime, VERSIONBITS_TOP_BITS | (1<<bit)).Tip();\n+    lastBlock = secondChain.Mine(params.nMinerConfirmationWindow * 2, nTime, VERSIONBITS_TOP_BITS | (1<<bit)).Tip();\n     // After one period of setting the bit on each block, it should have locked in.\n     // We keep setting the bit for one more period though, until activation.\n-    BOOST_CHECK((ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit)) != 0);\n+    BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\n \n     // Now check that we keep mining the block until the end of this period, and\n     // then stop at the beginning of the next period.\n-    lastBlock = secondChain.Mine((mainnetParams.nMinerConfirmationWindow * 3) - 1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK((ComputeBlockVersion(lastBlock, mainnetParams) & (1 << bit)) != 0);\n-    lastBlock = secondChain.Mine(mainnetParams.nMinerConfirmationWindow * 3, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit), 0);\n-\n-    // Finally, verify that after a soft fork has activated, CBV no longer uses\n-    // VERSIONBITS_LAST_OLD_BLOCK_VERSION.\n-    //BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & VERSIONBITS_TOP_MASK, VERSIONBITS_TOP_BITS);\n+    lastBlock = secondChain.Mine((params.nMinerConfirmationWindow * 3) - 1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+    BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1 << bit)) != 0);\n+    lastBlock = secondChain.Mine(params.nMinerConfirmationWindow * 3, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+\n+    if (lastBlock->nHeight + 1 < min_activation_height) {\n+        // check signalling continues while min_activation_height is not reached\n+        lastBlock = secondChain.Mine(min_activation_height - 1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+        BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1 << bit)) != 0);\n+        // then reach min_activation_height, which was already REQUIRE'd to start a new period\n+        lastBlock = secondChain.Mine(min_activation_height, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+    }\n+\n+    // Check that we don't signal after activation\n+    BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\n }\n \n+BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n+{\n+    // check that any deployment on any chain can conceivably reach both\n+    // ACTIVE and FAILED states in roughly the way we expect\n+    for (const auto& chain_name : {CBaseChainParams::MAIN, CBaseChainParams::TESTNET, CBaseChainParams::SIGNET, CBaseChainParams::REGTEST}) {\n+        const auto chainParams = CreateChainParams(*m_node.args, chain_name);\n+        for (int i = 0; i < (int)Consensus::MAX_VERSION_BITS_DEPLOYMENTS; ++i) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611717732",
      "id" : 611717732,
      "in_reply_to_id" : 611492633,
      "line" : 446,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTcxNzczMg==",
      "original_commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "original_line" : 446,
      "original_position" : 452,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 452,
      "pull_request_review_id" : 633636718,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T15:19:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611717732",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611719790"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611719790"
         }
      },
      "author_association" : "MEMBER",
      "body" : "55ac5f568a3b73d6f1ef4654617fb76e8bcbccdf: why not just use `-2` here?",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-12T15:14:07Z",
      "diff_hunk" : "@@ -447,6 +444,15 @@ BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n         }\n     }\n \n+    {\n+        // Use regtest/testdummy to ensure we always exercise some\n+        // deployment that's not always/never active\n+        ArgsManager args;\n+        args.ForceSetArg(\"-vbparams\", \"testdummy:1199145601:1230767999\"); // January 1, 2008 - December 31, 2008",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611719790",
      "id" : 611719790,
      "line" : 455,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTcxOTc5MA==",
      "original_commit_id" : "55ac5f568a3b73d6f1ef4654617fb76e8bcbccdf",
      "original_line" : 451,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 461,
      "pull_request_review_id" : 633661404,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T15:39:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611719790",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611725388"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611725388"
         }
      },
      "author_association" : "MEMBER",
      "body" : "dd85d5411c1702c8ae259610fe55050ba212e21e: why is the timeout set to 2008 here? In 55ac5f568a3b73d6f1ef4654617fb76e8bcbccdf  we don't the start height to `-2` here, so the test won't early-exit, but I think it's more clear to just set a far future timeout date:\r\n\r\n```cpp\r\nargs.ForceSetArg(\"-vbparams\", \"testdummy:1199145601:4102441200:403200\"); // January 1, 2008 - January 1, 2100, min act height 403200\r\n```",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-12T15:20:41Z",
      "diff_hunk" : "@@ -391,6 +446,16 @@ BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n             check_computeblockversion(chainParams->GetConsensus(), static_cast<Consensus::DeploymentPos>(i));\n         }\n     }\n+\n+    {\n+        // Use regtest/testdummy to ensure we always exercise the\n+        // min_activation_height test, even if we're not using that in a\n+        // live deployment\n+        ArgsManager args;\n+        args.ForceSetArg(\"-vbparams\", \"testdummy:1199145601:1230767999:403200\"); // January 1, 2008 - December 31, 2008, min act height 403200",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611725388",
      "id" : 611725388,
      "line" : 465,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTcyNTM4OA==",
      "original_commit_id" : "dd85d5411c1702c8ae259610fe55050ba212e21e",
      "original_line" : 455,
      "original_position" : 188,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 471,
      "pull_request_review_id" : 633661404,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T15:39:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611725388",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611743831"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611743831"
         }
      },
      "author_association" : "MEMBER",
      "body" : "73d4a706393e6dbd6b6d6b6428f8d3233ac0a2d8 maybe mention \"optional\" in addition to the brackets, as done for e.g, `-rpcbind`\r\n```suggestion\r\n    argsman.AddArg(\"-vbparams=deployment:start:end[:min_activation_height]\", \"Use given start/end times and optional min_activation_height for specified version bits deployment (regtest-only)\", ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::CHAINPARAMS);\r\n\r\n```",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-12T15:42:44Z",
      "diff_hunk" : "@@ -22,7 +22,7 @@ void SetupChainParamsBaseOptions(ArgsManager& argsman)\n                  \"This is intended for regression testing tools and app development. Equivalent to -chain=regtest.\", ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::CHAINPARAMS);\n     argsman.AddArg(\"-segwitheight=<n>\", \"Set the activation height of segwit. -1 to disable. (regtest-only)\", ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-testnet\", \"Use the test chain. Equivalent to -chain=test.\", ArgsManager::ALLOW_ANY, OptionsCategory::CHAINPARAMS);\n-    argsman.AddArg(\"-vbparams=deployment:start:end\", \"Use given start/end times for specified version bits deployment (regtest-only)\", ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::CHAINPARAMS);\n+    argsman.AddArg(\"-vbparams=deployment:start:end[:min_activation_height]\", \"Use given start/end times and min_activation_height for specified version bits deployment (regtest-only)\", ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::CHAINPARAMS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611743831",
      "id" : 611743831,
      "line" : 25,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTc0MzgzMQ==",
      "original_commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "original_line" : 25,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/chainparamsbase.cpp",
      "position" : 5,
      "pull_request_review_id" : 633693551,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T17:59:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611743831",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611802713"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611802713"
         }
      },
      "author_association" : "MEMBER",
      "body" : "dd85d5411c1702c8ae259610fe55050ba212e21e for these four calls to `TestStateSinceHeight(int height, int height_delayed)`\r\n```suggestion\r\n                           .Mine(24000, TestTime(40000), 0).TestActive().TestStateSinceHeight(4000, /* height_delayed */ 15000)\r\n```",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-12T17:00:46Z",
      "diff_hunk" : "@@ -202,9 +236,10 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n                            .Mine(2999, TestTime(19999), 0x200).TestStarted().TestStateSinceHeight(2000) // 49 old blocks\n                            .Mine(3000, TestTime(29999), 0x200).TestLockedIn().TestStateSinceHeight(3000) // 1 old block (so 900 out of the past 1000)\n                            .Mine(3999, TestTime(30001), 0).TestLockedIn().TestStateSinceHeight(3000)\n-                           .Mine(4000, TestTime(30002), 0).TestActive().TestStateSinceHeight(4000)\n-                           .Mine(14333, TestTime(30003), 0).TestActive().TestStateSinceHeight(4000)\n-                           .Mine(24000, TestTime(40000), 0).TestActive().TestStateSinceHeight(4000)\n+                           .Mine(4000, TestTime(30002), 0).TestActiveDelayed().TestStateSinceHeight(4000, 3000) // delayed will not become active until height=15000\n+                           .Mine(14333, TestTime(30003), 0).TestActiveDelayed().TestStateSinceHeight(4000, 3000)\n+                           .Mine(15000, TestTime(40000), 0).TestActive().TestStateSinceHeight(4000, 15000)\n+                           .Mine(24000, TestTime(40000), 0).TestActive().TestStateSinceHeight(4000, 15000)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611802713",
      "id" : 611802713,
      "line" : 242,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTgwMjcxMw==",
      "original_commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "original_line" : 242,
      "original_position" : 202,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 202,
      "pull_request_review_id" : 633693551,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T17:59:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611802713",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611815503"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611815503"
         }
      },
      "author_association" : "MEMBER",
      "body" : "dd07e6da48040dc7eae46bc7941db48d98a669fd can be `const`\r\n```suggestion\r\n    const int min_activation{fuzzed_data_provider.ConsumeIntegralInRange<int>(0, period * max_periods)};\r\n```",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-12T17:20:09Z",
      "diff_hunk" : "@@ -144,32 +147,27 @@ FUZZ_TARGET_INIT(versionbits, initialize)\n         // pick the timestamp to switch based on a block\n         // note states will change *after* these blocks because mediantime lags\n         int start_block = fuzzed_data_provider.ConsumeIntegralInRange<int>(0, period * (max_periods - 3));\n-        int end_block = fuzzed_data_provider.ConsumeIntegralInRange<int>(start_block, period * (max_periods - 3));\n+        int end_block = fuzzed_data_provider.ConsumeIntegralInRange<int>(0, period * (max_periods - 3));\n \n         start_time = block_start_time + start_block * interval;\n         timeout = block_start_time + end_block * interval;\n \n-        assert(start_time <= timeout);\n-\n         // allow for times to not exactly match a block\n         if (fuzzed_data_provider.ConsumeBool()) start_time += interval / 2;\n         if (fuzzed_data_provider.ConsumeBool()) timeout += interval / 2;\n-\n-        // this may make timeout too early; if so, don't run the test\n-        if (start_time > timeout) return;\n     } else {\n         if (fuzzed_data_provider.ConsumeBool()) {\n             start_time = Consensus::BIP9Deployment::ALWAYS_ACTIVE;\n-            timeout = Consensus::BIP9Deployment::NO_TIMEOUT;\n             always_active_test = true;\n         } else {\n-            start_time = 1199145601; // January 1, 2008\n-            timeout = 1230767999;    // December 31, 2008\n+            start_time = Consensus::BIP9Deployment::NEVER_ACTIVE;\n             never_active_test = true;\n         }\n+        timeout = fuzzed_data_provider.ConsumeBool() ? Consensus::BIP9Deployment::NO_TIMEOUT : fuzzed_data_provider.ConsumeIntegral<int64_t>();\n     }\n+    int min_activation = fuzzed_data_provider.ConsumeIntegralInRange<int>(0, period * max_periods);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611815503",
      "id" : 611815503,
      "line" : 168,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMTgxNTUwMw==",
      "original_commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "original_line" : 168,
      "original_position" : 58,
      "original_start_line" : null,
      "path" : "src/test/fuzz/versionbits.cpp",
      "position" : 58,
      "pull_request_review_id" : 633693551,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T17:59:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/611815503",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r612026992"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/612026992"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "-2 would be never active, this is to ensure we execute the test code even if all the actual deployments are always active or never active, to avoid the test code bit rotting",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-12T23:57:03Z",
      "diff_hunk" : "@@ -447,6 +444,15 @@ BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n         }\n     }\n \n+    {\n+        // Use regtest/testdummy to ensure we always exercise some\n+        // deployment that's not always/never active\n+        ArgsManager args;\n+        args.ForceSetArg(\"-vbparams\", \"testdummy:1199145601:1230767999\"); // January 1, 2008 - December 31, 2008",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r612026992",
      "id" : 612026992,
      "in_reply_to_id" : 611719790,
      "line" : 455,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMjAyNjk5Mg==",
      "original_commit_id" : "55ac5f568a3b73d6f1ef4654617fb76e8bcbccdf",
      "original_line" : 451,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 461,
      "pull_request_review_id" : 634052505,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-12T23:57:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/612026992",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r612028221"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/612028221"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It's duplicating the old testdummy parameters. It's a fake chain so the exact times don't matter. The difference between the times can make a difference, but only if the period's short enough that two periods of 10 minute blocks will cover the entire difference.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-13T00:00:22Z",
      "diff_hunk" : "@@ -391,6 +446,16 @@ BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n             check_computeblockversion(chainParams->GetConsensus(), static_cast<Consensus::DeploymentPos>(i));\n         }\n     }\n+\n+    {\n+        // Use regtest/testdummy to ensure we always exercise the\n+        // min_activation_height test, even if we're not using that in a\n+        // live deployment\n+        ArgsManager args;\n+        args.ForceSetArg(\"-vbparams\", \"testdummy:1199145601:1230767999:403200\"); // January 1, 2008 - December 31, 2008, min act height 403200",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r612028221",
      "id" : 612028221,
      "in_reply_to_id" : 611725388,
      "line" : 465,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMjAyODIyMQ==",
      "original_commit_id" : "dd85d5411c1702c8ae259610fe55050ba212e21e",
      "original_line" : 455,
      "original_position" : 188,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 471,
      "pull_request_review_id" : 634053795,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T00:00:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/612028221",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "re CR-ack based on `git diff be7d136..ffe33df`",
      "created_at" : "2021-04-13T01:25:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-818362890",
      "id" : 818362890,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxODM2Mjg5MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-13T01:25:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/818362890",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r612118083"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/612118083"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe add an explicit test for -1/-2 as well?",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-13T04:12:05Z",
      "diff_hunk" : "@@ -447,6 +444,15 @@ BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n         }\n     }\n \n+    {\n+        // Use regtest/testdummy to ensure we always exercise some\n+        // deployment that's not always/never active\n+        ArgsManager args;\n+        args.ForceSetArg(\"-vbparams\", \"testdummy:1199145601:1230767999\"); // January 1, 2008 - December 31, 2008",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r612118083",
      "id" : 612118083,
      "in_reply_to_id" : 611719790,
      "line" : 455,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMjExODA4Mw==",
      "original_commit_id" : "55ac5f568a3b73d6f1ef4654617fb76e8bcbccdf",
      "original_line" : 451,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 461,
      "pull_request_review_id" : 634160864,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T04:12:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/612118083",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r612153280"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/612153280"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Currently taproot on regtest/signet tests the always active (-1) case, and testdummy on mainnet should always test the never active (-2) case, so think this can be left for later cleanup/refactoring.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-13T06:06:23Z",
      "diff_hunk" : "@@ -447,6 +444,15 @@ BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n         }\n     }\n \n+    {\n+        // Use regtest/testdummy to ensure we always exercise some\n+        // deployment that's not always/never active\n+        ArgsManager args;\n+        args.ForceSetArg(\"-vbparams\", \"testdummy:1199145601:1230767999\"); // January 1, 2008 - December 31, 2008",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r612153280",
      "id" : 612153280,
      "in_reply_to_id" : 611719790,
      "line" : 455,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMjE1MzI4MA==",
      "original_commit_id" : "55ac5f568a3b73d6f1ef4654617fb76e8bcbccdf",
      "original_line" : 451,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 461,
      "pull_request_review_id" : 634201457,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T06:06:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/612153280",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r612155621"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/612155621"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sure, no need to force push. I am just dumping ideas.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-13T06:12:16Z",
      "diff_hunk" : "@@ -447,6 +444,15 @@ BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n         }\n     }\n \n+    {\n+        // Use regtest/testdummy to ensure we always exercise some\n+        // deployment that's not always/never active\n+        ArgsManager args;\n+        args.ForceSetArg(\"-vbparams\", \"testdummy:1199145601:1230767999\"); // January 1, 2008 - December 31, 2008",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r612155621",
      "id" : 612155621,
      "in_reply_to_id" : 611719790,
      "line" : 455,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMjE1NTYyMQ==",
      "original_commit_id" : "55ac5f568a3b73d6f1ef4654617fb76e8bcbccdf",
      "original_line" : 451,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 461,
      "pull_request_review_id" : 634204234,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T06:12:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/612155621",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r612403947"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/612403947"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@ajtowns maybe I'm missing something, but `January 1, 2008 - December 31, 2008` is also never active. Or do we use earlier fake dates in the test?\r\n\r\nAh I see: https://github.com/bitcoin/bitcoin/pull/21377#discussion_r612028221 . The casual reader - and me - might understand the test better when using a realistic range, but no need to change things here.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-13T12:34:40Z",
      "diff_hunk" : "@@ -447,6 +444,15 @@ BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n         }\n     }\n \n+    {\n+        // Use regtest/testdummy to ensure we always exercise some\n+        // deployment that's not always/never active\n+        ArgsManager args;\n+        args.ForceSetArg(\"-vbparams\", \"testdummy:1199145601:1230767999\"); // January 1, 2008 - December 31, 2008",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r612403947",
      "id" : 612403947,
      "in_reply_to_id" : 611719790,
      "line" : 455,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMjQwMzk0Nw==",
      "original_commit_id" : "55ac5f568a3b73d6f1ef4654617fb76e8bcbccdf",
      "original_line" : 451,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 461,
      "pull_request_review_id" : 634532044,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T12:37:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/612403947",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm going to try to make this my last comment on this PR because I'm wary of continuously adding noise and disrupting review. I just want to make sure we are all happy with a mix of block height and MTP rather than a consistent use of block height. Personally I just about am but my preference would definitely be a consistent use of block height.\r\n\r\nA minor preference for consistent use of block height from: @achow101 ([link](https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-808901334)) @Sjors ([link](https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-793818708)) @roconnor-blockstream ([link](https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-791956464)) @benthecarman ([link](https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-791967222))  @michaelfolkson @MarcoFalke ([link](https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-813208375)) @instagibbs ([link](https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-813833780))\r\n\r\nA minor preference for mix of block height and MTP from: No one\r\n\r\nEntirely neutral: @harding @jonatack  \r\n\r\nA literal NACK for consistent use of block height from: @ajtowns ([link](https://github.com/bitcoin/bitcoin/pull/21392#issuecomment-808844563))\r\n\r\nA literal NACK for mix of block height and MTP from: @luke-jr ([link](https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-802217810)) @maaku ([link](https://github.com/bitcoin/bitcoin/pull/21393#issuecomment-815698514))\r\n\r\nI'm personally not sure where to put them: @jeremyrubin @ariard \r\n\r\nIf I have mischaracterized anyone's view please message me on IRC or on ##taproot-activation channel and I will update this comment. Please don't comment on the PR as the focus should be on code and testing. However, if people like AJ's PR but they'd prefer consistent block height than mix of block height and MTP (essentially they just don't like BIP 8) then we should be going with this PR, a consistent use of block height and either BIP 9 or a new BIP.\r\n\r\n\r\n\r\n",
      "created_at" : "2021-04-13T13:58:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-818758277",
      "id" : 818758277,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxODc1ODI3Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-13T13:58:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/818758277",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/16323900?v=4",
         "events_url" : "https://api.github.com/users/michaelfolkson/events{/privacy}",
         "followers_url" : "https://api.github.com/users/michaelfolkson/followers",
         "following_url" : "https://api.github.com/users/michaelfolkson/following{/other_user}",
         "gists_url" : "https://api.github.com/users/michaelfolkson/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/michaelfolkson",
         "id" : 16323900,
         "login" : "michaelfolkson",
         "node_id" : "MDQ6VXNlcjE2MzIzOTAw",
         "organizations_url" : "https://api.github.com/users/michaelfolkson/orgs",
         "received_events_url" : "https://api.github.com/users/michaelfolkson/received_events",
         "repos_url" : "https://api.github.com/users/michaelfolkson/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/michaelfolkson/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/michaelfolkson/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/michaelfolkson"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r612482362"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/612482362"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "@Sjors Note that with the updated state machine, it's possible for a real chain (not just a fake one in the unit tests) to become ACTIVE even if starttime/timeout are prior to the genesis block's timestamp: in that case, the first period will be DEFINED, the second STARTED, and the third either LOCKED_IN or FAILED depending on signalling in the second period. Not an issue for chains that are already well past genesis though, so real is limited to regtest, brand new signets, or someone trying to reorg mainnet/testnet3 all the way to genesis.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-13T14:09:17Z",
      "diff_hunk" : "@@ -447,6 +444,15 @@ BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n         }\n     }\n \n+    {\n+        // Use regtest/testdummy to ensure we always exercise some\n+        // deployment that's not always/never active\n+        ArgsManager args;\n+        args.ForceSetArg(\"-vbparams\", \"testdummy:1199145601:1230767999\"); // January 1, 2008 - December 31, 2008",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r612482362",
      "id" : 612482362,
      "in_reply_to_id" : 611719790,
      "line" : 455,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMjQ4MjM2Mg==",
      "original_commit_id" : "55ac5f568a3b73d6f1ef4654617fb76e8bcbccdf",
      "original_line" : 451,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 461,
      "pull_request_review_id" : 634637992,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T14:09:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/612482362",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Corresponding spec text at https://github.com/bitcoin/bips/pull/1104",
      "created_at" : "2021-04-13T17:13:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-818903602",
      "id" : 818903602,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxODkwMzYwMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-13T17:13:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/818903602",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r612747285"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/612747285"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this is behavior is an explicit deviation from bip9.\r\n\r\nIf the last block of the retarget period is fulfilling the threshold condition but with a MTP past with the timeout, the locked_in takes _precedence_ over the failure transition. This sounds contrary to the bip 9 : \"MTP < timeout AND (threshold reached)\" ?\r\n\r\nIf you retouch the branch or as a follow-up, I think it would be worthy to document.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-13T20:16:34Z",
      "diff_hunk" : "@@ -74,12 +74,16 @@ ThresholdState AbstractThresholdConditionChecker::GetStateFor(const CBlockIndex*\n                 }\n                 if (count >= nThreshold) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r612747285",
      "id" : 612747285,
      "line" : 75,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMjc0NzI4NQ==",
      "original_commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "original_line" : 75,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/versionbits.cpp",
      "position" : 42,
      "pull_request_review_id" : 634988489,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T21:02:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/612747285",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-ACK ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-13T20:27:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-819030908",
      "id" : 819030908,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxOTAzMDkwOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-13T20:27:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/819030908",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r612760226"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/612760226"
         }
      },
      "author_association" : "NONE",
      "body" : "Can that precedent/convention be codified somewhere, code or otherwise? Is it already?",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-13T20:38:20Z",
      "diff_hunk" : "@@ -78,16 +78,18 @@ class CMainParams : public CChainParams {\n         consensus.nPowTargetSpacing = 10 * 60;\n         consensus.fPowAllowMinDifficultyBlocks = false;\n         consensus.fPowNoRetargeting = false;\n-        consensus.nRuleChangeActivationThreshold = 1916; // 95% of 2016\n+        consensus.nRuleChangeActivationThreshold = 1815; // 90% of 2016",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r612760226",
      "id" : 612760226,
      "in_reply_to_id" : 601818493,
      "line" : 81,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMjc2MDIyNg==",
      "original_commit_id" : "4c7d858167a7f8cd4cb6b09787f07929d2abc3a1",
      "original_line" : 81,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/chainparams.cpp",
      "position" : 5,
      "pull_request_review_id" : 635005498,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T21:51:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/612760226",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4033651?v=4",
         "events_url" : "https://api.github.com/users/ProofOfKeags/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ProofOfKeags/followers",
         "following_url" : "https://api.github.com/users/ProofOfKeags/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ProofOfKeags/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ProofOfKeags",
         "id" : 4033651,
         "login" : "ProofOfKeags",
         "node_id" : "MDQ6VXNlcjQwMzM2NTE=",
         "organizations_url" : "https://api.github.com/users/ProofOfKeags/orgs",
         "received_events_url" : "https://api.github.com/users/ProofOfKeags/received_events",
         "repos_url" : "https://api.github.com/users/ProofOfKeags/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ProofOfKeags/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ProofOfKeags/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ProofOfKeags"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r612809019"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/612809019"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "See https://github.com/bitcoin/bips/pull/1104/files",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-13T22:11:48Z",
      "diff_hunk" : "@@ -74,12 +74,16 @@ ThresholdState AbstractThresholdConditionChecker::GetStateFor(const CBlockIndex*\n                 }\n                 if (count >= nThreshold) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r612809019",
      "id" : 612809019,
      "in_reply_to_id" : 612747285,
      "line" : 75,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMjgwOTAxOQ==",
      "original_commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "original_line" : 75,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/versionbits.cpp",
      "position" : 42,
      "pull_request_review_id" : 635067127,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T22:11:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/612809019",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r612809523"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/612809523"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe that doesn't clarify the change -- the point is to ensure at least one signalling period ",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-13T22:13:09Z",
      "diff_hunk" : "@@ -74,12 +74,16 @@ ThresholdState AbstractThresholdConditionChecker::GetStateFor(const CBlockIndex*\n                 }\n                 if (count >= nThreshold) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r612809523",
      "id" : 612809523,
      "in_reply_to_id" : 612747285,
      "line" : 75,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMjgwOTUyMw==",
      "original_commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "original_line" : 75,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/versionbits.cpp",
      "position" : 42,
      "pull_request_review_id" : 635067798,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T22:13:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/612809523",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r612810408"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/612810408"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "https://github.com/bitcoin/bips/pull/1104#issuecomment-819068299\r\n\r\nThat's probably what you want to look at.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-13T22:15:30Z",
      "diff_hunk" : "@@ -74,12 +74,16 @@ ThresholdState AbstractThresholdConditionChecker::GetStateFor(const CBlockIndex*\n                 }\n                 if (count >= nThreshold) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r612810408",
      "id" : 612810408,
      "in_reply_to_id" : 612747285,
      "line" : 75,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMjgxMDQwOA==",
      "original_commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "original_line" : 75,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/versionbits.cpp",
      "position" : 42,
      "pull_request_review_id" : 635068950,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T22:15:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/612810408",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r612816233"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/612816233"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this is mostly personal style choice, so more as a general suggestion: if you really just want to get shorter aliases for other expressions, this may be even better (guaranteed to have the same type, and will avoid a copy in case it's a nontrivial object).\r\n\r\n```c++\r\nconst auto& bit = params.vDeployments[dep].bit;\r\n...\r\n```\r\n\r\nEven if the right hand is a nontrivial expression that computes a temporary, lifetime extension makes this formula safe to use.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-13T22:29:39Z",
      "diff_hunk" : "@@ -242,81 +290,118 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n     }\n }\n \n-BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n+/** Check that ComputeBlockVersion will set the appropriate bit correctly */\n+static void check_computeblockversion(const Consensus::Params& params, Consensus::DeploymentPos dep)\n {\n-    // Check that ComputeBlockVersion will set the appropriate bit correctly\n-    // on mainnet.\n-    const auto chainParams = CreateChainParams(*m_node.args, CBaseChainParams::MAIN);\n-    const Consensus::Params &mainnetParams = chainParams->GetConsensus();\n+    // This implicitly uses versionbitscache, so clear it every time\n+    versionbitscache.Clear();\n+\n+    int64_t bit = params.vDeployments[dep].bit;\n+    int64_t nStartTime = params.vDeployments[dep].nStartTime;\n+    int64_t nTimeout = params.vDeployments[dep].nTimeout;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r612816233",
      "id" : 612816233,
      "in_reply_to_id" : 611701546,
      "line" : 301,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMjgxNjIzMw==",
      "original_commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "original_line" : 301,
      "original_position" : 255,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 255,
      "pull_request_review_id" : 635075890,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-15T01:51:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/612816233",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r613347485"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613347485"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If overlapping deployments are an issue (I don't think they are as long as bits are not re-used for to-be-deployed changes), we could switch to the version of this pull requests that avoids them: https://github.com/bitcoin/bitcoin/pull/21377#pullrequestreview-619480897. (That version also has the min_activation based on height). I liked that version better because it really was a minimal change from BIP 9, but I am not sure what others think about picking that version.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-14T15:23:24Z",
      "diff_hunk" : "@@ -325,26 +410,62 @@ BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n \n     // Mine one period worth of blocks, and check that the bit will be on for the\n     // next period.\n-    lastBlock = secondChain.Mine(mainnetParams.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK((ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit)) != 0);\n+    lastBlock = secondChain.Mine(params.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+    BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\n \n     // Mine another period worth of blocks, signaling the new bit.\n-    lastBlock = secondChain.Mine(mainnetParams.nMinerConfirmationWindow * 2, nTime, VERSIONBITS_TOP_BITS | (1<<bit)).Tip();\n+    lastBlock = secondChain.Mine(params.nMinerConfirmationWindow * 2, nTime, VERSIONBITS_TOP_BITS | (1<<bit)).Tip();\n     // After one period of setting the bit on each block, it should have locked in.\n     // We keep setting the bit for one more period though, until activation.\n-    BOOST_CHECK((ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit)) != 0);\n+    BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\n \n     // Now check that we keep mining the block until the end of this period, and\n     // then stop at the beginning of the next period.\n-    lastBlock = secondChain.Mine((mainnetParams.nMinerConfirmationWindow * 3) - 1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK((ComputeBlockVersion(lastBlock, mainnetParams) & (1 << bit)) != 0);\n-    lastBlock = secondChain.Mine(mainnetParams.nMinerConfirmationWindow * 3, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit), 0);\n-\n-    // Finally, verify that after a soft fork has activated, CBV no longer uses\n-    // VERSIONBITS_LAST_OLD_BLOCK_VERSION.\n-    //BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & VERSIONBITS_TOP_MASK, VERSIONBITS_TOP_BITS);\n+    lastBlock = secondChain.Mine((params.nMinerConfirmationWindow * 3) - 1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+    BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1 << bit)) != 0);\n+    lastBlock = secondChain.Mine(params.nMinerConfirmationWindow * 3, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+\n+    if (lastBlock->nHeight + 1 < min_activation_height) {\n+        // check signalling continues while min_activation_height is not reached\n+        lastBlock = secondChain.Mine(min_activation_height - 1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+        BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1 << bit)) != 0);\n+        // then reach min_activation_height, which was already REQUIRE'd to start a new period\n+        lastBlock = secondChain.Mine(min_activation_height, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+    }\n+\n+    // Check that we don't signal after activation\n+    BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\n }\n \n+BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n+{\n+    // check that any deployment on any chain can conceivably reach both\n+    // ACTIVE and FAILED states in roughly the way we expect\n+    for (const auto& chain_name : {CBaseChainParams::MAIN, CBaseChainParams::TESTNET, CBaseChainParams::SIGNET, CBaseChainParams::REGTEST}) {\n+        const auto chainParams = CreateChainParams(*m_node.args, chain_name);\n+        for (int i = 0; i < (int)Consensus::MAX_VERSION_BITS_DEPLOYMENTS; ++i) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r613347485",
      "id" : 613347485,
      "in_reply_to_id" : 611492633,
      "line" : 446,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMzM0NzQ4NQ==",
      "original_commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "original_line" : 446,
      "original_position" : 452,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 452,
      "pull_request_review_id" : 635755881,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:23:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613347485",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. I'm in the process of reviewing the code.",
      "created_at" : "2021-04-14T17:14:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-819682434",
      "id" : 819682434,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxOTY4MjQzNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-14T17:14:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/819682434",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Concept ACK.\r\nApproach ACK.",
      "created_at" : "2021-04-14T17:23:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-819687374",
      "id" : 819687374,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxOTY4NzM3NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-14T17:23:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/819687374",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/21127776?v=4",
         "events_url" : "https://api.github.com/users/molxyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/molxyz/followers",
         "following_url" : "https://api.github.com/users/molxyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/molxyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/molxyz",
         "id" : 21127776,
         "login" : "molxyz",
         "node_id" : "MDQ6VXNlcjIxMTI3Nzc2",
         "organizations_url" : "https://api.github.com/users/molxyz/orgs",
         "received_events_url" : "https://api.github.com/users/molxyz/received_events",
         "repos_url" : "https://api.github.com/users/molxyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/molxyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/molxyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/molxyz"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Concept ACK. Reviewing the code now.",
      "created_at" : "2021-04-14T17:58:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-819720013",
      "id" : 819720013,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxOTcyMDAxMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-14T17:58:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/819720013",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4033651?v=4",
         "events_url" : "https://api.github.com/users/ProofOfKeags/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ProofOfKeags/followers",
         "following_url" : "https://api.github.com/users/ProofOfKeags/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ProofOfKeags/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ProofOfKeags",
         "id" : 4033651,
         "login" : "ProofOfKeags",
         "node_id" : "MDQ6VXNlcjQwMzM2NTE=",
         "organizations_url" : "https://api.github.com/users/ProofOfKeags/orgs",
         "received_events_url" : "https://api.github.com/users/ProofOfKeags/received_events",
         "repos_url" : "https://api.github.com/users/ProofOfKeags/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ProofOfKeags/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ProofOfKeags/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ProofOfKeags"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Concept ACK",
      "created_at" : "2021-04-14T18:04:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-819723508",
      "id" : 819723508,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxOTcyMzUwOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-14T18:04:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/819723508",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/47448562?v=4",
         "events_url" : "https://api.github.com/users/zndtoshi/events{/privacy}",
         "followers_url" : "https://api.github.com/users/zndtoshi/followers",
         "following_url" : "https://api.github.com/users/zndtoshi/following{/other_user}",
         "gists_url" : "https://api.github.com/users/zndtoshi/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/zndtoshi",
         "id" : 47448562,
         "login" : "zndtoshi",
         "node_id" : "MDQ6VXNlcjQ3NDQ4NTYy",
         "organizations_url" : "https://api.github.com/users/zndtoshi/orgs",
         "received_events_url" : "https://api.github.com/users/zndtoshi/received_events",
         "repos_url" : "https://api.github.com/users/zndtoshi/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/zndtoshi/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/zndtoshi/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/zndtoshi"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Concept ACK\r\nApproach ACK",
      "created_at" : "2021-04-14T18:13:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-819729589",
      "id" : 819729589,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxOTcyOTU4OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-14T18:13:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/819729589",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1362?v=4",
         "events_url" : "https://api.github.com/users/kastravec/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kastravec/followers",
         "following_url" : "https://api.github.com/users/kastravec/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kastravec/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kastravec",
         "id" : 1362,
         "login" : "kastravec",
         "node_id" : "MDQ6VXNlcjEzNjI=",
         "organizations_url" : "https://api.github.com/users/kastravec/orgs",
         "received_events_url" : "https://api.github.com/users/kastravec/received_events",
         "repos_url" : "https://api.github.com/users/kastravec/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kastravec/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kastravec/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kastravec"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@luke-jr you made [the same comment](https://github.com/bitcoin/bips/pull/1104#pullrequestreview-634969249) on the BIP. As others have asked, can you elaborate on it? The BIP or mailinglist is probably the best place for that. In particular, when you say \"BIP 8\" are you arguing to switch back to #21392 or do you want a full on `LOT=true` BIP 8 implementation?",
      "created_at" : "2021-04-14T18:59:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-819758074",
      "id" : 819758074,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxOTc1ODA3NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-14T18:59:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/819758074",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Concept ACK.\r\nApproach ACK.",
      "created_at" : "2021-04-14T19:13:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-819766540",
      "id" : 819766540,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxOTc2NjU0MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-14T19:13:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/819766540",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/45769237?v=4",
         "events_url" : "https://api.github.com/users/guerillaV2/events{/privacy}",
         "followers_url" : "https://api.github.com/users/guerillaV2/followers",
         "following_url" : "https://api.github.com/users/guerillaV2/following{/other_user}",
         "gists_url" : "https://api.github.com/users/guerillaV2/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/guerillaV2",
         "id" : 45769237,
         "login" : "guerillaV2",
         "node_id" : "MDQ6VXNlcjQ1NzY5MjM3",
         "organizations_url" : "https://api.github.com/users/guerillaV2/orgs",
         "received_events_url" : "https://api.github.com/users/guerillaV2/received_events",
         "repos_url" : "https://api.github.com/users/guerillaV2/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/guerillaV2/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/guerillaV2/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/guerillaV2"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Concept ACK.\r\nApproach ACK.",
      "created_at" : "2021-04-14T19:41:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-819783730",
      "id" : 819783730,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxOTc4MzczMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-14T19:41:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/819783730",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/518536?v=4",
         "events_url" : "https://api.github.com/users/cnavigato/events{/privacy}",
         "followers_url" : "https://api.github.com/users/cnavigato/followers",
         "following_url" : "https://api.github.com/users/cnavigato/following{/other_user}",
         "gists_url" : "https://api.github.com/users/cnavigato/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/cnavigato",
         "id" : 518536,
         "login" : "cnavigato",
         "node_id" : "MDQ6VXNlcjUxODUzNg==",
         "organizations_url" : "https://api.github.com/users/cnavigato/orgs",
         "received_events_url" : "https://api.github.com/users/cnavigato/received_events",
         "repos_url" : "https://api.github.com/users/cnavigato/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/cnavigato/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/cnavigato/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/cnavigato"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ACK ffe33dfbd4c3b11e3475b022b6c1dd077613de79\r\n\r\nI haven't been a Bitcoin developer for several years now but I am a user and investor with a solid technical background, having materially contributed to I believe every intentional consensus change since Satoshi's last.  I still follow along with some technical developments, including taproot activation related PRs.\r\n\r\nI've reviewed the PR and (AFAIK) all the publicly available conversation and spoken to many users I know in the ecosystem.  From my research and discussion it is unambiguous that this is not just perfectly acceptable but a good path forward and also extremely broadly supported.  Generally I've found users are of the perspective that whatever activation gets taproot activated quickly without causing relevant problems is a good thing, along with a *lot* of frustration over what they perceive to be arguing over pointless things.\r\n",
      "created_at" : "2021-04-14T19:56:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-819792337",
      "id" : 819792337,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxOTc5MjMzNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-14T20:12:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/819792337",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r613559485"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613559485"
         }
      },
      "author_association" : "NONE",
      "body" : "nit: Apologies if this is bikeshedding, but the asymmetry of `<` and `>` causes more mental load than the code it replaces since inequality is commutative. It took me a sec to wrap my head around it and I wonder if something like\r\n```suggestion\r\n        if (vDeploymentParams.size() != 3 && vDeploymentParams.size() != 4) {\r\n```\r\nwould be more readable. Obviously this is not strictly necessary, and if more sizes become permissible than just the two acceptable here, the code you wrote would be more future proof.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-14T20:18:07Z",
      "diff_hunk" : "@@ -492,22 +503,26 @@ void CRegTestParams::UpdateActivationParametersFromArgs(const ArgsManager& args)\n     for (const std::string& strDeployment : args.GetArgs(\"-vbparams\")) {\n         std::vector<std::string> vDeploymentParams;\n         boost::split(vDeploymentParams, strDeployment, boost::is_any_of(\":\"));\n-        if (vDeploymentParams.size() != 3) {\n-            throw std::runtime_error(\"Version bits parameters malformed, expecting deployment:start:end\");\n+        if (vDeploymentParams.size() < 3 || 4 < vDeploymentParams.size()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r613559485",
      "id" : 613559485,
      "line" : 506,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMzU1OTQ4NQ==",
      "original_commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "original_line" : 506,
      "original_position" : 104,
      "original_start_line" : null,
      "path" : "src/chainparams.cpp",
      "position" : 104,
      "pull_request_review_id" : 635005498,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T21:51:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613559485",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4033651?v=4",
         "events_url" : "https://api.github.com/users/ProofOfKeags/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ProofOfKeags/followers",
         "following_url" : "https://api.github.com/users/ProofOfKeags/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ProofOfKeags/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ProofOfKeags",
         "id" : 4033651,
         "login" : "ProofOfKeags",
         "node_id" : "MDQ6VXNlcjQwMzM2NTE=",
         "organizations_url" : "https://api.github.com/users/ProofOfKeags/orgs",
         "received_events_url" : "https://api.github.com/users/ProofOfKeags/received_events",
         "repos_url" : "https://api.github.com/users/ProofOfKeags/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ProofOfKeags/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ProofOfKeags/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ProofOfKeags"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r613562505"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613562505"
         }
      },
      "author_association" : "NONE",
      "body" : "nit: Is it possible for the deployment parameters to actually exceed 4? In the above checks it seems that we rule out any case where the deployment params size strictly exceeds 4. It seems that the only permissible cases here are sizes 3 and 4, which imo makes the `>= 4` test misleading, implying it could be 5+. Obviously the semantics here are identical considering the entire block of code as a whole, but I wonder if the ambiguity could be reduced.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-14T20:23:43Z",
      "diff_hunk" : "@@ -492,22 +503,26 @@ void CRegTestParams::UpdateActivationParametersFromArgs(const ArgsManager& args)\n     for (const std::string& strDeployment : args.GetArgs(\"-vbparams\")) {\n         std::vector<std::string> vDeploymentParams;\n         boost::split(vDeploymentParams, strDeployment, boost::is_any_of(\":\"));\n-        if (vDeploymentParams.size() != 3) {\n-            throw std::runtime_error(\"Version bits parameters malformed, expecting deployment:start:end\");\n+        if (vDeploymentParams.size() < 3 || 4 < vDeploymentParams.size()) {\n+            throw std::runtime_error(\"Version bits parameters malformed, expecting deployment:start:end[:min_activation_height]\");\n         }\n         int64_t nStartTime, nTimeout;\n+        int min_activation_height = 0;\n         if (!ParseInt64(vDeploymentParams[1], &nStartTime)) {\n             throw std::runtime_error(strprintf(\"Invalid nStartTime (%s)\", vDeploymentParams[1]));\n         }\n         if (!ParseInt64(vDeploymentParams[2], &nTimeout)) {\n             throw std::runtime_error(strprintf(\"Invalid nTimeout (%s)\", vDeploymentParams[2]));\n         }\n+        if (vDeploymentParams.size() >= 4 && !ParseInt32(vDeploymentParams[3], &min_activation_height)) {\n+            throw std::runtime_error(strprintf(\"Invalid min_activation_height (%s)\", vDeploymentParams[3]));\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r613562505",
      "id" : 613562505,
      "in_reply_to_id" : 608871691,
      "line" : 519,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMzU2MjUwNQ==",
      "original_commit_id" : "aa6a95de12b265cd3dc16b2d1303b89a20331a56",
      "original_line" : 519,
      "original_position" : 91,
      "original_start_line" : null,
      "path" : "src/chainparams.cpp",
      "position" : 117,
      "pull_request_review_id" : 635005498,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T21:51:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613562505",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4033651?v=4",
         "events_url" : "https://api.github.com/users/ProofOfKeags/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ProofOfKeags/followers",
         "following_url" : "https://api.github.com/users/ProofOfKeags/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ProofOfKeags/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ProofOfKeags",
         "id" : 4033651,
         "login" : "ProofOfKeags",
         "node_id" : "MDQ6VXNlcjQwMzM2NTE=",
         "organizations_url" : "https://api.github.com/users/ProofOfKeags/orgs",
         "received_events_url" : "https://api.github.com/users/ProofOfKeags/received_events",
         "repos_url" : "https://api.github.com/users/ProofOfKeags/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ProofOfKeags/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ProofOfKeags/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ProofOfKeags"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : ">In particular, when you say \"BIP 8\" are you arguing to switch back to #21392 or do you want a full on LOT=true BIP 8 implementation?\r\n\r\nA full BIP8 with LOT=True would be ideal, but #21392 was at least an acceptable compromise considering the lack of consensus around LOT.",
      "created_at" : "2021-04-14T20:47:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-819821398",
      "id" : 819821398,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxOTgyMTM5OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-14T20:47:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/819821398",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I have few questions and issues:\r\n\r\n1. Is this strictly based on BIP 9 or modified version of BIP 9? If modified, what are the changes and reasons for it?\r\n\r\n2. What are the trade-offs involved in using ST|BIP9|MTP vs ST|BIP8|Block Height?\r\n\r\n3. Use of BIP 9:\r\n\r\nQuoting few things from https://medium.com/@elombrozo/forks-signaling-and-activation-d60b6abda49a since I had followed all the things in 2017 and Eric Lombrozo had been a part of lot of discussions I read or watched in different podcasts.\r\n\r\n_In hindsight, itâs become clear that miner activation of soft forks cannot be relied upon when there exists a divergence of interests between miners and users. In the cooperative case, it is a tried and tested mechanism which if done correctly is known to work smoothly. However, in the **adversarial case** it simply does not work. BIP9 effectively gives a small amount of hashpower veto power over any soft fork activation no matter how widely popular it is among users and industry._\r\n\r\n_So given these lessons of the past, it seems that a **combination of MASF and UASF** will be required for future deployments to properly address these **adversarial scenarios**. It is **unlikely BIP9 will be ever used again**._\r\n\r\nQuoting few things from https://medium.com/hackernoon/peter-todd-on-the-essence-of-bitcoin-b8d0c6d16f43\r\n\r\n_No, definitely not. No. Most programmers in general, do you not have the capability to work on this stuff, because they donât think it **adversarially**. Itâs a tough thing for people to imagine. Most people are just not used to imagining, âAll right, **what are the bad things that could happen**?â_\r\n\r\nLot of people think its okay to ignore few things in this activation because we all want taproot and some think being prepared is PTSD from 2017. I don't agree with it because its Bitcoin and we need to be prepared for every bad scenario. We don't trust anyone if using full nodes for Bitcoin, why should we trust the miners who got incentives to mine blocks and in some case incentives to attack the network? \r\n\r\nI had mentioned few things in this email: https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2021-March/018613.html\r\n\r\nThere was one line written on the wall of a school I still remember: **The more we sweat in peace, the less we bleed in war**\r\n\r\n\r\n4. Use of MTP:\r\n\r\nAlthough SE answer and few other posts mentioned few trade-offs, I am still not sure if using MTP has no risk in a soft fork activation mechanism. Coinflip even if not considered for deciding MTP vs block height was wrong way to decide something involved in soft fork activation mechanism which can change lot of risk/rewards for miners to attack.\r\n\r\nhttps://bitcoin.stackexchange.com/questions/103854/should-block-height-or-mtp-or-a-mixture-of-both-be-used-in-a-soft-fork-activatio\r\n\r\n5. There are several occasions when something was preferred because it will take less time to review or less time to code and make changes. I understand its a \"Speedy\" Trial and things need to be done in less time with less people who go the right skills and experience, however this approach for development in Bitcoin Core (90% nodes use Bitcoin Core implementation) will not be good in long term. Maybe we need more people who can help and more people who can donate for such efforts. I appreciate everything done by @ajtowns and @achow101, also everyone who reviewed the PR but things can be improved. Bitcoin Core is [4th most critical C++ OSS project](https://twitter.com/_jonasschnelli_/status/1337351770192961540) and most of the users prefer using it when comparing usage of different implementations. \r\n\r\nhttp://gnusha.org/taproot-activation/\r\n\r\n6. Its not just @luke-jr who has different opinion about the approach and even if he is alone with a different idea that may work better, we should always respect his opinion as well. I have seen lot of comments in IRC logs which doesn't look good.",
      "created_at" : "2021-04-14T21:01:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-819829574",
      "id" : 819829574,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxOTgyOTU3NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-14T21:13:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/819829574",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@prayank23 The activation mechanism is not the same as BIP9.   The spec is at https://github.com/bitcoin/bips/pull/1104  because this is \"speedy trial\" and not BIP9 it has shorter duration, a lower threshold, and a minimum activation point (to give people adequate time to update).\r\n\r\nIn terms of preparation-- it is not feasible to prepare when you don't know what you're preparing for and the preparations come at great cost.  The idea with speedy trial is that is an inexpensive way to learn the lay of the land such that further moves (if required at all) can be informed by actual objective information,  rather than just having community members set their subjective speculations, hopes, and fears in a battle of rhetoric against each other.  Preparing for the wrong thing can easily be worse than not preparing at all.\r\n\r\nIt sounds like you may misunderstand what the \"speedy\" part refers to here-- it isn't about implementation complexity.  It's about learning how activation might activate or fail, in detail, with objective facts quickly.  The implementation here is also designed to leverage the existing stored testing and experience because that is just prudent engineering and no amount of additional time or added developers can fully replace that. Even with all the resources in the world, you're better off not introducing changes without good cause-- those resources can better be used some other way. \r\n\r\nAs such the most valuable thing for ST to accomplish is to be over with soon (activated or expired) and to do so without continuing to burn up goodwill among community members fighting over opinions rather than facts.  If it activates, GREAT.  If it doesn't activate-- that's great too-- because we will have learned about how it didn't activate and that will inform the required preparations and tradeoffs for further efforts.  The veto comment is directly addressed by ST (and also really was partially a criticism not of BIP9 but of the fact that the NODE_WITNESS changes made segwit difficult to reissue, leading to a mistaken belief that if it didn't activate it couldn't be activated later.)\r\n\r\nST is in some sense the opposite of trusting.  Instead of \"trusting\" participants to behave in particular ways, we just set things up so that no matter what happens things will be okay and then we see what actually happens.  This is much better than speculating, which is really just trusting our guesses and trusting others to behave in particular ways (perhaps you trust them to behave badly, but that is still an expectation).  ST is all about minimizing subjective assumptions in favor of learning objective facts.\r\n\r\nIn fact, if anything, I'd characterize allowing a broadly supported improvement to get jammed over the fine details of activation is a perfect example of failing to think adversarially.   Even to someone who is of the view that the fine details of the activation here aren't the best possible under their preferred weighing of the tradeoffs should recognize that after ST is over (via activation or expiration) these activation criteria will not be relevant *at all* anymore.  This puts a strict upper bound on how much these details matter.\r\n\r\n> Coinflip even if not considered for deciding MTP vs block height\r\n\r\nSince it appears you know it wasn't actually used bringing it up here is not really appropriate. Please don't do that.  I'd like no more to discuss with you at length why I am confident you are mistaken, but it would be entirely off-topic here.\r\n",
      "created_at" : "2021-04-14T21:19:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-819839941",
      "id" : 819839941,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxOTgzOTk0MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-14T21:33:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/819839941",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@prayank23 \r\n\r\n> 1. Is this strictly based on BIP 9 or modified version of BIP 9? If modified, what are the changes and reasons for it?\r\n\r\nIt's modified it two ways.  First, the timeout is only evaluated at the end of a STARTED period after all signaling blocks in that period have been counted.  This prevents miners from skipping over the signaling period altogether; that's mainly a concern for attempts to require mandatory signaling (e.g. a UASF) but it also simplifies things here a bit.\r\n\r\nSecond, it contains a minimum_activation_height parameter that delays activation of a locked_in fork until the specified height, making it compatible with the ST proposal.\r\n\r\n> 2. What are the trade-offs involved in using ST|BIP9|MTP vs ST|BIP8|Block Height?\r\n\r\nST|BIP9|MTP is compatible with activating future soft forks on signet.  ST|BIP9|Height is slightly simpler to review due to heights generally being monotonicly increasing and always being impossible to skip (although, again, this PR eliminates the skipping problem for MTP).\r\n\r\n>     3. Use of BIP 9:\r\n>\r\n> [Quoting from Eric Lombrozo] itâs become clear that miner activation of soft forks cannot be relied upon when there exists a divergence of interests between miners and users.\r\n\r\nThat remains clear.  In the case of taproot, miners have said that there's a convergence of interests and Speedy *Trial* is an attempt to see if that's actually the case.  It's designed either quickly succeed or quickly fail so that we can, correspondingly, quickly move on to the next thing or get everyone in agreement that we need some sort of UASF.\r\n\r\n> it seems that a **combination of MASF and UASF** will be required for future deployments to properly address these **adversarial scenarios**. \r\n\r\nST is exactly that.  It's a MASF which, if it fails, is almost certain to lead to a UASF.  The insight here is that we don't need to bundle a MASF and a UASF together; we can do them independently to allow us to focus on one piece of the puzzle at a time.\r\n\r\n> It is **unlikely BIP9 will be ever used again**._\r\n\r\nIf you'd like, I believe I can do some digging to find other developers who disagreed with Lombrozo at the time he said that.  Moreover, it's also worth noting that what's proposed here is a modified version of BIP9---it has much the same relationship with BIP9 that BIP8 itself has with BIP9: an re-use of the same basic mechanism but tweaked for slightly different goals.\r\n\r\n>     1. Use of MTP:\r\n> Although SE answer and few other posts mentioned few trade-offs, I am still not sure if using MTP has no risk in a soft fork activation mechanism.\r\n\r\nNo change to consensus code is without risk.  MTP is slightly more complex to think about than height, but IMO not to the degree height should automatically outweigh any advantage of MTP.\r\n\r\n \r\n> I understand its a \"Speedy\" Trial and things need to be done in less time with less people who go the right skills and experience\r\n\r\nThis PR has so far been reviewed in depth by most of the experts I would expect to review any other activation mechanism.  I don't think we've short circuited the review process; indeed, perhaps because of the controversy, I think we've all been more careful here than we might've been had there been no controversy at all.\r\n\r\n>     1. Its not just @luke-jr who has different opinion about the approach\r\n\r\nTo my knowledge, the technical objectors to this approach are:\r\n\r\n1. @luke-jr, on the basis that height is better than MTP and that he believes there's consensus to use BIP8.  IMO, the differences between height and MTP aren't significant enough to warrant a NACK and the previous widespread discussion about BIP8 doesn't represent consensus any more than widespread discussion of a block size increase in early 2015 represented consensus to hard fork.\r\n\r\n2. @maaku, on the basis that using MTP encourages miners to manipulate their block times and that BIP8/heights are easier and safer to use for non-devs creating their own UASFs.  IMO, significant time manipulation problems are extremely unlikely in the first place, super duper extremely unlikely for a ST, and are easier to mitigate than equivalent miner attempts to delay BIP8.  Also IMO, with a little bit of documentation, we can make it just as easy and safe for non-devs to create UASFs using this PR and MTP as for using BIP8.\r\n\r\n3. @michaelfolkson who I think has only echoed the arguments above.\r\n\r\nSeveral other people have expressed a preference for heights over MTP, but I personally don't think that's a reason to prevent merging this PR.  We will hopefully have many additional opportunities to activate feature-adding soft forks in the future, so we can iterate on the mechanism as we go---just as we've done from BIP30 flag day to BIP34 ISM to BIP9 to BIP148 to this PR.  It's better to do that work in parallel with waiting to see if miners use ST to lock in taproot than it is to delay taproot further while we argue over the subjective value of different people's preferences.\r\n\r\n(Note: I didn't see @gmaxwell's reply to your comment until I was previewing my draft of this comment; sorry if there's any redundancy.)",
      "created_at" : "2021-04-14T22:42:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-819896214",
      "id" : 819896214,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxOTg5NjIxNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-14T22:42:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/819896214",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/61096?v=4",
         "events_url" : "https://api.github.com/users/harding/events{/privacy}",
         "followers_url" : "https://api.github.com/users/harding/followers",
         "following_url" : "https://api.github.com/users/harding/following{/other_user}",
         "gists_url" : "https://api.github.com/users/harding/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/harding",
         "id" : 61096,
         "login" : "harding",
         "node_id" : "MDQ6VXNlcjYxMDk2",
         "organizations_url" : "https://api.github.com/users/harding/orgs",
         "received_events_url" : "https://api.github.com/users/harding/received_events",
         "repos_url" : "https://api.github.com/users/harding/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/harding/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/harding/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/harding"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r613702341"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613702341"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This can be addressed in a followup:\r\n```bash\r\nwarning: comparison of integers of different signs: 'const unsigned int' and 'const int' [-Wsign-compare]\r\n...\r\ntest/versionbits_tests.cpp:271:9: note: in instantiation of function template specialization 'boost::test_tools::tt_detail::check_frwd<boost::test_tools::tt_detail::equal_impl_frwd, unsigned int, int>' requested here\r\n        BOOST_CHECK_EQUAL(mainnetParams.vDeployments[i].min_activation_height % mainnetParams.nMinerConfirmationWindow, 0);\r\n```",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-15T01:49:30Z",
      "diff_hunk" : "@@ -226,6 +267,13 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n         // Make sure that no deployment tries to set an invalid bit.\n         BOOST_CHECK_EQUAL(bitmask & ~(uint32_t)VERSIONBITS_TOP_MASK, bitmask);\n \n+        // Check min_activation_height is on a retarget boundary\n+        BOOST_CHECK_EQUAL(mainnetParams.vDeployments[i].min_activation_height % mainnetParams.nMinerConfirmationWindow, 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r613702341",
      "id" : 613702341,
      "line" : 271,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMzcwMjM0MQ==",
      "original_commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "original_line" : 271,
      "original_position" : 229,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 229,
      "pull_request_review_id" : 636207422,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-15T01:49:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613702341",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r613824022"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613824022"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I can't reproduce (#19123), but the warning seems correct:\r\n\r\n```cpp\r\n#include <iostream>\r\n#include <type_traits>\r\n#include <cstdint>\r\n \r\nint main()\r\n{\r\n  std::cout << std::boolalpha;\r\n\r\n  std::cout << std::is_same_v<int     , decltype(int{1} % unsigned{2})> << '\\n'; // false\r\n  std::cout << std::is_same_v<unsigned, decltype(int{1} % unsigned{2})> << '\\n'; // true\r\n}\r\n```",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-15T07:31:17Z",
      "diff_hunk" : "@@ -226,6 +267,13 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n         // Make sure that no deployment tries to set an invalid bit.\n         BOOST_CHECK_EQUAL(bitmask & ~(uint32_t)VERSIONBITS_TOP_MASK, bitmask);\n \n+        // Check min_activation_height is on a retarget boundary\n+        BOOST_CHECK_EQUAL(mainnetParams.vDeployments[i].min_activation_height % mainnetParams.nMinerConfirmationWindow, 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r613824022",
      "id" : 613824022,
      "in_reply_to_id" : 613702341,
      "line" : 271,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMzgyNDAyMg==",
      "original_commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "original_line" : 271,
      "original_position" : 229,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 229,
      "pull_request_review_id" : 636355998,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-15T07:31:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613824022",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r613841600"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613841600"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added test in #21691",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-15T07:57:54Z",
      "diff_hunk" : "@@ -325,26 +410,62 @@ BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n \n     // Mine one period worth of blocks, and check that the bit will be on for the\n     // next period.\n-    lastBlock = secondChain.Mine(mainnetParams.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK((ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit)) != 0);\n+    lastBlock = secondChain.Mine(params.nMinerConfirmationWindow, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+    BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\n \n     // Mine another period worth of blocks, signaling the new bit.\n-    lastBlock = secondChain.Mine(mainnetParams.nMinerConfirmationWindow * 2, nTime, VERSIONBITS_TOP_BITS | (1<<bit)).Tip();\n+    lastBlock = secondChain.Mine(params.nMinerConfirmationWindow * 2, nTime, VERSIONBITS_TOP_BITS | (1<<bit)).Tip();\n     // After one period of setting the bit on each block, it should have locked in.\n     // We keep setting the bit for one more period though, until activation.\n-    BOOST_CHECK((ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit)) != 0);\n+    BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1<<bit)) != 0);\n \n     // Now check that we keep mining the block until the end of this period, and\n     // then stop at the beginning of the next period.\n-    lastBlock = secondChain.Mine((mainnetParams.nMinerConfirmationWindow * 3) - 1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK((ComputeBlockVersion(lastBlock, mainnetParams) & (1 << bit)) != 0);\n-    lastBlock = secondChain.Mine(mainnetParams.nMinerConfirmationWindow * 3, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n-    BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & (1<<bit), 0);\n-\n-    // Finally, verify that after a soft fork has activated, CBV no longer uses\n-    // VERSIONBITS_LAST_OLD_BLOCK_VERSION.\n-    //BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, mainnetParams) & VERSIONBITS_TOP_MASK, VERSIONBITS_TOP_BITS);\n+    lastBlock = secondChain.Mine((params.nMinerConfirmationWindow * 3) - 1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+    BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1 << bit)) != 0);\n+    lastBlock = secondChain.Mine(params.nMinerConfirmationWindow * 3, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+\n+    if (lastBlock->nHeight + 1 < min_activation_height) {\n+        // check signalling continues while min_activation_height is not reached\n+        lastBlock = secondChain.Mine(min_activation_height - 1, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+        BOOST_CHECK((ComputeBlockVersion(lastBlock, params) & (1 << bit)) != 0);\n+        // then reach min_activation_height, which was already REQUIRE'd to start a new period\n+        lastBlock = secondChain.Mine(min_activation_height, nTime, VERSIONBITS_LAST_OLD_BLOCK_VERSION).Tip();\n+    }\n+\n+    // Check that we don't signal after activation\n+    BOOST_CHECK_EQUAL(ComputeBlockVersion(lastBlock, params) & (1<<bit), 0);\n }\n \n+BOOST_AUTO_TEST_CASE(versionbits_computeblockversion)\n+{\n+    // check that any deployment on any chain can conceivably reach both\n+    // ACTIVE and FAILED states in roughly the way we expect\n+    for (const auto& chain_name : {CBaseChainParams::MAIN, CBaseChainParams::TESTNET, CBaseChainParams::SIGNET, CBaseChainParams::REGTEST}) {\n+        const auto chainParams = CreateChainParams(*m_node.args, chain_name);\n+        for (int i = 0; i < (int)Consensus::MAX_VERSION_BITS_DEPLOYMENTS; ++i) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r613841600",
      "id" : 613841600,
      "in_reply_to_id" : 611492633,
      "line" : 446,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMzg0MTYwMA==",
      "original_commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "original_line" : 446,
      "original_position" : 452,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 452,
      "pull_request_review_id" : 636378755,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-15T07:57:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613841600",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r613841828"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613841828"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed in #21691",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-15T07:58:14Z",
      "diff_hunk" : "@@ -226,6 +267,13 @@ BOOST_AUTO_TEST_CASE(versionbits_test)\n         // Make sure that no deployment tries to set an invalid bit.\n         BOOST_CHECK_EQUAL(bitmask & ~(uint32_t)VERSIONBITS_TOP_MASK, bitmask);\n \n+        // Check min_activation_height is on a retarget boundary\n+        BOOST_CHECK_EQUAL(mainnetParams.vDeployments[i].min_activation_height % mainnetParams.nMinerConfirmationWindow, 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r613841828",
      "id" : 613841828,
      "in_reply_to_id" : 613702341,
      "line" : 271,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMzg0MTgyOA==",
      "original_commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "original_line" : 271,
      "original_position" : 229,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 229,
      "pull_request_review_id" : 636379051,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-15T07:58:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613841828",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r613842051"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613842051"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed in #21691",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-15T07:58:36Z",
      "diff_hunk" : "@@ -77,14 +84,18 @@ class VersionBitsTester\n     int num;\n \n public:\n-    VersionBitsTester() : num(0) {}\n+    VersionBitsTester() : num(1000) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r613842051",
      "id" : 613842051,
      "in_reply_to_id" : 609585080,
      "line" : 87,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMzg0MjA1MQ==",
      "original_commit_id" : "be7d1368d8e98b6f9f692289b7d25ac369bf2984",
      "original_line" : 87,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/test/versionbits_tests.cpp",
      "position" : 37,
      "pull_request_review_id" : 636379363,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-15T07:58:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613842051",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK\r\nCode review ACK ffe33df",
      "created_at" : "2021-04-15T10:04:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-820302279",
      "id" : 820302279,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMDMwMjI3OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-15T10:04:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/820302279",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3824379?v=4",
         "events_url" : "https://api.github.com/users/hsjoberg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hsjoberg/followers",
         "following_url" : "https://api.github.com/users/hsjoberg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hsjoberg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hsjoberg",
         "id" : 3824379,
         "login" : "hsjoberg",
         "node_id" : "MDQ6VXNlcjM4MjQzNzk=",
         "organizations_url" : "https://api.github.com/users/hsjoberg/orgs",
         "received_events_url" : "https://api.github.com/users/hsjoberg/received_events",
         "repos_url" : "https://api.github.com/users/hsjoberg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hsjoberg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hsjoberg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hsjoberg"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "wasn't this supposed to be a BIP8 based ST?",
      "created_at" : "2021-04-15T10:44:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-820325634",
      "id" : 820325634,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMDMyNTYzNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-15T10:44:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/820325634",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/37063625?v=4",
         "events_url" : "https://api.github.com/users/Ziya-Sadr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Ziya-Sadr/followers",
         "following_url" : "https://api.github.com/users/Ziya-Sadr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Ziya-Sadr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Ziya-Sadr",
         "id" : 37063625,
         "login" : "Ziya-Sadr",
         "node_id" : "MDQ6VXNlcjM3MDYzNjI1",
         "organizations_url" : "https://api.github.com/users/Ziya-Sadr/orgs",
         "received_events_url" : "https://api.github.com/users/Ziya-Sadr/received_events",
         "repos_url" : "https://api.github.com/users/Ziya-Sadr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Ziya-Sadr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Ziya-Sadr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Ziya-Sadr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept NACK. BIP9 is a step backward from lessons learned during segwit activation. The user community that I am in wants BIP8 so we can UASF if miners don't cooperate.",
      "created_at" : "2021-04-15T10:57:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-820332928",
      "id" : 820332928,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMDMzMjkyOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-15T10:57:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/820332928",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4968956?v=4",
         "events_url" : "https://api.github.com/users/rodasmith/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rodasmith/followers",
         "following_url" : "https://api.github.com/users/rodasmith/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rodasmith/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rodasmith",
         "id" : 4968956,
         "login" : "rodasmith",
         "node_id" : "MDQ6VXNlcjQ5Njg5NTY=",
         "organizations_url" : "https://api.github.com/users/rodasmith/orgs",
         "received_events_url" : "https://api.github.com/users/rodasmith/received_events",
         "repos_url" : "https://api.github.com/users/rodasmith/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rodasmith/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rodasmith/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rodasmith"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> Concept NACK. BIP9 is a step backward from lessons learned during segwit activation. The user community that I am in wants BIP8 so we can UASF if miners don't cooperate.\r\n\r\n@rodasmith\r\nJust NACKing this, without even bothering to read the discussion in this very thread is only going to hurt your reputation. \r\nYour argument doesn't even make any sense since ST with MTP is absolutely compatible with a UASF.\r\n\r\nIf you had read at least the last few comments, you'd know this. Please educate yourself before wasting precious developer time.",
      "created_at" : "2021-04-15T11:18:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-820345393",
      "id" : 820345393,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMDM0NTM5Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-15T11:20:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/820345393",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/42124006?v=4",
         "events_url" : "https://api.github.com/users/viaj3ro/events{/privacy}",
         "followers_url" : "https://api.github.com/users/viaj3ro/followers",
         "following_url" : "https://api.github.com/users/viaj3ro/following{/other_user}",
         "gists_url" : "https://api.github.com/users/viaj3ro/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/viaj3ro",
         "id" : 42124006,
         "login" : "viaj3ro",
         "node_id" : "MDQ6VXNlcjQyMTI0MDA2",
         "organizations_url" : "https://api.github.com/users/viaj3ro/orgs",
         "received_events_url" : "https://api.github.com/users/viaj3ro/received_events",
         "repos_url" : "https://api.github.com/users/viaj3ro/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/viaj3ro/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/viaj3ro/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/viaj3ro"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Post-merge tested ACK ffe33dfbd4c3b11e3475b022b6c1dd077613de79\r\n\r\n- Code reviewed diff since my previous review\r\n- Tested changes to `getblockchaininfo` and the tests since previous review; also performed additional testing on the earlier vbparams changes and ensured `getblocktemplate` returned reasonable-looking results for a regtest deployment\r\n- Performed extensive testing on the fuzz testing.  Every problem I deliberately introduced that was reasonable to catch was caught within a minute of testing on a 48 core machine.  Ran fuzz testing for about 200 CPU days total (yeah, yeah, I know, gmaxwell can do that in like an hour :-)\r\n- Spent some time staring at the state machine trying to think of every way it could go wrong by accident or by manipulation\r\n- Re-read every comment on the PR to date to ensure nothing important was missed; [this](https://github.com/bitcoin/bitcoin/pull/21377#discussion_r611492633) is the only comment I'd personally like to see addressed in a follow up PR (no rush; it doesn't need to be backported).\r\n\r\nMy updated detailed review notes here: https://gist.github.com/harding/e622323eaf80d620826a7cb74ab3fb40\r\n\r\nMy thanks to AJ, Andrew, and all the other test writers and reviewers.  This seems to me to be extraordinarily well considered code.",
      "created_at" : "2021-04-15T11:46:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-820360487",
      "id" : 820360487,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMDM2MDQ4Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-15T11:46:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/820360487",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/61096?v=4",
         "events_url" : "https://api.github.com/users/harding/events{/privacy}",
         "followers_url" : "https://api.github.com/users/harding/followers",
         "following_url" : "https://api.github.com/users/harding/following{/other_user}",
         "gists_url" : "https://api.github.com/users/harding/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/harding",
         "id" : 61096,
         "login" : "harding",
         "node_id" : "MDQ6VXNlcjYxMDk2",
         "organizations_url" : "https://api.github.com/users/harding/orgs",
         "received_events_url" : "https://api.github.com/users/harding/received_events",
         "repos_url" : "https://api.github.com/users/harding/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/harding/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/harding/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/harding"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Being backported in #21701.",
      "created_at" : "2021-04-16T00:28:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-820823758",
      "id" : 820823758,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMDgyMzc1OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-16T00:28:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/820823758",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "ACK - no need for BIP8 at this time ",
      "created_at" : "2021-04-16T03:47:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-820885693",
      "id" : 820885693,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMDg4NTY5Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-16T03:47:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/820885693",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/777326?v=4",
         "events_url" : "https://api.github.com/users/jaybny/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jaybny/followers",
         "following_url" : "https://api.github.com/users/jaybny/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jaybny/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jaybny",
         "id" : 777326,
         "login" : "jaybny",
         "node_id" : "MDQ6VXNlcjc3NzMyNg==",
         "organizations_url" : "https://api.github.com/users/jaybny/orgs",
         "received_events_url" : "https://api.github.com/users/jaybny/received_events",
         "repos_url" : "https://api.github.com/users/jaybny/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jaybny/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jaybny/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jaybny"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Post merge Code Review ACK ffe33dfbd4c3b11e3475b022b6c1dd077613de79\r\n\r\nAlso built and ran unit tests locally.",
      "created_at" : "2021-04-17T18:21:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#issuecomment-821865855",
      "id" : 821865855,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21377",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMTg2NTg1NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-17T18:21:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/821865855",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r615425364"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/615425364"
         }
      },
      "author_association" : "NONE",
      "body" : "Hmm? BIP341 says `min_activation_height` should be `709632` but this code contains `0`.",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-18T16:54:42Z",
      "diff_hunk" : "@@ -78,16 +78,18 @@ class CMainParams : public CChainParams {\n         consensus.nPowTargetSpacing = 10 * 60;\n         consensus.fPowAllowMinDifficultyBlocks = false;\n         consensus.fPowNoRetargeting = false;\n-        consensus.nRuleChangeActivationThreshold = 1916; // 95% of 2016\n+        consensus.nRuleChangeActivationThreshold = 1815; // 90% of 2016\n         consensus.nMinerConfirmationWindow = 2016; // nPowTargetTimespan / nPowTargetSpacing\n         consensus.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].bit = 28;\n-        consensus.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nStartTime = 1199145601; // January 1, 2008\n-        consensus.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nTimeout = 1230767999; // December 31, 2008\n+        consensus.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nStartTime = Consensus::BIP9Deployment::NEVER_ACTIVE;\n+        consensus.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nTimeout = Consensus::BIP9Deployment::NO_TIMEOUT;\n+        consensus.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].min_activation_height = 0; // No activation delay\n \n         // Deployment of Taproot (BIPs 340-342)\n         consensus.vDeployments[Consensus::DEPLOYMENT_TAPROOT].bit = 2;\n-        consensus.vDeployments[Consensus::DEPLOYMENT_TAPROOT].nStartTime = 1199145601; // January 1, 2008\n-        consensus.vDeployments[Consensus::DEPLOYMENT_TAPROOT].nTimeout = 1230767999; // December 31, 2008\n+        consensus.vDeployments[Consensus::DEPLOYMENT_TAPROOT].nStartTime = Consensus::BIP9Deployment::NEVER_ACTIVE;\n+        consensus.vDeployments[Consensus::DEPLOYMENT_TAPROOT].nTimeout = Consensus::BIP9Deployment::NO_TIMEOUT;\n+        consensus.vDeployments[Consensus::DEPLOYMENT_TAPROOT].min_activation_height = 0; // No activation delay",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r615425364",
      "id" : 615425364,
      "line" : 92,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNTQyNTM2NA==",
      "original_commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "original_line" : 92,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/chainparams.cpp",
      "position" : 20,
      "pull_request_review_id" : 638348660,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-18T17:01:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/615425364",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1178779?v=4",
         "events_url" : "https://api.github.com/users/Kixunil/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Kixunil/followers",
         "following_url" : "https://api.github.com/users/Kixunil/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Kixunil/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Kixunil",
         "id" : 1178779,
         "login" : "Kixunil",
         "node_id" : "MDQ6VXNlcjExNzg3Nzk=",
         "organizations_url" : "https://api.github.com/users/Kixunil/orgs",
         "received_events_url" : "https://api.github.com/users/Kixunil/received_events",
         "repos_url" : "https://api.github.com/users/Kixunil/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Kixunil/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Kixunil/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Kixunil"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r615427806"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/615427806"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@kixunil The activation parameters were add in a separate PR, https://github.com/bitcoin/bitcoin/pull/21686 ",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-04-18T17:15:42Z",
      "diff_hunk" : "@@ -78,16 +78,18 @@ class CMainParams : public CChainParams {\n         consensus.nPowTargetSpacing = 10 * 60;\n         consensus.fPowAllowMinDifficultyBlocks = false;\n         consensus.fPowNoRetargeting = false;\n-        consensus.nRuleChangeActivationThreshold = 1916; // 95% of 2016\n+        consensus.nRuleChangeActivationThreshold = 1815; // 90% of 2016\n         consensus.nMinerConfirmationWindow = 2016; // nPowTargetTimespan / nPowTargetSpacing\n         consensus.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].bit = 28;\n-        consensus.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nStartTime = 1199145601; // January 1, 2008\n-        consensus.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nTimeout = 1230767999; // December 31, 2008\n+        consensus.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nStartTime = Consensus::BIP9Deployment::NEVER_ACTIVE;\n+        consensus.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].nTimeout = Consensus::BIP9Deployment::NO_TIMEOUT;\n+        consensus.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].min_activation_height = 0; // No activation delay\n \n         // Deployment of Taproot (BIPs 340-342)\n         consensus.vDeployments[Consensus::DEPLOYMENT_TAPROOT].bit = 2;\n-        consensus.vDeployments[Consensus::DEPLOYMENT_TAPROOT].nStartTime = 1199145601; // January 1, 2008\n-        consensus.vDeployments[Consensus::DEPLOYMENT_TAPROOT].nTimeout = 1230767999; // December 31, 2008\n+        consensus.vDeployments[Consensus::DEPLOYMENT_TAPROOT].nStartTime = Consensus::BIP9Deployment::NEVER_ACTIVE;\n+        consensus.vDeployments[Consensus::DEPLOYMENT_TAPROOT].nTimeout = Consensus::BIP9Deployment::NO_TIMEOUT;\n+        consensus.vDeployments[Consensus::DEPLOYMENT_TAPROOT].min_activation_height = 0; // No activation delay",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r615427806",
      "id" : 615427806,
      "in_reply_to_id" : 615425364,
      "line" : 92,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNTQyNzgwNg==",
      "original_commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "original_line" : 92,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/chainparams.cpp",
      "position" : 20,
      "pull_request_review_id" : 638350242,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-18T17:15:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/615427806",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/61096?v=4",
         "events_url" : "https://api.github.com/users/harding/events{/privacy}",
         "followers_url" : "https://api.github.com/users/harding/followers",
         "following_url" : "https://api.github.com/users/harding/following{/other_user}",
         "gists_url" : "https://api.github.com/users/harding/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/harding",
         "id" : 61096,
         "login" : "harding",
         "node_id" : "MDQ6VXNlcjYxMDk2",
         "organizations_url" : "https://api.github.com/users/harding/orgs",
         "received_events_url" : "https://api.github.com/users/harding/received_events",
         "repos_url" : "https://api.github.com/users/harding/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/harding/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/harding/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/harding"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r719711393"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719711393"
         }
      },
      "author_association" : "NONE",
      "body" : "The proposed inequality reads naturally.\r\nYour suggested change is common code, so it's easy to read as well.\r\nYour suggested change is not more future proof,\r\nI'd say it's slightly less future proof.\r\n",
      "commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "created_at" : "2021-09-30T19:50:24Z",
      "diff_hunk" : "@@ -492,22 +503,26 @@ void CRegTestParams::UpdateActivationParametersFromArgs(const ArgsManager& args)\n     for (const std::string& strDeployment : args.GetArgs(\"-vbparams\")) {\n         std::vector<std::string> vDeploymentParams;\n         boost::split(vDeploymentParams, strDeployment, boost::is_any_of(\":\"));\n-        if (vDeploymentParams.size() != 3) {\n-            throw std::runtime_error(\"Version bits parameters malformed, expecting deployment:start:end\");\n+        if (vDeploymentParams.size() < 3 || 4 < vDeploymentParams.size()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21377#discussion_r719711393",
      "id" : 719711393,
      "in_reply_to_id" : 613559485,
      "line" : 506,
      "node_id" : "PRRC_kwDOABII584q5eyh",
      "original_commit_id" : "ffe33dfbd4c3b11e3475b022b6c1dd077613de79",
      "original_line" : 506,
      "original_position" : 104,
      "original_start_line" : null,
      "path" : "src/chainparams.cpp",
      "position" : 104,
      "pull_request_review_id" : 768273415,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21377",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719711393/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-30T19:50:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/719711393",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/52637275?v=4",
         "events_url" : "https://api.github.com/users/katesalazar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/katesalazar/followers",
         "following_url" : "https://api.github.com/users/katesalazar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/katesalazar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/katesalazar",
         "id" : 52637275,
         "login" : "katesalazar",
         "node_id" : "MDQ6VXNlcjUyNjM3Mjc1",
         "organizations_url" : "https://api.github.com/users/katesalazar/orgs",
         "received_events_url" : "https://api.github.com/users/katesalazar/received_events",
         "repos_url" : "https://api.github.com/users/katesalazar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/katesalazar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/katesalazar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/katesalazar"
      }
   }
]
