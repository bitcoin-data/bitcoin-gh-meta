{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "One of my nodes using `onlynet=tor` nodes is completely broken with current master as of 97a35f3ae5bff7f4a25d37d8961191fdbc8c5b67.\r\n\r\nTor is manually configured. Relevant `bitcoin.conf`:\r\n```\r\nonlynet=onion\r\nproxy=127.0.0.1:9050\r\nonion=127.0.0.1:9050\r\n```\r\n\r\nIt does not manage to make any outgoing connections. The log has an endless stream of:\r\n```\r\n2021-03-03T13:42:13Z Socks5() connect to [â¦].onion:8333 failed: general failure\r\n2021-03-03T13:42:13Z Socks5() connect to [â¦].onion:8333 failed: general failure\r\n2021-03-03T13:42:14Z Socks5() connect to [â¦].onion:8333 failed: general failure\r\n2021-03-03T13:42:14Z Socks5() connect to [â¦].onion:8333 failed: general failure\r\n2021-03-03T13:42:15Z Socks5() connect to [â¦].onion:8333 failed: general failure\r\n2021-03-03T13:42:15Z Socks5() connect to [â¦].onion:8333 failed: general failure\r\n2021-03-03T13:42:16Z Socks5() connect to [â¦].onion:8333 failed: general failure\r\n2021-03-03T13:42:16Z Socks5() connect to [â¦].onion:8333 failed: general failure\r\n2021-03-03T13:42:17Z Socks5() connect to [â¦].onion:8333 failed: general failure\r\n2021-03-03T13:42:17Z Socks5() connect to [â¦].onion:8333 failed: general failure\r\n2021-03-03T13:42:18Z Socks5() connect to [â¦].onion:8333 failed: general failure\r\n2021-03-03T13:42:18Z Socks5() connect to [â¦].onion:8333 failed: general failure\r\n2021-03-03T13:42:19Z Socks5() connect to [â¦].onion:8333 failed: general failure\r\n2021-03-03T13:42:19Z Socks5() connect to [â¦].onion:8333 failed: general failure\r\n2021-03-03T13:42:20Z Socks5() connect to [â¦].onion:8333 failed: general failure\r\n2021-03-03T13:42:20Z Socks5() connect to [â¦].onion:8333 failed: general failure\r\nâ¦\r\n```\r\n(multiple messages per second, all `[â¦]` are short v2 onion addresses)\r\n\r\n```\r\n$ systemctl status tor\r\nâ tor.service - Anonymizing overlay network for TCP\r\n     Loaded: loaded (/etc/systemd/system/tor.service; enabled; vendor preset: enabled)\r\n     Active: active (running) since Wed 2021-03-03 14:45:24 CET; 3min 0s ago\r\n    Process: 158931 ExecStartPre=/opt/tor/bin/tor -f /opt/tor/etc/tor/torrc --verify-config (code=exited, status=0/SUCCESS)\r\n   Main PID: 158962 (tor)\r\n      Tasks: 1 (limit: 9367)\r\n     Memory: 38.4M\r\n     CGroup: /system.slice/tor.service\r\n             ââ158962 /opt/tor/bin/tor -f /opt/tor/etc/tor/torrc\r\n\r\nMar 03 14:48:20 tor[158962]: Mar 03 14:48:20.000 [warn] Invalid hostname [scrubbed]; rejecting\r\nMar 03 14:48:20 tor[158962]: Mar 03 14:48:20.000 [warn] Invalid hostname [scrubbed]; rejecting\r\nMar 03 14:48:21 tor[158962]: Mar 03 14:48:21.000 [warn] Invalid hostname [scrubbed]; rejecting\r\nMar 03 14:48:21 tor[158962]: Mar 03 14:48:21.000 [warn] Invalid hostname [scrubbed]; rejecting\r\nMar 03 14:48:22 tor[158962]: Mar 03 14:48:22.000 [warn] Invalid hostname [scrubbed]; rejecting\r\nMar 03 14:48:22 tor[158962]: Mar 03 14:48:22.000 [warn] Invalid hostname [scrubbed]; rejecting\r\nMar 03 14:48:23 tor[158962]: Mar 03 14:48:23.000 [warn] Invalid hostname [scrubbed]; rejecting\r\nMar 03 14:48:23 tor[158962]: Mar 03 14:48:23.000 [warn] Invalid hostname [scrubbed]; rejecting\r\nMar 03 14:48:24 tor[158962]: Mar 03 14:48:24.000 [warn] Invalid hostname [scrubbed]; rejecting\r\nMar 03 14:48:24 tor[158962]: Mar 03 14:48:24.000 [warn] Invalid hostname [scrubbed]; rejecting\r\n```\r\n\r\nI'll try to see if I can figure out what it's sending. Tor (current master) is otherwise successfully able to connect to hidden services, at least v3 ones.\r\n\r\nDid Tor completely remove v2 support?\r\n\r\n```\r\n$ /opt/tor/bin/tor --version\r\nTor version 0.4.6.0-alpha-dev (git-8020ae02abb105db).\r\nTor is running on Linux with Libevent 2.1.11-stable, OpenSSL 1.1.1f, Zlib 1.2.11, Liblzma 5.2.4, Libzstd N/A and Glibc 2.31 as libc.\r\nTor compiled with GCC version 9.3.0\r\n```",
   "closed_at" : "2021-08-17T12:55:02Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
      "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
      "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/MarcoFalke",
      "id" : 6399679,
      "login" : "MarcoFalke",
      "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
      "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
      "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
      "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/MarcoFalke"
   },
   "comments" : 21,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21351/comments",
   "created_at" : "2021-03-03T13:54:44Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21351/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/21351",
   "id" : 821131494,
   "labels" : [
      {
         "color" : "006b75",
         "default" : false,
         "description" : null,
         "id" : 98298007,
         "name" : "P2P",
         "node_id" : "MDU6TGFiZWw5ODI5ODAwNw==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P"
      },
      {
         "color" : "bfd4f2",
         "default" : false,
         "description" : null,
         "id" : 159815356,
         "name" : "Upstream",
         "node_id" : "MDU6TGFiZWwxNTk4MTUzNTY=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Upstream"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21351/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDU6SXNzdWU4MjExMzE0OTQ=",
   "number" : 21351,
   "performed_via_github_app" : null,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "net: No more v2 onion support in upstream Tor master",
   "updated_at" : "2021-08-17T12:55:02Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21351",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
      "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
      "followers_url" : "https://api.github.com/users/laanwj/followers",
      "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/laanwj",
      "id" : 126646,
      "login" : "laanwj",
      "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
      "organizations_url" : "https://api.github.com/users/laanwj/orgs",
      "received_events_url" : "https://api.github.com/users/laanwj/received_events",
      "repos_url" : "https://api.github.com/users/laanwj/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/laanwj"
   }
}
