[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #21533 (mining: Remove unused extranonce logic by jnewbery)\n* #21523 (validation: run VerifyDB on all chainstates by jamesob)\n* #21401 (Refactor versionbits deployments to avoid potential uninitialized variables by achow101)\n* #21378 (Convert taproot to flag day activation by ajtowns)\n* #20833 (rpc/validation: enable packages through testmempoolaccept by glozow)\n* #19573 (Replace unused BIP 9 logic with draft BIP 8 by luke-jr)\n* #19521 (Coinstats Index by fjahr)\n* #19438 (Introduce deploymentstatus by ajtowns)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-03-09T04:25:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#issuecomment-793367260",
      "id" : 793367260,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21391",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5MzM2NzI2MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-10T23:48:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/793367260",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Pushed a041676d3905002758a9c1827b410ea87d3329cf -> 6b89f537bad5fc3761ef3ada4cc5c9ac213c0ae6\r\n- Fixed assert linter complaint by using `CHECK_NONFATAL` instead of `assert`",
      "created_at" : "2021-03-09T17:40:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#issuecomment-794215591",
      "id" : 794215591,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21391",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5NDIxNTU5MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-09T17:40:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/794215591",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--4a62be1de6b64f3ed646cdc7932c8cf5-->\nðµï¸ @sipa @fjahr have been requested to review this pull request as specified in the REVIEWERS file.",
      "created_at" : "2021-03-15T16:49:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#issuecomment-799573816",
      "id" : 799573816,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21391",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5OTU3MzgxNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-15T16:49:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/799573816",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "(Needs rebase)",
      "created_at" : "2021-03-15T18:27:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#issuecomment-799649514",
      "id" : 799649514,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21391",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5OTY0OTUxNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-15T18:27:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/799649514",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Pushed 6b89f537bad5fc3761ef3ada4cc5c9ac213c0ae6 -> b57dc39eae25294071959b1eec42bd7dd5563357\r\n- Rebased over master\r\n- Prepended fixes to last bundle\r\n\r\n-----\r\n\r\nNote to reviewers:\r\n- I've made some changes in 5de3e3609ab591d88281558182efdec39b065541 that requires some attention, mostly I had to make decisions about default values of `getNumBlocks`, `isInitialBlockDownload`, `getUnspentOutput`, and `checkFinalTx` when our context doesn't contain a chainman\r\n- The commits before b7ed70dba191881d79fe71a746a2a826f40de884 should address the following posthumous reviews:\r\n  - From jnewbery:\r\n    - https://github.com/bitcoin/bitcoin/pull/21270#issuecomment-796738048\r\n      - I didn't fix this one, but I added a `TODO` comment so that we don't lost track of it\r\n    - https://github.com/bitcoin/bitcoin/pull/21270#discussion_r592291225\r\n    - https://github.com/bitcoin/bitcoin/pull/21270#discussion_r592296942\r\n    - https://github.com/bitcoin/bitcoin/pull/21270#discussion_r592299738\r\n    - https://github.com/bitcoin/bitcoin/pull/21270#discussion_r592301704\r\n  - From MarcoFalke:\r\n    - https://github.com/bitcoin/bitcoin/pull/21270#discussion_r593096212\r\n    - https://github.com/bitcoin/bitcoin/pull/21270#discussion_r593097032\r\n    - https://github.com/bitcoin/bitcoin/pull/21270#discussion_r593097867\r\n    - https://github.com/bitcoin/bitcoin/pull/21270#discussion_r593100570\r\n\r\nI have also went through all my changes in the last bundle and ensured that we didn't miss any potential UB-introductions.\r\n\r\nA few explanations:\r\n\r\n1. https://github.com/bitcoin/bitcoin/pull/21270#discussion_r592293190\r\nUnfortunately GetUTXOStats is fuzzed by constructing a `CCoinsView*` as an input, so this signature needs to remain.\r\n\r\n2. https://github.com/bitcoin/bitcoin/pull/21270#discussion_r592299232\r\n100% agree that it's unnecessary, but going to leave it be for now since it'll be removed in the end if that's okay with folks.\r\n\r\n3. https://github.com/bitcoin/bitcoin/pull/21270#discussion_r592357247\r\nRight, it would most likely be better to take a local `const CChainstate&` once in places where we're already taking `cs_main`, let's do this in a followup!\r\n",
      "created_at" : "2021-03-17T21:24:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#issuecomment-801453063",
      "id" : 801453063,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21391",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwMTQ1MzA2Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-17T21:24:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/801453063",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. Thanks for addressing review comments from the last bundle!",
      "created_at" : "2021-03-17T22:47:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#issuecomment-801491237",
      "id" : 801491237,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21391",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwMTQ5MTIzNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-17T22:47:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/801491237",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r596598280"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/596598280"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: Can this be const?",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-03-18T07:05:43Z",
      "diff_hunk" : "@@ -146,6 +146,7 @@ class BlockAssembler\n     int64_t nLockTimeCutoff;\n     const CChainParams& chainparams;\n     const CTxMemPool& m_mempool;\n+    CChainState& m_chainstate;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r596598280",
      "id" : 596598280,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NjU5ODI4MA==",
      "original_commit_id" : "b57dc39eae25294071959b1eec42bd7dd5563357",
      "original_line" : 149,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/miner.h",
      "position" : null,
      "pull_request_review_id" : 615035498,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/596598280",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r596601383"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/596601383"
         }
      },
      "author_association" : "MEMBER",
      "body" : "does it make sense to run a node without a chainman? It might make more sense to use Assert, like it is already done in `waitForNotificationsIfTipChanged`.\r\n\r\nMaybe the assert can even be wrapped into a private member:\r\n\r\n```\r\nprivate:\r\n ChainstateManager& chainman() { return *Assert(m_node.chainman); }",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-03-18T07:13:06Z",
      "diff_hunk" : "@@ -621,8 +651,13 @@ class ChainImpl : public Chain\n     }\n     bool isReadyToBroadcast() override { return !::fImporting && !::fReindex && !isInitialBlockDownload(); }\n     bool isInitialBlockDownload() override {\n-        assert(std::addressof(::ChainstateActive()) == std::addressof(m_node.chainman->ActiveChainstate()));\n-        return m_node.chainman->ActiveChainstate().IsInitialBlockDownload();\n+        const CChainState* active_chainstate;\n+        if (m_node.chainman) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r596601383",
      "id" : 596601383,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NjYwMTM4Mw==",
      "original_commit_id" : "b57dc39eae25294071959b1eec42bd7dd5563357",
      "original_line" : 655,
      "original_position" : 149,
      "original_start_line" : null,
      "path" : "src/node/interfaces.cpp",
      "position" : null,
      "pull_request_review_id" : 615035498,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/596601383",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r596601776"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/596601776"
         }
      },
      "author_association" : "MEMBER",
      "body" : "would be nice to assert before cs_main, because cs_main \"belongs\" to the chainman",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-03-18T07:13:56Z",
      "diff_hunk" : "@@ -39,6 +39,7 @@ TransactionError BroadcastTransaction(NodeContext& node, const CTransactionRef t\n \n     { // cs_main scope\n     LOCK(cs_main);\n+    assert(node.chainman);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r596601776",
      "id" : 596601776,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NjYwMTc3Ng==",
      "original_commit_id" : "b57dc39eae25294071959b1eec42bd7dd5563357",
      "original_line" : 41,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/node/transaction.cpp",
      "position" : null,
      "pull_request_review_id" : 615035498,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/596601776",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r596601876"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/596601876"
         }
      },
      "author_association" : "MEMBER",
      "body" : "would be nice to assert before cs_main, because cs_main \"belongs\" to the chainman",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-03-18T07:14:11Z",
      "diff_hunk" : "@@ -12,6 +12,7 @@ void FindCoins(const NodeContext& node, std::map<COutPoint, Coin>& coins)\n {\n     assert(node.mempool);\n     LOCK2(cs_main, node.mempool->cs);\n+    assert(node.chainman);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r596601876",
      "id" : 596601876,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NjYwMTg3Ng==",
      "original_commit_id" : "b57dc39eae25294071959b1eec42bd7dd5563357",
      "original_line" : 14,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/node/coin.cpp",
      "position" : null,
      "pull_request_review_id" : 615035498,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/596601876",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-03-18T09:37:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#issuecomment-801774683",
      "id" : 801774683,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21391",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwMTc3NDY4Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-18T09:37:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/801774683",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r597026552"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597026552"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Just remove this section marker.",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-03-18T16:12:56Z",
      "diff_hunk" : "@@ -474,21 +474,81 @@ class PeerManagerImpl final : public PeerManager\n     /** Offset into vExtraTxnForCompact to insert the next tx */\n     size_t vExtraTxnForCompactIt GUARDED_BY(g_cs_orphans) = 0;\n \n+    /** Check whether the last unknown block a peer advertised is not yet known. */\n     void ProcessBlockAvailability(NodeId nodeid) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+    /** Update tracking information about which blocks a peer is assumed to have. */\n     void UpdateBlockAvailability(NodeId nodeid, const uint256 &hash) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n     bool CanDirectFetch(const Consensus::Params &consensusParams) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+\n+    //////////////////////////////////////////////////////////////////////////////\n+    //\n+    // blockchain -> download logic notification\n+    //",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r597026552",
      "id" : 597026552,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NzAyNjU1Mg==",
      "original_commit_id" : "b57dc39eae25294071959b1eec42bd7dd5563357",
      "original_line" : 486,
      "original_position" : 13,
      "original_start_line" : 483,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 615597960,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597026552",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r597027186"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597027186"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Perhaps make this a doxygen comment (ie start with `/**`)",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-03-18T16:13:24Z",
      "diff_hunk" : "@@ -474,21 +474,81 @@ class PeerManagerImpl final : public PeerManager\n     /** Offset into vExtraTxnForCompact to insert the next tx */\n     size_t vExtraTxnForCompactIt GUARDED_BY(g_cs_orphans) = 0;\n \n+    /** Check whether the last unknown block a peer advertised is not yet known. */\n     void ProcessBlockAvailability(NodeId nodeid) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+    /** Update tracking information about which blocks a peer is assumed to have. */\n     void UpdateBlockAvailability(NodeId nodeid, const uint256 &hash) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n     bool CanDirectFetch(const Consensus::Params &consensusParams) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+\n+    //////////////////////////////////////////////////////////////////////////////\n+    //\n+    // blockchain -> download logic notification\n+    //\n+\n+    // To prevent fingerprinting attacks, only send blocks/headers outside of the\n+    // active chain if they are no more than a month older (both in time, and in\n+    // best equivalent proof of work) than the best header chain we know about and\n+    // we fully-validated them at some point.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r597027186",
      "id" : 597027186,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NzAyNzE4Ng==",
      "original_commit_id" : "b57dc39eae25294071959b1eec42bd7dd5563357",
      "original_line" : 491,
      "original_position" : 18,
      "original_start_line" : 488,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 615597960,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597027186",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r597027762"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597027762"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Remove this extra blank line? :grimacing: ",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-03-18T16:13:52Z",
      "diff_hunk" : "@@ -1185,15 +1243,6 @@ bool PeerManagerImpl::MaybePunishNodeForTx(NodeId nodeid, const TxValidationStat\n }\n \n ",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r597027762",
      "id" : 597027762,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NzAyNzc2Mg==",
      "original_commit_id" : "b57dc39eae25294071959b1eec42bd7dd5563357",
      "original_line" : 1245,
      "original_position" : 101,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 615597960,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597027762",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r597029360"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597029360"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think it'd be just as clear (and a smaller diff) to invert the conditional here:\r\n\r\n```suggestion\r\n        if (!m_context->chainman) return 0;\r\n        // Logic that uses chainman ...\r\n```",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-03-18T16:15:09Z",
      "diff_hunk" : "@@ -182,38 +182,51 @@ class NodeImpl : public Node\n     }\n     int getNumBlocks() override\n     {\n-        LOCK(::cs_main);\n-        assert(std::addressof(::ChainActive()) == std::addressof(m_context->chainman->ActiveChain()));\n-        return m_context->chainman->ActiveChain().Height();\n+        if (m_context->chainman) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r597029360",
      "id" : 597029360,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NzAyOTM2MA==",
      "original_commit_id" : "b57dc39eae25294071959b1eec42bd7dd5563357",
      "original_line" : 185,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/node/interfaces.cpp",
      "position" : null,
      "pull_request_review_id" : 615597960,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597029360",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r597029921"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597029921"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same here. You don't need this local variable if you exit early when `chainman` doesn't exist.",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-03-18T16:15:35Z",
      "diff_hunk" : "@@ -182,38 +182,51 @@ class NodeImpl : public Node\n     }\n     int getNumBlocks() override\n     {\n-        LOCK(::cs_main);\n-        assert(std::addressof(::ChainActive()) == std::addressof(m_context->chainman->ActiveChain()));\n-        return m_context->chainman->ActiveChain().Height();\n+        if (m_context->chainman) {\n+            LOCK(::cs_main);\n+            assert(std::addressof(::ChainActive()) == std::addressof(m_context->chainman->ActiveChain()));\n+            return m_context->chainman->ActiveChain().Height();\n+        }\n+        return 0;\n     }\n     uint256 getBestBlockHash() override\n     {\n-        assert(std::addressof(::ChainActive()) == std::addressof(m_context->chainman->ActiveChain()));\n-        const CBlockIndex* tip = WITH_LOCK(::cs_main, return m_context->chainman->ActiveChain().Tip());\n+        const CBlockIndex* tip;\n+        if (m_context->chainman) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r597029921",
      "id" : 597029921,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NzAyOTkyMQ==",
      "original_commit_id" : "b57dc39eae25294071959b1eec42bd7dd5563357",
      "original_line" : 195,
      "original_position" : 19,
      "original_start_line" : 194,
      "path" : "src/node/interfaces.cpp",
      "position" : null,
      "pull_request_review_id" : 615597960,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597029921",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r597035062"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597035062"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Any reason not to just do this? The function is obviously const since it just does a lookup and returns a pointer.",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-03-18T16:19:32Z",
      "diff_hunk" : "@@ -457,6 +457,7 @@ class BlockManager\n         const CChainParams& chainparams,\n         CBlockIndex** ppindex) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    // TODO: Change this to a const function",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r597035062",
      "id" : 597035062,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NzAzNTA2Mg==",
      "original_commit_id" : "b57dc39eae25294071959b1eec42bd7dd5563357",
      "original_line" : 460,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 615597960,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597035062",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r597038927"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597038927"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe join these lines?",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-03-18T16:22:34Z",
      "diff_hunk" : "@@ -398,7 +399,8 @@ static RPCHelpMan getdifficulty()\n         [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n {\n     LOCK(cs_main);\n-    return GetDifficulty(::ChainActive().Tip());\n+    CChain& active_chain = EnsureChainman(request.context).ActiveChain();\n+    return GetDifficulty(active_chain.Tip());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r597038927",
      "id" : 597038927,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NzAzODkyNw==",
      "original_commit_id" : "b57dc39eae25294071959b1eec42bd7dd5563357",
      "original_line" : 403,
      "original_position" : 32,
      "original_start_line" : 402,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 615597960,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597038927",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r597040349"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597040349"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    const CChain& active_chain = EnsureChainman(request.context).ActiveChain();\r\n```\r\n\r\n(same goes for other `CChain&`s)",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-03-18T16:23:43Z",
      "diff_hunk" : "@@ -763,12 +765,13 @@ static RPCHelpMan getblockhash()\n         [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n {\n     LOCK(cs_main);\n+    CChain& active_chain = EnsureChainman(request.context).ActiveChain();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r597040349",
      "id" : 597040349,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NzA0MDM0OQ==",
      "original_commit_id" : "b57dc39eae25294071959b1eec42bd7dd5563357",
      "original_line" : 768,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 615597960,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597040349",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r597067215"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597067215"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It would be nice to avoid so many repeated locks and releases of cs_main. In this function we take it at least 5 times:\r\n\r\n- in `EnsureChainman()`\r\n- in `ActiveChainstate()`\r\n- in `ForceFlushStateToDisk()`\r\n- in `WITH_LOCK(::cs_main, return &active_chainstate.CoinsDB());`\r\n- in `WITH_LOCK(::cs_main, return std::ref(active_chainstate.m_blockman));`\r\n\r\nthis gets rid of one unnecessary lock/release:\r\n\r\n```\r\ndiff --git a/src/rpc/blockchain.cpp b/src/rpc/blockchain.cpp\r\nindex aa1164ae29..941b2bf780 100644\r\n--- a/src/rpc/blockchain.cpp\r\n+++ b/src/rpc/blockchain.cpp\r\n@@ -1080,10 +1080,15 @@ static RPCHelpMan gettxoutsetinfo()\r\n \r\n     const CoinStatsHashType hash_type{request.params[0].isNull() ? CoinStatsHashType::HASH_SERIALIZED : ParseHashType(request.params[0].get_str())};\r\n \r\n-    CCoinsView* coins_view = WITH_LOCK(::cs_main, return &active_chainstate.CoinsDB());\r\n-    BlockManager& blockman = WITH_LOCK(::cs_main, return std::ref(active_chainstate.m_blockman));\r\n+    CCoinsView* coins_view;\r\n+    BlockManager* blockman;\r\n+    {\r\n+        LOCK(::cs_main);\r\n+        coins_view = &active_chainstate.CoinsDB();\r\n+        blockman = &active_chainstate.m_blockman;\r\n+    }\r\n     NodeContext& node = EnsureNodeContext(request.context);\r\n-    if (GetUTXOStats(coins_view, blockman, stats, hash_type, node.rpc_interruption_point)) {\r\n+    if (GetUTXOStats(coins_view, *blockman, stats, hash_type, node.rpc_interruption_point)) {\r\n         ret.pushKV(\"height\", (int64_t)stats.nHeight);\r\n         ret.pushKV(\"bestblock\", stats.hashBlock.GetHex());\r\n         ret.pushKV(\"transactions\", (int64_t)stats.nTransactions);\r\n```",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-03-18T16:54:40Z",
      "diff_hunk" : "@@ -1069,13 +1075,15 @@ static RPCHelpMan gettxoutsetinfo()\n     UniValue ret(UniValue::VOBJ);\n \n     CCoinsStats stats;\n-    ::ChainstateActive().ForceFlushStateToDisk();\n+    CChainState& active_chainstate = EnsureChainman(request.context).ActiveChainstate();\n+    active_chainstate.ForceFlushStateToDisk();\n \n     const CoinStatsHashType hash_type{request.params[0].isNull() ? CoinStatsHashType::HASH_SERIALIZED : ParseHashType(request.params[0].get_str())};\n \n-    CCoinsView* coins_view = WITH_LOCK(::cs_main, return &::ChainstateActive().CoinsDB());\n+    CCoinsView* coins_view = WITH_LOCK(::cs_main, return &active_chainstate.CoinsDB());\n+    BlockManager& blockman = WITH_LOCK(::cs_main, return std::ref(active_chainstate.m_blockman));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r597067215",
      "id" : 597067215,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NzA2NzIxNQ==",
      "original_commit_id" : "b57dc39eae25294071959b1eec42bd7dd5563357",
      "original_line" : 1083,
      "original_position" : 125,
      "original_start_line" : 1083,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 615597960,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597067215",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r597069682"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597069682"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can you declare this further up and use it instead of `(int)chainman.ActiveChain().Height())` for `\"blocks\"`?",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-03-18T16:57:27Z",
      "diff_hunk" : "@@ -1358,14 +1369,15 @@ RPCHelpMan getblockchaininfo()\n     }\n \n     const Consensus::Params& consensusParams = Params().GetConsensus();\n+    int active_tip_nheight = tip->nHeight;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r597069682",
      "id" : 597069682,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NzA2OTY4Mg==",
      "original_commit_id" : "b57dc39eae25294071959b1eec42bd7dd5563357",
      "original_line" : 1372,
      "original_position" : 232,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 615597960,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597069682",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r597096912"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597096912"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think just `height` here probably suffices:\r\n\r\n```suggestion\r\n    const int height = tip->nHeight;\r\n```",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-03-18T17:31:58Z",
      "diff_hunk" : "@@ -1358,14 +1369,15 @@ RPCHelpMan getblockchaininfo()\n     }\n \n     const Consensus::Params& consensusParams = Params().GetConsensus();\n+    int active_tip_nheight = tip->nHeight;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r597096912",
      "id" : 597096912,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NzA5NjkxMg==",
      "original_commit_id" : "b57dc39eae25294071959b1eec42bd7dd5563357",
      "original_line" : 1372,
      "original_position" : 232,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 615597960,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597096912",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r597103258"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597103258"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    CBlockIndex* pb = active_chain.Tip();\r\n```\r\n\r\n(could also make this const if you update line 65 to make `pb0` const too)",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-03-18T17:40:08Z",
      "diff_hunk" : "@@ -44,11 +44,12 @@\n  * or from the last difficulty change if 'lookup' is nonpositive.\n  * If 'height' is nonnegative, compute the estimate at the time when a given block was found.\n  */\n-static UniValue GetNetworkHashPS(int lookup, int height) {\n-    CBlockIndex *pb = ::ChainActive().Tip();\n+static UniValue GetNetworkHashPS(int lookup, int height, CChain& active_chain) {\n+    CBlockIndex *pb = active_chain.Tip();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r597103258",
      "id" : 597103258,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NzEwMzI1OA==",
      "original_commit_id" : "b57dc39eae25294071959b1eec42bd7dd5563357",
      "original_line" : 48,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/rpc/mining.cpp",
      "position" : null,
      "pull_request_review_id" : 615597960,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597103258",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r597163828"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597163828"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"node/interfaces: Meaningful locking and avoid potential UB\" (5de3e3609ab591d88281558182efdec39b065541)\r\n\r\nIt seems like this method and the two IBD methods are the only places that are changing locks or adding \"meaningful locking\". Since locking changes can have unexpected pitfalls I think it'd be good to split the locking parts of this commit into a separate commit. Also would be good to expand the commit message to say what's motivating the lock changes. I'm assuming it's to satisfy some lock annotations later?",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-03-18T19:07:16Z",
      "diff_hunk" : "@@ -182,38 +182,51 @@ class NodeImpl : public Node\n     }\n     int getNumBlocks() override\n     {\n-        LOCK(::cs_main);\n-        assert(std::addressof(::ChainActive()) == std::addressof(m_context->chainman->ActiveChain()));\n-        return m_context->chainman->ActiveChain().Height();\n+        if (m_context->chainman) {\n+            LOCK(::cs_main);\n+            assert(std::addressof(::ChainActive()) == std::addressof(m_context->chainman->ActiveChain()));\n+            return m_context->chainman->ActiveChain().Height();\n+        }\n+        return 0;\n     }\n     uint256 getBestBlockHash() override\n     {\n-        assert(std::addressof(::ChainActive()) == std::addressof(m_context->chainman->ActiveChain()));\n-        const CBlockIndex* tip = WITH_LOCK(::cs_main, return m_context->chainman->ActiveChain().Tip());\n+        const CBlockIndex* tip;\n+        if (m_context->chainman) {\n+            LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r597163828",
      "id" : 597163828,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NzE2MzgyOA==",
      "original_commit_id" : "5de3e3609ab591d88281558182efdec39b065541",
      "original_line" : 198,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/node/interfaces.cpp",
      "position" : null,
      "pull_request_review_id" : 615771075,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597163828",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r597167838"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597167838"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"node/interfaces: Meaningful locking and avoid potential UB\" (5de3e3609ab591d88281558182efdec39b065541)\r\n\r\n> Same here. You don't need this local variable if you exit early when `chainman` doesn't exist.\r\n\r\nI think John's suggestions are good, but Marco's suggestion to use an accessor that asserts https://github.com/bitcoin/bitcoin/pull/21391#discussion_r596601383 would be even better. That way we don't need to waste brain cells thinking about what values to return if chainman is null. Like if getBestBlockHash returns the genesis block hash in that case should getNumBlocks return 1 instead of 0 to be consistent? Easier to take everything down and assert.\r\n",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-03-18T19:13:42Z",
      "diff_hunk" : "@@ -182,38 +182,51 @@ class NodeImpl : public Node\n     }\n     int getNumBlocks() override\n     {\n-        LOCK(::cs_main);\n-        assert(std::addressof(::ChainActive()) == std::addressof(m_context->chainman->ActiveChain()));\n-        return m_context->chainman->ActiveChain().Height();\n+        if (m_context->chainman) {\n+            LOCK(::cs_main);\n+            assert(std::addressof(::ChainActive()) == std::addressof(m_context->chainman->ActiveChain()));\n+            return m_context->chainman->ActiveChain().Height();\n+        }\n+        return 0;\n     }\n     uint256 getBestBlockHash() override\n     {\n-        assert(std::addressof(::ChainActive()) == std::addressof(m_context->chainman->ActiveChain()));\n-        const CBlockIndex* tip = WITH_LOCK(::cs_main, return m_context->chainman->ActiveChain().Tip());\n+        const CBlockIndex* tip;\n+        if (m_context->chainman) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r597167838",
      "id" : 597167838,
      "in_reply_to_id" : 597029921,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NzE2NzgzOA==",
      "original_commit_id" : "b57dc39eae25294071959b1eec42bd7dd5563357",
      "original_line" : 195,
      "original_position" : 19,
      "original_start_line" : 194,
      "path" : "src/node/interfaces.cpp",
      "position" : null,
      "pull_request_review_id" : 615771075,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597167838",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r597546794"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597546794"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Seems reasonable to me!\r\n\r\nIn general, I like the concept of making all components optional, since it enforces decoupling. However, it's hard to imagine what a bitcoind without chainman would look like.",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-03-19T10:02:04Z",
      "diff_hunk" : "@@ -182,38 +182,51 @@ class NodeImpl : public Node\n     }\n     int getNumBlocks() override\n     {\n-        LOCK(::cs_main);\n-        assert(std::addressof(::ChainActive()) == std::addressof(m_context->chainman->ActiveChain()));\n-        return m_context->chainman->ActiveChain().Height();\n+        if (m_context->chainman) {\n+            LOCK(::cs_main);\n+            assert(std::addressof(::ChainActive()) == std::addressof(m_context->chainman->ActiveChain()));\n+            return m_context->chainman->ActiveChain().Height();\n+        }\n+        return 0;\n     }\n     uint256 getBestBlockHash() override\n     {\n-        assert(std::addressof(::ChainActive()) == std::addressof(m_context->chainman->ActiveChain()));\n-        const CBlockIndex* tip = WITH_LOCK(::cs_main, return m_context->chainman->ActiveChain().Tip());\n+        const CBlockIndex* tip;\n+        if (m_context->chainman) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r597546794",
      "id" : 597546794,
      "in_reply_to_id" : 597029921,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NzU0Njc5NA==",
      "original_commit_id" : "b57dc39eae25294071959b1eec42bd7dd5563357",
      "original_line" : 195,
      "original_position" : 19,
      "original_start_line" : 194,
      "path" : "src/node/interfaces.cpp",
      "position" : null,
      "pull_request_review_id" : 616236077,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/597546794",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r600690395"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600690395"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Unfortunately not... We pass `m_chainstate` to `TestBlockValidity` in `BlockAssembler::CreateNewBlock`, and `TestBlockValidity` requires its `CChainState` param to be non-const",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-03-24T17:10:50Z",
      "diff_hunk" : "@@ -146,6 +146,7 @@ class BlockAssembler\n     int64_t nLockTimeCutoff;\n     const CChainParams& chainparams;\n     const CTxMemPool& m_mempool;\n+    CChainState& m_chainstate;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r600690395",
      "id" : 600690395,
      "in_reply_to_id" : 596598280,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMDY5MDM5NQ==",
      "original_commit_id" : "b57dc39eae25294071959b1eec42bd7dd5563357",
      "original_line" : 149,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/miner.h",
      "position" : null,
      "pull_request_review_id" : 620000104,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600690395",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Pushed b57dc39eae25294071959b1eec42bd7dd5563357 -> 877c8a01fc1137e0c8187b0b6990a99658077152\r\n- Addressed some review suggestions\r\n- Note: this is not yet rebased",
      "created_at" : "2021-03-24T17:58:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#issuecomment-806039178",
      "id" : 806039178,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21391",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwNjAzOTE3OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-24T17:58:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/806039178",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Pushed 877c8a01fc1137e0c8187b0b6990a99658077152 -> b7833034a554b571b3d3e3e55a0639421770dfb9\r\n- Rebased on top of #21525\r\n- Addressed all reviews",
      "created_at" : "2021-03-24T20:30:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#issuecomment-806166717",
      "id" : 806166717,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21391",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwNjE2NjcxNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-24T20:30:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/806166717",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Pushed b7833034a554b571b3d3e3e55a0639421770dfb9 -> 677b836c4847315bf24a9d222bbb2eb23a2b9a2c\r\n- Use `CHECK_NONFATAL` instead of assert",
      "created_at" : "2021-03-24T20:39:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#issuecomment-806171889",
      "id" : 806171889,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21391",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwNjE3MTg4OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-24T20:39:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/806171889",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r604203643"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/604203643"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commits \"node/ifaces: NodeImpl: Use an accessor for ChainMan\" (3460a07d88d841c009e7b7efc0be2ae89bb4a63e)\r\nand \"node/ifaces: ChainImpl: Use an accessor for ChainMan\" (3b75ec491a68eb6fb137c2f829e7dde93b3c3189)\r\n\r\nNot important unless there will be a lot more of these, but I think it would be better not to add nested scopes for temporary asserts that we are going to want to remove and collapse later. The asserts seem good in other places where they can be removed with scripted diffs just deleting the assert lines. But places like this should be easier to clean up later using a helper like:\r\n\r\n```c++\r\n//! Temporary accessor that can be removed after\r\n//! https://github.com/bitcoin/bitcoin/pull/20158, but helps check correctness\r\n//! of refactored code in the meantime.\r\nstatic inline CChain& ActiveChain(ChainstateManager& chainman) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\r\n{\r\n    assert(std::addressof(::ChainActive()) == std::addressof(chainman.ActiveChain()));\r\n    return chainman.ActiveChain();\r\n}\r\n```\r\n\r\nthat could substituted out with a scripted-diff without needing to change surrounding code. Could also be appealing if you think usage looks nicer:\r\n\r\n```diff\r\n-        assert(std::addressof(::ChainActive()) == std::addressof(chainman().ActiveChain()));\r\n-        return chainman().ActiveChain().Height();\r\n+        return ActiveChain(chainman()).Height();\r\n```",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-03-30T15:27:29Z",
      "diff_hunk" : "@@ -183,21 +185,25 @@ class NodeImpl : public Node\n     int getNumBlocks() override\n     {\n         LOCK(::cs_main);\n-        assert(std::addressof(::ChainActive()) == std::addressof(m_context->chainman->ActiveChain()));\n-        return m_context->chainman->ActiveChain().Height();\n+        assert(std::addressof(::ChainActive()) == std::addressof(chainman().ActiveChain()));\n+        return chainman().ActiveChain().Height();\n     }\n     uint256 getBestBlockHash() override\n     {\n-        assert(std::addressof(::ChainActive()) == std::addressof(m_context->chainman->ActiveChain()));\n-        const CBlockIndex* tip = WITH_LOCK(::cs_main, return m_context->chainman->ActiveChain().Tip());\n+        const CBlockIndex* tip;\n+        {\n+            LOCK(cs_main);\n+            assert(std::addressof(::ChainActive()) == std::addressof(chainman().ActiveChain()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r604203643",
      "id" : 604203643,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNDIwMzY0Mw==",
      "original_commit_id" : "3460a07d88d841c009e7b7efc0be2ae89bb4a63e",
      "original_line" : 199,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/node/interfaces.cpp",
      "position" : null,
      "pull_request_review_id" : 624405217,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/604203643",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r604212432"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/604212432"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"net_processing: Move comments to declarations\" (067d0ba36cb701adff530f76ef9b1f574c966c6f)\r\n\r\nIs no more chain parameters.",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-03-30T15:38:03Z",
      "diff_hunk" : "@@ -475,19 +475,71 @@ class PeerManagerImpl final : public PeerManager\n     /** Offset into vExtraTxnForCompact to insert the next tx */\n     size_t vExtraTxnForCompactIt GUARDED_BY(g_cs_orphans) = 0;\n \n+    /** Check whether the last unknown block a peer advertised is not yet known. */\n     void ProcessBlockAvailability(NodeId nodeid) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+    /** Update tracking information about which blocks a peer is assumed to have. */\n     void UpdateBlockAvailability(NodeId nodeid, const uint256& hash) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n     bool CanDirectFetch() EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+\n+    /**\n+     * To prevent fingerprinting attacks, only send blocks/headers outside of\n+     * the active chain if they are no more than a month older (both in time,\n+     * and in best equivalent proof of work) than the best header chain we know\n+     * about and we fully-validated them at some point.\n+     */\n     bool BlockRequestAllowed(const CBlockIndex* pindex) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n     bool AlreadyHaveBlock(const uint256& block_hash) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n     void ProcessGetBlockData(CNode& pfrom, Peer& peer, const CInv& inv);\n+\n+    /**\n+     * Validation logic for compact filters request handling.\n+     *\n+     * May disconnect from the peer in the case of a bad request.\n+     *\n+     * @param[in]   peer            The peer that we received the request from\n+     * @param[in]   chain_params    Chain parameters",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r604212432",
      "id" : 604212432,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNDIxMjQzMg==",
      "original_commit_id" : "067d0ba36cb701adff530f76ef9b1f574c966c6f",
      "original_line" : 500,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 624405217,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/604212432",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Pushed 677b836c4847315bf24a9d222bbb2eb23a2b9a2c -> 188bb5e224d757d8d0603bb05a911f816776d295\r\n- Rebased on updated #21525, update summary reproduced below:\r\n\r\n> Pushed 3b75ec491a68eb6fb137c2f829e7dde93b3c3189 -> 693414d27181cf967f787a2ca72344e52c58c7f0\r\n> - Addressed https://github.com/bitcoin/bitcoin/pull/21391#pullrequestreview-624405217",
      "created_at" : "2021-03-30T17:56:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#issuecomment-810461117",
      "id" : 810461117,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21391",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMDQ2MTExNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-30T17:56:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/810461117",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Needs rebase?",
      "created_at" : "2021-04-01T09:51:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#issuecomment-811794240",
      "id" : 811794240,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21391",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMTc5NDI0MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-01T09:51:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/811794240",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Pushed 188bb5e224d757d8d0603bb05a911f816776d295 -> 7045f5f557f910827f13501e303ad617a8f0aaa6\r\n- Rebased over master after merge of #21525, fixed silent conflict in `src/rest.cpp`",
      "created_at" : "2021-04-02T21:05:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#issuecomment-812715600",
      "id" : 812715600,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21391",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMjcxNTYwMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-02T21:05:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/812715600",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@MarcoFalke re: https://github.com/bitcoin/bitcoin/pull/21525/files/e62067e7bcad5a559899afff2e4a8e8b7e9f4301..7b8e976cd5ac78a22f1be2b2fed8562c693af5d9#diff-cd34d7ba23b9b4f3f61cd06e9289c4981a5a6bcb17b61b5d010f3dc01c77787e\r\n\r\nThis is more or less what I'm thinking, let me know if I'm missing something!\r\n```diff\r\ndiff --git a/src/miner.cpp b/src/miner.cpp\r\nindex 8a9406f810..3bc7fdd458 100644\r\n--- a/src/miner.cpp\r\n+++ b/src/miner.cpp\r\n@@ -39,13 +39,14 @@ int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParam\r\n     return nNewTime - nOldTime;\r\n }\r\n \r\n-void RegenerateCommitments(CBlock& block, BlockManager& blockman)\r\n+void RegenerateCommitments(CBlock& block, CBlockIndex* prev_block)\r\n {\r\n     CMutableTransaction tx{*block.vtx.at(0)};\r\n     tx.vout.erase(tx.vout.begin() + GetWitnessCommitmentIndex(block));\r\n     block.vtx.at(0) = MakeTransactionRef(tx);\r\n \r\n-    GenerateCoinbaseCommitment(block, WITH_LOCK(::cs_main, assert(std::addressof(g_chainman.m_blockman) == std::addressof(blockman)); return blockman.LookupBlockIndex(block.hashPrevBlock)), Params().GetConsensus());\r\n+    WITH_LOCK(::cs_main, assert(g_chainman.m_blockman.LookupBlockIndex(block.hashPrevBlock) == prev_block));\r\n+    GenerateCoinbaseCommitment(block, prev_block, Params().GetConsensus());\r\n \r\n     block.hashMerkleRoot = BlockMerkleRoot(block);\r\n }\r\ndiff --git a/src/miner.h b/src/miner.h\r\nindex c400c90f6c..becf362b79 100644\r\n--- a/src/miner.h\r\n+++ b/src/miner.h\r\n@@ -202,8 +202,7 @@ private:\r\n void IncrementExtraNonce(CBlock* pblock, const CBlockIndex* pindexPrev, unsigned int& nExtraNonce);\r\n int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParams, const CBlockIndex* pindexPrev);\r\n \r\n-// TODO just accept a CBlockIndex*\r\n /** Update an old GenerateCoinbaseCommitment from CreateNewBlock after the block txs have changed */\r\n-void RegenerateCommitments(CBlock& block, BlockManager& blockman);\r\n+void RegenerateCommitments(CBlock& block, CBlockIndex* prev_block);\r\n \r\n #endif // BITCOIN_MINER_H\r\ndiff --git a/src/rpc/mining.cpp b/src/rpc/mining.cpp\r\nindex 8b54d07b50..5136a4e3de 100644\r\n--- a/src/rpc/mining.cpp\r\n+++ b/src/rpc/mining.cpp\r\n@@ -374,8 +374,8 @@ static RPCHelpMan generateblock()\r\n \r\n     // Add transactions\r\n     block.vtx.insert(block.vtx.end(), txs.begin(), txs.end());\r\n-    WITH_LOCK(::cs_main, CHECK_NONFATAL(std::addressof(g_chainman.m_blockman) == std::addressof(chainman.m_blockman)));\r\n-    RegenerateCommitments(block, WITH_LOCK(::cs_main, return std::ref(chainman.m_blockman)));\r\n+    CBlockIndex* prev_block = WITH_LOCK(::cs_main, return chainman.m_blockman.LookupBlockIndex(block.hashPrevBlock));\r\n+    RegenerateCommitments(block, prev_block);\r\n \r\n     {\r\n         LOCK(cs_main);\r\ndiff --git a/src/test/util/setup_common.cpp b/src/test/util/setup_common.cpp\r\nindex f7800aefca..46c7b781b0 100644\r\n--- a/src/test/util/setup_common.cpp\r\n+++ b/src/test/util/setup_common.cpp\r\n@@ -253,7 +253,8 @@ CBlock TestChain100Setup::CreateAndProcessBlock(const std::vector<CMutableTransa\r\n     for (const CMutableTransaction& tx : txns) {\r\n         block.vtx.push_back(MakeTransactionRef(tx));\r\n     }\r\n-    RegenerateCommitments(block, WITH_LOCK(::cs_main, return std::ref(g_chainman.m_blockman)));\r\n+    CBlockIndex* prev_block = WITH_LOCK(::cs_main, return g_chainman.m_blockman.LookupBlockIndex(block.hashPrevBlock));\r\n+    RegenerateCommitments(block, prev_block);\r\n \r\n     while (!CheckProofOfWork(block.GetHash(), block.nBits, chainparams.GetConsensus())) ++block.nNonce;\r\n \r\n\r\n```",
      "created_at" : "2021-04-02T21:09:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#issuecomment-812716831",
      "id" : 812716831,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21391",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMjcxNjgzMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-02T21:09:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/812716831",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r606625967"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/606625967"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: Would be nice to do this before locking cs_main, because I think cs_main should be made a (private) member of chainman in the future, if possible.",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-03T06:20:41Z",
      "diff_hunk" : "@@ -181,13 +181,14 @@ static bool rest_headers(const std::any& context,\n     headers.reserve(count);\n     {\n         LOCK(cs_main);\n-        tip = ::ChainActive().Tip();\n-        const CBlockIndex* pindex = g_chainman.m_blockman.LookupBlockIndex(hash);\n-        while (pindex != nullptr && ::ChainActive().Contains(pindex)) {\n+        ChainstateManager& chainman = EnsureChainman(context);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r606625967",
      "id" : 606625967,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNjYyNTk2Nw==",
      "original_commit_id" : "7045f5f557f910827f13501e303ad617a8f0aaa6",
      "original_line" : 183,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : null,
      "pull_request_review_id" : 627436295,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/606625967",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r606625982"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/606625982"
         }
      },
      "author_association" : "MEMBER",
      "body" : "same",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-03T06:20:53Z",
      "diff_hunk" : "@@ -249,8 +251,9 @@ static bool rest_block(HTTPRequest* req,\n     CBlockIndex* tip = nullptr;\n     {\n         LOCK(cs_main);\n-        tip = ::ChainActive().Tip();\n-        pblockindex = g_chainman.m_blockman.LookupBlockIndex(hash);\n+        ChainstateManager& chainman = EnsureChainman(context);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r606625982",
      "id" : 606625982,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNjYyNTk4Mg==",
      "original_commit_id" : "7045f5f557f910827f13501e303ad617a8f0aaa6",
      "original_line" : 253,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : null,
      "pull_request_review_id" : 627436295,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/606625982",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r606626126"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/606626126"
         }
      },
      "author_association" : "MEMBER",
      "body" : "same (etc ...)",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-03T06:23:20Z",
      "diff_hunk" : "@@ -822,8 +824,9 @@ static RPCHelpMan getblockheader()\n     const CBlockIndex* tip;\n     {\n         LOCK(cs_main);\n-        pblockindex = g_chainman.m_blockman.LookupBlockIndex(hash);\n-        tip = ::ChainActive().Tip();\n+        ChainstateManager& chainman = EnsureChainman(request.context);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r606626126",
      "id" : 606626126,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNjYyNjEyNg==",
      "original_commit_id" : "7045f5f557f910827f13501e303ad617a8f0aaa6",
      "original_line" : 842,
      "original_position" : 57,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 627436295,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/606626126",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> As you are modifying those lines, it would be nice if the chainman reference was created before taking cs_main, as that would simplify future work to remove cs_main (or reduce the scope of it).\r\n\r\nThese changes seem simple enough, so I'd be happy to make it. I do want to understand: how do you see these small changes helping with \"future work to remove cs_main (or reduce the scope of it)\"?",
      "created_at" : "2021-04-05T15:19:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#issuecomment-813449803",
      "id" : 813449803,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21391",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMzQ0OTgwMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-05T15:19:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/813449803",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "cs_main is a global and used to lock stuff that has nothing to do with validation (e.g. the p2p thread, disk access, orphan handling, ...). There is ongoing effort to clean those up: #19398, https://github.com/bitcoin/bitcoin/pull/21527/files#r601283910, https://github.com/bitcoin/bitcoin/pull/21598#issuecomment-813224175, ...\r\n\r\nIf cs_main is a member, the code might look like this:\r\n\r\n```cpp\r\nChainstatemanager& cm = ...;\r\nLOCK(cm.main);\r\n```\r\n\r\nSo simply getting a reference to the chainstatemanager before taking the lock will help in that regard, so that the two lines don't have to be switched in the future.",
      "created_at" : "2021-04-05T15:38:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#issuecomment-813459515",
      "id" : 813459515,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21391",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMzQ1OTUxNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-05T15:38:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/813459515",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607181930"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607181930"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Doesn't need `cs_main` to be locked first. You can also just call `ActiveHeight()`.",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-05T16:22:53Z",
      "diff_hunk" : "@@ -198,7 +199,7 @@ static RPCHelpMan getblockcount()\n         [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n {\n     LOCK(cs_main);\n-    return ::ChainActive().Height();\n+    return EnsureChainman(request.context).ActiveChain().Height();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607181930",
      "id" : 607181930,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNzE4MTkzMA==",
      "original_commit_id" : "7045f5f557f910827f13501e303ad617a8f0aaa6",
      "original_line" : 202,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 627966123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607181930",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607182273"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607182273"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Doesn't need `cs_main` to be locked first. You can also just call `ActiveTip()`.\r\n\r\n",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-05T16:23:34Z",
      "diff_hunk" : "@@ -217,7 +218,7 @@ static RPCHelpMan getbestblockhash()\n         [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n {\n     LOCK(cs_main);\n-    return ::ChainActive().Tip()->GetBlockHash().GetHex();\n+    return EnsureChainman(request.context).ActiveChain().Tip()->GetBlockHash().GetHex();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607182273",
      "id" : 607182273,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNzE4MjI3Mw==",
      "original_commit_id" : "7045f5f557f910827f13501e303ad617a8f0aaa6",
      "original_line" : 221,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 627966123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607182273",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607182630"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607182630"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Doesn't need `cs_main` to be locked first. You can also just call `ActiveTip()`.",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-05T16:24:11Z",
      "diff_hunk" : "@@ -398,7 +399,7 @@ static RPCHelpMan getdifficulty()\n         [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n {\n     LOCK(cs_main);\n-    return GetDifficulty(::ChainActive().Tip());\n+    return GetDifficulty(EnsureChainman(request.context).ActiveChain().Tip());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607182630",
      "id" : 607182630,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNzE4MjYzMA==",
      "original_commit_id" : "7045f5f557f910827f13501e303ad617a8f0aaa6",
      "original_line" : 402,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 627966123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607182630",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607190153"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607190153"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`ActiveTip()`",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-05T16:38:04Z",
      "diff_hunk" : "@@ -946,8 +949,9 @@ static RPCHelpMan getblock()\n     const CBlockIndex* tip;\n     {\n         LOCK(cs_main);\n-        pblockindex = g_chainman.m_blockman.LookupBlockIndex(hash);\n-        tip = ::ChainActive().Tip();\n+        ChainstateManager& chainman = EnsureChainman(request.context);\n+        pblockindex = chainman.m_blockman.LookupBlockIndex(hash);\n+        tip = chainman.ActiveChain().Tip();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607190153",
      "id" : 607190153,
      "line" : 970,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNzE5MDE1Mw==",
      "original_commit_id" : "7045f5f557f910827f13501e303ad617a8f0aaa6",
      "original_line" : 970,
      "original_position" : 71,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 171,
      "pull_request_review_id" : 627966123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607190153",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607190289"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607190289"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`ActiveHeight()`",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-05T16:38:15Z",
      "diff_hunk" : "@@ -997,15 +1002,15 @@ static RPCHelpMan pruneblockchain()\n     // too low to be a block time (corresponds to timestamp from Sep 2001).\n     if (heightParam > 1000000000) {\n         // Add a 2 hour buffer to include blocks which might have had old timestamps\n-        CBlockIndex* pindex = ::ChainActive().FindEarliestAtLeast(heightParam - TIMESTAMP_WINDOW, 0);\n+        CBlockIndex* pindex = chainman.ActiveChain().FindEarliestAtLeast(heightParam - TIMESTAMP_WINDOW, 0);\n         if (!pindex) {\n             throw JSONRPCError(RPC_INVALID_PARAMETER, \"Could not find block with at least the specified timestamp.\");\n         }\n         heightParam = pindex->nHeight;\n     }\n \n     unsigned int height = (unsigned int) heightParam;\n-    unsigned int chainHeight = (unsigned int) ::ChainActive().Height();\n+    unsigned int chainHeight = (unsigned int) chainman.ActiveChain().Height();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607190289",
      "id" : 607190289,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNzE5MDI4OQ==",
      "original_commit_id" : "7045f5f557f910827f13501e303ad617a8f0aaa6",
      "original_line" : 1029,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 627966123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607190289",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607190333"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607190333"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`ActiveTip()`",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-05T16:38:20Z",
      "diff_hunk" : "@@ -1015,8 +1020,8 @@ static RPCHelpMan pruneblockchain()\n         height = chainHeight - MIN_BLOCKS_TO_KEEP;\n     }\n \n-    PruneBlockFilesManual(::ChainstateActive(), height);\n-    const CBlockIndex* block = ::ChainActive().Tip();\n+    PruneBlockFilesManual(chainman.ActiveChainstate(), height);\n+    const CBlockIndex* block = chainman.ActiveChain().Tip();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607190333",
      "id" : 607190333,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNzE5MDMzMw==",
      "original_commit_id" : "7045f5f557f910827f13501e303ad617a8f0aaa6",
      "original_line" : 1040,
      "original_position" : 108,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 627966123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607190333",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607226203"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607226203"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    const CBlockIndex* tip = chainman.ActiveTip();\r\n```",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-05T17:43:19Z",
      "diff_hunk" : "@@ -1328,17 +1342,20 @@ RPCHelpMan getblockchaininfo()\n         [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n {\n     LOCK(cs_main);\n+    ChainstateManager& chainman = EnsureChainman(request.context);\n \n-    const CBlockIndex* tip = ::ChainActive().Tip();\n+    const CBlockIndex* tip = chainman.ActiveChain().Tip();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607226203",
      "id" : 607226203,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNzIyNjIwMw==",
      "original_commit_id" : "7045f5f557f910827f13501e303ad617a8f0aaa6",
      "original_line" : 1367,
      "original_position" : 217,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 627966123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607226203",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607228338"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607228338"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is casting an int to an int.\r\n\r\n```suggestion\r\n    obj.pushKV(\"blocks\",                height);\r\n```",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-05T17:47:21Z",
      "diff_hunk" : "@@ -1328,17 +1342,20 @@ RPCHelpMan getblockchaininfo()\n         [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n {\n     LOCK(cs_main);\n+    ChainstateManager& chainman = EnsureChainman(request.context);\n \n-    const CBlockIndex* tip = ::ChainActive().Tip();\n+    const CBlockIndex* tip = chainman.ActiveChain().Tip();\n+    CHECK_NONFATAL(tip);\n+    const int height = tip->nHeight;\n     UniValue obj(UniValue::VOBJ);\n     obj.pushKV(\"chain\",                 Params().NetworkIDString());\n-    obj.pushKV(\"blocks\",                (int)::ChainActive().Height());\n+    obj.pushKV(\"blocks\",                (int)height);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607228338",
      "id" : 607228338,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNzIyODMzOA==",
      "original_commit_id" : "7045f5f557f910827f13501e303ad617a8f0aaa6",
      "original_line" : 1352,
      "original_position" : 223,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 627966123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607228338",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607229343"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607229343"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe just:\r\n\r\n```suggestion\r\nstatic void BuriedForkDescPushBack(UniValue& softforks, const std::string &name, int softfork_height, int tip_height) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\r\n```\r\n\r\nnheight is hungarian, which we don't use any more.",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-05T17:49:07Z",
      "diff_hunk" : "@@ -1201,12 +1214,13 @@ static RPCHelpMan verifychain()\n \n     LOCK(cs_main);\n \n-    return CVerifyDB().VerifyDB(Params(), ::ChainstateActive(), &::ChainstateActive().CoinsTip(), check_level, check_depth);\n+    CChainState& active_chainstate = EnsureChainman(request.context).ActiveChainstate();\n+    return CVerifyDB().VerifyDB(Params(), active_chainstate, &active_chainstate.CoinsTip(), check_level, check_depth);\n },\n     };\n }\n \n-static void BuriedForkDescPushBack(UniValue& softforks, const std::string &name, int height) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+static void BuriedForkDescPushBack(UniValue& softforks, const std::string &name, int height, int active_tip_nheight) EXCLUSIVE_LOCKS_REQUIRED(cs_main)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607229343",
      "id" : 607229343,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNzIyOTM0Mw==",
      "original_commit_id" : "7045f5f557f910827f13501e303ad617a8f0aaa6",
      "original_line" : 1223,
      "original_position" : 167,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 627966123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607229343",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607230272"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607230272"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        pindex = chainman.ActiveTip();\r\n```",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-05T17:50:50Z",
      "diff_hunk" : "@@ -1679,20 +1699,21 @@ static RPCHelpMan getchaintxstats()\n                 },\n         [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n {\n+    ChainstateManager& chainman = EnsureChainman(request.context);\n     const CBlockIndex* pindex;\n     int blockcount = 30 * 24 * 60 * 60 / Params().GetConsensus().nPowTargetSpacing; // By default: 1 month\n \n     if (request.params[1].isNull()) {\n         LOCK(cs_main);\n-        pindex = ::ChainActive().Tip();\n+        pindex = chainman.ActiveChain().Tip();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607230272",
      "id" : 607230272,
      "line" : 1732,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNzIzMDI3Mg==",
      "original_commit_id" : "7045f5f557f910827f13501e303ad617a8f0aaa6",
      "original_line" : 1732,
      "original_position" : 334,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 516,
      "pull_request_review_id" : 627966123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607230272",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607230509"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607230509"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        const int current_tip = chainman.ActiveHeight();\r\n```",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-05T17:51:18Z",
      "diff_hunk" : "@@ -1861,26 +1882,27 @@ static RPCHelpMan getblockstats()\n         [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n {\n     LOCK(cs_main);\n+    ChainstateManager& chainman = EnsureChainman(request.context);\n \n     CBlockIndex* pindex;\n     if (request.params[0].isNum()) {\n         const int height = request.params[0].get_int();\n-        const int current_tip = ::ChainActive().Height();\n+        const int current_tip = chainman.ActiveChain().Height();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607230509",
      "id" : 607230509,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNzIzMDUwOQ==",
      "original_commit_id" : "7045f5f557f910827f13501e303ad617a8f0aaa6",
      "original_line" : 1910,
      "original_position" : 358,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 627966123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607230509",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607231032"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607231032"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n            tip = chainman.ActiveTip();\r\n```",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-05T17:52:21Z",
      "diff_hunk" : "@@ -2263,10 +2285,11 @@ static RPCHelpMan scantxoutset()\n         CBlockIndex* tip;\n         {\n             LOCK(cs_main);\n-            ::ChainstateActive().ForceFlushStateToDisk();\n-            pcursor = std::unique_ptr<CCoinsViewCursor>(::ChainstateActive().CoinsDB().Cursor());\n+            ChainstateManager& chainman = EnsureChainman(request.context);\n+            chainman.ActiveChainstate().ForceFlushStateToDisk();\n+            pcursor = std::unique_ptr<CCoinsViewCursor>(chainman.ActiveChainstate().CoinsDB().Cursor());\n             CHECK_NONFATAL(pcursor);\n-            tip = ::ChainActive().Tip();\n+            tip = chainman.ActiveChain().Tip();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607231032",
      "id" : 607231032,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNzIzMTAzMg==",
      "original_commit_id" : "7045f5f557f910827f13501e303ad617a8f0aaa6",
      "original_line" : 2313,
      "original_position" : 391,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 627966123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607231032",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607231883"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607231883"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        IncrementExtraNonce(&block, chainman.ActiveTip(), extra_nonce);\r\n```",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-05T17:53:59Z",
      "diff_hunk" : "@@ -111,7 +113,8 @@ static bool GenerateBlock(ChainstateManager& chainman, CBlock& block, uint64_t&\n \n     {\n         LOCK(cs_main);\n-        IncrementExtraNonce(&block, ::ChainActive().Tip(), extra_nonce);\n+        CHECK_NONFATAL(std::addressof(::ChainActive()) == std::addressof(chainman.ActiveChain()));\n+        IncrementExtraNonce(&block, chainman.ActiveChain().Tip(), extra_nonce);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607231883",
      "id" : 607231883,
      "line" : 117,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNzIzMTg4Mw==",
      "original_commit_id" : "7045f5f557f910827f13501e303ad617a8f0aaa6",
      "original_line" : 117,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/rpc/mining.cpp",
      "position" : 43,
      "pull_request_review_id" : 627966123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607231883",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607231972"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607231972"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        nHeight = chainman.ActiveHeight();\r\n```",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-05T17:54:09Z",
      "diff_hunk" : "@@ -143,7 +146,8 @@ static UniValue generateBlocks(ChainstateManager& chainman, const CTxMemPool& me\n \n     {   // Don't keep cs_main locked\n         LOCK(cs_main);\n-        nHeight = ::ChainActive().Height();\n+        CHECK_NONFATAL(std::addressof(::ChainActive()) == std::addressof(chainman.ActiveChain()));\n+        nHeight = chainman.ActiveChain().Height();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607231972",
      "id" : 607231972,
      "line" : 150,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNzIzMTk3Mg==",
      "original_commit_id" : "7045f5f557f910827f13501e303ad617a8f0aaa6",
      "original_line" : 150,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/rpc/mining.cpp",
      "position" : 53,
      "pull_request_review_id" : 627966123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607231972",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607232566"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607232566"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n            CBlockIndex* const pindexPrev = chainman.ActiveTip();\r\n```",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-05T17:55:14Z",
      "diff_hunk" : "@@ -628,12 +636,12 @@ static RPCHelpMan getblocktemplate()\n                 return \"duplicate-inconclusive\";\n             }\n \n-            CBlockIndex* const pindexPrev = ::ChainActive().Tip();\n+            CBlockIndex* const pindexPrev = chainman.ActiveChain().Tip();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607232566",
      "id" : 607232566,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNzIzMjU2Ng==",
      "original_commit_id" : "7045f5f557f910827f13501e303ad617a8f0aaa6",
      "original_line" : 645,
      "original_position" : 134,
      "original_start_line" : null,
      "path" : "src/rpc/mining.cpp",
      "position" : null,
      "pull_request_review_id" : 627966123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607232566",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607232747"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607232747"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n            hashWatchedChain = chainman.ActiveTip()->GetBlockHash();\r\n```",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-05T17:55:34Z",
      "diff_hunk" : "@@ -690,7 +698,7 @@ static RPCHelpMan getblocktemplate()\n         else\n         {\n             // NOTE: Spec does not specify behaviour for non-string longpollid, but this makes testing easier\n-            hashWatchedChain = ::ChainActive().Tip()->GetBlockHash();\n+            hashWatchedChain = chainman.ActiveChain().Tip()->GetBlockHash();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607232747",
      "id" : 607232747,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNzIzMjc0Nw==",
      "original_commit_id" : "7045f5f557f910827f13501e303ad617a8f0aaa6",
      "original_line" : 706,
      "original_position" : 158,
      "original_start_line" : null,
      "path" : "src/rpc/mining.cpp",
      "position" : null,
      "pull_request_review_id" : 627966123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607232747",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607233486"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607233486"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe just get ActiveChainstate once and then get the m_tip from there?",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-05T17:56:48Z",
      "diff_hunk" : "@@ -735,20 +743,20 @@ static RPCHelpMan getblocktemplate()\n     static CBlockIndex* pindexPrev;\n     static int64_t nStart;\n     static std::unique_ptr<CBlockTemplate> pblocktemplate;\n-    if (pindexPrev != ::ChainActive().Tip() ||\n+    if (pindexPrev != chainman.ActiveChain().Tip() ||",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607233486",
      "id" : 607233486,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNzIzMzQ4Ng==",
      "original_commit_id" : "7045f5f557f910827f13501e303ad617a8f0aaa6",
      "original_line" : 751,
      "original_position" : 167,
      "original_start_line" : null,
      "path" : "src/rpc/mining.cpp",
      "position" : null,
      "pull_request_review_id" : 627966123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607233486",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607233619"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607233619"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    result.pushKV(\"longpollid\", chainman.ActiveTip()->GetBlockHash().GetHex() + ToString(nTransactionsUpdatedLast));\r\n```",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-05T17:57:03Z",
      "diff_hunk" : "@@ -884,7 +892,7 @@ static RPCHelpMan getblocktemplate()\n     result.pushKV(\"transactions\", transactions);\n     result.pushKV(\"coinbaseaux\", aux);\n     result.pushKV(\"coinbasevalue\", (int64_t)pblock->vtx[0]->vout[0].nValue);\n-    result.pushKV(\"longpollid\", ::ChainActive().Tip()->GetBlockHash().GetHex() + ToString(nTransactionsUpdatedLast));\n+    result.pushKV(\"longpollid\", chainman.ActiveChain().Tip()->GetBlockHash().GetHex() + ToString(nTransactionsUpdatedLast));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607233619",
      "id" : 607233619,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNzIzMzYxOQ==",
      "original_commit_id" : "7045f5f557f910827f13501e303ad617a8f0aaa6",
      "original_line" : 900,
      "original_position" : 191,
      "original_start_line" : null,
      "path" : "src/rpc/mining.cpp",
      "position" : null,
      "pull_request_review_id" : 627966123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607233619",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607237567"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607237567"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe just grab `chainman.ActiveChain()` once above and then use it for each iteration.",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-05T18:04:10Z",
      "diff_hunk" : "@@ -181,13 +181,14 @@ static bool rest_headers(const std::any& context,\n     headers.reserve(count);\n     {\n         LOCK(cs_main);\n-        tip = ::ChainActive().Tip();\n-        const CBlockIndex* pindex = g_chainman.m_blockman.LookupBlockIndex(hash);\n-        while (pindex != nullptr && ::ChainActive().Contains(pindex)) {\n+        ChainstateManager& chainman = EnsureChainman(context);\n+        tip = chainman.ActiveChain().Tip();\n+        const CBlockIndex* pindex = chainman.m_blockman.LookupBlockIndex(hash);\n+        while (pindex != nullptr && chainman.ActiveChain().Contains(pindex)) {\n             headers.push_back(pindex);\n             if (headers.size() == (unsigned long)count)\n                 break;\n-            pindex = ::ChainActive().Next(pindex);\n+            pindex = chainman.ActiveChain().Next(pindex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607237567",
      "id" : 607237567,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNzIzNzU2Nw==",
      "original_commit_id" : "7045f5f557f910827f13501e303ad617a8f0aaa6",
      "original_line" : 191,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : null,
      "pull_request_review_id" : 627966123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607237567",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607238159"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607238159"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        tip = chainman.ActiveTip();\r\n```",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-05T18:05:19Z",
      "diff_hunk" : "@@ -249,8 +251,9 @@ static bool rest_block(HTTPRequest* req,\n     CBlockIndex* tip = nullptr;\n     {\n         LOCK(cs_main);\n-        tip = ::ChainActive().Tip();\n-        pblockindex = g_chainman.m_blockman.LookupBlockIndex(hash);\n+        ChainstateManager& chainman = EnsureChainman(context);\n+        tip = chainman.ActiveChain().Tip();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607238159",
      "id" : 607238159,
      "line" : 256,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNzIzODE1OQ==",
      "original_commit_id" : "7045f5f557f910827f13501e303ad617a8f0aaa6",
      "original_line" : 256,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : 39,
      "pull_request_review_id" : 627966123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607238159",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607239166"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607239166"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Perhaps just call `chainman.ActiveChainstate()` once in this function.",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-05T18:07:08Z",
      "diff_hunk" : "@@ -550,12 +554,12 @@ static bool rest_getutxos(const std::any& context, HTTPRequest* req, const std::\n             if (!mempool) return false;\n             // use db+mempool as cache backend in case user likes to query mempool\n             LOCK2(cs_main, mempool->cs);\n-            CCoinsViewCache& viewChain = ::ChainstateActive().CoinsTip();\n+            CCoinsViewCache& viewChain = chainman.ActiveChainstate().CoinsTip();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607239166",
      "id" : 607239166,
      "line" : 558,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNzIzOTE2Ng==",
      "original_commit_id" : "7045f5f557f910827f13501e303ad617a8f0aaa6",
      "original_line" : 558,
      "original_position" : 69,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : 72,
      "pull_request_review_id" : 627966123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607239166",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607253941"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607253941"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Agree about `ActiveHeight()` and similar comments below, but may be fine to leave the `LOCK(cs_main)` line as-is since I suspect we'll move to lock annotations for `ActiveChainstate()` in the near future (vs. the nested acquisition in the function definition).",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-05T18:34:20Z",
      "diff_hunk" : "@@ -198,7 +199,7 @@ static RPCHelpMan getblockcount()\n         [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n {\n     LOCK(cs_main);\n-    return ::ChainActive().Height();\n+    return EnsureChainman(request.context).ActiveChain().Height();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607253941",
      "id" : 607253941,
      "in_reply_to_id" : 607181930,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNzI1Mzk0MQ==",
      "original_commit_id" : "7045f5f557f910827f13501e303ad617a8f0aaa6",
      "original_line" : 202,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 628060034,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607253941",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607279832"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607279832"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`ActiveTip()`",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-05T19:22:52Z",
      "diff_hunk" : "@@ -823,8 +824,9 @@ static RPCHelpMan getblockheader()\n     const CBlockIndex* tip;\n     {\n         LOCK(cs_main);\n-        pblockindex = g_chainman.m_blockman.LookupBlockIndex(hash);\n-        tip = ::ChainActive().Tip();\n+        ChainstateManager& chainman = EnsureChainman(request.context);\n+        pblockindex = chainman.m_blockman.LookupBlockIndex(hash);\n+        tip = chainman.ActiveChain().Tip();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607279832",
      "id" : 607279832,
      "line" : 845,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNzI3OTgzMg==",
      "original_commit_id" : "9d67fd7229fd5444dace3d70c4fc0787d218c0d3",
      "original_line" : 845,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 158,
      "pull_request_review_id" : 628093401,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607279832",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607288645"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607288645"
         }
      },
      "author_association" : "MEMBER",
      "body" : "https://github.com/bitcoin/bitcoin/pull/21391/commits/626aa73ae48f6b5a50e88fc3d03e8c7842f75b1b\r\n\r\nCan remove unnecessary cast.",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-05T19:40:17Z",
      "diff_hunk" : "@@ -420,12 +426,13 @@ static RPCHelpMan getmininginfo()\n {\n     LOCK(cs_main);\n     const CTxMemPool& mempool = EnsureMemPool(request.context);\n+    const CChain& active_chain = EnsureChainman(request.context).ActiveChain();\n \n     UniValue obj(UniValue::VOBJ);\n-    obj.pushKV(\"blocks\",           (int)::ChainActive().Height());\n+    obj.pushKV(\"blocks\",           (int)active_chain.Height());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607288645",
      "id" : 607288645,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNzI4ODY0NQ==",
      "original_commit_id" : "626aa73ae48f6b5a50e88fc3d03e8c7842f75b1b",
      "original_line" : 432,
      "original_position" : 104,
      "original_start_line" : null,
      "path" : "src/rpc/mining.cpp",
      "position" : null,
      "pull_request_review_id" : 628104855,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607288645",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607293378"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607293378"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`ActiveTip()`",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-05T19:50:00Z",
      "diff_hunk" : "@@ -181,13 +181,14 @@ static bool rest_headers(const std::any& context,\n     headers.reserve(count);\n     {\n         LOCK(cs_main);\n-        tip = ::ChainActive().Tip();\n-        const CBlockIndex* pindex = g_chainman.m_blockman.LookupBlockIndex(hash);\n-        while (pindex != nullptr && ::ChainActive().Contains(pindex)) {\n+        ChainstateManager& chainman = EnsureChainman(context);\n+        tip = chainman.ActiveChain().Tip();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607293378",
      "id" : 607293378,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNzI5MzM3OA==",
      "original_commit_id" : "7045f5f557f910827f13501e303ad617a8f0aaa6",
      "original_line" : 185,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : null,
      "pull_request_review_id" : 628104855,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607293378",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607603389"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607603389"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think that'd be a move in the wrong direction. Ideally we'd remove the need to lock `cs_main` completely from the `Active*()` methods. I'm concerned that adding so many additional cs_main locks may cause performance regressions - for example, the optimization in #8007 is no longer possible since cs_main will almost always be locked before calling `IsInitialBlockDownload()`\r\n\r\n@jamesob: Did you consider changing the active pointer to being an atomic to remove this requirement as suggested here: https://github.com/bitcoin/bitcoin/pull/19806#issuecomment-768946522?",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-06T07:36:32Z",
      "diff_hunk" : "@@ -198,7 +199,7 @@ static RPCHelpMan getblockcount()\n         [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n {\n     LOCK(cs_main);\n-    return ::ChainActive().Height();\n+    return EnsureChainman(request.context).ActiveChain().Height();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607603389",
      "id" : 607603389,
      "in_reply_to_id" : 607181930,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNzYwMzM4OQ==",
      "original_commit_id" : "7045f5f557f910827f13501e303ad617a8f0aaa6",
      "original_line" : 202,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 628660031,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607603389",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607856088"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607856088"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think you may be forgetting that long before `ChainstateManager` was introduced, [`chainActive` was protected by `cs_main`](https://github.com/bitcoin/bitcoin/blob/0.16/src/validation.h#L445). So unless we dramatically rework the chainstate locking scheme, the `Active{Height,Tip,..}()` methods will always require holding cs_main one way or another. I think ultimately annotations are a cleaner way of doing this because they give callers the flexibility to reuse existing cs_main acquisitions, and avoid recursive locking.\r\n\r\nYour suggestion to move chainman's active pointer to an atomic may be a good one, but I think it's largely incidental in terms of performance since we usually need to acquire cs_main anyway when referencing chainstate data. Though my comment above is unrelated to that, since I'm making reference to the chain's protection by cs_main and not ancillary ChainstateManager layout.\r\n\r\n[Recent bitcoinperf benchmarks](https://bitcoinperf.com/d/YiV16Vsik/overview?orgId=1&from=now-1y&to=now) don't indicate any regressions in recent revisions, but I will be doing more thorough benchmarking in a bit.",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-06T13:37:21Z",
      "diff_hunk" : "@@ -198,7 +199,7 @@ static RPCHelpMan getblockcount()\n         [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n {\n     LOCK(cs_main);\n-    return ::ChainActive().Height();\n+    return EnsureChainman(request.context).ActiveChain().Height();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r607856088",
      "id" : 607856088,
      "in_reply_to_id" : 607181930,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNzg1NjA4OA==",
      "original_commit_id" : "7045f5f557f910827f13501e303ad617a8f0aaa6",
      "original_line" : 202,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 628980010,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/607856088",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Question: Is there an actual difference between `chainman.ActiveTip/Height()` and `chainman.ActiveChain().Tip/height()` or is it just shorter?",
      "created_at" : "2021-04-06T17:26:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#issuecomment-814297548",
      "id" : 814297548,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21391",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxNDI5NzU0OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-06T17:26:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/814297548",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Is there an actual difference between chainman.ActiveTip/Height() and chainman.ActiveChain().Tip/height() or is it just shorter?\r\n\r\nJust shorter. Feel free to ignore those comments if you disagree that it's clearer.",
      "created_at" : "2021-04-06T17:28:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#issuecomment-814299046",
      "id" : 814299046,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21391",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxNDI5OTA0Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-06T17:28:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/814299046",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Pushed 7045f5f557f910827f13501e303ad617a8f0aaa6 -> 1c483e8e73c9f02674895b73b017dc0d13a030b0\r\n- Addressed MarcoFalke's `cs_main` vs `ChainstateManager` code ordering comments\r\n- Addressed jnewbery and jamesob's height int casting comments\r\n- Addressed jnewbery's BuriedForkDescPushBack signature comments\r\n\r\nw/re getting rid of multiple calls to `ActiveChain{,State}()`, I really didn't consider it part of the PR scope, but am happy to do it if it's very simple and can be easily convinced that it's safe+correct. I had some questions for jamesob here: https://github.com/bitcoin/bitcoin/pull/21620#issuecomment-818372304",
      "created_at" : "2021-04-13T01:49:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#issuecomment-818371626",
      "id" : 818371626,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21391",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxODM3MTYyNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-13T01:53:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/818371626",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Pushed 1c483e8e73c9f02674895b73b017dc0d13a030b0 -> 6d923137f6eb31ace6f2d38480708af039a21437\r\n- Once more, with feeling...\r\n- I renamed params in last commit but forgot to rename references... oops",
      "created_at" : "2021-04-13T02:42:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#issuecomment-818389704",
      "id" : 818389704,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21391",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxODM4OTcwNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-13T02:42:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/818389704",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r612548023"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/612548023"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"rpc: Add alt Ensure* functions acepting NodeContext\" (306b1cd3eeb2502904ed4698646d2c86d028aad2)\r\n\r\nCaramba. I think this commit is ok, but it is a footgun to have overloaded functions where one of the functions takes an untyped std::any argument, because someone could easily try to call the typed overload, and fail because the type is a little off (const instead of nonconst, pointer instead of reference, or just accidentally passing the wrong variable), and the compiler will never catch it because it will fall back to the std::any overload.\r\n\r\nI think the new functions are good, but the existing std::any functions should be renamed to EnsureAnyMemPool, EnsureAnyChainman, etc to be more distinct. Or maybe the std::any functions should take JSONRPCRequest arguments instead. Or maybe they can be removed after a lot of usages are removed in the next commit.\r\n\r\nAnyway no need to worry about now. Save for bundle â26\r\n\r\n",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-13T15:22:11Z",
      "diff_hunk" : "@@ -57,8 +57,11 @@ void ScriptPubKeyToUniv(const CScript& scriptPubKey, UniValue& out, bool fInclud\n void TxToUniv(const CTransaction& tx, const uint256& hashBlock, UniValue& entry, bool include_hex = true, int serialize_flags = 0, const CTxUndo* txundo = nullptr);\n \n NodeContext& EnsureNodeContext(const std::any& context);\n+CTxMemPool& EnsureMemPool(const NodeContext& node);\n CTxMemPool& EnsureMemPool(const std::any& context);\n+ChainstateManager& EnsureChainman(const NodeContext& node);\n ChainstateManager& EnsureChainman(const std::any& context);\n+CBlockPolicyEstimator& EnsureFeeEstimator(const NodeContext& node);\n CBlockPolicyEstimator& EnsureFeeEstimator(const std::any& context);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r612548023",
      "id" : 612548023,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMjU0ODAyMw==",
      "original_commit_id" : "306b1cd3eeb2502904ed4698646d2c86d028aad2",
      "original_line" : 65,
      "original_position" : 9,
      "original_start_line" : 60,
      "path" : "src/rpc/blockchain.h",
      "position" : null,
      "pull_request_review_id" : 634726016,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-04-14T15:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/612548023",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r613942578"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613942578"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think it'd be better to move this `EnsureChainman()` to the top of the function. If chainman doesn't exist, then it's better to immediately exit from the function.",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-15T10:13:53Z",
      "diff_hunk" : "@@ -2261,15 +2308,17 @@ static RPCHelpMan scantxoutset()\n         int64_t count = 0;\n         std::unique_ptr<CCoinsViewCursor> pcursor;\n         CBlockIndex* tip;\n+        NodeContext& node = EnsureAnyNodeContext(request.context);\n         {\n+            ChainstateManager& chainman = EnsureChainman(node);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r613942578",
      "id" : 613942578,
      "line" : 2313,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMzk0MjU3OA==",
      "original_commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "original_line" : 2313,
      "original_position" : 579,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 579,
      "pull_request_review_id" : 636515425,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-15T12:00:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613942578",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r613943376"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613943376"
         }
      },
      "author_association" : "MEMBER",
      "body" : "While you're touching this, perhaps change it to use `std::make_unique`. That's the standard way to set unique pointers now that we're on c++17.",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-15T10:15:07Z",
      "diff_hunk" : "@@ -2261,15 +2308,17 @@ static RPCHelpMan scantxoutset()\n         int64_t count = 0;\n         std::unique_ptr<CCoinsViewCursor> pcursor;\n         CBlockIndex* tip;\n+        NodeContext& node = EnsureAnyNodeContext(request.context);\n         {\n+            ChainstateManager& chainman = EnsureChainman(node);\n             LOCK(cs_main);\n-            ::ChainstateActive().ForceFlushStateToDisk();\n-            pcursor = std::unique_ptr<CCoinsViewCursor>(::ChainstateActive().CoinsDB().Cursor());\n+            CChainState& active_chainstate = chainman.ActiveChainstate();\n+            active_chainstate.ForceFlushStateToDisk();\n+            pcursor = std::unique_ptr<CCoinsViewCursor>(active_chainstate.CoinsDB().Cursor());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r613943376",
      "id" : 613943376,
      "line" : 2317,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMzk0MzM3Ng==",
      "original_commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "original_line" : 2317,
      "original_position" : 585,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 585,
      "pull_request_review_id" : 636515425,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-15T12:00:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613943376",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r613944794"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613944794"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Again, chainman is a requirement for this function. I think it makes sense to place the assumption at the top of the function.",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-15T10:17:18Z",
      "diff_hunk" : "@@ -2342,8 +2391,9 @@ static RPCHelpMan getblockfilter()\n     const CBlockIndex* block_index;\n     bool block_was_connected;\n     {\n+        ChainstateManager& chainman = EnsureAnyChainman(request.context);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r613944794",
      "id" : 613944794,
      "line" : 2394,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMzk0NDc5NA==",
      "original_commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "original_line" : 2394,
      "original_position" : 599,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 599,
      "pull_request_review_id" : 636515425,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-15T12:00:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613944794",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r613951719"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613951719"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Even though it's not annotated as such, I think that holding a reference to `m_chain` and calling methods on it requires holding `cs_main`. Perhaps it would be a good idea to either:\r\n\r\n1. annotate this function and add an assertion that cs_main is held; or\r\n2. pass in a `&Chainman`, then inside the function lock cs_main, get the `CChain&`, and call the methods on that `CChain&`.\r\n\r\nI think (2) is nicer - best to limit scope of locks as much as possible.",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-15T10:28:02Z",
      "diff_hunk" : "@@ -44,11 +44,12 @@\n  * or from the last difficulty change if 'lookup' is nonpositive.\n  * If 'height' is nonnegative, compute the estimate at the time when a given block was found.\n  */\n-static UniValue GetNetworkHashPS(int lookup, int height) {\n-    CBlockIndex *pb = ::ChainActive().Tip();\n+static UniValue GetNetworkHashPS(int lookup, int height, const CChain& active_chain) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r613951719",
      "id" : 613951719,
      "line" : 47,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMzk1MTcxOQ==",
      "original_commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "original_line" : 47,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/rpc/mining.cpp",
      "position" : 6,
      "pull_request_review_id" : 636515425,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-15T12:00:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613951719",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r613953875"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613953875"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This line is long and difficult to read. Consider something like this:\r\n\r\n```diff\r\ndiff --git a/src/rpc/mining.cpp b/src/rpc/mining.cpp\r\nindex 0cef310c50..b60783761d 100644\r\n--- a/src/rpc/mining.cpp\r\n+++ b/src/rpc/mining.cpp\r\n@@ -102,7 +102,9 @@ static RPCHelpMan getnetworkhashps()\r\n {\r\n     ChainstateManager& chainman = EnsureAnyChainman(request.context);\r\n     LOCK(cs_main);\r\n-    return GetNetworkHashPS(!request.params[0].isNull() ? request.params[0].get_int() : 120, !request.params[1].isNull() ? request.params[1].get_int() : -1, chainman.ActiveChain());\r\n+    const int blocks{!request.params[0].isNull() ? request.params[0].get_int() : 120};\r\n+    const int height{!request.params[1].isNull() ? request.params[1].get_int() : -1};\r\n+    return GetNetworkHashPS(blocks, height, chainman.ActiveChain());\r\n },\r\n     };\r\n }\r\n```\r\n\r\nIt almost certainly compiles to the same thing, is much easier to read and reduces the risk of precedence bugs.",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-15T10:31:32Z",
      "diff_hunk" : "@@ -99,8 +100,9 @@ static RPCHelpMan getnetworkhashps()\n                 },\n         [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n {\n+    ChainstateManager& chainman = EnsureAnyChainman(request.context);\n     LOCK(cs_main);\n-    return GetNetworkHashPS(!request.params[0].isNull() ? request.params[0].get_int() : 120, !request.params[1].isNull() ? request.params[1].get_int() : -1);\n+    return GetNetworkHashPS(!request.params[0].isNull() ? request.params[0].get_int() : 120, !request.params[1].isNull() ? request.params[1].get_int() : -1, chainman.ActiveChain());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r613953875",
      "id" : 613953875,
      "line" : 105,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMzk1Mzg3NQ==",
      "original_commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "original_line" : 105,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/rpc/mining.cpp",
      "position" : 33,
      "pull_request_review_id" : 636515425,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-15T12:00:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613953875",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r613967463"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613967463"
         }
      },
      "author_association" : "MEMBER",
      "body" : "For a follow-up: `IncrementExtraNonce()` doesn't require cs_main. In fact, we could just get a height using `chainman.ActiveHeight()` and pass that to `IncrementExtraNonce()`.",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-15T10:54:48Z",
      "diff_hunk" : "@@ -111,7 +113,8 @@ static bool GenerateBlock(ChainstateManager& chainman, CBlock& block, uint64_t&\n \n     {\n         LOCK(cs_main);\n-        IncrementExtraNonce(&block, ::ChainActive().Tip(), extra_nonce);\n+        CHECK_NONFATAL(std::addressof(::ChainActive()) == std::addressof(chainman.ActiveChain()));\n+        IncrementExtraNonce(&block, chainman.ActiveChain().Tip(), extra_nonce);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r613967463",
      "id" : 613967463,
      "line" : 117,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMzk2NzQ2Mw==",
      "original_commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "original_line" : 117,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/rpc/mining.cpp",
      "position" : 43,
      "pull_request_review_id" : 636515425,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-15T12:00:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613967463",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r613992845"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613992845"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I haven't commented on all of these examples, but I really do think readability is helped by placing the `Ensure*()` assumptions at the top of the rpc methods.",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-15T11:38:29Z",
      "diff_hunk" : "@@ -1598,9 +1606,11 @@ static RPCHelpMan utxoupdatepsbt()\n     CCoinsView viewDummy;\n     CCoinsViewCache view(&viewDummy);\n     {\n-        const CTxMemPool& mempool = EnsureMemPool(request.context);\n+        NodeContext& node = EnsureAnyNodeContext(request.context);\n+        const CTxMemPool& mempool = EnsureMemPool(node);\n+        ChainstateManager& chainman = EnsureChainman(node);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r613992845",
      "id" : 613992845,
      "line" : 1611,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMzk5Mjg0NQ==",
      "original_commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "original_line" : 1611,
      "original_position" : 168,
      "original_start_line" : null,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : 168,
      "pull_request_review_id" : 636515425,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-15T12:00:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/613992845",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r614696860"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/614696860"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Shouldn't Cursor return a unique_ptr?",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-16T09:26:34Z",
      "diff_hunk" : "@@ -2261,15 +2308,17 @@ static RPCHelpMan scantxoutset()\n         int64_t count = 0;\n         std::unique_ptr<CCoinsViewCursor> pcursor;\n         CBlockIndex* tip;\n+        NodeContext& node = EnsureAnyNodeContext(request.context);\n         {\n+            ChainstateManager& chainman = EnsureChainman(node);\n             LOCK(cs_main);\n-            ::ChainstateActive().ForceFlushStateToDisk();\n-            pcursor = std::unique_ptr<CCoinsViewCursor>(::ChainstateActive().CoinsDB().Cursor());\n+            CChainState& active_chainstate = chainman.ActiveChainstate();\n+            active_chainstate.ForceFlushStateToDisk();\n+            pcursor = std::unique_ptr<CCoinsViewCursor>(active_chainstate.CoinsDB().Cursor());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r614696860",
      "id" : 614696860,
      "in_reply_to_id" : 613943376,
      "line" : 2317,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNDY5Njg2MA==",
      "original_commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "original_line" : 2317,
      "original_position" : 585,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 585,
      "pull_request_review_id" : 637507790,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-16T09:26:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/614696860",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r614706952"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/614706952"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, you're right. `Cursor()` is passing ownership to the caller.",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-16T09:42:09Z",
      "diff_hunk" : "@@ -2261,15 +2308,17 @@ static RPCHelpMan scantxoutset()\n         int64_t count = 0;\n         std::unique_ptr<CCoinsViewCursor> pcursor;\n         CBlockIndex* tip;\n+        NodeContext& node = EnsureAnyNodeContext(request.context);\n         {\n+            ChainstateManager& chainman = EnsureChainman(node);\n             LOCK(cs_main);\n-            ::ChainstateActive().ForceFlushStateToDisk();\n-            pcursor = std::unique_ptr<CCoinsViewCursor>(::ChainstateActive().CoinsDB().Cursor());\n+            CChainState& active_chainstate = chainman.ActiveChainstate();\n+            active_chainstate.ForceFlushStateToDisk();\n+            pcursor = std::unique_ptr<CCoinsViewCursor>(active_chainstate.CoinsDB().Cursor());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r614706952",
      "id" : 614706952,
      "in_reply_to_id" : 613943376,
      "line" : 2317,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNDcwNjk1Mg==",
      "original_commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "original_line" : 2317,
      "original_position" : 585,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 585,
      "pull_request_review_id" : 637521186,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-16T09:42:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/614706952",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r614711882"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/614711882"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm going to mark this comment as resolved since this PR shouldn't make any changes here. I think `Cursor()`'s return type should be changed in a separate PR.",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-16T09:49:52Z",
      "diff_hunk" : "@@ -2261,15 +2308,17 @@ static RPCHelpMan scantxoutset()\n         int64_t count = 0;\n         std::unique_ptr<CCoinsViewCursor> pcursor;\n         CBlockIndex* tip;\n+        NodeContext& node = EnsureAnyNodeContext(request.context);\n         {\n+            ChainstateManager& chainman = EnsureChainman(node);\n             LOCK(cs_main);\n-            ::ChainstateActive().ForceFlushStateToDisk();\n-            pcursor = std::unique_ptr<CCoinsViewCursor>(::ChainstateActive().CoinsDB().Cursor());\n+            CChainState& active_chainstate = chainman.ActiveChainstate();\n+            active_chainstate.ForceFlushStateToDisk();\n+            pcursor = std::unique_ptr<CCoinsViewCursor>(active_chainstate.CoinsDB().Cursor());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r614711882",
      "id" : 614711882,
      "in_reply_to_id" : 613943376,
      "line" : 2317,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNDcxMTg4Mg==",
      "original_commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "original_line" : 2317,
      "original_position" : 585,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 585,
      "pull_request_review_id" : 637527625,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-16T09:49:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/614711882",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r615237925"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/615237925"
         }
      },
      "author_association" : "MEMBER",
      "body" : "cced0f46c9:\r\n\r\nI don't understand this commit. Is the goal to remove this assert? If yes, how are new callers protected from accidentally passing the wrong pointer? If no, you'll need to pass blockman again, making this commit useless.\r\n\r\nAlso, this seems to put more code burden on the caller, duplicating the LookupBlockIndex at each call site.\r\n\r\nIt might help to specify a goal of the commit here. Is the goal to avoid locking cs_main twice instead of only once? If yes, a simpler solution would be to just pass chainman (from the rpc context) instead of the blockman reference (which needs cs_main to be taken from chainman).",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-17T10:22:53Z",
      "diff_hunk" : "@@ -39,13 +39,14 @@ int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParam\n     return nNewTime - nOldTime;\n }\n \n-void RegenerateCommitments(CBlock& block, BlockManager& blockman)\n+void RegenerateCommitments(CBlock& block, CBlockIndex* prev_block)\n {\n     CMutableTransaction tx{*block.vtx.at(0)};\n     tx.vout.erase(tx.vout.begin() + GetWitnessCommitmentIndex(block));\n     block.vtx.at(0) = MakeTransactionRef(tx);\n \n-    GenerateCoinbaseCommitment(block, WITH_LOCK(::cs_main, assert(std::addressof(g_chainman.m_blockman) == std::addressof(blockman)); return blockman.LookupBlockIndex(block.hashPrevBlock)), Params().GetConsensus());\n+    WITH_LOCK(::cs_main, assert(g_chainman.m_blockman.LookupBlockIndex(block.hashPrevBlock) == prev_block));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r615237925",
      "id" : 615237925,
      "line" : 48,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNTIzNzkyNQ==",
      "original_commit_id" : "cced0f46c9133e0fc6211e987421ad1d9be1a399",
      "original_line" : 48,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/miner.cpp",
      "position" : 12,
      "pull_request_review_id" : 638216483,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-17T11:25:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/615237925",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r615240200"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/615240200"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Looks like all the chainman references are still acquired after cs_main?",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-17T10:47:50Z",
      "diff_hunk" : "@@ -2264,10 +2285,11 @@ static RPCHelpMan scantxoutset()\n         CBlockIndex* tip;\n         {\n             LOCK(cs_main);\n-            ::ChainstateActive().ForceFlushStateToDisk();\n-            pcursor = std::unique_ptr<CCoinsViewCursor>(::ChainstateActive().CoinsDB().Cursor());\n+            ChainstateManager& chainman = EnsureChainman(request.context);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r615240200",
      "id" : 615240200,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNTI0MDIwMA==",
      "original_commit_id" : "d485e815e2b62dc74a485569d08130dc3ef9ff63",
      "original_line" : 2288,
      "original_position" : 378,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 638216483,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-17T11:25:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/615240200",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r615241789"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/615241789"
         }
      },
      "author_association" : "MEMBER",
      "body" : "same ...",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-17T11:06:54Z",
      "diff_hunk" : "@@ -1600,7 +1603,7 @@ static RPCHelpMan utxoupdatepsbt()\n     {\n         const CTxMemPool& mempool = EnsureMemPool(request.context);\n         LOCK2(cs_main, mempool.cs);\n-        CCoinsViewCache &viewChain = ::ChainstateActive().CoinsTip();\n+        CCoinsViewCache &viewChain = EnsureChainman(request.context).ActiveChainstate().CoinsTip();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r615241789",
      "id" : 615241789,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNTI0MTc4OQ==",
      "original_commit_id" : "7be0671b950842fc3a17641a4a21501de0a800b5",
      "original_line" : 1606,
      "original_position" : 123,
      "original_start_line" : null,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 638216483,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-17T11:25:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/615241789",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r615243437"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/615243437"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This may crash the node if the chainman is not available.\r\n\r\n```\r\nterminate called after throwing an instance of 'UniValue'\r\n```\r\n\r\n",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-17T11:24:59Z",
      "diff_hunk" : "@@ -250,8 +251,9 @@ static bool rest_block(const std::any& context,\n     CBlockIndex* tip = nullptr;\n     {\n         LOCK(cs_main);\n-        tip = ::ChainActive().Tip();\n-        pblockindex = g_chainman.m_blockman.LookupBlockIndex(hash);\n+        ChainstateManager& chainman = EnsureChainman(context);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r615243437",
      "id" : 615243437,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNTI0MzQzNw==",
      "original_commit_id" : "d7824acdb9b18fe8f151771a83ccae1681f16c66",
      "original_line" : 254,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : null,
      "pull_request_review_id" : 638216483,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-17T11:25:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/615243437",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r615267283"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/615267283"
         }
      },
      "author_association" : "MEMBER",
      "body" : "6fb65b49f4: the scripted diff will modify files that are not tracked by git. Could use `...  -- $(git grep -l Ensure)`",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-17T15:21:16Z",
      "diff_hunk" : "@@ -181,7 +181,7 @@ static bool rest_headers(const std::any& context,\n     headers.reserve(count);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r615267283",
      "id" : 615267283,
      "line" : 181,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNTI2NzI4Mw==",
      "original_commit_id" : "6fb65b49f4d393b091479be5a5df5a0a160cf986",
      "original_line" : 181,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : 2,
      "pull_request_review_id" : 638235264,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-17T15:34:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/615267283",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r615269206"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/615269206"
         }
      },
      "author_association" : "MEMBER",
      "body" : "(unresolved comment to make it easier to see all that needs to be addressed in follow-ups)",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-04-17T15:40:03Z",
      "diff_hunk" : "@@ -2261,15 +2308,17 @@ static RPCHelpMan scantxoutset()\n         int64_t count = 0;\n         std::unique_ptr<CCoinsViewCursor> pcursor;\n         CBlockIndex* tip;\n+        NodeContext& node = EnsureAnyNodeContext(request.context);\n         {\n+            ChainstateManager& chainman = EnsureChainman(node);\n             LOCK(cs_main);\n-            ::ChainstateActive().ForceFlushStateToDisk();\n-            pcursor = std::unique_ptr<CCoinsViewCursor>(::ChainstateActive().CoinsDB().Cursor());\n+            CChainState& active_chainstate = chainman.ActiveChainstate();\n+            active_chainstate.ForceFlushStateToDisk();\n+            pcursor = std::unique_ptr<CCoinsViewCursor>(active_chainstate.CoinsDB().Cursor());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r615269206",
      "id" : 615269206,
      "in_reply_to_id" : 613943376,
      "line" : 2317,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNTI2OTIwNg==",
      "original_commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "original_line" : 2317,
      "original_position" : 585,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 585,
      "pull_request_review_id" : 638236472,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-17T15:40:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/615269206",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r628904581"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/628904581"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This doesn't require `cs_main`.",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-05-09T15:18:36Z",
      "diff_hunk" : "@@ -1069,13 +1092,21 @@ static RPCHelpMan gettxoutsetinfo()\n     UniValue ret(UniValue::VOBJ);\n \n     CCoinsStats stats;\n-    ::ChainstateActive().ForceFlushStateToDisk();\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    ChainstateManager& chainman = EnsureChainman(node);\n+    CChainState& active_chainstate = chainman.ActiveChainstate();\n+    active_chainstate.ForceFlushStateToDisk();\n \n     const CoinStatsHashType hash_type{request.params[0].isNull() ? CoinStatsHashType::HASH_SERIALIZED : ParseHashType(request.params[0].get_str())};\n \n-    CCoinsView* coins_view = WITH_LOCK(::cs_main, return &::ChainstateActive().CoinsDB());\n-    NodeContext& node = EnsureNodeContext(request.context);\n-    if (GetUTXOStats(coins_view, WITH_LOCK(::cs_main, return std::ref(g_chainman.m_blockman)), stats, hash_type, node.rpc_interruption_point)) {\n+    CCoinsView* coins_view;\n+    BlockManager* blockman;\n+    {\n+        LOCK(::cs_main);\n+        coins_view = &active_chainstate.CoinsDB();\n+        blockman = &active_chainstate.m_blockman;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r628904581",
      "id" : 628904581,
      "line" : 1107,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyODkwNDU4MQ==",
      "original_commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "original_line" : 1107,
      "original_position" : 235,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 235,
      "pull_request_review_id" : 655088365,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-09T15:20:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/628904581",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r628904755"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/628904755"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's slightly confusing to take the references from `CoinsDB()` and `m_blockman` and take their addresses to make pointers, and then just dereference those pointers. Better just to use references as the local variables.",
      "commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "created_at" : "2021-05-09T15:20:22Z",
      "diff_hunk" : "@@ -1069,13 +1092,21 @@ static RPCHelpMan gettxoutsetinfo()\n     UniValue ret(UniValue::VOBJ);\n \n     CCoinsStats stats;\n-    ::ChainstateActive().ForceFlushStateToDisk();\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    ChainstateManager& chainman = EnsureChainman(node);\n+    CChainState& active_chainstate = chainman.ActiveChainstate();\n+    active_chainstate.ForceFlushStateToDisk();\n \n     const CoinStatsHashType hash_type{request.params[0].isNull() ? CoinStatsHashType::HASH_SERIALIZED : ParseHashType(request.params[0].get_str())};\n \n-    CCoinsView* coins_view = WITH_LOCK(::cs_main, return &::ChainstateActive().CoinsDB());\n-    NodeContext& node = EnsureNodeContext(request.context);\n-    if (GetUTXOStats(coins_view, WITH_LOCK(::cs_main, return std::ref(g_chainman.m_blockman)), stats, hash_type, node.rpc_interruption_point)) {\n+    CCoinsView* coins_view;\n+    BlockManager* blockman;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21391#discussion_r628904755",
      "id" : 628904755,
      "line" : 1103,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyODkwNDc1NQ==",
      "original_commit_id" : "586190f0b4740457cb86cba632e3d64e6dfe9b0c",
      "original_line" : 1103,
      "original_position" : 231,
      "original_start_line" : 1102,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 231,
      "pull_request_review_id" : 655088365,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21391",
      "side" : "RIGHT",
      "start_line" : 1102,
      "start_side" : "RIGHT",
      "updated_at" : "2021-05-09T15:20:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/628904755",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   }
]
