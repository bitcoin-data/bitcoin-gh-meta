[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-01-25T10:58:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#issuecomment-1021061595",
      "id" : 1021061595,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24149",
      "node_id" : "IC_kwDOABII58483Cnb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1021061595/reactions"
      },
      "updated_at" : "2022-01-25T10:58:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1021061595",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [sipa](https://github.com/bitcoin/bitcoin/pull/24149#pullrequestreview-1296428327), [achow101](https://github.com/bitcoin/bitcoin/pull/24149#issuecomment-1430404755) |\n| Stale ACK | [instagibbs](https://github.com/bitcoin/bitcoin/pull/24149#pullrequestreview-1295765939) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#26756](https://github.com/bitcoin/bitcoin/pull/26756) (wallet: Replace `GetBalance()` logic with `AvailableCoins()` by w0xlt)\n* [#26627](https://github.com/bitcoin/bitcoin/pull/26627) (wallet: Migrate non-HD keys with single combo containing a list of keys by achow101)\n* [#26626](https://github.com/bitcoin/bitcoin/pull/26626) (descriptors: Add a KEY expression representing a list of individual keys by achow101)\n* [#26573](https://github.com/bitcoin/bitcoin/pull/26573) (Wallet: don't underestimate the fees when spending a Taproot output by darosior)\n* [#26567](https://github.com/bitcoin/bitcoin/pull/26567) (Wallet: estimate the size of signed inputs using descriptors by darosior)\n* [#26101](https://github.com/bitcoin/bitcoin/pull/26101) (script: create V1SigVersion for functions which should only accept taproot/tapscript by theuni)\n* [#26076](https://github.com/bitcoin/bitcoin/pull/26076) (Switch hardened derivation marker to h (in normalized descriptors and new wallets) by Sjors)\n* [#22838](https://github.com/bitcoin/bitcoin/pull/22838) (descriptors: Be able to specify change and receiving in a single descriptor string by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2022-01-26T00:17:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#issuecomment-1021731369",
      "id" : 1021731369,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24149",
      "node_id" : "IC_kwDOABII58485mIp",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1021731369/reactions"
      },
      "updated_at" : "2023-02-14T21:30:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1021731369",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-01-26T08:11:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#issuecomment-1021959878",
      "id" : 1021959878,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24149",
      "node_id" : "IC_kwDOABII58486d7G",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1021959878/reactions"
      },
      "updated_at" : "2022-01-26T08:11:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1021959878",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r806178300"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/806178300"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In b2e3582323b1e3dfded7eb0a2597fd74ba52e4df \"miniscript: satisfaction support\"\r\n\r\nI think these should be named with a `Set` prefix as otherwise they read like they are functions to check these properties rather than setting them.",
      "commit_id" : "c226ee3075ed059060051276d3ef815f756602e9",
      "created_at" : "2022-02-14T19:38:43Z",
      "diff_hunk" : "@@ -225,6 +230,54 @@ size_t ComputeScriptLen(NodeType nodetype, Type sub0typ, size_t subsize, uint32_\n //! A helper sanitizer/checker for the output of CalcType.\n Type SanitizeType(Type x);\n \n+//! An object representing a sequence of witness stack elements.\n+struct InputStack {\n+    /** Whether this stack is valid for its intended purpose (satisfaction or dissatisfaction of a Node).\n+     *  The MAYBE value is used for size estimation, when keys/preimages may actually be unavailable,\n+     *  but may be available at signing time. This makes the InputStack structure and signing logic,\n+     *  filled with dummy signatures/preimages usable for witness size estimation.\n+     */\n+    Availability available = Availability::YES;\n+    //! Whether this stack contains a digital signature.\n+    bool has_sig = false;\n+    //! Whether this stack is malleable (can be turned into an equally valid other stack by a third party).\n+    bool malleable = false;\n+    //! Whether this stack is non-canonical (using a construction known to be unnecessary for satisfaction).\n+    bool non_canon = false;\n+    //! Serialized witness size.\n+    size_t size = 0;\n+    //! Data elements.\n+    std::vector<std::vector<unsigned char>> stack;\n+    //! Construct an empty stack (valid).\n+    InputStack() {}\n+    //! Construct a valid single-element stack (with an element up to 75 bytes).\n+    InputStack(std::vector<unsigned char> in) : size(in.size() + 1), stack(Vector(std::move(in))) {}\n+    //! Change availability\n+    InputStack& Available(Availability avail);\n+    //! Mark this input stack as having a signature.\n+    InputStack& WithSig();\n+    //! Mark this input stack as non-canonical (known to not be necessary in non-malleable satisfactions).\n+    InputStack& NonCanon();\n+    //! Mark this input stack as malleable.\n+    InputStack& Malleable(bool x = true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r806178300",
      "id" : 806178300,
      "line" : 262,
      "node_id" : "PRRC_kwDOABII584wDU38",
      "original_commit_id" : "b2e3582323b1e3dfded7eb0a2597fd74ba52e4df",
      "original_line" : 262,
      "original_position" : 45,
      "original_start_line" : 256,
      "path" : "src/script/miniscript.h",
      "position" : 45,
      "pull_request_review_id" : 882103227,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/806178300/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 256,
      "start_side" : "RIGHT",
      "updated_at" : "2022-02-14T20:49:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/806178300",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r806183392"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/806183392"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In b2e3582323b1e3dfded7eb0a2597fd74ba52e4df \"miniscript: satisfaction support\"\r\n\r\nIs there a doc somewhere that defines \"weak\" and \"strong\" in this context?",
      "commit_id" : "c226ee3075ed059060051276d3ef815f756602e9",
      "created_at" : "2022-02-14T19:45:41Z",
      "diff_hunk" : "@@ -282,6 +282,77 @@ size_t ComputeScriptLen(NodeType nodetype, Type sub0typ, size_t subsize, uint32_\n     return 0;\n }\n \n+InputStack& InputStack::Available(Availability avail) {\n+    available = avail;\n+    if (avail == Availability::NO) {\n+        stack.clear();\n+        size = std::numeric_limits<size_t>::max();\n+        has_sig = false;\n+        malleable = false;\n+        non_canon = false;\n+    }\n+    return *this;\n+}\n+\n+InputStack& InputStack::WithSig() {\n+    has_sig = true;\n+    return *this;\n+}\n+\n+InputStack& InputStack::NonCanon() {\n+    non_canon = true;\n+    return *this;\n+}\n+\n+InputStack& InputStack::Malleable(bool x) {\n+    malleable = x;\n+    return *this;\n+}\n+\n+InputStack operator+(InputStack a, InputStack b) {\n+    a.stack = Cat(std::move(a.stack), std::move(b.stack));\n+    a.size += b.size;\n+    a.has_sig |= b.has_sig;\n+    a.malleable |= b.malleable;\n+    a.non_canon |= b.non_canon;\n+    if (a.available == Availability::NO || b.available == Availability::NO) {\n+        a.Available(Availability::NO);\n+    } else if (a.available == Availability::MAYBE || b.available == Availability::MAYBE) {\n+        a.Available(Availability::MAYBE);\n+    }\n+    return a;\n+}\n+\n+InputStack Choose(InputStack a, InputStack b, bool nonmalleable) {\n+    // If only one (or neither) is valid, pick the other one.\n+    if (a.available == Availability::NO) return b;\n+    if (b.available == Availability::NO) return a;\n+    // If both are valid, they must be distinct.\n+    if (nonmalleable) {\n+        // If both options are weak, any result is fine; it just needs the malleable marker.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r806183392",
      "id" : 806183392,
      "line" : 332,
      "node_id" : "PRRC_kwDOABII584wDWHg",
      "original_commit_id" : "b2e3582323b1e3dfded7eb0a2597fd74ba52e4df",
      "original_line" : 332,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "src/script/miniscript.cpp",
      "position" : 51,
      "pull_request_review_id" : 882103227,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/806183392/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-14T20:49:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/806183392",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r806197176"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/806197176"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In b2e3582323b1e3dfded7eb0a2597fd74ba52e4df \"miniscript: satisfaction support\"\r\n\r\nThis line appears to not be doing anything.",
      "commit_id" : "c226ee3075ed059060051276d3ef815f756602e9",
      "created_at" : "2022-02-14T20:05:09Z",
      "diff_hunk" : "@@ -676,6 +744,166 @@ struct Node {\n         return {{}, {}};\n     }\n \n+\n+    template<typename Ctx>\n+    internal::InputResult ProduceInput(const Ctx& ctx, bool nonmal) const {\n+        using namespace internal;\n+\n+        auto helper = [&ctx, nonmal](const Node& node, Span<InputResult> subres) -> InputResult {\n+            switch (node.nodetype) {\n+                case NodeType::PK_K: {\n+                    std::vector<unsigned char> sig;\n+                    Availability avail = ctx.Sign(node.keys[0], sig);\n+                    return InputResult(ZERO, InputStack(std::move(sig)).WithSig().Available(avail));\n+                }\n+                case NodeType::PK_H: {\n+                    std::vector<unsigned char> key = ctx.ToPKBytes(node.keys[0]), sig;\n+                    Availability avail = ctx.Sign(node.keys[0], sig);\n+                    return InputResult(ZERO + InputStack(key), (InputStack(std::move(sig)).WithSig() + InputStack(key)).Available(avail));\n+                }\n+                case NodeType::MULTI: {\n+                    std::vector<InputStack> sats = Vector(ZERO);\n+                    for (size_t i = 0; i < node.keys.size(); ++i) {\n+                        std::vector<unsigned char> sig;\n+                        Availability avail = ctx.Sign(node.keys[i], sig);\n+                        auto sat = InputStack(std::move(sig)).WithSig().Available(avail);\n+                        std::vector<InputStack> next_sats;\n+                        next_sats.push_back(sats[0]);\n+                        for (size_t j = 1; j < sats.size(); ++j) next_sats.push_back(Choose(sats[j], std::move(sats[j - 1]) + sat, nonmal));\n+                        next_sats.push_back(std::move(sats[sats.size() - 1]) + std::move(sat));\n+                        sats = std::move(next_sats);\n+                    }\n+                    InputStack nsat = ZERO;\n+                    for (size_t i = 0; i < node.k; ++i) nsat = std::move(nsat) + ZERO;\n+                    assert(node.k <= sats.size());\n+                    return InputResult(std::move(nsat), std::move(sats[node.k]));\n+                }\n+                case NodeType::THRESH: {\n+                    std::vector<InputStack> sats = Vector(EMPTY);\n+                    for (size_t i = 0; i < subres.size(); ++i) {\n+                        auto& res = subres[subres.size() - i - 1];\n+                        std::vector<InputStack> next_sats;\n+                        next_sats.push_back(sats[0] + res.nsat);\n+                        for (size_t j = 1; j < sats.size(); ++j) next_sats.push_back(Choose(sats[j] + res.nsat, std::move(sats[j - 1]) + res.sat, nonmal));\n+                        next_sats.push_back(std::move(sats[sats.size() - 1]) + std::move(res.sat));\n+                        sats = std::move(next_sats);\n+                    }\n+                    InputStack nsat = INVALID;\n+                    for (size_t i = 0; i < sats.size(); ++i) {\n+                        if (i != node.k) nsat = Choose(std::move(nsat), std::move(sats[i]), nonmal);\n+                    }\n+                    assert(node.k <= sats.size());\n+                    return InputResult(std::move(nsat), std::move(sats[node.k]));\n+                }\n+                case NodeType::OLDER: {\n+                    return InputResult(INVALID, ctx.CheckOlder(node.k) ? EMPTY : INVALID);\n+                }\n+                case NodeType::AFTER: {\n+                    return InputResult(INVALID, ctx.CheckAfter(node.k) ? EMPTY : INVALID);\n+                }\n+                case NodeType::SHA256: {\n+                    std::vector<unsigned char> preimage;\n+                    Availability avail = ctx.SatSHA256(node.data, preimage);\n+                    return InputResult(ZERO32, InputStack(std::move(preimage)).Available(avail));\n+                }\n+                case NodeType::RIPEMD160: {\n+                    std::vector<unsigned char> preimage;\n+                    Availability avail = ctx.SatRIPEMD160(node.data, preimage);\n+                    return InputResult(ZERO32, InputStack(std::move(preimage)).Available(avail));\n+                }\n+                case NodeType::HASH256: {\n+                    std::vector<unsigned char> preimage;\n+                    Availability avail = ctx.SatHASH256(node.data, preimage);\n+                    return InputResult(ZERO32, InputStack(std::move(preimage)).Available(avail));\n+                }\n+                case NodeType::HASH160: {\n+                    std::vector<unsigned char> preimage;\n+                    Availability avail = ctx.SatHASH160(node.data, preimage);\n+                    return InputResult(ZERO32, InputStack(std::move(preimage)).Available(avail));\n+                }\n+                case NodeType::AND_V: {\n+                    auto& x = subres[0], &y = subres[1];\n+                    return InputResult((y.nsat + x.sat).NonCanon(), y.sat + x.sat);\n+                }\n+                case NodeType::AND_B: {\n+                    auto& x = subres[0], &y = subres[1];\n+                    return InputResult(Choose(Choose(y.nsat + x.nsat, (y.sat + x.nsat).NonCanon(), nonmal), (y.nsat + x.sat).NonCanon(), nonmal), y.sat + x.sat);\n+                }\n+                case NodeType::OR_B: {\n+                    auto& x = subres[0], &z = subres[1];\n+                    return InputResult(z.nsat + x.nsat, Choose(Choose(z.nsat + x.sat, z.sat + x.nsat, nonmal), (z.sat + x.sat).NonCanon(), nonmal));\n+                }\n+                case NodeType::OR_C: {\n+                    auto& x = subres[0], &z = subres[1];\n+                    return InputResult(INVALID, Choose(std::move(x.sat), z.sat + x.nsat, nonmal));\n+                }\n+                case NodeType::OR_D: {\n+                    auto& x = subres[0], &z = subres[1];\n+                    auto nsat = z.nsat + x.nsat, sat_l = x.sat, sat_r = z.sat + x.nsat;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r806197176",
      "id" : 806197176,
      "line" : 842,
      "node_id" : "PRRC_kwDOABII584wDZe4",
      "original_commit_id" : "b2e3582323b1e3dfded7eb0a2597fd74ba52e4df",
      "original_line" : 842,
      "original_position" : 188,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 188,
      "pull_request_review_id" : 882103227,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/806197176/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-14T20:49:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/806197176",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r806216748"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/806216748"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 96e9de9304edf5feec87adf5ee56ad0f526459b8 \"script/sign: signing support for Miniscript with timelocks\"\r\n\r\nIn `DoCheck`, `spender_nsequence` is `CTxIn::SEQUENCE_FINAL`, should it be that here as well (instead of 0)?",
      "commit_id" : "c226ee3075ed059060051276d3ef815f756602e9",
      "created_at" : "2022-02-14T20:33:12Z",
      "diff_hunk" : "@@ -297,29 +302,39 @@ void DoCheck(const std::string& prv, const std::string& pub, const std::string&\n     BOOST_CHECK_MESSAGE(left_paths.empty(), \"Not all expected key paths found: \" + prv);\n }\n \n-void Check(const std::string& prv, const std::string& pub, const std::string& norm_prv, const std::string& norm_pub, int flags, const std::vector<std::vector<std::string>>& scripts, const std::optional<OutputType>& type, const std::set<std::vector<uint32_t>>& paths = ONLY_EMPTY)\n+void Check(const std::string& prv, const std::string& pub, const std::string& norm_prv, const std::string& norm_pub,\n+           int flags, const std::vector<std::vector<std::string>>& scripts, const std::optional<OutputType>& type,\n+           const std::set<std::vector<uint32_t>>& paths = ONLY_EMPTY, uint32_t spender_nlocktime=0, uint32_t spender_nsequence=0)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r806216748",
      "id" : 806216748,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584wDeQs",
      "original_commit_id" : "96e9de9304edf5feec87adf5ee56ad0f526459b8",
      "original_line" : 307,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "src/test/descriptor_tests.cpp",
      "position" : 44,
      "pull_request_review_id" : 882103227,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/806216748/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-14T20:49:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/806216748",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r811146800"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/811146800"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The website defines it as `HASSIG`. That a satisfaction is weak means that it isn't protected by a signature, strong is the opposite. Note this property can be analyzed statically on the Witness Script: it is the 's' property (`NeedsSignature()`, a requirement to be `IsSaneTopLevel()`).",
      "commit_id" : "8e268cc3c016a94964c1cc3f933a64651848c5d4",
      "created_at" : "2022-02-21T13:49:15Z",
      "diff_hunk" : "@@ -282,6 +282,77 @@ size_t ComputeScriptLen(NodeType nodetype, Type sub0typ, size_t subsize, uint32_\n     return 0;\n }\n \n+InputStack& InputStack::Available(Availability avail) {\n+    available = avail;\n+    if (avail == Availability::NO) {\n+        stack.clear();\n+        size = std::numeric_limits<size_t>::max();\n+        has_sig = false;\n+        malleable = false;\n+        non_canon = false;\n+    }\n+    return *this;\n+}\n+\n+InputStack& InputStack::WithSig() {\n+    has_sig = true;\n+    return *this;\n+}\n+\n+InputStack& InputStack::NonCanon() {\n+    non_canon = true;\n+    return *this;\n+}\n+\n+InputStack& InputStack::Malleable(bool x) {\n+    malleable = x;\n+    return *this;\n+}\n+\n+InputStack operator+(InputStack a, InputStack b) {\n+    a.stack = Cat(std::move(a.stack), std::move(b.stack));\n+    a.size += b.size;\n+    a.has_sig |= b.has_sig;\n+    a.malleable |= b.malleable;\n+    a.non_canon |= b.non_canon;\n+    if (a.available == Availability::NO || b.available == Availability::NO) {\n+        a.Available(Availability::NO);\n+    } else if (a.available == Availability::MAYBE || b.available == Availability::MAYBE) {\n+        a.Available(Availability::MAYBE);\n+    }\n+    return a;\n+}\n+\n+InputStack Choose(InputStack a, InputStack b, bool nonmalleable) {\n+    // If only one (or neither) is valid, pick the other one.\n+    if (a.available == Availability::NO) return b;\n+    if (b.available == Availability::NO) return a;\n+    // If both are valid, they must be distinct.\n+    if (nonmalleable) {\n+        // If both options are weak, any result is fine; it just needs the malleable marker.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r811146800",
      "id" : 811146800,
      "in_reply_to_id" : 806183392,
      "line" : 332,
      "node_id" : "PRRC_kwDOABII584wWR4w",
      "original_commit_id" : "b2e3582323b1e3dfded7eb0a2597fd74ba52e4df",
      "original_line" : 332,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "src/script/miniscript.cpp",
      "position" : 332,
      "pull_request_review_id" : 888708611,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/811146800/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-21T13:49:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/811146800",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r811170683"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/811170683"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah, both work. I'm putting `CTxIn::SEQUENCE_FINAL`.",
      "commit_id" : "8e268cc3c016a94964c1cc3f933a64651848c5d4",
      "created_at" : "2022-02-21T14:15:26Z",
      "diff_hunk" : "@@ -297,29 +302,39 @@ void DoCheck(const std::string& prv, const std::string& pub, const std::string&\n     BOOST_CHECK_MESSAGE(left_paths.empty(), \"Not all expected key paths found: \" + prv);\n }\n \n-void Check(const std::string& prv, const std::string& pub, const std::string& norm_prv, const std::string& norm_pub, int flags, const std::vector<std::vector<std::string>>& scripts, const std::optional<OutputType>& type, const std::set<std::vector<uint32_t>>& paths = ONLY_EMPTY)\n+void Check(const std::string& prv, const std::string& pub, const std::string& norm_prv, const std::string& norm_pub,\n+           int flags, const std::vector<std::vector<std::string>>& scripts, const std::optional<OutputType>& type,\n+           const std::set<std::vector<uint32_t>>& paths = ONLY_EMPTY, uint32_t spender_nlocktime=0, uint32_t spender_nsequence=0)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r811170683",
      "id" : 811170683,
      "in_reply_to_id" : 806216748,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584wWXt7",
      "original_commit_id" : "96e9de9304edf5feec87adf5ee56ad0f526459b8",
      "original_line" : 307,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "src/test/descriptor_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 888742766,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/811170683/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-21T14:15:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/811170683",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r811183472"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/811183472"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "8e268cc3c016a94964c1cc3f933a64651848c5d4",
      "created_at" : "2022-02-21T14:29:28Z",
      "diff_hunk" : "@@ -225,6 +230,54 @@ size_t ComputeScriptLen(NodeType nodetype, Type sub0typ, size_t subsize, uint32_\n //! A helper sanitizer/checker for the output of CalcType.\n Type SanitizeType(Type x);\n \n+//! An object representing a sequence of witness stack elements.\n+struct InputStack {\n+    /** Whether this stack is valid for its intended purpose (satisfaction or dissatisfaction of a Node).\n+     *  The MAYBE value is used for size estimation, when keys/preimages may actually be unavailable,\n+     *  but may be available at signing time. This makes the InputStack structure and signing logic,\n+     *  filled with dummy signatures/preimages usable for witness size estimation.\n+     */\n+    Availability available = Availability::YES;\n+    //! Whether this stack contains a digital signature.\n+    bool has_sig = false;\n+    //! Whether this stack is malleable (can be turned into an equally valid other stack by a third party).\n+    bool malleable = false;\n+    //! Whether this stack is non-canonical (using a construction known to be unnecessary for satisfaction).\n+    bool non_canon = false;\n+    //! Serialized witness size.\n+    size_t size = 0;\n+    //! Data elements.\n+    std::vector<std::vector<unsigned char>> stack;\n+    //! Construct an empty stack (valid).\n+    InputStack() {}\n+    //! Construct a valid single-element stack (with an element up to 75 bytes).\n+    InputStack(std::vector<unsigned char> in) : size(in.size() + 1), stack(Vector(std::move(in))) {}\n+    //! Change availability\n+    InputStack& Available(Availability avail);\n+    //! Mark this input stack as having a signature.\n+    InputStack& WithSig();\n+    //! Mark this input stack as non-canonical (known to not be necessary in non-malleable satisfactions).\n+    InputStack& NonCanon();\n+    //! Mark this input stack as malleable.\n+    InputStack& Malleable(bool x = true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r811183472",
      "id" : 811183472,
      "in_reply_to_id" : 806178300,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584wWa1w",
      "original_commit_id" : "b2e3582323b1e3dfded7eb0a2597fd74ba52e4df",
      "original_line" : 262,
      "original_position" : 45,
      "original_start_line" : 256,
      "path" : "src/script/miniscript.h",
      "position" : null,
      "pull_request_review_id" : 888760739,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/811183472/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-02-21T14:29:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/811183472",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased, addressed Andrew's comments, added some cleanups from @sipa, and added a `miniscript_random` fuzz target which generates a random Miniscript node based on a binary encoding. We might eventually add another one which tries to be smart, either here or in a follow-up.\r\n\r\n> I don't think it would be particularly hard considering that you're already using SignatureData for non-wallet data lookups. I think all that would really need to be done is to update FillSignatureData to include the preimages from the PSBT.\r\n\r\nYeah, but i figured it would be cleaner to have this as part of a PR which'd also update the various PSBT RPCs and test it using those.",
      "created_at" : "2022-02-21T14:35:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#issuecomment-1046944178",
      "id" : 1046944178,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24149",
      "node_id" : "IC_kwDOABII584-Zxmy",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1046944178/reactions"
      },
      "updated_at" : "2022-02-21T14:35:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1046944178",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Fixed the fuzzer crash on integer overflow, and pushed another bunch of updates to the satisfaction code:\r\n- merge the malleable and non-malleable satisfaction\r\n- rename `Choose` to `operator|`\r\n- many improvements to the unit and fuzz tests\r\n\r\nSee https://github.com/sipa/miniscript/pull/102 for details.\r\n\r\nI also pushed an initial corpus for `miniscript_random` fuzz target at https://github.com/bitcoin-core/qa-assets/pull/87",
      "created_at" : "2022-02-24T15:25:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#issuecomment-1049973037",
      "id" : 1049973037,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24149",
      "node_id" : "IC_kwDOABII584-lVEt",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1049973037/reactions"
      },
      "updated_at" : "2022-03-17T13:57:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1049973037",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-03-04T13:30:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#issuecomment-1059164161",
      "id" : 1059164161,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24149",
      "node_id" : "IC_kwDOABII584_IZAB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1059164161/reactions"
      },
      "updated_at" : "2022-03-04T13:30:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1059164161",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased.",
      "created_at" : "2022-03-17T17:49:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#issuecomment-1071145456",
      "id" : 1071145456,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24149",
      "node_id" : "IC_kwDOABII584_2GHw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1071145456/reactions"
      },
      "updated_at" : "2022-03-17T17:49:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1071145456",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r844983186"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/844983186"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    DoCheck(prv, pub, norm_prv, norm_pub, flags, scripts, type, paths, /*replace_apostrophe_with_h_in_prv=*/false,\r\n```\r\nAnywhere you are adding / touching named args, please use the [style from the developer docs](https://github.com/bitcoin/bitcoin/blob/master/doc/developer-notes.md#coding-style-c-named-arguments).",
      "commit_id" : "8cd2c3c45ecefdd6659b81c9a5dd6a85a2711b01",
      "created_at" : "2022-04-07T10:37:37Z",
      "diff_hunk" : "@@ -342,29 +350,40 @@ void DoCheck(const std::string& prv, const std::string& pub, const std::string&\n     BOOST_CHECK_MESSAGE(left_paths.empty(), \"Not all expected key paths found: \" + prv);\n }\n \n-void Check(const std::string& prv, const std::string& pub, const std::string& norm_prv, const std::string& norm_pub, int flags, const std::vector<std::vector<std::string>>& scripts, const std::optional<OutputType>& type, const std::set<std::vector<uint32_t>>& paths = ONLY_EMPTY)\n+void Check(const std::string& prv, const std::string& pub, const std::string& norm_prv, const std::string& norm_pub,\n+           int flags, const std::vector<std::vector<std::string>>& scripts, const std::optional<OutputType>& type,\n+           const std::set<std::vector<uint32_t>>& paths = ONLY_EMPTY, uint32_t spender_nlocktime=0,\n+           uint32_t spender_nsequence=CTxIn::SEQUENCE_FINAL, std::map<std::vector<uint8_t>, std::vector<uint8_t>> preimages={})\n {\n     bool found_apostrophes_in_prv = false;\n     bool found_apostrophes_in_pub = false;\n \n     // Do not replace apostrophes with 'h' in prv and pub\n-    DoCheck(prv, pub, norm_prv, norm_pub, flags, scripts, type, paths);\n+    DoCheck(prv, pub, norm_prv, norm_pub, flags, scripts, type, paths, /* replace_apostrophe_with_h_in_prv = */false,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r844983186",
      "id" : 844983186,
      "line" : 362,
      "node_id" : "PRRC_kwDOABII584yXWuS",
      "original_commit_id" : "8cd2c3c45ecefdd6659b81c9a5dd6a85a2711b01",
      "original_line" : 362,
      "original_position" : 95,
      "original_start_line" : null,
      "path" : "src/test/descriptor_tests.cpp",
      "position" : 95,
      "pull_request_review_id" : 934850577,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/844983186/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-07T10:37:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/844983186",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased, and fixed named args for clang-tidy. This contains the latest iteration of our work on fuzz targets for Miniscript (the `miniscript_stable` and `miniscript_smart` targets introduced in the last two commits, see the commit messages for details).",
      "created_at" : "2022-04-20T12:44:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#issuecomment-1103889372",
      "id" : 1103889372,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24149",
      "node_id" : "IC_kwDOABII585BzAPc",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1103889372/reactions"
      },
      "updated_at" : "2022-04-20T12:44:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1103889372",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-05-18T17:39:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#issuecomment-1130303447",
      "id" : 1130303447,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24149",
      "node_id" : "IC_kwDOABII585DXw_X",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1130303447/reactions"
      },
      "updated_at" : "2022-05-18T17:39:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1130303447",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased on master and #24148.",
      "created_at" : "2022-05-27T09:17:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#issuecomment-1139436967",
      "id" : 1139436967,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24149",
      "node_id" : "IC_kwDOABII585D6m2n",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1139436967/reactions"
      },
      "updated_at" : "2022-05-27T09:17:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1139436967",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-06-04T20:33:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#issuecomment-1146681751",
      "id" : 1146681751,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24149",
      "node_id" : "IC_kwDOABII585EWPmX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1146681751/reactions"
      },
      "updated_at" : "2022-06-04T20:33:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1146681751",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased.",
      "created_at" : "2022-06-06T16:29:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#issuecomment-1147642846",
      "id" : 1147642846,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24149",
      "node_id" : "IC_kwDOABII585EZ6Pe",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1147642846/reactions"
      },
      "updated_at" : "2022-06-06T16:29:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1147642846",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-06-28T16:26:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#issuecomment-1168942379",
      "id" : 1168942379,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24149",
      "node_id" : "IC_kwDOABII585FrKUr",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1168942379/reactions"
      },
      "updated_at" : "2022-06-28T16:26:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1168942379",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> > I don't think it would be particularly hard considering that you're already using SignatureData for non-wallet data lookups. I think all that would really need to be done is to update FillSignatureData to include the preimages from the PSBT.\r\n> \r\n> Yeah, but i figured it would be cleaner to have this as part of a PR which'd also update the various PSBT RPCs and test it using those.\r\n\r\nI created a watch-only wallet for testing miniscript, which relies on the private keys from other wallets. I might be nice to have a (draft) PSBT-enabled PR on top of this for easier testing.\r\n\r\nI'm testing with something of the form `wsh(or_d(pk(A),and_v(v:pkh(B),older(3))))`. I'm able to create a PSBT in the watch-only wallet and sign it with wallet B. But then `analyzepsbt` still complains that signature A is missing (and `finalizepsbt` refuses to give me the hex transaction). Sounds like that's expected behaviour for now.",
      "created_at" : "2022-07-13T15:41:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#issuecomment-1183382594",
      "id" : 1183382594,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24149",
      "node_id" : "IC_kwDOABII585GiPxC",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1183382594/reactions"
      },
      "updated_at" : "2022-07-13T15:47:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1183382594",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased on latest #24148. I'll look into a draft PR for PSBT support.",
      "created_at" : "2022-07-14T11:24:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#issuecomment-1184328490",
      "id" : 1184328490,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24149",
      "node_id" : "IC_kwDOABII585Gl2sq",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1184328490/reactions"
      },
      "updated_at" : "2022-07-14T11:24:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1184328490",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r923781764"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/923781764"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 3bedfb5b13e863508cb9b0d44fa03cc991151927 \"miniscript: satisfaction support\"\r\n\r\nThe satisfactions table lists sat(z), sat(x) as non-canonical. Should that also have `SetNonCanon()`?",
      "commit_id" : "c9fac27f7646c1a65f018cf0ac1e8785a96c2c14",
      "created_at" : "2022-07-18T19:31:04Z",
      "diff_hunk" : "@@ -813,6 +867,189 @@ struct Node {\n         return !TreeEvalMaybe<set>(upfn);\n     }\n \n+    template<typename Ctx>\n+    internal::InputResult ProduceInput(const Ctx& ctx) const {\n+        using namespace internal;\n+\n+        auto helper = [&ctx](const Node& node, Span<InputResult> subres) -> InputResult {\n+            switch (node.fragment) {\n+                case Fragment::PK_K: {\n+                    std::vector<unsigned char> sig;\n+                    Availability avail = ctx.Sign(node.keys[0], sig);\n+                    return InputResult(ZERO, InputStack(std::move(sig)).SetWithSig().SetAvailable(avail));\n+                }\n+                case Fragment::PK_H: {\n+                    std::vector<unsigned char> key = ctx.ToPKBytes(node.keys[0]), sig;\n+                    Availability avail = ctx.Sign(node.keys[0], sig);\n+                    return InputResult(ZERO + InputStack(key), (InputStack(std::move(sig)).SetWithSig() + InputStack(key)).SetAvailable(avail));\n+                }\n+                case Fragment::MULTI: {\n+                    std::vector<InputStack> sats = Vector(ZERO);\n+                    for (size_t i = 0; i < node.keys.size(); ++i) {\n+                        std::vector<unsigned char> sig;\n+                        Availability avail = ctx.Sign(node.keys[i], sig);\n+                        auto sat = InputStack(std::move(sig)).SetWithSig().SetAvailable(avail);\n+                        std::vector<InputStack> next_sats;\n+                        next_sats.push_back(sats[0]);\n+                        for (size_t j = 1; j < sats.size(); ++j) next_sats.push_back(sats[j] | (std::move(sats[j - 1]) + sat));\n+                        next_sats.push_back(std::move(sats[sats.size() - 1]) + std::move(sat));\n+                        sats = std::move(next_sats);\n+                    }\n+                    InputStack nsat = ZERO;\n+                    for (size_t i = 0; i < node.k; ++i) nsat = std::move(nsat) + ZERO;\n+                    assert(node.k <= sats.size());\n+                    return InputResult(std::move(nsat), std::move(sats[node.k]));\n+                }\n+                case Fragment::THRESH: {\n+                    std::vector<InputStack> sats = Vector(EMPTY);\n+                    for (size_t i = 0; i < subres.size(); ++i) {\n+                        auto& res = subres[subres.size() - i - 1];\n+                        std::vector<InputStack> next_sats;\n+                        next_sats.push_back(sats[0] + res.nsat);\n+                        for (size_t j = 1; j < sats.size(); ++j) next_sats.push_back((sats[j] + res.nsat) | (std::move(sats[j - 1]) + res.sat));\n+                        next_sats.push_back(std::move(sats[sats.size() - 1]) + std::move(res.sat));\n+                        sats = std::move(next_sats);\n+                    }\n+                    InputStack nsat = INVALID;\n+                    for (size_t i = 0; i < sats.size(); ++i) {\n+                        // i==k is the satisfaction; i==0 is the canonical dissatisfaction; the rest are non-canonical.\n+                        if (i != 0 && i != node.k) sats[i].SetNonCanon();\n+                        if (i != node.k) nsat = std::move(nsat) | std::move(sats[i]);\n+                    }\n+                    assert(node.k <= sats.size());\n+                    return InputResult(std::move(nsat), std::move(sats[node.k]));\n+                }\n+                case Fragment::OLDER: {\n+                    return InputResult(INVALID, ctx.CheckOlder(node.k) ? EMPTY : INVALID);\n+                }\n+                case Fragment::AFTER: {\n+                    return InputResult(INVALID, ctx.CheckAfter(node.k) ? EMPTY : INVALID);\n+                }\n+                case Fragment::SHA256: {\n+                    std::vector<unsigned char> preimage;\n+                    Availability avail = ctx.SatSHA256(node.data, preimage);\n+                    return InputResult(ZERO32, InputStack(std::move(preimage)).SetAvailable(avail));\n+                }\n+                case Fragment::RIPEMD160: {\n+                    std::vector<unsigned char> preimage;\n+                    Availability avail = ctx.SatRIPEMD160(node.data, preimage);\n+                    return InputResult(ZERO32, InputStack(std::move(preimage)).SetAvailable(avail));\n+                }\n+                case Fragment::HASH256: {\n+                    std::vector<unsigned char> preimage;\n+                    Availability avail = ctx.SatHASH256(node.data, preimage);\n+                    return InputResult(ZERO32, InputStack(std::move(preimage)).SetAvailable(avail));\n+                }\n+                case Fragment::HASH160: {\n+                    std::vector<unsigned char> preimage;\n+                    Availability avail = ctx.SatHASH160(node.data, preimage);\n+                    return InputResult(ZERO32, InputStack(std::move(preimage)).SetAvailable(avail));\n+                }\n+                case Fragment::AND_V: {\n+                    auto& x = subres[0], &y = subres[1];\n+                    return InputResult((y.nsat + x.sat).SetNonCanon(), y.sat + x.sat);\n+                }\n+                case Fragment::AND_B: {\n+                    auto& x = subres[0], &y = subres[1];\n+                    return InputResult((y.nsat + x.nsat) | (y.sat + x.nsat).SetNonCanon() | (y.nsat + x.sat).SetNonCanon(), y.sat + x.sat);\n+                }\n+                case Fragment::OR_B: {\n+                    auto& x = subres[0], &z = subres[1];\n+                    // The (sat(Z) sat(X)) solution is overcomplete (attacker can change either into dsat).\n+                    return InputResult(z.nsat + x.nsat, (z.nsat + x.sat) | (z.sat + x.nsat) | (z.sat + x.sat).SetMalleable());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r923781764",
      "id" : 923781764,
      "line" : 959,
      "node_id" : "PRRC_kwDOABII5843D8qE",
      "original_commit_id" : "3bedfb5b13e863508cb9b0d44fa03cc991151927",
      "original_line" : 959,
      "original_position" : 161,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 161,
      "pull_request_review_id" : 1042429269,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/923781764/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-18T19:57:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/923781764",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r923783117"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/923783117"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 3bedfb5b13e863508cb9b0d44fa03cc991151927 \"miniscript: satisfaction support\"\r\n\r\nThis line is still here.",
      "commit_id" : "c9fac27f7646c1a65f018cf0ac1e8785a96c2c14",
      "created_at" : "2022-07-18T19:32:53Z",
      "diff_hunk" : "@@ -676,6 +744,166 @@ struct Node {\n         return {{}, {}};\n     }\n \n+\n+    template<typename Ctx>\n+    internal::InputResult ProduceInput(const Ctx& ctx, bool nonmal) const {\n+        using namespace internal;\n+\n+        auto helper = [&ctx, nonmal](const Node& node, Span<InputResult> subres) -> InputResult {\n+            switch (node.nodetype) {\n+                case NodeType::PK_K: {\n+                    std::vector<unsigned char> sig;\n+                    Availability avail = ctx.Sign(node.keys[0], sig);\n+                    return InputResult(ZERO, InputStack(std::move(sig)).WithSig().Available(avail));\n+                }\n+                case NodeType::PK_H: {\n+                    std::vector<unsigned char> key = ctx.ToPKBytes(node.keys[0]), sig;\n+                    Availability avail = ctx.Sign(node.keys[0], sig);\n+                    return InputResult(ZERO + InputStack(key), (InputStack(std::move(sig)).WithSig() + InputStack(key)).Available(avail));\n+                }\n+                case NodeType::MULTI: {\n+                    std::vector<InputStack> sats = Vector(ZERO);\n+                    for (size_t i = 0; i < node.keys.size(); ++i) {\n+                        std::vector<unsigned char> sig;\n+                        Availability avail = ctx.Sign(node.keys[i], sig);\n+                        auto sat = InputStack(std::move(sig)).WithSig().Available(avail);\n+                        std::vector<InputStack> next_sats;\n+                        next_sats.push_back(sats[0]);\n+                        for (size_t j = 1; j < sats.size(); ++j) next_sats.push_back(Choose(sats[j], std::move(sats[j - 1]) + sat, nonmal));\n+                        next_sats.push_back(std::move(sats[sats.size() - 1]) + std::move(sat));\n+                        sats = std::move(next_sats);\n+                    }\n+                    InputStack nsat = ZERO;\n+                    for (size_t i = 0; i < node.k; ++i) nsat = std::move(nsat) + ZERO;\n+                    assert(node.k <= sats.size());\n+                    return InputResult(std::move(nsat), std::move(sats[node.k]));\n+                }\n+                case NodeType::THRESH: {\n+                    std::vector<InputStack> sats = Vector(EMPTY);\n+                    for (size_t i = 0; i < subres.size(); ++i) {\n+                        auto& res = subres[subres.size() - i - 1];\n+                        std::vector<InputStack> next_sats;\n+                        next_sats.push_back(sats[0] + res.nsat);\n+                        for (size_t j = 1; j < sats.size(); ++j) next_sats.push_back(Choose(sats[j] + res.nsat, std::move(sats[j - 1]) + res.sat, nonmal));\n+                        next_sats.push_back(std::move(sats[sats.size() - 1]) + std::move(res.sat));\n+                        sats = std::move(next_sats);\n+                    }\n+                    InputStack nsat = INVALID;\n+                    for (size_t i = 0; i < sats.size(); ++i) {\n+                        if (i != node.k) nsat = Choose(std::move(nsat), std::move(sats[i]), nonmal);\n+                    }\n+                    assert(node.k <= sats.size());\n+                    return InputResult(std::move(nsat), std::move(sats[node.k]));\n+                }\n+                case NodeType::OLDER: {\n+                    return InputResult(INVALID, ctx.CheckOlder(node.k) ? EMPTY : INVALID);\n+                }\n+                case NodeType::AFTER: {\n+                    return InputResult(INVALID, ctx.CheckAfter(node.k) ? EMPTY : INVALID);\n+                }\n+                case NodeType::SHA256: {\n+                    std::vector<unsigned char> preimage;\n+                    Availability avail = ctx.SatSHA256(node.data, preimage);\n+                    return InputResult(ZERO32, InputStack(std::move(preimage)).Available(avail));\n+                }\n+                case NodeType::RIPEMD160: {\n+                    std::vector<unsigned char> preimage;\n+                    Availability avail = ctx.SatRIPEMD160(node.data, preimage);\n+                    return InputResult(ZERO32, InputStack(std::move(preimage)).Available(avail));\n+                }\n+                case NodeType::HASH256: {\n+                    std::vector<unsigned char> preimage;\n+                    Availability avail = ctx.SatHASH256(node.data, preimage);\n+                    return InputResult(ZERO32, InputStack(std::move(preimage)).Available(avail));\n+                }\n+                case NodeType::HASH160: {\n+                    std::vector<unsigned char> preimage;\n+                    Availability avail = ctx.SatHASH160(node.data, preimage);\n+                    return InputResult(ZERO32, InputStack(std::move(preimage)).Available(avail));\n+                }\n+                case NodeType::AND_V: {\n+                    auto& x = subres[0], &y = subres[1];\n+                    return InputResult((y.nsat + x.sat).NonCanon(), y.sat + x.sat);\n+                }\n+                case NodeType::AND_B: {\n+                    auto& x = subres[0], &y = subres[1];\n+                    return InputResult(Choose(Choose(y.nsat + x.nsat, (y.sat + x.nsat).NonCanon(), nonmal), (y.nsat + x.sat).NonCanon(), nonmal), y.sat + x.sat);\n+                }\n+                case NodeType::OR_B: {\n+                    auto& x = subres[0], &z = subres[1];\n+                    return InputResult(z.nsat + x.nsat, Choose(Choose(z.nsat + x.sat, z.sat + x.nsat, nonmal), (z.sat + x.sat).NonCanon(), nonmal));\n+                }\n+                case NodeType::OR_C: {\n+                    auto& x = subres[0], &z = subres[1];\n+                    return InputResult(INVALID, Choose(std::move(x.sat), z.sat + x.nsat, nonmal));\n+                }\n+                case NodeType::OR_D: {\n+                    auto& x = subres[0], &z = subres[1];\n+                    auto nsat = z.nsat + x.nsat, sat_l = x.sat, sat_r = z.sat + x.nsat;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r923783117",
      "id" : 923783117,
      "in_reply_to_id" : 806197176,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5843D8_N",
      "original_commit_id" : "b2e3582323b1e3dfded7eb0a2597fd74ba52e4df",
      "original_line" : 967,
      "original_position" : 188,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : null,
      "pull_request_review_id" : 1042429269,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/923783117/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-18T19:57:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/923783117",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r923792873"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/923792873"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 3bedfb5b13e863508cb9b0d44fa03cc991151927 \"miniscript: satisfaction support\"\r\n\r\nWhy a double negation?",
      "commit_id" : "c9fac27f7646c1a65f018cf0ac1e8785a96c2c14",
      "created_at" : "2022-07-18T19:44:03Z",
      "diff_hunk" : "@@ -842,6 +1079,47 @@ struct Node {\n         });\n     }\n \n+    //! Determine whether a Miniscript node is satisfiable. fn(node) will be invoked for all\n+    //! key, time, and hashing nodes, and should return their satisfiability.\n+    template<typename F>\n+    bool IsSatisfiable(F fn) const\n+    {\n+        // TreeEval() doesn't support bool as NodeType, so use int instead.\n+        return TreeEval<int>([&fn](const Node& node, Span<int> subs) {\n+            switch (node.fragment) {\n+                case Fragment::JUST_0:\n+                    return false;\n+                case Fragment::JUST_1:\n+                    return true;\n+                case Fragment::PK_K:\n+                case Fragment::PK_H:\n+                case Fragment::MULTI:\n+                case Fragment::AFTER:\n+                case Fragment::OLDER:\n+                case Fragment::HASH256:\n+                case Fragment::HASH160:\n+                case Fragment::SHA256:\n+                case Fragment::RIPEMD160:\n+                    return bool{fn(node)};\n+                case Fragment::ANDOR:\n+                    return (subs[0] && subs[1]) || subs[2];\n+                case Fragment::AND_V:\n+                case Fragment::AND_B:\n+                    return subs[0] && subs[1];\n+                case Fragment::OR_B:\n+                case Fragment::OR_C:\n+                case Fragment::OR_D:\n+                case Fragment::OR_I:\n+                    return subs[0] || subs[1];\n+                case Fragment::THRESH:\n+                    return std::count(subs.begin(), subs.end(), true) >= node.k;\n+                default: // wrappers\n+                    assert(subs.size() == 1);\n+                    return !!subs[0];",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r923792873",
      "id" : 923792873,
      "line" : 1117,
      "node_id" : "PRRC_kwDOABII5843D_Xp",
      "original_commit_id" : "3bedfb5b13e863508cb9b0d44fa03cc991151927",
      "original_line" : 1117,
      "original_position" : 298,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 297,
      "pull_request_review_id" : 1042429269,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/923792873/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-18T19:57:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/923792873",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r923799522"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/923799522"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 8f1b45bf256b7454d1b790038a00eb537b9bbb70 \"script/sign: signing support for Miniscripts with hash preimage challenges\"\r\n\r\nI think this line should be in the previous commit.",
      "commit_id" : "c9fac27f7646c1a65f018cf0ac1e8785a96c2c14",
      "created_at" : "2022-07-18T19:53:01Z",
      "diff_hunk" : "@@ -672,6 +685,7 @@ class DummySignatureChecker final : public BaseSignatureChecker\n     bool CheckSchnorrSignature(Span<const unsigned char> sig, Span<const unsigned char> pubkey, SigVersion sigversion, ScriptExecutionData& execdata, ScriptError* serror) const override { return sig.size() != 0; }\n     bool CheckLockTime(const CScriptNum& nLockTime) const override { return true; }\n     bool CheckSequence(const CScriptNum& nSequence) const override { return true; }\n+    bool CheckEqual(const std::vector<unsigned char>& vch1, const std::vector<unsigned char>& vch2) const override { return true; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r923799522",
      "id" : 923799522,
      "line" : 688,
      "node_id" : "PRRC_kwDOABII5843EA_i",
      "original_commit_id" : "8f1b45bf256b7454d1b790038a00eb537b9bbb70",
      "original_line" : 688,
      "original_position" : 64,
      "original_start_line" : null,
      "path" : "src/script/sign.cpp",
      "position" : 158,
      "pull_request_review_id" : 1042429269,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/923799522/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-18T19:57:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/923799522",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r924514128"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924514128"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Indeed. This enables stricter testing. Also, it looks like we are missing a few `SetMalleable()` here, as per the specs:\r\n> The non-canonical options for and_b, or_b, and thresh are always overcomplete (reason 3), so instead use DONTUSE there as well (with HASSIG flag if the original non-canonical solution had one). \r\n\r\n@sipa does the following diff seem correct to you?\r\n```diff\r\ndiff --git a/src/script/miniscript.h b/src/script/miniscript.h\r\nindex 5c04c40587..e94105d0f4 100644\r\n--- a/src/script/miniscript.h\r\n+++ b/src/script/miniscript.h\r\n@@ -951,12 +951,12 @@ public:\r\n                 }\r\n                 case Fragment::AND_B: {\r\n                     auto& x = subres[0], &y = subres[1];\r\n-                    return InputResult((y.nsat + x.nsat) | (y.sat + x.nsat).SetNonCanon() | (y.nsat + x.sat).SetNonCanon(), y.sat + x.sat);\r\n+                    return InputResult((y.nsat + x.nsat) | (y.sat + x.nsat).SetMalleable().SetNonCanon() | (y.nsat + x.sat).SetMalleable().SetNonCanon(), y.sat + x.sat);\r\n                 }\r\n                 case Fragment::OR_B: {\r\n                     auto& x = subres[0], &z = subres[1];\r\n                     // The (sat(Z) sat(X)) solution is overcomplete (attacker can change either into dsat).\r\n-                    return InputResult(z.nsat + x.nsat, (z.nsat + x.sat) | (z.sat + x.nsat) | (z.sat + x.sat).SetMalleable());\r\n+                    return InputResult(z.nsat + x.nsat, (z.nsat + x.sat) | (z.sat + x.nsat) | (z.sat + x.sat).SetMalleable().SetNonCanon());\r\n                 }\r\n                 case Fragment::OR_C: {\r\n                     auto& x = subres[0], &z = subres[1];\r\n``` ",
      "commit_id" : "c9fac27f7646c1a65f018cf0ac1e8785a96c2c14",
      "created_at" : "2022-07-19T13:37:42Z",
      "diff_hunk" : "@@ -813,6 +867,189 @@ struct Node {\n         return !TreeEvalMaybe<set>(upfn);\n     }\n \n+    template<typename Ctx>\n+    internal::InputResult ProduceInput(const Ctx& ctx) const {\n+        using namespace internal;\n+\n+        auto helper = [&ctx](const Node& node, Span<InputResult> subres) -> InputResult {\n+            switch (node.fragment) {\n+                case Fragment::PK_K: {\n+                    std::vector<unsigned char> sig;\n+                    Availability avail = ctx.Sign(node.keys[0], sig);\n+                    return InputResult(ZERO, InputStack(std::move(sig)).SetWithSig().SetAvailable(avail));\n+                }\n+                case Fragment::PK_H: {\n+                    std::vector<unsigned char> key = ctx.ToPKBytes(node.keys[0]), sig;\n+                    Availability avail = ctx.Sign(node.keys[0], sig);\n+                    return InputResult(ZERO + InputStack(key), (InputStack(std::move(sig)).SetWithSig() + InputStack(key)).SetAvailable(avail));\n+                }\n+                case Fragment::MULTI: {\n+                    std::vector<InputStack> sats = Vector(ZERO);\n+                    for (size_t i = 0; i < node.keys.size(); ++i) {\n+                        std::vector<unsigned char> sig;\n+                        Availability avail = ctx.Sign(node.keys[i], sig);\n+                        auto sat = InputStack(std::move(sig)).SetWithSig().SetAvailable(avail);\n+                        std::vector<InputStack> next_sats;\n+                        next_sats.push_back(sats[0]);\n+                        for (size_t j = 1; j < sats.size(); ++j) next_sats.push_back(sats[j] | (std::move(sats[j - 1]) + sat));\n+                        next_sats.push_back(std::move(sats[sats.size() - 1]) + std::move(sat));\n+                        sats = std::move(next_sats);\n+                    }\n+                    InputStack nsat = ZERO;\n+                    for (size_t i = 0; i < node.k; ++i) nsat = std::move(nsat) + ZERO;\n+                    assert(node.k <= sats.size());\n+                    return InputResult(std::move(nsat), std::move(sats[node.k]));\n+                }\n+                case Fragment::THRESH: {\n+                    std::vector<InputStack> sats = Vector(EMPTY);\n+                    for (size_t i = 0; i < subres.size(); ++i) {\n+                        auto& res = subres[subres.size() - i - 1];\n+                        std::vector<InputStack> next_sats;\n+                        next_sats.push_back(sats[0] + res.nsat);\n+                        for (size_t j = 1; j < sats.size(); ++j) next_sats.push_back((sats[j] + res.nsat) | (std::move(sats[j - 1]) + res.sat));\n+                        next_sats.push_back(std::move(sats[sats.size() - 1]) + std::move(res.sat));\n+                        sats = std::move(next_sats);\n+                    }\n+                    InputStack nsat = INVALID;\n+                    for (size_t i = 0; i < sats.size(); ++i) {\n+                        // i==k is the satisfaction; i==0 is the canonical dissatisfaction; the rest are non-canonical.\n+                        if (i != 0 && i != node.k) sats[i].SetNonCanon();\n+                        if (i != node.k) nsat = std::move(nsat) | std::move(sats[i]);\n+                    }\n+                    assert(node.k <= sats.size());\n+                    return InputResult(std::move(nsat), std::move(sats[node.k]));\n+                }\n+                case Fragment::OLDER: {\n+                    return InputResult(INVALID, ctx.CheckOlder(node.k) ? EMPTY : INVALID);\n+                }\n+                case Fragment::AFTER: {\n+                    return InputResult(INVALID, ctx.CheckAfter(node.k) ? EMPTY : INVALID);\n+                }\n+                case Fragment::SHA256: {\n+                    std::vector<unsigned char> preimage;\n+                    Availability avail = ctx.SatSHA256(node.data, preimage);\n+                    return InputResult(ZERO32, InputStack(std::move(preimage)).SetAvailable(avail));\n+                }\n+                case Fragment::RIPEMD160: {\n+                    std::vector<unsigned char> preimage;\n+                    Availability avail = ctx.SatRIPEMD160(node.data, preimage);\n+                    return InputResult(ZERO32, InputStack(std::move(preimage)).SetAvailable(avail));\n+                }\n+                case Fragment::HASH256: {\n+                    std::vector<unsigned char> preimage;\n+                    Availability avail = ctx.SatHASH256(node.data, preimage);\n+                    return InputResult(ZERO32, InputStack(std::move(preimage)).SetAvailable(avail));\n+                }\n+                case Fragment::HASH160: {\n+                    std::vector<unsigned char> preimage;\n+                    Availability avail = ctx.SatHASH160(node.data, preimage);\n+                    return InputResult(ZERO32, InputStack(std::move(preimage)).SetAvailable(avail));\n+                }\n+                case Fragment::AND_V: {\n+                    auto& x = subres[0], &y = subres[1];\n+                    return InputResult((y.nsat + x.sat).SetNonCanon(), y.sat + x.sat);\n+                }\n+                case Fragment::AND_B: {\n+                    auto& x = subres[0], &y = subres[1];\n+                    return InputResult((y.nsat + x.nsat) | (y.sat + x.nsat).SetNonCanon() | (y.nsat + x.sat).SetNonCanon(), y.sat + x.sat);\n+                }\n+                case Fragment::OR_B: {\n+                    auto& x = subres[0], &z = subres[1];\n+                    // The (sat(Z) sat(X)) solution is overcomplete (attacker can change either into dsat).\n+                    return InputResult(z.nsat + x.nsat, (z.nsat + x.sat) | (z.sat + x.nsat) | (z.sat + x.sat).SetMalleable());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r924514128",
      "id" : 924514128,
      "in_reply_to_id" : 923781764,
      "line" : 959,
      "node_id" : "PRRC_kwDOABII5843GvdQ",
      "original_commit_id" : "3bedfb5b13e863508cb9b0d44fa03cc991151927",
      "original_line" : 959,
      "original_position" : 161,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 161,
      "pull_request_review_id" : 1043453717,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924514128/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-19T13:37:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924514128",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r924514282"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924514282"
         }
      },
      "author_association" : "MEMBER",
      "body" : "To match the lambda return type. `subs[0]` is an `int` but we want a `bool`.",
      "commit_id" : "c9fac27f7646c1a65f018cf0ac1e8785a96c2c14",
      "created_at" : "2022-07-19T13:37:50Z",
      "diff_hunk" : "@@ -842,6 +1079,47 @@ struct Node {\n         });\n     }\n \n+    //! Determine whether a Miniscript node is satisfiable. fn(node) will be invoked for all\n+    //! key, time, and hashing nodes, and should return their satisfiability.\n+    template<typename F>\n+    bool IsSatisfiable(F fn) const\n+    {\n+        // TreeEval() doesn't support bool as NodeType, so use int instead.\n+        return TreeEval<int>([&fn](const Node& node, Span<int> subs) {\n+            switch (node.fragment) {\n+                case Fragment::JUST_0:\n+                    return false;\n+                case Fragment::JUST_1:\n+                    return true;\n+                case Fragment::PK_K:\n+                case Fragment::PK_H:\n+                case Fragment::MULTI:\n+                case Fragment::AFTER:\n+                case Fragment::OLDER:\n+                case Fragment::HASH256:\n+                case Fragment::HASH160:\n+                case Fragment::SHA256:\n+                case Fragment::RIPEMD160:\n+                    return bool{fn(node)};\n+                case Fragment::ANDOR:\n+                    return (subs[0] && subs[1]) || subs[2];\n+                case Fragment::AND_V:\n+                case Fragment::AND_B:\n+                    return subs[0] && subs[1];\n+                case Fragment::OR_B:\n+                case Fragment::OR_C:\n+                case Fragment::OR_D:\n+                case Fragment::OR_I:\n+                    return subs[0] || subs[1];\n+                case Fragment::THRESH:\n+                    return std::count(subs.begin(), subs.end(), true) >= node.k;\n+                default: // wrappers\n+                    assert(subs.size() == 1);\n+                    return !!subs[0];",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r924514282",
      "id" : 924514282,
      "in_reply_to_id" : 923792873,
      "line" : 1117,
      "node_id" : "PRRC_kwDOABII5843Gvfq",
      "original_commit_id" : "3bedfb5b13e863508cb9b0d44fa03cc991151927",
      "original_line" : 1117,
      "original_position" : 298,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 297,
      "pull_request_review_id" : 1043453924,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924514282/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-19T13:37:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924514282",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r924514496"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924514496"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why? The previous commit does not need it, it only cares about the interpreter.",
      "commit_id" : "c9fac27f7646c1a65f018cf0ac1e8785a96c2c14",
      "created_at" : "2022-07-19T13:38:01Z",
      "diff_hunk" : "@@ -672,6 +685,7 @@ class DummySignatureChecker final : public BaseSignatureChecker\n     bool CheckSchnorrSignature(Span<const unsigned char> sig, Span<const unsigned char> pubkey, SigVersion sigversion, ScriptExecutionData& execdata, ScriptError* serror) const override { return sig.size() != 0; }\n     bool CheckLockTime(const CScriptNum& nLockTime) const override { return true; }\n     bool CheckSequence(const CScriptNum& nSequence) const override { return true; }\n+    bool CheckEqual(const std::vector<unsigned char>& vch1, const std::vector<unsigned char>& vch2) const override { return true; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r924514496",
      "id" : 924514496,
      "in_reply_to_id" : 923799522,
      "line" : 688,
      "node_id" : "PRRC_kwDOABII5843GvjA",
      "original_commit_id" : "8f1b45bf256b7454d1b790038a00eb537b9bbb70",
      "original_line" : 688,
      "original_position" : 64,
      "original_start_line" : null,
      "path" : "src/script/sign.cpp",
      "position" : 158,
      "pull_request_review_id" : 1043454238,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924514496/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-19T13:38:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924514496",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r924515165"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924515165"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Woops. Done!",
      "commit_id" : "c9fac27f7646c1a65f018cf0ac1e8785a96c2c14",
      "created_at" : "2022-07-19T13:38:34Z",
      "diff_hunk" : "@@ -676,6 +744,166 @@ struct Node {\n         return {{}, {}};\n     }\n \n+\n+    template<typename Ctx>\n+    internal::InputResult ProduceInput(const Ctx& ctx, bool nonmal) const {\n+        using namespace internal;\n+\n+        auto helper = [&ctx, nonmal](const Node& node, Span<InputResult> subres) -> InputResult {\n+            switch (node.nodetype) {\n+                case NodeType::PK_K: {\n+                    std::vector<unsigned char> sig;\n+                    Availability avail = ctx.Sign(node.keys[0], sig);\n+                    return InputResult(ZERO, InputStack(std::move(sig)).WithSig().Available(avail));\n+                }\n+                case NodeType::PK_H: {\n+                    std::vector<unsigned char> key = ctx.ToPKBytes(node.keys[0]), sig;\n+                    Availability avail = ctx.Sign(node.keys[0], sig);\n+                    return InputResult(ZERO + InputStack(key), (InputStack(std::move(sig)).WithSig() + InputStack(key)).Available(avail));\n+                }\n+                case NodeType::MULTI: {\n+                    std::vector<InputStack> sats = Vector(ZERO);\n+                    for (size_t i = 0; i < node.keys.size(); ++i) {\n+                        std::vector<unsigned char> sig;\n+                        Availability avail = ctx.Sign(node.keys[i], sig);\n+                        auto sat = InputStack(std::move(sig)).WithSig().Available(avail);\n+                        std::vector<InputStack> next_sats;\n+                        next_sats.push_back(sats[0]);\n+                        for (size_t j = 1; j < sats.size(); ++j) next_sats.push_back(Choose(sats[j], std::move(sats[j - 1]) + sat, nonmal));\n+                        next_sats.push_back(std::move(sats[sats.size() - 1]) + std::move(sat));\n+                        sats = std::move(next_sats);\n+                    }\n+                    InputStack nsat = ZERO;\n+                    for (size_t i = 0; i < node.k; ++i) nsat = std::move(nsat) + ZERO;\n+                    assert(node.k <= sats.size());\n+                    return InputResult(std::move(nsat), std::move(sats[node.k]));\n+                }\n+                case NodeType::THRESH: {\n+                    std::vector<InputStack> sats = Vector(EMPTY);\n+                    for (size_t i = 0; i < subres.size(); ++i) {\n+                        auto& res = subres[subres.size() - i - 1];\n+                        std::vector<InputStack> next_sats;\n+                        next_sats.push_back(sats[0] + res.nsat);\n+                        for (size_t j = 1; j < sats.size(); ++j) next_sats.push_back(Choose(sats[j] + res.nsat, std::move(sats[j - 1]) + res.sat, nonmal));\n+                        next_sats.push_back(std::move(sats[sats.size() - 1]) + std::move(res.sat));\n+                        sats = std::move(next_sats);\n+                    }\n+                    InputStack nsat = INVALID;\n+                    for (size_t i = 0; i < sats.size(); ++i) {\n+                        if (i != node.k) nsat = Choose(std::move(nsat), std::move(sats[i]), nonmal);\n+                    }\n+                    assert(node.k <= sats.size());\n+                    return InputResult(std::move(nsat), std::move(sats[node.k]));\n+                }\n+                case NodeType::OLDER: {\n+                    return InputResult(INVALID, ctx.CheckOlder(node.k) ? EMPTY : INVALID);\n+                }\n+                case NodeType::AFTER: {\n+                    return InputResult(INVALID, ctx.CheckAfter(node.k) ? EMPTY : INVALID);\n+                }\n+                case NodeType::SHA256: {\n+                    std::vector<unsigned char> preimage;\n+                    Availability avail = ctx.SatSHA256(node.data, preimage);\n+                    return InputResult(ZERO32, InputStack(std::move(preimage)).Available(avail));\n+                }\n+                case NodeType::RIPEMD160: {\n+                    std::vector<unsigned char> preimage;\n+                    Availability avail = ctx.SatRIPEMD160(node.data, preimage);\n+                    return InputResult(ZERO32, InputStack(std::move(preimage)).Available(avail));\n+                }\n+                case NodeType::HASH256: {\n+                    std::vector<unsigned char> preimage;\n+                    Availability avail = ctx.SatHASH256(node.data, preimage);\n+                    return InputResult(ZERO32, InputStack(std::move(preimage)).Available(avail));\n+                }\n+                case NodeType::HASH160: {\n+                    std::vector<unsigned char> preimage;\n+                    Availability avail = ctx.SatHASH160(node.data, preimage);\n+                    return InputResult(ZERO32, InputStack(std::move(preimage)).Available(avail));\n+                }\n+                case NodeType::AND_V: {\n+                    auto& x = subres[0], &y = subres[1];\n+                    return InputResult((y.nsat + x.sat).NonCanon(), y.sat + x.sat);\n+                }\n+                case NodeType::AND_B: {\n+                    auto& x = subres[0], &y = subres[1];\n+                    return InputResult(Choose(Choose(y.nsat + x.nsat, (y.sat + x.nsat).NonCanon(), nonmal), (y.nsat + x.sat).NonCanon(), nonmal), y.sat + x.sat);\n+                }\n+                case NodeType::OR_B: {\n+                    auto& x = subres[0], &z = subres[1];\n+                    return InputResult(z.nsat + x.nsat, Choose(Choose(z.nsat + x.sat, z.sat + x.nsat, nonmal), (z.sat + x.sat).NonCanon(), nonmal));\n+                }\n+                case NodeType::OR_C: {\n+                    auto& x = subres[0], &z = subres[1];\n+                    return InputResult(INVALID, Choose(std::move(x.sat), z.sat + x.nsat, nonmal));\n+                }\n+                case NodeType::OR_D: {\n+                    auto& x = subres[0], &z = subres[1];\n+                    auto nsat = z.nsat + x.nsat, sat_l = x.sat, sat_r = z.sat + x.nsat;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r924515165",
      "id" : 924515165,
      "in_reply_to_id" : 806197176,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5843Gvtd",
      "original_commit_id" : "b2e3582323b1e3dfded7eb0a2597fd74ba52e4df",
      "original_line" : 967,
      "original_position" : 188,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : null,
      "pull_request_review_id" : 1043455216,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924515165/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-19T13:38:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924515165",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r924613712"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924613712"
         }
      },
      "author_association" : "MEMBER",
      "body" : "~~I'd follow @achow101's suggestion but not @darosior's.~~\r\n\r\nThe reason is that adding SetMalleable() is \"weakening\" the self-testing ability, while SetNonCanon() is \"strengthening\" it. \r\n\r\nThe malleability flag influences the signer's choices, so it should only need to be added when we're certain the signer logic can't already figure it out on its own. In OR_B, having an alternative (z.nsat + x.nsat) choice should be sufficient, always available, and not have any signatures. That implies the (z.nsat + x.sat) and (z.sat + x.nsat) choices should be treated as malleable anyway.\r\n\r\nOn the other hand, the non-canonical flag is effectively an assertion: it doesn't influence the signing logic, except for raising an error if a non-canonical choice ends up being actually used. These should be added wherever we believe, based on higher-level reasoning, that certain choices are off-limits.",
      "commit_id" : "fb4d20f3ba582536f4506a41a5268ff79eaa4803",
      "created_at" : "2022-07-19T15:01:21Z",
      "diff_hunk" : "@@ -813,6 +867,189 @@ struct Node {\n         return !TreeEvalMaybe<set>(upfn);\n     }\n \n+    template<typename Ctx>\n+    internal::InputResult ProduceInput(const Ctx& ctx) const {\n+        using namespace internal;\n+\n+        auto helper = [&ctx](const Node& node, Span<InputResult> subres) -> InputResult {\n+            switch (node.fragment) {\n+                case Fragment::PK_K: {\n+                    std::vector<unsigned char> sig;\n+                    Availability avail = ctx.Sign(node.keys[0], sig);\n+                    return InputResult(ZERO, InputStack(std::move(sig)).SetWithSig().SetAvailable(avail));\n+                }\n+                case Fragment::PK_H: {\n+                    std::vector<unsigned char> key = ctx.ToPKBytes(node.keys[0]), sig;\n+                    Availability avail = ctx.Sign(node.keys[0], sig);\n+                    return InputResult(ZERO + InputStack(key), (InputStack(std::move(sig)).SetWithSig() + InputStack(key)).SetAvailable(avail));\n+                }\n+                case Fragment::MULTI: {\n+                    std::vector<InputStack> sats = Vector(ZERO);\n+                    for (size_t i = 0; i < node.keys.size(); ++i) {\n+                        std::vector<unsigned char> sig;\n+                        Availability avail = ctx.Sign(node.keys[i], sig);\n+                        auto sat = InputStack(std::move(sig)).SetWithSig().SetAvailable(avail);\n+                        std::vector<InputStack> next_sats;\n+                        next_sats.push_back(sats[0]);\n+                        for (size_t j = 1; j < sats.size(); ++j) next_sats.push_back(sats[j] | (std::move(sats[j - 1]) + sat));\n+                        next_sats.push_back(std::move(sats[sats.size() - 1]) + std::move(sat));\n+                        sats = std::move(next_sats);\n+                    }\n+                    InputStack nsat = ZERO;\n+                    for (size_t i = 0; i < node.k; ++i) nsat = std::move(nsat) + ZERO;\n+                    assert(node.k <= sats.size());\n+                    return InputResult(std::move(nsat), std::move(sats[node.k]));\n+                }\n+                case Fragment::THRESH: {\n+                    std::vector<InputStack> sats = Vector(EMPTY);\n+                    for (size_t i = 0; i < subres.size(); ++i) {\n+                        auto& res = subres[subres.size() - i - 1];\n+                        std::vector<InputStack> next_sats;\n+                        next_sats.push_back(sats[0] + res.nsat);\n+                        for (size_t j = 1; j < sats.size(); ++j) next_sats.push_back((sats[j] + res.nsat) | (std::move(sats[j - 1]) + res.sat));\n+                        next_sats.push_back(std::move(sats[sats.size() - 1]) + std::move(res.sat));\n+                        sats = std::move(next_sats);\n+                    }\n+                    InputStack nsat = INVALID;\n+                    for (size_t i = 0; i < sats.size(); ++i) {\n+                        // i==k is the satisfaction; i==0 is the canonical dissatisfaction; the rest are non-canonical.\n+                        if (i != 0 && i != node.k) sats[i].SetNonCanon();\n+                        if (i != node.k) nsat = std::move(nsat) | std::move(sats[i]);\n+                    }\n+                    assert(node.k <= sats.size());\n+                    return InputResult(std::move(nsat), std::move(sats[node.k]));\n+                }\n+                case Fragment::OLDER: {\n+                    return InputResult(INVALID, ctx.CheckOlder(node.k) ? EMPTY : INVALID);\n+                }\n+                case Fragment::AFTER: {\n+                    return InputResult(INVALID, ctx.CheckAfter(node.k) ? EMPTY : INVALID);\n+                }\n+                case Fragment::SHA256: {\n+                    std::vector<unsigned char> preimage;\n+                    Availability avail = ctx.SatSHA256(node.data, preimage);\n+                    return InputResult(ZERO32, InputStack(std::move(preimage)).SetAvailable(avail));\n+                }\n+                case Fragment::RIPEMD160: {\n+                    std::vector<unsigned char> preimage;\n+                    Availability avail = ctx.SatRIPEMD160(node.data, preimage);\n+                    return InputResult(ZERO32, InputStack(std::move(preimage)).SetAvailable(avail));\n+                }\n+                case Fragment::HASH256: {\n+                    std::vector<unsigned char> preimage;\n+                    Availability avail = ctx.SatHASH256(node.data, preimage);\n+                    return InputResult(ZERO32, InputStack(std::move(preimage)).SetAvailable(avail));\n+                }\n+                case Fragment::HASH160: {\n+                    std::vector<unsigned char> preimage;\n+                    Availability avail = ctx.SatHASH160(node.data, preimage);\n+                    return InputResult(ZERO32, InputStack(std::move(preimage)).SetAvailable(avail));\n+                }\n+                case Fragment::AND_V: {\n+                    auto& x = subres[0], &y = subres[1];\n+                    return InputResult((y.nsat + x.sat).SetNonCanon(), y.sat + x.sat);\n+                }\n+                case Fragment::AND_B: {\n+                    auto& x = subres[0], &y = subres[1];\n+                    return InputResult((y.nsat + x.nsat) | (y.sat + x.nsat).SetNonCanon() | (y.nsat + x.sat).SetNonCanon(), y.sat + x.sat);\n+                }\n+                case Fragment::OR_B: {\n+                    auto& x = subres[0], &z = subres[1];\n+                    // The (sat(Z) sat(X)) solution is overcomplete (attacker can change either into dsat).\n+                    return InputResult(z.nsat + x.nsat, (z.nsat + x.sat) | (z.sat + x.nsat) | (z.sat + x.sat).SetMalleable());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r924613712",
      "id" : 924613712,
      "in_reply_to_id" : 923781764,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5843HHxQ",
      "original_commit_id" : "3bedfb5b13e863508cb9b0d44fa03cc991151927",
      "original_line" : 959,
      "original_position" : 161,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : null,
      "pull_request_review_id" : 1043601134,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924613712/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-19T15:13:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924613712",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r924620199"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924620199"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The previous commit adds `CheckEqual`, whereas this commit adds `LookupPreimage`. It's not immediately obvious how these are related, and IMO it makes more sense to introduce the `CheckEqual`s in the same commit even if unneeded immediately.",
      "commit_id" : "fb4d20f3ba582536f4506a41a5268ff79eaa4803",
      "created_at" : "2022-07-19T15:06:09Z",
      "diff_hunk" : "@@ -672,6 +685,7 @@ class DummySignatureChecker final : public BaseSignatureChecker\n     bool CheckSchnorrSignature(Span<const unsigned char> sig, Span<const unsigned char> pubkey, SigVersion sigversion, ScriptExecutionData& execdata, ScriptError* serror) const override { return sig.size() != 0; }\n     bool CheckLockTime(const CScriptNum& nLockTime) const override { return true; }\n     bool CheckSequence(const CScriptNum& nSequence) const override { return true; }\n+    bool CheckEqual(const std::vector<unsigned char>& vch1, const std::vector<unsigned char>& vch2) const override { return true; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r924620199",
      "id" : 924620199,
      "in_reply_to_id" : 923799522,
      "line" : 688,
      "node_id" : "PRRC_kwDOABII5843HJWn",
      "original_commit_id" : "8f1b45bf256b7454d1b790038a00eb537b9bbb70",
      "original_line" : 688,
      "original_position" : 64,
      "original_start_line" : null,
      "path" : "src/script/sign.cpp",
      "position" : 158,
      "pull_request_review_id" : 1043610830,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924620199/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-19T15:06:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924620199",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r924631109"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924631109"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Actually, no, let's make both changes. It matches the site, and the fact that there is an independent reason why these choices are off-limit doesn't change the fact that they are indeed malleable too. The code should express that, and if we choose not, it deserves a long comment about it's not being marked as such.",
      "commit_id" : "fb4d20f3ba582536f4506a41a5268ff79eaa4803",
      "created_at" : "2022-07-19T15:12:37Z",
      "diff_hunk" : "@@ -813,6 +867,189 @@ struct Node {\n         return !TreeEvalMaybe<set>(upfn);\n     }\n \n+    template<typename Ctx>\n+    internal::InputResult ProduceInput(const Ctx& ctx) const {\n+        using namespace internal;\n+\n+        auto helper = [&ctx](const Node& node, Span<InputResult> subres) -> InputResult {\n+            switch (node.fragment) {\n+                case Fragment::PK_K: {\n+                    std::vector<unsigned char> sig;\n+                    Availability avail = ctx.Sign(node.keys[0], sig);\n+                    return InputResult(ZERO, InputStack(std::move(sig)).SetWithSig().SetAvailable(avail));\n+                }\n+                case Fragment::PK_H: {\n+                    std::vector<unsigned char> key = ctx.ToPKBytes(node.keys[0]), sig;\n+                    Availability avail = ctx.Sign(node.keys[0], sig);\n+                    return InputResult(ZERO + InputStack(key), (InputStack(std::move(sig)).SetWithSig() + InputStack(key)).SetAvailable(avail));\n+                }\n+                case Fragment::MULTI: {\n+                    std::vector<InputStack> sats = Vector(ZERO);\n+                    for (size_t i = 0; i < node.keys.size(); ++i) {\n+                        std::vector<unsigned char> sig;\n+                        Availability avail = ctx.Sign(node.keys[i], sig);\n+                        auto sat = InputStack(std::move(sig)).SetWithSig().SetAvailable(avail);\n+                        std::vector<InputStack> next_sats;\n+                        next_sats.push_back(sats[0]);\n+                        for (size_t j = 1; j < sats.size(); ++j) next_sats.push_back(sats[j] | (std::move(sats[j - 1]) + sat));\n+                        next_sats.push_back(std::move(sats[sats.size() - 1]) + std::move(sat));\n+                        sats = std::move(next_sats);\n+                    }\n+                    InputStack nsat = ZERO;\n+                    for (size_t i = 0; i < node.k; ++i) nsat = std::move(nsat) + ZERO;\n+                    assert(node.k <= sats.size());\n+                    return InputResult(std::move(nsat), std::move(sats[node.k]));\n+                }\n+                case Fragment::THRESH: {\n+                    std::vector<InputStack> sats = Vector(EMPTY);\n+                    for (size_t i = 0; i < subres.size(); ++i) {\n+                        auto& res = subres[subres.size() - i - 1];\n+                        std::vector<InputStack> next_sats;\n+                        next_sats.push_back(sats[0] + res.nsat);\n+                        for (size_t j = 1; j < sats.size(); ++j) next_sats.push_back((sats[j] + res.nsat) | (std::move(sats[j - 1]) + res.sat));\n+                        next_sats.push_back(std::move(sats[sats.size() - 1]) + std::move(res.sat));\n+                        sats = std::move(next_sats);\n+                    }\n+                    InputStack nsat = INVALID;\n+                    for (size_t i = 0; i < sats.size(); ++i) {\n+                        // i==k is the satisfaction; i==0 is the canonical dissatisfaction; the rest are non-canonical.\n+                        if (i != 0 && i != node.k) sats[i].SetNonCanon();\n+                        if (i != node.k) nsat = std::move(nsat) | std::move(sats[i]);\n+                    }\n+                    assert(node.k <= sats.size());\n+                    return InputResult(std::move(nsat), std::move(sats[node.k]));\n+                }\n+                case Fragment::OLDER: {\n+                    return InputResult(INVALID, ctx.CheckOlder(node.k) ? EMPTY : INVALID);\n+                }\n+                case Fragment::AFTER: {\n+                    return InputResult(INVALID, ctx.CheckAfter(node.k) ? EMPTY : INVALID);\n+                }\n+                case Fragment::SHA256: {\n+                    std::vector<unsigned char> preimage;\n+                    Availability avail = ctx.SatSHA256(node.data, preimage);\n+                    return InputResult(ZERO32, InputStack(std::move(preimage)).SetAvailable(avail));\n+                }\n+                case Fragment::RIPEMD160: {\n+                    std::vector<unsigned char> preimage;\n+                    Availability avail = ctx.SatRIPEMD160(node.data, preimage);\n+                    return InputResult(ZERO32, InputStack(std::move(preimage)).SetAvailable(avail));\n+                }\n+                case Fragment::HASH256: {\n+                    std::vector<unsigned char> preimage;\n+                    Availability avail = ctx.SatHASH256(node.data, preimage);\n+                    return InputResult(ZERO32, InputStack(std::move(preimage)).SetAvailable(avail));\n+                }\n+                case Fragment::HASH160: {\n+                    std::vector<unsigned char> preimage;\n+                    Availability avail = ctx.SatHASH160(node.data, preimage);\n+                    return InputResult(ZERO32, InputStack(std::move(preimage)).SetAvailable(avail));\n+                }\n+                case Fragment::AND_V: {\n+                    auto& x = subres[0], &y = subres[1];\n+                    return InputResult((y.nsat + x.sat).SetNonCanon(), y.sat + x.sat);\n+                }\n+                case Fragment::AND_B: {\n+                    auto& x = subres[0], &y = subres[1];\n+                    return InputResult((y.nsat + x.nsat) | (y.sat + x.nsat).SetNonCanon() | (y.nsat + x.sat).SetNonCanon(), y.sat + x.sat);\n+                }\n+                case Fragment::OR_B: {\n+                    auto& x = subres[0], &z = subres[1];\n+                    // The (sat(Z) sat(X)) solution is overcomplete (attacker can change either into dsat).\n+                    return InputResult(z.nsat + x.nsat, (z.nsat + x.sat) | (z.sat + x.nsat) | (z.sat + x.sat).SetMalleable());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r924631109",
      "id" : 924631109,
      "in_reply_to_id" : 923781764,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5843HMBF",
      "original_commit_id" : "3bedfb5b13e863508cb9b0d44fa03cc991151927",
      "original_line" : 959,
      "original_position" : 161,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : null,
      "pull_request_review_id" : 1043621383,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924631109/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-19T15:12:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924631109",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r924683543"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924683543"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "fb4d20f3ba582536f4506a41a5268ff79eaa4803",
      "created_at" : "2022-07-19T15:53:40Z",
      "diff_hunk" : "@@ -813,6 +867,189 @@ struct Node {\n         return !TreeEvalMaybe<set>(upfn);\n     }\n \n+    template<typename Ctx>\n+    internal::InputResult ProduceInput(const Ctx& ctx) const {\n+        using namespace internal;\n+\n+        auto helper = [&ctx](const Node& node, Span<InputResult> subres) -> InputResult {\n+            switch (node.fragment) {\n+                case Fragment::PK_K: {\n+                    std::vector<unsigned char> sig;\n+                    Availability avail = ctx.Sign(node.keys[0], sig);\n+                    return InputResult(ZERO, InputStack(std::move(sig)).SetWithSig().SetAvailable(avail));\n+                }\n+                case Fragment::PK_H: {\n+                    std::vector<unsigned char> key = ctx.ToPKBytes(node.keys[0]), sig;\n+                    Availability avail = ctx.Sign(node.keys[0], sig);\n+                    return InputResult(ZERO + InputStack(key), (InputStack(std::move(sig)).SetWithSig() + InputStack(key)).SetAvailable(avail));\n+                }\n+                case Fragment::MULTI: {\n+                    std::vector<InputStack> sats = Vector(ZERO);\n+                    for (size_t i = 0; i < node.keys.size(); ++i) {\n+                        std::vector<unsigned char> sig;\n+                        Availability avail = ctx.Sign(node.keys[i], sig);\n+                        auto sat = InputStack(std::move(sig)).SetWithSig().SetAvailable(avail);\n+                        std::vector<InputStack> next_sats;\n+                        next_sats.push_back(sats[0]);\n+                        for (size_t j = 1; j < sats.size(); ++j) next_sats.push_back(sats[j] | (std::move(sats[j - 1]) + sat));\n+                        next_sats.push_back(std::move(sats[sats.size() - 1]) + std::move(sat));\n+                        sats = std::move(next_sats);\n+                    }\n+                    InputStack nsat = ZERO;\n+                    for (size_t i = 0; i < node.k; ++i) nsat = std::move(nsat) + ZERO;\n+                    assert(node.k <= sats.size());\n+                    return InputResult(std::move(nsat), std::move(sats[node.k]));\n+                }\n+                case Fragment::THRESH: {\n+                    std::vector<InputStack> sats = Vector(EMPTY);\n+                    for (size_t i = 0; i < subres.size(); ++i) {\n+                        auto& res = subres[subres.size() - i - 1];\n+                        std::vector<InputStack> next_sats;\n+                        next_sats.push_back(sats[0] + res.nsat);\n+                        for (size_t j = 1; j < sats.size(); ++j) next_sats.push_back((sats[j] + res.nsat) | (std::move(sats[j - 1]) + res.sat));\n+                        next_sats.push_back(std::move(sats[sats.size() - 1]) + std::move(res.sat));\n+                        sats = std::move(next_sats);\n+                    }\n+                    InputStack nsat = INVALID;\n+                    for (size_t i = 0; i < sats.size(); ++i) {\n+                        // i==k is the satisfaction; i==0 is the canonical dissatisfaction; the rest are non-canonical.\n+                        if (i != 0 && i != node.k) sats[i].SetNonCanon();\n+                        if (i != node.k) nsat = std::move(nsat) | std::move(sats[i]);\n+                    }\n+                    assert(node.k <= sats.size());\n+                    return InputResult(std::move(nsat), std::move(sats[node.k]));\n+                }\n+                case Fragment::OLDER: {\n+                    return InputResult(INVALID, ctx.CheckOlder(node.k) ? EMPTY : INVALID);\n+                }\n+                case Fragment::AFTER: {\n+                    return InputResult(INVALID, ctx.CheckAfter(node.k) ? EMPTY : INVALID);\n+                }\n+                case Fragment::SHA256: {\n+                    std::vector<unsigned char> preimage;\n+                    Availability avail = ctx.SatSHA256(node.data, preimage);\n+                    return InputResult(ZERO32, InputStack(std::move(preimage)).SetAvailable(avail));\n+                }\n+                case Fragment::RIPEMD160: {\n+                    std::vector<unsigned char> preimage;\n+                    Availability avail = ctx.SatRIPEMD160(node.data, preimage);\n+                    return InputResult(ZERO32, InputStack(std::move(preimage)).SetAvailable(avail));\n+                }\n+                case Fragment::HASH256: {\n+                    std::vector<unsigned char> preimage;\n+                    Availability avail = ctx.SatHASH256(node.data, preimage);\n+                    return InputResult(ZERO32, InputStack(std::move(preimage)).SetAvailable(avail));\n+                }\n+                case Fragment::HASH160: {\n+                    std::vector<unsigned char> preimage;\n+                    Availability avail = ctx.SatHASH160(node.data, preimage);\n+                    return InputResult(ZERO32, InputStack(std::move(preimage)).SetAvailable(avail));\n+                }\n+                case Fragment::AND_V: {\n+                    auto& x = subres[0], &y = subres[1];\n+                    return InputResult((y.nsat + x.sat).SetNonCanon(), y.sat + x.sat);\n+                }\n+                case Fragment::AND_B: {\n+                    auto& x = subres[0], &y = subres[1];\n+                    return InputResult((y.nsat + x.nsat) | (y.sat + x.nsat).SetNonCanon() | (y.nsat + x.sat).SetNonCanon(), y.sat + x.sat);\n+                }\n+                case Fragment::OR_B: {\n+                    auto& x = subres[0], &z = subres[1];\n+                    // The (sat(Z) sat(X)) solution is overcomplete (attacker can change either into dsat).\n+                    return InputResult(z.nsat + x.nsat, (z.nsat + x.sat) | (z.sat + x.nsat) | (z.sat + x.sat).SetMalleable());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r924683543",
      "id" : 924683543,
      "in_reply_to_id" : 923781764,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5843HY0X",
      "original_commit_id" : "3bedfb5b13e863508cb9b0d44fa03cc991151927",
      "original_line" : 959,
      "original_position" : 161,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : null,
      "pull_request_review_id" : 1043689475,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924683543/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-19T15:53:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924683543",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r924749544"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924749544"
         }
      },
      "author_association" : "MEMBER",
      "body" : "My rationale was that adding `CheckEqual` to the `DummySignatureChecker` is related to the descriptor: it makes a descriptor with timelocks reported as solvable (which in turn allows us to mark them as such in the unit tests). On the other hand the previous commit aims to be the isolated 3-lines-diff that touches consensus code, and only do that.\r\n\r\nNot that i feel too strongly about it of course!",
      "commit_id" : "26cd5992d59c52529a6c261315fd0353803a7901",
      "created_at" : "2022-07-19T16:56:32Z",
      "diff_hunk" : "@@ -672,6 +685,7 @@ class DummySignatureChecker final : public BaseSignatureChecker\n     bool CheckSchnorrSignature(Span<const unsigned char> sig, Span<const unsigned char> pubkey, SigVersion sigversion, ScriptExecutionData& execdata, ScriptError* serror) const override { return sig.size() != 0; }\n     bool CheckLockTime(const CScriptNum& nLockTime) const override { return true; }\n     bool CheckSequence(const CScriptNum& nSequence) const override { return true; }\n+    bool CheckEqual(const std::vector<unsigned char>& vch1, const std::vector<unsigned char>& vch2) const override { return true; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r924749544",
      "id" : 924749544,
      "in_reply_to_id" : 923799522,
      "line" : 688,
      "node_id" : "PRRC_kwDOABII5843Ho7o",
      "original_commit_id" : "8f1b45bf256b7454d1b790038a00eb537b9bbb70",
      "original_line" : 688,
      "original_position" : 64,
      "original_start_line" : null,
      "path" : "src/script/sign.cpp",
      "position" : 158,
      "pull_request_review_id" : 1043794644,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924749544/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-19T16:56:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924749544",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r924842709"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924842709"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I vaguely recall having a discussion about this already, but I can't remember the conclusion.\r\n\r\nIs this function needed just to make the dummy signing pass verification in the signing logic? If so, it may be easier to only add a way to bypass that verification check for dummy signing in the first place.\r\n\r\nI'm somewhat uncomfortable with making a change to consensus code like this just for that purpose.",
      "commit_id" : "26cd5992d59c52529a6c261315fd0353803a7901",
      "created_at" : "2022-07-19T18:35:15Z",
      "diff_hunk" : "@@ -263,6 +263,8 @@ class BaseSignatureChecker\n          return false;\n     }\n \n+    virtual bool CheckEqual(const std::vector<unsigned char>& vch1, const std::vector<unsigned char>& vch2) const { return vch1 == vch2; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r924842709",
      "id" : 924842709,
      "line" : 266,
      "node_id" : "PRRC_kwDOABII5843H_rV",
      "original_commit_id" : "26cd5992d59c52529a6c261315fd0353803a7901",
      "original_line" : 266,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/script/interpreter.h",
      "position" : 4,
      "pull_request_review_id" : 1043915829,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924842709/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-19T18:35:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924842709",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r925341728"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/925341728"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, it's only to pass the `IsSolvable` check and, yes, it is unfortunate. Previous discussion [logs here](https://gnusha.org/miniscript/2022-02-24.log). TL;DR:\r\n- I tested a few things and isolating a 3-lines patch to the interpreter was the only \"reasonable\" solution i could come up with that didn't change the existing logic\r\n- `IsSolvable` is overkill already, we could just drop the `VerifyScript` there and not need the interpreter patch here:\r\nhttps://github.com/bitcoin/bitcoin/blob/0897b189e4242321cd03339e7dde5c4d963d0e48/src/script/sign.cpp#L640-L646\r\n\r\nBut just getting rid of `VerifyScript` isn't enough. We still need to keep `ProduceSignature`, which will in turn call `VerifyScript` again. And since this path is used at \"real\" signing time too, it gets pretty convoluted to special case `IsSolvable` without using the `DummySignatureChecker`.\r\n\r\nI think a cleaner path forward would be to revise the implementation of `IsSolvable` altogether, detangling it from the signing code. It dates from back when there were no descriptors. Nowadays everything we can sign for (that \"is solvable\") can be represented as a descriptor. So how about re-defining `IsSolvable` as \"a descriptor can be inferred from this script, and this descriptor is solvable (ie not raw)\"?\r\nIt's probably a good cleanup of legacy code on its own too, so it could have its own PR and i would rebase this one on top of it and drop the interpreter patch.\r\n\r\nEDIT: a branch implementing this on top of this PR: https://github.com/darosior/bitcoin/tree/miniscript_wallet_signing_new_is_solvable",
      "commit_id" : "26cd5992d59c52529a6c261315fd0353803a7901",
      "created_at" : "2022-07-20T08:45:29Z",
      "diff_hunk" : "@@ -263,6 +263,8 @@ class BaseSignatureChecker\n          return false;\n     }\n \n+    virtual bool CheckEqual(const std::vector<unsigned char>& vch1, const std::vector<unsigned char>& vch2) const { return vch1 == vch2; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r925341728",
      "id" : 925341728,
      "in_reply_to_id" : 924842709,
      "line" : 266,
      "node_id" : "PRRC_kwDOABII5843J5gg",
      "original_commit_id" : "26cd5992d59c52529a6c261315fd0353803a7901",
      "original_line" : 266,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/script/interpreter.h",
      "position" : 4,
      "pull_request_review_id" : 1044651761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/925341728/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-20T10:30:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/925341728",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r925844683"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/925844683"
         }
      },
      "author_association" : "MEMBER",
      "body" : "IIRC, the DummySignatureCreator isn't just used for testing solvability, but also for determining the size of produced signatures before actual keys are available. If so, we still have a dependence on ProduceSignature in that context.\r\n\r\nThat said, it seems possible to just remove both VerifyScript calls in script/sign.cpp's ProduceSignature and IsSolvable. No tests break.",
      "commit_id" : "26cd5992d59c52529a6c261315fd0353803a7901",
      "created_at" : "2022-07-20T16:54:18Z",
      "diff_hunk" : "@@ -263,6 +263,8 @@ class BaseSignatureChecker\n          return false;\n     }\n \n+    virtual bool CheckEqual(const std::vector<unsigned char>& vch1, const std::vector<unsigned char>& vch2) const { return vch1 == vch2; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r925844683",
      "id" : 925844683,
      "in_reply_to_id" : 924842709,
      "line" : 266,
      "node_id" : "PRRC_kwDOABII5843L0TL",
      "original_commit_id" : "26cd5992d59c52529a6c261315fd0353803a7901",
      "original_line" : 266,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/script/interpreter.h",
      "position" : 4,
      "pull_request_review_id" : 1045379465,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/925844683/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-20T16:54:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/925844683",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r943484238"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943484238"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sorry for the late reply.\r\n\r\nYes. I think it would be nice to get rid of it entirely but indeed only redefining `IsSolvable` doesn't permit that, It's sufficient for dropping the interpreter patch here though.\r\n\r\nI don't know about removing the belt-and-suspender  `VerifyScript` check in `ProduceSignature`. I'd be more comfortable with just re-defining `IsSolvable`. I've done that in #25664.",
      "commit_id" : "26cd5992d59c52529a6c261315fd0353803a7901",
      "created_at" : "2022-08-11T13:27:16Z",
      "diff_hunk" : "@@ -263,6 +263,8 @@ class BaseSignatureChecker\n          return false;\n     }\n \n+    virtual bool CheckEqual(const std::vector<unsigned char>& vch1, const std::vector<unsigned char>& vch2) const { return vch1 == vch2; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r943484238",
      "id" : 943484238,
      "in_reply_to_id" : 924842709,
      "line" : 266,
      "node_id" : "PRRC_kwDOABII5844PG1O",
      "original_commit_id" : "26cd5992d59c52529a6c261315fd0353803a7901",
      "original_line" : 266,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/script/interpreter.h",
      "position" : 4,
      "pull_request_review_id" : 1069717335,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943484238/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-11T13:27:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/943484238",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-08-11T18:51:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#issuecomment-1212367179",
      "id" : 1212367179,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24149",
      "node_id" : "IC_kwDOABII585IQ0FL",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1212367179/reactions"
      },
      "updated_at" : "2022-08-11T18:51:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1212367179",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased. Dropped the commit modifying the interpreter, not needed after #25664. This PR does not touch consensus code anymore.\r\n\r\nNote however that since we can't mock the preimage check, we can't estimate the input size when spending from a Miniscript descriptor with a hash preimage challenge in all spending paths. Ideally, i think we should estimate the input size for spending a coin using the descriptors (no need to run the signature producer, we have this information already).\r\nRelatedly, i added a commit for determining solvability using an inferred descriptor in AvailableCoins, as the optimization introduced in 8a105ecd1aeff15f84c3883e2762bf71ad59d920 of using the result of `CalculateMaximumSignedInputSize` would not work for descriptors with hash preimage challenges.\r\n\r\nI didn't forget about the draft PR for PSBT support. :) But i'll look first into using descriptors for determining input size.\r\n\r\nEDIT: the switch to using descriptors for estimating input satisfaction size in the wallet is implemented in #26567.",
      "created_at" : "2022-08-12T13:08:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#issuecomment-1213092373",
      "id" : 1213092373,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24149",
      "node_id" : "IC_kwDOABII585ITlIV",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1213092373/reactions"
      },
      "updated_at" : "2022-11-25T10:11:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1213092373",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-08-17T23:50:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#issuecomment-1218684967",
      "id" : 1218684967,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24149",
      "node_id" : "IC_kwDOABII585Io6gn",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1218684967/reactions"
      },
      "updated_at" : "2022-08-17T23:50:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1218684967",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r950532827"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950532827"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I find slightly ugly to expose `SignatureData` to the `SignatureCreator` interface. I'd say that `SignatureData` is the \"upper\" interface of the script/sign logic, which it exposes to its users. And `SignatureCreator` is part of the \"lower\" interface - it's how one can provide simple individual signature logic to script/sign. So it feels awkward to make the `SignatureCreator` implementations (which should deal with simple low-level things like signatures) be exposed to this `SignatureData` class which deals with script signing. This isn't more than a philosophical concern about code structure, but I'd like to offer an alternative.\r\n\r\nTrying to draw an analogy with how keys/signatures are handled, there is the somewhat weird observation that hash preimages are both key material (which should really go in a `SigningProvider`, as it's a kind of secret) and signature material (which rightfully belongs in `SigningData`, as something that will end up in the witness). I don't think that's a problem - maybe it belongs in both. So a possibility is:\r\n* Add functionality to `SigningProvider` to hold/lookup preimages.\r\n* Have an overridable LookupPreimage in `SignatureCreator` that takes a `const SigningProvider&` as argument (like CreateSig etc). It's so simple it could have a default implementation, looking things up in the provider. Dummy implementations could override it by return success with zero-byte ones.\r\n* Still have preimage data in `SignatureData` too, accessed/controlled by a non-overridable ::CreatePreimage function (mimicking ::CreateSig in script/sign.cpp), which can invoke LookupPreimage on the `SignatureCreator` if needed, but can also access the \"cached\" version in `SignatureData`.\r\n\r\nThis means that `SignatureCreator` implementations only need to know about `SigningProvider`, like before, but can still override. It also avoids the need to pass a `SignatureData` to SignSignature.\r\n\r\n---\r\n\r\nAn alternative, if the above is too complex, is to introduce a simple `PreimageData` structure, make `LookupPreimage` take `const PreimageData&`, and add a `PreimageData` field to `SignatureData`.\r\n\r\n---\r\n\r\nLastly, if none of the above are doable: can `SignatureData&` here and the argument to SignSignature be made a const reference?\r\n",
      "commit_id" : "fb2a488d2ef3593072da3bad2741c4360508327f",
      "created_at" : "2022-08-19T20:18:32Z",
      "diff_hunk" : "@@ -32,6 +62,9 @@ class BaseSignatureCreator {\n     /** Create a singular (non-script) signature. */\n     virtual bool CreateSig(const SigningProvider& provider, std::vector<unsigned char>& vchSig, const CKeyID& keyid, const CScript& scriptCode, SigVersion sigversion) const =0;\n     virtual bool CreateSchnorrSig(const SigningProvider& provider, std::vector<unsigned char>& sig, const XOnlyPubKey& pubkey, const uint256* leaf_hash, const uint256* merkle_root, SigVersion sigversion) const =0;\n+\n+    //! Fetch a preimage corresponding to this hash.\n+    virtual bool LookupPreimage(SignatureData& sig_data, const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage) const =0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r950532827",
      "id" : 950532827,
      "line" : 67,
      "node_id" : "PRRC_kwDOABII5844p_rb",
      "original_commit_id" : "84cd88642fd9fc542593c9253fec4038408c2802",
      "original_line" : 67,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/script/sign.h",
      "position" : 43,
      "pull_request_review_id" : 1079318735,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950532827/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-19T20:21:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950532827",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r950544682"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950544682"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Using a single map/lookup for all types of preimages may be undesirable in an edge case: if `h=SHA256(SHA256(x))`, then both `x` and `SHA256(x)` can be correct preimages (under Hash256 and SHA256 respectively), and both might be used in a single script.\r\n",
      "commit_id" : "fb2a488d2ef3593072da3bad2741c4360508327f",
      "created_at" : "2022-08-19T20:40:25Z",
      "diff_hunk" : "@@ -443,11 +450,18 @@ struct Satisfier {\n \n \n     //! Hash preimage satisfactions.\n-    // TODO\n-    miniscript::Availability SatSHA256(const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage) const { return miniscript::Availability::NO; }\n-    miniscript::Availability SatRIPEMD160(const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage) const { return miniscript::Availability::NO; }\n-    miniscript::Availability SatHASH256(const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage) const { return miniscript::Availability::NO; }\n-    miniscript::Availability SatHASH160(const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage) const { return miniscript::Availability::NO; }\n+    miniscript::Availability SatSHA256(const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage) const {\n+        return m_creator.LookupPreimage(m_sig_data, hash, preimage) ? miniscript::Availability::YES : miniscript::Availability::NO;\n+    }\n+    miniscript::Availability SatRIPEMD160(const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage) const {\n+        return m_creator.LookupPreimage(m_sig_data, hash, preimage) ? miniscript::Availability::YES : miniscript::Availability::NO;\n+    }\n+    miniscript::Availability SatHASH256(const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage) const {\n+        return m_creator.LookupPreimage(m_sig_data, hash, preimage) ? miniscript::Availability::YES : miniscript::Availability::NO;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r950544682",
      "id" : 950544682,
      "line" : 460,
      "node_id" : "PRRC_kwDOABII5844qCkq",
      "original_commit_id" : "84cd88642fd9fc542593c9253fec4038408c2802",
      "original_line" : 460,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/script/sign.cpp",
      "position" : 30,
      "pull_request_review_id" : 1079335882,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950544682/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-19T20:40:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/950544682",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-08-24T17:24:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#issuecomment-1226019114",
      "id" : 1226019114,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24149",
      "node_id" : "IC_kwDOABII585JE5Eq",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1226019114/reactions"
      },
      "updated_at" : "2022-08-24T17:24:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1226019114",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r957584192"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/957584192"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I see. But since `SignatureData` is already largely exposed to the inner of `ProduceSignature`, what would you think of just making it a parameter in `SignSignature` (instead of creating a fresh one there)? Because actually it's not necessary to expose it to `SignatureCreator`:\r\n\r\n\r\n<details>\r\n<summary>Quick and dirty diff on the tip of the PR</summary>\r\n\r\n```diff\r\ndiff --git a/src/script/sign.cpp b/src/script/sign.cpp\r\nindex 4fe738dfd5..f337e8ba48 100644\r\n--- a/src/script/sign.cpp\r\n+++ b/src/script/sign.cpp\r\n@@ -89,13 +89,6 @@ bool MutableTransactionSignatureCreator::CreateSchnorrSig(const SigningProvider&\r\n     return true;\r\n }\r\n \r\n-bool MutableTransactionSignatureCreator::LookupPreimage(SignatureData& sig_data, const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage) const {\r\n-    auto it = sig_data.hash_preimages.find(hash);\r\n-    if (it == sig_data.hash_preimages.end()) return false;\r\n-    preimage = it->second;\r\n-    return true;\r\n-}\r\n-\r\n static bool GetCScript(const SigningProvider& provider, const SignatureData& sigdata, const CScriptID& scriptid, CScript& script)\r\n {\r\n     if (provider.GetCScript(scriptid, script)) {\r\n@@ -390,6 +383,17 @@ static CScript PushAll(const std::vector<valtype>& values)\r\n     return result;\r\n }\r\n \r\n+template<typename M, typename K, typename V>\r\n+bool LookupHelper(const M& map, const K& key, V& value)\r\n+{\r\n+    auto it = map.find(key);\r\n+    if (it != map.end()) {\r\n+        value = it->second;\r\n+        return true;\r\n+    }\r\n+    return false;\r\n+}\r\n+\r\n /**\r\n  * Context for solving a Miniscript.\r\n  * If enough material (access to keys, hash preimages, ..) is given, produces a valid satisfaction.\r\n@@ -451,16 +455,16 @@ struct Satisfier {\r\n \r\n     //! Hash preimage satisfactions.\r\n     miniscript::Availability SatSHA256(const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage) const {\r\n-        return m_creator.LookupPreimage(m_sig_data, hash, preimage) ? miniscript::Availability::YES : miniscript::Availability::NO;\r\n+        return LookupHelper(m_sig_data.hash_preimages, hash, preimage) ? miniscript::Availability::YES : miniscript::Availability::NO;\r\n     }\r\n     miniscript::Availability SatRIPEMD160(const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage) const {\r\n-        return m_creator.LookupPreimage(m_sig_data, hash, preimage) ? miniscript::Availability::YES : miniscript::Availability::NO;\r\n+        return LookupHelper(m_sig_data.hash_preimages, hash, preimage) ? miniscript::Availability::YES : miniscript::Availability::NO;\r\n     }\r\n     miniscript::Availability SatHASH256(const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage) const {\r\n-        return m_creator.LookupPreimage(m_sig_data, hash, preimage) ? miniscript::Availability::YES : miniscript::Availability::NO;\r\n+        return LookupHelper(m_sig_data.hash_preimages, hash, preimage) ? miniscript::Availability::YES : miniscript::Availability::NO;\r\n     }\r\n     miniscript::Availability SatHASH160(const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage) const {\r\n-        return m_creator.LookupPreimage(m_sig_data, hash, preimage) ? miniscript::Availability::YES : miniscript::Availability::NO;\r\n+        return LookupHelper(m_sig_data.hash_preimages, hash, preimage) ? miniscript::Availability::YES : miniscript::Availability::NO;\r\n     }\r\n };\r\n \r\n@@ -720,11 +724,6 @@ public:\r\n         sig.assign(64, '\\000');\r\n         return true;\r\n     }\r\n-\r\n-    bool LookupPreimage(SignatureData& sig_data, const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage) const override {\r\n-        preimage.assign(32, '\\000');\r\n-        return true;\r\n-    }\r\n };\r\n \r\n }\r\ndiff --git a/src/script/sign.h b/src/script/sign.h\r\nindex fdb3244d5d..8df1fbc98d 100644\r\n--- a/src/script/sign.h\r\n+++ b/src/script/sign.h\r\n@@ -62,9 +62,6 @@ public:\r\n     /** Create a singular (non-script) signature. */\r\n     virtual bool CreateSig(const SigningProvider& provider, std::vector<unsigned char>& vchSig, const CKeyID& keyid, const CScript& scriptCode, SigVersion sigversion) const =0;\r\n     virtual bool CreateSchnorrSig(const SigningProvider& provider, std::vector<unsigned char>& sig, const XOnlyPubKey& pubkey, const uint256* leaf_hash, const uint256* merkle_root, SigVersion sigversion) const =0;\r\n-\r\n-    //! Fetch a preimage corresponding to this hash.\r\n-    virtual bool LookupPreimage(SignatureData& sig_data, const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage) const =0;\r\n };\r\n \r\n /** A signature creator for transactions. */\r\n@@ -83,7 +80,6 @@ public:\r\n     const BaseSignatureChecker& Checker() const override { return checker; }\r\n     bool CreateSig(const SigningProvider& provider, std::vector<unsigned char>& vchSig, const CKeyID& keyid, const CScript& scriptCode, SigVersion sigversion) const override;\r\n     bool CreateSchnorrSig(const SigningProvider& provider, std::vector<unsigned char>& sig, const XOnlyPubKey& pubkey, const uint256* leaf_hash, const uint256* merkle_root, SigVersion sigversion) const override;\r\n-    bool LookupPreimage(SignatureData& sig_data, const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage) const override;\r\n };\r\n \r\n /** A signature creator that just produces 71-byte empty signatures. */\r\n```\r\n\r\n</details>\r\n\r\n> can [...] the argument to SignSignature be made a const reference?\r\n\r\nIt's modified by `SignSignature` so it wouldn't be possible to make it a const reference.",
      "commit_id" : "fb2a488d2ef3593072da3bad2741c4360508327f",
      "created_at" : "2022-08-29T17:04:30Z",
      "diff_hunk" : "@@ -32,6 +62,9 @@ class BaseSignatureCreator {\n     /** Create a singular (non-script) signature. */\n     virtual bool CreateSig(const SigningProvider& provider, std::vector<unsigned char>& vchSig, const CKeyID& keyid, const CScript& scriptCode, SigVersion sigversion) const =0;\n     virtual bool CreateSchnorrSig(const SigningProvider& provider, std::vector<unsigned char>& sig, const XOnlyPubKey& pubkey, const uint256* leaf_hash, const uint256* merkle_root, SigVersion sigversion) const =0;\n+\n+    //! Fetch a preimage corresponding to this hash.\n+    virtual bool LookupPreimage(SignatureData& sig_data, const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage) const =0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r957584192",
      "id" : 957584192,
      "in_reply_to_id" : 950532827,
      "line" : 67,
      "node_id" : "PRRC_kwDOABII5845E5NA",
      "original_commit_id" : "84cd88642fd9fc542593c9253fec4038408c2802",
      "original_line" : 67,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/script/sign.h",
      "position" : 43,
      "pull_request_review_id" : 1089052519,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/957584192/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-29T17:05:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/957584192",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r958488772"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958488772"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good catch. Thanks.",
      "commit_id" : "fb2a488d2ef3593072da3bad2741c4360508327f",
      "created_at" : "2022-08-30T13:33:17Z",
      "diff_hunk" : "@@ -443,11 +450,18 @@ struct Satisfier {\n \n \n     //! Hash preimage satisfactions.\n-    // TODO\n-    miniscript::Availability SatSHA256(const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage) const { return miniscript::Availability::NO; }\n-    miniscript::Availability SatRIPEMD160(const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage) const { return miniscript::Availability::NO; }\n-    miniscript::Availability SatHASH256(const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage) const { return miniscript::Availability::NO; }\n-    miniscript::Availability SatHASH160(const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage) const { return miniscript::Availability::NO; }\n+    miniscript::Availability SatSHA256(const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage) const {\n+        return m_creator.LookupPreimage(m_sig_data, hash, preimage) ? miniscript::Availability::YES : miniscript::Availability::NO;\n+    }\n+    miniscript::Availability SatRIPEMD160(const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage) const {\n+        return m_creator.LookupPreimage(m_sig_data, hash, preimage) ? miniscript::Availability::YES : miniscript::Availability::NO;\n+    }\n+    miniscript::Availability SatHASH256(const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage) const {\n+        return m_creator.LookupPreimage(m_sig_data, hash, preimage) ? miniscript::Availability::YES : miniscript::Availability::NO;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r958488772",
      "id" : 958488772,
      "in_reply_to_id" : 950544682,
      "line" : 460,
      "node_id" : "PRRC_kwDOABII5845IWDE",
      "original_commit_id" : "84cd88642fd9fc542593c9253fec4038408c2802",
      "original_line" : 460,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/script/sign.cpp",
      "position" : 30,
      "pull_request_review_id" : 1090331952,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958488772/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-30T13:33:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958488772",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased (quite verbose, following #25863) and removed needless commit 1af2145ef6 (\"descriptor_tests: use clang-tidy verifiable syntax for argument comment\").\r\n\r\nI changed the commit introducing hashlock satisfaction to use a mapping per hash type, since there might be collisions between hash types (thanks sipa!). I kept a single mapping in the unit tests that is copied in order to not introduce 4 new arguments to the function.\r\nI also changed this commit to not expose `SignatureData` to the `SignatureCreator` anymore. I might change it soon to use a `SigningProvider` to hold the preimages instead, depending on the outcome of the discussion in https://github.com/bitcoin/bitcoin/pull/24149#discussion_r950532827.",
      "created_at" : "2022-08-30T14:25:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#issuecomment-1231744442",
      "id" : 1231744442,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24149",
      "node_id" : "IC_kwDOABII585Jau26",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1231744442/reactions"
      },
      "updated_at" : "2022-08-30T14:25:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1231744442",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-09-19T16:23:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#issuecomment-1251248085",
      "id" : 1251248085,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24149",
      "node_id" : "IC_kwDOABII585KlIfV",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1251248085/reactions"
      },
      "updated_at" : "2022-09-19T16:23:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1251248085",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased.\r\n\r\nThere was a spurious (apparently build?) failure in the Windows CI, had to force-pushed to re-kick it.",
      "created_at" : "2022-11-21T18:54:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#issuecomment-1322508046",
      "id" : 1322508046,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24149",
      "node_id" : "IC_kwDOABII585O098O",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1322508046/reactions"
      },
      "updated_at" : "2022-11-21T18:54:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1322508046",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I have implemented in #26567 the signed input size estimation based on descriptor rather than on a dry run of the signing logic. This would allow the wallet to estimate the fees (and therefore do coin selection) for transactions spending Miniscript outputs.",
      "created_at" : "2022-11-25T12:50:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#issuecomment-1327435276",
      "id" : 1327435276,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24149",
      "node_id" : "IC_kwDOABII585PHw4M",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1327435276/reactions"
      },
      "updated_at" : "2022-11-25T12:50:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1327435276",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1073955788"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1073955788"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Mark the arguments as `LIFETIMEBOUND`?",
      "commit_id" : "75eee1679a081fe5b6d236af3449b459b0723625",
      "created_at" : "2023-01-18T19:00:27Z",
      "diff_hunk" : "@@ -381,6 +382,73 @@ static CScript PushAll(const std::vector<valtype>& values)\n     return result;\n }\n \n+/**\n+ * Context for solving a Miniscript.\n+ * If enough material (access to keys, hash preimages, ..) is given, produces a valid satisfaction.\n+ */\n+struct Satisfier {\n+    typedef CPubKey Key;\n+\n+    const SigningProvider& m_provider;\n+    SignatureData& m_sig_data;\n+    const BaseSignatureCreator& m_creator;\n+    const CScript& m_witness_script;\n+\n+    explicit Satisfier(const SigningProvider& provider, SignatureData& sig_data, const BaseSignatureCreator& creator,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1073955788",
      "id" : 1073955788,
      "line" : 408,
      "node_id" : "PRRC_kwDOABII585AA0PM",
      "original_commit_id" : "6503ece5fda960cbfd8cfa76d7891f7cd0faa5a8",
      "original_line" : 397,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/script/sign.cpp",
      "position" : 24,
      "pull_request_review_id" : 1254129729,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1073955788/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-18T20:49:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1073955788",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1073958344"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1073958344"
         }
      },
      "author_association" : "MEMBER",
      "body" : "typo: `collision` ?",
      "commit_id" : "75eee1679a081fe5b6d236af3449b459b0723625",
      "created_at" : "2023-01-18T19:03:04Z",
      "diff_hunk" : "@@ -317,6 +318,11 @@ void DoCheck(const std::string& prv, const std::string& pub, const std::string&\n                     txdata.Init(spend, std::move(utxos), /*force=*/true);\n                     MutableTransactionSignatureCreator creator{spend, 0, CAmount{0}, &txdata, SIGHASH_DEFAULT};\n                     SignatureData sigdata;\n+                    // We assume there is no collusion between the hashes (eg h1=SHA256(SHA256(x)) and h2=SHA256(x))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1073958344",
      "id" : 1073958344,
      "line" : 321,
      "node_id" : "PRRC_kwDOABII585AA03I",
      "original_commit_id" : "3d8e2897e1659c649e18d306c58e65ec9880a04c",
      "original_line" : 321,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/test/descriptor_tests.cpp",
      "position" : 14,
      "pull_request_review_id" : 1254129729,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1073958344/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-18T20:49:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1073958344",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1074017653"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1074017653"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Pass by reference, and mark `LIFETIMEBOUND` ?",
      "commit_id" : "75eee1679a081fe5b6d236af3449b459b0723625",
      "created_at" : "2023-01-18T19:59:26Z",
      "diff_hunk" : "@@ -117,12 +159,197 @@ struct KeyConverter {\n     }\n };\n \n+/** A class that encapsulates all signing/hash revealing operations. */\n+struct Satisfier : public KeyConverter {\n+    //! Which keys/timelocks/hash preimages are available.\n+    std::set<Challenge> supported;\n+\n+    //! Implement simplified CLTV logic: stack value must exactly match an entry in `supported`.\n+    bool CheckAfter(uint32_t value) const {\n+        return supported.count(Challenge(ChallengeType::AFTER, value));\n+    }\n+\n+    //! Implement simplified CSV logic: stack value must exactly match an entry in `supported`.\n+    bool CheckOlder(uint32_t value) const {\n+        return supported.count(Challenge(ChallengeType::OLDER, value));\n+    }\n+\n+    //! Produce a signature for the given key.\n+    miniscript::Availability Sign(const CPubKey& key, std::vector<unsigned char>& sig) const {\n+        if (supported.count(Challenge(ChallengeType::PK, ChallengeNumber(key)))) {\n+            auto it = g_testdata->signatures.find(key);\n+            if (it == g_testdata->signatures.end()) return miniscript::Availability::NO;\n+            sig = it->second;\n+            return miniscript::Availability::YES;\n+        }\n+        return miniscript::Availability::NO;\n+    }\n+\n+    //! Helper function for the various hash based satisfactions.\n+    miniscript::Availability SatHash(const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage, ChallengeType chtype) const {\n+        if (!supported.count(Challenge(chtype, ChallengeNumber(hash)))) return miniscript::Availability::NO;\n+        const auto& m =\n+            chtype == ChallengeType::SHA256 ? g_testdata->sha256_preimages :\n+            chtype == ChallengeType::HASH256 ? g_testdata->hash256_preimages :\n+            chtype == ChallengeType::RIPEMD160 ? g_testdata->ripemd160_preimages :\n+            g_testdata->hash160_preimages;\n+        auto it = m.find(hash);\n+        if (it == m.end()) return miniscript::Availability::NO;\n+        preimage = it->second;\n+        return miniscript::Availability::YES;\n+    }\n+\n+    // Functions that produce the preimage for hashes of various types.\n+    miniscript::Availability SatSHA256(const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage) const { return SatHash(hash, preimage, ChallengeType::SHA256); }\n+    miniscript::Availability SatRIPEMD160(const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage) const { return SatHash(hash, preimage, ChallengeType::RIPEMD160); }\n+    miniscript::Availability SatHASH256(const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage) const { return SatHash(hash, preimage, ChallengeType::HASH256); }\n+    miniscript::Availability SatHASH160(const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage) const { return SatHash(hash, preimage, ChallengeType::HASH160); }\n+};\n+\n+/** Mocking signature/timelock checker.\n+ *\n+ * It holds a pointer to a Satisfier object, to determine which timelocks are supposed to be available.\n+ */\n+class TestSignatureChecker : public BaseSignatureChecker {\n+    const Satisfier *ctx;\n+\n+public:\n+    TestSignatureChecker(const Satisfier *in_ctx) : ctx(in_ctx) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1074017653",
      "id" : 1074017653,
      "line" : 217,
      "node_id" : "PRRC_kwDOABII585ABDV1",
      "original_commit_id" : "49290ac88f753639507a6053937a0c26bd5d42b2",
      "original_line" : 217,
      "original_position" : 165,
      "original_start_line" : null,
      "path" : "src/test/miniscript_tests.cpp",
      "position" : 165,
      "pull_request_review_id" : 1254129729,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1074017653/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-18T20:49:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1074017653",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1074029527"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1074029527"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe worth adding some comments to these. I suggest:\r\n\r\n```c++\r\n/** A stack consisting of a single zero-length element (interpreted as 0 by the script interpreter in numeric context). */\r\nstatic const auto ZERO = InputStack(std::vector<unsigned char>());\r\n/** A stack consisting of a single malleable 32-byte 0x0000...0000 element (for dissatisfying hash challenges). */\r\nstatic const auto ZERO32 = InputStack(std::vector<unsigned char>(32, 0)).SetMalleable();\r\n/** A stack consisting of a single 0x01 element (interpreted as 1 by the script interpreted in numeric context). */\r\nstatic const auto ONE = InputStack(Vector((unsigned char)1));\r\n/** The empty stack. */\r\nstatic const auto EMPTY = InputStack();\r\n/** A stack representing the lack of any (dis)satisfactions. */\r\nstatic const auto INVALID = InputStack().SetAvailable(Availability::NO);\r\n```\r\n",
      "commit_id" : "75eee1679a081fe5b6d236af3449b459b0723625",
      "created_at" : "2023-01-18T20:14:26Z",
      "diff_hunk" : "@@ -235,6 +240,55 @@ size_t ComputeScriptLen(Fragment fragment, Type sub0typ, size_t subsize, uint32_\n //! A helper sanitizer/checker for the output of CalcType.\n Type SanitizeType(Type x);\n \n+//! An object representing a sequence of witness stack elements.\n+struct InputStack {\n+    /** Whether this stack is valid for its intended purpose (satisfaction or dissatisfaction of a Node).\n+     *  The MAYBE value is used for size estimation, when keys/preimages may actually be unavailable,\n+     *  but may be available at signing time. This makes the InputStack structure and signing logic,\n+     *  filled with dummy signatures/preimages usable for witness size estimation.\n+     */\n+    Availability available = Availability::YES;\n+    //! Whether this stack contains a digital signature.\n+    bool has_sig = false;\n+    //! Whether this stack is malleable (can be turned into an equally valid other stack by a third party).\n+    bool malleable = false;\n+    //! Whether this stack is non-canonical (using a construction known to be unnecessary for satisfaction).\n+    //! Note that this flag does not affect the satisfaction algorithm; it is only used for sanity checking.\n+    bool non_canon = false;\n+    //! Serialized witness size.\n+    size_t size = 0;\n+    //! Data elements.\n+    std::vector<std::vector<unsigned char>> stack;\n+    //! Construct an empty stack (valid).\n+    InputStack() {}\n+    //! Construct a valid single-element stack (with an element up to 75 bytes).\n+    InputStack(std::vector<unsigned char> in) : size(in.size() + 1), stack(Vector(std::move(in))) {}\n+    //! Change availability\n+    InputStack& SetAvailable(Availability avail);\n+    //! Mark this input stack as having a signature.\n+    InputStack& SetWithSig();\n+    //! Mark this input stack as non-canonical (known to not be necessary in non-malleable satisfactions).\n+    InputStack& SetNonCanon();\n+    //! Mark this input stack as malleable.\n+    InputStack& SetMalleable(bool x = true);\n+    //! Concatenate two input stacks.\n+    friend InputStack operator+(InputStack a, InputStack b);\n+    //! Choose between two potential input stacks.\n+    friend InputStack operator|(InputStack a, InputStack b);\n+};\n+\n+static const auto ZERO = InputStack(std::vector<unsigned char>());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1074029527",
      "id" : 1074029527,
      "line" : 280,
      "node_id" : "PRRC_kwDOABII585ABGPX",
      "original_commit_id" : "49290ac88f753639507a6053937a0c26bd5d42b2",
      "original_line" : 280,
      "original_position" : 53,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 53,
      "pull_request_review_id" : 1254129729,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1074029527/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-18T20:49:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1074029527",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1074031621"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1074031621"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe worth adding a comment, like `Internal function which is invoked for every tree node, constructing satisfaction/dissatisfactions given those of its subnodes.`.",
      "commit_id" : "75eee1679a081fe5b6d236af3449b459b0723625",
      "created_at" : "2023-01-18T20:16:59Z",
      "diff_hunk" : "@@ -785,6 +839,188 @@ struct Node {\n         assert(false);\n     }\n \n+    template<typename Ctx>\n+    internal::InputResult ProduceInput(const Ctx& ctx) const {\n+        using namespace internal;\n+\n+        auto helper = [&ctx](const Node& node, Span<InputResult> subres) -> InputResult {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1074031621",
      "id" : 1074031621,
      "line" : 846,
      "node_id" : "PRRC_kwDOABII585ABGwF",
      "original_commit_id" : "49290ac88f753639507a6053937a0c26bd5d42b2",
      "original_line" : 846,
      "original_position" : 76,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 76,
      "pull_request_review_id" : 1254129729,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1074031621/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-18T20:49:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1074031621",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1074033951"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1074033951"
         }
      },
      "author_association" : "MEMBER",
      "body" : "An alternative here would be adding `-> bool` to the lambda definition, I think, if we care.",
      "commit_id" : "75eee1679a081fe5b6d236af3449b459b0723625",
      "created_at" : "2023-01-18T20:19:39Z",
      "diff_hunk" : "@@ -842,6 +1079,47 @@ struct Node {\n         });\n     }\n \n+    //! Determine whether a Miniscript node is satisfiable. fn(node) will be invoked for all\n+    //! key, time, and hashing nodes, and should return their satisfiability.\n+    template<typename F>\n+    bool IsSatisfiable(F fn) const\n+    {\n+        // TreeEval() doesn't support bool as NodeType, so use int instead.\n+        return TreeEval<int>([&fn](const Node& node, Span<int> subs) {\n+            switch (node.fragment) {\n+                case Fragment::JUST_0:\n+                    return false;\n+                case Fragment::JUST_1:\n+                    return true;\n+                case Fragment::PK_K:\n+                case Fragment::PK_H:\n+                case Fragment::MULTI:\n+                case Fragment::AFTER:\n+                case Fragment::OLDER:\n+                case Fragment::HASH256:\n+                case Fragment::HASH160:\n+                case Fragment::SHA256:\n+                case Fragment::RIPEMD160:\n+                    return bool{fn(node)};\n+                case Fragment::ANDOR:\n+                    return (subs[0] && subs[1]) || subs[2];\n+                case Fragment::AND_V:\n+                case Fragment::AND_B:\n+                    return subs[0] && subs[1];\n+                case Fragment::OR_B:\n+                case Fragment::OR_C:\n+                case Fragment::OR_D:\n+                case Fragment::OR_I:\n+                    return subs[0] || subs[1];\n+                case Fragment::THRESH:\n+                    return std::count(subs.begin(), subs.end(), true) >= node.k;\n+                default: // wrappers\n+                    assert(subs.size() == 1);\n+                    return !!subs[0];",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1074033951",
      "id" : 1074033951,
      "in_reply_to_id" : 923792873,
      "line" : 1152,
      "node_id" : "PRRC_kwDOABII585ABHUf",
      "original_commit_id" : "3bedfb5b13e863508cb9b0d44fa03cc991151927",
      "original_line" : 1152,
      "original_position" : 298,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 297,
      "pull_request_review_id" : 1254129729,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1074033951/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-18T20:49:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1074033951",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1080530644"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1080530644"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can be `static` (and non-`const` then).",
      "commit_id" : "75eee1679a081fe5b6d236af3449b459b0723625",
      "created_at" : "2023-01-18T20:36:31Z",
      "diff_hunk" : "@@ -381,6 +382,73 @@ static CScript PushAll(const std::vector<valtype>& values)\n     return result;\n }\n \n+/**\n+ * Context for solving a Miniscript.\n+ * If enough material (access to keys, hash preimages, ..) is given, produces a valid satisfaction.\n+ */\n+struct Satisfier {\n+    typedef CPubKey Key;\n+\n+    const SigningProvider& m_provider;\n+    SignatureData& m_sig_data;\n+    const BaseSignatureCreator& m_creator;\n+    const CScript& m_witness_script;\n+\n+    explicit Satisfier(const SigningProvider& provider, SignatureData& sig_data, const BaseSignatureCreator& creator,\n+                       const CScript& witscript) : m_provider(provider),\n+                                                   m_sig_data(sig_data),\n+                                                   m_creator(creator),\n+                                                   m_witness_script(witscript) {}\n+\n+    bool KeyCompare(const Key& a, const Key& b) const {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1080530644",
      "id" : 1080530644,
      "line" : 414,
      "node_id" : "PRRC_kwDOABII585AZ5bU",
      "original_commit_id" : "6503ece5fda960cbfd8cfa76d7891f7cd0faa5a8",
      "original_line" : 403,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/script/sign.cpp",
      "position" : 30,
      "pull_request_review_id" : 1254129729,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1080530644/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-18T20:49:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1080530644",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1080534576"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1080534576"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Do you think this could be `if (!solved && result.empty()) {` instead? From a cursory reading, it looks like only `TxoutType::MULTISIG` populates `result` without fully solving, so that should match the exact behavior we want, without needing to special case `MULTISIG`, and without needing a slightly-concerning `result.clear()`.",
      "commit_id" : "75eee1679a081fe5b6d236af3449b459b0723625",
      "created_at" : "2023-01-18T20:41:38Z",
      "diff_hunk" : "@@ -416,9 +484,21 @@ bool ProduceSignature(const SigningProvider& provider, const BaseSignatureCreato\n     {\n         CScript witnessscript(result[0].begin(), result[0].end());\n         sigdata.witness_script = witnessscript;\n-        TxoutType subType;\n+\n+        TxoutType subType{TxoutType::NONSTANDARD};\n         solved = solved && SignStep(provider, creator, witnessscript, result, subType, SigVersion::WITNESS_V0, sigdata) && subType != TxoutType::SCRIPTHASH && subType != TxoutType::WITNESS_V0_SCRIPTHASH && subType != TxoutType::WITNESS_V0_KEYHASH;\n+\n+        // Don't try to satisfy using Miniscript if it was a multisig as it would have already been handled by\n+        // SignStep, which appends partial signatures to the witness stack and we must not temper with to keep\n+        // compatibility with the extractor relying on this behaviour to combine witnesses.\n+        if (!solved && subType != TxoutType::MULTISIG) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1080534576",
      "id" : 1080534576,
      "line" : 512,
      "node_id" : "PRRC_kwDOABII585AZ6Yw",
      "original_commit_id" : "6503ece5fda960cbfd8cfa76d7891f7cd0faa5a8",
      "original_line" : 494,
      "original_position" : 94,
      "original_start_line" : null,
      "path" : "src/script/sign.cpp",
      "position" : 94,
      "pull_request_review_id" : 1254129729,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1080534576/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-18T20:49:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1080534576",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1080537839"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1080537839"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The `sigdata` argument here should probably be passed to the call to `SignSignature()` below?\r\n\r\nAlso, here too, does `SignatureData sigdata` need to be passed by value?\r\n\r\n",
      "commit_id" : "75eee1679a081fe5b6d236af3449b459b0723625",
      "created_at" : "2023-01-18T20:45:48Z",
      "diff_hunk" : "@@ -644,19 +662,18 @@ void SignatureData::MergeSignatureData(SignatureData sigdata)\n     signatures.insert(std::make_move_iterator(sigdata.signatures.begin()), std::make_move_iterator(sigdata.signatures.end()));\n }\n \n-bool SignSignature(const SigningProvider &provider, const CScript& fromPubKey, CMutableTransaction& txTo, unsigned int nIn, const CAmount& amount, int nHashType)\n+bool SignSignature(const SigningProvider &provider, const CScript& fromPubKey, CMutableTransaction& txTo, unsigned int nIn, const CAmount& amount, int nHashType, SignatureData sigdata)\n {\n     assert(nIn < txTo.vin.size());\n \n     MutableTransactionSignatureCreator creator(txTo, nIn, amount, nHashType);\n \n-    SignatureData sigdata;\n     bool ret = ProduceSignature(provider, creator, fromPubKey, sigdata);\n     UpdateInput(txTo.vin.at(nIn), sigdata);\n     return ret;\n }\n \n-bool SignSignature(const SigningProvider &provider, const CTransaction& txFrom, CMutableTransaction& txTo, unsigned int nIn, int nHashType)\n+bool SignSignature(const SigningProvider &provider, const CTransaction& txFrom, CMutableTransaction& txTo, unsigned int nIn, int nHashType, SignatureData sigdata)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1080537839",
      "id" : 1080537839,
      "line" : 676,
      "node_id" : "PRRC_kwDOABII585AZ7Lv",
      "original_commit_id" : "3d8e2897e1659c649e18d306c58e65ec9880a04c",
      "original_line" : 676,
      "original_position" : 60,
      "original_start_line" : null,
      "path" : "src/script/sign.cpp",
      "position" : 60,
      "pull_request_review_id" : 1254129729,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1080537839/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-18T20:49:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1080537839",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1080538605"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1080538605"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Passed by value, so nothing can be returned in it?",
      "commit_id" : "75eee1679a081fe5b6d236af3449b459b0723625",
      "created_at" : "2023-01-18T20:46:47Z",
      "diff_hunk" : "@@ -91,9 +95,24 @@ struct SignatureData {\n /** Produce a script signature using a generic signature creator. */\n bool ProduceSignature(const SigningProvider& provider, const BaseSignatureCreator& creator, const CScript& scriptPubKey, SignatureData& sigdata);\n \n-/** Produce a script signature for a transaction. */\n-bool SignSignature(const SigningProvider &provider, const CScript& fromPubKey, CMutableTransaction& txTo, unsigned int nIn, const CAmount& amount, int nHashType);\n-bool SignSignature(const SigningProvider &provider, const CTransaction& txFrom, CMutableTransaction& txTo, unsigned int nIn, int nHashType);\n+/**\n+ * Produce a satisfying script (scriptSig or witness).\n+ *\n+ * @param provider   Utility containing the information necessary to solve a script.\n+ * @param fromPubKey The script to produce a satisfaction for.\n+ * @param txTo       The spending transaction.\n+ * @param nIn        The index of the input in `txTo` refering the output being spent.\n+ * @param amount     The value of the output being spent.\n+ * @param nHashType  Signature hash type.\n+ * @param sig_data   Additional data provided to solve a script. Filled with the resulting satisfying",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1080538605",
      "id" : 1080538605,
      "line" : 107,
      "node_id" : "PRRC_kwDOABII585AZ7Xt",
      "original_commit_id" : "3d8e2897e1659c649e18d306c58e65ec9880a04c",
      "original_line" : 107,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/script/sign.h",
      "position" : 27,
      "pull_request_review_id" : 1254129729,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1080538605/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-18T20:49:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1080538605",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1080539964"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1080539964"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Pass `SignatureData sigdata` by value, is that necessary?",
      "commit_id" : "75eee1679a081fe5b6d236af3449b459b0723625",
      "created_at" : "2023-01-18T20:48:33Z",
      "diff_hunk" : "@@ -644,19 +662,18 @@ void SignatureData::MergeSignatureData(SignatureData sigdata)\n     signatures.insert(std::make_move_iterator(sigdata.signatures.begin()), std::make_move_iterator(sigdata.signatures.end()));\n }\n \n-bool SignSignature(const SigningProvider &provider, const CScript& fromPubKey, CMutableTransaction& txTo, unsigned int nIn, const CAmount& amount, int nHashType)\n+bool SignSignature(const SigningProvider &provider, const CScript& fromPubKey, CMutableTransaction& txTo, unsigned int nIn, const CAmount& amount, int nHashType, SignatureData sigdata)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1080539964",
      "id" : 1080539964,
      "line" : 665,
      "node_id" : "PRRC_kwDOABII585AZ7s8",
      "original_commit_id" : "3d8e2897e1659c649e18d306c58e65ec9880a04c",
      "original_line" : 665,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "src/script/sign.cpp",
      "position" : 47,
      "pull_request_review_id" : 1254129729,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1080539964/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-18T20:49:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1080539964",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1086673062"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1086673062"
         }
      },
      "author_association" : "NONE",
      "body" : "suggestion: \"If only one is invalid, pick the other one. If both are invalid, pick an arbitrary one.\"\r\n\r\nThe current comment seems to say the opposite of what the code does.",
      "commit_id" : "75eee1679a081fe5b6d236af3449b459b0723625",
      "created_at" : "2023-01-25T13:57:24Z",
      "diff_hunk" : "@@ -279,6 +279,76 @@ size_t ComputeScriptLen(Fragment fragment, Type sub0typ, size_t subsize, uint32_\n     assert(false);\n }\n \n+InputStack& InputStack::SetAvailable(Availability avail) {\n+    available = avail;\n+    if (avail == Availability::NO) {\n+        stack.clear();\n+        size = std::numeric_limits<size_t>::max();\n+        has_sig = false;\n+        malleable = false;\n+        non_canon = false;\n+    }\n+    return *this;\n+}\n+\n+InputStack& InputStack::SetWithSig() {\n+    has_sig = true;\n+    return *this;\n+}\n+\n+InputStack& InputStack::SetNonCanon() {\n+    non_canon = true;\n+    return *this;\n+}\n+\n+InputStack& InputStack::SetMalleable(bool x) {\n+    malleable = x;\n+    return *this;\n+}\n+\n+InputStack operator+(InputStack a, InputStack b) {\n+    a.stack = Cat(std::move(a.stack), std::move(b.stack));\n+    if (a.available != Availability::NO && b.available != Availability::NO) a.size += b.size;\n+    a.has_sig |= b.has_sig;\n+    a.malleable |= b.malleable;\n+    a.non_canon |= b.non_canon;\n+    if (a.available == Availability::NO || b.available == Availability::NO) {\n+        a.SetAvailable(Availability::NO);\n+    } else if (a.available == Availability::MAYBE || b.available == Availability::MAYBE) {\n+        a.SetAvailable(Availability::MAYBE);\n+    }\n+    return a;\n+}\n+\n+InputStack operator|(InputStack a, InputStack b) {\n+    // If only one (or neither) is valid, pick the other one.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1086673062",
      "id" : 1086673062,
      "line" : 324,
      "node_id" : "PRRC_kwDOABII585AxVCm",
      "original_commit_id" : "75eee1679a081fe5b6d236af3449b459b0723625",
      "original_line" : 324,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/script/miniscript.cpp",
      "position" : 46,
      "pull_request_review_id" : 1269401970,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1086673062/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-25T13:57:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1086673062",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1225267?v=4",
         "events_url" : "https://api.github.com/users/benma/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benma/followers",
         "following_url" : "https://api.github.com/users/benma/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benma/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benma",
         "id" : 1225267,
         "login" : "benma",
         "node_id" : "MDQ6VXNlcjEyMjUyNjc=",
         "organizations_url" : "https://api.github.com/users/benma/orgs",
         "received_events_url" : "https://api.github.com/users/benma/received_events",
         "repos_url" : "https://api.github.com/users/benma/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benma/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benma/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benma"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1087111158"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1087111158"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oops, indeed. That's a typo in my code.",
      "commit_id" : "75eee1679a081fe5b6d236af3449b459b0723625",
      "created_at" : "2023-01-25T19:58:57Z",
      "diff_hunk" : "@@ -279,6 +279,76 @@ size_t ComputeScriptLen(Fragment fragment, Type sub0typ, size_t subsize, uint32_\n     assert(false);\n }\n \n+InputStack& InputStack::SetAvailable(Availability avail) {\n+    available = avail;\n+    if (avail == Availability::NO) {\n+        stack.clear();\n+        size = std::numeric_limits<size_t>::max();\n+        has_sig = false;\n+        malleable = false;\n+        non_canon = false;\n+    }\n+    return *this;\n+}\n+\n+InputStack& InputStack::SetWithSig() {\n+    has_sig = true;\n+    return *this;\n+}\n+\n+InputStack& InputStack::SetNonCanon() {\n+    non_canon = true;\n+    return *this;\n+}\n+\n+InputStack& InputStack::SetMalleable(bool x) {\n+    malleable = x;\n+    return *this;\n+}\n+\n+InputStack operator+(InputStack a, InputStack b) {\n+    a.stack = Cat(std::move(a.stack), std::move(b.stack));\n+    if (a.available != Availability::NO && b.available != Availability::NO) a.size += b.size;\n+    a.has_sig |= b.has_sig;\n+    a.malleable |= b.malleable;\n+    a.non_canon |= b.non_canon;\n+    if (a.available == Availability::NO || b.available == Availability::NO) {\n+        a.SetAvailable(Availability::NO);\n+    } else if (a.available == Availability::MAYBE || b.available == Availability::MAYBE) {\n+        a.SetAvailable(Availability::MAYBE);\n+    }\n+    return a;\n+}\n+\n+InputStack operator|(InputStack a, InputStack b) {\n+    // If only one (or neither) is valid, pick the other one.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1087111158",
      "id" : 1087111158,
      "in_reply_to_id" : 1086673062,
      "line" : 324,
      "node_id" : "PRRC_kwDOABII585Ay__2",
      "original_commit_id" : "75eee1679a081fe5b6d236af3449b459b0723625",
      "original_line" : 324,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/script/miniscript.cpp",
      "position" : 46,
      "pull_request_review_id" : 1270015240,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1087111158/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-25T19:58:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1087111158",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1088066029"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1088066029"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oh, i think i initially did that to not have to modify all the call sites (by using a default value in the declaration) when i started writing this and i forgot to change it. Thanks, fixed it (will push once i addressed all comments).",
      "commit_id" : "75eee1679a081fe5b6d236af3449b459b0723625",
      "created_at" : "2023-01-26T16:21:04Z",
      "diff_hunk" : "@@ -644,19 +662,18 @@ void SignatureData::MergeSignatureData(SignatureData sigdata)\n     signatures.insert(std::make_move_iterator(sigdata.signatures.begin()), std::make_move_iterator(sigdata.signatures.end()));\n }\n \n-bool SignSignature(const SigningProvider &provider, const CScript& fromPubKey, CMutableTransaction& txTo, unsigned int nIn, const CAmount& amount, int nHashType)\n+bool SignSignature(const SigningProvider &provider, const CScript& fromPubKey, CMutableTransaction& txTo, unsigned int nIn, const CAmount& amount, int nHashType, SignatureData sigdata)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1088066029",
      "id" : 1088066029,
      "in_reply_to_id" : 1080539964,
      "line" : 665,
      "node_id" : "PRRC_kwDOABII585A2pHt",
      "original_commit_id" : "3d8e2897e1659c649e18d306c58e65ec9880a04c",
      "original_line" : 665,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "src/script/sign.cpp",
      "position" : 47,
      "pull_request_review_id" : 1271371985,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1088066029/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-26T16:21:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1088066029",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1088068683"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1088068683"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Evil hashes colluding!",
      "commit_id" : "75eee1679a081fe5b6d236af3449b459b0723625",
      "created_at" : "2023-01-26T16:23:17Z",
      "diff_hunk" : "@@ -317,6 +318,11 @@ void DoCheck(const std::string& prv, const std::string& pub, const std::string&\n                     txdata.Init(spend, std::move(utxos), /*force=*/true);\n                     MutableTransactionSignatureCreator creator{spend, 0, CAmount{0}, &txdata, SIGHASH_DEFAULT};\n                     SignatureData sigdata;\n+                    // We assume there is no collusion between the hashes (eg h1=SHA256(SHA256(x)) and h2=SHA256(x))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1088068683",
      "id" : 1088068683,
      "in_reply_to_id" : 1073958344,
      "line" : 321,
      "node_id" : "PRRC_kwDOABII585A2pxL",
      "original_commit_id" : "3d8e2897e1659c649e18d306c58e65ec9880a04c",
      "original_line" : 321,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/test/descriptor_tests.cpp",
      "position" : 14,
      "pull_request_review_id" : 1271375739,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1088068683/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-26T16:23:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1088068683",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1088130840"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1088130840"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, it is equivalent. I've made the change and updated the comment accordingly. Curious why you found `result.clear()` to be slightly-concerning though? It's what we do at the beginning of every `SignStep()` (and the Miniscript satisfier is kind of a more modern `SignStep()`).",
      "commit_id" : "33d30d1edd85a0110cbd9e3e29cc832f1cb6dab2",
      "created_at" : "2023-01-26T17:18:28Z",
      "diff_hunk" : "@@ -416,9 +484,21 @@ bool ProduceSignature(const SigningProvider& provider, const BaseSignatureCreato\n     {\n         CScript witnessscript(result[0].begin(), result[0].end());\n         sigdata.witness_script = witnessscript;\n-        TxoutType subType;\n+\n+        TxoutType subType{TxoutType::NONSTANDARD};\n         solved = solved && SignStep(provider, creator, witnessscript, result, subType, SigVersion::WITNESS_V0, sigdata) && subType != TxoutType::SCRIPTHASH && subType != TxoutType::WITNESS_V0_SCRIPTHASH && subType != TxoutType::WITNESS_V0_KEYHASH;\n+\n+        // Don't try to satisfy using Miniscript if it was a multisig as it would have already been handled by\n+        // SignStep, which appends partial signatures to the witness stack and we must not temper with to keep\n+        // compatibility with the extractor relying on this behaviour to combine witnesses.\n+        if (!solved && subType != TxoutType::MULTISIG) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1088130840",
      "id" : 1088130840,
      "in_reply_to_id" : 1080534576,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585A248Y",
      "original_commit_id" : "6503ece5fda960cbfd8cfa76d7891f7cd0faa5a8",
      "original_line" : 494,
      "original_position" : 94,
      "original_start_line" : null,
      "path" : "src/script/sign.cpp",
      "position" : null,
      "pull_request_review_id" : 1271468680,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1088130840/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-26T17:18:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1088130840",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1088131573"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1088131573"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added `-> bool` to the lambda definition as suggested.",
      "commit_id" : "33d30d1edd85a0110cbd9e3e29cc832f1cb6dab2",
      "created_at" : "2023-01-26T17:19:13Z",
      "diff_hunk" : "@@ -842,6 +1079,47 @@ struct Node {\n         });\n     }\n \n+    //! Determine whether a Miniscript node is satisfiable. fn(node) will be invoked for all\n+    //! key, time, and hashing nodes, and should return their satisfiability.\n+    template<typename F>\n+    bool IsSatisfiable(F fn) const\n+    {\n+        // TreeEval() doesn't support bool as NodeType, so use int instead.\n+        return TreeEval<int>([&fn](const Node& node, Span<int> subs) {\n+            switch (node.fragment) {\n+                case Fragment::JUST_0:\n+                    return false;\n+                case Fragment::JUST_1:\n+                    return true;\n+                case Fragment::PK_K:\n+                case Fragment::PK_H:\n+                case Fragment::MULTI:\n+                case Fragment::AFTER:\n+                case Fragment::OLDER:\n+                case Fragment::HASH256:\n+                case Fragment::HASH160:\n+                case Fragment::SHA256:\n+                case Fragment::RIPEMD160:\n+                    return bool{fn(node)};\n+                case Fragment::ANDOR:\n+                    return (subs[0] && subs[1]) || subs[2];\n+                case Fragment::AND_V:\n+                case Fragment::AND_B:\n+                    return subs[0] && subs[1];\n+                case Fragment::OR_B:\n+                case Fragment::OR_C:\n+                case Fragment::OR_D:\n+                case Fragment::OR_I:\n+                    return subs[0] || subs[1];\n+                case Fragment::THRESH:\n+                    return std::count(subs.begin(), subs.end(), true) >= node.k;\n+                default: // wrappers\n+                    assert(subs.size() == 1);\n+                    return !!subs[0];",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1088131573",
      "id" : 1088131573,
      "in_reply_to_id" : 923792873,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585A25H1",
      "original_commit_id" : "3bedfb5b13e863508cb9b0d44fa03cc991151927",
      "original_line" : 1152,
      "original_position" : 298,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : null,
      "pull_request_review_id" : 1271469794,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1088131573/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-26T17:19:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1088131573",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks @sipa for the review and @benma for having a look. I addressed your comments in the latest push.",
      "created_at" : "2023-01-26T18:52:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#issuecomment-1405452971",
      "id" : 1405452971,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24149",
      "node_id" : "IC_kwDOABII585TxYKr",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1405452971/reactions"
      },
      "updated_at" : "2023-02-11T15:52:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1405452971",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1088226950"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1088226950"
         }
      },
      "author_association" : "MEMBER",
      "body" : "My intuitive reading was just that the old code effectively says \"unless doing multisig, just wipe whatever we have as partial solving data and start over using miniscript logic\", which may make someone wonder if truly nothing except multisig will have some important output we shouldn't delete.\r\n\r\nThe code I suggested instead conveys \"only try miniscript if we don't already have any signing output\" which doesn't require the reader to know that only multisig actually produces non-final partial solving data.",
      "commit_id" : "33d30d1edd85a0110cbd9e3e29cc832f1cb6dab2",
      "created_at" : "2023-01-26T18:55:49Z",
      "diff_hunk" : "@@ -416,9 +484,21 @@ bool ProduceSignature(const SigningProvider& provider, const BaseSignatureCreato\n     {\n         CScript witnessscript(result[0].begin(), result[0].end());\n         sigdata.witness_script = witnessscript;\n-        TxoutType subType;\n+\n+        TxoutType subType{TxoutType::NONSTANDARD};\n         solved = solved && SignStep(provider, creator, witnessscript, result, subType, SigVersion::WITNESS_V0, sigdata) && subType != TxoutType::SCRIPTHASH && subType != TxoutType::WITNESS_V0_SCRIPTHASH && subType != TxoutType::WITNESS_V0_KEYHASH;\n+\n+        // Don't try to satisfy using Miniscript if it was a multisig as it would have already been handled by\n+        // SignStep, which appends partial signatures to the witness stack and we must not temper with to keep\n+        // compatibility with the extractor relying on this behaviour to combine witnesses.\n+        if (!solved && subType != TxoutType::MULTISIG) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1088226950",
      "id" : 1088226950,
      "in_reply_to_id" : 1080534576,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585A3QaG",
      "original_commit_id" : "6503ece5fda960cbfd8cfa76d7891f7cd0faa5a8",
      "original_line" : 494,
      "original_position" : 94,
      "original_start_line" : null,
      "path" : "src/script/sign.cpp",
      "position" : null,
      "pull_request_review_id" : 1271609688,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1088226950/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-26T18:55:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1088226950",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1088228910"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1088228910"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Makes sense.",
      "commit_id" : "33d30d1edd85a0110cbd9e3e29cc832f1cb6dab2",
      "created_at" : "2023-01-26T18:57:18Z",
      "diff_hunk" : "@@ -416,9 +484,21 @@ bool ProduceSignature(const SigningProvider& provider, const BaseSignatureCreato\n     {\n         CScript witnessscript(result[0].begin(), result[0].end());\n         sigdata.witness_script = witnessscript;\n-        TxoutType subType;\n+\n+        TxoutType subType{TxoutType::NONSTANDARD};\n         solved = solved && SignStep(provider, creator, witnessscript, result, subType, SigVersion::WITNESS_V0, sigdata) && subType != TxoutType::SCRIPTHASH && subType != TxoutType::WITNESS_V0_SCRIPTHASH && subType != TxoutType::WITNESS_V0_KEYHASH;\n+\n+        // Don't try to satisfy using Miniscript if it was a multisig as it would have already been handled by\n+        // SignStep, which appends partial signatures to the witness stack and we must not temper with to keep\n+        // compatibility with the extractor relying on this behaviour to combine witnesses.\n+        if (!solved && subType != TxoutType::MULTISIG) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1088228910",
      "id" : 1088228910,
      "in_reply_to_id" : 1080534576,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585A3Q4u",
      "original_commit_id" : "6503ece5fda960cbfd8cfa76d7891f7cd0faa5a8",
      "original_line" : 494,
      "original_position" : 94,
      "original_start_line" : null,
      "path" : "src/script/sign.cpp",
      "position" : null,
      "pull_request_review_id" : 1271611565,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1088228910/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-26T18:57:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1088228910",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "light ACK 33d30d1edd85a0110cbd9e3e29cc832f1cb6dab2\r\n\r\nThe satisfaction code looks good to me, as do the fixed tests. I didn't delve too deeply into the fuzz and random tests though.",
      "created_at" : "2023-02-03T19:53:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#issuecomment-1416334727",
      "id" : 1416334727,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24149",
      "node_id" : "IC_kwDOABII585Ua42H",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1416334727/reactions"
      },
      "updated_at" : "2023-02-03T19:53:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1416334727",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1097609192"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1097609192"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can this link an open issue describing what exactly is left to be done to support it?",
      "commit_id" : "3c6e3e01ef2bf3ede7ecce198b9052f5262e8eca",
      "created_at" : "2023-02-06T16:18:22Z",
      "diff_hunk" : "@@ -20,6 +20,39 @@\n     \"or_i(and_b(pk(029ffbe722b147f3035c87cb1c60b9a5947dd49c774cc31e94773478711a929ac0),a:and_b(pk(025f05815e3a1a8a83bfbb03ce016c9a2ee31066b98f567f6227df1d76ec4bd143),a:and_b(pk(025625f41e4a065efc06d5019cbbd56fe8c07595af1231e7cbc03fafb87ebb71ec),a:and_b(pk(02a27c8b850a00f67da3499b60562673dcf5fdfb82b7e17652a7ac54416812aefd),s:pk(03e618ec5f384d6e19ca9ebdb8e2119e5bef978285076828ce054e55c4daf473e2))))),and_v(v:thresh(2,pkh(tpubD6NzVbkrYhZ4YK67cd5fDe4fBVmGB2waTDrAt1q4ey9HPq9veHjWkw3VpbaCHCcWozjkhgAkWpFrxuPMUrmXVrLHMfEJ9auoZA6AS1g3grC/*),a:pkh(033841045a531e1adf9910a6ec279589a90b3b8a904ee64ffd692bd08a8996c1aa),a:pkh(02aebf2d10b040eb936a6f02f44ee82f8b34f5c1ccb20ff3949c2b28206b7c1068)),older(4209713)))\",\n ]\n \n+MINISCRIPTS_PRIV = [\n+    # One of two keys, of which one private key is known\n+    {\n+        \"ms\": \"or_i(pk(tprv8ZgxMBicQKsPerQj6m35no46amfKQdjY7AhLnmatHYXs8S4MTgeZYkWAn4edSGwwL3vkSiiGqSZQrmy5D3P5gBoqgvYP2fCUpBwbKTMTAkL/*),pk(tpubD6NzVbkrYhZ4YPAbyf6urxqqnmJF79PzQtyERAmvkSVS9fweCTjxjDh22Z5St9fGb1a5DUCv8G27nYupKP1Ctr1pkamJossoetzws1moNRn/*))\",\n+        \"sequence\": None,\n+        \"locktime\": None,\n+    },\n+    # A more complex policy, that can't be satisfied through the first branch (need for a preimage)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1097609192",
      "id" : 1097609192,
      "line" : 56,
      "node_id" : "PRRC_kwDOABII585BbC_o",
      "original_commit_id" : "6f781a0be869aefbe31e48c44fdf9ac0e6238fb3",
      "original_line" : 56,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "test/functional/wallet_miniscript.py",
      "position" : 56,
      "pull_request_review_id" : 1285541393,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1097609192/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-06T17:54:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1097609192",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1097632933"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1097632933"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe have lists with all the tprv/tpub/pk and insert them directly into the strings? Could make these easier to read and easier to write more in the future with less copy/paste/accidental key publication\r\n\r\ne.g. I wanted to add the liquid style backoff key examples\r\n\r\n```\r\ntprv1 = \"tprv8ZgxMBicQKsPerQj6m35no46amfKQdjY7AhLnmatHYXs8S4MTgeZYkWAn4edSGwwL3vkSiiGqSZQrmy5D3P5gBoqgvYP2fCUpBwbKTMTAkL/*\"\r\ntprv2 = \"tprv8ZgxMBicQKsPd3cbrKjE5GKKJLDEidhtzSSmPVtSPyoHQGL2LZw49yt9foZsN9BeiC5VqRaESUSDV2PS9w7zAVBSK6EQH3CZW9sMKxSKDwD/*\"\r\ntpubs = [\"tpubD6NzVbkrYhZ4YPAbyf6urxqqnmJF79PzQtyERAmvkSVS9fweCTjxjDh22Z5St9fGb1a5DUCv8G27nYupKP1Ctr1pkamJossoetzws1moNRn\",\r\n    \"tpubD6NzVbkrYhZ4YMQC15JS7QcrsAyfGrGiykweqMmPxTkEVScu7vCZLNpPXW1XphHwzsgmqdHWDQAfucbM72EEB1ZEyfgZxYvkZjYVXx1xS9p\",\r\n    \"tpubD6NzVbkrYhZ4YU9vM1s53UhD75UyJatx8EMzMZ3VUjR2FciNfLLkAw6a4pWACChzobTseNqdWk4G7ZdBqRDLtLSACKykTScmqibb1ZrCvJu\",\r\n    \"tpubD6NzVbkrYhZ4XRMcMFMMFvzVt6jaDAtjZhD7JLwdPdMm9xa76DnxYYP7w9TZGJDVFkek3ArwVsuacheqqPog8TH5iBCX1wuig8PLXim4n9a\",\r\n    \"tpubD6NzVbkrYhZ4WsqRzDmkL82SWcu42JzUvKWzrJHQ8EC2vEHRHkXj1De93sD3biLrKd8XGnamXURGjMbYavbszVDXpjXV2cGUERucLJkE6cy\"]\r\npk = \"02aebf2d10b040eb936a6f02f44ee82f8b34f5c1ccb20ff3949c2b28206b7c1068\"\r\n\r\nMINISCRIPTS_PRIV = [\r\n    # Liquid-like federated pegin with emergency recovery privkeys\r\n    {\r\n        \"ms\": f\"or_i(and_b(pk({tpubs[0]}),a:and_b(pk({tpubs[1]}),a:and_b(pk({tpubs[2]}),a:and_b(pk({tpubs[3]}),s:pk({pk}))))),and_v(v:thresh(2,pkh({tprv1}),a:pkh({tprv2}),a:pkh({tpubs[4]})),older(420)))\",\r\n        \"sequence\": 420,\r\n        \"locktime\": None,\r\n    },\r\n```",
      "commit_id" : "3c6e3e01ef2bf3ede7ecce198b9052f5262e8eca",
      "created_at" : "2023-02-06T16:38:04Z",
      "diff_hunk" : "@@ -20,6 +20,39 @@\n     \"or_i(and_b(pk(029ffbe722b147f3035c87cb1c60b9a5947dd49c774cc31e94773478711a929ac0),a:and_b(pk(025f05815e3a1a8a83bfbb03ce016c9a2ee31066b98f567f6227df1d76ec4bd143),a:and_b(pk(025625f41e4a065efc06d5019cbbd56fe8c07595af1231e7cbc03fafb87ebb71ec),a:and_b(pk(02a27c8b850a00f67da3499b60562673dcf5fdfb82b7e17652a7ac54416812aefd),s:pk(03e618ec5f384d6e19ca9ebdb8e2119e5bef978285076828ce054e55c4daf473e2))))),and_v(v:thresh(2,pkh(tpubD6NzVbkrYhZ4YK67cd5fDe4fBVmGB2waTDrAt1q4ey9HPq9veHjWkw3VpbaCHCcWozjkhgAkWpFrxuPMUrmXVrLHMfEJ9auoZA6AS1g3grC/*),a:pkh(033841045a531e1adf9910a6ec279589a90b3b8a904ee64ffd692bd08a8996c1aa),a:pkh(02aebf2d10b040eb936a6f02f44ee82f8b34f5c1ccb20ff3949c2b28206b7c1068)),older(4209713)))\",\n ]\n \n+MINISCRIPTS_PRIV = [\n+    # One of two keys, of which one private key is known\n+    {\n+        \"ms\": \"or_i(pk(tprv8ZgxMBicQKsPerQj6m35no46amfKQdjY7AhLnmatHYXs8S4MTgeZYkWAn4edSGwwL3vkSiiGqSZQrmy5D3P5gBoqgvYP2fCUpBwbKTMTAkL/*),pk(tpubD6NzVbkrYhZ4YPAbyf6urxqqnmJF79PzQtyERAmvkSVS9fweCTjxjDh22Z5St9fGb1a5DUCv8G27nYupKP1Ctr1pkamJossoetzws1moNRn/*))\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1097632933",
      "id" : 1097632933,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585BbIyl",
      "original_commit_id" : "6f781a0be869aefbe31e48c44fdf9ac0e6238fb3",
      "original_line" : 26,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "test/functional/wallet_miniscript.py",
      "position" : null,
      "pull_request_review_id" : 1285541393,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1097632933/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-06T17:54:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1097632933",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've created a few commits in https://github.com/sipa/bitcoin/commits/202302_miniscript_improve. They're a bunch of small improvements that address some things @darosior and @benma noticed. No behavior changes that matter, but I hope it's closer to the website, and more easy to follow. Feel free to include, ignore, or squash (not all of it necessarily belongs in this PR).",
      "created_at" : "2023-02-09T15:27:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#issuecomment-1424369931",
      "id" : 1424369931,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24149",
      "node_id" : "IC_kwDOABII585U5ikL",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1424369931/reactions"
      },
      "updated_at" : "2023-02-09T15:27:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1424369931",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@instagibbs thanks for the suggestions and the examples. This functional test was clearly lacking imagination. :) However what you suggest is already thoroughly tested by the unit tests (and to a lesser extent by the fuzz tests). But it's inexpensive to test also in the functional test so i included your examples and added a couple more things to test for each descriptor: the number of signatures expected (always equal to the number of private keys we have in the descriptor), whether this \"completes\" the transaction or not, and the expected witness stack size of the satisfaction (to assert we used the expected satisfaction path).\r\n\r\n@sipa thanks, i think it'll be helpful to reviewers now and to future readers. I squashed [Simplify InputStack constructor calls](https://github.com/sipa/bitcoin/commit/69b1a492c2c2acc70edbf9abe8d433d3d708211f) into the first commit of this PR. I cherry-picked all your commits adding comments and explanations about the satisfaction logic, that i squashed in a single documentation commit (now the second commit of this PR). I was going to say the two commits aligning the properties with the website belong in another PR.. But it's a tiny diff and the `e` property is related to signing, so i just cherry-picked them as well (squashed in one commit).",
      "created_at" : "2023-02-11T13:16:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#issuecomment-1426765831",
      "id" : 1426765831,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24149",
      "node_id" : "IC_kwDOABII585VCrgH",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1426765831/reactions"
      },
      "updated_at" : "2023-02-11T13:16:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1426765831",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1103625462"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1103625462"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Initially i wanted to tackle all the PSBT integration in a followup (see https://github.com/bitcoin/bitcoin/pull/24149#issuecomment-1046944178). This comment made me (finally) have a look at what should be done. I think `analyzepsbt`, `utxoupdatepsbt` would need to be updated to support hash preimages. Maybe `walletprocesspsbt` too, but i'm not sure yet (for instance hash preimages could be imported separately and kept in a signing provider?). However i think we should first make those commands not rely on a dry run of the signer anymore (Similarly to what i do in https://github.com/bitcoin/bitcoin/pull/26567 with the input size estimation).\r\n\r\nGiven this followup would be blocked by preparatory work and since the the patch for supporting the preimages provided directly in the PSBT by external software is trivial (basically @achow101's patch from above https://github.com/bitcoin/bitcoin/pull/24149#pullrequestreview-882103227), i added a commit that implements it and tests satisfying using a path with a preimage check.",
      "commit_id" : "3c6e3e01ef2bf3ede7ecce198b9052f5262e8eca",
      "created_at" : "2023-02-11T13:16:06Z",
      "diff_hunk" : "@@ -20,6 +20,39 @@\n     \"or_i(and_b(pk(029ffbe722b147f3035c87cb1c60b9a5947dd49c774cc31e94773478711a929ac0),a:and_b(pk(025f05815e3a1a8a83bfbb03ce016c9a2ee31066b98f567f6227df1d76ec4bd143),a:and_b(pk(025625f41e4a065efc06d5019cbbd56fe8c07595af1231e7cbc03fafb87ebb71ec),a:and_b(pk(02a27c8b850a00f67da3499b60562673dcf5fdfb82b7e17652a7ac54416812aefd),s:pk(03e618ec5f384d6e19ca9ebdb8e2119e5bef978285076828ce054e55c4daf473e2))))),and_v(v:thresh(2,pkh(tpubD6NzVbkrYhZ4YK67cd5fDe4fBVmGB2waTDrAt1q4ey9HPq9veHjWkw3VpbaCHCcWozjkhgAkWpFrxuPMUrmXVrLHMfEJ9auoZA6AS1g3grC/*),a:pkh(033841045a531e1adf9910a6ec279589a90b3b8a904ee64ffd692bd08a8996c1aa),a:pkh(02aebf2d10b040eb936a6f02f44ee82f8b34f5c1ccb20ff3949c2b28206b7c1068)),older(4209713)))\",\n ]\n \n+MINISCRIPTS_PRIV = [\n+    # One of two keys, of which one private key is known\n+    {\n+        \"ms\": \"or_i(pk(tprv8ZgxMBicQKsPerQj6m35no46amfKQdjY7AhLnmatHYXs8S4MTgeZYkWAn4edSGwwL3vkSiiGqSZQrmy5D3P5gBoqgvYP2fCUpBwbKTMTAkL/*),pk(tpubD6NzVbkrYhZ4YPAbyf6urxqqnmJF79PzQtyERAmvkSVS9fweCTjxjDh22Z5St9fGb1a5DUCv8G27nYupKP1Ctr1pkamJossoetzws1moNRn/*))\",\n+        \"sequence\": None,\n+        \"locktime\": None,\n+    },\n+    # A more complex policy, that can't be satisfied through the first branch (need for a preimage)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1103625462",
      "id" : 1103625462,
      "in_reply_to_id" : 1097609192,
      "line" : 56,
      "node_id" : "PRRC_kwDOABII585Bx_z2",
      "original_commit_id" : "6f781a0be869aefbe31e48c44fdf9ac0e6238fb3",
      "original_line" : 56,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "test/functional/wallet_miniscript.py",
      "position" : 56,
      "pull_request_review_id" : 1294529799,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1103625462/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-11T13:16:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1103625462",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1103625470"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1103625470"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done. I added a refactoring commit to update the watchonly descriptors, and then use the keys list in the signing test too.",
      "commit_id" : "3c6e3e01ef2bf3ede7ecce198b9052f5262e8eca",
      "created_at" : "2023-02-11T13:16:09Z",
      "diff_hunk" : "@@ -20,6 +20,39 @@\n     \"or_i(and_b(pk(029ffbe722b147f3035c87cb1c60b9a5947dd49c774cc31e94773478711a929ac0),a:and_b(pk(025f05815e3a1a8a83bfbb03ce016c9a2ee31066b98f567f6227df1d76ec4bd143),a:and_b(pk(025625f41e4a065efc06d5019cbbd56fe8c07595af1231e7cbc03fafb87ebb71ec),a:and_b(pk(02a27c8b850a00f67da3499b60562673dcf5fdfb82b7e17652a7ac54416812aefd),s:pk(03e618ec5f384d6e19ca9ebdb8e2119e5bef978285076828ce054e55c4daf473e2))))),and_v(v:thresh(2,pkh(tpubD6NzVbkrYhZ4YK67cd5fDe4fBVmGB2waTDrAt1q4ey9HPq9veHjWkw3VpbaCHCcWozjkhgAkWpFrxuPMUrmXVrLHMfEJ9auoZA6AS1g3grC/*),a:pkh(033841045a531e1adf9910a6ec279589a90b3b8a904ee64ffd692bd08a8996c1aa),a:pkh(02aebf2d10b040eb936a6f02f44ee82f8b34f5c1ccb20ff3949c2b28206b7c1068)),older(4209713)))\",\n ]\n \n+MINISCRIPTS_PRIV = [\n+    # One of two keys, of which one private key is known\n+    {\n+        \"ms\": \"or_i(pk(tprv8ZgxMBicQKsPerQj6m35no46amfKQdjY7AhLnmatHYXs8S4MTgeZYkWAn4edSGwwL3vkSiiGqSZQrmy5D3P5gBoqgvYP2fCUpBwbKTMTAkL/*),pk(tpubD6NzVbkrYhZ4YPAbyf6urxqqnmJF79PzQtyERAmvkSVS9fweCTjxjDh22Z5St9fGb1a5DUCv8G27nYupKP1Ctr1pkamJossoetzws1moNRn/*))\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1103625470",
      "id" : 1103625470,
      "in_reply_to_id" : 1097632933,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Bx_z-",
      "original_commit_id" : "6f781a0be869aefbe31e48c44fdf9ac0e6238fb3",
      "original_line" : 26,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "test/functional/wallet_miniscript.py",
      "position" : null,
      "pull_request_review_id" : 1294529810,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1103625470/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-11T13:16:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1103625470",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1104552550"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1104552550"
         }
      },
      "author_association" : "MEMBER",
      "body" : "comment above should be updated I think:\r\n\r\n\"# Test we can sign most Miniscript (all but ones requiring preimages, for now)\"",
      "commit_id" : "6c7a17a8e0eec377f83ed1399f003ae70b898270",
      "created_at" : "2023-02-13T14:34:23Z",
      "diff_hunk" : "@@ -266,6 +286,7 @@ def run_test(self):\n                 ms[\"locktime\"],\n                 ms[\"sigs_count\"],\n                 ms[\"stack_size\"],\n+                ms.get(\"sha256_preimages\"),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1104552550",
      "id" : 1104552550,
      "line" : 289,
      "node_id" : "PRRC_kwDOABII585B1iJm",
      "original_commit_id" : "36478ac00ef0a82a82052032e68d513a92ea38b8",
      "original_line" : 289,
      "original_position" : 54,
      "original_start_line" : null,
      "path" : "test/functional/wallet_miniscript.py",
      "position" : 242,
      "pull_request_review_id" : 1295765939,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1104552550/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-13T14:36:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1104552550",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1104560393"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1104560393"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, updated.",
      "commit_id" : "6c7a17a8e0eec377f83ed1399f003ae70b898270",
      "created_at" : "2023-02-13T14:40:09Z",
      "diff_hunk" : "@@ -266,6 +286,7 @@ def run_test(self):\n                 ms[\"locktime\"],\n                 ms[\"sigs_count\"],\n                 ms[\"stack_size\"],\n+                ms.get(\"sha256_preimages\"),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1104560393",
      "id" : 1104560393,
      "in_reply_to_id" : 1104552550,
      "line" : 289,
      "node_id" : "PRRC_kwDOABII585B1kEJ",
      "original_commit_id" : "36478ac00ef0a82a82052032e68d513a92ea38b8",
      "original_line" : 289,
      "original_position" : 54,
      "original_start_line" : null,
      "path" : "test/functional/wallet_miniscript.py",
      "position" : 242,
      "pull_request_review_id" : 1295777966,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1104560393/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-13T14:40:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1104560393",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1105008572"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1105008572"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Given the need for all these dummy `SignatureData` objects that need to be created in calls, would it make sense to add another overload of `SignSignature` that has no `SignaturaData&` argument?",
      "commit_id" : "6c7a17a8e0eec377f83ed1399f003ae70b898270",
      "created_at" : "2023-02-13T20:58:06Z",
      "diff_hunk" : "@@ -108,7 +109,8 @@ BOOST_AUTO_TEST_CASE(DoS_mapOrphans)\n             tx.vin[j].prevout.n = j;\n             tx.vin[j].prevout.hash = txPrev->GetHash();\n         }\n-        BOOST_CHECK(SignSignature(keystore, *txPrev, tx, 0, SIGHASH_ALL));\n+        SignatureData empty;\n+        BOOST_CHECK(SignSignature(keystore, *txPrev, tx, 0, SIGHASH_ALL, empty));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1105008572",
      "id" : 1105008572,
      "line" : 113,
      "node_id" : "PRRC_kwDOABII585B3Re8",
      "original_commit_id" : "560e62b1e221832ae99ff8684559a7b8f9df84a7",
      "original_line" : 113,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/test/orphanage_tests.cpp",
      "position" : 16,
      "pull_request_review_id" : 1296428327,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1105008572/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-13T21:06:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1105008572",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1105320169"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1105320169"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Will do if i need to retouch.",
      "commit_id" : "6c7a17a8e0eec377f83ed1399f003ae70b898270",
      "created_at" : "2023-02-14T05:47:30Z",
      "diff_hunk" : "@@ -108,7 +109,8 @@ BOOST_AUTO_TEST_CASE(DoS_mapOrphans)\n             tx.vin[j].prevout.n = j;\n             tx.vin[j].prevout.hash = txPrev->GetHash();\n         }\n-        BOOST_CHECK(SignSignature(keystore, *txPrev, tx, 0, SIGHASH_ALL));\n+        SignatureData empty;\n+        BOOST_CHECK(SignSignature(keystore, *txPrev, tx, 0, SIGHASH_ALL, empty));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1105320169",
      "id" : 1105320169,
      "in_reply_to_id" : 1105008572,
      "line" : 113,
      "node_id" : "PRRC_kwDOABII585B4djp",
      "original_commit_id" : "560e62b1e221832ae99ff8684559a7b8f9df84a7",
      "original_line" : 113,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/test/orphanage_tests.cpp",
      "position" : 16,
      "pull_request_review_id" : 1296869578,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1105320169/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-14T05:47:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1105320169",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 6c7a17a8e0eec377f83ed1399f003ae70b898270\r\n\r\nReviewed code and non-fuzz tests.",
      "created_at" : "2023-02-14T21:30:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#issuecomment-1430404755",
      "id" : 1430404755,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24149",
      "node_id" : "IC_kwDOABII585VQj6T",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1430404755/reactions"
      },
      "updated_at" : "2023-02-14T21:30:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1430404755",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@darosior do I understand correctly that you need #26567 in order for [PSBT stuff](https://github.com/bitcoin/bitcoin/pull/24149#issuecomment-1183382594) to work? Can I just combine both PR's to continue the test I was doing, or are there more changes required?",
      "created_at" : "2023-02-15T10:33:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#issuecomment-1431108853",
      "id" : 1431108853,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24149",
      "node_id" : "IC_kwDOABII585VTPz1",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1431108853/reactions"
      },
      "updated_at" : "2023-02-15T10:33:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1431108853",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@Sjors see https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1103625462. A minimal PSBT integration is part of this PR now. We treat Miniscript-related data when we are given a PSBT. However to fill Miniscript-related data to a PSBT from our wallet will need more work than just #26567, and also some design decisions to be taken.",
      "created_at" : "2023-02-15T10:39:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#issuecomment-1431118379",
      "id" : 1431118379,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24149",
      "node_id" : "IC_kwDOABII585VTSIr",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1431118379/reactions"
      },
      "updated_at" : "2023-02-15T10:39:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1431118379",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1109650266"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1109650266"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Hmm looks like this checks for duplicate keys on every single node created whereas we could just check that on the top-level node in `GenNode()`?",
      "commit_id" : "6c7a17a8e0eec377f83ed1399f003ae70b898270",
      "created_at" : "2023-02-17T11:14:25Z",
      "diff_hunk" : "@@ -130,6 +174,732 @@ struct ScriptParserContext {\n     }\n } SCRIPT_PARSER_CONTEXT;\n \n+//! Context to produce a satisfaction for a Miniscript node using the pre-computed data.\n+struct SatisfierContext: ParserContext {\n+    // Timelock challenges satisfaction. Make the value (deterministically) vary to explore different\n+    // paths.\n+    bool CheckAfter(uint32_t value) const { return value % 2; }\n+    bool CheckOlder(uint32_t value) const { return value % 2; }\n+\n+    // Signature challenges fulfilled with a dummy signature, if it was one of our dummy keys.\n+    miniscript::Availability Sign(const CPubKey& key, std::vector<unsigned char>& sig) const {\n+        const auto it = TEST_DATA.dummy_sigs.find(key);\n+        if (it == TEST_DATA.dummy_sigs.end()) return miniscript::Availability::NO;\n+        if (it->second.second) {\n+            // Key is \"available\"\n+            sig = it->second.first;\n+            return miniscript::Availability::YES;\n+        } else {\n+            return miniscript::Availability::NO;\n+        }\n+    }\n+\n+    //! Lookup generalization for all the hash satisfactions below\n+    miniscript::Availability LookupHash(const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage,\n+                                        const std::map<std::vector<unsigned char>, std::vector<unsigned char>>& map) const\n+    {\n+        const auto it = map.find(hash);\n+        if (it == map.end()) return miniscript::Availability::NO;\n+        preimage = it->second;\n+        return miniscript::Availability::YES;\n+    }\n+    miniscript::Availability SatSHA256(const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage) const {\n+        return LookupHash(hash, preimage, TEST_DATA.sha256_preimages);\n+    }\n+    miniscript::Availability SatRIPEMD160(const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage) const {\n+        return LookupHash(hash, preimage, TEST_DATA.ripemd160_preimages);\n+    }\n+    miniscript::Availability SatHASH256(const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage) const {\n+        return LookupHash(hash, preimage, TEST_DATA.hash256_preimages);\n+    }\n+    miniscript::Availability SatHASH160(const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage) const {\n+        return LookupHash(hash, preimage, TEST_DATA.hash160_preimages);\n+    }\n+} SATISFIER_CTX;\n+\n+//! Context to check a satisfaction against the pre-computed data.\n+struct CheckerContext: BaseSignatureChecker {\n+    TestData *test_data;\n+\n+    // Signature checker methods. Checks the right dummy signature is used.\n+    bool CheckECDSASignature(const std::vector<unsigned char>& sig, const std::vector<unsigned char>& vchPubKey,\n+                             const CScript& scriptCode, SigVersion sigversion) const override\n+    {\n+        const CPubKey key{vchPubKey};\n+        const auto it = TEST_DATA.dummy_sigs.find(key);\n+        if (it == TEST_DATA.dummy_sigs.end()) return false;\n+        return it->second.first == sig;\n+    }\n+    bool CheckLockTime(const CScriptNum& nLockTime) const override { return nLockTime.GetInt64() & 1; }\n+    bool CheckSequence(const CScriptNum& nSequence) const override { return nSequence.GetInt64() & 1; }\n+} CHECKER_CTX;\n+\n+//! Context to check for duplicates when instancing a Node.\n+struct KeyComparator {\n+    bool KeyCompare(const CPubKey& a, const CPubKey& b) const {\n+        return a < b;\n+    }\n+} KEY_COMP;\n+\n+// A dummy scriptsig to pass to VerifyScript (we always use Segwit v0).\n+const CScript DUMMY_SCRIPTSIG;\n+\n+using Fragment = miniscript::Fragment;\n+using NodeRef = miniscript::NodeRef<CPubKey>;\n+using Node = miniscript::Node<CPubKey>;\n+using Type = miniscript::Type;\n+// https://github.com/llvm/llvm-project/issues/53444\n+// NOLINTNEXTLINE(misc-unused-using-decls)\n+using miniscript::operator\"\" _mst;\n+\n+//! Construct a miniscript node as a shared_ptr.\n+template<typename... Args> NodeRef MakeNodeRef(Args&&... args) { return miniscript::MakeNodeRef<CPubKey>(KEY_COMP, std::forward<Args>(args)...); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1109650266",
      "id" : 1109650266,
      "line" : 256,
      "node_id" : "PRRC_kwDOABII585CI-ta",
      "original_commit_id" : "6c7a17a8e0eec377f83ed1399f003ae70b898270",
      "original_line" : 256,
      "original_position" : 167,
      "original_start_line" : null,
      "path" : "src/test/fuzz/miniscript.cpp",
      "position" : 167,
      "pull_request_review_id" : 1303201964,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1109650266/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-17T11:14:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1109650266",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1109682908"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1109682908"
         }
      },
      "author_association" : "MEMBER",
      "body" : "https://github.com/bitcoin/bitcoin/pull/27117",
      "commit_id" : "6c7a17a8e0eec377f83ed1399f003ae70b898270",
      "created_at" : "2023-02-17T11:43:08Z",
      "diff_hunk" : "@@ -130,6 +174,732 @@ struct ScriptParserContext {\n     }\n } SCRIPT_PARSER_CONTEXT;\n \n+//! Context to produce a satisfaction for a Miniscript node using the pre-computed data.\n+struct SatisfierContext: ParserContext {\n+    // Timelock challenges satisfaction. Make the value (deterministically) vary to explore different\n+    // paths.\n+    bool CheckAfter(uint32_t value) const { return value % 2; }\n+    bool CheckOlder(uint32_t value) const { return value % 2; }\n+\n+    // Signature challenges fulfilled with a dummy signature, if it was one of our dummy keys.\n+    miniscript::Availability Sign(const CPubKey& key, std::vector<unsigned char>& sig) const {\n+        const auto it = TEST_DATA.dummy_sigs.find(key);\n+        if (it == TEST_DATA.dummy_sigs.end()) return miniscript::Availability::NO;\n+        if (it->second.second) {\n+            // Key is \"available\"\n+            sig = it->second.first;\n+            return miniscript::Availability::YES;\n+        } else {\n+            return miniscript::Availability::NO;\n+        }\n+    }\n+\n+    //! Lookup generalization for all the hash satisfactions below\n+    miniscript::Availability LookupHash(const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage,\n+                                        const std::map<std::vector<unsigned char>, std::vector<unsigned char>>& map) const\n+    {\n+        const auto it = map.find(hash);\n+        if (it == map.end()) return miniscript::Availability::NO;\n+        preimage = it->second;\n+        return miniscript::Availability::YES;\n+    }\n+    miniscript::Availability SatSHA256(const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage) const {\n+        return LookupHash(hash, preimage, TEST_DATA.sha256_preimages);\n+    }\n+    miniscript::Availability SatRIPEMD160(const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage) const {\n+        return LookupHash(hash, preimage, TEST_DATA.ripemd160_preimages);\n+    }\n+    miniscript::Availability SatHASH256(const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage) const {\n+        return LookupHash(hash, preimage, TEST_DATA.hash256_preimages);\n+    }\n+    miniscript::Availability SatHASH160(const std::vector<unsigned char>& hash, std::vector<unsigned char>& preimage) const {\n+        return LookupHash(hash, preimage, TEST_DATA.hash160_preimages);\n+    }\n+} SATISFIER_CTX;\n+\n+//! Context to check a satisfaction against the pre-computed data.\n+struct CheckerContext: BaseSignatureChecker {\n+    TestData *test_data;\n+\n+    // Signature checker methods. Checks the right dummy signature is used.\n+    bool CheckECDSASignature(const std::vector<unsigned char>& sig, const std::vector<unsigned char>& vchPubKey,\n+                             const CScript& scriptCode, SigVersion sigversion) const override\n+    {\n+        const CPubKey key{vchPubKey};\n+        const auto it = TEST_DATA.dummy_sigs.find(key);\n+        if (it == TEST_DATA.dummy_sigs.end()) return false;\n+        return it->second.first == sig;\n+    }\n+    bool CheckLockTime(const CScriptNum& nLockTime) const override { return nLockTime.GetInt64() & 1; }\n+    bool CheckSequence(const CScriptNum& nSequence) const override { return nSequence.GetInt64() & 1; }\n+} CHECKER_CTX;\n+\n+//! Context to check for duplicates when instancing a Node.\n+struct KeyComparator {\n+    bool KeyCompare(const CPubKey& a, const CPubKey& b) const {\n+        return a < b;\n+    }\n+} KEY_COMP;\n+\n+// A dummy scriptsig to pass to VerifyScript (we always use Segwit v0).\n+const CScript DUMMY_SCRIPTSIG;\n+\n+using Fragment = miniscript::Fragment;\n+using NodeRef = miniscript::NodeRef<CPubKey>;\n+using Node = miniscript::Node<CPubKey>;\n+using Type = miniscript::Type;\n+// https://github.com/llvm/llvm-project/issues/53444\n+// NOLINTNEXTLINE(misc-unused-using-decls)\n+using miniscript::operator\"\" _mst;\n+\n+//! Construct a miniscript node as a shared_ptr.\n+template<typename... Args> NodeRef MakeNodeRef(Args&&... args) { return miniscript::MakeNodeRef<CPubKey>(KEY_COMP, std::forward<Args>(args)...); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24149#discussion_r1109682908",
      "id" : 1109682908,
      "in_reply_to_id" : 1109650266,
      "line" : 256,
      "node_id" : "PRRC_kwDOABII585CJGrc",
      "original_commit_id" : "6c7a17a8e0eec377f83ed1399f003ae70b898270",
      "original_line" : 256,
      "original_position" : 167,
      "original_start_line" : null,
      "path" : "src/test/fuzz/miniscript.cpp",
      "position" : 167,
      "pull_request_review_id" : 1303261603,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24149",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1109682908/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-17T11:43:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1109682908",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   }
]
