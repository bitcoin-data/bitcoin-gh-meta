[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#25540](https://github.com/bitcoin/bitcoin/pull/25540) (miniscript: avoid wasteful computation, prevent memory blowup when fuzzing by darosior)\n* [#24361](https://github.com/bitcoin/bitcoin/pull/24361) (Descriptor unit tests and simplifications by sipa)\n* [#23480](https://github.com/bitcoin/bitcoin/pull/23480) (Add rawtr() descriptor for P2TR with specified (tweaked) output key by sipa)\n* [#22838](https://github.com/bitcoin/bitcoin/pull/22838) (descriptors: Be able to specify change and receiving in a single descriptor string by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-01-26T00:22:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#issuecomment-1021733605",
      "id" : 1021733605,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24148",
      "node_id" : "IC_kwDOABII58485mrl",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1021733605/reactions"
      },
      "updated_at" : "2022-07-12T22:54:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1021733605",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-01-26T08:11:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#issuecomment-1021959898",
      "id" : 1021959898,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24148",
      "node_id" : "IC_kwDOABII58486d7a",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1021959898/reactions"
      },
      "updated_at" : "2022-01-26T08:11:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1021959898",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased.",
      "created_at" : "2022-02-11T12:06:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#issuecomment-1036147958",
      "id" : 1036147958,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24148",
      "node_id" : "IC_kwDOABII5849wlz2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1036147958/reactions"
      },
      "updated_at" : "2022-02-11T12:06:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1036147958",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-03-04T13:30:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#issuecomment-1059164190",
      "id" : 1059164190,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24148",
      "node_id" : "IC_kwDOABII584_IZAe",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1059164190/reactions"
      },
      "updated_at" : "2022-03-04T13:30:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1059164190",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased.",
      "created_at" : "2022-03-17T17:09:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#issuecomment-1071101724",
      "id" : 1071101724,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24148",
      "node_id" : "IC_kwDOABII584_17cc",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1071101724/reactions"
      },
      "updated_at" : "2022-03-17T17:09:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1071101724",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I (slightly) messed up the last rebase here, but there was some updates in the meantime so i'll push a fix along with those soon.",
      "created_at" : "2022-04-05T13:50:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#issuecomment-1088728549",
      "id" : 1088728549,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24148",
      "node_id" : "IC_kwDOABII585A5K3l",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1088728549/reactions"
      },
      "updated_at" : "2022-04-05T13:50:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1088728549",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased on top of #24860. I've made some cleanups and added more comments. I've also merged the unit tests of the Miniscript descriptors with the commit introducing the feature. I've changed the author of the commit to myself from Pieter as it was modified quite a lot from [his original one](https://github.com/bitcoin/bitcoin/pull/16800/commits/037e55adc005e9d8253d3d35e7a30b2e8521389c)  and i don't want to wrongly attribute him my own mistakes :p (of course, the co-author credits were switched accordingly).",
      "created_at" : "2022-04-20T12:37:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#issuecomment-1103883337",
      "id" : 1103883337,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24148",
      "node_id" : "IC_kwDOABII585By-xJ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1103883337/reactions"
      },
      "updated_at" : "2022-04-20T12:37:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1103883337",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Hmm, so the use of `uint32_t` as key types makes the check for duplicate keys void. I need to look into it.",
      "created_at" : "2022-05-16T13:05:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#issuecomment-1127647494",
      "id" : 1127647494,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24148",
      "node_id" : "IC_kwDOABII585DNokG",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1127647494/reactions"
      },
      "updated_at" : "2022-05-16T13:05:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1127647494",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@darosior Perhaps add an KeyCompare(Key, Key) function to contexts, and use that as set ordering in the duplicate check, rather than Key::operator< ?",
      "created_at" : "2022-05-16T13:19:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#issuecomment-1127664730",
      "id" : 1127664730,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24148",
      "node_id" : "IC_kwDOABII585DNsxa",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1127664730/reactions"
      },
      "updated_at" : "2022-05-16T13:19:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1127664730",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r881898835"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/881898835"
         }
      },
      "author_association" : "NONE",
      "body" : "Naming could be improved. The name `duplicate_key` might suggest that the variable holds the value or reference of the key that is duplicated, when in fact it can only hold either `true` or `false`âand there could be multiple duplicated keys. It'd be best to name this variable `has_duplicate_keys` instead, which would go nicely along the naming scheme of `IsNonMalleable` and `IsSane`.",
      "commit_id" : "ec72f351134bed229baaefc8ffaa1f72688c5435",
      "created_at" : "2022-05-25T16:53:02Z",
      "diff_hunk" : "@@ -298,6 +298,8 @@ struct Node {\n     const Type typ;\n     //! Cached script length (computed by CalcScriptLen).\n     const size_t scriptlen;\n+    //! Whether a public key appears more than once in this node.\n+    const bool duplicate_key;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r881898835",
      "id" : 881898835,
      "line" : 302,
      "node_id" : "PRRC_kwDOABII5840kLVT",
      "original_commit_id" : "22b2171c48b5cbb1f293182f25e24ed5a3939bc1",
      "original_line" : 302,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 5,
      "pull_request_review_id" : 985172194,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/881898835/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-25T16:53:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/881898835",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/84942996?v=4",
         "events_url" : "https://api.github.com/users/OliverOffing/events{/privacy}",
         "followers_url" : "https://api.github.com/users/OliverOffing/followers",
         "following_url" : "https://api.github.com/users/OliverOffing/following{/other_user}",
         "gists_url" : "https://api.github.com/users/OliverOffing/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/OliverOffing",
         "id" : 84942996,
         "login" : "OliverOffing",
         "node_id" : "MDQ6VXNlcjg0OTQyOTk2",
         "organizations_url" : "https://api.github.com/users/OliverOffing/orgs",
         "received_events_url" : "https://api.github.com/users/OliverOffing/received_events",
         "repos_url" : "https://api.github.com/users/OliverOffing/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/OliverOffing/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/OliverOffing/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/OliverOffing"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r882552673"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/882552673"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> The name duplicate_key might suggest that the variable holds the value or reference of the key that is duplicated, when in fact it can only hold either true or false\r\n\r\nI don't think it's worth making the variable name even longer. The `bool` type should be enough for one to get that this value holds, well, a boolean and not a reference to the key.\r\nAlso note this commit is part of https://github.com/bitcoin/bitcoin/pull/24860 which features a `ContainsDuplicateKey()` public API in the same spirit as `IsNonMalleable` and `IsSane`.\r\n\r\n> and there could be multiple duplicated keys\r\n\r\nThe detection algorithm cuts through and wouldn't know that, it just knows that \"there exists one duplicate key\".",
      "commit_id" : "1d145ec1e5b62d9b4385ca7a63fa468d6708fe46",
      "created_at" : "2022-05-26T10:56:52Z",
      "diff_hunk" : "@@ -298,6 +298,8 @@ struct Node {\n     const Type typ;\n     //! Cached script length (computed by CalcScriptLen).\n     const size_t scriptlen;\n+    //! Whether a public key appears more than once in this node.\n+    const bool duplicate_key;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r882552673",
      "id" : 882552673,
      "in_reply_to_id" : 881898835,
      "line" : 305,
      "node_id" : "PRRC_kwDOABII5840mq9h",
      "original_commit_id" : "22b2171c48b5cbb1f293182f25e24ed5a3939bc1",
      "original_line" : 305,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 53,
      "pull_request_review_id" : 986051532,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/882552673/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-26T10:56:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/882552673",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased on top of #24860 to integrate the `IsSane` renaming and key duplicate check using a `KeyCompare` method. I added a unit test for duplicate key check when parsing a Miniscript descriptor and took the opportunity to rework a bit the error messages to make them consistent (Now always \"is not sane: [reason]\").",
      "created_at" : "2022-05-26T11:10:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#issuecomment-1138418715",
      "id" : 1138418715,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24148",
      "node_id" : "IC_kwDOABII585D2uQb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1138418715/reactions"
      },
      "updated_at" : "2022-05-26T11:10:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1138418715",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-06-04T20:33:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#issuecomment-1146681755",
      "id" : 1146681755,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24148",
      "node_id" : "IC_kwDOABII585EWPmb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1146681755/reactions"
      },
      "updated_at" : "2022-06-04T20:33:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1146681755",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@darosior Needs rebase! (wheeee)",
      "created_at" : "2022-06-06T14:49:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#issuecomment-1147534116",
      "id" : 1147534116,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24148",
      "node_id" : "IC_kwDOABII585EZfsk",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1147534116/reactions"
      },
      "updated_at" : "2022-06-06T14:49:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1147534116",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased. :)",
      "created_at" : "2022-06-06T16:20:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#issuecomment-1147634271",
      "id" : 1147634271,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24148",
      "node_id" : "IC_kwDOABII585EZ4Jf",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1147634271/reactions"
      },
      "updated_at" : "2022-06-06T16:20:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1147634271",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r892575319"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892575319"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Add LIFETIMEBOUND attribute to `keys`?",
      "commit_id" : "a042854c0f97f9553155f37696040e8f2a491faf",
      "created_at" : "2022-06-08T16:07:05Z",
      "diff_hunk" : "@@ -917,6 +918,89 @@ class TRDescriptor final : public DescriptorImpl\n     bool IsSingleType() const final { return true; }\n };\n \n+/* We instantiate Miniscript here with a simple integer as key type.\n+ * The value of these key integers are an index in the\n+ * DescriptorImpl::m_pubkey_args vector.\n+ */\n+\n+/**\n+ * The context for converting a Miniscript descriptor into a Script.\n+ */\n+class ScriptMaker {\n+    //! Keys contained in the Miniscript (the evaluation of DescriptorImpl::m_pubkey_args).\n+    const std::vector<CPubKey>& m_keys;\n+\n+public:\n+    ScriptMaker(const std::vector<CPubKey>& keys) : m_keys(keys) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r892575319",
      "id" : 892575319,
      "line" : 934,
      "node_id" : "PRRC_kwDOABII5841M55X",
      "original_commit_id" : "32eb838c00c8f47b62e3056c99aa6a72527b2e8d",
      "original_line" : 934,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 49,
      "pull_request_review_id" : 1000039762,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892575319/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-08T16:25:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892575319",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r892576514"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892576514"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Add LIFETIMEBOUND attribute to `arg` and to `pubkeys`?",
      "commit_id" : "a042854c0f97f9553155f37696040e8f2a491faf",
      "created_at" : "2022-06-08T16:08:17Z",
      "diff_hunk" : "@@ -917,6 +918,89 @@ class TRDescriptor final : public DescriptorImpl\n     bool IsSingleType() const final { return true; }\n };\n \n+/* We instantiate Miniscript here with a simple integer as key type.\n+ * The value of these key integers are an index in the\n+ * DescriptorImpl::m_pubkey_args vector.\n+ */\n+\n+/**\n+ * The context for converting a Miniscript descriptor into a Script.\n+ */\n+class ScriptMaker {\n+    //! Keys contained in the Miniscript (the evaluation of DescriptorImpl::m_pubkey_args).\n+    const std::vector<CPubKey>& m_keys;\n+\n+public:\n+    ScriptMaker(const std::vector<CPubKey>& keys) : m_keys(keys) {}\n+\n+    std::vector<unsigned char> ToPKBytes(uint32_t key) const {\n+        return {m_keys[key].begin(), m_keys[key].end()};\n+    }\n+\n+    std::vector<unsigned char> ToPKHBytes(uint32_t key) const {\n+        auto id = m_keys[key].GetID();\n+        return {id.begin(), id.end()};\n+    }\n+};\n+\n+/**\n+ * The context for converting a Miniscript descriptor to its textual form.\n+ */\n+class StringMaker {\n+    //! To convert private keys for private descriptors.\n+    const SigningProvider* m_arg;\n+    //! Keys contained in the Miniscript (a reference to DescriptorImpl::m_pubkey_args).\n+    const std::vector<std::unique_ptr<PubkeyProvider>>& m_pubkeys;\n+    //! Whether to serialize keys as private or public.\n+    bool m_private;\n+\n+public:\n+    StringMaker(const SigningProvider* arg, const std::vector<std::unique_ptr<PubkeyProvider>>& pubkeys, bool priv)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r892576514",
      "id" : 892576514,
      "line" : 958,
      "node_id" : "PRRC_kwDOABII5841M6MC",
      "original_commit_id" : "32eb838c00c8f47b62e3056c99aa6a72527b2e8d",
      "original_line" : 958,
      "original_position" : 73,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 73,
      "pull_request_review_id" : 1000039762,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892576514/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-08T16:25:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892576514",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r892584175"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892584175"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Add LIFETIMEBOUND here to `out` and `in` as well?",
      "commit_id" : "a042854c0f97f9553155f37696040e8f2a491faf",
      "created_at" : "2022-06-08T16:15:10Z",
      "diff_hunk" : "@@ -1058,6 +1142,93 @@ std::unique_ptr<PubkeyProvider> ParsePubkey(uint32_t key_exp_index, const Span<c\n     return std::make_unique<OriginPubkeyProvider>(key_exp_index, std::move(info), std::move(provider));\n }\n \n+std::unique_ptr<PubkeyProvider> InferPubkey(const CPubKey& pubkey, ParseScriptContext, const SigningProvider& provider)\n+{\n+    std::unique_ptr<PubkeyProvider> key_provider = std::make_unique<ConstPubkeyProvider>(0, pubkey, false);\n+    KeyOriginInfo info;\n+    if (provider.GetKeyOrigin(pubkey.GetID(), info)) {\n+        return std::make_unique<OriginPubkeyProvider>(0, std::move(info), std::move(key_provider));\n+    }\n+    return key_provider;\n+}\n+\n+std::unique_ptr<PubkeyProvider> InferXOnlyPubkey(const XOnlyPubKey& xkey, ParseScriptContext ctx, const SigningProvider& provider)\n+{\n+    unsigned char full_key[CPubKey::COMPRESSED_SIZE] = {0x02};\n+    std::copy(xkey.begin(), xkey.end(), full_key + 1);\n+    CPubKey pubkey(full_key);\n+    std::unique_ptr<PubkeyProvider> key_provider = std::make_unique<ConstPubkeyProvider>(0, pubkey, true);\n+    KeyOriginInfo info;\n+    if (provider.GetKeyOriginByXOnly(xkey, info)) {\n+        return std::make_unique<OriginPubkeyProvider>(0, std::move(info), std::move(key_provider));\n+    }\n+    return key_provider;\n+}\n+\n+/**\n+ * The context for parsing a Miniscript descriptor (either from Script or from its textual representation).\n+ */\n+struct KeyParser {\n+    //! The Key type is an index in DescriptorImpl::m_pubkey_args\n+    using Key = uint32_t;\n+    //! Must not be nullptr if parsing from string.\n+    FlatSigningProvider* m_out;\n+    //! Must not be nullptr if parsing from Script.\n+    const SigningProvider* m_in;\n+    //! List of keys contained in the Miniscript.\n+    mutable std::vector<std::unique_ptr<PubkeyProvider>> m_keys;\n+    //! Used to detect key parsing errors within a Miniscript.\n+    mutable std::string m_key_parsing_error;\n+\n+    KeyParser(FlatSigningProvider* out, const SigningProvider* in) : m_out(out), m_in(in) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r892584175",
      "id" : 892584175,
      "line" : 1183,
      "node_id" : "PRRC_kwDOABII5841M8Dv",
      "original_commit_id" : "32eb838c00c8f47b62e3056c99aa6a72527b2e8d",
      "original_line" : 1183,
      "original_position" : 164,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 164,
      "pull_request_review_id" : 1000039762,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892584175/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-08T16:25:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892584175",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r892587808"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892587808"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That sounds pretty slow. Perhaps it's worth adding generic comparison operators to the PubkeyProvider classes? Could be left as a TODO.",
      "commit_id" : "a042854c0f97f9553155f37696040e8f2a491faf",
      "created_at" : "2022-06-08T16:18:18Z",
      "diff_hunk" : "@@ -1058,6 +1142,93 @@ std::unique_ptr<PubkeyProvider> ParsePubkey(uint32_t key_exp_index, const Span<c\n     return std::make_unique<OriginPubkeyProvider>(key_exp_index, std::move(info), std::move(provider));\n }\n \n+std::unique_ptr<PubkeyProvider> InferPubkey(const CPubKey& pubkey, ParseScriptContext, const SigningProvider& provider)\n+{\n+    std::unique_ptr<PubkeyProvider> key_provider = std::make_unique<ConstPubkeyProvider>(0, pubkey, false);\n+    KeyOriginInfo info;\n+    if (provider.GetKeyOrigin(pubkey.GetID(), info)) {\n+        return std::make_unique<OriginPubkeyProvider>(0, std::move(info), std::move(key_provider));\n+    }\n+    return key_provider;\n+}\n+\n+std::unique_ptr<PubkeyProvider> InferXOnlyPubkey(const XOnlyPubKey& xkey, ParseScriptContext ctx, const SigningProvider& provider)\n+{\n+    unsigned char full_key[CPubKey::COMPRESSED_SIZE] = {0x02};\n+    std::copy(xkey.begin(), xkey.end(), full_key + 1);\n+    CPubKey pubkey(full_key);\n+    std::unique_ptr<PubkeyProvider> key_provider = std::make_unique<ConstPubkeyProvider>(0, pubkey, true);\n+    KeyOriginInfo info;\n+    if (provider.GetKeyOriginByXOnly(xkey, info)) {\n+        return std::make_unique<OriginPubkeyProvider>(0, std::move(info), std::move(key_provider));\n+    }\n+    return key_provider;\n+}\n+\n+/**\n+ * The context for parsing a Miniscript descriptor (either from Script or from its textual representation).\n+ */\n+struct KeyParser {\n+    //! The Key type is an index in DescriptorImpl::m_pubkey_args\n+    using Key = uint32_t;\n+    //! Must not be nullptr if parsing from string.\n+    FlatSigningProvider* m_out;\n+    //! Must not be nullptr if parsing from Script.\n+    const SigningProvider* m_in;\n+    //! List of keys contained in the Miniscript.\n+    mutable std::vector<std::unique_ptr<PubkeyProvider>> m_keys;\n+    //! Used to detect key parsing errors within a Miniscript.\n+    mutable std::string m_key_parsing_error;\n+\n+    KeyParser(FlatSigningProvider* out, const SigningProvider* in) : m_out(out), m_in(in) {}\n+\n+    bool KeyCompare(const Key& a, const Key& b) const {\n+        return m_keys[a]->ToString() < m_keys[b]->ToString();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r892587808",
      "id" : 892587808,
      "line" : 1186,
      "node_id" : "PRRC_kwDOABII5841M88g",
      "original_commit_id" : "32eb838c00c8f47b62e3056c99aa6a72527b2e8d",
      "original_line" : 1186,
      "original_position" : 167,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 167,
      "pull_request_review_id" : 1000039762,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892587808/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-08T16:25:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892587808",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r892589520"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892589520"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think `{&*begin, &*end}` can be used instead of `Span<const char>(&*begin, &*end)`.",
      "commit_id" : "a042854c0f97f9553155f37696040e8f2a491faf",
      "created_at" : "2022-06-08T16:20:04Z",
      "diff_hunk" : "@@ -1058,6 +1142,93 @@ std::unique_ptr<PubkeyProvider> ParsePubkey(uint32_t key_exp_index, const Span<c\n     return std::make_unique<OriginPubkeyProvider>(key_exp_index, std::move(info), std::move(provider));\n }\n \n+std::unique_ptr<PubkeyProvider> InferPubkey(const CPubKey& pubkey, ParseScriptContext, const SigningProvider& provider)\n+{\n+    std::unique_ptr<PubkeyProvider> key_provider = std::make_unique<ConstPubkeyProvider>(0, pubkey, false);\n+    KeyOriginInfo info;\n+    if (provider.GetKeyOrigin(pubkey.GetID(), info)) {\n+        return std::make_unique<OriginPubkeyProvider>(0, std::move(info), std::move(key_provider));\n+    }\n+    return key_provider;\n+}\n+\n+std::unique_ptr<PubkeyProvider> InferXOnlyPubkey(const XOnlyPubKey& xkey, ParseScriptContext ctx, const SigningProvider& provider)\n+{\n+    unsigned char full_key[CPubKey::COMPRESSED_SIZE] = {0x02};\n+    std::copy(xkey.begin(), xkey.end(), full_key + 1);\n+    CPubKey pubkey(full_key);\n+    std::unique_ptr<PubkeyProvider> key_provider = std::make_unique<ConstPubkeyProvider>(0, pubkey, true);\n+    KeyOriginInfo info;\n+    if (provider.GetKeyOriginByXOnly(xkey, info)) {\n+        return std::make_unique<OriginPubkeyProvider>(0, std::move(info), std::move(key_provider));\n+    }\n+    return key_provider;\n+}\n+\n+/**\n+ * The context for parsing a Miniscript descriptor (either from Script or from its textual representation).\n+ */\n+struct KeyParser {\n+    //! The Key type is an index in DescriptorImpl::m_pubkey_args\n+    using Key = uint32_t;\n+    //! Must not be nullptr if parsing from string.\n+    FlatSigningProvider* m_out;\n+    //! Must not be nullptr if parsing from Script.\n+    const SigningProvider* m_in;\n+    //! List of keys contained in the Miniscript.\n+    mutable std::vector<std::unique_ptr<PubkeyProvider>> m_keys;\n+    //! Used to detect key parsing errors within a Miniscript.\n+    mutable std::string m_key_parsing_error;\n+\n+    KeyParser(FlatSigningProvider* out, const SigningProvider* in) : m_out(out), m_in(in) {}\n+\n+    bool KeyCompare(const Key& a, const Key& b) const {\n+        return m_keys[a]->ToString() < m_keys[b]->ToString();\n+    }\n+\n+    template<typename I> std::optional<Key> FromString(I begin, I end) const\n+    {\n+        assert(m_out);\n+        Key key = m_keys.size();\n+        auto pk = ParsePubkey(key, Span<const char>(&*begin, &*end), ParseScriptContext::P2WSH, *m_out, m_key_parsing_error);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r892589520",
      "id" : 892589520,
      "line" : 1193,
      "node_id" : "PRRC_kwDOABII5841M9XQ",
      "original_commit_id" : "32eb838c00c8f47b62e3056c99aa6a72527b2e8d",
      "original_line" : 1193,
      "original_position" : 174,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 174,
      "pull_request_review_id" : 1000039762,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892589520/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-08T16:25:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892589520",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r892590971"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892590971"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Constructing a vector just to turn it into a `uint160` sounds a bit inefficient. I think this works too:\r\n\r\n```c++\r\nuint160 hash;\r\nstd::copy(begin, end, hash.begin());\r\n```\r\n",
      "commit_id" : "a042854c0f97f9553155f37696040e8f2a491faf",
      "created_at" : "2022-06-08T16:21:33Z",
      "diff_hunk" : "@@ -1058,6 +1142,93 @@ std::unique_ptr<PubkeyProvider> ParsePubkey(uint32_t key_exp_index, const Span<c\n     return std::make_unique<OriginPubkeyProvider>(key_exp_index, std::move(info), std::move(provider));\n }\n \n+std::unique_ptr<PubkeyProvider> InferPubkey(const CPubKey& pubkey, ParseScriptContext, const SigningProvider& provider)\n+{\n+    std::unique_ptr<PubkeyProvider> key_provider = std::make_unique<ConstPubkeyProvider>(0, pubkey, false);\n+    KeyOriginInfo info;\n+    if (provider.GetKeyOrigin(pubkey.GetID(), info)) {\n+        return std::make_unique<OriginPubkeyProvider>(0, std::move(info), std::move(key_provider));\n+    }\n+    return key_provider;\n+}\n+\n+std::unique_ptr<PubkeyProvider> InferXOnlyPubkey(const XOnlyPubKey& xkey, ParseScriptContext ctx, const SigningProvider& provider)\n+{\n+    unsigned char full_key[CPubKey::COMPRESSED_SIZE] = {0x02};\n+    std::copy(xkey.begin(), xkey.end(), full_key + 1);\n+    CPubKey pubkey(full_key);\n+    std::unique_ptr<PubkeyProvider> key_provider = std::make_unique<ConstPubkeyProvider>(0, pubkey, true);\n+    KeyOriginInfo info;\n+    if (provider.GetKeyOriginByXOnly(xkey, info)) {\n+        return std::make_unique<OriginPubkeyProvider>(0, std::move(info), std::move(key_provider));\n+    }\n+    return key_provider;\n+}\n+\n+/**\n+ * The context for parsing a Miniscript descriptor (either from Script or from its textual representation).\n+ */\n+struct KeyParser {\n+    //! The Key type is an index in DescriptorImpl::m_pubkey_args\n+    using Key = uint32_t;\n+    //! Must not be nullptr if parsing from string.\n+    FlatSigningProvider* m_out;\n+    //! Must not be nullptr if parsing from Script.\n+    const SigningProvider* m_in;\n+    //! List of keys contained in the Miniscript.\n+    mutable std::vector<std::unique_ptr<PubkeyProvider>> m_keys;\n+    //! Used to detect key parsing errors within a Miniscript.\n+    mutable std::string m_key_parsing_error;\n+\n+    KeyParser(FlatSigningProvider* out, const SigningProvider* in) : m_out(out), m_in(in) {}\n+\n+    bool KeyCompare(const Key& a, const Key& b) const {\n+        return m_keys[a]->ToString() < m_keys[b]->ToString();\n+    }\n+\n+    template<typename I> std::optional<Key> FromString(I begin, I end) const\n+    {\n+        assert(m_out);\n+        Key key = m_keys.size();\n+        auto pk = ParsePubkey(key, Span<const char>(&*begin, &*end), ParseScriptContext::P2WSH, *m_out, m_key_parsing_error);\n+        if (!pk) return {};\n+        m_keys.push_back(std::move(pk));\n+        return key;\n+    }\n+\n+    std::optional<std::string> ToString(const Key& key) const\n+    {\n+        return m_keys[key]->ToString();\n+    }\n+\n+    template<typename I> std::optional<Key> FromPKBytes(I begin, I end) const\n+    {\n+        assert(m_in);\n+        CPubKey pubkey(begin, end);\n+        if (pubkey.IsValid()) {\n+            Key key = m_keys.size();\n+            m_keys.push_back(InferPubkey(pubkey, ParseScriptContext::P2WSH, *m_in));\n+            return key;\n+        }\n+        return {};\n+    }\n+\n+    template<typename I> std::optional<Key> FromPKHBytes(I begin, I end) const\n+    {\n+        assert(end - begin == 20);\n+        assert(m_in);\n+        uint160 hash(std::vector<unsigned char>(begin, end));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r892590971",
      "id" : 892590971,
      "line" : 1220,
      "node_id" : "PRRC_kwDOABII5841M9t7",
      "original_commit_id" : "32eb838c00c8f47b62e3056c99aa6a72527b2e8d",
      "original_line" : 1220,
      "original_position" : 201,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 201,
      "pull_request_review_id" : 1000039762,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892590971/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-08T16:25:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892590971",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r892593226"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892593226"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Perhaps for a follow-up PR, but maybe we want to change the `FromString` methods (in miniscript code, but also descriptors in general) to take `std::string_view`s? That would avoid intermediary string objects like here.",
      "commit_id" : "a042854c0f97f9553155f37696040e8f2a491faf",
      "created_at" : "2022-06-08T16:23:48Z",
      "diff_hunk" : "@@ -1279,6 +1450,38 @@ std::unique_ptr<DescriptorImpl> ParseScript(uint32_t& key_exp_index, Span<const\n         error = \"Can only have raw() at top level\";\n         return nullptr;\n     }\n+    // Process miniscript expressions.\n+    {\n+        KeyParser parser(&out, nullptr);\n+        auto node = miniscript::FromString(std::string(expr.begin(), expr.end()), parser);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r892593226",
      "id" : 892593226,
      "line" : 1456,
      "node_id" : "PRRC_kwDOABII5841M-RK",
      "original_commit_id" : "32eb838c00c8f47b62e3056c99aa6a72527b2e8d",
      "original_line" : 1456,
      "original_position" : 223,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 223,
      "pull_request_review_id" : 1000039762,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892593226/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-08T16:25:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892593226",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r892594100"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892594100"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Use braces and separate lines, unless for single-line \"then\" statements without \"else\"s.",
      "commit_id" : "a042854c0f97f9553155f37696040e8f2a491faf",
      "created_at" : "2022-06-08T16:24:43Z",
      "diff_hunk" : "@@ -1279,6 +1450,38 @@ std::unique_ptr<DescriptorImpl> ParseScript(uint32_t& key_exp_index, Span<const\n         error = \"Can only have raw() at top level\";\n         return nullptr;\n     }\n+    // Process miniscript expressions.\n+    {\n+        KeyParser parser(&out, nullptr);\n+        auto node = miniscript::FromString(std::string(expr.begin(), expr.end()), parser);\n+        if (node) {\n+            if (ctx != ParseScriptContext::P2WSH) {\n+                error = \"Miniscript expressions can only be used in wsh\";\n+                return nullptr;\n+            }\n+            if (parser.m_key_parsing_error != \"\") {\n+                error = std::move(parser.m_key_parsing_error);\n+                return nullptr;\n+            }\n+            if (!node->IsSane()) {\n+                // Try to find the first insane sub for better error reporting.\n+                auto insane_node = node.get();\n+                if (const auto sub = node->FindInsaneSub()) insane_node = sub;\n+                if (const auto str = insane_node->ToString(parser)) error = *str;\n+                if (!insane_node->IsValid()) { error += \" is invalid\";}\n+                else {\n+                    error += \" is not sane\";\n+                    if (!insane_node->IsNonMalleable()) error += \": malleable witnesses exist\";\n+                    else if (insane_node == node.get() && !insane_node->NeedsSignature()) error += \": witnesses without signature exist\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r892594100",
      "id" : 892594100,
      "line" : 1475,
      "node_id" : "PRRC_kwDOABII5841M-e0",
      "original_commit_id" : "32eb838c00c8f47b62e3056c99aa6a72527b2e8d",
      "original_line" : 1475,
      "original_position" : 242,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 242,
      "pull_request_review_id" : 1000039762,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892594100/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-08T16:25:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892594100",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r893844202"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893844202"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah, it's also slightly incorrect. For instance if a user -for whatever reason- has a descriptor with 2 xpubs with the same key but different chaincodes, this would not detect them as duplicates (same with same key but diff origins). I wanted to revisit that but it slipped my mind.\r\n\r\nI added an `operator<`Â to `PubkeyProvider`:\r\n```patch\r\ndiff --git a/src/script/descriptor.cpp b/src/script/descriptor.cpp\r\nindex 94c9071999..66c4e1cba9 100644\r\n--- a/src/script/descriptor.cpp\r\n+++ b/src/script/descriptor.cpp\r\n@@ -162,6 +162,20 @@ public:\r\n \r\n     virtual ~PubkeyProvider() = default;\r\n \r\n+    /** Compare two public keys represented by this provider.\r\n+     * Used by the Miniscript descriptors to check for duplicate keys in the script.\r\n+     */\r\n+    bool operator<(PubkeyProvider& other) const {\r\n+        CPubKey a, b;\r\n+        SigningProvider dummy;\r\n+        KeyOriginInfo dummy_info;\r\n+\r\n+        GetPubKey(0, dummy, a, dummy_info);\r\n+        other.GetPubKey(0, dummy, b, dummy_info);\r\n+\r\n+        return a < b;\r\n+    }\r\n+\r\n     /** Derive a public key.\r\n      *  read_cache is the cache to read keys from (if not nullptr)\r\n      *  write_cache is the cache to write keys to (if not nullptr)\r\n@@ -1183,7 +1197,7 @@ struct KeyParser {\r\n     KeyParser(FlatSigningProvider* out LIFETIMEBOUND, const SigningProvider* in LIFETIMEBOUND) : m_out(out), m_in(in) {}\r\n \r\n     bool KeyCompare(const Key& a, const Key& b) const {\r\n-        return m_keys[a]->ToString() < m_keys[b]->ToString();\r\n+        return *m_keys[a] < *m_keys[b];\r\n     }\r\n \r\n     template<typename I> std::optional<Key> FromString(I begin, I end) const\r\n```",
      "commit_id" : "faa6f2176e487f7992557a1620923ebfaf60f432",
      "created_at" : "2022-06-09T18:41:11Z",
      "diff_hunk" : "@@ -1058,6 +1142,93 @@ std::unique_ptr<PubkeyProvider> ParsePubkey(uint32_t key_exp_index, const Span<c\n     return std::make_unique<OriginPubkeyProvider>(key_exp_index, std::move(info), std::move(provider));\n }\n \n+std::unique_ptr<PubkeyProvider> InferPubkey(const CPubKey& pubkey, ParseScriptContext, const SigningProvider& provider)\n+{\n+    std::unique_ptr<PubkeyProvider> key_provider = std::make_unique<ConstPubkeyProvider>(0, pubkey, false);\n+    KeyOriginInfo info;\n+    if (provider.GetKeyOrigin(pubkey.GetID(), info)) {\n+        return std::make_unique<OriginPubkeyProvider>(0, std::move(info), std::move(key_provider));\n+    }\n+    return key_provider;\n+}\n+\n+std::unique_ptr<PubkeyProvider> InferXOnlyPubkey(const XOnlyPubKey& xkey, ParseScriptContext ctx, const SigningProvider& provider)\n+{\n+    unsigned char full_key[CPubKey::COMPRESSED_SIZE] = {0x02};\n+    std::copy(xkey.begin(), xkey.end(), full_key + 1);\n+    CPubKey pubkey(full_key);\n+    std::unique_ptr<PubkeyProvider> key_provider = std::make_unique<ConstPubkeyProvider>(0, pubkey, true);\n+    KeyOriginInfo info;\n+    if (provider.GetKeyOriginByXOnly(xkey, info)) {\n+        return std::make_unique<OriginPubkeyProvider>(0, std::move(info), std::move(key_provider));\n+    }\n+    return key_provider;\n+}\n+\n+/**\n+ * The context for parsing a Miniscript descriptor (either from Script or from its textual representation).\n+ */\n+struct KeyParser {\n+    //! The Key type is an index in DescriptorImpl::m_pubkey_args\n+    using Key = uint32_t;\n+    //! Must not be nullptr if parsing from string.\n+    FlatSigningProvider* m_out;\n+    //! Must not be nullptr if parsing from Script.\n+    const SigningProvider* m_in;\n+    //! List of keys contained in the Miniscript.\n+    mutable std::vector<std::unique_ptr<PubkeyProvider>> m_keys;\n+    //! Used to detect key parsing errors within a Miniscript.\n+    mutable std::string m_key_parsing_error;\n+\n+    KeyParser(FlatSigningProvider* out, const SigningProvider* in) : m_out(out), m_in(in) {}\n+\n+    bool KeyCompare(const Key& a, const Key& b) const {\n+        return m_keys[a]->ToString() < m_keys[b]->ToString();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r893844202",
      "id" : 893844202,
      "in_reply_to_id" : 892587808,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5841Rvrq",
      "original_commit_id" : "32eb838c00c8f47b62e3056c99aa6a72527b2e8d",
      "original_line" : 1186,
      "original_position" : 167,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : null,
      "pull_request_review_id" : 1001822948,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893844202/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-09T18:41:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893844202",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r893847338"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893847338"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Since it's going to touch the Miniscript code again, i'd prefer to keep this as a follow-up if you don't mind.",
      "commit_id" : "faa6f2176e487f7992557a1620923ebfaf60f432",
      "created_at" : "2022-06-09T18:45:20Z",
      "diff_hunk" : "@@ -1279,6 +1450,38 @@ std::unique_ptr<DescriptorImpl> ParseScript(uint32_t& key_exp_index, Span<const\n         error = \"Can only have raw() at top level\";\n         return nullptr;\n     }\n+    // Process miniscript expressions.\n+    {\n+        KeyParser parser(&out, nullptr);\n+        auto node = miniscript::FromString(std::string(expr.begin(), expr.end()), parser);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r893847338",
      "id" : 893847338,
      "in_reply_to_id" : 892593226,
      "line" : 1471,
      "node_id" : "PRRC_kwDOABII5841Rwcq",
      "original_commit_id" : "32eb838c00c8f47b62e3056c99aa6a72527b2e8d",
      "original_line" : 1471,
      "original_position" : 223,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 245,
      "pull_request_review_id" : 1001827549,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893847338/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-09T18:45:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893847338",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r901976005"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/901976005"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In e9cac52614d11e30d1f6fec33efce3d00953bd70 \"Miniscript support in output descriptors\"\r\n\r\nnit: `m_name` does not need to be `protected`.",
      "commit_id" : "faa6f2176e487f7992557a1620923ebfaf60f432",
      "created_at" : "2022-06-20T20:14:30Z",
      "diff_hunk" : "@@ -493,12 +508,12 @@ class BIP32PubkeyProvider final : public PubkeyProvider\n /** Base class for all Descriptor implementations. */\n class DescriptorImpl : public Descriptor\n {\n-    //! Public key arguments for this descriptor (size 1 for PK, PKH, WPKH; any size for Multisig).\n+protected:\n+    //! Public key arguments for this descriptor (size 1 for PK, PKH, WPKH; any size for WSH and Multisig).\n     const std::vector<std::unique_ptr<PubkeyProvider>> m_pubkey_args;\n     //! The string name of the descriptor function.\n     const std::string m_name;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r901976005",
      "id" : 901976005,
      "line" : 515,
      "node_id" : "PRRC_kwDOABII5841ww_F",
      "original_commit_id" : "e9cac52614d11e30d1f6fec33efce3d00953bd70",
      "original_line" : 515,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 38,
      "pull_request_review_id" : 1012714706,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/901976005/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-20T20:28:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/901976005",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the review @achow101.\r\n\r\nRegarding `FindInsaneSub`, you are right. I should rename the commit. The intention here is to find the first insane sub that is closest to be a leaf.\r\n\r\n`Key` can't be aÂ `PubkeyProvider` because we instanciate `Key`s. Neither can it be a `unique_ptr` since we may copy it. Following Pieter's comment last month (https://github.com/bitcoin/bitcoin/pull/24148#issuecomment-1127664730) i tried making it a `shared_ptr` in order to avoid adding a `KeyCompare`Â requirement on all contexts. Unfortunately it quickly becomes unmanageable.",
      "created_at" : "2022-06-21T17:53:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#issuecomment-1162100884",
      "id" : 1162100884,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24148",
      "node_id" : "IC_kwDOABII585FRECU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1162100884/reactions"
      },
      "updated_at" : "2022-06-21T17:53:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1162100884",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r902922083"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/902922083"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah, but \r\n```patch\r\ndiff --git a/src/script/descriptor.cpp b/src/script/descriptor.cpp\r\nindex 66c4e1cba9..b40e330f67 100644\r\n--- a/src/script/descriptor.cpp\r\n+++ b/src/script/descriptor.cpp\r\n@@ -508,11 +508,12 @@ public:\r\n /** Base class for all Descriptor implementations. */\r\n class DescriptorImpl : public Descriptor\r\n {\r\n+    //! The string name of the descriptor function.\r\n+    const std::string m_name;\r\n+\r\n protected:\r\n     //! Public key arguments for this descriptor (size 1 for PK, PKH, WPKH; any size for WSH and Multisig).\r\n     const std::vector<std::unique_ptr<PubkeyProvider>> m_pubkey_args;\r\n-    //! The string name of the descriptor function.\r\n-    const std::string m_name;\r\n \r\n     //! The sub-descriptor arguments (empty for everything but SH and WSH).\r\n     //! In doc/descriptors.m this is referred to as SCRIPT expressions sh(SCRIPT)\r\n```\r\n\r\nWould make me reorder the initializer list of all classes heriting from `DescriptorImpl`, so i guess it's not so bad if it's just `protected` instead of `private`? Happy to change if you prefer, still. (This or doing `protectred:` then `private:` then `protected:` again.)",
      "commit_id" : "faa6f2176e487f7992557a1620923ebfaf60f432",
      "created_at" : "2022-06-21T18:08:57Z",
      "diff_hunk" : "@@ -493,12 +508,12 @@ class BIP32PubkeyProvider final : public PubkeyProvider\n /** Base class for all Descriptor implementations. */\n class DescriptorImpl : public Descriptor\n {\n-    //! Public key arguments for this descriptor (size 1 for PK, PKH, WPKH; any size for Multisig).\n+protected:\n+    //! Public key arguments for this descriptor (size 1 for PK, PKH, WPKH; any size for WSH and Multisig).\n     const std::vector<std::unique_ptr<PubkeyProvider>> m_pubkey_args;\n     //! The string name of the descriptor function.\n     const std::string m_name;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r902922083",
      "id" : 902922083,
      "in_reply_to_id" : 901976005,
      "line" : 515,
      "node_id" : "PRRC_kwDOABII58410X9j",
      "original_commit_id" : "e9cac52614d11e30d1f6fec33efce3d00953bd70",
      "original_line" : 515,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 38,
      "pull_request_review_id" : 1014038644,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/902922083/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-21T18:08:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/902922083",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK faa6f2176e487f7992557a1620923ebfaf60f432",
      "created_at" : "2022-06-23T21:59:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#issuecomment-1164921615",
      "id" : 1164921615,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24148",
      "node_id" : "IC_kwDOABII585Fb0sP",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1164921615/reactions"
      },
      "updated_at" : "2022-06-23T21:59:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1164921615",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sipa: could you give this another look when you have a minute?",
      "created_at" : "2022-07-04T13:25:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#issuecomment-1173820796",
      "id" : 1173820796,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24148",
      "node_id" : "IC_kwDOABII585F9xV8",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1173820796/reactions"
      },
      "updated_at" : "2022-07-04T13:25:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1173820796",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've got a decent fuzzing coverage of this PR with the corpus at https://github.com/bitcoin-core/qa-assets/pull/92 (using this branch along with #25540 to avoid memory blowups). A coverage report is available [here](http://download.darosior.ninja/dump/coverage_descriptor_parse_miniscript_2205/src/script/index.html).",
      "created_at" : "2022-07-05T08:21:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#issuecomment-1174763670",
      "id" : 1174763670,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24148",
      "node_id" : "IC_kwDOABII585GBXiW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1174763670/reactions"
      },
      "updated_at" : "2022-07-05T08:21:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1174763670",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Can you add a test for `FindInsaneSub`?  Right now its only function is to produce better error messages, but who knows what people do with it later... Though I guess such tests would much overlap with the test vectors in descriptor_tests.cpp.\r\n\r\nAny particular reason why you're moving `InferPubkey` and `InferXOnlyPubkey` (no problem with `--color-moved=dimmed-zebra`) in e9cac52614d11e30d1f6fec33efce3d00953bd70?\r\n\r\nNit: `bool operator<(PubkeyProvider& other)` and the new `StringMaker` class could go in their own commits (with tests, which also make them easier to review).",
      "created_at" : "2022-07-07T13:45:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#issuecomment-1177640746",
      "id" : 1177640746,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24148",
      "node_id" : "IC_kwDOABII585GMV8q",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1177640746/reactions"
      },
      "updated_at" : "2022-07-07T15:25:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1177640746",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r916011953"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916011953"
         }
      },
      "author_association" : "MEMBER",
      "body" : "What is supposed to happen here if we have a descriptor with 1 private key and otherwise only public keys?",
      "commit_id" : "faa6f2176e487f7992557a1620923ebfaf60f432",
      "created_at" : "2022-07-07T15:30:53Z",
      "diff_hunk" : "@@ -917,6 +932,89 @@ class TRDescriptor final : public DescriptorImpl\n     bool IsSingleType() const final { return true; }\n };\n \n+/* We instantiate Miniscript here with a simple integer as key type.\n+ * The value of these key integers are an index in the\n+ * DescriptorImpl::m_pubkey_args vector.\n+ */\n+\n+/**\n+ * The context for converting a Miniscript descriptor into a Script.\n+ */\n+class ScriptMaker {\n+    //! Keys contained in the Miniscript (the evaluation of DescriptorImpl::m_pubkey_args).\n+    const std::vector<CPubKey>& m_keys;\n+\n+public:\n+    ScriptMaker(const std::vector<CPubKey>& keys LIFETIMEBOUND) : m_keys(keys) {}\n+\n+    std::vector<unsigned char> ToPKBytes(uint32_t key) const {\n+        return {m_keys[key].begin(), m_keys[key].end()};\n+    }\n+\n+    std::vector<unsigned char> ToPKHBytes(uint32_t key) const {\n+        auto id = m_keys[key].GetID();\n+        return {id.begin(), id.end()};\n+    }\n+};\n+\n+/**\n+ * The context for converting a Miniscript descriptor to its textual form.\n+ */\n+class StringMaker {\n+    //! To convert private keys for private descriptors.\n+    const SigningProvider* m_arg;\n+    //! Keys contained in the Miniscript (a reference to DescriptorImpl::m_pubkey_args).\n+    const std::vector<std::unique_ptr<PubkeyProvider>>& m_pubkeys;\n+    //! Whether to serialize keys as private or public.\n+    bool m_private;\n+\n+public:\n+    StringMaker(const SigningProvider* arg LIFETIMEBOUND, const std::vector<std::unique_ptr<PubkeyProvider>>& pubkeys LIFETIMEBOUND, bool priv)\n+        : m_arg(arg), m_pubkeys(pubkeys), m_private(priv) {}\n+\n+    std::optional<std::string> ToString(uint32_t key) const\n+    {\n+        std::string ret;\n+        if (m_private) {\n+            if (!m_pubkeys[key]->ToPrivateString(*m_arg, ret)) return {};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r916011953",
      "id" : 916011953,
      "line" : 979,
      "node_id" : "PRRC_kwDOABII5842mTux",
      "original_commit_id" : "e9cac52614d11e30d1f6fec33efce3d00953bd70",
      "original_line" : 979,
      "original_position" : 101,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 101,
      "pull_request_review_id" : 1031776846,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916011953/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-07T15:30:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916011953",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r917821024"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917821024"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The same as for existing descriptors, a failure:\r\n```diff\r\ndiff --git a/src/test/descriptor_tests.cpp b/src/test/descriptor_tests.cpp\r\nindex a8c666079d..668cddfbba 100644\r\n--- a/src/test/descriptor_tests.cpp\r\n+++ b/src/test/descriptor_tests.cpp\r\n@@ -488,6 +488,13 @@ Check(\"sh(wsh(multi(20,KzoAz5CanayRKex3fSLQ2BwJpN7U52gZvxMyk78nDMHuqrUxuSJy,KwGN\r\n \r\n     // Miniscript tests\r\n \r\n+    FlatSigningProvider prov;\r\n+    std::string err, out;\r\n+    const auto multi_desc = Parse(\"wsh(multi(1,L4gM1FBdyHNpkzsFh9ipnofLhpZRp2mwobpeULy1a6dBTvw8Ywtd,032707170c71d8f75e4ca4e3fce870b9409dcaf12b051d3bcadff74747fa7619c0))\", prov, err, false);\r\n+    assert(multi_desc && !multi_desc->ToPrivateString(prov, out));\r\n+    const auto ms_desc = Parse(\"wsh(or_i(pk(L4gM1FBdyHNpkzsFh9ipnofLhpZRp2mwobpeULy1a6dBTvw8Ywtd),pk(032707170c71d8f75e4ca4e3fce870b9409dcaf12b051d3bcadff74747fa7619c0)))\", prov, err, false);\r\n+    assert(ms_desc && !ms_desc->ToPrivateString(prov, out));\r\n+\r\n     // Invalid checksum\r\n     CheckUnparsable(\"wsh(and_v(vc:andor(pk(L4gM1FBdyHNpkzsFh9ipnofLhpZRp2mwobpeULy1a6dBTvw8Ywtd),pk_k(Kx9HCDjGiwFcgVNhTrS5z5NeZdD6veeam61eDxLDCkGWujvL4Gnn),and_v(v:older(1),pk_k(L4o2kDvXXDRH2VS9uBnouScLduWt4dZnM25se7kvEjJeQ285en2A))),after(10)))#abcdef12\", \"wsh(and_v(vc:andor(pk(03cdabb7f2dce7bfbd8a0b9570c6fd1e712e5d64045e9d6b517b3d5072251dc204),pk_k(032707170c71d8f75e4ca4e3fce870b9409dcaf12b051d3bcadff74747fa7619c0),and_v(v:older(1),pk_k(02aa27e5eb2c185e87cd1dbc3e0efc9cb1175235e0259df1713424941c3cb40402))),after(10)))#abcdef12\", \"Provided checksum 'abcdef12' does not match computed checksum 'tyzp6a7p'\");\r\n     // Only p2wsh context is valid\r\n```\r\n\r\nIt is certainly suboptimal for certain usecases (like importing a partially private desc and calling `listdescriptors true`), but it's the existing behaviour and i don't think it should be fixed in this PR.",
      "commit_id" : "faa6f2176e487f7992557a1620923ebfaf60f432",
      "created_at" : "2022-07-11T11:22:46Z",
      "diff_hunk" : "@@ -917,6 +932,89 @@ class TRDescriptor final : public DescriptorImpl\n     bool IsSingleType() const final { return true; }\n };\n \n+/* We instantiate Miniscript here with a simple integer as key type.\n+ * The value of these key integers are an index in the\n+ * DescriptorImpl::m_pubkey_args vector.\n+ */\n+\n+/**\n+ * The context for converting a Miniscript descriptor into a Script.\n+ */\n+class ScriptMaker {\n+    //! Keys contained in the Miniscript (the evaluation of DescriptorImpl::m_pubkey_args).\n+    const std::vector<CPubKey>& m_keys;\n+\n+public:\n+    ScriptMaker(const std::vector<CPubKey>& keys LIFETIMEBOUND) : m_keys(keys) {}\n+\n+    std::vector<unsigned char> ToPKBytes(uint32_t key) const {\n+        return {m_keys[key].begin(), m_keys[key].end()};\n+    }\n+\n+    std::vector<unsigned char> ToPKHBytes(uint32_t key) const {\n+        auto id = m_keys[key].GetID();\n+        return {id.begin(), id.end()};\n+    }\n+};\n+\n+/**\n+ * The context for converting a Miniscript descriptor to its textual form.\n+ */\n+class StringMaker {\n+    //! To convert private keys for private descriptors.\n+    const SigningProvider* m_arg;\n+    //! Keys contained in the Miniscript (a reference to DescriptorImpl::m_pubkey_args).\n+    const std::vector<std::unique_ptr<PubkeyProvider>>& m_pubkeys;\n+    //! Whether to serialize keys as private or public.\n+    bool m_private;\n+\n+public:\n+    StringMaker(const SigningProvider* arg LIFETIMEBOUND, const std::vector<std::unique_ptr<PubkeyProvider>>& pubkeys LIFETIMEBOUND, bool priv)\n+        : m_arg(arg), m_pubkeys(pubkeys), m_private(priv) {}\n+\n+    std::optional<std::string> ToString(uint32_t key) const\n+    {\n+        std::string ret;\n+        if (m_private) {\n+            if (!m_pubkeys[key]->ToPrivateString(*m_arg, ret)) return {};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r917821024",
      "id" : 917821024,
      "in_reply_to_id" : 916011953,
      "line" : 979,
      "node_id" : "PRRC_kwDOABII5842tNZg",
      "original_commit_id" : "e9cac52614d11e30d1f6fec33efce3d00953bd70",
      "original_line" : 979,
      "original_position" : 101,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 101,
      "pull_request_review_id" : 1034182664,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917821024/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-11T11:22:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917821024",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Indeed a test for `FindInsaneSub` is redundant with the descriptor parsing failure test vectors. But it's trivial so i added one. I also took this opportunity to rename the commit to not mention it's looking for the \"deepest\" insane sub, as noted by @achow101.\r\n\r\n`InferPubkey` is used in the `KeyParser` so it needs to be declared. I made `InferXOnlyPubkey` stick with the former for pure style/organisation reasons: it appeared to be \"righter\" and not harder to review (this just extends the moved patch from ~8 to ~16 lines which is trivially reviewable with `--color-moved` as you mentioned).\r\n\r\nAs for splitting the commit, i'd prefer to leave it like that if you don't feel too strongly about it (and since you marked it as nit). I think it would just make the commits less atomic, and the `StringMaker`/`ScriptMaker` are tested through the `MiniscriptDescriptor`.",
      "created_at" : "2022-07-11T16:39:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#issuecomment-1180629992",
      "id" : 1180629992,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24148",
      "node_id" : "IC_kwDOABII585GXvvo",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1180629992/reactions"
      },
      "updated_at" : "2022-07-11T16:39:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1180629992",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r920081407"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920081407"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Indeed, something we can address later.",
      "commit_id" : "49ac002733157f5629303d1cf59fa3151fdf1e73",
      "created_at" : "2022-07-13T13:30:44Z",
      "diff_hunk" : "@@ -917,6 +932,89 @@ class TRDescriptor final : public DescriptorImpl\n     bool IsSingleType() const final { return true; }\n };\n \n+/* We instantiate Miniscript here with a simple integer as key type.\n+ * The value of these key integers are an index in the\n+ * DescriptorImpl::m_pubkey_args vector.\n+ */\n+\n+/**\n+ * The context for converting a Miniscript descriptor into a Script.\n+ */\n+class ScriptMaker {\n+    //! Keys contained in the Miniscript (the evaluation of DescriptorImpl::m_pubkey_args).\n+    const std::vector<CPubKey>& m_keys;\n+\n+public:\n+    ScriptMaker(const std::vector<CPubKey>& keys LIFETIMEBOUND) : m_keys(keys) {}\n+\n+    std::vector<unsigned char> ToPKBytes(uint32_t key) const {\n+        return {m_keys[key].begin(), m_keys[key].end()};\n+    }\n+\n+    std::vector<unsigned char> ToPKHBytes(uint32_t key) const {\n+        auto id = m_keys[key].GetID();\n+        return {id.begin(), id.end()};\n+    }\n+};\n+\n+/**\n+ * The context for converting a Miniscript descriptor to its textual form.\n+ */\n+class StringMaker {\n+    //! To convert private keys for private descriptors.\n+    const SigningProvider* m_arg;\n+    //! Keys contained in the Miniscript (a reference to DescriptorImpl::m_pubkey_args).\n+    const std::vector<std::unique_ptr<PubkeyProvider>>& m_pubkeys;\n+    //! Whether to serialize keys as private or public.\n+    bool m_private;\n+\n+public:\n+    StringMaker(const SigningProvider* arg LIFETIMEBOUND, const std::vector<std::unique_ptr<PubkeyProvider>>& pubkeys LIFETIMEBOUND, bool priv)\n+        : m_arg(arg), m_pubkeys(pubkeys), m_private(priv) {}\n+\n+    std::optional<std::string> ToString(uint32_t key) const\n+    {\n+        std::string ret;\n+        if (m_private) {\n+            if (!m_pubkeys[key]->ToPrivateString(*m_arg, ret)) return {};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r920081407",
      "id" : 920081407,
      "in_reply_to_id" : 916011953,
      "line" : 979,
      "node_id" : "PRRC_kwDOABII584211P_",
      "original_commit_id" : "e9cac52614d11e30d1f6fec33efce3d00953bd70",
      "original_line" : 979,
      "original_position" : 101,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 101,
      "pull_request_review_id" : 1037366519,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920081407/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T13:30:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920081407",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r920091023"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920091023"
         }
      },
      "author_association" : "MEMBER",
      "body" : "See #24361",
      "commit_id" : "49ac002733157f5629303d1cf59fa3151fdf1e73",
      "created_at" : "2022-07-13T13:39:20Z",
      "diff_hunk" : "@@ -917,6 +932,89 @@ class TRDescriptor final : public DescriptorImpl\n     bool IsSingleType() const final { return true; }\n };\n \n+/* We instantiate Miniscript here with a simple integer as key type.\n+ * The value of these key integers are an index in the\n+ * DescriptorImpl::m_pubkey_args vector.\n+ */\n+\n+/**\n+ * The context for converting a Miniscript descriptor into a Script.\n+ */\n+class ScriptMaker {\n+    //! Keys contained in the Miniscript (the evaluation of DescriptorImpl::m_pubkey_args).\n+    const std::vector<CPubKey>& m_keys;\n+\n+public:\n+    ScriptMaker(const std::vector<CPubKey>& keys LIFETIMEBOUND) : m_keys(keys) {}\n+\n+    std::vector<unsigned char> ToPKBytes(uint32_t key) const {\n+        return {m_keys[key].begin(), m_keys[key].end()};\n+    }\n+\n+    std::vector<unsigned char> ToPKHBytes(uint32_t key) const {\n+        auto id = m_keys[key].GetID();\n+        return {id.begin(), id.end()};\n+    }\n+};\n+\n+/**\n+ * The context for converting a Miniscript descriptor to its textual form.\n+ */\n+class StringMaker {\n+    //! To convert private keys for private descriptors.\n+    const SigningProvider* m_arg;\n+    //! Keys contained in the Miniscript (a reference to DescriptorImpl::m_pubkey_args).\n+    const std::vector<std::unique_ptr<PubkeyProvider>>& m_pubkeys;\n+    //! Whether to serialize keys as private or public.\n+    bool m_private;\n+\n+public:\n+    StringMaker(const SigningProvider* arg LIFETIMEBOUND, const std::vector<std::unique_ptr<PubkeyProvider>>& pubkeys LIFETIMEBOUND, bool priv)\n+        : m_arg(arg), m_pubkeys(pubkeys), m_private(priv) {}\n+\n+    std::optional<std::string> ToString(uint32_t key) const\n+    {\n+        std::string ret;\n+        if (m_private) {\n+            if (!m_pubkeys[key]->ToPrivateString(*m_arg, ret)) return {};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r920091023",
      "id" : 920091023,
      "in_reply_to_id" : 916011953,
      "line" : 979,
      "node_id" : "PRRC_kwDOABII584213mP",
      "original_commit_id" : "e9cac52614d11e30d1f6fec33efce3d00953bd70",
      "original_line" : 979,
      "original_position" : 101,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 101,
      "pull_request_review_id" : 1037380381,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920091023/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T13:39:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920091023",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r920210646"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920210646"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe use `.at(a)` here, as well as in `ToString()`",
      "commit_id" : "49ac002733157f5629303d1cf59fa3151fdf1e73",
      "created_at" : "2022-07-13T15:20:59Z",
      "diff_hunk" : "@@ -1058,6 +1156,94 @@ std::unique_ptr<PubkeyProvider> ParsePubkey(uint32_t key_exp_index, const Span<c\n     return std::make_unique<OriginPubkeyProvider>(key_exp_index, std::move(info), std::move(provider));\n }\n \n+std::unique_ptr<PubkeyProvider> InferPubkey(const CPubKey& pubkey, ParseScriptContext, const SigningProvider& provider)\n+{\n+    std::unique_ptr<PubkeyProvider> key_provider = std::make_unique<ConstPubkeyProvider>(0, pubkey, false);\n+    KeyOriginInfo info;\n+    if (provider.GetKeyOrigin(pubkey.GetID(), info)) {\n+        return std::make_unique<OriginPubkeyProvider>(0, std::move(info), std::move(key_provider));\n+    }\n+    return key_provider;\n+}\n+\n+std::unique_ptr<PubkeyProvider> InferXOnlyPubkey(const XOnlyPubKey& xkey, ParseScriptContext ctx, const SigningProvider& provider)\n+{\n+    unsigned char full_key[CPubKey::COMPRESSED_SIZE] = {0x02};\n+    std::copy(xkey.begin(), xkey.end(), full_key + 1);\n+    CPubKey pubkey(full_key);\n+    std::unique_ptr<PubkeyProvider> key_provider = std::make_unique<ConstPubkeyProvider>(0, pubkey, true);\n+    KeyOriginInfo info;\n+    if (provider.GetKeyOriginByXOnly(xkey, info)) {\n+        return std::make_unique<OriginPubkeyProvider>(0, std::move(info), std::move(key_provider));\n+    }\n+    return key_provider;\n+}\n+\n+/**\n+ * The context for parsing a Miniscript descriptor (either from Script or from its textual representation).\n+ */\n+struct KeyParser {\n+    //! The Key type is an index in DescriptorImpl::m_pubkey_args\n+    using Key = uint32_t;\n+    //! Must not be nullptr if parsing from string.\n+    FlatSigningProvider* m_out;\n+    //! Must not be nullptr if parsing from Script.\n+    const SigningProvider* m_in;\n+    //! List of keys contained in the Miniscript.\n+    mutable std::vector<std::unique_ptr<PubkeyProvider>> m_keys;\n+    //! Used to detect key parsing errors within a Miniscript.\n+    mutable std::string m_key_parsing_error;\n+\n+    KeyParser(FlatSigningProvider* out LIFETIMEBOUND, const SigningProvider* in LIFETIMEBOUND) : m_out(out), m_in(in) {}\n+\n+    bool KeyCompare(const Key& a, const Key& b) const {\n+        return *m_keys[a] < *m_keys[b];",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r920210646",
      "id" : 920210646,
      "line" : 1200,
      "node_id" : "PRRC_kwDOABII58422UzW",
      "original_commit_id" : "abd1c0444f44dc1c4b8ac91d9a0354e9912f1a2b",
      "original_line" : 1200,
      "original_position" : 188,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 188,
      "pull_request_review_id" : 1037552949,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920210646/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T15:35:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920210646",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r920220890"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920220890"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```cpp\r\nif (!insane_node->IsValid()) {\r\n  error += \" is invalid\";\r\n} else {\r\n```",
      "commit_id" : "49ac002733157f5629303d1cf59fa3151fdf1e73",
      "created_at" : "2022-07-13T15:30:19Z",
      "diff_hunk" : "@@ -1279,6 +1465,44 @@ std::unique_ptr<DescriptorImpl> ParseScript(uint32_t& key_exp_index, Span<const\n         error = \"Can only have raw() at top level\";\n         return nullptr;\n     }\n+    // Process miniscript expressions.\n+    {\n+        KeyParser parser(&out, nullptr);\n+        auto node = miniscript::FromString(std::string(expr.begin(), expr.end()), parser);\n+        if (node) {\n+            if (ctx != ParseScriptContext::P2WSH) {\n+                error = \"Miniscript expressions can only be used in wsh\";\n+                return nullptr;\n+            }\n+            if (parser.m_key_parsing_error != \"\") {\n+                error = std::move(parser.m_key_parsing_error);\n+                return nullptr;\n+            }\n+            if (!node->IsSane()) {\n+                // Try to find the first insane sub for better error reporting.\n+                auto insane_node = node.get();\n+                if (const auto sub = node->FindInsaneSub()) insane_node = sub;\n+                if (const auto str = insane_node->ToString(parser)) error = *str;\n+                if (!insane_node->IsValid()) { error += \" is invalid\";}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r920220890",
      "id" : 920220890,
      "line" : 1486,
      "node_id" : "PRRC_kwDOABII58422XTa",
      "original_commit_id" : "abd1c0444f44dc1c4b8ac91d9a0354e9912f1a2b",
      "original_line" : 1486,
      "original_position" : 260,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 260,
      "pull_request_review_id" : 1037552949,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920220890/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T15:35:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920220890",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-ACK 49ac002733157f5629303d1cf59fa3151fdf1e73",
      "created_at" : "2022-07-13T20:00:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#issuecomment-1183623495",
      "id" : 1183623495,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24148",
      "node_id" : "IC_kwDOABII585GjKlH",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1183623495/reactions"
      },
      "updated_at" : "2022-07-13T20:00:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1183623495",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r920477452"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920477452"
         }
      },
      "author_association" : "MEMBER",
      "body" : "need to define insane(I don't know what that means)",
      "commit_id" : "49ac002733157f5629303d1cf59fa3151fdf1e73",
      "created_at" : "2022-07-13T20:30:36Z",
      "diff_hunk" : "@@ -0,0 +1,93 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test Miniscript descriptors integration in the wallet.\"\"\"\n+\n+from test_framework.descriptors import descsum_create\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+MINISCRIPTS = [\n+    # One of two keys\n+    \"or_b(pk(tpubD6NzVbkrYhZ4XRMcMFMMFvzVt6jaDAtjZhD7JLwdPdMm9xa76DnxYYP7w9TZGJDVFkek3ArwVsuacheqqPog8TH5iBCX1wuig8PLXim4n9a/*),s:pk(tpubD6NzVbkrYhZ4WsqRzDmkL82SWcu42JzUvKWzrJHQ8EC2vEHRHkXj1De93sD3biLrKd8XGnamXURGjMbYavbszVDXpjXV2cGUERucLJkE6cy/*))\",\n+    # A script similar (same spending policy) to BOLT3's offered HTLC (with anchor outputs)\n+    \"or_d(pk(tpubD6NzVbkrYhZ4XRMcMFMMFvzVt6jaDAtjZhD7JLwdPdMm9xa76DnxYYP7w9TZGJDVFkek3ArwVsuacheqqPog8TH5iBCX1wuig8PLXim4n9a/*),and_v(and_v(v:pk(tpubD6NzVbkrYhZ4WsqRzDmkL82SWcu42JzUvKWzrJHQ8EC2vEHRHkXj1De93sD3biLrKd8XGnamXURGjMbYavbszVDXpjXV2cGUERucLJkE6cy/*),or_c(pk(tpubD6NzVbkrYhZ4YNwtTWrKRJQzQX3PjPKeUQg1gYh1hiLMkk1cw8SRLgB1yb7JzE8bHKNt6EcZXkJ6AqpCZL1aaRSjnG36mLgbQvJZBNsjWnG/*),v:hash160(7f999c905d5e35cefd0a37673f746eb13fba3640))),older(1)))\",\n+    # A Revault Unvault policy with the older() replaced by an after()\n+    \"andor(multi(2,tpubD6NzVbkrYhZ4YMQC15JS7QcrsAyfGrGiykweqMmPxTkEVScu7vCZLNpPXW1XphHwzsgmqdHWDQAfucbM72EEB1ZEyfgZxYvkZjYVXx1xS9p/*,tpubD6NzVbkrYhZ4WkCyc7E3z6g6NkypHMiecnwc4DpWHTPqFdteRGkEKukdrSSyJGNnGrHNMfy4BCw2UXo5soYRCtCDDfy4q8pc8oyB7RgTFv8/*),and_v(v:multi(4,030f64b922aee2fd597f104bc6cb3b670f1ca2c6c49b1071a1a6c010575d94fe5a,02abe475b199ec3d62fa576faee16a334fdb86ffb26dce75becebaaedf328ac3fe,0314f3dc33595b0d016bb522f6fe3a67680723d842c1b9b8ae6b59fdd8ab5cccb4,025eba3305bd3c829e4e1551aac7358e4178832c739e4fc4729effe428de0398ab),after(424242)),thresh(4,pkh(tpubD6NzVbkrYhZ4YVrNggiT2ptVHwnFbLBqDkCtV5HkxR4WtcRLAQReKTkqZGNcV6GE7cQsmpBzzSzhk16DUwB1gn1L7ZPnJF2dnNePP1uMBCY/*),a:pkh(tpubD6NzVbkrYhZ4YU9vM1s53UhD75UyJatx8EMzMZ3VUjR2FciNfLLkAw6a4pWACChzobTseNqdWk4G7ZdBqRDLtLSACKykTScmqibb1ZrCvJu/*),a:pkh(tpubD6NzVbkrYhZ4YUHcFfuH9iEBLiH8CBRJTpS7X3qjHmh82m1KCNbzs6w9gyK8oWHSZmKHWcakAXCGfbKg6xoCvKzQCWAHyxaC7QcWfmzyBf4/*),a:pkh(tpubD6NzVbkrYhZ4XXEmQtS3sgxpJbMyMg4McqRR1Af6ULzyrTRnhwjyr1etPD7svap9oFtJf4MM72brUb5o7uvF2Jyszc5c1t836fJW7SX2e8D/*)))\",\n+    # Liquid-like federated pegin with emergency recovery keys\n+    \"or_i(and_b(pk(029ffbe722b147f3035c87cb1c60b9a5947dd49c774cc31e94773478711a929ac0),a:and_b(pk(025f05815e3a1a8a83bfbb03ce016c9a2ee31066b98f567f6227df1d76ec4bd143),a:and_b(pk(025625f41e4a065efc06d5019cbbd56fe8c07595af1231e7cbc03fafb87ebb71ec),a:and_b(pk(02a27c8b850a00f67da3499b60562673dcf5fdfb82b7e17652a7ac54416812aefd),s:pk(03e618ec5f384d6e19ca9ebdb8e2119e5bef978285076828ce054e55c4daf473e2))))),and_v(v:thresh(2,pkh(tpubD6NzVbkrYhZ4YK67cd5fDe4fBVmGB2waTDrAt1q4ey9HPq9veHjWkw3VpbaCHCcWozjkhgAkWpFrxuPMUrmXVrLHMfEJ9auoZA6AS1g3grC/*),a:pkh(033841045a531e1adf9910a6ec279589a90b3b8a904ee64ffd692bd08a8996c1aa),a:pkh(02aebf2d10b040eb936a6f02f44ee82f8b34f5c1ccb20ff3949c2b28206b7c1068)),older(4209713)))\",\n+]\n+\n+\n+class WalletMiniscriptTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+        self.skip_if_no_sqlite()\n+\n+    def watchonly_test(self, ms):\n+        self.log.info(f\"Importing Miniscript '{ms}'\")\n+        desc = descsum_create(f\"wsh({ms})\")\n+        assert self.ms_wo_wallet.importdescriptors(\n+            [\n+                {\n+                    \"desc\": desc,\n+                    \"active\": True,\n+                    \"range\": 2,\n+                    \"next_index\": 0,\n+                    \"timestamp\": \"now\",\n+                }\n+            ]\n+        )[0][\"success\"]\n+\n+        self.log.info(\"Testing we derive new addresses for it\")\n+        assert_equal(\n+            self.ms_wo_wallet.getnewaddress(), self.funder.deriveaddresses(desc, 0)[0]\n+        )\n+        assert_equal(\n+            self.ms_wo_wallet.getnewaddress(), self.funder.deriveaddresses(desc, 1)[1]\n+        )\n+\n+        self.log.info(\"Testing we detect funds sent to one of them\")\n+        addr = self.ms_wo_wallet.getnewaddress()\n+        txid = self.funder.sendtoaddress(addr, 0.01)\n+        self.wait_until(\n+            lambda: len(self.ms_wo_wallet.listunspent(minconf=0, addresses=[addr])) == 1\n+        )\n+        utxo = self.ms_wo_wallet.listunspent(minconf=0, addresses=[addr])[0]\n+        assert utxo[\"txid\"] == txid and not utxo[\"solvable\"]  # No satisfaction logic (yet)\n+\n+    def run_test(self):\n+        self.log.info(\"Making a descriptor wallet\")\n+        self.funder = self.nodes[0].get_wallet_rpc(self.default_wallet_name)\n+        self.nodes[0].createwallet(\n+            wallet_name=\"ms_wo\", descriptors=True, disable_private_keys=True\n+        )\n+        self.ms_wo_wallet = self.nodes[0].get_wallet_rpc(\"ms_wo\")\n+\n+        # Sanity check we wouldn't let an insane Miniscript descriptor in",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r920477452",
      "id" : 920477452,
      "line" : 72,
      "node_id" : "PRRC_kwDOABII58423V8M",
      "original_commit_id" : "49ac002733157f5629303d1cf59fa3151fdf1e73",
      "original_line" : 72,
      "original_position" : 72,
      "original_start_line" : null,
      "path" : "test/functional/wallet_miniscript.py",
      "position" : 72,
      "pull_request_review_id" : 1037933525,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920477452/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T20:30:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920477452",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r920481462"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920481462"
         }
      },
      "author_association" : "MEMBER",
      "body" : "imo makes more sense to do the rest of the test against an address we explicitly checked was derived correctly(instead of the 3rd one)",
      "commit_id" : "ffc79b8e492c6dd1352e528fd82e45d8d25eaa04",
      "created_at" : "2022-07-13T20:35:45Z",
      "diff_hunk" : "@@ -0,0 +1,93 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test Miniscript descriptors integration in the wallet.\"\"\"\n+\n+from test_framework.descriptors import descsum_create\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+MINISCRIPTS = [\n+    # One of two keys\n+    \"or_b(pk(tpubD6NzVbkrYhZ4XRMcMFMMFvzVt6jaDAtjZhD7JLwdPdMm9xa76DnxYYP7w9TZGJDVFkek3ArwVsuacheqqPog8TH5iBCX1wuig8PLXim4n9a/*),s:pk(tpubD6NzVbkrYhZ4WsqRzDmkL82SWcu42JzUvKWzrJHQ8EC2vEHRHkXj1De93sD3biLrKd8XGnamXURGjMbYavbszVDXpjXV2cGUERucLJkE6cy/*))\",\n+    # A script similar (same spending policy) to BOLT3's offered HTLC (with anchor outputs)\n+    \"or_d(pk(tpubD6NzVbkrYhZ4XRMcMFMMFvzVt6jaDAtjZhD7JLwdPdMm9xa76DnxYYP7w9TZGJDVFkek3ArwVsuacheqqPog8TH5iBCX1wuig8PLXim4n9a/*),and_v(and_v(v:pk(tpubD6NzVbkrYhZ4WsqRzDmkL82SWcu42JzUvKWzrJHQ8EC2vEHRHkXj1De93sD3biLrKd8XGnamXURGjMbYavbszVDXpjXV2cGUERucLJkE6cy/*),or_c(pk(tpubD6NzVbkrYhZ4YNwtTWrKRJQzQX3PjPKeUQg1gYh1hiLMkk1cw8SRLgB1yb7JzE8bHKNt6EcZXkJ6AqpCZL1aaRSjnG36mLgbQvJZBNsjWnG/*),v:hash160(7f999c905d5e35cefd0a37673f746eb13fba3640))),older(1)))\",\n+    # A Revault Unvault policy with the older() replaced by an after()\n+    \"andor(multi(2,tpubD6NzVbkrYhZ4YMQC15JS7QcrsAyfGrGiykweqMmPxTkEVScu7vCZLNpPXW1XphHwzsgmqdHWDQAfucbM72EEB1ZEyfgZxYvkZjYVXx1xS9p/*,tpubD6NzVbkrYhZ4WkCyc7E3z6g6NkypHMiecnwc4DpWHTPqFdteRGkEKukdrSSyJGNnGrHNMfy4BCw2UXo5soYRCtCDDfy4q8pc8oyB7RgTFv8/*),and_v(v:multi(4,030f64b922aee2fd597f104bc6cb3b670f1ca2c6c49b1071a1a6c010575d94fe5a,02abe475b199ec3d62fa576faee16a334fdb86ffb26dce75becebaaedf328ac3fe,0314f3dc33595b0d016bb522f6fe3a67680723d842c1b9b8ae6b59fdd8ab5cccb4,025eba3305bd3c829e4e1551aac7358e4178832c739e4fc4729effe428de0398ab),after(424242)),thresh(4,pkh(tpubD6NzVbkrYhZ4YVrNggiT2ptVHwnFbLBqDkCtV5HkxR4WtcRLAQReKTkqZGNcV6GE7cQsmpBzzSzhk16DUwB1gn1L7ZPnJF2dnNePP1uMBCY/*),a:pkh(tpubD6NzVbkrYhZ4YU9vM1s53UhD75UyJatx8EMzMZ3VUjR2FciNfLLkAw6a4pWACChzobTseNqdWk4G7ZdBqRDLtLSACKykTScmqibb1ZrCvJu/*),a:pkh(tpubD6NzVbkrYhZ4YUHcFfuH9iEBLiH8CBRJTpS7X3qjHmh82m1KCNbzs6w9gyK8oWHSZmKHWcakAXCGfbKg6xoCvKzQCWAHyxaC7QcWfmzyBf4/*),a:pkh(tpubD6NzVbkrYhZ4XXEmQtS3sgxpJbMyMg4McqRR1Af6ULzyrTRnhwjyr1etPD7svap9oFtJf4MM72brUb5o7uvF2Jyszc5c1t836fJW7SX2e8D/*)))\",\n+    # Liquid-like federated pegin with emergency recovery keys\n+    \"or_i(and_b(pk(029ffbe722b147f3035c87cb1c60b9a5947dd49c774cc31e94773478711a929ac0),a:and_b(pk(025f05815e3a1a8a83bfbb03ce016c9a2ee31066b98f567f6227df1d76ec4bd143),a:and_b(pk(025625f41e4a065efc06d5019cbbd56fe8c07595af1231e7cbc03fafb87ebb71ec),a:and_b(pk(02a27c8b850a00f67da3499b60562673dcf5fdfb82b7e17652a7ac54416812aefd),s:pk(03e618ec5f384d6e19ca9ebdb8e2119e5bef978285076828ce054e55c4daf473e2))))),and_v(v:thresh(2,pkh(tpubD6NzVbkrYhZ4YK67cd5fDe4fBVmGB2waTDrAt1q4ey9HPq9veHjWkw3VpbaCHCcWozjkhgAkWpFrxuPMUrmXVrLHMfEJ9auoZA6AS1g3grC/*),a:pkh(033841045a531e1adf9910a6ec279589a90b3b8a904ee64ffd692bd08a8996c1aa),a:pkh(02aebf2d10b040eb936a6f02f44ee82f8b34f5c1ccb20ff3949c2b28206b7c1068)),older(4209713)))\",\n+]\n+\n+\n+class WalletMiniscriptTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+        self.skip_if_no_sqlite()\n+\n+    def watchonly_test(self, ms):\n+        self.log.info(f\"Importing Miniscript '{ms}'\")\n+        desc = descsum_create(f\"wsh({ms})\")\n+        assert self.ms_wo_wallet.importdescriptors(\n+            [\n+                {\n+                    \"desc\": desc,\n+                    \"active\": True,\n+                    \"range\": 2,\n+                    \"next_index\": 0,\n+                    \"timestamp\": \"now\",\n+                }\n+            ]\n+        )[0][\"success\"]\n+\n+        self.log.info(\"Testing we derive new addresses for it\")\n+        assert_equal(\n+            self.ms_wo_wallet.getnewaddress(), self.funder.deriveaddresses(desc, 0)[0]\n+        )\n+        assert_equal(\n+            self.ms_wo_wallet.getnewaddress(), self.funder.deriveaddresses(desc, 1)[1]\n+        )\n+\n+        self.log.info(\"Testing we detect funds sent to one of them\")\n+        addr = self.ms_wo_wallet.getnewaddress()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r920481462",
      "id" : 920481462,
      "line" : 56,
      "node_id" : "PRRC_kwDOABII58423W62",
      "original_commit_id" : "49ac002733157f5629303d1cf59fa3151fdf1e73",
      "original_line" : 56,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "test/functional/wallet_miniscript.py",
      "position" : 56,
      "pull_request_review_id" : 1037947014,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920481462/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-14T13:29:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920481462",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r920627531"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920627531"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: Maybe is `FromPublicKeyBytes()` clearer ?",
      "commit_id" : "49ac002733157f5629303d1cf59fa3151fdf1e73",
      "created_at" : "2022-07-14T01:14:07Z",
      "diff_hunk" : "@@ -1058,6 +1156,94 @@ std::unique_ptr<PubkeyProvider> ParsePubkey(uint32_t key_exp_index, const Span<c\n     return std::make_unique<OriginPubkeyProvider>(key_exp_index, std::move(info), std::move(provider));\n }\n \n+std::unique_ptr<PubkeyProvider> InferPubkey(const CPubKey& pubkey, ParseScriptContext, const SigningProvider& provider)\n+{\n+    std::unique_ptr<PubkeyProvider> key_provider = std::make_unique<ConstPubkeyProvider>(0, pubkey, false);\n+    KeyOriginInfo info;\n+    if (provider.GetKeyOrigin(pubkey.GetID(), info)) {\n+        return std::make_unique<OriginPubkeyProvider>(0, std::move(info), std::move(key_provider));\n+    }\n+    return key_provider;\n+}\n+\n+std::unique_ptr<PubkeyProvider> InferXOnlyPubkey(const XOnlyPubKey& xkey, ParseScriptContext ctx, const SigningProvider& provider)\n+{\n+    unsigned char full_key[CPubKey::COMPRESSED_SIZE] = {0x02};\n+    std::copy(xkey.begin(), xkey.end(), full_key + 1);\n+    CPubKey pubkey(full_key);\n+    std::unique_ptr<PubkeyProvider> key_provider = std::make_unique<ConstPubkeyProvider>(0, pubkey, true);\n+    KeyOriginInfo info;\n+    if (provider.GetKeyOriginByXOnly(xkey, info)) {\n+        return std::make_unique<OriginPubkeyProvider>(0, std::move(info), std::move(key_provider));\n+    }\n+    return key_provider;\n+}\n+\n+/**\n+ * The context for parsing a Miniscript descriptor (either from Script or from its textual representation).\n+ */\n+struct KeyParser {\n+    //! The Key type is an index in DescriptorImpl::m_pubkey_args\n+    using Key = uint32_t;\n+    //! Must not be nullptr if parsing from string.\n+    FlatSigningProvider* m_out;\n+    //! Must not be nullptr if parsing from Script.\n+    const SigningProvider* m_in;\n+    //! List of keys contained in the Miniscript.\n+    mutable std::vector<std::unique_ptr<PubkeyProvider>> m_keys;\n+    //! Used to detect key parsing errors within a Miniscript.\n+    mutable std::string m_key_parsing_error;\n+\n+    KeyParser(FlatSigningProvider* out LIFETIMEBOUND, const SigningProvider* in LIFETIMEBOUND) : m_out(out), m_in(in) {}\n+\n+    bool KeyCompare(const Key& a, const Key& b) const {\n+        return *m_keys[a] < *m_keys[b];\n+    }\n+\n+    template<typename I> std::optional<Key> FromString(I begin, I end) const\n+    {\n+        assert(m_out);\n+        Key key = m_keys.size();\n+        auto pk = ParsePubkey(key, {&*begin, &*end}, ParseScriptContext::P2WSH, *m_out, m_key_parsing_error);\n+        if (!pk) return {};\n+        m_keys.push_back(std::move(pk));\n+        return key;\n+    }\n+\n+    std::optional<std::string> ToString(const Key& key) const\n+    {\n+        return m_keys[key]->ToString();\n+    }\n+\n+    template<typename I> std::optional<Key> FromPKBytes(I begin, I end) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r920627531",
      "id" : 920627531,
      "line" : 1218,
      "node_id" : "PRRC_kwDOABII584236lL",
      "original_commit_id" : "49ac002733157f5629303d1cf59fa3151fdf1e73",
      "original_line" : 1218,
      "original_position" : 206,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 206,
      "pull_request_review_id" : 1038131136,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920627531/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-14T01:24:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920627531",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/94266259?v=4",
         "events_url" : "https://api.github.com/users/w0xlt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/w0xlt/followers",
         "following_url" : "https://api.github.com/users/w0xlt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/w0xlt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/w0xlt",
         "id" : 94266259,
         "login" : "w0xlt",
         "node_id" : "U_kgDOBZ5jkw",
         "organizations_url" : "https://api.github.com/users/w0xlt/orgs",
         "received_events_url" : "https://api.github.com/users/w0xlt/received_events",
         "repos_url" : "https://api.github.com/users/w0xlt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/w0xlt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/w0xlt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/w0xlt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r920627658"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920627658"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: Maybe is `FromPublicKeyHashBytes()` clearer ?",
      "commit_id" : "49ac002733157f5629303d1cf59fa3151fdf1e73",
      "created_at" : "2022-07-14T01:14:28Z",
      "diff_hunk" : "@@ -1058,6 +1156,94 @@ std::unique_ptr<PubkeyProvider> ParsePubkey(uint32_t key_exp_index, const Span<c\n     return std::make_unique<OriginPubkeyProvider>(key_exp_index, std::move(info), std::move(provider));\n }\n \n+std::unique_ptr<PubkeyProvider> InferPubkey(const CPubKey& pubkey, ParseScriptContext, const SigningProvider& provider)\n+{\n+    std::unique_ptr<PubkeyProvider> key_provider = std::make_unique<ConstPubkeyProvider>(0, pubkey, false);\n+    KeyOriginInfo info;\n+    if (provider.GetKeyOrigin(pubkey.GetID(), info)) {\n+        return std::make_unique<OriginPubkeyProvider>(0, std::move(info), std::move(key_provider));\n+    }\n+    return key_provider;\n+}\n+\n+std::unique_ptr<PubkeyProvider> InferXOnlyPubkey(const XOnlyPubKey& xkey, ParseScriptContext ctx, const SigningProvider& provider)\n+{\n+    unsigned char full_key[CPubKey::COMPRESSED_SIZE] = {0x02};\n+    std::copy(xkey.begin(), xkey.end(), full_key + 1);\n+    CPubKey pubkey(full_key);\n+    std::unique_ptr<PubkeyProvider> key_provider = std::make_unique<ConstPubkeyProvider>(0, pubkey, true);\n+    KeyOriginInfo info;\n+    if (provider.GetKeyOriginByXOnly(xkey, info)) {\n+        return std::make_unique<OriginPubkeyProvider>(0, std::move(info), std::move(key_provider));\n+    }\n+    return key_provider;\n+}\n+\n+/**\n+ * The context for parsing a Miniscript descriptor (either from Script or from its textual representation).\n+ */\n+struct KeyParser {\n+    //! The Key type is an index in DescriptorImpl::m_pubkey_args\n+    using Key = uint32_t;\n+    //! Must not be nullptr if parsing from string.\n+    FlatSigningProvider* m_out;\n+    //! Must not be nullptr if parsing from Script.\n+    const SigningProvider* m_in;\n+    //! List of keys contained in the Miniscript.\n+    mutable std::vector<std::unique_ptr<PubkeyProvider>> m_keys;\n+    //! Used to detect key parsing errors within a Miniscript.\n+    mutable std::string m_key_parsing_error;\n+\n+    KeyParser(FlatSigningProvider* out LIFETIMEBOUND, const SigningProvider* in LIFETIMEBOUND) : m_out(out), m_in(in) {}\n+\n+    bool KeyCompare(const Key& a, const Key& b) const {\n+        return *m_keys[a] < *m_keys[b];\n+    }\n+\n+    template<typename I> std::optional<Key> FromString(I begin, I end) const\n+    {\n+        assert(m_out);\n+        Key key = m_keys.size();\n+        auto pk = ParsePubkey(key, {&*begin, &*end}, ParseScriptContext::P2WSH, *m_out, m_key_parsing_error);\n+        if (!pk) return {};\n+        m_keys.push_back(std::move(pk));\n+        return key;\n+    }\n+\n+    std::optional<std::string> ToString(const Key& key) const\n+    {\n+        return m_keys[key]->ToString();\n+    }\n+\n+    template<typename I> std::optional<Key> FromPKBytes(I begin, I end) const\n+    {\n+        assert(m_in);\n+        CPubKey pubkey(begin, end);\n+        if (pubkey.IsValid()) {\n+            Key key = m_keys.size();\n+            m_keys.push_back(InferPubkey(pubkey, ParseScriptContext::P2WSH, *m_in));\n+            return key;\n+        }\n+        return {};\n+    }\n+\n+    template<typename I> std::optional<Key> FromPKHBytes(I begin, I end) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r920627658",
      "id" : 920627658,
      "line" : 1230,
      "node_id" : "PRRC_kwDOABII584236nK",
      "original_commit_id" : "49ac002733157f5629303d1cf59fa3151fdf1e73",
      "original_line" : 1230,
      "original_position" : 218,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 218,
      "pull_request_review_id" : 1038131136,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920627658/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-14T01:24:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920627658",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/94266259?v=4",
         "events_url" : "https://api.github.com/users/w0xlt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/w0xlt/followers",
         "following_url" : "https://api.github.com/users/w0xlt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/w0xlt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/w0xlt",
         "id" : 94266259,
         "login" : "w0xlt",
         "node_id" : "U_kgDOBZ5jkw",
         "organizations_url" : "https://api.github.com/users/w0xlt/orgs",
         "received_events_url" : "https://api.github.com/users/w0xlt/received_events",
         "repos_url" : "https://api.github.com/users/w0xlt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/w0xlt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/w0xlt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/w0xlt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r920966866"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920966866"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It was discussed in the OP of the Miniscript PR, #24147, and is defined in `src/script/miniscript.h`:\r\nhttps://github.com/bitcoin/bitcoin/blob/062b9db0ccb6af8bfbaa2b29132408cda9991b40/src/script/miniscript.h#L842-L846",
      "commit_id" : "49ac002733157f5629303d1cf59fa3151fdf1e73",
      "created_at" : "2022-07-14T09:46:03Z",
      "diff_hunk" : "@@ -0,0 +1,93 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test Miniscript descriptors integration in the wallet.\"\"\"\n+\n+from test_framework.descriptors import descsum_create\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+MINISCRIPTS = [\n+    # One of two keys\n+    \"or_b(pk(tpubD6NzVbkrYhZ4XRMcMFMMFvzVt6jaDAtjZhD7JLwdPdMm9xa76DnxYYP7w9TZGJDVFkek3ArwVsuacheqqPog8TH5iBCX1wuig8PLXim4n9a/*),s:pk(tpubD6NzVbkrYhZ4WsqRzDmkL82SWcu42JzUvKWzrJHQ8EC2vEHRHkXj1De93sD3biLrKd8XGnamXURGjMbYavbszVDXpjXV2cGUERucLJkE6cy/*))\",\n+    # A script similar (same spending policy) to BOLT3's offered HTLC (with anchor outputs)\n+    \"or_d(pk(tpubD6NzVbkrYhZ4XRMcMFMMFvzVt6jaDAtjZhD7JLwdPdMm9xa76DnxYYP7w9TZGJDVFkek3ArwVsuacheqqPog8TH5iBCX1wuig8PLXim4n9a/*),and_v(and_v(v:pk(tpubD6NzVbkrYhZ4WsqRzDmkL82SWcu42JzUvKWzrJHQ8EC2vEHRHkXj1De93sD3biLrKd8XGnamXURGjMbYavbszVDXpjXV2cGUERucLJkE6cy/*),or_c(pk(tpubD6NzVbkrYhZ4YNwtTWrKRJQzQX3PjPKeUQg1gYh1hiLMkk1cw8SRLgB1yb7JzE8bHKNt6EcZXkJ6AqpCZL1aaRSjnG36mLgbQvJZBNsjWnG/*),v:hash160(7f999c905d5e35cefd0a37673f746eb13fba3640))),older(1)))\",\n+    # A Revault Unvault policy with the older() replaced by an after()\n+    \"andor(multi(2,tpubD6NzVbkrYhZ4YMQC15JS7QcrsAyfGrGiykweqMmPxTkEVScu7vCZLNpPXW1XphHwzsgmqdHWDQAfucbM72EEB1ZEyfgZxYvkZjYVXx1xS9p/*,tpubD6NzVbkrYhZ4WkCyc7E3z6g6NkypHMiecnwc4DpWHTPqFdteRGkEKukdrSSyJGNnGrHNMfy4BCw2UXo5soYRCtCDDfy4q8pc8oyB7RgTFv8/*),and_v(v:multi(4,030f64b922aee2fd597f104bc6cb3b670f1ca2c6c49b1071a1a6c010575d94fe5a,02abe475b199ec3d62fa576faee16a334fdb86ffb26dce75becebaaedf328ac3fe,0314f3dc33595b0d016bb522f6fe3a67680723d842c1b9b8ae6b59fdd8ab5cccb4,025eba3305bd3c829e4e1551aac7358e4178832c739e4fc4729effe428de0398ab),after(424242)),thresh(4,pkh(tpubD6NzVbkrYhZ4YVrNggiT2ptVHwnFbLBqDkCtV5HkxR4WtcRLAQReKTkqZGNcV6GE7cQsmpBzzSzhk16DUwB1gn1L7ZPnJF2dnNePP1uMBCY/*),a:pkh(tpubD6NzVbkrYhZ4YU9vM1s53UhD75UyJatx8EMzMZ3VUjR2FciNfLLkAw6a4pWACChzobTseNqdWk4G7ZdBqRDLtLSACKykTScmqibb1ZrCvJu/*),a:pkh(tpubD6NzVbkrYhZ4YUHcFfuH9iEBLiH8CBRJTpS7X3qjHmh82m1KCNbzs6w9gyK8oWHSZmKHWcakAXCGfbKg6xoCvKzQCWAHyxaC7QcWfmzyBf4/*),a:pkh(tpubD6NzVbkrYhZ4XXEmQtS3sgxpJbMyMg4McqRR1Af6ULzyrTRnhwjyr1etPD7svap9oFtJf4MM72brUb5o7uvF2Jyszc5c1t836fJW7SX2e8D/*)))\",\n+    # Liquid-like federated pegin with emergency recovery keys\n+    \"or_i(and_b(pk(029ffbe722b147f3035c87cb1c60b9a5947dd49c774cc31e94773478711a929ac0),a:and_b(pk(025f05815e3a1a8a83bfbb03ce016c9a2ee31066b98f567f6227df1d76ec4bd143),a:and_b(pk(025625f41e4a065efc06d5019cbbd56fe8c07595af1231e7cbc03fafb87ebb71ec),a:and_b(pk(02a27c8b850a00f67da3499b60562673dcf5fdfb82b7e17652a7ac54416812aefd),s:pk(03e618ec5f384d6e19ca9ebdb8e2119e5bef978285076828ce054e55c4daf473e2))))),and_v(v:thresh(2,pkh(tpubD6NzVbkrYhZ4YK67cd5fDe4fBVmGB2waTDrAt1q4ey9HPq9veHjWkw3VpbaCHCcWozjkhgAkWpFrxuPMUrmXVrLHMfEJ9auoZA6AS1g3grC/*),a:pkh(033841045a531e1adf9910a6ec279589a90b3b8a904ee64ffd692bd08a8996c1aa),a:pkh(02aebf2d10b040eb936a6f02f44ee82f8b34f5c1ccb20ff3949c2b28206b7c1068)),older(4209713)))\",\n+]\n+\n+\n+class WalletMiniscriptTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+        self.skip_if_no_sqlite()\n+\n+    def watchonly_test(self, ms):\n+        self.log.info(f\"Importing Miniscript '{ms}'\")\n+        desc = descsum_create(f\"wsh({ms})\")\n+        assert self.ms_wo_wallet.importdescriptors(\n+            [\n+                {\n+                    \"desc\": desc,\n+                    \"active\": True,\n+                    \"range\": 2,\n+                    \"next_index\": 0,\n+                    \"timestamp\": \"now\",\n+                }\n+            ]\n+        )[0][\"success\"]\n+\n+        self.log.info(\"Testing we derive new addresses for it\")\n+        assert_equal(\n+            self.ms_wo_wallet.getnewaddress(), self.funder.deriveaddresses(desc, 0)[0]\n+        )\n+        assert_equal(\n+            self.ms_wo_wallet.getnewaddress(), self.funder.deriveaddresses(desc, 1)[1]\n+        )\n+\n+        self.log.info(\"Testing we detect funds sent to one of them\")\n+        addr = self.ms_wo_wallet.getnewaddress()\n+        txid = self.funder.sendtoaddress(addr, 0.01)\n+        self.wait_until(\n+            lambda: len(self.ms_wo_wallet.listunspent(minconf=0, addresses=[addr])) == 1\n+        )\n+        utxo = self.ms_wo_wallet.listunspent(minconf=0, addresses=[addr])[0]\n+        assert utxo[\"txid\"] == txid and not utxo[\"solvable\"]  # No satisfaction logic (yet)\n+\n+    def run_test(self):\n+        self.log.info(\"Making a descriptor wallet\")\n+        self.funder = self.nodes[0].get_wallet_rpc(self.default_wallet_name)\n+        self.nodes[0].createwallet(\n+            wallet_name=\"ms_wo\", descriptors=True, disable_private_keys=True\n+        )\n+        self.ms_wo_wallet = self.nodes[0].get_wallet_rpc(\"ms_wo\")\n+\n+        # Sanity check we wouldn't let an insane Miniscript descriptor in",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r920966866",
      "id" : 920966866,
      "in_reply_to_id" : 920477452,
      "line" : 72,
      "node_id" : "PRRC_kwDOABII58425NbS",
      "original_commit_id" : "49ac002733157f5629303d1cf59fa3151fdf1e73",
      "original_line" : 72,
      "original_position" : 72,
      "original_start_line" : null,
      "path" : "test/functional/wallet_miniscript.py",
      "position" : 72,
      "pull_request_review_id" : 1038597002,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920966866/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-14T09:46:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920966866",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r920988710"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920988710"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This interface was introduced in #24147, i'm not going to change it and all the callsites now. :)",
      "commit_id" : "ffc79b8e492c6dd1352e528fd82e45d8d25eaa04",
      "created_at" : "2022-07-14T10:10:43Z",
      "diff_hunk" : "@@ -1058,6 +1156,94 @@ std::unique_ptr<PubkeyProvider> ParsePubkey(uint32_t key_exp_index, const Span<c\n     return std::make_unique<OriginPubkeyProvider>(key_exp_index, std::move(info), std::move(provider));\n }\n \n+std::unique_ptr<PubkeyProvider> InferPubkey(const CPubKey& pubkey, ParseScriptContext, const SigningProvider& provider)\n+{\n+    std::unique_ptr<PubkeyProvider> key_provider = std::make_unique<ConstPubkeyProvider>(0, pubkey, false);\n+    KeyOriginInfo info;\n+    if (provider.GetKeyOrigin(pubkey.GetID(), info)) {\n+        return std::make_unique<OriginPubkeyProvider>(0, std::move(info), std::move(key_provider));\n+    }\n+    return key_provider;\n+}\n+\n+std::unique_ptr<PubkeyProvider> InferXOnlyPubkey(const XOnlyPubKey& xkey, ParseScriptContext ctx, const SigningProvider& provider)\n+{\n+    unsigned char full_key[CPubKey::COMPRESSED_SIZE] = {0x02};\n+    std::copy(xkey.begin(), xkey.end(), full_key + 1);\n+    CPubKey pubkey(full_key);\n+    std::unique_ptr<PubkeyProvider> key_provider = std::make_unique<ConstPubkeyProvider>(0, pubkey, true);\n+    KeyOriginInfo info;\n+    if (provider.GetKeyOriginByXOnly(xkey, info)) {\n+        return std::make_unique<OriginPubkeyProvider>(0, std::move(info), std::move(key_provider));\n+    }\n+    return key_provider;\n+}\n+\n+/**\n+ * The context for parsing a Miniscript descriptor (either from Script or from its textual representation).\n+ */\n+struct KeyParser {\n+    //! The Key type is an index in DescriptorImpl::m_pubkey_args\n+    using Key = uint32_t;\n+    //! Must not be nullptr if parsing from string.\n+    FlatSigningProvider* m_out;\n+    //! Must not be nullptr if parsing from Script.\n+    const SigningProvider* m_in;\n+    //! List of keys contained in the Miniscript.\n+    mutable std::vector<std::unique_ptr<PubkeyProvider>> m_keys;\n+    //! Used to detect key parsing errors within a Miniscript.\n+    mutable std::string m_key_parsing_error;\n+\n+    KeyParser(FlatSigningProvider* out LIFETIMEBOUND, const SigningProvider* in LIFETIMEBOUND) : m_out(out), m_in(in) {}\n+\n+    bool KeyCompare(const Key& a, const Key& b) const {\n+        return *m_keys[a] < *m_keys[b];\n+    }\n+\n+    template<typename I> std::optional<Key> FromString(I begin, I end) const\n+    {\n+        assert(m_out);\n+        Key key = m_keys.size();\n+        auto pk = ParsePubkey(key, {&*begin, &*end}, ParseScriptContext::P2WSH, *m_out, m_key_parsing_error);\n+        if (!pk) return {};\n+        m_keys.push_back(std::move(pk));\n+        return key;\n+    }\n+\n+    std::optional<std::string> ToString(const Key& key) const\n+    {\n+        return m_keys[key]->ToString();\n+    }\n+\n+    template<typename I> std::optional<Key> FromPKBytes(I begin, I end) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r920988710",
      "id" : 920988710,
      "in_reply_to_id" : 920627531,
      "line" : 1218,
      "node_id" : "PRRC_kwDOABII58425Swm",
      "original_commit_id" : "49ac002733157f5629303d1cf59fa3151fdf1e73",
      "original_line" : 1218,
      "original_position" : 206,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 206,
      "pull_request_review_id" : 1038627680,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920988710/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-14T10:10:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920988710",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r920989283"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920989283"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same here",
      "commit_id" : "ffc79b8e492c6dd1352e528fd82e45d8d25eaa04",
      "created_at" : "2022-07-14T10:11:25Z",
      "diff_hunk" : "@@ -1058,6 +1156,94 @@ std::unique_ptr<PubkeyProvider> ParsePubkey(uint32_t key_exp_index, const Span<c\n     return std::make_unique<OriginPubkeyProvider>(key_exp_index, std::move(info), std::move(provider));\n }\n \n+std::unique_ptr<PubkeyProvider> InferPubkey(const CPubKey& pubkey, ParseScriptContext, const SigningProvider& provider)\n+{\n+    std::unique_ptr<PubkeyProvider> key_provider = std::make_unique<ConstPubkeyProvider>(0, pubkey, false);\n+    KeyOriginInfo info;\n+    if (provider.GetKeyOrigin(pubkey.GetID(), info)) {\n+        return std::make_unique<OriginPubkeyProvider>(0, std::move(info), std::move(key_provider));\n+    }\n+    return key_provider;\n+}\n+\n+std::unique_ptr<PubkeyProvider> InferXOnlyPubkey(const XOnlyPubKey& xkey, ParseScriptContext ctx, const SigningProvider& provider)\n+{\n+    unsigned char full_key[CPubKey::COMPRESSED_SIZE] = {0x02};\n+    std::copy(xkey.begin(), xkey.end(), full_key + 1);\n+    CPubKey pubkey(full_key);\n+    std::unique_ptr<PubkeyProvider> key_provider = std::make_unique<ConstPubkeyProvider>(0, pubkey, true);\n+    KeyOriginInfo info;\n+    if (provider.GetKeyOriginByXOnly(xkey, info)) {\n+        return std::make_unique<OriginPubkeyProvider>(0, std::move(info), std::move(key_provider));\n+    }\n+    return key_provider;\n+}\n+\n+/**\n+ * The context for parsing a Miniscript descriptor (either from Script or from its textual representation).\n+ */\n+struct KeyParser {\n+    //! The Key type is an index in DescriptorImpl::m_pubkey_args\n+    using Key = uint32_t;\n+    //! Must not be nullptr if parsing from string.\n+    FlatSigningProvider* m_out;\n+    //! Must not be nullptr if parsing from Script.\n+    const SigningProvider* m_in;\n+    //! List of keys contained in the Miniscript.\n+    mutable std::vector<std::unique_ptr<PubkeyProvider>> m_keys;\n+    //! Used to detect key parsing errors within a Miniscript.\n+    mutable std::string m_key_parsing_error;\n+\n+    KeyParser(FlatSigningProvider* out LIFETIMEBOUND, const SigningProvider* in LIFETIMEBOUND) : m_out(out), m_in(in) {}\n+\n+    bool KeyCompare(const Key& a, const Key& b) const {\n+        return *m_keys[a] < *m_keys[b];\n+    }\n+\n+    template<typename I> std::optional<Key> FromString(I begin, I end) const\n+    {\n+        assert(m_out);\n+        Key key = m_keys.size();\n+        auto pk = ParsePubkey(key, {&*begin, &*end}, ParseScriptContext::P2WSH, *m_out, m_key_parsing_error);\n+        if (!pk) return {};\n+        m_keys.push_back(std::move(pk));\n+        return key;\n+    }\n+\n+    std::optional<std::string> ToString(const Key& key) const\n+    {\n+        return m_keys[key]->ToString();\n+    }\n+\n+    template<typename I> std::optional<Key> FromPKBytes(I begin, I end) const\n+    {\n+        assert(m_in);\n+        CPubKey pubkey(begin, end);\n+        if (pubkey.IsValid()) {\n+            Key key = m_keys.size();\n+            m_keys.push_back(InferPubkey(pubkey, ParseScriptContext::P2WSH, *m_in));\n+            return key;\n+        }\n+        return {};\n+    }\n+\n+    template<typename I> std::optional<Key> FromPKHBytes(I begin, I end) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r920989283",
      "id" : 920989283,
      "in_reply_to_id" : 920627658,
      "line" : 1230,
      "node_id" : "PRRC_kwDOABII58425S5j",
      "original_commit_id" : "49ac002733157f5629303d1cf59fa3151fdf1e73",
      "original_line" : 1230,
      "original_position" : 218,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 218,
      "pull_request_review_id" : 1038628504,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920989283/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-14T10:11:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920989283",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks @w0xlt, good catch: it's the unit test for `FindInsaneSub` i just added that i had only tested on the tip of the branch. I've swapped the two first commits now and they all individually compile and pass the tests.\r\n\r\n@Sjors \r\n> interestingly even BOOST_CHECK(ms_ins); fails.\r\n\r\ni was missing an `a:` wrapper for the second `after`, i've added a check that the Miniscript is valid (which does not change the test since an invalid sub is necessarily insane):\r\n```diff\r\ndiff --git a/src/test/miniscript_tests.cpp b/src/test/miniscript_tests.cpp\r\nindex f5bea00e1e..bc5c49ef63 100644\r\n--- a/src/test/miniscript_tests.cpp\r\n+++ b/src/test/miniscript_tests.cpp\r\n@@ -299,10 +299,10 @@ BOOST_AUTO_TEST_CASE(fixed_tests)\r\n     // 2. It contains timelock mixes\r\n     // We'll report the timelock mix error, as it's \"deeper\" (closer to be a leaf node) than the \"no 's' property\"\r\n     // error is.\r\n-    const auto ms_ins = miniscript::FromString(\"or_i(and_b(after(1),after(10000000)),pk(03cdabb7f2dce7bfbd8a0b9570c6fd1e712e5d64045e9d6b517b3d5072251dc204))\", CONVERTER);\r\n-    BOOST_CHECK(ms_ins && !ms_ins->IsSane());\r\n+    const auto ms_ins = miniscript::FromString(\"or_i(and_b(after(1),a:after(1000000000)),pk(03cdabb7f2dce7bfbd8a0b9570c6fd1e712e5d64045e9d6b517b3d5072251dc204))\", CONVERTER);\r\n+    BOOST_CHECK(ms_ins && ms_ins->IsValid() && !ms_ins->IsSane());\r\n     const auto insane_sub = ms_ins->FindInsaneSub();\r\n-    BOOST_CHECK(insane_sub && *insane_sub->ToString(CONVERTER) == \"and_b(after(1),after(10000000))\");\r\n+    BOOST_CHECK(insane_sub && *insane_sub->ToString(CONVERTER) == \"and_b(after(1),a:after(1000000000))\");\r\n \r\n     // Timelock tests\r\n     Test(\"after(100)\", \"?\", TESTMODE_VALID | TESTMODE_NONMAL); // only heightlock\r\n```\r\n\r\nI also took the opportunity to fix the two nits @Sjors had previously.",
      "created_at" : "2022-07-14T10:17:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#issuecomment-1184263500",
      "id" : 1184263500,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24148",
      "node_id" : "IC_kwDOABII585Glm1M",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1184263500/reactions"
      },
      "updated_at" : "2022-07-14T10:17:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1184263500",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "It's still a bit weird that a `BOOST_CHECK` doesn't just fail but hits a \"no mapping at fault address\" when the miniscript can't be parsed. You're following the same pattern as other tests though.",
      "created_at" : "2022-07-14T12:10:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#issuecomment-1184371480",
      "id" : 1184371480,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24148",
      "node_id" : "IC_kwDOABII585GmBMY",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1184371480/reactions"
      },
      "updated_at" : "2022-07-14T12:10:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1184371480",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-utACK ffc79b8e492c6dd1352e528fd82e45d8d25eaa04",
      "created_at" : "2022-07-14T12:16:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#issuecomment-1184376100",
      "id" : 1184376100,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24148",
      "node_id" : "IC_kwDOABII585GmCUk",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1184376100/reactions"
      },
      "updated_at" : "2022-07-14T12:17:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1184376100",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r921149205"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921149205"
         }
      },
      "author_association" : "MEMBER",
      "body" : "sure, what I mean is \"assuming this is merged, as a reader of the test, what is this?\" i.e. should include link or self contained definition \r\n\r\n",
      "commit_id" : "ffc79b8e492c6dd1352e528fd82e45d8d25eaa04",
      "created_at" : "2022-07-14T13:22:15Z",
      "diff_hunk" : "@@ -0,0 +1,93 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test Miniscript descriptors integration in the wallet.\"\"\"\n+\n+from test_framework.descriptors import descsum_create\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+MINISCRIPTS = [\n+    # One of two keys\n+    \"or_b(pk(tpubD6NzVbkrYhZ4XRMcMFMMFvzVt6jaDAtjZhD7JLwdPdMm9xa76DnxYYP7w9TZGJDVFkek3ArwVsuacheqqPog8TH5iBCX1wuig8PLXim4n9a/*),s:pk(tpubD6NzVbkrYhZ4WsqRzDmkL82SWcu42JzUvKWzrJHQ8EC2vEHRHkXj1De93sD3biLrKd8XGnamXURGjMbYavbszVDXpjXV2cGUERucLJkE6cy/*))\",\n+    # A script similar (same spending policy) to BOLT3's offered HTLC (with anchor outputs)\n+    \"or_d(pk(tpubD6NzVbkrYhZ4XRMcMFMMFvzVt6jaDAtjZhD7JLwdPdMm9xa76DnxYYP7w9TZGJDVFkek3ArwVsuacheqqPog8TH5iBCX1wuig8PLXim4n9a/*),and_v(and_v(v:pk(tpubD6NzVbkrYhZ4WsqRzDmkL82SWcu42JzUvKWzrJHQ8EC2vEHRHkXj1De93sD3biLrKd8XGnamXURGjMbYavbszVDXpjXV2cGUERucLJkE6cy/*),or_c(pk(tpubD6NzVbkrYhZ4YNwtTWrKRJQzQX3PjPKeUQg1gYh1hiLMkk1cw8SRLgB1yb7JzE8bHKNt6EcZXkJ6AqpCZL1aaRSjnG36mLgbQvJZBNsjWnG/*),v:hash160(7f999c905d5e35cefd0a37673f746eb13fba3640))),older(1)))\",\n+    # A Revault Unvault policy with the older() replaced by an after()\n+    \"andor(multi(2,tpubD6NzVbkrYhZ4YMQC15JS7QcrsAyfGrGiykweqMmPxTkEVScu7vCZLNpPXW1XphHwzsgmqdHWDQAfucbM72EEB1ZEyfgZxYvkZjYVXx1xS9p/*,tpubD6NzVbkrYhZ4WkCyc7E3z6g6NkypHMiecnwc4DpWHTPqFdteRGkEKukdrSSyJGNnGrHNMfy4BCw2UXo5soYRCtCDDfy4q8pc8oyB7RgTFv8/*),and_v(v:multi(4,030f64b922aee2fd597f104bc6cb3b670f1ca2c6c49b1071a1a6c010575d94fe5a,02abe475b199ec3d62fa576faee16a334fdb86ffb26dce75becebaaedf328ac3fe,0314f3dc33595b0d016bb522f6fe3a67680723d842c1b9b8ae6b59fdd8ab5cccb4,025eba3305bd3c829e4e1551aac7358e4178832c739e4fc4729effe428de0398ab),after(424242)),thresh(4,pkh(tpubD6NzVbkrYhZ4YVrNggiT2ptVHwnFbLBqDkCtV5HkxR4WtcRLAQReKTkqZGNcV6GE7cQsmpBzzSzhk16DUwB1gn1L7ZPnJF2dnNePP1uMBCY/*),a:pkh(tpubD6NzVbkrYhZ4YU9vM1s53UhD75UyJatx8EMzMZ3VUjR2FciNfLLkAw6a4pWACChzobTseNqdWk4G7ZdBqRDLtLSACKykTScmqibb1ZrCvJu/*),a:pkh(tpubD6NzVbkrYhZ4YUHcFfuH9iEBLiH8CBRJTpS7X3qjHmh82m1KCNbzs6w9gyK8oWHSZmKHWcakAXCGfbKg6xoCvKzQCWAHyxaC7QcWfmzyBf4/*),a:pkh(tpubD6NzVbkrYhZ4XXEmQtS3sgxpJbMyMg4McqRR1Af6ULzyrTRnhwjyr1etPD7svap9oFtJf4MM72brUb5o7uvF2Jyszc5c1t836fJW7SX2e8D/*)))\",\n+    # Liquid-like federated pegin with emergency recovery keys\n+    \"or_i(and_b(pk(029ffbe722b147f3035c87cb1c60b9a5947dd49c774cc31e94773478711a929ac0),a:and_b(pk(025f05815e3a1a8a83bfbb03ce016c9a2ee31066b98f567f6227df1d76ec4bd143),a:and_b(pk(025625f41e4a065efc06d5019cbbd56fe8c07595af1231e7cbc03fafb87ebb71ec),a:and_b(pk(02a27c8b850a00f67da3499b60562673dcf5fdfb82b7e17652a7ac54416812aefd),s:pk(03e618ec5f384d6e19ca9ebdb8e2119e5bef978285076828ce054e55c4daf473e2))))),and_v(v:thresh(2,pkh(tpubD6NzVbkrYhZ4YK67cd5fDe4fBVmGB2waTDrAt1q4ey9HPq9veHjWkw3VpbaCHCcWozjkhgAkWpFrxuPMUrmXVrLHMfEJ9auoZA6AS1g3grC/*),a:pkh(033841045a531e1adf9910a6ec279589a90b3b8a904ee64ffd692bd08a8996c1aa),a:pkh(02aebf2d10b040eb936a6f02f44ee82f8b34f5c1ccb20ff3949c2b28206b7c1068)),older(4209713)))\",\n+]\n+\n+\n+class WalletMiniscriptTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+        self.skip_if_no_sqlite()\n+\n+    def watchonly_test(self, ms):\n+        self.log.info(f\"Importing Miniscript '{ms}'\")\n+        desc = descsum_create(f\"wsh({ms})\")\n+        assert self.ms_wo_wallet.importdescriptors(\n+            [\n+                {\n+                    \"desc\": desc,\n+                    \"active\": True,\n+                    \"range\": 2,\n+                    \"next_index\": 0,\n+                    \"timestamp\": \"now\",\n+                }\n+            ]\n+        )[0][\"success\"]\n+\n+        self.log.info(\"Testing we derive new addresses for it\")\n+        assert_equal(\n+            self.ms_wo_wallet.getnewaddress(), self.funder.deriveaddresses(desc, 0)[0]\n+        )\n+        assert_equal(\n+            self.ms_wo_wallet.getnewaddress(), self.funder.deriveaddresses(desc, 1)[1]\n+        )\n+\n+        self.log.info(\"Testing we detect funds sent to one of them\")\n+        addr = self.ms_wo_wallet.getnewaddress()\n+        txid = self.funder.sendtoaddress(addr, 0.01)\n+        self.wait_until(\n+            lambda: len(self.ms_wo_wallet.listunspent(minconf=0, addresses=[addr])) == 1\n+        )\n+        utxo = self.ms_wo_wallet.listunspent(minconf=0, addresses=[addr])[0]\n+        assert utxo[\"txid\"] == txid and not utxo[\"solvable\"]  # No satisfaction logic (yet)\n+\n+    def run_test(self):\n+        self.log.info(\"Making a descriptor wallet\")\n+        self.funder = self.nodes[0].get_wallet_rpc(self.default_wallet_name)\n+        self.nodes[0].createwallet(\n+            wallet_name=\"ms_wo\", descriptors=True, disable_private_keys=True\n+        )\n+        self.ms_wo_wallet = self.nodes[0].get_wallet_rpc(\"ms_wo\")\n+\n+        # Sanity check we wouldn't let an insane Miniscript descriptor in",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r921149205",
      "id" : 921149205,
      "in_reply_to_id" : 920477452,
      "line" : 72,
      "node_id" : "PRRC_kwDOABII5842558V",
      "original_commit_id" : "49ac002733157f5629303d1cf59fa3151fdf1e73",
      "original_line" : 72,
      "original_position" : 72,
      "original_start_line" : null,
      "path" : "test/functional/wallet_miniscript.py",
      "position" : 72,
      "pull_request_review_id" : 1037947014,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921149205/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-14T13:29:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921149205",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK ffc79b8e492c6dd1352e528fd82e45d8d25eaa04",
      "created_at" : "2022-07-14T18:33:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#issuecomment-1184772200",
      "id" : 1184772200,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24148",
      "node_id" : "IC_kwDOABII585GnjBo",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1184772200/reactions"
      },
      "updated_at" : "2022-07-14T18:33:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1184772200",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Opening a miniscript-descriptor wallet in an older version of Bitcoin Core causes a crash. (How) did we handle backward compatibility for `tr()` descriptors? Do we want to set a flag each time? Of have some generic mechanism to abort loading a wallet that has unrecognised descriptor / miniscript fragment?",
      "created_at" : "2022-07-19T18:23:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#issuecomment-1189415605",
      "id" : 1189415605,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24148",
      "node_id" : "IC_kwDOABII585G5Qq1",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1189415605/reactions"
      },
      "updated_at" : "2022-07-19T18:23:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1189415605",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r924876846"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924876846"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I get two compiler warnings on master from this, `gcc (Ubuntu 9.4.0-1ubuntu1~20.04.1) 9.4.0`:\r\n```\r\nscript/descriptor.cpp: In function âminiscript::NodeRef<Key> miniscript::internal::DecodeScript(I&, I, const Ctx&) [with Key = unsigned int; Ctx = {anonymous}::KeyParser; I = __gnu_cxx::__normal_iterator<std::pair<opcodetype, std::vector<unsigned char> >*, std::vector<std::pair<opcodetype, std::vector<unsigned char> > > >]â:\r\nscript/descriptor.cpp:1243:17: warning: â<anonymous>â may be used uninitialized in this function [-Wmaybe-uninitialized]\r\n 1243 |         return {};\r\n      |                 ^\r\nscript/descriptor.cpp: In function âminiscript::NodeRef<Key> miniscript::internal::Parse(Span<const char>, const Ctx&) [with Key = unsigned int; Ctx = {anonymous}::KeyParser]â:\r\nscript/descriptor.cpp:1208:26: warning: â<anonymous>â may be used uninitialized in this function [-Wmaybe-uninitialized]\r\n 1208 |         if (!pk) return {};\r\n```\r\n",
      "commit_id" : "ffc79b8e492c6dd1352e528fd82e45d8d25eaa04",
      "created_at" : "2022-07-19T19:19:39Z",
      "diff_hunk" : "@@ -1058,6 +1156,94 @@ std::unique_ptr<PubkeyProvider> ParsePubkey(uint32_t key_exp_index, const Span<c\n     return std::make_unique<OriginPubkeyProvider>(key_exp_index, std::move(info), std::move(provider));\n }\n \n+std::unique_ptr<PubkeyProvider> InferPubkey(const CPubKey& pubkey, ParseScriptContext, const SigningProvider& provider)\n+{\n+    std::unique_ptr<PubkeyProvider> key_provider = std::make_unique<ConstPubkeyProvider>(0, pubkey, false);\n+    KeyOriginInfo info;\n+    if (provider.GetKeyOrigin(pubkey.GetID(), info)) {\n+        return std::make_unique<OriginPubkeyProvider>(0, std::move(info), std::move(key_provider));\n+    }\n+    return key_provider;\n+}\n+\n+std::unique_ptr<PubkeyProvider> InferXOnlyPubkey(const XOnlyPubKey& xkey, ParseScriptContext ctx, const SigningProvider& provider)\n+{\n+    unsigned char full_key[CPubKey::COMPRESSED_SIZE] = {0x02};\n+    std::copy(xkey.begin(), xkey.end(), full_key + 1);\n+    CPubKey pubkey(full_key);\n+    std::unique_ptr<PubkeyProvider> key_provider = std::make_unique<ConstPubkeyProvider>(0, pubkey, true);\n+    KeyOriginInfo info;\n+    if (provider.GetKeyOriginByXOnly(xkey, info)) {\n+        return std::make_unique<OriginPubkeyProvider>(0, std::move(info), std::move(key_provider));\n+    }\n+    return key_provider;\n+}\n+\n+/**\n+ * The context for parsing a Miniscript descriptor (either from Script or from its textual representation).\n+ */\n+struct KeyParser {\n+    //! The Key type is an index in DescriptorImpl::m_pubkey_args\n+    using Key = uint32_t;\n+    //! Must not be nullptr if parsing from string.\n+    FlatSigningProvider* m_out;\n+    //! Must not be nullptr if parsing from Script.\n+    const SigningProvider* m_in;\n+    //! List of keys contained in the Miniscript.\n+    mutable std::vector<std::unique_ptr<PubkeyProvider>> m_keys;\n+    //! Used to detect key parsing errors within a Miniscript.\n+    mutable std::string m_key_parsing_error;\n+\n+    KeyParser(FlatSigningProvider* out LIFETIMEBOUND, const SigningProvider* in LIFETIMEBOUND) : m_out(out), m_in(in) {}\n+\n+    bool KeyCompare(const Key& a, const Key& b) const {\n+        return *m_keys.at(a) < *m_keys.at(b);\n+    }\n+\n+    template<typename I> std::optional<Key> FromString(I begin, I end) const\n+    {\n+        assert(m_out);\n+        Key key = m_keys.size();\n+        auto pk = ParsePubkey(key, {&*begin, &*end}, ParseScriptContext::P2WSH, *m_out, m_key_parsing_error);\n+        if (!pk) return {};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r924876846",
      "id" : 924876846,
      "line" : 1208,
      "node_id" : "PRRC_kwDOABII5843IIAu",
      "original_commit_id" : "bfb036756ad6e187fd6d3abfefe5804bb54a5c71",
      "original_line" : 1208,
      "original_position" : 196,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 196,
      "pull_request_review_id" : 1043963753,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924876846/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-19T19:19:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924876846",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r924960870"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924960870"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I believe that's a known false positive in certain GCC versions.",
      "commit_id" : "ffc79b8e492c6dd1352e528fd82e45d8d25eaa04",
      "created_at" : "2022-07-19T21:11:38Z",
      "diff_hunk" : "@@ -1058,6 +1156,94 @@ std::unique_ptr<PubkeyProvider> ParsePubkey(uint32_t key_exp_index, const Span<c\n     return std::make_unique<OriginPubkeyProvider>(key_exp_index, std::move(info), std::move(provider));\n }\n \n+std::unique_ptr<PubkeyProvider> InferPubkey(const CPubKey& pubkey, ParseScriptContext, const SigningProvider& provider)\n+{\n+    std::unique_ptr<PubkeyProvider> key_provider = std::make_unique<ConstPubkeyProvider>(0, pubkey, false);\n+    KeyOriginInfo info;\n+    if (provider.GetKeyOrigin(pubkey.GetID(), info)) {\n+        return std::make_unique<OriginPubkeyProvider>(0, std::move(info), std::move(key_provider));\n+    }\n+    return key_provider;\n+}\n+\n+std::unique_ptr<PubkeyProvider> InferXOnlyPubkey(const XOnlyPubKey& xkey, ParseScriptContext ctx, const SigningProvider& provider)\n+{\n+    unsigned char full_key[CPubKey::COMPRESSED_SIZE] = {0x02};\n+    std::copy(xkey.begin(), xkey.end(), full_key + 1);\n+    CPubKey pubkey(full_key);\n+    std::unique_ptr<PubkeyProvider> key_provider = std::make_unique<ConstPubkeyProvider>(0, pubkey, true);\n+    KeyOriginInfo info;\n+    if (provider.GetKeyOriginByXOnly(xkey, info)) {\n+        return std::make_unique<OriginPubkeyProvider>(0, std::move(info), std::move(key_provider));\n+    }\n+    return key_provider;\n+}\n+\n+/**\n+ * The context for parsing a Miniscript descriptor (either from Script or from its textual representation).\n+ */\n+struct KeyParser {\n+    //! The Key type is an index in DescriptorImpl::m_pubkey_args\n+    using Key = uint32_t;\n+    //! Must not be nullptr if parsing from string.\n+    FlatSigningProvider* m_out;\n+    //! Must not be nullptr if parsing from Script.\n+    const SigningProvider* m_in;\n+    //! List of keys contained in the Miniscript.\n+    mutable std::vector<std::unique_ptr<PubkeyProvider>> m_keys;\n+    //! Used to detect key parsing errors within a Miniscript.\n+    mutable std::string m_key_parsing_error;\n+\n+    KeyParser(FlatSigningProvider* out LIFETIMEBOUND, const SigningProvider* in LIFETIMEBOUND) : m_out(out), m_in(in) {}\n+\n+    bool KeyCompare(const Key& a, const Key& b) const {\n+        return *m_keys.at(a) < *m_keys.at(b);\n+    }\n+\n+    template<typename I> std::optional<Key> FromString(I begin, I end) const\n+    {\n+        assert(m_out);\n+        Key key = m_keys.size();\n+        auto pk = ParsePubkey(key, {&*begin, &*end}, ParseScriptContext::P2WSH, *m_out, m_key_parsing_error);\n+        if (!pk) return {};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#discussion_r924960870",
      "id" : 924960870,
      "in_reply_to_id" : 924876846,
      "line" : 1208,
      "node_id" : "PRRC_kwDOABII5843Ichm",
      "original_commit_id" : "bfb036756ad6e187fd6d3abfefe5804bb54a5c71",
      "original_line" : 1208,
      "original_position" : 196,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 196,
      "pull_request_review_id" : 1044086481,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24148",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924960870/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-19T21:11:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924960870",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Opening a miniscript-descriptor wallet in an older version of Bitcoin Core causes a crash. (How) did we handle backward compatibility for `tr()` descriptors? Do we want to set a flag each time? Of have some generic mechanism to abort loading a wallet that has unrecognised descriptor / miniscript fragment?\r\n\r\nNot sure how it was done with `tr()` descriptors. But before `CWallet::SetMinVersion` was used to handle wallet compatibility with various software versions.",
      "created_at" : "2022-07-21T07:39:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24148#issuecomment-1191151252",
      "id" : 1191151252,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24148",
      "node_id" : "IC_kwDOABII585G_4aU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1191151252/reactions"
      },
      "updated_at" : "2022-07-21T07:39:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1191151252",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   }
]
