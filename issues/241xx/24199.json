{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "Addresses review feedback by Marco Falke in https://github.com/bitcoin/bitcoin/pull/22932#discussion_r794493058:\r\n\r\n1. add `cs_main` thread safety annotation to `CBlockTreeDB::WriteBatchSync()`, which allows us to\r\n\r\n2. remove the `cs_main` lock in `CDiskBlockIndex::SERIALIZE_METHODS` with respect to its 2 callers in the codebase, `CBlockTreeDB::LoadBlockIndexGuts()` and `CBlockTreeDB::WriteBatchSync()`,  that already hold the lock and whose callers hold the lock.\r\n\r\nI didn't manage to remove the thread safety warnings generated by the fuzz tests (suggestions welcome) and resolved them here with a `NO_THREAD_SAFETY_ANALYSIS` annotation and explanatory documentation.",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 0,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24199/comments",
   "created_at" : "2022-01-29T00:10:22Z",
   "draft" : false,
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24199/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/24199",
   "id" : 1117962182,
   "labels" : [],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24199/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "PR_kwDOABII584xw855",
   "number" : 24199,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/24199.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24199",
      "merged_at" : null,
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/24199.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24199"
   },
   "reactions" : {
      "+1" : 0,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 0,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24199/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24199/timeline",
   "title" : "Add cs_main annotation to WriteBatchSync(), drop lock in CDiskBlockIndex",
   "updated_at" : "2022-01-29T00:10:22Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24199",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
      "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
      "followers_url" : "https://api.github.com/users/jonatack/followers",
      "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/jonatack",
      "id" : 2415484,
      "login" : "jonatack",
      "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
      "organizations_url" : "https://api.github.com/users/jonatack/orgs",
      "received_events_url" : "https://api.github.com/users/jonatack/received_events",
      "repos_url" : "https://api.github.com/users/jonatack/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/jonatack"
   }
}
