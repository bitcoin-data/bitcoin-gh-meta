[
   {
      "author_association" : "MEMBER",
      "body" : "utACK 0d58b577dd00df9fb15b71f77ab59545a5a1f95c\r\n\r\nThanks for fixing this annoying warning!",
      "created_at" : "2018-03-13T20:46:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12680#issuecomment-372812649",
      "id" : 372812649,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12680",
      "updated_at" : "2018-03-13T20:52:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/372812649",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "LGTM, utACK https://github.com/bitcoin/bitcoin/commit/0d58b577dd00df9fb15b71f77ab59545a5a1f95c",
      "created_at" : "2018-03-13T20:51:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12680#issuecomment-372813934",
      "id" : 372813934,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12680",
      "updated_at" : "2018-03-13T20:51:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/372813934",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 0d58b57",
      "created_at" : "2018-03-14T00:27:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12680#issuecomment-372864495",
      "id" : 372864495,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12680",
      "updated_at" : "2018-03-14T00:27:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/372864495",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "It seems strange to fix this in the derived class.\r\n\r\nIf a virtual destructor is added to `CValidationInterface` and `CNetEventsInterface` instead it will automatically fix it for all possible future derived classes for these interfaces.",
      "created_at" : "2018-03-14T00:33:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12680#issuecomment-372865331",
      "id" : 372865331,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12680",
      "updated_at" : "2018-03-14T00:33:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/372865331",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Edit: responded before seeing @sipa's comment. That would work as well, I'd just rather go ahead and make PeerLogicValidation explicitly non-derivable, as only bad things could come from doing that :)\r\n\r\n---\r\n\r\nThe issue here isn't PeerLogicValidation's lack of virtual destructor, it's that it's possible to delete a PeerLogicValidation through a base CValidationInterface or NetEventsInterface pointer, or even something derived from PeerLogicValidation.\r\n\r\nMaking PeerLogicValidation's destructor virtual would only muddy the situation further, making it appear as though it's meant to be derived-from. Instead, I'd rather we address the actual issue by making sure that a PeerLogicValidation can't be deleted through a base or derived class.\r\n\r\nWe can address that, while potentially benefiting from extra devirtualization, by marking the interface destructors as protected, and the derived class as final. That should also shut clang up :)\r\n\r\n```patch\r\n--- a/src/net.h\r\n+++ b/src/net.h\r\n@@ -466,11 +466,17 @@ struct CombinerAll\r\n  */\r\n class NetEventsInterface\r\n {\r\n-public:\r\n+protected:\r\n     virtual bool ProcessMessages(CNode* pnode, std::atomic<bool>& interrupt) = 0;\r\n     virtual bool SendMessages(CNode* pnode, std::atomic<bool>& interrupt) = 0;\r\n     virtual void InitializeNode(CNode* pnode) = 0;\r\n     virtual void FinalizeNode(NodeId id, bool& update_connection_time) = 0;\r\n+    /**\r\n+     *\r\n+     * Protected destructor so that instances can only be deleted by derived classes.\r\n+     * If that restriction is no longer desired, this should be made public and virtual.\r\n+     */\r\n+    ~NetEventsInterface() = default;\r\n };\r\n\r\n enum\r\n--- a/src/net_processing.h\r\n+++ b/src/net_processing.h\r\n@@ -35,7 +35,7 @@ static constexpr int64_t EXTRA_PEER_CHECK_INTERVAL = 45;\r\n /** Minimum time an outbound-peer-eviction candidate must be connected for, in order to evict, in seconds */\r\n static constexpr int64_t MINIMUM_CONNECT_TIME = 30;\r\n\r\n-class PeerLogicValidation : public CValidationInterface, public NetEventsInterface {\r\n+class PeerLogicValidation final : public CValidationInterface, public NetEventsInterface {\r\n private:\r\n     CConnman* const connman;\r\n\r\n--- a/src/validationinterface.h\r\n+++ b/src/validationinterface.h\r\n@@ -56,6 +56,12 @@ void SyncWithValidationInterfaceQueue();\r\n class CValidationInterface {\r\n protected:\r\n     /**\r\n+     *\r\n+     * Protected destructor so that instances can only be deleted by derived classes.\r\n+     * If that restriction is no longer desired, this should be made public and virtual.\r\n+     */\r\n+    ~CValidationInterface() = default;\r\n+    /**\r\n      * Notifies listeners of updated block chain tip\r\n      *\r\n      * Called on a background thread.\r\n```",
      "created_at" : "2018-03-14T04:25:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12680#issuecomment-372900582",
      "id" : 372900582,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12680",
      "updated_at" : "2018-03-14T04:29:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/372900582",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Allright, removed `Trivial:` from the pull request subject and pushed a new patch.",
      "created_at" : "2018-03-14T09:12:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12680#issuecomment-372952438",
      "id" : 372952438,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12680",
      "updated_at" : "2018-03-14T09:12:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/372952438",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "utACK 2b3ea39\r\n\r\n> The issue here isn't PeerLogicValidation's lack of virtual destructor, it's that it's possible to delete a PeerLogicValidation through a base CValidationInterface or NetEventsInterface pointer, or even something derived from PeerLogicValidation.\r\n\r\nTIL. I thought that was a necessity for base classes w/ virtual methods. But avoiding this behavior if it's unused is certainly better.",
      "created_at" : "2018-03-14T09:25:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12680#issuecomment-372955766",
      "id" : 372955766,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12680",
      "updated_at" : "2018-03-14T09:25:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/372955766",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 2b3ea39de40bc7754cab558245e4ddac1b261750",
      "created_at" : "2018-03-14T09:32:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12680#issuecomment-372957858",
      "id" : 372957858,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12680",
      "updated_at" : "2018-03-14T09:32:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/372957858",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   }
]
