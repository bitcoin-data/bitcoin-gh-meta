[
   {
      "author_association" : "MEMBER",
      "body" : "Don't forget to add a test.",
      "created_at" : "2018-03-07T13:02:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12630#issuecomment-371131245",
      "id" : 371131245,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12630",
      "updated_at" : "2018-03-07T13:02:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/371131245",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12630#discussion_r172838928"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12630"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172838928"
         }
      },
      "author_association" : "OWNER",
      "body" : "no need for lexical cast and uuid here: you can use `fs::unique_path` if it needs to be unique, but I'm not sure if hardcoding a name for the probe file wouldn't be better for troubleshooting.\r\n\r\nAnother (potentially better, as it will follow for wallet paths too) possibility would be to report a different failure from the LockDirectory function, as creating the lock file is done separately. E.g. change this to actually report an error:\r\n```\r\n    // Create empty lock file if it doesn't exist.\r\n    FILE* file = fsbridge::fopen(pathLockFile, \"a\");\r\n    if (file) fclose(file);\r\n```",
      "commit_id" : "6df3caf6e9a3322bdd5b165c81504a64795b7a97",
      "created_at" : "2018-03-07T13:21:30Z",
      "diff_hunk" : "@@ -418,6 +422,20 @@ void ReleaseDirectoryLocks()\n     dir_locks.clear();\n }\n \n+bool DirIsWritable(const fs::path& directory)\n+{\n+    // Use a UUID for a unique temp filename.\n+    fs::path tmpFile = directory / boost::lexical_cast<std::string>((boost::uuids::random_generator())());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12630#discussion_r172838928",
      "id" : 172838928,
      "original_commit_id" : "6df3caf6e9a3322bdd5b165c81504a64795b7a97",
      "original_position" : 18,
      "path" : "src/util.cpp",
      "position" : 18,
      "pull_request_review_id" : 101923470,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12630",
      "updated_at" : "2018-03-07T13:32:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172838928",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, but please try to solve this without introducing more Boost usage. We want to get rid of Boost Ã¢ÂÂ see https://github.com/bitcoin/bitcoin/projects/3 :-)",
      "created_at" : "2018-03-07T14:08:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12630#issuecomment-371149073",
      "id" : 371149073,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12630",
      "updated_at" : "2018-03-07T14:08:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/371149073",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK.  I agree with not needing UUID, etc., and not using the Boost libraries.",
      "created_at" : "2018-03-07T15:18:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12630#issuecomment-371171788",
      "id" : 371171788,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12630",
      "updated_at" : "2018-03-07T15:18:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/371171788",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/33541170?v=4",
         "events_url" : "https://api.github.com/users/randolf/events{/privacy}",
         "followers_url" : "https://api.github.com/users/randolf/followers",
         "following_url" : "https://api.github.com/users/randolf/following{/other_user}",
         "gists_url" : "https://api.github.com/users/randolf/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/randolf",
         "id" : 33541170,
         "login" : "randolf",
         "organizations_url" : "https://api.github.com/users/randolf/orgs",
         "received_events_url" : "https://api.github.com/users/randolf/received_events",
         "repos_url" : "https://api.github.com/users/randolf/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/randolf/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/randolf/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/randolf"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12630#discussion_r172914561"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12630"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172914561"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Agree, just improve error handling.",
      "commit_id" : "6df3caf6e9a3322bdd5b165c81504a64795b7a97",
      "created_at" : "2018-03-07T17:07:23Z",
      "diff_hunk" : "@@ -418,6 +422,20 @@ void ReleaseDirectoryLocks()\n     dir_locks.clear();\n }\n \n+bool DirIsWritable(const fs::path& directory)\n+{\n+    // Use a UUID for a unique temp filename.\n+    fs::path tmpFile = directory / boost::lexical_cast<std::string>((boost::uuids::random_generator())());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12630#discussion_r172914561",
      "id" : 172914561,
      "in_reply_to_id" : 172838928,
      "original_commit_id" : "6df3caf6e9a3322bdd5b165c81504a64795b7a97",
      "original_position" : 18,
      "path" : "src/util.cpp",
      "position" : 18,
      "pull_request_review_id" : 102014672,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12630",
      "updated_at" : "2018-03-07T17:07:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172914561",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "On POSIX you can do this in one line of code with `access(3)`, which just relied on `<unistd.h>`. I believe that MingW (which we use for Windows builds) provides a compatibility version of that header, so I think you can just use `access()` on the directory and completely remove the boost fs stuff.",
      "created_at" : "2018-03-10T16:31:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12630#issuecomment-372042853",
      "id" : 372042853,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12630",
      "updated_at" : "2018-03-10T16:31:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/372042853",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@eklitzke, access() works on Linux for me, but not Windows. I consistently get failure with errno ENOENT. I believe access() can be flaky with NFS as well, but I didn't test that myself. My most recent commit works on Windows and Linux.\r\n\r\n",
      "created_at" : "2018-03-12T08:23:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12630#issuecomment-372226858",
      "id" : 372226858,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12630",
      "updated_at" : "2018-03-12T08:23:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/372226858",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5404807?v=4",
         "events_url" : "https://api.github.com/users/murrayn/events{/privacy}",
         "followers_url" : "https://api.github.com/users/murrayn/followers",
         "following_url" : "https://api.github.com/users/murrayn/following{/other_user}",
         "gists_url" : "https://api.github.com/users/murrayn/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/murrayn",
         "id" : 5404807,
         "login" : "murrayn",
         "organizations_url" : "https://api.github.com/users/murrayn/orgs",
         "received_events_url" : "https://api.github.com/users/murrayn/received_events",
         "repos_url" : "https://api.github.com/users/murrayn/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/murrayn/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/murrayn/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/murrayn"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Alright in that case disregard. utACK 8a79879d2dfb5bcf1a020949044f246ce666e3d3 (and I'll note there aren't any credible proposed alternatives for boost::filesystem so I don't think that should be an objection).",
      "created_at" : "2018-03-13T05:10:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12630#issuecomment-372548929",
      "id" : 372548929,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12630",
      "updated_at" : "2018-03-13T05:10:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/372548929",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "utACK after squash. I still think the check for write-ability could be rolled into LockDirectory, as that function creates the lock file by writing by definition (and that would take care of other directories too, such as wallet directories), but anyhow I'm ok with this solution too.\r\n\r\n> and I'll note there aren't any credible proposed alternatives for boost::filesystem\r\n\r\nRight - we'll just wait for `std::filesystem` from C++17. @theuni has a minimal patch somewhere that makes it work with that.",
      "created_at" : "2018-03-14T16:10:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12630#issuecomment-373079144",
      "id" : 373079144,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12630",
      "updated_at" : "2018-03-14T16:11:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/373079144",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "It works:\r\n```bash\r\n$ src/bitcoind -datadir=/tmp/test1\r\nError: Specified data directory \"/tmp/test1\" does not exist.\r\n$ mkdir /tmp/test2 && chmod 0 /tmp/test2\r\n$ src/bitcoind -datadir=/tmp/test2\r\nError: Cannot write to data directory '/tmp/test2'; check permissions.\r\n$ mkdir /tmp/test3\r\n$ src/bitcoind -datadir=/tmp/test3 -daemon\r\n$ src/bitcoind -datadir=/tmp/test3\r\nError: Cannot obtain a lock on data directory /tmp/test3. Bitcoin Core is probably already running.\r\n```\r\nNit: It's kind of funny that all three error messages wrap the path differently. The first puts it in `\"`, the second uses `'`, the third prints it unwrapped.",
      "created_at" : "2018-03-19T15:49:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12630#issuecomment-374260786",
      "id" : 374260786,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12630",
      "updated_at" : "2018-03-19T15:49:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/374260786",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 8674e74b47c1f6e86a367cfbc738fcc9812b616b",
      "created_at" : "2018-03-20T07:45:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12630#issuecomment-374504233",
      "id" : 374504233,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12630",
      "updated_at" : "2018-03-20T07:45:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/374504233",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   }
]
