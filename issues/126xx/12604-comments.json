[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172317130"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172317130"
         }
      },
      "author_association" : "OWNER",
      "body" : "We might want to skip this call (and the one after) if BCLog::LEVELDB is disabled, with the string parsing and floating point arithmetic it seems a lot of overhead for a log message that will be ignored anyway.",
      "commit_id" : "8f1026b0762b71a279203d519799c64d4e8c458f",
      "created_at" : "2018-03-05T20:23:58Z",
      "diff_hunk" : "@@ -155,11 +156,25 @@ CDBWrapper::~CDBWrapper()\n \n bool CDBWrapper::WriteBatch(CDBBatch& batch, bool fSync)\n {\n+    double mem_before = DynamicMemoryUsage() / 1024 / 1024;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172317130",
      "id" : 172317130,
      "original_commit_id" : "d7bb5050995e9c1d0642d18994167580cd0a69bb",
      "original_position" : 12,
      "path" : "src/dbwrapper.cpp",
      "position" : null,
      "pull_request_review_id" : 101313878,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604",
      "updated_at" : "2018-03-05T21:24:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172317130",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172318417"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172318417"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good observation, fixed.",
      "commit_id" : "8f1026b0762b71a279203d519799c64d4e8c458f",
      "created_at" : "2018-03-05T20:28:58Z",
      "diff_hunk" : "@@ -155,11 +156,25 @@ CDBWrapper::~CDBWrapper()\n \n bool CDBWrapper::WriteBatch(CDBBatch& batch, bool fSync)\n {\n+    double mem_before = DynamicMemoryUsage() / 1024 / 1024;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172318417",
      "id" : 172318417,
      "in_reply_to_id" : 172317130,
      "original_commit_id" : "d7bb5050995e9c1d0642d18994167580cd0a69bb",
      "original_position" : 12,
      "path" : "src/dbwrapper.cpp",
      "position" : null,
      "pull_request_review_id" : 101315454,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604",
      "updated_at" : "2018-03-05T21:24:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172318417",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172318882"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172318882"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Use http://en.cppreference.com/w/cpp/string/basic_string/stoul instead.",
      "commit_id" : "8f1026b0762b71a279203d519799c64d4e8c458f",
      "created_at" : "2018-03-05T20:30:57Z",
      "diff_hunk" : "@@ -155,11 +156,25 @@ CDBWrapper::~CDBWrapper()\n \n bool CDBWrapper::WriteBatch(CDBBatch& batch, bool fSync)\n {\n+    double mem_before = DynamicMemoryUsage() / 1024 / 1024;\n     leveldb::Status status = pdb->Write(fSync ? syncoptions : writeoptions, &batch.batch);\n     dbwrapper_private::HandleError(status);\n+    double mem_after = DynamicMemoryUsage() / 1024 / 1024;\n+    LogPrint(BCLog::LEVELDB, \"WriteBatch memory usage: db=%s, before=%.1fMiB, after=%.1fMiB\\n\",\n+             m_name, mem_before, mem_after);\n     return true;\n }\n \n+size_t CDBWrapper::DynamicMemoryUsage() {\n+    std::string memory;\n+    if (pdb->GetProperty(\"leveldb.approximate-memory-usage\", &memory)) {\n+        return strtoul(memory.c_str(), nullptr, 10);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172318882",
      "id" : 172318882,
      "original_commit_id" : "d7bb5050995e9c1d0642d18994167580cd0a69bb",
      "original_position" : 24,
      "path" : "src/dbwrapper.cpp",
      "position" : null,
      "pull_request_review_id" : 101316037,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604",
      "updated_at" : "2018-03-05T21:24:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172318882",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172319158"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172319158"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Could be `const`?",
      "commit_id" : "8f1026b0762b71a279203d519799c64d4e8c458f",
      "created_at" : "2018-03-05T20:32:05Z",
      "diff_hunk" : "@@ -284,6 +287,9 @@ class CDBWrapper\n \n     bool WriteBatch(CDBBatch& batch, bool fSync = false);\n \n+    // Get an estimate of LevelDB memory usage (in bytes).\n+    size_t DynamicMemoryUsage();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172319158",
      "id" : 172319158,
      "original_commit_id" : "e7fa704cbaa5de2ca9bfffe560ff6c6fdf751ac0",
      "original_position" : 15,
      "path" : "src/dbwrapper.h",
      "position" : 15,
      "pull_request_review_id" : 101316037,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604",
      "updated_at" : "2018-03-05T21:24:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172319158",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172319216"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172319216"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit, space after `:`.",
      "commit_id" : "8f1026b0762b71a279203d519799c64d4e8c458f",
      "created_at" : "2018-03-05T20:32:19Z",
      "diff_hunk" : "@@ -89,6 +89,7 @@ static leveldb::Options GetOptions(size_t nCacheSize)\n }\n \n CDBWrapper::CDBWrapper(const fs::path& path, size_t nCacheSize, bool fMemory, bool fWipe, bool obfuscate)\n+    :m_name(fs::basename(path))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172319216",
      "id" : 172319216,
      "original_commit_id" : "e7fa704cbaa5de2ca9bfffe560ff6c6fdf751ac0",
      "original_position" : 4,
      "path" : "src/dbwrapper.cpp",
      "position" : null,
      "pull_request_review_id" : 101316037,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604",
      "updated_at" : "2018-03-05T21:24:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172319216",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172319558"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172319558"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit, initialize `= 0`.",
      "commit_id" : "8f1026b0762b71a279203d519799c64d4e8c458f",
      "created_at" : "2018-03-05T20:33:38Z",
      "diff_hunk" : "@@ -155,11 +156,28 @@ CDBWrapper::~CDBWrapper()\n \n bool CDBWrapper::WriteBatch(CDBBatch& batch, bool fSync)\n {\n+    const bool log_memory = LogAcceptCategory(BCLog::LEVELDB);\n+    double mem_before;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172319558",
      "id" : 172319558,
      "original_commit_id" : "e7fa704cbaa5de2ca9bfffe560ff6c6fdf751ac0",
      "original_position" : 13,
      "path" : "src/dbwrapper.cpp",
      "position" : null,
      "pull_request_review_id" : 101316037,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604",
      "updated_at" : "2018-03-05T21:24:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172319558",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172319697"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172319697"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit, same line.",
      "commit_id" : "8f1026b0762b71a279203d519799c64d4e8c458f",
      "created_at" : "2018-03-05T20:34:14Z",
      "diff_hunk" : "@@ -155,11 +156,28 @@ CDBWrapper::~CDBWrapper()\n \n bool CDBWrapper::WriteBatch(CDBBatch& batch, bool fSync)\n {\n+    const bool log_memory = LogAcceptCategory(BCLog::LEVELDB);\n+    double mem_before;\n+    if (log_memory)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172319697",
      "id" : 172319697,
      "original_commit_id" : "e7fa704cbaa5de2ca9bfffe560ff6c6fdf751ac0",
      "original_position" : 14,
      "path" : "src/dbwrapper.cpp",
      "position" : null,
      "pull_request_review_id" : 101316037,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604",
      "updated_at" : "2018-03-05T21:24:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172319697",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172319860"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172319860"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit\r\n```cpp\r\nif (log_memory) {\r\n    double mem_after = ...;\r\n    LogPrint(BCLog::LEVELDB, ...);\r\n}",
      "commit_id" : "8f1026b0762b71a279203d519799c64d4e8c458f",
      "created_at" : "2018-03-05T20:34:55Z",
      "diff_hunk" : "@@ -155,11 +156,28 @@ CDBWrapper::~CDBWrapper()\n \n bool CDBWrapper::WriteBatch(CDBBatch& batch, bool fSync)\n {\n+    const bool log_memory = LogAcceptCategory(BCLog::LEVELDB);\n+    double mem_before;\n+    if (log_memory)\n+        mem_before = DynamicMemoryUsage() / 1024 / 1024;\n     leveldb::Status status = pdb->Write(fSync ? syncoptions : writeoptions, &batch.batch);\n     dbwrapper_private::HandleError(status);\n+    if (log_memory)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172319860",
      "id" : 172319860,
      "original_commit_id" : "e7fa704cbaa5de2ca9bfffe560ff6c6fdf751ac0",
      "original_position" : 18,
      "path" : "src/dbwrapper.cpp",
      "position" : null,
      "pull_request_review_id" : 101316037,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604",
      "updated_at" : "2018-03-05T21:24:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172319860",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172320929"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172320929"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Suggestion:\r\n```cpp\r\nif (!pdb->GetProperty(...)) {\r\n    LogPrint(BCLog::LEVELDB, \"Failed to get approximate-memory-usage property\\n\");\r\n    return 0;\r\n}\r\n\r\nreturn stoul(memory);\r\n```",
      "commit_id" : "8f1026b0762b71a279203d519799c64d4e8c458f",
      "created_at" : "2018-03-05T20:39:12Z",
      "diff_hunk" : "@@ -155,11 +156,28 @@ CDBWrapper::~CDBWrapper()\n \n bool CDBWrapper::WriteBatch(CDBBatch& batch, bool fSync)\n {\n+    const bool log_memory = LogAcceptCategory(BCLog::LEVELDB);\n+    double mem_before;\n+    if (log_memory)\n+        mem_before = DynamicMemoryUsage() / 1024 / 1024;\n     leveldb::Status status = pdb->Write(fSync ? syncoptions : writeoptions, &batch.batch);\n     dbwrapper_private::HandleError(status);\n+    if (log_memory)\n+        LogPrint(BCLog::LEVELDB, \"WriteBatch memory usage: db=%s, before=%.1fMiB, after=%.1fMiB\\n\",\n+                 m_name, mem_before, DynamicMemoryUsage() / 1024 / 1024);\n     return true;\n }\n \n+size_t CDBWrapper::DynamicMemoryUsage() {\n+    std::string memory;\n+    if (pdb->GetProperty(\"leveldb.approximate-memory-usage\", &memory)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172320929",
      "id" : 172320929,
      "original_commit_id" : "e7fa704cbaa5de2ca9bfffe560ff6c6fdf751ac0",
      "original_position" : 26,
      "path" : "src/dbwrapper.cpp",
      "position" : null,
      "pull_request_review_id" : 101316037,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604",
      "updated_at" : "2018-03-05T21:24:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172320929",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172321892"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172321892"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "BTW, could use `path` in the debug instead?\r\n - relevant considering #11687\r\n - CDBWrapper constructor also logs path. ",
      "commit_id" : "8f1026b0762b71a279203d519799c64d4e8c458f",
      "created_at" : "2018-03-05T20:43:11Z",
      "diff_hunk" : "@@ -89,6 +89,7 @@ static leveldb::Options GetOptions(size_t nCacheSize)\n }\n \n CDBWrapper::CDBWrapper(const fs::path& path, size_t nCacheSize, bool fMemory, bool fWipe, bool obfuscate)\n+    :m_name(fs::basename(path))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172321892",
      "id" : 172321892,
      "in_reply_to_id" : 172319216,
      "original_commit_id" : "e7fa704cbaa5de2ca9bfffe560ff6c6fdf751ac0",
      "original_position" : 4,
      "path" : "src/dbwrapper.cpp",
      "position" : null,
      "pull_request_review_id" : 101316037,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604",
      "updated_at" : "2018-03-05T21:24:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172321892",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172325031"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172325031"
         }
      },
      "author_association" : "OWNER",
      "body" : "Nit: braces whenever the then branch is not on the same line.",
      "commit_id" : "8f1026b0762b71a279203d519799c64d4e8c458f",
      "created_at" : "2018-03-05T20:55:04Z",
      "diff_hunk" : "@@ -155,11 +156,28 @@ CDBWrapper::~CDBWrapper()\n \n bool CDBWrapper::WriteBatch(CDBBatch& batch, bool fSync)\n {\n+    const bool log_memory = LogAcceptCategory(BCLog::LEVELDB);\n+    double mem_before;\n+    if (log_memory)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172325031",
      "id" : 172325031,
      "original_commit_id" : "e7fa704cbaa5de2ca9bfffe560ff6c6fdf751ac0",
      "original_position" : 14,
      "path" : "src/dbwrapper.cpp",
      "position" : null,
      "pull_request_review_id" : 101323485,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604",
      "updated_at" : "2018-03-05T21:24:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172325031",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172325286"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172325286"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe it's not possible, since [`GetProperty` is not const](https://github.com/google/leveldb/blob/41172a24016bc29fc795ed504737392587f54e3d/include/leveldb/db.h#L121)",
      "commit_id" : "8f1026b0762b71a279203d519799c64d4e8c458f",
      "created_at" : "2018-03-05T20:55:54Z",
      "diff_hunk" : "@@ -284,6 +287,9 @@ class CDBWrapper\n \n     bool WriteBatch(CDBBatch& batch, bool fSync = false);\n \n+    // Get an estimate of LevelDB memory usage (in bytes).\n+    size_t DynamicMemoryUsage();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172325286",
      "id" : 172325286,
      "in_reply_to_id" : 172319158,
      "original_commit_id" : "e7fa704cbaa5de2ca9bfffe560ff6c6fdf751ac0",
      "original_position" : 15,
      "path" : "src/dbwrapper.h",
      "position" : 15,
      "pull_request_review_id" : 101323808,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604",
      "updated_at" : "2018-03-05T21:24:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172325286",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172326050"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172326050"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "8f1026b0762b71a279203d519799c64d4e8c458f",
      "created_at" : "2018-03-05T20:58:49Z",
      "diff_hunk" : "@@ -155,11 +156,25 @@ CDBWrapper::~CDBWrapper()\n \n bool CDBWrapper::WriteBatch(CDBBatch& batch, bool fSync)\n {\n+    double mem_before = DynamicMemoryUsage() / 1024 / 1024;\n     leveldb::Status status = pdb->Write(fSync ? syncoptions : writeoptions, &batch.batch);\n     dbwrapper_private::HandleError(status);\n+    double mem_after = DynamicMemoryUsage() / 1024 / 1024;\n+    LogPrint(BCLog::LEVELDB, \"WriteBatch memory usage: db=%s, before=%.1fMiB, after=%.1fMiB\\n\",\n+             m_name, mem_before, mem_after);\n     return true;\n }\n \n+size_t CDBWrapper::DynamicMemoryUsage() {\n+    std::string memory;\n+    if (pdb->GetProperty(\"leveldb.approximate-memory-usage\", &memory)) {\n+        return strtoul(memory.c_str(), nullptr, 10);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172326050",
      "id" : 172326050,
      "in_reply_to_id" : 172318882,
      "original_commit_id" : "d7bb5050995e9c1d0642d18994167580cd0a69bb",
      "original_position" : 24,
      "path" : "src/dbwrapper.cpp",
      "position" : null,
      "pull_request_review_id" : 101324743,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604",
      "updated_at" : "2018-03-05T21:24:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172326050",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172326328"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172326328"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Right, unless you want to give into the temptation of const cast.",
      "commit_id" : "8f1026b0762b71a279203d519799c64d4e8c458f",
      "created_at" : "2018-03-05T20:59:46Z",
      "diff_hunk" : "@@ -284,6 +287,9 @@ class CDBWrapper\n \n     bool WriteBatch(CDBBatch& batch, bool fSync = false);\n \n+    // Get an estimate of LevelDB memory usage (in bytes).\n+    size_t DynamicMemoryUsage();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172326328",
      "id" : 172326328,
      "in_reply_to_id" : 172319158,
      "original_commit_id" : "e7fa704cbaa5de2ca9bfffe560ff6c6fdf751ac0",
      "original_position" : 15,
      "path" : "src/dbwrapper.h",
      "position" : 15,
      "pull_request_review_id" : 101325024,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604",
      "updated_at" : "2018-03-05T21:24:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172326328",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172326745"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172326745"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "8f1026b0762b71a279203d519799c64d4e8c458f",
      "created_at" : "2018-03-05T21:01:14Z",
      "diff_hunk" : "@@ -155,11 +156,28 @@ CDBWrapper::~CDBWrapper()\n \n bool CDBWrapper::WriteBatch(CDBBatch& batch, bool fSync)\n {\n+    const bool log_memory = LogAcceptCategory(BCLog::LEVELDB);\n+    double mem_before;\n+    if (log_memory)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172326745",
      "id" : 172326745,
      "in_reply_to_id" : 172325031,
      "original_commit_id" : "e7fa704cbaa5de2ca9bfffe560ff6c6fdf751ac0",
      "original_position" : 14,
      "path" : "src/dbwrapper.cpp",
      "position" : null,
      "pull_request_review_id" : 101325487,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604",
      "updated_at" : "2018-03-05T21:24:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172326745",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172326945"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172326945"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "8f1026b0762b71a279203d519799c64d4e8c458f",
      "created_at" : "2018-03-05T21:01:54Z",
      "diff_hunk" : "@@ -155,11 +156,28 @@ CDBWrapper::~CDBWrapper()\n \n bool CDBWrapper::WriteBatch(CDBBatch& batch, bool fSync)\n {\n+    const bool log_memory = LogAcceptCategory(BCLog::LEVELDB);\n+    double mem_before;\n+    if (log_memory)\n+        mem_before = DynamicMemoryUsage() / 1024 / 1024;\n     leveldb::Status status = pdb->Write(fSync ? syncoptions : writeoptions, &batch.batch);\n     dbwrapper_private::HandleError(status);\n+    if (log_memory)\n+        LogPrint(BCLog::LEVELDB, \"WriteBatch memory usage: db=%s, before=%.1fMiB, after=%.1fMiB\\n\",\n+                 m_name, mem_before, DynamicMemoryUsage() / 1024 / 1024);\n     return true;\n }\n \n+size_t CDBWrapper::DynamicMemoryUsage() {\n+    std::string memory;\n+    if (pdb->GetProperty(\"leveldb.approximate-memory-usage\", &memory)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172326945",
      "id" : 172326945,
      "in_reply_to_id" : 172320929,
      "original_commit_id" : "e7fa704cbaa5de2ca9bfffe560ff6c6fdf751ac0",
      "original_position" : 26,
      "path" : "src/dbwrapper.cpp",
      "position" : null,
      "pull_request_review_id" : 101325691,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604",
      "updated_at" : "2018-03-05T21:24:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172326945",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172327094"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172327094"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "8f1026b0762b71a279203d519799c64d4e8c458f",
      "created_at" : "2018-03-05T21:02:29Z",
      "diff_hunk" : "@@ -155,11 +156,28 @@ CDBWrapper::~CDBWrapper()\n \n bool CDBWrapper::WriteBatch(CDBBatch& batch, bool fSync)\n {\n+    const bool log_memory = LogAcceptCategory(BCLog::LEVELDB);\n+    double mem_before;\n+    if (log_memory)\n+        mem_before = DynamicMemoryUsage() / 1024 / 1024;\n     leveldb::Status status = pdb->Write(fSync ? syncoptions : writeoptions, &batch.batch);\n     dbwrapper_private::HandleError(status);\n+    if (log_memory)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172327094",
      "id" : 172327094,
      "in_reply_to_id" : 172319860,
      "original_commit_id" : "e7fa704cbaa5de2ca9bfffe560ff6c6fdf751ac0",
      "original_position" : 18,
      "path" : "src/dbwrapper.cpp",
      "position" : null,
      "pull_request_review_id" : 101325868,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604",
      "updated_at" : "2018-03-05T21:24:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172327094",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172327169"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172327169"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I added braces, which I think is what you mean here?",
      "commit_id" : "8f1026b0762b71a279203d519799c64d4e8c458f",
      "created_at" : "2018-03-05T21:02:48Z",
      "diff_hunk" : "@@ -155,11 +156,28 @@ CDBWrapper::~CDBWrapper()\n \n bool CDBWrapper::WriteBatch(CDBBatch& batch, bool fSync)\n {\n+    const bool log_memory = LogAcceptCategory(BCLog::LEVELDB);\n+    double mem_before;\n+    if (log_memory)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172327169",
      "id" : 172327169,
      "in_reply_to_id" : 172319697,
      "original_commit_id" : "e7fa704cbaa5de2ca9bfffe560ff6c6fdf751ac0",
      "original_position" : 14,
      "path" : "src/dbwrapper.cpp",
      "position" : null,
      "pull_request_review_id" : 101325964,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604",
      "updated_at" : "2018-03-05T21:24:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172327169",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172327292"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172327292"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done (although I think it's fine to keep unused variables uninitialized)",
      "commit_id" : "8f1026b0762b71a279203d519799c64d4e8c458f",
      "created_at" : "2018-03-05T21:03:11Z",
      "diff_hunk" : "@@ -155,11 +156,28 @@ CDBWrapper::~CDBWrapper()\n \n bool CDBWrapper::WriteBatch(CDBBatch& batch, bool fSync)\n {\n+    const bool log_memory = LogAcceptCategory(BCLog::LEVELDB);\n+    double mem_before;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172327292",
      "id" : 172327292,
      "in_reply_to_id" : 172319558,
      "original_commit_id" : "e7fa704cbaa5de2ca9bfffe560ff6c6fdf751ac0",
      "original_position" : 13,
      "path" : "src/dbwrapper.cpp",
      "position" : null,
      "pull_request_review_id" : 101326095,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604",
      "updated_at" : "2018-03-05T21:24:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172327292",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172328151"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172328151"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Added space. I kind of like the short path in the logs because it makes the lines more readable, what if I did the following:\r\n * Add new name parameter to constructor\r\n * Chainstate/blocks databases will pass in \"chainstate\" \"blocks\" etc. to explicitly name the object\r\n * If an explicit name is omitted the path will be logged, and this pattern could be used in #11687 since wallet files are not global like the other databases.\r\n\r\n",
      "commit_id" : "8f1026b0762b71a279203d519799c64d4e8c458f",
      "created_at" : "2018-03-05T21:06:16Z",
      "diff_hunk" : "@@ -89,6 +89,7 @@ static leveldb::Options GetOptions(size_t nCacheSize)\n }\n \n CDBWrapper::CDBWrapper(const fs::path& path, size_t nCacheSize, bool fMemory, bool fWipe, bool obfuscate)\n+    :m_name(fs::basename(path))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172328151",
      "id" : 172328151,
      "in_reply_to_id" : 172319216,
      "original_commit_id" : "e7fa704cbaa5de2ca9bfffe560ff6c6fdf751ac0",
      "original_position" : 4,
      "path" : "src/dbwrapper.cpp",
      "position" : null,
      "pull_request_review_id" : 101327095,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604",
      "updated_at" : "2018-03-05T21:24:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172328151",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172329557"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172329557"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nah, IMO it's fine as it is.",
      "commit_id" : "8f1026b0762b71a279203d519799c64d4e8c458f",
      "created_at" : "2018-03-05T21:11:44Z",
      "diff_hunk" : "@@ -284,6 +287,9 @@ class CDBWrapper\n \n     bool WriteBatch(CDBBatch& batch, bool fSync = false);\n \n+    // Get an estimate of LevelDB memory usage (in bytes).\n+    size_t DynamicMemoryUsage();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172329557",
      "id" : 172329557,
      "in_reply_to_id" : 172319158,
      "original_commit_id" : "e7fa704cbaa5de2ca9bfffe560ff6c6fdf751ac0",
      "original_position" : 15,
      "path" : "src/dbwrapper.h",
      "position" : 15,
      "pull_request_review_id" : 101328759,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604",
      "updated_at" : "2018-03-05T21:24:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172329557",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "utACK after squash.",
      "created_at" : "2018-03-05T21:13:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12604#issuecomment-370567811",
      "id" : 370567811,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12604",
      "updated_at" : "2018-03-05T21:13:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370567811",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "utACK ",
      "created_at" : "2018-03-05T21:17:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12604#issuecomment-370568989",
      "id" : 370568989,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12604",
      "updated_at" : "2018-03-05T21:17:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370568989",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172349527"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172349527"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Maybe it's not possible, since GetProperty is not const\r\n\r\nFWIW, it is possible to declare this const, because GetProperty is called on a pointer to a non-const object. Adding const here only makes the pointer address const, not the object located at that address.",
      "commit_id" : "8f1026b0762b71a279203d519799c64d4e8c458f",
      "created_at" : "2018-03-05T22:22:59Z",
      "diff_hunk" : "@@ -284,6 +287,9 @@ class CDBWrapper\n \n     bool WriteBatch(CDBBatch& batch, bool fSync = false);\n \n+    // Get an estimate of LevelDB memory usage (in bytes).\n+    size_t DynamicMemoryUsage();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12604#discussion_r172349527",
      "id" : 172349527,
      "in_reply_to_id" : 172319158,
      "original_commit_id" : "e7fa704cbaa5de2ca9bfffe560ff6c6fdf751ac0",
      "original_position" : 15,
      "path" : "src/dbwrapper.h",
      "position" : 15,
      "pull_request_review_id" : 101351973,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12604",
      "updated_at" : "2018-03-05T22:31:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172349527",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated with 741f0177c53ae536801a67c8ec194d6be3505d2d to fix const correctness.",
      "created_at" : "2018-03-06T05:27:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12604#issuecomment-370667823",
      "id" : 370667823,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12604",
      "updated_at" : "2018-03-06T05:27:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370667823",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Nice!\r\nutACK 741f0177c53ae536801a67c8ec194d6be3505d2d",
      "created_at" : "2018-03-06T05:44:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12604#issuecomment-370670631",
      "id" : 370670631,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12604",
      "updated_at" : "2018-03-06T05:44:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370670631",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 741f0177c53ae536801a67c8ec194d6be3505d2d",
      "created_at" : "2018-03-06T06:13:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12604#issuecomment-370675374",
      "id" : 370675374,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12604",
      "updated_at" : "2018-03-06T06:13:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370675374",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   }
]
