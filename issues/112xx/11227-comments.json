[
   {
      "author_association" : "MEMBER",
      "body" : "I believe that the proxy_test failure is a false-positive.\r\n\r\nLooks like the issue is that disconnection happens so quickly now after an error that the testnode fails.",
      "created_at" : "2017-09-04T00:16:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11227#issuecomment-326841655",
      "id" : 326841655,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11227",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDMyNjg0MTY1NQ==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/326841655/reactions"
      },
      "updated_at" : "2017-09-04T00:16:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/326841655",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11227#discussion_r136741410"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11227"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136741410"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It looks like this could be a scripted diff, `s/fDisconnect = true/Disconnect()/g`.",
      "commit_id" : "77cee166e17e355306d2ca1a1d360e71c12d8350",
      "created_at" : "2017-09-04T04:07:32Z",
      "diff_hunk" : "@@ -454,7 +454,7 @@ void CConnman::DumpBanlist()\n \n void CNode::CloseSocketDisconnect()\n {\n-    fDisconnect = true;\n+    Disconnect();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11227#discussion_r136741410",
      "id" : 136741410,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEzNjc0MTQxMA==",
      "original_commit_id" : "82625c5a40e9698b509a926ec0bd6a5a9c93cf68",
      "original_line" : 457,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 60320773,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11227",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136741410/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2017-09-20T20:41:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136741410",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11227#discussion_r136750497"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11227"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136750497"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This test is no longer needed?",
      "commit_id" : "77cee166e17e355306d2ca1a1d360e71c12d8350",
      "created_at" : "2017-09-04T06:20:24Z",
      "diff_hunk" : "@@ -914,12 +914,7 @@ size_t CConnman::SocketSendData(CNode *pnode) const\n     while (it != pnode->vSendMsg.end()) {\n         const auto &data = *it;\n         assert(data.size() > pnode->nSendOffset);\n-        int nBytes = 0;\n-        {\n-            if (pnode->hSocket == INVALID_SOCKET)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11227#discussion_r136750497",
      "id" : 136750497,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEzNjc1MDQ5Nw==",
      "original_commit_id" : "f7ff0a794fbdc9cd744de8e8d41e5081567cadce",
      "original_line" : 875,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 60320773,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11227",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136750497/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2017-12-30T11:11:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136750497",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11227#discussion_r136752250"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11227"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136752250"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Heh, I'd have hoped that this restriction wouldn't be needed anymore with libevent.",
      "commit_id" : "77cee166e17e355306d2ca1a1d360e71c12d8350",
      "created_at" : "2017-09-04T06:37:05Z",
      "diff_hunk" : "@@ -1205,11 +1302,14 @@ void CConnman::AcceptConnection(const SOCKET& listen_socket, bool whitelisted) {\n         return;\n     }\n \n-    if (!IsSelectableSocket(hSocket))\n-    {\n-        LogPrintf(\"connection from %s dropped: non-selectable socket\\n\", addr.ToString());\n-        CloseSocket(hSocket);\n-        return;\n+    const char* method = event_base_get_method(m_event_base);\n+    if (!method || (strncmp(method, \"select\", 6) == 0)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11227#discussion_r136752250",
      "id" : 136752250,
      "line" : 1400,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEzNjc1MjI1MA==",
      "original_commit_id" : "fa64f69c37f9ea3aee77ccad0cca8a13ec802fa6",
      "original_line" : 1400,
      "original_position" : 221,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 650,
      "pull_request_review_id" : 60320773,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11227",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136752250/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2017-12-30T11:11:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136752250",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11227#discussion_r136756884"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11227"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136756884"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The documentation on `event_base_init_common_timeout` says \"To do this, call this function with the common duration. It will return a pointer to a different, opaque timeout value. (Don't depend on its actual contents!)\".\r\n\r\nI'm not sure whether that means you need to use the exact pointer returned, or just a copy of its value (as this code does).",
      "commit_id" : "77cee166e17e355306d2ca1a1d360e71c12d8350",
      "created_at" : "2017-09-04T07:16:31Z",
      "diff_hunk" : "@@ -2397,6 +2370,9 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         LOCK(m_cs_interrupt_event);\n         m_interrupt_event = event_new(m_event_base, -1, 0, [](evutil_socket_t, short, void* data) {static_cast<CConnman*>(data)->InterruptEvents();}, (this));\n     }\n+    m_event_timeout = timeval{60, 0};\n+    const timeval* common_timeout = event_base_init_common_timeout(m_event_base, &m_event_timeout);\n+    memcpy(&m_event_timeout, common_timeout, sizeof(m_event_timeout));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11227#discussion_r136756884",
      "id" : 136756884,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEzNjc1Njg4NA==",
      "original_commit_id" : "fa64f69c37f9ea3aee77ccad0cca8a13ec802fa6",
      "original_line" : 2491,
      "original_position" : 514,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 60320773,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11227",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136756884/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2017-09-20T20:41:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136756884",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11227#discussion_r136757653"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11227"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136757653"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I would prefer it if you could have some RAII wrappers around the libevent structures before adding all this.",
      "commit_id" : "77cee166e17e355306d2ca1a1d360e71c12d8350",
      "created_at" : "2017-09-04T07:22:11Z",
      "diff_hunk" : "@@ -456,7 +471,14 @@ void CConnman::DumpBanlist()\n \n void CNode::CloseSocketDisconnect()\n {\n-    Disconnect();\n+    if (m_write_event) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11227#discussion_r136757653",
      "id" : 136757653,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEzNjc1NzY1Mw==",
      "original_commit_id" : "fa64f69c37f9ea3aee77ccad0cca8a13ec802fa6",
      "original_line" : 526,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 60320773,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11227",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136757653/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2017-09-20T20:41:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136757653",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11227#discussion_r136792970"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11227"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136792970"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Probably so, will give it a shot.",
      "commit_id" : "77cee166e17e355306d2ca1a1d360e71c12d8350",
      "created_at" : "2017-09-04T10:34:46Z",
      "diff_hunk" : "@@ -454,7 +454,7 @@ void CConnman::DumpBanlist()\n \n void CNode::CloseSocketDisconnect()\n {\n-    fDisconnect = true;\n+    Disconnect();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11227#discussion_r136792970",
      "id" : 136792970,
      "in_reply_to_id" : 136741410,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEzNjc5Mjk3MA==",
      "original_commit_id" : "82625c5a40e9698b509a926ec0bd6a5a9c93cf68",
      "original_line" : 457,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 60380058,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11227",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136792970/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2017-09-20T20:41:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136792970",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11227#discussion_r136793387"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11227"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136793387"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I believe all of these are gone by the end of the change set, the removal may make more sense in an earlier commit, though.",
      "commit_id" : "77cee166e17e355306d2ca1a1d360e71c12d8350",
      "created_at" : "2017-09-04T10:37:08Z",
      "diff_hunk" : "@@ -914,12 +914,7 @@ size_t CConnman::SocketSendData(CNode *pnode) const\n     while (it != pnode->vSendMsg.end()) {\n         const auto &data = *it;\n         assert(data.size() > pnode->nSendOffset);\n-        int nBytes = 0;\n-        {\n-            if (pnode->hSocket == INVALID_SOCKET)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11227#discussion_r136793387",
      "id" : 136793387,
      "in_reply_to_id" : 136750497,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEzNjc5MzM4Nw==",
      "original_commit_id" : "f7ff0a794fbdc9cd744de8e8d41e5081567cadce",
      "original_line" : 875,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 60380520,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11227",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136793387/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2017-12-30T11:11:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136793387",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11227#discussion_r136793461"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11227"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136793461"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Agreed, see PR description :)",
      "commit_id" : "77cee166e17e355306d2ca1a1d360e71c12d8350",
      "created_at" : "2017-09-04T10:37:29Z",
      "diff_hunk" : "@@ -456,7 +471,14 @@ void CConnman::DumpBanlist()\n \n void CNode::CloseSocketDisconnect()\n {\n-    Disconnect();\n+    if (m_write_event) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11227#discussion_r136793461",
      "id" : 136793461,
      "in_reply_to_id" : 136757653,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEzNjc5MzQ2MQ==",
      "original_commit_id" : "fa64f69c37f9ea3aee77ccad0cca8a13ec802fa6",
      "original_line" : 526,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 60380578,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11227",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136793461/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2017-09-20T20:41:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136793461",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11227#discussion_r136793635"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11227"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136793635"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's only needed if select ends up being used, which should be very unlikely on most platforms. I'll add a comment here, and print something to the log so that it's clear which back-end is being used.",
      "commit_id" : "77cee166e17e355306d2ca1a1d360e71c12d8350",
      "created_at" : "2017-09-04T10:38:44Z",
      "diff_hunk" : "@@ -1205,11 +1302,14 @@ void CConnman::AcceptConnection(const SOCKET& listen_socket, bool whitelisted) {\n         return;\n     }\n \n-    if (!IsSelectableSocket(hSocket))\n-    {\n-        LogPrintf(\"connection from %s dropped: non-selectable socket\\n\", addr.ToString());\n-        CloseSocket(hSocket);\n-        return;\n+    const char* method = event_base_get_method(m_event_base);\n+    if (!method || (strncmp(method, \"select\", 6) == 0)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11227#discussion_r136793635",
      "id" : 136793635,
      "in_reply_to_id" : 136752250,
      "line" : 1400,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEzNjc5MzYzNQ==",
      "original_commit_id" : "fa64f69c37f9ea3aee77ccad0cca8a13ec802fa6",
      "original_line" : 1400,
      "original_position" : 221,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 650,
      "pull_request_review_id" : 60380818,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11227",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136793635/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2017-12-30T11:11:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136793635",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11227#discussion_r136794167"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11227"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136794167"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good eye! I wasn't sure how to store this properly either. This usage is taken from the official documentation. I'll add a comment about its sanity and a link to the docs.",
      "commit_id" : "77cee166e17e355306d2ca1a1d360e71c12d8350",
      "created_at" : "2017-09-04T10:41:36Z",
      "diff_hunk" : "@@ -2397,6 +2370,9 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         LOCK(m_cs_interrupt_event);\n         m_interrupt_event = event_new(m_event_base, -1, 0, [](evutil_socket_t, short, void* data) {static_cast<CConnman*>(data)->InterruptEvents();}, (this));\n     }\n+    m_event_timeout = timeval{60, 0};\n+    const timeval* common_timeout = event_base_init_common_timeout(m_event_base, &m_event_timeout);\n+    memcpy(&m_event_timeout, common_timeout, sizeof(m_event_timeout));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11227#discussion_r136794167",
      "id" : 136794167,
      "in_reply_to_id" : 136756884,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEzNjc5NDE2Nw==",
      "original_commit_id" : "fa64f69c37f9ea3aee77ccad0cca8a13ec802fa6",
      "original_line" : 2491,
      "original_position" : 514,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 60381406,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11227",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136794167/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2017-09-20T20:41:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136794167",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, woohoo!",
      "created_at" : "2017-09-05T21:56:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11227#issuecomment-327315068",
      "id" : 327315068,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11227",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDMyNzMxNTA2OA==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/327315068/reactions"
      },
      "updated_at" : "2017-09-05T21:56:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/327315068",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11227#discussion_r137125533"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11227"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/137125533"
         }
      },
      "author_association" : "MEMBER",
      "body" : "We could just bail out if select is being used. But not sure what platforms would be affected.",
      "commit_id" : "77cee166e17e355306d2ca1a1d360e71c12d8350",
      "created_at" : "2017-09-05T21:57:12Z",
      "diff_hunk" : "@@ -1205,11 +1302,14 @@ void CConnman::AcceptConnection(const SOCKET& listen_socket, bool whitelisted) {\n         return;\n     }\n \n-    if (!IsSelectableSocket(hSocket))\n-    {\n-        LogPrintf(\"connection from %s dropped: non-selectable socket\\n\", addr.ToString());\n-        CloseSocket(hSocket);\n-        return;\n+    const char* method = event_base_get_method(m_event_base);\n+    if (!method || (strncmp(method, \"select\", 6) == 0)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11227#discussion_r137125533",
      "id" : 137125533,
      "in_reply_to_id" : 136752250,
      "line" : 1400,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEzNzEyNTUzMw==",
      "original_commit_id" : "fa64f69c37f9ea3aee77ccad0cca8a13ec802fa6",
      "original_line" : 1400,
      "original_position" : 221,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 650,
      "pull_request_review_id" : 60752966,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11227",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/137125533/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2017-12-30T11:11:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/137125533",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11227#discussion_r137135950"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11227"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/137135950"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Should this be moved into the above `if` block? (It used to be inside the `if (notify)` statement)",
      "commit_id" : "77cee166e17e355306d2ca1a1d360e71c12d8350",
      "created_at" : "2017-09-05T23:00:14Z",
      "diff_hunk" : "@@ -841,36 +872,126 @@ const uint256& CNetMessage::GetMessageHash() const\n \n \n \n+size_t CConnman::SocketReceiveData(CNode* pnode)\n+{\n+    // typical socket buffer is 8K-64K\n+    char pchBuf[0x10000];\n+    int nBytes = recv(pnode->hSocket, pchBuf, sizeof(pchBuf), MSG_DONTWAIT);\n+    if (nBytes > 0)\n+    {\n+        bool notify = false;\n+        if (!pnode->ReceiveMsgBytes(pchBuf, nBytes, notify))\n+            pnode->Disconnect();\n \n+        auto it(pnode->vRecvMsg.begin());\n+        size_t nSizeAdded = 0;\n+        {\n+            LOCK(pnode->cs_vRecv);\n+            int64_t nTimeMicros = GetTimeMicros();\n+            pnode->nLastRecv = nTimeMicros / 1000000;\n+            pnode->nRecvBytes += nBytes;\n+            if (notify) {\n+                for (; it != pnode->vRecvMsg.end(); ++it) {\n+                    const auto& msg = *it;\n+                    if (!msg.complete())\n+                        break;\n+                    nSizeAdded += msg.vRecv.size() + CMessageHeader::HEADER_SIZE;\n+                    mapMsgCmdSize::iterator mapit = pnode->mapRecvBytesPerMsgCmd.find(msg.hdr.pchCommand);\n+                    if (mapit == pnode->mapRecvBytesPerMsgCmd.end())\n+                        mapit = pnode->mapRecvBytesPerMsgCmd.find(NET_MESSAGE_COMMAND_OTHER);\n+                    assert(mapit != pnode->mapRecvBytesPerMsgCmd.end());\n+                    mapit->second += msg.vRecv.size() + CMessageHeader::HEADER_SIZE;\n+                }\n+            }\n+        }\n+        if (it != pnode->vRecvMsg.begin()) {\n+            LOCK(pnode->cs_vProcessMsg);\n+            pnode->vProcessMsg.splice(pnode->vProcessMsg.end(), pnode->vRecvMsg, pnode->vRecvMsg.begin(), it);\n+            pnode->nProcessQueueSize += nSizeAdded;\n+            if (pnode->nProcessQueueSize > nReceiveFloodSize) {\n+                LogPrint(BCLog::NET, \"Disabling receive due to oversized process queue of size: %lu. peer=%i\\n\", pnode->nProcessQueueSize, pnode->GetId());\n+                pnode->fPauseRecv = true;\n+                event_del(pnode->m_read_event);\n+            }\n \n+        }\n+        WakeMessageHandler();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11227#discussion_r137135950",
      "id" : 137135950,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEzNzEzNTk1MA==",
      "original_commit_id" : "7274a18dc3b438b090b1423fff442c760ae1c851",
      "original_line" : 918,
      "original_position" : 164,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 60733609,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11227",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/137135950/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2017-09-20T20:41:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/137135950",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11227#discussion_r137138600"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11227"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/137138600"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> ||=\r\n\r\nI don't think such an operator exists in C++.",
      "commit_id" : "77cee166e17e355306d2ca1a1d360e71c12d8350",
      "created_at" : "2017-09-05T23:18:10Z",
      "diff_hunk" : "@@ -1150,7 +1150,7 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n         }\n     }\n \n-    bool whitelisted = hListenSocket.whitelisted || IsWhitelistedRange(addr);\n+    whitelisted = whitelisted || IsWhitelistedRange(addr);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11227#discussion_r137138600",
      "id" : 137138600,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEzNzEzODYwMA==",
      "original_commit_id" : "0d08cb3d896703d1435a3c2520635a1d79e7cf22",
      "original_line" : 1321,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 60767227,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11227",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/137138600/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2017-09-20T20:41:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/137138600",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11227#discussion_r137139010"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11227"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/137139010"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Oops, you're right. Should have checked.",
      "commit_id" : "77cee166e17e355306d2ca1a1d360e71c12d8350",
      "created_at" : "2017-09-05T23:21:19Z",
      "diff_hunk" : "@@ -1150,7 +1150,7 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n         }\n     }\n \n-    bool whitelisted = hListenSocket.whitelisted || IsWhitelistedRange(addr);\n+    whitelisted = whitelisted || IsWhitelistedRange(addr);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11227#discussion_r137139010",
      "id" : 137139010,
      "in_reply_to_id" : 137138600,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEzNzEzOTAxMA==",
      "original_commit_id" : "0d08cb3d896703d1435a3c2520635a1d79e7cf22",
      "original_line" : 1321,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 60767653,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11227",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/137139010/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2017-09-20T20:41:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/137139010",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "node_id" : "MDQ6VXNlcjg4MTI1Mw==",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11227#discussion_r137144026"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11227"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/137144026"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, thank you.",
      "commit_id" : "77cee166e17e355306d2ca1a1d360e71c12d8350",
      "created_at" : "2017-09-06T00:02:58Z",
      "diff_hunk" : "@@ -841,36 +872,126 @@ const uint256& CNetMessage::GetMessageHash() const\n \n \n \n+size_t CConnman::SocketReceiveData(CNode* pnode)\n+{\n+    // typical socket buffer is 8K-64K\n+    char pchBuf[0x10000];\n+    int nBytes = recv(pnode->hSocket, pchBuf, sizeof(pchBuf), MSG_DONTWAIT);\n+    if (nBytes > 0)\n+    {\n+        bool notify = false;\n+        if (!pnode->ReceiveMsgBytes(pchBuf, nBytes, notify))\n+            pnode->Disconnect();\n \n+        auto it(pnode->vRecvMsg.begin());\n+        size_t nSizeAdded = 0;\n+        {\n+            LOCK(pnode->cs_vRecv);\n+            int64_t nTimeMicros = GetTimeMicros();\n+            pnode->nLastRecv = nTimeMicros / 1000000;\n+            pnode->nRecvBytes += nBytes;\n+            if (notify) {\n+                for (; it != pnode->vRecvMsg.end(); ++it) {\n+                    const auto& msg = *it;\n+                    if (!msg.complete())\n+                        break;\n+                    nSizeAdded += msg.vRecv.size() + CMessageHeader::HEADER_SIZE;\n+                    mapMsgCmdSize::iterator mapit = pnode->mapRecvBytesPerMsgCmd.find(msg.hdr.pchCommand);\n+                    if (mapit == pnode->mapRecvBytesPerMsgCmd.end())\n+                        mapit = pnode->mapRecvBytesPerMsgCmd.find(NET_MESSAGE_COMMAND_OTHER);\n+                    assert(mapit != pnode->mapRecvBytesPerMsgCmd.end());\n+                    mapit->second += msg.vRecv.size() + CMessageHeader::HEADER_SIZE;\n+                }\n+            }\n+        }\n+        if (it != pnode->vRecvMsg.begin()) {\n+            LOCK(pnode->cs_vProcessMsg);\n+            pnode->vProcessMsg.splice(pnode->vProcessMsg.end(), pnode->vRecvMsg, pnode->vRecvMsg.begin(), it);\n+            pnode->nProcessQueueSize += nSizeAdded;\n+            if (pnode->nProcessQueueSize > nReceiveFloodSize) {\n+                LogPrint(BCLog::NET, \"Disabling receive due to oversized process queue of size: %lu. peer=%i\\n\", pnode->nProcessQueueSize, pnode->GetId());\n+                pnode->fPauseRecv = true;\n+                event_del(pnode->m_read_event);\n+            }\n \n+        }\n+        WakeMessageHandler();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11227#discussion_r137144026",
      "id" : 137144026,
      "in_reply_to_id" : 137135950,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEzNzE0NDAyNg==",
      "original_commit_id" : "7274a18dc3b438b090b1423fff442c760ae1c851",
      "original_line" : 918,
      "original_position" : 164,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 60773387,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11227",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/137144026/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2017-09-20T20:41:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/137144026",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11227#discussion_r137144255"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11227"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/137144255"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I can say for certain that the operator doesn't exist because I tried it first :)",
      "commit_id" : "77cee166e17e355306d2ca1a1d360e71c12d8350",
      "created_at" : "2017-09-06T00:04:50Z",
      "diff_hunk" : "@@ -1150,7 +1150,7 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n         }\n     }\n \n-    bool whitelisted = hListenSocket.whitelisted || IsWhitelistedRange(addr);\n+    whitelisted = whitelisted || IsWhitelistedRange(addr);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11227#discussion_r137144255",
      "id" : 137144255,
      "in_reply_to_id" : 137138600,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEzNzE0NDI1NQ==",
      "original_commit_id" : "0d08cb3d896703d1435a3c2520635a1d79e7cf22",
      "original_line" : 1321,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 60773619,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11227",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/137144255/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2017-09-20T20:41:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/137144255",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11227#discussion_r137347641"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11227"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/137347641"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Hehe I also remember it doesn't exist - I looked it up a long time ago and IIRC the rationale is that's because `|=` is the same when using only booleans. In any case this is ok as it is.",
      "commit_id" : "77cee166e17e355306d2ca1a1d360e71c12d8350",
      "created_at" : "2017-09-06T18:12:37Z",
      "diff_hunk" : "@@ -1150,7 +1150,7 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n         }\n     }\n \n-    bool whitelisted = hListenSocket.whitelisted || IsWhitelistedRange(addr);\n+    whitelisted = whitelisted || IsWhitelistedRange(addr);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11227#discussion_r137347641",
      "id" : 137347641,
      "in_reply_to_id" : 137138600,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEzNzM0NzY0MQ==",
      "original_commit_id" : "0d08cb3d896703d1435a3c2520635a1d79e7cf22",
      "original_line" : 1321,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 61002663,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11227",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/137347641/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2017-09-20T20:41:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/137347641",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Needs rebase.",
      "created_at" : "2017-10-18T21:19:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11227#issuecomment-337731082",
      "id" : 337731082,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11227",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDMzNzczMTA4Mg==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/337731082/reactions"
      },
      "updated_at" : "2017-10-18T21:19:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/337731082",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "<!--5fd3d806e98f4a0ca80977bb178665a0-->There hasn't been much activity lately and the patch still needs rebase, so I am closing this for now. Please let me know when you want to continue working on this, so the pull request can be re-opened.",
      "created_at" : "2018-11-08T23:20:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11227#issuecomment-437192644",
      "id" : 437192644,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11227",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNzE5MjY0NA==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/437192644/reactions"
      },
      "updated_at" : "2018-11-08T23:20:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/437192644",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   }
]
