[
   {
      "author_association" : "OWNER",
      "body" : "Awesome, I'm very happy to see someone work on this again.",
      "created_at" : "2017-09-04T00:21:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11226#issuecomment-326841879",
      "id" : 326841879,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11226",
      "updated_at" : "2017-09-04T00:21:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/326841879",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "You must have introduced a lock inversion, based on the Travis output.",
      "created_at" : "2017-09-04T09:00:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11226#issuecomment-326906921",
      "id" : 326906921,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11226",
      "updated_at" : "2017-09-04T09:00:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/326906921",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Squash commits `Add GUARDED_BY(cs_KeyStore)` and also `Add GUARDED_BY(cs) annotation`.",
      "created_at" : "2017-09-04T09:24:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11226#issuecomment-326912914",
      "id" : 326912914,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11226",
      "updated_at" : "2017-09-04T09:26:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/326912914",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@sipa Thanks for letting me know! I've now removed the commit with the incorrectly added `LOCK(walletInstance->cs_KeyStore)` in `wallet.cpp` that caused the lock inversion. Do you which variables `cs_KeyStore` is meant to guard?",
      "created_at" : "2017-09-04T15:25:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11226#issuecomment-326987651",
      "id" : 326987651,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11226",
      "updated_at" : "2017-09-04T19:32:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/326987651",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@promag Fixed! :-) Regarding the repeated `GUARDED_BY(cs)` commit messages - these actually refer to different `cs`:es. To make things less confusing I've now disambiguated them by adding the class names in the commit message.\r\n\r\nFurthermore I've added an commit which renames renames `CAddrMan.cs` to `CAddrMan.cs_addrMan`, and `CTxMemPool.cs` to `CTxMemPool.cs_txMemPool`.",
      "created_at" : "2017-09-04T15:28:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11226#issuecomment-326988190",
      "id" : 326988190,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11226",
      "updated_at" : "2017-09-04T15:28:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/326988190",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK. This will generate some turbulence in terms of needing to rebase a ton of existing PRs, so maybe it makes sense to break this into several PRs which only touch given modules? In any case, excited to see this stuff happen.",
      "created_at" : "2017-09-04T20:17:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11226#issuecomment-327023365",
      "id" : 327023365,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11226",
      "updated_at" : "2017-09-04T20:17:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/327023365",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "Concept ACK. Though I'm not sure what a good time to merge a huge, spread-out (though low-risk) change like this is. Maybe just before the 0.16 split?",
      "created_at" : "2017-09-06T22:28:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11226#issuecomment-327629626",
      "id" : 327629626,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11226",
      "updated_at" : "2017-09-06T22:28:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/327629626",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@laanwj Good point! When is the 0.16 split expected to happen?\r\n\r\nThe smaller PR #10866 lays the groundwork for the subsequent thread-safety-analysis annotation work. Having that PR merged a bit earlier would help a lot :-)",
      "created_at" : "2017-09-11T08:34:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11226#issuecomment-328458741",
      "id" : 328458741,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11226",
      "updated_at" : "2017-09-11T08:35:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/328458741",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@TheBlueMatt Sure, I can split this PR into multiple parts to ease reviewing! Just let me know which parts/modules to split it on :-) To avoid duplicating the commits in #10866 we should probably wait until #10866 is merged before splitting this PR up. Sounds reasonable?",
      "created_at" : "2017-09-11T08:40:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11226#issuecomment-328460258",
      "id" : 328460258,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11226",
      "updated_at" : "2017-09-11T08:40:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/328460258",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@sipa @TheBlueMatt @laanwj Thanks for reviewing and thanks for the encouragement! Do you happen to know which core developers that would be appropriate reviewers for this work (on a deeper `GUARDED_BY(Ã¢ÂÂ¦)` level for each module)?\r\n\r\nThe types of errors I might need some help from reviewers to avoid:\r\n* False positives: Too restrictive lock requirements. Requiring a lock where a lock is not needed. More concretely: unnecessary `GUARDED_BY(Ã¢ÂÂ¦)` annotations. (The `EXCLUSIVE_LOCKS_REQUIRED(Ã¢ÂÂ¦)` annotations follow more or less mechanically for the `GUARDED_BY(Ã¢ÂÂ¦)`.)\r\n* False negatives: Missing lock requirements. Not requiring a lock where a lock is needed. More concretely: missing `GUARDED_BY(Ã¢ÂÂ¦)` annotations.\r\n\r\nAnd perhaps most importantly: help reviewing that the *added* locks in this PR looks reasonable. In constrast to the annotations they alter run-time behaviour.\r\n\r\nThere are a couple of `AssertLockHeld(Ã¢ÂÂ¦)`:s that I've been unable to map to variables being guarded. I might need some help to track those down to add the corresponding `GUARDED_BY(Ã¢ÂÂ¦)`:s (and hence `EXCLUSIVE_LOCKS_REQUIRED(Ã¢ÂÂ¦)`). I'm a bit hesitant to just add `EXCLUSIVE_LOCKS_REQUIRED(Ã¢ÂÂ¦)` to match the `AssertLockHeld(Ã¢ÂÂ¦)` (which would be trivial) since that methodology hides the fact that the guard required hasn't been explicitly stated using an `GUARDED_BY(Ã¢ÂÂ¦)` annotation yet.",
      "created_at" : "2017-09-11T09:13:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11226#issuecomment-328469429",
      "id" : 328469429,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11226",
      "updated_at" : "2017-09-13T07:43:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/328469429",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "The code base contains 37 locks and in the process of documenting them I compiled this list of the initial creators of each lock. These lock introducers would likely be the best possible reviewers for the `GUARDED_BY(Ã¢ÂÂ¦)`:s in this PR for \"their\" respective locks :-)\r\n\r\n## Bitcoin locks hall of fame\r\n\r\nLocks introduced by currently active core devs:\r\n* @TheBlueMatt (10 locks): `cs_filter, cs_args, cs_vSend, cs_most_recent_block, cs_callbacks_pending (previously m_cs_callbacks_pending), cs_vAddedNodes, cs_SubVer, cs_addrName, cs_addrLocal, cs_sendProcessing`\r\n* @sipa (8 locks): `cs_KeyStore, cs_addrMan (previously cs), cs_mapLocalHost, cs_LastBlockFile, cs_vOneShots, cs_pathCached (previously csPathCached), cs_nTimeOffset, cs_nBlockSequenceId`\r\n* @theuni (3 locks): `cs_hSocket, cs_vRecv, cs_vProcessMsg`\r\n* @morcos (2 locks): `cs_feeEstimator, cs_feeFilter`\r\n* @gmaxwell (1 lock): `cs_warnings`\r\n\r\nPrevious lock introducers:\r\n* Locks included in the first commit in the repo (Satoshi locks!): `cs_main, cs_vNodes, cs_db, cs_inventory, cs_Shutdown`\r\n* gavinandresen: `cs_wallet, cs_txMemPool (previously cs), cs_setBanned`\r\n* sje397: `cs_totalBytesSent, cs_totalBytesRecv`\r\n* Clark Gaebel: `cs_test (previously cs)`\r\n* domob1812: `cs_rpcWarmup`\r\n* Philip Kaufmann: `cs_proxyInfos`\r\n",
      "created_at" : "2017-09-13T20:39:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11226#issuecomment-329289991",
      "id" : 329289991,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11226",
      "updated_at" : "2017-09-13T20:43:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/329289991",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm now down to only four remaining `AssertLockHeld(Ã¢ÂÂ¦)`:s for which I'm unable to identify which specific variable the lock in question is being a guard for.\r\n\r\nThese are the four cases I need help with:\r\n\r\n* [[validation.cpp] GetBlockScriptFlags(...)](https://github.com/bitcoin/bitcoin/blob/ea729d55b4dbd17a53ced474a8457d4759cfb5a5/src/validation.cpp#L1588-L1589) Ã¢ÂÂ `AssertLockHeld(cs_main);`\r\n* [[validation.cpp] AcceptBlockHeader(...)](https://github.com/bitcoin/bitcoin/blob/ea729d55b4dbd17a53ced474a8457d4759cfb5a5/src/validation.cpp#L3030-L3032) Ã¢ÂÂ `AssertLockHeld(cs_main);`\r\n* [[wallet/wallet.cpp] CWallet::RemoveWatchOnly(...)](https://github.com/bitcoin/bitcoin/blob/ea729d55b4dbd17a53ced474a8457d4759cfb5a5/src/wallet/wallet.cpp#L335-L337) Ã¢ÂÂ `AssertLockHeld(cs_wallet);`\r\n* [[wallet/wallet.cpp] CWallet::RescanFromTime(...)](https://github.com/bitcoin/bitcoin/blob/ea729d55b4dbd17a53ced474a8457d4759cfb5a5/src/wallet/wallet.cpp#L1530-L1533) Ã¢ÂÂ `AssertLockHeld(cs_wallet);`\r\n\r\nFor each of the above cases I see two alternatives:\r\n1. A `GUARDED_BY(Ã¢ÂÂ¦)` for some variable accessed directly or indirectly is missing.\r\n2. The lock is not technically necessary.",
      "created_at" : "2017-09-14T20:27:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11226#issuecomment-329599474",
      "id" : 329599474,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11226",
      "updated_at" : "2017-09-14T20:28:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/329599474",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I've now documented the five places where I'm opting out of thread-safety analysis for various reasons (using the `NO_THREAD_SAFETY_ANALYSIS` annotation): b72ad1f43d96b6f63e7a4046f31af085da4e86db\r\n\r\nPlease let me know if there is a way to remove any of these opt-outs.",
      "created_at" : "2017-09-15T09:17:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11226#issuecomment-329728351",
      "id" : 329728351,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11226",
      "updated_at" : "2017-09-15T09:17:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/329728351",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@practicalswift \r\n\r\n* GetBlockScriptFlags() needs cs_main for versionbitscache (maybe others, but probably just that?)\r\n* AcceptBlockHeader is mostly for mapBlockIndex it looks like\r\n* RemoveWatchOnly looks like it may need to be an atomic operation, but I haven't dug into it too much. It may very well be the case that you'd miss a NotifyWatchonlyChanged fire if you have an AddWatchOnly and a RemoveWatchOnly call at the same time (though I don't know if there are any negative effects from doing so).\r\n* RescanFromTime indeed does not appear to require cs_wallet (obviously ScanForWalletTransactions does, but it takes it itself). It obviously needs cs_main, though.",
      "created_at" : "2017-09-15T18:25:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11226#issuecomment-329863375",
      "id" : 329863375,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11226",
      "updated_at" : "2017-09-15T18:25:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/329863375",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@TheBlueMatt Thanks! I'll look into the suggested fixes.",
      "created_at" : "2017-09-15T18:48:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11226#issuecomment-329868802",
      "id" : 329868802,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11226",
      "updated_at" : "2017-09-15T18:48:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/329868802",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@jonasschnelli @TheBlueMatt In `CDB::PeriodicFlush(CWalletDBWrapper& dbw)` ([code](https://github.com/bitcoin/bitcoin/blob/39ae41389a8694ec1ab9059117ed2cdd2003d0d3/src/wallet/db.cpp#L604-L612)) we are currently trying to lock `bitdb.cs_db` Ã¢ÂÂÃÂ shouldn't that lock be on `env->cs_db` instead (`CDBEnv *env = dbw.env`)? Or am I reading it wrong? :-)\r\n\r\n",
      "created_at" : "2017-09-16T14:22:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11226#issuecomment-329971393",
      "id" : 329971393,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11226",
      "updated_at" : "2017-09-16T14:22:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/329971393",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@laanwj, after some digging I found your `bitdb` reference cleanup commit be9e1a968debbb7ede8ed50e9288a62ff15d1e1e, perhaps you know the answer to the question about the `bitdb.cs_db` lock above? :-)",
      "created_at" : "2017-09-16T18:12:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11226#issuecomment-329985651",
      "id" : 329985651,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11226",
      "updated_at" : "2017-09-16T18:12:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/329985651",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased!",
      "created_at" : "2017-10-02T14:33:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11226#issuecomment-333552872",
      "id" : 333552872,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11226",
      "updated_at" : "2017-10-02T14:33:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/333552872",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This change is great, but I might suggest breaking off and grouping the ADD_LOCK commits into a few separate PRs. That way the runtime changes can be more easily and carefully vetted, and this PR can exclusively focus on adding compiler annotations and also be more easily reviewed.",
      "created_at" : "2017-11-02T15:20:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11226#issuecomment-341455991",
      "id" : 341455991,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11226",
      "updated_at" : "2017-11-02T15:20:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/341455991",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@ryanofsky Very good point! I'll do that! Thanks.",
      "created_at" : "2017-11-02T16:47:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11226#issuecomment-341484866",
      "id" : 341484866,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11226",
      "updated_at" : "2017-11-02T16:47:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/341484866",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@ryanofsky One slight problem is that this PR won't compile cleanly unless the locks are added. But you thinking was that the individual \"add locks\"-PR should be merged before this PR gets merged (and hence no need for add locks in this PR when it is time to merge it)? That works for me :-)",
      "created_at" : "2017-11-02T17:16:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11226#issuecomment-341494112",
      "id" : 341494112,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11226",
      "updated_at" : "2017-11-02T17:16:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/341494112",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Yeah, I was thinking there would be a handful of other prs which this would depend on since the LOCKs are in different parts of the code, and different people might want to review them. Those PRs would all have their own branches, and the branch for this PR could just `git merge` in those branches until they get merged to master.",
      "created_at" : "2017-11-02T17:24:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11226#issuecomment-341496939",
      "id" : 341496939,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11226",
      "updated_at" : "2017-11-02T17:24:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/341496939",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@ryanofsky Excellent! That'll be our plan!",
      "created_at" : "2017-11-02T17:42:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11226#issuecomment-341502401",
      "id" : 341502401,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11226",
      "updated_at" : "2017-11-02T17:42:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/341502401",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Alright, with the depends, it seems like time to start breaking this up, no? There is no way this is going to get merged in one go, though its been great to see this keep getting rebased since it has caught a few errors already :).",
      "created_at" : "2017-11-10T01:00:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11226#issuecomment-343342388",
      "id" : 343342388,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11226",
      "updated_at" : "2017-11-10T01:00:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/343342388",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Pretty sure this is already happening. There have been a bunch of new prs adding locking. As they are merged, the \"ADD LOCK\" commits here can go away and this will shrink, only adding annotations without changing behaviour.",
      "created_at" : "2017-11-10T01:06:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11226#issuecomment-343343387",
      "id" : 343343387,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11226",
      "updated_at" : "2017-11-10T01:06:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/343343387",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@ryanofsky I was referring to adding the annotations - as far as I've seen the only @practicalswift PRs in the locking space have been adding missing locks detected by the annotations, not actually adding the annotations.\n\nOn November 9, 2017 8:06:51 PM EST, Russell Yanofsky <notifications@github.com> wrote:\n>Pretty sure this is already happening. There have been a bunch of new\n>prs adding locking. As they are merged, the \"ADD LOCK\" commits here can\n>go away and this will shrink, only adding annotations without changing\n>behaviour.\n>\n>-- \n>You are receiving this because you were mentioned.\n>Reply to this email directly or view it on GitHub:\n>https://github.com/bitcoin/bitcoin/pull/11226#issuecomment-343343387\n",
      "created_at" : "2017-11-10T03:13:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11226#issuecomment-343362978",
      "id" : 343362978,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11226",
      "updated_at" : "2017-11-10T03:13:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/343362978",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Since annotations don't change behaviour, it seems to me that having one PR that *just* adds annotations is fine and probably easier to review than lots of different PRs adding annotations.\r\n\r\nAdding new locks is much more dicey, and changes that add new locks should be smaller and get more careful review. This is happening now with #11634, #11623, #11596, etc, and I'm assuming there will be more.\r\n\r\n@practicalswift, you may want to add WIP / Work in progress to the description here to indicate that this is currently a work in progress, and that this PR will eventually only add annotations and not change locking or other runtime behavior, since right now it is doing a little of everything.",
      "created_at" : "2017-11-10T03:39:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11226#issuecomment-343366242",
      "id" : 343366242,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11226",
      "updated_at" : "2017-11-10T03:39:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/343366242",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I tend to disagree - if we add annotations and get them wrong we're\nlikely to fool ourselves in the future on locking changes - making sure\nthat a function which doesn't access variables which need locks but\nwhich needs results from two other function calls to be consistent has\nthe appropriate annotation may end up pretty important. Even better, we\nshould take this as an opportunity to fix obviously bad locking and\nreduce the coverage of locks when there are easy places to do so!\n\nOn 11/09/17 22:39, Russell Yanofsky wrote:\n> Since annotations don't change behaviour, it seems to me that having one\n> PR that /just/ adds annotations is fine and probably easier to review\n> than lots of different PRs adding annotations.\n> \n> Adding new locks is much more dicey, and changes that add new locks\n> should be smaller and get more careful review. This is happening now\n> with #11634 <https://github.com/bitcoin/bitcoin/pull/11634>, #11623\n> <https://github.com/bitcoin/bitcoin/pull/11623>, #11596\n> <https://github.com/bitcoin/bitcoin/pull/11596>, etc, and I'm assuming\n> there will be more.\n> \n> @practicalswift <https://github.com/practicalswift>, you may want to add\n> WIP / Work in progress to the description here to indicate that this is\n> currently a work in progress, and that this PR will eventually only add\n> annotations and not change locking or other runtime behavior, since\n> right now it is doing a little of everything.\n> \n> Ã¢ÂÂ\n> You are receiving this because you were mentioned.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/bitcoin/bitcoin/pull/11226#issuecomment-343366242>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AAnoHpnNC6mocaDz3cXFXZ-P61DDJuR_ks5s08WNgaJpZM4PLPK1>.\n> \n",
      "created_at" : "2017-11-10T04:06:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11226#issuecomment-343369453",
      "id" : 343369453,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11226",
      "updated_at" : "2017-11-10T04:06:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/343369453",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@ryanofsky @TheBlueMatt What about doing both: I start by submitting the `LOCK(Ã¢ÂÂ¦)`:s as separate PR:s and when these are merged I continue by submitting the annotations (`GUARDED_BY(Ã¢ÂÂ¦)`/`EXCLUSIVE_LOCKS_REQUIRED(Ã¢ÂÂ¦)`) in separate PR:s. All while keeping this PR updated with both types of changes. Sounds good?\r\n\r\nRegarding the latter, should I submit the annotation PR:s on a per-lock basis (i.e. one PR with all `cs_wallet` annotations, etc.)?",
      "created_at" : "2017-11-10T19:16:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11226#issuecomment-343561308",
      "id" : 343561308,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11226",
      "updated_at" : "2017-11-10T19:17:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/343561308",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Needs rebase.\r\nFor the purpose of easing review and speeding up merge: What about submitting a subset of this that only renames the comments `// protected by ${cs}` to `GUARDED_BY(${cs})`. Assuming that the existing comments are reviewed such a subset should be refactoring-only and easier to merge.",
      "created_at" : "2018-01-10T14:24:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11226#issuecomment-356616856",
      "id" : 356616856,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11226",
      "updated_at" : "2018-01-10T14:24:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/356616856",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke Do you mean a new PR with the `GUARDED_BY(Ã¢ÂÂ¦)`:s in this PR added instead as comments `// GUARDED_BY(Ã¢ÂÂ¦)`? Sure, confirm and I'll do that.\r\n\r\nRegarding rebasing Ã¢ÂÂ I suggest we merge (or close in the case of NACK) the locking related [PR:s I currently have open](https://github.com/bitcoin/bitcoin/pulls/practicalswift) and I'll rebase this PR on top of `master` after that. Makes sense?",
      "created_at" : "2018-01-31T16:22:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11226#issuecomment-361985753",
      "id" : 361985753,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11226",
      "updated_at" : "2018-01-31T16:25:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/361985753",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Something like e7f4866d499c4f1a5c17fa140be090da7c940c86, but at this point I am not sure if it is going to help review a lot.",
      "created_at" : "2018-02-02T23:38:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11226#issuecomment-362741639",
      "id" : 362741639,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11226",
      "updated_at" : "2018-02-02T23:38:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/362741639",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Closing. Will split this into subsets and submit as separate PR:s.",
      "created_at" : "2018-02-22T21:46:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11226#issuecomment-367833103",
      "id" : 367833103,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11226",
      "updated_at" : "2018-02-22T21:46:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/367833103",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "To facilitate reviewing the most important parts of this thread-safety PR (milestone 0.17.0) have been submitted as individual PR:s Ã¢ÂÂ\r\n\r\n* #12665 Ã¢ÂÂ Add compile time checking for all run time locking assertions\r\n* #11795 Ã¢ÂÂ Avoid locking cs_vNodes twice when calling FindNode(...)\r\n* #11762 Ã¢ÂÂ Avoid locking mutexes that are already held by the same thread\r\n* #11694 Ã¢ÂÂ Add missing cs_main lock in getblocktemplate(...)\r\n* #11689 Ã¢ÂÂ Fix missing locking in CTxMemPool::check(Ã¢ÂÂ¦) and CTxMemPool::setSanityCheck(Ã¢ÂÂ¦)\r\n* #11652 Ã¢ÂÂ Add missing locks to init.cpp (in AppInitMain + ThreadImport) and validation.cpp\r\n* #11634 Ã¢ÂÂ Add missing cs_wallet/cs_KeyStore locks to wallet\r\n* #11617 Ã¢ÂÂ Call FlushStateToDisk(...) regardless of fCheckForPruning\r\n* #11596 Ã¢ÂÂ Add missing cs_main locks when accessing chainActive\r\n\r\nReviews of these PR:s would be really appreciated! :-)\r\n\r\nI'll tackle the remaining parts once the above PR:s have been merged or closed. Complete thread safety annotation coverage is not far away now! :-)",
      "created_at" : "2018-03-12T22:37:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11226#issuecomment-372485811",
      "id" : 372485811,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11226",
      "updated_at" : "2018-03-12T22:38:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/372485811",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   }
]
