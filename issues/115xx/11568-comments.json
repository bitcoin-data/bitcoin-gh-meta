[
   {
      "author_association" : "MEMBER",
      "body" : "Needed rebase",
      "created_at" : "2017-10-26T20:40:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11568#issuecomment-339794211",
      "id" : 339794211,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11568",
      "updated_at" : "2017-10-26T20:40:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/339794211",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "utACK 8ca0ffa127e1a11dca3a17f6d9b3079e92fd3771",
      "created_at" : "2017-10-26T21:57:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11568#issuecomment-339812899",
      "id" : 339812899,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11568",
      "updated_at" : "2017-10-26T21:57:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/339812899",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11568#discussion_r147334764"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11568"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/147334764"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Carrying forward my cranky-old-man-rant from: https://github.com/bitcoin/bitcoin/pull/11446#discussion_r144654182\r\n\r\nThis is crazy-confusing to read. If the header was bad enough to earn them some ban points, put the points on the score-board and carry on. But if it wasn't bad enough for points, kick them immediately.\r\n\r\nIf we're punishing for invalid, I think the disconnect needs to always happen ```if (state.IsInvalid)```. Using points as a proxy for some certain invalid condition(s) is really non-obvious.",
      "commit_id" : "37886d5e2f9992678dea4b1bd893f4f10d61d3ad",
      "created_at" : "2017-10-27T06:55:15Z",
      "diff_hunk" : "@@ -1264,6 +1264,9 @@ bool static ProcessHeadersMessage(CNode *pfrom, CConnman *connman, const std::ve\n             if (nDoS > 0) {\n                 LOCK(cs_main);\n                 Misbehaving(pfrom->GetId(), nDoS);\n+            } else if (!pfrom->fInbound && !pfrom->m_manual_connection && punish_invalid) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11568#discussion_r147334764",
      "id" : 147334764,
      "original_commit_id" : "8ca0ffa127e1a11dca3a17f6d9b3079e92fd3771",
      "original_position" : 13,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 72416330,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11568",
      "updated_at" : "2017-10-27T20:30:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/147334764",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11568#discussion_r147335063"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11568"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/147335063"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's weird to have a punish_invalid param that only punishes based on its own criteria. That means that both sites have to consider all constraints.\r\n\r\nInstead, from the ::HEADERS handler, how about something like:\r\n```c++\r\nbool punish_invalid = !pfrom->fInbound && !pfrom->m_manual_connection;\r\nProcessHeadersMessage(..., should_punish);\r\n```",
      "commit_id" : "37886d5e2f9992678dea4b1bd893f4f10d61d3ad",
      "created_at" : "2017-10-27T06:57:37Z",
      "diff_hunk" : "@@ -1264,6 +1264,9 @@ bool static ProcessHeadersMessage(CNode *pfrom, CConnman *connman, const std::ve\n             if (nDoS > 0) {\n                 LOCK(cs_main);\n                 Misbehaving(pfrom->GetId(), nDoS);\n+            } else if (!pfrom->fInbound && !pfrom->m_manual_connection && punish_invalid) {\n+                // Don't keep outbound peers that are on an invalid chain",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11568#discussion_r147335063",
      "id" : 147335063,
      "original_commit_id" : "8ca0ffa127e1a11dca3a17f6d9b3079e92fd3771",
      "original_position" : 14,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 72416682,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11568",
      "updated_at" : "2017-10-27T20:30:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/147335063",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. No hostility intended, I'm just still having a hard time understanding the intended ban/disconnect behavior.",
      "created_at" : "2017-10-27T07:05:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11568#issuecomment-339890772",
      "id" : 339890772,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11568",
      "updated_at" : "2017-10-27T07:05:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/339890772",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11568#discussion_r147442770"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11568"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/147442770"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I agree with @theuni. Think this should be `if ...` not `else if ...` so that we always disconnect on invalid blocks.",
      "commit_id" : "37886d5e2f9992678dea4b1bd893f4f10d61d3ad",
      "created_at" : "2017-10-27T15:31:39Z",
      "diff_hunk" : "@@ -1264,6 +1264,9 @@ bool static ProcessHeadersMessage(CNode *pfrom, CConnman *connman, const std::ve\n             if (nDoS > 0) {\n                 LOCK(cs_main);\n                 Misbehaving(pfrom->GetId(), nDoS);\n+            } else if (!pfrom->fInbound && !pfrom->m_manual_connection && punish_invalid) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11568#discussion_r147442770",
      "id" : 147442770,
      "in_reply_to_id" : 147334764,
      "original_commit_id" : "8ca0ffa127e1a11dca3a17f6d9b3079e92fd3771",
      "original_position" : 13,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 72543322,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11568",
      "updated_at" : "2017-10-27T20:30:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/147442770",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11568#discussion_r147444455"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11568"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/147444455"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Obviously this is very, very much a stop-gap for 0.15.0.2. Next up is refactoring the CValidationState logic to have a concept of *what* went wrong (bad-by-soft-fork, bad-by-prev-block, bad-by-....) and then just move all of the DoS logic into net_processing. I believe a switch to if instead of else if may break the \"prev block not found\" handling, so I'm happy to commit to pushing for a DoS overhaul by 0.16 in the coming months.",
      "commit_id" : "37886d5e2f9992678dea4b1bd893f4f10d61d3ad",
      "created_at" : "2017-10-27T15:38:26Z",
      "diff_hunk" : "@@ -1264,6 +1264,9 @@ bool static ProcessHeadersMessage(CNode *pfrom, CConnman *connman, const std::ve\n             if (nDoS > 0) {\n                 LOCK(cs_main);\n                 Misbehaving(pfrom->GetId(), nDoS);\n+            } else if (!pfrom->fInbound && !pfrom->m_manual_connection && punish_invalid) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11568#discussion_r147444455",
      "id" : 147444455,
      "in_reply_to_id" : 147334764,
      "original_commit_id" : "8ca0ffa127e1a11dca3a17f6d9b3079e92fd3771",
      "original_position" : 13,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 72545336,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11568",
      "updated_at" : "2017-10-27T20:30:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/147444455",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11568#discussion_r147446565"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11568"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/147446565"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Can you add a comment saying why this avoids disconnecting on compact block messages with invalid headers? It's unclear whether it's important not to disconnect or whether it's an arbitrary decision and you're just being conservative. You could also consider renaming punish_invalid to disconnect_invalid or similar to be more specific.",
      "commit_id" : "37886d5e2f9992678dea4b1bd893f4f10d61d3ad",
      "created_at" : "2017-10-27T15:46:15Z",
      "diff_hunk" : "@@ -2349,7 +2352,7 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n             return ProcessMessage(pfrom, NetMsgType::BLOCKTXN, blockTxnMsg, nTimeReceived, chainparams, connman, interruptMsgProc);\n \n         if (fRevertToHeaderProcessing)\n-            return ProcessMessage(pfrom, NetMsgType::HEADERS, vHeadersMsg, nTimeReceived, chainparams, connman, interruptMsgProc);\n+            return ProcessHeadersMessage(pfrom, connman, {cmpctblock.header}, chainparams, /*punish_invalid=*/false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11568#discussion_r147446565",
      "id" : 147446565,
      "original_commit_id" : "8ca0ffa127e1a11dca3a17f6d9b3079e92fd3771",
      "original_position" : 24,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 72547899,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11568",
      "updated_at" : "2017-10-27T20:30:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/147446565",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11568#discussion_r147447693"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11568"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/147447693"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This suggestion doesn't apply if you make the changes Cory and Andrew are asking, but otherwise it would be nice if this comment said something about why it avoids disconnecting when nDoS > 0.",
      "commit_id" : "37886d5e2f9992678dea4b1bd893f4f10d61d3ad",
      "created_at" : "2017-10-27T15:50:41Z",
      "diff_hunk" : "@@ -1264,6 +1264,9 @@ bool static ProcessHeadersMessage(CNode *pfrom, CConnman *connman, const std::ve\n             if (nDoS > 0) {\n                 LOCK(cs_main);\n                 Misbehaving(pfrom->GetId(), nDoS);\n+            } else if (!pfrom->fInbound && !pfrom->m_manual_connection && punish_invalid) {\n+                // Don't keep outbound peers that are on an invalid chain",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11568#discussion_r147447693",
      "id" : 147447693,
      "original_commit_id" : "8ca0ffa127e1a11dca3a17f6d9b3079e92fd3771",
      "original_position" : 14,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 72547899,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11568",
      "updated_at" : "2017-10-27T20:30:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/147447693",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11568#discussion_r147454687"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11568"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/147454687"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sounds good.",
      "commit_id" : "37886d5e2f9992678dea4b1bd893f4f10d61d3ad",
      "created_at" : "2017-10-27T16:19:25Z",
      "diff_hunk" : "@@ -1264,6 +1264,9 @@ bool static ProcessHeadersMessage(CNode *pfrom, CConnman *connman, const std::ve\n             if (nDoS > 0) {\n                 LOCK(cs_main);\n                 Misbehaving(pfrom->GetId(), nDoS);\n+            } else if (!pfrom->fInbound && !pfrom->m_manual_connection && punish_invalid) {\n+                // Don't keep outbound peers that are on an invalid chain",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11568#discussion_r147454687",
      "id" : 147454687,
      "in_reply_to_id" : 147335063,
      "original_commit_id" : "8ca0ffa127e1a11dca3a17f6d9b3079e92fd3771",
      "original_position" : 14,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 72557673,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11568",
      "updated_at" : "2017-10-27T20:30:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/147454687",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11568#discussion_r147477607"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11568"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/147477607"
         }
      },
      "author_association" : "MEMBER",
      "body" : "After further analysis, I think the logic I've presented here is undesirable, because there is at least one situation where we should not disconnect an outbound peer for an invalid block header, which is when the block timestamp is too far in the future.  This is a problem whether or not we break this `else if` out into its own `if` clause.\r\n\r\nI'm going to add a commit that reworks this to explicitly look for the case where the first invalid block header processed is one for which we have the entry in our mapBlockIndex, and only disconnect in that case.  I think the review burden will be somewhat (much?) lower for such an approach, and it still accomplishes the overall goal of disconnecting peers on (some, but not all) known-invalid headers chains.",
      "commit_id" : "37886d5e2f9992678dea4b1bd893f4f10d61d3ad",
      "created_at" : "2017-10-27T18:00:57Z",
      "diff_hunk" : "@@ -1264,6 +1264,9 @@ bool static ProcessHeadersMessage(CNode *pfrom, CConnman *connman, const std::ve\n             if (nDoS > 0) {\n                 LOCK(cs_main);\n                 Misbehaving(pfrom->GetId(), nDoS);\n+            } else if (!pfrom->fInbound && !pfrom->m_manual_connection && punish_invalid) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11568#discussion_r147477607",
      "id" : 147477607,
      "in_reply_to_id" : 147334764,
      "original_commit_id" : "8ca0ffa127e1a11dca3a17f6d9b3079e92fd3771",
      "original_position" : 13,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 72584555,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11568",
      "updated_at" : "2017-10-27T20:30:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/147477607",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I reworked the disconnect logic to (hopefully) be much clearer, and narrowly tailored to the situation that we're interested in.",
      "created_at" : "2017-10-27T18:14:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11568#issuecomment-340045820",
      "id" : 340045820,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11568",
      "updated_at" : "2017-10-27T18:14:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/340045820",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 4cde638d4ce054ffdadc3bf65ae5dfa81b01aee2",
      "created_at" : "2017-10-27T18:25:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11568#issuecomment-340048564",
      "id" : 340048564,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11568",
      "updated_at" : "2017-10-27T18:25:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/340048564",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11568#discussion_r147488855"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11568"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/147488855"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "37886d5e2f9992678dea4b1bd893f4f10d61d3ad",
      "created_at" : "2017-10-27T18:47:19Z",
      "diff_hunk" : "@@ -2349,7 +2352,7 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n             return ProcessMessage(pfrom, NetMsgType::BLOCKTXN, blockTxnMsg, nTimeReceived, chainparams, connman, interruptMsgProc);\n \n         if (fRevertToHeaderProcessing)\n-            return ProcessMessage(pfrom, NetMsgType::HEADERS, vHeadersMsg, nTimeReceived, chainparams, connman, interruptMsgProc);\n+            return ProcessHeadersMessage(pfrom, connman, {cmpctblock.header}, chainparams, /*punish_invalid=*/false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11568#discussion_r147488855",
      "id" : 147488855,
      "in_reply_to_id" : 147446565,
      "original_commit_id" : "8ca0ffa127e1a11dca3a17f6d9b3079e92fd3771",
      "original_position" : 24,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 72597475,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11568",
      "updated_at" : "2017-10-27T20:30:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/147488855",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11568#discussion_r147488919"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11568"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/147488919"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Reworked this and added an explanatory comment.",
      "commit_id" : "37886d5e2f9992678dea4b1bd893f4f10d61d3ad",
      "created_at" : "2017-10-27T18:47:37Z",
      "diff_hunk" : "@@ -1264,6 +1264,9 @@ bool static ProcessHeadersMessage(CNode *pfrom, CConnman *connman, const std::ve\n             if (nDoS > 0) {\n                 LOCK(cs_main);\n                 Misbehaving(pfrom->GetId(), nDoS);\n+            } else if (!pfrom->fInbound && !pfrom->m_manual_connection && punish_invalid) {\n+                // Don't keep outbound peers that are on an invalid chain",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11568#discussion_r147488919",
      "id" : 147488919,
      "in_reply_to_id" : 147447693,
      "original_commit_id" : "8ca0ffa127e1a11dca3a17f6d9b3079e92fd3771",
      "original_position" : 14,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 72597547,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11568",
      "updated_at" : "2017-10-27T20:30:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/147488919",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11568#discussion_r147494692"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11568"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/147494692"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think the hacky vHeadersMsg serialization stuff can be removed now that ProcessHeadersMessage is factored out.",
      "commit_id" : "37886d5e2f9992678dea4b1bd893f4f10d61d3ad",
      "created_at" : "2017-10-27T19:13:55Z",
      "diff_hunk" : "@@ -2349,7 +2352,7 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n             return ProcessMessage(pfrom, NetMsgType::BLOCKTXN, blockTxnMsg, nTimeReceived, chainparams, connman, interruptMsgProc);\n \n         if (fRevertToHeaderProcessing)\n-            return ProcessMessage(pfrom, NetMsgType::HEADERS, vHeadersMsg, nTimeReceived, chainparams, connman, interruptMsgProc);\n+            return ProcessHeadersMessage(pfrom, connman, {cmpctblock.header}, chainparams, /*punish_invalid=*/false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11568#discussion_r147494692",
      "id" : 147494692,
      "in_reply_to_id" : 147446565,
      "original_commit_id" : "8ca0ffa127e1a11dca3a17f6d9b3079e92fd3771",
      "original_position" : 24,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 72604408,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11568",
      "updated_at" : "2017-10-27T20:30:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/147494692",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Somewhat tested ACK 4cde638d4ce054ffdadc3bf65ae5dfa81b01aee2.\r\n\r\nI have a test case that proves a peer gets kicked for sending an invalid header here: https://github.com/jnewbery/bitcoin/tree/pr11568.2 so I can verify that this PR works in the positive case (ie it disconnects when it's supposed to). I don't think that there are corner cases where this PR might cause other changes in existing behaviour, but I haven't been able to convince myself of that.\r\n\r\nThe test case in https://github.com/jnewbery/bitcoin/tree/pr11568.2 should be reviewed and merged separately and shouldn't hold up merging or backporting this PR. It builds on #10160 which isn't yet merged, and the test itself is potentially racey so could be improved.",
      "created_at" : "2017-10-27T20:10:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11568#issuecomment-340073347",
      "id" : 340073347,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11568",
      "updated_at" : "2017-10-27T20:10:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/340073347",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK other than https://github.com/bitcoin/bitcoin/pull/11568#discussion_r147494692",
      "created_at" : "2017-10-27T20:18:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11568#issuecomment-340075148",
      "id" : 340075148,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11568",
      "updated_at" : "2017-10-27T20:18:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/340075148",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11568#discussion_r147507583"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11568"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/147507583"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, I had been looking forward to nuking that, and then forgot! Done.",
      "commit_id" : "37886d5e2f9992678dea4b1bd893f4f10d61d3ad",
      "created_at" : "2017-10-27T20:18:38Z",
      "diff_hunk" : "@@ -2349,7 +2352,7 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n             return ProcessMessage(pfrom, NetMsgType::BLOCKTXN, blockTxnMsg, nTimeReceived, chainparams, connman, interruptMsgProc);\n \n         if (fRevertToHeaderProcessing)\n-            return ProcessMessage(pfrom, NetMsgType::HEADERS, vHeadersMsg, nTimeReceived, chainparams, connman, interruptMsgProc);\n+            return ProcessHeadersMessage(pfrom, connman, {cmpctblock.header}, chainparams, /*punish_invalid=*/false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11568#discussion_r147507583",
      "id" : 147507583,
      "in_reply_to_id" : 147446565,
      "original_commit_id" : "8ca0ffa127e1a11dca3a17f6d9b3079e92fd3771",
      "original_position" : 24,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 72619385,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11568",
      "updated_at" : "2017-10-27T20:30:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/147507583",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ewww-ewww-ewww-ewww-ewww-I've-already-started-working-on-rewriting-DoS-interface utACK bf5494badac903af51802e9aeb1ca1ca0f83a59c",
      "created_at" : "2017-10-27T20:24:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11568#issuecomment-340076377",
      "id" : 340076377,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11568",
      "updated_at" : "2017-10-27T20:24:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/340076377",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sdaftuar Thanks!\r\n\r\n@TheBlueMatt Please consider working on top of #11457 (will rebase) which allows for much more straightforward banning.",
      "created_at" : "2017-10-27T20:27:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11568#issuecomment-340077055",
      "id" : 340077055,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11568",
      "updated_at" : "2017-10-27T20:27:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/340077055",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Squashed https://github.com/sdaftuar/bitcoin/commits/11568.0 -> 37886d5e2f9992678dea4b1bd893f4f10d61d3ad",
      "created_at" : "2017-10-27T20:31:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11568#issuecomment-340077898",
      "id" : 340077898,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11568",
      "updated_at" : "2017-10-27T20:31:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/340077898",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Verified same as unsquashed. utACK 37886d5.",
      "created_at" : "2017-10-27T20:41:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11568#issuecomment-340079974",
      "id" : 340079974,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11568",
      "updated_at" : "2017-10-27T20:41:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/340079974",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "utACK 37886d5",
      "created_at" : "2017-10-28T16:41:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11568#issuecomment-340203848",
      "id" : 340203848,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11568",
      "updated_at" : "2017-10-28T16:41:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/340203848",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11568#discussion_r147558672"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11568"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/147558672"
         }
      },
      "author_association" : "OWNER",
      "body" : "Thanks for adding a comment before the argument, that's a good way to avoid boolean arguments turning into an unreadable blob of arguments.",
      "commit_id" : "37886d5e2f9992678dea4b1bd893f4f10d61d3ad",
      "created_at" : "2017-10-28T16:43:57Z",
      "diff_hunk" : "@@ -2176,8 +2378,14 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n         if (fProcessBLOCKTXN)\n             return ProcessMessage(pfrom, NetMsgType::BLOCKTXN, blockTxnMsg, nTimeReceived, chainparams, connman, interruptMsgProc);\n \n-        if (fRevertToHeaderProcessing)\n-            return ProcessMessage(pfrom, NetMsgType::HEADERS, vHeadersMsg, nTimeReceived, chainparams, connman, interruptMsgProc);\n+        if (fRevertToHeaderProcessing) {\n+            // Headers received from HB compact block peers are permitted to be\n+            // relayed before full validation (see BIP 152), so we don't want to disconnect\n+            // the peer if the header turns out to be for an invalid block.\n+            // Note that if a peer tries to build on an invalid chain, that\n+            // will be detected and the peer will be banned.\n+            return ProcessHeadersMessage(pfrom, connman, {cmpctblock.header}, chainparams, /*punish_duplicate_invalid=*/false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11568#discussion_r147558672",
      "id" : 147558672,
      "original_commit_id" : "37886d5e2f9992678dea4b1bd893f4f10d61d3ad",
      "original_position" : 245,
      "path" : "src/net_processing.cpp",
      "position" : 245,
      "pull_request_review_id" : 72676012,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11568",
      "updated_at" : "2017-10-28T16:43:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/147558672",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Posthumous utACK https://github.com/bitcoin/bitcoin/commit/37886d5e2f9992678dea4b1bd893f4f10d61d3ad",
      "created_at" : "2017-10-28T20:15:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11568#issuecomment-340217002",
      "id" : 340217002,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11568",
      "updated_at" : "2017-10-28T20:15:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/340217002",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   }
]
