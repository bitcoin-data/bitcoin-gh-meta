[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ACK 3ab545d.\r\n\r\nI think all `CAddrMan` members should be guarded by `cs`, so LGTM as it is:\r\nhttps://github.com/bitcoin/bitcoin/blob/8335cb478183d800e274f6e96f9d7269ae584220/src/addrman.h#L184-L186",
      "created_at" : "2017-10-31T14:44:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11585#issuecomment-340784537",
      "id" : 340784537,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11585",
      "updated_at" : "2017-10-31T14:44:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/340784537",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for the quick review @promag!\r\n\r\n@promag, you mean that all of the following should be guarded by `cs`? If so I think we might be missing some additional locks. Let me know and I'll investigate.\r\n\r\n```\r\n    //! last used nId\r\n    int nIdCount;\r\n\r\n    //! table with information about all nIds\r\n    std::map<int, CAddrInfo> mapInfo;\r\n\r\n    //! find an nId based on its network address\r\n    std::map<CNetAddr, int> mapAddr;\r\n\r\n    //! randomly-ordered vector of all nIds\r\n    std::vector<int> vRandom;\r\n\r\n    // number of \"tried\" entries\r\n    int nTried;\r\n\r\n    //! list of \"tried\" buckets\r\n    int vvTried[ADDRMAN_TRIED_BUCKET_COUNT][ADDRMAN_BUCKET_SIZE];\r\n\r\n    //! number of (unique) \"new\" entries\r\n    int nNew;\r\n\r\n    //! list of \"new\" buckets\r\n    int vvNew[ADDRMAN_NEW_BUCKET_COUNT][ADDRMAN_BUCKET_SIZE];\r\n\r\n    //! last time Good was called (memory only)\r\n    int64_t nLastGood;\r\n\r\nprotected:\r\n    //! secret key to randomize bucket select with\r\n    uint256 nKey;\r\n\r\n    //! Source of random numbers for randomization in inner loops\r\n    FastRandomContext insecure_rand;\r\n```\r\n\r\n",
      "created_at" : "2017-10-31T15:45:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11585#issuecomment-340805016",
      "id" : 340805016,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11585",
      "updated_at" : "2017-10-31T15:46:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/340805016",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "That is what https://github.com/bitcoin/bitcoin/blob/8335cb478183d800e274f6e96f9d7269ae584220/src/addrman.h#L185 says. It seems public methods do lock `cs`.",
      "created_at" : "2017-10-31T15:50:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11585#issuecomment-340806831",
      "id" : 340806831,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11585",
      "updated_at" : "2017-10-31T15:50:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/340806831",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@promag I'll investigate! :-)",
      "created_at" : "2017-10-31T16:00:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11585#issuecomment-340810414",
      "id" : 340810414,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11585",
      "updated_at" : "2017-10-31T16:00:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/340810414",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@promag You're right! The locking seems to be correct for the other `CAddrMan` members. Thanks!",
      "created_at" : "2017-10-31T16:41:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11585#issuecomment-340824070",
      "id" : 340824070,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11585",
      "updated_at" : "2017-10-31T16:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/340824070",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 3ab545d7f8e979e2cabeff6f5f6f1afe94a5c195. I believe the intention is for all public methods to lock the cs, and the privates ones don't need to. That would imply that all vars should be covered under the cs.",
      "created_at" : "2017-11-01T20:32:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11585#issuecomment-341233218",
      "id" : 341233218,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11585",
      "updated_at" : "2017-11-01T20:32:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/341233218",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "utACK 3ab545d7f8e979e2cabeff6f5f6f1afe94a5c195",
      "created_at" : "2017-11-06T19:06:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11585#issuecomment-342251980",
      "id" : 342251980,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11585",
      "updated_at" : "2017-11-06T19:06:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/342251980",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   }
]
