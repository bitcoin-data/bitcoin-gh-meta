[
   {
      "author_association" : "MEMBER",
      "body" : "@huahuayu Please don't tag multiple people just to draw attention to your issue.",
      "created_at" : "2019-04-04T09:26:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/15745#issuecomment-479821972",
      "id" : 479821972,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15745",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3OTgyMTk3Mg==",
      "updated_at" : "2019-04-04T09:26:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/479821972",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "There is a circular relationship of sorts between the config file and the data dir. The configuration file can specify a data directory (using `-datadir`), while the default configuration file `bitcoin.conf` is *in* the data directory.\r\n\r\nThis potential circularity is broken by ignoring `-datadir` in the default configuration file, so when `-conf` is driven by the data directory. \r\n\r\nHowever, when `-conf` is specified on the command line it should be possible to set a `-datadir` in that configuration file and have it be used. The purpose of this is to be able to have the configuration file in a read-only directory, e.g. `/etc/bitcoin.conf`, specifying where the read/write data is.\r\n\r\nI've tested this and with master this seems to work as expected:\r\n```bash\r\n$ mkdir /tmp/conf /tmp/datadir\r\n$ echo \"datadir=/tmp/datadir\" > /tmp/conf/test1.conf\r\n$ src/bitcoind --conf=/tmp/conf/test1.conf -printtoconsole\r\n2019-04-04T11:00:28Z Bitcoin Core version v0.18.99.0-79c345a0114c9a83fd40e01150519373c017b130 (release build)\r\n2019-04-04T11:00:28Z Default data directory /home/.../.bitcoin\r\n2019-04-04T11:00:28Z Using data directory /tmp/datadir\r\n2019-04-04T11:00:28Z Config file: /tmp/conf/test1.conf\r\n...\r\n```\r\n",
      "created_at" : "2019-04-04T11:05:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/15745#issuecomment-479852569",
      "id" : 479852569,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15745",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3OTg1MjU2OQ==",
      "updated_at" : "2019-04-04T11:06:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/479852569",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Same for 0.17.1. Cannot reproduct this.\r\n```\r\n$ mkdir /tmp/conf /tmp/datadir\r\n$ echo \"datadir=/tmp/datadir\" > /tmp/conf/test1.conf\r\n$ src/bitcoind --conf=/tmp/conf/test1.conf -printtoconsole\r\n2019-04-04T11:34:53Z Bitcoin Core version v0.17.1.0-6cf81b01b48e871a35072dd08e7735c3ba42528c (release build)\r\n2019-04-04T11:34:53Z InitParameterInteraction: parameter interaction: -whitelistforcerelay=1 -> setting -whitelistrelay=1\r\n2019-04-04T11:34:53Z Assuming ancestors of block 0000000000000000002e63058c023a9a1de233554f28c7b21380b6c9003f36a8 have valid signatures.\r\n2019-04-04T11:34:53Z Setting nMinimumChainWork=0000000000000000000000000000000000000000028822fef1c230963535a90d\r\n2019-04-04T11:34:53Z Using the 'standard' SHA256 implementation\r\n2019-04-04T11:34:53Z Default data directory /home/.../.bitcoin\r\n2019-04-04T11:34:53Z Using data directory /tmp/datadir\r\n2019-04-04T11:34:53Z Using config file /tmp/conf/test1.conf\r\n```",
      "created_at" : "2019-04-04T11:35:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/15745#issuecomment-479861204",
      "id" : 479861204,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15745",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3OTg2MTIwNA==",
      "updated_at" : "2019-04-04T11:35:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/479861204",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "hi @laanwj , sorry for the late reply,  I tried again, if you followed my steps you will definitely reproduce the problem.  Please not only to see the log but check the dirs actually created.\r\n\r\n## Env info\r\nsystem info  \r\n``` bash\r\n$ uname -a\r\nLinux MNG-BC 4.4.0-142-generic #168-Ubuntu SMP Wed Jan 16 21:00:45 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux\r\n```\r\n\r\nbitcoind version\r\n``` bash\r\n$ bitcoind --version\r\nBitcoin Core Daemon version v0.17.1.0-gef70f9b52b851c7997a9f1a0834714e3eebc1fd8\r\n```\r\n\r\n## Steps to reproduce\r\n### step1\r\n`vi ~/.bitcoind/bitcoin.conf` add below contents (**change line 44/53 to your datadir**)\r\n``` \r\n# This config should be placed in following path:\r\n# /root/.bitcoin/bitcoin.conf\r\n\r\n# [core]\r\n# Specify the location of the configuration file. To use non-default location, create a default location config file containing this setting.\r\nconf=/root/.bitcoin/bitcoin.conf\r\n\r\n# [debug]\r\n# Enable debug logging for all categories.\r\n#debug=1\r\n# Log IP Addresses in debug output.\r\n#logips=1\r\n# Run this node on the Bitcoin Test Network.\r\n#testnet=1\r\n\r\n# [rpc]\r\n# Accept command line and JSON-RPC commands.\r\nserver=1\r\n# Accept public REST requests.\r\nrest=1\r\n# RPC user\r\nrpcuser=rpcuser\r\n# RPC password\r\nrpcpassword=rpcpass\r\n# RPC allow ip (allow all)\r\nrpcallowip=0.0.0.0/0\r\n# RPC bind\r\n#rpcbind=127.0.0.1\r\n# get all transaction\r\ntxindex=1\r\n\r\n\r\n# [Sections]\r\n# Most options automatically apply to mainnet, testnet, and regtest networks.\r\n# If you want to confine an option to just one network, you should add it in the relevant section.\r\n# EXCEPTIONS: The options addnode, connect, port, bind, rpcport, rpcbind and wallet\r\n# only apply to mainnet unless they appear in the appropriate section below.\r\n\r\n# Options only for mainnet\r\n[main]\r\n# datadir\r\ndatadir=/mnt/data/bitcoin/mainnet\r\n# Listen for incoming connections on non-default port.(default: 8333 or testnet: 18333)\r\nport=8333\r\n# RPC port(default:8332 or testnet:18332)\r\nrpcport=8332\r\n\r\n# Options only for testnet\r\n[test]\r\n# datadir\r\ndatadir=/mnt/data/bitcoin\r\n# Listen for incoming connections on non-default port.(default: 8333 or testnet: 18333)\r\nport=18333\r\n# RPC port(default:8332 or testnet:18332)\r\nrpcport=18332\r\n\r\n# Options only for regtest\r\n[regtest]\r\n```\r\n\r\n### step2\r\nrun bitcoind with below command  \r\n``` bash\r\nbitcoind -conf=/root/.bitcoin/bitcoin.conf -testnet=1 -daemon\r\n```\r\n\r\n### step3\r\n1. check the dir `/root/.bitcoin/` it will have two dirs created: `blocks` and `testnet3`   **which is not expected**\r\n2. check the datadir you specified (for me it's `/mnt/data/bitcoin/`) , it will have a dir created: `testnet3`, the files inside are as below\r\n``` bash\r\nroot@MNG-BC Ã¢ÂÂ  testnet3 ls\r\nbanlist.dat  chainstate  debug.log  fee_estimates.dat  indexes  mempool.dat  peers.dat  wallets\r\n```\r\n\r\n### Problem summary\r\nAfter bitcoind run, data write to two different dirs  \r\n1. wallet and some other files write to the expected `datadir` which is good  \r\n2. but block data write to /root/.bitcoin/ is not expected, it should in `datadir` too.  It runs out of my disk space in system volume.\r\n\r\n\r\n ",
      "created_at" : "2019-04-09T09:00:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/15745#issuecomment-481165929",
      "id" : 481165929,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15745",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4MTE2NTkyOQ==",
      "updated_at" : "2019-04-09T09:11:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/481165929",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1725060?v=4",
         "events_url" : "https://api.github.com/users/huahuayu/events{/privacy}",
         "followers_url" : "https://api.github.com/users/huahuayu/followers",
         "following_url" : "https://api.github.com/users/huahuayu/following{/other_user}",
         "gists_url" : "https://api.github.com/users/huahuayu/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/huahuayu",
         "id" : 1725060,
         "login" : "huahuayu",
         "node_id" : "MDQ6VXNlcjE3MjUwNjA=",
         "organizations_url" : "https://api.github.com/users/huahuayu/orgs",
         "received_events_url" : "https://api.github.com/users/huahuayu/received_events",
         "repos_url" : "https://api.github.com/users/huahuayu/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/huahuayu/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/huahuayu/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/huahuayu"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@huahuayu does #15864 fix this issue?",
      "created_at" : "2019-04-22T08:15:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/15745#issuecomment-485359795",
      "id" : 485359795,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15745",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4NTM1OTc5NQ==",
      "updated_at" : "2019-04-22T08:15:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/485359795",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Should we just check the *special case*  `-conf` is specified and avoid `GetDefaultDataDir` in that case?",
      "created_at" : "2019-04-22T10:10:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/15745#issuecomment-485383368",
      "id" : 485383368,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15745",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4NTM4MzM2OA==",
      "updated_at" : "2019-04-22T10:10:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/485383368",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@hebasto let me check",
      "created_at" : "2019-04-23T02:11:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/15745#issuecomment-485615877",
      "id" : 485615877,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15745",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4NTYxNTg3Nw==",
      "updated_at" : "2019-04-23T02:11:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/485615877",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1725060?v=4",
         "events_url" : "https://api.github.com/users/huahuayu/events{/privacy}",
         "followers_url" : "https://api.github.com/users/huahuayu/followers",
         "following_url" : "https://api.github.com/users/huahuayu/following{/other_user}",
         "gists_url" : "https://api.github.com/users/huahuayu/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/huahuayu",
         "id" : 1725060,
         "login" : "huahuayu",
         "node_id" : "MDQ6VXNlcjE3MjUwNjA=",
         "organizations_url" : "https://api.github.com/users/huahuayu/orgs",
         "received_events_url" : "https://api.github.com/users/huahuayu/received_events",
         "repos_url" : "https://api.github.com/users/huahuayu/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/huahuayu/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/huahuayu/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/huahuayu"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@huahuayu Did #15864 fix your issue?",
      "created_at" : "2019-08-04T05:59:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/15745#issuecomment-517976433",
      "id" : 517976433,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15745",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNzk3NjQzMw==",
      "updated_at" : "2019-08-04T05:59:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/517976433",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   }
]
