[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.",
      "created_at" : "2021-01-20T05:29:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-763344104",
      "id" : 763344104,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MzM0NDEwNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-22T09:27:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/763344104",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2021-01-20T10:16:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-763497435",
      "id" : 763497435,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MzQ5NzQzNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-20T10:16:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/763497435",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "790727eea..fd751850e: add the tests from #20904 (closed without merge), they are precious",
      "created_at" : "2021-01-20T10:57:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-763521567",
      "id" : 763521567,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MzUyMTU2Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-20T11:02:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/763521567",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "fd751850e..2d287f639: add release notes",
      "created_at" : "2021-01-20T11:30:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-763540526",
      "id" : 763540526,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MzU0MDUyNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-20T11:30:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/763540526",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r560912563"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560912563"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Please add the release notes to https://github.com/bitcoin-core/bitcoin-devwiki/wiki/%2320852-Release-notes-snippet\r\n\r\nOtherwise they will have to be removed here after merge, then added to the `0.21` branch. (Release notes are only added to the point releases, not the next major version that also includes those fixes)",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-01-20T12:10:31Z",
      "diff_hunk" : "@@ -105,6 +105,15 @@ RPC\n Tests\n -----\n \n+Files\n+-----\n+\n+- The list of banned hosts and networks (via `setban` RPC) is now saved on disk\n+  in JSON format in `banlist.json` instead of `banlist.dat`. Both files are\n+  read on startup and contents merged. Updateds are only written to the new\n+  `banlist.json`. A future version of Bitcoin Core may completely ignore\n+  `banlist.dat`. (#20966)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r560912563",
      "id" : 560912563,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDkxMjU2Mw==",
      "original_commit_id" : "2d287f639a77e03b07009712c756664c761d2867",
      "original_line" : 119,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "doc/release-notes.md",
      "position" : null,
      "pull_request_review_id" : 572158049,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T07:58:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560912563",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2021-01-20T12:37:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-763578760",
      "id" : 763578760,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MzU3ODc2MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-20T12:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/763578760",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r560934560"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560934560"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I guess after/if this PR is merged?",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-01-20T12:49:05Z",
      "diff_hunk" : "@@ -105,6 +105,15 @@ RPC\n Tests\n -----\n \n+Files\n+-----\n+\n+- The list of banned hosts and networks (via `setban` RPC) is now saved on disk\n+  in JSON format in `banlist.json` instead of `banlist.dat`. Both files are\n+  read on startup and contents merged. Updateds are only written to the new\n+  `banlist.json`. A future version of Bitcoin Core may completely ignore\n+  `banlist.dat`. (#20966)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r560934560",
      "id" : 560934560,
      "in_reply_to_id" : 560912563,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDkzNDU2MA==",
      "original_commit_id" : "2d287f639a77e03b07009712c756664c761d2867",
      "original_line" : 119,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "doc/release-notes.md",
      "position" : null,
      "pull_request_review_id" : 572186410,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T07:58:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560934560",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "2d287f639...fd751850e: remove edits of `doc/release-notes.md`",
      "created_at" : "2021-01-20T12:53:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-763587128",
      "id" : 763587128,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MzU4NzEyOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-20T12:53:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/763587128",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Notes:\r\n\r\n* I guess it would be possible to write the ban list to `settings.json` instead of in `banlist.json` (as originally proposed in https://github.com/bitcoin/bitcoin/issues/19748), but the periodic dump may create some complications and also it is unclear what to do if we are running with `-nosettings`.\r\n\r\n* The current patch would write `banlist.json` on the first change of the ban list. This means that a node that upgrades from before this PR with only `banlist.dat` on disk may not create `banlist.json` for some time. I think this is ok.",
      "created_at" : "2021-01-20T13:01:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-763591233",
      "id" : 763591233,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MzU5MTIzMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-20T13:01:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/763591233",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK\r\n\r\n> [790727e](https://github.com/bitcoin/bitcoin/commit/790727eeaf165449f691d1f874b70f0816ef7601)..[fd75185](https://github.com/bitcoin/bitcoin/commit/fd751850e5dc918b523c63ce9db98279f2398c96): add the tests from #20904 (closed without merge), they are precious\r\n\r\nGood to see these tests brought in.",
      "created_at" : "2021-01-27T12:46:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-768261953",
      "id" : 768261953,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2ODI2MTk1Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-27T12:46:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/768261953",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "fd751850e...e74196741: read `banlist.dat` only if `banlist.json` is not present and catch all exceptions that could come from an invalid JSON.\r\n\r\n@promag  \r\n> Should try to read JSON first, and if it exists then skip old format?\r\n\r\nI made it to read both if present so that if the user temporary downgrades and makes some changes to `banlist.dat` those changes would be picked up by the new version. However this has the deficiency that if an entry is deleted from `banlist.json` it will keep being loaded from `banlist.dat`. Changed to what you suggest above.\r\n\r\n> Personally I wouldn't add from/to JSON in `CBanEntry`, `BanMapFromJson` and `BanMapToJson` seem enough.\r\n\r\n`CBanEntry` being able to ser/unser itself to/from JSON improves its encapsulation.\r\n\r\n> Also, there should be some validation in `BanMapFromJson`?\r\n\r\nRight! Added `try/catch` to handle invalid JSONs.",
      "created_at" : "2021-01-28T13:39:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-769058840",
      "id" : 769058840,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2OTA1ODg0MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-28T13:39:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/769058840",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "needs rebase after #21167",
      "created_at" : "2021-02-15T14:20:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-779253018",
      "id" : 779253018,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3OTI1MzAxOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-15T14:20:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/779253018",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`e74196741...7493bbe38`: rebase due to conflicts",
      "created_at" : "2021-02-15T14:54:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-779272710",
      "id" : 779272710,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3OTI3MjcxMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-15T14:54:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/779272710",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r576391571"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/576391571"
         }
      },
      "author_association" : "NONE",
      "body" : "-    m_node.banman = MakeUnique<BanMan>(GetDataDir() / \"banlist\", nullptr, DEFAULT_MISBEHAVING_BANTIME) ;",
      "commit_id" : "7493bbe388a8016cac7aff3ab176d2cc73ac3d69",
      "created_at" : "2021-02-15T19:37:44Z",
      "diff_hunk" : "@@ -187,7 +187,7 @@ TestingSetup::TestingSetup(const std::string& chainName, const std::vector<const\n         throw std::runtime_error(strprintf(\"ActivateBestChain failed. (%s)\", state.ToString()));\n     }\n \n-    m_node.banman = MakeUnique<BanMan>(GetDataDir() / \"banlist.dat\", nullptr, DEFAULT_MISBEHAVING_BANTIME);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r576391571",
      "id" : 576391571,
      "line" : 190,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NjM5MTU3MQ==",
      "original_commit_id" : "7493bbe388a8016cac7aff3ab176d2cc73ac3d69",
      "original_line" : 190,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/test/util/setup_common.cpp",
      "position" : 4,
      "pull_request_review_id" : 590718713,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-15T19:37:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/576391571",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/52614312?v=4",
         "events_url" : "https://api.github.com/users/trongham/events{/privacy}",
         "followers_url" : "https://api.github.com/users/trongham/followers",
         "following_url" : "https://api.github.com/users/trongham/following{/other_user}",
         "gists_url" : "https://api.github.com/users/trongham/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/trongham",
         "id" : 52614312,
         "login" : "trongham",
         "node_id" : "MDQ6VXNlcjUyNjE0MzEy",
         "organizations_url" : "https://api.github.com/users/trongham/orgs",
         "received_events_url" : "https://api.github.com/users/trongham/received_events",
         "repos_url" : "https://api.github.com/users/trongham/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/trongham/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/trongham/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/trongham"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-02-23T15:47:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-784298049",
      "id" : 784298049,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc4NDI5ODA0OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-23T15:47:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/784298049",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`7493bbe38...1310b5460`: rebase due to conflicts",
      "created_at" : "2021-03-10T16:12:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-795669488",
      "id" : 795669488,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5NTY2OTQ4OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-10T16:12:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/795669488",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "So many rebases. I hope the backport won't be too nasty",
      "created_at" : "2021-03-10T16:20:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-795681231",
      "id" : 795681231,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5NTY4MTIzMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-10T16:20:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/795681231",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-03-12T07:41:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-797300625",
      "id" : 797300625,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5NzMwMDYyNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-12T07:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/797300625",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`1310b5460...469da8ca3`: rebase due to conflicts",
      "created_at" : "2021-03-15T15:27:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-799510958",
      "id" : 799510958,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5OTUxMDk1OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-15T15:27:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/799510958",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2021-03-15T17:08:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-799588784",
      "id" : 799588784,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5OTU4ODc4NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-15T17:08:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/799588784",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r598083776"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598083776"
         }
      },
      "author_association" : "MEMBER",
      "body" : "8372aad9cc01774e981edee1dd8822a31ef6ea18\r\n\r\nis the goal still to backport this? If yes, it could make sense to use C++11",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-03-20T08:45:11Z",
      "diff_hunk" : "@@ -11,13 +11,69 @@\n #include <cstdint>\n #include <hash.h>\n #include <logging/timer.h>\n+#include <netbase.h>\n #include <random.h>\n #include <streams.h>\n #include <tinyformat.h>\n+#include <univalue.h>\n+#include <util/settings.h>\n #include <util/system.h>\n \n+CBanEntry::CBanEntry(const UniValue& json)\n+    : nVersion(json[\"version\"].get_int()), nCreateTime(json[\"ban_created\"].get_int64()),\n+      nBanUntil(json[\"banned_until\"].get_int64())\n+{\n+}\n+\n+UniValue CBanEntry::ToJson() const\n+{\n+    UniValue json(UniValue::VOBJ);\n+    json.pushKV(\"version\", nVersion);\n+    json.pushKV(\"ban_created\", nCreateTime);\n+    json.pushKV(\"banned_until\", nBanUntil);\n+    return json;\n+}\n+\n namespace {\n \n+/**\n+ * Convert a `banmap_t` object to a JSON array.\n+ * @param[in] bans Bans list to convert.\n+ * @return a JSON array, similar to the one returned by the `listbanned` RPC. Suitable for\n+ * passing to `BanMapFromJson()`.\n+ */\n+UniValue BanMapToJson(const banmap_t& bans)\n+{\n+    UniValue bans_json(UniValue::VARR);\n+    for (const auto& [address, ban_entry] : bans) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r598083776",
      "id" : 598083776,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODA4Mzc3Ng==",
      "original_commit_id" : "8372aad9cc01774e981edee1dd8822a31ef6ea18",
      "original_line" : 48,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : null,
      "pull_request_review_id" : 616895551,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T07:58:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598083776",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r598084377"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598084377"
         }
      },
      "author_association" : "MEMBER",
      "body" : "8372aad9cc01774e981edee1dd8822a31ef6ea18\r\n\r\n* Any reason to prepend the function name? This is already done by -logfunctionnames\r\n* Any reason to use `error` here, but `std::runtime_error` if a field is missing?\r\n* It would be better to leave the logging to the caller and not mix logging responsibility between a utility function and the caller object",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-03-20T08:50:00Z",
      "diff_hunk" : "@@ -11,13 +11,69 @@\n #include <cstdint>\n #include <hash.h>\n #include <logging/timer.h>\n+#include <netbase.h>\n #include <random.h>\n #include <streams.h>\n #include <tinyformat.h>\n+#include <univalue.h>\n+#include <util/settings.h>\n #include <util/system.h>\n \n+CBanEntry::CBanEntry(const UniValue& json)\n+    : nVersion(json[\"version\"].get_int()), nCreateTime(json[\"ban_created\"].get_int64()),\n+      nBanUntil(json[\"banned_until\"].get_int64())\n+{\n+}\n+\n+UniValue CBanEntry::ToJson() const\n+{\n+    UniValue json(UniValue::VOBJ);\n+    json.pushKV(\"version\", nVersion);\n+    json.pushKV(\"ban_created\", nCreateTime);\n+    json.pushKV(\"banned_until\", nBanUntil);\n+    return json;\n+}\n+\n namespace {\n \n+/**\n+ * Convert a `banmap_t` object to a JSON array.\n+ * @param[in] bans Bans list to convert.\n+ * @return a JSON array, similar to the one returned by the `listbanned` RPC. Suitable for\n+ * passing to `BanMapFromJson()`.\n+ */\n+UniValue BanMapToJson(const banmap_t& bans)\n+{\n+    UniValue bans_json(UniValue::VARR);\n+    for (const auto& [address, ban_entry] : bans) {\n+        UniValue j = ban_entry.ToJson();\n+        j.pushKV(\"address\", address.ToString());\n+        bans_json.push_back(j);\n+    }\n+    return bans_json;\n+}\n+\n+/**\n+ * Convert a JSON array to a `banmap_t` object.\n+ * @param[in] bans_json JSON to convert, must be as returned by `BanMapToJson()`.\n+ * @param[out] bans Bans list to create from the JSON.\n+ * @return true if the conversion was successful.\n+ * @throws std::runtime_error if the JSON does not have the expected fields.\n+ */\n+bool BanMapFromJson(const UniValue& bans_json, banmap_t& bans)\n+{\n+    for (const auto& ban_entry_json : bans_json.getValues()) {\n+        CSubNet subnet;\n+        const auto& subnet_str = ban_entry_json[\"address\"].get_str();\n+        if (!LookupSubNet(subnet_str, subnet)) {\n+            return error(\"%s: Cannot parse banned address or subnet: %s\", __func__, subnet_str);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r598084377",
      "id" : 598084377,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODA4NDM3Nw==",
      "original_commit_id" : "8372aad9cc01774e981edee1dd8822a31ef6ea18",
      "original_line" : 69,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : null,
      "pull_request_review_id" : 616895551,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T07:58:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598084377",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r598085409"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598085409"
         }
      },
      "author_association" : "MEMBER",
      "body" : "same commit:\r\n\r\n* It seems the caller ignores the return code, so calling this ERROR seems confusing\r\n* No longer need `__func__`",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-03-20T09:00:47Z",
      "diff_hunk" : "@@ -119,18 +175,46 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {\n+        return true;\n+    }\n+\n+    for (const auto& err : errors) {\n+        error(\"%s: %s\", __func__, err);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r598085409",
      "id" : 598085409,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODA4NTQwOQ==",
      "original_commit_id" : "8372aad9cc01774e981edee1dd8822a31ef6ea18",
      "original_line" : 192,
      "original_position" : 90,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : null,
      "pull_request_review_id" : 616895551,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T07:58:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598085409",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r598085607"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598085607"
         }
      },
      "author_association" : "MEMBER",
      "body" : "same commit:\r\n\r\n* The caller will be \"Recreating the banlist database\", so calling this ERROR seems confusing\r\n* `__func__` ;)",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-03-20T09:03:43Z",
      "diff_hunk" : "@@ -119,18 +175,46 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {\n+        return true;\n+    }\n+\n+    for (const auto& err : errors) {\n+        error(\"%s: %s\", __func__, err);\n+    }\n+    return false;\n }\n \n bool CBanDB::Read(banmap_t& banSet)\n {\n-    return DeserializeFileDB(m_ban_list_path, banSet);\n+    if (!fs::exists(m_banlist_json)) {\n+        return DeserializeFileDB(m_banlist_dat, banSet);\n+    }\n+\n+    std::map<std::string, util::SettingsValue> settings;\n+    std::vector<std::string> errors;\n+\n+    if (!util::ReadSettings(m_banlist_json, settings, errors)) {\n+        for (const auto& err : errors) {\n+            error(\"%s: %s\", __func__, err);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r598085607",
      "id" : 598085607,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODA4NTYwNw==",
      "original_commit_id" : "8372aad9cc01774e981edee1dd8822a31ef6ea18",
      "original_line" : 208,
      "original_position" : 107,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : null,
      "pull_request_review_id" : 616895551,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T07:58:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598085607",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r598085630"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598085630"
         }
      },
      "author_association" : "MEMBER",
      "body" : "same ;)",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-03-20T09:03:55Z",
      "diff_hunk" : "@@ -119,18 +175,46 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {\n+        return true;\n+    }\n+\n+    for (const auto& err : errors) {\n+        error(\"%s: %s\", __func__, err);\n+    }\n+    return false;\n }\n \n bool CBanDB::Read(banmap_t& banSet)\n {\n-    return DeserializeFileDB(m_ban_list_path, banSet);\n+    if (!fs::exists(m_banlist_json)) {\n+        return DeserializeFileDB(m_banlist_dat, banSet);\n+    }\n+\n+    std::map<std::string, util::SettingsValue> settings;\n+    std::vector<std::string> errors;\n+\n+    if (!util::ReadSettings(m_banlist_json, settings, errors)) {\n+        for (const auto& err : errors) {\n+            error(\"%s: %s\", __func__, err);\n+        }\n+        return false;\n+    }\n+\n+    try {\n+        return BanMapFromJson(settings[JSON_KEY], banSet);\n+    } catch (const std::runtime_error& e) {\n+        return error(\"%s: Cannot parse %s: %s\", __func__, m_banlist_json.string(), e.what());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r598085630",
      "id" : 598085630,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODA4NTYzMA==",
      "original_commit_id" : "8372aad9cc01774e981edee1dd8822a31ef6ea18",
      "original_line" : 216,
      "original_position" : 115,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : null,
      "pull_request_review_id" : 616895551,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T07:58:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598085630",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r598086423"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598086423"
         }
      },
      "author_association" : "MEMBER",
      "body" : "same commit:\r\n\r\nI don't understand this line. There shouldn't be any reason this instance will ever write a banlist.dat file.\r\n\r\nAlso, to make the fuzz test more useful, it should probably *create* a banlist.dat file. Extra points for creating a corrupted one. With extra bonus points for passing one in without disk access.",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-03-20T09:11:33Z",
      "diff_hunk" : "@@ -34,8 +34,9 @@ FUZZ_TARGET_INIT(banman, initialize_banman)\n {\n     FuzzedDataProvider fuzzed_data_provider{buffer.data(), buffer.size()};\n     SetMockTime(ConsumeTime(fuzzed_data_provider));\n-    const fs::path banlist_file = GetDataDir() / \"fuzzed_banlist.dat\";\n-    fs::remove(banlist_file);\n+    const fs::path banlist_file = GetDataDir() / \"fuzzed_banlist\";\n+    fs::remove(banlist_file.string() + \".dat\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r598086423",
      "id" : 598086423,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODA4NjQyMw==",
      "original_commit_id" : "8372aad9cc01774e981edee1dd8822a31ef6ea18",
      "original_line" : 38,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/test/fuzz/banman.cpp",
      "position" : null,
      "pull_request_review_id" : 616895551,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T07:58:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598086423",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`469da8ca3...4efa5e73b`: address review suggestions, remove the release notes that were removed before but sneaked back in one of the updates",
      "created_at" : "2021-03-24T15:35:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-805928003",
      "id" : 805928003,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwNTkyODAwMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-24T15:35:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/805928003",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r600601565"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600601565"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "My understanding is that this deserves a backport because it would allow storing torv3 addresses in the banlist on disk. Not super important though.\r\n\r\nSwitched to C++11.",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-03-24T15:37:09Z",
      "diff_hunk" : "@@ -11,13 +11,69 @@\n #include <cstdint>\n #include <hash.h>\n #include <logging/timer.h>\n+#include <netbase.h>\n #include <random.h>\n #include <streams.h>\n #include <tinyformat.h>\n+#include <univalue.h>\n+#include <util/settings.h>\n #include <util/system.h>\n \n+CBanEntry::CBanEntry(const UniValue& json)\n+    : nVersion(json[\"version\"].get_int()), nCreateTime(json[\"ban_created\"].get_int64()),\n+      nBanUntil(json[\"banned_until\"].get_int64())\n+{\n+}\n+\n+UniValue CBanEntry::ToJson() const\n+{\n+    UniValue json(UniValue::VOBJ);\n+    json.pushKV(\"version\", nVersion);\n+    json.pushKV(\"ban_created\", nCreateTime);\n+    json.pushKV(\"banned_until\", nBanUntil);\n+    return json;\n+}\n+\n namespace {\n \n+/**\n+ * Convert a `banmap_t` object to a JSON array.\n+ * @param[in] bans Bans list to convert.\n+ * @return a JSON array, similar to the one returned by the `listbanned` RPC. Suitable for\n+ * passing to `BanMapFromJson()`.\n+ */\n+UniValue BanMapToJson(const banmap_t& bans)\n+{\n+    UniValue bans_json(UniValue::VARR);\n+    for (const auto& [address, ban_entry] : bans) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r600601565",
      "id" : 600601565,
      "in_reply_to_id" : 598083776,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMDYwMTU2NQ==",
      "original_commit_id" : "8372aad9cc01774e981edee1dd8822a31ef6ea18",
      "original_line" : 48,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : null,
      "pull_request_review_id" : 619883706,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T07:58:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600601565",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r600604218"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600604218"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "You probably mean `-logsourcelocations` instead of `-logfunctionnames`.\r\n\r\nRemoved `__func__`. Changed this function to throw an exception for all errors and return `void`. Now it does not do any logging - just bubble up a detailed error message to the callers via the exception.",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-03-24T15:39:46Z",
      "diff_hunk" : "@@ -11,13 +11,69 @@\n #include <cstdint>\n #include <hash.h>\n #include <logging/timer.h>\n+#include <netbase.h>\n #include <random.h>\n #include <streams.h>\n #include <tinyformat.h>\n+#include <univalue.h>\n+#include <util/settings.h>\n #include <util/system.h>\n \n+CBanEntry::CBanEntry(const UniValue& json)\n+    : nVersion(json[\"version\"].get_int()), nCreateTime(json[\"ban_created\"].get_int64()),\n+      nBanUntil(json[\"banned_until\"].get_int64())\n+{\n+}\n+\n+UniValue CBanEntry::ToJson() const\n+{\n+    UniValue json(UniValue::VOBJ);\n+    json.pushKV(\"version\", nVersion);\n+    json.pushKV(\"ban_created\", nCreateTime);\n+    json.pushKV(\"banned_until\", nBanUntil);\n+    return json;\n+}\n+\n namespace {\n \n+/**\n+ * Convert a `banmap_t` object to a JSON array.\n+ * @param[in] bans Bans list to convert.\n+ * @return a JSON array, similar to the one returned by the `listbanned` RPC. Suitable for\n+ * passing to `BanMapFromJson()`.\n+ */\n+UniValue BanMapToJson(const banmap_t& bans)\n+{\n+    UniValue bans_json(UniValue::VARR);\n+    for (const auto& [address, ban_entry] : bans) {\n+        UniValue j = ban_entry.ToJson();\n+        j.pushKV(\"address\", address.ToString());\n+        bans_json.push_back(j);\n+    }\n+    return bans_json;\n+}\n+\n+/**\n+ * Convert a JSON array to a `banmap_t` object.\n+ * @param[in] bans_json JSON to convert, must be as returned by `BanMapToJson()`.\n+ * @param[out] bans Bans list to create from the JSON.\n+ * @return true if the conversion was successful.\n+ * @throws std::runtime_error if the JSON does not have the expected fields.\n+ */\n+bool BanMapFromJson(const UniValue& bans_json, banmap_t& bans)\n+{\n+    for (const auto& ban_entry_json : bans_json.getValues()) {\n+        CSubNet subnet;\n+        const auto& subnet_str = ban_entry_json[\"address\"].get_str();\n+        if (!LookupSubNet(subnet_str, subnet)) {\n+            return error(\"%s: Cannot parse banned address or subnet: %s\", __func__, subnet_str);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r600604218",
      "id" : 600604218,
      "in_reply_to_id" : 598084377,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMDYwNDIxOA==",
      "original_commit_id" : "8372aad9cc01774e981edee1dd8822a31ef6ea18",
      "original_line" : 69,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : null,
      "pull_request_review_id" : 619887083,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T07:58:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600604218",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r600607040"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600607040"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The caller of `CBanDB::Write()` does not ignore its return code? If you mean the return code of `error()` itself - this is because we want to log all of the errors (possibly more than one) before returning `false`.\r\n\r\nRemoved `__func__`.",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-03-24T15:42:21Z",
      "diff_hunk" : "@@ -119,18 +175,46 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {\n+        return true;\n+    }\n+\n+    for (const auto& err : errors) {\n+        error(\"%s: %s\", __func__, err);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r600607040",
      "id" : 600607040,
      "in_reply_to_id" : 598085409,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMDYwNzA0MA==",
      "original_commit_id" : "8372aad9cc01774e981edee1dd8822a31ef6ea18",
      "original_line" : 192,
      "original_position" : 90,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : null,
      "pull_request_review_id" : 619890819,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T07:58:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600607040",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r600609034"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600609034"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think it is ok to see something like the following in the log:\r\n```\r\nERROR: ... banlist foo ...\r\nERROR: ... banlist bar ...\r\nRecreating the banlist database\r\n```\r\n\r\nRemoved `__func__`.",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-03-24T15:44:14Z",
      "diff_hunk" : "@@ -119,18 +175,46 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {\n+        return true;\n+    }\n+\n+    for (const auto& err : errors) {\n+        error(\"%s: %s\", __func__, err);\n+    }\n+    return false;\n }\n \n bool CBanDB::Read(banmap_t& banSet)\n {\n-    return DeserializeFileDB(m_ban_list_path, banSet);\n+    if (!fs::exists(m_banlist_json)) {\n+        return DeserializeFileDB(m_banlist_dat, banSet);\n+    }\n+\n+    std::map<std::string, util::SettingsValue> settings;\n+    std::vector<std::string> errors;\n+\n+    if (!util::ReadSettings(m_banlist_json, settings, errors)) {\n+        for (const auto& err : errors) {\n+            error(\"%s: %s\", __func__, err);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r600609034",
      "id" : 600609034,
      "in_reply_to_id" : 598085607,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMDYwOTAzNA==",
      "original_commit_id" : "8372aad9cc01774e981edee1dd8822a31ef6ea18",
      "original_line" : 208,
      "original_position" : 107,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : null,
      "pull_request_review_id" : 619892999,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T07:58:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600609034",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r600609538"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600609538"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Removed `__func__`.",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-03-24T15:44:51Z",
      "diff_hunk" : "@@ -119,18 +175,46 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {\n+        return true;\n+    }\n+\n+    for (const auto& err : errors) {\n+        error(\"%s: %s\", __func__, err);\n+    }\n+    return false;\n }\n \n bool CBanDB::Read(banmap_t& banSet)\n {\n-    return DeserializeFileDB(m_ban_list_path, banSet);\n+    if (!fs::exists(m_banlist_json)) {\n+        return DeserializeFileDB(m_banlist_dat, banSet);\n+    }\n+\n+    std::map<std::string, util::SettingsValue> settings;\n+    std::vector<std::string> errors;\n+\n+    if (!util::ReadSettings(m_banlist_json, settings, errors)) {\n+        for (const auto& err : errors) {\n+            error(\"%s: %s\", __func__, err);\n+        }\n+        return false;\n+    }\n+\n+    try {\n+        return BanMapFromJson(settings[JSON_KEY], banSet);\n+    } catch (const std::runtime_error& e) {\n+        return error(\"%s: Cannot parse %s: %s\", __func__, m_banlist_json.string(), e.what());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r600609538",
      "id" : 600609538,
      "in_reply_to_id" : 598085630,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMDYwOTUzOA==",
      "original_commit_id" : "8372aad9cc01774e981edee1dd8822a31ef6ea18",
      "original_line" : 216,
      "original_position" : 115,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : null,
      "pull_request_review_id" : 619893728,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T07:58:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600609538",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r600612275"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600612275"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Right, removed the `fs::remove` calls and replaced them with a creation of a corrupted or inaccessible banlist file.",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-03-24T15:47:45Z",
      "diff_hunk" : "@@ -34,8 +34,9 @@ FUZZ_TARGET_INIT(banman, initialize_banman)\n {\n     FuzzedDataProvider fuzzed_data_provider{buffer.data(), buffer.size()};\n     SetMockTime(ConsumeTime(fuzzed_data_provider));\n-    const fs::path banlist_file = GetDataDir() / \"fuzzed_banlist.dat\";\n-    fs::remove(banlist_file);\n+    const fs::path banlist_file = GetDataDir() / \"fuzzed_banlist\";\n+    fs::remove(banlist_file.string() + \".dat\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r600612275",
      "id" : 600612275,
      "in_reply_to_id" : 598086423,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMDYxMjI3NQ==",
      "original_commit_id" : "8372aad9cc01774e981edee1dd8822a31ef6ea18",
      "original_line" : 38,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/test/fuzz/banman.cpp",
      "position" : null,
      "pull_request_review_id" : 619898024,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T07:58:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600612275",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-03-30T11:13:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-810135353",
      "id" : 810135353,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMDEzNTM1Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-30T11:13:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/810135353",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@vasild I've split up the unit tests from this pull, since they are unrelated to changes here (They are checking functionality that already works just fine on master). See #21571. The benefit is that this pull can focus on the disk serialization changes only. I hope you don't mind and maybe can leave a (Concept) (N)ACK.",
      "created_at" : "2021-04-02T17:41:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-812635126",
      "id" : 812635126,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMjYzNTEyNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-02T17:41:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/812635126",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebase should be easy now `git rebase --skip`",
      "created_at" : "2021-04-06T08:27:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-813933912",
      "id" : 813933912,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMzkzMzkxMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-06T08:27:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/813933912",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`4efa5e7...03239a3ab`: rebase due to conflicts, remove 3 commits from this PR that were already merged via https://github.com/bitcoin/bitcoin/pull/21571.",
      "created_at" : "2021-04-06T09:00:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-813955853",
      "id" : 813955853,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMzk1NTg1Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-06T09:00:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/813955853",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Moving milestone to 0.21.2. We'd like to do 0.21.1 soon, and even though this may be ready for merge soon, it seems like a risky thing to rush into a point release.",
      "created_at" : "2021-04-16T05:15:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-820911383",
      "id" : 820911383,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMDkxMTM4Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-16T05:15:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/820911383",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r615236159"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/615236159"
         }
      },
      "author_association" : "MEMBER",
      "body" : "User will report bugs if they see `ERROR`. For example, http://www.erisian.com.au/bitcoin-core-dev/log-2021-02-13.html#l-296",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-04-17T10:03:59Z",
      "diff_hunk" : "@@ -119,18 +175,46 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {\n+        return true;\n+    }\n+\n+    for (const auto& err : errors) {\n+        error(\"%s: %s\", __func__, err);\n+    }\n+    return false;\n }\n \n bool CBanDB::Read(banmap_t& banSet)\n {\n-    return DeserializeFileDB(m_ban_list_path, banSet);\n+    if (!fs::exists(m_banlist_json)) {\n+        return DeserializeFileDB(m_banlist_dat, banSet);\n+    }\n+\n+    std::map<std::string, util::SettingsValue> settings;\n+    std::vector<std::string> errors;\n+\n+    if (!util::ReadSettings(m_banlist_json, settings, errors)) {\n+        for (const auto& err : errors) {\n+            error(\"%s: %s\", __func__, err);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r615236159",
      "id" : 615236159,
      "in_reply_to_id" : 598085607,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNTIzNjE1OQ==",
      "original_commit_id" : "8372aad9cc01774e981edee1dd8822a31ef6ea18",
      "original_line" : 208,
      "original_position" : 107,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : null,
      "pull_request_review_id" : 638215405,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T07:58:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/615236159",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r615236932"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/615236932"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can remove `__func__` while touching this line?",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-04-17T10:11:18Z",
      "diff_hunk" : "@@ -188,7 +188,7 @@ void BanMan::SweepBanned()\n                 m_banned.erase(it++);\n                 m_is_dirty = true;\n                 notify_ui = true;\n-                LogPrint(BCLog::NET, \"%s: Removed banned node ip/subnet from banlist.dat: %s\\n\", __func__, sub_net.ToString());\n+                LogPrint(BCLog::NET, \"%s: Removed banned node address/subnet: %s\\n\", __func__, sub_net.ToString());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r615236932",
      "id" : 615236932,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNTIzNjkzMg==",
      "original_commit_id" : "03239a3ab204dfc71bb46f85679414b331836763",
      "original_line" : 191,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/banman.cpp",
      "position" : null,
      "pull_request_review_id" : 638215872,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T07:58:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/615236932",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`03239a3ab...aa90a7d46`: address suggestions",
      "created_at" : "2021-04-19T14:59:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-822536616",
      "id" : 822536616,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMjUzNjYxNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-19T14:59:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/822536616",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r615925693"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/615925693"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Removed",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-04-19T14:59:53Z",
      "diff_hunk" : "@@ -188,7 +188,7 @@ void BanMan::SweepBanned()\n                 m_banned.erase(it++);\n                 m_is_dirty = true;\n                 notify_ui = true;\n-                LogPrint(BCLog::NET, \"%s: Removed banned node ip/subnet from banlist.dat: %s\\n\", __func__, sub_net.ToString());\n+                LogPrint(BCLog::NET, \"%s: Removed banned node address/subnet: %s\\n\", __func__, sub_net.ToString());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r615925693",
      "id" : 615925693,
      "in_reply_to_id" : 615236932,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNTkyNTY5Mw==",
      "original_commit_id" : "03239a3ab204dfc71bb46f85679414b331836763",
      "original_line" : 191,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/banman.cpp",
      "position" : null,
      "pull_request_review_id" : 638974463,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T07:58:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/615925693",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r615930585"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/615930585"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I changed it to avoid the word \"error\". I don't think those errors should be hushed - those are errors from loading the file and we already checked that the file exists. So may include something like \"json parse error\", \"io error\", \"permission denied\".\r\n\r\nIn general I don't think we should avoid using \"error\" or use it just for cases where we have detected a bug in the program. Messages like \"error: permission denied\" or \"error: connection reset\" are to be expected.",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-04-19T15:05:44Z",
      "diff_hunk" : "@@ -119,18 +175,46 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {\n+        return true;\n+    }\n+\n+    for (const auto& err : errors) {\n+        error(\"%s: %s\", __func__, err);\n+    }\n+    return false;\n }\n \n bool CBanDB::Read(banmap_t& banSet)\n {\n-    return DeserializeFileDB(m_ban_list_path, banSet);\n+    if (!fs::exists(m_banlist_json)) {\n+        return DeserializeFileDB(m_banlist_dat, banSet);\n+    }\n+\n+    std::map<std::string, util::SettingsValue> settings;\n+    std::vector<std::string> errors;\n+\n+    if (!util::ReadSettings(m_banlist_json, settings, errors)) {\n+        for (const auto& err : errors) {\n+            error(\"%s: %s\", __func__, err);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r615930585",
      "id" : 615930585,
      "in_reply_to_id" : 598085607,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNTkzMDU4NQ==",
      "original_commit_id" : "8372aad9cc01774e981edee1dd8822a31ef6ea18",
      "original_line" : 208,
      "original_position" : 107,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : null,
      "pull_request_review_id" : 638981145,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T07:58:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/615930585",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616099538"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616099538"
         }
      },
      "author_association" : "MEMBER",
      "body" : ":facepalm: Oh wait, I might have missed that this is actually an error. Then it is fine to mention the word \"error\"",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-04-19T19:00:11Z",
      "diff_hunk" : "@@ -119,18 +175,46 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {\n+        return true;\n+    }\n+\n+    for (const auto& err : errors) {\n+        error(\"%s: %s\", __func__, err);\n+    }\n+    return false;\n }\n \n bool CBanDB::Read(banmap_t& banSet)\n {\n-    return DeserializeFileDB(m_ban_list_path, banSet);\n+    if (!fs::exists(m_banlist_json)) {\n+        return DeserializeFileDB(m_banlist_dat, banSet);\n+    }\n+\n+    std::map<std::string, util::SettingsValue> settings;\n+    std::vector<std::string> errors;\n+\n+    if (!util::ReadSettings(m_banlist_json, settings, errors)) {\n+        for (const auto& err : errors) {\n+            error(\"%s: %s\", __func__, err);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616099538",
      "id" : 616099538,
      "in_reply_to_id" : 598085607,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNjA5OTUzOA==",
      "original_commit_id" : "8372aad9cc01774e981edee1dd8822a31ef6ea18",
      "original_line" : 208,
      "original_position" : 107,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : null,
      "pull_request_review_id" : 639208463,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T07:58:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616099538",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616166735"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616166735"
         }
      },
      "author_association" : "MEMBER",
      "body" : "aa90a7d46a506b26a6016d1171f7ddae809e9c99\r\n\r\nnit, here and below, add a comment on why the check is repeated after the restart.",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-04-19T20:47:46Z",
      "diff_hunk" : "@@ -51,12 +51,22 @@ def run_test(self):\n         ip_addr = \"1.2.3.4\"\n         assert(not self.is_banned(node, tor_addr))\n         assert(not self.is_banned(node, ip_addr))\n+\n         node.setban(tor_addr, \"add\")\n         assert(self.is_banned(node, tor_addr))\n         assert(not self.is_banned(node, ip_addr))\n+\n+        self.restart_node(1)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616166735",
      "id" : 616166735,
      "line" : 61,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNjE2NjczNQ==",
      "original_commit_id" : "aa90a7d46a506b26a6016d1171f7ddae809e9c99",
      "original_line" : 61,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "test/functional/rpc_setban.py",
      "position" : 41,
      "pull_request_review_id" : 639293715,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T07:58:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616166735",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616173334"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616173334"
         }
      },
      "author_association" : "MEMBER",
      "body" : "51909ded1e8b26158f8d36cfe323ac72feac1d78\r\n\r\nnit, `fs::path(ban_list_path).replace_extension(\"dat\")`.",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-04-19T20:58:44Z",
      "diff_hunk" : "@@ -119,18 +176,49 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616173334",
      "id" : 616173334,
      "line" : 180,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNjE3MzMzNA==",
      "original_commit_id" : "51909ded1e8b26158f8d36cfe323ac72feac1d78",
      "original_line" : 180,
      "original_position" : 77,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : 77,
      "pull_request_review_id" : 639293715,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T07:58:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616173334",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616211147"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616211147"
         }
      },
      "author_association" : "MEMBER",
      "body" : "51909ded1e8b26158f8d36cfe323ac72feac1d78\r\n\r\nA comment here would be nice. Or maybe just take the next suggestion so it's clear what this is doing.",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-04-19T22:11:19Z",
      "diff_hunk" : "@@ -119,18 +176,49 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {\n+        return true;\n+    }\n+\n+    for (const auto& err : errors) {\n+        error(\"%s\", err);\n+    }\n+    return false;\n }\n \n bool CBanDB::Read(banmap_t& banSet)\n {\n-    return DeserializeFileDB(m_ban_list_path, banSet);\n+    if (!fs::exists(m_banlist_json)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616211147",
      "id" : 616211147,
      "line" : 201,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNjIxMTE0Nw==",
      "original_commit_id" : "aa90a7d46a506b26a6016d1171f7ddae809e9c99",
      "original_line" : 201,
      "original_position" : 99,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : 101,
      "pull_request_review_id" : 639293715,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T07:58:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616211147",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616214439"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616214439"
         }
      },
      "author_association" : "MEMBER",
      "body" : "51909ded1e8b26158f8d36cfe323ac72feac1d78\r\n\r\nMaybe migrate on 1st run?\r\n```diff\r\n bool CBanDB::Read(banmap_t& banSet)\r\n {\r\n     if (!fs::exists(m_banlist_json)) {\r\n-        return DeserializeFileDB(m_banlist_dat, banSet);\r\n+        if (!DeserializeFileDB(m_banlist_dat, banSet)) {\r\n+            return false;\r\n+        }\r\n+        // log something\r\n+        Write(banSet);\r\n+        return true;\r\n     }\r\n```",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-04-19T22:19:17Z",
      "diff_hunk" : "@@ -119,18 +176,49 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {\n+        return true;\n+    }\n+\n+    for (const auto& err : errors) {\n+        error(\"%s\", err);\n+    }\n+    return false;\n }\n \n bool CBanDB::Read(banmap_t& banSet)\n {\n-    return DeserializeFileDB(m_ban_list_path, banSet);\n+    if (!fs::exists(m_banlist_json)) {\n+        return DeserializeFileDB(m_banlist_dat, banSet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616214439",
      "id" : 616214439,
      "line" : 204,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNjIxNDQzOQ==",
      "original_commit_id" : "aa90a7d46a506b26a6016d1171f7ddae809e9c99",
      "original_line" : 204,
      "original_position" : 100,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : 104,
      "pull_request_review_id" : 639293715,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T07:58:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616214439",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-04-20T02:33:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-822927038",
      "id" : 822927038,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMjkyNzAzOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-20T02:33:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/822927038",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`aa90a7d46...7e399e2de`: rebase due to conflicts",
      "created_at" : "2021-04-20T15:55:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-823396970",
      "id" : 823396970,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMzM5Njk3MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-20T15:55:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/823396970",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`7e399e2de...08f4f98ea`: address some suggestions; force saving on disk if we loaded just the old `banlist.dat` so that we create the new `banlist.json` this way, without waiting for mods to the list in order to flush it to disk.",
      "created_at" : "2021-04-20T15:58:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-823399313",
      "id" : 823399313,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMzM5OTMxMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-20T15:58:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/823399313",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616826373"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616826373"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I am leaving it as is, I don't like `error()` too much.",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-04-20T15:59:23Z",
      "diff_hunk" : "@@ -119,18 +175,46 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {\n+        return true;\n+    }\n+\n+    for (const auto& err : errors) {\n+        error(\"%s: %s\", __func__, err);\n+    }\n+    return false;\n }\n \n bool CBanDB::Read(banmap_t& banSet)\n {\n-    return DeserializeFileDB(m_ban_list_path, banSet);\n+    if (!fs::exists(m_banlist_json)) {\n+        return DeserializeFileDB(m_banlist_dat, banSet);\n+    }\n+\n+    std::map<std::string, util::SettingsValue> settings;\n+    std::vector<std::string> errors;\n+\n+    if (!util::ReadSettings(m_banlist_json, settings, errors)) {\n+        for (const auto& err : errors) {\n+            error(\"%s: %s\", __func__, err);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616826373",
      "id" : 616826373,
      "in_reply_to_id" : 598085607,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNjgyNjM3Mw==",
      "original_commit_id" : "8372aad9cc01774e981edee1dd8822a31ef6ea18",
      "original_line" : 208,
      "original_position" : 107,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : null,
      "pull_request_review_id" : 640147406,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T07:58:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616826373",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616826715"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616826715"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Added a comment.",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-04-20T15:59:46Z",
      "diff_hunk" : "@@ -51,12 +51,22 @@ def run_test(self):\n         ip_addr = \"1.2.3.4\"\n         assert(not self.is_banned(node, tor_addr))\n         assert(not self.is_banned(node, ip_addr))\n+\n         node.setban(tor_addr, \"add\")\n         assert(self.is_banned(node, tor_addr))\n         assert(not self.is_banned(node, ip_addr))\n+\n+        self.restart_node(1)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616826715",
      "id" : 616826715,
      "in_reply_to_id" : 616166735,
      "line" : 61,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNjgyNjcxNQ==",
      "original_commit_id" : "aa90a7d46a506b26a6016d1171f7ddae809e9c99",
      "original_line" : 61,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "test/functional/rpc_setban.py",
      "position" : 41,
      "pull_request_review_id" : 640147832,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T07:58:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616826715",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616827889"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616827889"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I find `replace_extension()` a bit confusing in this case because we know that there is no extension, so we are not replacing anything (I know it will do the right thing, but still).",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-04-20T16:01:15Z",
      "diff_hunk" : "@@ -119,18 +176,49 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616827889",
      "id" : 616827889,
      "in_reply_to_id" : 616173334,
      "line" : 180,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNjgyNzg4OQ==",
      "original_commit_id" : "51909ded1e8b26158f8d36cfe323ac72feac1d78",
      "original_line" : 180,
      "original_position" : 77,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : 77,
      "pull_request_review_id" : 640149483,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T07:58:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616827889",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616828047"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616828047"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Added some comments.",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-04-20T16:01:27Z",
      "diff_hunk" : "@@ -119,18 +176,49 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {\n+        return true;\n+    }\n+\n+    for (const auto& err : errors) {\n+        error(\"%s\", err);\n+    }\n+    return false;\n }\n \n bool CBanDB::Read(banmap_t& banSet)\n {\n-    return DeserializeFileDB(m_ban_list_path, banSet);\n+    if (!fs::exists(m_banlist_json)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616828047",
      "id" : 616828047,
      "in_reply_to_id" : 616211147,
      "line" : 201,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNjgyODA0Nw==",
      "original_commit_id" : "aa90a7d46a506b26a6016d1171f7ddae809e9c99",
      "original_line" : 201,
      "original_position" : 99,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : 101,
      "pull_request_review_id" : 640149711,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T07:58:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616828047",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616829628"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616829628"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Migrate on first run - yes. But `Read()` calling `Write()` seems like some anti-pattern to me. Instead I signal from `Read()` that the list needs re-flushing, so that the caller takes care of it.",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-04-20T16:03:30Z",
      "diff_hunk" : "@@ -119,18 +176,49 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {\n+        return true;\n+    }\n+\n+    for (const auto& err : errors) {\n+        error(\"%s\", err);\n+    }\n+    return false;\n }\n \n bool CBanDB::Read(banmap_t& banSet)\n {\n-    return DeserializeFileDB(m_ban_list_path, banSet);\n+    if (!fs::exists(m_banlist_json)) {\n+        return DeserializeFileDB(m_banlist_dat, banSet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616829628",
      "id" : 616829628,
      "in_reply_to_id" : 616214439,
      "line" : 204,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNjgyOTYyOA==",
      "original_commit_id" : "aa90a7d46a506b26a6016d1171f7ddae809e9c99",
      "original_line" : 204,
      "original_position" : 100,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : 104,
      "pull_request_review_id" : 640151910,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T07:58:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616829628",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616843518"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616843518"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good point. Maybe add a `CBanDB::MigrateAndRead` where calling `Write()` isn't so bad.",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-04-20T16:20:39Z",
      "diff_hunk" : "@@ -119,18 +176,49 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {\n+        return true;\n+    }\n+\n+    for (const auto& err : errors) {\n+        error(\"%s\", err);\n+    }\n+    return false;\n }\n \n bool CBanDB::Read(banmap_t& banSet)\n {\n-    return DeserializeFileDB(m_ban_list_path, banSet);\n+    if (!fs::exists(m_banlist_json)) {\n+        return DeserializeFileDB(m_banlist_dat, banSet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616843518",
      "id" : 616843518,
      "in_reply_to_id" : 616214439,
      "line" : 204,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNjg0MzUxOA==",
      "original_commit_id" : "aa90a7d46a506b26a6016d1171f7ddae809e9c99",
      "original_line" : 204,
      "original_position" : 100,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : 104,
      "pull_request_review_id" : 640170176,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T07:58:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616843518",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r617300060"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617300060"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Not necessary with the latest changes.",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-04-21T08:13:44Z",
      "diff_hunk" : "@@ -119,18 +176,49 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {\n+        return true;\n+    }\n+\n+    for (const auto& err : errors) {\n+        error(\"%s\", err);\n+    }\n+    return false;\n }\n \n bool CBanDB::Read(banmap_t& banSet)\n {\n-    return DeserializeFileDB(m_ban_list_path, banSet);\n+    if (!fs::exists(m_banlist_json)) {\n+        return DeserializeFileDB(m_banlist_dat, banSet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r617300060",
      "id" : 617300060,
      "in_reply_to_id" : 616214439,
      "line" : 204,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNzMwMDA2MA==",
      "original_commit_id" : "aa90a7d46a506b26a6016d1171f7ddae809e9c99",
      "original_line" : 204,
      "original_position" : 100,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : 104,
      "pull_request_review_id" : 640752196,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T07:58:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617300060",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r619372413"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/619372413"
         }
      },
      "author_association" : "MEMBER",
      "body" : "s/would/will/\r\n\r\nSuggested version all in present tense:\r\n```suggestion\r\n`./`               | `banlist.dat`         | Stores the addresses/subnets of banned nodes (deprecated); `bitcoind` or `bitcoin-qt` no longer save the banlist to this file, but read it on startup if `banlist.json` is not present.\r\n```\r\n------\r\nif you retouch, in the same commit and file would you please touch up:\r\n```diff\r\n ## Legacy subdirectories and files\r\n \r\n-These subdirectories and files are no longer used by the Bitcoin Core:\r\n+These subdirectories and files are no longer used by Bitcoin Core:\r\n```\r\n",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-04-23T17:04:16Z",
      "diff_hunk" : "@@ -55,7 +55,8 @@ Subdirectory       | File(s)               | Description\n `indexes/blockfilter/basic/`    | `fltrNNNNN.dat`<sup>[\\[2\\]](#note2)</sup> | Blockfilter index filters for the basic filtertype; *optional*, used if `-blockfilterindex=basic`\n `wallets/`         |                       | [Contains wallets](#multi-wallet-environment); can be specified by `-walletdir` option; if `wallets/` subdirectory does not exist, wallets reside in the [data directory](#data-directory-location)\n `./`               | `anchors.dat`         | Anchor IP address database, created on shutdown and deleted at startup. Anchors are last known outgoing block-relay-only peers that are tried to re-connect to on startup\n-`./`               | `banlist.dat`         | Stores the IPs/subnets of banned nodes\n+`./`               | `banlist.dat`         | Stores the addresses/subnets of banned nodes (deprecated). Bitcoin Core will not save the banlist to it. It would only read it on startup if `banlist.json` is not present.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r619372413",
      "id" : 619372413,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxOTM3MjQxMw==",
      "original_commit_id" : "08f4f98ea2cdc3fbff5c9e21870296106430e468",
      "original_line" : 58,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "doc/files.md",
      "position" : null,
      "pull_request_review_id" : 643501581,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T07:58:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/619372413",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r619375121"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/619375121"
         }
      },
      "author_association" : "MEMBER",
      "body" : "08f4f98ea nit, drop the outer parens on the 4 added asserts and add a second newline at line 72 (per pycodestyle, \"E305 expected 2 blank lines after class or function definition, found 1\") \r\n\r\n(the black linter, e.g. `apt install black && black test/functional/rpc_setban.py` will do both of these for you)",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-04-23T17:08:45Z",
      "diff_hunk" : "@@ -51,12 +51,24 @@ def run_test(self):\n         ip_addr = \"1.2.3.4\"\n         assert(not self.is_banned(node, tor_addr))\n         assert(not self.is_banned(node, ip_addr))\n+\n         node.setban(tor_addr, \"add\")\n         assert(self.is_banned(node, tor_addr))\n         assert(not self.is_banned(node, ip_addr))\n+\n+        # Test that the ban list is preserved through restart.\n+\n+        self.restart_node(1)\n+        assert(self.is_banned(node, tor_addr))\n+        assert(not self.is_banned(node, ip_addr))\n+\n         node.setban(tor_addr, \"remove\")\n         assert(not self.is_banned(self.nodes[1], tor_addr))\n         assert(not self.is_banned(node, ip_addr))\n \n+        self.restart_node(1)\n+        assert(not self.is_banned(self.nodes[1], tor_addr))\n+        assert(not self.is_banned(node, ip_addr))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r619375121",
      "id" : 619375121,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxOTM3NTEyMQ==",
      "original_commit_id" : "08f4f98ea2cdc3fbff5c9e21870296106430e468",
      "original_line" : 71,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "test/functional/rpc_setban.py",
      "position" : null,
      "pull_request_review_id" : 643501581,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T07:58:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/619375121",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 08f4f98ea2cdc3fbff5c9e21870296106430e468 with the suggestion to perhaps remove any leftover (e.g. \"::/0\") addresses from mis-saved addrv2 ban entries when creating the json file and add a test. They may eventually expire--or not, depending on the duration--so it might not be a bad idea to remove any that are identifiable. Tested on master that an existing banlist.dat containing IPv4/6 and torv3 addresses is read on restart (with an entry of \"::/0\" or an \"IPv4\"-like address for the torv3 addresses), and that after building this patch, a banlist.json file with the existing entries is auto-created on startup except with incorrect ban entries for the addrv2 addresses, and that subsequent setban add/remove operations correctly update the `banlist.json` file for torv3 and i2p addresses. As expected, attempting to remove any previously incorrectly saved addrv2 addresses fails to recognize them unless the \"new\" address is stipulated, but subsequent setban add/remove operations work correctly. This testing was done by simultaneously looking at the banlist files and running setban/listbanned, shutting down, sometimes rm-ing the banlist.json file, restarting on master and with this patch, and repeating the testing.",
      "created_at" : "2021-04-24T21:27:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-826155791",
      "id" : 826155791,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyNjE1NTc5MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-25T12:58:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/826155791",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`08f4f98ea...fe4aafda5`: apply doc and style suggestions",
      "created_at" : "2021-04-26T08:00:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-826603992",
      "id" : 826603992,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyNjYwMzk5Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-26T08:00:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/826603992",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r620060270"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620060270"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done. Put that last change in a separate commit.",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-04-26T08:01:07Z",
      "diff_hunk" : "@@ -55,7 +55,8 @@ Subdirectory       | File(s)               | Description\n `indexes/blockfilter/basic/`    | `fltrNNNNN.dat`<sup>[\\[2\\]](#note2)</sup> | Blockfilter index filters for the basic filtertype; *optional*, used if `-blockfilterindex=basic`\n `wallets/`         |                       | [Contains wallets](#multi-wallet-environment); can be specified by `-walletdir` option; if `wallets/` subdirectory does not exist, wallets reside in the [data directory](#data-directory-location)\n `./`               | `anchors.dat`         | Anchor IP address database, created on shutdown and deleted at startup. Anchors are last known outgoing block-relay-only peers that are tried to re-connect to on startup\n-`./`               | `banlist.dat`         | Stores the IPs/subnets of banned nodes\n+`./`               | `banlist.dat`         | Stores the addresses/subnets of banned nodes (deprecated). Bitcoin Core will not save the banlist to it. It would only read it on startup if `banlist.json` is not present.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r620060270",
      "id" : 620060270,
      "in_reply_to_id" : 619372413,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMDA2MDI3MA==",
      "original_commit_id" : "08f4f98ea2cdc3fbff5c9e21870296106430e468",
      "original_line" : 58,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "doc/files.md",
      "position" : null,
      "pull_request_review_id" : 644370881,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T08:01:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620060270",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r620061718"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620061718"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done. Since the surrounding code uses `assert()` I added the new code with `assert()` for consistency and then removed all `()` from asserts in the entire file in a separate commit.",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-04-26T08:03:17Z",
      "diff_hunk" : "@@ -51,12 +51,24 @@ def run_test(self):\n         ip_addr = \"1.2.3.4\"\n         assert(not self.is_banned(node, tor_addr))\n         assert(not self.is_banned(node, ip_addr))\n+\n         node.setban(tor_addr, \"add\")\n         assert(self.is_banned(node, tor_addr))\n         assert(not self.is_banned(node, ip_addr))\n+\n+        # Test that the ban list is preserved through restart.\n+\n+        self.restart_node(1)\n+        assert(self.is_banned(node, tor_addr))\n+        assert(not self.is_banned(node, ip_addr))\n+\n         node.setban(tor_addr, \"remove\")\n         assert(not self.is_banned(self.nodes[1], tor_addr))\n         assert(not self.is_banned(node, ip_addr))\n \n+        self.restart_node(1)\n+        assert(not self.is_banned(self.nodes[1], tor_addr))\n+        assert(not self.is_banned(node, ip_addr))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r620061718",
      "id" : 620061718,
      "in_reply_to_id" : 619375121,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMDA2MTcxOA==",
      "original_commit_id" : "08f4f98ea2cdc3fbff5c9e21870296106430e468",
      "original_line" : 71,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "test/functional/rpc_setban.py",
      "position" : null,
      "pull_request_review_id" : 644372897,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T08:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620061718",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> ... remove any leftover (e.g. \"::/0\") addresses from mis-saved addrv2 ban entries when creating the json file ...\r\n\r\nHmm. Could there be real, manually added, no-mistake, ban entries like `::/0`? Somebody has banned deliberately the entire IPv6 network?",
      "created_at" : "2021-04-26T08:06:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-826608515",
      "id" : 826608515,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyNjYwODUxNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-26T08:06:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/826608515",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r620088086"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620088086"
         }
      },
      "author_association" : "MEMBER",
      "body" : "fe4aafda512483e863b23cfad403509b1604555c drive-by nit, while touching lines 25 and 46 in this commit (maybe just make it a PEP8/black linter commit)\r\n\r\n`$ pycodestyle test/functional/rpc_setban.py`\r\n\r\n    test/functional/rpc_setban.py:25:16: E713 test for membership should be 'not in'\r\n    test/functional/rpc_setban.py:46:16: E713 test for membership should be 'not in'\r\n",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-04-26T08:39:23Z",
      "diff_hunk" : "@@ -22,7 +22,7 @@ def run_test(self):\n         # Node 0 connects to Node 1, check that the noban permission is not granted\n         self.connect_nodes(0, 1)\n         peerinfo = self.nodes[1].getpeerinfo()[0]\n-        assert(not 'noban' in peerinfo['permissions'])\n+        assert not \"noban\" in peerinfo[\"permissions\"]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r620088086",
      "id" : 620088086,
      "line" : 25,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMDA4ODA4Ng==",
      "original_commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "original_line" : 25,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/rpc_setban.py",
      "position" : 5,
      "pull_request_review_id" : 644406696,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T08:40:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620088086",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> > ... remove any leftover (e.g. \"::/0\") addresses from mis-saved addrv2 ban entries when creating the json file ...\r\n> \r\n> Hmm. Could there be real, manually added, no-mistake, ban entries like `::/0`? Somebody has banned deliberately the entire IPv6 network?\r\n\r\nGood question. Would anyone do that. OTOH, have people been banning tor v3 addresses yet. Possible. IDK if it's an edge case worth worrying about.",
      "created_at" : "2021-04-26T08:45:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-826638612",
      "id" : 826638612,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyNjYzODYxMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-26T08:45:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/826638612",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r620116268"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620116268"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Going to leave it as is because none of \"black\" or \"pycodestyle\" is mentioned in `doc/`. Don't want to bother other reviewers with too big and unrelated changes to this PR.",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-04-26T09:15:12Z",
      "diff_hunk" : "@@ -22,7 +22,7 @@ def run_test(self):\n         # Node 0 connects to Node 1, check that the noban permission is not granted\n         self.connect_nodes(0, 1)\n         peerinfo = self.nodes[1].getpeerinfo()[0]\n-        assert(not 'noban' in peerinfo['permissions'])\n+        assert not \"noban\" in peerinfo[\"permissions\"]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r620116268",
      "id" : 620116268,
      "in_reply_to_id" : 620088086,
      "line" : 25,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMDExNjI2OA==",
      "original_commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "original_line" : 25,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/rpc_setban.py",
      "position" : 5,
      "pull_request_review_id" : 644443038,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T09:15:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620116268",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r620119397"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620119397"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ok. For info, pycodestyle is PEP8 that we follow per doc/test/functional/README.md\r\n\r\nhttps://pypi.org/project/pycodestyle",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-04-26T09:19:27Z",
      "diff_hunk" : "@@ -22,7 +22,7 @@ def run_test(self):\n         # Node 0 connects to Node 1, check that the noban permission is not granted\n         self.connect_nodes(0, 1)\n         peerinfo = self.nodes[1].getpeerinfo()[0]\n-        assert(not 'noban' in peerinfo['permissions'])\n+        assert not \"noban\" in peerinfo[\"permissions\"]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r620119397",
      "id" : 620119397,
      "in_reply_to_id" : 620088086,
      "line" : 25,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMDExOTM5Nw==",
      "original_commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "original_line" : 25,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/rpc_setban.py",
      "position" : 5,
      "pull_request_review_id" : 644447234,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T09:19:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620119397",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r620120674"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620120674"
         }
      },
      "author_association" : "MEMBER",
      "body" : "(ah, it was renamed from PEP8 for this reason https://github.com/PyCQA/pycodestyle/issues/466)",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-04-26T09:21:12Z",
      "diff_hunk" : "@@ -22,7 +22,7 @@ def run_test(self):\n         # Node 0 connects to Node 1, check that the noban permission is not granted\n         self.connect_nodes(0, 1)\n         peerinfo = self.nodes[1].getpeerinfo()[0]\n-        assert(not 'noban' in peerinfo['permissions'])\n+        assert not \"noban\" in peerinfo[\"permissions\"]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r620120674",
      "id" : 620120674,
      "in_reply_to_id" : 620088086,
      "line" : 25,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMDEyMDY3NA==",
      "original_commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "original_line" : 25,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/rpc_setban.py",
      "position" : 5,
      "pull_request_review_id" : 644448947,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T09:21:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620120674",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r620133277"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620133277"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`lint-python.sh` is happy with the current `rpc_setban.py`:\r\n\r\n```sh\r\n$ ./test/lint/lint-python.sh\r\ntest/functional/test_runner.py:42: error: Module has no attribute \"getwindowsversion\"\r\nFound 1 error in 1 file (checked 199 source files)\r\n$\r\n```",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-04-26T09:37:44Z",
      "diff_hunk" : "@@ -22,7 +22,7 @@ def run_test(self):\n         # Node 0 connects to Node 1, check that the noban permission is not granted\n         self.connect_nodes(0, 1)\n         peerinfo = self.nodes[1].getpeerinfo()[0]\n-        assert(not 'noban' in peerinfo['permissions'])\n+        assert not \"noban\" in peerinfo[\"permissions\"]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r620133277",
      "id" : 620133277,
      "in_reply_to_id" : 620088086,
      "line" : 25,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMDEzMzI3Nw==",
      "original_commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "original_line" : 25,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/rpc_setban.py",
      "position" : 5,
      "pull_request_review_id" : 644464895,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T09:37:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620133277",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r620157123"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620157123"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If adding new code or retouching old code for style reasons, I'd try to make it conform (https://www.python.org/dev/peps/pep-0008/#other-recommendations, https://www.flake8rules.com/rules/E713.html for \"not in\") because reviewers are often picky about it. I also wouldn't add a commit that does a one-word grammar change because otherwise someone will invariably ask me to squash the commit. But everyone has a different experience with this so definitely feel free to ignore.",
      "commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "created_at" : "2021-04-26T10:09:35Z",
      "diff_hunk" : "@@ -22,7 +22,7 @@ def run_test(self):\n         # Node 0 connects to Node 1, check that the noban permission is not granted\n         self.connect_nodes(0, 1)\n         peerinfo = self.nodes[1].getpeerinfo()[0]\n-        assert(not 'noban' in peerinfo['permissions'])\n+        assert not \"noban\" in peerinfo[\"permissions\"]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r620157123",
      "id" : 620157123,
      "in_reply_to_id" : 620088086,
      "line" : 25,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMDE1NzEyMw==",
      "original_commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "original_line" : 25,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/rpc_setban.py",
      "position" : 5,
      "pull_request_review_id" : 644494451,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-26T10:12:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/620157123",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--4a62be1de6b64f3ed646cdc7932c8cf5-->\nðµï¸ @harding @hebasto have been requested to review this pull request as specified in the REVIEWERS file.",
      "created_at" : "2021-05-03T17:25:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-831409748",
      "id" : 831409748,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgzMTQwOTc0OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-03T17:25:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/831409748",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r631375563"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631375563"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Would it be worthwhile renaming `(Read)WriteSettings()` to something like `(Read)WriteJsonObjFile()`?",
      "commit_id" : "13c681161c4a3f2a2acd6d812c1360e0ad94019c",
      "created_at" : "2021-05-12T20:29:10Z",
      "diff_hunk" : "@@ -119,18 +176,54 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r631375563",
      "id" : 631375563,
      "line" : 190,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMTM3NTU2Mw==",
      "original_commit_id" : "391b4d5e84db2811df4de371480729fd0e8c42b8",
      "original_line" : 190,
      "original_position" : 86,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : 88,
      "pull_request_review_id" : 658347550,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-14T19:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631375563",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r631378639"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631378639"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Can the string \"address\" be a file-level `const` and re-used in `BanMapFromJson()`?",
      "commit_id" : "13c681161c4a3f2a2acd6d812c1360e0ad94019c",
      "created_at" : "2021-05-12T20:34:32Z",
      "diff_hunk" : "@@ -11,13 +11,70 @@\n #include <cstdint>\n #include <hash.h>\n #include <logging/timer.h>\n+#include <netbase.h>\n #include <random.h>\n #include <streams.h>\n #include <tinyformat.h>\n+#include <univalue.h>\n+#include <util/settings.h>\n #include <util/system.h>\n \n+CBanEntry::CBanEntry(const UniValue& json)\n+    : nVersion(json[\"version\"].get_int()), nCreateTime(json[\"ban_created\"].get_int64()),\n+      nBanUntil(json[\"banned_until\"].get_int64())\n+{\n+}\n+\n+UniValue CBanEntry::ToJson() const\n+{\n+    UniValue json(UniValue::VOBJ);\n+    json.pushKV(\"version\", nVersion);\n+    json.pushKV(\"ban_created\", nCreateTime);\n+    json.pushKV(\"banned_until\", nBanUntil);\n+    return json;\n+}\n+\n namespace {\n \n+/**\n+ * Convert a `banmap_t` object to a JSON array.\n+ * @param[in] bans Bans list to convert.\n+ * @return a JSON array, similar to the one returned by the `listbanned` RPC. Suitable for\n+ * passing to `BanMapFromJson()`.\n+ */\n+UniValue BanMapToJson(const banmap_t& bans)\n+{\n+    UniValue bans_json(UniValue::VARR);\n+    for (const auto& it : bans) {\n+        const auto& address = it.first;\n+        const auto& ban_entry = it.second;\n+        UniValue j = ban_entry.ToJson();\n+        j.pushKV(\"address\", address.ToString());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r631378639",
      "id" : 631378639,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMTM3ODYzOQ==",
      "original_commit_id" : "391b4d5e84db2811df4de371480729fd0e8c42b8",
      "original_line" : 52,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : null,
      "pull_request_review_id" : 658347550,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-14T19:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631378639",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r631402209"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631402209"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Is it useful to sanity check `version` and `banned_until` as well?",
      "commit_id" : "13c681161c4a3f2a2acd6d812c1360e0ad94019c",
      "created_at" : "2021-05-12T21:06:06Z",
      "diff_hunk" : "@@ -11,13 +11,70 @@\n #include <cstdint>\n #include <hash.h>\n #include <logging/timer.h>\n+#include <netbase.h>\n #include <random.h>\n #include <streams.h>\n #include <tinyformat.h>\n+#include <univalue.h>\n+#include <util/settings.h>\n #include <util/system.h>\n \n+CBanEntry::CBanEntry(const UniValue& json)\n+    : nVersion(json[\"version\"].get_int()), nCreateTime(json[\"ban_created\"].get_int64()),\n+      nBanUntil(json[\"banned_until\"].get_int64())\n+{\n+}\n+\n+UniValue CBanEntry::ToJson() const\n+{\n+    UniValue json(UniValue::VOBJ);\n+    json.pushKV(\"version\", nVersion);\n+    json.pushKV(\"ban_created\", nCreateTime);\n+    json.pushKV(\"banned_until\", nBanUntil);\n+    return json;\n+}\n+\n namespace {\n \n+/**\n+ * Convert a `banmap_t` object to a JSON array.\n+ * @param[in] bans Bans list to convert.\n+ * @return a JSON array, similar to the one returned by the `listbanned` RPC. Suitable for\n+ * passing to `BanMapFromJson()`.\n+ */\n+UniValue BanMapToJson(const banmap_t& bans)\n+{\n+    UniValue bans_json(UniValue::VARR);\n+    for (const auto& it : bans) {\n+        const auto& address = it.first;\n+        const auto& ban_entry = it.second;\n+        UniValue j = ban_entry.ToJson();\n+        j.pushKV(\"address\", address.ToString());\n+        bans_json.push_back(j);\n+    }\n+    return bans_json;\n+}\n+\n+/**\n+ * Convert a JSON array to a `banmap_t` object.\n+ * @param[in] bans_json JSON to convert, must be as returned by `BanMapToJson()`.\n+ * @param[out] bans Bans list to create from the JSON.\n+ * @throws std::runtime_error if the JSON does not have the expected fields or they contain\n+ * unparsable values.\n+ */\n+void BanMapFromJson(const UniValue& bans_json, banmap_t& bans)\n+{\n+    for (const auto& ban_entry_json : bans_json.getValues()) {\n+        CSubNet subnet;\n+        const auto& subnet_str = ban_entry_json[\"address\"].get_str();\n+        if (!LookupSubNet(subnet_str, subnet)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r631402209",
      "id" : 631402209,
      "line" : 72,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMTQwMjIwOQ==",
      "original_commit_id" : "391b4d5e84db2811df4de371480729fd0e8c42b8",
      "original_line" : 72,
      "original_position" : 60,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : 62,
      "pull_request_review_id" : 658347550,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-14T19:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/631402209",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r632146518"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632146518"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> only set if `true` is returned.\r\n\r\nI _think_ it's possible for it to be set and yet the function return false if `DeserializeFileDB` returns `false` due to an invalid or missing file.",
      "commit_id" : "13c681161c4a3f2a2acd6d812c1360e0ad94019c",
      "created_at" : "2021-05-13T22:39:38Z",
      "diff_hunk" : "@@ -62,15 +76,30 @@ class CAddrDB\n     static bool Read(CAddrMan& addr, CDataStream& ssPeers);\n };\n \n-/** Access to the banlist database (banlist.dat) */\n+/** Access to the banlist databases (banlist.json and banlist.dat) */\n class CBanDB\n {\n private:\n-    const fs::path m_ban_list_path;\n+    /**\n+     * JSON key under which the data is stored in the json database.\n+     */\n+    static constexpr const char* JSON_KEY = \"banned_nets\";\n+\n+    const fs::path m_banlist_dat;\n+    const fs::path m_banlist_json;\n public:\n     explicit CBanDB(fs::path ban_list_path);\n     bool Write(const banmap_t& banSet);\n-    bool Read(banmap_t& banSet);\n+\n+    /**\n+     * Read the banlist from disk.\n+     * @param[out] banSet The loaded list, set if `true` is returned, otherwise it is left\n+     * in an undefined state.\n+     * @param[out] dirty Indicates whether the loaded list needs flushing to disk, only set",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r632146518",
      "id" : 632146518,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMjE0NjUxOA==",
      "original_commit_id" : "391b4d5e84db2811df4de371480729fd0e8c42b8",
      "original_line" : 98,
      "original_position" : 61,
      "original_start_line" : null,
      "path" : "src/addrdb.h",
      "position" : null,
      "pull_request_review_id" : 658347550,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-14T19:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632146518",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r632151649"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632151649"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Is it useful to remove `banlist.dat` if it does exist at this point? Or a log to inform the user that they can remove it? Might be confusing to have two files both claiming to be banlists.",
      "commit_id" : "13c681161c4a3f2a2acd6d812c1360e0ad94019c",
      "created_at" : "2021-05-13T22:54:26Z",
      "diff_hunk" : "@@ -119,18 +176,54 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {\n+        return true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r632151649",
      "id" : 632151649,
      "line" : 191,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMjE1MTY0OQ==",
      "original_commit_id" : "391b4d5e84db2811df4de371480729fd0e8c42b8",
      "original_line" : 191,
      "original_position" : 87,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : 89,
      "pull_request_review_id" : 658347550,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-14T19:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632151649",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r632169018"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632169018"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Extra \"/\"",
      "commit_id" : "13c681161c4a3f2a2acd6d812c1360e0ad94019c",
      "created_at" : "2021-05-13T23:48:15Z",
      "diff_hunk" : "@@ -17,7 +17,8 @@\n \n // NOTE: When adjusting this, update rpcnet:setban's help (\"24h\")\n static constexpr unsigned int DEFAULT_MISBEHAVING_BANTIME = 60 * 60 * 24; // Default 24-hour ban\n-// How often to dump addresses to banlist.dat\n+\n+/// How often to dump banned addresses/subnets to disk.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r632169018",
      "id" : 632169018,
      "line" : 21,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMjE2OTAxOA==",
      "original_commit_id" : "391b4d5e84db2811df4de371480729fd0e8c42b8",
      "original_line" : 21,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : 6,
      "pull_request_review_id" : 658347550,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-14T19:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632169018",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r632279391"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632279391"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Is there a way to add these fuzz tests and not invalidate the existing seeds?",
      "commit_id" : "13c681161c4a3f2a2acd6d812c1360e0ad94019c",
      "created_at" : "2021-05-14T04:52:35Z",
      "diff_hunk" : "@@ -34,8 +36,20 @@ FUZZ_TARGET_INIT(banman, initialize_banman)\n {\n     FuzzedDataProvider fuzzed_data_provider{buffer.data(), buffer.size()};\n     SetMockTime(ConsumeTime(fuzzed_data_provider));\n-    const fs::path banlist_file = GetDataDir() / \"fuzzed_banlist.dat\";\n-    fs::remove(banlist_file);\n+    fs::path banlist_file = GetDataDir() / \"fuzzed_banlist\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r632279391",
      "id" : 632279391,
      "line" : 39,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMjI3OTM5MQ==",
      "original_commit_id" : "391b4d5e84db2811df4de371480729fd0e8c42b8",
      "original_line" : 39,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/test/fuzz/banman.cpp",
      "position" : 17,
      "pull_request_review_id" : 658347550,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-14T19:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632279391",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r632705279"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632705279"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I know this is a resolved comment. Just leaving my +1 for `assert x not in y` being easier than `not assert x in y`",
      "commit_id" : "13c681161c4a3f2a2acd6d812c1360e0ad94019c",
      "created_at" : "2021-05-14T18:05:53Z",
      "diff_hunk" : "@@ -22,7 +22,7 @@ def run_test(self):\n         # Node 0 connects to Node 1, check that the noban permission is not granted\n         self.connect_nodes(0, 1)\n         peerinfo = self.nodes[1].getpeerinfo()[0]\n-        assert(not 'noban' in peerinfo['permissions'])\n+        assert not \"noban\" in peerinfo[\"permissions\"]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r632705279",
      "id" : 632705279,
      "in_reply_to_id" : 620088086,
      "line" : 25,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMjcwNTI3OQ==",
      "original_commit_id" : "fe4aafda512483e863b23cfad403509b1604555c",
      "original_line" : 25,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/rpc_setban.py",
      "position" : 5,
      "pull_request_review_id" : 658347550,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-14T19:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632705279",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r634439439"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634439439"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I am not sure. `version` and `banned_until` are not sanity-checked when reading `banlist.dat`, so I do the same with `banlist.json` as the purpose of this PR is to switch the format, not introduce new checks.\r\n\r\nMaybe worth considering separately.",
      "commit_id" : "13c681161c4a3f2a2acd6d812c1360e0ad94019c",
      "created_at" : "2021-05-18T14:29:05Z",
      "diff_hunk" : "@@ -11,13 +11,70 @@\n #include <cstdint>\n #include <hash.h>\n #include <logging/timer.h>\n+#include <netbase.h>\n #include <random.h>\n #include <streams.h>\n #include <tinyformat.h>\n+#include <univalue.h>\n+#include <util/settings.h>\n #include <util/system.h>\n \n+CBanEntry::CBanEntry(const UniValue& json)\n+    : nVersion(json[\"version\"].get_int()), nCreateTime(json[\"ban_created\"].get_int64()),\n+      nBanUntil(json[\"banned_until\"].get_int64())\n+{\n+}\n+\n+UniValue CBanEntry::ToJson() const\n+{\n+    UniValue json(UniValue::VOBJ);\n+    json.pushKV(\"version\", nVersion);\n+    json.pushKV(\"ban_created\", nCreateTime);\n+    json.pushKV(\"banned_until\", nBanUntil);\n+    return json;\n+}\n+\n namespace {\n \n+/**\n+ * Convert a `banmap_t` object to a JSON array.\n+ * @param[in] bans Bans list to convert.\n+ * @return a JSON array, similar to the one returned by the `listbanned` RPC. Suitable for\n+ * passing to `BanMapFromJson()`.\n+ */\n+UniValue BanMapToJson(const banmap_t& bans)\n+{\n+    UniValue bans_json(UniValue::VARR);\n+    for (const auto& it : bans) {\n+        const auto& address = it.first;\n+        const auto& ban_entry = it.second;\n+        UniValue j = ban_entry.ToJson();\n+        j.pushKV(\"address\", address.ToString());\n+        bans_json.push_back(j);\n+    }\n+    return bans_json;\n+}\n+\n+/**\n+ * Convert a JSON array to a `banmap_t` object.\n+ * @param[in] bans_json JSON to convert, must be as returned by `BanMapToJson()`.\n+ * @param[out] bans Bans list to create from the JSON.\n+ * @throws std::runtime_error if the JSON does not have the expected fields or they contain\n+ * unparsable values.\n+ */\n+void BanMapFromJson(const UniValue& bans_json, banmap_t& bans)\n+{\n+    for (const auto& ban_entry_json : bans_json.getValues()) {\n+        CSubNet subnet;\n+        const auto& subnet_str = ban_entry_json[\"address\"].get_str();\n+        if (!LookupSubNet(subnet_str, subnet)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r634439439",
      "id" : 634439439,
      "in_reply_to_id" : 631402209,
      "line" : 72,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDQzOTQzOQ==",
      "original_commit_id" : "391b4d5e84db2811df4de371480729fd0e8c42b8",
      "original_line" : 72,
      "original_position" : 60,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : 62,
      "pull_request_review_id" : 662162688,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-18T14:29:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634439439",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r634452821"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634452821"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I deliberately avoid removing `banlist.dat` automatically because that would prevent downgrading to an older version (and keeping the ban list).\r\n\r\nSomething like this may be a good idea:\r\n\r\n```diff\r\n--- i/src/addrdb.cpp\r\n+++ w/src/addrdb.cpp\r\n@@ -185,12 +185,18 @@ CBanDB::CBanDB(fs::path ban_list_path)\r\n }\r\n\r\n bool CBanDB::Write(const banmap_t& banSet)\r\n {\r\n     std::vector<std::string> errors;\r\n     if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {\r\n+        if (fs::exists(m_banlist_dat)) {\r\n+            LogPrintf(\"Successfully saved %s to disk. %s can be removed manually now if \"\r\n+                      \"downgrading to an older version is not planned.\\n\",\r\n+                      m_banlist_json.string(),\r\n+                      m_banlist_dat.string());\r\n+        }\r\n         return true;\r\n     }\r\n\r\n     for (const auto& err : errors) {\r\n         error(\"%s\", err);\r\n     }\r\n```\r\n\r\nbut it would be printed **every** time which would be annoying. There is some doc added to `doc/files.md` which should clarify things if the user wonders why there are two files. Maybe leave it as is?\r\n\r\nWe can add an automatic removal of `banlist.dat` one major version after this change is released.",
      "commit_id" : "13c681161c4a3f2a2acd6d812c1360e0ad94019c",
      "created_at" : "2021-05-18T14:43:01Z",
      "diff_hunk" : "@@ -119,18 +176,54 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {\n+        return true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r634452821",
      "id" : 634452821,
      "in_reply_to_id" : 632151649,
      "line" : 191,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDQ1MjgyMQ==",
      "original_commit_id" : "391b4d5e84db2811df4de371480729fd0e8c42b8",
      "original_line" : 191,
      "original_position" : 87,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : 89,
      "pull_request_review_id" : 662180763,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-18T14:58:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634452821",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r634455991"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634455991"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The 3 slashes make it a [doxygen comment](https://www.doxygen.nl/manual/docblocks.html#specialblock) for inclusion in https://doxygen.bitcoincore.org/.\r\n\r\n",
      "commit_id" : "13c681161c4a3f2a2acd6d812c1360e0ad94019c",
      "created_at" : "2021-05-18T14:46:28Z",
      "diff_hunk" : "@@ -17,7 +17,8 @@\n \n // NOTE: When adjusting this, update rpcnet:setban's help (\"24h\")\n static constexpr unsigned int DEFAULT_MISBEHAVING_BANTIME = 60 * 60 * 24; // Default 24-hour ban\n-// How often to dump addresses to banlist.dat\n+\n+/// How often to dump banned addresses/subnets to disk.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r634455991",
      "id" : 634455991,
      "in_reply_to_id" : 632169018,
      "line" : 21,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDQ1NTk5MQ==",
      "original_commit_id" : "391b4d5e84db2811df4de371480729fd0e8c42b8",
      "original_line" : 21,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : 6,
      "pull_request_review_id" : 662185086,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-18T14:46:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634455991",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r634460741"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634460741"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't see how - we must first write the file or set `banlist_file` and only after that execute the actual test.",
      "commit_id" : "13c681161c4a3f2a2acd6d812c1360e0ad94019c",
      "created_at" : "2021-05-18T14:51:26Z",
      "diff_hunk" : "@@ -34,8 +36,20 @@ FUZZ_TARGET_INIT(banman, initialize_banman)\n {\n     FuzzedDataProvider fuzzed_data_provider{buffer.data(), buffer.size()};\n     SetMockTime(ConsumeTime(fuzzed_data_provider));\n-    const fs::path banlist_file = GetDataDir() / \"fuzzed_banlist.dat\";\n-    fs::remove(banlist_file);\n+    fs::path banlist_file = GetDataDir() / \"fuzzed_banlist\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r634460741",
      "id" : 634460741,
      "in_reply_to_id" : 632279391,
      "line" : 39,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDQ2MDc0MQ==",
      "original_commit_id" : "391b4d5e84db2811df4de371480729fd0e8c42b8",
      "original_line" : 39,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/test/fuzz/banman.cpp",
      "position" : 17,
      "pull_request_review_id" : 662191428,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-18T14:51:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634460741",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r634462854"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634462854"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Right, reworded the comment.",
      "commit_id" : "13c681161c4a3f2a2acd6d812c1360e0ad94019c",
      "created_at" : "2021-05-18T14:53:35Z",
      "diff_hunk" : "@@ -62,15 +76,30 @@ class CAddrDB\n     static bool Read(CAddrMan& addr, CDataStream& ssPeers);\n };\n \n-/** Access to the banlist database (banlist.dat) */\n+/** Access to the banlist databases (banlist.json and banlist.dat) */\n class CBanDB\n {\n private:\n-    const fs::path m_ban_list_path;\n+    /**\n+     * JSON key under which the data is stored in the json database.\n+     */\n+    static constexpr const char* JSON_KEY = \"banned_nets\";\n+\n+    const fs::path m_banlist_dat;\n+    const fs::path m_banlist_json;\n public:\n     explicit CBanDB(fs::path ban_list_path);\n     bool Write(const banmap_t& banSet);\n-    bool Read(banmap_t& banSet);\n+\n+    /**\n+     * Read the banlist from disk.\n+     * @param[out] banSet The loaded list, set if `true` is returned, otherwise it is left\n+     * in an undefined state.\n+     * @param[out] dirty Indicates whether the loaded list needs flushing to disk, only set",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r634462854",
      "id" : 634462854,
      "in_reply_to_id" : 632146518,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDQ2Mjg1NA==",
      "original_commit_id" : "391b4d5e84db2811df4de371480729fd0e8c42b8",
      "original_line" : 98,
      "original_position" : 61,
      "original_start_line" : null,
      "path" : "src/addrdb.h",
      "position" : null,
      "pull_request_review_id" : 662194361,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-18T14:53:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634462854",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r634463232"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634463232"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, good idea! Done.",
      "commit_id" : "13c681161c4a3f2a2acd6d812c1360e0ad94019c",
      "created_at" : "2021-05-18T14:54:00Z",
      "diff_hunk" : "@@ -11,13 +11,70 @@\n #include <cstdint>\n #include <hash.h>\n #include <logging/timer.h>\n+#include <netbase.h>\n #include <random.h>\n #include <streams.h>\n #include <tinyformat.h>\n+#include <univalue.h>\n+#include <util/settings.h>\n #include <util/system.h>\n \n+CBanEntry::CBanEntry(const UniValue& json)\n+    : nVersion(json[\"version\"].get_int()), nCreateTime(json[\"ban_created\"].get_int64()),\n+      nBanUntil(json[\"banned_until\"].get_int64())\n+{\n+}\n+\n+UniValue CBanEntry::ToJson() const\n+{\n+    UniValue json(UniValue::VOBJ);\n+    json.pushKV(\"version\", nVersion);\n+    json.pushKV(\"ban_created\", nCreateTime);\n+    json.pushKV(\"banned_until\", nBanUntil);\n+    return json;\n+}\n+\n namespace {\n \n+/**\n+ * Convert a `banmap_t` object to a JSON array.\n+ * @param[in] bans Bans list to convert.\n+ * @return a JSON array, similar to the one returned by the `listbanned` RPC. Suitable for\n+ * passing to `BanMapFromJson()`.\n+ */\n+UniValue BanMapToJson(const banmap_t& bans)\n+{\n+    UniValue bans_json(UniValue::VARR);\n+    for (const auto& it : bans) {\n+        const auto& address = it.first;\n+        const auto& ban_entry = it.second;\n+        UniValue j = ban_entry.ToJson();\n+        j.pushKV(\"address\", address.ToString());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r634463232",
      "id" : 634463232,
      "in_reply_to_id" : 631378639,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDQ2MzIzMg==",
      "original_commit_id" : "391b4d5e84db2811df4de371480729fd0e8c42b8",
      "original_line" : 52,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : null,
      "pull_request_review_id" : 662194891,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-18T14:54:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634463232",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r634466857"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634466857"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think either one is fine. Renaming is out of the scope of this PR.",
      "commit_id" : "13c681161c4a3f2a2acd6d812c1360e0ad94019c",
      "created_at" : "2021-05-18T14:57:50Z",
      "diff_hunk" : "@@ -119,18 +176,54 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r634466857",
      "id" : 634466857,
      "in_reply_to_id" : 631375563,
      "line" : 190,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDQ2Njg1Nw==",
      "original_commit_id" : "391b4d5e84db2811df4de371480729fd0e8c42b8",
      "original_line" : 190,
      "original_position" : 86,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : 88,
      "pull_request_review_id" : 662199887,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-18T14:57:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634466857",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`fe4aafda51...13c681161c`: address review suggestions",
      "created_at" : "2021-05-18T14:59:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-843245302",
      "id" : 843245302,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg0MzI0NTMwMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-18T14:59:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/843245302",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> this is the behavior I'd like to point to and make sure it's ok ... Node 1 deletes banlist.json to clear all bans ... The ban comes back from banlist.dat\r\n\r\nYes, this is how it is supposed to work. The operator should have seen that there are two files `banlist.dat` and `banlist.json` and deleted both or consulted `doc/files.md`. We don't automatically delete `banlist.dat` after creating `banlist.json` because that would create issues if the user decides to downgrade to the previous version which only recognizes `banlist.dat`.\r\n",
      "created_at" : "2021-05-18T15:05:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-843250170",
      "id" : 843250170,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg0MzI1MDE3MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-18T15:05:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/843250170",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r634498403"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634498403"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, and doc/developer-notes.md also provides an example with /// iirc.",
      "commit_id" : "13c681161c4a3f2a2acd6d812c1360e0ad94019c",
      "created_at" : "2021-05-18T15:29:39Z",
      "diff_hunk" : "@@ -17,7 +17,8 @@\n \n // NOTE: When adjusting this, update rpcnet:setban's help (\"24h\")\n static constexpr unsigned int DEFAULT_MISBEHAVING_BANTIME = 60 * 60 * 24; // Default 24-hour ban\n-// How often to dump addresses to banlist.dat\n+\n+/// How often to dump banned addresses/subnets to disk.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r634498403",
      "id" : 634498403,
      "in_reply_to_id" : 632169018,
      "line" : 21,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDQ5ODQwMw==",
      "original_commit_id" : "391b4d5e84db2811df4de371480729fd0e8c42b8",
      "original_line" : 21,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : 6,
      "pull_request_review_id" : 662242388,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-18T15:29:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634498403",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r634514956"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634514956"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Oh. Thanks for teaching.",
      "commit_id" : "13c681161c4a3f2a2acd6d812c1360e0ad94019c",
      "created_at" : "2021-05-18T15:48:44Z",
      "diff_hunk" : "@@ -17,7 +17,8 @@\n \n // NOTE: When adjusting this, update rpcnet:setban's help (\"24h\")\n static constexpr unsigned int DEFAULT_MISBEHAVING_BANTIME = 60 * 60 * 24; // Default 24-hour ban\n-// How often to dump addresses to banlist.dat\n+\n+/// How often to dump banned addresses/subnets to disk.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r634514956",
      "id" : 634514956,
      "in_reply_to_id" : 632169018,
      "line" : 21,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDUxNDk1Ng==",
      "original_commit_id" : "391b4d5e84db2811df4de371480729fd0e8c42b8",
      "original_line" : 21,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : 6,
      "pull_request_review_id" : 662264959,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-18T15:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634514956",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r634517262"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634517262"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Removing `banlist.dat` one major version later seems like a fair choice!",
      "commit_id" : "13c681161c4a3f2a2acd6d812c1360e0ad94019c",
      "created_at" : "2021-05-18T15:51:27Z",
      "diff_hunk" : "@@ -119,18 +176,54 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {\n+        return true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r634517262",
      "id" : 634517262,
      "in_reply_to_id" : 632151649,
      "line" : 191,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDUxNzI2Mg==",
      "original_commit_id" : "391b4d5e84db2811df4de371480729fd0e8c42b8",
      "original_line" : 191,
      "original_position" : 87,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : 89,
      "pull_request_review_id" : 662268112,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-18T15:51:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634517262",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r634518185"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634518185"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Perhaps with a separate fuzz test? I'm a fuzzing n00b though. We should ask @MarcoFalke and @practicalswift!",
      "commit_id" : "13c681161c4a3f2a2acd6d812c1360e0ad94019c",
      "created_at" : "2021-05-18T15:52:34Z",
      "diff_hunk" : "@@ -34,8 +36,20 @@ FUZZ_TARGET_INIT(banman, initialize_banman)\n {\n     FuzzedDataProvider fuzzed_data_provider{buffer.data(), buffer.size()};\n     SetMockTime(ConsumeTime(fuzzed_data_provider));\n-    const fs::path banlist_file = GetDataDir() / \"fuzzed_banlist.dat\";\n-    fs::remove(banlist_file);\n+    fs::path banlist_file = GetDataDir() / \"fuzzed_banlist\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r634518185",
      "id" : 634518185,
      "in_reply_to_id" : 632279391,
      "line" : 39,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDUxODE4NQ==",
      "original_commit_id" : "391b4d5e84db2811df4de371480729fd0e8c42b8",
      "original_line" : 39,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/test/fuzz/banman.cpp",
      "position" : 17,
      "pull_request_review_id" : 662269355,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-18T15:52:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634518185",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "re-ACK `13c6811`",
      "created_at" : "2021-05-18T15:55:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-843290442",
      "id" : 843290442,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg0MzI5MDQ0Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-18T15:55:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/843290442",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r635305449"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/635305449"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Not a fan of doing this for a short string like this that is used only twice, but it's not a blocker.",
      "commit_id" : "13c681161c4a3f2a2acd6d812c1360e0ad94019c",
      "created_at" : "2021-05-19T14:36:48Z",
      "diff_hunk" : "@@ -11,13 +11,70 @@\n #include <cstdint>\n #include <hash.h>\n #include <logging/timer.h>\n+#include <netbase.h>\n #include <random.h>\n #include <streams.h>\n #include <tinyformat.h>\n+#include <univalue.h>\n+#include <util/settings.h>\n #include <util/system.h>\n \n+CBanEntry::CBanEntry(const UniValue& json)\n+    : nVersion(json[\"version\"].get_int()), nCreateTime(json[\"ban_created\"].get_int64()),\n+      nBanUntil(json[\"banned_until\"].get_int64())\n+{\n+}\n+\n+UniValue CBanEntry::ToJson() const\n+{\n+    UniValue json(UniValue::VOBJ);\n+    json.pushKV(\"version\", nVersion);\n+    json.pushKV(\"ban_created\", nCreateTime);\n+    json.pushKV(\"banned_until\", nBanUntil);\n+    return json;\n+}\n+\n namespace {\n \n+/**\n+ * Convert a `banmap_t` object to a JSON array.\n+ * @param[in] bans Bans list to convert.\n+ * @return a JSON array, similar to the one returned by the `listbanned` RPC. Suitable for\n+ * passing to `BanMapFromJson()`.\n+ */\n+UniValue BanMapToJson(const banmap_t& bans)\n+{\n+    UniValue bans_json(UniValue::VARR);\n+    for (const auto& it : bans) {\n+        const auto& address = it.first;\n+        const auto& ban_entry = it.second;\n+        UniValue j = ban_entry.ToJson();\n+        j.pushKV(\"address\", address.ToString());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r635305449",
      "id" : 635305449,
      "in_reply_to_id" : 631378639,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNTMwNTQ0OQ==",
      "original_commit_id" : "391b4d5e84db2811df4de371480729fd0e8c42b8",
      "original_line" : 52,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : null,
      "pull_request_review_id" : 663293152,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-19T14:36:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/635305449",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Diff-review re-ACK 13c681161c4a3f2a2acd6d812c1360e0ad94019c per ` git diff 08f4f98 13c6811` and  `git range-diff d4c409c 08f4f98 13c6811`\r\n\r\nOnly non-showstopping mini-regret is the Python \"not in\" not updated while re-touching to conform to PEP8 per our functional test guidelines.",
      "created_at" : "2021-05-19T14:41:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-844172348",
      "id" : 844172348,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg0NDE3MjM0OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-19T14:41:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/844172348",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-05-24T09:39:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-846919349",
      "id" : 846919349,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg0NjkxOTM0OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-24T09:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/846919349",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Sorry, this had two ACKs and I didn't see the conflict.",
      "created_at" : "2021-05-24T10:00:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-846931030",
      "id" : 846931030,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg0NjkzMTAzMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-24T10:00:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/846931030",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`13c681161c...88b843e49c`: rebase due to conflicts\r\n\r\n<details>\r\n<summary>Release notes</summary>\r\n\r\n```diff\r\n--- a/doc/release-notes.md\r\n+++ b/doc/release-notes.md\r\n@@ -182,12 +182,21 @@ RPC\r\n   - `verifymessage` now returns RPC_TYPE_ERROR (-3) if the passed signature\r\n     is malformed. Previously returned RPC_INVALID_ADDRESS_OR_KEY (-5).\r\n\r\n Tests\r\n -----\r\n\r\n+Files\r\n+-----\r\n+\r\n+- The list of banned hosts and networks (via `setban` RPC) is now saved on disk\r\n+  in JSON format in `banlist.json` instead of `banlist.dat`. `banlist.dat` is\r\n+  only read on startup if `banlist.json` is not present. Changes are only\r\n+  written to the new `banlist.json`. A future version of Bitcoin Core may\r\n+  completely ignore `banlist.dat`. (#20966)\r\n+\r\n Credits\r\n =======\r\n```\r\n</details>\r\n",
      "created_at" : "2021-05-24T12:13:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-847001828",
      "id" : 847001828,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg0NzAwMTgyOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-24T12:13:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/847001828",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK.",
      "created_at" : "2021-05-24T13:07:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-847030339",
      "id" : 847030339,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg0NzAzMDMzOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-24T13:07:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/847030339",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r637932195"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/637932195"
         }
      },
      "author_association" : "MEMBER",
      "body" : "f371273 could be done in a follow-up along with `not_in`, but if you retouch\r\n```diff\r\n--- a/test/functional/rpc_setban.py\r\n+++ b/test/functional/rpc_setban.py\r\n@@ -56,18 +56,17 @@ class SetBanTests(BitcoinTestFramework):\r\n         assert self.is_banned(node, tor_addr)\r\n         assert not self.is_banned(node, ip_addr)\r\n \r\n-        # Test that the ban list is preserved through restart.\r\n-\r\n+        self.log.info(\"Test the ban list is preserved through restart\")\r\n         self.restart_node(1)\r\n         assert self.is_banned(node, tor_addr)\r\n         assert not self.is_banned(node, ip_addr)\r\n \r\n         node.setban(tor_addr, \"remove\")\r\n-        assert not self.is_banned(self.nodes[1], tor_addr)\r\n+        assert not self.is_banned(node, tor_addr)\r\n         assert not self.is_banned(node, ip_addr)\r\n \r\n         self.restart_node(1)\r\n-        assert not self.is_banned(self.nodes[1], tor_addr)\r\n+        assert not self.is_banned(node, tor_addr)\r\n         assert not self.is_banned(node, ip_addr)\r\n```\r\n",
      "commit_id" : "88b843e49c84e331e40bfbe249269deaf2a6a2ac",
      "created_at" : "2021-05-24T13:09:04Z",
      "diff_hunk" : "@@ -36,27 +36,40 @@ def run_test(self):\n         self.restart_node(1, ['-whitelist=127.0.0.1'])\n         self.connect_nodes(0, 1)\n         peerinfo = self.nodes[1].getpeerinfo()[0]\n-        assert('noban' in peerinfo['permissions'])\n+        assert \"noban\" in peerinfo[\"permissions\"]\n \n         # If we remove the ban, Node 0 should be able to reconnect even without noban permission\n         self.nodes[1].setban(\"127.0.0.1\", \"remove\")\n         self.restart_node(1, [])\n         self.connect_nodes(0, 1)\n         peerinfo = self.nodes[1].getpeerinfo()[0]\n-        assert(not 'noban' in peerinfo['permissions'])\n+        assert not \"noban\" in peerinfo[\"permissions\"]\n \n         self.log.info(\"Test that a non-IP address can be banned/unbanned\")\n         node = self.nodes[1]\n         tor_addr = \"pg6mmjiyjmcrsslvykfwnntlaru7p5svn6y2ymmju6nubxndf4pscryd.onion\"\n         ip_addr = \"1.2.3.4\"\n-        assert(not self.is_banned(node, tor_addr))\n-        assert(not self.is_banned(node, ip_addr))\n+        assert not self.is_banned(node, tor_addr)\n+        assert not self.is_banned(node, ip_addr)\n+\n         node.setban(tor_addr, \"add\")\n-        assert(self.is_banned(node, tor_addr))\n-        assert(not self.is_banned(node, ip_addr))\n+        assert self.is_banned(node, tor_addr)\n+        assert not self.is_banned(node, ip_addr)\n+\n+        # Test that the ban list is preserved through restart.\n+\n+        self.restart_node(1)\n+        assert self.is_banned(node, tor_addr)\n+        assert not self.is_banned(node, ip_addr)\n+\n         node.setban(tor_addr, \"remove\")\n-        assert(not self.is_banned(self.nodes[1], tor_addr))\n-        assert(not self.is_banned(node, ip_addr))\n+        assert not self.is_banned(self.nodes[1], tor_addr)\n+        assert not self.is_banned(node, ip_addr)\n+\n+        self.restart_node(1)\n+        assert not self.is_banned(self.nodes[1], tor_addr)\n+        assert not self.is_banned(node, ip_addr)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r637932195",
      "id" : 637932195,
      "line" : 71,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNzkzMjE5NQ==",
      "original_commit_id" : "88b843e49c84e331e40bfbe249269deaf2a6a2ac",
      "original_line" : 71,
      "original_position" : 53,
      "original_start_line" : null,
      "path" : "test/functional/rpc_setban.py",
      "position" : 53,
      "pull_request_review_id" : 666719128,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-24T13:13:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/637932195",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r637940462"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/637940462"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@vasild \r\nIn your opinion, when will be an appropriate moment to move the `banlist.dat` description into the \"Legacy subdirectories and files\" subsection?",
      "commit_id" : "88b843e49c84e331e40bfbe249269deaf2a6a2ac",
      "created_at" : "2021-05-24T13:22:22Z",
      "diff_hunk" : "@@ -56,7 +56,8 @@ Subdirectory       | File(s)               | Description\n `indexes/coinstats/db/` | LevelDB database | Coinstats index; *optional*, used if `-coinstatsindex=1`\n `wallets/`         |                       | [Contains wallets](#multi-wallet-environment); can be specified by `-walletdir` option; if `wallets/` subdirectory does not exist, wallets reside in the [data directory](#data-directory-location)\n `./`               | `anchors.dat`         | Anchor IP address database, created on shutdown and deleted at startup. Anchors are last known outgoing block-relay-only peers that are tried to re-connect to on startup\n-`./`               | `banlist.dat`         | Stores the IPs/subnets of banned nodes\n+`./`               | `banlist.dat`         | Stores the addresses/subnets of banned nodes (deprecated). `bitcoind` or `bitcoin-qt` no longer save the banlist to this file, but read it on startup if `banlist.json` is not present.\n+`./`               | `banlist.json`        | Stores the addresses/subnets of banned nodes.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r637940462",
      "id" : 637940462,
      "line" : 60,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNzk0MDQ2Mg==",
      "original_commit_id" : "88b843e49c84e331e40bfbe249269deaf2a6a2ac",
      "original_line" : 60,
      "original_position" : 6,
      "original_start_line" : 59,
      "path" : "doc/files.md",
      "position" : 6,
      "pull_request_review_id" : 666730325,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : 59,
      "start_side" : "LEFT",
      "updated_at" : "2021-05-24T13:22:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/637940462",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r637941953"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/637941953"
         }
      },
      "author_association" : "MEMBER",
      "body" : "See https://github.com/bitcoin/bitcoin/pull/20966#discussion_r634452821.",
      "commit_id" : "88b843e49c84e331e40bfbe249269deaf2a6a2ac",
      "created_at" : "2021-05-24T13:24:41Z",
      "diff_hunk" : "@@ -56,7 +56,8 @@ Subdirectory       | File(s)               | Description\n `indexes/coinstats/db/` | LevelDB database | Coinstats index; *optional*, used if `-coinstatsindex=1`\n `wallets/`         |                       | [Contains wallets](#multi-wallet-environment); can be specified by `-walletdir` option; if `wallets/` subdirectory does not exist, wallets reside in the [data directory](#data-directory-location)\n `./`               | `anchors.dat`         | Anchor IP address database, created on shutdown and deleted at startup. Anchors are last known outgoing block-relay-only peers that are tried to re-connect to on startup\n-`./`               | `banlist.dat`         | Stores the IPs/subnets of banned nodes\n+`./`               | `banlist.dat`         | Stores the addresses/subnets of banned nodes (deprecated). `bitcoind` or `bitcoin-qt` no longer save the banlist to this file, but read it on startup if `banlist.json` is not present.\n+`./`               | `banlist.json`        | Stores the addresses/subnets of banned nodes.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r637941953",
      "id" : 637941953,
      "in_reply_to_id" : 637940462,
      "line" : 60,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNzk0MTk1Mw==",
      "original_commit_id" : "88b843e49c84e331e40bfbe249269deaf2a6a2ac",
      "original_line" : 60,
      "original_position" : 6,
      "original_start_line" : 59,
      "path" : "doc/files.md",
      "position" : 6,
      "pull_request_review_id" : 666732386,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : 59,
      "start_side" : "LEFT",
      "updated_at" : "2021-05-24T13:25:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/637941953",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r637943278"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/637943278"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good question! I am not sure. Either now or in a next release where we completely ignore `banlist.dat`?",
      "commit_id" : "88b843e49c84e331e40bfbe249269deaf2a6a2ac",
      "created_at" : "2021-05-24T13:26:48Z",
      "diff_hunk" : "@@ -56,7 +56,8 @@ Subdirectory       | File(s)               | Description\n `indexes/coinstats/db/` | LevelDB database | Coinstats index; *optional*, used if `-coinstatsindex=1`\n `wallets/`         |                       | [Contains wallets](#multi-wallet-environment); can be specified by `-walletdir` option; if `wallets/` subdirectory does not exist, wallets reside in the [data directory](#data-directory-location)\n `./`               | `anchors.dat`         | Anchor IP address database, created on shutdown and deleted at startup. Anchors are last known outgoing block-relay-only peers that are tried to re-connect to on startup\n-`./`               | `banlist.dat`         | Stores the IPs/subnets of banned nodes\n+`./`               | `banlist.dat`         | Stores the addresses/subnets of banned nodes (deprecated). `bitcoind` or `bitcoin-qt` no longer save the banlist to this file, but read it on startup if `banlist.json` is not present.\n+`./`               | `banlist.json`        | Stores the addresses/subnets of banned nodes.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r637943278",
      "id" : 637943278,
      "in_reply_to_id" : 637940462,
      "line" : 60,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNzk0MzI3OA==",
      "original_commit_id" : "88b843e49c84e331e40bfbe249269deaf2a6a2ac",
      "original_line" : 60,
      "original_position" : 6,
      "original_start_line" : 59,
      "path" : "doc/files.md",
      "position" : 6,
      "pull_request_review_id" : 666734300,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : 59,
      "start_side" : "LEFT",
      "updated_at" : "2021-05-24T13:26:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/637943278",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r637953866"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/637953866"
         }
      },
      "author_association" : "MEMBER",
      "body" : "As we have https://github.com/bitcoin/bitcoin/blob/88b843e49c84e331e40bfbe249269deaf2a6a2ac/test/functional/rpc_setban.py#L49\r\n\r\nwhat are reasons to use `self.nodes[1]`? Did I miss something?",
      "commit_id" : "88b843e49c84e331e40bfbe249269deaf2a6a2ac",
      "created_at" : "2021-05-24T13:41:58Z",
      "diff_hunk" : "@@ -36,27 +36,40 @@ def run_test(self):\n         self.restart_node(1, ['-whitelist=127.0.0.1'])\n         self.connect_nodes(0, 1)\n         peerinfo = self.nodes[1].getpeerinfo()[0]\n-        assert('noban' in peerinfo['permissions'])\n+        assert \"noban\" in peerinfo[\"permissions\"]\n \n         # If we remove the ban, Node 0 should be able to reconnect even without noban permission\n         self.nodes[1].setban(\"127.0.0.1\", \"remove\")\n         self.restart_node(1, [])\n         self.connect_nodes(0, 1)\n         peerinfo = self.nodes[1].getpeerinfo()[0]\n-        assert(not 'noban' in peerinfo['permissions'])\n+        assert not \"noban\" in peerinfo[\"permissions\"]\n \n         self.log.info(\"Test that a non-IP address can be banned/unbanned\")\n         node = self.nodes[1]\n         tor_addr = \"pg6mmjiyjmcrsslvykfwnntlaru7p5svn6y2ymmju6nubxndf4pscryd.onion\"\n         ip_addr = \"1.2.3.4\"\n-        assert(not self.is_banned(node, tor_addr))\n-        assert(not self.is_banned(node, ip_addr))\n+        assert not self.is_banned(node, tor_addr)\n+        assert not self.is_banned(node, ip_addr)\n+\n         node.setban(tor_addr, \"add\")\n-        assert(self.is_banned(node, tor_addr))\n-        assert(not self.is_banned(node, ip_addr))\n+        assert self.is_banned(node, tor_addr)\n+        assert not self.is_banned(node, ip_addr)\n+\n+        # Test that the ban list is preserved through restart.\n+\n+        self.restart_node(1)\n+        assert self.is_banned(node, tor_addr)\n+        assert not self.is_banned(node, ip_addr)\n+\n         node.setban(tor_addr, \"remove\")\n-        assert(not self.is_banned(self.nodes[1], tor_addr))\n-        assert(not self.is_banned(node, ip_addr))\n+        assert not self.is_banned(self.nodes[1], tor_addr)\n+        assert not self.is_banned(node, ip_addr)\n+\n+        self.restart_node(1)\n+        assert not self.is_banned(self.nodes[1], tor_addr)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r637953866",
      "id" : 637953866,
      "line" : 70,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNzk1Mzg2Ng==",
      "original_commit_id" : "88b843e49c84e331e40bfbe249269deaf2a6a2ac",
      "original_line" : 70,
      "original_position" : 52,
      "original_start_line" : 66,
      "path" : "test/functional/rpc_setban.py",
      "position" : 52,
      "pull_request_review_id" : 666748246,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : 66,
      "start_side" : "RIGHT",
      "updated_at" : "2021-05-24T13:41:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/637953866",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r637954472"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/637954472"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oh, I see https://github.com/bitcoin/bitcoin/pull/20966/files#r637932195",
      "commit_id" : "88b843e49c84e331e40bfbe249269deaf2a6a2ac",
      "created_at" : "2021-05-24T13:42:49Z",
      "diff_hunk" : "@@ -36,27 +36,40 @@ def run_test(self):\n         self.restart_node(1, ['-whitelist=127.0.0.1'])\n         self.connect_nodes(0, 1)\n         peerinfo = self.nodes[1].getpeerinfo()[0]\n-        assert('noban' in peerinfo['permissions'])\n+        assert \"noban\" in peerinfo[\"permissions\"]\n \n         # If we remove the ban, Node 0 should be able to reconnect even without noban permission\n         self.nodes[1].setban(\"127.0.0.1\", \"remove\")\n         self.restart_node(1, [])\n         self.connect_nodes(0, 1)\n         peerinfo = self.nodes[1].getpeerinfo()[0]\n-        assert(not 'noban' in peerinfo['permissions'])\n+        assert not \"noban\" in peerinfo[\"permissions\"]\n \n         self.log.info(\"Test that a non-IP address can be banned/unbanned\")\n         node = self.nodes[1]\n         tor_addr = \"pg6mmjiyjmcrsslvykfwnntlaru7p5svn6y2ymmju6nubxndf4pscryd.onion\"\n         ip_addr = \"1.2.3.4\"\n-        assert(not self.is_banned(node, tor_addr))\n-        assert(not self.is_banned(node, ip_addr))\n+        assert not self.is_banned(node, tor_addr)\n+        assert not self.is_banned(node, ip_addr)\n+\n         node.setban(tor_addr, \"add\")\n-        assert(self.is_banned(node, tor_addr))\n-        assert(not self.is_banned(node, ip_addr))\n+        assert self.is_banned(node, tor_addr)\n+        assert not self.is_banned(node, ip_addr)\n+\n+        # Test that the ban list is preserved through restart.\n+\n+        self.restart_node(1)\n+        assert self.is_banned(node, tor_addr)\n+        assert not self.is_banned(node, ip_addr)\n+\n         node.setban(tor_addr, \"remove\")\n-        assert(not self.is_banned(self.nodes[1], tor_addr))\n-        assert(not self.is_banned(node, ip_addr))\n+        assert not self.is_banned(self.nodes[1], tor_addr)\n+        assert not self.is_banned(node, ip_addr)\n+\n+        self.restart_node(1)\n+        assert not self.is_banned(self.nodes[1], tor_addr)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r637954472",
      "id" : 637954472,
      "in_reply_to_id" : 637953866,
      "line" : 70,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNzk1NDQ3Mg==",
      "original_commit_id" : "88b843e49c84e331e40bfbe249269deaf2a6a2ac",
      "original_line" : 70,
      "original_position" : 52,
      "original_start_line" : 66,
      "path" : "test/functional/rpc_setban.py",
      "position" : 52,
      "pull_request_review_id" : 666749019,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : 66,
      "start_side" : "RIGHT",
      "updated_at" : "2021-05-24T13:50:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/637954472",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-06-11T01:41:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-859198356",
      "id" : 859198356,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg1OTE5ODM1Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-11T01:41:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/859198356",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`88b843e49c...4b52c7234f`: rebase due to conflicts\r\n\r\nrelease notes in https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-847001828",
      "created_at" : "2021-06-14T12:02:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-860629340",
      "id" : 860629340,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2MDYyOTM0MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-14T12:02:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/860629340",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Did a bunch of manual testing and updated my ACK above.",
      "created_at" : "2021-06-14T15:19:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-860770280",
      "id" : 860770280,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2MDc3MDI4MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-14T15:19:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/860770280",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> - The list of banned hosts and networks (via `setban` RPC) is now saved on disk\r\n>   in JSON format in `banlist.json` instead of `banlist.dat`. `banlist.dat` is\r\n>   only read on startup if `banlist.json` is not present. Changes are only\r\n>   written to the new `banlist.json`. A future version of Bitcoin Core may\r\n>   completely ignore `banlist.dat`. (#20966)\r\n\r\nRegarding the release note, peers may be banned and unbanned via the GUI peers window in addition to the setban RPC. As mentioned in my previous comment, it may be a good idea to describe user gotchas and best practices for upgrading and downgrading.",
      "created_at" : "2021-06-14T15:22:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-860772236",
      "id" : 860772236,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2MDc3MjIzNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-15T04:05:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/860772236",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 4b52c7234f3c2e3067d7d6c6fd7ebf2b96bb8a45\r\n\r\nI think it would be useful to make the code ignore future version numbers, so it will not completely wipe banlists on downgrading (from future versions that introduce additional features to this format), but that can be done later.",
      "created_at" : "2021-06-15T03:59:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-861150204",
      "id" : 861150204,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2MTE1MDIwNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-15T03:59:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/861150204",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-06-17T17:46:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-863437409",
      "id" : 863437409,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2MzQzNzQwOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-17T17:46:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/863437409",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`4b52c7234f...5fcc96457d`: rebase due to conflicts",
      "created_at" : "2021-06-21T13:31:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-865035904",
      "id" : 865035904,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2NTAzNTkwNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-21T13:31:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/865035904",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`5fcc96457d...bb719a08db`: minor tweaks in `rpc_setban.py` - log a message and use `node` instead of `self.nodes[1]`",
      "created_at" : "2021-06-21T13:33:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-865037181",
      "id" : 865037181,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2NTAzNzE4MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-21T13:33:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/865037181",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r655381856"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/655381856"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Added the log message and changed to `node` in the second one, but left the first one as that line is not modified by this PR.",
      "commit_id" : "bb719a08db173a753984a04534de6f148b87b17a",
      "created_at" : "2021-06-21T13:35:41Z",
      "diff_hunk" : "@@ -36,27 +36,40 @@ def run_test(self):\n         self.restart_node(1, ['-whitelist=127.0.0.1'])\n         self.connect_nodes(0, 1)\n         peerinfo = self.nodes[1].getpeerinfo()[0]\n-        assert('noban' in peerinfo['permissions'])\n+        assert \"noban\" in peerinfo[\"permissions\"]\n \n         # If we remove the ban, Node 0 should be able to reconnect even without noban permission\n         self.nodes[1].setban(\"127.0.0.1\", \"remove\")\n         self.restart_node(1, [])\n         self.connect_nodes(0, 1)\n         peerinfo = self.nodes[1].getpeerinfo()[0]\n-        assert(not 'noban' in peerinfo['permissions'])\n+        assert not \"noban\" in peerinfo[\"permissions\"]\n \n         self.log.info(\"Test that a non-IP address can be banned/unbanned\")\n         node = self.nodes[1]\n         tor_addr = \"pg6mmjiyjmcrsslvykfwnntlaru7p5svn6y2ymmju6nubxndf4pscryd.onion\"\n         ip_addr = \"1.2.3.4\"\n-        assert(not self.is_banned(node, tor_addr))\n-        assert(not self.is_banned(node, ip_addr))\n+        assert not self.is_banned(node, tor_addr)\n+        assert not self.is_banned(node, ip_addr)\n+\n         node.setban(tor_addr, \"add\")\n-        assert(self.is_banned(node, tor_addr))\n-        assert(not self.is_banned(node, ip_addr))\n+        assert self.is_banned(node, tor_addr)\n+        assert not self.is_banned(node, ip_addr)\n+\n+        # Test that the ban list is preserved through restart.\n+\n+        self.restart_node(1)\n+        assert self.is_banned(node, tor_addr)\n+        assert not self.is_banned(node, ip_addr)\n+\n         node.setban(tor_addr, \"remove\")\n-        assert(not self.is_banned(self.nodes[1], tor_addr))\n-        assert(not self.is_banned(node, ip_addr))\n+        assert not self.is_banned(self.nodes[1], tor_addr)\n+        assert not self.is_banned(node, ip_addr)\n+\n+        self.restart_node(1)\n+        assert not self.is_banned(self.nodes[1], tor_addr)\n+        assert not self.is_banned(node, ip_addr)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r655381856",
      "id" : 655381856,
      "in_reply_to_id" : 637932195,
      "line" : 71,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1NTM4MTg1Ng==",
      "original_commit_id" : "88b843e49c84e331e40bfbe249269deaf2a6a2ac",
      "original_line" : 71,
      "original_position" : 53,
      "original_start_line" : null,
      "path" : "test/functional/rpc_setban.py",
      "position" : 53,
      "pull_request_review_id" : 688430476,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-21T13:35:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/655381856",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review re-ACK bb719a08db173a753984a04534de6f148b87b17a per `git range-diff 6a67366 4b52c72 bb719a0`",
      "created_at" : "2021-06-21T14:10:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-865064475",
      "id" : 865064475,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2NTA2NDQ3NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-21T14:10:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/865064475",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code Review ACK bb719a08db173a753984a04534de6f148b87b17a",
      "created_at" : "2021-06-22T22:43:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-866384961",
      "id" : 866384961,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2NjM4NDk2MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-22T22:43:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/866384961",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Removed from backport, but if someone wants to backport, it will need to be done together with https://github.com/bitcoin/bitcoin/pull/20852#issuecomment-866610187",
      "created_at" : "2021-06-23T08:08:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-866625710",
      "id" : 866625710,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2NjYyNTcxMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-23T08:08:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/866625710",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Added to release notes: https://github.com/bitcoin-core/bitcoin-devwiki/wiki/22.0-Release-Notes-draft/_history",
      "created_at" : "2021-06-23T08:15:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-866630110",
      "id" : 866630110,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2NjYzMDExMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-23T08:15:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/866630110",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
