{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "USDTs are tracepoints and behave similar to trace logging (no performance impact if not used), but can pass data into scripts running in a Linux kernel VM for collection and further evaluation. The required build system changes and a tracing framework for User Static Defined Traces (USDTs) were merged in #19866 and some additional discussion took place in https://github.com/bitcoin/bitcoin/pull/20960. Simpler scripts, such as collecting and printing metrics as histogram, can be created with the [bpftrace](https://github.com/iovisor/bpftrace) tool. Complexer [bcc](https://github.com/iovisor/bcc) scripts are written in C and loaded into the kernel with, for example, the bcc Python module where the passed data can be processed.\r\n\r\nFollowing the [core-dev-meeting discussion](https://bitcoin.jonasschnelli.ch/ircmeetings/logs/bitcoin-core-dev/2021/bitcoin-core-dev.2021-01-21-19.00.moin.txt) on 21st Jan 2021, the goal here is to list potentially interesting USDTs and what data they should pass. The USDT should have:\r\n1. a clear use-case and motivation\r\n2. a semi-stable API (order of arguments don't change so people can rely on these for scripting)\r\n3. no expensive operations added specifically for this USDT (no parsing, serialization, ... - just passing of already avaliable data)\r\n4. a documentation in `docs/tracing.md`\r\n5. (ideally) a usage example as bftrace or bcc script\r\n6. (need to double check this) a maximum of 512 bytes passed (max stack size in bpftrace)\r\n\r\nWhile some kind of testing of the USDT examples would be good, root privileges are required to load programs in the kernel VM. Might still be possible to run them in a CI, though?\r\n\r\n**What could be useful USDTs? What data should they pass? Where should they be placed in the code?**\r\n\r\n---\r\n_I'll add some already discussed USDT candidates as comments later_ ",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 0,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20981/comments",
   "created_at" : "2021-01-21T19:49:58Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20981/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/20981",
   "id" : 791446055,
   "labels" : [
      {
         "color" : "7cf575",
         "default" : false,
         "description" : null,
         "id" : 64583,
         "name" : "Feature",
         "node_id" : "MDU6TGFiZWw2NDU4Mw==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Feature"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20981/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDU6SXNzdWU3OTE0NDYwNTU=",
   "number" : 20981,
   "performed_via_github_app" : null,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "Discussion: Potential USDTs (User Static Defined Traces) for Core ",
   "updated_at" : "2021-01-21T19:52:40Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20981",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
      "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
      "followers_url" : "https://api.github.com/users/0xB10C/followers",
      "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
      "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/0xB10C",
      "id" : 19157360,
      "login" : "0xB10C",
      "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
      "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
      "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
      "repos_url" : "https://api.github.com/users/0xB10C/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/0xB10C"
   }
}
