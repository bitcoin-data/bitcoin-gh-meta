[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Next set of patches from #20758 -- should be straightforward to review hopefully.",
      "created_at" : "2021-01-15T08:35:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20942#issuecomment-760753399",
      "id" : 760753399,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20942",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MDc1MzM5OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-15T08:35:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/760753399",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #21162 (Net Processing: Move RelayTransaction() into PeerManager by jnewbery)\n* #21160 (Net/Net processing: Move tx inventory into net_processing by jnewbery)\n* #20925 (RFC: Move Peer and PeerManagerImpl declarations to separate header by jnewbery)\n* #20799 (net processing: Only support version 2 compact blocks by jnewbery)\n* #20729 (p2p: standardize outbound full/block relay connection type naming by jonatack)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-01-15T15:04:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20942#issuecomment-760993809",
      "id" : 760993809,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20942",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MDk5MzgwOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-12T23:33:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/760993809",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20942#discussion_r559495985"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20942"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559495985"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You're renaming the other data members as you move them into `PeerManagerImpl`. Perhaps rename this to `m_sync_started`?",
      "commit_id" : "6452190841f8da1cdaf899d064974136ab37659f",
      "created_at" : "2021-01-18T11:21:38Z",
      "diff_hunk" : "@@ -345,10 +353,7 @@ class PeerManagerImpl final : public PeerManager\n      * their own locks.\n      */\n     std::map<NodeId, PeerRef> m_peer_map GUARDED_BY(m_peer_mutex);\n-};\n-} // namespace\n \n-namespace {\n     /** Number of nodes with fSyncStarted. */\n     int nSyncStarted GUARDED_BY(cs_main) = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20942#discussion_r559495985",
      "id" : 559495985,
      "line" : 358,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTQ5NTk4NQ==",
      "original_commit_id" : "a3ef94957be28d1b94ee0a34e015b39e60895e0d",
      "original_line" : 358,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 24,
      "pull_request_review_id" : 570398764,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20942",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-29T16:52:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559495985",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20942#discussion_r559496221"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20942"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559496221"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Perhaps rename this to `m_block_sources`?",
      "commit_id" : "6452190841f8da1cdaf899d064974136ab37659f",
      "created_at" : "2021-01-18T11:22:09Z",
      "diff_hunk" : "@@ -360,6 +365,14 @@ namespace {\n      */\n     std::map<uint256, std::pair<NodeId, bool>> mapBlockSource GUARDED_BY(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20942#discussion_r559496221",
      "id" : 559496221,
      "line" : 366,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTQ5NjIyMQ==",
      "original_commit_id" : "a3ef94957be28d1b94ee0a34e015b39e60895e0d",
      "original_line" : 366,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 28,
      "pull_request_review_id" : 570398764,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20942",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-29T16:52:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559496221",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20942#discussion_r559500293"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20942"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559500293"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Since you're already renaming this, consider dropping the outdated cs naming. Perhaps `m_recent_confirmed_transactions_mutex`?",
      "commit_id" : "6452190841f8da1cdaf899d064974136ab37659f",
      "created_at" : "2021-01-18T11:29:33Z",
      "diff_hunk" : "@@ -402,42 +415,44 @@ namespace {\n      * We use this to avoid requesting transactions that have already been\n      * confirnmed.\n      */\n-    Mutex g_cs_recent_confirmed_transactions;\n-    std::unique_ptr<CRollingBloomFilter> g_recent_confirmed_transactions GUARDED_BY(g_cs_recent_confirmed_transactions);\n-\n-    /** Blocks that are in flight, and that are in the queue to be downloaded. */\n-    struct QueuedBlock {\n-        uint256 hash;\n-        const CBlockIndex* pindex;                               //!< Optional.\n-        bool fValidatedHeaders;                                  //!< Whether this block has validated headers at the time of request.\n-        std::unique_ptr<PartiallyDownloadedBlock> partialBlock;  //!< Optional, used for CMPCTBLOCK downloads\n-    };\n-    std::map<uint256, std::pair<NodeId, std::list<QueuedBlock>::iterator> > mapBlocksInFlight GUARDED_BY(cs_main);\n-\n-    /** Stack of nodes which we have set to announce using compact blocks */\n-    std::list<NodeId> lNodesAnnouncingHeaderAndIDs GUARDED_BY(cs_main);\n-\n-    /** Number of preferable block download peers. */\n-    int nPreferredDownload GUARDED_BY(cs_main) = 0;\n-\n-    /** Number of peers from which we're downloading blocks. */\n-    int nPeersWithValidatedDownloads GUARDED_BY(cs_main) = 0;\n+    Mutex m_cs_recent_confirmed_transactions;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20942#discussion_r559500293",
      "id" : 559500293,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTUwMDI5Mw==",
      "original_commit_id" : "a3ef94957be28d1b94ee0a34e015b39e60895e0d",
      "original_line" : 418,
      "original_position" : 65,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 570398764,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20942",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-29T16:52:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559500293",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20942#discussion_r559504329"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20942"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559504329"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Move the function comments to the declarations now that these are declared separately from the function definition.",
      "commit_id" : "6452190841f8da1cdaf899d064974136ab37659f",
      "created_at" : "2021-01-18T11:36:59Z",
      "diff_hunk" : "@@ -402,42 +415,44 @@ namespace {\n      * We use this to avoid requesting transactions that have already been\n      * confirnmed.\n      */\n-    Mutex g_cs_recent_confirmed_transactions;\n-    std::unique_ptr<CRollingBloomFilter> g_recent_confirmed_transactions GUARDED_BY(g_cs_recent_confirmed_transactions);\n-\n-    /** Blocks that are in flight, and that are in the queue to be downloaded. */\n-    struct QueuedBlock {\n-        uint256 hash;\n-        const CBlockIndex* pindex;                               //!< Optional.\n-        bool fValidatedHeaders;                                  //!< Whether this block has validated headers at the time of request.\n-        std::unique_ptr<PartiallyDownloadedBlock> partialBlock;  //!< Optional, used for CMPCTBLOCK downloads\n-    };\n-    std::map<uint256, std::pair<NodeId, std::list<QueuedBlock>::iterator> > mapBlocksInFlight GUARDED_BY(cs_main);\n-\n-    /** Stack of nodes which we have set to announce using compact blocks */\n-    std::list<NodeId> lNodesAnnouncingHeaderAndIDs GUARDED_BY(cs_main);\n-\n-    /** Number of preferable block download peers. */\n-    int nPreferredDownload GUARDED_BY(cs_main) = 0;\n-\n-    /** Number of peers from which we're downloading blocks. */\n-    int nPeersWithValidatedDownloads GUARDED_BY(cs_main) = 0;\n+    Mutex m_cs_recent_confirmed_transactions;\n+    std::unique_ptr<CRollingBloomFilter> m_recent_confirmed_transactions GUARDED_BY(m_cs_recent_confirmed_transactions);\n \n-    /** Number of peers with wtxid relay. */\n-    int g_wtxid_relay_peers GUARDED_BY(cs_main) = 0;\n+    bool MarkBlockAsReceived(const uint256& hash) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+    bool MarkBlockAsInFlight(NodeId nodeid, const uint256& hash, const CBlockIndex* pindex = nullptr, std::list<QueuedBlock>::iterator** pit = nullptr) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+    bool TipMayBeStale() EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+    void FindNextBlocksToDownload(NodeId nodeid, unsigned int count, std::vector<const CBlockIndex*>& vBlocks, NodeId& nodeStaller) EXCLUSIVE_LOCKS_REQUIRED(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20942#discussion_r559504329",
      "id" : 559504329,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTUwNDMyOQ==",
      "original_commit_id" : "a3ef94957be28d1b94ee0a34e015b39e60895e0d",
      "original_line" : 437,
      "original_position" : 73,
      "original_start_line" : 421,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 570398764,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20942",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-01-29T16:52:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559504329",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20942#discussion_r559506033"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20942"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559506033"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Now that `m_last_tip_update` isn't a global and can be initialized at the time that `PeerManagerImpl` is constructed, consider initializing it to `GetTime()` in the initializer list and removing this special casing.",
      "commit_id" : "6452190841f8da1cdaf899d064974136ab37659f",
      "created_at" : "2021-01-18T11:40:03Z",
      "diff_hunk" : "@@ -750,13 +765,14 @@ static void MaybeSetPeerAsAnnouncingHeaderAndIDs(NodeId nodeid, CConnman& connma\n     }\n }\n \n-static bool TipMayBeStale(const Consensus::Params &consensusParams) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+bool PeerManagerImpl::TipMayBeStale() EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n {\n     AssertLockHeld(cs_main);\n-    if (g_last_tip_update == 0) {\n-        g_last_tip_update = GetTime();\n+    const Consensus::Params& consensusParams = m_chainparams.GetConsensus();\n+    if (m_last_tip_update == 0) {\n+        m_last_tip_update = GetTime();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20942#discussion_r559506033",
      "id" : 559506033,
      "line" : 786,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTUwNjAzMw==",
      "original_commit_id" : "a3ef94957be28d1b94ee0a34e015b39e60895e0d",
      "original_line" : 786,
      "original_position" : 185,
      "original_start_line" : 772,
      "path" : "src/net_processing.cpp",
      "position" : 215,
      "pull_request_review_id" : 570398764,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20942",
      "side" : "RIGHT",
      "start_line" : 785,
      "start_side" : "RIGHT",
      "updated_at" : "2021-01-29T16:52:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559506033",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20942#discussion_r559507511"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20942"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559507511"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Move function comment to the declaration.",
      "commit_id" : "6452190841f8da1cdaf899d064974136ab37659f",
      "created_at" : "2021-01-18T11:42:44Z",
      "diff_hunk" : "@@ -402,42 +415,44 @@ namespace {\n      * We use this to avoid requesting transactions that have already been\n      * confirnmed.\n      */\n-    Mutex g_cs_recent_confirmed_transactions;\n-    std::unique_ptr<CRollingBloomFilter> g_recent_confirmed_transactions GUARDED_BY(g_cs_recent_confirmed_transactions);\n-\n-    /** Blocks that are in flight, and that are in the queue to be downloaded. */\n-    struct QueuedBlock {\n-        uint256 hash;\n-        const CBlockIndex* pindex;                               //!< Optional.\n-        bool fValidatedHeaders;                                  //!< Whether this block has validated headers at the time of request.\n-        std::unique_ptr<PartiallyDownloadedBlock> partialBlock;  //!< Optional, used for CMPCTBLOCK downloads\n-    };\n-    std::map<uint256, std::pair<NodeId, std::list<QueuedBlock>::iterator> > mapBlocksInFlight GUARDED_BY(cs_main);\n-\n-    /** Stack of nodes which we have set to announce using compact blocks */\n-    std::list<NodeId> lNodesAnnouncingHeaderAndIDs GUARDED_BY(cs_main);\n-\n-    /** Number of preferable block download peers. */\n-    int nPreferredDownload GUARDED_BY(cs_main) = 0;\n-\n-    /** Number of peers from which we're downloading blocks. */\n-    int nPeersWithValidatedDownloads GUARDED_BY(cs_main) = 0;\n+    Mutex m_cs_recent_confirmed_transactions;\n+    std::unique_ptr<CRollingBloomFilter> m_recent_confirmed_transactions GUARDED_BY(m_cs_recent_confirmed_transactions);\n \n-    /** Number of peers with wtxid relay. */\n-    int g_wtxid_relay_peers GUARDED_BY(cs_main) = 0;\n+    bool MarkBlockAsReceived(const uint256& hash) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+    bool MarkBlockAsInFlight(NodeId nodeid, const uint256& hash, const CBlockIndex* pindex = nullptr, std::list<QueuedBlock>::iterator** pit = nullptr) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+    bool TipMayBeStale() EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+    void FindNextBlocksToDownload(NodeId nodeid, unsigned int count, std::vector<const CBlockIndex*>& vBlocks, NodeId& nodeStaller) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n-    /** Number of outbound peers with m_chain_sync.m_protect. */\n-    int g_outbound_peers_with_protect_from_disconnect GUARDED_BY(cs_main) = 0;\n+    std::map<uint256, std::pair<NodeId, std::list<QueuedBlock>::iterator> > mapBlocksInFlight GUARDED_BY(cs_main);\n \n     /** When our tip was last updated. */\n-    std::atomic<int64_t> g_last_tip_update(0);\n+    std::atomic<int64_t> m_last_tip_update{0};\n+\n+    CTransactionRef FindTxForGetData(const CNode& peer, const GenTxid& gtxid, const std::chrono::seconds mempool_req, const std::chrono::seconds now) LOCKS_EXCLUDED(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20942#discussion_r559507511",
      "id" : 559507511,
      "line" : 445,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTUwNzUxMQ==",
      "original_commit_id" : "a3ef94957be28d1b94ee0a34e015b39e60895e0d",
      "original_line" : 445,
      "original_position" : 83,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 94,
      "pull_request_review_id" : 570398764,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20942",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-29T16:52:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559507511",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-01-29T08:11:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20942#issuecomment-769649828",
      "id" : 769649828,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20942",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2OTY0OTgyOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-29T08:11:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/769649828",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20942#discussion_r566919793"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20942"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566919793"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm only renaming the ones that are currently marked `g_` since that would be wrong once they're no longer global. I'm avoiding renaming the others because that's unnecessary churn.\r\n\r\nI think all of them are `GUARDED_BY(cs_main)` so renaming them at the same time as switching them to a new mutex would make sense -- that's the point at which you need to be reviewing every place the variable is touched to ensure the locking makes sense, so having every place the variable is touched show up in the diff because it's getting renamed would make sense.",
      "commit_id" : "6452190841f8da1cdaf899d064974136ab37659f",
      "created_at" : "2021-01-29T15:56:37Z",
      "diff_hunk" : "@@ -345,10 +353,7 @@ class PeerManagerImpl final : public PeerManager\n      * their own locks.\n      */\n     std::map<NodeId, PeerRef> m_peer_map GUARDED_BY(m_peer_mutex);\n-};\n-} // namespace\n \n-namespace {\n     /** Number of nodes with fSyncStarted. */\n     int nSyncStarted GUARDED_BY(cs_main) = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20942#discussion_r566919793",
      "id" : 566919793,
      "in_reply_to_id" : 559495985,
      "line" : 358,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjkxOTc5Mw==",
      "original_commit_id" : "a3ef94957be28d1b94ee0a34e015b39e60895e0d",
      "original_line" : 358,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 24,
      "pull_request_review_id" : 579388462,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20942",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-29T16:52:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566919793",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20942#discussion_r566920079"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20942"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566920079"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Sure, makes sense.",
      "commit_id" : "6452190841f8da1cdaf899d064974136ab37659f",
      "created_at" : "2021-01-29T15:57:00Z",
      "diff_hunk" : "@@ -402,42 +415,44 @@ namespace {\n      * We use this to avoid requesting transactions that have already been\n      * confirnmed.\n      */\n-    Mutex g_cs_recent_confirmed_transactions;\n-    std::unique_ptr<CRollingBloomFilter> g_recent_confirmed_transactions GUARDED_BY(g_cs_recent_confirmed_transactions);\n-\n-    /** Blocks that are in flight, and that are in the queue to be downloaded. */\n-    struct QueuedBlock {\n-        uint256 hash;\n-        const CBlockIndex* pindex;                               //!< Optional.\n-        bool fValidatedHeaders;                                  //!< Whether this block has validated headers at the time of request.\n-        std::unique_ptr<PartiallyDownloadedBlock> partialBlock;  //!< Optional, used for CMPCTBLOCK downloads\n-    };\n-    std::map<uint256, std::pair<NodeId, std::list<QueuedBlock>::iterator> > mapBlocksInFlight GUARDED_BY(cs_main);\n-\n-    /** Stack of nodes which we have set to announce using compact blocks */\n-    std::list<NodeId> lNodesAnnouncingHeaderAndIDs GUARDED_BY(cs_main);\n-\n-    /** Number of preferable block download peers. */\n-    int nPreferredDownload GUARDED_BY(cs_main) = 0;\n-\n-    /** Number of peers from which we're downloading blocks. */\n-    int nPeersWithValidatedDownloads GUARDED_BY(cs_main) = 0;\n+    Mutex m_cs_recent_confirmed_transactions;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20942#discussion_r566920079",
      "id" : 566920079,
      "in_reply_to_id" : 559500293,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjkyMDA3OQ==",
      "original_commit_id" : "a3ef94957be28d1b94ee0a34e015b39e60895e0d",
      "original_line" : 418,
      "original_position" : 65,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 579388834,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20942",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-29T16:52:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566920079",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20942#discussion_r566940719"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20942"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566940719"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "That seems like a good idea -- I think it'd let you mark `TipMayBeStale` as a const method as well; but I think it goes beyond the mechanical code shuffling that the rest of this PR does.",
      "commit_id" : "6452190841f8da1cdaf899d064974136ab37659f",
      "created_at" : "2021-01-29T16:27:32Z",
      "diff_hunk" : "@@ -750,13 +765,14 @@ static void MaybeSetPeerAsAnnouncingHeaderAndIDs(NodeId nodeid, CConnman& connma\n     }\n }\n \n-static bool TipMayBeStale(const Consensus::Params &consensusParams) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+bool PeerManagerImpl::TipMayBeStale() EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n {\n     AssertLockHeld(cs_main);\n-    if (g_last_tip_update == 0) {\n-        g_last_tip_update = GetTime();\n+    const Consensus::Params& consensusParams = m_chainparams.GetConsensus();\n+    if (m_last_tip_update == 0) {\n+        m_last_tip_update = GetTime();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20942#discussion_r566940719",
      "id" : 566940719,
      "in_reply_to_id" : 559506033,
      "line" : 786,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Njk0MDcxOQ==",
      "original_commit_id" : "a3ef94957be28d1b94ee0a34e015b39e60895e0d",
      "original_line" : 786,
      "original_position" : 185,
      "original_start_line" : 772,
      "path" : "src/net_processing.cpp",
      "position" : 215,
      "pull_request_review_id" : 579417053,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20942",
      "side" : "RIGHT",
      "start_line" : 785,
      "start_side" : "RIGHT",
      "updated_at" : "2021-01-29T16:52:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566940719",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased, addressed some of @jnewbery's comments. There's still more stuff coming from #20758 so will leave reorganising PeerManagerImpl declaration until later.",
      "created_at" : "2021-01-29T16:55:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20942#issuecomment-769922909",
      "id" : 769922909,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20942",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2OTkyMjkwOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-29T16:55:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/769922909",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20942#discussion_r570180374"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20942"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570180374"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This (and the comment for `MarkBlockAsInFlight()`) won't get picked up by doxygen without the `/**` comment marker (https://www.doxygen.nl/manual/docblocks.html)",
      "commit_id" : "6452190841f8da1cdaf899d064974136ab37659f",
      "created_at" : "2021-02-04T12:21:20Z",
      "diff_hunk" : "@@ -402,42 +415,65 @@ namespace {\n      * We use this to avoid requesting transactions that have already been\n      * confirnmed.\n      */\n-    Mutex g_cs_recent_confirmed_transactions;\n-    std::unique_ptr<CRollingBloomFilter> g_recent_confirmed_transactions GUARDED_BY(g_cs_recent_confirmed_transactions);\n-\n-    /** Blocks that are in flight, and that are in the queue to be downloaded. */\n-    struct QueuedBlock {\n-        uint256 hash;\n-        const CBlockIndex* pindex;                               //!< Optional.\n-        bool fValidatedHeaders;                                  //!< Whether this block has validated headers at the time of request.\n-        std::unique_ptr<PartiallyDownloadedBlock> partialBlock;  //!< Optional, used for CMPCTBLOCK downloads\n-    };\n-    std::map<uint256, std::pair<NodeId, std::list<QueuedBlock>::iterator> > mapBlocksInFlight GUARDED_BY(cs_main);\n+    Mutex m_recent_confirmed_transactions_mutex;\n+    std::unique_ptr<CRollingBloomFilter> m_recent_confirmed_transactions GUARDED_BY(m_recent_confirmed_transactions_mutex);\n \n-    /** Stack of nodes which we have set to announce using compact blocks */\n-    std::list<NodeId> lNodesAnnouncingHeaderAndIDs GUARDED_BY(cs_main);\n+    /* Returns a bool indicating whether we requested this block.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20942#discussion_r570180374",
      "id" : 570180374,
      "line" : 421,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDE4MDM3NA==",
      "original_commit_id" : "6452190841f8da1cdaf899d064974136ab37659f",
      "original_line" : 421,
      "original_position" : 61,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 61,
      "pull_request_review_id" : 583335393,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20942",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-04T12:27:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570180374",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20942#discussion_r570185059"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20942"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570185059"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ok!",
      "commit_id" : "6452190841f8da1cdaf899d064974136ab37659f",
      "created_at" : "2021-02-04T12:29:08Z",
      "diff_hunk" : "@@ -345,10 +353,7 @@ class PeerManagerImpl final : public PeerManager\n      * their own locks.\n      */\n     std::map<NodeId, PeerRef> m_peer_map GUARDED_BY(m_peer_mutex);\n-};\n-} // namespace\n \n-namespace {\n     /** Number of nodes with fSyncStarted. */\n     int nSyncStarted GUARDED_BY(cs_main) = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20942#discussion_r570185059",
      "id" : 570185059,
      "in_reply_to_id" : 559495985,
      "line" : 358,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDE4NTA1OQ==",
      "original_commit_id" : "a3ef94957be28d1b94ee0a34e015b39e60895e0d",
      "original_line" : 358,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 24,
      "pull_request_review_id" : 583341481,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20942",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-04T12:29:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570185059",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20942#discussion_r570185597"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20942"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570185597"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yep, fine to leave this. There's plenty more to be cleaned up after this PR.",
      "commit_id" : "6452190841f8da1cdaf899d064974136ab37659f",
      "created_at" : "2021-02-04T12:30:00Z",
      "diff_hunk" : "@@ -750,13 +765,14 @@ static void MaybeSetPeerAsAnnouncingHeaderAndIDs(NodeId nodeid, CConnman& connma\n     }\n }\n \n-static bool TipMayBeStale(const Consensus::Params &consensusParams) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+bool PeerManagerImpl::TipMayBeStale() EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n {\n     AssertLockHeld(cs_main);\n-    if (g_last_tip_update == 0) {\n-        g_last_tip_update = GetTime();\n+    const Consensus::Params& consensusParams = m_chainparams.GetConsensus();\n+    if (m_last_tip_update == 0) {\n+        m_last_tip_update = GetTime();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20942#discussion_r570185597",
      "id" : 570185597,
      "in_reply_to_id" : 559506033,
      "line" : 786,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDE4NTU5Nw==",
      "original_commit_id" : "a3ef94957be28d1b94ee0a34e015b39e60895e0d",
      "original_line" : 786,
      "original_position" : 185,
      "original_start_line" : 772,
      "path" : "src/net_processing.cpp",
      "position" : 215,
      "pull_request_review_id" : 583342184,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20942",
      "side" : "RIGHT",
      "start_line" : 785,
      "start_side" : "RIGHT",
      "updated_at" : "2021-02-04T12:30:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570185597",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20942#discussion_r570955961"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20942"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570955961"
         }
      },
      "author_association" : "MEMBER",
      "body" : "eeac506\r\n\r\nI don't know if we have code guidelines on this but maybe move this method at the bottom of the other ones instead of among variables members. \r\n\r\nAlso maybe add a small comment \"Check if we have already seen this transaction by looking up its identifier among reject filter, orphan pool, recent confirmations and mempool\" ? ",
      "commit_id" : "6452190841f8da1cdaf899d064974136ab37659f",
      "created_at" : "2021-02-05T13:09:37Z",
      "diff_hunk" : "@@ -362,10 +362,9 @@ class PeerManagerImpl final : public PeerManager\n \n     /** Number of outbound peers with m_chain_sync.m_protect. */\n     int m_outbound_peers_with_protect_from_disconnect GUARDED_BY(cs_main) = 0;\n-};\n-} // namespace\n \n-namespace {\n+    bool AlreadyHaveTx(const GenTxid& gtxid, const CTxMemPool& mempool) EXCLUSIVE_LOCKS_REQUIRED(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20942#discussion_r570955961",
      "id" : 570955961,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDk1NTk2MQ==",
      "original_commit_id" : "eeac5062508c98fe58daaec471cdd27f3909b6ec",
      "original_line" : 366,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 584321280,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20942",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T13:47:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570955961",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20942#discussion_r570962958"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20942"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570962958"
         }
      },
      "author_association" : "MEMBER",
      "body" : "a490f0a\r\n\r\n\"Check if our chain is stalling by measuring if a delta of pow targets has been reached since last time of tip update\" ?",
      "commit_id" : "6452190841f8da1cdaf899d064974136ab37659f",
      "created_at" : "2021-02-05T13:22:39Z",
      "diff_hunk" : "@@ -409,19 +417,33 @@ class PeerManagerImpl final : public PeerManager\n      */\n     Mutex m_recent_confirmed_transactions_mutex;\n     std::unique_ptr<CRollingBloomFilter> m_recent_confirmed_transactions GUARDED_BY(m_recent_confirmed_transactions_mutex);\n+\n+    /* Returns a bool indicating whether we requested this block.\n+     * Also used if a block was /not/ received and timed out or started with another peer\n+     */\n+    bool MarkBlockAsReceived(const uint256& hash) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+\n+    /* Mark a block as in flight\n+     * Returns false, still setting pit, if the block was already in flight from the same peer\n+     * pit will only be valid as long as the same cs_main lock is being held\n+     */\n+    bool MarkBlockAsInFlight(CTxMemPool& mempool, NodeId nodeid, const uint256& hash, const CBlockIndex* pindex = nullptr, std::list<QueuedBlock>::iterator** pit = nullptr) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+\n+    bool TipMayBeStale(const Consensus::Params &consensusParams) EXCLUSIVE_LOCKS_REQUIRED(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20942#discussion_r570962958",
      "id" : 570962958,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDk2Mjk1OA==",
      "original_commit_id" : "a490f0a056456d683dd8ef6f89a5af1a13792118",
      "original_line" : 432,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 584321280,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20942",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T13:47:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570962958",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20942#discussion_r570989482"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20942"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570989482"
         }
      },
      "author_association" : "MEMBER",
      "body" : "See discussion here: https://github.com/bitcoin/bitcoin/pull/20942#discussion_r559495985",
      "commit_id" : "6452190841f8da1cdaf899d064974136ab37659f",
      "created_at" : "2021-02-05T14:05:24Z",
      "diff_hunk" : "@@ -362,10 +362,9 @@ class PeerManagerImpl final : public PeerManager\n \n     /** Number of outbound peers with m_chain_sync.m_protect. */\n     int m_outbound_peers_with_protect_from_disconnect GUARDED_BY(cs_main) = 0;\n-};\n-} // namespace\n \n-namespace {\n+    bool AlreadyHaveTx(const GenTxid& gtxid, const CTxMemPool& mempool) EXCLUSIVE_LOCKS_REQUIRED(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20942#discussion_r570989482",
      "id" : 570989482,
      "in_reply_to_id" : 570955961,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDk4OTQ4Mg==",
      "original_commit_id" : "eeac5062508c98fe58daaec471cdd27f3909b6ec",
      "original_line" : 366,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 584366103,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20942",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T14:05:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570989482",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "It would be really nice to get these right before merge:\r\n\r\n* Order of member variables and methods, private and public. I think the [Google C++ Style Guide](https://google.github.io/styleguide/cppguide.html#Declaration_Order) makes perfect sense.\r\n* Member variables naming.\r\n* Proper doxygen comments.\r\n\r\nOtherwise 6452190841f8da1cdaf899d064974136ab37659f looks good.",
      "created_at" : "2021-02-09T17:06:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20942#issuecomment-776091733",
      "id" : 776091733,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20942",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3NjA5MTczMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-09T17:06:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/776091733",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20942#discussion_r574210485"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20942"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/574210485"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Added some text to https://github.com/bitcoin/bitcoin/pull/20758/commits/4f9931df03ac5ea223733abe3909db8c61aa559e ",
      "commit_id" : "6452190841f8da1cdaf899d064974136ab37659f",
      "created_at" : "2021-02-11T01:58:42Z",
      "diff_hunk" : "@@ -409,19 +417,33 @@ class PeerManagerImpl final : public PeerManager\n      */\n     Mutex m_recent_confirmed_transactions_mutex;\n     std::unique_ptr<CRollingBloomFilter> m_recent_confirmed_transactions GUARDED_BY(m_recent_confirmed_transactions_mutex);\n+\n+    /* Returns a bool indicating whether we requested this block.\n+     * Also used if a block was /not/ received and timed out or started with another peer\n+     */\n+    bool MarkBlockAsReceived(const uint256& hash) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+\n+    /* Mark a block as in flight\n+     * Returns false, still setting pit, if the block was already in flight from the same peer\n+     * pit will only be valid as long as the same cs_main lock is being held\n+     */\n+    bool MarkBlockAsInFlight(CTxMemPool& mempool, NodeId nodeid, const uint256& hash, const CBlockIndex* pindex = nullptr, std::list<QueuedBlock>::iterator** pit = nullptr) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+\n+    bool TipMayBeStale(const Consensus::Params &consensusParams) EXCLUSIVE_LOCKS_REQUIRED(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20942#discussion_r574210485",
      "id" : 574210485,
      "in_reply_to_id" : 570962958,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NDIxMDQ4NQ==",
      "original_commit_id" : "a490f0a056456d683dd8ef6f89a5af1a13792118",
      "original_line" : 432,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 588206362,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20942",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-11T01:58:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/574210485",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think this is probably ready for merge. It's a simple refactor and has three ACKs.\r\n\r\n@ajtowns - All three reviewers have asked for sorting members, doxygen comments and renaming data members. I have a small branch that does those things here: https://github.com/jnewbery/bitcoin/tree/pr20942.1. Feel free to take those commits in a follow-up PR.",
      "created_at" : "2021-02-15T10:37:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20942#issuecomment-779129464",
      "id" : 779129464,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20942",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3OTEyOTQ2NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-15T10:37:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/779129464",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "fwiw, I had reviewed until a490f0a056456d683dd8ef6f89a5af1a13792118, so post-merge-ACK the first few commits =P ",
      "created_at" : "2021-02-15T21:59:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20942#issuecomment-779466509",
      "id" : 779466509,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20942",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3OTQ2NjUwOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-15T21:59:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/779466509",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks, d44084883adcf00f50d3d5a9e0c88e3a0b276817 allows me to simplify #20295 a bit.",
      "created_at" : "2021-04-01T09:29:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20942#issuecomment-811781708",
      "id" : 811781708,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20942",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMTc4MTcwOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-01T09:29:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/811781708",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   }
]
