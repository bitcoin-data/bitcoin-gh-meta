[
   {
      "author_association" : "MEMBER",
      "body" : "I'm not entirely sure that this is what we want to do. When I implemented that external input weight feature, I specifically decided to allow user provided weight to override what the wallet does. This is because if a user were using `walletcreatefundedpsbt` or `fundrawtransaction`, it is possible that they are going to use a different signer and are merely using the wallet as a watchonly wallet. We can't know how the other signer is going to behave. Furthermore, with taproot descriptors, and with miniscript coming up soon, the wallet does not necessarily know which script branch is going to be taken and may end up using the wrong script branch when estimating size. By allowing the user to override the size estimation, the user can effectively tell provide a more accurate size estimation depending on the branch taken.",
      "created_at" : "2022-03-23T16:55:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24649#issuecomment-1076570907",
      "id" : 1076570907,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24649",
      "node_id" : "IC_kwDOABII585AKysb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1076570907/reactions"
      },
      "updated_at" : "2022-03-23T16:55:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1076570907",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I believe `input_weights` option always takes precedences and this PR doesn't change it.  Rather it improves precision when `input_weights` option is not provided. ",
      "created_at" : "2022-03-24T07:30:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24649#issuecomment-1077319812",
      "id" : 1077319812,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24649",
      "node_id" : "IC_kwDOABII585ANpiE",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1077319812/reactions"
      },
      "updated_at" : "2022-03-24T07:30:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1077319812",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Oh indeed. Looking at `SelectCoins` again, we only check to see if an output is external after we determine it is not in the wallet. I'm not sure that this PR actually has an effect. Can you provide a test case where the weights end up calculated differently before and after this PR?",
      "created_at" : "2022-03-24T14:27:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24649#issuecomment-1077688427",
      "id" : 1077688427,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24649",
      "node_id" : "IC_kwDOABII585APDhr",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1077688427/reactions"
      },
      "updated_at" : "2022-03-24T14:27:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1077688427",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, but it doesn't do so in `CWallet::DummySignTx`, so `CalculateMaximumSignedTxSize` does produce less precise result, which might cause a lower change than needed. I'll see if I can create a test exposing this issue.",
      "created_at" : "2022-03-29T07:33:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24649#issuecomment-1081517389",
      "id" : 1081517389,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24649",
      "node_id" : "IC_kwDOABII585AdqVN",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1081517389/reactions"
      },
      "updated_at" : "2022-03-29T07:33:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1081517389",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@achow101 added a test case",
      "created_at" : "2022-03-30T07:21:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24649#issuecomment-1082720613",
      "id" : 1082720613,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24649",
      "node_id" : "IC_kwDOABII585AiQFl",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1082720613/reactions"
      },
      "updated_at" : "2022-03-30T07:21:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1082720613",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#25218](https://github.com/bitcoin/bitcoin/pull/25218) (refactor: introduce generic 'Result' classes and connect them to CreateTransaction and GetNewDestination by furszy)\n* [#25118](https://github.com/bitcoin/bitcoin/pull/25118) (wallet: unify âallow/block other inputsâ concept by furszy)\n* [#20892](https://github.com/bitcoin/bitcoin/pull/20892) (tests: Run both descriptor and legacy tests within a single test invocation by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-03-31T05:12:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24649#issuecomment-1084083413",
      "id" : 1084083413,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24649",
      "node_id" : "IC_kwDOABII585AnczV",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1084083413/reactions"
      },
      "updated_at" : "2022-05-29T00:43:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1084083413",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 3b83b8a3b032ee2d730948c538ea66e81875abbb\r\n\r\nThanks for the test case, now I see what the problem is.",
      "created_at" : "2022-04-01T18:22:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24649#issuecomment-1086204768",
      "id" : 1086204768,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24649",
      "node_id" : "IC_kwDOABII585Avitg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1086204768/reactions"
      },
      "updated_at" : "2022-04-01T18:22:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1086204768",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-05-17T12:06:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24649#issuecomment-1128786241",
      "id" : 1128786241,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24649",
      "node_id" : "IC_kwDOABII585DR-lB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1128786241/reactions"
      },
      "updated_at" : "2022-05-17T12:06:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1128786241",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ACK 3b83b8a3b032ee2d730948c538ea66e81875abbb",
      "created_at" : "2022-05-17T15:16:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24649#issuecomment-1128999640",
      "id" : 1128999640,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24649",
      "node_id" : "IC_kwDOABII585DSyrY",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1128999640/reactions"
      },
      "updated_at" : "2022-05-17T15:16:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1128999640",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24649#discussion_r886015377"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24649"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/886015377"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit, if you have to rebase or touch something else:\r\n\r\n```suggestion\r\n        // if it's not in the wallet and corresponding UTXO is found, then select as external output\r\n```",
      "commit_id" : "7832e9438f5c66b88f60676d14e1e11d669eb109",
      "created_at" : "2022-05-31T18:42:26Z",
      "diff_hunk" : "@@ -1018,14 +1018,28 @@ bool FundTransaction(CWallet& wallet, CMutableTransaction& tx, CAmount& nFeeRet,\n \n     coinControl.fAllowOtherInputs = true;\n \n-    for (const CTxIn& txin : tx.vin) {\n-        coinControl.Select(txin.prevout);\n-    }\n-\n     // Acquire the locks to prevent races to the new locked unspents between the\n     // CreateTransaction call and LockCoin calls (when lockUnspents is true).\n     LOCK(wallet.cs_wallet);\n \n+    // Fetch specified UTXOs from the UTXO set to get the scriptPubKeys and values of the outputs being selected\n+    // and to match with the given solving_data. Only used for non-wallet outputs.\n+    std::map<COutPoint, Coin> coins;\n+    for (const CTxIn& txin : tx.vin) {\n+        coins[txin.prevout]; // Create empty map entry keyed by prevout.\n+    }\n+    wallet.chain().findCoins(coins);\n+\n+    for (const CTxIn& txin : tx.vin) {\n+        // if it's not in the wallet and corresponding UTXO is found than select as external output",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24649#discussion_r886015377",
      "id" : 886015377,
      "line" : 1034,
      "node_id" : "PRRC_kwDOABII5840z4WR",
      "original_commit_id" : "7832e9438f5c66b88f60676d14e1e11d669eb109",
      "original_line" : 1034,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 21,
      "pull_request_review_id" : 990984178,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24649",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/886015377/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-31T18:46:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/886015377",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-ACK 7832e9438f5c66b88f60676d14e1e11d669eb109",
      "created_at" : "2022-06-03T21:22:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24649#issuecomment-1146372533",
      "id" : 1146372533,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24649",
      "node_id" : "IC_kwDOABII585EVEG1",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1146372533/reactions"
      },
      "updated_at" : "2022-06-03T21:22:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1146372533",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24649#discussion_r889616160"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24649"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/889616160"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "At this point, we have `cs_wallet` locked (lock is few lines above) and inside `findCoins` we lock `cs_main`\r\n\r\nWonder if it's a potential deadlock cause or not. Because, `cs_main` should be taking precedence over `cs_wallet` in other processes.",
      "commit_id" : "7832e9438f5c66b88f60676d14e1e11d669eb109",
      "created_at" : "2022-06-04T21:11:49Z",
      "diff_hunk" : "@@ -1018,14 +1018,28 @@ bool FundTransaction(CWallet& wallet, CMutableTransaction& tx, CAmount& nFeeRet,\n \n     coinControl.fAllowOtherInputs = true;\n \n-    for (const CTxIn& txin : tx.vin) {\n-        coinControl.Select(txin.prevout);\n-    }\n-\n     // Acquire the locks to prevent races to the new locked unspents between the\n     // CreateTransaction call and LockCoin calls (when lockUnspents is true).\n     LOCK(wallet.cs_wallet);\n \n+    // Fetch specified UTXOs from the UTXO set to get the scriptPubKeys and values of the outputs being selected\n+    // and to match with the given solving_data. Only used for non-wallet outputs.\n+    std::map<COutPoint, Coin> coins;\n+    for (const CTxIn& txin : tx.vin) {\n+        coins[txin.prevout]; // Create empty map entry keyed by prevout.\n+    }\n+    wallet.chain().findCoins(coins);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24649#discussion_r889616160",
      "id" : 889616160,
      "line" : 1031,
      "node_id" : "PRRC_kwDOABII5841Bncg",
      "original_commit_id" : "c3981e379fa088aa7aa03b2f505342a5b3bc3436",
      "original_line" : 1031,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 18,
      "pull_request_review_id" : 995955190,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24649",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/889616160/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-04T21:42:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/889616160",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24649#discussion_r889618423"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24649"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/889618423"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: would be better to use `wallet.GetWalletTx(hash)` instead of accessing the wallet's map directly.",
      "commit_id" : "7832e9438f5c66b88f60676d14e1e11d669eb109",
      "created_at" : "2022-06-04T21:40:35Z",
      "diff_hunk" : "@@ -1018,14 +1018,28 @@ bool FundTransaction(CWallet& wallet, CMutableTransaction& tx, CAmount& nFeeRet,\n \n     coinControl.fAllowOtherInputs = true;\n \n-    for (const CTxIn& txin : tx.vin) {\n-        coinControl.Select(txin.prevout);\n-    }\n-\n     // Acquire the locks to prevent races to the new locked unspents between the\n     // CreateTransaction call and LockCoin calls (when lockUnspents is true).\n     LOCK(wallet.cs_wallet);\n \n+    // Fetch specified UTXOs from the UTXO set to get the scriptPubKeys and values of the outputs being selected\n+    // and to match with the given solving_data. Only used for non-wallet outputs.\n+    std::map<COutPoint, Coin> coins;\n+    for (const CTxIn& txin : tx.vin) {\n+        coins[txin.prevout]; // Create empty map entry keyed by prevout.\n+    }\n+    wallet.chain().findCoins(coins);\n+\n+    for (const CTxIn& txin : tx.vin) {\n+        // if it's not in the wallet and corresponding UTXO is found than select as external output\n+        const auto& outPoint = txin.prevout;\n+        if (wallet.mapWallet.find(outPoint.hash) == wallet.mapWallet.end() && !coins[outPoint].out.IsNull()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24649#discussion_r889618423",
      "id" : 889618423,
      "line" : 1036,
      "node_id" : "PRRC_kwDOABII5841Bn_3",
      "original_commit_id" : "c3981e379fa088aa7aa03b2f505342a5b3bc3436",
      "original_line" : 1036,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 23,
      "pull_request_review_id" : 995955190,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24649",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/889618423/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-04T21:42:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/889618423",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24649#discussion_r893150565"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24649"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893150565"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Agree it could be a problem in theory, but I'd like to understand the problem better before making a change.\r\n\r\nRight now I couldn't find any places in our code that acquire `cs_wallet` while holding `cs_main`. To experiment I added `LOCK(cs_main)` to `wallet/rpc/coins.cpp:197` and immediately this triggered our deadlock detection mechanism because it turns out that `loadwallet` rpc acquires lock in a different order (first `cs_wallet` and then `cs_main`).\r\n\r\nWhat is our long-term direction with regards to using `cs_main` and `cs_wallet` together? \r\n@achow101 any thoughts?\r\n\r\nI'm also curious how we should think of these locks in light of multiprocess (cc @ryanofsky )\r\n",
      "commit_id" : "7832e9438f5c66b88f60676d14e1e11d669eb109",
      "created_at" : "2022-06-09T07:14:50Z",
      "diff_hunk" : "@@ -1018,14 +1018,28 @@ bool FundTransaction(CWallet& wallet, CMutableTransaction& tx, CAmount& nFeeRet,\n \n     coinControl.fAllowOtherInputs = true;\n \n-    for (const CTxIn& txin : tx.vin) {\n-        coinControl.Select(txin.prevout);\n-    }\n-\n     // Acquire the locks to prevent races to the new locked unspents between the\n     // CreateTransaction call and LockCoin calls (when lockUnspents is true).\n     LOCK(wallet.cs_wallet);\n \n+    // Fetch specified UTXOs from the UTXO set to get the scriptPubKeys and values of the outputs being selected\n+    // and to match with the given solving_data. Only used for non-wallet outputs.\n+    std::map<COutPoint, Coin> coins;\n+    for (const CTxIn& txin : tx.vin) {\n+        coins[txin.prevout]; // Create empty map entry keyed by prevout.\n+    }\n+    wallet.chain().findCoins(coins);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24649#discussion_r893150565",
      "id" : 893150565,
      "in_reply_to_id" : 889616160,
      "line" : 1031,
      "node_id" : "PRRC_kwDOABII5841PGVl",
      "original_commit_id" : "c3981e379fa088aa7aa03b2f505342a5b3bc3436",
      "original_line" : 1031,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 18,
      "pull_request_review_id" : 1000830600,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24649",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893150565/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-09T07:14:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893150565",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24649#discussion_r893151534"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24649"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893151534"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "will do if I have to retouch",
      "commit_id" : "7832e9438f5c66b88f60676d14e1e11d669eb109",
      "created_at" : "2022-06-09T07:15:47Z",
      "diff_hunk" : "@@ -1018,14 +1018,28 @@ bool FundTransaction(CWallet& wallet, CMutableTransaction& tx, CAmount& nFeeRet,\n \n     coinControl.fAllowOtherInputs = true;\n \n-    for (const CTxIn& txin : tx.vin) {\n-        coinControl.Select(txin.prevout);\n-    }\n-\n     // Acquire the locks to prevent races to the new locked unspents between the\n     // CreateTransaction call and LockCoin calls (when lockUnspents is true).\n     LOCK(wallet.cs_wallet);\n \n+    // Fetch specified UTXOs from the UTXO set to get the scriptPubKeys and values of the outputs being selected\n+    // and to match with the given solving_data. Only used for non-wallet outputs.\n+    std::map<COutPoint, Coin> coins;\n+    for (const CTxIn& txin : tx.vin) {\n+        coins[txin.prevout]; // Create empty map entry keyed by prevout.\n+    }\n+    wallet.chain().findCoins(coins);\n+\n+    for (const CTxIn& txin : tx.vin) {\n+        // if it's not in the wallet and corresponding UTXO is found than select as external output\n+        const auto& outPoint = txin.prevout;\n+        if (wallet.mapWallet.find(outPoint.hash) == wallet.mapWallet.end() && !coins[outPoint].out.IsNull()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24649#discussion_r893151534",
      "id" : 893151534,
      "in_reply_to_id" : 889618423,
      "line" : 1036,
      "node_id" : "PRRC_kwDOABII5841PGku",
      "original_commit_id" : "c3981e379fa088aa7aa03b2f505342a5b3bc3436",
      "original_line" : 1036,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 23,
      "pull_request_review_id" : 1000832025,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24649",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893151534/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-09T07:15:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893151534",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24649#discussion_r893682487"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24649"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893682487"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`cs_main` is really for things in node operation and so there should never be a scenario within the wallet where we lock `cs_main` before `cs_wallet`. That would imply that the node is doing something to the wallet, but the model we (want to) have is the wallet asks for things from the node and otherwise operates asynchronously from the node. So it should always be `cs_wallet` before `cs_main`.",
      "commit_id" : "7832e9438f5c66b88f60676d14e1e11d669eb109",
      "created_at" : "2022-06-09T15:48:54Z",
      "diff_hunk" : "@@ -1018,14 +1018,28 @@ bool FundTransaction(CWallet& wallet, CMutableTransaction& tx, CAmount& nFeeRet,\n \n     coinControl.fAllowOtherInputs = true;\n \n-    for (const CTxIn& txin : tx.vin) {\n-        coinControl.Select(txin.prevout);\n-    }\n-\n     // Acquire the locks to prevent races to the new locked unspents between the\n     // CreateTransaction call and LockCoin calls (when lockUnspents is true).\n     LOCK(wallet.cs_wallet);\n \n+    // Fetch specified UTXOs from the UTXO set to get the scriptPubKeys and values of the outputs being selected\n+    // and to match with the given solving_data. Only used for non-wallet outputs.\n+    std::map<COutPoint, Coin> coins;\n+    for (const CTxIn& txin : tx.vin) {\n+        coins[txin.prevout]; // Create empty map entry keyed by prevout.\n+    }\n+    wallet.chain().findCoins(coins);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24649#discussion_r893682487",
      "id" : 893682487,
      "in_reply_to_id" : 889616160,
      "line" : 1031,
      "node_id" : "PRRC_kwDOABII5841RIM3",
      "original_commit_id" : "c3981e379fa088aa7aa03b2f505342a5b3bc3436",
      "original_line" : 1031,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 18,
      "pull_request_review_id" : 1001599892,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24649",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893682487/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-09T15:48:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893682487",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24649#discussion_r897626578"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24649"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/897626578"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "@furszy Looks like the current lock order is fine. Is there anything left before you can ACK this?",
      "commit_id" : "7832e9438f5c66b88f60676d14e1e11d669eb109",
      "created_at" : "2022-06-15T07:24:54Z",
      "diff_hunk" : "@@ -1018,14 +1018,28 @@ bool FundTransaction(CWallet& wallet, CMutableTransaction& tx, CAmount& nFeeRet,\n \n     coinControl.fAllowOtherInputs = true;\n \n-    for (const CTxIn& txin : tx.vin) {\n-        coinControl.Select(txin.prevout);\n-    }\n-\n     // Acquire the locks to prevent races to the new locked unspents between the\n     // CreateTransaction call and LockCoin calls (when lockUnspents is true).\n     LOCK(wallet.cs_wallet);\n \n+    // Fetch specified UTXOs from the UTXO set to get the scriptPubKeys and values of the outputs being selected\n+    // and to match with the given solving_data. Only used for non-wallet outputs.\n+    std::map<COutPoint, Coin> coins;\n+    for (const CTxIn& txin : tx.vin) {\n+        coins[txin.prevout]; // Create empty map entry keyed by prevout.\n+    }\n+    wallet.chain().findCoins(coins);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24649#discussion_r897626578",
      "id" : 897626578,
      "in_reply_to_id" : 889616160,
      "line" : 1031,
      "node_id" : "PRRC_kwDOABII5841gLHS",
      "original_commit_id" : "c3981e379fa088aa7aa03b2f505342a5b3bc3436",
      "original_line" : 1031,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 18,
      "pull_request_review_id" : 1006992867,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24649",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/897626578/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-15T07:24:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/897626578",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24649#discussion_r897927815"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24649"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/897927815"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Was thinking on moving the \"fetch coins\" block of code above the `cs_wallet` lock, so both mutexes are locked independently from each other.\r\n\r\nBut, at this point, it's merely a nit.",
      "commit_id" : "7832e9438f5c66b88f60676d14e1e11d669eb109",
      "created_at" : "2022-06-15T12:39:22Z",
      "diff_hunk" : "@@ -1018,14 +1018,28 @@ bool FundTransaction(CWallet& wallet, CMutableTransaction& tx, CAmount& nFeeRet,\n \n     coinControl.fAllowOtherInputs = true;\n \n-    for (const CTxIn& txin : tx.vin) {\n-        coinControl.Select(txin.prevout);\n-    }\n-\n     // Acquire the locks to prevent races to the new locked unspents between the\n     // CreateTransaction call and LockCoin calls (when lockUnspents is true).\n     LOCK(wallet.cs_wallet);\n \n+    // Fetch specified UTXOs from the UTXO set to get the scriptPubKeys and values of the outputs being selected\n+    // and to match with the given solving_data. Only used for non-wallet outputs.\n+    std::map<COutPoint, Coin> coins;\n+    for (const CTxIn& txin : tx.vin) {\n+        coins[txin.prevout]; // Create empty map entry keyed by prevout.\n+    }\n+    wallet.chain().findCoins(coins);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24649#discussion_r897927815",
      "id" : 897927815,
      "in_reply_to_id" : 889616160,
      "line" : 1031,
      "node_id" : "PRRC_kwDOABII5841hUqH",
      "original_commit_id" : "c3981e379fa088aa7aa03b2f505342a5b3bc3436",
      "original_line" : 1031,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 18,
      "pull_request_review_id" : 1007428087,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24649",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/897927815/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-15T12:40:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/897927815",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   }
]
