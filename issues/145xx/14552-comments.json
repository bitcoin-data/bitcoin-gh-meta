[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Would prefer to check this at database level, rather than in higher level wallet code. I think it's better if high level code just passes along wallet paths and isn't concerned with how data is stored in them.\r\n\r\nI posted a tweaked version of this PR at 40a6475e59950838be532b0a2c58f4359eae5625 which moves the check. @ken2812221, could you incorporate 40a6475e59950838be532b0a2c58f4359eae5625 into this PR if you think it makes sense?",
      "created_at" : "2018-10-23T19:36:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14552#issuecomment-432389031",
      "id" : 432389031,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14552",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMjM4OTAzMQ==",
      "updated_at" : "2018-10-23T19:36:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/432389031",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ryanofsky The element in mapDb is not always exist.\r\n\r\nFor example:\r\n1. Load wallet `dir/w1`\r\n2. Load wallet `dir/w2`\r\n3. Unload wallet `dir/w1`\r\n\r\nNow mapDb contains neither `dir/w1` nor `dir/w2` because it would flush all wallet files that share same BerkeleyEnvironment\r\n",
      "created_at" : "2018-10-23T20:34:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14552#issuecomment-432409103",
      "id" : 432409103,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14552",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMjQwOTEwMw==",
      "updated_at" : "2018-10-24T09:05:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/432409103",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "node_id" : "MDQ6VXNlcjExMTU0MTE4",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#11911](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/11911.html) (Free BerkeleyEnvironment instances when not in use by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2018-10-23T22:01:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14552#issuecomment-432437568",
      "id" : 432437568,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14552",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMjQzNzU2OA==",
      "updated_at" : "2018-11-05T20:10:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/432437568",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> @ryanofsky The element in mapDb is not always exist.\r\n\r\nGood catch. I think a small refactoring could fix this: 9c945d011abde24f8649d877e694d392e1a5727e. And then the fix would change slightly to aef19be5851ceb3b324fd80756060a00aad8e61c.\r\n\r\nI pushed a branch with these two commits to: https://github.com/ryanofsky/bitcoin/commits/pr/bloaded\r\n\r\nI think this is a better than checking for wallet.dat files outside the database layer, but let me know what you think, and feel free to use the code or commits in this PR if you think this approach makes sense.",
      "created_at" : "2018-10-24T21:02:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14552#issuecomment-432826947",
      "id" : 432826947,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14552",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMjgyNjk0Nw==",
      "updated_at" : "2018-10-24T21:02:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/432826947",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased",
      "created_at" : "2018-11-05T13:28:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14552#issuecomment-435873156",
      "id" : 435873156,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14552",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNTg3MzE1Ng==",
      "updated_at" : "2018-11-05T13:28:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/435873156",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "node_id" : "MDQ6VXNlcjExMTU0MTE4",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14552#discussion_r230800120"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14552"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/230800120"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Some comments here:\r\n - there's a slight change when replacing `map::operator[]` with `map::at`, maybe worth a comemnt or an assertion?\r\n - also, isn't this equivalent to the above `database` argument?\r\n - if this is really necessary then you could avoid shadowing `database`.",
      "commit_id" : "591203149f1700f594f781862e88cbbfe83d8d37",
      "created_at" : "2018-11-05T15:47:40Z",
      "diff_hunk" : "@@ -463,7 +463,8 @@ BerkeleyBatch::BerkeleyBatch(BerkeleyDatabase& database, const char* pszMode, bo\n         if (!env->Open(false /* retry */))\n             throw std::runtime_error(\"BerkeleyBatch: Failed to open database environment.\");\n \n-        pdb = env->mapDb[strFilename];\n+        BerkeleyDatabase& database = env->m_databases.at(strFilename).get();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14552#discussion_r230800120",
      "id" : 230800120,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMDgwMDEyMA==",
      "original_commit_id" : "1a2b9223662f1a9458d53d1c8f7c0fcf8e37a7e9",
      "original_position" : 24,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 171619030,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14552",
      "updated_at" : "2018-11-08T03:54:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/230800120",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14552#discussion_r230800921"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14552"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/230800921"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit, could add `final` to class since this is not virtual.",
      "commit_id" : "591203149f1700f594f781862e88cbbfe83d8d37",
      "created_at" : "2018-11-05T15:49:20Z",
      "diff_hunk" : "@@ -115,13 +117,22 @@ class BerkeleyDatabase\n         nUpdateCounter(0), nLastSeen(0), nLastFlushed(0), nLastWalletUpdate(0)\n     {\n         env = GetWalletEnv(wallet_path, strFile);\n+        auto inserted = env->m_databases.emplace(strFile, std::ref(*this));\n+        assert(inserted.second);\n         if (mock) {\n             env->Close();\n             env->Reset();\n             env->MakeMock();\n         }\n     }\n \n+    ~BerkeleyDatabase() {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14552#discussion_r230800921",
      "id" : 230800921,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMDgwMDkyMQ==",
      "original_commit_id" : "1a2b9223662f1a9458d53d1c8f7c0fcf8e37a7e9",
      "original_position" : 31,
      "path" : "src/wallet/db.h",
      "position" : 49,
      "pull_request_review_id" : 171619030,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14552",
      "updated_at" : "2018-11-08T03:54:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/230800921",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ryanofsky Thanks for your review. I would take your suggestion.",
      "created_at" : "2018-11-05T15:51:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14552#issuecomment-435925125",
      "id" : 435925125,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14552",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNTkyNTEyNQ==",
      "updated_at" : "2018-11-05T15:51:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/435925125",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "node_id" : "MDQ6VXNlcjExMTU0MTE4",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14552#discussion_r230802798"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14552"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/230802798"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could be `static`?",
      "commit_id" : "591203149f1700f594f781862e88cbbfe83d8d37",
      "created_at" : "2018-11-05T15:53:44Z",
      "diff_hunk" : "@@ -56,9 +56,8 @@ bool WalletDatabaseFileId::operator==(const WalletDatabaseFileId& rhs) const\n     return memcmp(value, &rhs.value, sizeof(value)) == 0;\n }\n \n-BerkeleyEnvironment* GetWalletEnv(const fs::path& wallet_path, std::string& database_filename)\n+void SplitWalletPath(const fs::path& wallet_path, fs::path& env_directory, std::string& database_filename)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14552#discussion_r230802798",
      "id" : 230802798,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMDgwMjc5OA==",
      "original_commit_id" : "b0375538375eb0c419b308d1015723ab64d53294",
      "original_position" : 5,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 171619030,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14552",
      "updated_at" : "2018-11-08T03:54:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/230802798",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14552#discussion_r230808159"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14552"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/230808159"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/14552#discussion_r230800120\r\n\r\nOh, I didn't even realize there was a `database` argument being shadowed above. Should just delete this line and use the existing `database`, which points to the same thing.",
      "commit_id" : "591203149f1700f594f781862e88cbbfe83d8d37",
      "created_at" : "2018-11-05T16:06:02Z",
      "diff_hunk" : "@@ -463,7 +463,8 @@ BerkeleyBatch::BerkeleyBatch(BerkeleyDatabase& database, const char* pszMode, bo\n         if (!env->Open(false /* retry */))\n             throw std::runtime_error(\"BerkeleyBatch: Failed to open database environment.\");\n \n-        pdb = env->mapDb[strFilename];\n+        BerkeleyDatabase& database = env->m_databases.at(strFilename).get();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14552#discussion_r230808159",
      "id" : 230808159,
      "in_reply_to_id" : 230800120,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMDgwODE1OQ==",
      "original_commit_id" : "1a2b9223662f1a9458d53d1c8f7c0fcf8e37a7e9",
      "original_position" : 24,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 171629140,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14552",
      "updated_at" : "2018-11-08T03:54:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/230808159",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14552#discussion_r230810096"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14552"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/230810096"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same as above, there's a slight change when replacing `map::operator[]` with `map::at`, maybe worth a comment or an assertion?",
      "commit_id" : "591203149f1700f594f781862e88cbbfe83d8d37",
      "created_at" : "2018-11-05T16:11:01Z",
      "diff_hunk" : "@@ -563,12 +581,11 @@ void BerkeleyEnvironment::CloseDb(const std::string& strFile)\n {\n     {\n         LOCK(cs_db);\n-        if (mapDb[strFile] != nullptr) {\n+        BerkeleyDatabase& database = m_databases.at(strFile).get();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14552#discussion_r230810096",
      "id" : 230810096,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMDgxMDA5Ng==",
      "original_commit_id" : "b0375538375eb0c419b308d1015723ab64d53294",
      "original_position" : 79,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 171631637,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14552",
      "updated_at" : "2018-11-08T03:54:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/230810096",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14552#discussion_r230825166"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14552"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/230825166"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`final` can only be added to virtual method.",
      "commit_id" : "591203149f1700f594f781862e88cbbfe83d8d37",
      "created_at" : "2018-11-05T16:46:40Z",
      "diff_hunk" : "@@ -115,13 +117,22 @@ class BerkeleyDatabase\n         nUpdateCounter(0), nLastSeen(0), nLastFlushed(0), nLastWalletUpdate(0)\n     {\n         env = GetWalletEnv(wallet_path, strFile);\n+        auto inserted = env->m_databases.emplace(strFile, std::ref(*this));\n+        assert(inserted.second);\n         if (mock) {\n             env->Close();\n             env->Reset();\n             env->MakeMock();\n         }\n     }\n \n+    ~BerkeleyDatabase() {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14552#discussion_r230825166",
      "id" : 230825166,
      "in_reply_to_id" : 230800921,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMDgyNTE2Ng==",
      "original_commit_id" : "1a2b9223662f1a9458d53d1c8f7c0fcf8e37a7e9",
      "original_position" : 31,
      "path" : "src/wallet/db.h",
      "position" : 49,
      "pull_request_review_id" : 171650318,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14552",
      "updated_at" : "2018-11-08T03:54:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/230825166",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "node_id" : "MDQ6VXNlcjExMTU0MTE4",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14552#discussion_r230825935"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14552"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/230825935"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@ken2812221 I mean `class BerkeleyDatabase final`.",
      "commit_id" : "591203149f1700f594f781862e88cbbfe83d8d37",
      "created_at" : "2018-11-05T16:48:37Z",
      "diff_hunk" : "@@ -115,13 +117,22 @@ class BerkeleyDatabase\n         nUpdateCounter(0), nLastSeen(0), nLastFlushed(0), nLastWalletUpdate(0)\n     {\n         env = GetWalletEnv(wallet_path, strFile);\n+        auto inserted = env->m_databases.emplace(strFile, std::ref(*this));\n+        assert(inserted.second);\n         if (mock) {\n             env->Close();\n             env->Reset();\n             env->MakeMock();\n         }\n     }\n \n+    ~BerkeleyDatabase() {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14552#discussion_r230825935",
      "id" : 230825935,
      "in_reply_to_id" : 230800921,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMDgyNTkzNQ==",
      "original_commit_id" : "1a2b9223662f1a9458d53d1c8f7c0fcf8e37a7e9",
      "original_position" : 31,
      "path" : "src/wallet/db.h",
      "position" : 49,
      "pull_request_review_id" : 171651339,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14552",
      "updated_at" : "2018-11-08T03:54:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/230825935",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14552#discussion_r230838723"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14552"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/230838723"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Change would be unrelated to this PR, and IMO, it's better only to use final when you have virtual methods and actual optimizations this would allow or bugs it would prevent. There's a core guideline that touches on this: http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rh-final",
      "commit_id" : "591203149f1700f594f781862e88cbbfe83d8d37",
      "created_at" : "2018-11-05T17:23:06Z",
      "diff_hunk" : "@@ -115,13 +117,22 @@ class BerkeleyDatabase\n         nUpdateCounter(0), nLastSeen(0), nLastFlushed(0), nLastWalletUpdate(0)\n     {\n         env = GetWalletEnv(wallet_path, strFile);\n+        auto inserted = env->m_databases.emplace(strFile, std::ref(*this));\n+        assert(inserted.second);\n         if (mock) {\n             env->Close();\n             env->Reset();\n             env->MakeMock();\n         }\n     }\n \n+    ~BerkeleyDatabase() {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14552#discussion_r230838723",
      "id" : 230838723,
      "in_reply_to_id" : 230800921,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMDgzODcyMw==",
      "original_commit_id" : "1a2b9223662f1a9458d53d1c8f7c0fcf8e37a7e9",
      "original_position" : 31,
      "path" : "src/wallet/db.h",
      "position" : 49,
      "pull_request_review_id" : 171667387,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14552",
      "updated_at" : "2018-11-08T03:54:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/230838723",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14552#discussion_r230841325"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14552"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/230841325"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nice thanks.",
      "commit_id" : "591203149f1700f594f781862e88cbbfe83d8d37",
      "created_at" : "2018-11-05T17:30:38Z",
      "diff_hunk" : "@@ -115,13 +117,22 @@ class BerkeleyDatabase\n         nUpdateCounter(0), nLastSeen(0), nLastFlushed(0), nLastWalletUpdate(0)\n     {\n         env = GetWalletEnv(wallet_path, strFile);\n+        auto inserted = env->m_databases.emplace(strFile, std::ref(*this));\n+        assert(inserted.second);\n         if (mock) {\n             env->Close();\n             env->Reset();\n             env->MakeMock();\n         }\n     }\n \n+    ~BerkeleyDatabase() {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14552#discussion_r230841325",
      "id" : 230841325,
      "in_reply_to_id" : 230800921,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMDg0MTMyNQ==",
      "original_commit_id" : "1a2b9223662f1a9458d53d1c8f7c0fcf8e37a7e9",
      "original_position" : 31,
      "path" : "src/wallet/db.h",
      "position" : 49,
      "pull_request_review_id" : 171670650,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14552",
      "updated_at" : "2018-11-08T03:54:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/230841325",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 15c93f0.",
      "created_at" : "2018-11-06T10:20:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14552#issuecomment-436202696",
      "id" : 436202696,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14552",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNjIwMjY5Ng==",
      "updated_at" : "2018-11-06T10:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/436202696",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14552#discussion_r231096324"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14552"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/231096324"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this is leaking the implementation detail of `m_databases`, wouldn't checking whether a database exists ideally be a responsibility of the database environment. e.g. add a `bool IsDatabaseLoaded(name)` on `DBenv`?",
      "commit_id" : "591203149f1700f594f781862e88cbbfe83d8d37",
      "created_at" : "2018-11-06T12:01:40Z",
      "diff_hunk" : "@@ -71,6 +70,24 @@ BerkeleyEnvironment* GetWalletEnv(const fs::path& wallet_path, std::string& data\n         env_directory = wallet_path;\n         database_filename = \"wallet.dat\";\n     }\n+}\n+\n+bool IsWalletLoaded(const fs::path& wallet_path)\n+{\n+    fs::path env_directory;\n+    std::string database_filename;\n+    SplitWalletPath(wallet_path, env_directory, database_filename);\n+    LOCK(cs_db);\n+    auto env = g_dbenvs.find(env_directory.string());\n+    if (env == g_dbenvs.end()) return false;\n+    auto db = env->second.m_databases.find(database_filename);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14552#discussion_r231096324",
      "id" : 231096324,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMTA5NjMyNA==",
      "original_commit_id" : "15c93f075a881deb3ad7b1dd8a4516a9b06e5e11",
      "original_position" : 25,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 171984230,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14552",
      "updated_at" : "2018-11-08T03:54:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/231096324",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14552#discussion_r231099786"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14552"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/231099786"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Note that `BerkeleyEnvironment::mapDb` is currently used outside. I consider this a bugfix so any improvement/refactor could come next.",
      "commit_id" : "591203149f1700f594f781862e88cbbfe83d8d37",
      "created_at" : "2018-11-06T12:15:05Z",
      "diff_hunk" : "@@ -71,6 +70,24 @@ BerkeleyEnvironment* GetWalletEnv(const fs::path& wallet_path, std::string& data\n         env_directory = wallet_path;\n         database_filename = \"wallet.dat\";\n     }\n+}\n+\n+bool IsWalletLoaded(const fs::path& wallet_path)\n+{\n+    fs::path env_directory;\n+    std::string database_filename;\n+    SplitWalletPath(wallet_path, env_directory, database_filename);\n+    LOCK(cs_db);\n+    auto env = g_dbenvs.find(env_directory.string());\n+    if (env == g_dbenvs.end()) return false;\n+    auto db = env->second.m_databases.find(database_filename);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14552#discussion_r231099786",
      "id" : 231099786,
      "in_reply_to_id" : 231096324,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMTA5OTc4Ng==",
      "original_commit_id" : "15c93f075a881deb3ad7b1dd8a4516a9b06e5e11",
      "original_position" : 25,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 171988725,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14552",
      "updated_at" : "2018-11-08T03:54:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/231099786",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "utACK 591203149f1700f594f781862e88cbbfe83d8d37. Just minor tweaks since last review: replacing map::at exception with assert, adding IsDatabaseLoaded.\r\n\r\n@promag and @MarcoFalke, I've noticed that in your recent reviews you've been advocating replacing exceptions with asserts or return codes. Maybe one of you can write up some guidelines about when to use exceptions in the developer guide. Personally, I tend to like exceptions and think that whatever drawbacks they have will be fixed by new c++ features like `throws`/`std::error` in \r\nhttp://www.open-std.org/jtc1/sc22/wg21/docs/papers/2018/p0709r0.pdf (see ÃÂ§4.1.1 \"Elevator Pitch\")",
      "created_at" : "2018-11-08T16:33:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14552#issuecomment-437061444",
      "id" : 437061444,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14552",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNzA2MTQ0NA==",
      "updated_at" : "2018-11-08T16:33:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/437061444",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14552#discussion_r231968260"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14552"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/231968260"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is now resolved (by adding `IsDatabaseLoaded`)",
      "commit_id" : "591203149f1700f594f781862e88cbbfe83d8d37",
      "created_at" : "2018-11-08T16:34:03Z",
      "diff_hunk" : "@@ -71,6 +70,24 @@ BerkeleyEnvironment* GetWalletEnv(const fs::path& wallet_path, std::string& data\n         env_directory = wallet_path;\n         database_filename = \"wallet.dat\";\n     }\n+}\n+\n+bool IsWalletLoaded(const fs::path& wallet_path)\n+{\n+    fs::path env_directory;\n+    std::string database_filename;\n+    SplitWalletPath(wallet_path, env_directory, database_filename);\n+    LOCK(cs_db);\n+    auto env = g_dbenvs.find(env_directory.string());\n+    if (env == g_dbenvs.end()) return false;\n+    auto db = env->second.m_databases.find(database_filename);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14552#discussion_r231968260",
      "id" : 231968260,
      "in_reply_to_id" : 231096324,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMTk2ODI2MA==",
      "original_commit_id" : "15c93f075a881deb3ad7b1dd8a4516a9b06e5e11",
      "original_position" : 25,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 173055063,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14552",
      "updated_at" : "2018-11-08T16:34:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/231968260",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK https://github.com/bitcoin/bitcoin/pull/14552/commits/591203149f1700f594f781862e88cbbfe83d8d37, looks good",
      "created_at" : "2018-11-09T13:37:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14552#issuecomment-437361617",
      "id" : 437361617,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14552",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNzM2MTYxNw==",
      "updated_at" : "2018-11-09T13:37:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/437361617",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Can this be merged? It fixes an ugly bug and has some refactoring changes I want to build on. If it can't be merged, maybe it could be added to https://github.com/bitcoin/bitcoin/projects/8",
      "created_at" : "2018-11-15T17:35:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14552#issuecomment-439125552",
      "id" : 439125552,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14552",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzOTEyNTU1Mg==",
      "updated_at" : "2018-11-15T17:35:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/439125552",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Is this for backport?",
      "created_at" : "2018-11-15T18:21:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14552#issuecomment-439140212",
      "id" : 439140212,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14552",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzOTE0MDIxMg==",
      "updated_at" : "2018-11-15T18:21:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/439140212",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Is this for backport?\r\n\r\nI don't have a great sense for which changes get backported and which changes don't. I would guess it could be backported, but I don't think it's important to backport. Original bug #14538 reporter @chernyshev might have an opinion.\r\n\r\nNote: related fix https://github.com/bitcoin/bitcoin/pull/14320#issuecomment-425159822 does not appear to have been backported.",
      "created_at" : "2018-11-15T18:28:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14552#issuecomment-439142609",
      "id" : 439142609,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14552",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzOTE0MjYwOQ==",
      "updated_at" : "2018-11-15T18:31:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/439142609",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14552#discussion_r234812302"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14552"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/234812302"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Shouldn't this be guarded by `cs_db`?",
      "commit_id" : "591203149f1700f594f781862e88cbbfe83d8d37",
      "created_at" : "2018-11-19T22:51:39Z",
      "diff_hunk" : "@@ -43,7 +45,7 @@ class BerkeleyEnvironment\n public:\n     std::unique_ptr<DbEnv> dbenv;\n     std::map<std::string, int> mapFileUseCount;\n-    std::map<std::string, Db*> mapDb;\n+    std::map<std::string, std::reference_wrapper<BerkeleyDatabase>> m_databases;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14552#discussion_r234812302",
      "id" : 234812302,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzNDgxMjMwMg==",
      "original_commit_id" : "591203149f1700f594f781862e88cbbfe83d8d37",
      "original_position" : 14,
      "path" : "src/wallet/db.h",
      "position" : 14,
      "pull_request_review_id" : 176535062,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14552",
      "updated_at" : "2018-11-19T22:51:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/234812302",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   }
]
