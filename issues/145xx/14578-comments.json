[
   {
      "author_association" : "NONE",
      "body" : "**I tried to find the reference links, but I can't.** I will keep searching, but I have bugs to fix in EasyNOMP.\r\n\r\nYou should be able to easily reproduce the two problems (both related to batch transactions)\r\n1) Make batch payment for 50 miners (this should be well over the limit that causes the failure)\r\n2) Make batch payment to 10 people, but make one of the 10 people have an invalid receiving address (try changing one letter, and also try something completeley wrong like \"123456\")\r\n\r\nYou should get a failure on the entire batch of payments in both cases.\r\n\r\n**This is a security issue for pools, as an attacker can deny payment services by simply mining one or two shares to an invalid receiving address.**\r\n\r\nWhat _should_ happen, is the daemon should process each transaction that it can, but fail only the one transaction with the problem. Also batch transactions should support at least 150 transactions to be worth having a \"batching\" feature (think of how many tx a pool would send!).\r\n\r\nNOMP is also responsible, as it never had address validation prior to making payments. Address validation should be done on both sides. I will be patching this in NOMP shortly.\r\n\r\n**Thanks**",
      "created_at" : "2018-10-26T22:37:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/14578#issuecomment-433561391",
      "id" : 433561391,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14578",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMzU2MTM5MQ==",
      "updated_at" : "2018-10-26T22:45:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/433561391",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/43627985?v=4",
         "events_url" : "https://api.github.com/users/leshacat/events{/privacy}",
         "followers_url" : "https://api.github.com/users/leshacat/followers",
         "following_url" : "https://api.github.com/users/leshacat/following{/other_user}",
         "gists_url" : "https://api.github.com/users/leshacat/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/leshacat",
         "id" : 43627985,
         "login" : "leshacat",
         "node_id" : "MDQ6VXNlcjQzNjI3OTg1",
         "organizations_url" : "https://api.github.com/users/leshacat/orgs",
         "received_events_url" : "https://api.github.com/users/leshacat/received_events",
         "repos_url" : "https://api.github.com/users/leshacat/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/leshacat/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/leshacat/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/leshacat"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Also batch transactions should support at least 150 transactions to be worth having a \"batching\" feature (think of how many tx a pool would send!).\r\n\r\nThe limit is due to the maximum size of bitcoin transactions, and depends on the number of inputs your transactions has. Certain 150 outputs is not a problem in general, but if you need 1000s of inputs to pay that much, then yes. Sorry, nothing Bitcoin Core can do about that.\r\n\r\n> You should get a failure on the entire batch of payments in both cases.\r\n\r\nBatches are not atomic. They're executed one by one. Changing that would require a major redesign of how the RPC system works.\r\n\r\n> What should happen, is the daemon should process each transaction that it can, but fail only the one transaction with the problem.\r\n\r\nPerhaps that is reasonable for `sendmany`, and perhaps not. I think it's generally safer to fail as much as possible when part of the input is invalid (in line with your earlier request, except we can't do it across RPC calls). It certainly isn't reasonable in general (for example, if that's what we'd do for `createrawtransaction` you'd end up paying the failed amounts as fee!).\r\n\r\nReally, I think there is no solution except validating your inputs.",
      "created_at" : "2018-10-26T23:22:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/14578#issuecomment-433568076",
      "id" : 433568076,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14578",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMzU2ODA3Ng==",
      "updated_at" : "2018-10-26T23:23:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/433568076",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "**@sipa - thank you for your speedy reply!**\r\n\r\n>The limit is due to the maximum size of bitcoin transactions, and depends on the number of inputs your transactions has. Certain 150 outputs is not a problem in general, but if you need 1000s of inputs to pay that much, then yes. Sorry, nothing Bitcoin Core can do about that.\r\n\r\n**So what is the upper limit on how many transactions can fit into one batch RPC call?** I need to know so I can manually batch my transactions...\r\n\r\n>>You should get a failure on the entire batch of payments in both cases.\r\n\r\n>Batches are not atomic. They're executed one by one. Changing that would require a major redesign of how the RPC system works.\r\n\r\nI meant to say \"you should NOT get a failure on the entire batch, it should process the other transactions in the batch and return the failed transaction in the JSON return value\"\r\n\r\n**Example of 'sendmany' partial failure response:**\r\n>\"result\": {\r\n>    error: true,\r\n>    successnum: 5\r\n>    success: {\r\n>        \"f341229e5d0cc0747b1d0194416c7f272dbc6e3244384caa4e11678bcfc79edc\", blockheight, etc,\r\n>        \"f341229e5d0cc0747b1d0194416c7f272dbc6e3244384caa4e11678bcfc79edc\", blockheight, etc,\r\n>        \"f341229e5d0cc0747b1d0194416c7f272dbc6e3244384caa4e11678bcfc79edc\", blockheight, etc,\r\n>        \"f341229e5d0cc0747b1d0194416c7f272dbc6e3244384caa4e11678bcfc79edc\", blockheight, etc,\r\n>        \"f341229e5d0cc0747b1d0194416c7f272dbc6e3244384caa4e11678bcfc79edc\", blockheight, etc,\r\n>    }\r\n>    failnum: 3\r\n>    failed: {\r\n>        {\"1PvSxjrpzNXpuBHCupAGuuzeUk5DE7kB7H\", 10.83746523, \"invalid address\", 400, etc},\r\n>        {\"1PvwxjrTzNXpuBHCupAGuuzeik5DE7kB7H\", 5.42042020, \"insufficient funds\", 401, etc},\r\n>        {\"1PvuxjrpzNlpuBHCupAGuuzeUk5DE7kB7H\", 10000.00000000, \"fee too low\", 402, etc}\r\n>    }\r\n>}\r\n\r\nI must be unaware of how the RPC system works and ties into other systems. Was it intended to be designed so that the entire batch fails if one single address is wrong?\r\n\r\n>Perhaps that is reasonable for sendmany, and perhaps not. I think it's generally safer to fail as much as possible when part of the input is invalid (in line with your earlier request, except we can't do it across RPC calls). It certainly isn't reasonable in general (for example, if that's what we'd do for createrawtransaction you'd end up paying the failed amounts as fee!).\r\nDefinitely would not want to pay the failed amount as a fee... My goal is to track the failed amounts, and give it to the pool as donation.\r\n\r\n**So should I just switch it back to send one single transaction at a time then? Or is there a way to tell which transaction is the one that failed the whole batch?**",
      "created_at" : "2018-10-27T22:09:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/14578#issuecomment-433659038",
      "id" : 433659038,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14578",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMzY1OTAzOA==",
      "updated_at" : "2018-10-27T23:32:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/433659038",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/43627985?v=4",
         "events_url" : "https://api.github.com/users/leshacat/events{/privacy}",
         "followers_url" : "https://api.github.com/users/leshacat/followers",
         "following_url" : "https://api.github.com/users/leshacat/following{/other_user}",
         "gists_url" : "https://api.github.com/users/leshacat/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/leshacat",
         "id" : 43627985,
         "login" : "leshacat",
         "node_id" : "MDQ6VXNlcjQzNjI3OTg1",
         "organizations_url" : "https://api.github.com/users/leshacat/orgs",
         "received_events_url" : "https://api.github.com/users/leshacat/received_events",
         "repos_url" : "https://api.github.com/users/leshacat/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/leshacat/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/leshacat/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/leshacat"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I'm confused now. Which RPCs are you using?",
      "created_at" : "2018-10-27T22:14:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/14578#issuecomment-433659330",
      "id" : 433659330,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14578",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMzY1OTMzMA==",
      "updated_at" : "2018-10-27T22:14:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/433659330",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@sipa I am using the **sendmany** RPC call. I thought there was a confusion, I am sorry if I was not clear about that.\r\n\r\nI just looked at the RPC page for sendmany http://chainquery.com/bitcoin-api/sendmany\r\n\r\nI see what you mean, because the original return value is **only** a transaction ID which if you change it to a JSON result, will break every single program that is set up to expect a transaction ID as a result.\r\n\r\n**sendmany return information:**\r\n\"Result:\r\n\"txid\"                   (string) The transaction id for the send. Only 1 transaction is created regardless of \r\n                                    the number of addresses.\"\r\n\r\nThe thing is, this is why there is a such thing as a \"Hard Fork\" and \"Soft Fork\". \r\n\r\n**One way to make it work without breaking compatability** is to bring the new command in stages, and depreciate the old one over time...\r\n\r\n**Example:** _sendmany_ operates as normal until depreciation date, sendmany-new operates the new way until _sendmany_ depreaciation date, and then _sendmany-new_ gets it's own depreciation date later on...\r\n\r\nThat gives backwards compatability, notice, and time for developers to switch over to the new version of sendmany, which has better return information telling them which tx failed and why. It also allows you to fix the issues with sendmany failing in the two specific instances in the OP.\r\n\r\n**Is this not possible?**\r\n\r\nP.S. I believe I have patched EasyNOMP I am just testing it now",
      "created_at" : "2018-10-28T20:09:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/14578#issuecomment-433737122",
      "id" : 433737122,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14578",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMzczNzEyMg==",
      "updated_at" : "2018-10-28T20:17:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/433737122",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/43627985?v=4",
         "events_url" : "https://api.github.com/users/leshacat/events{/privacy}",
         "followers_url" : "https://api.github.com/users/leshacat/followers",
         "following_url" : "https://api.github.com/users/leshacat/following{/other_user}",
         "gists_url" : "https://api.github.com/users/leshacat/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/leshacat",
         "id" : 43627985,
         "login" : "leshacat",
         "node_id" : "MDQ6VXNlcjQzNjI3OTg1",
         "organizations_url" : "https://api.github.com/users/leshacat/orgs",
         "received_events_url" : "https://api.github.com/users/leshacat/received_events",
         "repos_url" : "https://api.github.com/users/leshacat/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/leshacat/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/leshacat/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/leshacat"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I was having trouble understanding this issue, because I thought it was referring to [JSON-RPC batch requests](https://www.jsonrpc.org/specification#batch), but it sounds like this is just talking about calling the `sendmany` RPC method to send one payment to a lot of recipients.\r\n\r\nIn https://github.com/bitcoin/bitcoin/issues/14578#issuecomment-433659038, leshacat seems to be asking for `sendmany` to return a more detailed response in case of failure. But the response format shown there doesn't really make sense because `sendmany` currently only creates single transaction and doesn't know about block heights. Also errors like \"insufficient funds\" would apply to transactions, not addresses. \r\n\r\nMaybe in the future it wound be good to have a `sendmanytxs` method which sends multiple transactions to a long list of recipients that don't necessarily fit in a single transaction. In the meantime, we probably should replace \"send multiple times\" in `sendmany documentation`:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/29f429dc7d4c7e6cd012e749cadf89e3138bcab3/src/wallet/rpcwallet.cpp#L766\r\n\r\nwith something to clarify that it only makes a single transaction.\r\n\r\n@leshacat, I would agree with sipa that \"there is no solution except validating your inputs.\". If your application isn't checking that addresses are valid as soon as it receives them, and instead it is failing at the point of trying to send a payment, that sounds like it would only be making invalid address issues harder to debug at the same time as making your payment code more complex...\r\n\r\nRe: https://github.com/bitcoin/bitcoin/issues/14578#issuecomment-433737122, backwards compatibility is not a major concern here. There are many ways we can extend APIs while remaining backwards compatible, and it would make sense to first figure out what the ideal API would actually look like before getting into the weeds of backwards compatibility.",
      "created_at" : "2018-10-29T15:45:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/14578#issuecomment-433961974",
      "id" : 433961974,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14578",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzMzk2MTk3NA==",
      "updated_at" : "2018-10-29T15:45:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/433961974",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@ryanofsky yes I am getting the feeling the problem is not too many transactions in the batch, it is too many inputs and outputs in the transaction. So the posting I read must have been someone mid-trail finding the cause of the issue.\r\n\r\nIf this is an issue of too many inputs/outputs and not too many transactions in the batch, I will work on this from my end then. I think I found a fix for it in z-nomp. This adds to context of why you cannot simply change this.\r\n\r\nEither way I intended to work on it from my end, I only raised the issue because I believe validation should be done on both sides, as well as also batch processing should support large batches on both sides.\r\n\r\n**Thanks for the quick replies, and sorry for consuming resources and time from your busy days :) Obviously thanks for BTC :)**",
      "created_at" : "2018-10-30T19:32:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/14578#issuecomment-434438814",
      "id" : 434438814,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14578",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNDQzODgxNA==",
      "updated_at" : "2018-10-30T19:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/434438814",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/43627985?v=4",
         "events_url" : "https://api.github.com/users/leshacat/events{/privacy}",
         "followers_url" : "https://api.github.com/users/leshacat/followers",
         "following_url" : "https://api.github.com/users/leshacat/following{/other_user}",
         "gists_url" : "https://api.github.com/users/leshacat/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/leshacat",
         "id" : 43627985,
         "login" : "leshacat",
         "node_id" : "MDQ6VXNlcjQzNjI3OTg1",
         "organizations_url" : "https://api.github.com/users/leshacat/orgs",
         "received_events_url" : "https://api.github.com/users/leshacat/received_events",
         "repos_url" : "https://api.github.com/users/leshacat/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/leshacat/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/leshacat/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/leshacat"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "**Just an update:**\r\n\r\nThe real issue was the number of RPC threads available.\r\n\r\nInside walletd.conf:\r\n`rpcthreads=4`\r\n\r\nSet the above to a high enough number to handle the requests from the client application which is accessing the daemon's RPC.\r\n\r\n**Sorry for wasting peoples time on this!**\r\n\r\n**Thank you everyone for your help!**",
      "created_at" : "2019-04-02T22:28:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/14578#issuecomment-479233375",
      "id" : 479233375,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14578",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3OTIzMzM3NQ==",
      "updated_at" : "2019-04-02T22:28:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/479233375",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/43627985?v=4",
         "events_url" : "https://api.github.com/users/leshacat/events{/privacy}",
         "followers_url" : "https://api.github.com/users/leshacat/followers",
         "following_url" : "https://api.github.com/users/leshacat/following{/other_user}",
         "gists_url" : "https://api.github.com/users/leshacat/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/leshacat",
         "id" : 43627985,
         "login" : "leshacat",
         "node_id" : "MDQ6VXNlcjQzNjI3OTg1",
         "organizations_url" : "https://api.github.com/users/leshacat/orgs",
         "received_events_url" : "https://api.github.com/users/leshacat/received_events",
         "repos_url" : "https://api.github.com/users/leshacat/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/leshacat/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/leshacat/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/leshacat"
      }
   }
]
