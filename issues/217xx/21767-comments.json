[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #21726 (Improve Indices on pruned nodes via prune blockers by fjahr)\n* #21526 (validation: UpdateTip/CheckBlockIndex assumeutxo support by jamesob)\n* #15606 ([experimental] UTXO snapshots by jamesob)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-04-24T01:14:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#issuecomment-826010997",
      "id" : 826010997,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21767",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyNjAxMDk5Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-28T05:17:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/826010997",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Looks like this accumulated a silent merge conflict:\r\n```\r\nâ¦/bitcoin/src/test/coinstatsindex_tests.cpp:35:28: error: too few arguments to function call, single argument 'active_chainstate' was not specified\r\n    coin_stats_index.Start();\r\n    ~~~~~~~~~~~~~~~~~~~~~~ ^\r\nâ¦/bitcoin/src/index/base.h:122:10: note: 'Start' declared here\r\n    void Start(CChainState& active_chainstate);\r\n         ^\r\n1 error generated.\r\n```",
      "created_at" : "2021-05-05T12:09:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#issuecomment-832636493",
      "id" : 832636493,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21767",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgzMjYzNjQ5Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-05T12:09:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/832636493",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r627846989"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/627846989"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"rest: Add GetChainman function and use it\" (a839078c20f4ac3d92e14af7b287f2f0fddbc61e)\r\n\r\nIt seems like this should say `if (!node_context || !node_context->chainman)` otherwise the http error won't be set in the null chainman case.",
      "commit_id" : "0945b4117e0209d156a6b74c407f4d32e0cf2c1a",
      "created_at" : "2021-05-07T00:28:38Z",
      "diff_hunk" : "@@ -107,6 +107,23 @@ static CTxMemPool* GetMemPool(const std::any& context, HTTPRequest* req)\n     return node_context->mempool.get();\n }\n \n+/**\n+ * Get the node context chainstatemanager.\n+ *\n+ * @param[in]  req The HTTP request, whose status code will be set if node\n+ *                 context chainstatemanager is not found.\n+ * @returns        Pointer to the chainstatemanager or nullptr if none found.\n+ */\n+static ChainstateManager* GetChainman(const std::any& context, HTTPRequest* req)\n+{\n+    auto node_context = util::AnyPtr<NodeContext>(context);\n+    if (!node_context) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r627846989",
      "id" : 627846989,
      "line" : 120,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNzg0Njk4OQ==",
      "original_commit_id" : "a839078c20f4ac3d92e14af7b287f2f0fddbc61e",
      "original_line" : 120,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : 14,
      "pull_request_review_id" : 653992917,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-07T00:55:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/627846989",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r627847595"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/627847595"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"rest: Add GetChainman function and use it\" (a839078c20f4ac3d92e14af7b287f2f0fddbc61e)\r\n\r\nIf this condition is never expected, then maybe this should use `HTTP_INTERNAL_SERVER_ERROR` to flag that this is a bug in request handling, not an invalid request.",
      "commit_id" : "0945b4117e0209d156a6b74c407f4d32e0cf2c1a",
      "created_at" : "2021-05-07T00:30:39Z",
      "diff_hunk" : "@@ -107,6 +107,23 @@ static CTxMemPool* GetMemPool(const std::any& context, HTTPRequest* req)\n     return node_context->mempool.get();\n }\n \n+/**\n+ * Get the node context chainstatemanager.\n+ *\n+ * @param[in]  req The HTTP request, whose status code will be set if node\n+ *                 context chainstatemanager is not found.\n+ * @returns        Pointer to the chainstatemanager or nullptr if none found.\n+ */\n+static ChainstateManager* GetChainman(const std::any& context, HTTPRequest* req)\n+{\n+    auto node_context = util::AnyPtr<NodeContext>(context);\n+    if (!node_context) {\n+        RESTERR(req, HTTP_NOT_FOUND, \"Chainman disabled or instance not found\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r627847595",
      "id" : 627847595,
      "line" : 121,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNzg0NzU5NQ==",
      "original_commit_id" : "a839078c20f4ac3d92e14af7b287f2f0fddbc61e",
      "original_line" : 121,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : 15,
      "pull_request_review_id" : 653992917,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-07T00:55:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/627847595",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r627848313"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/627848313"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"rest: Add GetChainman function and use it\" (a839078c20f4ac3d92e14af7b287f2f0fddbc61e)\r\n\r\nre: \"Someone can probably make this a bit prettier,\" your current version of this seems fine to me, but if you wanted to make it more minimal you could use CHECK_NONFATAL and catch the NonFatalCheckError exception in here, I think: https://github.com/bitcoin/bitcoin/blob/06d573f053c63eb6521c62d210c5924418ae2b83/src/rest.cpp#L699",
      "commit_id" : "0945b4117e0209d156a6b74c407f4d32e0cf2c1a",
      "created_at" : "2021-05-07T00:33:15Z",
      "diff_hunk" : "@@ -644,7 +667,9 @@ static bool rest_blockhash_by_height(const std::any& context, HTTPRequest* req,\n \n     CBlockIndex* pblockindex = nullptr;\n     {\n-        ChainstateManager& chainman = EnsureAnyChainman(context);\n+        ChainstateManager* maybe_chainman = GetChainman(context, req);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r627848313",
      "id" : 627848313,
      "line" : 670,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNzg0ODMxMw==",
      "original_commit_id" : "a839078c20f4ac3d92e14af7b287f2f0fddbc61e",
      "original_line" : 670,
      "original_position" : 62,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : 62,
      "pull_request_review_id" : 653992917,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-07T00:55:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/627848313",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r627852105"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/627852105"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"miner: Pass in chainman to RegenerateCommitments\" (f5368a525b3d5b93d06c83101497de5aaa6fe1c8)\r\n\r\nIt seems like this could take blockman reference instead of a chainman reference to be a little more limited. Doesn't matter though, all version of this function seem about the same to me.",
      "commit_id" : "0945b4117e0209d156a6b74c407f4d32e0cf2c1a",
      "created_at" : "2021-05-07T00:46:16Z",
      "diff_hunk" : "@@ -39,13 +39,21 @@ int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParam\n     return nNewTime - nOldTime;\n }\n \n-void RegenerateCommitments(CBlock& block, CBlockIndex* prev_block)\n+void RegenerateCommitments(CBlock& block, ChainstateManager& chainman)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r627852105",
      "id" : 627852105,
      "line" : 42,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNzg1MjEwNQ==",
      "original_commit_id" : "f5368a525b3d5b93d06c83101497de5aaa6fe1c8",
      "original_line" : 42,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/miner.cpp",
      "position" : 5,
      "pull_request_review_id" : 653992917,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-07T00:55:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/627852105",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r627853739"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/627853739"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"index: Add chainstate member to BaseIndex\" (0945b4117e0209d156a6b74c407f4d32e0cf2c1a)\r\n\r\nSeems like active_chain could be used above too. Fine either way in case this was intentional, though.",
      "commit_id" : "0945b4117e0209d156a6b74c407f4d32e0cf2c1a",
      "created_at" : "2021-05-07T00:50:26Z",
      "diff_hunk" : "@@ -63,30 +63,31 @@ bool BaseIndex::Init()\n     if (locator.IsNull()) {\n         m_best_block_index = nullptr;\n     } else {\n-        m_best_block_index = g_chainman.m_blockman.FindForkInGlobalIndex(::ChainActive(), locator);\n+        m_best_block_index = m_chainstate->m_blockman.FindForkInGlobalIndex(m_chainstate->m_chain, locator);\n     }\n-    m_synced = m_best_block_index.load() == ::ChainActive().Tip();\n+    CChain& active_chain = m_chainstate->m_chain;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r627853739",
      "id" : 627853739,
      "line" : 68,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNzg1MzczOQ==",
      "original_commit_id" : "0945b4117e0209d156a6b74c407f4d32e0cf2c1a",
      "original_line" : 68,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/index/base.cpp",
      "position" : 8,
      "pull_request_review_id" : 653992917,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-07T00:55:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/627853739",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Pushed 0945b4117e -> b04370dbb5\r\n- Addressed: https://github.com/bitcoin/bitcoin/pull/21767#discussion_r627846989, https://github.com/bitcoin/bitcoin/pull/21767#discussion_r627847595, https://github.com/bitcoin/bitcoin/pull/21767#discussion_r627853739",
      "created_at" : "2021-05-07T18:52:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#issuecomment-834691206",
      "id" : 834691206,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21767",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgzNDY5MTIwNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-07T18:52:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/834691206",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r628439658"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/628439658"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Unfortunately if we take a blockman reference, then callers would need to take `cs_main` to reach into ChainMan for the blockman ref :-/\r\n\r\nSomething for another day I think! Added to: #21766",
      "commit_id" : "b04370dbb55e61e168cbf0aba3d29fb882a46bec",
      "created_at" : "2021-05-07T18:57:48Z",
      "diff_hunk" : "@@ -39,13 +39,21 @@ int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParam\n     return nNewTime - nOldTime;\n }\n \n-void RegenerateCommitments(CBlock& block, CBlockIndex* prev_block)\n+void RegenerateCommitments(CBlock& block, ChainstateManager& chainman)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r628439658",
      "id" : 628439658,
      "in_reply_to_id" : 627852105,
      "line" : 42,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyODQzOTY1OA==",
      "original_commit_id" : "f5368a525b3d5b93d06c83101497de5aaa6fe1c8",
      "original_line" : 42,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/miner.cpp",
      "position" : 5,
      "pull_request_review_id" : 654784332,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-07T18:57:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/628439658",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r628449195"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/628449195"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hmmmm, how could we differentiate between NOT_FOUND like the \"no mempool\"-case and INTERNAL_SERVER_ERROR like the \"no Context/Chainman\"-case here?",
      "commit_id" : "b04370dbb55e61e168cbf0aba3d29fb882a46bec",
      "created_at" : "2021-05-07T19:07:51Z",
      "diff_hunk" : "@@ -644,7 +667,9 @@ static bool rest_blockhash_by_height(const std::any& context, HTTPRequest* req,\n \n     CBlockIndex* pblockindex = nullptr;\n     {\n-        ChainstateManager& chainman = EnsureAnyChainman(context);\n+        ChainstateManager* maybe_chainman = GetChainman(context, req);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r628449195",
      "id" : 628449195,
      "in_reply_to_id" : 627848313,
      "line" : 674,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyODQ0OTE5NQ==",
      "original_commit_id" : "a839078c20f4ac3d92e14af7b287f2f0fddbc61e",
      "original_line" : 674,
      "original_position" : 62,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : 66,
      "pull_request_review_id" : 654791104,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-07T19:07:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/628449195",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r628494664"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/628494664"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/21767#discussion_r628449195\r\n\r\n> Hmmmm, how could we differentiate between NOT_FOUND like the \"no mempool\"-case and INTERNAL_SERVER_ERROR like the \"no Context/Chainman\"-case here?\r\n\r\nI didn't realize that was intentional and I do think the your approach is fine, but you wanted to use the NonFatalCheckError approach, you would just add:\r\n\r\n```\r\nclass PageNotFoundError : public std::runtime_error\r\n{\r\n    using std::runtime_error::runtime_error;\r\n};\r\n\r\n...\r\n\r\nthrow PageNotFoundError{};\r\n\r\n...\r\n\r\n} catch (const PageNotFoundError&) {\r\n\r\n```",
      "commit_id" : "b04370dbb55e61e168cbf0aba3d29fb882a46bec",
      "created_at" : "2021-05-07T20:26:55Z",
      "diff_hunk" : "@@ -644,7 +667,9 @@ static bool rest_blockhash_by_height(const std::any& context, HTTPRequest* req,\n \n     CBlockIndex* pblockindex = nullptr;\n     {\n-        ChainstateManager& chainman = EnsureAnyChainman(context);\n+        ChainstateManager* maybe_chainman = GetChainman(context, req);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r628494664",
      "id" : 628494664,
      "in_reply_to_id" : 627848313,
      "line" : 674,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyODQ5NDY2NA==",
      "original_commit_id" : "a839078c20f4ac3d92e14af7b287f2f0fddbc61e",
      "original_line" : 674,
      "original_position" : 62,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : 66,
      "pull_request_review_id" : 654841050,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-07T20:26:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/628494664",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r628502581"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/628502581"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Oh I see see the mempool code you're referring to is preexisting. That would more incline towards following previous pattern like you're doing I think. I'm sure you could just set the 404 one way and the 500 the other way, too though. Again any approach seems fine and I was just responding originally to dissatisfaction in the commit message.",
      "commit_id" : "b04370dbb55e61e168cbf0aba3d29fb882a46bec",
      "created_at" : "2021-05-07T20:36:59Z",
      "diff_hunk" : "@@ -644,7 +667,9 @@ static bool rest_blockhash_by_height(const std::any& context, HTTPRequest* req,\n \n     CBlockIndex* pblockindex = nullptr;\n     {\n-        ChainstateManager& chainman = EnsureAnyChainman(context);\n+        ChainstateManager* maybe_chainman = GetChainman(context, req);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r628502581",
      "id" : 628502581,
      "in_reply_to_id" : 627848313,
      "line" : 674,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyODUwMjU4MQ==",
      "original_commit_id" : "a839078c20f4ac3d92e14af7b287f2f0fddbc61e",
      "original_line" : 674,
      "original_position" : 62,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : 66,
      "pull_request_review_id" : 654847802,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-07T20:37:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/628502581",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r628905295"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/628905295"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think this is necessarily a bug. Once chainman is deglobalized, it should be theoretically possible to run without a chainman. I think just having a message \"Chainman disabled or instance not found\" (similar to if mempool isn't found) is sufficient.",
      "commit_id" : "b04370dbb55e61e168cbf0aba3d29fb882a46bec",
      "created_at" : "2021-05-09T15:24:37Z",
      "diff_hunk" : "@@ -107,6 +107,27 @@ static CTxMemPool* GetMemPool(const std::any& context, HTTPRequest* req)\n     return node_context->mempool.get();\n }\n \n+/**\n+ * Get the node context chainstatemanager.\n+ *\n+ * @param[in]  req The HTTP request, whose status code will be set if node\n+ *                 context chainstatemanager is not found.\n+ * @returns        Pointer to the chainstatemanager or nullptr if none found.\n+ */\n+static ChainstateManager* GetChainman(const std::any& context, HTTPRequest* req)\n+{\n+    auto node_context = util::AnyPtr<NodeContext>(context);\n+    if (!node_context || !node_context->chainman) {\n+        RESTERR(req, HTTP_INTERNAL_SERVER_ERROR,\n+                strprintf(\"%s:%d (%s)\\n\"\n+                          \"Internal bug detected: Chainman disabled or instance not found!\\n\"\n+                          \"You may report this issue here: %s\\n\",\n+                          __FILE__, __LINE__, __func__, PACKAGE_BUGREPORT));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r628905295",
      "id" : 628905295,
      "line" : 125,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyODkwNTI5NQ==",
      "original_commit_id" : "b04370dbb55e61e168cbf0aba3d29fb882a46bec",
      "original_line" : 125,
      "original_position" : 19,
      "original_start_line" : 123,
      "path" : "src/rest.cpp",
      "position" : 19,
      "pull_request_review_id" : 655088834,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : 123,
      "start_side" : "RIGHT",
      "updated_at" : "2021-05-09T15:47:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/628905295",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r628906795"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/628906795"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Perhaps just pass in a `BlockManager&` here?",
      "commit_id" : "b04370dbb55e61e168cbf0aba3d29fb882a46bec",
      "created_at" : "2021-05-09T15:37:05Z",
      "diff_hunk" : "@@ -203,6 +203,6 @@ void IncrementExtraNonce(CBlock* pblock, const CBlockIndex* pindexPrev, unsigned\n int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParams, const CBlockIndex* pindexPrev);\n \n /** Update an old GenerateCoinbaseCommitment from CreateNewBlock after the block txs have changed */\n-void RegenerateCommitments(CBlock& block, CBlockIndex* prev_block);\n+void RegenerateCommitments(CBlock& block, ChainstateManager& chainman);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r628906795",
      "id" : 628906795,
      "line" : 206,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyODkwNjc5NQ==",
      "original_commit_id" : "b04370dbb55e61e168cbf0aba3d29fb882a46bec",
      "original_line" : 206,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/miner.h",
      "position" : 5,
      "pull_request_review_id" : 655088834,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-09T15:47:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/628906795",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r628906943"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/628906943"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Does this need to be in the `cs_main` scope?",
      "commit_id" : "b04370dbb55e61e168cbf0aba3d29fb882a46bec",
      "created_at" : "2021-05-09T15:38:19Z",
      "diff_hunk" : "@@ -25,7 +25,8 @@ static void DuplicateInputs(benchmark::Bench& bench)\n     CMutableTransaction naughtyTx{};\n \n     LOCK(cs_main);\n-    CBlockIndex* pindexPrev = ::ChainActive().Tip();\n+    assert(std::addressof(::ChainActive()) == std::addressof(testing_setup->m_node.chainman->ActiveChain()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r628906943",
      "id" : 628906943,
      "line" : 28,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyODkwNjk0Mw==",
      "original_commit_id" : "b04370dbb55e61e168cbf0aba3d29fb882a46bec",
      "original_line" : 28,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/bench/duplicate_inputs.cpp",
      "position" : 5,
      "pull_request_review_id" : 655088834,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-09T15:47:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/628906943",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r628906955"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/628906955"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    CBlockIndex* pindexPrev = testing_setup->m_node.chainman->ActiveTip();\r\n```",
      "commit_id" : "b04370dbb55e61e168cbf0aba3d29fb882a46bec",
      "created_at" : "2021-05-09T15:38:28Z",
      "diff_hunk" : "@@ -25,7 +25,8 @@ static void DuplicateInputs(benchmark::Bench& bench)\n     CMutableTransaction naughtyTx{};\n \n     LOCK(cs_main);\n-    CBlockIndex* pindexPrev = ::ChainActive().Tip();\n+    assert(std::addressof(::ChainActive()) == std::addressof(testing_setup->m_node.chainman->ActiveChain()));\n+    CBlockIndex* pindexPrev = testing_setup->m_node.chainman->ActiveChain().Tip();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r628906955",
      "id" : 628906955,
      "line" : 29,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyODkwNjk1NQ==",
      "original_commit_id" : "b04370dbb55e61e168cbf0aba3d29fb882a46bec",
      "original_line" : 29,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/bench/duplicate_inputs.cpp",
      "position" : 6,
      "pull_request_review_id" : 655088834,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-09T15:47:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/628906955",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r628907425"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/628907425"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I really don't like `CChain` becoming part of chainstate's public interface. It's too low level - code outside validation shouldn't be interacting directly with that object and should be using higher level interface functions.",
      "commit_id" : "b04370dbb55e61e168cbf0aba3d29fb882a46bec",
      "created_at" : "2021-05-09T15:42:56Z",
      "diff_hunk" : "@@ -60,33 +60,34 @@ bool BaseIndex::Init()\n     }\n \n     LOCK(cs_main);\n+    CChain& active_chain = m_chainstate->m_chain;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r628907425",
      "id" : 628907425,
      "line" : 63,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyODkwNzQyNQ==",
      "original_commit_id" : "b04370dbb55e61e168cbf0aba3d29fb882a46bec",
      "original_line" : 63,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/index/base.cpp",
      "position" : 4,
      "pull_request_review_id" : 655088834,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-09T15:47:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/628907425",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r628907979"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/628907979"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Any reason that you decided to put this in the `Start()` method rather than the constructor. You have access to the `::ChainstateActive()` object at the point you construct the index objects.\r\n\r\nAdding this parameter to the ctor would allow you to set `m_chainstate` in the initializer list and make it a const member.",
      "commit_id" : "b04370dbb55e61e168cbf0aba3d29fb882a46bec",
      "created_at" : "2021-05-09T15:47:37Z",
      "diff_hunk" : "@@ -117,7 +119,7 @@ class BaseIndex : public CValidationInterface\n \n     /// Start initializes the sync state and registers the instance as a\n     /// ValidationInterface so that it stays in sync with blockchain updates.\n-    void Start();\n+    void Start(CChainState& active_chainstate);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r628907979",
      "id" : 628907979,
      "line" : 122,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyODkwNzk3OQ==",
      "original_commit_id" : "b04370dbb55e61e168cbf0aba3d29fb882a46bec",
      "original_line" : 122,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/index/base.h",
      "position" : 24,
      "pull_request_review_id" : 655088834,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-09T15:47:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/628907979",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r630759329"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/630759329"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is the 4th time the same function gets changed around. I think we should decide what to settle on, and ideally provide a rationale for it. \r\n\r\nhttps://github.com/bitcoin/bitcoin/pull/21391#discussion_r615237925",
      "commit_id" : "b04370dbb55e61e168cbf0aba3d29fb882a46bec",
      "created_at" : "2021-05-12T06:30:02Z",
      "diff_hunk" : "@@ -203,6 +203,6 @@ void IncrementExtraNonce(CBlock* pblock, const CBlockIndex* pindexPrev, unsigned\n int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParams, const CBlockIndex* pindexPrev);\n \n /** Update an old GenerateCoinbaseCommitment from CreateNewBlock after the block txs have changed */\n-void RegenerateCommitments(CBlock& block, CBlockIndex* prev_block);\n+void RegenerateCommitments(CBlock& block, ChainstateManager& chainman);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r630759329",
      "id" : 630759329,
      "in_reply_to_id" : 628906795,
      "line" : 206,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMDc1OTMyOQ==",
      "original_commit_id" : "b04370dbb55e61e168cbf0aba3d29fb882a46bec",
      "original_line" : 206,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/miner.h",
      "position" : 5,
      "pull_request_review_id" : 657504641,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-12T06:30:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/630759329",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r630759634"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/630759634"
         }
      },
      "author_association" : "MEMBER",
      "body" : "What is the point of running a bitcoin full node without a blockchain?",
      "commit_id" : "b04370dbb55e61e168cbf0aba3d29fb882a46bec",
      "created_at" : "2021-05-12T06:30:41Z",
      "diff_hunk" : "@@ -107,6 +107,27 @@ static CTxMemPool* GetMemPool(const std::any& context, HTTPRequest* req)\n     return node_context->mempool.get();\n }\n \n+/**\n+ * Get the node context chainstatemanager.\n+ *\n+ * @param[in]  req The HTTP request, whose status code will be set if node\n+ *                 context chainstatemanager is not found.\n+ * @returns        Pointer to the chainstatemanager or nullptr if none found.\n+ */\n+static ChainstateManager* GetChainman(const std::any& context, HTTPRequest* req)\n+{\n+    auto node_context = util::AnyPtr<NodeContext>(context);\n+    if (!node_context || !node_context->chainman) {\n+        RESTERR(req, HTTP_INTERNAL_SERVER_ERROR,\n+                strprintf(\"%s:%d (%s)\\n\"\n+                          \"Internal bug detected: Chainman disabled or instance not found!\\n\"\n+                          \"You may report this issue here: %s\\n\",\n+                          __FILE__, __LINE__, __func__, PACKAGE_BUGREPORT));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r630759634",
      "id" : 630759634,
      "in_reply_to_id" : 628905295,
      "line" : 125,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMDc1OTYzNA==",
      "original_commit_id" : "b04370dbb55e61e168cbf0aba3d29fb882a46bec",
      "original_line" : 125,
      "original_position" : 19,
      "original_start_line" : 123,
      "path" : "src/rest.cpp",
      "position" : 19,
      "pull_request_review_id" : 657505087,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : 123,
      "start_side" : "RIGHT",
      "updated_at" : "2021-05-12T06:30:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/630759634",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r630813812"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/630813812"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Testing mostly, but you could also imagine using Bitcoin Core as an addr relayer without a blockchain (eg http://www.erisian.com.au/bitcoin-core-dev/log-2020-12-16.html#l-583), or serving compact block indexes.",
      "commit_id" : "b04370dbb55e61e168cbf0aba3d29fb882a46bec",
      "created_at" : "2021-05-12T08:01:11Z",
      "diff_hunk" : "@@ -107,6 +107,27 @@ static CTxMemPool* GetMemPool(const std::any& context, HTTPRequest* req)\n     return node_context->mempool.get();\n }\n \n+/**\n+ * Get the node context chainstatemanager.\n+ *\n+ * @param[in]  req The HTTP request, whose status code will be set if node\n+ *                 context chainstatemanager is not found.\n+ * @returns        Pointer to the chainstatemanager or nullptr if none found.\n+ */\n+static ChainstateManager* GetChainman(const std::any& context, HTTPRequest* req)\n+{\n+    auto node_context = util::AnyPtr<NodeContext>(context);\n+    if (!node_context || !node_context->chainman) {\n+        RESTERR(req, HTTP_INTERNAL_SERVER_ERROR,\n+                strprintf(\"%s:%d (%s)\\n\"\n+                          \"Internal bug detected: Chainman disabled or instance not found!\\n\"\n+                          \"You may report this issue here: %s\\n\",\n+                          __FILE__, __LINE__, __func__, PACKAGE_BUGREPORT));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r630813812",
      "id" : 630813812,
      "in_reply_to_id" : 628905295,
      "line" : 125,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMDgxMzgxMg==",
      "original_commit_id" : "b04370dbb55e61e168cbf0aba3d29fb882a46bec",
      "original_line" : 125,
      "original_position" : 19,
      "original_start_line" : 123,
      "path" : "src/rest.cpp",
      "position" : 19,
      "pull_request_review_id" : 657578304,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : 123,
      "start_side" : "RIGHT",
      "updated_at" : "2021-05-12T08:01:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/630813812",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r630827371"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/630827371"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think fundamentally the issue here is with `generateblock()`, which calls into miner.cpp to construct the block, then changes the transactions in that block, and then calls back into miner.cpp to fix up the coinbase commitment. It'd be a much simpler interface if `generateblock()` just passed in a const ref to the vector of transactions it wants to include in its first call to miner.cpp.\r\n\r\nI'm going to mark this comment as resolved. The mining code is a bit of a mess, and can be cleaned up in other PRs.",
      "commit_id" : "b04370dbb55e61e168cbf0aba3d29fb882a46bec",
      "created_at" : "2021-05-12T08:20:04Z",
      "diff_hunk" : "@@ -203,6 +203,6 @@ void IncrementExtraNonce(CBlock* pblock, const CBlockIndex* pindexPrev, unsigned\n int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParams, const CBlockIndex* pindexPrev);\n \n /** Update an old GenerateCoinbaseCommitment from CreateNewBlock after the block txs have changed */\n-void RegenerateCommitments(CBlock& block, CBlockIndex* prev_block);\n+void RegenerateCommitments(CBlock& block, ChainstateManager& chainman);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r630827371",
      "id" : 630827371,
      "in_reply_to_id" : 628906795,
      "line" : 206,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMDgyNzM3MQ==",
      "original_commit_id" : "b04370dbb55e61e168cbf0aba3d29fb882a46bec",
      "original_line" : 206,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/miner.h",
      "position" : 5,
      "pull_request_review_id" : 657596443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-12T08:20:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/630827371",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-05-12T14:26:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#issuecomment-839817501",
      "id" : 839817501,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21767",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgzOTgxNzUwMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-12T14:26:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/839817501",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, full review soon",
      "created_at" : "2021-05-12T17:06:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#issuecomment-839946136",
      "id" : 839946136,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21767",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgzOTk0NjEzNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-12T17:06:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/839946136",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r635558895"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/635558895"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I believe I did this mostly because ctors are not inherited, whereas methods are. If I were to make `m_chainstate` be a const member and initialized in the ctor, I'd have to change the ctor of every subclass.",
      "commit_id" : "6ef9163cc4604177fbdab5b644f7b2af7a33204b",
      "created_at" : "2021-05-19T20:23:25Z",
      "diff_hunk" : "@@ -117,7 +119,7 @@ class BaseIndex : public CValidationInterface\n \n     /// Start initializes the sync state and registers the instance as a\n     /// ValidationInterface so that it stays in sync with blockchain updates.\n-    void Start();\n+    void Start(CChainState& active_chainstate);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r635558895",
      "id" : 635558895,
      "in_reply_to_id" : 628907979,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNTU1ODg5NQ==",
      "original_commit_id" : "b04370dbb55e61e168cbf0aba3d29fb882a46bec",
      "original_line" : 122,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/index/base.h",
      "position" : null,
      "pull_request_review_id" : 663627936,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-19T20:23:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/635558895",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r635561010"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/635561010"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Do you mean the `m_chain` member specifically or any kind of `CChain`? It seems that we were already using a `CChain` previously when we were caling `::ChainActive()`. Happy to document and add to #21766 so nothing gets lost!",
      "commit_id" : "6ef9163cc4604177fbdab5b644f7b2af7a33204b",
      "created_at" : "2021-05-19T20:26:56Z",
      "diff_hunk" : "@@ -60,33 +60,34 @@ bool BaseIndex::Init()\n     }\n \n     LOCK(cs_main);\n+    CChain& active_chain = m_chainstate->m_chain;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r635561010",
      "id" : 635561010,
      "in_reply_to_id" : 628907425,
      "line" : 63,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNTU2MTAxMA==",
      "original_commit_id" : "b04370dbb55e61e168cbf0aba3d29fb882a46bec",
      "original_line" : 63,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/index/base.cpp",
      "position" : 4,
      "pull_request_review_id" : 663630777,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-19T20:26:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/635561010",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r635563120"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/635563120"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I've been making changes with the assumption that chainman is considered absolutely necessary. If we decide that running bitcoin without a chainman is a usecase we want to support, I think we can have a separate discussion about that. Added to: #21766",
      "commit_id" : "6ef9163cc4604177fbdab5b644f7b2af7a33204b",
      "created_at" : "2021-05-19T20:30:20Z",
      "diff_hunk" : "@@ -107,6 +107,27 @@ static CTxMemPool* GetMemPool(const std::any& context, HTTPRequest* req)\n     return node_context->mempool.get();\n }\n \n+/**\n+ * Get the node context chainstatemanager.\n+ *\n+ * @param[in]  req The HTTP request, whose status code will be set if node\n+ *                 context chainstatemanager is not found.\n+ * @returns        Pointer to the chainstatemanager or nullptr if none found.\n+ */\n+static ChainstateManager* GetChainman(const std::any& context, HTTPRequest* req)\n+{\n+    auto node_context = util::AnyPtr<NodeContext>(context);\n+    if (!node_context || !node_context->chainman) {\n+        RESTERR(req, HTTP_INTERNAL_SERVER_ERROR,\n+                strprintf(\"%s:%d (%s)\\n\"\n+                          \"Internal bug detected: Chainman disabled or instance not found!\\n\"\n+                          \"You may report this issue here: %s\\n\",\n+                          __FILE__, __LINE__, __func__, PACKAGE_BUGREPORT));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r635563120",
      "id" : 635563120,
      "in_reply_to_id" : 628905295,
      "line" : 125,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNTU2MzEyMA==",
      "original_commit_id" : "b04370dbb55e61e168cbf0aba3d29fb882a46bec",
      "original_line" : 125,
      "original_position" : 19,
      "original_start_line" : 123,
      "path" : "src/rest.cpp",
      "position" : 19,
      "pull_request_review_id" : 663633450,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : 123,
      "start_side" : "RIGHT",
      "updated_at" : "2021-05-19T20:30:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/635563120",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r635564717"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/635564717"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't think it necessarily has to be (at least not before more of AssumeUTXO is merged), in any case Bundle 7 will remove all of these assertions!",
      "commit_id" : "6ef9163cc4604177fbdab5b644f7b2af7a33204b",
      "created_at" : "2021-05-19T20:33:07Z",
      "diff_hunk" : "@@ -25,7 +25,8 @@ static void DuplicateInputs(benchmark::Bench& bench)\n     CMutableTransaction naughtyTx{};\n \n     LOCK(cs_main);\n-    CBlockIndex* pindexPrev = ::ChainActive().Tip();\n+    assert(std::addressof(::ChainActive()) == std::addressof(testing_setup->m_node.chainman->ActiveChain()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r635564717",
      "id" : 635564717,
      "in_reply_to_id" : 628906943,
      "line" : 28,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNTU2NDcxNw==",
      "original_commit_id" : "b04370dbb55e61e168cbf0aba3d29fb882a46bec",
      "original_line" : 28,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/bench/duplicate_inputs.cpp",
      "position" : 5,
      "pull_request_review_id" : 663635555,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-19T20:33:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/635564717",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Pushed b04370dbb55e61e168cbf0aba3d29fb882a46bec -> 6ef9163cc4604177fbdab5b644f7b2af7a33204b\r\n- Rebased over master",
      "created_at" : "2021-05-19T20:45:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#issuecomment-844459136",
      "id" : 844459136,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21767",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg0NDQ1OTEzNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-19T20:45:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/844459136",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r637169193"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/637169193"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In \"rest: Add GetChainman function and use it\"\r\n\r\nDo you have pointers to inform reviewers about `EnsureAnyChainman` causing crashes in REST contexts ?",
      "commit_id" : "6ef9163cc4604177fbdab5b644f7b2af7a33204b",
      "created_at" : "2021-05-21T19:22:09Z",
      "diff_hunk" : "@@ -107,6 +107,27 @@ static CTxMemPool* GetMemPool(const std::any& context, HTTPRequest* req)\n     return node_context->mempool.get();\n }\n \n+/**\n+ * Get the node context chainstatemanager.\n+ *\n+ * @param[in]  req The HTTP request, whose status code will be set if node\n+ *                 context chainstatemanager is not found.\n+ * @returns        Pointer to the chainstatemanager or nullptr if none found.\n+ */\n+static ChainstateManager* GetChainman(const std::any& context, HTTPRequest* req)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r637169193",
      "id" : 637169193,
      "line" : 117,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNzE2OTE5Mw==",
      "original_commit_id" : "c83488835832be21f865f43c8fdb5de327694dcb",
      "original_line" : 117,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : 11,
      "pull_request_review_id" : 665803997,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-21T20:19:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/637169193",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r637201920"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/637201920"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: Add comment \"Provide access to the active chainstate, containing the current most-work chain\". Maybe even as a member name `m_active_chainstate`",
      "commit_id" : "6ef9163cc4604177fbdab5b644f7b2af7a33204b",
      "created_at" : "2021-05-21T20:06:24Z",
      "diff_hunk" : "@@ -75,8 +76,9 @@ class BaseIndex : public CValidationInterface\n     /// to a chain reorganization), the index must halt until Commit succeeds or else it could end up\n     /// getting corrupted.\n     bool Commit();\n-\n protected:\n+    CChainState* m_chainstate{nullptr};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r637201920",
      "id" : 637201920,
      "line" : 80,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNzIwMTkyMA==",
      "original_commit_id" : "f9222a0cb5f3ec56db1b04b061fa136a488353eb",
      "original_line" : 80,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/index/base.h",
      "position" : 14,
      "pull_request_review_id" : 665803997,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-21T20:19:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/637201920",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r637599151"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/637599151"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: could have used std::optional for prettiness ð ",
      "commit_id" : "6ef9163cc4604177fbdab5b644f7b2af7a33204b",
      "created_at" : "2021-05-23T20:46:09Z",
      "diff_hunk" : "@@ -107,6 +107,27 @@ static CTxMemPool* GetMemPool(const std::any& context, HTTPRequest* req)\n     return node_context->mempool.get();\n }\n \n+/**\n+ * Get the node context chainstatemanager.\n+ *\n+ * @param[in]  req The HTTP request, whose status code will be set if node\n+ *                 context chainstatemanager is not found.\n+ * @returns        Pointer to the chainstatemanager or nullptr if none found.\n+ */\n+static ChainstateManager* GetChainman(const std::any& context, HTTPRequest* req)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r637599151",
      "id" : 637599151,
      "line" : 117,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNzU5OTE1MQ==",
      "original_commit_id" : "c83488835832be21f865f43c8fdb5de327694dcb",
      "original_line" : 117,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : 11,
      "pull_request_review_id" : 666303706,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-23T21:20:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/637599151",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r640855990"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/640855990"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Would be happy to add to PR if you supply a simple enough diff!",
      "commit_id" : "7a799c9c2b8652e780d1fd5e1bf7d05b026c1c1a",
      "created_at" : "2021-05-27T18:06:30Z",
      "diff_hunk" : "@@ -107,6 +107,27 @@ static CTxMemPool* GetMemPool(const std::any& context, HTTPRequest* req)\n     return node_context->mempool.get();\n }\n \n+/**\n+ * Get the node context chainstatemanager.\n+ *\n+ * @param[in]  req The HTTP request, whose status code will be set if node\n+ *                 context chainstatemanager is not found.\n+ * @returns        Pointer to the chainstatemanager or nullptr if none found.\n+ */\n+static ChainstateManager* GetChainman(const std::any& context, HTTPRequest* req)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r640855990",
      "id" : 640855990,
      "in_reply_to_id" : 637599151,
      "line" : 117,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDg1NTk5MA==",
      "original_commit_id" : "c83488835832be21f865f43c8fdb5de327694dcb",
      "original_line" : 117,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : 11,
      "pull_request_review_id" : 670494721,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-27T18:06:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/640855990",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Pushed 6ef9163cc4604177fbdab5b644f7b2af7a33204b -> 7a799c9c2b8652e780d1fd5e1bf7d05b026c1c1a\r\n- Added REST crash explanation to commit message per: https://github.com/bitcoin/bitcoin/pull/21767#discussion_r637169193",
      "created_at" : "2021-05-27T18:07:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#issuecomment-849834091",
      "id" : 849834091,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21767",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg0OTgzNDA5MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-27T18:07:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/849834091",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r640857749"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/640857749"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Added in commit message",
      "commit_id" : "7a799c9c2b8652e780d1fd5e1bf7d05b026c1c1a",
      "created_at" : "2021-05-27T18:08:06Z",
      "diff_hunk" : "@@ -107,6 +107,27 @@ static CTxMemPool* GetMemPool(const std::any& context, HTTPRequest* req)\n     return node_context->mempool.get();\n }\n \n+/**\n+ * Get the node context chainstatemanager.\n+ *\n+ * @param[in]  req The HTTP request, whose status code will be set if node\n+ *                 context chainstatemanager is not found.\n+ * @returns        Pointer to the chainstatemanager or nullptr if none found.\n+ */\n+static ChainstateManager* GetChainman(const std::any& context, HTTPRequest* req)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r640857749",
      "id" : 640857749,
      "in_reply_to_id" : 637169193,
      "line" : 117,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDg1Nzc0OQ==",
      "original_commit_id" : "c83488835832be21f865f43c8fdb5de327694dcb",
      "original_line" : 117,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : 11,
      "pull_request_review_id" : 670496052,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-27T18:08:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/640857749",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r640858184"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/640858184"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Not sure `m_active_chainstate` makes too much sense here, as in the index context, this member means \"the active chainstate at the time when `<Index>::Start` was called\"",
      "commit_id" : "7a799c9c2b8652e780d1fd5e1bf7d05b026c1c1a",
      "created_at" : "2021-05-27T18:08:45Z",
      "diff_hunk" : "@@ -75,8 +76,9 @@ class BaseIndex : public CValidationInterface\n     /// to a chain reorganization), the index must halt until Commit succeeds or else it could end up\n     /// getting corrupted.\n     bool Commit();\n-\n protected:\n+    CChainState* m_chainstate{nullptr};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r640858184",
      "id" : 640858184,
      "in_reply_to_id" : 637201920,
      "line" : 80,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDg1ODE4NA==",
      "original_commit_id" : "f9222a0cb5f3ec56db1b04b061fa136a488353eb",
      "original_line" : 80,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/index/base.h",
      "position" : 14,
      "pull_request_review_id" : 670496591,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-27T18:09:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/640858184",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ACK  7a799c9\r\n\r\nEasy to follow what's going on, the assert statements and tests also give assurance to there being no change in behavior. Nice to see how this gets wrapped up on the next bundle.",
      "created_at" : "2021-05-28T01:59:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#issuecomment-850056378",
      "id" : 850056378,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21767",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg1MDA1NjM3OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-28T01:59:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/850056378",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23396902?v=4",
         "events_url" : "https://api.github.com/users/jarolrod/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jarolrod/followers",
         "following_url" : "https://api.github.com/users/jarolrod/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jarolrod/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jarolrod",
         "id" : 23396902,
         "login" : "jarolrod",
         "node_id" : "MDQ6VXNlcjIzMzk2OTAy",
         "organizations_url" : "https://api.github.com/users/jarolrod/orgs",
         "received_events_url" : "https://api.github.com/users/jarolrod/received_events",
         "repos_url" : "https://api.github.com/users/jarolrod/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jarolrod/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jarolrod/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jarolrod"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r641727406"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/641727406"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sure, it's just with assumeutxo, we start to have multiple chainstate references through the codebase (`m_ibd_chainstate`, `m_snapshot_chainstate`, `m_m_active_chainstate`) and it could be confusing in the future. I don't think it changes anything for the indexes rn.",
      "commit_id" : "7a799c9c2b8652e780d1fd5e1bf7d05b026c1c1a",
      "created_at" : "2021-05-28T18:08:59Z",
      "diff_hunk" : "@@ -75,8 +76,9 @@ class BaseIndex : public CValidationInterface\n     /// to a chain reorganization), the index must halt until Commit succeeds or else it could end up\n     /// getting corrupted.\n     bool Commit();\n-\n protected:\n+    CChainState* m_chainstate{nullptr};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r641727406",
      "id" : 641727406,
      "in_reply_to_id" : 637201920,
      "line" : 80,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MTcyNzQwNg==",
      "original_commit_id" : "f9222a0cb5f3ec56db1b04b061fa136a488353eb",
      "original_line" : 80,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/index/base.h",
      "position" : 14,
      "pull_request_review_id" : 671539146,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-28T18:08:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/641727406",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code Review ACK 7a799c9",
      "created_at" : "2021-05-28T18:09:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#issuecomment-850584902",
      "id" : 850584902,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21767",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg1MDU4NDkwMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-28T18:09:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/850584902",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r641777198"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/641777198"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Hm, shouldn't we be asserting here (instead of assigning) to preserve behavior?\r\nEdit: not sure what practical difference that would have if any.",
      "commit_id" : "7a799c9c2b8652e780d1fd5e1bf7d05b026c1c1a",
      "created_at" : "2021-05-28T19:34:31Z",
      "diff_hunk" : "@@ -39,13 +39,21 @@ int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParam\n     return nNewTime - nOldTime;\n }\n \n-void RegenerateCommitments(CBlock& block, CBlockIndex* prev_block)\n+void RegenerateCommitments(CBlock& block, ChainstateManager& chainman)\n {\n     CMutableTransaction tx{*block.vtx.at(0)};\n     tx.vout.erase(tx.vout.begin() + GetWitnessCommitmentIndex(block));\n     block.vtx.at(0) = MakeTransactionRef(tx);\n \n-    WITH_LOCK(::cs_main, assert(g_chainman.m_blockman.LookupBlockIndex(block.hashPrevBlock) == prev_block));\n+    CBlockIndex* prev_block;\n+    {\n+        // TODO: Temporary scope to check correctness of refactored code.\n+        // Should be removed manually after merge of\n+        // https://github.com/bitcoin/bitcoin/pull/20158\n+        LOCK(::cs_main);\n+        assert(std::addressof(g_chainman.m_blockman) == std::addressof(chainman.m_blockman));\n+        prev_block = chainman.m_blockman.LookupBlockIndex(block.hashPrevBlock);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r641777198",
      "id" : 641777198,
      "line" : 55,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MTc3NzE5OA==",
      "original_commit_id" : "e6b4aa6eb53dc555ecab2922af35e7a2572faf4f",
      "original_line" : 55,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/miner.cpp",
      "position" : 19,
      "pull_request_review_id" : 671593219,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-28T19:35:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/641777198",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r641791366"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/641791366"
         }
      },
      "author_association" : "MEMBER",
      "body" : "To @ariard's point, we will likely have to facilitate changing this pointer mid-execution when the user calls `ActivateSnapshot()`. I'll have to warm my caches on the indexing stuff a little more, but IIRC we want this class instance to have a reference to the current active chainstate (which obviously will be liable to change as assumeutxo progresses).",
      "commit_id" : "7a799c9c2b8652e780d1fd5e1bf7d05b026c1c1a",
      "created_at" : "2021-05-28T20:06:38Z",
      "diff_hunk" : "@@ -75,8 +76,9 @@ class BaseIndex : public CValidationInterface\n     /// to a chain reorganization), the index must halt until Commit succeeds or else it could end up\n     /// getting corrupted.\n     bool Commit();\n-\n protected:\n+    CChainState* m_chainstate{nullptr};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r641791366",
      "id" : 641791366,
      "in_reply_to_id" : 637201920,
      "line" : 80,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MTc5MTM2Ng==",
      "original_commit_id" : "f9222a0cb5f3ec56db1b04b061fa136a488353eb",
      "original_line" : 80,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/index/base.h",
      "position" : 14,
      "pull_request_review_id" : 671611341,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-28T20:06:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/641791366",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r641792021"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/641792021"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That said, the reduction of global use is an obvious win, and it should be pretty easy to facilitate changing `m_chainstate` via some method that can be called by `ActivateSnapshot()`.",
      "commit_id" : "7a799c9c2b8652e780d1fd5e1bf7d05b026c1c1a",
      "created_at" : "2021-05-28T20:08:13Z",
      "diff_hunk" : "@@ -75,8 +76,9 @@ class BaseIndex : public CValidationInterface\n     /// to a chain reorganization), the index must halt until Commit succeeds or else it could end up\n     /// getting corrupted.\n     bool Commit();\n-\n protected:\n+    CChainState* m_chainstate{nullptr};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r641792021",
      "id" : 641792021,
      "in_reply_to_id" : 637201920,
      "line" : 80,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MTc5MjAyMQ==",
      "original_commit_id" : "f9222a0cb5f3ec56db1b04b061fa136a488353eb",
      "original_line" : 80,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/index/base.h",
      "position" : 14,
      "pull_request_review_id" : 671612184,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-28T20:08:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/641792021",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r641795958"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/641795958"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Might even just make sense to pass in a `ChainstateManager` instance to keep with this class... but that can be done in a follow-up.",
      "commit_id" : "7a799c9c2b8652e780d1fd5e1bf7d05b026c1c1a",
      "created_at" : "2021-05-28T20:17:51Z",
      "diff_hunk" : "@@ -75,8 +76,9 @@ class BaseIndex : public CValidationInterface\n     /// to a chain reorganization), the index must halt until Commit succeeds or else it could end up\n     /// getting corrupted.\n     bool Commit();\n-\n protected:\n+    CChainState* m_chainstate{nullptr};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r641795958",
      "id" : 641795958,
      "in_reply_to_id" : 637201920,
      "line" : 80,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MTc5NTk1OA==",
      "original_commit_id" : "f9222a0cb5f3ec56db1b04b061fa136a488353eb",
      "original_line" : 80,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/index/base.h",
      "position" : 14,
      "pull_request_review_id" : 671617299,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-28T20:17:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/641795958",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r642130503"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/642130503"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Something like this maybe, if have to retouch: https://github.com/fjahr/bitcoin/commit/69187f82b1227cc33bc5733c742b8f8b9fcefea3",
      "commit_id" : "7a799c9c2b8652e780d1fd5e1bf7d05b026c1c1a",
      "created_at" : "2021-05-30T21:25:33Z",
      "diff_hunk" : "@@ -107,6 +107,27 @@ static CTxMemPool* GetMemPool(const std::any& context, HTTPRequest* req)\n     return node_context->mempool.get();\n }\n \n+/**\n+ * Get the node context chainstatemanager.\n+ *\n+ * @param[in]  req The HTTP request, whose status code will be set if node\n+ *                 context chainstatemanager is not found.\n+ * @returns        Pointer to the chainstatemanager or nullptr if none found.\n+ */\n+static ChainstateManager* GetChainman(const std::any& context, HTTPRequest* req)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r642130503",
      "id" : 642130503,
      "in_reply_to_id" : 637599151,
      "line" : 117,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MjEzMDUwMw==",
      "original_commit_id" : "c83488835832be21f865f43c8fdb5de327694dcb",
      "original_line" : 117,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : 11,
      "pull_request_review_id" : 671865574,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-30T21:25:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/642130503",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "re-ACK 7a799c9c2b8652e780d1fd5e1bf7d05b026c1c1a",
      "created_at" : "2021-05-30T21:27:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#issuecomment-851063809",
      "id" : 851063809,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21767",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg1MTA2MzgwOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-30T21:27:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/851063809",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r642977388"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/642977388"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This creates a copy of chainman, no?",
      "commit_id" : "7a799c9c2b8652e780d1fd5e1bf7d05b026c1c1a",
      "created_at" : "2021-06-01T10:24:35Z",
      "diff_hunk" : "@@ -107,6 +107,27 @@ static CTxMemPool* GetMemPool(const std::any& context, HTTPRequest* req)\n     return node_context->mempool.get();\n }\n \n+/**\n+ * Get the node context chainstatemanager.\n+ *\n+ * @param[in]  req The HTTP request, whose status code will be set if node\n+ *                 context chainstatemanager is not found.\n+ * @returns        Pointer to the chainstatemanager or nullptr if none found.\n+ */\n+static ChainstateManager* GetChainman(const std::any& context, HTTPRequest* req)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r642977388",
      "id" : 642977388,
      "in_reply_to_id" : 637599151,
      "line" : 117,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0Mjk3NzM4OA==",
      "original_commit_id" : "c83488835832be21f865f43c8fdb5de327694dcb",
      "original_line" : 117,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : 11,
      "pull_request_review_id" : 672905845,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-01T10:24:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/642977388",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "review ACK 7a799c9c2b8652e780d1fd5e1bf7d05b026c1c1a ð \r\n\r\n<details><summary>Show signature and timestamp</summary>\r\n\r\nSignature:\r\n\r\n```\r\n-----BEGIN PGP SIGNED MESSAGE-----\r\nHash: SHA512\r\n\r\nreview ACK 7a799c9c2b8652e780d1fd5e1bf7d05b026c1c1a ð \r\n-----BEGIN PGP SIGNATURE-----\r\n\r\niQGzBAEBCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\r\npUgnkAv/eYSF8/6fmyM3n1fjSVmbmXT74brAbRsg0tMEuWb0rtk603x8E8QSAAot\r\nPCSICg/oAsOXVIzdxOWNYpqhEiceILJNlQTjuNfswOu0cgJNNqCp/sYX3nWrlmaW\r\n9dqsK0zMMLjnC/U2xzSzvvU6id++ipSQlyWkbAjt+n7UorVd2A8wCdQMrMCQejpz\r\npFB1K25WAH7KYiDIwLxy1ZWO/x094gQaVSk6DfIu+KhUSQTL03QunHCFjN3Fyoey\r\n8drI7oGaL0GtA6mcZHjApXhJG4ts7kYI39WJ8zD9wIHotQ1e9earLar9L28WwCRE\r\nfhdCBtjHGSTf1V6WKOZFkvYVbMyxQhyUVqdSwsZzlcNB7szkUJfmLZTMNSfKKYBS\r\nMPuNUM5MCB9/atp2+YVEvCw3TdaXHxNJ1JDLvuFMAMOvCD5BuGrZklYKW2FhP4Ar\r\nMsMO6AoCfzHJUVvdWlsxWYneMlN37Eg428rZOw9lUH9rdWavMMskwpcUe8MaYY5w\r\ne3hP/g/H\r\n=P/4c\r\n-----END PGP SIGNATURE-----\r\n```\r\n\r\n[Timestamp of file with hash `e8caa0bbe435d430361ec68dd841345069e815f61d2cf90bf463dd41e3290516  -`](https://opentimestamps.org/info/?004f70656e54696d657374616d7073000050726f6f6600bf89e2e884e892940108e8caa0bbe435d430361ec68dd841345069e815f61d2cf90bf463dd41e3290516f010db371f291dcd7e4ee32989791a2f703408fff0102cd1cc3b289d479285b9b3314ffe257d08f10460b61788f0087d6c1e1ebfea06140083dfe30d2ef90c8e2e2d68747470733a2f2f616c6963652e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267fff0102e0740c1f9448775dc49479281075d9708f10460b61788f00837100840f65255910083dfe30d2ef90c8e2c2b68747470733a2f2f626f622e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267f010a8588cd95ed21e4a51deb7538bc4aebb08f10460b61787f008e651d53631cd2fc20083dfe30d2ef90c8e232268747470733a2f2f6274632e63616c656e6461722e636174616c6c6178792e636f6d)\r\n\r\n</details>\r\n",
      "created_at" : "2021-06-01T11:18:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#issuecomment-852043606",
      "id" : 852043606,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21767",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg1MjA0MzYwNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-01T11:18:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/852043606",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r644361155"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/644361155"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "So `::RegenerateCommitments` has been changed a few times now:\r\n1. In 2c3ba00693, where we passed in a `BlockManager`, instead of reaching for `g_chainman.m_blockman`\r\n    - Because we don't want to reach for globals anymore (the overall point of this PR series)\r\n2. In cced0f46c9, where we passed in the specific `CBlockIndex` instead of a `BlockManager`\r\n    - Because it is a more specific validation-related object than `BlockManager`\r\n3. In e6b4aa6eb5, where we pass in a `ChainstateManger` instead of the specific `CBlockIndex`\r\n    - Because then we don't have to worry about callers violating the invariant checked here: https://github.com/bitcoin/bitcoin/blob/cced0f46c9133e0fc6211e987421ad1d9be1a399/src/miner.cpp#L48 \r\n\r\nJust to be clear, the original behaviour does not do any checking/assertions:\r\nhttps://github.com/bitcoin/bitcoin/blob/2afcf24408b4453e4418ebfb326b141f6ea8647c/src/miner.cpp#L42-L51\r\n\r\nSo overall, I don't think an behaviour has changed, and I think we should just go with the current one since the few versions we've tried are all functionally equivalent. Thanks for the careful review tho! :-)",
      "commit_id" : "7a799c9c2b8652e780d1fd5e1bf7d05b026c1c1a",
      "created_at" : "2021-06-02T22:29:25Z",
      "diff_hunk" : "@@ -39,13 +39,21 @@ int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParam\n     return nNewTime - nOldTime;\n }\n \n-void RegenerateCommitments(CBlock& block, CBlockIndex* prev_block)\n+void RegenerateCommitments(CBlock& block, ChainstateManager& chainman)\n {\n     CMutableTransaction tx{*block.vtx.at(0)};\n     tx.vout.erase(tx.vout.begin() + GetWitnessCommitmentIndex(block));\n     block.vtx.at(0) = MakeTransactionRef(tx);\n \n-    WITH_LOCK(::cs_main, assert(g_chainman.m_blockman.LookupBlockIndex(block.hashPrevBlock) == prev_block));\n+    CBlockIndex* prev_block;\n+    {\n+        // TODO: Temporary scope to check correctness of refactored code.\n+        // Should be removed manually after merge of\n+        // https://github.com/bitcoin/bitcoin/pull/20158\n+        LOCK(::cs_main);\n+        assert(std::addressof(g_chainman.m_blockman) == std::addressof(chainman.m_blockman));\n+        prev_block = chainman.m_blockman.LookupBlockIndex(block.hashPrevBlock);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r644361155",
      "id" : 644361155,
      "in_reply_to_id" : 641777198,
      "line" : 55,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NDM2MTE1NQ==",
      "original_commit_id" : "e6b4aa6eb53dc555ecab2922af35e7a2572faf4f",
      "original_line" : 55,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/miner.cpp",
      "position" : 19,
      "pull_request_review_id" : 674733060,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-02T22:31:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/644361155",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r645530719"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/645530719"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@fjahr I think the branch is invalid because you're trying to move from the global `g_chainman`.\r\n\r\nIn general, the usage of algebraic sum types like std::optional or std::variant isn't for prettiness - it's to entirely remove the possibility of being in an invalid program state.",
      "commit_id" : "7a799c9c2b8652e780d1fd5e1bf7d05b026c1c1a",
      "created_at" : "2021-06-04T12:28:16Z",
      "diff_hunk" : "@@ -107,6 +107,27 @@ static CTxMemPool* GetMemPool(const std::any& context, HTTPRequest* req)\n     return node_context->mempool.get();\n }\n \n+/**\n+ * Get the node context chainstatemanager.\n+ *\n+ * @param[in]  req The HTTP request, whose status code will be set if node\n+ *                 context chainstatemanager is not found.\n+ * @returns        Pointer to the chainstatemanager or nullptr if none found.\n+ */\n+static ChainstateManager* GetChainman(const std::any& context, HTTPRequest* req)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r645530719",
      "id" : 645530719,
      "in_reply_to_id" : 637599151,
      "line" : 117,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NTUzMDcxOQ==",
      "original_commit_id" : "c83488835832be21f865f43c8fdb5de327694dcb",
      "original_line" : 117,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : 11,
      "pull_request_review_id" : 676232105,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-04T12:28:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/645530719",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r646101735"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/646101735"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ok, never mind, I guess since there is no optional reference in std this wasn't a good idea after all.",
      "commit_id" : "7a799c9c2b8652e780d1fd5e1bf7d05b026c1c1a",
      "created_at" : "2021-06-06T09:12:06Z",
      "diff_hunk" : "@@ -107,6 +107,27 @@ static CTxMemPool* GetMemPool(const std::any& context, HTTPRequest* req)\n     return node_context->mempool.get();\n }\n \n+/**\n+ * Get the node context chainstatemanager.\n+ *\n+ * @param[in]  req The HTTP request, whose status code will be set if node\n+ *                 context chainstatemanager is not found.\n+ * @returns        Pointer to the chainstatemanager or nullptr if none found.\n+ */\n+static ChainstateManager* GetChainman(const std::any& context, HTTPRequest* req)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21767#discussion_r646101735",
      "id" : 646101735,
      "in_reply_to_id" : 637599151,
      "line" : 117,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NjEwMTczNQ==",
      "original_commit_id" : "c83488835832be21f865f43c8fdb5de327694dcb",
      "original_line" : 117,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/rest.cpp",
      "position" : 11,
      "pull_request_review_id" : 676844423,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21767",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-06T09:12:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/646101735",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   }
]
