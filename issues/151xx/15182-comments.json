[
   {
      "author_association" : "MEMBER",
      "body" : "Do you have any benchmarks that show this is actually faster?",
      "created_at" : "2019-01-16T17:17:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15182#issuecomment-454862890",
      "id" : 454862890,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15182",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NDg2Mjg5MA==",
      "updated_at" : "2019-01-16T17:17:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/454862890",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Do you have any benchmarks that show this is actually faster?\r\n\r\nI wouldn't expect much performance gain, these are small vectors. I think reserving is mostly a gain when there's a large number of pushes.\r\n\r\nHow did you come to optimizing these specific functions? Did they show up in a profiling result?\r\n",
      "created_at" : "2019-01-16T17:37:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15182#issuecomment-454870021",
      "id" : 454870021,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15182",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NDg3MDAyMQ==",
      "updated_at" : "2019-01-16T17:37:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/454870021",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This code isn't performance critical. IMO simple code is preferred.",
      "created_at" : "2019-01-16T17:39:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15182#issuecomment-454871002",
      "id" : 454871002,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15182",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NDg3MTAwMg==",
      "updated_at" : "2019-01-16T17:39:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/454871002",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "As long as size is bigger than 1, it is mostly useful(which is most likely the case). For example:\r\n\r\n******************[Incase of NO-reserve]******************:\r\nsize = 1; initial cap = 1. No Re-Allocations needed.\r\nTotal Cost: 0 Re-Allocation\r\n\r\nsize = 2; initial cap = 1. so needs 1 Re-Allocation, in this case so becomes (prev_cap * 2):\r\nsize = 2; initial cap = 2.\r\nTotal Cost: 1 Re-Allocation\r\n\r\nsize = 3; initial cap = 1. needs to Re-Allocate in this case so becomes (prev_cap * 2):\r\nsize = 3; initial cap = 2. needs 1 more Re-Allocation so becomes (prev_cap * 2):\r\nsize = 3; initial cap = 4.\r\nTotal Cost: 2 Re-Allocations\r\n\r\nsize = 10; initial cap = 1. needs Re-Allocation, so becomes (prev_cap * 2):\r\nsize = 10; initial cap = 2. needs more Re-Allocation so becomes (prev_cap * 2):\r\nsize = 10; initial cap = 4. needs more Re-Alocation so becomes (prev_cap * 2):\r\nsize = 10; initial cap = 8. needs more Re-Alocation so becomes (prev_cap * 2):\r\nsize = 10; initial cap = 16.\r\nTotal Cost: 4 Re-Allocations\r\n\r\n******************[Incase of Reserve]******************:\r\nsize = 1; initial cap = 1. Reserves once for cap = 1, so no reallocation needed upto size = 1.\r\nTotal Cost: 1 Re-Allocation\r\n\r\nsize = 2; initial cap = 2. Reserves once for cap = 2, so no reallocation needed upto size = 2.\r\nTotal Cost: 1 Re-Allocation\r\n\r\nsize = 3; initial cap = 3 (or up to 4, compiler specifc). Reserved once for upto(atleast) cap = 3, so no reallocation needed upto size = 3.\r\nTotal Cost: 1 Re-Allocations\r\n\r\nsize = 10; initial cap = 10 (or up to 16, compiler specifc). Reserved once for upto(atleast) cap = 10, so no reallocation needed upto size = 10.\r\nTotal Cost: 1 Re-Allocations\r\n\r\nIn-addition to memory-allocation-cost there are more over-heads for each re-allocation like these things for example:\r\n\r\n    Makes a new vector of double size each time. (creation time spent).\r\n    Copies each element of the old vector in the new (bigger) sized one. (expensive).\r\n    Then destroys the old one.\r\n\r\nMoreover, this also guarantees that the iterator will remain valid, because early throw/error incase not enough memory for the task. This can potentially save data corruptions.\r\n\r\nWhich can all be avoided in this case as we know the size before.\r\n\r\nThis is pretty standard practice, infact in this file alone I see this applied in function[getNodesStats(NodesStats& stats)] line 98:\r\n``` \r\n           stats.reserve(stats_temp.size());\r\n            for (auto& node_stats_temp : stats_temp) {\r\n                stats.emplace_back(std::move(node_stats_temp), false, CNodeStateStats());\r\n             }\r\n```",
      "created_at" : "2019-01-16T17:40:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15182#issuecomment-454871229",
      "id" : 454871229,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15182",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NDg3MTIyOQ==",
      "updated_at" : "2019-01-16T17:40:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/454871229",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/30120428?v=4",
         "events_url" : "https://api.github.com/users/shahzadlone/events{/privacy}",
         "followers_url" : "https://api.github.com/users/shahzadlone/followers",
         "following_url" : "https://api.github.com/users/shahzadlone/following{/other_user}",
         "gists_url" : "https://api.github.com/users/shahzadlone/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/shahzadlone",
         "id" : 30120428,
         "login" : "shahzadlone",
         "node_id" : "MDQ6VXNlcjMwMTIwNDI4",
         "organizations_url" : "https://api.github.com/users/shahzadlone/orgs",
         "received_events_url" : "https://api.github.com/users/shahzadlone/received_events",
         "repos_url" : "https://api.github.com/users/shahzadlone/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/shahzadlone/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/shahzadlone/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/shahzadlone"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Agreed it's not critically important, but it is better code practice to reserve if you know the size.\r\n",
      "created_at" : "2019-01-16T17:42:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15182#issuecomment-454871851",
      "id" : 454871851,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15182",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NDg3MTg1MQ==",
      "updated_at" : "2019-01-16T17:42:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/454871851",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/30120428?v=4",
         "events_url" : "https://api.github.com/users/shahzadlone/events{/privacy}",
         "followers_url" : "https://api.github.com/users/shahzadlone/followers",
         "following_url" : "https://api.github.com/users/shahzadlone/following{/other_user}",
         "gists_url" : "https://api.github.com/users/shahzadlone/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/shahzadlone",
         "id" : 30120428,
         "login" : "shahzadlone",
         "node_id" : "MDQ6VXNlcjMwMTIwNDI4",
         "organizations_url" : "https://api.github.com/users/shahzadlone/orgs",
         "received_events_url" : "https://api.github.com/users/shahzadlone/received_events",
         "repos_url" : "https://api.github.com/users/shahzadlone/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/shahzadlone/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/shahzadlone/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/shahzadlone"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Current code is worst since it calls each function twice.",
      "created_at" : "2019-01-16T17:45:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15182#issuecomment-454872965",
      "id" : 454872965,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15182",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NDg3Mjk2NQ==",
      "updated_at" : "2019-01-16T17:45:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/454872965",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Sorry, I'm going to close this, there is no agreement to make this change.",
      "created_at" : "2019-01-16T18:35:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15182#issuecomment-454890243",
      "id" : 454890243,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15182",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NDg5MDI0Mw==",
      "updated_at" : "2019-01-16T18:35:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/454890243",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
