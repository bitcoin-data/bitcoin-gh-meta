[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#16486](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16486.html) ([consensus] skip bip30 checks when assumevalid is set for the block by pstratem)\n* [#16400](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16400.html) ([refactor] Rewrite AcceptToMemoryPoolWorker() using smaller parts by sdaftuar)\n* [#15713](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15713.html) (refactor: Replace chain relayTransactions/submitMemoryPool by higher method by ariard)\n* [#15192](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15192.html) (Add missing cs_main locks in ThreadImport(...)/Shutdown(...)/gettxoutsetinfo(...)/InitScriptExecutionCache(). Add missing locking annotations. by practicalswift)\n* [#13868](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/13868.html) (Remove unused fScriptChecks parameter from CheckInputs by Empact)\n* [#13204](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/13204.html) (Faster sigcache nonce by JeremyRubin)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-01-15T07:00:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#issuecomment-454287296",
      "id" : 454287296,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15169",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NDI4NzI5Ng==",
      "updated_at" : "2019-07-31T18:46:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/454287296",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> we could relay transactions from a whitelisted peer that would cause us to be banned by an older peer\r\n\r\nThis seems bad.  The original motivation for making whitelist relay is long long long since dead (*).  Can we just eliminate this behaviour, as it makes whitelisting less useful and isn't useful itself?\r\n\r\nIf there is still any need for forced-relay transactions it could be accomplished by introducing a new P2P message that only whitelisted peers are allowed to use, that carries with it a TX whos relay is forced.\r\n\r\n(*) my recollection is that the original reason that behaviour was added was because people using armory would start armory and their bitcoin node at the same time, and their armory wallet would blast txn to send at bitcoind which would end up in its mempool but not relayed on the network because it had no actual peers up. ... then later attempts by armory to rebroadcast were ineffectual because the txn were already in the node's mempool.   However, because it causes all your peers to be flooded by txn relayed by your whitelisted neighbours it makes whitelisting useless outside of that armory usecase, unless you add the second option to force relay off. \r\n",
      "created_at" : "2019-01-15T20:34:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#issuecomment-454540989",
      "id" : 454540989,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15169",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NDU0MDk4OQ==",
      "updated_at" : "2019-01-15T20:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/454540989",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "On the overall change, sounds interesting but without benchmarks I dunno how exciting it is.  I guess I'm kinda surprised that there is a speedup at all considering that IBD doesn't seem to scale past 15/16 cores... which I'd assumed was due to synchronization overheads in the script validation thread dispatch.",
      "created_at" : "2019-01-15T20:35:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#issuecomment-454541281",
      "id" : 454541281,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15169",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NDU0MTI4MQ==",
      "updated_at" : "2019-01-15T20:35:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/454541281",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I would love to get rid of the whitelist relay behavior.  Any opinions about whether I should open a new PR for that, or just do it here?\r\n\r\nMy initial benchmark is on a very large transaction that has 640 P2PKH inputs, 2 outputs, and is policy-valid.  I compared this PR with master, and I tried this on two computers, a Power9 workstation (which doesn't have the SHA optimizations) and my laptop (a recent macbook pro).\r\n\r\nWith master (verification threads are unused in mempool acceptance):\r\n\r\n| Computer | Verification Threads | average scriptcheck time | average total atmp time|\r\n|-----------|---------------------|------------------|----------------|\r\n|power9|16|283.0ms|285.6ms|\r\n|macbook pro|8|176.7ms|178.5ms|\r\n\r\nThe \"scriptcheck time\" is a timing I added from just before the first call to CheckInputs(), to just after the second call.  (I compare with the total ATMP time to sanity check that this is a meaningful optimization.)\r\n\r\nWith this PR:\r\n\r\n| Computer | Verification Threads | average scriptcheck time | average total atmp time|\r\n|-----------|---------------------|------------------|----------------|\r\n|power9|16|35.7ms|38.2ms|\r\n|macbook pro|8|40.7ms|42.6ms|\r\n\r\nI'm actually somewhat more interested in benchmarking transactions that use maximal CPU resources but don't get into the mempool, since such transactions are costless for someone to generate (and because they're slower for us to process, at least in this PR as it stands) -- I will try to post those numbers later.  Also, if you have any suggestions for transactions that might be more costly to validate than what I've done so far, please let me know.\r\n",
      "created_at" : "2019-01-15T22:13:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#issuecomment-454572075",
      "id" : 454572075,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15169",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NDU3MjA3NQ==",
      "updated_at" : "2019-01-15T22:13:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/454572075",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "It would be nice to have the benchmark in master before the changes are made here so that it is easier to see how much each of the two commits change the performance.",
      "created_at" : "2019-01-15T22:29:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#issuecomment-454576869",
      "id" : 454576869,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15169",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NDU3Njg2OQ==",
      "updated_at" : "2019-01-15T22:29:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/454576869",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r248093418"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/248093418"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Perhaps marginally less clear, but as follows, we skip the legacy input count if we don't have parallel threads & we abort the check as soon as we trigger the legacy count condition. \r\n\r\n```c++\r\n    bool parallel_verify = nScriptCheckThreads > 0;\r\n    size_t legacy_inputs_threshold = parallel_verify ? 15 : 0;\r\n    for (size_t i = 0; i < tx.vin.size() && legacy_input_threshold; i++) {\r\n        legacy_inputs_threshold -= tx.vin[i].scriptWitness.IsNull();\r\n    }\r\n    parallel_verify &= legacy_input_threshold == 0; \r\n```\r\n\r\n",
      "commit_id" : "1de40f79276e3ad024ec823ca77c1fa5652fe56f",
      "created_at" : "2019-01-15T22:49:23Z",
      "diff_hunk" : "@@ -1679,6 +1680,30 @@ void ThreadScriptCheck() {\n     scriptcheckqueue.Thread();\n }\n \n+bool RunCheckInputsMaybeParallel(const CTransaction& tx, CValidationState &state, const CCoinsViewCache &inputs, unsigned int flags, bool cacheSigStore, bool cacheFullScriptStore, PrecomputedTransactionData& txdata) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    size_t legacy_inputs = 0;\n+    for (size_t i = 0; i < tx.vin.size(); i++) {\n+        if (tx.vin[i].scriptWitness.IsNull()) {\n+            ++legacy_inputs;\n+        }\n+    }\n+    bool parallel_verify = false;\n+    if (legacy_inputs >= 15 && nScriptCheckThreads) {\n+        parallel_verify = true;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r248093418",
      "id" : 248093418,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0ODA5MzQxOA==",
      "original_commit_id" : "8cd9e2f0a0ee927b648c3ac72913da41c33562f0",
      "original_position" : 52,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 192903141,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169",
      "updated_at" : "2019-07-22T18:42:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/248093418",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sdaftuar on forced relay, I think a PR that defaulted it to off could just be open separately and make it in faster than this work... and this would could continue assuming that issue is resolved elsewhere.",
      "created_at" : "2019-01-16T01:38:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#issuecomment-454618309",
      "id" : 454618309,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15169",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NDYxODMwOQ==",
      "updated_at" : "2019-01-16T01:38:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/454618309",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-01-24T15:15:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#issuecomment-457233146",
      "id" : 457233146,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15169",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NzIzMzE0Ng==",
      "updated_at" : "2019-01-24T15:15:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/457233146",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r283560268"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/283560268"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think you're right that it's not worth the complexity of gating the logic on the number of legacy inputs.  I did some microbenchmarking on a couple of my computers to see how long it takes to validate small transactions at various thresholds, and the effect seems very small.",
      "commit_id" : "1de40f79276e3ad024ec823ca77c1fa5652fe56f",
      "created_at" : "2019-05-13T22:19:26Z",
      "diff_hunk" : "@@ -1679,6 +1680,30 @@ void ThreadScriptCheck() {\n     scriptcheckqueue.Thread();\n }\n \n+bool RunCheckInputsMaybeParallel(const CTransaction& tx, CValidationState &state, const CCoinsViewCache &inputs, unsigned int flags, bool cacheSigStore, bool cacheFullScriptStore, PrecomputedTransactionData& txdata) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    size_t legacy_inputs = 0;\n+    for (size_t i = 0; i < tx.vin.size(); i++) {\n+        if (tx.vin[i].scriptWitness.IsNull()) {\n+            ++legacy_inputs;\n+        }\n+    }\n+    bool parallel_verify = false;\n+    if (legacy_inputs >= 15 && nScriptCheckThreads) {\n+        parallel_verify = true;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r283560268",
      "id" : 283560268,
      "in_reply_to_id" : 248093418,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4MzU2MDI2OA==",
      "original_commit_id" : "8cd9e2f0a0ee927b648c3ac72913da41c33562f0",
      "original_position" : 52,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 236947090,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169",
      "updated_at" : "2019-07-22T18:42:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/283560268",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Updated to always use parallel validation for mempool transactions if scriptcheck threads are available, and also updated the OP to describe the current behavior.\r\n\r\nOne remaining open question in my mind is around the new behavior where a peer sending an invalid-according-to-consensus rules transaction would no longer be disconnected.  The motivation for this  is to mitigate adversarial behavior: in order to determine whether a transaction is invalid according to consensus rules (rather than policy) we end up validating a transaction's scripts twice, so an adversary trying a CPU DoS could construct transactions that only fail policy checks, but otherwise tie up our CPU for twice as long.\r\n\r\nHowever, in a non-adversarial case, where our peer is merely broken (or intended to operate on a different network) but non-malicious, this means that we will stay connected to the peer longer than we should.  This is also not ideal.  I have two ideas for addressing this, but I welcome other suggestions: \r\n\r\n(1) probabilistically evaluate failing transactions with consensus flags, and using the result to decide whether to disconnect a peer -- say we had a 1% chance of validating a failed transaction a second time, so that if a peer is giving us garbage we can figure it out relatively quickly while still limiting CPU usage for a bad transaction in the general case.\r\n\r\n(2) @TheBlueMatt suggested I refactor the checkqueue logic to pass back the reason for a script failure (say, the first script that fails when doing parallel validation), and then we use that to determine whether to disconnect a peer based on a single validation of scripts.  Assuming that there are no conceptual issues with this, then this should be optimal behavior for us.  This also seems a little invasive and IMO the gain here is not obviously worth the effort, but Matt suggested we might want this the next time a consensus change is proposed anyway.\r\n\r\nAny thoughts on whether the behavior change proposed here is ok, or if I should pursue an alternate approach, such as one of the two ideas above?",
      "created_at" : "2019-05-14T13:14:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#issuecomment-492232216",
      "id" : 492232216,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15169",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5MjIzMjIxNg==",
      "updated_at" : "2019-05-14T13:19:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/492232216",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "The check queue approach is IMO a bad idea because we may fail for different reasons on different executions.\r\n\r\nIf you want a reason, I would re-run validation in single core and reproduce the first failure.\r\n\r\nOtherwise maybe you can produce all failure tuples (index, failure) and then take the sorted first one?",
      "created_at" : "2019-05-14T16:27:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#issuecomment-492310750",
      "id" : 492310750,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15169",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5MjMxMDc1MA==",
      "updated_at" : "2019-05-14T16:27:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/492310750",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "You can even track the min txn that any worker has attempted and then just restart from there -- that might save you some work against blocks which have their last txn fail. ",
      "created_at" : "2019-05-14T16:32:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#issuecomment-492312364",
      "id" : 492312364,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15169",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5MjMxMjM2NA==",
      "updated_at" : "2019-05-14T16:32:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/492312364",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@JeremyRubin For a transaction containing multiple failing script inputs, I don't think it should matter whether the failure we associate with it is deterministic, since trying to find the reason for validation failure is only something we're trying to do for a non-adversarial case anyway. Do you have a scenario in mind where it would be an issue? ",
      "created_at" : "2019-05-15T13:28:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#issuecomment-492654340",
      "id" : 492654340,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15169",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5MjY1NDM0MA==",
      "updated_at" : "2019-05-15T13:28:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/492654340",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I added a commit (to be squashed) which uses single-threaded validation for transactions submitted over RPC, since we're not worried about DoS there and users can get more detailed error information for invalid transactions when we scripts are evaluated serially.  @jnewbery -- thanks for the suggestion.",
      "created_at" : "2019-06-07T08:02:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#issuecomment-499795478",
      "id" : 499795478,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15169",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5OTc5NTQ3OA==",
      "updated_at" : "2019-06-07T08:02:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/499795478",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r302224265"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/302224265"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hmm, one thing this potentially protects us from is inbound peers on fork chains where the chain doesn't (yet) have any blocks to relay us (so that we ban them for invalid headers). We may want to broaden the ConsiderEviction logic to apply some similar (but relaxed - don't want to disconnect peers which are in IBD and making progress) rules to inbound peers. No need to do it in this PR, though - I think our inbound peer eviction logic could use some tuning independently and no huge risk even in the case of more fork chains given the outbound peer eviction logic robustness.",
      "commit_id" : "1de40f79276e3ad024ec823ca77c1fa5652fe56f",
      "created_at" : "2019-07-10T19:01:54Z",
      "diff_hunk" : "@@ -895,6 +895,20 @@ static bool AcceptToMemoryPoolWorker(const CChainParams& chainparams, CTxMemPool\n         // This is done last to help prevent CPU exhaustion denial-of-service attacks.\n         PrecomputedTransactionData txdata(tx);\n         if (!CheckInputs(tx, state, view, true, scriptVerifyFlags, true, false, txdata)) {\n+            // Assume that this is due to a policy violation, rather than",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r302224265",
      "id" : 302224265,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMjIyNDI2NQ==",
      "original_commit_id" : "dd236e45b07caf8e486f32758e4de0e90a455f3a",
      "original_position" : 4,
      "path" : "src/validation.cpp",
      "position" : 76,
      "pull_request_review_id" : 260295629,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169",
      "updated_at" : "2019-07-22T18:42:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/302224265",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r302225458"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/302225458"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: maybe include in the comment why we have to call this function anyway (that CheckInputs always returns CONSENSUS so we have to overwrite it).",
      "commit_id" : "1de40f79276e3ad024ec823ca77c1fa5652fe56f",
      "created_at" : "2019-07-10T19:04:51Z",
      "diff_hunk" : "@@ -895,6 +895,20 @@ static bool AcceptToMemoryPoolWorker(const CChainParams& chainparams, CTxMemPool\n         // This is done last to help prevent CPU exhaustion denial-of-service attacks.\n         PrecomputedTransactionData txdata(tx);\n         if (!CheckInputs(tx, state, view, true, scriptVerifyFlags, true, false, txdata)) {\n+            // Assume that this is due to a policy violation, rather than\n+            // re-checking with the consensus flags. Separating policy rules\n+            // from consensus rules is tricky, because we want to be able to\n+            // support old peers who may not be aware of recent consensus\n+            // changes; returning NOT_STANDARD here is maximally permissive.\n+            // Anyway re-checking the scripts with a different set of flags\n+            // wastes CPU as well (particularly if an attacker is constructing\n+            // transactions designed to waste our CPU).\n+            state.Invalid(ValidationInvalidReason::TX_NOT_STANDARD, false, REJECT_NONSTANDARD, state.GetRejectReason(), state.GetDebugMessage());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r302225458",
      "id" : 302225458,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMjIyNTQ1OA==",
      "original_commit_id" : "dd236e45b07caf8e486f32758e4de0e90a455f3a",
      "original_position" : 12,
      "path" : "src/validation.cpp",
      "position" : 85,
      "pull_request_review_id" : 260295629,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169",
      "updated_at" : "2019-07-22T18:42:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/302225458",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the review @TheBlueMatt.  I'll hold off on the comment nit unless I end up updating this PR for something else.",
      "created_at" : "2019-07-12T15:40:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#issuecomment-510933710",
      "id" : 510933710,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15169",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxMDkzMzcxMA==",
      "updated_at" : "2019-07-12T15:40:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/510933710",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r303650100"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/303650100"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`maxfeerate` -> `allowhighfees` seems like a bad rebase. The new argument is `maxfeerate`, but `allowhighfees` is retained for backwards compatibility and may be removed in a future version.",
      "commit_id" : "1de40f79276e3ad024ec823ca77c1fa5652fe56f",
      "created_at" : "2019-07-15T21:43:50Z",
      "diff_hunk" : "@@ -101,8 +101,8 @@ def run_test(self):\n         # First we show that this tx is valid except for DERSIG by getting it\n         # rejected from the mempool for exactly that reason.\n         assert_equal(\n-            [{'txid': spendtx.hash, 'allowed': False, 'reject-reason': '64: non-mandatory-script-verify-flag (Non-canonical DER signature)'}],\n-            self.nodes[0].testmempoolaccept(rawtxs=[spendtx.serialize().hex()], maxfeerate=0)\n+            [{'txid': spendtx.hash, 'allowed': False, 'reject-reason': '64: script-verify-flag-failed (Non-canonical DER signature)'}],\n+            self.nodes[0].testmempoolaccept(rawtxs=[spendtx.serialize().hex()], allowhighfees=0)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r303650100",
      "id" : 303650100,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMzY1MDEwMA==",
      "original_commit_id" : "b689d4de467cf4031a2473afc08d2a0fe1b6c71b",
      "original_position" : 7,
      "path" : "test/functional/feature_dersig.py",
      "position" : null,
      "pull_request_review_id" : 262091202,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169",
      "updated_at" : "2019-07-22T18:42:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/303650100",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r303650126"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/303650126"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`maxfeerate` -> `allowhighfees` seems like a bad rebase. The new argument is `maxfeerate`, but `allowhighfees` is retained for backwards compatibility and may be removed in a future version.",
      "commit_id" : "1de40f79276e3ad024ec823ca77c1fa5652fe56f",
      "created_at" : "2019-07-15T21:43:55Z",
      "diff_hunk" : "@@ -112,16 +112,16 @@ def run_test(self):\n         # First we show that this tx is valid except for CLTV by getting it\n         # rejected from the mempool for exactly that reason.\n         assert_equal(\n-            [{'txid': spendtx.hash, 'allowed': False, 'reject-reason': '64: non-mandatory-script-verify-flag (Negative locktime)'}],\n-            self.nodes[0].testmempoolaccept(rawtxs=[spendtx.serialize().hex()], maxfeerate=0)\n+            [{'txid': spendtx.hash, 'allowed': False, 'reject-reason': '64: script-verify-flag-failed (Negative locktime)'}],\n+            self.nodes[0].testmempoolaccept(rawtxs=[spendtx.serialize().hex()], allowhighfees=0)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r303650126",
      "id" : 303650126,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMzY1MDEyNg==",
      "original_commit_id" : "b689d4de467cf4031a2473afc08d2a0fe1b6c71b",
      "original_position" : 7,
      "path" : "test/functional/feature_cltv.py",
      "position" : null,
      "pull_request_review_id" : 262091202,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169",
      "updated_at" : "2019-07-22T18:42:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/303650126",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r303651045"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/303651045"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This change is not necessary now that #15193 has been merged.",
      "commit_id" : "1de40f79276e3ad024ec823ca77c1fa5652fe56f",
      "created_at" : "2019-07-15T21:46:35Z",
      "diff_hunk" : "@@ -184,7 +184,7 @@ def set_test_params(self):\n         self.setup_clean_chain = True\n         self.num_nodes = 3\n         # This test tests SegWit both pre and post-activation, so use the normal BIP9 activation.\n-        self.extra_args = [[\"-whitelist=127.0.0.1\", \"-vbparams=segwit:0:999999999999\"], [\"-whitelist=127.0.0.1\", \"-acceptnonstdtxn=0\", \"-vbparams=segwit:0:999999999999\"], [\"-whitelist=127.0.0.1\", \"-vbparams=segwit:0:0\"]]\n+        self.extra_args = [[\"-whitelist=127.0.0.1\", \"-vbparams=segwit:0:999999999999\", \"-whitelistforcerelay=0\"], [\"-whitelist=127.0.0.1\", \"-acceptnonstdtxn=0\", \"-vbparams=segwit:0:999999999999\", \"-whitelistforcerelay=0\"], [\"-whitelist=127.0.0.1\", \"-vbparams=segwit:0:0\", \"-whitelistforcerelay=0\"]]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r303651045",
      "id" : 303651045,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMzY1MTA0NQ==",
      "original_commit_id" : "b689d4de467cf4031a2473afc08d2a0fe1b6c71b",
      "original_position" : 5,
      "path" : "test/functional/p2p_segwit.py",
      "position" : null,
      "pull_request_review_id" : 262091202,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169",
      "updated_at" : "2019-07-22T18:42:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/303651045",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r303673472"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/303673472"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The failure string can be \"script-verify-flag-failed\" here. Even better, with the specific error string \"script-verify-flag-failed (Operation not valid with the current stack size)\"",
      "commit_id" : "1de40f79276e3ad024ec823ca77c1fa5652fe56f",
      "created_at" : "2019-07-15T23:12:54Z",
      "diff_hunk" : "@@ -154,8 +154,8 @@ def run_test(self):\n         self.skip_mine(self.nodes[2], p2sh_ids[NODE_2][WIT_V1][0], True)  # block 427\n \n         self.log.info(\"Verify unsigned p2sh witness txs without a redeem script are invalid\")\n-        self.fail_accept(self.nodes[2], \"mandatory-script-verify-flag\", p2sh_ids[NODE_2][WIT_V0][1], False)\n-        self.fail_accept(self.nodes[2], \"mandatory-script-verify-flag\", p2sh_ids[NODE_2][WIT_V1][1], False)\n+        self.fail_accept(self.nodes[2], \"script-verify-flag\", p2sh_ids[NODE_2][WIT_V0][1], False)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r303673472",
      "id" : 303673472,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMzY3MzQ3Mg==",
      "original_commit_id" : "b689d4de467cf4031a2473afc08d2a0fe1b6c71b",
      "original_position" : 6,
      "path" : "test/functional/feature_segwit.py",
      "position" : 6,
      "pull_request_review_id" : 262091202,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169",
      "updated_at" : "2019-07-22T18:42:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/303673472",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r303938913"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/303938913"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed",
      "commit_id" : "1de40f79276e3ad024ec823ca77c1fa5652fe56f",
      "created_at" : "2019-07-16T14:24:49Z",
      "diff_hunk" : "@@ -101,8 +101,8 @@ def run_test(self):\n         # First we show that this tx is valid except for DERSIG by getting it\n         # rejected from the mempool for exactly that reason.\n         assert_equal(\n-            [{'txid': spendtx.hash, 'allowed': False, 'reject-reason': '64: non-mandatory-script-verify-flag (Non-canonical DER signature)'}],\n-            self.nodes[0].testmempoolaccept(rawtxs=[spendtx.serialize().hex()], maxfeerate=0)\n+            [{'txid': spendtx.hash, 'allowed': False, 'reject-reason': '64: script-verify-flag-failed (Non-canonical DER signature)'}],\n+            self.nodes[0].testmempoolaccept(rawtxs=[spendtx.serialize().hex()], allowhighfees=0)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r303938913",
      "id" : 303938913,
      "in_reply_to_id" : 303650100,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMzkzODkxMw==",
      "original_commit_id" : "b689d4de467cf4031a2473afc08d2a0fe1b6c71b",
      "original_position" : 7,
      "path" : "test/functional/feature_dersig.py",
      "position" : null,
      "pull_request_review_id" : 262455037,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169",
      "updated_at" : "2019-07-22T18:42:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/303938913",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r303938941"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/303938941"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed",
      "commit_id" : "1de40f79276e3ad024ec823ca77c1fa5652fe56f",
      "created_at" : "2019-07-16T14:24:53Z",
      "diff_hunk" : "@@ -112,16 +112,16 @@ def run_test(self):\n         # First we show that this tx is valid except for CLTV by getting it\n         # rejected from the mempool for exactly that reason.\n         assert_equal(\n-            [{'txid': spendtx.hash, 'allowed': False, 'reject-reason': '64: non-mandatory-script-verify-flag (Negative locktime)'}],\n-            self.nodes[0].testmempoolaccept(rawtxs=[spendtx.serialize().hex()], maxfeerate=0)\n+            [{'txid': spendtx.hash, 'allowed': False, 'reject-reason': '64: script-verify-flag-failed (Negative locktime)'}],\n+            self.nodes[0].testmempoolaccept(rawtxs=[spendtx.serialize().hex()], allowhighfees=0)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r303938941",
      "id" : 303938941,
      "in_reply_to_id" : 303650126,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMzkzODk0MQ==",
      "original_commit_id" : "b689d4de467cf4031a2473afc08d2a0fe1b6c71b",
      "original_position" : 7,
      "path" : "test/functional/feature_cltv.py",
      "position" : null,
      "pull_request_review_id" : 262455073,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169",
      "updated_at" : "2019-07-22T18:42:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/303938941",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r303939015"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/303939015"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Removed",
      "commit_id" : "1de40f79276e3ad024ec823ca77c1fa5652fe56f",
      "created_at" : "2019-07-16T14:24:59Z",
      "diff_hunk" : "@@ -184,7 +184,7 @@ def set_test_params(self):\n         self.setup_clean_chain = True\n         self.num_nodes = 3\n         # This test tests SegWit both pre and post-activation, so use the normal BIP9 activation.\n-        self.extra_args = [[\"-whitelist=127.0.0.1\", \"-vbparams=segwit:0:999999999999\"], [\"-whitelist=127.0.0.1\", \"-acceptnonstdtxn=0\", \"-vbparams=segwit:0:999999999999\"], [\"-whitelist=127.0.0.1\", \"-vbparams=segwit:0:0\"]]\n+        self.extra_args = [[\"-whitelist=127.0.0.1\", \"-vbparams=segwit:0:999999999999\", \"-whitelistforcerelay=0\"], [\"-whitelist=127.0.0.1\", \"-acceptnonstdtxn=0\", \"-vbparams=segwit:0:999999999999\", \"-whitelistforcerelay=0\"], [\"-whitelist=127.0.0.1\", \"-vbparams=segwit:0:0\", \"-whitelistforcerelay=0\"]]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r303939015",
      "id" : 303939015,
      "in_reply_to_id" : 303651045,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMzkzOTAxNQ==",
      "original_commit_id" : "b689d4de467cf4031a2473afc08d2a0fe1b6c71b",
      "original_position" : 5,
      "path" : "test/functional/p2p_segwit.py",
      "position" : null,
      "pull_request_review_id" : 262455152,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169",
      "updated_at" : "2019-07-22T18:42:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/303939015",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r303939181"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/303939181"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Leaving this one alone -- someone interested in improving this test can take it on in a separate PR.",
      "commit_id" : "1de40f79276e3ad024ec823ca77c1fa5652fe56f",
      "created_at" : "2019-07-16T14:25:18Z",
      "diff_hunk" : "@@ -154,8 +154,8 @@ def run_test(self):\n         self.skip_mine(self.nodes[2], p2sh_ids[NODE_2][WIT_V1][0], True)  # block 427\n \n         self.log.info(\"Verify unsigned p2sh witness txs without a redeem script are invalid\")\n-        self.fail_accept(self.nodes[2], \"mandatory-script-verify-flag\", p2sh_ids[NODE_2][WIT_V0][1], False)\n-        self.fail_accept(self.nodes[2], \"mandatory-script-verify-flag\", p2sh_ids[NODE_2][WIT_V1][1], False)\n+        self.fail_accept(self.nodes[2], \"script-verify-flag\", p2sh_ids[NODE_2][WIT_V0][1], False)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r303939181",
      "id" : 303939181,
      "in_reply_to_id" : 303673472,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMzkzOTE4MQ==",
      "original_commit_id" : "b689d4de467cf4031a2473afc08d2a0fe1b6c71b",
      "original_position" : 6,
      "path" : "test/functional/feature_segwit.py",
      "position" : 6,
      "pull_request_review_id" : 262455372,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169",
      "updated_at" : "2019-07-22T18:42:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/303939181",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Addressed all but one of @jnewbery's comments, and included the comment change that @TheBlueMatt previously suggested.\r\n\r\nPrior version of this PR can be compared here: [15169.1](https://github.com/sdaftuar/bitcoin/commits/15169.1)",
      "created_at" : "2019-07-16T14:26:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#issuecomment-511839762",
      "id" : 511839762,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15169",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxMTgzOTc2Mg==",
      "updated_at" : "2019-07-16T14:26:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/511839762",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r303995652"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/303995652"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Unnecessary whitespace change",
      "commit_id" : "1de40f79276e3ad024ec823ca77c1fa5652fe56f",
      "created_at" : "2019-07-16T16:06:31Z",
      "diff_hunk" : "@@ -184,7 +184,7 @@ def set_test_params(self):\n         self.setup_clean_chain = True\n         self.num_nodes = 3\n         # This test tests SegWit both pre and post-activation, so use the normal BIP9 activation.\n-        self.extra_args = [[\"-whitelist=127.0.0.1\", \"-vbparams=segwit:0:999999999999\"], [\"-whitelist=127.0.0.1\", \"-acceptnonstdtxn=0\", \"-vbparams=segwit:0:999999999999\"], [\"-whitelist=127.0.0.1\", \"-vbparams=segwit:0:0\"]]\n+        self.extra_args = [[\"-whitelist=127.0.0.1\", \"-vbparams=segwit:0:999999999999\"], [\"-whitelist=127.0.0.1\", \"-acceptnonstdtxn=0\", \"-vbparams=segwit:0:999999999999\" ], [\"-whitelist=127.0.0.1\", \"-vbparams=segwit:0:0\" ]]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r303995652",
      "id" : 303995652,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMzk5NTY1Mg==",
      "original_commit_id" : "cb0c42cfda7669f3df57c167cf0d691f926039d2",
      "original_position" : 5,
      "path" : "test/functional/p2p_segwit.py",
      "position" : null,
      "pull_request_review_id" : 262526428,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169",
      "updated_at" : "2019-07-22T18:42:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/303995652",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r304037434"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/304037434"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Note for reviewers that there's a change in behaviour here where previously state would be set to NOT_STANDARD and now it's set to CONSENSUS. I think that's correct behaviour, since this check is against consensus rules.\r\n\r\nAlso note that this should never fail. If `CheckInputsFromMempoolAndCache()` fails script checking it's because a policy change has been deployed which is a hard fork against consensus rules. That's a bug.",
      "commit_id" : "1de40f79276e3ad024ec823ca77c1fa5652fe56f",
      "created_at" : "2019-07-16T17:42:56Z",
      "diff_hunk" : "@@ -558,7 +559,7 @@ static bool CheckInputsFromMempoolAndCache(const CTransaction& tx, CValidationSt\n         }\n     }\n \n-    return CheckInputs(tx, state, view, true, flags, cacheSigStore, true, txdata);\n+    return RunCheckInputsMaybeParallel(tx, state, view, flags, cacheSigStore, true, txdata);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r304037434",
      "id" : 304037434,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNDAzNzQzNA==",
      "original_commit_id" : "cb0c42cfda7669f3df57c167cf0d691f926039d2",
      "original_position" : 22,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 262526428,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169",
      "updated_at" : "2019-07-22T18:42:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/304037434",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r304044230"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/304044230"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I believe this breaks script caching - `CheckInputs()` will only cache script success if running non-parallel.",
      "commit_id" : "1de40f79276e3ad024ec823ca77c1fa5652fe56f",
      "created_at" : "2019-07-16T17:58:05Z",
      "diff_hunk" : "@@ -558,7 +559,7 @@ static bool CheckInputsFromMempoolAndCache(const CTransaction& tx, CValidationSt\n         }\n     }\n \n-    return CheckInputs(tx, state, view, true, flags, cacheSigStore, true, txdata);\n+    return RunCheckInputsMaybeParallel(tx, state, view, flags, cacheSigStore, true, txdata);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r304044230",
      "id" : 304044230,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNDA0NDIzMA==",
      "original_commit_id" : "cb0c42cfda7669f3df57c167cf0d691f926039d2",
      "original_position" : 22,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 262526428,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169",
      "updated_at" : "2019-07-22T18:42:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/304044230",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r304045068"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/304045068"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It seems slightly weird (and scary) to return that this was a consensus failure, when this is a dumb utility function which is just checking whichever rules it gets passed. Perhaps a future PR should remove the `CValidationState` argument and force the caller to set the validation failure reason:\r\n\r\n- The initial call to `CheckInputs()` in ATMP should always set the state to `TX_NOT_STANDARD` on failure\r\n- The subsequent call to `CheckInputs()` in ATMP should always set the state to `TX_WITNESS_MUTATED` on failure\r\n- ConnectBlock should update this anyway (eg by setting a BlockValidationState after https://github.com/bitcoin/bitcoin/pull/15921)\r\n- The call in `CheckInputsFromMempoolAndCache()` should set this to `CONSENSUS` (since it's checking against consensus flags)",
      "commit_id" : "1de40f79276e3ad024ec823ca77c1fa5652fe56f",
      "created_at" : "2019-07-16T17:59:55Z",
      "diff_hunk" : "@@ -1422,30 +1438,18 @@ bool CheckInputs(const CTransaction& tx, CValidationState &state, const CCoinsVi\n                     pvChecks->push_back(CScriptCheck());\n                     check.swap(pvChecks->back());\n                 } else if (!check()) {\n-                    if (flags & STANDARD_NOT_MANDATORY_VERIFY_FLAGS) {\n-                        // Check whether the failure was caused by a\n-                        // non-mandatory script verification check, such as\n-                        // non-standard DER encodings or non-null dummy\n-                        // arguments; if so, ensure we return NOT_STANDARD\n-                        // instead of CONSENSUS to avoid downstream users\n-                        // splitting the network between upgraded and\n-                        // non-upgraded nodes by banning CONSENSUS-failing\n-                        // data providers.\n-                        CScriptCheck check2(coin.out, tx, i,\n-                                flags & ~STANDARD_NOT_MANDATORY_VERIFY_FLAGS, cacheSigStore, &txdata);\n-                        if (check2())\n-                            return state.Invalid(ValidationInvalidReason::TX_NOT_STANDARD, false, REJECT_NONSTANDARD, strprintf(\"non-mandatory-script-verify-flag (%s)\", ScriptErrorString(check.GetScriptError())));\n-                    }\n-                    // MANDATORY flag failures correspond to\n-                    // ValidationInvalidReason::CONSENSUS. Because CONSENSUS\n-                    // failures are the most serious case of validation\n-                    // failures, we may need to consider using\n-                    // RECENT_CONSENSUS_CHANGE for any script failure that\n-                    // could be due to non-upgraded nodes which we may want to\n-                    // support, to avoid splitting the network (but this\n-                    // depends on the details of how net_processing handles\n-                    // such errors).\n-                    return state.Invalid(ValidationInvalidReason::CONSENSUS, false, REJECT_INVALID, strprintf(\"mandatory-script-verify-flag-failed (%s)\", ScriptErrorString(check.GetScriptError())));\n+                    // NOTE: We return CONSENSUS as the reason here, even",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r304045068",
      "id" : 304045068,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNDA0NTA2OA==",
      "original_commit_id" : "cb0c42cfda7669f3df57c167cf0d691f926039d2",
      "original_position" : 121,
      "path" : "src/validation.cpp",
      "position" : 209,
      "pull_request_review_id" : 262526428,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169",
      "updated_at" : "2019-07-22T18:42:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/304045068",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jnewbery Good catch on the caching bug.  I've pushed up a quick fix for now, but probably I should do something better here when I have a chance to revisit.",
      "created_at" : "2019-07-16T18:59:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#issuecomment-511943502",
      "id" : 511943502,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15169",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxMTk0MzUwMg==",
      "updated_at" : "2019-07-16T18:59:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/511943502",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r304495604"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/304495604"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Style-Nit: Would be a bit nicer to have consistency in the ordering of argument and comment.",
      "commit_id" : "1de40f79276e3ad024ec823ca77c1fa5652fe56f",
      "created_at" : "2019-07-17T16:02:49Z",
      "diff_hunk" : "@@ -925,7 +925,7 @@ static UniValue testmempoolaccept(const JSONRPCRequest& request)\n     {\n         LOCK(cs_main);\n         test_accept_res = AcceptToMemoryPool(mempool, state, std::move(tx), &missing_inputs,\n-            nullptr /* plTxnReplaced */, false /* bypass_limits */, max_raw_tx_fee, /* test_accept */ true);\n+            nullptr /* plTxnReplaced */, false /* bypass_limits */, max_raw_tx_fee, /* test_accept */ true, /* single_threaded_validation */ true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r304495604",
      "id" : 304495604,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNDQ5NTYwNA==",
      "original_commit_id" : "cb0c42cfda7669f3df57c167cf0d691f926039d2",
      "original_position" : 5,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : 5,
      "pull_request_review_id" : 263158198,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169",
      "updated_at" : "2019-07-22T18:42:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/304495604",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r304554016"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/304554016"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The arguments might be wrapped into a struct before they are passed at some point in the future, so I guess this style inconsistency will be solved at that point",
      "commit_id" : "1de40f79276e3ad024ec823ca77c1fa5652fe56f",
      "created_at" : "2019-07-17T17:29:13Z",
      "diff_hunk" : "@@ -925,7 +925,7 @@ static UniValue testmempoolaccept(const JSONRPCRequest& request)\n     {\n         LOCK(cs_main);\n         test_accept_res = AcceptToMemoryPool(mempool, state, std::move(tx), &missing_inputs,\n-            nullptr /* plTxnReplaced */, false /* bypass_limits */, max_raw_tx_fee, /* test_accept */ true);\n+            nullptr /* plTxnReplaced */, false /* bypass_limits */, max_raw_tx_fee, /* test_accept */ true, /* single_threaded_validation */ true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r304554016",
      "id" : 304554016,
      "in_reply_to_id" : 304495604,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNDU1NDAxNg==",
      "original_commit_id" : "cb0c42cfda7669f3df57c167cf0d691f926039d2",
      "original_position" : 5,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : 5,
      "pull_request_review_id" : 263205953,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169",
      "updated_at" : "2019-07-22T18:42:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/304554016",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r304618876"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/304618876"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Question on code structure: I would like to understand the reasoning for wrapping CheckInputs() in RunCheckInputsMaybeParalell(). Rather than that I would probably have put that logic into CheckInputs() itself and then have it delegate to CheckInputsParalell() or so. Are there other factors at play that I am not seeing, like keeping the changes in CheckInputs() as minimal as possible for example?",
      "commit_id" : "1de40f79276e3ad024ec823ca77c1fa5652fe56f",
      "created_at" : "2019-07-17T20:07:48Z",
      "diff_hunk" : "@@ -1672,6 +1675,23 @@ void ThreadScriptCheck(int worker_num) {\n     scriptcheckqueue.Thread();\n }\n \n+bool RunCheckInputsMaybeParallel(const CTransaction& tx, CValidationState &state, const CCoinsViewCache &inputs, unsigned int flags, bool cacheSigStore, bool cacheFullScriptStore, PrecomputedTransactionData& txdata, bool single_threaded_validation) EXCLUSIVE_LOCKS_REQUIRED(cs_main)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r304618876",
      "id" : 304618876,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNDYxODg3Ng==",
      "original_commit_id" : "775b71d2c490d17a8576c1c88c5a7f3800483df9",
      "original_position" : 178,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 263287845,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169",
      "updated_at" : "2019-07-22T18:42:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/304618876",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r304940181"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/304940181"
         }
      },
      "author_association" : "NONE",
      "body" : "nit: since `(nScriptCheckThreads && !single_threaded_validation)` is used several times throughout this function, maybe declare it at the beginning of the function? (e.g. `bool use_multiple_threads = (nScriptCheckThreads && !single_threaded_validation)`.",
      "commit_id" : "1de40f79276e3ad024ec823ca77c1fa5652fe56f",
      "created_at" : "2019-07-18T14:14:35Z",
      "diff_hunk" : "@@ -1672,6 +1675,23 @@ void ThreadScriptCheck(int worker_num) {\n     scriptcheckqueue.Thread();\n }\n \n+bool RunCheckInputsMaybeParallel(const CTransaction& tx, CValidationState &state, const CCoinsViewCache &inputs, unsigned int flags, bool cacheSigStore, bool cacheFullScriptStore, PrecomputedTransactionData& txdata, bool single_threaded_validation) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    uint256 hash_cache_entry;\n+    CCheckQueueControl<CScriptCheck> control((nScriptCheckThreads && !single_threaded_validation) ? &scriptcheckqueue : nullptr);\n+    std::vector<CScriptCheck> vChecks;\n+    if (!CheckInputs(tx, state, inputs, true, flags, cacheSigStore, cacheFullScriptStore, txdata, hash_cache_entry, (nScriptCheckThreads && !single_threaded_validation) ? &vChecks : nullptr)) {\n+        return false;\n+    }\n+    control.Add(vChecks);\n+    if (!control.Wait()) {\n+        return state.Invalid(ValidationInvalidReason::CONSENSUS, false, REJECT_INVALID, \"script-verify-flag-failed\");\n+    }\n+    if (nScriptCheckThreads && !single_threaded_validation && cacheFullScriptStore) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r304940181",
      "id" : 304940181,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNDk0MDE4MQ==",
      "original_commit_id" : "775b71d2c490d17a8576c1c88c5a7f3800483df9",
      "original_position" : 190,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 263684324,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169",
      "updated_at" : "2019-07-22T18:42:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/304940181",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4769925?v=4",
         "events_url" : "https://api.github.com/users/hugohn/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hugohn/followers",
         "following_url" : "https://api.github.com/users/hugohn/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hugohn/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hugohn",
         "id" : 4769925,
         "login" : "hugohn",
         "node_id" : "MDQ6VXNlcjQ3Njk5MjU=",
         "organizations_url" : "https://api.github.com/users/hugohn/orgs",
         "received_events_url" : "https://api.github.com/users/hugohn/received_events",
         "repos_url" : "https://api.github.com/users/hugohn/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hugohn/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hugohn/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hugohn"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r305873419"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/305873419"
         }
      },
      "author_association" : "MEMBER",
      "body" : "CheckInputs() is also invoked directly from ConnectBlock(), which handles the parallel scriptcheck threads itself.",
      "commit_id" : "1de40f79276e3ad024ec823ca77c1fa5652fe56f",
      "created_at" : "2019-07-22T14:25:32Z",
      "diff_hunk" : "@@ -1672,6 +1675,23 @@ void ThreadScriptCheck(int worker_num) {\n     scriptcheckqueue.Thread();\n }\n \n+bool RunCheckInputsMaybeParallel(const CTransaction& tx, CValidationState &state, const CCoinsViewCache &inputs, unsigned int flags, bool cacheSigStore, bool cacheFullScriptStore, PrecomputedTransactionData& txdata, bool single_threaded_validation) EXCLUSIVE_LOCKS_REQUIRED(cs_main)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r305873419",
      "id" : 305873419,
      "in_reply_to_id" : 304618876,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNTg3MzQxOQ==",
      "original_commit_id" : "775b71d2c490d17a8576c1c88c5a7f3800483df9",
      "original_position" : 178,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 264851607,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169",
      "updated_at" : "2019-07-22T18:42:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/305873419",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "There was a silent merge conflict in the prior version of this PR ([15169.2](https://github.com/sdaftuar/bitcoin/commits/15169.2)) so I've rebased -- still intend to revisit the fix for the scriptcache and outstanding nits.",
      "created_at" : "2019-07-22T17:29:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#issuecomment-513878514",
      "id" : 513878514,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15169",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxMzg3ODUxNA==",
      "updated_at" : "2019-07-22T17:29:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/513878514",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Updated with an improved fix to the script caching issue; @jnewbery @TheBlueMatt care to take a look?",
      "created_at" : "2019-07-22T18:42:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#issuecomment-513905416",
      "id" : 513905416,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15169",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxMzkwNTQxNg==",
      "updated_at" : "2019-07-22T18:42:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/513905416",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r305976540"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/305976540"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "1de40f79276e3ad024ec823ca77c1fa5652fe56f",
      "created_at" : "2019-07-22T18:43:00Z",
      "diff_hunk" : "@@ -1672,6 +1675,23 @@ void ThreadScriptCheck(int worker_num) {\n     scriptcheckqueue.Thread();\n }\n \n+bool RunCheckInputsMaybeParallel(const CTransaction& tx, CValidationState &state, const CCoinsViewCache &inputs, unsigned int flags, bool cacheSigStore, bool cacheFullScriptStore, PrecomputedTransactionData& txdata, bool single_threaded_validation) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    uint256 hash_cache_entry;\n+    CCheckQueueControl<CScriptCheck> control((nScriptCheckThreads && !single_threaded_validation) ? &scriptcheckqueue : nullptr);\n+    std::vector<CScriptCheck> vChecks;\n+    if (!CheckInputs(tx, state, inputs, true, flags, cacheSigStore, cacheFullScriptStore, txdata, hash_cache_entry, (nScriptCheckThreads && !single_threaded_validation) ? &vChecks : nullptr)) {\n+        return false;\n+    }\n+    control.Add(vChecks);\n+    if (!control.Wait()) {\n+        return state.Invalid(ValidationInvalidReason::CONSENSUS, false, REJECT_INVALID, \"script-verify-flag-failed\");\n+    }\n+    if (nScriptCheckThreads && !single_threaded_validation && cacheFullScriptStore) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r305976540",
      "id" : 305976540,
      "in_reply_to_id" : 304940181,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNTk3NjU0MA==",
      "original_commit_id" : "775b71d2c490d17a8576c1c88c5a7f3800483df9",
      "original_position" : 190,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 264984359,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169",
      "updated_at" : "2019-07-22T18:43:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/305976540",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r305976856"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/305976856"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "1de40f79276e3ad024ec823ca77c1fa5652fe56f",
      "created_at" : "2019-07-22T18:43:48Z",
      "diff_hunk" : "@@ -895,6 +895,20 @@ static bool AcceptToMemoryPoolWorker(const CChainParams& chainparams, CTxMemPool\n         // This is done last to help prevent CPU exhaustion denial-of-service attacks.\n         PrecomputedTransactionData txdata(tx);\n         if (!CheckInputs(tx, state, view, true, scriptVerifyFlags, true, false, txdata)) {\n+            // Assume that this is due to a policy violation, rather than\n+            // re-checking with the consensus flags. Separating policy rules\n+            // from consensus rules is tricky, because we want to be able to\n+            // support old peers who may not be aware of recent consensus\n+            // changes; returning NOT_STANDARD here is maximally permissive.\n+            // Anyway re-checking the scripts with a different set of flags\n+            // wastes CPU as well (particularly if an attacker is constructing\n+            // transactions designed to waste our CPU).\n+            state.Invalid(ValidationInvalidReason::TX_NOT_STANDARD, false, REJECT_NONSTANDARD, state.GetRejectReason(), state.GetDebugMessage());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#discussion_r305976856",
      "id" : 305976856,
      "in_reply_to_id" : 302225458,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwNTk3Njg1Ng==",
      "original_commit_id" : "dd236e45b07caf8e486f32758e4de0e90a455f3a",
      "original_position" : 12,
      "path" : "src/validation.cpp",
      "position" : 85,
      "pull_request_review_id" : 264984751,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15169",
      "updated_at" : "2019-07-22T18:43:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/305976856",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-08-02T13:21:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15169#issuecomment-517698368",
      "id" : 517698368,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15169",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNzY5ODM2OA==",
      "updated_at" : "2019-08-02T13:21:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/517698368",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   }
]
