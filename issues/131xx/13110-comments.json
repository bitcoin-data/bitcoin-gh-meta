[
   {
      "author_association" : "OWNER",
      "body" : "Interesting: this assertion was added in #11074. This was indeed first released in 0.16.0.\r\n\r\nCan you try to run with that commit (6c4042a5d0796b732f441669117b909a3247e465) reverted?\r\n\r\nIt might segfault later on, I have no idea what can cause `copyFrom` to be null but apparently the assumption behind adding it was not correct.",
      "created_at" : "2018-04-30T12:20:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/13110#issuecomment-385382518",
      "id" : 385382518,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13110",
      "updated_at" : "2018-04-30T12:20:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/385382518",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "We should probably return early if there is nothing to copy from, i.e. `range.first == range.second`",
      "created_at" : "2018-04-30T12:43:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/13110#issuecomment-385387449",
      "id" : 385387449,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13110",
      "updated_at" : "2018-04-30T12:43:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/385387449",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Thanks for the response. I will try to (build and) run 0.16.0 with commit 6c4042a5d0796b732f441669117b909a3247e465 reverted but having limited time available at the moment it might take a while before I follow up.",
      "created_at" : "2018-04-30T18:15:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/13110#issuecomment-385483509",
      "id" : 385483509,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13110",
      "updated_at" : "2018-04-30T18:15:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/385483509",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1979526?v=4",
         "events_url" : "https://api.github.com/users/DeltaLeonis/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DeltaLeonis/followers",
         "following_url" : "https://api.github.com/users/DeltaLeonis/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DeltaLeonis/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DeltaLeonis",
         "id" : 1979526,
         "login" : "DeltaLeonis",
         "organizations_url" : "https://api.github.com/users/DeltaLeonis/orgs",
         "received_events_url" : "https://api.github.com/users/DeltaLeonis/received_events",
         "repos_url" : "https://api.github.com/users/DeltaLeonis/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DeltaLeonis/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DeltaLeonis/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DeltaLeonis"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "With commit 6c4042a5d0796b732f441669117b909a3247e465 reverted I get:\r\n```\r\nbitcoin-qt: wallet/wallet.cpp:547: void CWallet::SyncMetaData(std::pair<std::_Rb_tree_iterator<std::pair<const COutPoint, uint256> >, std::_Rb_tree_iterator<std::pair<const COutPoint, uint256> > >): Assertion `copyFrom && \"Oldest wallet transaction in range assumed to have been found.\"' failed.\r\n```\r\n\r\nI could try with commit fdc329376c8a0fa4dffd0cd2599a494a64c38472 additionally reverted but it seems obvious at this point that it would dereference a NULL pointer at\r\n```cpp\r\nif (!copyFrom->IsEquivalentTo(*copyTo)) continue;\r\n```",
      "created_at" : "2018-05-01T03:12:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/13110#issuecomment-385589303",
      "id" : 385589303,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13110",
      "updated_at" : "2018-05-01T03:12:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/385589303",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1979526?v=4",
         "events_url" : "https://api.github.com/users/DeltaLeonis/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DeltaLeonis/followers",
         "following_url" : "https://api.github.com/users/DeltaLeonis/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DeltaLeonis/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DeltaLeonis",
         "id" : 1979526,
         "login" : "DeltaLeonis",
         "organizations_url" : "https://api.github.com/users/DeltaLeonis/orgs",
         "received_events_url" : "https://api.github.com/users/DeltaLeonis/received_events",
         "repos_url" : "https://api.github.com/users/DeltaLeonis/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DeltaLeonis/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DeltaLeonis/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DeltaLeonis"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "This should work:\r\n```patch\r\ndiff --git a/src/wallet/wallet.cpp b/src/wallet/wallet.cpp\r\nindex 6e0f49f..844167d 100644\r\n--- a/src/wallet/wallet.cpp\r\n+++ b/src/wallet/wallet.cpp\r\n@@ -548,7 +548,9 @@ void CWallet::SyncMetaData(std::pair<TxSpends::iterator, TxSpends::iterator> ran\r\n         }\r\n     }\r\n \r\n-    assert(copyFrom);\r\n+    if (!copyFrom) {\r\n+        return;\r\n+    }\r\n \r\n     // Now copy data from copyFrom to rest:\r\n     for (TxSpends::iterator it = range.first; it != range.second; ++it)\r\n```",
      "created_at" : "2018-05-01T16:00:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/13110#issuecomment-385708583",
      "id" : 385708583,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13110",
      "updated_at" : "2018-05-01T16:00:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/385708583",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "This does indeed seem to work.\r\n\r\nHowever, I guess it only fixes the symptom but does not explain why `copyFrom` is a `nullptr` for me, yet isn't for most people? (well... that's what I assume).\r\n\r\nI have not tried to understand the code in more detail and/or run with GDB, but can try to do so if we want to understand the cause? Two remarks about this wallet:\r\n- It only consists of a few old transactions (over 300 000 confirmations) where coins were received\r\n- No coins were ever spent\r\n- It's not an HD wallet\r\n\r\nBy the way, note that the line\r\n```cpp\r\nassert(copyFrom && \"Oldest wallet transaction in range assumed to have been found.\");\r\n```\r\nseems superfluous to me anyway (either the `assert(copyFrom)` or your suggested patch will prevent it from ever failing).",
      "created_at" : "2018-05-03T06:55:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/13110#issuecomment-386205959",
      "id" : 386205959,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13110",
      "updated_at" : "2018-05-03T06:55:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/386205959",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1979526?v=4",
         "events_url" : "https://api.github.com/users/DeltaLeonis/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DeltaLeonis/followers",
         "following_url" : "https://api.github.com/users/DeltaLeonis/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DeltaLeonis/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DeltaLeonis",
         "id" : 1979526,
         "login" : "DeltaLeonis",
         "organizations_url" : "https://api.github.com/users/DeltaLeonis/orgs",
         "received_events_url" : "https://api.github.com/users/DeltaLeonis/received_events",
         "repos_url" : "https://api.github.com/users/DeltaLeonis/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DeltaLeonis/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DeltaLeonis/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DeltaLeonis"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think the explanation is simply that in your case, there is no metadata to sync, so the range is empty.",
      "created_at" : "2018-05-17T20:17:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/13110#issuecomment-389996781",
      "id" : 389996781,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13110",
      "updated_at" : "2018-05-17T20:17:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/389996781",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
