[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "It looks like an empty line needs to be added to the commit message after the subject line for the linter to pass.",
      "created_at" : "2021-07-01T14:40:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#issuecomment-872304091",
      "id" : 872304091,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3MjMwNDA5MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-01T14:40:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/872304091",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I think this would change the behavior of `GetTransaction` in some cases. I'm not sure whether this is OK or not, but I'd think we should at least update comments here: https://github.com/bitcoin/bitcoin/blob/master/src/validation.h#L146, and docs here: https://github.com/bitcoin/bitcoin/blob/master/src/rpc/rawtransaction.cpp#L78\r\n\r\nThe case I'm thinking about, which you noted, is when an incorrect `block_index` is provided to `GetTransaction`, but `g_txindex->FindTx(hash, hashBlock, tx)` finds and returns the tx. After this PR we would return the tx although it isn't in the block the user asked for. Idk the implications of this or if it matters, but if it does, you could probably check `hashBlock` against the user provided `block_index` and get the performance win you want without changing behavior (if necessary/practical)\r\n\r\nSimilarly, I'm not sure if checking the mempool first has any unintended consequences (other than deviating from current docs). That said, I'm not sure the `if (mempool) {` branch needs to move in this PR, can probably just leave it after the `if (block_index) {` branch as is. Again, not sure how we feel about returning a tx from the mempool when the user wanted to check a specific `block_index`",
      "created_at" : "2021-07-01T16:31:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#issuecomment-872388955",
      "id" : 872388955,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3MjM4ODk1NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-01T16:31:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/872388955",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7217256?v=4",
         "events_url" : "https://api.github.com/users/mjdietzx/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mjdietzx/followers",
         "following_url" : "https://api.github.com/users/mjdietzx/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mjdietzx/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mjdietzx",
         "id" : 7217256,
         "login" : "mjdietzx",
         "node_id" : "MDQ6VXNlcjcyMTcyNTY=",
         "organizations_url" : "https://api.github.com/users/mjdietzx/orgs",
         "received_events_url" : "https://api.github.com/users/mjdietzx/received_events",
         "repos_url" : "https://api.github.com/users/mjdietzx/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mjdietzx/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mjdietzx/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mjdietzx"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I think a fundamental question is whether or not the block_index is intended to be used as a hint or as a validation parameter.\r\n\r\nGiven that the current logic of this function has various fallbacks, it seems to me that block_index is a hint and that the goal of the function is to try to return the requested transaction regardless of where it is stored. So it seems to me that reorganizing the logic for performance gains is a suitable goal.",
      "created_at" : "2021-07-01T18:37:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#issuecomment-872465440",
      "id" : 872465440,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3MjQ2NTQ0MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-01T18:37:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/872465440",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/288011?v=4",
         "events_url" : "https://api.github.com/users/jlopp/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jlopp/followers",
         "following_url" : "https://api.github.com/users/jlopp/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jlopp/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jlopp",
         "id" : 288011,
         "login" : "jlopp",
         "node_id" : "MDQ6VXNlcjI4ODAxMQ==",
         "organizations_url" : "https://api.github.com/users/jlopp/orgs",
         "received_events_url" : "https://api.github.com/users/jlopp/received_events",
         "repos_url" : "https://api.github.com/users/jlopp/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jlopp/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jlopp/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jlopp"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "FindTx returns the block hash, so it's very easy to check if it matches. If you do so, the question of whether the provided block is a hint or a search restriction doesn't apply.",
      "created_at" : "2021-07-01T18:45:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#issuecomment-872470202",
      "id" : 872470202,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3MjQ3MDIwMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-01T18:45:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/872470202",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r662813217"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662813217"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`g_index`? How about `If -txindex is enabled, check it next for the tx`.",
      "commit_id" : "6dd28e76884c72681767b5a43d8960b9904ac3e0",
      "created_at" : "2021-07-02T07:52:09Z",
      "diff_hunk" : "@@ -142,15 +142,16 @@ void StartScriptCheckWorkerThreads(int threads_num);\n /** Stop all of the script checking worker threads */\n void StopScriptCheckWorkerThreads();\n /**\n- * Return transaction from the block at block_index.\n- * If block_index is not provided, fall back to mempool.\n- * If mempool is not provided or the tx couldn't be found in mempool, fall back to g_txindex.\n+ * Return transaction with a given hash.\n+ * If mempool is provided, check it first for the tx.\n+ * If g_index is available, check it next for the tx.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r662813217",
      "id" : 662813217,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MjgxMzIxNw==",
      "original_commit_id" : "5ab22ef9445522748393ebceb0ca41a6b13a2bc3",
      "original_line" : 147,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 697919335,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-02T08:12:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662813217",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r662819949"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662819949"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Something like the following would keep behavior?\r\n```cpp\r\nuint256 block_hash;\r\nif (g_txindex->FindTx(hash, block_hash, tx)) {\r\n    if (block_index && block_index->GetBlockHash() != block_hash) return nullptr;\r\n    hashBlock = block_hash;\r\n    return tx;\r\n}\r\n```\r\nNote the local `block_hash` to avoid changing the out-arg in case it fails.",
      "commit_id" : "6dd28e76884c72681767b5a43d8960b9904ac3e0",
      "created_at" : "2021-07-02T08:02:33Z",
      "diff_hunk" : "@@ -1159,6 +1159,14 @@ CTransactionRef GetTransaction(const CBlockIndex* const block_index, const CTxMe\n {\n     LOCK(cs_main);\n \n+    if (mempool) {\n+        CTransactionRef ptx = mempool->get(hash);\n+        if (ptx) return ptx;\n+    }\n+    if (g_txindex) {\n+        CTransactionRef tx;\n+        if (g_txindex->FindTx(hash, hashBlock, tx)) return tx;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r662819949",
      "id" : 662819949,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MjgxOTk0OQ==",
      "original_commit_id" : "5ab22ef9445522748393ebceb0ca41a6b13a2bc3",
      "original_line" : 1168,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 697919335,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-02T08:12:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662819949",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r662821224"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662821224"
         }
      },
      "author_association" : "MEMBER",
      "body" : "same, `... via -txindex or ...`",
      "commit_id" : "6dd28e76884c72681767b5a43d8960b9904ac3e0",
      "created_at" : "2021-07-02T08:04:48Z",
      "diff_hunk" : "@@ -142,15 +142,16 @@ void StartScriptCheckWorkerThreads(int threads_num);\n /** Stop all of the script checking worker threads */\n void StopScriptCheckWorkerThreads();\n /**\n- * Return transaction from the block at block_index.\n- * If block_index is not provided, fall back to mempool.\n- * If mempool is not provided or the tx couldn't be found in mempool, fall back to g_txindex.\n+ * Return transaction with a given hash.\n+ * If mempool is provided, check it first for the tx.\n+ * If g_index is available, check it next for the tx.\n+ * Finally, if block_index is provided, check for tx by reading entire block from disk.\n  *\n  * @param[in]  block_index     The block to read from disk, or nullptr\n  * @param[in]  mempool         If block_index is not provided, look in the mempool, if provided\n  * @param[in]  hash            The txid\n  * @param[in]  consensusParams The params\n- * @param[out] hashBlock       The hash of block_index, if the tx was found via block_index\n+ * @param[out] hashBlock       The block hash, if the tx was found via g_txindex or block_index",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r662821224",
      "id" : 662821224,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MjgyMTIyNA==",
      "original_commit_id" : "5ab22ef9445522748393ebceb0ca41a6b13a2bc3",
      "original_line" : 154,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 697919335,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-02T08:12:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662821224",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r662991449"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662991449"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Sure; will update.",
      "commit_id" : "6dd28e76884c72681767b5a43d8960b9904ac3e0",
      "created_at" : "2021-07-02T12:54:35Z",
      "diff_hunk" : "@@ -142,15 +142,16 @@ void StartScriptCheckWorkerThreads(int threads_num);\n /** Stop all of the script checking worker threads */\n void StopScriptCheckWorkerThreads();\n /**\n- * Return transaction from the block at block_index.\n- * If block_index is not provided, fall back to mempool.\n- * If mempool is not provided or the tx couldn't be found in mempool, fall back to g_txindex.\n+ * Return transaction with a given hash.\n+ * If mempool is provided, check it first for the tx.\n+ * If g_index is available, check it next for the tx.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r662991449",
      "id" : 662991449,
      "in_reply_to_id" : 662813217,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2Mjk5MTQ0OQ==",
      "original_commit_id" : "5ab22ef9445522748393ebceb0ca41a6b13a2bc3",
      "original_line" : 147,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 698156964,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-02T12:54:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662991449",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/288011?v=4",
         "events_url" : "https://api.github.com/users/jlopp/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jlopp/followers",
         "following_url" : "https://api.github.com/users/jlopp/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jlopp/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jlopp",
         "id" : 288011,
         "login" : "jlopp",
         "node_id" : "MDQ6VXNlcjI4ODAxMQ==",
         "organizations_url" : "https://api.github.com/users/jlopp/orgs",
         "received_events_url" : "https://api.github.com/users/jlopp/received_events",
         "repos_url" : "https://api.github.com/users/jlopp/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jlopp/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jlopp/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jlopp"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r662991716"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662991716"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Makes sense; I can add a similar check for the mempool condition.",
      "commit_id" : "6dd28e76884c72681767b5a43d8960b9904ac3e0",
      "created_at" : "2021-07-02T12:55:00Z",
      "diff_hunk" : "@@ -1159,6 +1159,14 @@ CTransactionRef GetTransaction(const CBlockIndex* const block_index, const CTxMe\n {\n     LOCK(cs_main);\n \n+    if (mempool) {\n+        CTransactionRef ptx = mempool->get(hash);\n+        if (ptx) return ptx;\n+    }\n+    if (g_txindex) {\n+        CTransactionRef tx;\n+        if (g_txindex->FindTx(hash, hashBlock, tx)) return tx;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r662991716",
      "id" : 662991716,
      "in_reply_to_id" : 662819949,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2Mjk5MTcxNg==",
      "original_commit_id" : "5ab22ef9445522748393ebceb0ca41a6b13a2bc3",
      "original_line" : 1168,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 698157299,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-02T12:55:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662991716",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/288011?v=4",
         "events_url" : "https://api.github.com/users/jlopp/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jlopp/followers",
         "following_url" : "https://api.github.com/users/jlopp/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jlopp/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jlopp",
         "id" : 288011,
         "login" : "jlopp",
         "node_id" : "MDQ6VXNlcjI4ODAxMQ==",
         "organizations_url" : "https://api.github.com/users/jlopp/orgs",
         "received_events_url" : "https://api.github.com/users/jlopp/received_events",
         "repos_url" : "https://api.github.com/users/jlopp/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jlopp/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jlopp/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jlopp"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r662991827"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662991827"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Sure; will update.",
      "commit_id" : "6dd28e76884c72681767b5a43d8960b9904ac3e0",
      "created_at" : "2021-07-02T12:55:10Z",
      "diff_hunk" : "@@ -142,15 +142,16 @@ void StartScriptCheckWorkerThreads(int threads_num);\n /** Stop all of the script checking worker threads */\n void StopScriptCheckWorkerThreads();\n /**\n- * Return transaction from the block at block_index.\n- * If block_index is not provided, fall back to mempool.\n- * If mempool is not provided or the tx couldn't be found in mempool, fall back to g_txindex.\n+ * Return transaction with a given hash.\n+ * If mempool is provided, check it first for the tx.\n+ * If g_index is available, check it next for the tx.\n+ * Finally, if block_index is provided, check for tx by reading entire block from disk.\n  *\n  * @param[in]  block_index     The block to read from disk, or nullptr\n  * @param[in]  mempool         If block_index is not provided, look in the mempool, if provided\n  * @param[in]  hash            The txid\n  * @param[in]  consensusParams The params\n- * @param[out] hashBlock       The hash of block_index, if the tx was found via block_index\n+ * @param[out] hashBlock       The block hash, if the tx was found via g_txindex or block_index",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r662991827",
      "id" : 662991827,
      "in_reply_to_id" : 662821224,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2Mjk5MTgyNw==",
      "original_commit_id" : "5ab22ef9445522748393ebceb0ca41a6b13a2bc3",
      "original_line" : 154,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 698157449,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-02T12:55:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662991827",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/288011?v=4",
         "events_url" : "https://api.github.com/users/jlopp/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jlopp/followers",
         "following_url" : "https://api.github.com/users/jlopp/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jlopp/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jlopp",
         "id" : 288011,
         "login" : "jlopp",
         "node_id" : "MDQ6VXNlcjI4ODAxMQ==",
         "organizations_url" : "https://api.github.com/users/jlopp/orgs",
         "received_events_url" : "https://api.github.com/users/jlopp/received_events",
         "repos_url" : "https://api.github.com/users/jlopp/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jlopp/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jlopp/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jlopp"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I've added additional checks that should ensure there is no behavior change, only performance improvements. Now it should return nullptr faster in certain conditions.",
      "created_at" : "2021-07-02T12:58:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#issuecomment-872977773",
      "id" : 872977773,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3Mjk3Nzc3Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-02T12:58:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/872977773",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/288011?v=4",
         "events_url" : "https://api.github.com/users/jlopp/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jlopp/followers",
         "following_url" : "https://api.github.com/users/jlopp/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jlopp/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jlopp",
         "id" : 288011,
         "login" : "jlopp",
         "node_id" : "MDQ6VXNlcjI4ODAxMQ==",
         "organizations_url" : "https://api.github.com/users/jlopp/orgs",
         "received_events_url" : "https://api.github.com/users/jlopp/received_events",
         "repos_url" : "https://api.github.com/users/jlopp/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jlopp/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jlopp/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jlopp"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r663000869"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663000869"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It could be an orphaned block and tx went back to the pool? I think previously it would return the transaction.\r\n\r\nMight be better just do `if (mempool && !block_index) {` in L1162?",
      "commit_id" : "6dd28e76884c72681767b5a43d8960b9904ac3e0",
      "created_at" : "2021-07-02T13:09:29Z",
      "diff_hunk" : "@@ -1159,6 +1159,24 @@ CTransactionRef GetTransaction(const CBlockIndex* const block_index, const CTxMe\n {\n     LOCK(cs_main);\n \n+    if (mempool) {\n+        CTransactionRef ptx = mempool->get(hash);\n+        if (ptx) {\n+            // Transaction was found in mempool but we were searching for it in a block.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r663000869",
      "id" : 663000869,
      "line" : 1165,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MzAwMDg2OQ==",
      "original_commit_id" : "6dd28e76884c72681767b5a43d8960b9904ac3e0",
      "original_line" : 1165,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 7,
      "pull_request_review_id" : 698169905,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-02T13:12:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663000869",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r663241855"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663241855"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ðð¼ ",
      "commit_id" : "5dd11ea1406f4926ab9061702b69b409459723b4",
      "created_at" : "2021-07-02T20:51:16Z",
      "diff_hunk" : "@@ -1159,6 +1159,24 @@ CTransactionRef GetTransaction(const CBlockIndex* const block_index, const CTxMe\n {\n     LOCK(cs_main);\n \n+    if (mempool) {\n+        CTransactionRef ptx = mempool->get(hash);\n+        if (ptx) {\n+            // Transaction was found in mempool but we were searching for it in a block.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r663241855",
      "id" : 663241855,
      "in_reply_to_id" : 663000869,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MzI0MTg1NQ==",
      "original_commit_id" : "6dd28e76884c72681767b5a43d8960b9904ac3e0",
      "original_line" : 1165,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 698492344,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-02T20:51:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663241855",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/288011?v=4",
         "events_url" : "https://api.github.com/users/jlopp/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jlopp/followers",
         "following_url" : "https://api.github.com/users/jlopp/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jlopp/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jlopp",
         "id" : 288011,
         "login" : "jlopp",
         "node_id" : "MDQ6VXNlcjI4ODAxMQ==",
         "organizations_url" : "https://api.github.com/users/jlopp/orgs",
         "received_events_url" : "https://api.github.com/users/jlopp/received_events",
         "repos_url" : "https://api.github.com/users/jlopp/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jlopp/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jlopp/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jlopp"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r663267393"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663267393"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Really edge case but I think this should be:\r\n```cpp\r\nif (!block_index || block_index->GetBlockHash() == block_hash) {\r\n    hashBlock = block_hash;\r\n    return tx;\r\n}\r\n```\r\nSo if the block hash doesn't match with the index then fall thru the next check - the transaction can be in another block right?",
      "commit_id" : "5dd11ea1406f4926ab9061702b69b409459723b4",
      "created_at" : "2021-07-02T22:15:19Z",
      "diff_hunk" : "@@ -1159,6 +1159,20 @@ CTransactionRef GetTransaction(const CBlockIndex* const block_index, const CTxMe\n {\n     LOCK(cs_main);\n \n+    if (mempool && !block_index) {\n+        CTransactionRef ptx = mempool->get(hash);\n+        if (ptx) return ptx;\n+    }\n+    if (g_txindex) {\n+        CTransactionRef tx;\n+        uint256 block_hash;\n+        if (g_txindex->FindTx(hash, block_hash, tx)) {\n+            // Transaction was found in a different block than requested.\n+            if (block_index && block_index->GetBlockHash() != block_hash) return nullptr;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r663267393",
      "id" : 663267393,
      "line" : 1171,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MzI2NzM5Mw==",
      "original_commit_id" : "5dd11ea1406f4926ab9061702b69b409459723b4",
      "original_line" : 1171,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 13,
      "pull_request_review_id" : 698522695,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-02T22:15:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663267393",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "review ACK 5dd11ea1406f4926ab9061702b69b409459723b4",
      "created_at" : "2021-07-03T07:38:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#issuecomment-873363488",
      "id" : 873363488,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3MzM2MzQ4OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-03T07:38:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/873363488",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r663347449"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663347449"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit if you retouch\r\n```suggestion\r\n                \"\\nBy default, this call only returns a transaction if it is in the mempool. If -txindex is enabled\\n\"\r\n```",
      "commit_id" : "78f4c8b98eada337346ffb206339c3ebae4ff43b",
      "created_at" : "2021-07-03T10:18:30Z",
      "diff_hunk" : "@@ -74,12 +74,10 @@ static RPCHelpMan getrawtransaction()\n                 \"getrawtransaction\",\n                 \"\\nReturn the raw transaction data.\\n\"\n \n-                \"\\nBy default this function only works for mempool transactions. When called with a blockhash\\n\"\n-                \"argument, getrawtransaction will return the transaction if the specified block is available and\\n\"\n-                \"the transaction is found in that block. When called without a blockhash argument, getrawtransaction\\n\"\n-                \"will return the transaction if it is in the mempool, or if -txindex is enabled and the transaction\\n\"\n-                \"is in a block in the blockchain.\\n\"\n-\n+                \"\\nBy default this function only returns a transaction if it is in the mempool. If -txindex is enabled\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r663347449",
      "id" : 663347449,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MzM0NzQ0OQ==",
      "original_commit_id" : "5dd11ea1406f4926ab9061702b69b409459723b4",
      "original_line" : 77,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : null,
      "pull_request_review_id" : 698583510,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-03T11:05:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663347449",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r663348910"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663348910"
         }
      },
      "author_association" : "MEMBER",
      "body" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r663267393 seems preferable, otherwise move comment to the right place (or omit it)\r\n```diff\r\n@@ -1167,8 +1167,10 @@ CTransactionRef GetTransaction(const CBlockIndex* const block_index, const CTxMe\r\n         CTransactionRef tx;\r\n         uint256 block_hash;\r\n         if (g_txindex->FindTx(hash, block_hash, tx)) {\r\n-            // Transaction was found in a different block than requested.\r\n-            if (block_index && block_index->GetBlockHash() != block_hash) return nullptr;\r\n+            if (block_index && block_index->GetBlockHash() != block_hash) {\r\n+                // Transaction was found in a different block than requested.\r\n+                return nullptr;\r\n+            }\r\n             hashBlock = block_hash;\r\n             return tx;\r\n```\r\n",
      "commit_id" : "78f4c8b98eada337346ffb206339c3ebae4ff43b",
      "created_at" : "2021-07-03T10:33:49Z",
      "diff_hunk" : "@@ -1159,6 +1159,20 @@ CTransactionRef GetTransaction(const CBlockIndex* const block_index, const CTxMe\n {\n     LOCK(cs_main);\n \n+    if (mempool && !block_index) {\n+        CTransactionRef ptx = mempool->get(hash);\n+        if (ptx) return ptx;\n+    }\n+    if (g_txindex) {\n+        CTransactionRef tx;\n+        uint256 block_hash;\n+        if (g_txindex->FindTx(hash, block_hash, tx)) {\n+            // Transaction was found in a different block than requested.\n+            if (block_index && block_index->GetBlockHash() != block_hash) return nullptr;\n+            hashBlock = block_hash;\n+            return tx;\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r663348910",
      "id" : 663348910,
      "line" : 1174,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MzM0ODkxMA==",
      "original_commit_id" : "5dd11ea1406f4926ab9061702b69b409459723b4",
      "original_line" : 1174,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 16,
      "pull_request_review_id" : 698583510,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-03T11:05:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663348910",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r663354682"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663354682"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "indeed",
      "commit_id" : "78f4c8b98eada337346ffb206339c3ebae4ff43b",
      "created_at" : "2021-07-03T11:32:16Z",
      "diff_hunk" : "@@ -1159,6 +1159,20 @@ CTransactionRef GetTransaction(const CBlockIndex* const block_index, const CTxMe\n {\n     LOCK(cs_main);\n \n+    if (mempool && !block_index) {\n+        CTransactionRef ptx = mempool->get(hash);\n+        if (ptx) return ptx;\n+    }\n+    if (g_txindex) {\n+        CTransactionRef tx;\n+        uint256 block_hash;\n+        if (g_txindex->FindTx(hash, block_hash, tx)) {\n+            // Transaction was found in a different block than requested.\n+            if (block_index && block_index->GetBlockHash() != block_hash) return nullptr;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r663354682",
      "id" : 663354682,
      "in_reply_to_id" : 663267393,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MzM1NDY4Mg==",
      "original_commit_id" : "5dd11ea1406f4926ab9061702b69b409459723b4",
      "original_line" : 1171,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 698587713,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-03T11:32:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663354682",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/288011?v=4",
         "events_url" : "https://api.github.com/users/jlopp/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jlopp/followers",
         "following_url" : "https://api.github.com/users/jlopp/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jlopp/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jlopp",
         "id" : 288011,
         "login" : "jlopp",
         "node_id" : "MDQ6VXNlcjI4ODAxMQ==",
         "organizations_url" : "https://api.github.com/users/jlopp/orgs",
         "received_events_url" : "https://api.github.com/users/jlopp/received_events",
         "repos_url" : "https://api.github.com/users/jlopp/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jlopp/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jlopp/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jlopp"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 78f4c8b98eada337346ffb206339c3ebae4ff43b",
      "created_at" : "2021-07-03T12:03:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#issuecomment-873397253",
      "id" : 873397253,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3MzM5NzI1Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-03T12:03:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/873397253",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2021-07-03T16:50:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#issuecomment-873436275",
      "id" : 873436275,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3MzQzNjI3NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-03T16:50:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/873436275",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r663389869"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663389869"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This shouldn't happen, though, as the `FindTx` wouldn't return true?",
      "commit_id" : "78f4c8b98eada337346ffb206339c3ebae4ff43b",
      "created_at" : "2021-07-03T17:36:39Z",
      "diff_hunk" : "@@ -1159,6 +1159,20 @@ CTransactionRef GetTransaction(const CBlockIndex* const block_index, const CTxMe\n {\n     LOCK(cs_main);\n \n+    if (mempool && !block_index) {\n+        CTransactionRef ptx = mempool->get(hash);\n+        if (ptx) return ptx;\n+    }\n+    if (g_txindex) {\n+        CTransactionRef tx;\n+        uint256 block_hash;\n+        if (g_txindex->FindTx(hash, block_hash, tx)) {\n+            // Transaction was found in a different block than requested.\n+            if (block_index && block_index->GetBlockHash() != block_hash) return nullptr;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r663389869",
      "id" : 663389869,
      "in_reply_to_id" : 663267393,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MzM4OTg2OQ==",
      "original_commit_id" : "5dd11ea1406f4926ab9061702b69b409459723b4",
      "original_line" : 1171,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 698608862,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-03T17:36:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663389869",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r663395936"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663395936"
         }
      },
      "author_association" : "MEMBER",
      "body" : "txindex only keeps 1 block hash right?",
      "commit_id" : "78f4c8b98eada337346ffb206339c3ebae4ff43b",
      "created_at" : "2021-07-03T18:41:57Z",
      "diff_hunk" : "@@ -1159,6 +1159,20 @@ CTransactionRef GetTransaction(const CBlockIndex* const block_index, const CTxMe\n {\n     LOCK(cs_main);\n \n+    if (mempool && !block_index) {\n+        CTransactionRef ptx = mempool->get(hash);\n+        if (ptx) return ptx;\n+    }\n+    if (g_txindex) {\n+        CTransactionRef tx;\n+        uint256 block_hash;\n+        if (g_txindex->FindTx(hash, block_hash, tx)) {\n+            // Transaction was found in a different block than requested.\n+            if (block_index && block_index->GetBlockHash() != block_hash) return nullptr;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r663395936",
      "id" : 663395936,
      "in_reply_to_id" : 663267393,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MzM5NTkzNg==",
      "original_commit_id" : "5dd11ea1406f4926ab9061702b69b409459723b4",
      "original_line" : 1171,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 698612208,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-03T18:41:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663395936",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r663396921"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663396921"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oh, I didn't think of BIP 30",
      "commit_id" : "78f4c8b98eada337346ffb206339c3ebae4ff43b",
      "created_at" : "2021-07-03T18:52:20Z",
      "diff_hunk" : "@@ -1159,6 +1159,20 @@ CTransactionRef GetTransaction(const CBlockIndex* const block_index, const CTxMe\n {\n     LOCK(cs_main);\n \n+    if (mempool && !block_index) {\n+        CTransactionRef ptx = mempool->get(hash);\n+        if (ptx) return ptx;\n+    }\n+    if (g_txindex) {\n+        CTransactionRef tx;\n+        uint256 block_hash;\n+        if (g_txindex->FindTx(hash, block_hash, tx)) {\n+            // Transaction was found in a different block than requested.\n+            if (block_index && block_index->GetBlockHash() != block_hash) return nullptr;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r663396921",
      "id" : 663396921,
      "in_reply_to_id" : 663267393,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MzM5NjkyMQ==",
      "original_commit_id" : "5dd11ea1406f4926ab9061702b69b409459723b4",
      "original_line" : 1171,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 698612705,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-03T18:52:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663396921",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r663533270"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663533270"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Also, `block_index` could be an orphaned block where the transaction is but in the index the block is the one in the chain.",
      "commit_id" : "78f4c8b98eada337346ffb206339c3ebae4ff43b",
      "created_at" : "2021-07-04T17:21:37Z",
      "diff_hunk" : "@@ -1159,6 +1159,20 @@ CTransactionRef GetTransaction(const CBlockIndex* const block_index, const CTxMe\n {\n     LOCK(cs_main);\n \n+    if (mempool && !block_index) {\n+        CTransactionRef ptx = mempool->get(hash);\n+        if (ptx) return ptx;\n+    }\n+    if (g_txindex) {\n+        CTransactionRef tx;\n+        uint256 block_hash;\n+        if (g_txindex->FindTx(hash, block_hash, tx)) {\n+            // Transaction was found in a different block than requested.\n+            if (block_index && block_index->GetBlockHash() != block_hash) return nullptr;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r663533270",
      "id" : 663533270,
      "in_reply_to_id" : 663267393,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MzUzMzI3MA==",
      "original_commit_id" : "5dd11ea1406f4926ab9061702b69b409459723b4",
      "original_line" : 1171,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 698694318,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-04T17:21:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663533270",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r664172064"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664172064"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: there is the case where -txindex is enabled and a blockhash argument is passed, where it will return the transaction only if the block it's found in matches the blockhash argument passed",
      "commit_id" : "78f4c8b98eada337346ffb206339c3ebae4ff43b",
      "created_at" : "2021-07-06T00:59:19Z",
      "diff_hunk" : "@@ -74,12 +74,10 @@ static RPCHelpMan getrawtransaction()\n                 \"getrawtransaction\",\n                 \"\\nReturn the raw transaction data.\\n\"\n \n-                \"\\nBy default this function only works for mempool transactions. When called with a blockhash\\n\"\n-                \"argument, getrawtransaction will return the transaction if the specified block is available and\\n\"\n-                \"the transaction is found in that block. When called without a blockhash argument, getrawtransaction\\n\"\n-                \"will return the transaction if it is in the mempool, or if -txindex is enabled and the transaction\\n\"\n-                \"is in a block in the blockchain.\\n\"\n-\n+                \"\\nBy default, this call only returns a transaction if it is in the mempool. If -txindex is enabled\\n\"\n+                \"and no blockhash argument is passed, it will return the transaction if it is in the mempool or any block.\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r664172064",
      "id" : 664172064,
      "line" : 78,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NDE3MjA2NA==",
      "original_commit_id" : "78f4c8b98eada337346ffb206339c3ebae4ff43b",
      "original_line" : 78,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : 11,
      "pull_request_review_id" : 699462554,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-14T19:54:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664172064",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7217256?v=4",
         "events_url" : "https://api.github.com/users/mjdietzx/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mjdietzx/followers",
         "following_url" : "https://api.github.com/users/mjdietzx/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mjdietzx/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mjdietzx",
         "id" : 7217256,
         "login" : "mjdietzx",
         "node_id" : "MDQ6VXNlcjcyMTcyNTY=",
         "organizations_url" : "https://api.github.com/users/mjdietzx/orgs",
         "received_events_url" : "https://api.github.com/users/mjdietzx/received_events",
         "repos_url" : "https://api.github.com/users/mjdietzx/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mjdietzx/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mjdietzx/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mjdietzx"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "NACK  -- In general, I think performance optimizations should come with data that shows they improve things. Especially in the case the code isn't being cleaned up or simplified (I think this PR makes the code slightly more complicated and harder to follow so I'd want to be sure the performance improvements warrant it). I also have other concerns which I lay out below. I can quickly come around on my review with some explanation/correction to my understanding if I'm off base anywhere.\r\n\r\n---\r\n\r\n> Motivation: prevent excessive disk reads if txindex is enabled.\r\n\r\nHowever, from #22382 which this PR fixes, the issue is reported as:\r\n> When using getrawtransaction with an included blockhash, performance should be better as there is no need to scan the entire txindex.\r\n\r\nWas the issue misread? Because the issue expects scanning the entire txindex causes a slowdown, while this PR claims excessive disk reads (in the case that txindex is enabled) causes a slowdown. So to me the two seem to contradict each other.\r\n\r\n---\r\n\r\nTo me it seems both `ReadBlockFromDisk` and `g_txindex->FindTx` do the same disk read, so I'm not sure how this change \"prevents excessive disk reads\" (please correct me if I'm misunderstanding something basic, I'm learning):\r\n  - https://github.com/bitcoin/bitcoin/blob/master/src/node/blockstorage.cpp#L370\r\n  - https://github.com/bitcoin/bitcoin/blob/master/src/index/txindex.cpp#L238\r\n\r\nIf I'm understanding this correctly, the main benefit of txindex being enabled is that **we don't need** `blockhash` to be specified to know which block to look in for the transaction, so we can still find it, but the same disk read is happens in both cases.\r\n\r\n---\r\n\r\nNow the measurements provided in the issue seem to show some performance discrepancy (which maybe @jlopp just looked at and knew what was going on right away). But I also don't know how much variation is normal in the timing of rpc calls, and whether one measurement (under unknown conditions) is good enough to warrant a performance optimization. On top of that it's only one data point - what if this tx reported in the issue happens to be at the beginning/end of txindex or who knows what?",
      "created_at" : "2021-07-06T02:15:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#issuecomment-874410913",
      "id" : 874410913,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3NDQxMDkxMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-06T02:15:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/874410913",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7217256?v=4",
         "events_url" : "https://api.github.com/users/mjdietzx/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mjdietzx/followers",
         "following_url" : "https://api.github.com/users/mjdietzx/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mjdietzx/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mjdietzx",
         "id" : 7217256,
         "login" : "mjdietzx",
         "node_id" : "MDQ6VXNlcjcyMTcyNTY=",
         "organizations_url" : "https://api.github.com/users/mjdietzx/orgs",
         "received_events_url" : "https://api.github.com/users/mjdietzx/received_events",
         "repos_url" : "https://api.github.com/users/mjdietzx/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mjdietzx/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mjdietzx/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mjdietzx"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> To me it seems both `ReadBlockFromDisk` and `g_txindex->FindTx` do the same disk read, so I'm not sure how this change \"prevents excessive disk reads\" (please correct me if I'm misunderstanding something basic, I'm learning):\r\n\r\n@mjdietzx txindex stores the transaction position in the block, so it just seeks there to parse the transaction. Without txindex it needs to load the block - parse transactions, build hashes,... - and then search in those transactions.",
      "created_at" : "2021-07-06T07:12:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#issuecomment-874518363",
      "id" : 874518363,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3NDUxODM2Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-06T07:12:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/874518363",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> txindex stores the transaction position in the block, so it just seeks there to parse the transaction. Without txindex it needs to load the block - parse transactions, build hashes,... - and then search in those transactions.\r\n\r\nMakes sense, and thanks for the explanation @promag. So is it safe to say scanning through the entire txindex and then \"seeking to the tx's position in the block and reading it from disk\" is much faster than \" load the block - parse transactions, build hashes,... - and then search in those transactions\"? Do we have any intuitions here, like big-O and/or worst-case runtimes?\r\n\r\nIf so, is it worth adding some good comments to the source code (not sure whether they are added in `GetTransaction` or in the `ReadBlockFromDisk` and `FindTx` declarations). Note, I have no intuition of the runtimes of these operations (due to my inexperience) so just lmk if this is obvious and unnecessary.\r\n\r\nBut here's where I'm coming from - how do I know the test measurements provided in #22382 are on mainnet (what if they are on some testnet where the txindex is extremely small? I can't find the transaction or block hashes from that issue in any block explorers). How do I even know -txindex is enabled for these measurements (and it's not just scanning through his wallet's transactions, and that's where the performance discrepancy comes from)?\r\n\r\nWithout some source code comments and data/measurments showing the performance differences here, it makes me wonder if the reason people pass `block_hash` in the first place is because it gets around scanning the entire txindex.\r\n",
      "created_at" : "2021-07-06T13:50:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#issuecomment-874777830",
      "id" : 874777830,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3NDc3NzgzMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-06T13:52:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/874777830",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7217256?v=4",
         "events_url" : "https://api.github.com/users/mjdietzx/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mjdietzx/followers",
         "following_url" : "https://api.github.com/users/mjdietzx/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mjdietzx/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mjdietzx",
         "id" : 7217256,
         "login" : "mjdietzx",
         "node_id" : "MDQ6VXNlcjcyMTcyNTY=",
         "organizations_url" : "https://api.github.com/users/mjdietzx/orgs",
         "received_events_url" : "https://api.github.com/users/mjdietzx/received_events",
         "repos_url" : "https://api.github.com/users/mjdietzx/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mjdietzx/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mjdietzx/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mjdietzx"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't believe that \"scanning through the entire txindex\" is an accurate way to describe how txindex->FindTx functions. I expect it to be more of a O(1) constant time operation while ReadBlockFromDisk() is more of a O(n) operation that is directly correlated to block size.",
      "created_at" : "2021-07-06T14:22:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#issuecomment-874805472",
      "id" : 874805472,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3NDgwNTQ3Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-06T14:22:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/874805472",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/288011?v=4",
         "events_url" : "https://api.github.com/users/jlopp/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jlopp/followers",
         "following_url" : "https://api.github.com/users/jlopp/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jlopp/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jlopp",
         "id" : 288011,
         "login" : "jlopp",
         "node_id" : "MDQ6VXNlcjI4ODAxMQ==",
         "organizations_url" : "https://api.github.com/users/jlopp/orgs",
         "received_events_url" : "https://api.github.com/users/jlopp/received_events",
         "repos_url" : "https://api.github.com/users/jlopp/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jlopp/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jlopp/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jlopp"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Right, it doesn't scan the entire txindex as keys are indexed. I think leveldb lookup is O(log n).\r\n\r\n#22382 shows the performance difference from each approach.",
      "created_at" : "2021-07-06T14:33:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#issuecomment-874814496",
      "id" : 874814496,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3NDgxNDQ5Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-06T14:44:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/874814496",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "FWIW, this is the compared performance with @jlopp's modifications\r\n\r\n```\r\n$ time ./src/bitcoin-cli getrawtransaction 20a93350cd6f4e03dfb6cbb3f104965293627f25c199c1be0e4d187a4ed5f4bb\r\n020000000001018d3f7d8efaa377dda74892af26c1ca028466d97721d2ea6c74a5cbcf404feb9004000000171600147f5a49a2d89f86ff498103bdbcb1762f9f0ab5aefeffffff08a04a05000000000017a91467a849785bb12f1a03260b3b52ec9dff52b30e708724b80100000000001976a914f0b7e8a5ede232c2654fca3b47f8d0c95f7a561688ac50fe0b00000000001976a914ed06524fb21248a37e7f8f20cdc67e27f49c4f1588acf44f01000000000017a9147422dbf3bdf441a640d09a2a91e6fa40837b019f878d9b3100000000001976a9142a5cd9333e4e94c88f7cd33216b2fc0af15fbd8588ac89b400000000000017a914d05dbcdb4587f1a243cc1ed89e96cd4ec19e24a08778e169180000000017a914f520df8923419f60d9a76df60cfc7a0e3a3fc86f8708d806000000000017a9147246c684dd4890e9c8977e6312c30ecdea2b0a55870247304402205704dd3b6d8930e89c660011ab2f6a42aedcbde438d5f121998e3db6a66889310220054a506aee274f885229d6a9ed89eca17bac87dca401f9c63d07990e98b2f0a301210390e3b178ebc51da1589baee9de37de491dba0575838aacf88c2cd70a06a4486eb47c0a00\r\n\r\nreal\t0m0.003s\r\nuser\t0m0.002s\r\nsys\t0m0.000s\r\n\r\n\r\n$ time ./src/bitcoin-cli getrawtransaction 20a93350cd6f4e03dfb6cbb3f104965293627f25c199c1be0e4d187a4ed5f4bb false 0000000000000000000a801776a92ced69dc5fb0a5919271872a9261a613d9c3\r\n020000000001018d3f7d8efaa377dda74892af26c1ca028466d97721d2ea6c74a5cbcf404feb9004000000171600147f5a49a2d89f86ff498103bdbcb1762f9f0ab5aefeffffff08a04a05000000000017a91467a849785bb12f1a03260b3b52ec9dff52b30e708724b80100000000001976a914f0b7e8a5ede232c2654fca3b47f8d0c95f7a561688ac50fe0b00000000001976a914ed06524fb21248a37e7f8f20cdc67e27f49c4f1588acf44f01000000000017a9147422dbf3bdf441a640d09a2a91e6fa40837b019f878d9b3100000000001976a9142a5cd9333e4e94c88f7cd33216b2fc0af15fbd8588ac89b400000000000017a914d05dbcdb4587f1a243cc1ed89e96cd4ec19e24a08778e169180000000017a914f520df8923419f60d9a76df60cfc7a0e3a3fc86f8708d806000000000017a9147246c684dd4890e9c8977e6312c30ecdea2b0a55870247304402205704dd3b6d8930e89c660011ab2f6a42aedcbde438d5f121998e3db6a66889310220054a506aee274f885229d6a9ed89eca17bac87dca401f9c63d07990e98b2f0a301210390e3b178ebc51da1589baee9de37de491dba0575838aacf88c2cd70a06a4486eb47c0a00\r\n\r\nreal\t0m0.003s\r\nuser\t0m0.002s\r\nsys\t0m0.000s\r\n```",
      "created_at" : "2021-07-13T07:38:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#issuecomment-878853661",
      "id" : 878853661,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3ODg1MzY2MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-13T07:38:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/878853661",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1876045?v=4",
         "events_url" : "https://api.github.com/users/orweinberger/events{/privacy}",
         "followers_url" : "https://api.github.com/users/orweinberger/followers",
         "following_url" : "https://api.github.com/users/orweinberger/following{/other_user}",
         "gists_url" : "https://api.github.com/users/orweinberger/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/orweinberger",
         "id" : 1876045,
         "login" : "orweinberger",
         "node_id" : "MDQ6VXNlcjE4NzYwNDU=",
         "organizations_url" : "https://api.github.com/users/orweinberger/orgs",
         "received_events_url" : "https://api.github.com/users/orweinberger/received_events",
         "repos_url" : "https://api.github.com/users/orweinberger/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/orweinberger/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/orweinberger/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/orweinberger"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I cherry-picked this change onto #22437 that adds a lot of `GetTransaction()` coverage and it doesn't see any change in behavior; all is green.",
      "created_at" : "2021-07-13T14:11:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#issuecomment-879123985",
      "id" : 879123985,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22383",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3OTEyMzk4NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-13T14:11:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/879123985",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r673590243"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/673590243"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n            if (!block_index) {\r\n                hashBlock = block_hash;\r\n                return tx;\r\n            }\r\n            if (block_index->GetBlockHash() != block_hash) return nullptr;\r\n```\r\nThis improves the performance of the case where a block hash is specified, but the transaction is found in a different block. The `if` at line 1170 would be false, so we would call `ReadBlockFromDisk()` below, but would not find the transaction there either (assuming the txindex is accurate).\r\n\r\nI cherry-picked this PR with this suggestion onto #22437 as @jonatack [described above](https://github.com/bitcoin/bitcoin/pull/22383#issuecomment-879123985), and the tests all pass.",
      "commit_id" : "78f4c8b98eada337346ffb206339c3ebae4ff43b",
      "created_at" : "2021-07-21T01:09:51Z",
      "diff_hunk" : "@@ -1159,6 +1159,20 @@ CTransactionRef GetTransaction(const CBlockIndex* const block_index, const CTxMe\n {\n     LOCK(cs_main);\n \n+    if (mempool && !block_index) {\n+        CTransactionRef ptx = mempool->get(hash);\n+        if (ptx) return ptx;\n+    }\n+    if (g_txindex) {\n+        CTransactionRef tx;\n+        uint256 block_hash;\n+        if (g_txindex->FindTx(hash, block_hash, tx)) {\n+            if (!block_index || block_index->GetBlockHash() == block_hash) {\n+                hashBlock = block_hash;\n+                return tx;\n+            }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r673590243",
      "id" : 673590243,
      "line" : 1173,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MzU5MDI0Mw==",
      "original_commit_id" : "78f4c8b98eada337346ffb206339c3ebae4ff43b",
      "original_line" : 1173,
      "original_position" : 15,
      "original_start_line" : 1170,
      "path" : "src/validation.cpp",
      "position" : 15,
      "pull_request_review_id" : 711178990,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383",
      "side" : "RIGHT",
      "start_line" : 1170,
      "start_side" : "RIGHT",
      "updated_at" : "2021-07-21T01:18:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/673590243",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r673591294"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/673591294"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n * @param[in]  mempool         If provided and block_index is not, check mempool for tx\r\n```",
      "commit_id" : "78f4c8b98eada337346ffb206339c3ebae4ff43b",
      "created_at" : "2021-07-21T01:13:15Z",
      "diff_hunk" : "@@ -142,15 +142,16 @@ void StartScriptCheckWorkerThreads(int threads_num);\n /** Stop all of the script checking worker threads */\n void StopScriptCheckWorkerThreads();\n /**\n- * Return transaction from the block at block_index.\n- * If block_index is not provided, fall back to mempool.\n- * If mempool is not provided or the tx couldn't be found in mempool, fall back to g_txindex.\n+ * Return transaction with a given hash.\n+ * If mempool is provided and block_index is not provided, check it first for the tx.\n+ * If -txindex is available, check it next for the tx.\n+ * Finally, if block_index is provided, check for tx by reading entire block from disk.\n  *\n  * @param[in]  block_index     The block to read from disk, or nullptr\n- * @param[in]  mempool         If block_index is not provided, look in the mempool, if provided\n+ * @param[in]  mempool         If provided, check mempool for tx",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r673591294",
      "id" : 673591294,
      "line" : 151,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MzU5MTI5NA==",
      "original_commit_id" : "78f4c8b98eada337346ffb206339c3ebae4ff43b",
      "original_line" : 151,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 14,
      "pull_request_review_id" : 711178990,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-21T01:18:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/673591294",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r673899065"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/673899065"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n            }\r\n            return nullptr;\r\n```\r\nNit: This improves the performance of the (unlikely) case where a block hash is specified, but the transaction is found in the txindex but in a different block. The `if` at line 1170 would be false, so we would call `ReadBlockFromDisk()` below, but would not find the transaction there either (assuming the txindex is accurate).\r\n\r\nI cherry-picked this PR with this suggestion onto #22437 as @jonatack [described above](https://github.com/bitcoin/bitcoin/pull/22383#issuecomment-879123985), and the tests all pass.",
      "commit_id" : "78f4c8b98eada337346ffb206339c3ebae4ff43b",
      "created_at" : "2021-07-21T11:43:57Z",
      "diff_hunk" : "@@ -1159,6 +1159,20 @@ CTransactionRef GetTransaction(const CBlockIndex* const block_index, const CTxMe\n {\n     LOCK(cs_main);\n \n+    if (mempool && !block_index) {\n+        CTransactionRef ptx = mempool->get(hash);\n+        if (ptx) return ptx;\n+    }\n+    if (g_txindex) {\n+        CTransactionRef tx;\n+        uint256 block_hash;\n+        if (g_txindex->FindTx(hash, block_hash, tx)) {\n+            if (!block_index || block_index->GetBlockHash() == block_hash) {\n+                hashBlock = block_hash;\n+                return tx;\n+            }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r673899065",
      "id" : 673899065,
      "line" : 1173,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3Mzg5OTA2NQ==",
      "original_commit_id" : "78f4c8b98eada337346ffb206339c3ebae4ff43b",
      "original_line" : 1173,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 15,
      "pull_request_review_id" : 711558121,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-21T16:53:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/673899065",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r674532918"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/674532918"
         }
      },
      "author_association" : "MEMBER",
      "body" : "How is this different from the initial solution: https://github.com/bitcoin/bitcoin/pull/22383#discussion_r663267393?",
      "commit_id" : "78f4c8b98eada337346ffb206339c3ebae4ff43b",
      "created_at" : "2021-07-22T06:32:55Z",
      "diff_hunk" : "@@ -1159,6 +1159,20 @@ CTransactionRef GetTransaction(const CBlockIndex* const block_index, const CTxMe\n {\n     LOCK(cs_main);\n \n+    if (mempool && !block_index) {\n+        CTransactionRef ptx = mempool->get(hash);\n+        if (ptx) return ptx;\n+    }\n+    if (g_txindex) {\n+        CTransactionRef tx;\n+        uint256 block_hash;\n+        if (g_txindex->FindTx(hash, block_hash, tx)) {\n+            if (!block_index || block_index->GetBlockHash() == block_hash) {\n+                hashBlock = block_hash;\n+                return tx;\n+            }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r674532918",
      "id" : 674532918,
      "in_reply_to_id" : 673899065,
      "line" : 1173,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3NDUzMjkxOA==",
      "original_commit_id" : "78f4c8b98eada337346ffb206339c3ebae4ff43b",
      "original_line" : 1173,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 15,
      "pull_request_review_id" : 712401628,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-22T06:32:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/674532918",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r674694240"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/674694240"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'd suggest just replacing this with `Optional pointer to the node's mempool` to avoid duplicating what's already documented above.",
      "commit_id" : "78f4c8b98eada337346ffb206339c3ebae4ff43b",
      "created_at" : "2021-07-22T10:56:46Z",
      "diff_hunk" : "@@ -142,15 +142,16 @@ void StartScriptCheckWorkerThreads(int threads_num);\n /** Stop all of the script checking worker threads */\n void StopScriptCheckWorkerThreads();\n /**\n- * Return transaction from the block at block_index.\n- * If block_index is not provided, fall back to mempool.\n- * If mempool is not provided or the tx couldn't be found in mempool, fall back to g_txindex.\n+ * Return transaction with a given hash.\n+ * If mempool is provided and block_index is not provided, check it first for the tx.\n+ * If -txindex is available, check it next for the tx.\n+ * Finally, if block_index is provided, check for tx by reading entire block from disk.\n  *\n  * @param[in]  block_index     The block to read from disk, or nullptr\n- * @param[in]  mempool         If block_index is not provided, look in the mempool, if provided\n+ * @param[in]  mempool         If provided, check mempool for tx",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r674694240",
      "id" : 674694240,
      "in_reply_to_id" : 673591294,
      "line" : 151,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3NDY5NDI0MA==",
      "original_commit_id" : "78f4c8b98eada337346ffb206339c3ebae4ff43b",
      "original_line" : 151,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 14,
      "pull_request_review_id" : 712607533,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-22T10:56:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/674694240",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r674695881"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/674695881"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think the following change addresses @mjdietzx's comment: https://github.com/bitcoin/bitcoin/pull/22383/files#r664172064\r\n\r\n```suggestion\r\n                \"If a blockhash argument is passed, it will return the transaction if\\n\"\r\n                \"the specified block is available and the transaction is in that block.\\n\"\r\n```",
      "commit_id" : "78f4c8b98eada337346ffb206339c3ebae4ff43b",
      "created_at" : "2021-07-22T10:59:49Z",
      "diff_hunk" : "@@ -74,12 +74,10 @@ static RPCHelpMan getrawtransaction()\n                 \"getrawtransaction\",\n                 \"\\nReturn the raw transaction data.\\n\"\n \n-                \"\\nBy default this function only works for mempool transactions. When called with a blockhash\\n\"\n-                \"argument, getrawtransaction will return the transaction if the specified block is available and\\n\"\n-                \"the transaction is found in that block. When called without a blockhash argument, getrawtransaction\\n\"\n-                \"will return the transaction if it is in the mempool, or if -txindex is enabled and the transaction\\n\"\n-                \"is in a block in the blockchain.\\n\"\n-\n+                \"\\nBy default, this call only returns a transaction if it is in the mempool. If -txindex is enabled\\n\"\n+                \"and no blockhash argument is passed, it will return the transaction if it is in the mempool or any block.\\n\"\n+                \"If -txindex is not enabled and a blockhash argument is passed, it will return the transaction if\\n\"\n+                \"the specified block is available and the transaction is found in that block.\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r674695881",
      "id" : 674695881,
      "line" : 80,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3NDY5NTg4MQ==",
      "original_commit_id" : "78f4c8b98eada337346ffb206339c3ebae4ff43b",
      "original_line" : 80,
      "original_position" : 13,
      "original_start_line" : 79,
      "path" : "src/rpc/rawtransaction.cpp",
      "position" : 13,
      "pull_request_review_id" : 712609777,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383",
      "side" : "RIGHT",
      "start_line" : 79,
      "start_side" : "RIGHT",
      "updated_at" : "2021-07-22T11:09:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/674695881",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r674700406"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/674700406"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@LarryRuane the idea is to allow fetching the transaction from a block out of the active chain - which -txindex doesn't take into account. Before this was possible.",
      "commit_id" : "78f4c8b98eada337346ffb206339c3ebae4ff43b",
      "created_at" : "2021-07-22T11:07:48Z",
      "diff_hunk" : "@@ -1159,6 +1159,20 @@ CTransactionRef GetTransaction(const CBlockIndex* const block_index, const CTxMe\n {\n     LOCK(cs_main);\n \n+    if (mempool && !block_index) {\n+        CTransactionRef ptx = mempool->get(hash);\n+        if (ptx) return ptx;\n+    }\n+    if (g_txindex) {\n+        CTransactionRef tx;\n+        uint256 block_hash;\n+        if (g_txindex->FindTx(hash, block_hash, tx)) {\n+            if (!block_index || block_index->GetBlockHash() == block_hash) {\n+                hashBlock = block_hash;\n+                return tx;\n+            }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r674700406",
      "id" : 674700406,
      "in_reply_to_id" : 673899065,
      "line" : 1173,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3NDcwMDQwNg==",
      "original_commit_id" : "78f4c8b98eada337346ffb206339c3ebae4ff43b",
      "original_line" : 1173,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 15,
      "pull_request_review_id" : 712615811,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-22T11:07:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/674700406",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r674700841"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/674700841"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This could do with a comment:\r\n\r\n```suggestion\r\n            if (!block_index || block_index->GetBlockHash() == block_hash) {\r\n                // Don't return the transaction if the provided block hash doesn't match.\r\n                // The case where a transaction appears in multiple blocks (e.g. reorgs or\r\n                // BIP30) is handled by the block lookup below.\r\n                hashBlock = block_hash;\r\n```",
      "commit_id" : "78f4c8b98eada337346ffb206339c3ebae4ff43b",
      "created_at" : "2021-07-22T11:08:32Z",
      "diff_hunk" : "@@ -1159,6 +1159,20 @@ CTransactionRef GetTransaction(const CBlockIndex* const block_index, const CTxMe\n {\n     LOCK(cs_main);\n \n+    if (mempool && !block_index) {\n+        CTransactionRef ptx = mempool->get(hash);\n+        if (ptx) return ptx;\n+    }\n+    if (g_txindex) {\n+        CTransactionRef tx;\n+        uint256 block_hash;\n+        if (g_txindex->FindTx(hash, block_hash, tx)) {\n+            if (!block_index || block_index->GetBlockHash() == block_hash) {\n+                hashBlock = block_hash;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r674700841",
      "id" : 674700841,
      "line" : 1171,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3NDcwMDg0MQ==",
      "original_commit_id" : "78f4c8b98eada337346ffb206339c3ebae4ff43b",
      "original_line" : 1171,
      "original_position" : 13,
      "original_start_line" : 1170,
      "path" : "src/validation.cpp",
      "position" : 13,
      "pull_request_review_id" : 712609777,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383",
      "side" : "RIGHT",
      "start_line" : 1170,
      "start_side" : "RIGHT",
      "updated_at" : "2021-07-22T11:09:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/674700841",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r674994661"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/674994661"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That could be checked by seeing if the specified block index is in the main chain.\r\n\r\nBut I suppose even that has edge cases (eg, index out of sync), so maybe it's better to just leave it alone.",
      "commit_id" : "78f4c8b98eada337346ffb206339c3ebae4ff43b",
      "created_at" : "2021-07-22T17:06:37Z",
      "diff_hunk" : "@@ -1159,6 +1159,20 @@ CTransactionRef GetTransaction(const CBlockIndex* const block_index, const CTxMe\n {\n     LOCK(cs_main);\n \n+    if (mempool && !block_index) {\n+        CTransactionRef ptx = mempool->get(hash);\n+        if (ptx) return ptx;\n+    }\n+    if (g_txindex) {\n+        CTransactionRef tx;\n+        uint256 block_hash;\n+        if (g_txindex->FindTx(hash, block_hash, tx)) {\n+            if (!block_index || block_index->GetBlockHash() == block_hash) {\n+                hashBlock = block_hash;\n+                return tx;\n+            }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r674994661",
      "id" : 674994661,
      "in_reply_to_id" : 673899065,
      "line" : 1173,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3NDk5NDY2MQ==",
      "original_commit_id" : "78f4c8b98eada337346ffb206339c3ebae4ff43b",
      "original_line" : 1173,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 15,
      "pull_request_review_id" : 713033426,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-22T17:06:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/674994661",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Would be nice to include the documentation suggested by @jnewbery to avoid someone \"optimizing\" this again in the future. Maybe #22528, which also moves the code, can be used for that?",
      "created_at" : "2021-07-22T18:15:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#issuecomment-885130926",
      "id" : 885130926,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22383",
      "node_id" : "IC_kwDOABII5840wgau",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-22T18:15:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/885130926",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r675069128"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/675069128"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Just realized after merge that cs_main is not needed to read from the mempool (only to write to it)",
      "commit_id" : "78f4c8b98eada337346ffb206339c3ebae4ff43b",
      "created_at" : "2021-07-22T18:33:05Z",
      "diff_hunk" : "@@ -1159,6 +1159,20 @@ CTransactionRef GetTransaction(const CBlockIndex* const block_index, const CTxMe\n {\n     LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#discussion_r675069128",
      "id" : 675069128,
      "line" : 1160,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3NTA2OTEyOA==",
      "original_commit_id" : "78f4c8b98eada337346ffb206339c3ebae4ff43b",
      "original_line" : 1160,
      "original_position" : 2,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 2,
      "pull_request_review_id" : 713115133,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22383",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-22T18:33:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/675069128",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I was curious about response times so I ran some tests:\r\n\r\nI picked up 5 random transactions and fetched them with and without the block hash against both latest release (v0.21.1) and  78f4c8b98eada337346ffb206339c3ebae4ff43b\r\n\r\nv0.21.1 results\r\n```\r\nnelson@bitcoin-node-v3:~$ time ./bitcoin-cli getrawtransaction 278e5e132279ef4bbb0a612cb6b27d8b7510c2cc3be432b0641841cf56a7b0d5\r\n[...]\r\n\r\nreal\t0m0.118s\r\nuser\t0m0.000s\r\nsys\t0m0.006s\r\nnelson@bitcoin-node-v3:~$ time ./bitcoin-cli getrawtransaction 278e5e132279ef4bbb0a612cb6b27d8b7510c2cc3be432b0641841cf56a7b0d5 false 0000000000000000000611dd7a5bde18744ebd17dd0ee71123bb31c5a500f9c0\r\n[...]\r\n\r\nreal\t0m0.133s\r\nuser\t0m0.005s\r\nsys\t0m0.001s\r\n\r\n\r\n\r\nnelson@bitcoin-node-v3:~$ time ./bitcoin-cli getrawtransaction 2ad5c8d13cc87293145eefbf4f6b4ee22859c75006266b335248ae402d1495f8\r\n[...]\r\n\r\nreal\t0m0.117s\r\nuser\t0m0.006s\r\nsys\t0m0.001s\r\nnelson@bitcoin-node-v3:~$ time ./bitcoin-cli getrawtransaction 2ad5c8d13cc87293145eefbf4f6b4ee22859c75006266b335248ae402d1495f8 false 00000000000000000070de9aec218ad077a877f8061cf990ab321dbd2753bfbc\r\n[...]\r\n\r\nreal\t0m0.043s\r\nuser\t0m0.006s\r\nsys\t0m0.000s\r\n\r\n\r\n\r\nnelson@bitcoin-node-v3:~$ time ./bitcoin-cli getrawtransaction b9d34e525aa764d7043abb2c83d51394ada5162d6c1a352047bc388de8845e4b false 000000000000000006cd4488b5c44d79983f466fc2e7821cb309e0523dee0e52\r\n[...]\r\n\r\nreal\t0m0.090s\r\nuser\t0m0.000s\r\nsys\t0m0.006s\r\nnelson@bitcoin-node-v3:~$ time ./bitcoin-cli getrawtransaction b9d34e525aa764d7043abb2c83d51394ada5162d6c1a352047bc388de8845e4b\r\n[...]\r\n\r\nreal\t0m0.112s\r\nuser\t0m0.000s\r\nsys\t0m0.005s\r\n\r\n\r\n\r\nnelson@bitcoin-node-v3:~$ time ./bitcoin-cli getrawtransaction c2def6c34dd508a36776ac76eab06391f1ce90fdb142355b6ddd4fdb90b60f24 false 00000000000004fa9ea9acff9060083ea60f9377589e6797bb132484263f4b7c\r\n[...]\r\n\r\nreal\t0m0.021s\r\nuser\t0m0.003s\r\nsys\t0m0.004s\r\nnelson@bitcoin-node-v3:~$ time ./bitcoin-cli getrawtransaction c2def6c34dd508a36776ac76eab06391f1ce90fdb142355b6ddd4fdb90b60f24\r\n[...]\r\n\r\nreal\t0m0.102s\r\nuser\t0m0.005s\r\nsys\t0m0.001s\r\n\r\n\r\n\r\nnelson@bitcoin-node-v3:~$ time ./bitcoin-cli getrawtransaction 2722e08668a07b515d57a80922c2348c6a857f9afd1fa456851d489edc39b9e6\r\n[...]\r\n\r\nreal\t0m0.154s\r\nuser\t0m0.000s\r\nsys\t0m0.006s\r\nnelson@bitcoin-node-v3:~$ time ./bitcoin-cli  getrawtransaction 2722e08668a07b515d57a80922c2348c6a857f9afd1fa456851d489edc39b9e6 false 00000000000536414be8da7f69059a812bab7623ebd25abd779d1d24b06110fc\r\n[...]\r\n\r\nreal\t0m0.006s\r\nuser\t0m0.002s\r\nsys\t0m0.003s\r\n```\r\n\r\n78f4c8b98eada337346ffb206339c3ebae4ff43b results\r\n```\r\nnelson@bitcoin-node-v3:~$ time ./bitcoin-cli getrawtransaction 278e5e132279ef4bbb0a612cb6b27d8b7510c2cc3be432b0641841cf56a7b0d5\r\n[...]\r\n\r\nreal\t0m0.095s\r\nuser\t0m0.001s\r\nsys\t0m0.006s\r\nnelson@bitcoin-node-v3:~$ time ./bitcoin-cli getrawtransaction 278e5e132279ef4bbb0a612cb6b27d8b7510c2cc3be432b0641841cf56a7b0d5 false 0000000000000000000611dd7a5bde18744ebd17dd0ee71123bb31c5a500f9c0\r\n[...]\r\n\r\nreal\t0m0.007s\r\nuser\t0m0.002s\r\nsys\t0m0.005s\r\n\r\n\r\n\r\nnelson@bitcoin-node-v3:~$ time ./bitcoin-cli getrawtransaction 2ad5c8d13cc87293145eefbf4f6b4ee22859c75006266b335248ae402d1495f8\r\n[...]\r\n\r\nreal\t0m0.124s\r\nuser\t0m0.001s\r\nsys\t0m0.006s\r\nnelson@bitcoin-node-v3:~$ time ./bitcoin-cli getrawtransaction 2ad5c8d13cc87293145eefbf4f6b4ee22859c75006266b335248ae402d1495f8 false 00000000000000000070de9aec218ad077a877f8061cf990ab321dbd2753bfbc\r\n[...]\r\nreal\t0m0.009s\r\nuser\t0m0.000s\r\nsys\t0m0.007s\r\n\r\n\r\n\r\nnelson@bitcoin-node-v3:~$ time ./bitcoin-cli getrawtransaction b9d34e525aa764d7043abb2c83d51394ada5162d6c1a352047bc388de8845e4b false 000000000000000006cd4488b5c44d79983f466fc2e7821cb309e0523dee0e52\r\n[...]\r\n\r\nreal\t0m0.153s\r\nuser\t0m0.003s\r\nsys\t0m0.004s\r\nnelson@bitcoin-node-v3:~$ time ./bitcoin-cli getrawtransaction b9d34e525aa764d7043abb2c83d51394ada5162d6c1a352047bc388de8845e4b\r\n[...]\r\n\r\nreal\t0m0.006s\r\nuser\t0m0.006s\r\nsys\t0m0.000s\r\n\r\n\r\n\r\nnelson@bitcoin-node-v3:~$ time ./bitcoin-cli getrawtransaction c2def6c34dd508a36776ac76eab06391f1ce90fdb142355b6ddd4fdb90b60f24 false 00000000000004fa9ea9acff9060083ea60f9377589e6797bb132484263f4b7c\r\n[...]\r\n\r\nreal\t0m0.138s\r\nuser\t0m0.000s\r\nsys\t0m0.006s\r\nnelson@bitcoin-node-v3:~$ time ./bitcoin-cli getrawtransaction c2def6c34dd508a36776ac76eab06391f1ce90fdb142355b6ddd4fdb90b60f24\r\n[...]\r\n\r\nreal\t0m0.006s\r\nuser\t0m0.000s\r\nsys\t0m0.006s\r\n\r\n\r\n\r\nnelson@bitcoin-node-v3:~$ time ./bitcoin-cli getrawtransaction 2722e08668a07b515d57a80922c2348c6a857f9afd1fa456851d489edc39b9e6\r\n[...]\r\n\r\nreal\t0m0.158s\r\nuser\t0m0.000s\r\nsys\t0m0.005s\r\nnelson@bitcoin-node-v3:~$ time ./bitcoin-cli getrawtransaction 2722e08668a07b515d57a80922c2348c6a857f9afd1fa456851d489edc39b9e6 false 00000000000536414be8da7f69059a812bab7623ebd25abd779d1d24b06110fc\r\n[...]\r\n\r\nreal\t0m0.006s\r\nuser\t0m0.005s\r\nsys\t0m0.000s\r\n```\r\n\r\n**System information**\r\nGCP n1-standard-2\r\n2 vCPUs\r\n7.5 GB memory\r\nHDD Standard Disk",
      "created_at" : "2021-08-02T12:10:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22383#issuecomment-890974295",
      "id" : 890974295,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22383",
      "node_id" : "IC_kwDOABII5841GzBX",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-02T12:25:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/890974295",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/9610178?v=4",
         "events_url" : "https://api.github.com/users/NelsonGaldeman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NelsonGaldeman/followers",
         "following_url" : "https://api.github.com/users/NelsonGaldeman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NelsonGaldeman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NelsonGaldeman",
         "id" : 9610178,
         "login" : "NelsonGaldeman",
         "node_id" : "MDQ6VXNlcjk2MTAxNzg=",
         "organizations_url" : "https://api.github.com/users/NelsonGaldeman/orgs",
         "received_events_url" : "https://api.github.com/users/NelsonGaldeman/received_events",
         "repos_url" : "https://api.github.com/users/NelsonGaldeman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NelsonGaldeman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NelsonGaldeman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NelsonGaldeman"
      }
   }
]
