[
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, good idea.",
      "created_at" : "2021-06-23T11:00:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22322#issuecomment-866740351",
      "id" : 866740351,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22322",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2Njc0MDM1MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-23T11:00:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/866740351",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22322#discussion_r657092084"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22322"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/657092084"
         }
      },
      "author_association" : "MEMBER",
      "body" : "proposed docs if you like\r\n```diff\r\n-        BanMan ban_man{banlist_file, nullptr, offset};\r\n+        BanMan ban_man{banlist_file, /* client_interface */ nullptr, /* default_ban_time */ offset};\r\n         while (--limit_max_ops >= 0 && fuzzed_data_provider.ConsumeBool()) {\r\n             CallOneOf(\r\n                 fuzzed_data_provider,\r\n@@ -100,15 +100,15 @@ FUZZ_TARGET_INIT(banman, initialize_banman)\r\n             SetMockTime(ConsumeTime(fuzzed_data_provider));\r\n             banmap_t banmap;\r\n             ban_man.GetBanned(banmap);\r\n-            BanMan ban_man_read{banlist_file, nullptr, offset};\r\n+            BanMan ban_man_read{banlist_file, /* client_interface */ nullptr, /* default_ban_time */ offset};\r\n             banmap_t banmap_read;\r\n             ban_man_read.GetBanned(banmap_read);\r\n             assert(banmap.size() == banmap_read.size());\r\n             auto it1{banmap.begin()};\r\n             auto it2{banmap_read.begin()};\r\n             for (; it1 != banmap.end(); ++it1, ++it2) {\r\n-                assert(it1->first == it2->first);\r\n-                assert(it1->second.ToJson().write() == it2->second.ToJson().write());\r\n+                assert(it1->first == it2->first); // CSubNet\r\n+                assert(it1->second.ToJson().write() == it2->second.ToJson().write()); // CBanEntry\r\n             }\r\n         }\r\n     }\r\n```\r\n",
      "commit_id" : "fabadb7702a9cbe477e9e5f91706620456154903",
      "created_at" : "2021-06-23T13:21:01Z",
      "diff_hunk" : "@@ -93,6 +95,22 @@ FUZZ_TARGET_INIT(banman, initialize_banman)\n                     ban_man.Discourage(ConsumeNetAddr(fuzzed_data_provider));\n                 });\n         }\n+        if (!force_read_and_write_to_err) {\n+            ban_man.DumpBanlist();\n+            SetMockTime(ConsumeTime(fuzzed_data_provider));\n+            banmap_t banmap;\n+            ban_man.GetBanned(banmap);\n+            BanMan ban_man_read{banlist_file, nullptr, offset};\n+            banmap_t banmap_read;\n+            ban_man_read.GetBanned(banmap_read);\n+            assert(banmap.size() == banmap_read.size());\n+            auto it1{banmap.begin()};\n+            auto it2{banmap_read.begin()};\n+            for (; it1 != banmap.end(); ++it1, ++it2) {\n+                assert(it1->first == it2->first);\n+                assert(it1->second.ToJson().write() == it2->second.ToJson().write());\n+            }\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22322#discussion_r657092084",
      "id" : 657092084,
      "line" : 113,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1NzA5MjA4NA==",
      "original_commit_id" : "fabadb7702a9cbe477e9e5f91706620456154903",
      "original_line" : 113,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/test/fuzz/banman.cpp",
      "position" : 43,
      "pull_request_review_id" : 690644108,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22322",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-23T13:22:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/657092084",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22322#discussion_r657233544"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22322"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/657233544"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Unrelated to this PR, why is this called \"offset\"? It is actually \"ban_time\" - number of seconds to keep the ban entry after the misbehavior occurred.\r\n\r\n~~There is some \"offset\" involved in `BanMan::Ban()`, but that is completely internal to `BanMan`.~~",
      "commit_id" : "fabadb7702a9cbe477e9e5f91706620456154903",
      "created_at" : "2021-06-23T15:41:42Z",
      "diff_hunk" : "@@ -43,19 +43,21 @@ FUZZ_TARGET_INIT(banman, initialize_banman)\n     fs::path banlist_file = gArgs.GetDataDirNet() / \"fuzzed_banlist\";\n \n     const bool start_with_corrupted_banlist{fuzzed_data_provider.ConsumeBool()};\n+    bool force_read_and_write_to_err{false};\n     if (start_with_corrupted_banlist) {\n         const std::string sfx{fuzzed_data_provider.ConsumeBool() ? \".dat\" : \".json\"};\n         assert(WriteBinaryFile(banlist_file.string() + sfx,\n                                fuzzed_data_provider.ConsumeRandomLengthString()));\n     } else {\n-        const bool force_read_and_write_to_err{fuzzed_data_provider.ConsumeBool()};\n+        force_read_and_write_to_err = fuzzed_data_provider.ConsumeBool();\n         if (force_read_and_write_to_err) {\n             banlist_file = fs::path{\"path\"} / \"to\" / \"inaccessible\" / \"fuzzed_banlist\";\n         }\n     }\n \n     {\n-        BanMan ban_man{banlist_file, nullptr, ConsumeBanTimeOffset(fuzzed_data_provider)};\n+        const auto offset{ConsumeBanTimeOffset(fuzzed_data_provider)};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22322#discussion_r657233544",
      "id" : 657233544,
      "line" : 59,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1NzIzMzU0NA==",
      "original_commit_id" : "fabadb7702a9cbe477e9e5f91706620456154903",
      "original_line" : 59,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/test/fuzz/banman.cpp",
      "position" : 19,
      "pull_request_review_id" : 690837367,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22322",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-24T07:13:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/657233544",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22322#discussion_r657241603"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22322"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/657241603"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The dumped data may end up containing more entries than `banmap` and `banmap_read` because `SweepBanned()` may leave them when called from `DumpBanlist()` but when called from `GetBanned()` after `SetMockTime()` it may remove \"expired\" entries.\r\n\r\nIt is ok since both `banmap` and `banmap_read` will contain the same, but if somebody ends up debugging this and looking at the file, then it may be confusing. Maybe swap lines 99 and 100.",
      "commit_id" : "fabadb7702a9cbe477e9e5f91706620456154903",
      "created_at" : "2021-06-23T15:49:44Z",
      "diff_hunk" : "@@ -93,6 +95,22 @@ FUZZ_TARGET_INIT(banman, initialize_banman)\n                     ban_man.Discourage(ConsumeNetAddr(fuzzed_data_provider));\n                 });\n         }\n+        if (!force_read_and_write_to_err) {\n+            ban_man.DumpBanlist();\n+            SetMockTime(ConsumeTime(fuzzed_data_provider));\n+            banmap_t banmap;\n+            ban_man.GetBanned(banmap);\n+            BanMan ban_man_read{banlist_file, nullptr, offset};\n+            banmap_t banmap_read;\n+            ban_man_read.GetBanned(banmap_read);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22322#discussion_r657241603",
      "id" : 657241603,
      "line" : 105,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1NzI0MTYwMw==",
      "original_commit_id" : "fabadb7702a9cbe477e9e5f91706620456154903",
      "original_line" : 105,
      "original_position" : 35,
      "original_start_line" : 99,
      "path" : "src/test/fuzz/banman.cpp",
      "position" : 35,
      "pull_request_review_id" : 690837367,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22322",
      "side" : "RIGHT",
      "start_line" : 99,
      "start_side" : "RIGHT",
      "updated_at" : "2021-06-23T15:58:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/657241603",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22322#discussion_r657248949"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22322"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/657248949"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This may brick if `banmap_t` is changed from `std::map` to `std::unordered_map`. It should be changed because the latter is faster and we don't need an order into this container.\r\n\r\nMaybe add something like `static_assert(std::is_base_of<std::map, banmap_t>::value)` to ensure this gets adjusted if `banmap_t` is changed in the future?\r\n\r\nOr a slower, but more robust variant: for each entry in `banmap` ensure that it can be found in `banmap_read` and that both maps have the same size.",
      "commit_id" : "fabadb7702a9cbe477e9e5f91706620456154903",
      "created_at" : "2021-06-23T15:57:17Z",
      "diff_hunk" : "@@ -93,6 +95,22 @@ FUZZ_TARGET_INIT(banman, initialize_banman)\n                     ban_man.Discourage(ConsumeNetAddr(fuzzed_data_provider));\n                 });\n         }\n+        if (!force_read_and_write_to_err) {\n+            ban_man.DumpBanlist();\n+            SetMockTime(ConsumeTime(fuzzed_data_provider));\n+            banmap_t banmap;\n+            ban_man.GetBanned(banmap);\n+            BanMan ban_man_read{banlist_file, nullptr, offset};\n+            banmap_t banmap_read;\n+            ban_man_read.GetBanned(banmap_read);\n+            assert(banmap.size() == banmap_read.size());\n+            auto it1{banmap.begin()};\n+            auto it2{banmap_read.begin()};\n+            for (; it1 != banmap.end(); ++it1, ++it2) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22322#discussion_r657248949",
      "id" : 657248949,
      "line" : 109,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1NzI0ODk0OQ==",
      "original_commit_id" : "fabadb7702a9cbe477e9e5f91706620456154903",
      "original_line" : 109,
      "original_position" : 39,
      "original_start_line" : 107,
      "path" : "src/test/fuzz/banman.cpp",
      "position" : 39,
      "pull_request_review_id" : 690837367,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22322",
      "side" : "RIGHT",
      "start_line" : 107,
      "start_side" : "RIGHT",
      "updated_at" : "2021-06-23T15:58:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/657248949",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22322#discussion_r657283978"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22322"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/657283978"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This was done on purpose to check `SweepBanned` is called on read",
      "commit_id" : "fabadb7702a9cbe477e9e5f91706620456154903",
      "created_at" : "2021-06-23T16:42:15Z",
      "diff_hunk" : "@@ -93,6 +95,22 @@ FUZZ_TARGET_INIT(banman, initialize_banman)\n                     ban_man.Discourage(ConsumeNetAddr(fuzzed_data_provider));\n                 });\n         }\n+        if (!force_read_and_write_to_err) {\n+            ban_man.DumpBanlist();\n+            SetMockTime(ConsumeTime(fuzzed_data_provider));\n+            banmap_t banmap;\n+            ban_man.GetBanned(banmap);\n+            BanMan ban_man_read{banlist_file, nullptr, offset};\n+            banmap_t banmap_read;\n+            ban_man_read.GetBanned(banmap_read);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22322#discussion_r657283978",
      "id" : 657283978,
      "in_reply_to_id" : 657241603,
      "line" : 105,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1NzI4Mzk3OA==",
      "original_commit_id" : "fabadb7702a9cbe477e9e5f91706620456154903",
      "original_line" : 105,
      "original_position" : 35,
      "original_start_line" : 99,
      "path" : "src/test/fuzz/banman.cpp",
      "position" : 35,
      "pull_request_review_id" : 690906380,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22322",
      "side" : "RIGHT",
      "start_line" : 99,
      "start_side" : "RIGHT",
      "updated_at" : "2021-06-23T16:42:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/657283978",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22322#discussion_r657694907"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22322"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/657694907"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The 3rd argument `offset` is only used by `BanMan::Ban()` which we never call on `ban_man_read`. So this can be \r\n```suggestion\r\n            BanMan ban_man_read{banlist_file, nullptr, 0};\r\n```\r\nand then the `offset` variable is not necessary.",
      "commit_id" : "fabadb7702a9cbe477e9e5f91706620456154903",
      "created_at" : "2021-06-24T07:28:20Z",
      "diff_hunk" : "@@ -93,6 +95,22 @@ FUZZ_TARGET_INIT(banman, initialize_banman)\n                     ban_man.Discourage(ConsumeNetAddr(fuzzed_data_provider));\n                 });\n         }\n+        if (!force_read_and_write_to_err) {\n+            ban_man.DumpBanlist();\n+            SetMockTime(ConsumeTime(fuzzed_data_provider));\n+            banmap_t banmap;\n+            ban_man.GetBanned(banmap);\n+            BanMan ban_man_read{banlist_file, nullptr, offset};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22322#discussion_r657694907",
      "id" : 657694907,
      "line" : 103,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1NzY5NDkwNw==",
      "original_commit_id" : "fabadb7702a9cbe477e9e5f91706620456154903",
      "original_line" : 103,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/test/fuzz/banman.cpp",
      "position" : 33,
      "pull_request_review_id" : 691423050,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22322",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-24T07:31:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/657694907",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22322#discussion_r657712467"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22322"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/657712467"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hmm, then maybe add one entry that will certainly expire? This will also make the intention more explicit:\r\n\r\n```diff\r\ndiff --git i/src/test/fuzz/banman.cpp w/src/test/fuzz/banman.cpp\r\nindex 6aa95b484f..b3b10da084 100644\r\n--- i/src/test/fuzz/banman.cpp\r\n+++ w/src/test/fuzz/banman.cpp\r\n@@ -93,16 +93,23 @@ FUZZ_TARGET_INIT(banman, initialize_banman)\r\n                 },\r\n                 [&] {\r\n                     ban_man.Discourage(ConsumeNetAddr(fuzzed_data_provider));\r\n                 });\r\n         }\r\n         if (!force_read_and_write_to_err) {\r\n+            const auto mock_time = ConsumeTime(fuzzed_data_provider);\r\n+            SetMockTime(mock_time);\r\n+            // Add one ban entry that will expire to check that on read expired entries are removed.\r\n+            ban_man.Ban(ConsumeNetAddr(fuzzed_data_provider), mock_time + 5, true);\r\n             ban_man.DumpBanlist();\r\n-            SetMockTime(ConsumeTime(fuzzed_data_provider));\r\n+            banmap_t banmap_unexpired;\r\n+            ban_man.GetBanned(banmap_unexpired);\r\n+            SetMockTime(mock_time + 10);\r\n             banmap_t banmap;\r\n             ban_man.GetBanned(banmap);\r\n+            assert(banmap.size() < banmap_unexpired.size()); // At least one should have expired.\r\n             BanMan ban_man_read{banlist_file, nullptr, offset};\r\n             banmap_t banmap_read;\r\n             ban_man_read.GetBanned(banmap_read);\r\n             assert(banmap.size() == banmap_read.size());\r\n             auto it1{banmap.begin()};\r\n             auto it2{banmap_read.begin()};\r\n```",
      "commit_id" : "fabadb7702a9cbe477e9e5f91706620456154903",
      "created_at" : "2021-06-24T07:53:41Z",
      "diff_hunk" : "@@ -93,6 +95,22 @@ FUZZ_TARGET_INIT(banman, initialize_banman)\n                     ban_man.Discourage(ConsumeNetAddr(fuzzed_data_provider));\n                 });\n         }\n+        if (!force_read_and_write_to_err) {\n+            ban_man.DumpBanlist();\n+            SetMockTime(ConsumeTime(fuzzed_data_provider));\n+            banmap_t banmap;\n+            ban_man.GetBanned(banmap);\n+            BanMan ban_man_read{banlist_file, nullptr, offset};\n+            banmap_t banmap_read;\n+            ban_man_read.GetBanned(banmap_read);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22322#discussion_r657712467",
      "id" : 657712467,
      "in_reply_to_id" : 657241603,
      "line" : 105,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1NzcxMjQ2Nw==",
      "original_commit_id" : "fabadb7702a9cbe477e9e5f91706620456154903",
      "original_line" : 105,
      "original_position" : 35,
      "original_start_line" : 99,
      "path" : "src/test/fuzz/banman.cpp",
      "position" : 35,
      "pull_request_review_id" : 691445187,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22322",
      "side" : "RIGHT",
      "start_line" : 99,
      "start_side" : "RIGHT",
      "updated_at" : "2021-06-24T07:53:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/657712467",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22322#discussion_r657719745"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22322"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/657719745"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```diff\r\n             assert(banmap.size() == banmap_read.size());\r\n-            auto it1{banmap.begin()};\r\n-            auto it2{banmap_read.begin()};\r\n-            for (; it1 != banmap.end(); ++it1, ++it2) {\r\n-                assert(it1->first == it2->first);\r\n-                assert(it1->second.ToJson().write() == it2->second.ToJson().write());\r\n+            for (const auto& [subnet, ban_entry] : banmap) {\r\n+                const auto it = banmap_read.find(subnet);\r\n+                assert(it != banmap_read.end());\r\n+                assert(it->second.ToJson().write() == ban_entry.ToJson().write());\r\n             }\r\n```",
      "commit_id" : "fabadb7702a9cbe477e9e5f91706620456154903",
      "created_at" : "2021-06-24T08:03:22Z",
      "diff_hunk" : "@@ -93,6 +95,22 @@ FUZZ_TARGET_INIT(banman, initialize_banman)\n                     ban_man.Discourage(ConsumeNetAddr(fuzzed_data_provider));\n                 });\n         }\n+        if (!force_read_and_write_to_err) {\n+            ban_man.DumpBanlist();\n+            SetMockTime(ConsumeTime(fuzzed_data_provider));\n+            banmap_t banmap;\n+            ban_man.GetBanned(banmap);\n+            BanMan ban_man_read{banlist_file, nullptr, offset};\n+            banmap_t banmap_read;\n+            ban_man_read.GetBanned(banmap_read);\n+            assert(banmap.size() == banmap_read.size());\n+            auto it1{banmap.begin()};\n+            auto it2{banmap_read.begin()};\n+            for (; it1 != banmap.end(); ++it1, ++it2) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22322#discussion_r657719745",
      "id" : 657719745,
      "in_reply_to_id" : 657248949,
      "line" : 109,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1NzcxOTc0NQ==",
      "original_commit_id" : "fabadb7702a9cbe477e9e5f91706620456154903",
      "original_line" : 109,
      "original_position" : 39,
      "original_start_line" : 107,
      "path" : "src/test/fuzz/banman.cpp",
      "position" : 39,
      "pull_request_review_id" : 691454226,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22322",
      "side" : "RIGHT",
      "start_line" : 107,
      "start_side" : "RIGHT",
      "updated_at" : "2021-06-24T08:03:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/657719745",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22322#discussion_r657731261"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22322"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/657731261"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Or even better:\r\n```diff\r\ndiff --git i/src/test/fuzz/banman.cpp w/src/test/fuzz/banman.cpp\r\nindex 6aa95b484f..15ccd9df3c 100644\r\n--- i/src/test/fuzz/banman.cpp\r\n+++ w/src/test/fuzz/banman.cpp\r\n@@ -29,12 +29,18 @@ int64_t ConsumeBanTimeOffset(FuzzedDataProvider& fuzzed_data_provider) noexcept\r\n \r\n void initialize_banman()\r\n {\r\n     static const auto testing_setup = MakeNoLogFileContext<>();\r\n }\r\n \r\n+static bool operator==(const CBanEntry& lhs, const CBanEntry& rhs)\r\n+{\r\n+    return lhs.nVersion == rhs.nVersion && lhs.nCreateTime == rhs.nCreateTime &&\r\n+           lhs.nBanUntil == rhs.nBanUntil;\r\n+}\r\n+\r\n FUZZ_TARGET_INIT(banman, initialize_banman)\r\n {\r\n     // The complexity is O(N^2), where N is the input size, because each call\r\n     // might call DumpBanlist (or other methods that are at least linear\r\n     // complexity of the input size).\r\n     int limit_max_ops{300};\r\n@@ -100,18 +106,12 @@ FUZZ_TARGET_INIT(banman, initialize_banman)\r\n             SetMockTime(ConsumeTime(fuzzed_data_provider));\r\n             banmap_t banmap;\r\n             ban_man.GetBanned(banmap);\r\n             BanMan ban_man_read{banlist_file, nullptr, offset};\r\n             banmap_t banmap_read;\r\n             ban_man_read.GetBanned(banmap_read);\r\n-            assert(banmap.size() == banmap_read.size());\r\n-            auto it1{banmap.begin()};\r\n-            auto it2{banmap_read.begin()};\r\n-            for (; it1 != banmap.end(); ++it1, ++it2) {\r\n-                assert(it1->first == it2->first);\r\n-                assert(it1->second.ToJson().write() == it2->second.ToJson().write());\r\n-            }\r\n+            assert(banmap_read == banmap);\r\n         }\r\n     }\r\n     fs::remove(banlist_file.string() + \".dat\");\r\n     fs::remove(banlist_file.string() + \".json\");\r\n }\r\n```",
      "commit_id" : "fabadb7702a9cbe477e9e5f91706620456154903",
      "created_at" : "2021-06-24T08:18:55Z",
      "diff_hunk" : "@@ -93,6 +95,22 @@ FUZZ_TARGET_INIT(banman, initialize_banman)\n                     ban_man.Discourage(ConsumeNetAddr(fuzzed_data_provider));\n                 });\n         }\n+        if (!force_read_and_write_to_err) {\n+            ban_man.DumpBanlist();\n+            SetMockTime(ConsumeTime(fuzzed_data_provider));\n+            banmap_t banmap;\n+            ban_man.GetBanned(banmap);\n+            BanMan ban_man_read{banlist_file, nullptr, offset};\n+            banmap_t banmap_read;\n+            ban_man_read.GetBanned(banmap_read);\n+            assert(banmap.size() == banmap_read.size());\n+            auto it1{banmap.begin()};\n+            auto it2{banmap_read.begin()};\n+            for (; it1 != banmap.end(); ++it1, ++it2) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22322#discussion_r657731261",
      "id" : 657731261,
      "in_reply_to_id" : 657248949,
      "line" : 109,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1NzczMTI2MQ==",
      "original_commit_id" : "fabadb7702a9cbe477e9e5f91706620456154903",
      "original_line" : 109,
      "original_position" : 39,
      "original_start_line" : 107,
      "path" : "src/test/fuzz/banman.cpp",
      "position" : 39,
      "pull_request_review_id" : 691468674,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22322",
      "side" : "RIGHT",
      "start_line" : 107,
      "start_side" : "RIGHT",
      "updated_at" : "2021-06-24T08:20:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/657731261",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22322#discussion_r657810116"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22322"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/657810116"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, added comments",
      "commit_id" : "fa57878340e6e9e34b01e26091d9d57f1c26f771",
      "created_at" : "2021-06-24T10:04:01Z",
      "diff_hunk" : "@@ -93,6 +95,22 @@ FUZZ_TARGET_INIT(banman, initialize_banman)\n                     ban_man.Discourage(ConsumeNetAddr(fuzzed_data_provider));\n                 });\n         }\n+        if (!force_read_and_write_to_err) {\n+            ban_man.DumpBanlist();\n+            SetMockTime(ConsumeTime(fuzzed_data_provider));\n+            banmap_t banmap;\n+            ban_man.GetBanned(banmap);\n+            BanMan ban_man_read{banlist_file, nullptr, offset};\n+            banmap_t banmap_read;\n+            ban_man_read.GetBanned(banmap_read);\n+            assert(banmap.size() == banmap_read.size());\n+            auto it1{banmap.begin()};\n+            auto it2{banmap_read.begin()};\n+            for (; it1 != banmap.end(); ++it1, ++it2) {\n+                assert(it1->first == it2->first);\n+                assert(it1->second.ToJson().write() == it2->second.ToJson().write());\n+            }\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22322#discussion_r657810116",
      "id" : 657810116,
      "in_reply_to_id" : 657092084,
      "line" : 112,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1NzgxMDExNg==",
      "original_commit_id" : "fabadb7702a9cbe477e9e5f91706620456154903",
      "original_line" : 112,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/test/fuzz/banman.cpp",
      "position" : 42,
      "pull_request_review_id" : 691570955,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22322",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-24T10:04:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/657810116",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22322#discussion_r657810294"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22322"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/657810294"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Removed `offset`",
      "commit_id" : "fa57878340e6e9e34b01e26091d9d57f1c26f771",
      "created_at" : "2021-06-24T10:04:17Z",
      "diff_hunk" : "@@ -43,19 +43,21 @@ FUZZ_TARGET_INIT(banman, initialize_banman)\n     fs::path banlist_file = gArgs.GetDataDirNet() / \"fuzzed_banlist\";\n \n     const bool start_with_corrupted_banlist{fuzzed_data_provider.ConsumeBool()};\n+    bool force_read_and_write_to_err{false};\n     if (start_with_corrupted_banlist) {\n         const std::string sfx{fuzzed_data_provider.ConsumeBool() ? \".dat\" : \".json\"};\n         assert(WriteBinaryFile(banlist_file.string() + sfx,\n                                fuzzed_data_provider.ConsumeRandomLengthString()));\n     } else {\n-        const bool force_read_and_write_to_err{fuzzed_data_provider.ConsumeBool()};\n+        force_read_and_write_to_err = fuzzed_data_provider.ConsumeBool();\n         if (force_read_and_write_to_err) {\n             banlist_file = fs::path{\"path\"} / \"to\" / \"inaccessible\" / \"fuzzed_banlist\";\n         }\n     }\n \n     {\n-        BanMan ban_man{banlist_file, nullptr, ConsumeBanTimeOffset(fuzzed_data_provider)};\n+        const auto offset{ConsumeBanTimeOffset(fuzzed_data_provider)};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22322#discussion_r657810294",
      "id" : 657810294,
      "in_reply_to_id" : 657233544,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1NzgxMDI5NA==",
      "original_commit_id" : "fabadb7702a9cbe477e9e5f91706620456154903",
      "original_line" : 59,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/test/fuzz/banman.cpp",
      "position" : null,
      "pull_request_review_id" : 691571206,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22322",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-24T10:04:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/657810294",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22322#discussion_r657810548"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22322"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/657810548"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Made it a compile failure to change the type without touching this file",
      "commit_id" : "fa57878340e6e9e34b01e26091d9d57f1c26f771",
      "created_at" : "2021-06-24T10:04:40Z",
      "diff_hunk" : "@@ -93,6 +95,22 @@ FUZZ_TARGET_INIT(banman, initialize_banman)\n                     ban_man.Discourage(ConsumeNetAddr(fuzzed_data_provider));\n                 });\n         }\n+        if (!force_read_and_write_to_err) {\n+            ban_man.DumpBanlist();\n+            SetMockTime(ConsumeTime(fuzzed_data_provider));\n+            banmap_t banmap;\n+            ban_man.GetBanned(banmap);\n+            BanMan ban_man_read{banlist_file, nullptr, offset};\n+            banmap_t banmap_read;\n+            ban_man_read.GetBanned(banmap_read);\n+            assert(banmap.size() == banmap_read.size());\n+            auto it1{banmap.begin()};\n+            auto it2{banmap_read.begin()};\n+            for (; it1 != banmap.end(); ++it1, ++it2) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22322#discussion_r657810548",
      "id" : 657810548,
      "in_reply_to_id" : 657248949,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1NzgxMDU0OA==",
      "original_commit_id" : "fabadb7702a9cbe477e9e5f91706620456154903",
      "original_line" : 109,
      "original_position" : 39,
      "original_start_line" : 107,
      "path" : "src/test/fuzz/banman.cpp",
      "position" : null,
      "pull_request_review_id" : 691571539,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22322",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-06-24T10:04:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/657810548",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22322#discussion_r657810658"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22322"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/657810658"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, done",
      "commit_id" : "fa57878340e6e9e34b01e26091d9d57f1c26f771",
      "created_at" : "2021-06-24T10:04:49Z",
      "diff_hunk" : "@@ -93,6 +95,22 @@ FUZZ_TARGET_INIT(banman, initialize_banman)\n                     ban_man.Discourage(ConsumeNetAddr(fuzzed_data_provider));\n                 });\n         }\n+        if (!force_read_and_write_to_err) {\n+            ban_man.DumpBanlist();\n+            SetMockTime(ConsumeTime(fuzzed_data_provider));\n+            banmap_t banmap;\n+            ban_man.GetBanned(banmap);\n+            BanMan ban_man_read{banlist_file, nullptr, offset};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22322#discussion_r657810658",
      "id" : 657810658,
      "in_reply_to_id" : 657694907,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1NzgxMDY1OA==",
      "original_commit_id" : "fabadb7702a9cbe477e9e5f91706620456154903",
      "original_line" : 103,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/test/fuzz/banman.cpp",
      "position" : null,
      "pull_request_review_id" : 691571705,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22322",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-24T10:04:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/657810658",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Addressed feedback",
      "created_at" : "2021-06-24T10:05:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22322#issuecomment-867511027",
      "id" : 867511027,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22322",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2NzUxMTAyNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-24T10:05:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/867511027",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22322#discussion_r657828550"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22322"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/657828550"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is now addressed in another way. Just out of curiosity - why not the `assert(banmap_read == banmap);` variant? It is shorter and works for both `map` and `unordered_map`.",
      "commit_id" : "fa57878340e6e9e34b01e26091d9d57f1c26f771",
      "created_at" : "2021-06-24T10:32:53Z",
      "diff_hunk" : "@@ -93,6 +95,22 @@ FUZZ_TARGET_INIT(banman, initialize_banman)\n                     ban_man.Discourage(ConsumeNetAddr(fuzzed_data_provider));\n                 });\n         }\n+        if (!force_read_and_write_to_err) {\n+            ban_man.DumpBanlist();\n+            SetMockTime(ConsumeTime(fuzzed_data_provider));\n+            banmap_t banmap;\n+            ban_man.GetBanned(banmap);\n+            BanMan ban_man_read{banlist_file, nullptr, offset};\n+            banmap_t banmap_read;\n+            ban_man_read.GetBanned(banmap_read);\n+            assert(banmap.size() == banmap_read.size());\n+            auto it1{banmap.begin()};\n+            auto it2{banmap_read.begin()};\n+            for (; it1 != banmap.end(); ++it1, ++it2) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22322#discussion_r657828550",
      "id" : 657828550,
      "in_reply_to_id" : 657248949,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1NzgyODU1MA==",
      "original_commit_id" : "fabadb7702a9cbe477e9e5f91706620456154903",
      "original_line" : 109,
      "original_position" : 39,
      "original_start_line" : 107,
      "path" : "src/test/fuzz/banman.cpp",
      "position" : null,
      "pull_request_review_id" : 691595708,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22322",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-06-24T10:32:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/657828550",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for updating.\r\n\r\nTested ACK fa57878340e6e9e34b01e26091d9d57f1c26f771",
      "created_at" : "2021-06-24T13:42:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22322#issuecomment-867647317",
      "id" : 867647317,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22322",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2NzY0NzMxNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-24T13:42:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/867647317",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "cr ACK fa485d06ec10acd9a791f8d29689e1e82591fb70",
      "created_at" : "2021-06-25T06:14:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22322#issuecomment-868252392",
      "id" : 868252392,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22322",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2ODI1MjM5Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-25T06:14:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/868252392",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22322#discussion_r684250327"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22322"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/684250327"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Errors in CI job (https://cirrus-ci.com/task/6055643191705600?logs=ci#L2769):\r\n```\r\nfuzz: test/fuzz/banman.cpp:112: void banman_fuzz_target(FuzzBufferType): Assertion `banmap == banmap_read' failed.\r\n```",
      "commit_id" : "fa485d06ec10acd9a791f8d29689e1e82591fb70",
      "created_at" : "2021-08-06T13:48:56Z",
      "diff_hunk" : "@@ -93,6 +101,16 @@ FUZZ_TARGET_INIT(banman, initialize_banman)\n                     ban_man.Discourage(ConsumeNetAddr(fuzzed_data_provider));\n                 });\n         }\n+        if (!force_read_and_write_to_err) {\n+            ban_man.DumpBanlist();\n+            SetMockTime(ConsumeTime(fuzzed_data_provider));\n+            banmap_t banmap;\n+            ban_man.GetBanned(banmap);\n+            BanMan ban_man_read{banlist_file, /* client_interface */ nullptr, /* default_ban_time */ 0};\n+            banmap_t banmap_read;\n+            ban_man_read.GetBanned(banmap_read);\n+            assert(banmap == banmap_read);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22322#discussion_r684250327",
      "id" : 684250327,
      "line" : 112,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NDI1MDMyNw==",
      "original_commit_id" : "fa485d06ec10acd9a791f8d29689e1e82591fb70",
      "original_line" : 112,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "src/test/fuzz/banman.cpp",
      "position" : 49,
      "pull_request_review_id" : 724377601,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22322",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-06T13:48:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/684250327",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   }
]
