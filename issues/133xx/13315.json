{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "NONE",
   "body" : "ZMQ  pub/sub has a default limit of 1000 buffered messages. When it hits the limit messages are dropped. This happens sometimes when a new block is found and ~2500messages ( 2.5MB) are send (almost) at once.  \r\n50-800 usually got lost on my (cheap) node. \r\n [ZMQ_SNDHWM](https://github.com/zeromq/libzmq/blob/master/doc/zmq_setsockopt.txt#L840) \r\n\r\nThe PUBlisher limit,  SNDHWM, is disabled by setting it to 0.\r\nOn very slow networks it might fill up memory a bit, but that is hardly noticeable since the queue is usually emptied in a few hundred milliseconds. \r\n \r\nSame applies to the SUBscriber (although the bottleneck there is only the local processing, not the network throughput), so it would be good practice to set RCV_HWM to zero as well for some client script, although I was only able to hit the limit on the subscriber side after adding sleep(1) on every rawtx.\r\n\r\nI've tested for about a day and had a bunch of subscribers running on different computers, and not a single message got dropped. ( also while using swap and 100% cpu  `stress --vm-bytes $(awk '/MemAvailable/{printf \"%d\\n\", $2 * 1.9;}' < /proc/meminfo)k --vm-keep -m 1 -c 1 -i 2` )\r\nI forced one subscriber to lag about 10000 messages , and they were still not dropped. \r\n\r\nI'd appreciate it if others test their performance and load. You can just use this script and check for missing messages while bitcoind is running. (for testing max throughput, stop bitcoind for a while, then restart it; it will send lots of messages while syncing)\r\n\r\nsubscriber testscript:\r\nhttps://gist.github.com/FeedTheWeb/e6243410cb463759d5b29fae24550f36  \r\n ",
   "closed_at" : "2018-11-05T13:02:14Z",
   "closed_by" : {
      "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
      "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
      "followers_url" : "https://api.github.com/users/laanwj/followers",
      "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/laanwj",
      "id" : 126646,
      "login" : "laanwj",
      "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
      "organizations_url" : "https://api.github.com/users/laanwj/orgs",
      "received_events_url" : "https://api.github.com/users/laanwj/received_events",
      "repos_url" : "https://api.github.com/users/laanwj/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/laanwj"
   },
   "comments" : 34,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13315/comments",
   "created_at" : "2018-05-24T14:10:56Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13315/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/13315",
   "id" : 326140437,
   "labels" : [
      {
         "color" : "0052cc",
         "default" : false,
         "id" : 98279177,
         "name" : "RPC/REST/ZMQ",
         "node_id" : "MDU6TGFiZWw5ODI3OTE3Nw==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/RPC/REST/ZMQ"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13315/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDExOlB1bGxSZXF1ZXN0MTkwMzA0MTIy",
   "number" : 13315,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/13315.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13315",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/13315.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13315"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "configurable ZMQ message limit",
   "updated_at" : "2018-11-05T13:07:35Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13315",
   "user" : {
      "avatar_url" : "https://avatars0.githubusercontent.com/u/1678423?v=4",
      "events_url" : "https://api.github.com/users/Alex-CodeLab/events{/privacy}",
      "followers_url" : "https://api.github.com/users/Alex-CodeLab/followers",
      "following_url" : "https://api.github.com/users/Alex-CodeLab/following{/other_user}",
      "gists_url" : "https://api.github.com/users/Alex-CodeLab/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/Alex-CodeLab",
      "id" : 1678423,
      "login" : "Alex-CodeLab",
      "node_id" : "MDQ6VXNlcjE2Nzg0MjM=",
      "organizations_url" : "https://api.github.com/users/Alex-CodeLab/orgs",
      "received_events_url" : "https://api.github.com/users/Alex-CodeLab/received_events",
      "repos_url" : "https://api.github.com/users/Alex-CodeLab/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/Alex-CodeLab/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/Alex-CodeLab/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/Alex-CodeLab"
   }
}
