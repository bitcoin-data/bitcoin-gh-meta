{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "Performing a Guix build of master (d8f1e1327f9c2f9fcc804468f6a981580acdf30a), for either `x86_64-linux-gnu` or `x86_64-w64-mingw32` using:\r\n```bash\r\ntime BASE_CACHE=\"/guix/base_cache\" SOURCES_PATH=\"/guix/sources\" SDK_PATH=\"/guix/SDKs\" HOSTS=\"x86_64-linux-gnu\" ./contrib/guix/guix-build\r\n```\r\ninside an Alpine Docker container, running on an mac mini (M1) currently fails with the following:\r\n```bash\r\n=== configuring in src/secp256k1 (/distsrc-base/distsrc-d8f1e1327f9c-x86_64-linux-gnu/src/secp256k1)\r\nconfigure: running /bin/sh ./configure --disable-option-checking '--prefix=/'  '--disable-ccache' '--disable-maintainer-mode' '--disable-dependency-tracking' '--enable-reduce-exports' '--disable-bench' '--disable-gui-tests' '--disable-fuzz-binary' '--disable-threadlocal' 'CFLAGS=-O2 -g -ffile-prefix-map=/bitcoin=.' 'CXXFLAGS=-O2 -g -ffile-prefix-map=/bitcoin=.' 'LDFLAGS=-Wl,--as-needed -Wl,--dynamic-linker=/lib64/ld-linux-x86-64.so.2 -static-libstdc++ -Wl,-O2' 'PKG_CONFIG_PATH=/root/.guix-profile/lib/pkgconfig' 'PYTHONPATH=/root/.guix-profile/lib/python3.8/site-packages' '--disable-shared' '--with-pic' '--enable-benchmark=no' '--enable-module-recovery' '--enable-module-schnorrsig' '--enable-experimental' --cache-file=/dev/null --srcdir=.\r\nconfigure: loading site script /bitcoin/depends/x86_64-linux-gnu/share/config.site\r\nchecking build system type... aarch64-unknown-linux-gnu\r\nchecking host system type... x86_64-pc-linux-gnu\r\nchecking for a BSD-compatible install... /root/.guix-profile/bin/install -c\r\nchecking whether build environment is sane... yes\r\nchecking for x86_64-linux-gnu-strip... x86_64-linux-gnu-strip\r\nchecking for a thread-safe mkdir -p... /root/.guix-profile/bin/mkdir -p\r\nchecking for gawk... gawk\r\nchecking whether make sets $(MAKE)... yes\r\nchecking whether make supports nested variables... yes\r\nchecking how to print strings... printf\r\nchecking whether make supports the include directive... yes (GNU style)\r\nchecking for x86_64-linux-gnu-gcc... x86_64-linux-gnu-gcc\r\nchecking whether the C compiler works... yes\r\nchecking for C compiler default output file name... a.out\r\nchecking for suffix of executables... \r\nchecking whether we are cross compiling... yes\r\nchecking for suffix of object files... o\r\nchecking whether we are using the GNU C compiler... yes\r\nchecking whether x86_64-linux-gnu-gcc accepts -g... yes\r\nchecking for x86_64-linux-gnu-gcc option to accept ISO C89... none needed\r\nchecking whether x86_64-linux-gnu-gcc understands -c and -o together... yes\r\nchecking dependency style of x86_64-linux-gnu-gcc... none\r\nchecking for a sed that does not truncate output... /root/.guix-profile/bin/sed\r\nchecking for grep that handles long lines and -e... /root/.guix-profile/bin/grep\r\nchecking for egrep... /root/.guix-profile/bin/grep -E\r\nchecking for fgrep... /root/.guix-profile/bin/grep -F\r\nchecking for ld used by x86_64-linux-gnu-gcc... /gnu/store/fzwlmgg54z0iqkhvs74v60zfx64x62gr-gcc-cross-x86_64-linux-gnu-8.4.0/libexec/gcc/x86_64-linux-gnu/ld\r\nchecking if the linker (/gnu/store/fzwlmgg54z0iqkhvs74v60zfx64x62gr-gcc-cross-x86_64-linux-gnu-8.4.0/libexec/gcc/x86_64-linux-gnu/ld) is GNU ld... yes\r\nchecking for BSD- or MS-compatible name lister (nm)... x86_64-linux-gnu-nm\r\nchecking the name lister (x86_64-linux-gnu-nm) interface... BSD nm\r\nchecking whether ln -s works... yes\r\nchecking the maximum length of command line arguments... 1572864\r\nchecking how to convert aarch64-unknown-linux-gnu file names to x86_64-pc-linux-gnu format... func_convert_file_noop\r\nchecking how to convert aarch64-unknown-linux-gnu file names to toolchain format... func_convert_file_noop\r\nchecking for /gnu/store/fzwlmgg54z0iqkhvs74v60zfx64x62gr-gcc-cross-x86_64-linux-gnu-8.4.0/libexec/gcc/x86_64-linux-gnu/ld option to reload object files... -r\r\nchecking for x86_64-linux-gnu-objdump... x86_64-linux-gnu-objdump\r\nchecking how to recognize dependent libraries... pass_all\r\nchecking for x86_64-linux-gnu-dlltool... no\r\nchecking for dlltool... no\r\nchecking how to associate runtime and link libraries... printf %s\\n\r\nchecking for x86_64-linux-gnu-ar... x86_64-linux-gnu-ar\r\nchecking for archiver @FILE support... @\r\nchecking for x86_64-linux-gnu-strip... (cached) x86_64-linux-gnu-strip\r\nchecking for x86_64-linux-gnu-ranlib... x86_64-linux-gnu-ranlib\r\nchecking command to parse x86_64-linux-gnu-nm output from x86_64-linux-gnu-gcc object... ok\r\nchecking for sysroot... no\r\nchecking for a working dd... /root/.guix-profile/bin/dd\r\nchecking how to truncate binary pipes... /root/.guix-profile/bin/dd bs=4096 count=1\r\nchecking for x86_64-linux-gnu-mt... no\r\nchecking for mt... no\r\nchecking if : is a manifest tool... no\r\nchecking how to run the C preprocessor... x86_64-linux-gnu-gcc -E\r\nchecking for ANSI C header files... yes\r\nchecking for sys/types.h... yes\r\nchecking for sys/stat.h... yes\r\nchecking for stdlib.h... yes\r\nchecking for string.h... yes\r\nchecking for memory.h... yes\r\nchecking for strings.h... yes\r\nchecking for inttypes.h... yes\r\nchecking for stdint.h... yes\r\nchecking for unistd.h... yes\r\nchecking for dlfcn.h... yes\r\nchecking for objdir... .libs\r\nchecking if x86_64-linux-gnu-gcc supports -fno-rtti -fno-exceptions... no\r\nchecking for x86_64-linux-gnu-gcc option to produce PIC... -fPIC -DPIC\r\nchecking if x86_64-linux-gnu-gcc PIC flag -fPIC -DPIC works... yes\r\nchecking if x86_64-linux-gnu-gcc static flag -static works... yes\r\nchecking if x86_64-linux-gnu-gcc supports -c -o file.o... yes\r\nchecking if x86_64-linux-gnu-gcc supports -c -o file.o... (cached) yes\r\nchecking whether the x86_64-linux-gnu-gcc linker (/gnu/store/fzwlmgg54z0iqkhvs74v60zfx64x62gr-gcc-cross-x86_64-linux-gnu-8.4.0/libexec/gcc/x86_64-linux-gnu/ld -m elf_x86_64) supports shared libraries... yes\r\nchecking dynamic linker characteristics... GNU/Linux ld.so\r\nchecking how to hardcode library paths into programs... immediate\r\nchecking whether stripping libraries is possible... yes\r\nchecking if libtool supports shared libraries... yes\r\nchecking whether to build shared libraries... no\r\nchecking whether to build static libraries... yes\r\nchecking whether make supports nested variables... (cached) yes\r\nchecking for x86_64-linux-gnu-pkg-config... /root/.guix-profile/bin/pkg-config --static\r\nchecking pkg-config is at least version 0.9.0... yes\r\nchecking for x86_64-linux-gnu-ar... /root/.guix-profile/bin/x86_64-linux-gnu-ar\r\nchecking for x86_64-linux-gnu-ranlib... /root/.guix-profile/bin/x86_64-linux-gnu-ranlib\r\nchecking for x86_64-linux-gnu-strip... /root/.guix-profile/bin/x86_64-linux-gnu-strip\r\nchecking for x86_64-linux-gnu-gcc option to accept ISO C89... (cached) none needed\r\nchecking dependency style of x86_64-linux-gnu-gcc... none\r\nchecking if x86_64-linux-gnu-gcc supports -std=c89 -pedantic -Wall -Wextra -Wcast-align -Wnested-externs -Wshadow -Wstrict-prototypes -Wundef -Wno-unused-function -Wno-long-long -Wno-overlength-strings... yes\r\nchecking if x86_64-linux-gnu-gcc supports -Wconditional-uninitialized... no\r\nchecking if x86_64-linux-gnu-gcc supports -fvisibility=hidden... yes\r\nchecking valgrind/memcheck.h usability... no\r\nchecking valgrind/memcheck.h presence... no\r\nchecking for valgrind/memcheck.h... no\r\nchecking for x86_64 assembly availability... yes\r\nchecking for libcrypto... no\r\nchecking openssl/crypto.h usability... no\r\nchecking openssl/crypto.h presence... no\r\nchecking for openssl/crypto.h... no\r\nchecking for gcc... gcc\r\nchecking whether we are using the GNU C compiler... (cached) yes\r\nchecking whether gcc accepts -g... yes\r\nchecking for gcc option to accept ISO C89... (cached) none needed\r\nchecking whether gcc understands -c and -o together... (cached) yes\r\nchecking dependency style of gcc... (cached) none\r\nchecking how to run the C preprocessor... gcc -E\r\nchecking if native gcc supports -Wall -Wextra -Wno-unused-function... yes\r\nchecking for working native compiler: gcc... yes\r\nconfigure: ******\r\nconfigure: WARNING: experimental build\r\nconfigure: Experimental features do not have stable APIs or properties, and may not be safe for production use.\r\nconfigure: Building extrakeys module: yes\r\nconfigure: Building schnorrsig module: yes\r\nconfigure: ******\r\nchecking that generated files are newer than configure... done\r\nconfigure: creating ./config.status\r\nconfig.status: creating Makefile\r\nconfig.status: creating libsecp256k1.pc\r\nconfig.status: creating src/libsecp256k1-config.h\r\nconfig.status: executing depfiles commands\r\nconfig.status: executing libtool commands\r\n\r\nBuild Options:\r\n  with ecmult precomp     = yes\r\n  with external callbacks = no\r\n  with benchmarks         = no\r\n  with tests              = yes\r\n  with openssl tests      = no\r\n  with coverage           = no\r\n  module ecdh             = no\r\n  module recovery         = yes\r\n  module extrakeys        = yes\r\n  module schnorrsig       = yes\r\n\r\n  asm                     = x86_64\r\n  ecmult window size      = 15\r\n  ecmult gen prec. bits   = 4\r\n\r\n  valgrind                = no\r\n  CC                      = x86_64-linux-gnu-gcc\r\n  CFLAGS                  = -O2 -fvisibility=hidden -std=c89 -pedantic -Wall -Wextra -Wcast-align -Wnested-externs -Wshadow -Wstrict-prototypes -Wundef -Wno-unused-function -Wno-long-long -Wno-overlength-strings -W -pipe -O2 -O2 -g -ffile-prefix-map=/bitcoin=.\r\n  CPPFLAGS                =  -I/bitcoin/depends/x86_64-linux-gnu/include/ \r\n  LDFLAGS                 = -L/bitcoin/depends/x86_64-linux-gnu/lib -Wl,--as-needed -Wl,--dynamic-linker=/lib64/ld-linux-x86-64.so.2 -static-libstdc++ -Wl,-O2\r\n\r\n  CC_FOR_BUILD            = gcc\r\n  CFLAGS_FOR_BUILD        = -Wall -Wextra -Wno-unused-function -g -O2\r\n  CPPFLAGS_FOR_BUILD      = \r\n  LDFLAGS_FOR_BUILD       = \r\n\r\n# <snip>\r\n\r\nmake[3]: Entering directory '/distsrc-base/distsrc-d8f1e1327f9c-x86_64-linux-gnu/src/secp256k1'\r\ngcc -I. -I./src -Wall -Wextra -Wno-unused-function -g -O2 -c src/gen_context.c -o gen_context.o\r\n  CXX      bitcoin_cli-bitcoin-cli.o\r\nIn file included from src/field_5x52_impl.h:19:0,\r\n                 from src/field_impl.h:17,\r\n                 from src/gen_context.c:19:\r\nsrc/field_5x52_asm_impl.h: In function 'secp256k1_fe_mul_inner':\r\nsrc/field_5x52_asm_impl.h:28:1: error: unknown register name '%rdx' in 'asm'\r\n __asm__ __volatile__(\r\n ^~~~~~~\r\nsrc/field_5x52_asm_impl.h:28:1: error: unknown register name '%rcx' in 'asm'\r\nsrc/field_5x52_asm_impl.h:28:1: error: unknown register name '%rax' in 'asm'\r\nsrc/field_5x52_asm_impl.h:28:1: error: output number 0 not directly addressable\r\nsrc/field_5x52_asm_impl.h:28:1: warning: asm operand 6 probably doesn't match constraints\r\nsrc/field_5x52_asm_impl.h: In function 'secp256k1_fe_sqr_inner':\r\nsrc/field_5x52_asm_impl.h:298:1: error: unknown register name '%rdx' in 'asm'\r\n __asm__ __volatile__(\r\n ^~~~~~~\r\n\r\n# <snip>\r\n\r\nsrc/field_5x52_asm_impl.h:28:1: error: unknown register name '%rcx' in 'asm'\r\nsrc/field_5x52_asm_impl.h:28:1: error: unknown register name '%rax' in 'asm'\r\nsrc/field_5x52_asm_impl.h:28:1: error: output number 0 not directly addressable\r\nsrc/field_5x52_asm_impl.h:28:1: warning: asm operand 6 probably doesn't match constraints\r\nmake[3]: *** [Makefile:1775: gen_context.o] Error 1\r\nmake[3]: Leaving directory '/distsrc-base/distsrc-d8f1e1327f9c-x86_64-linux-gnu/src/secp256k1'\r\nmake[2]: *** [Makefile:17987: secp256k1/libsecp256k1.la] Error 2\r\nmake[2]: *** Waiting for unfinished jobs....\r\n  CXX      lib/libunivalue_la-univalue_write.lo\r\n  CXXLD    libunivalue.la\r\nx86_64-linux-gnu-ar: `u' modifier ignored since `D' is the default (see `U')\r\nmake[3]: Leaving directory '/distsrc-base/distsrc-d8f1e1327f9c-x86_64-linux-gnu/src/univalue'\r\nmake[2]: Leaving directory '/distsrc-base/distsrc-d8f1e1327f9c-x86_64-linux-gnu/src'\r\nmake[1]: *** [Makefile:16160: all-recursive] Error 1\r\nmake[1]: Leaving directory '/distsrc-base/distsrc-d8f1e1327f9c-x86_64-linux-gnu/src'\r\nmake: *** [Makefile:820: all-recursive] Error 1\r\n```\r\n\r\nBuilding libsecp256k1 directly in the Alpine container works as expected, and building when running a `guix environment`, and installing the needed packages (`autoconf automake gcc libtool make pkg-config `) also seems to work ok. So I'm assuming the failure here is due to something we are doing in our Guix environment. \r\n\r\nAdditional build output [here](https://gist.github.com/fanquake/7bafe06adaf00a719c6c28c17d12a61f).\r\n\r\n@real-or-random @jonasnick you might be interested  here.",
   "closed_at" : "2021-08-03T05:15:58Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
      "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
      "followers_url" : "https://api.github.com/users/fanquake/followers",
      "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/fanquake",
      "id" : 863730,
      "login" : "fanquake",
      "node_id" : "MDQ6VXNlcjg2MzczMA==",
      "organizations_url" : "https://api.github.com/users/fanquake/orgs",
      "received_events_url" : "https://api.github.com/users/fanquake/received_events",
      "repos_url" : "https://api.github.com/users/fanquake/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/fanquake"
   },
   "comments" : 6,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22441/comments",
   "created_at" : "2021-07-14T05:55:50Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22441/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/22441",
   "id" : 944070245,
   "labels" : [
      {
         "color" : "FBBAAB",
         "default" : false,
         "description" : null,
         "id" : 64585,
         "name" : "Bug",
         "node_id" : "MDU6TGFiZWw2NDU4NQ==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug"
      },
      {
         "color" : "5319e7",
         "default" : false,
         "description" : null,
         "id" : 61889416,
         "name" : "Build system",
         "node_id" : "MDU6TGFiZWw2MTg4OTQxNg==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Build%20system"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22441/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDU6SXNzdWU5NDQwNzAyNDU=",
   "number" : 22441,
   "performed_via_github_app" : null,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "guix: libsecp256k1 build failure on aarch64 (M1)",
   "updated_at" : "2021-08-03T05:15:58Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22441",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
      "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
      "followers_url" : "https://api.github.com/users/fanquake/followers",
      "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/fanquake",
      "id" : 863730,
      "login" : "fanquake",
      "node_id" : "MDQ6VXNlcjg2MzczMA==",
      "organizations_url" : "https://api.github.com/users/fanquake/orgs",
      "received_events_url" : "https://api.github.com/users/fanquake/received_events",
      "repos_url" : "https://api.github.com/users/fanquake/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/fanquake"
   }
}
