[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "tACK https://github.com/bitcoin/bitcoin/pull/22408/commits/1f449586a9e39bc4fb53cb5c7a31362e47aea19b\r\n\r\nFew generic points I was pondering about.\r\n\r\n- Is such invalid transaction handling and intended behavior is same for both `p2p` and `mempool validation`? If not we might wanna have some checks there too??\r\n\r\n- What's the purpose of `PrevoutNullInput` and other classes in `invalid_txs.py` in general? It seems they are not much used anywhere?\r\n\r\n- It seems here we are having a previously valid tx, and then appending an invalid input\r\nhttps://github.com/theStack/bitcoin/blob/1f449586a9e39bc4fb53cb5c7a31362e47aea19b/test/functional/mempool_accept.py#L252-L253\r\nWhich is same as \r\nhttps://github.com/theStack/bitcoin/blob/1f449586a9e39bc4fb53cb5c7a31362e47aea19b/test/functional/data/invalid_txs.py#L160-L161\r\nin  `PrevoutNullInput` `get_tx()` construction. \r\n\r\n  So maybe it can be used there instead of doing it via hand (adding a reason to have the class)? Or if its just that easy to append      an invalid input, does it make sense to have the class?  \r\n\r\n- As you are touching `invalid_txs.py`, maybe regarding https://github.com/bitcoin/bitcoin/pull/22363#discussion_r663990893, it makes sense to apply same changes here too? \r\nhttps://github.com/theStack/bitcoin/blob/1f449586a9e39bc4fb53cb5c7a31362e47aea19b/test/functional/data/invalid_txs.py#L233\r\n\r\n  It probably makes more sense to change it in #22363 , just wanna note it, as I i missed it in that review.\r\n  \r\nEdit: I am not sure why code snippets are not showing in the above comments. (Or its just in my local).    ",
      "created_at" : "2021-07-06T15:37:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22408#issuecomment-874867148",
      "id" : 874867148,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22408",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3NDg2NzE0OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-07T04:46:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/874867148",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for the reviews so far! ð \r\n\r\n@rajarshimaitra:\r\n\r\n> * Is such invalid transaction handling and intended behavior is same for both `p2p` and `mempool validation`? If not we might wanna have some checks there too??\r\n\r\nThe routine throwing `bad-txns-prevout-null` (-> `CheckTransaction()`) is called on two places in the codebase: block validation (`CheckBlock(...)`) and mempool acceptance (`MemPoolAccept::PreChecks(...)`). Both are covered by the tests in this PR: block validation in `feature_block.py` and mempool acceptance in `p2p_invalid_txs.py` (tx sent to peer, which tries to add it to its mempool) and `mempool_accept.py` (tx locally added to mempool).\r\n\r\n> * What's the purpose of `PrevoutNullInput` and other classes in `invalid_txs.py` in general? It seems they are not much used anywhere?\r\n\r\n`invalid_txs.py` provides a general template framework for invalid txs. It is currently used in the tests `feature_block.py` and `p2p_invalid_tx.py` (see also first commit message). All classes inheriting of `BadTxTemplate` can be iterated with the following loop: `for TxTemplate in invalid_txs.iter_all_templates():`. Also found this a bit confusing that the classes are never directly referenced anywhere :)\r\n\r\n\r\n> * It seems here we are having a previously valid tx, and then appending an invalid input [...]\r\n>   So maybe it can be used there instead of doing it via hand (adding a reason to have the class)? Or if its just that easy to append      an invalid input, does it make sense to have the class?\r\n\r\nGood point, I think reusing the invalid_tx templates in `mempool_accept.py` would be worth a separate PR.\r\n\r\n> * As you are touching `invalid_txs.py`, maybe regarding [test: refactor: use `script_util` helpers for creating P2{PKH,SH,WPKH,WSH} scriptsÂ #22363 (comment)](https://github.com/bitcoin/bitcoin/pull/22363#discussion_r663990893), it makes sense to apply same changes here too?\r\n>   https://github.com/theStack/bitcoin/blob/1f449586a9e39bc4fb53cb5c7a31362e47aea19b/test/functional/data/invalid_txs.py#L233\r\n>   It probably makes more sense to change it in [test: refactor: use `script_util` helpers for creating P2{PKH,SH,WPKH,WSH} scriptsÂ #22363](https://github.com/bitcoin/bitcoin/pull/22363) , just wanna note it, as I i missed it in that review.\r\n> \r\n\r\nSince I am quite confident that #22363 gets merged (has already several Concept ACKs), I don't think there is a need to repeat its style changes in `invalid_txs.py` in this PR too.\r\n\r\n",
      "created_at" : "2021-07-07T14:24:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22408#issuecomment-875649499",
      "id" : 875649499,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22408",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3NTY0OTQ5OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-07T14:29:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/875649499",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> All classes inheriting of BadTxTemplate can be iterated with the following loop: for TxTemplate in invalid_txs.iter_all_templates():\r\n\r\nThanks for this, yes I was confused for that reason only. Makes sense.\r\n\r\n > Since I am quite confident that #22363 gets merged (has already several Concept ACKs), I don't think there is a need to repeat its style changes in invalid_txs.py in this PR too.\r\n \r\n I think the change I pointed here is not present in #22363, The `basic_p2sh` was changed to have a use `CScript` directly, but this line wasn't. https://github.com/theStack/bitcoin/blob/1f449586a9e39bc4fb53cb5c7a31362e47aea19b/test/functional/data/invalid_txs.py#L233\r\n Otherwise, the same file will contain different formatting of using `CScript`. \r\n I probably should have made the comment in #22363  instead of here. \r\n ",
      "created_at" : "2021-07-08T09:25:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22408#issuecomment-876282665",
      "id" : 876282665,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22408",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3NjI4MjY2NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-08T09:25:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/876282665",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@rajarshimaitra:\r\n\r\n> > Since I am quite confident that #22363 gets merged (has already several Concept ACKs), I don't think there is a need to repeat its style changes in invalid_txs.py in this PR too.\r\n> \r\n> I think the change I pointed here is not present in #22363, The `basic_p2sh` was changed to have a use `CScript` directly, but this line wasn't. https://github.com/theStack/bitcoin/blob/1f449586a9e39bc4fb53cb5c7a31362e47aea19b/test/functional/data/invalid_txs.py#L233\r\n> Otherwise, the same file will contain different formatting of using `CScript`.\r\n> I probably should have made the comment in #22363 instead of here.\r\n\r\nIn the latest version in #22363, all references in `invalid_txs.py` to `sc` were eliminated [after your suggestion](https://github.com/bitcoin/bitcoin/pull/22363#discussion_r663990893), see commit https://github.com/bitcoin/bitcoin/pull/22363/commits/285a65ccfde2e811cfe01e916b998c02ee534a97, e.g. https://github.com/bitcoin/bitcoin/commit/285a65ccfde2e811cfe01e916b998c02ee534a97#diff-d390e9e12bfa34a462fdff9f1894d7dc3edb45c26cf55df486d92864a3052fafR224-R226 :)",
      "created_at" : "2021-07-08T17:00:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22408#issuecomment-876598818",
      "id" : 876598818,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22408",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3NjU5ODgxOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-08T17:00:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/876598818",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> In the latest version in #22363, all references in invalid_txs.py to sc were eliminated after your suggestion, see commit 285a65c, e.g. 285a65c#diff-d390e9e12bfa34a462fdff9f1894d7dc3edb45c26cf55df486d92864a3052fafR224-R226 :)\r\n\r\nAh Ok, I missed that, my bad.. ",
      "created_at" : "2021-07-08T17:41:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22408#issuecomment-876624240",
      "id" : 876624240,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22408",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3NjYyNDI0MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-08T17:52:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/876624240",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   }
]
