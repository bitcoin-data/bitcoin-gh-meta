[
   {
      "author_association" : "MEMBER",
      "body" : "There should not be any special casing of the all-zeroes hash in the consensus rules. Is it possible that the library you're using for constructing the signature/tweak/output key/control block treats the all-zero hash specially (and wrong)?",
      "created_at" : "2022-04-04T22:01:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24765#issuecomment-1088055709",
      "id" : 1088055709,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24765",
      "node_id" : "IC_kwDOABII585A2mmd",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1088055709/reactions"
      },
      "updated_at" : "2022-04-04T22:53:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1088055709",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "diff of two spending transactions\r\nthe difference is they use a different TapBranch, therefore another prev out, i needed a different output and that gives a different txid, hash and sighash which gave a different signature\r\nthe top one this the second transaction of https://github.com/bitcoin/bitcoin/issues/24765#issue-1192292067\r\nthe bottom one is in the testnet blockchain (i tried spending it with all zeros except last byte and it worked)\r\n\r\n![image](https://user-images.githubusercontent.com/49868160/161703883-197ec01e-a01c-42a8-9f30-961917fabdb9.png)\r\n\r\n\r\n> Is it possible that the library you're using for constructing the signature/tweak/output key/control block treats the all-zero hash specially (and wrong)?\r\n\r\ni think not, i checked all output of my script with `btcdeb` and things like tapleaf, tapbranch and taptweak worked as expected.\r\nbut i will work it through completely from generated keys to taproot output with btcdeb and my javascript function + bitcoinlib-js\r\n\r\ninternal pub: `035be1beaf62c286f2eae1b60ee1f1f6dcc9b96104ede0f09f1497c5bae82ea5aa`\r\nnonexistent leaf hash: `0000000000000000000000000000000000000000000000000000000000000000` (call this leaf1)\r\nleaf2: `2042c68328c229ddef4f0588bd952e05eaca009bee43d01ff6bcbb0b681c15c894ac2042c68328c229ddef4f0588bd952e05eaca009bee43d01ff6bcbb0b681c15c894ba5287`\r\nleaf2 hash:\r\n```\r\nbtcdeb> tf tagged-hash TapLeaf c0 prefix_compact_size(2042c68328c229ddef4f0588bd952e05eaca009bee43d01ff6bcbb0b681c15c894ac2042c68328c229ddef4f0588bd952e05eaca009bee43d01ff6bcbb0b681c15c894ba5287)\r\nmsg = c0462042c68328c229ddef4f0588bd952e05eaca009bee43d01ff6bcbb0b681c15c894ac2042c68328c229ddef4f0588bd952e05eaca009bee43d01ff6bcbb0b681c15c894ba5287\r\ndac59a19ed030a45e6b20e14c5e88934429213369703b24aeeaf1e623b58df58\r\n```\r\n```js\r\n> tapLeaf(Buffer.from('2042c68328c229ddef4f0588bd952e05eaca009bee43d01ff6bcbb0b681c15c894ac2042c68328c229ddef4f0588bd952e05eaca009bee43d01ff6bcbb0b681c15c894ba5287', 'hex')).toString('hex')\r\n'dac59a19ed030a45e6b20e14c5e88934429213369703b24aeeaf1e623b58df58'\r\n```\r\n\r\ntapbranch(leaf1, leaf2) (note that in btcdeb you must enter the branches in the correct order (lexicographically smallest first), my tapBranch function sorts them before hashing)\r\n```\r\nbtcdeb> tf tagged-hash TapBranch 0000000000000000000000000000000000000000000000000000000000000000 dac59a19ed030a45e6b20e14c5e88934429213369703b24aeeaf1e623b58df58\r\nmsg = 0000000000000000000000000000000000000000000000000000000000000000dac59a19ed030a45e6b20e14c5e88934429213369703b24aeeaf1e623b58df58\r\n8af589ab15530ce5ce1d0ca79f5d1c2a7db576c6802bb0b200904b7ea0272618\r\n```\r\n```js\r\n> zeros = Buffer.alloc(32)\r\n<Buffer 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00>\r\n> tapBranch(Buffer.from('dac59a19ed030a45e6b20e14c5e88934429213369703b24aeeaf1e623b58df58', 'hex'), zeros).toString('hex')\r\n'8af589ab15530ce5ce1d0ca79f5d1c2a7db576c6802bb0b200904b7ea0272618'\r\n```\r\n\r\ntweak(pub, tapTweak(internal_pub, branch))\r\n```\r\nbtcdeb> tf tagged-hash TapTweak 5be1beaf62c286f2eae1b60ee1f1f6dcc9b96104ede0f09f1497c5bae82ea5aa 8af589ab15530ce5ce1d0ca79f5d1c2a7db576c6802bb0b200904b7ea0272618\r\nmsg = 5be1beaf62c286f2eae1b60ee1f1f6dcc9b96104ede0f09f1497c5bae82ea5aa8af589ab15530ce5ce1d0ca79f5d1c2a7db576c6802bb0b200904b7ea0272618\r\ncd537bb4434ce4ca7b7aefc20ed0ffcce55bbab5ef805ef4bd9df2dd87a4c869\r\nbtcdeb> tf taproot-tweak-pubkey 5be1beaf62c286f2eae1b60ee1f1f6dcc9b96104ede0f09f1497c5bae82ea5aa cd537bb4434ce4ca7b7aefc20ed0ffcce55bbab5ef805ef4bd9df2dd87a4c869\r\n02c730e130570fb56367fb31d9ab9d492e38be719d31a0b4602fda344caa4b3d03\r\n```\r\n```js\r\n> tapTweak(Buffer.from('5be1beaf62c286f2eae1b60ee1f1f6dcc9b96104ede0f09f1497c5bae82ea5aa', 'hex'), Buffer.from('8af589ab15530ce5ce1d0ca79f5d1c2a7db576c6802bb0b200904b7ea0272618', 'hex')).toString('hex')\r\n'cd537bb4434ce4ca7b7aefc20ed0ffcce55bbab5ef805ef4bd9df2dd87a4c869'\r\n> curve.xOnlyPointAddTweak(Buffer.from('5be1beaf62c286f2eae1b60ee1f1f6dcc9b96104ede0f09f1497c5bae82ea5aa', 'hex'), Buffer.from('cd537bb4434ce4ca7b7aefc20ed0ffcce55bbab5ef805ef4bd9df2dd87a4c869', 'hex'))\r\n{\r\n  parity: 0,\r\n  xOnlyPubkey: Uint8Array(32) [\r\n    199,  48, 225,  48,  87,  15, 181, 99,\r\n    103, 251,  49, 217, 171, 157,  73, 46,\r\n     56, 190, 113, 157,  49, 160, 180, 96,\r\n     47, 218,  52,  76, 170,  75,  61,  3\r\n  ]\r\n}\r\n> Buffer.from(_.xOnlyPubkey)\r\n<Buffer c7 30 e1 30 57 0f b5 63 67 fb 31 d9 ab 9d 49 2e 38 be 71 9d 31 a0 b4 60 2f da 34 4c aa 4b 3d 03>\r\n```\r\n`_` in js means previous output\r\nparity 0 = `02` and parity 1 = `03` prefix\r\n\r\nthis `c730e130570fb56367fb31d9ab9d492e38be719d31a0b4602fda344caa4b3d03` that came out of both btcdeb and js is the taproot key",
      "created_at" : "2022-04-05T08:11:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24765#issuecomment-1088401007",
      "id" : 1088401007,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24765",
      "node_id" : "IC_kwDOABII585A365v",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1088401007/reactions"
      },
      "updated_at" : "2022-04-05T11:58:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1088401007",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/49868160?v=4",
         "events_url" : "https://api.github.com/users/antonilol/events{/privacy}",
         "followers_url" : "https://api.github.com/users/antonilol/followers",
         "following_url" : "https://api.github.com/users/antonilol/following{/other_user}",
         "gists_url" : "https://api.github.com/users/antonilol/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/antonilol",
         "id" : 49868160,
         "login" : "antonilol",
         "node_id" : "MDQ6VXNlcjQ5ODY4MTYw",
         "organizations_url" : "https://api.github.com/users/antonilol/orgs",
         "received_events_url" : "https://api.github.com/users/antonilol/received_events",
         "repos_url" : "https://api.github.com/users/antonilol/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/antonilol/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/antonilol/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/antonilol"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "the js line are reproducible by git cloning antonilol/btc_stuff\r\ncd into it\r\ntype `node` to enter nodejs repl\r\nrun `exports={}`\r\nand then `.load p2tr_tapscript.js`\r\nit will give some errors but my js functions tapLeaf, tapBranch and tapTweak should work",
      "created_at" : "2022-04-05T08:24:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24765#issuecomment-1088413284",
      "id" : 1088413284,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24765",
      "node_id" : "IC_kwDOABII585A395k",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1088413284/reactions"
      },
      "updated_at" : "2022-04-05T08:27:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1088413284",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/49868160?v=4",
         "events_url" : "https://api.github.com/users/antonilol/events{/privacy}",
         "followers_url" : "https://api.github.com/users/antonilol/followers",
         "following_url" : "https://api.github.com/users/antonilol/following{/other_user}",
         "gists_url" : "https://api.github.com/users/antonilol/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/antonilol",
         "id" : 49868160,
         "login" : "antonilol",
         "node_id" : "MDQ6VXNlcjQ5ODY4MTYw",
         "organizations_url" : "https://api.github.com/users/antonilol/orgs",
         "received_events_url" : "https://api.github.com/users/antonilol/received_events",
         "repos_url" : "https://api.github.com/users/antonilol/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/antonilol/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/antonilol/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/antonilol"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "was anyone able to reproduce this?",
      "created_at" : "2022-04-06T18:23:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24765#issuecomment-1090590772",
      "id" : 1090590772,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24765",
      "node_id" : "IC_kwDOABII585BARg0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1090590772/reactions"
      },
      "updated_at" : "2022-04-06T18:23:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1090590772",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/49868160?v=4",
         "events_url" : "https://api.github.com/users/antonilol/events{/privacy}",
         "followers_url" : "https://api.github.com/users/antonilol/followers",
         "following_url" : "https://api.github.com/users/antonilol/following{/other_user}",
         "gists_url" : "https://api.github.com/users/antonilol/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/antonilol",
         "id" : 49868160,
         "login" : "antonilol",
         "node_id" : "MDQ6VXNlcjQ5ODY4MTYw",
         "organizations_url" : "https://api.github.com/users/antonilol/orgs",
         "received_events_url" : "https://api.github.com/users/antonilol/received_events",
         "repos_url" : "https://api.github.com/users/antonilol/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/antonilol/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/antonilol/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/antonilol"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I tried to recreate your scenario in Bitcoin Core's test framework: https://github.com/sipa/bitcoin/commits/202204_try24765\r\n\r\nI do seem to get very different results (perhaps the way hash outputs are treated as private keys is different?), but it does work. In case you're interested, the output is:\r\n\r\n```\r\nInternal privkey: 99cc9f872553025f99977238bba5ff60053a8d19b676bf84cfab7dce40a7ede5\r\nInternal pubkey: 6354f7dcabb8d506321bf2ed98f37d0058f93096c0205159f54f25810417dd07\r\nScript privkey: 40cf24c0a04be8a0fcf9976c97e617a260420970066026d5b42fc95cb1625db5\r\nScript pubkey: d2055541cd829ec122ff03233920a6d403b2ad1058293f00e2216828a4d2cb97\r\nMerkle root: be28fd1d09cab5b9e1f2bd87fe452451d23e784e84d46c61d000b69b7934cc31\r\nTweak: e22993c6b6f74a486151785d437c09419142452d5752b48808935aa2c0cf973d\r\nOutput pubkey: d408be1569a4eb76ba8d2ac8fb69e0138d08ebf903579dd64bbbb506df398386\r\nScriptPubKey: 5120d408be1569a4eb76ba8d2ac8fb69e0138d08ebf903579dd64bbbb506df398386\r\nLeaf: script: 20d2055541cd829ec122ff03233920a6d403b2ad1058293f00e2216828a4d2cb97ac20d2055541cd829ec122ff03233920a6d403b2ad1058293f00e2216828a4d2cb97ba5287\r\n      controlblock: c06354f7dcabb8d506321bf2ed98f37d0058f93096c0205159f54f25810417dd070000000000000000000000000000000000000000000000000000000000000000\r\n```",
      "created_at" : "2022-04-06T22:30:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24765#issuecomment-1090876068",
      "id" : 1090876068,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24765",
      "node_id" : "IC_kwDOABII585BBXKk",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1090876068/reactions"
      },
      "updated_at" : "2022-04-06T22:30:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1090876068",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> I do seem to get very different results\r\n\r\nyeah i used different privs before, so thats expected\r\n\r\ni was able to create a valid spend with 32 zero bytes as tapleaf hash by using random keys and running the program over and over again. sometimes it failed and other times it worked, i still dont know why, but will go to bitcoin SE for that. it does seem to be related to the input values, and apparently when first playing with this it failed when using all zeros and worked with 2 different values, so basically i made the wrong conclusion based on 3 attempts.",
      "created_at" : "2022-04-07T15:05:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24765#issuecomment-1091854990",
      "id" : 1091854990,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24765",
      "node_id" : "IC_kwDOABII585BFGKO",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1091854990/reactions"
      },
      "updated_at" : "2022-04-07T15:05:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1091854990",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/49868160?v=4",
         "events_url" : "https://api.github.com/users/antonilol/events{/privacy}",
         "followers_url" : "https://api.github.com/users/antonilol/followers",
         "following_url" : "https://api.github.com/users/antonilol/following{/other_user}",
         "gists_url" : "https://api.github.com/users/antonilol/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/antonilol",
         "id" : 49868160,
         "login" : "antonilol",
         "node_id" : "MDQ6VXNlcjQ5ODY4MTYw",
         "organizations_url" : "https://api.github.com/users/antonilol/orgs",
         "received_events_url" : "https://api.github.com/users/antonilol/received_events",
         "repos_url" : "https://api.github.com/users/antonilol/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/antonilol/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/antonilol/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/antonilol"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "i was able to narrow down the problem, by looking at public key parities and i noticed that it works when key1 Y is even and the output key Y is even\r\ni am 99% sure this is my fault and not of bitcoin core",
      "created_at" : "2022-04-07T15:27:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24765#issuecomment-1091878753",
      "id" : 1091878753,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24765",
      "node_id" : "IC_kwDOABII585BFL9h",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1091878753/reactions"
      },
      "updated_at" : "2022-04-07T15:27:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1091878753",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/49868160?v=4",
         "events_url" : "https://api.github.com/users/antonilol/events{/privacy}",
         "followers_url" : "https://api.github.com/users/antonilol/followers",
         "following_url" : "https://api.github.com/users/antonilol/following{/other_user}",
         "gists_url" : "https://api.github.com/users/antonilol/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/antonilol",
         "id" : 49868160,
         "login" : "antonilol",
         "node_id" : "MDQ6VXNlcjQ5ODY4MTYw",
         "organizations_url" : "https://api.github.com/users/antonilol/orgs",
         "received_events_url" : "https://api.github.com/users/antonilol/received_events",
         "repos_url" : "https://api.github.com/users/antonilol/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/antonilol/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/antonilol/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/antonilol"
      }
   }
]
