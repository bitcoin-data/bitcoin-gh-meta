[
   {
      "author_association" : "MEMBER",
      "body" : "> typedef std::unordered_map<uint256, CBlockIndex*, BlockHasher> BlockMap;\r\n\r\nThis is no longer true in current master.\r\n\r\n> We're over 2 GB of memory at times\r\n\r\nThis implies that the issue is not the block index. If a memory limit is only surpassed temporarily, it is more likely the wallet, an index thread or the mempool.\r\n\r\nLocally for me, the block index consumes way less than 1 GB or even 500 MB on x86. It shouldn't be that much different on aarch64?",
      "created_at" : "2022-04-04T14:17:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24760#issuecomment-1087616704",
      "id" : 1087616704,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24760",
      "node_id" : "IC_kwDOABII585A07bA",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1087616704/reactions"
      },
      "updated_at" : "2022-04-04T14:17:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1087616704",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I believe our current BlockMap structure on 64-bit systems uses 216 bytes per entry (incl. malloc overhead), plus another 8 bytes per entry in CChain. Together that should be around 156 MiB of memory usage on the main chain.\r\n\r\nThat's not a trivial amount, but combined with some amount of peer connection buffer, utxo cache, mempool, ... to provide a basic operation, it's also not by far the only contributing factor. Furthermore, it's an extremely predictably-growing one which for all but the most memory-starved systems probably grows slower than what normal system evolution allows (so this should be becoming less and less of a problem over time).\r\n\r\nI'm not opposed to improvements to reducing the memory usage of the block map, but I'm not sure that the complexity of switching to a LRU model is worth it for saving maybe 100 MiB.",
      "created_at" : "2022-04-04T14:25:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24760#issuecomment-1087626857",
      "id" : 1087626857,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24760",
      "node_id" : "IC_kwDOABII585A095p",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1087626857/reactions"
      },
      "updated_at" : "2022-04-04T14:35:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1087626857",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> This is no longer true in current master.\r\n\r\nVery nice. I'm glad to see clear ownership there. Thank you for that.\r\n\r\n> This implies that the issue is not the block index. If a memory limit is only surpassed temporarily, it is more likely the wallet, an index thread or the mempool.\r\n\r\nIt's probably the indexer, I agree there. I'm running on an empty wallet. Now after the sync is over, it's around 800 MB of memory on my workstation (assuming we have zero forks and synced newly), which is still not negligible. \r\n\r\n> I believe our current BlockMap structure on 64-bit systems uses 216 bytes per entry, plus another 8 bytes per entry in CChain. Together that should be around 156 MiB of memory usage on the main chain.\r\n\r\nIt looks small maybe if we ignore alignment and maps/sets overheads. The problem also is that there are other things I constantly see linked with block index and they all relate to the block map in some way and live in memory, storing extra information times 800k blocks, taking memory. The CChain was an example. Take also a look at `setBlockIndexCandidates`. Another 800k pointers thrown in the bucket of barely used memory (ignoring std::set's overhead). \r\n\r\nAnd to prove that this is specifically the block index. Just launch a new node from genesis. And you'll see the memory usage just growing linearly starting from around 150 MB. So it's either the block index or something else that grows linearly with the current height. I don't think there's anything else, because everything else is managed properly with bounded memory.\r\n\r\nAnd finally, to concede and agree with you guys, yes, it may not be the worst thing depending on the angle. But it's something that has to be fixed sooner or later. If you guys think it's worth shooting through it, I'll happily do it.",
      "created_at" : "2022-04-04T14:54:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24760#issuecomment-1087660569",
      "id" : 1087660569,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24760",
      "node_id" : "IC_kwDOABII585A1GIZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1087660569/reactions"
      },
      "updated_at" : "2022-04-04T14:54:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1087660569",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8694366?v=4",
         "events_url" : "https://api.github.com/users/TheQuantumPhysicist/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheQuantumPhysicist/followers",
         "following_url" : "https://api.github.com/users/TheQuantumPhysicist/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheQuantumPhysicist/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheQuantumPhysicist",
         "id" : 8694366,
         "login" : "TheQuantumPhysicist",
         "node_id" : "MDQ6VXNlcjg2OTQzNjY=",
         "organizations_url" : "https://api.github.com/users/TheQuantumPhysicist/orgs",
         "received_events_url" : "https://api.github.com/users/TheQuantumPhysicist/received_events",
         "repos_url" : "https://api.github.com/users/TheQuantumPhysicist/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheQuantumPhysicist/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheQuantumPhysicist/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheQuantumPhysicist"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "My calculation takes maps/sets/allocation overhead into account.\r\n\r\nThe default utxo cache size is 450 MiB in size, plus it \"steals\" any unused portion of the mempool (default limited to 300 MiB). If you want to reduce memory usage today during sync, the best move is reducing `-dbcache` and `-maxmempool`.",
      "created_at" : "2022-04-04T14:57:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24760#issuecomment-1087663552",
      "id" : 1087663552,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24760",
      "node_id" : "IC_kwDOABII585A1G3A",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1087663552/reactions"
      },
      "updated_at" : "2022-04-04T14:57:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1087663552",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> So it's either the block index or something else that grows linearly with the current height.\r\n\r\nIt might be best to benchmark/measure this, otherwise it will be hard to guess. I'd be really surprised if this was the block index, as the block index is constructed and fully filled before IBD starts. Also, I can confirm the ~150MiB figure above on x86.",
      "created_at" : "2022-04-04T15:02:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24760#issuecomment-1087669974",
      "id" : 1087669974,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24760",
      "node_id" : "IC_kwDOABII585A1IbW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1087669974/reactions"
      },
      "updated_at" : "2022-04-04T15:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1087669974",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> My calculation takes maps/sets/allocation overhead into account.\r\n\r\nSounds good. I would appreciate telling me how you got these numbers, because I'm failing to understand what all that memory is taken for.\r\n\r\n> The default utxo cache size is 450 MiB in size, plus it \"steals\" any unused portion of the mempool (default limited to 300 MiB). If you want to reduce memory usage today during sync, the best move is reducing -dbcache and -maxmempool.\r\n\r\nIf I run `./src/qt/bitcoin-qt --dbcache=25 --maxmempool=10`, it's still over 700 MB of usage. Taking the linear calculation from before into account, if we subtract 150 MB, it's 550 MB that can be attributed to the block index, which is around 65% of the total consumption of memory (and growing).",
      "created_at" : "2022-04-04T15:03:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24760#issuecomment-1087670697",
      "id" : 1087670697,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24760",
      "node_id" : "IC_kwDOABII585A1Imp",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1087670697/reactions"
      },
      "updated_at" : "2022-04-04T15:03:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1087670697",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8694366?v=4",
         "events_url" : "https://api.github.com/users/TheQuantumPhysicist/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheQuantumPhysicist/followers",
         "following_url" : "https://api.github.com/users/TheQuantumPhysicist/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheQuantumPhysicist/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheQuantumPhysicist",
         "id" : 8694366,
         "login" : "TheQuantumPhysicist",
         "node_id" : "MDQ6VXNlcjg2OTQzNjY=",
         "organizations_url" : "https://api.github.com/users/TheQuantumPhysicist/orgs",
         "received_events_url" : "https://api.github.com/users/TheQuantumPhysicist/received_events",
         "repos_url" : "https://api.github.com/users/TheQuantumPhysicist/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheQuantumPhysicist/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheQuantumPhysicist/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheQuantumPhysicist"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> It might be best to benchmark/measure this, otherwise it will be hard to guess. I'd be really surprised if this was the block index, as the block index is constructed and fully filled before IBD starts. Also, I can confirm the ~150MiB figure above on x86.\r\n\r\nI might be wrong with my figures. But I learned over the years that estimating memory consumption is really a difficult thing. So, please excuse me if I'm overextending my imagination on this.",
      "created_at" : "2022-04-04T15:05:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24760#issuecomment-1087672551",
      "id" : 1087672551,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24760",
      "node_id" : "IC_kwDOABII585A1JDn",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1087672551/reactions"
      },
      "updated_at" : "2022-04-04T15:05:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1087672551",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8694366?v=4",
         "events_url" : "https://api.github.com/users/TheQuantumPhysicist/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheQuantumPhysicist/followers",
         "following_url" : "https://api.github.com/users/TheQuantumPhysicist/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheQuantumPhysicist/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheQuantumPhysicist",
         "id" : 8694366,
         "login" : "TheQuantumPhysicist",
         "node_id" : "MDQ6VXNlcjg2OTQzNjY=",
         "organizations_url" : "https://api.github.com/users/TheQuantumPhysicist/orgs",
         "received_events_url" : "https://api.github.com/users/TheQuantumPhysicist/received_events",
         "repos_url" : "https://api.github.com/users/TheQuantumPhysicist/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheQuantumPhysicist/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheQuantumPhysicist/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheQuantumPhysicist"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "It might be that the GUI is using another 200 MB of memory?\r\n\r\nAgain, there is nothing we can do without benchmarking. Locally (for me), I get:\r\n\r\n* 250 MiB heap, see https://github.com/bitcoin/bitcoin/pull/24050#issuecomment-1016701173\r\n* 600 MiB rss:\r\n\r\n![Screenshot from 2022-04-04 17-15-37](https://user-images.githubusercontent.com/6399679/161577258-b3a0145a-7aeb-4d27-b842-fca28695e743.png)\r\n\r\n",
      "created_at" : "2022-04-04T15:24:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24760#issuecomment-1087697735",
      "id" : 1087697735,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24760",
      "node_id" : "IC_kwDOABII585A1PNH",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1087697735/reactions"
      },
      "updated_at" : "2022-04-04T15:24:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1087697735",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Sounds good. I would appreciate telling me how you got these numbers, because I'm failing to understand what all that memory is taken for.\r\n\r\nmemusage.h contains algorithms for computing memory usage of various structures, including `std::unordered_map`. That only works with actual maps, but if you look at the code you'll find it consists of:\r\n* Individually-allocated blobs of type (similar to) `struct : std::pair<const Key, Value> { void* ptr; }` (every unordered_map node consists of a key, a value, and a pointer to potentially another blob in the same bucket). These blobs (incl. allocation overhead) use 208 bytes.\r\n* The table itself, with size one pointer per bucket. The number of buckets is approximately equal to the number of elements in the map. So 8 bytes per element.\r\n",
      "created_at" : "2022-04-04T15:28:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24760#issuecomment-1087702537",
      "id" : 1087702537,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24760",
      "node_id" : "IC_kwDOABII585A1QYJ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1087702537/reactions"
      },
      "updated_at" : "2022-04-04T15:28:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1087702537",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> It might be that the GUI is using another 200 MB of memory?\r\n\r\nCorrect. In my Linux (Debian Bullseye), when I start a node from genesis, before choosing the data dir, it consumes 125 MB. Then after choosing it bumps up to 175 MB. \r\n\r\nPerhaps there was a misunderstanding on what I meant with my calculation. If the node starts at around 150 MB, then after sync it's 800 MB (or 700 after removing the mempool and the cache), that can only mean that things have grown linearly in between, assuming everything else is cleaned up.\r\n\r\nI'll see what I can do with benchmarks. I'm no so familiar with how that works though. If there's somewhere where I can start/target to get these results, I'd appreciate pointing me there. ",
      "created_at" : "2022-04-04T16:38:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24760#issuecomment-1087775961",
      "id" : 1087775961,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24760",
      "node_id" : "IC_kwDOABII585A1iTZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1087775961/reactions"
      },
      "updated_at" : "2022-04-04T16:38:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1087775961",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8694366?v=4",
         "events_url" : "https://api.github.com/users/TheQuantumPhysicist/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheQuantumPhysicist/followers",
         "following_url" : "https://api.github.com/users/TheQuantumPhysicist/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheQuantumPhysicist/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheQuantumPhysicist",
         "id" : 8694366,
         "login" : "TheQuantumPhysicist",
         "node_id" : "MDQ6VXNlcjg2OTQzNjY=",
         "organizations_url" : "https://api.github.com/users/TheQuantumPhysicist/orgs",
         "received_events_url" : "https://api.github.com/users/TheQuantumPhysicist/received_events",
         "repos_url" : "https://api.github.com/users/TheQuantumPhysicist/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheQuantumPhysicist/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheQuantumPhysicist/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheQuantumPhysicist"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I used massif to check the *allocated* memory. Not sure if this can also help find the memory issue you are facing, but it might be worth a try.",
      "created_at" : "2022-04-06T11:27:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24760#issuecomment-1090158360",
      "id" : 1090158360,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24760",
      "node_id" : "IC_kwDOABII585A-n8Y",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1090158360/reactions"
      },
      "updated_at" : "2022-04-06T11:27:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1090158360",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I will play with massif. I'll see the benchmarks. I will also attempt to remove the block index and see what happens. I'll be playing with this for a while on multiple angles. \r\n\r\nIssue #24700 shows an interesting symptom of the problem on devices with low memory. Honestly, I was able to reduce the usage of the whole node to 25-50 MB of memory in an old bitcoin fork (with millions of blocks in the block index) by completely eliminating the block index, which was very aggressive with no LRU cache. It's difficult to know how modern bitcoin will act without trying, and I'm even convinced that after we try, we can recursively fix more related memory waste; but I believe the main culprit here is the block index. There are too many things to be checked. I'll keep you updated with any results I arrive at.",
      "created_at" : "2022-04-06T11:45:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24760#issuecomment-1090174979",
      "id" : 1090174979,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24760",
      "node_id" : "IC_kwDOABII585A-sAD",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1090174979/reactions"
      },
      "updated_at" : "2022-04-06T11:45:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1090174979",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8694366?v=4",
         "events_url" : "https://api.github.com/users/TheQuantumPhysicist/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheQuantumPhysicist/followers",
         "following_url" : "https://api.github.com/users/TheQuantumPhysicist/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheQuantumPhysicist/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheQuantumPhysicist",
         "id" : 8694366,
         "login" : "TheQuantumPhysicist",
         "node_id" : "MDQ6VXNlcjg2OTQzNjY=",
         "organizations_url" : "https://api.github.com/users/TheQuantumPhysicist/orgs",
         "received_events_url" : "https://api.github.com/users/TheQuantumPhysicist/received_events",
         "repos_url" : "https://api.github.com/users/TheQuantumPhysicist/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheQuantumPhysicist/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheQuantumPhysicist/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheQuantumPhysicist"
      }
   }
]
