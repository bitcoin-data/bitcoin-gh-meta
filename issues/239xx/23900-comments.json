[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#24170](https://github.com/bitcoin/bitcoin/pull/24170) (p2p, rpc: Manual block-relay-only connections with addnode by mzumsande)\n* [#23604](https://github.com/bitcoin/bitcoin/pull/23604) (Use Sock in CNode by vasild)\n* [#23531](https://github.com/bitcoin/bitcoin/pull/23531) (Add Yggdrasil support by prusnak)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-12-30T11:26:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23900#issuecomment-1002987848",
      "id" : 1002987848,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23900",
      "node_id" : "IC_kwDOABII5847yGFI",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1002987848/reactions"
      },
      "updated_at" : "2022-01-27T05:13:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1002987848",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Shouldn't handshaking be independent of advertised services? Otherwise attackers could simply advertise the wrong services for a peer when forwarding along addr messages, or mitm'ing dns seeds? I thought the idea for p2p v2 was to attempt an encrypted handshake, and if that failed, retry without encryption, and you'd just do that for all connection attempts.",
      "created_at" : "2022-01-10T08:29:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23900#issuecomment-1008638321",
      "id" : 1008638321,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23900",
      "node_id" : "IC_kwDOABII5848Hplx",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1008638321/reactions"
      },
      "updated_at" : "2022-01-10T08:29:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1008638321",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Shouldn't handshaking be independent of advertised services?\r\n\r\nI might be missing something but don't we already use data from the advertised services in changing the nature of the connection? For example, (I'm not certain, but expect that), we do not ask pruned nodes for older blocks [when in IBD](https://github.com/bitcoin/bitcoin/blob/623745ca74cf3f54b474dac106f5802b7929503f/src/protocol.cpp#L127).\r\n\r\n> I thought the idea for p2p v2 was to attempt an encrypted handshake, and if that failed, retry without encryption, and you'd just do that for all connection attempts.\r\n\r\nThe current plan is to initiate v2 connections to peers advertising `NODE_P2P_V2` and if the handshake fails, try with a v1 handshake before moving on to another node from addrman. While the method you propose would work, attempting v2 connections with v1 nodes that do not advertise v2 support would waste bandwidth in the initial phases of deployment.\r\n\r\n> Otherwise attackers could simply advertise the wrong services for a peer when forwarding along addr messages, or mitm'ing dns seeds?\r\n\r\nThe MITM attacker could make a v2 node look like a v1 node which would result in a v1 connection, or a v1 node look like v2 which would result still in a v1 connection. Downgrade attacks are a risk mentioned in [BIP324](https://gist.github.com/dhruv/5b1275751bc98f3b64bcafce7876b489#Signaling_BIP324_support):\r\n\r\n```\r\nIf the responding peer closes the connection after receiving the handshake request, the initiating peer MAY try to connect again with the v1 p2p transport protocol. Such reconnects allow an attacker to \"downgrade\" the encryption to plaintext communication and thus, accepting v1 connections MUST not be done when the Bitcoin peer-to-peer network has almost entirely embraced v2 communication. \r\n```",
      "created_at" : "2022-01-10T19:43:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23900#issuecomment-1009281582",
      "id" : 1009281582,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23900",
      "node_id" : "IC_kwDOABII5848KGou",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1009281582/reactions"
      },
      "updated_at" : "2022-01-10T19:44:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1009281582",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Shouldn't handshaking be independent of advertised services? Otherwise attackers could simply advertise the wrong services for a peer when forwarding along addr messages\r\n\r\naddrman will OR the nServices together when there is conflicting information (and overwrite when getting it from a connection to the node itself), so it should be far easier for an attacker to falsely \"upgrade\" the rumoured information than to downgrade it.  So I think there is relatively little danger in only trying v2 with peers for which we believe they may support it.",
      "created_at" : "2022-01-10T21:24:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23900#issuecomment-1009357898",
      "id" : 1009357898,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23900",
      "node_id" : "IC_kwDOABII5848KZRK",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1009357898/reactions"
      },
      "updated_at" : "2022-01-10T21:24:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1009357898",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23900#discussion_r781560060"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23900"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/781560060"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why only for onetry connections?",
      "commit_id" : "43dc78e2ff1d1cbc5302c928492c2e19f322c258",
      "created_at" : "2022-01-10T21:25:10Z",
      "diff_hunk" : "@@ -300,6 +301,9 @@ static RPCHelpMan addnode()\n     if (strCommand == \"onetry\")\n     {\n         CAddress addr;\n+        if (!request.params[2].isNull()) {\n+            addr.nServices = ServiceFlags{static_cast<uint64_t>(request.params[2].get_int64())};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23900#discussion_r781560060",
      "id" : 781560060,
      "line" : 305,
      "node_id" : "PRRC_kwDOABII584ulaj8",
      "original_commit_id" : "43dc78e2ff1d1cbc5302c928492c2e19f322c258",
      "original_line" : 305,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : 20,
      "pull_request_review_id" : 848373683,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23900",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/781560060/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-10T21:25:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/781560060",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I might be missing something but don't we already use data from the advertised services in changing the nature of the connection? For example, (I'm not certain, but expect that), we do not ask pruned nodes for older blocks [when in IBD](https://github.com/bitcoin/bitcoin/blob/623745ca74cf3f54b474dac106f5802b7929503f/src/protocol.cpp#L127).\r\n\r\nWe use that to decide not to connect to some peers, but when we do connect to them we treat them the same?\r\n\r\n> The current plan is to initiate v2 connections to peers advertising `NODE_P2P_V2` and if the handshake fails, try with a v1 handshake before moving on to another node from addrman. While the method you propose would work, attempting v2 connections with v1 nodes that do not advertise v2 support would waste bandwidth in the initial phases of deployment.\r\n\r\nI guess I'm thinking about it backwards: the whole point of p2p v2 is to have an incompatible handshake compared to current p2p, so if the goal is to pass around some advisory data on who supports the new handshake that helps people avoid wasting bandwidth, then using a service bit makes sense for connecting to random peers.\r\n\r\nBut if all that's only for saving bandwidth, why apply it to addnode at all? Just have addnode always try p2pv2 first and fallback -- a redundant connection attempt for addnode nodes only shouldn't be much extra bandwidth?\r\n\r\nJust feels like this is something that's only relevant for p2pv2, not a reason for addnode to know about service bits in general.\r\n\r\n(Another alternative would be to have \"p2pv2\" as an alternative to \"onetry\" to enable to p2pv2 handshake) ",
      "created_at" : "2022-01-12T09:30:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23900#issuecomment-1010833733",
      "id" : 1010833733,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23900",
      "node_id" : "IC_kwDOABII5848QBlF",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1010833733/reactions"
      },
      "updated_at" : "2022-01-12T09:30:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1010833733",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23900#discussion_r784508041"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23900"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/784508041"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I just happened to be using it like that, but, you're right - it should work for the \"add\" sub-command as well. Fixed.",
      "commit_id" : "609ca6dd2d5b66a60959ca3cd88aac07c8eed0ad",
      "created_at" : "2022-01-14T04:59:52Z",
      "diff_hunk" : "@@ -300,6 +301,9 @@ static RPCHelpMan addnode()\n     if (strCommand == \"onetry\")\n     {\n         CAddress addr;\n+        if (!request.params[2].isNull()) {\n+            addr.nServices = ServiceFlags{static_cast<uint64_t>(request.params[2].get_int64())};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23900#discussion_r784508041",
      "id" : 784508041,
      "in_reply_to_id" : 781560060,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584uwqSJ",
      "original_commit_id" : "43dc78e2ff1d1cbc5302c928492c2e19f322c258",
      "original_line" : 305,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 852486195,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23900",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/784508041/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-14T04:59:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/784508041",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Changed the code to be (a slightly modified version of) the last approach suggested by @ajtowns. Instead of accepting `nServices`, the `addnode` rpc now has a boolean `p2p_v2` argument. If set to true, the peer is treated as if it were advertising `NODE_P2P_V2`. \r\n\r\nReady for further review.",
      "created_at" : "2022-01-14T05:03:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23900#issuecomment-1012778741",
      "id" : 1012778741,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23900",
      "node_id" : "IC_kwDOABII5848Xcb1",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1012778741/reactions"
      },
      "updated_at" : "2022-01-14T05:03:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1012778741",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23900#discussion_r784510807"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23900"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/784510807"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This will invalidate existing fuzz seeds (I think).",
      "commit_id" : "609ca6dd2d5b66a60959ca3cd88aac07c8eed0ad",
      "created_at" : "2022-01-14T05:10:19Z",
      "diff_hunk" : "@@ -45,7 +45,7 @@ FUZZ_TARGET_INIT(connman, initialize_connman)\n                 random_string = fuzzed_data_provider.ConsumeRandomLengthString(64);\n             },\n             [&] {\n-                connman.AddNode(random_string);\n+                connman.AddNode(random_string, fuzzed_data_provider.ConsumeBool());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23900#discussion_r784510807",
      "id" : 784510807,
      "line" : 48,
      "node_id" : "PRRC_kwDOABII584uwq9X",
      "original_commit_id" : "609ca6dd2d5b66a60959ca3cd88aac07c8eed0ad",
      "original_line" : 48,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/fuzz/connman.cpp",
      "position" : 5,
      "pull_request_review_id" : 852489793,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23900",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/784510807/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-14T05:10:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/784510807",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23900#discussion_r785575053"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23900"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/785575053"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This line (+ the one in the else branch) is unnecessary, `use_p2p_v2` is already set in the initialization.",
      "commit_id" : "609ca6dd2d5b66a60959ca3cd88aac07c8eed0ad",
      "created_at" : "2022-01-17T00:32:19Z",
      "diff_hunk" : "@@ -2170,16 +2170,21 @@ std::vector<AddedNodeInfo> CConnman::GetAddedNodeInfo() const\n         }\n     }\n \n-    for (const std::string& strAddNode : lAddresses) {\n+    std::string strAddNode;\n+    bool use_p2p_v2;\n+\n+    for (auto addr : lAddresses) {\n+        std::tie(strAddNode, use_p2p_v2) = addr;\n         CService service(LookupNumeric(strAddNode, Params().GetDefaultPort(strAddNode)));\n-        AddedNodeInfo addedNode{strAddNode, CService(), false, false};\n+        AddedNodeInfo addedNode{strAddNode, CService(), false, false, use_p2p_v2};\n         if (service.IsValid()) {\n             // strAddNode is an IP:port\n             auto it = mapConnected.find(service);\n             if (it != mapConnected.end()) {\n                 addedNode.resolvedAddress = service;\n                 addedNode.fConnected = true;\n                 addedNode.fInbound = it->second;\n+                addedNode.use_p2p_v2 = use_p2p_v2;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23900#discussion_r785575053",
      "id" : 785575053,
      "line" : 2187,
      "node_id" : "PRRC_kwDOABII584u0uyN",
      "original_commit_id" : "609ca6dd2d5b66a60959ca3cd88aac07c8eed0ad",
      "original_line" : 2187,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 38,
      "pull_request_review_id" : 853792641,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23900",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/785575053/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-17T01:00:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/785575053",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23900#discussion_r785618935"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23900"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/785618935"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Personally think adding a small struct with two vars is superior to this std::pair/tie stuff where you have to look up/remember what the components are.",
      "commit_id" : "609ca6dd2d5b66a60959ca3cd88aac07c8eed0ad",
      "created_at" : "2022-01-17T03:45:26Z",
      "diff_hunk" : "@@ -1099,7 +1104,10 @@ class CConnman\n     AddrMan& addrman;\n     std::deque<std::string> m_addr_fetches GUARDED_BY(m_addr_fetches_mutex);\n     Mutex m_addr_fetches_mutex;\n-    std::vector<std::string> m_added_nodes GUARDED_BY(m_added_nodes_mutex);\n+\n+    // connection string and whether to use v2 p2p\n+    std::vector<std::pair<std::string, bool>> m_added_nodes GUARDED_BY(m_added_nodes_mutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23900#discussion_r785618935",
      "id" : 785618935,
      "line" : 1109,
      "node_id" : "PRRC_kwDOABII584u05f3",
      "original_commit_id" : "609ca6dd2d5b66a60959ca3cd88aac07c8eed0ad",
      "original_line" : 1109,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 44,
      "pull_request_review_id" : 853847364,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23900",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/785618935/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-17T03:49:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/785618935",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23900#discussion_r785619126"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23900"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/785619126"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: Current convention is to prefix with `m_` so `m_use_p2p_v2`.",
      "commit_id" : "609ca6dd2d5b66a60959ca3cd88aac07c8eed0ad",
      "created_at" : "2022-01-17T03:46:13Z",
      "diff_hunk" : "@@ -92,6 +93,7 @@ struct AddedNodeInfo\n     CService resolvedAddress;\n     bool fConnected;\n     bool fInbound;\n+    bool use_p2p_v2;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23900#discussion_r785619126",
      "id" : 785619126,
      "line" : 96,
      "node_id" : "PRRC_kwDOABII584u05i2",
      "original_commit_id" : "609ca6dd2d5b66a60959ca3cd88aac07c8eed0ad",
      "original_line" : 96,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 12,
      "pull_request_review_id" : 853847364,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23900",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/785619126/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-17T03:49:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/785619126",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23900#discussion_r785619208"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23900"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/785619208"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm fine with the change but wondering why it is happening here/now?",
      "commit_id" : "609ca6dd2d5b66a60959ca3cd88aac07c8eed0ad",
      "created_at" : "2022-01-17T03:46:37Z",
      "diff_hunk" : "@@ -2977,7 +2988,8 @@ ServiceFlags CConnman::GetLocalServices() const\n unsigned int CConnman::GetReceiveFloodSize() const { return nReceiveFloodSize; }\n \n CNode::CNode(NodeId idIn, ServiceFlags nLocalServicesIn, SOCKET hSocketIn, const CAddress& addrIn, uint64_t nKeyedNetGroupIn, uint64_t nLocalHostNonceIn, const CAddress& addrBindIn, const std::string& addrNameIn, ConnectionType conn_type_in, bool inbound_onion)\n-    : m_connected{GetTime<std::chrono::seconds>()},\n+    : nServices(addrIn.nServices),\n+      m_connected(GetTimeSeconds()),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23900#discussion_r785619208",
      "id" : 785619208,
      "line" : 2992,
      "node_id" : "PRRC_kwDOABII584u05kI",
      "original_commit_id" : "609ca6dd2d5b66a60959ca3cd88aac07c8eed0ad",
      "original_line" : 2992,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 97,
      "pull_request_review_id" : 853847364,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23900",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/785619208/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-17T03:49:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/785619208",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23900#discussion_r785619680"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23900"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/785619680"
         }
      },
      "author_association" : "MEMBER",
      "body" : "See personal opinion on using structs.",
      "commit_id" : "609ca6dd2d5b66a60959ca3cd88aac07c8eed0ad",
      "created_at" : "2022-01-17T03:48:56Z",
      "diff_hunk" : "@@ -2146,7 +2146,7 @@ std::vector<AddedNodeInfo> CConnman::GetAddedNodeInfo() const\n {\n     std::vector<AddedNodeInfo> ret;\n \n-    std::list<std::string> lAddresses(0);\n+    std::list<std::pair<std::string, bool>> lAddresses(0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23900#discussion_r785619680",
      "id" : 785619680,
      "line" : 2149,
      "node_id" : "PRRC_kwDOABII584u05rg",
      "original_commit_id" : "609ca6dd2d5b66a60959ca3cd88aac07c8eed0ad",
      "original_line" : 2149,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 14,
      "pull_request_review_id" : 853847364,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23900",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/785619680/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-17T03:49:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/785619680",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Approach ACK, but if it's specific to P2P v2 now, doesn't seem like it needs to be broken out into its own PR prior to P2P v2?",
      "created_at" : "2022-01-18T11:38:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23900#issuecomment-1015328518",
      "id" : 1015328518,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23900",
      "node_id" : "IC_kwDOABII5848hK8G",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1015328518/reactions"
      },
      "updated_at" : "2022-01-18T11:38:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1015328518",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-02-04T08:59:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23900#issuecomment-1029775780",
      "id" : 1029775780,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23900",
      "node_id" : "IC_kwDOABII5849YSGk",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1029775780/reactions"
      },
      "updated_at" : "2022-02-04T08:59:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1029775780",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks, @ajtowns @mzumsande  @kallewoof. As @ajtowns has pointed out, this is now just specific to BIP324. The code has been rolled into #24545 so let's continue there. Closing this PR.\r\n\r\nTo address @mzumsande's point about RPC vs CLI `addnode`, I think it is ok for the RPC functionality to be a superset of the CLI so long as the additional RPC functionality is only enabling things that are used for manual testing as is the case here. But of course, curious to hear what other contributors think about this as well.\r\n\r\nI will address other comments from here in that code this week.",
      "created_at" : "2022-03-14T15:21:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23900#issuecomment-1066935145",
      "id" : 1066935145,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23900",
      "node_id" : "IC_kwDOABII584_mCNp",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1066935145/reactions"
      },
      "updated_at" : "2022-03-14T15:30:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1066935145",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23900#discussion_r838098815"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23900"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838098815"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks. Done in #24545.",
      "commit_id" : "609ca6dd2d5b66a60959ca3cd88aac07c8eed0ad",
      "created_at" : "2022-03-30T04:10:54Z",
      "diff_hunk" : "@@ -2170,16 +2170,21 @@ std::vector<AddedNodeInfo> CConnman::GetAddedNodeInfo() const\n         }\n     }\n \n-    for (const std::string& strAddNode : lAddresses) {\n+    std::string strAddNode;\n+    bool use_p2p_v2;\n+\n+    for (auto addr : lAddresses) {\n+        std::tie(strAddNode, use_p2p_v2) = addr;\n         CService service(LookupNumeric(strAddNode, Params().GetDefaultPort(strAddNode)));\n-        AddedNodeInfo addedNode{strAddNode, CService(), false, false};\n+        AddedNodeInfo addedNode{strAddNode, CService(), false, false, use_p2p_v2};\n         if (service.IsValid()) {\n             // strAddNode is an IP:port\n             auto it = mapConnected.find(service);\n             if (it != mapConnected.end()) {\n                 addedNode.resolvedAddress = service;\n                 addedNode.fConnected = true;\n                 addedNode.fInbound = it->second;\n+                addedNode.use_p2p_v2 = use_p2p_v2;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23900#discussion_r838098815",
      "id" : 838098815,
      "in_reply_to_id" : 785575053,
      "line" : 2187,
      "node_id" : "PRRC_kwDOABII584x9F9_",
      "original_commit_id" : "609ca6dd2d5b66a60959ca3cd88aac07c8eed0ad",
      "original_line" : 2187,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 38,
      "pull_request_review_id" : 925491946,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23900",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838098815/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-30T04:10:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838098815",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23900#discussion_r838098880"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23900"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838098880"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done in #24545.",
      "commit_id" : "609ca6dd2d5b66a60959ca3cd88aac07c8eed0ad",
      "created_at" : "2022-03-30T04:11:03Z",
      "diff_hunk" : "@@ -1099,7 +1104,10 @@ class CConnman\n     AddrMan& addrman;\n     std::deque<std::string> m_addr_fetches GUARDED_BY(m_addr_fetches_mutex);\n     Mutex m_addr_fetches_mutex;\n-    std::vector<std::string> m_added_nodes GUARDED_BY(m_added_nodes_mutex);\n+\n+    // connection string and whether to use v2 p2p\n+    std::vector<std::pair<std::string, bool>> m_added_nodes GUARDED_BY(m_added_nodes_mutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23900#discussion_r838098880",
      "id" : 838098880,
      "in_reply_to_id" : 785618935,
      "line" : 1109,
      "node_id" : "PRRC_kwDOABII584x9F_A",
      "original_commit_id" : "609ca6dd2d5b66a60959ca3cd88aac07c8eed0ad",
      "original_line" : 1109,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 44,
      "pull_request_review_id" : 925492018,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23900",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838098880/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-30T04:11:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838098880",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23900#discussion_r838098993"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23900"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838098993"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done in #24545.",
      "commit_id" : "609ca6dd2d5b66a60959ca3cd88aac07c8eed0ad",
      "created_at" : "2022-03-30T04:11:19Z",
      "diff_hunk" : "@@ -92,6 +93,7 @@ struct AddedNodeInfo\n     CService resolvedAddress;\n     bool fConnected;\n     bool fInbound;\n+    bool use_p2p_v2;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23900#discussion_r838098993",
      "id" : 838098993,
      "in_reply_to_id" : 785619126,
      "line" : 96,
      "node_id" : "PRRC_kwDOABII584x9GAx",
      "original_commit_id" : "609ca6dd2d5b66a60959ca3cd88aac07c8eed0ad",
      "original_line" : 96,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 12,
      "pull_request_review_id" : 925492163,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23900",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838098993/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-30T04:11:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838098993",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23900#discussion_r838099452"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23900"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838099452"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "IIRC, there was a compiler warning(maybe error actually) about the order in the initializer list needing to be the same as that in the class member declaration.",
      "commit_id" : "609ca6dd2d5b66a60959ca3cd88aac07c8eed0ad",
      "created_at" : "2022-03-30T04:12:43Z",
      "diff_hunk" : "@@ -2977,7 +2988,8 @@ ServiceFlags CConnman::GetLocalServices() const\n unsigned int CConnman::GetReceiveFloodSize() const { return nReceiveFloodSize; }\n \n CNode::CNode(NodeId idIn, ServiceFlags nLocalServicesIn, SOCKET hSocketIn, const CAddress& addrIn, uint64_t nKeyedNetGroupIn, uint64_t nLocalHostNonceIn, const CAddress& addrBindIn, const std::string& addrNameIn, ConnectionType conn_type_in, bool inbound_onion)\n-    : m_connected{GetTime<std::chrono::seconds>()},\n+    : nServices(addrIn.nServices),\n+      m_connected(GetTimeSeconds()),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23900#discussion_r838099452",
      "id" : 838099452,
      "in_reply_to_id" : 785619208,
      "line" : 2992,
      "node_id" : "PRRC_kwDOABII584x9GH8",
      "original_commit_id" : "609ca6dd2d5b66a60959ca3cd88aac07c8eed0ad",
      "original_line" : 2992,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 97,
      "pull_request_review_id" : 925492771,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23900",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838099452/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-30T04:12:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838099452",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23900#discussion_r838099533"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23900"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838099533"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done in #24545 ",
      "commit_id" : "609ca6dd2d5b66a60959ca3cd88aac07c8eed0ad",
      "created_at" : "2022-03-30T04:12:57Z",
      "diff_hunk" : "@@ -2146,7 +2146,7 @@ std::vector<AddedNodeInfo> CConnman::GetAddedNodeInfo() const\n {\n     std::vector<AddedNodeInfo> ret;\n \n-    std::list<std::string> lAddresses(0);\n+    std::list<std::pair<std::string, bool>> lAddresses(0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23900#discussion_r838099533",
      "id" : 838099533,
      "in_reply_to_id" : 785619680,
      "line" : 2149,
      "node_id" : "PRRC_kwDOABII584x9GJN",
      "original_commit_id" : "609ca6dd2d5b66a60959ca3cd88aac07c8eed0ad",
      "original_line" : 2149,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 14,
      "pull_request_review_id" : 925492856,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23900",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838099533/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-30T04:12:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/838099533",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   }
]
