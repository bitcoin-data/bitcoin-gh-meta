{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "On single-core machines, executing the test `feature_nulldummy.py` results in the following assertion error:\r\n\r\n```\r\n    ...\r\n    2021-08-18T15:37:58.805000Z TestFramework (INFO): Test 4: Non-NULLDUMMY base multisig transaction is invalid after activation\r\n    2021-08-18T15:37:58.814000Z TestFramework (ERROR): Assertion failed\r\n    Traceback (most recent call last):\r\n      File \"[...]/test/functional/test_framework/test_framework.py\", line 131, in main\r\n        self.run_test()\r\n      File \"[...]/test/functional/feature_nulldummy.py\", line 107, in run_test\r\n        self.block_submit(self.nodes[0], [test4tx], accept=False)\r\n      File \"[...]/test/functional/feature_nulldummy.py\", line 134, in block_submit\r\n        assert_equal(None if accept else 'block-validation-failed', node.submitblock(block.serialize().hex()))\r\n      File \"[...]/test/functional/test_framework/util.py\", line 49, in assert_equal\r\n        raise AssertionError(\"not(%s)\" % \" == \".join(str(arg) for arg in (thing1, thing2) + args))\r\n    AssertionError: not(block-validation-failed == non-mandatory-script-verify-flag (Dummy CHECKMULTISIG argument must be zero))\r\n    2021-08-18T15:37:58.866000Z TestFramework (INFO): Stopping nodes\r\n    ...\r\n```\r\n\r\nThere are hardly any single-core machines around anymore, but the behaviour can be reproduced on a multi-core machine by patching the function `GetNumCores()` to return 1 on the master branch and running `feature_nulldummy.py`:\r\n\r\n```diff\r\ndiff --git a/src/util/system.cpp b/src/util/system.cpp\r\nindex 30d410381..149b512fc 100644\r\n--- a/src/util/system.cpp\r\n+++ b/src/util/system.cpp\r\n@@ -1338,7 +1338,7 @@ bool SetupNetworking()\r\n\r\n int GetNumCores()\r\n {\r\n-    return std::thread::hardware_concurrency();\r\n+    return 1;\r\n }\r\n```\r\nAs solution, parallel script verification is disabled (`-par=1`) and the exact reject reason is checked, which also increases the precision of the test (the possibility that the block is rejected because of another unintended reason is ruled out). See also related PR #22711 which applies the same approach for the p2p segwit test. The PR also includes a refactoring commit which changes the calls to `self.block_submit()` to use named arguments and removes the default value for parameter `accept` (i.e. explicitely passing `accept=...` is mandatory), with the aim to increase the test readability.",
   "closed_at" : "2021-08-26T09:13:07Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
      "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
      "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/MarcoFalke",
      "id" : 6399679,
      "login" : "MarcoFalke",
      "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
      "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
      "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
      "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/MarcoFalke"
   },
   "comments" : 5,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22738/comments",
   "created_at" : "2021-08-18T16:10:46Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22738/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/22738",
   "id" : 973841256,
   "labels" : [
      {
         "color" : "d4c5f9",
         "default" : false,
         "description" : null,
         "id" : 62963516,
         "name" : "Tests",
         "node_id" : "MDU6TGFiZWw2Mjk2MzUxNg==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22738/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDExOlB1bGxSZXF1ZXN0NzE1MjMzMzI2",
   "number" : 22738,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/22738.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22738",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/22738.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22738"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "test: fix failure in feature_nulldummy.py on single-core machines",
   "updated_at" : "2021-08-26T09:13:07Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22738",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
      "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
      "followers_url" : "https://api.github.com/users/theStack/followers",
      "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
      "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/theStack",
      "id" : 91535,
      "login" : "theStack",
      "node_id" : "MDQ6VXNlcjkxNTM1",
      "organizations_url" : "https://api.github.com/users/theStack/orgs",
      "received_events_url" : "https://api.github.com/users/theStack/received_events",
      "repos_url" : "https://api.github.com/users/theStack/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/theStack"
   }
}
