[
   {
      "author_association" : "MEMBER",
      "body" : "I'm unable to build (with clang 13, CI seems to agree). The first commit compiles; testing. \r\n\r\n<details><summary>build output</summary><p>\r\n\r\n```\r\nbench/addrman.cpp:76:18: error: no matching constructor for initialization of 'CAddrMan'\r\n        CAddrMan addrman{/* deterministic */ false, /* consistency_check_ratio */ 0};\r\n                 ^      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n./addrman.h:181:7: note: candidate constructor (the implicit copy constructor) not viable: requires 1 argument, but 2 were provided\r\nclass CAddrMan\r\n      ^\r\n./addrman.h:458:14: note: candidate constructor not viable: requires 3 arguments, but 2 were provided\r\n    explicit CAddrMan(std::vector<bool>* asmap, bool deterministic, int32_t consistency_check_ratio);\r\n             ^\r\nbench/addrman.cpp:83:14: error: no matching constructor for initialization of 'CAddrMan'\r\n    CAddrMan addrman(/* deterministic */ false, /* consistency_check_ratio */ 0);\r\n             ^                           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n./addrman.h:181:7: note: candidate constructor (the implicit copy constructor) not viable: requires 1 argument, but 2 were provided\r\nclass CAddrMan\r\n      ^\r\n./addrman.h:458:14: note: candidate constructor not viable: requires 3 arguments, but 2 were provided\r\n    explicit CAddrMan(std::vector<bool>* asmap, bool deterministic, int32_t consistency_check_ratio);\r\n             ^\r\nbench/addrman.cpp:95:14: error: no matching constructor for initialization of 'CAddrMan'\r\n    CAddrMan addrman(/* deterministic */ false, /* consistency_check_ratio */ 0);\r\n             ^                           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n./addrman.h:181:7: note: candidate constructor (the implicit copy constructor) not viable: requires 1 argument, but 2 were provided\r\nclass CAddrMan\r\n      ^\r\n./addrman.h:458:14: note: candidate constructor not viable: requires 3 arguments, but 2 were provided\r\n    explicit CAddrMan(std::vector<bool>* asmap, bool deterministic, int32_t consistency_check_ratio);\r\n             ^\r\n```\r\n</p></details>\r\n",
      "created_at" : "2021-08-24T13:34:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#issuecomment-904647597",
      "id" : 904647597,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22791",
      "node_id" : "IC_kwDOABII584169Ot",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-24T13:51:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/904647597",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I'm unable to build (with clang 13, CI seems to agree)\r\n\r\nOops. I don't build with bench locally to save a bit of time. Now fixed.",
      "created_at" : "2021-08-24T13:43:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#issuecomment-904654593",
      "id" : 904654593,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22791",
      "node_id" : "IC_kwDOABII58416-8B",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-24T13:43:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/904654593",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "First commit: the addrman checks pass throughout, but I lose 18k addresses on startup and then see parsing errors with the asmap file (and same on bitcoind restart, which fails).\r\n```\r\n2021-08-24T13:39:14Z [init] Opened asmap file \"/home/jon/projects/bitcoin/asmap/demo.map\" (932999 bytes) from disk\r\n2021-08-24T13:39:15Z [init] Using asmap version 7ead927689f884bc4021618017cc1438d9328578779edd2adfbed044fb52928e for IP bucketing\r\n2021-08-24T13:39:15Z [init] init message: Loading P2P addressesâ¦\r\n2021-08-24T13:39:16Z [init] Bucketing method was updated, re-bucketing addrman entries from disk\r\n2021-08-24T13:39:25Z [init] addrman lost 18599 new and 1 tried addresses due to collisions or invalid addresses\r\n2021-08-24T13:39:25Z [init] Addrman checks started: new 26373, tried 72, total 26445\r\n2021-08-24T13:39:25Z [init] Addrman checks completed successfully\r\n2021-08-24T13:39:25Z [init] Loaded 26445 addresses from peers.dat  9577ms\r\n...\r\nError: Error reading configuration file: parse error on line 334: 2021-08-24T13:39:14Z [init] Opened asmap file \"/home/jon/projects/bitcoin/asmap/demo.map\" (932999 bytes) from disk\r\n```\r\n\r\n<details><summary>tested with these config args</summary><p>\r\n\r\n```\r\n2021-08-24T13:41:49Z [init] Config file arg: blockfilterindex=\"1\"\r\n2021-08-24T13:41:49Z [init] Config file arg: checkaddrman=\"1\"\r\n2021-08-24T13:41:49Z [init] Config file arg: checkblocks=\"12\"\r\n2021-08-24T13:41:49Z [init] Config file arg: checklevel=\"4\"\r\n2021-08-24T13:41:49Z [init] Config file arg: checkmempool=\"1\"\r\n2021-08-24T13:41:49Z [init] Config file arg: coinstatsindex=\"1\"\r\n2021-08-24T13:41:49Z [init] Config file arg: debug=\"tor\"\r\n2021-08-24T13:41:49Z [init] Config file arg: debug=\"i2p\"\r\n2021-08-24T13:41:49Z [init] Config file arg: debug=\"addrman\"\r\n2021-08-24T13:41:49Z [init] Config file arg: i2psam=\"127.0.0.1:7656\"\r\n2021-08-24T13:41:49Z [init] Config file arg: logips=\"1\"\r\n2021-08-24T13:41:49Z [init] Config file arg: logthreadnames=\"1\"\r\n2021-08-24T13:41:49Z [init] Config file arg: par=\"1\"\r\n2021-08-24T13:41:49Z [init] Config file arg: peerbloomfilters=\"1\"\r\n2021-08-24T13:41:49Z [init] Config file arg: persistmempool=\"1\"\r\n2021-08-24T13:41:49Z [init] Config file arg: txindex=\"1\"\r\n2021-08-24T13:41:49Z [init] Config file arg: walletbroadcast=\"1\"\r\n2021-08-24T13:41:49Z [init] Config file arg: [main] asmap=\"/home/jon/projects/bitcoin/asmap/demo.map\"\r\n```\r\n</p></details>\r\n",
      "created_at" : "2021-08-24T13:45:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#issuecomment-904656625",
      "id" : 904656625,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22791",
      "node_id" : "IC_kwDOABII58416_bx",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-24T13:55:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/904656625",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Test with only the first commit: the addrman checks pass throughout, but I lost 18k addresses on startup, perhaps because I had the -asmap config option commented out to be able to run bitcoind on mainnet, and I uncommented it again to test.\r\n```\r\n2021-08-24T13:39:14Z [init] Opened asmap file \"/home/jon/projects/bitcoin/asmap/demo.map\" (932999 bytes) from disk\r\n2021-08-24T13:39:15Z [init] Using asmap version 7ead927689f884bc4021618017cc1438d9328578779edd2adfbed044fb52928e for IP bucketing\r\n2021-08-24T13:39:15Z [init] init message: Loading P2P addressesâ¦\r\n2021-08-24T13:39:16Z [init] Bucketing method was updated, re-bucketing addrman entries from disk\r\n2021-08-24T13:39:25Z [init] addrman lost 18599 new and 1 tried addresses due to collisions or invalid addresses\r\n2021-08-24T13:39:25Z [init] Addrman checks started: new 26373, tried 72, total 26445\r\n2021-08-24T13:39:25Z [init] Addrman checks completed successfully\r\n2021-08-24T13:39:25Z [init] Loaded 26445 addresses from peers.dat  9577ms\r\n```\r\n\r\nUpdate: deleted my peers.dat and re-tried building on the PR branch after the update; debug build now succeeds and retesting with multiple restarts initially seems fine.\r\n```\r\n2021-08-24T14:11:09Z [init] Opened asmap file \"/home/jon/projects/bitcoin/asmap/demo.map\" (932999 bytes) from disk\r\n2021-08-24T14:11:11Z [init] Using asmap version 7ead927689f884bc4021618017cc1438d9328578779edd2adfbed044fb52928e for IP bucketing\r\n2021-08-24T14:11:11Z [init] init message: Loading P2P addressesâ¦\r\n2021-08-24T14:11:11Z [init] Addrman checks started: new 6828, tried 10, total 6838\r\n2021-08-24T14:11:12Z [init] Addrman checks completed successfully\r\n2021-08-24T14:11:12Z [init] Loaded 6838 addresses from peers.dat  756ms\r\n```\r\n\r\n<details><summary>tested with these config args</summary><p>\r\n\r\n```\r\n2021-08-24T13:41:49Z [init] Config file arg: blockfilterindex=\"1\"\r\n2021-08-24T13:41:49Z [init] Config file arg: checkaddrman=\"1\"\r\n2021-08-24T13:41:49Z [init] Config file arg: checkblocks=\"12\"\r\n2021-08-24T13:41:49Z [init] Config file arg: checklevel=\"4\"\r\n2021-08-24T13:41:49Z [init] Config file arg: checkmempool=\"1\"\r\n2021-08-24T13:41:49Z [init] Config file arg: coinstatsindex=\"1\"\r\n2021-08-24T13:41:49Z [init] Config file arg: debug=\"tor\"\r\n2021-08-24T13:41:49Z [init] Config file arg: debug=\"i2p\"\r\n2021-08-24T13:41:49Z [init] Config file arg: debug=\"addrman\"\r\n2021-08-24T13:41:49Z [init] Config file arg: i2psam=\"127.0.0.1:7656\"\r\n2021-08-24T13:41:49Z [init] Config file arg: logips=\"1\"\r\n2021-08-24T13:41:49Z [init] Config file arg: logthreadnames=\"1\"\r\n2021-08-24T13:41:49Z [init] Config file arg: par=\"1\"\r\n2021-08-24T13:41:49Z [init] Config file arg: peerbloomfilters=\"1\"\r\n2021-08-24T13:41:49Z [init] Config file arg: txindex=\"1\"\r\n2021-08-24T13:41:49Z [init] Config file arg: walletbroadcast=\"1\"\r\n2021-08-24T13:41:49Z [init] Config file arg: [main] asmap=\"/home/jon/projects/bitcoin/asmap/demo.map\"\r\n```\r\n</p></details>\r\n",
      "created_at" : "2021-08-24T14:13:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#issuecomment-904680566",
      "id" : 904680566,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22791",
      "node_id" : "IC_kwDOABII58417FR2",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-24T14:18:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/904680566",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "<details><summary>Further testing seems ok (provided that losing addresses on rebucketing when toggling -asmap on/off is expected)</summary><p>\r\n\r\nRestarted after turning off -asmap:\r\n\r\n```\r\n2021-08-24T14:19:00Z [init] Using /16 prefix for IP bucketing\r\n2021-08-24T14:19:00Z [init] init message: Loading P2P addressesâ¦\r\n2021-08-24T14:19:01Z [init] Bucketing method was updated, re-bucketing addrman entries from disk\r\n2021-08-24T14:19:01Z [init] addrman lost 2147 new and 0 tried addresses due to collisions or invalid addresses\r\n2021-08-24T14:19:01Z [init] Loaded 9928 addresses from peers.dat  463ms\r\n```\r\nRestarted again with -asmap off:\r\n```\r\n2021-08-24T14:20:59Z [init] Using /16 prefix for IP bucketing\r\n2021-08-24T14:20:59Z [init] init message: Loading P2P addressesâ¦\r\n2021-08-24T14:21:00Z [init] Loaded 10760 addresses from peers.dat  169ms\r\n```\r\nRestarted with -asmap back on:\r\n```\r\n2021-08-24T14:22:44Z [init] Opened asmap file \"/home/jon/projects/bitcoin/asmap/demo.map\" (932999 bytes) from disk\r\n2021-08-24T14:22:46Z [init] Using asmap version 7ead927689f884bc4021618017cc1438d9328578779edd2adfbed044fb52928e for IP bucketing\r\n2021-08-24T14:22:46Z [init] init message: Loading P2P addressesâ¦\r\n2021-08-24T14:22:46Z [init] Bucketing method was updated, re-bucketing addrman entries from disk\r\n2021-08-24T14:22:48Z [init] addrman lost 510 new and 0 tried addresses due to collisions or invalid addresses\r\n2021-08-24T14:22:48Z [init] Loaded 10462 addresses from peers.dat  2802ms\r\n```\r\nRestarted again with -asmap on and reduced frequency of checkaddrman=100, leaving running this way for now:\r\n```\r\n2021-08-24T14:24:41Z [init] Opened asmap file \"/home/jon/projects/bitcoin/asmap/demo.map\" (932999 bytes) from disk\r\n2021-08-24T14:24:43Z [init] Using asmap version 7ead927689f884bc4021618017cc1438d9328578779edd2adfbed044fb52928e for IP bucketing\r\n2021-08-24T14:24:43Z [init] init message: Loading P2P addressesâ¦\r\n2021-08-24T14:24:43Z [init] Loaded 11203 addresses from peers.dat  737ms\r\n...\r\n2021-08-24T14:30:12Z [msghand] Addrman checks started: new 15479, tried 19, total 15498\r\n2021-08-24T14:30:13Z [msghand] Addrman checks completed successfully\r\n```\r\n\r\nAddrman checks passing throughout.\r\n\r\n</p></details>\r\n",
      "created_at" : "2021-08-24T14:30:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#issuecomment-904694941",
      "id" : 904694941,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22791",
      "node_id" : "IC_kwDOABII58417Iyd",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-24T14:32:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/904694941",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r694991699"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/694991699"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "What is the point of `{}`?",
      "commit_id" : "4ffc8b81bc520fe66fbea9a597ab889a2647ca2e",
      "created_at" : "2021-08-24T16:01:12Z",
      "diff_hunk" : "@@ -1171,10 +1171,38 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     fDiscover = args.GetBoolArg(\"-discover\", true);\n     const bool ignores_incoming_txs{args.GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY)};\n \n-    assert(!node.addrman);\n-    auto check_addrman = std::clamp<int32_t>(args.GetArg(\"-checkaddrman\", DEFAULT_ADDRMAN_CONSISTENCY_CHECKS), 0, 1000000);\n-    node.addrman = std::make_unique<CAddrMan>(/* deterministic */ false, /* consistency_check_ratio */ check_addrman);\n     {\n+        // Initialize addrman\n+        assert(!node.addrman);\n+\n+        // Read asmap file if configured\n+        std::vector<bool> asmap{};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r694991699",
      "id" : 694991699,
      "line" : 1179,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NDk5MTY5OQ==",
      "original_commit_id" : "4ffc8b81bc520fe66fbea9a597ab889a2647ca2e",
      "original_line" : 1179,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 12,
      "pull_request_review_id" : 737414947,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-24T16:20:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/694991699",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r695003334"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695003334"
         }
      },
      "author_association" : "MEMBER",
      "body" : "4ffc8b81bc520fe66fb is there any benefit to making `m_asmap` private rather than a public data member? referencing our previous conversation:\r\n\r\n- https://github.com/bitcoin/bitcoin/pull/20210#issuecomment-766093925\r\n\r\n- https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines.html#c131-avoid-trivial-getters-and-setters\r\n\r\n(otherwise, make the getter const?)\r\n```suggestion\r\n    const std::vector<bool>& GetAsmap() const { return m_asmap; }\r\n```",
      "commit_id" : "4ffc8b81bc520fe66fbea9a597ab889a2647ca2e",
      "created_at" : "2021-08-24T16:15:08Z",
      "diff_hunk" : "@@ -593,6 +577,8 @@ class CAddrMan\n         Check();\n     }\n \n+    const std::vector<bool>& GetAsmap() { return m_asmap; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r695003334",
      "id" : 695003334,
      "line" : 580,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NTAwMzMzNA==",
      "original_commit_id" : "4ffc8b81bc520fe66fbea9a597ab889a2647ca2e",
      "original_line" : 580,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 36,
      "pull_request_review_id" : 737430387,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-24T16:46:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695003334",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r695005038"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695005038"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit:\r\n\r\n```suggestion\r\n    const std::vector<bool>& GetAsmap() const { return m_asmap; }\r\n```",
      "commit_id" : "4ffc8b81bc520fe66fbea9a597ab889a2647ca2e",
      "created_at" : "2021-08-24T16:17:20Z",
      "diff_hunk" : "@@ -593,6 +577,8 @@ class CAddrMan\n         Check();\n     }\n \n+    const std::vector<bool>& GetAsmap() { return m_asmap; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r695005038",
      "id" : 695005038,
      "line" : 580,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NTAwNTAzOA==",
      "original_commit_id" : "4ffc8b81bc520fe66fbea9a597ab889a2647ca2e",
      "original_line" : 580,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 36,
      "pull_request_review_id" : 737414947,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-24T16:20:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695005038",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r695006419"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695006419"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This pattern `asmap = Consume(); if (!Sanity()) { asmap.clear(); }` is used in two places. Maybe not worth it, but consider adding `ConsumeASMap()` to deduplicate it.",
      "commit_id" : "4ffc8b81bc520fe66fbea9a597ab889a2647ca2e",
      "created_at" : "2021-08-24T16:19:04Z",
      "diff_hunk" : "@@ -306,9 +307,12 @@ FUZZ_TARGET_INIT(addrman_serdeser, initialize_addrman)\n     FuzzedDataProvider fuzzed_data_provider(buffer.data(), buffer.size());\n     SetMockTime(ConsumeTime(fuzzed_data_provider));\n \n-    CAddrManDeterministic addr_man1{fuzzed_data_provider};\n-    CAddrManDeterministic addr_man2{fuzzed_data_provider};\n-    addr_man2.m_asmap = addr_man1.m_asmap;\n+    std::vector<bool> asmap = ConsumeRandomLengthBitVector(fuzzed_data_provider);\n+    if (!SanityCheckASMap(asmap)) {\n+        asmap.clear();\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r695006419",
      "id" : 695006419,
      "line" : 313,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NTAwNjQxOQ==",
      "original_commit_id" : "4ffc8b81bc520fe66fbea9a597ab889a2647ca2e",
      "original_line" : 313,
      "original_position" : 55,
      "original_start_line" : 310,
      "path" : "src/test/fuzz/addrman.cpp",
      "position" : 55,
      "pull_request_review_id" : 737414947,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : 310,
      "start_side" : "RIGHT",
      "updated_at" : "2021-08-24T16:20:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695006419",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r695020652"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695020652"
         }
      },
      "author_association" : "MEMBER",
      "body" : "47ad0fd2644c4de7a11efa9c9e288f73d6c147e5 naming nit: `asmap_data` would allow more easily grepping for / distinguishing this new data structure in the code \r\n```suggestion\r\n        std::vector<bool> asmap_data;\r\n```",
      "commit_id" : "4ffc8b81bc520fe66fbea9a597ab889a2647ca2e",
      "created_at" : "2021-08-24T16:37:22Z",
      "diff_hunk" : "@@ -1171,10 +1171,38 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     fDiscover = args.GetBoolArg(\"-discover\", true);\n     const bool ignores_incoming_txs{args.GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY)};\n \n-    assert(!node.addrman);\n-    auto check_addrman = std::clamp<int32_t>(args.GetArg(\"-checkaddrman\", DEFAULT_ADDRMAN_CONSISTENCY_CHECKS), 0, 1000000);\n-    node.addrman = std::make_unique<CAddrMan>(/* deterministic */ false, /* consistency_check_ratio */ check_addrman);\n     {\n+        // Initialize addrman\n+        assert(!node.addrman);\n+\n+        // Read asmap file if configured\n+        std::vector<bool> asmap{};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r695020652",
      "id" : 695020652,
      "line" : 1179,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NTAyMDY1Mg==",
      "original_commit_id" : "4ffc8b81bc520fe66fbea9a597ab889a2647ca2e",
      "original_line" : 1179,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 12,
      "pull_request_review_id" : 737430387,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-24T16:48:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695020652",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r695022214"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695022214"
         }
      },
      "author_association" : "MEMBER",
      "body" : "47ad0fd2644c4de7a11efa9c9e288f73d6c147e5 nit, why these outer brackets?",
      "commit_id" : "4ffc8b81bc520fe66fbea9a597ab889a2647ca2e",
      "created_at" : "2021-08-24T16:39:31Z",
      "diff_hunk" : "@@ -1183,11 +1211,12 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n             LogPrintf(\"Loaded %i addresses from peers.dat  %dms\\n\", node.addrman->size(), GetTimeMillis() - nStart);\n         } else {\n             // Addrman can be in an inconsistent state after failure, reset it\n-            node.addrman = std::make_unique<CAddrMan>(/* deterministic */ false, /* consistency_check_ratio */ check_addrman);\n+            node.addrman = std::make_unique<CAddrMan>(&asmap, /* deterministic */ false, /* consistency_check_ratio */ check_addrman);\n             LogPrintf(\"Recreating peers.dat\\n\");\n             adb.Write(*node.addrman);\n         }\n     }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r695022214",
      "id" : 695022214,
      "line" : 1218,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NTAyMjIxNA==",
      "original_commit_id" : "4ffc8b81bc520fe66fbea9a597ab889a2647ca2e",
      "original_line" : 1218,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 51,
      "pull_request_review_id" : 737430387,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-24T16:46:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695022214",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#22831](https://github.com/bitcoin/bitcoin/pull/22831) (p2p, bugfix: fix addrman tried table corruption on restart with asmap by jonatack)\n* [#22778](https://github.com/bitcoin/bitcoin/pull/22778) (net processing: Reduce resource usage for inbound block-relay-only connections by jnewbery)\n* [#22766](https://github.com/bitcoin/bitcoin/pull/22766) (refactor: Clarify and disable unused ArgsManager flags by ryanofsky)\n* [#22762](https://github.com/bitcoin/bitcoin/pull/22762) (Raise InitError when peers.dat is invalid or corrupted by MarcoFalke)\n* [#21160](https://github.com/bitcoin/bitcoin/pull/21160) (net/net processing: Move tx inventory into net_processing by jnewbery)\n* [#19860](https://github.com/bitcoin/bitcoin/pull/19860) (Improve diversification of new connections: privacy and stability by naumenkogs)\n* [#16545](https://github.com/bitcoin/bitcoin/pull/16545) (refactor: Implement missing error checking for ArgsManager flags by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-08-25T04:39:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#issuecomment-905177302",
      "id" : 905177302,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22791",
      "node_id" : "IC_kwDOABII58418-jW",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-30T00:51:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/905177302",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r695699110"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695699110"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Removed",
      "commit_id" : "8a4c815dfef78eca6e481233195a5cfb171f3687",
      "created_at" : "2021-08-25T12:24:25Z",
      "diff_hunk" : "@@ -1171,10 +1171,38 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     fDiscover = args.GetBoolArg(\"-discover\", true);\n     const bool ignores_incoming_txs{args.GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY)};\n \n-    assert(!node.addrman);\n-    auto check_addrman = std::clamp<int32_t>(args.GetArg(\"-checkaddrman\", DEFAULT_ADDRMAN_CONSISTENCY_CHECKS), 0, 1000000);\n-    node.addrman = std::make_unique<CAddrMan>(/* deterministic */ false, /* consistency_check_ratio */ check_addrman);\n     {\n+        // Initialize addrman\n+        assert(!node.addrman);\n+\n+        // Read asmap file if configured\n+        std::vector<bool> asmap{};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r695699110",
      "id" : 695699110,
      "in_reply_to_id" : 694991699,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NTY5OTExMA==",
      "original_commit_id" : "4ffc8b81bc520fe66fbea9a597ab889a2647ca2e",
      "original_line" : 1179,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 738281707,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-25T12:24:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695699110",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r695699221"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695699221"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks. Done.",
      "commit_id" : "8a4c815dfef78eca6e481233195a5cfb171f3687",
      "created_at" : "2021-08-25T12:24:35Z",
      "diff_hunk" : "@@ -593,6 +577,8 @@ class CAddrMan\n         Check();\n     }\n \n+    const std::vector<bool>& GetAsmap() { return m_asmap; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r695699221",
      "id" : 695699221,
      "in_reply_to_id" : 695005038,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NTY5OTIyMQ==",
      "original_commit_id" : "4ffc8b81bc520fe66fbea9a597ab889a2647ca2e",
      "original_line" : 580,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 738281870,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-25T12:24:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695699221",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r695703548"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695703548"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "8a4c815dfef78eca6e481233195a5cfb171f3687",
      "created_at" : "2021-08-25T12:30:27Z",
      "diff_hunk" : "@@ -306,9 +307,12 @@ FUZZ_TARGET_INIT(addrman_serdeser, initialize_addrman)\n     FuzzedDataProvider fuzzed_data_provider(buffer.data(), buffer.size());\n     SetMockTime(ConsumeTime(fuzzed_data_provider));\n \n-    CAddrManDeterministic addr_man1{fuzzed_data_provider};\n-    CAddrManDeterministic addr_man2{fuzzed_data_provider};\n-    addr_man2.m_asmap = addr_man1.m_asmap;\n+    std::vector<bool> asmap = ConsumeRandomLengthBitVector(fuzzed_data_provider);\n+    if (!SanityCheckASMap(asmap)) {\n+        asmap.clear();\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r695703548",
      "id" : 695703548,
      "in_reply_to_id" : 695006419,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NTcwMzU0OA==",
      "original_commit_id" : "4ffc8b81bc520fe66fbea9a597ab889a2647ca2e",
      "original_line" : 313,
      "original_position" : 55,
      "original_start_line" : 310,
      "path" : "src/test/fuzz/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 738287747,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-08-25T12:30:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695703548",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r695704111"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695704111"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've made the getter const. I think removing the only public data member of CAddrMan is an improvement.",
      "commit_id" : "8a4c815dfef78eca6e481233195a5cfb171f3687",
      "created_at" : "2021-08-25T12:31:13Z",
      "diff_hunk" : "@@ -593,6 +577,8 @@ class CAddrMan\n         Check();\n     }\n \n+    const std::vector<bool>& GetAsmap() { return m_asmap; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r695704111",
      "id" : 695704111,
      "in_reply_to_id" : 695003334,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NTcwNDExMQ==",
      "original_commit_id" : "4ffc8b81bc520fe66fbea9a597ab889a2647ca2e",
      "original_line" : 580,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 738288490,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-25T12:31:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695704111",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r695704407"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695704407"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good suggestion, but will hold off doing it in this PR to reduce the diff. This part is mostly move-only.",
      "commit_id" : "8a4c815dfef78eca6e481233195a5cfb171f3687",
      "created_at" : "2021-08-25T12:31:35Z",
      "diff_hunk" : "@@ -1171,10 +1171,38 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     fDiscover = args.GetBoolArg(\"-discover\", true);\n     const bool ignores_incoming_txs{args.GetBoolArg(\"-blocksonly\", DEFAULT_BLOCKSONLY)};\n \n-    assert(!node.addrman);\n-    auto check_addrman = std::clamp<int32_t>(args.GetArg(\"-checkaddrman\", DEFAULT_ADDRMAN_CONSISTENCY_CHECKS), 0, 1000000);\n-    node.addrman = std::make_unique<CAddrMan>(/* deterministic */ false, /* consistency_check_ratio */ check_addrman);\n     {\n+        // Initialize addrman\n+        assert(!node.addrman);\n+\n+        // Read asmap file if configured\n+        std::vector<bool> asmap{};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r695704407",
      "id" : 695704407,
      "in_reply_to_id" : 695020652,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NTcwNDQwNw==",
      "original_commit_id" : "4ffc8b81bc520fe66fbea9a597ab889a2647ca2e",
      "original_line" : 1179,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 738288877,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-25T12:31:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695704407",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r695705032"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695705032"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It limits the scope and makes it obvious that local variables like `asmap` and `adb` are not used outside this code block.",
      "commit_id" : "8a4c815dfef78eca6e481233195a5cfb171f3687",
      "created_at" : "2021-08-25T12:32:25Z",
      "diff_hunk" : "@@ -1183,11 +1211,12 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n             LogPrintf(\"Loaded %i addresses from peers.dat  %dms\\n\", node.addrman->size(), GetTimeMillis() - nStart);\n         } else {\n             // Addrman can be in an inconsistent state after failure, reset it\n-            node.addrman = std::make_unique<CAddrMan>(/* deterministic */ false, /* consistency_check_ratio */ check_addrman);\n+            node.addrman = std::make_unique<CAddrMan>(&asmap, /* deterministic */ false, /* consistency_check_ratio */ check_addrman);\n             LogPrintf(\"Recreating peers.dat\\n\");\n             adb.Write(*node.addrman);\n         }\n     }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r695705032",
      "id" : 695705032,
      "in_reply_to_id" : 695022214,
      "line" : 1218,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NTcwNTAzMg==",
      "original_commit_id" : "4ffc8b81bc520fe66fbea9a597ab889a2647ca2e",
      "original_line" : 1218,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 51,
      "pull_request_review_id" : 738289710,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-25T12:32:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695705032",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the reviews @vasild @jonatack. I've addressed all your inline comments.\r\n\r\n@jonatack - If you have any suggested wording, I'm happy to incorporate it into the PR description.",
      "created_at" : "2021-08-25T12:35:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#issuecomment-905462254",
      "id" : 905462254,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22791",
      "node_id" : "IC_kwDOABII5841-EHu",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-25T12:35:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/905462254",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r696370758"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/696370758"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Previously the asmap assignment was inside `ConsumeBool()`, not anymore. To make it identical, this should be `vector asmap; if (ConsumeBool()) { asmap = ConsumeAsmap(); }`. I think it is fine now too, because in some cases `ConsumeAsmap()` will return an empty vector.",
      "commit_id" : "8a4c815dfef78eca6e481233195a5cfb171f3687",
      "created_at" : "2021-08-26T07:36:36Z",
      "diff_hunk" : "@@ -224,11 +218,19 @@ class CAddrManDeterministic : public CAddrMan\n     }\n };\n \n+[[nodiscard]] inline std::vector<bool> ConsumeAsmap(FuzzedDataProvider& fuzzed_data_provider) noexcept\n+{\n+    std::vector<bool> asmap = ConsumeRandomLengthBitVector(fuzzed_data_provider);\n+    if (!SanityCheckASMap(asmap)) asmap.clear();\n+    return asmap;\n+}\n+\n FUZZ_TARGET_INIT(addrman, initialize_addrman)\n {\n     FuzzedDataProvider fuzzed_data_provider(buffer.data(), buffer.size());\n     SetMockTime(ConsumeTime(fuzzed_data_provider));\n-    auto addr_man_ptr = std::make_unique<CAddrManDeterministic>(fuzzed_data_provider);\n+    std::vector<bool> asmap = ConsumeAsmap(fuzzed_data_provider);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r696370758",
      "id" : 696370758,
      "line" : 232,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NjM3MDc1OA==",
      "original_commit_id" : "8a4c815dfef78eca6e481233195a5cfb171f3687",
      "original_line" : 232,
      "original_position" : 36,
      "original_start_line" : 231,
      "path" : "src/test/fuzz/addrman.cpp",
      "position" : 36,
      "pull_request_review_id" : 739135528,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : 231,
      "start_side" : "LEFT",
      "updated_at" : "2021-08-26T07:41:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/696370758",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r696374214"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/696374214"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Commit 8a4c815dfef78eca6e481233195a5cfb171f3687 `[fuzz] Add ConsumeAsmap() function` contains this change:\r\n```diff\r\n-    const std::vector<bool>& GetAsmap() { return m_asmap; }\r\n+    const std::vector<bool>& GetAsmap() const { return m_asmap; }\r\n```\r\nwhich does not belong to it. Instead, that change should be squashed into 314e23e964ab7b333a2aec2cacb7c98b22daa8c2 `[addrman] Make m_asmap private` which introduced the `GetAsmap()` method.",
      "commit_id" : "8a4c815dfef78eca6e481233195a5cfb171f3687",
      "created_at" : "2021-08-26T07:41:20Z",
      "diff_hunk" : "@@ -660,6 +646,22 @@ class CAddrMan\n     /** Perform consistency checks every m_consistency_check_ratio operations (if non-zero). */\n     const int32_t m_consistency_check_ratio;\n \n+    // Compressed IP->ASN mapping, loaded from a file when a node starts.\n+    // Should be always empty if no file was provided.\n+    // This mapping is then used for bucketing nodes in Addrman.\n+    //\n+    // If asmap is provided, nodes will be bucketed by\n+    // AS they belong to, in order to make impossible for a node\n+    // to connect to several nodes hosted in a single AS.\n+    // This is done in response to Erebus attack, but also to generally\n+    // diversify the connections every node creates,\n+    // especially useful when a large fraction of nodes\n+    // operate under a couple of cloud providers.\n+    //\n+    // If a new asmap was provided, the existing records\n+    // would be re-bucketed accordingly.\n+    const std::vector<bool> m_asmap;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r696374214",
      "id" : 696374214,
      "line" : 663,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NjM3NDIxNA==",
      "original_commit_id" : "8a4c815dfef78eca6e481233195a5cfb171f3687",
      "original_line" : 663,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 59,
      "pull_request_review_id" : 739135528,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-26T07:41:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/696374214",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r696380951"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/696380951"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I guess this is fine either way. I like the reasoning in https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines.html#c131-avoid-trivial-getters-and-setters",
      "commit_id" : "8a4c815dfef78eca6e481233195a5cfb171f3687",
      "created_at" : "2021-08-26T07:50:28Z",
      "diff_hunk" : "@@ -593,6 +577,8 @@ class CAddrMan\n         Check();\n     }\n \n+    const std::vector<bool>& GetAsmap() { return m_asmap; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r696380951",
      "id" : 696380951,
      "in_reply_to_id" : 695003334,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NjM4MDk1MQ==",
      "original_commit_id" : "4ffc8b81bc520fe66fbea9a597ab889a2647ca2e",
      "original_line" : 580,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 739148547,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-26T07:50:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/696380951",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r696383320"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/696383320"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Functions do that better.",
      "commit_id" : "8a4c815dfef78eca6e481233195a5cfb171f3687",
      "created_at" : "2021-08-26T07:53:35Z",
      "diff_hunk" : "@@ -1183,11 +1211,12 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n             LogPrintf(\"Loaded %i addresses from peers.dat  %dms\\n\", node.addrman->size(), GetTimeMillis() - nStart);\n         } else {\n             // Addrman can be in an inconsistent state after failure, reset it\n-            node.addrman = std::make_unique<CAddrMan>(/* deterministic */ false, /* consistency_check_ratio */ check_addrman);\n+            node.addrman = std::make_unique<CAddrMan>(&asmap, /* deterministic */ false, /* consistency_check_ratio */ check_addrman);\n             LogPrintf(\"Recreating peers.dat\\n\");\n             adb.Write(*node.addrman);\n         }\n     }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r696383320",
      "id" : 696383320,
      "in_reply_to_id" : 695022214,
      "line" : 1218,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NjM4MzMyMA==",
      "original_commit_id" : "4ffc8b81bc520fe66fbea9a597ab889a2647ca2e",
      "original_line" : 1218,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 51,
      "pull_request_review_id" : 739151651,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-26T07:53:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/696383320",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r696457307"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/696457307"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Right, I think `ConsumeAsmap()` will actually return an empty vector in most cases, since `SanityCheckASMap()` will fail for most random bool vectors.",
      "commit_id" : "d4fda4f9b9c9e0cebf16381f6f49b39a43ef9ef4",
      "created_at" : "2021-08-26T09:28:18Z",
      "diff_hunk" : "@@ -224,11 +218,19 @@ class CAddrManDeterministic : public CAddrMan\n     }\n };\n \n+[[nodiscard]] inline std::vector<bool> ConsumeAsmap(FuzzedDataProvider& fuzzed_data_provider) noexcept\n+{\n+    std::vector<bool> asmap = ConsumeRandomLengthBitVector(fuzzed_data_provider);\n+    if (!SanityCheckASMap(asmap)) asmap.clear();\n+    return asmap;\n+}\n+\n FUZZ_TARGET_INIT(addrman, initialize_addrman)\n {\n     FuzzedDataProvider fuzzed_data_provider(buffer.data(), buffer.size());\n     SetMockTime(ConsumeTime(fuzzed_data_provider));\n-    auto addr_man_ptr = std::make_unique<CAddrManDeterministic>(fuzzed_data_provider);\n+    std::vector<bool> asmap = ConsumeAsmap(fuzzed_data_provider);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r696457307",
      "id" : 696457307,
      "in_reply_to_id" : 696370758,
      "line" : 232,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NjQ1NzMwNw==",
      "original_commit_id" : "8a4c815dfef78eca6e481233195a5cfb171f3687",
      "original_line" : 232,
      "original_position" : 36,
      "original_start_line" : 231,
      "path" : "src/test/fuzz/addrman.cpp",
      "position" : 36,
      "pull_request_review_id" : 739247378,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : 231,
      "start_side" : "LEFT",
      "updated_at" : "2021-08-26T09:28:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/696457307",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r696457401"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/696457401"
         }
      },
      "author_association" : "MEMBER",
      "body" : "thanks. Fixed",
      "commit_id" : "d4fda4f9b9c9e0cebf16381f6f49b39a43ef9ef4",
      "created_at" : "2021-08-26T09:28:28Z",
      "diff_hunk" : "@@ -660,6 +646,22 @@ class CAddrMan\n     /** Perform consistency checks every m_consistency_check_ratio operations (if non-zero). */\n     const int32_t m_consistency_check_ratio;\n \n+    // Compressed IP->ASN mapping, loaded from a file when a node starts.\n+    // Should be always empty if no file was provided.\n+    // This mapping is then used for bucketing nodes in Addrman.\n+    //\n+    // If asmap is provided, nodes will be bucketed by\n+    // AS they belong to, in order to make impossible for a node\n+    // to connect to several nodes hosted in a single AS.\n+    // This is done in response to Erebus attack, but also to generally\n+    // diversify the connections every node creates,\n+    // especially useful when a large fraction of nodes\n+    // operate under a couple of cloud providers.\n+    //\n+    // If a new asmap was provided, the existing records\n+    // would be re-bucketed accordingly.\n+    const std::vector<bool> m_asmap;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r696457401",
      "id" : 696457401,
      "in_reply_to_id" : 696374214,
      "line" : 663,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NjQ1NzQwMQ==",
      "original_commit_id" : "8a4c815dfef78eca6e481233195a5cfb171f3687",
      "original_line" : 663,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 59,
      "pull_request_review_id" : 739247529,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-26T09:28:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/696457401",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r697256371"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/697256371"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'd prefer to use `std::optional<std::vector<bool>>` instead of a pointer here, as it more clearly communicates what the parameter is (as well as the copying semantics).",
      "commit_id" : "d4fda4f9b9c9e0cebf16381f6f49b39a43ef9ef4",
      "created_at" : "2021-08-27T08:32:44Z",
      "diff_hunk" : "@@ -471,7 +455,7 @@ class CAddrMan\n         Check();\n     }\n \n-    explicit CAddrMan(bool deterministic, int32_t consistency_check_ratio);\n+    explicit CAddrMan(std::vector<bool>* asmap, bool deterministic, int32_t consistency_check_ratio);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r697256371",
      "id" : 697256371,
      "line" : 458,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NzI1NjM3MQ==",
      "original_commit_id" : "d4fda4f9b9c9e0cebf16381f6f49b39a43ef9ef4",
      "original_line" : 458,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 28,
      "pull_request_review_id" : 740274270,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-27T08:39:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/697256371",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r697265506"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/697265506"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If we were going to change this, I think it'd be even easier just to pass a `std::vector<bool>`, and pass the empty vector if there was no asmap (which is what `m_asmap` gets set to in that case). What do you think?",
      "commit_id" : "d4fda4f9b9c9e0cebf16381f6f49b39a43ef9ef4",
      "created_at" : "2021-08-27T08:46:54Z",
      "diff_hunk" : "@@ -471,7 +455,7 @@ class CAddrMan\n         Check();\n     }\n \n-    explicit CAddrMan(bool deterministic, int32_t consistency_check_ratio);\n+    explicit CAddrMan(std::vector<bool>* asmap, bool deterministic, int32_t consistency_check_ratio);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r697265506",
      "id" : 697265506,
      "in_reply_to_id" : 697256371,
      "line" : 458,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NzI2NTUwNg==",
      "original_commit_id" : "d4fda4f9b9c9e0cebf16381f6f49b39a43ef9ef4",
      "original_line" : 458,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 28,
      "pull_request_review_id" : 740286382,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-27T08:46:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/697265506",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r697298430"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/697298430"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Given that the class member is of type `std::vector<bool>` (not a pointer that can be NULL, nor an optional that can be without a value), maybe just passing `std::vector<bool>` would be ok. The checks whether asmap \"is present\" are `m_asmap.size() != 0`.",
      "commit_id" : "d4fda4f9b9c9e0cebf16381f6f49b39a43ef9ef4",
      "created_at" : "2021-08-27T09:35:54Z",
      "diff_hunk" : "@@ -471,7 +455,7 @@ class CAddrMan\n         Check();\n     }\n \n-    explicit CAddrMan(bool deterministic, int32_t consistency_check_ratio);\n+    explicit CAddrMan(std::vector<bool>* asmap, bool deterministic, int32_t consistency_check_ratio);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r697298430",
      "id" : 697298430,
      "in_reply_to_id" : 697256371,
      "line" : 458,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NzI5ODQzMA==",
      "original_commit_id" : "d4fda4f9b9c9e0cebf16381f6f49b39a43ef9ef4",
      "original_line" : 458,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 28,
      "pull_request_review_id" : 740329616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-27T09:35:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/697298430",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r697316933"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/697316933"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ok, done!",
      "commit_id" : "724c4975622bc22cedc3f3814dfc8e66cf8371f7",
      "created_at" : "2021-08-27T10:03:30Z",
      "diff_hunk" : "@@ -471,7 +455,7 @@ class CAddrMan\n         Check();\n     }\n \n-    explicit CAddrMan(bool deterministic, int32_t consistency_check_ratio);\n+    explicit CAddrMan(std::vector<bool>* asmap, bool deterministic, int32_t consistency_check_ratio);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r697316933",
      "id" : 697316933,
      "in_reply_to_id" : 697256371,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NzMxNjkzMw==",
      "original_commit_id" : "d4fda4f9b9c9e0cebf16381f6f49b39a43ef9ef4",
      "original_line" : 458,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 740354357,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-27T10:03:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/697316933",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r697317574"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/697317574"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sure, that would be more obvious, I hesitated to suggest it though because treating an empty vector as \"special\" value for absence is a CAddrMan implementation detail that might change later. But I'm ok with it, it's better than the pointer.",
      "commit_id" : "724c4975622bc22cedc3f3814dfc8e66cf8371f7",
      "created_at" : "2021-08-27T10:04:35Z",
      "diff_hunk" : "@@ -471,7 +455,7 @@ class CAddrMan\n         Check();\n     }\n \n-    explicit CAddrMan(bool deterministic, int32_t consistency_check_ratio);\n+    explicit CAddrMan(std::vector<bool>* asmap, bool deterministic, int32_t consistency_check_ratio);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r697317574",
      "id" : 697317574,
      "in_reply_to_id" : 697256371,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NzMxNzU3NA==",
      "original_commit_id" : "d4fda4f9b9c9e0cebf16381f6f49b39a43ef9ef4",
      "original_line" : 458,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 740355225,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-27T10:07:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/697317574",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r697472059"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/697472059"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think performance is not important here because addrman constructor is not called frequently. Just mentioning: without the `std::move` it would copy the vector two times - once from the caller to the temporary argument and once from the temporary argument to `m_asmap`. With the `std::move` the second copy is avoided (a move is done instead), but the first copy is still done.\r\n\r\nFrom performance point of view it would be best to have two constructors:\r\n```cpp\r\n// If the caller does not need the asmap afterwards. One move operation. Example:\r\n// std::vector<bool> asmap;\r\n// ...\r\n// CAddrMan addrman{std::move(asmap)};\r\n// Now the asmap variable is \"empty\".\r\nCAddrMan::CAddrMan(std::vector<bool>&& asmap) : m_asmap{std::move(asmap)} { ... }\r\n\r\n// If the caller needs the asmap afterwards. One copy operation. Example:\r\n// std::vector<bool> asmap;\r\n// ...\r\n// CAddrMan addrman{asmap};\r\n// Now the asmap variable is untouched.\r\nCAddrMan::CAddrMan(const std::vector<bool>& asmap) : m_asmap{asmap} { ... }\r\n```",
      "commit_id" : "724c4975622bc22cedc3f3814dfc8e66cf8371f7",
      "created_at" : "2021-08-27T14:09:25Z",
      "diff_hunk" : "@@ -77,10 +77,11 @@ double CAddrInfo::GetChance(int64_t nNow) const\n     return fChance;\n }\n \n-CAddrMan::CAddrMan(bool deterministic, int32_t consistency_check_ratio)\n+CAddrMan::CAddrMan(std::vector<bool> asmap, bool deterministic, int32_t consistency_check_ratio)\n     : insecure_rand{deterministic}\n     , nKey{deterministic ? uint256{1} : insecure_rand.rand256()}\n     , m_consistency_check_ratio{consistency_check_ratio}\n+    , m_asmap{std::move(asmap)}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r697472059",
      "id" : 697472059,
      "line" : 84,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NzQ3MjA1OQ==",
      "original_commit_id" : "724c4975622bc22cedc3f3814dfc8e66cf8371f7",
      "original_line" : 84,
      "original_position" : 9,
      "original_start_line" : 80,
      "path" : "src/addrman.cpp",
      "position" : 9,
      "pull_request_review_id" : 740564895,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : 80,
      "start_side" : "RIGHT",
      "updated_at" : "2021-08-27T14:10:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/697472059",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r697489358"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/697489358"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Right, the reason I originally used a pointer as an argument was that the asmap might be needed afterwards, so we can't just move from the argument. I wanted to avoid the two copies that you refer to above.\r\n\r\nAs you point out, performance is not important since we'll call this ctor at most twice (and almost always only once).",
      "commit_id" : "724c4975622bc22cedc3f3814dfc8e66cf8371f7",
      "created_at" : "2021-08-27T14:31:26Z",
      "diff_hunk" : "@@ -77,10 +77,11 @@ double CAddrInfo::GetChance(int64_t nNow) const\n     return fChance;\n }\n \n-CAddrMan::CAddrMan(bool deterministic, int32_t consistency_check_ratio)\n+CAddrMan::CAddrMan(std::vector<bool> asmap, bool deterministic, int32_t consistency_check_ratio)\n     : insecure_rand{deterministic}\n     , nKey{deterministic ? uint256{1} : insecure_rand.rand256()}\n     , m_consistency_check_ratio{consistency_check_ratio}\n+    , m_asmap{std::move(asmap)}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r697489358",
      "id" : 697489358,
      "in_reply_to_id" : 697472059,
      "line" : 84,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NzQ4OTM1OA==",
      "original_commit_id" : "724c4975622bc22cedc3f3814dfc8e66cf8371f7",
      "original_line" : 84,
      "original_position" : 9,
      "original_start_line" : 80,
      "path" : "src/addrman.cpp",
      "position" : 9,
      "pull_request_review_id" : 740588377,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : 80,
      "start_side" : "RIGHT",
      "updated_at" : "2021-08-27T14:31:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/697489358",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Tested ACK 724c4975622bc22cedc3f3814dfc8e66cf8371f7\r\n\r\nCode changes look correct to me.\r\nI verified that current master failed the addrman checks (`-checkaddrman`) when switching from no-asmap mode to asmap mode with an existing `peers.dat`, while I experienced no problems over multiple switches on this branch.",
      "created_at" : "2021-08-28T18:41:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#issuecomment-907671183",
      "id" : 907671183,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22791",
      "node_id" : "IC_kwDOABII5842GfaP",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-28T18:41:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/907671183",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Suggestions:\r\n> \r\n>     * link to [erisian.com.au/bitcoin-core-dev/log-2021-08-23.html#l-263](https://www.erisian.com.au/bitcoin-core-dev/log-2021-08-23.html#l-263) (up to line 382) in the PR description for context\r\n> \r\n>     * describe the symptoms/consequences of the issue and how to reproduce\r\n> \r\n>     * maybe save refactoring/renaming for a non-bug-fix\r\n> \r\n>     * add a passing/failing test that demonstrates the bug is fixed\r\n\r\nAddressed these suggestions in #22831 that pulls in the first commit here. That patch could be merged first and this one rebased on it (or vice-versa), or you could optionally pull in the test commits and use the PR description--as you prefer.",
      "created_at" : "2021-08-29T19:30:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#issuecomment-907856179",
      "id" : 907856179,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22791",
      "node_id" : "IC_kwDOABII5842HMkz",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-29T19:30:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/907856179",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r699652022"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/699652022"
         }
      },
      "author_association" : "MEMBER",
      "body" : "question about use of `std::move` here - \r\n\r\nIf reading `peers.dat` causes issues, `init.cpp` will instantiate a `CAddrMan` twice, using the same asmap both times. Is this ok? I know that `std::move` is more of a suggestion than a command, so I'm wondering how this code would be interpreted. ",
      "commit_id" : "724c4975622bc22cedc3f3814dfc8e66cf8371f7",
      "created_at" : "2021-08-31T20:30:43Z",
      "diff_hunk" : "@@ -77,8 +77,9 @@ double CAddrInfo::GetChance(int64_t nNow) const\n     return fChance;\n }\n \n-CAddrMan::CAddrMan(bool deterministic, int32_t consistency_check_ratio)\n-    : insecure_rand{deterministic}\n+CAddrMan::CAddrMan(std::vector<bool> asmap, bool deterministic, int32_t consistency_check_ratio)\n+    : m_asmap{std::move(asmap)}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r699652022",
      "id" : 699652022,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5OTY1MjAyMg==",
      "original_commit_id" : "f572f2b2048994b3b50f4cfd5de19e40b1acfb22",
      "original_line" : 81,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 743162479,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-31T20:46:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/699652022",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r699655721"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/699655721"
         }
      },
      "author_association" : "MEMBER",
      "body" : "commit: 5840476714ffebb2599999c85a23b52ebcff6090  _[addrman] Make m_asmap private_\r\n\r\nIs making the ordering of private members last in the initializer list a personal preference? I find it slightly odd that the initializer list no longer matches the order of the ctor args. Also you could have just introduced them in this order? =P ",
      "commit_id" : "724c4975622bc22cedc3f3814dfc8e66cf8371f7",
      "created_at" : "2021-08-31T20:36:54Z",
      "diff_hunk" : "@@ -78,10 +78,10 @@ double CAddrInfo::GetChance(int64_t nNow) const\n }\n \n CAddrMan::CAddrMan(std::vector<bool> asmap, bool deterministic, int32_t consistency_check_ratio)\n-    : m_asmap{std::move(asmap)}\n-    , insecure_rand{deterministic}\n+    : insecure_rand{deterministic}\n     , nKey{deterministic ? uint256{1} : insecure_rand.rand256()}\n     , m_consistency_check_ratio{consistency_check_ratio}\n+    , m_asmap{std::move(asmap)}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r699655721",
      "id" : 699655721,
      "line" : 84,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5OTY1NTcyMQ==",
      "original_commit_id" : "5840476714ffebb2599999c85a23b52ebcff6090",
      "original_line" : 84,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 9,
      "pull_request_review_id" : 743162479,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-31T20:46:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/699655721",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "approach ACK, I want to understand the `std::move` implications & then I'm ready to leave a review ACK. \r\ndid you consider making `m_asmap` an optional arg for the addrman constructor? \r\nbut overall, I like these changes- in addition to fixing the bug, making asmap a private & read-only member of addrman seems like an incremental improvement to me. ",
      "created_at" : "2021-08-31T20:46:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#issuecomment-909622667",
      "id" : 909622667,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22791",
      "node_id" : "IC_kwDOABII5842N72L",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-31T20:46:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/909622667",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r700323492"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700323492"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The variable from `init.cpp` will be copied to the `CAddrMan` constructor into a temporary, used for the argument (this temporary is what is available inside the body of the constructor and will be automatically destroyed when the constructor returns). Then the constructor moves that temporary into the `m_asmap` member. So, the caller's variable from `init.cpp` will not be modified and can be reused.\r\n\r\nSee also https://github.com/bitcoin/bitcoin/pull/22791#discussion_r697472059",
      "commit_id" : "724c4975622bc22cedc3f3814dfc8e66cf8371f7",
      "created_at" : "2021-09-01T15:25:33Z",
      "diff_hunk" : "@@ -77,8 +77,9 @@ double CAddrInfo::GetChance(int64_t nNow) const\n     return fChance;\n }\n \n-CAddrMan::CAddrMan(bool deterministic, int32_t consistency_check_ratio)\n-    : insecure_rand{deterministic}\n+CAddrMan::CAddrMan(std::vector<bool> asmap, bool deterministic, int32_t consistency_check_ratio)\n+    : m_asmap{std::move(asmap)}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r700323492",
      "id" : 700323492,
      "in_reply_to_id" : 699652022,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMDMyMzQ5Mg==",
      "original_commit_id" : "f572f2b2048994b3b50f4cfd5de19e40b1acfb22",
      "original_line" : 81,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 744078620,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-01T15:25:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700323492",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r700327345"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700327345"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The order here must be the same as the order in which the variables are declared in the class, otherwise we get a compiler warning.",
      "commit_id" : "724c4975622bc22cedc3f3814dfc8e66cf8371f7",
      "created_at" : "2021-09-01T15:29:46Z",
      "diff_hunk" : "@@ -78,10 +78,10 @@ double CAddrInfo::GetChance(int64_t nNow) const\n }\n \n CAddrMan::CAddrMan(std::vector<bool> asmap, bool deterministic, int32_t consistency_check_ratio)\n-    : m_asmap{std::move(asmap)}\n-    , insecure_rand{deterministic}\n+    : insecure_rand{deterministic}\n     , nKey{deterministic ? uint256{1} : insecure_rand.rand256()}\n     , m_consistency_check_ratio{consistency_check_ratio}\n+    , m_asmap{std::move(asmap)}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r700327345",
      "id" : 700327345,
      "in_reply_to_id" : 699655721,
      "line" : 84,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMDMyNzM0NQ==",
      "original_commit_id" : "5840476714ffebb2599999c85a23b52ebcff6090",
      "original_line" : 84,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 9,
      "pull_request_review_id" : 744083742,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-01T15:29:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700327345",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r700338434"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700338434"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ah right, thanks ",
      "commit_id" : "724c4975622bc22cedc3f3814dfc8e66cf8371f7",
      "created_at" : "2021-09-01T15:42:30Z",
      "diff_hunk" : "@@ -78,10 +78,10 @@ double CAddrInfo::GetChance(int64_t nNow) const\n }\n \n CAddrMan::CAddrMan(std::vector<bool> asmap, bool deterministic, int32_t consistency_check_ratio)\n-    : m_asmap{std::move(asmap)}\n-    , insecure_rand{deterministic}\n+    : insecure_rand{deterministic}\n     , nKey{deterministic ? uint256{1} : insecure_rand.rand256()}\n     , m_consistency_check_ratio{consistency_check_ratio}\n+    , m_asmap{std::move(asmap)}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r700338434",
      "id" : 700338434,
      "in_reply_to_id" : 699655721,
      "line" : 84,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMDMzODQzNA==",
      "original_commit_id" : "5840476714ffebb2599999c85a23b52ebcff6090",
      "original_line" : 84,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 9,
      "pull_request_review_id" : 744099031,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-01T15:42:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700338434",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r701521327"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701521327"
         }
      },
      "author_association" : "MEMBER",
      "body" : "hm interesting, I've made some little toy programs to try to understand this behavior, and I see that the caller's variable can be reused, so that resolves my concern.\r\n\r\n~I'm not seeing the behavior of copying the temporary, but I'm going to resolve this conversation and explain further on the comment you linked.~ ",
      "commit_id" : "724c4975622bc22cedc3f3814dfc8e66cf8371f7",
      "created_at" : "2021-09-03T01:21:07Z",
      "diff_hunk" : "@@ -77,8 +77,9 @@ double CAddrInfo::GetChance(int64_t nNow) const\n     return fChance;\n }\n \n-CAddrMan::CAddrMan(bool deterministic, int32_t consistency_check_ratio)\n-    : insecure_rand{deterministic}\n+CAddrMan::CAddrMan(std::vector<bool> asmap, bool deterministic, int32_t consistency_check_ratio)\n+    : m_asmap{std::move(asmap)}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r701521327",
      "id" : 701521327,
      "in_reply_to_id" : 699652022,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMTUyMTMyNw==",
      "original_commit_id" : "f572f2b2048994b3b50f4cfd5de19e40b1acfb22",
      "original_line" : 81,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 745635851,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-03T01:31:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/701521327",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "code review but utACK 724c497562",
      "created_at" : "2021-09-03T01:35:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#issuecomment-912184276",
      "id" : 912184276,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22791",
      "node_id" : "IC_kwDOABII5842XtPU",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-03T01:35:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/912184276",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 724c4975622bc22cedc3f3814dfc8e66cf8371f7",
      "created_at" : "2021-09-06T09:18:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#issuecomment-913489764",
      "id" : 913489764,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22791",
      "node_id" : "IC_kwDOABII5842cr9k",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-06T09:18:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/913489764",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r702798866"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702798866"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The order could have been kept the same if it was moved to before `insecure_rand` in the header file",
      "commit_id" : "724c4975622bc22cedc3f3814dfc8e66cf8371f7",
      "created_at" : "2021-09-06T10:38:48Z",
      "diff_hunk" : "@@ -78,10 +78,10 @@ double CAddrInfo::GetChance(int64_t nNow) const\n }\n \n CAddrMan::CAddrMan(std::vector<bool> asmap, bool deterministic, int32_t consistency_check_ratio)\n-    : m_asmap{std::move(asmap)}\n-    , insecure_rand{deterministic}\n+    : insecure_rand{deterministic}\n     , nKey{deterministic ? uint256{1} : insecure_rand.rand256()}\n     , m_consistency_check_ratio{consistency_check_ratio}\n+    , m_asmap{std::move(asmap)}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r702798866",
      "id" : 702798866,
      "in_reply_to_id" : 699655721,
      "line" : 84,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMjc5ODg2Ng==",
      "original_commit_id" : "5840476714ffebb2599999c85a23b52ebcff6090",
      "original_line" : 84,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 9,
      "pull_request_review_id" : 747083335,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-06T10:38:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702798866",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r702799151"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702799151"
         }
      },
      "author_association" : "MEMBER",
      "body" : "please add LIFETIMEBOUND when returning a pointer to memory in `this`",
      "commit_id" : "724c4975622bc22cedc3f3814dfc8e66cf8371f7",
      "created_at" : "2021-09-06T10:39:25Z",
      "diff_hunk" : "@@ -593,6 +577,8 @@ class CAddrMan\n         Check();\n     }\n \n+    const std::vector<bool>& GetAsmap() const { return m_asmap; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r702799151",
      "id" : 702799151,
      "line" : 580,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMjc5OTE1MQ==",
      "original_commit_id" : "5840476714ffebb2599999c85a23b52ebcff6090",
      "original_line" : 580,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 36,
      "pull_request_review_id" : 747083780,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-06T10:41:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702799151",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r703582112"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703582112"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good idea.\r\n\r\nI actually plan to fully encapsulate asmap in its own component in #22910, so we're not passing out references to private data.",
      "commit_id" : "724c4975622bc22cedc3f3814dfc8e66cf8371f7",
      "created_at" : "2021-09-07T14:49:20Z",
      "diff_hunk" : "@@ -593,6 +577,8 @@ class CAddrMan\n         Check();\n     }\n \n+    const std::vector<bool>& GetAsmap() const { return m_asmap; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#discussion_r703582112",
      "id" : 703582112,
      "in_reply_to_id" : 702799151,
      "line" : 580,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMzU4MjExMg==",
      "original_commit_id" : "5840476714ffebb2599999c85a23b52ebcff6090",
      "original_line" : 580,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 36,
      "pull_request_review_id" : 748074254,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/22791",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-07T14:49:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/703582112",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Addressed these suggestions in #22831 that pulls in the first commit here. That patch could be merged first and this one rebased on it (or vice-versa), or you could optionally pull in the test commits and use the PR description--as you prefer.\r\n\r\nWhy was this comment, made 12 days ago and 8 days before merge, ignored? \r\n\r\nIt would be one thing if this change was a straightforward revert or a simple reordering, but at face value it is not obvious that this change fixes the fairly severe bug that @jonatack discovered. It is troubling that a patch of this complexity was merged without an accompanying test verifying its efficacy, especially when one was made readily available.",
      "created_at" : "2021-09-10T16:46:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#issuecomment-917050278",
      "id" : 917050278,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22791",
      "node_id" : "IC_kwDOABII5842qROm",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-10T16:46:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/917050278",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Concept ACK [4ffc8b8](https://github.com/bitcoin/bitcoin/commit/4ffc8b81bc520fe66fbea9a597ab889a2647ca2e) modulo comments below and feedback from fuzzing people wrt invalidating affected corpii\r\n> \r\n> Suggestions:\r\n> \r\n>     * link to [erisian.com.au/bitcoin-core-dev/log-2021-08-23.html#l-263](https://www.erisian.com.au/bitcoin-core-dev/log-2021-08-23.html#l-263) (up to line 382) in the PR description for context\r\n> \r\n>     * describe the symptoms/consequences of the issue and how to reproduce\r\n> \r\n>     * maybe save refactoring/renaming for a non-bug-fix\r\n> \r\n>     * add a passing/failing test that demonstrates the bug is fixed\r\n\r\n@jamesob I didn't understand either. The suggestions in https://github.com/bitcoin/bitcoin/pull/22791#pullrequestreview-737430387 were also essentially ignored. \r\n",
      "created_at" : "2021-09-10T18:11:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#issuecomment-917108864",
      "id" : 917108864,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22791",
      "node_id" : "IC_kwDOABII5842qfiA",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-10T18:11:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/917108864",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "There were 5 ACKs, including one tested ACK, before I added the 6th ACK. I think this number of review ACKs (in addition to the tests to verify the fix by people who didn't leave a comment) is sufficient to merge a pull request. This is overall a higher than average review interest compared to other pull reqeusts. If the alternative pull doesn't get any ACKs, it would appear slightly odd to me to merge it instead.",
      "created_at" : "2021-09-11T06:59:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#issuecomment-917355217",
      "id" : 917355217,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22791",
      "node_id" : "IC_kwDOABII5842rbrR",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-11T06:59:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/917355217",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Why was this comment, made 12 days ago and 8 days before merge, ignored?\r\n> \r\n> It would be one thing if this change was a straightforward revert or a simple reordering, but at face value it is not obvious that this change fixes the fairly severe bug that @jonatack discovered. It is troubling that a patch of this complexity was merged without an accompanying test verifying its efficacy, especially when one was made readily available.\r\n\r\n@jamesob (https://github.com/bitcoin/bitcoin/pull/22791#issuecomment-917050278)\r\n\r\n> The suggestions in #22791 (review) were also essentially ignored.\r\n\r\n@jonatack (https://github.com/bitcoin/bitcoin/pull/22791#issuecomment-917108864)\r\n\r\nPlease see https://github.com/bitcoin/bitcoin/pull/22831#issuecomment-918092775.",
      "created_at" : "2021-09-13T12:59:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/22791#issuecomment-918164710",
      "id" : 918164710,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/22791",
      "node_id" : "IC_kwDOABII5842uhTm",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-13T12:59:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/918164710",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   }
]
