{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "[Travis errors](https://travis-ci.org/github/bitcoin/bitcoin/jobs/689667275#L4121) on #18912 (PR adding Valgrind checking) due to the following `CPubKey` deserialization issue. [See Travis log for details](https://travis-ci.org/github/bitcoin/bitcoin/jobs/689667275#L4121).\r\n\r\nIssue:\r\n\r\nIt is possible to successfully deserialize a public key (`CPubKey`) which when used -- such as checking for validity using `IsFullyValid()` -- leads to use of uninitialized memory (UUM):\r\n\r\nExample:\r\n\r\n```c++\r\nconst std::vector<uint8_t> serialized_pub_key{4, 4, 0, 0, 0};\r\nCDataStream data_stream{serialized_pub_key, SER_NETWORK, INIT_PROTO_VERSION};\r\nCPubKey pub_key;\r\ndata_stream >> pub_key;\r\nif (pub_key.IsValid()) {\r\n    (void)pub_key.IsFullyValid();\r\n}\r\n```\r\n\r\nThe example code leads to the following use of uninitialized memory (UUM) (in `IsFullyValid()`) ...\r\n\r\n```\r\n==6417== Conditional jump or move depends on uninitialised value(s)\r\n==6417==    at 0x1077684: secp256k1_fe_set_b32 (field_5x52_impl.h:320)\r\n==6417==    by 0x1056B82: secp256k1_eckey_pubkey_parse (eckey_impl.h:23)\r\n==6417==    by 0x1056B82: secp256k1_ec_pubkey_parse (secp256k1.c:178)\r\n==6417==    by 0xF4A6A3: CPubKey::IsFullyValid() const (pubkey.cpp:213)\r\n```\r\n\r\n... instead of the expected `std::ios_base::failure` when deserializing (on `data_stream >> pub_key`).\r\n\r\n---\r\n\r\nUses of uninitialized memory (UUM) is unfortunately a quite common type of bug, but luckily MemorySanitizer and Valgrind can help us guard against such issues entering our code base. Travis MSan checking and Valgrind checking is provided in the following two PRs which should be ready for merge pending final code review (they have multiple \"Concept ACKs\"):\r\n* #18288 -- \"build: Add MemorySanitizer (MSan) in Travis to detect use of uninitialized memory\"\r\n* #18912 -- \"ci: Run fuzz testing test cases (bitcoin-core/qa-assets) under valgrind to catch memory errors\"\r\n\r\nHopefully uses of uninitialized memory will soon be a thing of the past when we have the proper UUM detection in place :)",
   "closed_at" : "2020-06-25T12:08:50Z",
   "closed_by" : {
      "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
      "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
      "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/MarcoFalke",
      "id" : 6399679,
      "login" : "MarcoFalke",
      "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
      "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
      "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
      "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/MarcoFalke"
   },
   "comments" : 3,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19235/comments",
   "created_at" : "2020-06-10T11:27:45Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19235/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/19235",
   "id" : 636168900,
   "labels" : [
      {
         "color" : "FBBAAB",
         "default" : false,
         "description" : null,
         "id" : 64585,
         "name" : "Bug",
         "node_id" : "MDU6TGFiZWw2NDU4NQ==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19235/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDU6SXNzdWU2MzYxNjg5MDA=",
   "number" : 19235,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "Use of uninitialized memory when validating successfully deserialized CPubKey",
   "updated_at" : "2020-06-25T12:08:50Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19235",
   "user" : {
      "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
      "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
      "followers_url" : "https://api.github.com/users/practicalswift/followers",
      "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/practicalswift",
      "id" : 7826565,
      "login" : "practicalswift",
      "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
      "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
      "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
      "repos_url" : "https://api.github.com/users/practicalswift/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/practicalswift"
   }
}
