[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437267147"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437267147"
         }
      },
      "author_association" : "MEMBER",
      "body" : "A comment on the choice of nElements and nFPRate may be good here. These are the same as for `filterInventoryKnown`.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-09T09:23:00Z",
      "diff_hunk" : "@@ -68,6 +77,7 @@ class BanMan\n     CClientUIInterface* m_client_interface = nullptr;\n     CBanDB m_ban_db;\n     const int64_t m_default_ban_time;\n+    CRollingBloomFilter m_discouraged{50000, 0.000001};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437267147",
      "id" : 437267147,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI2NzE0Nw==",
      "original_commit_id" : "4c4df6bf61104a4946479fccc7885dc0fe05dbd8",
      "original_line" : 80,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : null,
      "pull_request_review_id" : 426954204,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437267147",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437417403"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437417403"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n     BOOST_CHECK_EQUAL(1, banman->IsBannedLevel(addr));\r\n```\r\n\r\nnit (feel free to ignore, ofc): Could add a test for `IsBannedLevel`?",
      "commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "created_at" : "2020-06-09T13:29:44Z",
      "diff_hunk" : "@@ -346,12 +346,6 @@ BOOST_AUTO_TEST_CASE(DoS_bantime)\n     }\n     BOOST_CHECK(banman->IsBanned(addr));\n ",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437417403",
      "id" : 437417403,
      "line" : 348,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQxNzQwMw==",
      "original_commit_id" : "4c4df6bf61104a4946479fccc7885dc0fe05dbd8",
      "original_line" : 348,
      "original_position" : 3,
      "original_start_line" : null,
      "path" : "src/test/denialofservice_tests.cpp",
      "position" : 70,
      "pull_request_review_id" : 427144790,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-18T05:22:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437417403",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK 4c4df6bf61104a4946479fccc7885dc0fe05dbd8",
      "created_at" : "2020-06-09T14:08:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-641322171",
      "id" : 641322171,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MTMyMjE3MQ==",
      "updated_at" : "2020-06-09T14:08:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/641322171",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@luke-jr I don't think that's necessary. They (by default) have a 24 hour limit only, and during that time, they will just be treated as a real ban instead of a discouragement.",
      "created_at" : "2020-06-09T14:52:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-641349507",
      "id" : 641349507,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MTM0OTUwNw==",
      "updated_at" : "2020-06-09T14:53:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/641349507",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437648963"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437648963"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "it feels a bit odd to treat what is essentially an enum (0/1/2) as an int like this, suggest replacing with a conditional returning 1/0 explicitly",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-09T18:55:10Z",
      "diff_hunk" : "@@ -72,27 +72,26 @@ int BanMan::IsBannedLevel(CNetAddr net_addr)\n {\n     // Returns the most severe level of banning that applies to this address.\n     // 0 - Not banned\n-    // 1 - Automatic misbehavior ban\n+    // 1 - Discouraged because of misbehavior\n     // 2 - Any other ban\n-    int level = 0;\n     auto current_time = GetTime();\n     LOCK(m_cs_banned);\n     for (const auto& it : m_banned) {\n         CSubNet sub_net = it.first;\n         CBanEntry ban_entry = it.second;\n \n         if (current_time < ban_entry.nBanUntil && sub_net.Match(net_addr)) {\n-            if (ban_entry.banReason != BanReasonNodeMisbehaving) return 2;\n-            level = 1;\n+            return 2;\n         }\n     }\n-    return level;\n+    return m_discouraged.contains(net_addr.GetAddrBytes());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437648963",
      "id" : 437648963,
      "line" : 74,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY0ODk2Mw==",
      "original_commit_id" : "4c4df6bf61104a4946479fccc7885dc0fe05dbd8",
      "original_line" : 74,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/banman.cpp",
      "position" : 24,
      "pull_request_review_id" : 427451155,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437648963",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/620611?v=4",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "node_id" : "MDQ6VXNlcjYyMDYxMQ==",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437731526"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437731526"
         }
      },
      "author_association" : "NONE",
      "body" : "Looks like `ClearBanned()` should call `m_discouraged.reset()` otherwise the `clearbanned` RPC no longer does what users expect.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-09T21:25:12Z",
      "diff_hunk" : "@@ -45,10 +46,18 @@ class BanMan\n     BanMan(fs::path ban_file, CClientUIInterface* client_interface, int64_t default_ban_time);\n     void Ban(const CNetAddr& net_addr, const BanReason& ban_reason, int64_t ban_time_offset = 0, bool since_unix_epoch = false);\n     void Ban(const CSubNet& sub_net, const BanReason& ban_reason, int64_t ban_time_offset = 0, bool since_unix_epoch = false);\n+    void Discourage(const CNetAddr& net_addr);\n     void ClearBanned();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437731526",
      "id" : 437731526,
      "line" : 65,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzczMTUyNg==",
      "original_commit_id" : "4c4df6bf61104a4946479fccc7885dc0fe05dbd8",
      "original_line" : 65,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : 66,
      "pull_request_review_id" : 427556815,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437731526",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/602513?v=4",
         "events_url" : "https://api.github.com/users/jasonbcox/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jasonbcox/followers",
         "following_url" : "https://api.github.com/users/jasonbcox/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jasonbcox/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jasonbcox",
         "id" : 602513,
         "login" : "jasonbcox",
         "node_id" : "MDQ6VXNlcjYwMjUxMw==",
         "organizations_url" : "https://api.github.com/users/jasonbcox/orgs",
         "received_events_url" : "https://api.github.com/users/jasonbcox/received_events",
         "repos_url" : "https://api.github.com/users/jasonbcox/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jasonbcox/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jasonbcox/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jasonbcox"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437734287"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437734287"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I considered that, but I think it would be counterintuitive. Discouragement isn't exposed as bans (it's not visible or accessible in RPCs or UI) as it's a completely automatic process, so I think that exposing a way to clear it would violate that abstraction.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-09T21:31:11Z",
      "diff_hunk" : "@@ -45,10 +46,18 @@ class BanMan\n     BanMan(fs::path ban_file, CClientUIInterface* client_interface, int64_t default_ban_time);\n     void Ban(const CNetAddr& net_addr, const BanReason& ban_reason, int64_t ban_time_offset = 0, bool since_unix_epoch = false);\n     void Ban(const CSubNet& sub_net, const BanReason& ban_reason, int64_t ban_time_offset = 0, bool since_unix_epoch = false);\n+    void Discourage(const CNetAddr& net_addr);\n     void ClearBanned();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437734287",
      "id" : 437734287,
      "in_reply_to_id" : 437731526,
      "line" : 65,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzczNDI4Nw==",
      "original_commit_id" : "4c4df6bf61104a4946479fccc7885dc0fe05dbd8",
      "original_line" : 65,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : 66,
      "pull_request_review_id" : 427560239,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437734287",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437736947"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437736947"
         }
      },
      "author_association" : "NONE",
      "body" : "I see. The current implementation may introduce subtle bugs then, especially considering that `IsBanned()` is now unintuitively named. `setban \"someIP\" \"add\"` may return `Error: IP/Subnet already banned` for instance.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-09T21:37:10Z",
      "diff_hunk" : "@@ -45,10 +46,18 @@ class BanMan\n     BanMan(fs::path ban_file, CClientUIInterface* client_interface, int64_t default_ban_time);\n     void Ban(const CNetAddr& net_addr, const BanReason& ban_reason, int64_t ban_time_offset = 0, bool since_unix_epoch = false);\n     void Ban(const CSubNet& sub_net, const BanReason& ban_reason, int64_t ban_time_offset = 0, bool since_unix_epoch = false);\n+    void Discourage(const CNetAddr& net_addr);\n     void ClearBanned();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437736947",
      "id" : 437736947,
      "in_reply_to_id" : 437731526,
      "line" : 65,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzczNjk0Nw==",
      "original_commit_id" : "4c4df6bf61104a4946479fccc7885dc0fe05dbd8",
      "original_line" : 65,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : 66,
      "pull_request_review_id" : 427563645,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437736947",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/602513?v=4",
         "events_url" : "https://api.github.com/users/jasonbcox/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jasonbcox/followers",
         "following_url" : "https://api.github.com/users/jasonbcox/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jasonbcox/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jasonbcox",
         "id" : 602513,
         "login" : "jasonbcox",
         "node_id" : "MDQ6VXNlcjYwMjUxMw==",
         "organizations_url" : "https://api.github.com/users/jasonbcox/orgs",
         "received_events_url" : "https://api.github.com/users/jasonbcox/received_events",
         "repos_url" : "https://api.github.com/users/jasonbcox/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jasonbcox/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jasonbcox/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jasonbcox"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437744807"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437744807"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should this have a `GUARDED_BY(m_cs_banned)` lock annotation?",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-09T21:55:44Z",
      "diff_hunk" : "@@ -68,6 +77,7 @@ class BanMan\n     CClientUIInterface* m_client_interface = nullptr;\n     CBanDB m_ban_db;\n     const int64_t m_default_ban_time;\n+    CRollingBloomFilter m_discouraged{50000, 0.000001};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437744807",
      "id" : 437744807,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc0NDgwNw==",
      "original_commit_id" : "4c4df6bf61104a4946479fccc7885dc0fe05dbd8",
      "original_line" : 80,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : null,
      "pull_request_review_id" : 427573509,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437744807",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437772412"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437772412"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ok, added an explicit `? 1 : 0`.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-09T23:13:12Z",
      "diff_hunk" : "@@ -72,27 +72,26 @@ int BanMan::IsBannedLevel(CNetAddr net_addr)\n {\n     // Returns the most severe level of banning that applies to this address.\n     // 0 - Not banned\n-    // 1 - Automatic misbehavior ban\n+    // 1 - Discouraged because of misbehavior\n     // 2 - Any other ban\n-    int level = 0;\n     auto current_time = GetTime();\n     LOCK(m_cs_banned);\n     for (const auto& it : m_banned) {\n         CSubNet sub_net = it.first;\n         CBanEntry ban_entry = it.second;\n \n         if (current_time < ban_entry.nBanUntil && sub_net.Match(net_addr)) {\n-            if (ban_entry.banReason != BanReasonNodeMisbehaving) return 2;\n-            level = 1;\n+            return 2;\n         }\n     }\n-    return level;\n+    return m_discouraged.contains(net_addr.GetAddrBytes());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437772412",
      "id" : 437772412,
      "in_reply_to_id" : 437648963,
      "line" : 74,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc3MjQxMg==",
      "original_commit_id" : "4c4df6bf61104a4946479fccc7885dc0fe05dbd8",
      "original_line" : 74,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/banman.cpp",
      "position" : 24,
      "pull_request_review_id" : 427607249,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437772412",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437772571"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437772571"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nice catch. I've addressed it by adding a separate `IsBannedOrDiscouraged` that's distinct from `IsBanned`.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-09T23:13:40Z",
      "diff_hunk" : "@@ -45,10 +46,18 @@ class BanMan\n     BanMan(fs::path ban_file, CClientUIInterface* client_interface, int64_t default_ban_time);\n     void Ban(const CNetAddr& net_addr, const BanReason& ban_reason, int64_t ban_time_offset = 0, bool since_unix_epoch = false);\n     void Ban(const CSubNet& sub_net, const BanReason& ban_reason, int64_t ban_time_offset = 0, bool since_unix_epoch = false);\n+    void Discourage(const CNetAddr& net_addr);\n     void ClearBanned();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437772571",
      "id" : 437772571,
      "in_reply_to_id" : 437731526,
      "line" : 65,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc3MjU3MQ==",
      "original_commit_id" : "4c4df6bf61104a4946479fccc7885dc0fe05dbd8",
      "original_line" : 65,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : 66,
      "pull_request_review_id" : 427607453,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437772571",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437772648"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437772648"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-09T23:13:49Z",
      "diff_hunk" : "@@ -68,6 +77,7 @@ class BanMan\n     CClientUIInterface* m_client_interface = nullptr;\n     CBanDB m_ban_db;\n     const int64_t m_default_ban_time;\n+    CRollingBloomFilter m_discouraged{50000, 0.000001};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437772648",
      "id" : 437772648,
      "in_reply_to_id" : 437744807,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc3MjY0OA==",
      "original_commit_id" : "4c4df6bf61104a4946479fccc7885dc0fe05dbd8",
      "original_line" : 80,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : null,
      "pull_request_review_id" : 427607511,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437772648",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This seems like an improvement, but it leaves the `BanMan` with a slightly odd and inconsistent interface:\r\n\r\n- `Ban()` has an enum as its second parameter, but that parameter is only ever set to `BanReasonManuallyAdded`\r\n- If `IsBanned()` is called with an address, it returns whether an address is discouraged or banned. If it's called with a subnet, it returns if it's banned, but not discouraged.\r\n- `Unban()` won't remove a discouraged address from banman, but it's not possible to add an outbound connection to that address with `addnode onetry`.\r\n- `ClearBanned()` (which is called by the `clearban` RPC (\"Clear all banned IPs\")) doesn't clear discouraged addresses.\r\n- The `listbanned` RPC returns a `ban_reason`, which can only ever be \"manually added\". (`banReasonToString()` is basically dead code now).\r\n\r\nIt'd be nice to rationalize this so BanMan just had a setter `SetBanLevel()` function and a getter `GetBanLevel()` function.",
      "created_at" : "2020-06-10T00:08:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-641643725",
      "id" : 641643725,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MTY0MzcyNQ==",
      "updated_at" : "2020-06-10T00:08:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/641643725",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jnewbery Most of those things are no longer true, apart from the BanReason being superfluous now (there is a separate IsBannedOrDiscouraged). I think a follow-up can remove BanReason altogether, but I think it's preferable to not have a SetBanLevel - discouragement and banning are very different concepts (and it wouldn't be unreasonable to move discouragement elsewhere entirely).",
      "created_at" : "2020-06-10T00:12:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-641644913",
      "id" : 641644913,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MTY0NDkxMw==",
      "updated_at" : "2020-06-10T00:14:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/641644913",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19316 ([net] Cleanup logic around connection types by amitiuttarwar)\n* #19315 ([tests] Allow outbound & block-relay-only connections in functional tests. by amitiuttarwar)\n* #19243 (banman: Limit resources consumed by misbehaving node deprioitisation by luke-jr)\n* #19222 (tests: Add fuzzing harness for BanMan by practicalswift)\n* #19191 (net: Extract download permission from noban by MarcoFalke)\n* #19147 (Document BanMan with regards to malicious exploitation by ariard)\n* #19101 (refactor: remove ::vpwallets and related global variables by ryanofsky)\n* #19099 (refactor: Move wallet methods out of chain.h and node.h by ryanofsky)\n* #19098 (test: Remove duplicate NodeContext hacks by ryanofsky)\n* #18991 (Cache responses to GETADDR to prevent topology leaks by naumenkogs)\n* #18531 (rpc: Assert that RPCArg names are equal to CRPCCommand ones by MarcoFalke)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-06-10T01:24:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-641664852",
      "id" : 641664852,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MTY2NDg1Mg==",
      "updated_at" : "2020-07-04T16:02:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/641664852",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK.",
      "created_at" : "2020-06-10T13:13:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-641999691",
      "id" : 641999691,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MTk5OTY5MQ==",
      "updated_at" : "2020-06-10T13:13:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/641999691",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@jnewbery agreed that the interface is a little odd now but think that should be dealt with in a separate pr",
      "created_at" : "2020-06-10T18:12:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-642175291",
      "id" : 642175291,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjE3NTI5MQ==",
      "updated_at" : "2020-06-10T18:12:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642175291",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/620611?v=4",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "node_id" : "MDQ6VXNlcjYyMDYxMQ==",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "You really should add a benchmark for this..",
      "created_at" : "2020-06-10T18:56:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-642196131",
      "id" : 642196131,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjE5NjEzMQ==",
      "updated_at" : "2020-06-10T18:56:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642196131",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266627?v=4",
         "events_url" : "https://api.github.com/users/cculianu/events{/privacy}",
         "followers_url" : "https://api.github.com/users/cculianu/followers",
         "following_url" : "https://api.github.com/users/cculianu/following{/other_user}",
         "gists_url" : "https://api.github.com/users/cculianu/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/cculianu",
         "id" : 266627,
         "login" : "cculianu",
         "node_id" : "MDQ6VXNlcjI2NjYyNw==",
         "organizations_url" : "https://api.github.com/users/cculianu/orgs",
         "received_events_url" : "https://api.github.com/users/cculianu/received_events",
         "repos_url" : "https://api.github.com/users/cculianu/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/cculianu/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/cculianu/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/cculianu"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "What happens if someone floods the filter with a big block of 1 million IPv6 addresses? ",
      "created_at" : "2020-06-10T19:20:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-642207388",
      "id" : 642207388,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjIwNzM4OA==",
      "updated_at" : "2020-06-10T19:20:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642207388",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266627?v=4",
         "events_url" : "https://api.github.com/users/cculianu/events{/privacy}",
         "followers_url" : "https://api.github.com/users/cculianu/followers",
         "following_url" : "https://api.github.com/users/cculianu/following{/other_user}",
         "gists_url" : "https://api.github.com/users/cculianu/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/cculianu",
         "id" : 266627,
         "login" : "cculianu",
         "node_id" : "MDQ6VXNlcjI2NjYyNw==",
         "organizations_url" : "https://api.github.com/users/cculianu/orgs",
         "received_events_url" : "https://api.github.com/users/cculianu/received_events",
         "repos_url" : "https://api.github.com/users/cculianu/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/cculianu/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/cculianu/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/cculianu"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rolling Bloom filters only keep the last N elements added; 50000 in this case. Their performance is not affected by how many elements are kept.\n\nSo worst case, being flooded with IPs would reduce the effectiveness of the filter in keeping broken peers out.",
      "created_at" : "2020-06-10T19:33:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-642213438",
      "id" : 642213438,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjIxMzQzOA==",
      "updated_at" : "2020-06-10T19:35:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642213438",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Right, so you can flood the filter with even something like 150k inserts, saturate it to always return false positive, and then all peers are \"equally discouraged\" (meaning you have no ban policy anymore)....\r\n",
      "created_at" : "2020-06-10T19:43:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-642218185",
      "id" : 642218185,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjIxODE4NQ==",
      "updated_at" : "2020-06-10T19:43:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642218185",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266627?v=4",
         "events_url" : "https://api.github.com/users/cculianu/events{/privacy}",
         "followers_url" : "https://api.github.com/users/cculianu/followers",
         "following_url" : "https://api.github.com/users/cculianu/following{/other_user}",
         "gists_url" : "https://api.github.com/users/cculianu/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/cculianu",
         "id" : 266627,
         "login" : "cculianu",
         "node_id" : "MDQ6VXNlcjI2NjYyNw==",
         "organizations_url" : "https://api.github.com/users/cculianu/orgs",
         "received_events_url" : "https://api.github.com/users/cculianu/received_events",
         "repos_url" : "https://api.github.com/users/cculianu/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/cculianu/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/cculianu/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/cculianu"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "No, the false positive rate never goes above the specified one (0.000001 in this case). The rolling aspect discards old entries.",
      "created_at" : "2020-06-10T19:45:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-642219432",
      "id" : 642219432,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjIxOTQzMg==",
      "updated_at" : "2020-06-10T19:45:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642219432",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@cculianu - I suggest you take a look at the `CRollingBloomFilter` implementation. The rolling bloom filter is actually multiple generations of bloom filters, so you can't saturate it by adding many entries. It'll just discard the oldest generation when it reaches (max entries * 3/2).",
      "created_at" : "2020-06-10T19:47:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-642220132",
      "id" : 642220132,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjIyMDEzMg==",
      "updated_at" : "2020-06-10T19:47:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642220132",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Indeed, thanks for the explanation.",
      "created_at" : "2020-06-10T20:20:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-642235845",
      "id" : 642235845,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjIzNTg0NQ==",
      "updated_at" : "2020-06-10T20:20:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642235845",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266627?v=4",
         "events_url" : "https://api.github.com/users/cculianu/events{/privacy}",
         "followers_url" : "https://api.github.com/users/cculianu/followers",
         "following_url" : "https://api.github.com/users/cculianu/following{/other_user}",
         "gists_url" : "https://api.github.com/users/cculianu/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/cculianu",
         "id" : 266627,
         "login" : "cculianu",
         "node_id" : "MDQ6VXNlcjI2NjYyNw==",
         "organizations_url" : "https://api.github.com/users/cculianu/orgs",
         "received_events_url" : "https://api.github.com/users/cculianu/received_events",
         "repos_url" : "https://api.github.com/users/cculianu/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/cculianu/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/cculianu/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/cculianu"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Ok, so basically:\r\n\r\n- this is as if you had a typical hash table implementation clamped to 75k most recent entries\r\n- but it has no ability to unban\r\n- it only eats about 67k memory\r\n- small tiny chance of false positives.\r\n- slightly slower insertions and lookups than a hash table, but not monstrously so.\r\n\r\nGot it.  Thanks.\r\n",
      "created_at" : "2020-06-10T20:39:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-642245289",
      "id" : 642245289,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjI0NTI4OQ==",
      "updated_at" : "2020-06-10T20:39:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642245289",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266627?v=4",
         "events_url" : "https://api.github.com/users/cculianu/events{/privacy}",
         "followers_url" : "https://api.github.com/users/cculianu/followers",
         "following_url" : "https://api.github.com/users/cculianu/following{/other_user}",
         "gists_url" : "https://api.github.com/users/cculianu/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/cculianu",
         "id" : 266627,
         "login" : "cculianu",
         "node_id" : "MDQ6VXNlcjI2NjYyNw==",
         "organizations_url" : "https://api.github.com/users/cculianu/orgs",
         "received_events_url" : "https://api.github.com/users/cculianu/received_events",
         "repos_url" : "https://api.github.com/users/cculianu/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/cculianu/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/cculianu/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/cculianu"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@cculianu Indeed. Your numbers are a bit off: it only guarantees 50000 entries (it keeps up to 75000, but the last 25000 are removed whenever that number is exceeded). It also uses around 528 KiB (at an fprate of 1/1000000).",
      "created_at" : "2020-06-10T20:44:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-642247743",
      "id" : 642247743,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjI0Nzc0Mw==",
      "updated_at" : "2020-06-10T20:44:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642247743",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Oh right.. it's 67k uint64's -> 528KiB.  My bad.\r\n\r\nHmm.  For ~800KiB you could have just implemented a regular hash table (std::unordered_map, etc) or a std::unordered_set, clamped it to 50k items, and then had the ability to query it, iterate over it, show it in the UI, and/or remove individual items.\r\n",
      "created_at" : "2020-06-10T20:49:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-642250414",
      "id" : 642250414,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjI1MDQxNA==",
      "updated_at" : "2020-06-10T20:49:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642250414",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266627?v=4",
         "events_url" : "https://api.github.com/users/cculianu/events{/privacy}",
         "followers_url" : "https://api.github.com/users/cculianu/followers",
         "following_url" : "https://api.github.com/users/cculianu/following{/other_user}",
         "gists_url" : "https://api.github.com/users/cculianu/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/cculianu",
         "id" : 266627,
         "login" : "cculianu",
         "node_id" : "MDQ6VXNlcjI2NjYyNw==",
         "organizations_url" : "https://api.github.com/users/cculianu/orgs",
         "received_events_url" : "https://api.github.com/users/cculianu/received_events",
         "repos_url" : "https://api.github.com/users/cculianu/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/cculianu/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/cculianu/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/cculianu"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@cculianu Yeah, we do have a limitedmap data structure that implements effectively that. Its memory usage is significantly worse though (because every entry in the map needs several pointers, plus dynamic allocation overhead). If I recall the number correctly it would be 4 MiB at least for 50000 entries.",
      "created_at" : "2020-06-10T20:53:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-642252444",
      "id" : 642252444,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjI1MjQ0NA==",
      "updated_at" : "2020-06-10T20:53:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642252444",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I'm aware of that data structure but it's not a hash table, it's a red-black tree based map, which also stores a reverse-map as well.  It's not very efficient for this situation...\r\n\r\nYou can probably get away with just a straight hash table (unordered_map) with some wrapper that periodically sweeps it to clamp it to some max size -- probably just remove the oldest entries by creation time.  While not ideal, it has some advantages -- namely being able to remove from the set... and blazing fast lookups.  \r\n\r\nI guess it's your call -- you either pay the memory and upkeep costs and preserve the facility of a traditional ban list and save a few cycles on lookups -- or you toss that aside and maintain a bloom set and redefine the semantics of banning (which is already happening anyway)...",
      "created_at" : "2020-06-10T21:33:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-642279750",
      "id" : 642279750,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjI3OTc1MA==",
      "updated_at" : "2020-06-10T21:33:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642279750",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266627?v=4",
         "events_url" : "https://api.github.com/users/cculianu/events{/privacy}",
         "followers_url" : "https://api.github.com/users/cculianu/followers",
         "following_url" : "https://api.github.com/users/cculianu/following{/other_user}",
         "gists_url" : "https://api.github.com/users/cculianu/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/cculianu",
         "id" : 266627,
         "login" : "cculianu",
         "node_id" : "MDQ6VXNlcjI2NjYyNw==",
         "organizations_url" : "https://api.github.com/users/cculianu/orgs",
         "received_events_url" : "https://api.github.com/users/cculianu/received_events",
         "repos_url" : "https://api.github.com/users/cculianu/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/cculianu/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/cculianu/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/cculianu"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Hash table or red-black tree doesn't matter much. It's (table size + 2 pointers + alloc overhead per entry) or (3 pointers + 1 int + alloc overhead per entry), and in both cases you need a way to iterate efficiently in order of insertion (either through a separate map like limitedmap does, or by doubly-linking the elements together like is supported by boost::multi_index). Even if you don't do that and just occasionally sweep, you need to keep track of insertion time per item, and the allocation overheads don't go away.\r\n\r\nIn either case, the overhead is much larger than a rolling bloom filter, and as you say - changes to the semantics of auto banned items are happening anyway.",
      "created_at" : "2020-06-10T21:38:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-642281599",
      "id" : 642281599,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjI4MTU5OQ==",
      "updated_at" : "2020-06-10T21:39:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642281599",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ACK 4131caf2431054adf9ad6641386dfbe922af0dc5",
      "created_at" : "2020-06-10T23:51:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-642324926",
      "id" : 642324926,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjMyNDkyNg==",
      "updated_at" : "2020-06-10T23:51:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642324926",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/620611?v=4",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "node_id" : "MDQ6VXNlcjYyMDYxMQ==",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've made a few changes suggested by @jnewbery. The PR is now split into two commits:\r\n* The first is a minimal change that implements the new behavior (smaller than the previous PR), plus release notes and RPC documentation changes.\r\n* The seconds makes the distinction between discouraging and banning much cleaner in the interface, removing BanReason altogether.\r\n\r\nI'm happy to split off the second commit. It could also be ignored in backports.",
      "created_at" : "2020-06-11T00:52:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-642341655",
      "id" : 642341655,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjM0MTY1NQ==",
      "updated_at" : "2020-06-11T00:52:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642341655",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r438537628"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438537628"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Since they're not really bans, let's not call them bans in docs?",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-11T04:35:31Z",
      "diff_hunk" : "@@ -0,0 +1,20 @@\n+#### Change in automatic banning\n+\n+Automatic banning of peers for bad behavior has been slightly altered:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r438537628",
      "id" : 438537628,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODUzNzYyOA==",
      "original_commit_id" : "b6a3448435678b945a89275993c3f51c7215ec09",
      "original_line" : 3,
      "original_position" : 3,
      "original_start_line" : null,
      "path" : "doc/release-notes-19219.md",
      "position" : null,
      "pull_request_review_id" : 428586267,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438537628",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r438554928"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438554928"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "maybe this should me two checks so the log can indicate ban/discouraged",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-11T05:45:13Z",
      "diff_hunk" : "@@ -1010,11 +1010,12 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n     // on all platforms.  Set it again here just to be sure.\n     SetSocketNoDelay(hSocket);\n \n-    int bannedlevel = m_banman ? m_banman->IsBannedLevel(addr) : 0;\n+    bool discouraged = m_banman && m_banman->IsDiscouraged(addr);\n+    bool banned = m_banman && m_banman->IsBanned(addr);\n \n     // Don't accept connections from banned peers, but if our inbound slots aren't almost full, accept\n     // if the only banning reason was an automatic misbehavior ban.\n-    if (!NetPermissions::HasFlag(permissionFlags, NetPermissionFlags::PF_NOBAN) && bannedlevel > ((nInbound + 1 < nMaxInbound) ? 1 : 0))\n+    if (!NetPermissions::HasFlag(permissionFlags, NetPermissionFlags::PF_NOBAN) && (banned || (discouraged && nInbound + 1 < nMaxInbound)))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r438554928",
      "id" : 438554928,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU1NDkyOA==",
      "original_commit_id" : "0778faa584871010c82db84c9d54d1353a91a37c",
      "original_line" : 1018,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 428607594,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438554928",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/620611?v=4",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "node_id" : "MDQ6VXNlcjYyMDYxMQ==",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ACK 0778faa584871010c82db84c9d54d1353a91a37c",
      "created_at" : "2020-06-11T06:00:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-642427063",
      "id" : 642427063,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjQyNzA2Mw==",
      "updated_at" : "2020-06-11T06:00:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642427063",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/620611?v=4",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "node_id" : "MDQ6VXNlcjYyMDYxMQ==",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r438711333"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438711333"
         }
      },
      "author_association" : "MEMBER",
      "body" : "b6a34484 nit: omit \"that\"",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-11T11:13:57Z",
      "diff_hunk" : "@@ -68,6 +77,17 @@ class BanMan\n     CClientUIInterface* m_client_interface = nullptr;\n     CBanDB m_ban_db;\n     const int64_t m_default_ban_time;\n+\n+    /** Individual addresses that of peers that misbehave (see Misbehaving() in",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r438711333",
      "id" : 438711333,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODcxMTMzMw==",
      "original_commit_id" : "0778faa584871010c82db84c9d54d1353a91a37c",
      "original_line" : 81,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : null,
      "pull_request_review_id" : 428813005,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438711333",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r438711751"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438711751"
         }
      },
      "author_association" : "MEMBER",
      "body" : "b6a34484 For my understanding, \"rumour\" == gossip?",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-11T11:14:58Z",
      "diff_hunk" : "@@ -68,6 +77,17 @@ class BanMan\n     CClientUIInterface* m_client_interface = nullptr;\n     CBanDB m_ban_db;\n     const int64_t m_default_ban_time;\n+\n+    /** Individual addresses that of peers that misbehave (see Misbehaving() in\n+     *  net_processing) are not banned but discouraged: we still allow incoming\n+     *  connections from them, but prefer them for eviction. Similar to banned\n+     *  IPs, we never make outgoing connections to them, and do not rumour them",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r438711751",
      "id" : 438711751,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODcxMTc1MQ==",
      "original_commit_id" : "0778faa584871010c82db84c9d54d1353a91a37c",
      "original_line" : 84,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : null,
      "pull_request_review_id" : 428813005,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438711751",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r438717008"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438717008"
         }
      },
      "author_association" : "MEMBER",
      "body" : "b6a34484 Should also remove `ban_reason` from the help at line 650, I believe, and update the release notes that this has been removed from `listbanned`.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-11T11:26:21Z",
      "diff_hunk" : "@@ -671,7 +672,6 @@ static UniValue listbanned(const JSONRPCRequest& request)\n         rec.pushKV(\"address\", entry.first.ToString());\n         rec.pushKV(\"banned_until\", banEntry.nBanUntil);\n         rec.pushKV(\"ban_created\", banEntry.nCreateTime);\n-        rec.pushKV(\"ban_reason\", banEntry.banReasonToString());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r438717008",
      "id" : 438717008,
      "line" : 674,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODcxNzAwOA==",
      "original_commit_id" : "0778faa584871010c82db84c9d54d1353a91a37c",
      "original_line" : 674,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : 45,
      "pull_request_review_id" : 428813005,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438717008",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r438741761"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438741761"
         }
      },
      "author_association" : "MEMBER",
      "body" : "0778faa perhaps update the code doc\r\n```diff\r\n-    // Don't accept connections from banned peers, but if our inbound slots aren't almost full, accept\r\n-    // if the only banning reason was an automatic misbehavior ban.\r\n+    // Don't accept connections from banned peers, nor from discouraged peers if\r\n+    // our inbound slots are almost full.\r\n```",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-11T12:20:17Z",
      "diff_hunk" : "@@ -1010,11 +1010,12 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n     // on all platforms.  Set it again here just to be sure.\n     SetSocketNoDelay(hSocket);\n \n-    int bannedlevel = m_banman ? m_banman->IsBannedLevel(addr) : 0;\n+    bool discouraged = m_banman && m_banman->IsDiscouraged(addr);\n+    bool banned = m_banman && m_banman->IsBanned(addr);\n \n     // Don't accept connections from banned peers, but if our inbound slots aren't almost full, accept\n     // if the only banning reason was an automatic misbehavior ban.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r438741761",
      "id" : 438741761,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc0MTc2MQ==",
      "original_commit_id" : "0778faa584871010c82db84c9d54d1353a91a37c",
      "original_line" : 1017,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 428853272,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438741761",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r438752687"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438752687"
         }
      },
      "author_association" : "MEMBER",
      "body" : "0778faa5\r\nFor determining if the inbounds are nearly full, should the comparison operator be reversed?\r\n```diff\r\n- (banned || (discouraged && nInbound + 1 < nMaxInbound)))\r\n+ (banned || (nInbound + 1 >= nMaxInbound && discouraged)))\r\n```",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-11T12:41:37Z",
      "diff_hunk" : "@@ -1010,11 +1010,12 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n     // on all platforms.  Set it again here just to be sure.\n     SetSocketNoDelay(hSocket);\n \n-    int bannedlevel = m_banman ? m_banman->IsBannedLevel(addr) : 0;\n+    bool discouraged = m_banman && m_banman->IsDiscouraged(addr);\n+    bool banned = m_banman && m_banman->IsBanned(addr);\n \n     // Don't accept connections from banned peers, but if our inbound slots aren't almost full, accept\n     // if the only banning reason was an automatic misbehavior ban.\n-    if (!NetPermissions::HasFlag(permissionFlags, NetPermissionFlags::PF_NOBAN) && bannedlevel > ((nInbound + 1 < nMaxInbound) ? 1 : 0))\n+    if (!NetPermissions::HasFlag(permissionFlags, NetPermissionFlags::PF_NOBAN) && (banned || (discouraged && nInbound + 1 < nMaxInbound)))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r438752687",
      "id" : 438752687,
      "in_reply_to_id" : 438554928,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc1MjY4Nw==",
      "original_commit_id" : "0778faa584871010c82db84c9d54d1353a91a37c",
      "original_line" : 1018,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 428853272,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438752687",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r439052719"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439052719"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think it would be useful to have a way to clear only the misbehaving filter, but perhaps that is best left for a followup PR.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-11T20:27:00Z",
      "diff_hunk" : "@@ -0,0 +1,20 @@\n+#### Change in automatic banning\n+\n+Automatic banning of peers for bad behavior has been slightly altered:\n+\n+- automatic bans will no longer time out automatically after 24 hours.\n+  Depending on traffic from other peers, automatic bans may time out at an\n+  indeterminate time.\n+\n+- automatic bans will no longer be persisted over restarts. Only manual bans\n+  will be persisted.\n+\n+- automatic bans will no longer be returned by the `listbanned` RPC.\n+\n+- automatic bans can no longer be lifted with the `setban remove` RPC command.\n+  If you need to remove an automatic ban, you can clear all bans (including\n+  manual bans) with the `clearbanned` RPC, or stop-start to clear automatic bans.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r439052719",
      "id" : 439052719,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTA1MjcxOQ==",
      "original_commit_id" : "0778faa584871010c82db84c9d54d1353a91a37c",
      "original_line" : 16,
      "original_position" : 16,
      "original_start_line" : 15,
      "path" : "doc/release-notes-19219.md",
      "position" : null,
      "pull_request_review_id" : 429265081,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439052719",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "There are quite a few places where comments/names/logs are now out of date. Commit here: https://github.com/jnewbery/bitcoin/tree/pr19219.2 gets most of them I think.",
      "created_at" : "2020-06-11T21:26:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-642935950",
      "id" : 642935950,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjkzNTk1MA==",
      "updated_at" : "2020-06-11T21:26:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642935950",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r441975010"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441975010"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this is improved now with @jnewbery's changes.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-18T05:24:01Z",
      "diff_hunk" : "@@ -0,0 +1,20 @@\n+#### Change in automatic banning\n+\n+Automatic banning of peers for bad behavior has been slightly altered:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r441975010",
      "id" : 441975010,
      "in_reply_to_id" : 438537628,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTk3NTAxMA==",
      "original_commit_id" : "b6a3448435678b945a89275993c3f51c7215ec09",
      "original_line" : 3,
      "original_position" : 3,
      "original_start_line" : null,
      "path" : "doc/release-notes-19219.md",
      "position" : null,
      "pull_request_review_id" : 432949170,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441975010",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r441975184"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441975184"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This has been rewritten following a suggestion by @pstratem below.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-18T05:24:47Z",
      "diff_hunk" : "@@ -1010,11 +1010,12 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n     // on all platforms.  Set it again here just to be sure.\n     SetSocketNoDelay(hSocket);\n \n-    int bannedlevel = m_banman ? m_banman->IsBannedLevel(addr) : 0;\n+    bool discouraged = m_banman && m_banman->IsDiscouraged(addr);\n+    bool banned = m_banman && m_banman->IsBanned(addr);\n \n     // Don't accept connections from banned peers, but if our inbound slots aren't almost full, accept\n     // if the only banning reason was an automatic misbehavior ban.\n-    if (!NetPermissions::HasFlag(permissionFlags, NetPermissionFlags::PF_NOBAN) && bannedlevel > ((nInbound + 1 < nMaxInbound) ? 1 : 0))\n+    if (!NetPermissions::HasFlag(permissionFlags, NetPermissionFlags::PF_NOBAN) && (banned || (discouraged && nInbound + 1 < nMaxInbound)))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r441975184",
      "id" : 441975184,
      "in_reply_to_id" : 438554928,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTk3NTE4NA==",
      "original_commit_id" : "0778faa584871010c82db84c9d54d1353a91a37c",
      "original_line" : 1018,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 432949428,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441975184",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r441975459"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441975459"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is gone.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-18T05:25:25Z",
      "diff_hunk" : "@@ -68,6 +77,17 @@ class BanMan\n     CClientUIInterface* m_client_interface = nullptr;\n     CBanDB m_ban_db;\n     const int64_t m_default_ban_time;\n+\n+    /** Individual addresses that of peers that misbehave (see Misbehaving() in",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r441975459",
      "id" : 441975459,
      "in_reply_to_id" : 438711333,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTk3NTQ1OQ==",
      "original_commit_id" : "0778faa584871010c82db84c9d54d1353a91a37c",
      "original_line" : 81,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : null,
      "pull_request_review_id" : 432949636,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441975459",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r441975507"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441975507"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is gone.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-18T05:25:35Z",
      "diff_hunk" : "@@ -68,6 +77,17 @@ class BanMan\n     CClientUIInterface* m_client_interface = nullptr;\n     CBanDB m_ban_db;\n     const int64_t m_default_ban_time;\n+\n+    /** Individual addresses that of peers that misbehave (see Misbehaving() in\n+     *  net_processing) are not banned but discouraged: we still allow incoming\n+     *  connections from them, but prefer them for eviction. Similar to banned\n+     *  IPs, we never make outgoing connections to them, and do not rumour them",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r441975507",
      "id" : 441975507,
      "in_reply_to_id" : 438711751,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTk3NTUwNw==",
      "original_commit_id" : "0778faa584871010c82db84c9d54d1353a91a37c",
      "original_line" : 84,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : null,
      "pull_request_review_id" : 432949694,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441975507",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r441975555"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441975555"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-18T05:25:44Z",
      "diff_hunk" : "@@ -671,7 +672,6 @@ static UniValue listbanned(const JSONRPCRequest& request)\n         rec.pushKV(\"address\", entry.first.ToString());\n         rec.pushKV(\"banned_until\", banEntry.nBanUntil);\n         rec.pushKV(\"ban_created\", banEntry.nCreateTime);\n-        rec.pushKV(\"ban_reason\", banEntry.banReasonToString());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r441975555",
      "id" : 441975555,
      "in_reply_to_id" : 438717008,
      "line" : 674,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTk3NTU1NQ==",
      "original_commit_id" : "0778faa584871010c82db84c9d54d1353a91a37c",
      "original_line" : 674,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : 45,
      "pull_request_review_id" : 432949747,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441975555",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r441975668"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441975668"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This has been split up, so I don't think this applies anymore.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-18T05:26:11Z",
      "diff_hunk" : "@@ -1010,11 +1010,12 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n     // on all platforms.  Set it again here just to be sure.\n     SetSocketNoDelay(hSocket);\n \n-    int bannedlevel = m_banman ? m_banman->IsBannedLevel(addr) : 0;\n+    bool discouraged = m_banman && m_banman->IsDiscouraged(addr);\n+    bool banned = m_banman && m_banman->IsBanned(addr);\n \n     // Don't accept connections from banned peers, but if our inbound slots aren't almost full, accept\n     // if the only banning reason was an automatic misbehavior ban.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r441975668",
      "id" : 441975668,
      "in_reply_to_id" : 438741761,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTk3NTY2OA==",
      "original_commit_id" : "0778faa584871010c82db84c9d54d1353a91a37c",
      "original_line" : 1017,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 432949912,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441975668",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r441975725"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441975725"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Agree.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-18T05:26:22Z",
      "diff_hunk" : "@@ -0,0 +1,20 @@\n+#### Change in automatic banning\n+\n+Automatic banning of peers for bad behavior has been slightly altered:\n+\n+- automatic bans will no longer time out automatically after 24 hours.\n+  Depending on traffic from other peers, automatic bans may time out at an\n+  indeterminate time.\n+\n+- automatic bans will no longer be persisted over restarts. Only manual bans\n+  will be persisted.\n+\n+- automatic bans will no longer be returned by the `listbanned` RPC.\n+\n+- automatic bans can no longer be lifted with the `setban remove` RPC command.\n+  If you need to remove an automatic ban, you can clear all bans (including\n+  manual bans) with the `clearbanned` RPC, or stop-start to clear automatic bans.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r441975725",
      "id" : 441975725,
      "in_reply_to_id" : 439052719,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTk3NTcyNQ==",
      "original_commit_id" : "0778faa584871010c82db84c9d54d1353a91a37c",
      "original_line" : 16,
      "original_position" : 16,
      "original_start_line" : 15,
      "path" : "doc/release-notes-19219.md",
      "position" : null,
      "pull_request_review_id" : 432949974,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441975725",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jnewbery I've incorporated most of the changes from your branch (split out over both commits).\r\n\r\nI dropped the PF_NOBAN -> PF_NODISCOURAGE change, because that capability also protects against bans.",
      "created_at" : "2020-06-18T05:28:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-645782691",
      "id" : 645782691,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NTc4MjY5MQ==",
      "updated_at" : "2020-06-18T16:12:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/645782691",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442407361"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442407361"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Note for reviewers: this means that if any peers are discouraged at the time that the node was last shut down pre-upgrade, they'll be loaded as banned post-upgrade. They'll clear automatically after 24 hours, so I think this is ok.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-18T18:02:21Z",
      "diff_hunk" : "@@ -44,31 +36,17 @@ class CBanEntry\n         nCreateTime = nCreateTimeIn;\n     }\n \n-    explicit CBanEntry(int64_t n_create_time_in, BanReason ban_reason_in) : CBanEntry(n_create_time_in)\n+    SERIALIZE_METHODS(CBanEntry, obj)\n     {\n-        banReason = ban_reason_in;\n+        uint8_t ban_reason = 2; //! For backward compatibility\n+        READWRITE(obj.nVersion, obj.nCreateTime, obj.nBanUntil, ban_reason);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442407361",
      "id" : 442407361,
      "line" : 42,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQwNzM2MQ==",
      "original_commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "original_line" : 42,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/addrdb.h",
      "position" : 31,
      "pull_request_review_id" : 433523837,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442407361",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442410269"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442410269"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It should be very straightforward to unify the `Ban()` public functions and `IsBanned()` public functions so that the caller always passes in a (possibly /32) subnet. That would actually make the calling code in `setban` simpler.\r\n\r\nThis is out of scope for this PR, but could be done in a follow-up.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-18T18:07:35Z",
      "diff_hunk" : "@@ -23,32 +24,55 @@ class CClientUIInterface;\n class CNetAddr;\n class CSubNet;\n \n-// Denial-of-service detection/prevention\n-// The idea is to detect peers that are behaving\n-// badly and disconnect/ban them, but do it in a\n-// one-coding-mistake-won't-shatter-the-entire-network\n-// way.\n-// IMPORTANT:  There should be nothing I can give a\n-// node that it will forward on that will make that\n-// node's peers drop it. If there is, an attacker\n-// can isolate a node and/or try to split the network.\n-// Dropping a node for sending stuff that is invalid\n-// now but might be valid in a later version is also\n-// dangerous, because it can cause a network split\n-// between nodes running old code and nodes running\n-// new code.\n+// Banman manages two related but distinct concepts:\n+//\n+// 1. Banning. This is configured manually by the user, through the setban RPC.\n+// If an address or subnet is banned, we never accept incoming connections from\n+// it and never create outgoing connections to it. We won't gossip its address\n+// to other peers in addr messages. Banned addresses and subets are stored to\n+// banlist.dat on shutdown and reloaded on startup. Banning can be used to\n+// prevent connections with spy nodes or other griefers.\n+//\n+// 2. Discouragement. If a peer misbehaves enough (see Misbehaving()) in\n+// net_processing.cpp, we'll mark that address as discouraged. We still allow\n+// incoming connections from them, but they're preferred for eviction when\n+// we receive new incoming connections. We never make outgoing connections to\n+// them, and do not gossip their address to other peers. This is implemented as\n+// a bloom filter. We can (probabilistically) test for membership, but can't\n+// list all discouraged addresses or unmark them as discouraged. Discouragement\n+// can prevent our limited connection slots being used up by incompatible\n+// or broken peers.\n+//\n+// Neither banning nor discouragement are protections against denial-of-service\n+// attacks, since if an attacker has a way to waste our resources and we\n+// disconnect from them and ban that address, it's trivial for them to\n+// reconnect from another IP address.\n+//\n+// Attempting to automatically disconnect or ban any class of peer carries the\n+// risk of splitting the network. For example, if we banned/disconnected for a\n+// transaction that fails a policy check and a future version changes the\n+// policy check so the transaction is accepted, then that transaction could\n+// cause the network to split between old nodes and new nodes.\n \n class BanMan\n {\n public:\n     ~BanMan();\n     BanMan(fs::path ban_file, CClientUIInterface* client_interface, int64_t default_ban_time);\n-    void Ban(const CNetAddr& net_addr, const BanReason& ban_reason, int64_t ban_time_offset = 0, bool since_unix_epoch = false);\n-    void Ban(const CSubNet& sub_net, const BanReason& ban_reason, int64_t ban_time_offset = 0, bool since_unix_epoch = false);\n+    void Ban(const CNetAddr& net_addr, int64_t ban_time_offset = 0, bool since_unix_epoch = false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442410269",
      "id" : 442410269,
      "line" : 62,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQxMDI2OQ==",
      "original_commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "original_line" : 62,
      "original_position" : 63,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : 63,
      "pull_request_review_id" : 433523837,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442410269",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442411846"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442411846"
         }
      },
      "author_association" : "MEMBER",
      "body" : "or'ing with `banned` is confusing here. After this PR, banning and discouraging are totally separated concepts, but this code signals that discouraging is a superset of banning.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-18T18:10:28Z",
      "diff_hunk" : "@@ -1010,17 +1010,25 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n     // on all platforms.  Set it again here just to be sure.\n     SetSocketNoDelay(hSocket);\n \n-    int bannedlevel = m_banman ? m_banman->IsBannedLevel(addr) : 0;\n+    bool banned = m_banman->IsBanned(addr);\n+    bool discouraged = banned || m_banman->IsDiscouraged(addr);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442411846",
      "id" : 442411846,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQxMTg0Ng==",
      "original_commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "original_line" : 1014,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 433523837,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442411846",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442415282"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442415282"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This would be easier to read if `(m_banman .... )` conditional was on its own line, so it's easier to see that the `||` within that conditional is not at the top level.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-18T18:16:52Z",
      "diff_hunk" : "@@ -2046,7 +2054,7 @@ void CConnman::OpenNetworkConnection(const CAddress& addrConnect, bool fCountFai\n     }\n     if (!pszDest) {\n         if (IsLocal(addrConnect) ||\n-            FindNode(static_cast<CNetAddr>(addrConnect)) || (m_banman && m_banman->IsBanned(addrConnect)) ||\n+            FindNode(static_cast<CNetAddr>(addrConnect)) || (m_banman && (m_banman->IsDiscouraged(addrConnect) || m_banman->IsBanned(addrConnect))) ||",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442415282",
      "id" : 442415282,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQxNTI4Mg==",
      "original_commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "original_line" : 2057,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 433523837,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442415282",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442417041"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442417041"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You added logging here in the first commit and then (accidentally, I think) removed it in the second.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-18T18:20:03Z",
      "diff_hunk" : "@@ -3559,25 +3560,25 @@ bool ProcessMessage(CNode& pfrom, const std::string& msg_type, CDataStream& vRec\n     return true;\n }\n \n-bool PeerLogicValidation::CheckIfBanned(CNode& pnode)\n+bool PeerLogicValidation::CheckIfShouldDiscourage(CNode& pnode)\n {\n     AssertLockHeld(cs_main);\n     CNodeState &state = *State(pnode.GetId());\n \n-    if (state.fShouldBan) {\n-        state.fShouldBan = false;\n+    if (state.m_should_discourage) {\n+        state.m_should_discourage = false;\n         if (pnode.HasPermission(PF_NOBAN))\n             LogPrintf(\"Warning: not punishing whitelisted peer %s!\\n\", pnode.addr.ToString());\n         else if (pnode.m_manual_connection)\n             LogPrintf(\"Warning: not punishing manually-connected peer %s!\\n\", pnode.addr.ToString());\n         else if (pnode.addr.IsLocal()) {\n-            // Disconnect but don't ban _this_ local node\n-            LogPrintf(\"Warning: disconnecting but not banning local peer %s!\\n\", pnode.addr.ToString());\n+            // Disconnect but don't discourage this local node\n+            LogPrintf(\"Warning: disconnecting but not discouraging local peer %s!\\n\", pnode.addr.ToString());\n             pnode.fDisconnect = true;\n         } else {\n-            // Disconnect and ban all nodes sharing the address\n+            // Disconnect and discourage all nodes sharing the address",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442417041",
      "id" : 442417041,
      "line" : 3584,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQxNzA0MQ==",
      "original_commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "original_line" : 3584,
      "original_position" : 137,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 140,
      "pull_request_review_id" : 433523837,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442417041",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442423477"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442423477"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: the parens are in the wrong place - this should say \"(see Misbehaving() in net_processing.cpp)\r\n\r\nSorry, this is my fault!",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-18T18:31:55Z",
      "diff_hunk" : "@@ -23,32 +24,55 @@ class CClientUIInterface;\n class CNetAddr;\n class CSubNet;\n \n-// Denial-of-service detection/prevention\n-// The idea is to detect peers that are behaving\n-// badly and disconnect/ban them, but do it in a\n-// one-coding-mistake-won't-shatter-the-entire-network\n-// way.\n-// IMPORTANT:  There should be nothing I can give a\n-// node that it will forward on that will make that\n-// node's peers drop it. If there is, an attacker\n-// can isolate a node and/or try to split the network.\n-// Dropping a node for sending stuff that is invalid\n-// now but might be valid in a later version is also\n-// dangerous, because it can cause a network split\n-// between nodes running old code and nodes running\n-// new code.\n+// Banman manages two related but distinct concepts:\n+//\n+// 1. Banning. This is configured manually by the user, through the setban RPC.\n+// If an address or subnet is banned, we never accept incoming connections from\n+// it and never create outgoing connections to it. We won't gossip its address\n+// to other peers in addr messages. Banned addresses and subets are stored to\n+// banlist.dat on shutdown and reloaded on startup. Banning can be used to\n+// prevent connections with spy nodes or other griefers.\n+//\n+// 2. Discouragement. If a peer misbehaves enough (see Misbehaving()) in",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442423477",
      "id" : 442423477,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQyMzQ3Nw==",
      "original_commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "original_line" : 36,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : null,
      "pull_request_review_id" : 433523837,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442423477",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442424037"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442424037"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This line should be removed (sorry - this was from my branch when I was referring to automatic banning)",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-18T18:32:56Z",
      "diff_hunk" : "@@ -556,7 +556,8 @@ static UniValue getnetworkinfo(const JSONRPCRequest& request)\n static UniValue setban(const JSONRPCRequest& request)\n {\n     const RPCHelpMan help{\"setban\",\n-                \"\\nAttempts to add or remove an IP/Subnet from the banned list.\\n\",\n+                \"\\nAttempts to add or remove an IP/Subnet from the banned list.\\n\"\n+                \"Peers that are automatically banned cannot be unbanned.\\n\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442424037",
      "id" : 442424037,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQyNDAzNw==",
      "original_commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "original_line" : 560,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 433523837,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442424037",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442447314"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442447314"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I was trying to avoid a call to IsDiscouraged if the peer is already banned. I moved it to accomplish something similar. I think it's clearer now.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-18T19:17:17Z",
      "diff_hunk" : "@@ -1010,17 +1010,25 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n     // on all platforms.  Set it again here just to be sure.\n     SetSocketNoDelay(hSocket);\n \n-    int bannedlevel = m_banman ? m_banman->IsBannedLevel(addr) : 0;\n+    bool banned = m_banman->IsBanned(addr);\n+    bool discouraged = banned || m_banman->IsDiscouraged(addr);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442447314",
      "id" : 442447314,
      "in_reply_to_id" : 442411846,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ0NzMxNA==",
      "original_commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "original_line" : 1014,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 433575757,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442447314",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442447464"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442447464"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-18T19:17:36Z",
      "diff_hunk" : "@@ -2046,7 +2054,7 @@ void CConnman::OpenNetworkConnection(const CAddress& addrConnect, bool fCountFai\n     }\n     if (!pszDest) {\n         if (IsLocal(addrConnect) ||\n-            FindNode(static_cast<CNetAddr>(addrConnect)) || (m_banman && m_banman->IsBanned(addrConnect)) ||\n+            FindNode(static_cast<CNetAddr>(addrConnect)) || (m_banman && (m_banman->IsDiscouraged(addrConnect) || m_banman->IsBanned(addrConnect))) ||",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442447464",
      "id" : 442447464,
      "in_reply_to_id" : 442415282,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ0NzQ2NA==",
      "original_commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "original_line" : 2057,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 433575942,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442447464",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442447535"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442447535"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-18T19:17:44Z",
      "diff_hunk" : "@@ -23,32 +24,55 @@ class CClientUIInterface;\n class CNetAddr;\n class CSubNet;\n \n-// Denial-of-service detection/prevention\n-// The idea is to detect peers that are behaving\n-// badly and disconnect/ban them, but do it in a\n-// one-coding-mistake-won't-shatter-the-entire-network\n-// way.\n-// IMPORTANT:  There should be nothing I can give a\n-// node that it will forward on that will make that\n-// node's peers drop it. If there is, an attacker\n-// can isolate a node and/or try to split the network.\n-// Dropping a node for sending stuff that is invalid\n-// now but might be valid in a later version is also\n-// dangerous, because it can cause a network split\n-// between nodes running old code and nodes running\n-// new code.\n+// Banman manages two related but distinct concepts:\n+//\n+// 1. Banning. This is configured manually by the user, through the setban RPC.\n+// If an address or subnet is banned, we never accept incoming connections from\n+// it and never create outgoing connections to it. We won't gossip its address\n+// to other peers in addr messages. Banned addresses and subets are stored to\n+// banlist.dat on shutdown and reloaded on startup. Banning can be used to\n+// prevent connections with spy nodes or other griefers.\n+//\n+// 2. Discouragement. If a peer misbehaves enough (see Misbehaving()) in",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442447535",
      "id" : 442447535,
      "in_reply_to_id" : 442423477,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ0NzUzNQ==",
      "original_commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "original_line" : 36,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : null,
      "pull_request_review_id" : 433576046,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442447535",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442447693"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442447693"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-18T19:18:04Z",
      "diff_hunk" : "@@ -3559,25 +3560,25 @@ bool ProcessMessage(CNode& pfrom, const std::string& msg_type, CDataStream& vRec\n     return true;\n }\n \n-bool PeerLogicValidation::CheckIfBanned(CNode& pnode)\n+bool PeerLogicValidation::CheckIfShouldDiscourage(CNode& pnode)\n {\n     AssertLockHeld(cs_main);\n     CNodeState &state = *State(pnode.GetId());\n \n-    if (state.fShouldBan) {\n-        state.fShouldBan = false;\n+    if (state.m_should_discourage) {\n+        state.m_should_discourage = false;\n         if (pnode.HasPermission(PF_NOBAN))\n             LogPrintf(\"Warning: not punishing whitelisted peer %s!\\n\", pnode.addr.ToString());\n         else if (pnode.m_manual_connection)\n             LogPrintf(\"Warning: not punishing manually-connected peer %s!\\n\", pnode.addr.ToString());\n         else if (pnode.addr.IsLocal()) {\n-            // Disconnect but don't ban _this_ local node\n-            LogPrintf(\"Warning: disconnecting but not banning local peer %s!\\n\", pnode.addr.ToString());\n+            // Disconnect but don't discourage this local node\n+            LogPrintf(\"Warning: disconnecting but not discouraging local peer %s!\\n\", pnode.addr.ToString());\n             pnode.fDisconnect = true;\n         } else {\n-            // Disconnect and ban all nodes sharing the address\n+            // Disconnect and discourage all nodes sharing the address",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442447693",
      "id" : 442447693,
      "in_reply_to_id" : 442417041,
      "line" : 3584,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ0NzY5Mw==",
      "original_commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "original_line" : 3584,
      "original_position" : 137,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 140,
      "pull_request_review_id" : 433576257,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442447693",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442447784"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442447784"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-18T19:18:16Z",
      "diff_hunk" : "@@ -556,7 +556,8 @@ static UniValue getnetworkinfo(const JSONRPCRequest& request)\n static UniValue setban(const JSONRPCRequest& request)\n {\n     const RPCHelpMan help{\"setban\",\n-                \"\\nAttempts to add or remove an IP/Subnet from the banned list.\\n\",\n+                \"\\nAttempts to add or remove an IP/Subnet from the banned list.\\n\"\n+                \"Peers that are automatically banned cannot be unbanned.\\n\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442447784",
      "id" : 442447784,
      "in_reply_to_id" : 442424037,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ0Nzc4NA==",
      "original_commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "original_line" : 560,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 433576382,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442447784",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 250e8acc7df63430f73099549d18d707844c08a8",
      "created_at" : "2020-06-18T20:00:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-646276515",
      "id" : 646276515,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NjI3NjUxNQ==",
      "updated_at" : "2020-06-18T20:00:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646276515",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 0ba85217caa333021cf04eb5cff9770f3152c287",
      "created_at" : "2020-06-18T20:46:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-646296724",
      "id" : 646296724,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NjI5NjcyNA==",
      "updated_at" : "2020-06-18T20:46:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646296724",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442492761"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442492761"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Have the release notes been updated with this breaking RPC change?",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-18T20:46:16Z",
      "diff_hunk" : "@@ -671,7 +672,6 @@ static UniValue listbanned(const JSONRPCRequest& request)\n         rec.pushKV(\"address\", entry.first.ToString());\n         rec.pushKV(\"banned_until\", banEntry.nBanUntil);\n         rec.pushKV(\"ban_created\", banEntry.nCreateTime);\n-        rec.pushKV(\"ban_reason\", banEntry.banReasonToString());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442492761",
      "id" : 442492761,
      "in_reply_to_id" : 438717008,
      "line" : 674,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ5Mjc2MQ==",
      "original_commit_id" : "0778faa584871010c82db84c9d54d1353a91a37c",
      "original_line" : 674,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : 45,
      "pull_request_review_id" : 433634359,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442492761",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442906534"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442906534"
         }
      },
      "author_association" : "MEMBER",
      "body" : "36db81e Thoughts:\r\n\r\n`-bantime` help would now print\r\n```\r\n-bantime=<n>\r\n       Default bantime for manually configured bans (default: 86400)\r\n```\r\n\r\n- \"Default\": only the case if this config arg is not passed\r\n- It would be helpful to continue providing the units (seconds)\r\n\r\nPerhaps `\"Bantime in seconds for manually configured bans (default: %u)\"`",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-19T15:30:08Z",
      "diff_hunk" : "@@ -427,8 +427,8 @@ void SetupServerArgs(NodeContext& node)\n \n     gArgs.AddArg(\"-addnode=<ip>\", \"Add a node to connect to and attempt to keep the connection open (see the `addnode` RPC command help for more info). This option can be specified multiple times to add multiple nodes.\", ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::CONNECTION);\n     gArgs.AddArg(\"-asmap=<file>\", strprintf(\"Specify asn mapping used for bucketing of the peers (default: %s). Relative paths will be prefixed by the net-specific datadir location.\", DEFAULT_ASMAP_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n-    gArgs.AddArg(\"-banscore=<n>\", strprintf(\"Threshold for disconnecting misbehaving peers (default: %u)\", DEFAULT_BANSCORE_THRESHOLD), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n-    gArgs.AddArg(\"-bantime=<n>\", strprintf(\"Number of seconds to keep misbehaving peers from reconnecting (default: %u)\", DEFAULT_MISBEHAVING_BANTIME), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n+    gArgs.AddArg(\"-banscore=<n>\", strprintf(\"Threshold for disconnecting and discouraging misbehaving peers (default: %u)\", DEFAULT_BANSCORE_THRESHOLD), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n+    gArgs.AddArg(\"-bantime=<n>\", strprintf(\"Default bantime for manually configured bans (default: %u)\", DEFAULT_MISBEHAVING_BANTIME), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442906534",
      "id" : 442906534,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjkwNjUzNA==",
      "original_commit_id" : "0ba85217caa333021cf04eb5cff9770f3152c287",
      "original_line" : 431,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 434166887,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442906534",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442908348"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442908348"
         }
      },
      "author_association" : "MEMBER",
      "body" : "36db81e nit: `s/subets/subnets/`",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-19T15:33:29Z",
      "diff_hunk" : "@@ -23,32 +24,55 @@ class CClientUIInterface;\n class CNetAddr;\n class CSubNet;\n \n-// Denial-of-service detection/prevention\n-// The idea is to detect peers that are behaving\n-// badly and disconnect/ban them, but do it in a\n-// one-coding-mistake-won't-shatter-the-entire-network\n-// way.\n-// IMPORTANT:  There should be nothing I can give a\n-// node that it will forward on that will make that\n-// node's peers drop it. If there is, an attacker\n-// can isolate a node and/or try to split the network.\n-// Dropping a node for sending stuff that is invalid\n-// now but might be valid in a later version is also\n-// dangerous, because it can cause a network split\n-// between nodes running old code and nodes running\n-// new code.\n+// Banman manages two related but distinct concepts:\n+//\n+// 1. Banning. This is configured manually by the user, through the setban RPC.\n+// If an address or subnet is banned, we never accept incoming connections from\n+// it and never create outgoing connections to it. We won't gossip its address\n+// to other peers in addr messages. Banned addresses and subets are stored to",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442908348",
      "id" : 442908348,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjkwODM0OA==",
      "original_commit_id" : "0ba85217caa333021cf04eb5cff9770f3152c287",
      "original_line" : 32,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : null,
      "pull_request_review_id" : 434166887,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442908348",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442913589"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442913589"
         }
      },
      "author_association" : "MEMBER",
      "body" : "perhaps: \"after 24 hours or a user's `-bantime` setting.\"",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-19T15:43:44Z",
      "diff_hunk" : "@@ -0,0 +1,20 @@\n+#### Change in banning behaviour\n+\n+Peers that misbehave (e.g. send us invalid blocks) are now referred to as\n+discouraged nodes in log output, as they're not (and weren't) strictly banned:\n+incoming connections are still allowed from them, but they're preferred for\n+eviction. There are some small changes to our treatment of discouraged\n+addresses:\n+\n+- Discouraging an address does not time out automatically after 24 hours.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442913589",
      "id" : 442913589,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjkxMzU4OQ==",
      "original_commit_id" : "0ba85217caa333021cf04eb5cff9770f3152c287",
      "original_line" : 9,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "doc/release-notes-19219.md",
      "position" : null,
      "pull_request_review_id" : 434166887,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442913589",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442914450"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442914450"
         }
      },
      "author_association" : "MEMBER",
      "body" : "36db81e The release note looks great.\r\n\r\nOne thought: we're talking about discouraging misbehavior rather than banning. I wonder if a more accurate title is possible here, e.g. \"Changes regarding misbehaving peers\" or \"Discouraging misbehaving peers.\"",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-19T15:45:31Z",
      "diff_hunk" : "@@ -0,0 +1,20 @@\n+#### Change in banning behaviour",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442914450",
      "id" : 442914450,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjkxNDQ1MA==",
      "original_commit_id" : "0ba85217caa333021cf04eb5cff9770f3152c287",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "doc/release-notes-19219.md",
      "position" : null,
      "pull_request_review_id" : 434166887,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442914450",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442915997"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442915997"
         }
      },
      "author_association" : "MEMBER",
      "body" : "36db81e if this change is long-lasting, the `-banscore` config arg and getpeerinfo field name may need to be gradually renamed to avoid confusion with banning and `-bantime` (the log output is already being changed in this commit from \"BAN\" to \"DISCOURAGE\")",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-19T15:48:26Z",
      "diff_hunk" : "@@ -427,8 +427,8 @@ void SetupServerArgs(NodeContext& node)\n \n     gArgs.AddArg(\"-addnode=<ip>\", \"Add a node to connect to and attempt to keep the connection open (see the `addnode` RPC command help for more info). This option can be specified multiple times to add multiple nodes.\", ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::CONNECTION);\n     gArgs.AddArg(\"-asmap=<file>\", strprintf(\"Specify asn mapping used for bucketing of the peers (default: %s). Relative paths will be prefixed by the net-specific datadir location.\", DEFAULT_ASMAP_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n-    gArgs.AddArg(\"-banscore=<n>\", strprintf(\"Threshold for disconnecting misbehaving peers (default: %u)\", DEFAULT_BANSCORE_THRESHOLD), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n-    gArgs.AddArg(\"-bantime=<n>\", strprintf(\"Number of seconds to keep misbehaving peers from reconnecting (default: %u)\", DEFAULT_MISBEHAVING_BANTIME), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n+    gArgs.AddArg(\"-banscore=<n>\", strprintf(\"Threshold for disconnecting and discouraging misbehaving peers (default: %u)\", DEFAULT_BANSCORE_THRESHOLD), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442915997",
      "id" : 442915997,
      "line" : 433,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjkxNTk5Nw==",
      "original_commit_id" : "0ba85217caa333021cf04eb5cff9770f3152c287",
      "original_line" : 433,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 6,
      "pull_request_review_id" : 434166887,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442915997",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442979680"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442979680"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The conditional for determining if the inbounds are nearly full, per previous review https://github.com/bitcoin/bitcoin/pull/19219#discussion_r438752687, now seems correct.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-19T18:07:27Z",
      "diff_hunk" : "@@ -1010,17 +1010,24 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n     // on all platforms.  Set it again here just to be sure.\n     SetSocketNoDelay(hSocket);\n \n-    int bannedlevel = m_banman ? m_banman->IsBannedLevel(addr) : 0;\n-\n-    // Don't accept connections from banned peers, but if our inbound slots aren't almost full, accept\n-    // if the only banning reason was an automatic misbehavior ban.\n-    if (!NetPermissions::HasFlag(permissionFlags, NetPermissionFlags::PF_NOBAN) && bannedlevel > ((nInbound + 1 < nMaxInbound) ? 1 : 0))\n+    // Don't accept connections from banned peers.\n+    bool banned = m_banman->IsBanned(addr);\n+    if (!NetPermissions::HasFlag(permissionFlags, NetPermissionFlags::PF_NOBAN) && banned)\n     {\n         LogPrint(BCLog::NET, \"connection from %s dropped (banned)\\n\", addr.ToString());\n         CloseSocket(hSocket);\n         return;\n     }\n \n+    // Only accept connections from discouraged peers if our inbound slots aren't (almost) full.\n+    bool discouraged = m_banman->IsDiscouraged(addr);\n+    if (!NetPermissions::HasFlag(permissionFlags, NetPermissionFlags::PF_NOBAN) && nInbound + 1 >= nMaxInbound && discouraged)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442979680",
      "id" : 442979680,
      "line" : 1024,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjk3OTY4MA==",
      "original_commit_id" : "0ba85217caa333021cf04eb5cff9770f3152c287",
      "original_line" : 1024,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 20,
      "pull_request_review_id" : 434166887,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442979680",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r443070746"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443070746"
         }
      },
      "author_association" : "NONE",
      "body" : "What if they are `PF_NOBAN` yet these flags happen to be set.. in that case `m_prefer_evict` will be set... even though they are `PF_NOBAN`.. is that acceptable and/or intentional?",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-19T22:52:43Z",
      "diff_hunk" : "@@ -1044,7 +1051,7 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n     pnode->m_permissionFlags = permissionFlags;\n     // If this flag is present, the user probably expect that RPC and QT report it as whitelisted (backward compatibility)\n     pnode->m_legacyWhitelisted = legacyWhitelisted;\n-    pnode->m_prefer_evict = bannedlevel > 0;\n+    pnode->m_prefer_evict = banned || discouraged;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r443070746",
      "id" : 443070746,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA3MDc0Ng==",
      "original_commit_id" : "0ba85217caa333021cf04eb5cff9770f3152c287",
      "original_line" : 1054,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 434372642,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443070746",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266627?v=4",
         "events_url" : "https://api.github.com/users/cculianu/events{/privacy}",
         "followers_url" : "https://api.github.com/users/cculianu/followers",
         "following_url" : "https://api.github.com/users/cculianu/following{/other_user}",
         "gists_url" : "https://api.github.com/users/cculianu/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/cculianu",
         "id" : 266627,
         "login" : "cculianu",
         "node_id" : "MDQ6VXNlcjI2NjYyNw==",
         "organizations_url" : "https://api.github.com/users/cculianu/orgs",
         "received_events_url" : "https://api.github.com/users/cculianu/received_events",
         "repos_url" : "https://api.github.com/users/cculianu/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/cculianu/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/cculianu/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/cculianu"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r443074215"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443074215"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-19T23:11:49Z",
      "diff_hunk" : "@@ -671,7 +672,6 @@ static UniValue listbanned(const JSONRPCRequest& request)\n         rec.pushKV(\"address\", entry.first.ToString());\n         rec.pushKV(\"banned_until\", banEntry.nBanUntil);\n         rec.pushKV(\"ban_created\", banEntry.nCreateTime);\n-        rec.pushKV(\"ban_reason\", banEntry.banReasonToString());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r443074215",
      "id" : 443074215,
      "in_reply_to_id" : 438717008,
      "line" : 674,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA3NDIxNQ==",
      "original_commit_id" : "0778faa584871010c82db84c9d54d1353a91a37c",
      "original_line" : 674,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : 45,
      "pull_request_review_id" : 434376358,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443074215",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r443074356"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443074356"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't understand what your comment on the use of \"default\" is about. It can be overridden by providing an RPC argument.\r\n\r\nI've added seconds back.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-19T23:12:50Z",
      "diff_hunk" : "@@ -427,8 +427,8 @@ void SetupServerArgs(NodeContext& node)\n \n     gArgs.AddArg(\"-addnode=<ip>\", \"Add a node to connect to and attempt to keep the connection open (see the `addnode` RPC command help for more info). This option can be specified multiple times to add multiple nodes.\", ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::CONNECTION);\n     gArgs.AddArg(\"-asmap=<file>\", strprintf(\"Specify asn mapping used for bucketing of the peers (default: %s). Relative paths will be prefixed by the net-specific datadir location.\", DEFAULT_ASMAP_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n-    gArgs.AddArg(\"-banscore=<n>\", strprintf(\"Threshold for disconnecting misbehaving peers (default: %u)\", DEFAULT_BANSCORE_THRESHOLD), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n-    gArgs.AddArg(\"-bantime=<n>\", strprintf(\"Number of seconds to keep misbehaving peers from reconnecting (default: %u)\", DEFAULT_MISBEHAVING_BANTIME), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n+    gArgs.AddArg(\"-banscore=<n>\", strprintf(\"Threshold for disconnecting and discouraging misbehaving peers (default: %u)\", DEFAULT_BANSCORE_THRESHOLD), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n+    gArgs.AddArg(\"-bantime=<n>\", strprintf(\"Default bantime for manually configured bans (default: %u)\", DEFAULT_MISBEHAVING_BANTIME), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r443074356",
      "id" : 443074356,
      "in_reply_to_id" : 442906534,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA3NDM1Ng==",
      "original_commit_id" : "0ba85217caa333021cf04eb5cff9770f3152c287",
      "original_line" : 431,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 434376542,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443074356",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r443074380"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443074380"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-19T23:12:57Z",
      "diff_hunk" : "@@ -23,32 +24,55 @@ class CClientUIInterface;\n class CNetAddr;\n class CSubNet;\n \n-// Denial-of-service detection/prevention\n-// The idea is to detect peers that are behaving\n-// badly and disconnect/ban them, but do it in a\n-// one-coding-mistake-won't-shatter-the-entire-network\n-// way.\n-// IMPORTANT:  There should be nothing I can give a\n-// node that it will forward on that will make that\n-// node's peers drop it. If there is, an attacker\n-// can isolate a node and/or try to split the network.\n-// Dropping a node for sending stuff that is invalid\n-// now but might be valid in a later version is also\n-// dangerous, because it can cause a network split\n-// between nodes running old code and nodes running\n-// new code.\n+// Banman manages two related but distinct concepts:\n+//\n+// 1. Banning. This is configured manually by the user, through the setban RPC.\n+// If an address or subnet is banned, we never accept incoming connections from\n+// it and never create outgoing connections to it. We won't gossip its address\n+// to other peers in addr messages. Banned addresses and subets are stored to",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r443074380",
      "id" : 443074380,
      "in_reply_to_id" : 442908348,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA3NDM4MA==",
      "original_commit_id" : "0ba85217caa333021cf04eb5cff9770f3152c287",
      "original_line" : 32,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : null,
      "pull_request_review_id" : 434376561,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443074380",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r443074413"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443074413"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-19T23:13:04Z",
      "diff_hunk" : "@@ -0,0 +1,20 @@\n+#### Change in banning behaviour\n+\n+Peers that misbehave (e.g. send us invalid blocks) are now referred to as\n+discouraged nodes in log output, as they're not (and weren't) strictly banned:\n+incoming connections are still allowed from them, but they're preferred for\n+eviction. There are some small changes to our treatment of discouraged\n+addresses:\n+\n+- Discouraging an address does not time out automatically after 24 hours.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r443074413",
      "id" : 443074413,
      "in_reply_to_id" : 442913589,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA3NDQxMw==",
      "original_commit_id" : "0ba85217caa333021cf04eb5cff9770f3152c287",
      "original_line" : 9,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "doc/release-notes-19219.md",
      "position" : null,
      "pull_request_review_id" : 434376592,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443074413",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r443074436"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443074436"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-19T23:13:11Z",
      "diff_hunk" : "@@ -0,0 +1,20 @@\n+#### Change in banning behaviour",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r443074436",
      "id" : 443074436,
      "in_reply_to_id" : 442914450,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA3NDQzNg==",
      "original_commit_id" : "0ba85217caa333021cf04eb5cff9770f3152c287",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "doc/release-notes-19219.md",
      "position" : null,
      "pull_request_review_id" : 434376610,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443074436",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r443074487"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443074487"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think `banscore` should die a swift death (but not in this PR).",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-19T23:13:34Z",
      "diff_hunk" : "@@ -427,8 +427,8 @@ void SetupServerArgs(NodeContext& node)\n \n     gArgs.AddArg(\"-addnode=<ip>\", \"Add a node to connect to and attempt to keep the connection open (see the `addnode` RPC command help for more info). This option can be specified multiple times to add multiple nodes.\", ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::CONNECTION);\n     gArgs.AddArg(\"-asmap=<file>\", strprintf(\"Specify asn mapping used for bucketing of the peers (default: %s). Relative paths will be prefixed by the net-specific datadir location.\", DEFAULT_ASMAP_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n-    gArgs.AddArg(\"-banscore=<n>\", strprintf(\"Threshold for disconnecting misbehaving peers (default: %u)\", DEFAULT_BANSCORE_THRESHOLD), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n-    gArgs.AddArg(\"-bantime=<n>\", strprintf(\"Number of seconds to keep misbehaving peers from reconnecting (default: %u)\", DEFAULT_MISBEHAVING_BANTIME), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n+    gArgs.AddArg(\"-banscore=<n>\", strprintf(\"Threshold for disconnecting and discouraging misbehaving peers (default: %u)\", DEFAULT_BANSCORE_THRESHOLD), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r443074487",
      "id" : 443074487,
      "in_reply_to_id" : 442915997,
      "line" : 433,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA3NDQ4Nw==",
      "original_commit_id" : "0ba85217caa333021cf04eb5cff9770f3152c287",
      "original_line" : 433,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 6,
      "pull_request_review_id" : 434376677,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443074487",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r443074517"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443074517"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ok.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-19T23:13:49Z",
      "diff_hunk" : "@@ -1010,17 +1010,24 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n     // on all platforms.  Set it again here just to be sure.\n     SetSocketNoDelay(hSocket);\n \n-    int bannedlevel = m_banman ? m_banman->IsBannedLevel(addr) : 0;\n-\n-    // Don't accept connections from banned peers, but if our inbound slots aren't almost full, accept\n-    // if the only banning reason was an automatic misbehavior ban.\n-    if (!NetPermissions::HasFlag(permissionFlags, NetPermissionFlags::PF_NOBAN) && bannedlevel > ((nInbound + 1 < nMaxInbound) ? 1 : 0))\n+    // Don't accept connections from banned peers.\n+    bool banned = m_banman->IsBanned(addr);\n+    if (!NetPermissions::HasFlag(permissionFlags, NetPermissionFlags::PF_NOBAN) && banned)\n     {\n         LogPrint(BCLog::NET, \"connection from %s dropped (banned)\\n\", addr.ToString());\n         CloseSocket(hSocket);\n         return;\n     }\n \n+    // Only accept connections from discouraged peers if our inbound slots aren't (almost) full.\n+    bool discouraged = m_banman->IsDiscouraged(addr);\n+    if (!NetPermissions::HasFlag(permissionFlags, NetPermissionFlags::PF_NOBAN) && nInbound + 1 >= nMaxInbound && discouraged)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r443074517",
      "id" : 443074517,
      "in_reply_to_id" : 442979680,
      "line" : 1024,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA3NDUxNw==",
      "original_commit_id" : "0ba85217caa333021cf04eb5cff9770f3152c287",
      "original_line" : 1024,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 20,
      "pull_request_review_id" : 434376717,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443074517",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r443074710"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443074710"
         }
      },
      "author_association" : "MEMBER",
      "body" : "PF_NOBAN peers are already except from eviction entirely, so the value of the `m_prefer_evict` field has no meaning for them.\r\n\r\nThe code here is just maintaining the existing semantics (current master also sets `m_prefer_evict` for (auto)banned peers with PF_NOBAN).",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-19T23:14:58Z",
      "diff_hunk" : "@@ -1044,7 +1051,7 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n     pnode->m_permissionFlags = permissionFlags;\n     // If this flag is present, the user probably expect that RPC and QT report it as whitelisted (backward compatibility)\n     pnode->m_legacyWhitelisted = legacyWhitelisted;\n-    pnode->m_prefer_evict = bannedlevel > 0;\n+    pnode->m_prefer_evict = banned || discouraged;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r443074710",
      "id" : 443074710,
      "in_reply_to_id" : 443070746,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA3NDcxMA==",
      "original_commit_id" : "0ba85217caa333021cf04eb5cff9770f3152c287",
      "original_line" : 1054,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 434376928,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443074710",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 2605bdd220b118fe3cac6a9cebb673cf651e273c",
      "created_at" : "2020-06-20T01:54:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-646919685",
      "id" : 646919685,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NjkxOTY4NQ==",
      "updated_at" : "2020-06-20T01:54:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646919685",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r443107637"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443107637"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks. The two uses of \"default\" with different meanings in the same sentence (default for manual bans and default for this setting, e.g. the default for the default) seemed confusing to me. That said, reading it with \"(in seconds)\" now separating the two seems better.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-20T06:51:15Z",
      "diff_hunk" : "@@ -427,8 +427,8 @@ void SetupServerArgs(NodeContext& node)\n \n     gArgs.AddArg(\"-addnode=<ip>\", \"Add a node to connect to and attempt to keep the connection open (see the `addnode` RPC command help for more info). This option can be specified multiple times to add multiple nodes.\", ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::CONNECTION);\n     gArgs.AddArg(\"-asmap=<file>\", strprintf(\"Specify asn mapping used for bucketing of the peers (default: %s). Relative paths will be prefixed by the net-specific datadir location.\", DEFAULT_ASMAP_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n-    gArgs.AddArg(\"-banscore=<n>\", strprintf(\"Threshold for disconnecting misbehaving peers (default: %u)\", DEFAULT_BANSCORE_THRESHOLD), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n-    gArgs.AddArg(\"-bantime=<n>\", strprintf(\"Number of seconds to keep misbehaving peers from reconnecting (default: %u)\", DEFAULT_MISBEHAVING_BANTIME), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n+    gArgs.AddArg(\"-banscore=<n>\", strprintf(\"Threshold for disconnecting and discouraging misbehaving peers (default: %u)\", DEFAULT_BANSCORE_THRESHOLD), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n+    gArgs.AddArg(\"-bantime=<n>\", strprintf(\"Default bantime for manually configured bans (default: %u)\", DEFAULT_MISBEHAVING_BANTIME), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r443107637",
      "id" : 443107637,
      "in_reply_to_id" : 442906534,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzEwNzYzNw==",
      "original_commit_id" : "0ba85217caa333021cf04eb5cff9770f3152c287",
      "original_line" : 431,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 434408315,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443107637",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review re-ACK 2605bdd per git diff `0ba8521 2605bdd` changes since last review are documentation and help improvements and a code change to clarify that only discouragement affects the `bool CNode::m_prefer_eviction` value for peers, as we don't accept connections from banned peers.",
      "created_at" : "2020-06-20T07:10:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-646955760",
      "id" : 646955760,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0Njk1NTc2MA==",
      "updated_at" : "2020-06-20T07:10:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646955760",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r443868261"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443868261"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: I think this change makes more sense in the previous commit, since that's where you added the assert.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-22T22:53:42Z",
      "diff_hunk" : "@@ -151,8 +137,8 @@ void BanMan::Ban(const CSubNet& sub_net, const BanReason& ban_reason, int64_t ba\n     }\n     if (m_client_interface) m_client_interface->BannedListChanged();\n \n-    //store banlist to disk immediately if user requested ban",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r443868261",
      "id" : 443868261,
      "line" : 149,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg2ODI2MQ==",
      "original_commit_id" : "2605bdd220b118fe3cac6a9cebb673cf651e273c",
      "original_line" : 149,
      "original_position" : 85,
      "original_start_line" : null,
      "path" : "src/banman.cpp",
      "position" : 71,
      "pull_request_review_id" : 435327566,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443868261",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/177646?v=4",
         "events_url" : "https://api.github.com/users/narula/events{/privacy}",
         "followers_url" : "https://api.github.com/users/narula/followers",
         "following_url" : "https://api.github.com/users/narula/following{/other_user}",
         "gists_url" : "https://api.github.com/users/narula/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/narula",
         "id" : 177646,
         "login" : "narula",
         "node_id" : "MDQ6VXNlcjE3NzY0Ng==",
         "organizations_url" : "https://api.github.com/users/narula/orgs",
         "received_events_url" : "https://api.github.com/users/narula/received_events",
         "repos_url" : "https://api.github.com/users/narula/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/narula/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/narula/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/narula"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r445854050"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/445854050"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: I'd prefer if this was moved up in the file so the two `IsBanned` functions could be next to each other ",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-25T21:40:11Z",
      "diff_hunk" : "@@ -68,43 +68,28 @@ void BanMan::ClearBanned()\n     if (m_client_interface) m_client_interface->BannedListChanged();\n }\n \n-int BanMan::IsBannedLevel(CNetAddr net_addr)\n+bool BanMan::IsBanned(const CNetAddr& net_addr)\n {\n-    // Returns the most severe level of banning that applies to this address.\n-    // 0 - Not banned\n-    // 1 - Automatic misbehavior ban\n-    // 2 - Any other ban\n-    int level = 0;\n     auto current_time = GetTime();\n     LOCK(m_cs_banned);\n     for (const auto& it : m_banned) {\n         CSubNet sub_net = it.first;\n         CBanEntry ban_entry = it.second;\n \n         if (current_time < ban_entry.nBanUntil && sub_net.Match(net_addr)) {\n-            if (ban_entry.banReason != BanReasonNodeMisbehaving) return 2;\n-            level = 1;\n+            return true;\n         }\n     }\n-    return level;\n+    return false;\n }\n \n-bool BanMan::IsBanned(CNetAddr net_addr)\n+bool BanMan::IsDiscouraged(const CNetAddr& net_addr)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r445854050",
      "id" : 445854050,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTg1NDA1MA==",
      "original_commit_id" : "2605bdd220b118fe3cac6a9cebb673cf651e273c",
      "original_line" : 86,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/banman.cpp",
      "position" : null,
      "pull_request_review_id" : 437878496,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/445854050",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r446180687"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446180687"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I find this name misleading since this function doesn't just check, it takes the critical actions (initiating add to discourage filter, peer disconnect). I don't have any suggestions I love, but some ideas are `ConsiderDiscourageAndDisconnect` or `MaybeDiscourageAndDisconnect`, in line with naming conventions from other net processing functions ",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-26T13:23:13Z",
      "diff_hunk" : "@@ -3559,25 +3560,26 @@ bool ProcessMessage(CNode& pfrom, const std::string& msg_type, CDataStream& vRec\n     return true;\n }\n \n-bool PeerLogicValidation::CheckIfBanned(CNode& pnode)\n+bool PeerLogicValidation::CheckIfShouldDiscourage(CNode& pnode)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r446180687",
      "id" : 446180687,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjE4MDY4Nw==",
      "original_commit_id" : "2605bdd220b118fe3cac6a9cebb673cf651e273c",
      "original_line" : 3563,
      "original_position" : 116,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 437878496,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446180687",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r446386146"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446386146"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Agreed. Will fix if there are more changes requested, but I don't think this is worth breaking ACKs for.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-26T20:06:47Z",
      "diff_hunk" : "@@ -151,8 +137,8 @@ void BanMan::Ban(const CSubNet& sub_net, const BanReason& ban_reason, int64_t ba\n     }\n     if (m_client_interface) m_client_interface->BannedListChanged();\n \n-    //store banlist to disk immediately if user requested ban",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r446386146",
      "id" : 446386146,
      "in_reply_to_id" : 443868261,
      "line" : 149,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM4NjE0Ng==",
      "original_commit_id" : "2605bdd220b118fe3cac6a9cebb673cf651e273c",
      "original_line" : 149,
      "original_position" : 85,
      "original_start_line" : null,
      "path" : "src/banman.cpp",
      "position" : 71,
      "pull_request_review_id" : 438564474,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446386146",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r446448578"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446448578"
         }
      },
      "author_association" : "MEMBER",
      "body" : "hm, I find the previous description of \"bantime\" (time to disallow reconnect) more helpful than repeating the word\r\n\r\nconsider: `Default time (in seconds) to disallow manually configured bans from reconnecting`",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-26T23:17:24Z",
      "diff_hunk" : "@@ -427,8 +427,8 @@ void SetupServerArgs(NodeContext& node)\n \n     gArgs.AddArg(\"-addnode=<ip>\", \"Add a node to connect to and attempt to keep the connection open (see the `addnode` RPC command help for more info). This option can be specified multiple times to add multiple nodes.\", ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::CONNECTION);\n     gArgs.AddArg(\"-asmap=<file>\", strprintf(\"Specify asn mapping used for bucketing of the peers (default: %s). Relative paths will be prefixed by the net-specific datadir location.\", DEFAULT_ASMAP_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n-    gArgs.AddArg(\"-banscore=<n>\", strprintf(\"Threshold for disconnecting misbehaving peers (default: %u)\", DEFAULT_BANSCORE_THRESHOLD), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n-    gArgs.AddArg(\"-bantime=<n>\", strprintf(\"Number of seconds to keep misbehaving peers from reconnecting (default: %u)\", DEFAULT_MISBEHAVING_BANTIME), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n+    gArgs.AddArg(\"-banscore=<n>\", strprintf(\"Threshold for disconnecting and discouraging misbehaving peers (default: %u)\", DEFAULT_BANSCORE_THRESHOLD), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n+    gArgs.AddArg(\"-bantime=<n>\", strprintf(\"Default bantime (in seconds) for manually configured bans (default: %u)\", DEFAULT_MISBEHAVING_BANTIME), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r446448578",
      "id" : 446448578,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ0ODU3OA==",
      "original_commit_id" : "2605bdd220b118fe3cac6a9cebb673cf651e273c",
      "original_line" : 431,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 437878496,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446448578",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r446463595"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446463595"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nice release notes. I have a suggestion for a small change that would help with logical clarity.  \r\n\r\nwhen I initially read these release notes, I didn't understand if the discouraged address behaviors were (A) now different than banned, but functionally the same as before or (B) changes in functionality. After reading the code I understand that the first part is the same (logic for managing connections), and the bullet points are things that changed (managing the discouraged address list). \r\n\r\nAn attempt to make that clearer- \r\n```suggestion\r\neviction.\r\n\r\nManaging discouraged addresses is now handled slightly different than banned\r\nones:\r\n\r\n```",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-27T00:51:10Z",
      "diff_hunk" : "@@ -0,0 +1,21 @@\n+#### Changes regarding misbehaving peers\n+\n+Peers that misbehave (e.g. send us invalid blocks) are now referred to as\n+discouraged nodes in log output, as they're not (and weren't) strictly banned:\n+incoming connections are still allowed from them, but they're preferred for\n+eviction. Discouraged addresses are treated slightly different than banned\n+ones:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r446463595",
      "id" : 446463595,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ2MzU5NQ==",
      "original_commit_id" : "2605bdd220b118fe3cac6a9cebb673cf651e273c",
      "original_line" : 7,
      "original_position" : 7,
      "original_start_line" : 6,
      "path" : "doc/release-notes-19219.md",
      "position" : null,
      "pull_request_review_id" : 437878496,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446463595",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r446465208"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446465208"
         }
      },
      "author_association" : "MEMBER",
      "body" : "thanks for this awesome overview! ",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-27T01:05:04Z",
      "diff_hunk" : "@@ -23,32 +24,55 @@ class CClientUIInterface;\n class CNetAddr;\n class CSubNet;\n \n-// Denial-of-service detection/prevention\n-// The idea is to detect peers that are behaving\n-// badly and disconnect/ban them, but do it in a\n-// one-coding-mistake-won't-shatter-the-entire-network\n-// way.\n-// IMPORTANT:  There should be nothing I can give a\n-// node that it will forward on that will make that\n-// node's peers drop it. If there is, an attacker\n-// can isolate a node and/or try to split the network.\n-// Dropping a node for sending stuff that is invalid\n-// now but might be valid in a later version is also\n-// dangerous, because it can cause a network split\n-// between nodes running old code and nodes running\n-// new code.\n+// Banman manages two related but distinct concepts:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r446465208",
      "id" : 446465208,
      "line" : 27,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ2NTIwOA==",
      "original_commit_id" : "2605bdd220b118fe3cac6a9cebb673cf651e273c",
      "original_line" : 27,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : 26,
      "pull_request_review_id" : 437878496,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446465208",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r446469138"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446469138"
         }
      },
      "author_association" : "MEMBER",
      "body" : "whats the process for changing config args? do we go through a deprecation cycle? (and is this documented anywhere? I couldn't find it)\r\n\r\n@sipa when you say _die a swift death_ do you mean more than rename? ",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-27T01:43:56Z",
      "diff_hunk" : "@@ -427,8 +427,8 @@ void SetupServerArgs(NodeContext& node)\n \n     gArgs.AddArg(\"-addnode=<ip>\", \"Add a node to connect to and attempt to keep the connection open (see the `addnode` RPC command help for more info). This option can be specified multiple times to add multiple nodes.\", ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::CONNECTION);\n     gArgs.AddArg(\"-asmap=<file>\", strprintf(\"Specify asn mapping used for bucketing of the peers (default: %s). Relative paths will be prefixed by the net-specific datadir location.\", DEFAULT_ASMAP_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n-    gArgs.AddArg(\"-banscore=<n>\", strprintf(\"Threshold for disconnecting misbehaving peers (default: %u)\", DEFAULT_BANSCORE_THRESHOLD), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n-    gArgs.AddArg(\"-bantime=<n>\", strprintf(\"Number of seconds to keep misbehaving peers from reconnecting (default: %u)\", DEFAULT_MISBEHAVING_BANTIME), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n+    gArgs.AddArg(\"-banscore=<n>\", strprintf(\"Threshold for disconnecting and discouraging misbehaving peers (default: %u)\", DEFAULT_BANSCORE_THRESHOLD), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r446469138",
      "id" : 446469138,
      "in_reply_to_id" : 442915997,
      "line" : 433,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ2OTEzOA==",
      "original_commit_id" : "0ba85217caa333021cf04eb5cff9770f3152c287",
      "original_line" : 433,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 6,
      "pull_request_review_id" : 437878496,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446469138",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r446469629"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446469629"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\nIncrement peer's misbehavior score. If the new value surpasses banscore (specified on startup or by default), mark node to be discouraged, meaning the peer might be disconnected & added to the discouragement filter.\r\n```",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-06-27T01:49:03Z",
      "diff_hunk" : "@@ -1019,7 +1019,7 @@ unsigned int LimitOrphanTxSize(unsigned int nMaxOrphans)\n }\n \n /**\n- * Mark a misbehaving peer to be banned depending upon the value of `-banscore`.\n+ * Mark a misbehaving peer to be discouraged depending upon the value of `-banscore`.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r446469629",
      "id" : 446469629,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ2OTYyOQ==",
      "original_commit_id" : "2605bdd220b118fe3cac6a9cebb673cf651e273c",
      "original_line" : 1022,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 437878496,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446469629",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r448654791"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448654791"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-07-01T22:48:09Z",
      "diff_hunk" : "@@ -151,8 +137,8 @@ void BanMan::Ban(const CSubNet& sub_net, const BanReason& ban_reason, int64_t ba\n     }\n     if (m_client_interface) m_client_interface->BannedListChanged();\n \n-    //store banlist to disk immediately if user requested ban",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r448654791",
      "id" : 448654791,
      "in_reply_to_id" : 443868261,
      "line" : 149,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY1NDc5MQ==",
      "original_commit_id" : "2605bdd220b118fe3cac6a9cebb673cf651e273c",
      "original_line" : 149,
      "original_position" : 85,
      "original_start_line" : null,
      "path" : "src/banman.cpp",
      "position" : 71,
      "pull_request_review_id" : 441242947,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448654791",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r448654847"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448654847"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-07-01T22:48:18Z",
      "diff_hunk" : "@@ -68,43 +68,28 @@ void BanMan::ClearBanned()\n     if (m_client_interface) m_client_interface->BannedListChanged();\n }\n \n-int BanMan::IsBannedLevel(CNetAddr net_addr)\n+bool BanMan::IsBanned(const CNetAddr& net_addr)\n {\n-    // Returns the most severe level of banning that applies to this address.\n-    // 0 - Not banned\n-    // 1 - Automatic misbehavior ban\n-    // 2 - Any other ban\n-    int level = 0;\n     auto current_time = GetTime();\n     LOCK(m_cs_banned);\n     for (const auto& it : m_banned) {\n         CSubNet sub_net = it.first;\n         CBanEntry ban_entry = it.second;\n \n         if (current_time < ban_entry.nBanUntil && sub_net.Match(net_addr)) {\n-            if (ban_entry.banReason != BanReasonNodeMisbehaving) return 2;\n-            level = 1;\n+            return true;\n         }\n     }\n-    return level;\n+    return false;\n }\n \n-bool BanMan::IsBanned(CNetAddr net_addr)\n+bool BanMan::IsDiscouraged(const CNetAddr& net_addr)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r448654847",
      "id" : 448654847,
      "in_reply_to_id" : 445854050,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY1NDg0Nw==",
      "original_commit_id" : "2605bdd220b118fe3cac6a9cebb673cf651e273c",
      "original_line" : 86,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/banman.cpp",
      "position" : null,
      "pull_request_review_id" : 441243006,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448654847",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r448654929"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448654929"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Changed to `MaybeDiscourageAndDisconnect`.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-07-01T22:48:33Z",
      "diff_hunk" : "@@ -3559,25 +3560,26 @@ bool ProcessMessage(CNode& pfrom, const std::string& msg_type, CDataStream& vRec\n     return true;\n }\n \n-bool PeerLogicValidation::CheckIfBanned(CNode& pnode)\n+bool PeerLogicValidation::CheckIfShouldDiscourage(CNode& pnode)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r448654929",
      "id" : 448654929,
      "in_reply_to_id" : 446180687,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY1NDkyOQ==",
      "original_commit_id" : "2605bdd220b118fe3cac6a9cebb673cf651e273c",
      "original_line" : 3563,
      "original_position" : 116,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 441243117,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448654929",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r448654957"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448654957"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-07-01T22:48:42Z",
      "diff_hunk" : "@@ -427,8 +427,8 @@ void SetupServerArgs(NodeContext& node)\n \n     gArgs.AddArg(\"-addnode=<ip>\", \"Add a node to connect to and attempt to keep the connection open (see the `addnode` RPC command help for more info). This option can be specified multiple times to add multiple nodes.\", ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::CONNECTION);\n     gArgs.AddArg(\"-asmap=<file>\", strprintf(\"Specify asn mapping used for bucketing of the peers (default: %s). Relative paths will be prefixed by the net-specific datadir location.\", DEFAULT_ASMAP_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n-    gArgs.AddArg(\"-banscore=<n>\", strprintf(\"Threshold for disconnecting misbehaving peers (default: %u)\", DEFAULT_BANSCORE_THRESHOLD), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n-    gArgs.AddArg(\"-bantime=<n>\", strprintf(\"Number of seconds to keep misbehaving peers from reconnecting (default: %u)\", DEFAULT_MISBEHAVING_BANTIME), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n+    gArgs.AddArg(\"-banscore=<n>\", strprintf(\"Threshold for disconnecting and discouraging misbehaving peers (default: %u)\", DEFAULT_BANSCORE_THRESHOLD), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n+    gArgs.AddArg(\"-bantime=<n>\", strprintf(\"Default bantime (in seconds) for manually configured bans (default: %u)\", DEFAULT_MISBEHAVING_BANTIME), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r448654957",
      "id" : 448654957,
      "in_reply_to_id" : 446448578,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY1NDk1Nw==",
      "original_commit_id" : "2605bdd220b118fe3cac6a9cebb673cf651e273c",
      "original_line" : 431,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 441243160,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448654957",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r448655327"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448655327"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Agree, the text didn't make that clear. I've changed it to \"Furthermore, a few additional changes to how discouraged addressed are treated are introduced:\". LMK what you think.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-07-01T22:49:53Z",
      "diff_hunk" : "@@ -0,0 +1,21 @@\n+#### Changes regarding misbehaving peers\n+\n+Peers that misbehave (e.g. send us invalid blocks) are now referred to as\n+discouraged nodes in log output, as they're not (and weren't) strictly banned:\n+incoming connections are still allowed from them, but they're preferred for\n+eviction. Discouraged addresses are treated slightly different than banned\n+ones:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r448655327",
      "id" : 448655327,
      "in_reply_to_id" : 446463595,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY1NTMyNw==",
      "original_commit_id" : "2605bdd220b118fe3cac6a9cebb673cf651e273c",
      "original_line" : 7,
      "original_position" : 7,
      "original_start_line" : 6,
      "path" : "doc/release-notes-19219.md",
      "position" : null,
      "pull_request_review_id" : 441243594,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448655327",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r448655397"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448655397"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thank @jnewbery!",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-07-01T22:50:07Z",
      "diff_hunk" : "@@ -23,32 +24,55 @@ class CClientUIInterface;\n class CNetAddr;\n class CSubNet;\n \n-// Denial-of-service detection/prevention\n-// The idea is to detect peers that are behaving\n-// badly and disconnect/ban them, but do it in a\n-// one-coding-mistake-won't-shatter-the-entire-network\n-// way.\n-// IMPORTANT:  There should be nothing I can give a\n-// node that it will forward on that will make that\n-// node's peers drop it. If there is, an attacker\n-// can isolate a node and/or try to split the network.\n-// Dropping a node for sending stuff that is invalid\n-// now but might be valid in a later version is also\n-// dangerous, because it can cause a network split\n-// between nodes running old code and nodes running\n-// new code.\n+// Banman manages two related but distinct concepts:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r448655397",
      "id" : 448655397,
      "in_reply_to_id" : 446465208,
      "line" : 27,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY1NTM5Nw==",
      "original_commit_id" : "2605bdd220b118fe3cac6a9cebb673cf651e273c",
      "original_line" : 27,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : 26,
      "pull_request_review_id" : 441243668,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448655397",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r448655482"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448655482"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-07-01T22:50:19Z",
      "diff_hunk" : "@@ -1019,7 +1019,7 @@ unsigned int LimitOrphanTxSize(unsigned int nMaxOrphans)\n }\n \n /**\n- * Mark a misbehaving peer to be banned depending upon the value of `-banscore`.\n+ * Mark a misbehaving peer to be discouraged depending upon the value of `-banscore`.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r448655482",
      "id" : 448655482,
      "in_reply_to_id" : 446469629,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY1NTQ4Mg==",
      "original_commit_id" : "2605bdd220b118fe3cac6a9cebb673cf651e273c",
      "original_line" : 1022,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 441243745,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448655482",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@amitiuttarwar Thanks for the review. I've addresses all of your comments, I think. As for your overall suggestion around \"discouraging\" as a term, do you mean that primarily in RPC/log interface, or in code symbol names/comments? If there are small changes you see that can improve the interface it may be worth including them here, as they may become harder to change later.\r\n\r\nI don't feel like touching the banscore option and RPC field, as I think they should go away. For two reasons:\r\n\r\n* It's a configuration option, but there is no advice we know to give (I think?) about when anyone should ever change it. Such configuration options are useless.\r\n* The concept of scores for this just complicates reasoning. Either a particular behavior is worthy of discouragement, and it should happen immediately, or it isn't, and we shouldn't have scores to track if it happens frequently or not. If the software is broken, it'll do it repeatedly, and we'll eventually discourage them anyway. Independently it makes sense to keep track of resource usage we do on behalf of a peer (CPU, memory, network bandwidth) and if resources are constrained, we should disconnect the peers that demand the most of us (possibly with some exceptions like keeping the peers that gave us the latest blocks) - but that feels like a very different aspect of peer management than misbehavior/discouragement currently is.\r\n\r\nBesides that, I'd like to get this merged.",
      "created_at" : "2020-07-01T22:53:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-652684340",
      "id" : 652684340,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MjY4NDM0MA==",
      "updated_at" : "2020-07-02T00:34:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/652684340",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Oh, vaguely related: @gmaxwell and I working on designing/implementing a rolling cuckoo filter (see [this paper](https://www.cs.cmu.edu/~dga/papers/cuckoo-conext2014.pdf)), which would be a drop-in replacement for the rolling bloom filters we have, but around 3x smaller. However, they also support deletion, which may be useful if we'd ever want a set of RPCs to actually manage discouragement (separate from the ban management RPCs).",
      "created_at" : "2020-07-01T22:57:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-652685715",
      "id" : 652685715,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MjY4NTcxNQ==",
      "updated_at" : "2020-07-01T22:57:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/652685715",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r448670158"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448670158"
         }
      },
      "author_association" : "MEMBER",
      "body" : "looks good ",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-07-01T23:39:19Z",
      "diff_hunk" : "@@ -0,0 +1,21 @@\n+#### Changes regarding misbehaving peers\n+\n+Peers that misbehave (e.g. send us invalid blocks) are now referred to as\n+discouraged nodes in log output, as they're not (and weren't) strictly banned:\n+incoming connections are still allowed from them, but they're preferred for\n+eviction. Discouraged addresses are treated slightly different than banned\n+ones:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r448670158",
      "id" : 448670158,
      "in_reply_to_id" : 446463595,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY3MDE1OA==",
      "original_commit_id" : "2605bdd220b118fe3cac6a9cebb673cf651e273c",
      "original_line" : 7,
      "original_position" : 7,
      "original_start_line" : 6,
      "path" : "doc/release-notes-19219.md",
      "position" : null,
      "pull_request_review_id" : 441260205,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448670158",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I don't feel like touching the banscore option and RPC field, as I think they should go away...\r\n\r\nTotally agree on these. It seems to me that historically there are two reasons that configuration options get added:\r\n\r\n1. Different users require different functionality from the system, and the configuration controls those different functionalities.\r\n2. All (or _virtually all_) users require the same functionality, but the developer has punted (or hedged - pick how charitable you want to be) on the right parameters for the system.\r\n\r\n`-banscore` certainly falls under the second category. As @sipa points out, we have no advice for users on when to change it, and it's not clear how you'd change it to achieve different desired outcomes.\r\n\r\nWe should aim to eliminate all of the second category, while being careful that there aren't genuine use cases for those config options.",
      "created_at" : "2020-07-01T23:48:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-652699592",
      "id" : 652699592,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MjY5OTU5Mg==",
      "updated_at" : "2020-07-01T23:48:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/652699592",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> As for your overall suggestion around \"discouraging\" as a term, do you mean that primarily in RPC/log interface, or in code symbol names/comments? If there are small changes you see that can improve the interface it may be worth including them here, as they may become harder to change later.\r\n\r\nWas referring to code internals too, so symbols/comments. I proposed my identified small changes to help with clarity (thanks for updates!) and agree moving forward with merge makes more sense than more rounds of changes and review. \r\n\r\nAlso agree with reasoning & removing banscore config & RPC. Updated my comment aggregating follow ups to reflect. \r\n\r\nFrom my phone ð changes look good. I'm off the grid till Monday, but I'll re-review ack then if this is still open. ",
      "created_at" : "2020-07-02T02:08:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-652737093",
      "id" : 652737093,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MjczNzA5Mw==",
      "updated_at" : "2020-07-02T02:08:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/652737093",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r449330025"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449330025"
         }
      },
      "author_association" : "MEMBER",
      "body" : "why change this to %lu? `DEFAULT_MISBEHAVING_BANTIME` isn't a long",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-07-03T01:11:11Z",
      "diff_hunk" : "@@ -430,8 +430,8 @@ void SetupServerArgs(NodeContext& node)\n \n     gArgs.AddArg(\"-addnode=<ip>\", \"Add a node to connect to and attempt to keep the connection open (see the `addnode` RPC command help for more info). This option can be specified multiple times to add multiple nodes.\", ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::CONNECTION);\n     gArgs.AddArg(\"-asmap=<file>\", strprintf(\"Specify asn mapping used for bucketing of the peers (default: %s). Relative paths will be prefixed by the net-specific datadir location.\", DEFAULT_ASMAP_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n-    gArgs.AddArg(\"-banscore=<n>\", strprintf(\"Threshold for disconnecting misbehaving peers (default: %u)\", DEFAULT_BANSCORE_THRESHOLD), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n-    gArgs.AddArg(\"-bantime=<n>\", strprintf(\"Number of seconds to keep misbehaving peers from reconnecting (default: %u)\", DEFAULT_MISBEHAVING_BANTIME), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n+    gArgs.AddArg(\"-banscore=<n>\", strprintf(\"Threshold for disconnecting and discouraging misbehaving peers (default: %u)\", DEFAULT_BANSCORE_THRESHOLD), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n+    gArgs.AddArg(\"-bantime=<n>\", strprintf(\"Default time (in seconds) to disallow manually configured bans from reconnecting (default: %lu)\", DEFAULT_MISBEHAVING_BANTIME), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r449330025",
      "id" : 449330025,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTMzMDAyNQ==",
      "original_commit_id" : "1f7e0cab7a74b19fab2f33beb46c44b4944e770e",
      "original_line" : 434,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 442093531,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449330025",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r449361672"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449361672"
         }
      },
      "author_association" : "MEMBER",
      "body" : "s/addressed/addresses/\r\n\r\nSuggestion:\r\n\r\n\"Furthermore, a few additional changes are introduced to how discouraged addresses are treated:\"",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-07-03T03:47:19Z",
      "diff_hunk" : "@@ -0,0 +1,23 @@\n+#### Changes regarding misbehaving peers\n+\n+Peers that misbehave (e.g. send us invalid blocks) are now referred to as\n+discouraged nodes in log output, as they're not (and weren't) strictly banned:\n+incoming connections are still allowed from them, but they're preferred for\n+eviction.\n+\n+Furthermore, a few additional changes to how discouraged addressed are",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r449361672",
      "id" : 449361672,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM2MTY3Mg==",
      "original_commit_id" : "1f7e0cab7a74b19fab2f33beb46c44b4944e770e",
      "original_line" : 8,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "doc/release-notes-19219.md",
      "position" : null,
      "pull_request_review_id" : 442129566,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449361672",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r449369309"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449369309"
         }
      },
      "author_association" : "MEMBER",
      "body" : "True, though the printed value is unchanged.\r\n\r\nProposed simplification if you retouch:\r\n\r\ncurrent\r\n```\r\n       Default time (in seconds) to disallow manually configured bans from\r\n       reconnecting (default: 86400)\r\n```\r\nproposed\r\n```\r\n       Default duration (in seconds) of manually configured bans (default: 86400)\r\n```",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-07-03T04:27:14Z",
      "diff_hunk" : "@@ -430,8 +430,8 @@ void SetupServerArgs(NodeContext& node)\n \n     gArgs.AddArg(\"-addnode=<ip>\", \"Add a node to connect to and attempt to keep the connection open (see the `addnode` RPC command help for more info). This option can be specified multiple times to add multiple nodes.\", ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::CONNECTION);\n     gArgs.AddArg(\"-asmap=<file>\", strprintf(\"Specify asn mapping used for bucketing of the peers (default: %s). Relative paths will be prefixed by the net-specific datadir location.\", DEFAULT_ASMAP_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n-    gArgs.AddArg(\"-banscore=<n>\", strprintf(\"Threshold for disconnecting misbehaving peers (default: %u)\", DEFAULT_BANSCORE_THRESHOLD), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n-    gArgs.AddArg(\"-bantime=<n>\", strprintf(\"Number of seconds to keep misbehaving peers from reconnecting (default: %u)\", DEFAULT_MISBEHAVING_BANTIME), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n+    gArgs.AddArg(\"-banscore=<n>\", strprintf(\"Threshold for disconnecting and discouraging misbehaving peers (default: %u)\", DEFAULT_BANSCORE_THRESHOLD), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n+    gArgs.AddArg(\"-bantime=<n>\", strprintf(\"Default time (in seconds) to disallow manually configured bans from reconnecting (default: %lu)\", DEFAULT_MISBEHAVING_BANTIME), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r449369309",
      "id" : 449369309,
      "in_reply_to_id" : 449330025,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM2OTMwOQ==",
      "original_commit_id" : "1f7e0cab7a74b19fab2f33beb46c44b4944e770e",
      "original_line" : 434,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 442138560,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449369309",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r449733245"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449733245"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed. I suspect the %lu was just muscle memory...",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-07-04T03:12:07Z",
      "diff_hunk" : "@@ -430,8 +430,8 @@ void SetupServerArgs(NodeContext& node)\n \n     gArgs.AddArg(\"-addnode=<ip>\", \"Add a node to connect to and attempt to keep the connection open (see the `addnode` RPC command help for more info). This option can be specified multiple times to add multiple nodes.\", ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::CONNECTION);\n     gArgs.AddArg(\"-asmap=<file>\", strprintf(\"Specify asn mapping used for bucketing of the peers (default: %s). Relative paths will be prefixed by the net-specific datadir location.\", DEFAULT_ASMAP_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n-    gArgs.AddArg(\"-banscore=<n>\", strprintf(\"Threshold for disconnecting misbehaving peers (default: %u)\", DEFAULT_BANSCORE_THRESHOLD), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n-    gArgs.AddArg(\"-bantime=<n>\", strprintf(\"Number of seconds to keep misbehaving peers from reconnecting (default: %u)\", DEFAULT_MISBEHAVING_BANTIME), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n+    gArgs.AddArg(\"-banscore=<n>\", strprintf(\"Threshold for disconnecting and discouraging misbehaving peers (default: %u)\", DEFAULT_BANSCORE_THRESHOLD), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n+    gArgs.AddArg(\"-bantime=<n>\", strprintf(\"Default time (in seconds) to disallow manually configured bans from reconnecting (default: %lu)\", DEFAULT_MISBEHAVING_BANTIME), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r449733245",
      "id" : 449733245,
      "in_reply_to_id" : 449330025,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTczMzI0NQ==",
      "original_commit_id" : "1f7e0cab7a74b19fab2f33beb46c44b4944e770e",
      "original_line" : 434,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 442583934,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449733245",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r449733248"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449733248"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-07-04T03:12:14Z",
      "diff_hunk" : "@@ -0,0 +1,23 @@\n+#### Changes regarding misbehaving peers\n+\n+Peers that misbehave (e.g. send us invalid blocks) are now referred to as\n+discouraged nodes in log output, as they're not (and weren't) strictly banned:\n+incoming connections are still allowed from them, but they're preferred for\n+eviction.\n+\n+Furthermore, a few additional changes to how discouraged addressed are",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r449733248",
      "id" : 449733248,
      "in_reply_to_id" : 449361672,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTczMzI0OA==",
      "original_commit_id" : "1f7e0cab7a74b19fab2f33beb46c44b4944e770e",
      "original_line" : 8,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "doc/release-notes-19219.md",
      "position" : null,
      "pull_request_review_id" : 442583939,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-04T03:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449733248",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "this fixes a publicly disclosed vulnerability and has been open for a month. Is it worth merging now?",
      "created_at" : "2020-07-06T17:44:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-654376210",
      "id" : 654376210,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1NDM3NjIxMA==",
      "updated_at" : "2020-07-06T17:44:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/654376210",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r450464303"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/450464303"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This appears to be slightly less defensive since it's not checking that `m_banman` has been assigned before dereferencing it. It's fine because `m_banman` is always set in `CConnman::Init()` from the value in `connOptions.m_banman` (which is itself always set in `AppInitMain()`.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-07-06T20:32:54Z",
      "diff_hunk" : "@@ -1010,17 +1010,24 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n     // on all platforms.  Set it again here just to be sure.\n     SetSocketNoDelay(hSocket);\n \n-    int bannedlevel = m_banman ? m_banman->IsBannedLevel(addr) : 0;\n-\n-    // Don't accept connections from banned peers, but if our inbound slots aren't almost full, accept\n-    // if the only banning reason was an automatic misbehavior ban.\n-    if (!NetPermissions::HasFlag(permissionFlags, NetPermissionFlags::PF_NOBAN) && bannedlevel > ((nInbound + 1 < nMaxInbound) ? 1 : 0))\n+    // Don't accept connections from banned peers.\n+    bool banned = m_banman->IsBanned(addr);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r450464303",
      "id" : 450464303,
      "line" : 1014,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ2NDMwMw==",
      "original_commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "original_line" : 1014,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 10,
      "pull_request_review_id" : 443388135,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-06T20:39:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/450464303",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r450554242"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/450554242"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Let's fix that later.",
      "commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-07-07T00:59:07Z",
      "diff_hunk" : "@@ -1010,17 +1010,24 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n     // on all platforms.  Set it again here just to be sure.\n     SetSocketNoDelay(hSocket);\n \n-    int bannedlevel = m_banman ? m_banman->IsBannedLevel(addr) : 0;\n-\n-    // Don't accept connections from banned peers, but if our inbound slots aren't almost full, accept\n-    // if the only banning reason was an automatic misbehavior ban.\n-    if (!NetPermissions::HasFlag(permissionFlags, NetPermissionFlags::PF_NOBAN) && bannedlevel > ((nInbound + 1 < nMaxInbound) ? 1 : 0))\n+    // Don't accept connections from banned peers.\n+    bool banned = m_banman->IsBanned(addr);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r450554242",
      "id" : 450554242,
      "in_reply_to_id" : 450464303,
      "line" : 1014,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU1NDI0Mg==",
      "original_commit_id" : "2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "original_line" : 1014,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 10,
      "pull_request_review_id" : 443493808,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-07T00:59:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/450554242",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 2ad58381fffb33d611abf900b73d9e6b5a4e35f8",
      "created_at" : "2020-07-07T11:26:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-654788810",
      "id" : 654788810,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1NDc4ODgxMA==",
      "updated_at" : "2020-07-07T11:26:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/654788810",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "code review ACK 2ad58381ff",
      "created_at" : "2020-07-07T17:44:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-655020777",
      "id" : 655020777,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1NTAyMDc3Nw==",
      "updated_at" : "2020-07-07T17:44:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/655020777",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've added this for backport in #19224.",
      "created_at" : "2020-07-08T01:47:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-655231321",
      "id" : 655231321,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1NTIzMTMyMQ==",
      "updated_at" : "2020-07-08T01:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/655231321",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   }
]
