[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "It looks like openssl removed the threading stuff out from under us - we should proabbly do something like check OPENSSL_THREADS (ie if openssl was built with threading support - can we also do this at runtime?) and fail to build/run if it wasn't, only setting the locking callbacks if the openssl version is low enough that they are needed.",
      "created_at" : "2017-11-03T21:58:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11602#issuecomment-341837549",
      "id" : 341837549,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11602",
      "updated_at" : "2017-11-03T21:58:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/341837549",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "> It looks like openssl removed the threading stuff out from under us\r\n\r\nWhat I don't understand is why this doesn't fail because it still calls `CRYPTO_set_locking_callback`? If they removed the threading stuff and associated flags why not that?\r\n\r\n> can we also do this at runtime?\r\n\r\nMaybe - though even checking the OpenSSL version at runtime isn't straightforward. E.g. there used to be a function `SSLeay` to get a version number which they suddenly removed and replaced with `OpenSSL_version_num` (see https://github.com/openssl/openssl/issues/862). Also would have to consider alternative implementations such as LibreSSL and PolarSSL, which try to be compatible but with whoknowswhat...\r\n\r\nWhat a mess.\r\n",
      "created_at" : "2017-11-06T10:42:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11602#issuecomment-342111099",
      "id" : 342111099,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11602",
      "updated_at" : "2017-11-06T10:43:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/342111099",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> What I don't understand is why this doesn't fail because it still callsÃÂ CRYPTO_set_locking_callback?\n\nThe functions themselves were kept, except they are now just #defines to nothing, the constant was removed.\n\nI am somewhat concerned that the current code may break if OpenSSL is complied without threading support, though I'd hope that's rather rare in any case.\n\nOn November 6, 2017 5:42:29 AM EST, \"Wladimir J. van der Laan\" <notifications@github.com> wrote:\n>> It looks like openssl removed the threading stuff out from under us\n>\n>What I don't understand is why this doesn't fail because it still calls\n>`CRYPTO_set_locking_callback`?\n>\n>> can we also do this at runtime?\n>\n>Maybe - though even checking the OpenSSL version at runtime isn't\n>straightforward. E.g. there used to be a function `SSLeay` to get a\n>version number which they suddenly removed and replaced with\n>`OpenSSL_version_num` (see\n>https://github.com/openssl/openssl/issues/862). Also would have to\n>consider alternative implementations such as LibreSSL and PolarSSL,\n>which try to be compatible but with whoknowswhat...\n>\n>What a mess.\n>\n>\n>-- \n>You are receiving this because you commented.\n>Reply to this email directly or view it on GitHub:\n>https://github.com/bitcoin/bitcoin/pull/11602#issuecomment-342111099\n",
      "created_at" : "2017-11-06T13:34:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11602#issuecomment-342149848",
      "id" : 342149848,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11602",
      "updated_at" : "2017-11-06T13:34:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/342149848",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "> I am somewhat concerned that the current code may break if OpenSSL is complied without threading support, though I'd hope that's rather rare in any case.\r\n\r\nI had hoped that the thread-related functions would be missing from the library in that case, causing either compilation error or a runtime error in the dynamic linker. \r\n(one'd hope they don't #define them away in the case of no thread support, only because the API for thread support doesn't need them anymore, but who knows..)",
      "created_at" : "2017-11-07T07:44:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11602#issuecomment-342400998",
      "id" : 342400998,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11602",
      "updated_at" : "2017-11-07T07:44:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/342400998",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "In any case this can't be merged as-is. It breaks the tests, and breaks compatibility with older OpenSSL. At the least it needs `#if` to delimit the OpenSSL versions where it is needed versus not needed.",
      "created_at" : "2017-11-08T07:41:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11602#issuecomment-342735803",
      "id" : 342735803,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11602",
      "updated_at" : "2017-11-08T07:42:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/342735803",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "They removed the thread-related functions and then `#define`d them again as `no-ops`.\r\nThis means that:\r\n- Everything will work just fine for a openssl version low enough.\r\n- Compilation will fail for the openssl versions where they removed those functions.\r\n- Possibly obscure race conditions at run time for openssl versions with the `no-op` defines?\r\n\r\nIs that correct?",
      "created_at" : "2017-11-09T00:33:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11602#issuecomment-343008480",
      "id" : 343008480,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11602",
      "updated_at" : "2017-11-09T00:33:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/343008480",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7092991?v=4",
         "events_url" : "https://api.github.com/users/azavalla/events{/privacy}",
         "followers_url" : "https://api.github.com/users/azavalla/followers",
         "following_url" : "https://api.github.com/users/azavalla/following{/other_user}",
         "gists_url" : "https://api.github.com/users/azavalla/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/azavalla",
         "id" : 7092991,
         "login" : "azavalla",
         "organizations_url" : "https://api.github.com/users/azavalla/orgs",
         "received_events_url" : "https://api.github.com/users/azavalla/received_events",
         "repos_url" : "https://api.github.com/users/azavalla/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/azavalla/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/azavalla/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/azavalla"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11602#discussion_r149938189"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11602"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/149938189"
         }
      },
      "author_association" : "OWNER",
      "body" : "Does the removal of CRYPTO_LOCK here have any influence on older versions of OpenSSL which need this?\r\nMight be better to add the define here, if it's not defined.",
      "commit_id" : "7b0b1665f4f926a384782f43663ceabee808ab37",
      "created_at" : "2017-11-09T11:38:06Z",
      "diff_hunk" : "@@ -107,7 +107,7 @@ std::atomic<uint32_t> logCategories(0);\n static std::unique_ptr<CCriticalSection[]> ppmutexOpenSSL;\n void locking_callback(int mode, int i, const char* file, int line) NO_THREAD_SAFETY_ANALYSIS\n {\n-    if (mode & CRYPTO_LOCK) {\n+    if (mode) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11602#discussion_r149938189",
      "id" : 149938189,
      "original_commit_id" : "7b0b1665f4f926a384782f43663ceabee808ab37",
      "original_position" : 5,
      "path" : "src/util.cpp",
      "position" : 5,
      "pull_request_review_id" : 75409273,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11602",
      "updated_at" : "2017-11-09T11:38:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/149938189",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11602#discussion_r149938288"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11602"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/149938288"
         }
      },
      "author_association" : "OWNER",
      "body" : "We'd still want to call this function for versions of OpenSSL that need it.",
      "commit_id" : "7b0b1665f4f926a384782f43663ceabee808ab37",
      "created_at" : "2017-11-09T11:38:42Z",
      "diff_hunk" : "@@ -141,8 +141,6 @@ class CInit\n     }\n     ~CInit()\n     {\n-        // Securely erase the memory used by the PRNG\n-        RAND_cleanup();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11602#discussion_r149938288",
      "id" : 149938288,
      "original_commit_id" : "7b0b1665f4f926a384782f43663ceabee808ab37",
      "original_position" : 14,
      "path" : "src/util.cpp",
      "position" : 14,
      "pull_request_review_id" : 75409402,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11602",
      "updated_at" : "2017-11-09T11:38:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/149938288",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "Ping @azavalla",
      "created_at" : "2017-11-30T11:02:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11602#issuecomment-348155973",
      "id" : 348155973,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11602",
      "updated_at" : "2017-11-30T11:02:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/348155973",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
