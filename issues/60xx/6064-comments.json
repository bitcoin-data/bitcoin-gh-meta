[
   {
      "author_association" : "MEMBER",
      "body" : "The HMAC for address inventory hashing is absolute overkill, but was easy to write. I doubt the performance matters.\n",
      "created_at" : "2015-04-25T16:41:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6064#issuecomment-96234859",
      "id" : 96234859,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6064",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDk2MjM0ODU5",
      "performed_via_github_app" : null,
      "updated_at" : "2015-04-25T16:41:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/96234859",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased on top of @gavinandresen's #6066 (so that I don't need the address hasher here).\n\nRemoved the boost::unordered_set usage for now, as it is incompatible with older boost versions (which don't have unordered_set::reserve).\n",
      "created_at" : "2015-04-25T21:47:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6064#issuecomment-96284019",
      "id" : 96284019,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6064",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDk2Mjg0MDE5",
      "performed_via_github_app" : null,
      "updated_at" : "2015-04-25T21:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/96284019",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6064#discussion_r29112655"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6064"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/29112655"
         }
      },
      "body" : "I'm probably just an old fuddy-duddy...\r\n... but I find the \"use swap to assign\" idiom hard to review.\r\nWhy not just:\r\norder.assign(nMaxSizeIn, set.end());\r\n",
      "commit_id" : "ab42414b8c2ddc440effcd1ab022b221365e2e27",
      "created_at" : "2015-04-26T18:58:34Z",
      "diff_hunk" : "@@ -22,21 +22,26 @@ class mruset\n \n protected:\n     std::set<T> set;\n-    std::deque<T> queue;\n+    std::vector<iterator> order;\n+    size_type first_used;\n+    size_type first_unused;\n     size_type nMaxSize;\n \n public:\n-    mruset(size_type nMaxSizeIn = 0) { nMaxSize = nMaxSizeIn; }\n+    mruset(size_type nMaxSizeIn = 1) { clear(nMaxSizeIn); }\n     iterator begin() const { return set.begin(); }\n     iterator end() const { return set.end(); }\n     size_type size() const { return set.size(); }\n     bool empty() const { return set.empty(); }\n     iterator find(const key_type& k) const { return set.find(k); }\n     size_type count(const key_type& k) const { return set.count(k); }\n-    void clear()\n+    void clear(size_type nMaxSizeIn = 1)\n     {\n         set.clear();\n-        queue.clear();\n+        std::vector<iterator>(nMaxSizeIn, set.end()).swap(order);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6064#discussion_r29112655",
      "id" : 29112655,
      "original_commit_id" : "8ba847459421e9786fd8c25c9303027df6b9f3d7",
      "original_position" : 39,
      "path" : "src/mruset.h",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6064",
      "updated_at" : "2015-04-30T15:00:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/29112655",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=3",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6064#discussion_r29112682"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6064"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/29112682"
         }
      },
      "body" : "Save a line of code with:\r\nfirst_used = (first_used+1)%nMaxSize;",
      "commit_id" : "ab42414b8c2ddc440effcd1ab022b221365e2e27",
      "created_at" : "2015-04-26T19:03:01Z",
      "diff_hunk" : "@@ -45,25 +50,19 @@ class mruset\n     {\n         std::pair<iterator, bool> ret = set.insert(x);\n         if (ret.second) {\n-            if (nMaxSize && queue.size() == nMaxSize) {\n-                set.erase(queue.front());\n-                queue.pop_front();\n+            if (set.size() == nMaxSize + 1) {\n+                set.erase(order[first_used]);\n+                order[first_used] = set.end();\n+                first_used++;\n+                if (first_used == nMaxSize) { first_used = 0; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6064#discussion_r29112682",
      "id" : 29112682,
      "original_commit_id" : "8ba847459421e9786fd8c25c9303027df6b9f3d7",
      "original_position" : 57,
      "path" : "src/mruset.h",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6064",
      "updated_at" : "2015-04-30T15:00:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/29112682",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=3",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Code review ACK-- note I changed the CRollingBloomFilter implementation commit in #6066 .\n\nMeasured heap usage on OSX for a 1,000-entry mruset<CInv> : 72,192 bytes.\n(before this change: 100,992 bytes).\n\nI'm running a node with these changes now.\n",
      "created_at" : "2015-04-26T19:24:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6064#issuecomment-96422464",
      "id" : 96422464,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6064",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDk2NDIyNDY0",
      "performed_via_github_app" : null,
      "updated_at" : "2015-04-26T19:24:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/96422464",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=4",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "node_id" : "MDQ6VXNlcjMzMTk5Nw==",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6064#discussion_r29113580"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6064"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/29113580"
         }
      },
      "body" : "It's horrible, but it's the only way to make a vector release its memory, afaik.",
      "commit_id" : "ab42414b8c2ddc440effcd1ab022b221365e2e27",
      "created_at" : "2015-04-26T20:39:45Z",
      "diff_hunk" : "@@ -22,21 +22,26 @@ class mruset\n \n protected:\n     std::set<T> set;\n-    std::deque<T> queue;\n+    std::vector<iterator> order;\n+    size_type first_used;\n+    size_type first_unused;\n     size_type nMaxSize;\n \n public:\n-    mruset(size_type nMaxSizeIn = 0) { nMaxSize = nMaxSizeIn; }\n+    mruset(size_type nMaxSizeIn = 1) { clear(nMaxSizeIn); }\n     iterator begin() const { return set.begin(); }\n     iterator end() const { return set.end(); }\n     size_type size() const { return set.size(); }\n     bool empty() const { return set.empty(); }\n     iterator find(const key_type& k) const { return set.find(k); }\n     size_type count(const key_type& k) const { return set.count(k); }\n-    void clear()\n+    void clear(size_type nMaxSizeIn = 1)\n     {\n         set.clear();\n-        queue.clear();\n+        std::vector<iterator>(nMaxSizeIn, set.end()).swap(order);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6064#discussion_r29113580",
      "id" : 29113580,
      "original_commit_id" : "8ba847459421e9786fd8c25c9303027df6b9f3d7",
      "original_position" : 39,
      "path" : "src/mruset.h",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6064",
      "updated_at" : "2015-04-30T15:00:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/29113580",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6064#discussion_r29113583"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6064"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/29113583"
         }
      },
      "body" : "Modulo operator is slow, if it's not a compile-time known power-of-two constant.",
      "commit_id" : "ab42414b8c2ddc440effcd1ab022b221365e2e27",
      "created_at" : "2015-04-26T20:40:23Z",
      "diff_hunk" : "@@ -45,25 +50,19 @@ class mruset\n     {\n         std::pair<iterator, bool> ret = set.insert(x);\n         if (ret.second) {\n-            if (nMaxSize && queue.size() == nMaxSize) {\n-                set.erase(queue.front());\n-                queue.pop_front();\n+            if (set.size() == nMaxSize + 1) {\n+                set.erase(order[first_used]);\n+                order[first_used] = set.end();\n+                first_used++;\n+                if (first_used == nMaxSize) { first_used = 0; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6064#discussion_r29113583",
      "id" : 29113583,
      "original_commit_id" : "8ba847459421e9786fd8c25c9303027df6b9f3d7",
      "original_position" : 57,
      "path" : "src/mruset.h",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6064",
      "updated_at" : "2015-04-30T15:00:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/29113583",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6064#discussion_r29113708"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6064"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/29113708"
         }
      },
      "body" : "Updated to use another one-line construct.",
      "commit_id" : "ab42414b8c2ddc440effcd1ab022b221365e2e27",
      "created_at" : "2015-04-26T20:58:11Z",
      "diff_hunk" : "@@ -45,25 +50,19 @@ class mruset\n     {\n         std::pair<iterator, bool> ret = set.insert(x);\n         if (ret.second) {\n-            if (nMaxSize && queue.size() == nMaxSize) {\n-                set.erase(queue.front());\n-                queue.pop_front();\n+            if (set.size() == nMaxSize + 1) {\n+                set.erase(order[first_used]);\n+                order[first_used] = set.end();\n+                first_used++;\n+                if (first_used == nMaxSize) { first_used = 0; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6064#discussion_r29113708",
      "id" : 29113708,
      "original_commit_id" : "8ba847459421e9786fd8c25c9303027df6b9f3d7",
      "original_position" : 57,
      "path" : "src/mruset.h",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6064",
      "updated_at" : "2015-04-30T15:00:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/29113708",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased on updated #6066, and addressed a nit.\n",
      "created_at" : "2015-04-26T20:59:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6064#issuecomment-96434748",
      "id" : 96434748,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6064",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDk2NDM0NzQ4",
      "performed_via_github_app" : null,
      "updated_at" : "2015-04-26T20:59:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/96434748",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@gavinandresen I measure around a 50 byte overhead per mruset entry now. Before, it was 50 bytes + double storage of the elements.\n",
      "created_at" : "2015-04-26T21:04:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6064#issuecomment-96435183",
      "id" : 96435183,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6064",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDk2NDM1MTgz",
      "performed_via_github_app" : null,
      "updated_at" : "2015-04-26T21:13:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/96435183",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Heading in src/mruset.h should be:\n// Copyright (c) 2012-2015 The Bitcoin Core developers\n",
      "created_at" : "2015-04-27T13:49:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6064#issuecomment-96658861",
      "id" : 96658861,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6064",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDk2NjU4ODYx",
      "performed_via_github_app" : null,
      "updated_at" : "2015-04-27T13:49:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/96658861",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6118832?v=4",
         "events_url" : "https://api.github.com/users/sandakersmann/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sandakersmann/followers",
         "following_url" : "https://api.github.com/users/sandakersmann/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sandakersmann/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sandakersmann",
         "id" : 6118832,
         "login" : "sandakersmann",
         "node_id" : "MDQ6VXNlcjYxMTg4MzI=",
         "organizations_url" : "https://api.github.com/users/sandakersmann/orgs",
         "received_events_url" : "https://api.github.com/users/sandakersmann/received_events",
         "repos_url" : "https://api.github.com/users/sandakersmann/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sandakersmann/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sandakersmann/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sandakersmann"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sandakersmann Why? It's only worked on in 2012 and 2015.\n",
      "created_at" : "2015-04-27T14:27:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6064#issuecomment-96675191",
      "id" : 96675191,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6064",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDk2Njc1MTkx",
      "performed_via_github_app" : null,
      "updated_at" : "2015-04-27T14:27:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/96675191",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@sipa Last update was in 2014.\n",
      "created_at" : "2015-04-27T14:34:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6064#issuecomment-96677819",
      "id" : 96677819,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6064",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDk2Njc3ODE5",
      "performed_via_github_app" : null,
      "updated_at" : "2015-04-27T14:34:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/96677819",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6118832?v=4",
         "events_url" : "https://api.github.com/users/sandakersmann/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sandakersmann/followers",
         "following_url" : "https://api.github.com/users/sandakersmann/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sandakersmann/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sandakersmann",
         "id" : 6118832,
         "login" : "sandakersmann",
         "node_id" : "MDQ6VXNlcjYxMTg4MzI=",
         "organizations_url" : "https://api.github.com/users/sandakersmann/orgs",
         "received_events_url" : "https://api.github.com/users/sandakersmann/received_events",
         "repos_url" : "https://api.github.com/users/sandakersmann/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sandakersmann/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sandakersmann/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sandakersmann"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sandakersmann Ok, fixed.\n",
      "created_at" : "2015-04-27T17:30:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6064#issuecomment-96751152",
      "id" : 96751152,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6064",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDk2NzUxMTUy",
      "performed_via_github_app" : null,
      "updated_at" : "2015-04-27T17:30:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/96751152",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6064#discussion_r29426121"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6064"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/29426121"
         }
      },
      "body" : "Nit: indentation",
      "commit_id" : "ab42414b8c2ddc440effcd1ab022b221365e2e27",
      "created_at" : "2015-04-30T12:57:47Z",
      "diff_hunk" : "@@ -40,6 +40,17 @@ nFlags(nFlagsIn)\n {\n }\n \n+// Private constructor used by CRollingBloomFilter\n+CBloomFilter::CBloomFilter(unsigned int nElements, double nFPRate, unsigned int nTweakIn) :\n+vData((unsigned int)(-1  / LN2SQUARED * nElements * log(nFPRate)) / 8),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6064#discussion_r29426121",
      "id" : 29426121,
      "original_commit_id" : "5f35e5be5746bbb27a1c9645c375af435b1035be",
      "original_position" : 6,
      "path" : "src/bloom.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6064",
      "updated_at" : "2015-04-30T15:00:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/29426121",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6064#discussion_r29426232"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6064"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/29426232"
         }
      },
      "body" : "Comment should be `two filters of nElements*2 each`, if I understand the above initialization correctly?",
      "commit_id" : "ab42414b8c2ddc440effcd1ab022b221365e2e27",
      "created_at" : "2015-04-30T12:59:19Z",
      "diff_hunk" : "@@ -197,3 +208,38 @@ void CBloomFilter::UpdateEmptyFull()\n     isFull = full;\n     isEmpty = empty;\n }\n+\n+CRollingBloomFilter::CRollingBloomFilter(unsigned int nElements, double fpRate, unsigned int nTweak) :\n+    b1(nElements*2, fpRate, nTweak), b2(nElements*2, fpRate, nTweak)\n+{\n+    // Implemented using two bloom filters of nElements each.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6064#discussion_r29426232",
      "id" : 29426232,
      "original_commit_id" : "5f35e5be5746bbb27a1c9645c375af435b1035be",
      "original_position" : 26,
      "path" : "src/bloom.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6064",
      "updated_at" : "2015-04-30T15:00:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/29426232",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6064#discussion_r29427076"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6064"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/29427076"
         }
      },
      "body" : "I'd prefer to wrap this counter around at nBloomSize, this avoids some `%` operations, and also avoids trouble with integer overflows when UIINT_MAX is not divisible by nBloomSize.",
      "commit_id" : "ab42414b8c2ddc440effcd1ab022b221365e2e27",
      "created_at" : "2015-04-30T13:10:49Z",
      "diff_hunk" : "@@ -197,3 +208,38 @@ void CBloomFilter::UpdateEmptyFull()\n     isFull = full;\n     isEmpty = empty;\n }\n+\n+CRollingBloomFilter::CRollingBloomFilter(unsigned int nElements, double fpRate, unsigned int nTweak) :\n+    b1(nElements*2, fpRate, nTweak), b2(nElements*2, fpRate, nTweak)\n+{\n+    // Implemented using two bloom filters of nElements each.\n+    // We fill them up, and clear them, staggered, every nElements\n+    // inserted, so at least one always contains the last nElements\n+    // inserted.\n+    nBloomSize = nElements*2;\n+    nInsertions = 0;\n+}\n+\n+void CRollingBloomFilter::insert(const std::vector<unsigned char>& vKey)\n+{\n+    if (nInsertions%nBloomSize == 0)\n+        b1.clear();\n+    else if (nInsertions%nBloomSize == nBloomSize/2)\n+        b2.clear();\n+    b1.insert(vKey);\n+    b2.insert(vKey);\n+    ++nInsertions;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6064#discussion_r29427076",
      "id" : 29427076,
      "original_commit_id" : "5f35e5be5746bbb27a1c9645c375af435b1035be",
      "original_position" : 42,
      "path" : "src/bloom.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6064",
      "updated_at" : "2015-04-30T15:00:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/29427076",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6064#discussion_r29429219"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6064"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/29429219"
         }
      },
      "body" : "This comment is no longer relevant: `contains` is self-documenting in contrast to `insert`'s second return value",
      "commit_id" : "ab42414b8c2ddc440effcd1ab022b221365e2e27",
      "created_at" : "2015-04-30T13:36:26Z",
      "diff_hunk" : "@@ -4799,8 +4799,9 @@ bool SendMessages(CNode* pto, bool fSendTrickle)\n             BOOST_FOREACH(const CAddress& addr, pto->vAddrToSend)\n             {\n                 // returns true if wasn't already contained in the set",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6064#discussion_r29429219",
      "id" : 29429219,
      "original_commit_id" : "5f35e5be5746bbb27a1c9645c375af435b1035be",
      "original_position" : 24,
      "path" : "src/main.cpp",
      "position" : 24,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6064",
      "updated_at" : "2015-04-30T15:00:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/29429219",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6064#discussion_r29429962"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6064"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/29429962"
         }
      },
      "body" : "AFAIK too. Though this is only important if we expect the size to change (become smaller) dynamically. \r\n\r\nI'm not sure I like having `clear()` double as set-maximum-size method. I'd prefer the maximum size to be passed to the constructor and be static over the lifetime of the object. If that's not possible, let's add a special `resize()` call for resizing (that happens to clear the structure too).\r\n",
      "commit_id" : "ab42414b8c2ddc440effcd1ab022b221365e2e27",
      "created_at" : "2015-04-30T13:44:56Z",
      "diff_hunk" : "@@ -22,21 +22,26 @@ class mruset\n \n protected:\n     std::set<T> set;\n-    std::deque<T> queue;\n+    std::vector<iterator> order;\n+    size_type first_used;\n+    size_type first_unused;\n     size_type nMaxSize;\n \n public:\n-    mruset(size_type nMaxSizeIn = 0) { nMaxSize = nMaxSizeIn; }\n+    mruset(size_type nMaxSizeIn = 1) { clear(nMaxSizeIn); }\n     iterator begin() const { return set.begin(); }\n     iterator end() const { return set.end(); }\n     size_type size() const { return set.size(); }\n     bool empty() const { return set.empty(); }\n     iterator find(const key_type& k) const { return set.find(k); }\n     size_type count(const key_type& k) const { return set.count(k); }\n-    void clear()\n+    void clear(size_type nMaxSizeIn = 1)\n     {\n         set.clear();\n-        queue.clear();\n+        std::vector<iterator>(nMaxSizeIn, set.end()).swap(order);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6064#discussion_r29429962",
      "id" : 29429962,
      "original_commit_id" : "8ba847459421e9786fd8c25c9303027df6b9f3d7",
      "original_position" : 39,
      "path" : "src/mruset.h",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6064",
      "updated_at" : "2015-04-30T15:00:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/29429962",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6064#discussion_r29431189"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6064"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/29431189"
         }
      },
      "body" : "I've checked that the old test still passes on the new code (a drawback of replacing the tests as well as the code that is tested :grin:)",
      "commit_id" : "ab42414b8c2ddc440effcd1ab022b221365e2e27",
      "created_at" : "2015-04-30T13:58:26Z",
      "diff_hunk" : "@@ -17,83 +17,56 @@\n \n using namespace std;\n \n-class mrutester\n-{\n-private:\n-    mruset<int> mru;\n-    std::set<int> set;\n-\n-public:\n-    mrutester() { mru.max_size(MAX_SIZE); }\n-    int size() const { return set.size(); }\n-\n-    void insert(int n)\n-    {\n-        mru.insert(n);\n-        set.insert(n);\n-        BOOST_CHECK(mru == set);\n-    }\n-};\n-\n BOOST_FIXTURE_TEST_SUITE(mruset_tests, BasicTestingSetup)\n \n-// Test that an mruset behaves like a set, as long as no more than MAX_SIZE elements are in it\n-BOOST_AUTO_TEST_CASE(mruset_like_set)\n-{\n-\n-    for (int nTest=0; nTest<NUM_TESTS; nTest++)\n-    {\n-        mrutester tester;\n-        while (tester.size() < MAX_SIZE)\n-            tester.insert(GetRandInt(2 * MAX_SIZE));\n-    }\n-\n-}\n-\n-// Test that an mruset's size never exceeds its max_size\n-BOOST_AUTO_TEST_CASE(mruset_limited_size)\n+BOOST_AUTO_TEST_CASE(mruset_test)\n {\n-    for (int nTest=0; nTest<NUM_TESTS; nTest++)\n-    {\n-        mruset<int> mru(MAX_SIZE);\n-        for (int nAction=0; nAction<3*MAX_SIZE; nAction++)\n-        {\n-            int n = GetRandInt(2 * MAX_SIZE);\n-            mru.insert(n);\n-            BOOST_CHECK(mru.size() <= MAX_SIZE);\n+    // The mruset being tested.\n+    mruset<int> mru(5000);\n+\n+    // Run the test 10 times.\n+    for (int test = 0; test < 10; test++) {\n+        // Reset mru.\n+        mru.clear(5000);\n+\n+        // A deque + set to simulate the mruset.\n+        std::deque<int> rep;\n+        std::set<int> all;\n+\n+        // Insert 10000 random integers below 15000.\n+        for (int j=0; j<10000; j++) {\n+            int add = GetRandInt(15000);\n+            mru.insert(add);\n+\n+            // Add the number to rep/all as well.\n+            if (all.count(add) == 0) {\n+               all.insert(add);\n+               rep.push_back(add);\n+               if (all.size() == 5001) {\n+                   all.erase(rep.front());\n+                   rep.pop_front();\n+               }\n+            }\n+\n+            // Do a full comparison between mru and the simulated mru every 1000 and every 5001 elements.\n+            if (j % 1000 == 0 || j % 5001 == 0) {\n+                // Check that all elements that should be in there, are in there.\n+                BOOST_FOREACH(int x, rep) {\n+                    BOOST_CHECK(mru.count(x));\n+                }\n+\n+                // Check that all elements that are in there, should be in there.\n+                BOOST_FOREACH(int x, mru) {\n+                    BOOST_CHECK(all.count(x));\n+                }\n+\n+                for (int t = 0; t < 10; t++) {\n+                    int r = GetRandInt(15000);\n+                    BOOST_CHECK(all.count(r) == mru.count(r));\n+                }\n+            }\n         }\n     }\n }\n \n-// 16-bit permutation function\n-int static permute(int n)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6064#discussion_r29431189",
      "id" : 29431189,
      "original_commit_id" : "5f35e5be5746bbb27a1c9645c375af435b1035be",
      "original_position" : 98,
      "path" : "src/test/mruset_tests.cpp",
      "position" : 107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6064",
      "updated_at" : "2015-04-30T15:00:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/29431189",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Made several changes:\n- The MRU size of mruset is now a constant (set at constructor time).\n- Restyled some of the rolling bloom filter code.\n\nI think there is a significant improvement possible to the size of the rolling bloom filter, by using a different tweak for multiple filters, and checking several filters for a 'contains'. I'll check the math and write a separate PR for that if found useful.\n",
      "created_at" : "2015-04-30T15:14:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6064#issuecomment-97833767",
      "id" : 97833767,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6064",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDk3ODMzNzY3",
      "performed_via_github_app" : null,
      "updated_at" : "2015-04-30T15:23:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/97833767",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@sipa: There's a good survey paper by Sasu Tarkoma et al:  \"Theory and Practice of Bloom Filters for Distributed Systems.\"  Which pointed me to:  https://home.kookmin.ac.kr/~mkyoon/publications/2010TKDE.pdf \n... which has a more complicated scheme (maybe similar to what you're thinking).\n",
      "created_at" : "2015-04-30T15:30:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6064#issuecomment-97839845",
      "id" : 97839845,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6064",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDk3ODM5ODQ1",
      "performed_via_github_app" : null,
      "updated_at" : "2015-04-30T15:30:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/97839845",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=4",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "node_id" : "MDQ6VXNlcjMzMTk5Nw==",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ACK\n",
      "created_at" : "2015-04-30T15:41:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6064#issuecomment-97844006",
      "id" : 97844006,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6064",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDk3ODQ0MDA2",
      "performed_via_github_app" : null,
      "updated_at" : "2015-04-30T15:41:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/97844006",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=4",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "node_id" : "MDQ6VXNlcjMzMTk5Nw==",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : ">  I think there is a significant improvement possible to the size of the rolling bloom filter, by using a different tweak for both, and checking both filters for a 'contains'. I'll check the math and write a separate PR for that if found useful.\n\n@sipa sounds great to me, although let's do that in a later pull, this is already a great improvement compared to the current state, so let's get this reviewed and merged.\n",
      "created_at" : "2015-05-01T05:09:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6064#issuecomment-98046318",
      "id" : 98046318,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6064",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDk4MDQ2MzE4",
      "performed_via_github_app" : null,
      "updated_at" : "2015-05-01T05:09:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/98046318",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Tested ACK\n",
      "created_at" : "2015-05-01T10:52:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6064#issuecomment-98099469",
      "id" : 98099469,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6064",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDk4MDk5NDY5",
      "performed_via_github_app" : null,
      "updated_at" : "2015-05-01T10:52:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/98099469",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
