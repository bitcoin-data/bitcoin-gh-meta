[
   {
      "body" : "Nice! I'm glad you looked at this.\r\n\r\nThe way you checked `pindexRescan` isn't sufficient however.  You can't assume a pruned node has all the blocks past a certain point.  Blocks are deleted from disk in the order they were written, which doesn't necessarily correspond with order in the chain.  But perhaps you could scan backwards from the Tip until you get to either `pindexRescan` or one which isn't BLOCK_HAVE_DATA.",
      "created_at" : "2015-04-24T20:18:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6057#issuecomment-96052286",
      "id" : 96052286,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6057",
      "updated_at" : "2015-04-24T20:18:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/96052286",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "Right. I did ignore the fact that blocks are not fly in in order. Will change it to your proposed way of scanning backwards.\r\n\r\n~~Same needs to be done for #6058~~ (edit: already correct there)",
      "created_at" : "2015-04-24T20:26:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6057#issuecomment-96054772",
      "id" : 96054772,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6057",
      "updated_at" : "2015-04-26T21:32:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/96054772",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6057#discussion_r29092036"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6057"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/29092036"
         }
      },
      "body" : "This message is unclear to me. Do you mean:\r\n\"Rescans are not possible in pruned mode. You will need to use -reindex which will download the whole blockchain again.\"?",
      "commit_id" : "7e6569ea5be8cb26454ede3efb6a50b393aaa9be",
      "created_at" : "2015-04-24T22:47:45Z",
      "diff_hunk" : "@@ -703,16 +703,12 @@ bool AppInit2(boost::thread_group& threadGroup)\n         nMaxConnections = nFD - MIN_CORE_FILEDESCRIPTORS;\n \n     // if using block pruning, then disable txindex\n-    // also disable the wallet (for now, until SPV support is implemented in wallet)\n     if (GetArg(\"-prune\", 0)) {\n         if (GetBoolArg(\"-txindex\", false))\n             return InitError(_(\"Prune mode is incompatible with -txindex.\"));\n #ifdef ENABLE_WALLET\n-        if (!GetBoolArg(\"-disablewallet\", false)) {\n-            if (SoftSetBoolArg(\"-disablewallet\", true))\n-                LogPrintf(\"%s : parameter interaction: -prune -> setting -disablewallet=1\\n\", __func__);\n-            else\n-                return InitError(_(\"Can't run with a wallet in prune mode.\"));\n+        if (GetBoolArg(\"-rescan\", false)) {\n+            return InitError(_(\"Rescans are not possible in pruned mode. You might use -reindex which then download the whole blockchain again.\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6057#discussion_r29092036",
      "id" : 29092036,
      "original_commit_id" : "37cf0f43fde1c87fe6ee056ce69d93f0d425eef9",
      "original_position" : 24,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6057",
      "updated_at" : "2015-05-28T07:00:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/29092036",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/429961?v=3",
         "events_url" : "https://api.github.com/users/PRabahy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/PRabahy/followers",
         "following_url" : "https://api.github.com/users/PRabahy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/PRabahy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/PRabahy",
         "id" : 429961,
         "login" : "PRabahy",
         "organizations_url" : "https://api.github.com/users/PRabahy/orgs",
         "received_events_url" : "https://api.github.com/users/PRabahy/received_events",
         "repos_url" : "https://api.github.com/users/PRabahy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/PRabahy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/PRabahy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/PRabahy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6057#discussion_r29098551"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6057"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/29098551"
         }
      },
      "body" : "Thanks!\r\nEnglish is not my mother language and I always struggle with it.\r\nFeel free to also correct/rewrite the other warnings and errors (as well as the code comments).",
      "commit_id" : "7e6569ea5be8cb26454ede3efb6a50b393aaa9be",
      "created_at" : "2015-04-25T06:59:23Z",
      "diff_hunk" : "@@ -703,16 +703,12 @@ bool AppInit2(boost::thread_group& threadGroup)\n         nMaxConnections = nFD - MIN_CORE_FILEDESCRIPTORS;\n \n     // if using block pruning, then disable txindex\n-    // also disable the wallet (for now, until SPV support is implemented in wallet)\n     if (GetArg(\"-prune\", 0)) {\n         if (GetBoolArg(\"-txindex\", false))\n             return InitError(_(\"Prune mode is incompatible with -txindex.\"));\n #ifdef ENABLE_WALLET\n-        if (!GetBoolArg(\"-disablewallet\", false)) {\n-            if (SoftSetBoolArg(\"-disablewallet\", true))\n-                LogPrintf(\"%s : parameter interaction: -prune -> setting -disablewallet=1\\n\", __func__);\n-            else\n-                return InitError(_(\"Can't run with a wallet in prune mode.\"));\n+        if (GetBoolArg(\"-rescan\", false)) {\n+            return InitError(_(\"Rescans are not possible in pruned mode. You might use -reindex which then download the whole blockchain again.\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6057#discussion_r29098551",
      "id" : 29098551,
      "original_commit_id" : "37cf0f43fde1c87fe6ee056ce69d93f0d425eef9",
      "original_position" : 24,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6057",
      "updated_at" : "2015-05-28T07:00:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/29098551",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Fixed `pindexRescan` check mentioned by @morcos.",
      "created_at" : "2015-04-26T12:52:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6057#issuecomment-96374657",
      "id" : 96374657,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6057",
      "updated_at" : "2015-04-26T12:52:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/96374657",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Concept & code review ACK, but this definitely needs testing.",
      "created_at" : "2015-04-27T12:30:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6057#issuecomment-96632339",
      "id" : 96632339,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6057",
      "updated_at" : "2015-04-27T12:30:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/96632339",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Also applied an additional test during wallet catchup-rescan if the previous block has TXs but no data to be sure we have pruned this block.",
      "created_at" : "2015-04-29T11:32:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6057#issuecomment-97393680",
      "id" : 97393680,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6057",
      "updated_at" : "2015-04-29T11:32:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/97393680",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Rebased.",
      "created_at" : "2015-05-28T07:01:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6057#issuecomment-106201584",
      "id" : 106201584,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6057",
      "updated_at" : "2015-05-28T07:01:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/106201584",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6057#discussion_r31490030"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6057"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/31490030"
         }
      },
      "body" : "What prevents this error if the user has passed -reindex? In particular, a pruned node may not have the space for the whole blockchain, and may need to redownload it with pruning enabled.\r\n\r\n(... btw, does -reindex actually work correctly with pruned data? I think last time I tried, it ignored blocks after the first missing one, and redownloaded/reappended them...)",
      "commit_id" : "7e6569ea5be8cb26454ede3efb6a50b393aaa9be",
      "created_at" : "2015-06-02T02:58:00Z",
      "diff_hunk" : "@@ -714,16 +714,12 @@ bool AppInit2(boost::thread_group& threadGroup, CScheduler& scheduler)\n         nMaxConnections = nFD - MIN_CORE_FILEDESCRIPTORS;\n \n     // if using block pruning, then disable txindex\n-    // also disable the wallet (for now, until SPV support is implemented in wallet)\n     if (GetArg(\"-prune\", 0)) {\n         if (GetBoolArg(\"-txindex\", false))\n             return InitError(_(\"Prune mode is incompatible with -txindex.\"));\n #ifdef ENABLE_WALLET\n-        if (!GetBoolArg(\"-disablewallet\", false)) {\n-            if (SoftSetBoolArg(\"-disablewallet\", true))\n-                LogPrintf(\"%s : parameter interaction: -prune -> setting -disablewallet=1\\n\", __func__);\n-            else\n-                return InitError(_(\"Can't run with a wallet in prune mode.\"));\n+        if (GetBoolArg(\"-rescan\", false)) {\n+            return InitError(_(\"Rescans are not possible in pruned mode. You will need to use -reindex which will download the whole blockchain again.\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6057#discussion_r31490030",
      "id" : 31490030,
      "original_commit_id" : "7e6569ea5be8cb26454ede3efb6a50b393aaa9be",
      "original_position" : 15,
      "path" : "src/init.cpp",
      "position" : 15,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6057",
      "updated_at" : "2015-06-02T02:58:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/31490030",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "utACK.\r\n",
      "created_at" : "2015-06-10T10:32:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6057#issuecomment-110689301",
      "id" : 110689301,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6057",
      "updated_at" : "2015-06-10T10:32:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/110689301",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
