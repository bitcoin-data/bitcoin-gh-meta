[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r385714744"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385714744"
         }
      },
      "author_association" : "NONE",
      "body" : "```suggestion\r\n    // Filter 1 is reserved as an option to include all filters.\r\n```",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-02-28T14:09:53Z",
      "diff_hunk" : "@@ -88,6 +88,8 @@ constexpr uint32_t BASIC_FILTER_M = 784931;\n enum class BlockFilterType : uint8_t\n {\n     BASIC = 0,\n+    // Floter 1 is reserved as option to include all filters",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r385714744",
      "id" : 385714744,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcxNDc0NA==",
      "original_commit_id" : "19b9959a3c02dc9cb98740d5740e709b971e0c03",
      "original_position" : 4,
      "path" : "src/blockfilter.h",
      "position" : null,
      "pull_request_review_id" : 366421997,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385714744",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/9844978?v=4",
         "events_url" : "https://api.github.com/users/molnard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/molnard/followers",
         "following_url" : "https://api.github.com/users/molnard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/molnard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/molnard",
         "id" : 9844978,
         "login" : "molnard",
         "node_id" : "MDQ6VXNlcjk4NDQ5Nzg=",
         "organizations_url" : "https://api.github.com/users/molnard/orgs",
         "received_events_url" : "https://api.github.com/users/molnard/received_events",
         "repos_url" : "https://api.github.com/users/molnard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/molnard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/molnard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/molnard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r385715107"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385715107"
         }
      },
      "author_association" : "NONE",
      "body" : "```suggestion\r\n        // Using the same filter params as basic type.\r\n```",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-02-28T14:10:41Z",
      "diff_hunk" : "@@ -309,6 +347,13 @@ bool BlockFilter::BuildParams(GCSFilter::Params& params) const\n         params.m_P = BASIC_FILTER_P;\n         params.m_M = BASIC_FILTER_M;\n         return true;\n+    case BlockFilterType::P2WPKH:\n+        params.m_siphash_k0 = m_block_hash.GetUint64(0);\n+        params.m_siphash_k1 = m_block_hash.GetUint64(1);\n+        // using the same filter params as basic type",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r385715107",
      "id" : 385715107,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcxNTEwNw==",
      "original_commit_id" : "19b9959a3c02dc9cb98740d5740e709b971e0c03",
      "original_position" : 75,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 366421997,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385715107",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/9844978?v=4",
         "events_url" : "https://api.github.com/users/molnard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/molnard/followers",
         "following_url" : "https://api.github.com/users/molnard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/molnard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/molnard",
         "id" : 9844978,
         "login" : "molnard",
         "node_id" : "MDQ6VXNlcjk4NDQ5Nzg=",
         "organizations_url" : "https://api.github.com/users/molnard/orgs",
         "received_events_url" : "https://api.github.com/users/molnard/received_events",
         "repos_url" : "https://api.github.com/users/molnard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/molnard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/molnard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/molnard"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Note this PR and its accompanying issue (https://github.com/bitcoin/bitcoin/issues/18221) conforms to the original BIP157 filter extensibility proposal (https://github.com/bitcoin/bips/blob/master/bip-0157.mediawiki#filter-types) and to the proposal I submitted about filter combinations too: https://github.com/bitcoin/bitcoin/issues/18221",
      "created_at" : "2020-02-28T14:40:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-592542243",
      "id" : 592542243,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MjU0MjI0Mw==",
      "updated_at" : "2020-02-28T14:41:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/592542243",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/9156103?v=4",
         "events_url" : "https://api.github.com/users/nopara73/events{/privacy}",
         "followers_url" : "https://api.github.com/users/nopara73/followers",
         "following_url" : "https://api.github.com/users/nopara73/following{/other_user}",
         "gists_url" : "https://api.github.com/users/nopara73/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/nopara73",
         "id" : 9156103,
         "login" : "nopara73",
         "node_id" : "MDQ6VXNlcjkxNTYxMDM=",
         "organizations_url" : "https://api.github.com/users/nopara73/orgs",
         "received_events_url" : "https://api.github.com/users/nopara73/received_events",
         "repos_url" : "https://api.github.com/users/nopara73/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/nopara73/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/nopara73/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/nopara73"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "For the record there is a discussion about that probably it should combine both P2WPKH and P2WSH scripts: https://github.com/bitcoin/bitcoin/issues/18222#issuecomment-592631517",
      "created_at" : "2020-02-28T17:40:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-592644104",
      "id" : 592644104,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MjY0NDEwNA==",
      "updated_at" : "2020-02-28T17:40:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/592644104",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/9156103?v=4",
         "events_url" : "https://api.github.com/users/nopara73/events{/privacy}",
         "followers_url" : "https://api.github.com/users/nopara73/followers",
         "following_url" : "https://api.github.com/users/nopara73/following{/other_user}",
         "gists_url" : "https://api.github.com/users/nopara73/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/nopara73",
         "id" : 9156103,
         "login" : "nopara73",
         "node_id" : "MDQ6VXNlcjkxNTYxMDM=",
         "organizations_url" : "https://api.github.com/users/nopara73/orgs",
         "received_events_url" : "https://api.github.com/users/nopara73/received_events",
         "repos_url" : "https://api.github.com/users/nopara73/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/nopara73/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/nopara73/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/nopara73"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386119285"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386119285"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`enumeration value 'INVALID' not handled in switch`. I guess in this case `default: assert(false)` would be appropriate?",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-01T15:58:55Z",
      "diff_hunk" : "@@ -297,7 +329,15 @@ BlockFilter::BlockFilter(BlockFilterType filter_type, const CBlock& block, const\n     if (!BuildParams(params)) {\n         throw std::invalid_argument(\"unknown filter_type\");\n     }\n-    m_filter = GCSFilter(params, BasicFilterElements(block, block_undo));\n+\n+    switch (m_filter_type) {\n+    case BlockFilterType::BASIC:\n+        m_filter = GCSFilter(params, BasicFilterElements(block, block_undo));\n+        break;\n+    case BlockFilterType::V0:\n+        m_filter = GCSFilter(params, V0FilterElements(block, block_undo));\n+        break;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386119285",
      "id" : 386119285,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjExOTI4NQ==",
      "original_commit_id" : "22b2ac6c38a870d59d18e8d2d7a0337dc63c86a5",
      "original_position" : 66,
      "path" : "src/blockfilter.cpp",
      "position" : 72,
      "pull_request_review_id" : 366868739,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386119285",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386120193"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386120193"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This case is identical to `BlockFilterType::BASIC`, so you can avoid the duplication.",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-01T16:12:43Z",
      "diff_hunk" : "@@ -309,6 +349,13 @@ bool BlockFilter::BuildParams(GCSFilter::Params& params) const\n         params.m_P = BASIC_FILTER_P;\n         params.m_M = BASIC_FILTER_M;\n         return true;\n+    case BlockFilterType::V0:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386120193",
      "id" : 386120193,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEyMDE5Mw==",
      "original_commit_id" : "22b2ac6c38a870d59d18e8d2d7a0337dc63c86a5",
      "original_position" : 74,
      "path" : "src/blockfilter.cpp",
      "position" : 79,
      "pull_request_review_id" : 366868739,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386120193",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386120440"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386120440"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Instead of this new function, maybe just add these four lines to `BasicFilterElements` (after the `OP_RETURN` check) and give that two additional arguments `bool only_segwit = true, int witness_version = 0`",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-01T16:16:26Z",
      "diff_hunk" : "@@ -279,6 +281,36 @@ static GCSFilter::ElementSet BasicFilterElements(const CBlock& block,\n     return elements;\n }\n \n+static GCSFilter::ElementSet V0FilterElements(const CBlock& block,\n+    const CBlockUndo& block_undo)\n+{\n+    GCSFilter::ElementSet elements;\n+\n+    for (const CTransactionRef& tx : block.vtx) {\n+        for (const CTxOut& txout : tx->vout) {\n+            const CScript& scriptPubKey = txout.scriptPubKey;\n+            int witnessversion;\n+            std::vector<unsigned char> witnessprogram;\n+            if (scriptPubKey.empty() || !scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+            if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE)))  continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386120440",
      "id" : 386120440,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEyMDQ0MA==",
      "original_commit_id" : "22b2ac6c38a870d59d18e8d2d7a0337dc63c86a5",
      "original_position" : 31,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 366868739,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386120440",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386120920"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386120920"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The `basic` filter undo code doesn't have a check for `OP_RETURN`. @jimpo was that because the difference on undo data is negligible? I suppose that's not the case here though, but then I'd prefer adding OP_RETURN as well for readability.",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-01T16:23:42Z",
      "diff_hunk" : "@@ -279,6 +281,36 @@ static GCSFilter::ElementSet BasicFilterElements(const CBlock& block,\n     return elements;\n }\n \n+static GCSFilter::ElementSet V0FilterElements(const CBlock& block,\n+    const CBlockUndo& block_undo)\n+{\n+    GCSFilter::ElementSet elements;\n+\n+    for (const CTransactionRef& tx : block.vtx) {\n+        for (const CTxOut& txout : tx->vout) {\n+            const CScript& scriptPubKey = txout.scriptPubKey;\n+            int witnessversion;\n+            std::vector<unsigned char> witnessprogram;\n+            if (scriptPubKey.empty() || !scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+            if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE)))  continue;\n+            elements.emplace(scriptPubKey.begin(), scriptPubKey.end());\n+        }\n+    }\n+\n+    for (const CTxUndo& tx_undo : block_undo.vtxundo) {\n+        for (const Coin& prevout : tx_undo.vprevout) {\n+            const CScript& scriptPubKey = prevout.out.scriptPubKey;\n+            int witnessversion;\n+            std::vector<unsigned char> witnessprogram;\n+            if (scriptPubKey.empty() || !scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+            if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE))) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386120920",
      "id" : 386120920,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEyMDkyMA==",
      "original_commit_id" : "22b2ac6c38a870d59d18e8d2d7a0337dc63c86a5",
      "original_position" : 42,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 366868739,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386120920",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386153251"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386153251"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ah good point, will fix.",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-01T23:42:59Z",
      "diff_hunk" : "@@ -309,6 +349,13 @@ bool BlockFilter::BuildParams(GCSFilter::Params& params) const\n         params.m_P = BASIC_FILTER_P;\n         params.m_M = BASIC_FILTER_M;\n         return true;\n+    case BlockFilterType::V0:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386153251",
      "id" : 386153251,
      "in_reply_to_id" : 386120193,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjE1MzI1MQ==",
      "original_commit_id" : "22b2ac6c38a870d59d18e8d2d7a0337dc63c86a5",
      "original_position" : 74,
      "path" : "src/blockfilter.cpp",
      "position" : 79,
      "pull_request_review_id" : 366898357,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386153251",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7487930?v=4",
         "events_url" : "https://api.github.com/users/dangershony/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dangershony/followers",
         "following_url" : "https://api.github.com/users/dangershony/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dangershony/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dangershony",
         "id" : 7487930,
         "login" : "dangershony",
         "node_id" : "MDQ6VXNlcjc0ODc5MzA=",
         "organizations_url" : "https://api.github.com/users/dangershony/orgs",
         "received_events_url" : "https://api.github.com/users/dangershony/received_events",
         "repos_url" : "https://api.github.com/users/dangershony/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dangershony/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dangershony/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dangershony"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386153357"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386153357"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It's handled in the code above so I left it out, but for best practice I agree so I'll add an assert as suggested.",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-01T23:44:29Z",
      "diff_hunk" : "@@ -297,7 +329,15 @@ BlockFilter::BlockFilter(BlockFilterType filter_type, const CBlock& block, const\n     if (!BuildParams(params)) {\n         throw std::invalid_argument(\"unknown filter_type\");\n     }\n-    m_filter = GCSFilter(params, BasicFilterElements(block, block_undo));\n+\n+    switch (m_filter_type) {\n+    case BlockFilterType::BASIC:\n+        m_filter = GCSFilter(params, BasicFilterElements(block, block_undo));\n+        break;\n+    case BlockFilterType::V0:\n+        m_filter = GCSFilter(params, V0FilterElements(block, block_undo));\n+        break;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386153357",
      "id" : 386153357,
      "in_reply_to_id" : 386119285,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjE1MzM1Nw==",
      "original_commit_id" : "22b2ac6c38a870d59d18e8d2d7a0337dc63c86a5",
      "original_position" : 66,
      "path" : "src/blockfilter.cpp",
      "position" : 72,
      "pull_request_review_id" : 366898468,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386153357",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7487930?v=4",
         "events_url" : "https://api.github.com/users/dangershony/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dangershony/followers",
         "following_url" : "https://api.github.com/users/dangershony/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dangershony/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dangershony",
         "id" : 7487930,
         "login" : "dangershony",
         "node_id" : "MDQ6VXNlcjc0ODc5MzA=",
         "organizations_url" : "https://api.github.com/users/dangershony/orgs",
         "received_events_url" : "https://api.github.com/users/dangershony/received_events",
         "repos_url" : "https://api.github.com/users/dangershony/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dangershony/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dangershony/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dangershony"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386153713"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386153713"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Is `opreturn` not already filtered out with the witness check?\r\nOr you mean to add the `opreturn` check to the blockundo on the code of the `basic` filter type?",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-01T23:48:57Z",
      "diff_hunk" : "@@ -279,6 +281,36 @@ static GCSFilter::ElementSet BasicFilterElements(const CBlock& block,\n     return elements;\n }\n \n+static GCSFilter::ElementSet V0FilterElements(const CBlock& block,\n+    const CBlockUndo& block_undo)\n+{\n+    GCSFilter::ElementSet elements;\n+\n+    for (const CTransactionRef& tx : block.vtx) {\n+        for (const CTxOut& txout : tx->vout) {\n+            const CScript& scriptPubKey = txout.scriptPubKey;\n+            int witnessversion;\n+            std::vector<unsigned char> witnessprogram;\n+            if (scriptPubKey.empty() || !scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+            if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE)))  continue;\n+            elements.emplace(scriptPubKey.begin(), scriptPubKey.end());\n+        }\n+    }\n+\n+    for (const CTxUndo& tx_undo : block_undo.vtxundo) {\n+        for (const Coin& prevout : tx_undo.vprevout) {\n+            const CScript& scriptPubKey = prevout.out.scriptPubKey;\n+            int witnessversion;\n+            std::vector<unsigned char> witnessprogram;\n+            if (scriptPubKey.empty() || !scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+            if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE))) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386153713",
      "id" : 386153713,
      "in_reply_to_id" : 386120920,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjE1MzcxMw==",
      "original_commit_id" : "22b2ac6c38a870d59d18e8d2d7a0337dc63c86a5",
      "original_position" : 42,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 366898833,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386153713",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7487930?v=4",
         "events_url" : "https://api.github.com/users/dangershony/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dangershony/followers",
         "following_url" : "https://api.github.com/users/dangershony/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dangershony/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dangershony",
         "id" : 7487930,
         "login" : "dangershony",
         "node_id" : "MDQ6VXNlcjc0ODc5MzA=",
         "organizations_url" : "https://api.github.com/users/dangershony/orgs",
         "received_events_url" : "https://api.github.com/users/dangershony/received_events",
         "repos_url" : "https://api.github.com/users/dangershony/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dangershony/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dangershony/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dangershony"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386154075"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386154075"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In that case the method name should change to `BuildFilterElements` no?",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-01T23:53:17Z",
      "diff_hunk" : "@@ -279,6 +281,36 @@ static GCSFilter::ElementSet BasicFilterElements(const CBlock& block,\n     return elements;\n }\n \n+static GCSFilter::ElementSet V0FilterElements(const CBlock& block,\n+    const CBlockUndo& block_undo)\n+{\n+    GCSFilter::ElementSet elements;\n+\n+    for (const CTransactionRef& tx : block.vtx) {\n+        for (const CTxOut& txout : tx->vout) {\n+            const CScript& scriptPubKey = txout.scriptPubKey;\n+            int witnessversion;\n+            std::vector<unsigned char> witnessprogram;\n+            if (scriptPubKey.empty() || !scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+            if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE)))  continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386154075",
      "id" : 386154075,
      "in_reply_to_id" : 386120440,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjE1NDA3NQ==",
      "original_commit_id" : "22b2ac6c38a870d59d18e8d2d7a0337dc63c86a5",
      "original_position" : 31,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 366899206,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386154075",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7487930?v=4",
         "events_url" : "https://api.github.com/users/dangershony/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dangershony/followers",
         "following_url" : "https://api.github.com/users/dangershony/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dangershony/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dangershony",
         "id" : 7487930,
         "login" : "dangershony",
         "node_id" : "MDQ6VXNlcjc0ODc5MzA=",
         "organizations_url" : "https://api.github.com/users/dangershony/orgs",
         "received_events_url" : "https://api.github.com/users/dangershony/received_events",
         "repos_url" : "https://api.github.com/users/dangershony/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dangershony/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dangershony/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dangershony"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386249968"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386249968"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If you combine this with the code from the `basic` filter then it's probably more readable to `OP_RETURN` back for that as well (assuming that doesn't break anything). For the `v0` filter it indeed doesn't matter.",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-02T08:26:58Z",
      "diff_hunk" : "@@ -279,6 +281,36 @@ static GCSFilter::ElementSet BasicFilterElements(const CBlock& block,\n     return elements;\n }\n \n+static GCSFilter::ElementSet V0FilterElements(const CBlock& block,\n+    const CBlockUndo& block_undo)\n+{\n+    GCSFilter::ElementSet elements;\n+\n+    for (const CTransactionRef& tx : block.vtx) {\n+        for (const CTxOut& txout : tx->vout) {\n+            const CScript& scriptPubKey = txout.scriptPubKey;\n+            int witnessversion;\n+            std::vector<unsigned char> witnessprogram;\n+            if (scriptPubKey.empty() || !scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+            if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE)))  continue;\n+            elements.emplace(scriptPubKey.begin(), scriptPubKey.end());\n+        }\n+    }\n+\n+    for (const CTxUndo& tx_undo : block_undo.vtxundo) {\n+        for (const Coin& prevout : tx_undo.vprevout) {\n+            const CScript& scriptPubKey = prevout.out.scriptPubKey;\n+            int witnessversion;\n+            std::vector<unsigned char> witnessprogram;\n+            if (scriptPubKey.empty() || !scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+            if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE))) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386249968",
      "id" : 386249968,
      "in_reply_to_id" : 386120920,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjI0OTk2OA==",
      "original_commit_id" : "22b2ac6c38a870d59d18e8d2d7a0337dc63c86a5",
      "original_position" : 42,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 367015351,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386249968",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "You may want to squash all this into 1 commit (perhaps a separate commit to add `OP_RETURN` to the `basic` undo filter).",
      "created_at" : "2020-03-02T08:31:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-593281427",
      "id" : 593281427,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MzI4MTQyNw==",
      "updated_at" : "2020-03-02T08:31:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/593281427",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386356988"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386356988"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Shall I add the `OP_RETURN ` check also on the spent script then? I agree with you I see no reason why it's omitted.",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-02T12:11:56Z",
      "diff_hunk" : "@@ -279,6 +281,36 @@ static GCSFilter::ElementSet BasicFilterElements(const CBlock& block,\n     return elements;\n }\n \n+static GCSFilter::ElementSet V0FilterElements(const CBlock& block,\n+    const CBlockUndo& block_undo)\n+{\n+    GCSFilter::ElementSet elements;\n+\n+    for (const CTransactionRef& tx : block.vtx) {\n+        for (const CTxOut& txout : tx->vout) {\n+            const CScript& scriptPubKey = txout.scriptPubKey;\n+            int witnessversion;\n+            std::vector<unsigned char> witnessprogram;\n+            if (scriptPubKey.empty() || !scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+            if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE)))  continue;\n+            elements.emplace(scriptPubKey.begin(), scriptPubKey.end());\n+        }\n+    }\n+\n+    for (const CTxUndo& tx_undo : block_undo.vtxundo) {\n+        for (const Coin& prevout : tx_undo.vprevout) {\n+            const CScript& scriptPubKey = prevout.out.scriptPubKey;\n+            int witnessversion;\n+            std::vector<unsigned char> witnessprogram;\n+            if (scriptPubKey.empty() || !scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+            if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE))) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386356988",
      "id" : 386356988,
      "in_reply_to_id" : 386120920,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjM1Njk4OA==",
      "original_commit_id" : "22b2ac6c38a870d59d18e8d2d7a0337dc63c86a5",
      "original_position" : 42,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 367152205,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386356988",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7487930?v=4",
         "events_url" : "https://api.github.com/users/dangershony/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dangershony/followers",
         "following_url" : "https://api.github.com/users/dangershony/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dangershony/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dangershony",
         "id" : 7487930,
         "login" : "dangershony",
         "node_id" : "MDQ6VXNlcjc0ODc5MzA=",
         "organizations_url" : "https://api.github.com/users/dangershony/orgs",
         "received_events_url" : "https://api.github.com/users/dangershony/received_events",
         "repos_url" : "https://api.github.com/users/dangershony/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dangershony/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dangershony/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dangershony"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386357964"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386357964"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Any particular reason why defaulting segwit to true?",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-02T12:14:24Z",
      "diff_hunk" : "@@ -279,6 +281,36 @@ static GCSFilter::ElementSet BasicFilterElements(const CBlock& block,\n     return elements;\n }\n \n+static GCSFilter::ElementSet V0FilterElements(const CBlock& block,\n+    const CBlockUndo& block_undo)\n+{\n+    GCSFilter::ElementSet elements;\n+\n+    for (const CTransactionRef& tx : block.vtx) {\n+        for (const CTxOut& txout : tx->vout) {\n+            const CScript& scriptPubKey = txout.scriptPubKey;\n+            int witnessversion;\n+            std::vector<unsigned char> witnessprogram;\n+            if (scriptPubKey.empty() || !scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+            if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE)))  continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386357964",
      "id" : 386357964,
      "in_reply_to_id" : 386120440,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjM1Nzk2NA==",
      "original_commit_id" : "22b2ac6c38a870d59d18e8d2d7a0337dc63c86a5",
      "original_position" : 31,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 367153538,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386357964",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7487930?v=4",
         "events_url" : "https://api.github.com/users/dangershony/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dangershony/followers",
         "following_url" : "https://api.github.com/users/dangershony/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dangershony/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dangershony",
         "id" : 7487930,
         "login" : "dangershony",
         "node_id" : "MDQ6VXNlcjc0ODc5MzA=",
         "organizations_url" : "https://api.github.com/users/dangershony/orgs",
         "received_events_url" : "https://api.github.com/users/dangershony/received_events",
         "repos_url" : "https://api.github.com/users/dangershony/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dangershony/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dangershony/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dangershony"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386392290"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386392290"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-02T13:30:14Z",
      "diff_hunk" : "@@ -279,6 +281,36 @@ static GCSFilter::ElementSet BasicFilterElements(const CBlock& block,\n     return elements;\n }\n \n+static GCSFilter::ElementSet V0FilterElements(const CBlock& block,\n+    const CBlockUndo& block_undo)\n+{\n+    GCSFilter::ElementSet elements;\n+\n+    for (const CTransactionRef& tx : block.vtx) {\n+        for (const CTxOut& txout : tx->vout) {\n+            const CScript& scriptPubKey = txout.scriptPubKey;\n+            int witnessversion;\n+            std::vector<unsigned char> witnessprogram;\n+            if (scriptPubKey.empty() || !scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+            if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE)))  continue;\n+            elements.emplace(scriptPubKey.begin(), scriptPubKey.end());\n+        }\n+    }\n+\n+    for (const CTxUndo& tx_undo : block_undo.vtxundo) {\n+        for (const Coin& prevout : tx_undo.vprevout) {\n+            const CScript& scriptPubKey = prevout.out.scriptPubKey;\n+            int witnessversion;\n+            std::vector<unsigned char> witnessprogram;\n+            if (scriptPubKey.empty() || !scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+            if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE))) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386392290",
      "id" : 386392290,
      "in_reply_to_id" : 386120920,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjM5MjI5MA==",
      "original_commit_id" : "22b2ac6c38a870d59d18e8d2d7a0337dc63c86a5",
      "original_position" : 42,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 367197446,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386392290",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7487930?v=4",
         "events_url" : "https://api.github.com/users/dangershony/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dangershony/followers",
         "following_url" : "https://api.github.com/users/dangershony/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dangershony/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dangershony",
         "id" : 7487930,
         "login" : "dangershony",
         "node_id" : "MDQ6VXNlcjc0ODc5MzA=",
         "organizations_url" : "https://api.github.com/users/dangershony/orgs",
         "received_events_url" : "https://api.github.com/users/dangershony/received_events",
         "repos_url" : "https://api.github.com/users/dangershony/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dangershony/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dangershony/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dangershony"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386392348"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386392348"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-02T13:30:20Z",
      "diff_hunk" : "@@ -279,6 +281,36 @@ static GCSFilter::ElementSet BasicFilterElements(const CBlock& block,\n     return elements;\n }\n \n+static GCSFilter::ElementSet V0FilterElements(const CBlock& block,\n+    const CBlockUndo& block_undo)\n+{\n+    GCSFilter::ElementSet elements;\n+\n+    for (const CTransactionRef& tx : block.vtx) {\n+        for (const CTxOut& txout : tx->vout) {\n+            const CScript& scriptPubKey = txout.scriptPubKey;\n+            int witnessversion;\n+            std::vector<unsigned char> witnessprogram;\n+            if (scriptPubKey.empty() || !scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+            if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE)))  continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386392348",
      "id" : 386392348,
      "in_reply_to_id" : 386120440,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjM5MjM0OA==",
      "original_commit_id" : "22b2ac6c38a870d59d18e8d2d7a0337dc63c86a5",
      "original_position" : 31,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 367197520,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386392348",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7487930?v=4",
         "events_url" : "https://api.github.com/users/dangershony/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dangershony/followers",
         "following_url" : "https://api.github.com/users/dangershony/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dangershony/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dangershony",
         "id" : 7487930,
         "login" : "dangershony",
         "node_id" : "MDQ6VXNlcjc0ODc5MzA=",
         "organizations_url" : "https://api.github.com/users/dangershony/orgs",
         "received_events_url" : "https://api.github.com/users/dangershony/received_events",
         "repos_url" : "https://api.github.com/users/dangershony/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dangershony/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dangershony/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dangershony"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386400668"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386400668"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No, it should be `false` I think (basic filter is the default)",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-02T13:46:29Z",
      "diff_hunk" : "@@ -279,6 +281,36 @@ static GCSFilter::ElementSet BasicFilterElements(const CBlock& block,\n     return elements;\n }\n \n+static GCSFilter::ElementSet V0FilterElements(const CBlock& block,\n+    const CBlockUndo& block_undo)\n+{\n+    GCSFilter::ElementSet elements;\n+\n+    for (const CTransactionRef& tx : block.vtx) {\n+        for (const CTxOut& txout : tx->vout) {\n+            const CScript& scriptPubKey = txout.scriptPubKey;\n+            int witnessversion;\n+            std::vector<unsigned char> witnessprogram;\n+            if (scriptPubKey.empty() || !scriptPubKey.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+            if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE)))  continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r386400668",
      "id" : 386400668,
      "in_reply_to_id" : 386120440,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjQwMDY2OA==",
      "original_commit_id" : "22b2ac6c38a870d59d18e8d2d7a0337dc63c86a5",
      "original_position" : 31,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 367208262,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386400668",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thank you @Sjors for your helpful review, I will squash the commits when there is a general ack.",
      "created_at" : "2020-03-02T21:41:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-593637564",
      "id" : 593637564,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MzYzNzU2NA==",
      "updated_at" : "2020-03-02T21:41:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/593637564",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7487930?v=4",
         "events_url" : "https://api.github.com/users/dangershony/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dangershony/followers",
         "following_url" : "https://api.github.com/users/dangershony/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dangershony/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dangershony",
         "id" : 7487930,
         "login" : "dangershony",
         "node_id" : "MDQ6VXNlcjc0ODc5MzA=",
         "organizations_url" : "https://api.github.com/users/dangershony/orgs",
         "received_events_url" : "https://api.github.com/users/dangershony/received_events",
         "repos_url" : "https://api.github.com/users/dangershony/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dangershony/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dangershony/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dangershony"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Tend to NACK. I fail to see a use case for this, and a missing use case does not justify the time spent on code review and the resulting complexity/user confusion and maintenance overhead when this is merged.",
      "created_at" : "2020-03-03T11:25:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-593903472",
      "id" : 593903472,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MzkwMzQ3Mg==",
      "updated_at" : "2020-03-03T11:25:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/593903472",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "What do you mean no use case? It's already being used and in production for 1.5 years now.",
      "created_at" : "2020-03-03T17:17:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-594065664",
      "id" : 594065664,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NDA2NTY2NA==",
      "updated_at" : "2020-03-03T17:17:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/594065664",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/9156103?v=4",
         "events_url" : "https://api.github.com/users/nopara73/events{/privacy}",
         "followers_url" : "https://api.github.com/users/nopara73/followers",
         "following_url" : "https://api.github.com/users/nopara73/following{/other_user}",
         "gists_url" : "https://api.github.com/users/nopara73/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/nopara73",
         "id" : 9156103,
         "login" : "nopara73",
         "node_id" : "MDQ6VXNlcjkxNTYxMDM=",
         "organizations_url" : "https://api.github.com/users/nopara73/orgs",
         "received_events_url" : "https://api.github.com/users/nopara73/received_events",
         "repos_url" : "https://api.github.com/users/nopara73/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/nopara73/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/nopara73/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/nopara73"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept NACK if I understand this correctly.\r\n\r\nIf we assume everything will be Segwit eventually, this filter will just become redundant with the basic one?\r\n\r\nIf the goal is to reduce the initial download, couldn't the wallet just start with its birthdate block anyway?\r\n\r\nPlus, remotely-accessible filters are still a bad idea in the first place, which this seems to presuppose...",
      "created_at" : "2020-03-04T15:12:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-594588223",
      "id" : 594588223,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NDU4ODIyMw==",
      "updated_at" : "2020-03-04T15:12:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/594588223",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> What do you mean no use case? It's already being used and in production for 1.5 years now.\r\n\r\nIf there is a use case internal to the Wasabi wallet, that is fine. However, for anyone else (and probably also Wasabi wallet), they are better off using the existing BIP 158 filters.",
      "created_at" : "2020-03-04T15:18:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-594593320",
      "id" : 594593320,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NDU5MzMyMA==",
      "updated_at" : "2020-03-04T15:18:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/594593320",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r387735322"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387735322"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is this a bugfix to the existing code? Please PR it separately if so.",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-04T15:20:07Z",
      "diff_hunk" : "@@ -257,60 +257,46 @@ const std::string& ListBlockFilterTypes()\n     return type_list;\n }\n \n-static GCSFilter::ElementSet BasicFilterElements(const CBlock& block,\n-                                                 const CBlockUndo& block_undo)\n+static GCSFilter::ElementSet BuildFilterElements(const CBlock& block,\n+                                                 const CBlockUndo& block_undo,\n+                                                 bool only_segwit = true,\n+                                                 int witness_version = 0)\n {\n     GCSFilter::ElementSet elements;\n \n     for (const CTransactionRef& tx : block.vtx) {\n         for (const CTxOut& txout : tx->vout) {\n             const CScript& script = txout.scriptPubKey;\n             if (script.empty() || script[0] == OP_RETURN) continue;\n+            if (only_segwit) {\n+                int witnessversion;\n+                std::vector<unsigned char> witnessprogram;\n+                if (!script.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+                if (witnessversion != witness_version) continue;\n+                if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE))) continue; // specific v0 checks\n+            }\n             elements.emplace(script.begin(), script.end());\n         }\n     }\n \n     for (const CTxUndo& tx_undo : block_undo.vtxundo) {\n         for (const Coin& prevout : tx_undo.vprevout) {\n             const CScript& script = prevout.out.scriptPubKey;\n-            if (script.empty()) continue;\n+            if (script.empty() || script[0] == OP_RETURN) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r387735322",
      "id" : 387735322,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzczNTMyMg==",
      "original_commit_id" : "3055ac89c1032c2e9f35e4894d6f61ef960a3ef8",
      "original_position" : 32,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 368867532,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387735322",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r387736534"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387736534"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Please use `case BlockFilterType::INVALID` here so new enum values warn at compile time.",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-04T15:21:53Z",
      "diff_hunk" : "@@ -297,12 +315,22 @@ BlockFilter::BlockFilter(BlockFilterType filter_type, const CBlock& block, const\n     if (!BuildParams(params)) {\n         throw std::invalid_argument(\"unknown filter_type\");\n     }\n-    m_filter = GCSFilter(params, BasicFilterElements(block, block_undo));\n+\n+    switch (m_filter_type) {\n+    case BlockFilterType::BASIC:\n+        m_filter = GCSFilter(params, BuildFilterElements(block, block_undo));\n+        break;\n+    case BlockFilterType::V0:\n+        m_filter = GCSFilter(params, BuildFilterElements(block, block_undo, true));\n+        break;\n+    default: assert(false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r387736534",
      "id" : 387736534,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzczNjUzNA==",
      "original_commit_id" : "dc1fe756fc5148b467932fb76888393270134c1d",
      "original_position" : 72,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 368869081,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387736534",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r387744637"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387744637"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Let's keep the order BASIC,V0 here?",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-04T15:32:49Z",
      "diff_hunk" : "@@ -297,12 +315,22 @@ BlockFilter::BlockFilter(BlockFilterType filter_type, const CBlock& block, const\n     if (!BuildParams(params)) {\n         throw std::invalid_argument(\"unknown filter_type\");\n     }\n-    m_filter = GCSFilter(params, BasicFilterElements(block, block_undo));\n+\n+    switch (m_filter_type) {\n+    case BlockFilterType::BASIC:\n+        m_filter = GCSFilter(params, BuildFilterElements(block, block_undo));\n+        break;\n+    case BlockFilterType::V0:\n+        m_filter = GCSFilter(params, BuildFilterElements(block, block_undo, true));\n+        break;\n+    default: assert(false);\n+    }\n }\n \n bool BlockFilter::BuildParams(GCSFilter::Params& params) const\n {\n     switch (m_filter_type) {\n+    case BlockFilterType::V0:\n     case BlockFilterType::BASIC:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r387744637",
      "id" : 387744637,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc0NDYzNw==",
      "original_commit_id" : "dc1fe756fc5148b467932fb76888393270134c1d",
      "original_position" : 80,
      "path" : "src/blockfilter.cpp",
      "position" : 78,
      "pull_request_review_id" : 368879370,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387744637",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r387874789"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387874789"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Actually, it's it absolutely impossible to encounter an `OP_RETURN` here? These are spent pubkeys, right? You can't spend an `OP_RETURN`...",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-04T19:10:09Z",
      "diff_hunk" : "@@ -257,60 +257,46 @@ const std::string& ListBlockFilterTypes()\n     return type_list;\n }\n \n-static GCSFilter::ElementSet BasicFilterElements(const CBlock& block,\n-                                                 const CBlockUndo& block_undo)\n+static GCSFilter::ElementSet BuildFilterElements(const CBlock& block,\n+                                                 const CBlockUndo& block_undo,\n+                                                 bool only_segwit = true,\n+                                                 int witness_version = 0)\n {\n     GCSFilter::ElementSet elements;\n \n     for (const CTransactionRef& tx : block.vtx) {\n         for (const CTxOut& txout : tx->vout) {\n             const CScript& script = txout.scriptPubKey;\n             if (script.empty() || script[0] == OP_RETURN) continue;\n+            if (only_segwit) {\n+                int witnessversion;\n+                std::vector<unsigned char> witnessprogram;\n+                if (!script.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+                if (witnessversion != witness_version) continue;\n+                if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE))) continue; // specific v0 checks\n+            }\n             elements.emplace(script.begin(), script.end());\n         }\n     }\n \n     for (const CTxUndo& tx_undo : block_undo.vtxundo) {\n         for (const Coin& prevout : tx_undo.vprevout) {\n             const CScript& script = prevout.out.scriptPubKey;\n-            if (script.empty()) continue;\n+            if (script.empty() || script[0] == OP_RETURN) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r387874789",
      "id" : 387874789,
      "in_reply_to_id" : 387735322,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg3NDc4OQ==",
      "original_commit_id" : "3055ac89c1032c2e9f35e4894d6f61ef960a3ef8",
      "original_position" : 32,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 369046647,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387874789",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r387920404"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387920404"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I agree but this is in response to this comment (for readability)\r\nhttps://github.com/bitcoin/bitcoin/pull/18223#discussion_r386120920\r\n\r\n",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-04T20:38:17Z",
      "diff_hunk" : "@@ -257,60 +257,46 @@ const std::string& ListBlockFilterTypes()\n     return type_list;\n }\n \n-static GCSFilter::ElementSet BasicFilterElements(const CBlock& block,\n-                                                 const CBlockUndo& block_undo)\n+static GCSFilter::ElementSet BuildFilterElements(const CBlock& block,\n+                                                 const CBlockUndo& block_undo,\n+                                                 bool only_segwit = true,\n+                                                 int witness_version = 0)\n {\n     GCSFilter::ElementSet elements;\n \n     for (const CTransactionRef& tx : block.vtx) {\n         for (const CTxOut& txout : tx->vout) {\n             const CScript& script = txout.scriptPubKey;\n             if (script.empty() || script[0] == OP_RETURN) continue;\n+            if (only_segwit) {\n+                int witnessversion;\n+                std::vector<unsigned char> witnessprogram;\n+                if (!script.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+                if (witnessversion != witness_version) continue;\n+                if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE))) continue; // specific v0 checks\n+            }\n             elements.emplace(script.begin(), script.end());\n         }\n     }\n \n     for (const CTxUndo& tx_undo : block_undo.vtxundo) {\n         for (const Coin& prevout : tx_undo.vprevout) {\n             const CScript& script = prevout.out.scriptPubKey;\n-            if (script.empty()) continue;\n+            if (script.empty() || script[0] == OP_RETURN) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r387920404",
      "id" : 387920404,
      "in_reply_to_id" : 387735322,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkyMDQwNA==",
      "original_commit_id" : "3055ac89c1032c2e9f35e4894d6f61ef960a3ef8",
      "original_position" : 32,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 369104563,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387920404",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7487930?v=4",
         "events_url" : "https://api.github.com/users/dangershony/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dangershony/followers",
         "following_url" : "https://api.github.com/users/dangershony/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dangershony/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dangershony",
         "id" : 7487930,
         "login" : "dangershony",
         "node_id" : "MDQ6VXNlcjc0ODc5MzA=",
         "organizations_url" : "https://api.github.com/users/dangershony/orgs",
         "received_events_url" : "https://api.github.com/users/dangershony/received_events",
         "repos_url" : "https://api.github.com/users/dangershony/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dangershony/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dangershony/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dangershony"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r387928903"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387928903"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think this makes it any more readable...\r\n\r\nPrefer a comment simply stating that it is impossible.",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-04T20:55:34Z",
      "diff_hunk" : "@@ -257,60 +257,46 @@ const std::string& ListBlockFilterTypes()\n     return type_list;\n }\n \n-static GCSFilter::ElementSet BasicFilterElements(const CBlock& block,\n-                                                 const CBlockUndo& block_undo)\n+static GCSFilter::ElementSet BuildFilterElements(const CBlock& block,\n+                                                 const CBlockUndo& block_undo,\n+                                                 bool only_segwit = true,\n+                                                 int witness_version = 0)\n {\n     GCSFilter::ElementSet elements;\n \n     for (const CTransactionRef& tx : block.vtx) {\n         for (const CTxOut& txout : tx->vout) {\n             const CScript& script = txout.scriptPubKey;\n             if (script.empty() || script[0] == OP_RETURN) continue;\n+            if (only_segwit) {\n+                int witnessversion;\n+                std::vector<unsigned char> witnessprogram;\n+                if (!script.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+                if (witnessversion != witness_version) continue;\n+                if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE))) continue; // specific v0 checks\n+            }\n             elements.emplace(script.begin(), script.end());\n         }\n     }\n \n     for (const CTxUndo& tx_undo : block_undo.vtxundo) {\n         for (const Coin& prevout : tx_undo.vprevout) {\n             const CScript& script = prevout.out.scriptPubKey;\n-            if (script.empty()) continue;\n+            if (script.empty() || script[0] == OP_RETURN) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r387928903",
      "id" : 387928903,
      "in_reply_to_id" : 387735322,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkyODkwMw==",
      "original_commit_id" : "3055ac89c1032c2e9f35e4894d6f61ef960a3ef8",
      "original_position" : 32,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 369115380,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387928903",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r387936428"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387936428"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Reverted.",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-04T21:10:54Z",
      "diff_hunk" : "@@ -257,60 +257,46 @@ const std::string& ListBlockFilterTypes()\n     return type_list;\n }\n \n-static GCSFilter::ElementSet BasicFilterElements(const CBlock& block,\n-                                                 const CBlockUndo& block_undo)\n+static GCSFilter::ElementSet BuildFilterElements(const CBlock& block,\n+                                                 const CBlockUndo& block_undo,\n+                                                 bool only_segwit = true,\n+                                                 int witness_version = 0)\n {\n     GCSFilter::ElementSet elements;\n \n     for (const CTransactionRef& tx : block.vtx) {\n         for (const CTxOut& txout : tx->vout) {\n             const CScript& script = txout.scriptPubKey;\n             if (script.empty() || script[0] == OP_RETURN) continue;\n+            if (only_segwit) {\n+                int witnessversion;\n+                std::vector<unsigned char> witnessprogram;\n+                if (!script.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+                if (witnessversion != witness_version) continue;\n+                if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE))) continue; // specific v0 checks\n+            }\n             elements.emplace(script.begin(), script.end());\n         }\n     }\n \n     for (const CTxUndo& tx_undo : block_undo.vtxundo) {\n         for (const Coin& prevout : tx_undo.vprevout) {\n             const CScript& script = prevout.out.scriptPubKey;\n-            if (script.empty()) continue;\n+            if (script.empty() || script[0] == OP_RETURN) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r387936428",
      "id" : 387936428,
      "in_reply_to_id" : 387735322,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkzNjQyOA==",
      "original_commit_id" : "3055ac89c1032c2e9f35e4894d6f61ef960a3ef8",
      "original_position" : 32,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 369125222,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-04T21:10:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387936428",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7487930?v=4",
         "events_url" : "https://api.github.com/users/dangershony/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dangershony/followers",
         "following_url" : "https://api.github.com/users/dangershony/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dangershony/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dangershony",
         "id" : 7487930,
         "login" : "dangershony",
         "node_id" : "MDQ6VXNlcjc0ODc5MzA=",
         "organizations_url" : "https://api.github.com/users/dangershony/orgs",
         "received_events_url" : "https://api.github.com/users/dangershony/received_events",
         "repos_url" : "https://api.github.com/users/dangershony/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dangershony/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dangershony/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dangershony"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@dangershony Let's discuss alternative solutions. If I wouldn't be so biased I think even I would NACK this with P2P in mind. (Not for RPC only though.)",
      "created_at" : "2020-03-05T10:06:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-595141379",
      "id" : 595141379,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NTE0MTM3OQ==",
      "updated_at" : "2020-03-05T10:06:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/595141379",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/9156103?v=4",
         "events_url" : "https://api.github.com/users/nopara73/events{/privacy}",
         "followers_url" : "https://api.github.com/users/nopara73/followers",
         "following_url" : "https://api.github.com/users/nopara73/following{/other_user}",
         "gists_url" : "https://api.github.com/users/nopara73/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/nopara73",
         "id" : 9156103,
         "login" : "nopara73",
         "node_id" : "MDQ6VXNlcjkxNTYxMDM=",
         "organizations_url" : "https://api.github.com/users/nopara73/orgs",
         "received_events_url" : "https://api.github.com/users/nopara73/received_events",
         "repos_url" : "https://api.github.com/users/nopara73/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/nopara73/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/nopara73/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/nopara73"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "After internal discussions we decided to close this PR (thanks for providing review)",
      "created_at" : "2020-03-05T13:34:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-595232096",
      "id" : 595232096,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NTIzMjA5Ng==",
      "updated_at" : "2020-03-05T13:34:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/595232096",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7487930?v=4",
         "events_url" : "https://api.github.com/users/dangershony/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dangershony/followers",
         "following_url" : "https://api.github.com/users/dangershony/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dangershony/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dangershony",
         "id" : 7487930,
         "login" : "dangershony",
         "node_id" : "MDQ6VXNlcjc0ODc5MzA=",
         "organizations_url" : "https://api.github.com/users/dangershony/orgs",
         "received_events_url" : "https://api.github.com/users/dangershony/received_events",
         "repos_url" : "https://api.github.com/users/dangershony/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dangershony/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dangershony/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dangershony"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Thanks for the review everyone!\r\n\r\nThough I am sad about the concept NACK. I had high hopes that with customizable block filters served over RPC, we make a great step towards further separating the wallet functionality from Core, making it more compatible with dedicated wallet software. Wasabi is currently segwit v0 only, and it will be segwit v1 taproot only as soon as possible [similar to lightning wallets too]. Thus the custom filters have a superb use case, as I see it. Basic filters are unfortunately not feasible for Wasabi [even after segwit activation, basic filters are 4.8 GB; compared to 250MB for segwit v0 filters]. I do not know of another way to provide full verification while preserving the \"light client feel\" of Wasabi. This means, very unfortunately, that Wasabi will not have full verification for the foreseeable future, and the current Bitcoin Core integration is only a gimmicky bandwidth savings, not much more.\r\n\r\nAnyway, thank You all for making Core as beautiful as it is, and I am eager to continue the collaboration towards integrating it properly in Wasabi. ",
      "created_at" : "2020-03-05T14:20:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-595253155",
      "id" : 595253155,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NTI1MzE1NQ==",
      "updated_at" : "2020-03-05T14:20:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/595253155",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/30683012?v=4",
         "events_url" : "https://api.github.com/users/MaxHillebrand/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MaxHillebrand/followers",
         "following_url" : "https://api.github.com/users/MaxHillebrand/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MaxHillebrand/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MaxHillebrand",
         "id" : 30683012,
         "login" : "MaxHillebrand",
         "node_id" : "MDQ6VXNlcjMwNjgzMDEy",
         "organizations_url" : "https://api.github.com/users/MaxHillebrand/orgs",
         "received_events_url" : "https://api.github.com/users/MaxHillebrand/received_events",
         "repos_url" : "https://api.github.com/users/MaxHillebrand/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MaxHillebrand/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MaxHillebrand/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MaxHillebrand"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Neutrino is NOT full verification, and people falsely portraying it as such is a huge part of the problem with Neutrino. It is no safer than other SPV protocols, and less efficient.\r\n\r\nI don't see why this means Wasabi will forego full validation. That doesn't logically follow at all.\r\n\r\n(I suggest we find someplace to continue this topic off this GitHub PR)",
      "created_at" : "2020-03-05T14:44:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-595264676",
      "id" : 595264676,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NTI2NDY3Ng==",
      "updated_at" : "2020-03-05T14:44:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/595264676",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Yes @luke-jr, the current way BIP158 is used in Wasabi relies on the server to build and send valid filters - there is no verification, and it relies on trust in the server. [this is the problem that we intended to solve with this PR]. Wasabi uses block filters solely for the privacy benefits, of having a light wallet without leaking the xpub or address to any third party server.\r\n\r\nHowever, we intended to use SegWit v0 only [later SegWit v1 only] block filters generated in the [Wasabi in-built bitcoind](https://github.com/zkSNACKs/WalletWasabi/tree/master/WalletWasabi/Microservices/Binaries/lin64), thus every Wasabi user, who opts in to run bitcoind, can cross reference the server filters, from his own generated ones, thus having full verification.",
      "created_at" : "2020-03-05T14:50:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-595268039",
      "id" : 595268039,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NTI2ODAzOQ==",
      "updated_at" : "2020-03-05T16:36:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/595268039",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/30683012?v=4",
         "events_url" : "https://api.github.com/users/MaxHillebrand/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MaxHillebrand/followers",
         "following_url" : "https://api.github.com/users/MaxHillebrand/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MaxHillebrand/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MaxHillebrand",
         "id" : 30683012,
         "login" : "MaxHillebrand",
         "node_id" : "MDQ6VXNlcjMwNjgzMDEy",
         "organizations_url" : "https://api.github.com/users/MaxHillebrand/orgs",
         "received_events_url" : "https://api.github.com/users/MaxHillebrand/received_events",
         "repos_url" : "https://api.github.com/users/MaxHillebrand/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MaxHillebrand/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MaxHillebrand/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MaxHillebrand"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> even after segwit activation, basic filters are 4.8 GB; compared to 250MB for segwit v0 filters\r\n\r\nSegwit usage is higher than 50% right now, and assuming that most wallets have a rather recent birthday, the difference should be a factor of 2 or so (clearly less than 10). Further, assuming that taproot is activated some day, it will likely show a similar or higher usage pattern. With that in mind, promising users storage requirements that can not hold over the long term anyway and converge to those of the all-including basic BIP158 filter, seems slightly misleading.\r\n\r\nFinally, network bandwidth shouldn't matter when users feed filters from their local bitcoind instance.",
      "created_at" : "2020-03-05T15:55:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-595303196",
      "id" : 595303196,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NTMwMzE5Ng==",
      "updated_at" : "2020-03-05T15:55:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/595303196",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "If it's for local RPC usage, why is a filter needed at all? You can just fetch the block, and check it for matching transactions like a pre-BIP37 wallet would. If that results in any transactions that were missing from the remotely-provided filter, you know the filter is missing things.",
      "created_at" : "2020-03-05T16:08:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-595309918",
      "id" : 595309918,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NTMwOTkxOA==",
      "updated_at" : "2020-03-05T16:08:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/595309918",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Yes @luke-jr, the current way BIP158 is used in Wasabi relies on the server to build and send valid filters - there is no verification, and trust in the server. [this is the problem that we intended to solve with this PR].\r\n\r\nThis PR cannot solve it.\r\n\r\n> Wasabi uses block filters solely for the privacy benefits, of having a light wallet without leaking the xpub or address to any third party server.\r\n\r\nThere are no privacy benefits when you're using your own node.\r\n\r\n>However, we intended to use SegWit v0 only [later SegWit v1 only] block filters generated in the Wasabi in-built bitcoind, thus every Wasabi user, who opts in to run bitcoind, can cross reference the server filters, from his own generated ones, thus having full verification.\r\n\r\nThere is no need for a third-party server filter. Just use your own.\r\n",
      "created_at" : "2020-03-05T16:14:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-595313256",
      "id" : 595313256,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NTMxMzI1Ng==",
      "updated_at" : "2020-03-05T16:14:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/595313256",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Let me clarify a few things.  \r\n\r\nWasabi client uses P2WPKH only filters those are built on and fetched from the Wasabi backend. We want to make Wasabi a hybrid full node, which we've progressed towards gradually, to the point that only the validation function is needed to be implemented. The idea is to serve the exact same filters from the server to the clients, so the client can just verify the correct filters are provided by the server until its own local Bitcoin Core node catches up. Wasabi wallets aren't running all the time, they are closed and reopened constantly, but ultimately what really matters is that eventually the validation happens, the when is less important, IMO.\r\n\r\nPorting our own filter building implementation to the client or going through every block for every wallet is no-go as it has poor performance, because going through every block with RPC is a slow process. You may take it as a given as you are working on Bitcoin Core, but the performance of Bitcoin Core is impossible to even come close to for any project.\r\n\r\nWhat just came to my mind, the most important limitation for most performance issues while communicating with Core is that we cannot just pull out the input value-script pars when getting a transaction from Core. Would that be something sensible to start working on? Like a getblock rpc request where more information on the inputs are added to the tx?",
      "created_at" : "2020-03-05T16:48:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-595330862",
      "id" : 595330862,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NTMzMDg2Mg==",
      "updated_at" : "2020-03-05T16:48:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/595330862",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/9156103?v=4",
         "events_url" : "https://api.github.com/users/nopara73/events{/privacy}",
         "followers_url" : "https://api.github.com/users/nopara73/followers",
         "following_url" : "https://api.github.com/users/nopara73/following{/other_user}",
         "gists_url" : "https://api.github.com/users/nopara73/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/nopara73",
         "id" : 9156103,
         "login" : "nopara73",
         "node_id" : "MDQ6VXNlcjkxNTYxMDM=",
         "organizations_url" : "https://api.github.com/users/nopara73/orgs",
         "received_events_url" : "https://api.github.com/users/nopara73/received_events",
         "repos_url" : "https://api.github.com/users/nopara73/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/nopara73/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/nopara73/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/nopara73"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : ">Like a getblock rpc request where more information on the inputs are added to the tx?\r\n\r\nLike #16083 ? (It's already in Knots, so you could even use it immediately!)",
      "created_at" : "2020-03-05T17:06:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-595339831",
      "id" : 595339831,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NTMzOTgzMQ==",
      "updated_at" : "2020-03-05T17:07:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/595339831",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@luke-jr that's great, I also noticed you merged the v0 filter commits to Knots, eta when this will go in Knots master?",
      "created_at" : "2020-03-05T22:23:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-595477562",
      "id" : 595477562,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NTQ3NzU2Mg==",
      "updated_at" : "2020-03-05T22:23:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/595477562",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7487930?v=4",
         "events_url" : "https://api.github.com/users/dangershony/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dangershony/followers",
         "following_url" : "https://api.github.com/users/dangershony/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dangershony/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dangershony",
         "id" : 7487930,
         "login" : "dangershony",
         "node_id" : "MDQ6VXNlcjc0ODc5MzA=",
         "organizations_url" : "https://api.github.com/users/dangershony/orgs",
         "received_events_url" : "https://api.github.com/users/dangershony/received_events",
         "repos_url" : "https://api.github.com/users/dangershony/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dangershony/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dangershony/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dangershony"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Knots doesn't have a master, just releases. Should be in v0.19.1 (but disabled unless specified explicitly via `-blockfilterindex=v0`).",
      "created_at" : "2020-03-05T23:48:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-595502578",
      "id" : 595502578,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NTUwMjU3OA==",
      "updated_at" : "2020-03-05T23:48:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/595502578",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r388806543"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/388806543"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Aargh, I totally misread that code :-)",
      "commit_id" : "5561e7a0c79606e555ea9b986a9065d14ec40118",
      "created_at" : "2020-03-06T09:49:28Z",
      "diff_hunk" : "@@ -257,60 +257,46 @@ const std::string& ListBlockFilterTypes()\n     return type_list;\n }\n \n-static GCSFilter::ElementSet BasicFilterElements(const CBlock& block,\n-                                                 const CBlockUndo& block_undo)\n+static GCSFilter::ElementSet BuildFilterElements(const CBlock& block,\n+                                                 const CBlockUndo& block_undo,\n+                                                 bool only_segwit = true,\n+                                                 int witness_version = 0)\n {\n     GCSFilter::ElementSet elements;\n \n     for (const CTransactionRef& tx : block.vtx) {\n         for (const CTxOut& txout : tx->vout) {\n             const CScript& script = txout.scriptPubKey;\n             if (script.empty() || script[0] == OP_RETURN) continue;\n+            if (only_segwit) {\n+                int witnessversion;\n+                std::vector<unsigned char> witnessprogram;\n+                if (!script.IsWitnessProgram(witnessversion, witnessprogram)) continue;\n+                if (witnessversion != witness_version) continue;\n+                if (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE))) continue; // specific v0 checks\n+            }\n             elements.emplace(script.begin(), script.end());\n         }\n     }\n \n     for (const CTxUndo& tx_undo : block_undo.vtxundo) {\n         for (const Coin& prevout : tx_undo.vprevout) {\n             const CScript& script = prevout.out.scriptPubKey;\n-            if (script.empty()) continue;\n+            if (script.empty() || script[0] == OP_RETURN) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#discussion_r388806543",
      "id" : 388806543,
      "in_reply_to_id" : 387735322,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgwNjU0Mw==",
      "original_commit_id" : "3055ac89c1032c2e9f35e4894d6f61ef960a3ef8",
      "original_position" : 32,
      "path" : "src/blockfilter.cpp",
      "position" : null,
      "pull_request_review_id" : 370198508,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18223",
      "updated_at" : "2020-03-06T09:49:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/388806543",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "It may be worth studying c-lightning; they scan all blocks for lightning transactions, no filters needed, and in my experience it's fast. You could wrap some of their C code if it looks too magical :-)",
      "created_at" : "2020-03-06T10:05:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-595695871",
      "id" : 595695871,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NTY5NTg3MQ==",
      "updated_at" : "2020-03-06T10:05:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/595695871",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> Like #16083 ? (It's already in Knots, so you could even use it immediately!)\r\n\r\n![image](https://user-images.githubusercontent.com/9156103/76086184-e55bba00-5fb3-11ea-968f-4c8fad9f1a79.png)\r\n",
      "created_at" : "2020-03-06T13:08:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-595759832",
      "id" : 595759832,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NTc1OTgzMg==",
      "updated_at" : "2020-03-06T13:08:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/595759832",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/9156103?v=4",
         "events_url" : "https://api.github.com/users/nopara73/events{/privacy}",
         "followers_url" : "https://api.github.com/users/nopara73/followers",
         "following_url" : "https://api.github.com/users/nopara73/following{/other_user}",
         "gists_url" : "https://api.github.com/users/nopara73/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/nopara73",
         "id" : 9156103,
         "login" : "nopara73",
         "node_id" : "MDQ6VXNlcjkxNTYxMDM=",
         "organizations_url" : "https://api.github.com/users/nopara73/orgs",
         "received_events_url" : "https://api.github.com/users/nopara73/received_events",
         "repos_url" : "https://api.github.com/users/nopara73/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/nopara73/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/nopara73/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/nopara73"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MaxHillebrand \r\n\r\n> Basic filters are unfortunately not feasible for Wasabi [even after segwit activation, basic filters are 4.8 GB; compared to 250MB for segwit v0 filters].\r\n\r\nAs @MarcoFalke noted above, this conclusion seems unlikely, so I tested the size of the current \"basic\" filters myself from segwit activation to present and I get a size of 2.6 GB.\r\n\r\n    $ for i in `seq 481824 620831` ; do bitcoin-cli getblockhash $i ; done | while read hash ; do bitcoin-cli getblockfilter $hash ; done | jq -r .filter | xxd -r -p- | wc -c\r\n    2628728815\r\n\r\nBeyond that, I'm confused by this disk space argument in the first place.  If you're getting the filter for block x from your local node, don't you also expect to be getting the contents of block x from the same node?  Blocks are ~33x larger than a full basic filter for that block, so the extra few kilobytes disk space per filter (for present usage patterns) seems particularly irrelevant.\r\n\r\n@nopara73 \r\n\r\n> The idea is to serve the exact same filters from the server to the clients, so the client can just verify the correct filters are provided by the server until its own local Bitcoin Core node catches up.\r\n\r\nI understand the idea is for the Wasabi application to get identical filters from either Wasabi's server or the local Bitcoin Core node, but I want to make sure you're aware that, as long as the filter encoding is the same, the Wasabi application should be able to use the basic filters produced by Core without any changes to Wasabi's application logic.  That's because the application doesn't care whether the filter was constructed out of just P2WPKH transactions or all transactions---it's just looking for potential output/input scriptPubKey matches to its wallet.\r\n\r\nSo, unless I'm misunderstanding something, the Wasabi application should be able to transition seamlessly between using the P2WPKH-only filters served by the Wasabi server to basic (everything) filters served by the local Bitcoin Core node after it has caught up.",
      "created_at" : "2020-03-08T18:51:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-596238365",
      "id" : 596238365,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NjIzODM2NQ==",
      "updated_at" : "2020-03-08T18:51:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/596238365",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/61096?v=4",
         "events_url" : "https://api.github.com/users/harding/events{/privacy}",
         "followers_url" : "https://api.github.com/users/harding/followers",
         "following_url" : "https://api.github.com/users/harding/following{/other_user}",
         "gists_url" : "https://api.github.com/users/harding/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/harding",
         "id" : 61096,
         "login" : "harding",
         "node_id" : "MDQ6VXNlcjYxMDk2",
         "organizations_url" : "https://api.github.com/users/harding/orgs",
         "received_events_url" : "https://api.github.com/users/harding/received_events",
         "repos_url" : "https://api.github.com/users/harding/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/harding/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/harding/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/harding"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@harding yeah this was incorrect the 4.8GB refers to the entire basic filter data, still core has no way to store locally only basic filters form segwit activation. (also note that 2.6 GB is probably too much if we can avoid it)\r\n\r\n> the Wasabi application should be able to use the basic filters produced by Core without any changes to Wasabi's application logic.  \r\n\r\nWasabi compresses the script on the clients before trying to match it with a filter (or more correctly wasabi builds the filter with compressed scripts) so legacy clients won't work with basic filters from core.\r\n",
      "created_at" : "2020-03-08T21:42:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-596256235",
      "id" : 596256235,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NjI1NjIzNQ==",
      "updated_at" : "2020-03-08T21:42:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/596256235",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7487930?v=4",
         "events_url" : "https://api.github.com/users/dangershony/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dangershony/followers",
         "following_url" : "https://api.github.com/users/dangershony/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dangershony/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dangershony",
         "id" : 7487930,
         "login" : "dangershony",
         "node_id" : "MDQ6VXNlcjc0ODc5MzA=",
         "organizations_url" : "https://api.github.com/users/dangershony/orgs",
         "received_events_url" : "https://api.github.com/users/dangershony/received_events",
         "repos_url" : "https://api.github.com/users/dangershony/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dangershony/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dangershony/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dangershony"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> 2.6 GB is probably too much if we can avoid it\r\n\r\n2.6 is roughly 50% the minimum amount of data Bitcoin Core needs to store anyway (chainstate plus minimum prune depth) or the rough equivalent of 10 days worth of blocks and undo data at current utilization levels, so 2.6 GB seems to me to be a pretty small additional requirement on top of using Bitcoin Core in the first place.\r\n\r\nAnd, as mentioned elsewhere in this thread, you can use the wallet birthday to prune filters from blocks before the wallet was created (though I don't think we currently support filter pruning).\r\n\r\n> wasabi builds the filter with compressed scripts) so legacy clients won't work with basic filters from core.\r\n\r\nI'm confused.  What are \"compressed scripts\"?  I skimmed this PR---it is a nice example of a minimalistic change, thanks!---and it seemed to me that it builds both the basic and v0 filters the same way, except that the v0 filter skips past any transactions with non-v0 parts:\r\n\r\n```\r\nif (!script.IsWitnessProgram(witnessversion, witnessprogram)) \r\nif (witnessversion != witness_version) \r\nif (!(witnessversion == 0 && (witnessprogram.size() == WITNESS_V0_KEYHASH_SIZE || witnessprogram.size() == WITNESS_V0_SCRIPTHASH_SIZE))) continue; // specific v0 checks\r\n```\r\n\r\nUnless I'm missing something, that should mean that any Wasabi clients compatible with this PR would also automatically be compatible with basic filters with no changes needed (except maybe to deal with the break in the chain of filter headers).",
      "created_at" : "2020-03-08T22:17:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-596259299",
      "id" : 596259299,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NjI1OTI5OQ==",
      "updated_at" : "2020-03-08T22:17:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/596259299",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/61096?v=4",
         "events_url" : "https://api.github.com/users/harding/events{/privacy}",
         "followers_url" : "https://api.github.com/users/harding/followers",
         "following_url" : "https://api.github.com/users/harding/following{/other_user}",
         "gists_url" : "https://api.github.com/users/harding/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/harding",
         "id" : 61096,
         "login" : "harding",
         "node_id" : "MDQ6VXNlcjYxMDk2",
         "organizations_url" : "https://api.github.com/users/harding/orgs",
         "received_events_url" : "https://api.github.com/users/harding/received_events",
         "repos_url" : "https://api.github.com/users/harding/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/harding/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/harding/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/harding"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "You are right, this filter will sill not be compatible with wasabi (and had we gone down this path would mean we have to support two api endpoints after the upgrade) there are a few narratives in parallel here (fetch filters from local core node, fetch filters from wasabi server, maintain backwards compatibility, least disruption to current wasabi design etc...) this will explain the confusion.\r\n\r\n>  so 2.6 GB seems to me to be a pretty small additional requirement on top of using Bitcoin Core in the first place. \r\n\r\nEach client (not using a local core node) will fetch 2.6GB of data form the server (wasabi stores all filters locally) if we can prevent this its preferable.\r\n\r\nRight new it seems we probably take the approach of using Knots and constructing the same filters wasabi currently uses from a Knots node (that can serve the spent ScriptPubKey)\r\nhttps://github.com/zkSNACKs/WalletWasabi/issues/3208#issuecomment-595768764\r\n\r\nFYI compressed scripts to bytes https://github.com/zkSNACKs/WalletWasabi/blob/master/WalletWasabi/Blockchain/BlockFilters/IndexBuilderService.cs#L264\r\n ",
      "created_at" : "2020-03-09T11:47:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-596479621",
      "id" : 596479621,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NjQ3OTYyMQ==",
      "updated_at" : "2020-03-09T11:47:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/596479621",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7487930?v=4",
         "events_url" : "https://api.github.com/users/dangershony/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dangershony/followers",
         "following_url" : "https://api.github.com/users/dangershony/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dangershony/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dangershony",
         "id" : 7487930,
         "login" : "dangershony",
         "node_id" : "MDQ6VXNlcjc0ODc5MzA=",
         "organizations_url" : "https://api.github.com/users/dangershony/orgs",
         "received_events_url" : "https://api.github.com/users/dangershony/received_events",
         "repos_url" : "https://api.github.com/users/dangershony/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dangershony/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dangershony/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dangershony"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Each client (not using a local core node) will fetch 2.6GB of data form the server (wasabi stores all filters locally) if we can prevent this its preferable.\r\n\r\nYes, this can be prevented, that's what I've been trying to say but I must not be communicating effectively here, so let me start from first principles (my appologies for repeating stuff you probably already know).\r\n\r\nThe process of creating a BIP158-style filter starts with a block that's full of transactions which each spend one or more UTXOs and which each create one or more new UTXOs.  For BIP158, scriptPubKeys for all spent UTXOs and created UTXOs (excepting `OP_RETURN` outputs) are hashed and then put into a sorted list:\r\n\r\n    00000000\r\n    11111111\r\n    22222222\r\n    33333333\r\n    \r\nThe list is then golumb coded to minimize its size to produce the final BIP158 basic filter.  The client then takes a list of its scriptPubKeys, hashes them the same way, and compares each of them to the entries in the filter to see if there's any matches.  E.g., the wallet matches on `22222222` and so goes and downloads the block to find the possibly-relevant transaction.\r\n\r\nNow, as proposed in this PR, you can create a filter using a subset of the original data (e.g. only P2WPKH):\r\n\r\n    11111111\r\n    22222222\r\n\r\nIf you use the same hashing and golumb coding, then any client which can process the subset filter above can also process the original full set filter to find its scriptPubKey `22222222`.\r\n\r\nThis means Wasabi's server can generate and serve the small subset filter (~250 MB currently you say) while it's also possible for clients to use their local node's full filter (~2.6 GB post-segwit activation).  This is my point: you don't have to choose between a 250 MB and a 2.6 GB filter---you can use them both in different contexts with no special logic in the client.\r\n\r\n> Right new it seems we probably take the approach of using Knots and constructing the same filters wasabi currently uses from a Knots node (that can serve the spent ScriptPubKey)\r\n\r\nIf you do indeed have a custom GCS algorithm, that does seem like it might be the simplest path forward for you, but it seems a shame to me that choosing that path would remove the possibility of compatibility with the most popular and best reviewed full node implementation (as well as all other software that's implemented standard BIP158).\r\n\r\n> FYI compressed scripts to bytes https://github.com/zkSNACKs/WalletWasabi/blob/master/WalletWasabi/Blockchain/BlockFilters/IndexBuilderService.cs#L264\r\n\r\nThat looks like it's just doing the GCS compression; I'm not sure how your code differs from the same operation as described in BIP158.",
      "created_at" : "2020-03-09T16:32:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18223#issuecomment-596636403",
      "id" : 596636403,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18223",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NjYzNjQwMw==",
      "updated_at" : "2020-03-09T16:32:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/596636403",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/61096?v=4",
         "events_url" : "https://api.github.com/users/harding/events{/privacy}",
         "followers_url" : "https://api.github.com/users/harding/followers",
         "following_url" : "https://api.github.com/users/harding/following{/other_user}",
         "gists_url" : "https://api.github.com/users/harding/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/harding",
         "id" : 61096,
         "login" : "harding",
         "node_id" : "MDQ6VXNlcjYxMDk2",
         "organizations_url" : "https://api.github.com/users/harding/orgs",
         "received_events_url" : "https://api.github.com/users/harding/received_events",
         "repos_url" : "https://api.github.com/users/harding/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/harding/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/harding/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/harding"
      }
   }
]
