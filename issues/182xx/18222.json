{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "NONE",
   "body" : "I would like to have a `p2wpkh` `blockfilterindex` type to outsource Wasabi's filter generation to Bitcoin Core, as our filter generation is orders of magnitude slower and we would like to bring this to the client side too, so our users with full nodes would be able to validate that our server does not cheat.  \r\n\r\nI previously created a `blockfilterindex` extensibility proposal to enable filter type combinations: https://github.com/bitcoin/bitcoin/issues/18221. So the followup PR of this issue will make sure it adheres to it. Since the PR is ready already, I'll omit to go into the implementation details in this issue, rather concentrate on the goal, the benefits of end users and how we ruled out the alternative solutions.\r\n\r\n### The Goal\r\n\r\nWe would like to enable our users to upgrade Wasabi to be a full node with one click.\r\n\r\n![image](https://user-images.githubusercontent.com/9156103/75548208-01e47900-5a2d-11ea-9f5a-87b7d6099a47.png)\r\n\r\nThis feature is already implemented and rolled out to production (shipping with Core, fee estimation, tx broadcasting, mempool serving etc..) except the (most important) validation part of it is yet to be added.\r\n\r\n### Alternative Solutions\r\n\r\nI've been long struggling with how to enable this for our users and we ended up working together with a brilliant dev, @dangershony, who maintained the C# Bitcoin full node for years. Unfortunately we had to rule out all the possible alternatives.  \r\n\r\nOne alternative would be using `importmulti`, but we would not like to rely on the wallet feature of Bitcoin Core, rather stick to the node functionality.\r\n\r\nAnother alternative could be to slowly replace our filters with Bitcoin Core's filters on the client side, but that would require reindexing all of our wallets, which in some cases could take half a day. Also mixing filter types feels dirty and can result in unexpected issues.\r\n\r\nWe also considered bringing our own filter generation algorithm to the client side, but this is one of the oldest brain class of our codebase that serves a critical functionality so touching this could be problematic. It currently takes 2-3 days for us to create our filters on a powerful server, even though we are using `p2wpkh` filters and only building them from segwit activation. Bitcoin Core creates these filters within 2 hours. Why we are so slow is out of the scope of this issue, but here's the clue: input scripts aren't part of a transaction.\r\n\r\nFurther we considered just blindly going through all the blocks and process all the transactions and make sure the server doesn't lie. The performance here is also unacceptable.\r\n\r\nFinally we would also don't like to use bloom filters, as it is on the edge of obsolation and having multiple filters to achieve the same purpose feels dirty from a complexity point of view.\r\n\r\n### Benefits to the End User\r\n\r\n@gmaxwell has suggested to articulate the benefits to the end user for changes to the codebase, thus this section.\r\n\r\nAdding new filter types and filter type combinations (https://github.com/bitcoin/bitcoin/issues/18221) would enable a privacy oriented light wallet surge to be built on top of Bitcoin Core.\r\n\r\nMaybe more importantly Bitcoin Core providing the filters to Wasabi enables a clean architecture and a seamless UX for users willing to run a full node that comes with Wasabi.\r\n\r\nIt is quite unique in a sense that no other popular light wallets went to the extent of building a full node into their software, especially not in a way that only requires a a single click configuration, so if our feature gets out of \"work in progress\" phase there may be an influx of full node users, which is good for the network.\r\n\r\nWhat we stand to lose is that this full node feature will be delayed into the future so far that I may not be here when the next clean solution presents itself and maybe the Wasabi team won't be willing to work on it as frankly it has little business value.\r\n\r\n### What's Next?\r\n\r\nThis issue described our motivation and the context of the feature request, our pull request is coming up soon, so we discuss the specifics.",
   "closed_at" : "2022-08-03T16:35:06Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/755825?v=4",
      "events_url" : "https://api.github.com/users/adamjonas/events{/privacy}",
      "followers_url" : "https://api.github.com/users/adamjonas/followers",
      "following_url" : "https://api.github.com/users/adamjonas/following{/other_user}",
      "gists_url" : "https://api.github.com/users/adamjonas/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/adamjonas",
      "id" : 755825,
      "login" : "adamjonas",
      "node_id" : "MDQ6VXNlcjc1NTgyNQ==",
      "organizations_url" : "https://api.github.com/users/adamjonas/orgs",
      "received_events_url" : "https://api.github.com/users/adamjonas/received_events",
      "repos_url" : "https://api.github.com/users/adamjonas/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/adamjonas/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/adamjonas/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/adamjonas"
   },
   "comments" : 23,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18222/comments",
   "created_at" : "2020-02-28T13:00:03Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18222/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/18222",
   "id" : 572741089,
   "labels" : [
      {
         "color" : "ebd775",
         "default" : false,
         "description" : null,
         "id" : 64584,
         "name" : "Brainstorming",
         "node_id" : "MDU6TGFiZWw2NDU4NA==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Brainstorming"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18222/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDU6SXNzdWU1NzI3NDEwODk=",
   "number" : 18222,
   "performed_via_github_app" : null,
   "reactions" : {
      "+1" : 5,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 1,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 6,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18222/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "state_reason" : "not_planned",
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18222/timeline",
   "title" : "Add `blockfilterindex = p2wpkh` ",
   "updated_at" : "2022-08-03T16:35:07Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18222",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/9156103?v=4",
      "events_url" : "https://api.github.com/users/nopara73/events{/privacy}",
      "followers_url" : "https://api.github.com/users/nopara73/followers",
      "following_url" : "https://api.github.com/users/nopara73/following{/other_user}",
      "gists_url" : "https://api.github.com/users/nopara73/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/nopara73",
      "id" : 9156103,
      "login" : "nopara73",
      "node_id" : "MDQ6VXNlcjkxNTYxMDM=",
      "organizations_url" : "https://api.github.com/users/nopara73/orgs",
      "received_events_url" : "https://api.github.com/users/nopara73/received_events",
      "repos_url" : "https://api.github.com/users/nopara73/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/nopara73/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/nopara73/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/nopara73"
   }
}
