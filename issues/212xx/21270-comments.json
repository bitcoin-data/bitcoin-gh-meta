[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #21236 (Net processing: Extract `addr` send functionality into MaybeSendAddr() by jnewbery)\n* #21235 (p2p: Clarify disconnect log message in ProcessGetBlockData, remove send bool by MarcoFalke)\n* #21186 (Net/Net Processing: Move addr data into net_processing by jnewbery)\n* #21061 ([p2p] Introduce node rebroadcast module by amitiuttarwar)\n* #21009 (Remove RewindBlockIndex logic by dhruv)\n* #19521 (Coinstats Index by fjahr)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-02-23T00:55:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21270#issuecomment-783788519",
      "id" : 783788519,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21270",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc4Mzc4ODUxOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-09T05:53:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/783788519",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-03-04T10:01:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21270#issuecomment-790492000",
      "id" : 790492000,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21270",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5MDQ5MjAwMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-04T10:01:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/790492000",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. Will review after rebase.",
      "created_at" : "2021-03-06T18:01:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21270#issuecomment-792000937",
      "id" : 792000937,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21270",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5MjAwMDkzNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-06T18:01:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/792000937",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Pushed a0741fa4d5acb567122d0d43c725f8f64fd75eaf -> 38c325b1df093b2ff380df93c3a518286c531f32\r\n- Rebased over master",
      "created_at" : "2021-03-08T20:36:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21270#issuecomment-793058721",
      "id" : 793058721,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21270",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5MzA1ODcyMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-08T20:36:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/793058721",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Pushed 38c325b1df093b2ff380df93c3a518286c531f32 -> a67983cd6d8e61565da4e03f3ba401d0148fe195\r\n- Addressed https://github.com/bitcoin/bitcoin/pull/21270#commitcomment-47985104 in prepended commit\r\n- Fixed namespace brace syntax mistake in \"net_processing: Move some static functions to PeerManager\"",
      "created_at" : "2021-03-08T20:57:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21270#issuecomment-793071459",
      "id" : 793071459,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21270",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5MzA3MTQ1OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-08T20:57:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/793071459",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r591987692"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/591987692"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think this line would give jnewbery a heart attack... \r\n\r\n```suggestion\r\n    GenerateCoinbaseCommitment(block,\r\n                               WITH_LOCK(::cs_main,\r\n                                         assert(std::addressof(g_chainman.m_blockman) == std::addressof(blockman));\r\n                                         return blockman.LookupBlockIndex(block.hashPrevBlock)),\r\n                               Params().GetConsensus());\r\n```",
      "commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "created_at" : "2021-03-11T00:53:25Z",
      "diff_hunk" : "@@ -39,13 +39,13 @@ int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParam\n     return nNewTime - nOldTime;\n }\n \n-void RegenerateCommitments(CBlock& block)\n+void RegenerateCommitments(CBlock& block, BlockManager& blockman)\n {\n     CMutableTransaction tx{*block.vtx.at(0)};\n     tx.vout.erase(tx.vout.begin() + GetWitnessCommitmentIndex(block));\n     block.vtx.at(0) = MakeTransactionRef(tx);\n \n-    GenerateCoinbaseCommitment(block, WITH_LOCK(cs_main, return g_chainman.m_blockman.LookupBlockIndex(block.hashPrevBlock)), Params().GetConsensus());\n+    GenerateCoinbaseCommitment(block, WITH_LOCK(::cs_main, assert(std::addressof(g_chainman.m_blockman) == std::addressof(blockman)); return blockman.LookupBlockIndex(block.hashPrevBlock)), Params().GetConsensus());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r591987692",
      "id" : 591987692,
      "line" : 48,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MTk4NzY5Mg==",
      "original_commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "original_line" : 48,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/miner.cpp",
      "position" : 12,
      "pull_request_review_id" : 609296491,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-11T01:49:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/591987692",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r592140891"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592140891"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is a really strange C++ construction to me, to have assertions and return statements inside a function argument. It is likely out of scope of this PR to refactor it though. I'm not sure splitting it up over multiple lines makes it much more insightful.\r\n(the change here didn't make it much worse)",
      "commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "created_at" : "2021-03-11T08:04:52Z",
      "diff_hunk" : "@@ -39,13 +39,13 @@ int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParam\n     return nNewTime - nOldTime;\n }\n \n-void RegenerateCommitments(CBlock& block)\n+void RegenerateCommitments(CBlock& block, BlockManager& blockman)\n {\n     CMutableTransaction tx{*block.vtx.at(0)};\n     tx.vout.erase(tx.vout.begin() + GetWitnessCommitmentIndex(block));\n     block.vtx.at(0) = MakeTransactionRef(tx);\n \n-    GenerateCoinbaseCommitment(block, WITH_LOCK(cs_main, return g_chainman.m_blockman.LookupBlockIndex(block.hashPrevBlock)), Params().GetConsensus());\n+    GenerateCoinbaseCommitment(block, WITH_LOCK(::cs_main, assert(std::addressof(g_chainman.m_blockman) == std::addressof(blockman)); return blockman.LookupBlockIndex(block.hashPrevBlock)), Params().GetConsensus());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r592140891",
      "id" : 592140891,
      "in_reply_to_id" : 591987692,
      "line" : 48,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MjE0MDg5MQ==",
      "original_commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "original_line" : 48,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/miner.cpp",
      "position" : 12,
      "pull_request_review_id" : 609480883,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-11T08:05:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592140891",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r592173932"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592173932"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The assert will go away eventually, if I understood correctly, so the line is only temporarily longer than it previously was",
      "commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "created_at" : "2021-03-11T08:56:05Z",
      "diff_hunk" : "@@ -39,13 +39,13 @@ int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParam\n     return nNewTime - nOldTime;\n }\n \n-void RegenerateCommitments(CBlock& block)\n+void RegenerateCommitments(CBlock& block, BlockManager& blockman)\n {\n     CMutableTransaction tx{*block.vtx.at(0)};\n     tx.vout.erase(tx.vout.begin() + GetWitnessCommitmentIndex(block));\n     block.vtx.at(0) = MakeTransactionRef(tx);\n \n-    GenerateCoinbaseCommitment(block, WITH_LOCK(cs_main, return g_chainman.m_blockman.LookupBlockIndex(block.hashPrevBlock)), Params().GetConsensus());\n+    GenerateCoinbaseCommitment(block, WITH_LOCK(::cs_main, assert(std::addressof(g_chainman.m_blockman) == std::addressof(blockman)); return blockman.LookupBlockIndex(block.hashPrevBlock)), Params().GetConsensus());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r592173932",
      "id" : 592173932,
      "in_reply_to_id" : 591987692,
      "line" : 48,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MjE3MzkzMg==",
      "original_commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "original_line" : 48,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/miner.cpp",
      "position" : 12,
      "pull_request_review_id" : 609521912,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-11T08:56:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592173932",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "created_at" : "2021-03-11T10:46:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21270#issuecomment-796645222",
      "id" : 796645222,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21270",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5NjY0NTIyMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-11T10:46:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/796645222",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r592257102"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592257102"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Right :smile: ",
      "commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "created_at" : "2021-03-11T10:49:59Z",
      "diff_hunk" : "@@ -39,13 +39,13 @@ int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParam\n     return nNewTime - nOldTime;\n }\n \n-void RegenerateCommitments(CBlock& block)\n+void RegenerateCommitments(CBlock& block, BlockManager& blockman)\n {\n     CMutableTransaction tx{*block.vtx.at(0)};\n     tx.vout.erase(tx.vout.begin() + GetWitnessCommitmentIndex(block));\n     block.vtx.at(0) = MakeTransactionRef(tx);\n \n-    GenerateCoinbaseCommitment(block, WITH_LOCK(cs_main, return g_chainman.m_blockman.LookupBlockIndex(block.hashPrevBlock)), Params().GetConsensus());\n+    GenerateCoinbaseCommitment(block, WITH_LOCK(::cs_main, assert(std::addressof(g_chainman.m_blockman) == std::addressof(blockman)); return blockman.LookupBlockIndex(block.hashPrevBlock)), Params().GetConsensus());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r592257102",
      "id" : 592257102,
      "in_reply_to_id" : 591987692,
      "line" : 48,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MjI1NzEwMg==",
      "original_commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "original_line" : 48,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/miner.cpp",
      "position" : 12,
      "pull_request_review_id" : 609627196,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-11T10:49:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592257102",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r592274113"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592274113"
         }
      },
      "author_association" : "NONE",
      "body" : "I had a heart attack, but I've returned from beyond the grave to relay this warning from the underworld. Do not make 150 column function calls containing asserts and return statements, lest one day you should have to read and understand that code.\r\n\r\nConsider doing this instead. It's a lot less spooky:\r\n\r\n```suggestion\r\n    CBlockIndex* index;\r\n    {\r\n        LOCK(::cs_main);\r\n        assert(std::addressof(g_chainman.m_blockman) == std::addressof(blockman));\r\n        index = blockman.LookupBlockIndex(block.hashPrevBlock);\r\n    }\r\n    GenerateCoinbaseCommitment(block, index, Params().GetConsensus());\r\n```",
      "commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "created_at" : "2021-03-11T11:15:34Z",
      "diff_hunk" : "@@ -39,13 +39,13 @@ int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParam\n     return nNewTime - nOldTime;\n }\n \n-void RegenerateCommitments(CBlock& block)\n+void RegenerateCommitments(CBlock& block, BlockManager& blockman)\n {\n     CMutableTransaction tx{*block.vtx.at(0)};\n     tx.vout.erase(tx.vout.begin() + GetWitnessCommitmentIndex(block));\n     block.vtx.at(0) = MakeTransactionRef(tx);\n \n-    GenerateCoinbaseCommitment(block, WITH_LOCK(cs_main, return g_chainman.m_blockman.LookupBlockIndex(block.hashPrevBlock)), Params().GetConsensus());\n+    GenerateCoinbaseCommitment(block, WITH_LOCK(::cs_main, assert(std::addressof(g_chainman.m_blockman) == std::addressof(blockman)); return blockman.LookupBlockIndex(block.hashPrevBlock)), Params().GetConsensus());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r592274113",
      "id" : 592274113,
      "in_reply_to_id" : 591987692,
      "line" : 48,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MjI3NDExMw==",
      "original_commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "original_line" : 48,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/miner.cpp",
      "position" : 12,
      "pull_request_review_id" : 609648793,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-11T11:15:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592274113",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/80458851?v=4",
         "events_url" : "https://api.github.com/users/ghostofjnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ghostofjnewbery/followers",
         "following_url" : "https://api.github.com/users/ghostofjnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ghostofjnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ghostofjnewbery",
         "id" : 80458851,
         "login" : "ghostofjnewbery",
         "node_id" : "MDQ6VXNlcjgwNDU4ODUx",
         "organizations_url" : "https://api.github.com/users/ghostofjnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/ghostofjnewbery/received_events",
         "repos_url" : "https://api.github.com/users/ghostofjnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ghostofjnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ghostofjnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ghostofjnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r592287485"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592287485"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Did you consider changing the function signature here to accept a `CBlockIndex*`, which you fetch from blockman before calling the function? That seems like a more natural interface, and would avoid some of the difficult to read `WITH_LOCK()` in function calls.",
      "commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "created_at" : "2021-03-11T11:36:15Z",
      "diff_hunk" : "@@ -39,13 +39,13 @@ int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParam\n     return nNewTime - nOldTime;\n }\n \n-void RegenerateCommitments(CBlock& block)\n+void RegenerateCommitments(CBlock& block, BlockManager& blockman)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r592287485",
      "id" : 592287485,
      "line" : 42,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MjI4NzQ4NQ==",
      "original_commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "original_line" : 42,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/miner.cpp",
      "position" : 5,
      "pull_request_review_id" : 609665296,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592287485/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-11T13:38:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592287485",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r592291225"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592291225"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No need for this include. You can just forward declare `BlockManager`",
      "commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "created_at" : "2021-03-11T11:42:17Z",
      "diff_hunk" : "@@ -8,6 +8,7 @@\n \n #include <amount.h>\n #include <uint256.h>\n+#include <validation.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r592291225",
      "id" : 592291225,
      "line" : 11,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MjI5MTIyNQ==",
      "original_commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "original_line" : 11,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/node/coinstats.h",
      "position" : 4,
      "pull_request_review_id" : 609665296,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592291225/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-11T13:38:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592291225",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r592293190"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592293190"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could this be changed to take just a `CChainstate&`, and get the `CCoinsView` and `BlockManager` from there?",
      "commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "created_at" : "2021-03-11T11:45:42Z",
      "diff_hunk" : "@@ -36,6 +37,6 @@ struct CCoinsStats\n };\n \n //! Calculate statistics about the unspent transaction output set\n-bool GetUTXOStats(CCoinsView* view, CCoinsStats& stats, const CoinStatsHashType hash_type, const std::function<void()>& interruption_point = {});\n+bool GetUTXOStats(CCoinsView* view, BlockManager& blockman, CCoinsStats& stats, const CoinStatsHashType hash_type, const std::function<void()>& interruption_point = {});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r592293190",
      "id" : 592293190,
      "line" : 40,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MjI5MzE5MA==",
      "original_commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "original_line" : 40,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/node/coinstats.h",
      "position" : 13,
      "pull_request_review_id" : 609665296,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592293190/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-11T13:38:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592293190",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r592296942"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592296942"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should this assert happen while holding `cs_main`? Both `ChainstateActive()` and `ActiveChainstate()` take cs_main, but there's a race condition where it changes between those locks.",
      "commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "created_at" : "2021-03-11T11:51:38Z",
      "diff_hunk" : "@@ -202,11 +205,15 @@ class NodeImpl : public Node\n         const CBlockIndex* tip;\n         {\n             LOCK(::cs_main);\n-            tip = ::ChainActive().Tip();\n+            assert(std::addressof(::ChainActive()) == std::addressof(m_context->chainman->ActiveChain()));\n+            tip = m_context->chainman->ActiveChain().Tip();\n         }\n         return GuessVerificationProgress(Params().TxData(), tip);\n     }\n-    bool isInitialBlockDownload() override { return ::ChainstateActive().IsInitialBlockDownload(); }\n+    bool isInitialBlockDownload() override {\n+        assert(std::addressof(::ChainstateActive()) == std::addressof(m_context->chainman->ActiveChainstate()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r592296942",
      "id" : 592296942,
      "line" : 214,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MjI5Njk0Mg==",
      "original_commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "original_line" : 214,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/node/interfaces.cpp",
      "position" : 38,
      "pull_request_review_id" : 609665296,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592296942/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-11T13:38:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592296942",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r592299232"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592299232"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This second assert seems unnecessary. cs_main is held throughout this function. Same below for `findCommonAncestor`.",
      "commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "created_at" : "2021-03-11T11:55:35Z",
      "diff_hunk" : "@@ -479,17 +491,21 @@ class ChainImpl : public Chain\n     {\n         WAIT_LOCK(cs_main, lock);\n         const CChain& active = Assert(m_node.chainman)->ActiveChain();\n-        const CBlockIndex* block = g_chainman.m_blockman.LookupBlockIndex(block_hash);\n-        const CBlockIndex* ancestor = g_chainman.m_blockman.LookupBlockIndex(ancestor_hash);\n+        assert(std::addressof(g_chainman) == std::addressof(*m_node.chainman));\n+        const CBlockIndex* block = m_node.chainman->m_blockman.LookupBlockIndex(block_hash);\n+        assert(std::addressof(g_chainman) == std::addressof(*m_node.chainman));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r592299232",
      "id" : 592299232,
      "line" : 496,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MjI5OTIzMg==",
      "original_commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "original_line" : 496,
      "original_position" : 100,
      "original_start_line" : null,
      "path" : "src/node/interfaces.cpp",
      "position" : 100,
      "pull_request_review_id" : 609665296,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592299232/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-11T13:38:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592299232",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r592299738"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592299738"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same comment as above about holding cs_main for this assert.",
      "commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "created_at" : "2021-03-11T11:56:23Z",
      "diff_hunk" : "@@ -595,7 +613,10 @@ class ChainImpl : public Chain\n         return ::fHavePruned;\n     }\n     bool isReadyToBroadcast() override { return !::fImporting && !::fReindex && !isInitialBlockDownload(); }\n-    bool isInitialBlockDownload() override { return ::ChainstateActive().IsInitialBlockDownload(); }\n+    bool isInitialBlockDownload() override {\n+        assert(std::addressof(::ChainstateActive()) == std::addressof(m_node.chainman->ActiveChainstate()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r592299738",
      "id" : 592299738,
      "line" : 617,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MjI5OTczOA==",
      "original_commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "original_line" : 617,
      "original_position" : 144,
      "original_start_line" : null,
      "path" : "src/node/interfaces.cpp",
      "position" : 144,
      "pull_request_review_id" : 609665296,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592299738/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-11T13:38:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592299738",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r592301704"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592301704"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can you move the function comments to the declarations now that they're no longer static?",
      "commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "created_at" : "2021-03-11T11:59:15Z",
      "diff_hunk" : "@@ -684,41 +702,6 @@ bool PeerManagerImpl::MarkBlockAsInFlight(NodeId nodeid, const uint256& hash, co\n     return true;\n }\n \n-/** Check whether the last unknown block a peer advertised is not yet known. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r592301704",
      "id" : 592301704,
      "line" : 687,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MjMwMTcwNA==",
      "original_commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "original_line" : 687,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 29,
      "pull_request_review_id" : 609665296,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592301704/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-11T13:38:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592301704",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r592302622"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592302622"
         }
      },
      "author_association" : "MEMBER",
      "body" : "None of these functions need to take `Consensus::Params&` now that they're members of `PeerManagerImpl`. They can just use `PeerManagerImpl.m_chainparams.consensus`.",
      "commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "created_at" : "2021-03-11T12:00:40Z",
      "diff_hunk" : "@@ -1200,10 +1218,10 @@ bool PeerManagerImpl::MaybePunishNodeForTx(NodeId nodeid, const TxValidationStat\n // active chain if they are no more than a month older (both in time, and in\n // best equivalent proof of work) than the best header chain we know about and\n // we fully-validated them at some point.\n-static bool BlockRequestAllowed(const CBlockIndex* pindex, const Consensus::Params& consensusParams) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+bool PeerManagerImpl::BlockRequestAllowed(const CBlockIndex* pindex, const Consensus::Params& consensusParams)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r592302622",
      "id" : 592302622,
      "line" : 1221,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MjMwMjYyMg==",
      "original_commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "original_line" : 1221,
      "original_position" : 153,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 153,
      "pull_request_review_id" : 609665296,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592302622/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-11T13:38:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592302622",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r592357247"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592357247"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This sequence of `m_chainman.ActiveChain()` function calls is repeatedly taking a `cs_main` lock and releasing it again (while holding `cs_main` the whole time). That's fine, and correct, but perhaps it'd be better to just take a local `const CChainstate&` variable once to avoid the multiple function calls.",
      "commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "created_at" : "2021-03-11T13:25:57Z",
      "diff_hunk" : "@@ -1920,27 +1939,27 @@ void PeerManagerImpl::ProcessHeadersMessage(CNode& pfrom, const Peer& peer,\n         // because it is set in UpdateBlockAvailability. Some nullptr checks\n         // are still present, however, as belt-and-suspenders.\n \n-        if (received_new_header && pindexLast->nChainWork > ::ChainActive().Tip()->nChainWork) {\n+        if (received_new_header && pindexLast->nChainWork > m_chainman.ActiveChain().Tip()->nChainWork) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r592357247",
      "id" : 592357247,
      "line" : 1942,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MjM1NzI0Nw==",
      "original_commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "original_line" : 1942,
      "original_position" : 301,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 301,
      "pull_request_review_id" : 609665296,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592357247/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-11T13:38:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592357247",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Question: I forget if this was already mentioned somewhere, but why isn't LookupBlockIndex a const member function? Otherwise could be passing const BlockManager&\r\n\r\nI can't see any reason why `LookupBlockIndex` shouldn't be a const function. Changing all the places that `BlockManager&` is passed to pass `const BlockManager&` seems like it'd be a big improvement and indicate to the reader that the function won't mutate the `BlockManager`.",
      "created_at" : "2021-03-11T13:33:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21270#issuecomment-796738048",
      "id" : 796738048,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21270",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5NjczODA0OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-11T13:33:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/796738048",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r593096212"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/593096212"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This should really be a member variable, like the mempool. I'd doubt it would make sense to pass a different chainstate reference than the one the mempool is based on.",
      "commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "created_at" : "2021-03-12T11:14:30Z",
      "diff_hunk" : "@@ -99,7 +99,7 @@ void BlockAssembler::resetBlock()\n Optional<int64_t> BlockAssembler::m_last_block_num_txs{nullopt};\n Optional<int64_t> BlockAssembler::m_last_block_weight{nullopt};\n \n-std::unique_ptr<CBlockTemplate> BlockAssembler::CreateNewBlock(const CScript& scriptPubKeyIn)\n+std::unique_ptr<CBlockTemplate> BlockAssembler::CreateNewBlock(CChainState& chainstate, const CScript& scriptPubKeyIn)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r593096212",
      "id" : 593096212,
      "line" : 102,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MzA5NjIxMg==",
      "original_commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "original_line" : 102,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/miner.cpp",
      "position" : 21,
      "pull_request_review_id" : 610682788,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/593096212/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-12T11:25:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/593096212",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r593096545"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/593096545"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Isn't params a member? Seems odd to pass twice",
      "commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "created_at" : "2021-03-12T11:15:09Z",
      "diff_hunk" : "@@ -472,6 +472,24 @@ class PeerManagerImpl final : public PeerManager\n     std::vector<std::pair<uint256, CTransactionRef>> vExtraTxnForCompact GUARDED_BY(g_cs_orphans);\n     /** Offset into vExtraTxnForCompact to insert the next tx */\n     size_t vExtraTxnForCompactIt GUARDED_BY(g_cs_orphans) = 0;\n+\n+    void ProcessBlockAvailability(NodeId nodeid) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+    void UpdateBlockAvailability(NodeId nodeid, const uint256 &hash) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+    bool CanDirectFetch(const Consensus::Params &consensusParams) EXCLUSIVE_LOCKS_REQUIRED(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r593096545",
      "id" : 593096545,
      "line" : 478,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MzA5NjU0NQ==",
      "original_commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "original_line" : 478,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 7,
      "pull_request_review_id" : 610682788,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/593096545/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-12T11:25:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/593096545",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r593097032"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/593097032"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Any reason to prefer UB over a clean assert, like it is done for node.mempool above?",
      "commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "created_at" : "2021-03-12T11:15:57Z",
      "diff_hunk" : "@@ -12,7 +12,8 @@ void FindCoins(const NodeContext& node, std::map<COutPoint, Coin>& coins)\n {\n     assert(node.mempool);\n     LOCK2(cs_main, node.mempool->cs);\n-    CCoinsViewCache& chain_view = ::ChainstateActive().CoinsTip();\n+    assert(std::addressof(::ChainstateActive()) == std::addressof(node.chainman->ActiveChainstate()));\n+    CCoinsViewCache& chain_view = node.chainman->ActiveChainstate().CoinsTip();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r593097032",
      "id" : 593097032,
      "line" : 16,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MzA5NzAzMg==",
      "original_commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "original_line" : 16,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/node/coin.cpp",
      "position" : 6,
      "pull_request_review_id" : 610682788,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/593097032/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-12T11:25:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/593097032",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r593097867"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/593097867"
         }
      },
      "author_association" : "MEMBER",
      "body" : "same",
      "commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "created_at" : "2021-03-12T11:17:27Z",
      "diff_hunk" : "@@ -182,18 +182,21 @@ class NodeImpl : public Node\n     int getNumBlocks() override\n     {\n         LOCK(::cs_main);\n-        return ::ChainActive().Height();\n+        assert(std::addressof(::ChainActive()) == std::addressof(m_context->chainman->ActiveChain()));\n+        return m_context->chainman->ActiveChain().Height();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r593097867",
      "id" : 593097867,
      "line" : 186,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MzA5Nzg2Nw==",
      "original_commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "original_line" : 186,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/node/interfaces.cpp",
      "position" : 6,
      "pull_request_review_id" : 610682788,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/593097867/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-12T11:25:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/593097867",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r593100570"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/593100570"
         }
      },
      "author_association" : "MEMBER",
      "body" : "same",
      "commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "created_at" : "2021-03-12T11:22:21Z",
      "diff_hunk" : "@@ -39,9 +39,10 @@ TransactionError BroadcastTransaction(NodeContext& node, const CTransactionRef t\n \n     { // cs_main scope\n     LOCK(cs_main);\n+    assert(std::addressof(::ChainstateActive()) == std::addressof(node.chainman->ActiveChainstate()));\n     // If the transaction is already confirmed in the chain, don't do anything\n     // and return early.\n-    CCoinsViewCache &view = ::ChainstateActive().CoinsTip();\n+    CCoinsViewCache &view = node.chainman->ActiveChainstate().CoinsTip();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r593100570",
      "id" : 593100570,
      "line" : 45,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MzEwMDU3MA==",
      "original_commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "original_line" : 45,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/node/transaction.cpp",
      "position" : 8,
      "pull_request_review_id" : 610682788,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/593100570/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-12T11:25:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/593100570",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r593126224"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/593126224"
         }
      },
      "author_association" : "MEMBER",
      "body" : "#21425",
      "commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "created_at" : "2021-03-12T12:09:38Z",
      "diff_hunk" : "@@ -472,6 +472,24 @@ class PeerManagerImpl final : public PeerManager\n     std::vector<std::pair<uint256, CTransactionRef>> vExtraTxnForCompact GUARDED_BY(g_cs_orphans);\n     /** Offset into vExtraTxnForCompact to insert the next tx */\n     size_t vExtraTxnForCompactIt GUARDED_BY(g_cs_orphans) = 0;\n+\n+    void ProcessBlockAvailability(NodeId nodeid) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+    void UpdateBlockAvailability(NodeId nodeid, const uint256 &hash) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+    bool CanDirectFetch(const Consensus::Params &consensusParams) EXCLUSIVE_LOCKS_REQUIRED(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r593126224",
      "id" : 593126224,
      "in_reply_to_id" : 593096545,
      "line" : 478,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MzEyNjIyNA==",
      "original_commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "original_line" : 478,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 7,
      "pull_request_review_id" : 610721335,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/593126224/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-12T12:09:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/593126224",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks everyone for the diligent reviews! I will prepend commits in Bundle 5 when I get the chance and link back to the convo here, we can continue the convos over on the Bundle 5 thread!",
      "created_at" : "2021-03-12T22:12:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21270#issuecomment-797786186",
      "id" : 797786186,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21270",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5Nzc4NjE4Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-12T22:12:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/797786186",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r1073861315"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1073861315"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done in #21525.",
      "commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "created_at" : "2023-01-18T17:40:59Z",
      "diff_hunk" : "@@ -8,6 +8,7 @@\n \n #include <amount.h>\n #include <uint256.h>\n+#include <validation.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r1073861315",
      "id" : 1073861315,
      "in_reply_to_id" : 592291225,
      "line" : 11,
      "node_id" : "PRRC_kwDOABII585AAdLD",
      "original_commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "original_line" : 11,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/node/coinstats.h",
      "position" : 4,
      "pull_request_review_id" : 1254011748,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1073861315/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-18T17:40:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1073861315",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r1073863389"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1073863389"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done in #21525",
      "commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "created_at" : "2023-01-18T17:42:39Z",
      "diff_hunk" : "@@ -684,41 +702,6 @@ bool PeerManagerImpl::MarkBlockAsInFlight(NodeId nodeid, const uint256& hash, co\n     return true;\n }\n \n-/** Check whether the last unknown block a peer advertised is not yet known. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21270#discussion_r1073863389",
      "id" : 1073863389,
      "in_reply_to_id" : 592301704,
      "line" : 687,
      "node_id" : "PRRC_kwDOABII585AAdrd",
      "original_commit_id" : "a67983cd6d8e61565da4e03f3ba401d0148fe195",
      "original_line" : 687,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 29,
      "pull_request_review_id" : 1254015603,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21270",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1073863389/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-18T17:42:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1073863389",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   }
]
