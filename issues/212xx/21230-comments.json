[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Code changes look good, but I don't understand what the problem is or how the fix works. I'm seeing the feature_blockfilterindex_prune.py failure during the sync_all() call https://cirrus-ci.com/task/5429627528151040?command=ci#L3364 and a \"[ProcessGetBlockData] Ignore block request below NODE_NETWORK_LIMITED threshold from peer=0\" message in the logs.\r\n\r\nBut I don't understand what the log message means means or why replacing one generate/sync sequence with two would fix the problem. I also don't understand why this error seems to only happen on one platform, and I can't tell from the bug report whether this is happens reliably is some kind of race condition.",
      "created_at" : "2021-02-19T02:00:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21230#issuecomment-781761074",
      "id" : 781761074,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21230",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc4MTc2MTA3NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-19T02:00:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/781761074",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> But I don't understand what the log message means means or why replacing one generate/sync sequence with two would fix the problem. I also don't understand why this error seems to only happen on one platform, and I can't tell from the bug report whether this is happens reliably is some kind of race condition.\r\n\r\nIf you look at the next line after the logprint, you will see that this is the reason for disconnection:\r\n\r\n```cpp\r\n        LogPrint(BCLog::NET, \"Ignore block request below NODE_NETWORK_LIMITED threshold from peer=%d\\n\", pfrom.GetId());\r\n\r\n        //disconnect node and prevent it from stalling (would otherwise wait for the missing block)\r\n        pfrom.fDisconnect = true;\r\n```\r\nIf you then look up `NODE_NETWORK_LIMITED_MIN_BLOCKS` you will see that it is 288 blocks. Thus, the condition shouldn't be hit when less than 288 blocks (from the tip) are synced. (250 is less than 288)\r\n\r\nThis is a race condition because a node that \"immediately\" requests the block that has been announced to it won't request a block that is 288 blocks \"old\". Thus it won't hit the disconnect.",
      "created_at" : "2021-02-19T08:17:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21230#issuecomment-781913569",
      "id" : 781913569,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21230",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc4MTkxMzU2OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-19T08:17:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/781913569",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Very helpful explanation! Thanks! I didn't know there was a disconnection, and didn't realize ignoring request from a peer might also involve disconnecting the peer.",
      "created_at" : "2021-02-19T09:00:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21230#issuecomment-781935519",
      "id" : 781935519,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21230",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc4MTkzNTUxOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-19T09:04:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/781935519",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   }
]
