{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "Split-off from #20277 \r\n\r\nThis PR halts the processing of unrequested transactions in Bitcoin at TX message reception. An unrequested transaction is one defined by which a \"getdata\" message for its specific identifier (either txid or wtxid) has not been previously issued by the node.\r\n\r\nThis change is motivated by reducing the CPU DoS surface of Bitcoin Core around mempool acceptance. Currently, an attacker can open multiple inbound connections to a node and send expensive to validate, junk transactions. Once the canonical INV/GETDATA sequence is enforced on the network, a further protection would be to deprioritize bandwidth and validation resources allocation, or even to wither connections with such DoSy peers. A permissioned peer (PF_RELAY) will still be able to bypass such restrictions.\r\n\r\nFew high-level questions to go through :\r\n\r\n* Is this change ease any privacy attack, such as transaction origin inference or tx-relay connection graph leaks ?\r\n* Is this change ease observation of internal tx-requester configuration, such as preferred peers ?\r\n* As one identified downside of this change is the potential breaking of tx-relay capabilities of non-compliant Bitcoin clients, should we offer them a wider adaptation period ?\r\n\r\nSee mailing proposal and discussions: https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2021-February/018391.html\r\n\r\nNote, our tx-relay functional test framework wasn't at all compliant with the canonical inv-getdata sequence. This change modifies some tx-relay tests by introducing INV-GETDATA sequence enforcement (`wait_for_getdata`). It comes with a meaningful delay of running the framework (e.g +4min to run `p2p_segwit.py`)\r\n\r\nBetter could be either to label such tested nodes with PF_RELAY and such bypass the new restriction but I fear it might mask some behaviors verified and silently break tests (e.g PF_RELAY impacts the max announcements per-peer buffer). Or either to switch the whitelisting of the new restriction under the more-scoped `PF_FORCERELAY` permission or even some new one (e.g `PF_FORCETXPROCESS`)  ?",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 2,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21224/comments",
   "created_at" : "2021-02-18T14:15:26Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21224/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/21224",
   "id" : 811138753,
   "labels" : [
      {
         "color" : "006b75",
         "default" : false,
         "description" : null,
         "id" : 98298007,
         "name" : "P2P",
         "node_id" : "MDU6TGFiZWw5ODI5ODAwNw==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21224/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDExOlB1bGxSZXF1ZXN0NTc1NzE1Mzgx",
   "number" : 21224,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/21224.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21224",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/21224.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21224"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "[p2p] Halt processing of unrequested transactions",
   "updated_at" : "2021-02-18T14:57:32Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21224",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
      "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
      "followers_url" : "https://api.github.com/users/ariard/followers",
      "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/ariard",
      "id" : 23310655,
      "login" : "ariard",
      "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
      "organizations_url" : "https://api.github.com/users/ariard/orgs",
      "received_events_url" : "https://api.github.com/users/ariard/received_events",
      "repos_url" : "https://api.github.com/users/ariard/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/ariard"
   }
}
