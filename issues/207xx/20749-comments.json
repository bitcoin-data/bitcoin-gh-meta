[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r547447969"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/547447969"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I know I've asked the same question already, but I didn't get why this can't use `chainman.ActiveChainstate().Load...`.\r\n\r\nThis should simplify review because it will touch the same lines of code less often.\r\n\r\nAlso, it shouldn't make review harder, because everyone knows that there is only one chainman (whether it is called `g_chainman` or `chainman` shouldn't matter). On top you added a runtime assertion, which validates this for all executed code paths in our tests:\r\n\r\n```cpp\r\n     assert(std::addressof(::ChainstateActive()) == std::addressof(ActiveChainstate()));",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2020-12-22T18:53:33Z",
      "diff_hunk" : "@@ -699,7 +699,7 @@ static void ThreadImport(ChainstateManager& chainman, std::vector<fs::path> vImp\n             if (!file)\n                 break; // This error is logged in OpenBlockFile\n             LogPrintf(\"Reindexing block file blk%05u.dat...\\n\", (unsigned int)nFile);\n-            LoadExternalBlockFile(chainparams, file, &pos);\n+            ::ChainstateActive().LoadExternalBlockFile(chainparams, file, &pos);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r547447969",
      "id" : 547447969,
      "line" : 708,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzQ0Nzk2OQ==",
      "original_commit_id" : "e8dedbb064e90aaa8b2540c7524af54bbdd49d0a",
      "original_line" : 708,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 5,
      "pull_request_review_id" : 557295697,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/547447969",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r547450444"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/547450444"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Anyway, no big deal if you want to keep it that way. Will review regardless.",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2020-12-22T18:58:50Z",
      "diff_hunk" : "@@ -699,7 +699,7 @@ static void ThreadImport(ChainstateManager& chainman, std::vector<fs::path> vImp\n             if (!file)\n                 break; // This error is logged in OpenBlockFile\n             LogPrintf(\"Reindexing block file blk%05u.dat...\\n\", (unsigned int)nFile);\n-            LoadExternalBlockFile(chainparams, file, &pos);\n+            ::ChainstateActive().LoadExternalBlockFile(chainparams, file, &pos);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r547450444",
      "id" : 547450444,
      "in_reply_to_id" : 547447969,
      "line" : 708,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzQ1MDQ0NA==",
      "original_commit_id" : "e8dedbb064e90aaa8b2540c7524af54bbdd49d0a",
      "original_line" : 708,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 5,
      "pull_request_review_id" : 557298663,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/547450444",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #21025 (validation: Guard the active_chainstate with cs_main by dongcarl)\n* #20758 (net-processing refactoring -- lose globals, move implementation details from .h to .cpp by ajtowns)\n* #20750 ([Bundle 2/n] Prune g_chainman usage in mempool-related validation functions by dongcarl)\n* #20331 (allow -loadblock blocks to be unsorted by LarryRuane)\n* #20158 (tree-wide: De-globalize ChainstateManager by dongcarl)\n* #19806 (validation: UTXO snapshot activation by jamesob)\n* #19594 (refactor: Make mapBlocksUnknownParent local, and rename it by hebasto)\n* #19438 (Introduce deploymentstatus by ajtowns)\n* #16981 (Improve runtime performance of --reindex by LarryRuane)\n* #16333 (test: Set BIP34Height = 2 for regtest by MarcoFalke)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-12-22T20:41:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-749765464",
      "id" : 749765464,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0OTc2NTQ2NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-01T04:22:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/749765464",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r550179512"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550179512"
         }
      },
      "author_association" : "MEMBER",
      "body" : "626b709edfe1bd71e6d485c096ff9a52f698a94c nit: move help text to header file",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2020-12-30T12:33:38Z",
      "diff_hunk" : "@@ -3392,14 +3391,15 @@ std::vector<unsigned char> GenerateCoinbaseCommitment(CBlock& block, const CBloc\n }\n \n //! Returns last CBlockIndex* that is a checkpoint\n-static CBlockIndex* GetLastCheckpoint(const CCheckpointData& data) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+CBlockIndex* BlockManager::GetLastCheckpoint(const CCheckpointData& data)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r550179512",
      "id" : 550179512,
      "line" : 3401,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDE3OTUxMg==",
      "original_commit_id" : "626b709edfe1bd71e6d485c096ff9a52f698a94c",
      "original_line" : 3401,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 93,
      "pull_request_review_id" : 560030209,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550179512",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r550182154"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550182154"
         }
      },
      "author_association" : "MEMBER",
      "body" : "a375714f24b85b6f9ce7e1765a1137e3b85af009 nit: drop `, nullptr`?",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2020-12-30T12:43:32Z",
      "diff_hunk" : "@@ -4671,7 +4667,7 @@ void LoadExternalBlockFile(const CChainParams& chainparams, FILE* fileIn, FlatFi\n                 // Activate the genesis block so normal node progress can continue\n                 if (hash == chainparams.GetConsensus().hashGenesisBlock) {\n                     BlockValidationState state;\n-                    if (!ActivateBestChain(state, chainparams, nullptr)) {\n+                    if (!::ChainstateActive().ActivateBestChain(state, chainparams, nullptr)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r550182154",
      "id" : 550182154,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDE4MjE1NA==",
      "original_commit_id" : "a375714f24b85b6f9ce7e1765a1137e3b85af009",
      "original_line" : 4670,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 560030209,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550182154",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r550182687"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550182687"
         }
      },
      "author_association" : "MEMBER",
      "body" : "a375714f24b85b6f9ce7e1765a1137e3b85af009  Should this comment be preserved?\r\n```\r\n* May not be called with cs_main held. May not be called in a\t\t\r\n* validationinterface callback.\r\n ```",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2020-12-30T12:45:17Z",
      "diff_hunk" : "@@ -654,6 +647,8 @@ class CChainState\n     void PruneAndFlush();\n \n     /**\n+     * Find the best known block, and make it the tip of the block chain\n+     *",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r550182687",
      "id" : 550182687,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDE4MjY4Nw==",
      "original_commit_id" : "a375714f24b85b6f9ce7e1765a1137e3b85af009",
      "original_line" : 653,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 560030209,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/550182687",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK!",
      "created_at" : "2020-12-30T14:25:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-752639564",
      "id" : 752639564,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1MjYzOTU2NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-30T14:25:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/752639564",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r551995246"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/551995246"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Unsure, perhaps @jamesob can help expound on this point a little?",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-05T15:15:41Z",
      "diff_hunk" : "@@ -654,6 +647,8 @@ class CChainState\n     void PruneAndFlush();\n \n     /**\n+     * Find the best known block, and make it the tip of the block chain\n+     *",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r551995246",
      "id" : 551995246,
      "in_reply_to_id" : 550182687,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTk5NTI0Ng==",
      "original_commit_id" : "a375714f24b85b6f9ce7e1765a1137e3b85af009",
      "original_line" : 653,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 561873479,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/551995246",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r551995825"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/551995825"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Will do on next push!",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-05T15:16:35Z",
      "diff_hunk" : "@@ -3392,14 +3391,15 @@ std::vector<unsigned char> GenerateCoinbaseCommitment(CBlock& block, const CBloc\n }\n \n //! Returns last CBlockIndex* that is a checkpoint\n-static CBlockIndex* GetLastCheckpoint(const CCheckpointData& data) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+CBlockIndex* BlockManager::GetLastCheckpoint(const CCheckpointData& data)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r551995825",
      "id" : 551995825,
      "in_reply_to_id" : 550179512,
      "line" : 3401,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTk5NTgyNQ==",
      "original_commit_id" : "626b709edfe1bd71e6d485c096ff9a52f698a94c",
      "original_line" : 3401,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 93,
      "pull_request_review_id" : 561874263,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/551995825",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2021-01-07T17:01:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-756243510",
      "id" : 756243510,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1NjI0MzUxMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-07T17:01:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/756243510",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2021-01-08T21:07:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-756998410",
      "id" : 756998410,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1Njk5ODQxMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-08T21:07:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/756998410",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r555338921"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/555338921"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It is preserved, at the bottom of this comment. It was just duplicated before.\r\n\r\nAlthough I think it's fine to remove \"May not be called with cs_main held.\" We have lock annotations to document/enforce that now, so the comment is redundant.",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-11T21:04:45Z",
      "diff_hunk" : "@@ -654,6 +647,8 @@ class CChainState\n     void PruneAndFlush();\n \n     /**\n+     * Find the best known block, and make it the tip of the block chain\n+     *",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r555338921",
      "id" : 555338921,
      "in_reply_to_id" : 550182687,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTMzODkyMQ==",
      "original_commit_id" : "a375714f24b85b6f9ce7e1765a1137e3b85af009",
      "original_line" : 653,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 565737562,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/555338921",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've reviewed everything up to 94bbdd7134 _validation: Remove global LookupBlockIndex_ and it looks good so far.\r\n\r\nDoes it make sense to remove the `assert(std::addressof(thing) == std::addressof(thing));` lines as the last commit of this PR? Is there value in keeping those in place until the series of PRs is finished?\r\n",
      "created_at" : "2021-01-11T21:08:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-758225714",
      "id" : 758225714,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1ODIyNTcxNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-11T21:08:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/758225714",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r556051990"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/556051990"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"validation: Make CChainState.m_blockman public\" (f28f8e3da5a48be3cdc0207112d9aa8ec8f6e820)\r\n\r\nIs it intentional to add GUARDED_BY here? Maybe add a comment saying what semantics are. I wouldn't think it should be necessary to lock cs_main just to get a reference to the BlockManager instance. It does seem like cs_main is needed to use some BlockManager members, but these are already annotated. ",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-12T20:08:03Z",
      "diff_hunk" : "@@ -541,18 +541,18 @@ class CChainState\n      */\n     mutable std::atomic<bool> m_cached_finished_ibd{false};\n \n-    //! Reference to a BlockManager instance which itself is shared across all\n-    //! CChainState instances. Keeping a local reference allows us to test more\n-    //! easily as opposed to referencing a global.\n-    BlockManager& m_blockman;\n-\n     //! mempool that is kept in sync with the chain\n     CTxMemPool& m_mempool;\n \n     //! Manages the UTXO set, which is a reflection of the contents of `m_chain`.\n     std::unique_ptr<CoinsViews> m_coins_views;\n \n public:\n+    //! Reference to a BlockManager instance which itself is shared across all\n+    //! CChainState instances. Keeping a local reference allows us to test more\n+    //! easily as opposed to referencing a global.\n+    BlockManager& m_blockman GUARDED_BY(::cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r556051990",
      "id" : 556051990,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjA1MTk5MA==",
      "original_commit_id" : "f28f8e3da5a48be3cdc0207112d9aa8ec8f6e820",
      "original_line" : 554,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 566654472,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/556051990",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I've reviewed everything up to [94bbdd7](https://github.com/bitcoin/bitcoin/commit/94bbdd7134588961a63a23a5ac93e6503bee47ec) _validation: Remove global LookupBlockIndex_ and it looks good so far.\r\n\r\nYay! âºï¸ \r\n\r\n> Does it make sense to remove the `assert(std::addressof(thing) == std::addressof(thing));` lines as the last commit of this PR? Is there value in keeping those in place until the series of PRs is finished?\r\n\r\nI did that in a previous version of this PR, but I changed my mind in this version.\r\n\r\nThe main reason for this is that as we make further changes in the future (e.g. call `LoadExternalBlockFile` on the local chainman in `ThreadImport` in [this commit](https://github.com/bitcoin/bitcoin/pull/20158/commits/9711fac132695c303918f6b6a4df494126b99854)) we still want to make sure that these assertions hold up for correctness.\r\n\r\nAnother advantage is that leaving these assertions in prevents new PRs from making the class of mistakes fixed in #20323 from passing tests while the de-globalize chainman bundles are being reviewed and merged.",
      "created_at" : "2021-01-12T20:19:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-758916993",
      "id" : 758916993,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1ODkxNjk5Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-12T20:19:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/758916993",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--4a62be1de6b64f3ed646cdc7932c8cf5-->\nðµï¸ @sipa @fjahr have been requested to review this pull request as specified in the REVIEWERS file.",
      "created_at" : "2021-01-13T11:46:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-759396506",
      "id" : 759396506,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1OTM5NjUwNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-13T11:46:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/759396506",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r556802926"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/556802926"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "True, that doesn't seem necessary!",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-13T20:17:27Z",
      "diff_hunk" : "@@ -541,18 +541,18 @@ class CChainState\n      */\n     mutable std::atomic<bool> m_cached_finished_ibd{false};\n \n-    //! Reference to a BlockManager instance which itself is shared across all\n-    //! CChainState instances. Keeping a local reference allows us to test more\n-    //! easily as opposed to referencing a global.\n-    BlockManager& m_blockman;\n-\n     //! mempool that is kept in sync with the chain\n     CTxMemPool& m_mempool;\n \n     //! Manages the UTXO set, which is a reflection of the contents of `m_chain`.\n     std::unique_ptr<CoinsViews> m_coins_views;\n \n public:\n+    //! Reference to a BlockManager instance which itself is shared across all\n+    //! CChainState instances. Keeping a local reference allows us to test more\n+    //! easily as opposed to referencing a global.\n+    BlockManager& m_blockman GUARDED_BY(::cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r556802926",
      "id" : 556802926,
      "in_reply_to_id" : 556051990,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjgwMjkyNg==",
      "original_commit_id" : "f28f8e3da5a48be3cdc0207112d9aa8ec8f6e820",
      "original_line" : 554,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 567585013,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/556802926",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Push e8dedbb064e90aaa8b2540c7524af54bbdd49d0a -> c948ff186b34693e762fa595ddc174cd88bfd89c\r\n- Addressed https://github.com/bitcoin/bitcoin/pull/20749#discussion_r550179512 and https://github.com/bitcoin/bitcoin/pull/20749#discussion_r556051990\r\n\r\n",
      "created_at" : "2021-01-13T20:19:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-759715558",
      "id" : 759715558,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1OTcxNTU1OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-13T20:19:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/759715558",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r557816128"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557816128"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this `assert` can be removed after 98f2375, as `FindForkInGlobalIndex` is moved to `BlockManager` and thus you can now directly access the new local method `BlockManager::LookupBlockIndex`. Asserting `g_chainmain.m_blockman` equivalence is lapsed ? \r\n\r\nSame for `assert`s in `GetSpendHeight` after d34c069 and in `GetLastCheckpoint` after 866834a",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-15T02:02:56Z",
      "diff_hunk" : "@@ -167,17 +166,19 @@ namespace {\n     std::set<int> setDirtyFileInfo;\n } // anon namespace\n \n-CBlockIndex* LookupBlockIndex(const uint256& hash)\n+CBlockIndex* BlockManager::LookupBlockIndex(const uint256& hash)\n {\n     AssertLockHeld(cs_main);\n-    BlockMap::const_iterator it = g_chainman.BlockIndex().find(hash);\n-    return it == g_chainman.BlockIndex().end() ? nullptr : it->second;\n+    assert(std::addressof(g_chainman.BlockIndex()) == std::addressof(m_block_index));\n+    BlockMap::const_iterator it = m_block_index.find(hash);\n+    return it == m_block_index.end() ? nullptr : it->second;\n }\n \n-CBlockIndex* FindForkInGlobalIndex(const CChain& chain, const CBlockLocator& locator)\n+CBlockIndex* BlockManager::FindForkInGlobalIndex(const CChain& chain, const CBlockLocator& locator)\n {\n     AssertLockHeld(cs_main);\n \n+    assert(std::addressof(g_chainman.m_blockman) == std::addressof(*this));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r557816128",
      "id" : 557816128,
      "line" : 182,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzgxNjEyOA==",
      "original_commit_id" : "c948ff186b34693e762fa595ddc174cd88bfd89c",
      "original_line" : 182,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 20,
      "pull_request_review_id" : 568766234,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557816128",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2021-01-15T11:00:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-760870364",
      "id" : 760870364,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MDg3MDM2NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-15T11:00:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/760870364",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r558249589"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/558249589"
         }
      },
      "author_association" : "MEMBER",
      "body" : "64d27fb0b950bcbd87bc7cd0b4d62f47f305ef88 naming and placement suggestions, feel free to ignore\r\n\r\n- as the verb is \"look up\" (not \"lookup\", which is a noun or adjective), suggest naming the function `LookUpBlockIndex`\r\n\r\n- it may be nice to place the function next to its similar twins, per the following diff\r\n\r\n<details><summary>suggested diff</summary><p>\r\n\r\n```diff\r\n+++ b/src/validation.h\r\n@@ -417,6 +417,7 @@ public:\r\n     CBlockIndex* AddToBlockIndex(const CBlockHeader& block) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\r\n     /** Create a new block index entry for a given block hash */\r\n     CBlockIndex* InsertBlockIndex(const uint256& hash) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\r\n+    CBlockIndex* LookUpBlockIndex(const uint256& hash) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\r\n \r\n     //! Mark one block file as pruned (modify associated database entries)\r\n     void PruneOneBlockFile(const int fileNumber) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\r\n@@ -431,8 +432,6 @@ public:\r\n         const CChainParams& chainparams,\r\n         CBlockIndex** ppindex) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\r\n \r\n-    CBlockIndex* LookupBlockIndex(const uint256& hash) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\r\n-\r\n     ~BlockManager() {\r\n         Unload();\r\n     }\r\n```\r\n</p></details>\r\n",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-15T11:34:55Z",
      "diff_hunk" : "@@ -438,6 +426,21 @@ class BlockManager\n         const CChainParams& chainparams,\n         CBlockIndex** ppindex) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    CBlockIndex* LookupBlockIndex(const uint256& hash) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+\n+    /** Find the last common block between the parameter chain and a locator. */\n+    CBlockIndex* FindForkInGlobalIndex(const CChain& chain, const CBlockLocator& locator) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+\n+    //! Returns last CBlockIndex* that is a checkpoint\n+    CBlockIndex* GetLastCheckpoint(const CCheckpointData& data) EXCLUSIVE_LOCKS_REQUIRED(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r558249589",
      "id" : 558249589,
      "line" : 435,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODI0OTU4OQ==",
      "original_commit_id" : "c948ff186b34693e762fa595ddc174cd88bfd89c",
      "original_line" : 435,
      "original_position" : 70,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 68,
      "pull_request_review_id" : 569183285,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/558249589",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r558488887"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/558488887"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I see your point, but I don't think it hurts anything ð\r\nAll of these will be removed in the end with a scripted-diff anyway",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-15T18:21:35Z",
      "diff_hunk" : "@@ -167,17 +166,19 @@ namespace {\n     std::set<int> setDirtyFileInfo;\n } // anon namespace\n \n-CBlockIndex* LookupBlockIndex(const uint256& hash)\n+CBlockIndex* BlockManager::LookupBlockIndex(const uint256& hash)\n {\n     AssertLockHeld(cs_main);\n-    BlockMap::const_iterator it = g_chainman.BlockIndex().find(hash);\n-    return it == g_chainman.BlockIndex().end() ? nullptr : it->second;\n+    assert(std::addressof(g_chainman.BlockIndex()) == std::addressof(m_block_index));\n+    BlockMap::const_iterator it = m_block_index.find(hash);\n+    return it == m_block_index.end() ? nullptr : it->second;\n }\n \n-CBlockIndex* FindForkInGlobalIndex(const CChain& chain, const CBlockLocator& locator)\n+CBlockIndex* BlockManager::FindForkInGlobalIndex(const CChain& chain, const CBlockLocator& locator)\n {\n     AssertLockHeld(cs_main);\n \n+    assert(std::addressof(g_chainman.m_blockman) == std::addressof(*this));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r558488887",
      "id" : 558488887,
      "in_reply_to_id" : 557816128,
      "line" : 182,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODQ4ODg4Nw==",
      "original_commit_id" : "c948ff186b34693e762fa595ddc174cd88bfd89c",
      "original_line" : 182,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 20,
      "pull_request_review_id" : 569497138,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/558488887",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Note: If #20946 gets in before this, we won't need this last commit I just pushed.",
      "created_at" : "2021-01-15T21:06:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-761197346",
      "id" : 761197346,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MTE5NzM0Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-15T21:06:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/761197346",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r559425521"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559425521"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The lock ordering is to take `cs_main` then take `mempool.cs` so at first glance, this looks like a lock inversion since it's locking `cs_main` while already holding `mempool.cs`. In fact, whenever `mempool.check()` is called, we're already holding `cs_main` (see the two call sites in net_processing).\r\n\r\nI think it'd be better to add an `EXCLUSIVE_LOCKS_REQUIRED(cs_main)` annotation to `check()` and remove the re-entrant lock-taking here.",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-18T09:30:30Z",
      "diff_hunk" : "@@ -625,7 +625,7 @@ void CTxMemPool::check(const CCoinsViewCache *pcoins) const\n     uint64_t innerUsage = 0;\n \n     CCoinsViewCache mempoolDuplicate(const_cast<CCoinsViewCache*>(pcoins));\n-    const int64_t spendheight = GetSpendHeight(mempoolDuplicate);\n+    const int64_t spendheight = WITH_LOCK(::cs_main, return g_chainman.m_blockman.GetSpendHeight(mempoolDuplicate));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r559425521",
      "id" : 559425521,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTQyNTUyMQ==",
      "original_commit_id" : "364fa81a2b014bd6257e011e6a201a48c1b8853e",
      "original_line" : 629,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 570308900,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559425521",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r559429565"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559429565"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No need for this forward declaration. You're including chainparams.h, which is where this is declared.",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-18T09:36:10Z",
      "diff_hunk" : "@@ -50,6 +51,7 @@ struct ChainTxData;\n struct DisconnectedBlockTransactions;\n struct PrecomputedTransactionData;\n struct LockPoints;\n+struct CCheckpointData;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r559429565",
      "id" : 559429565,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTQyOTU2NQ==",
      "original_commit_id" : "364fa81a2b014bd6257e011e6a201a48c1b8853e",
      "original_line" : 54,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 570308900,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559429565",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r559437992"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559437992"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I find these very long lines almost impossible to read. If you touch this branch again, could you be convinced to split it up. Something like:\r\n\r\n```suggestion\r\nbool TestBlockValidity(BlockValidationState& state, const CChainParams& chainparams,\r\n                       CChainState& chainstate, const CBlock& block, CBlockIndex* pindexPrev,\r\n                       bool fCheckPOW = true, bool fCheckMerkleRoot = true)\r\n    EXCLUSIVE_LOCKS_REQUIRED(cs_main);\r\n```",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-18T09:48:53Z",
      "diff_hunk" : "@@ -296,7 +289,7 @@ bool UndoReadFromDisk(CBlockUndo& blockundo, const CBlockIndex* pindex);\n bool CheckBlock(const CBlock& block, BlockValidationState& state, const Consensus::Params& consensusParams, bool fCheckPOW = true, bool fCheckMerkleRoot = true);\n \n /** Check a block is completely valid from start to finish (only works on top of our current best block) */\n-bool TestBlockValidity(BlockValidationState& state, const CChainParams& chainparams, const CBlock& block, CBlockIndex* pindexPrev, bool fCheckPOW = true, bool fCheckMerkleRoot = true) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+bool TestBlockValidity(BlockValidationState& state, const CChainParams& chainparams, CChainState& chainstate, const CBlock& block, CBlockIndex* pindexPrev, bool fCheckPOW = true, bool fCheckMerkleRoot = true) EXCLUSIVE_LOCKS_REQUIRED(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r559437992",
      "id" : 559437992,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTQzNzk5Mg==",
      "original_commit_id" : "364fa81a2b014bd6257e011e6a201a48c1b8853e",
      "original_line" : 292,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 570308900,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559437992",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r559438289"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559438289"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same comment as for the declaration. Consider splitting this line.",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-18T09:49:23Z",
      "diff_hunk" : "@@ -3778,42 +3780,44 @@ bool ChainstateManager::ProcessNewBlock(const CChainParams& chainparams, const s\n         bool ret = CheckBlock(*pblock, state, chainparams.GetConsensus());\n         if (ret) {\n             // Store to disk\n-            ret = ::ChainstateActive().AcceptBlock(pblock, state, chainparams, &pindex, fForceProcessing, nullptr, fNewBlock);\n+            ret = ActiveChainstate().AcceptBlock(pblock, state, chainparams, &pindex, fForceProcessing, nullptr, fNewBlock);\n         }\n         if (!ret) {\n             GetMainSignals().BlockChecked(*pblock, state);\n             return error(\"%s: AcceptBlock FAILED (%s)\", __func__, state.ToString());\n         }\n     }\n \n-    NotifyHeaderTip();\n+    NotifyHeaderTip(ActiveChainstate());\n \n     BlockValidationState state; // Only used to report errors, not invalidity - ignore it\n-    if (!::ChainstateActive().ActivateBestChain(state, chainparams, pblock))\n+    if (!ActiveChainstate().ActivateBestChain(state, chainparams, pblock))\n         return error(\"%s: ActivateBestChain failed (%s)\", __func__, state.ToString());\n \n     return true;\n }\n \n-bool TestBlockValidity(BlockValidationState& state, const CChainParams& chainparams, const CBlock& block, CBlockIndex* pindexPrev, bool fCheckPOW, bool fCheckMerkleRoot)\n+bool TestBlockValidity(BlockValidationState& state, const CChainParams& chainparams, CChainState& chainstate, const CBlock& block, CBlockIndex* pindexPrev, bool fCheckPOW, bool fCheckMerkleRoot)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r559438289",
      "id" : 559438289,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTQzODI4OQ==",
      "original_commit_id" : "364fa81a2b014bd6257e011e6a201a48c1b8853e",
      "original_line" : 3800,
      "original_position" : 201,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 570308900,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559438289",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r559441927"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559441927"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Any reason not to just jump straight to using `EnsureChainman(request.context)` in all the rpc methods that you're touching here?",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-18T09:55:09Z",
      "diff_hunk" : "@@ -375,7 +375,7 @@ static RPCHelpMan generateblock()\n         LOCK(cs_main);\n \n         BlockValidationState state;\n-        if (!TestBlockValidity(state, chainparams, block, LookupBlockIndex(block.hashPrevBlock), false, false)) {\n+        if (!TestBlockValidity(state, chainparams, ::ChainstateActive(), block, g_chainman.m_blockman.LookupBlockIndex(block.hashPrevBlock), false, false)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r559441927",
      "id" : 559441927,
      "line" : 378,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTQ0MTkyNw==",
      "original_commit_id" : "364fa81a2b014bd6257e011e6a201a48c1b8853e",
      "original_line" : 378,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/rpc/mining.cpp",
      "position" : 5,
      "pull_request_review_id" : 570308900,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559441927",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r559524032"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559524032"
         }
      },
      "author_association" : "MEMBER",
      "body" : "There's still some redundant text in here. Consider:\r\n\r\n```diff\r\ndiff --git a/src/validation.h b/src/validation.h\r\nindex 10943b6c24..2e1c441ba5 100644\r\n--- a/src/validation.h\r\n+++ b/src/validation.h\r\n@@ -649,18 +649,16 @@ public:\r\n     void PruneAndFlush();\r\n \r\n     /**\r\n-     * Find the best known block, and make it the tip of the block chain\r\n-     *\r\n-     * Make the best chain active, in multiple steps. The result is either failure\r\n-     * or an activated best chain. pblock is either nullptr or a pointer to a block\r\n-     * that is already loaded (to avoid loading it again from disk).\r\n+     * Find the best known block, and make it the tip of the block chain. The\r\n+     * result is either failure or an activated best chain. pblock is either\r\n+     * nullptr or a pointer to a block that is already loaded (to avoid loading\r\n+     * it again from disk).\r\n      *\r\n      * ActivateBestChain is split into steps (see ActivateBestChainStep) so that\r\n      * we avoid holding cs_main for an extended period of time; the length of this\r\n      * call may be quite long during reindexing or a substantial reorg.\r\n      *\r\n-     * May not be called with cs_main held. May not be called in a\r\n-     * validationinterface callback.\r\n+     * May not be called in a validationinterface callback.\r\n      *\r\n      * @returns true unless a system error occurred\r\n      */\r\n```\r\n\r\n",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-18T12:12:44Z",
      "diff_hunk" : "@@ -643,6 +649,8 @@ class CChainState\n     void PruneAndFlush();\n \n     /**\n+     * Find the best known block, and make it the tip of the block chain",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r559524032",
      "id" : 559524032,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTUyNDAzMg==",
      "original_commit_id" : "364fa81a2b014bd6257e011e6a201a48c1b8853e",
      "original_line" : 652,
      "original_position" : 120,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 570434073,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559524032",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r559544027"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559544027"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`ActiveChainstate()` doesn't take `cs_main`, whereas `::ChainstateActive()` does. Is that a problem? I imagine we shouldn't be reading `m_active_chainstate` without `cs_main`. The comment says:\r\n\r\n```\r\n    //! Once this pointer is set to a corresponding chainstate, it will not\r\n    //! be reset until init.cpp:Shutdown(). This means it is safe to acquire\r\n    //! the contents of this pointer with ::cs_main held, release the lock,\r\n    //! and then use the reference without concern of it being deconstructed.\r\n```\r\n\r\nShould `m_active_chainstate` be GUARDED_BY cs_main and `ActiveChainstate()` have EXCLUSIVE_LOCKS_REQUIRED(::cs_main)?",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-18T12:49:11Z",
      "diff_hunk" : "@@ -3650,8 +3651,8 @@ bool ChainstateManager::ProcessNewBlockHeaders(const std::vector<CBlockHeader>&\n             }\n         }\n     }\n-    if (NotifyHeaderTip()) {\n-        if (::ChainstateActive().IsInitialBlockDownload() && ppindex && *ppindex) {\n+    if (NotifyHeaderTip(ActiveChainstate())) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r559544027",
      "id" : 559544027,
      "line" : 3665,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTU0NDAyNw==",
      "original_commit_id" : "364fa81a2b014bd6257e011e6a201a48c1b8853e",
      "original_line" : 3665,
      "original_position" : 163,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 155,
      "pull_request_review_id" : 570434073,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/559544027",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r560977964"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560977964"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"validation: Move GetSpendHeight to BlockManager\" (d34c0698ec34b45b3ce153dd7ef0b79650e6deb9)\r\n\r\nre: https://github.com/bitcoin/bitcoin/pull/20749#discussion_r559425521\r\n\r\n> The lock ordering is to take `cs_main` then take `mempool.cs` so at first glance, this looks like a lock inversion since it's locking `cs_main` while already holding `mempool.cs`. In fact, whenever `mempool.check()` is called, we're already holding `cs_main` (see the two call sites in net_processing).\r\n> \r\n> I think it'd be better to add an `EXCLUSIVE_LOCKS_REQUIRED(cs_main)` annotation to `check()` and remove the re-entrant lock-taking here.\r\n\r\nThis is true and I commented on it previously https://github.com/bitcoin/bitcoin/pull/20158#discussion_r510481852, but since this commit is just a plain refactoring, I suspect it could complicate the PR in a bad way to try to tackle the lock ordering issue here. I would be happy to see a code comment pointing out the inconsistent lock ordering, or even to see it fixed here if your fix is not that complicated to review and implement. But I suspect this could be better to fix separately since it's not directly related to changes in this PR",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-20T13:57:12Z",
      "diff_hunk" : "@@ -625,7 +625,7 @@ void CTxMemPool::check(const CCoinsViewCache *pcoins) const\n     uint64_t innerUsage = 0;\n \n     CCoinsViewCache mempoolDuplicate(const_cast<CCoinsViewCache*>(pcoins));\n-    const int64_t spendheight = GetSpendHeight(mempoolDuplicate);\n+    const int64_t spendheight = WITH_LOCK(::cs_main, return g_chainman.m_blockman.GetSpendHeight(mempoolDuplicate));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r560977964",
      "id" : 560977964,
      "in_reply_to_id" : 559425521,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDk3Nzk2NA==",
      "original_commit_id" : "364fa81a2b014bd6257e011e6a201a48c1b8853e",
      "original_line" : 629,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 572243158,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560977964",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r560979259"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560979259"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"validation: Use existing chainstate in ChainstateManager::ProcessNewBlockHeaders\" (e0ab7ee8ded2eb44fe2791a081703452012228e8)\r\n\r\nre: https://github.com/bitcoin/bitcoin/pull/20749#discussion_r559544027\r\n\r\n> `ActiveChainstate()` doesn't take `cs_main`, whereas `::ChainstateActive()` does. Is that a problem? I imagine we shouldn't be reading `m_active_chainstate` without `cs_main`. The comment says:\r\n> \r\n> ```\r\n>     //! Once this pointer is set to a corresponding chainstate, it will not\r\n>     //! be reset until init.cpp:Shutdown(). This means it is safe to acquire\r\n>     //! the contents of this pointer with ::cs_main held, release the lock,\r\n>     //! and then use the reference without concern of it being deconstructed.\r\n> ```\r\n> \r\n> Should `m_active_chainstate` be GUARDED_BY cs_main and `ActiveChainstate()` have EXCLUSIVE_LOCKS_REQUIRED(::cs_main)?\r\n\r\nWow, good catch! I assumed ActiveChainstate() either acquired cs_main or required it, and didn't know it was accessing the m_active_chainstate pointer with no protection. This is probably safe for now because the pointer never changes after initialization, but it will not be safe after #19806 which adds an ActivateSnapshot method updating the pointer.\r\n\r\nIn this particular place (this line and next line), I think it would be best not to call either ActiveChainstate or ChainstateActive because both could have a race condition after #19806 if the active chain state changes after cs_main is released in the code immediately above. Best would be to have a `CChainState* chain_state` local variable that is initialized while cs_main is held above, and then used here.\r\n\r\nIf we can add a EXCLUSIVE_LOCKS_REQUIRED annotation to `ActiveChainstate` and GUARDED_BY annotation to `m_active_chainstate` that would be gravy too, but this could also happen in #19806. Suggested it https://github.com/bitcoin/bitcoin/pull/19806#discussion_r561023961",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-20T13:58:57Z",
      "diff_hunk" : "@@ -3650,8 +3651,8 @@ bool ChainstateManager::ProcessNewBlockHeaders(const std::vector<CBlockHeader>&\n             }\n         }\n     }\n-    if (NotifyHeaderTip()) {\n-        if (::ChainstateActive().IsInitialBlockDownload() && ppindex && *ppindex) {\n+    if (NotifyHeaderTip(ActiveChainstate())) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r560979259",
      "id" : 560979259,
      "in_reply_to_id" : 559544027,
      "line" : 3665,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDk3OTI1OQ==",
      "original_commit_id" : "364fa81a2b014bd6257e011e6a201a48c1b8853e",
      "original_line" : 3665,
      "original_position" : 163,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 155,
      "pull_request_review_id" : 572243158,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560979259",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r561009408"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561009408"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"fuzz: Initialize a full TestingSetup instead of BasicTestingSetup\" (364fa81a2b014bd6257e011e6a201a48c1b8853e)\r\n\r\nThis seems safe and fine, but I'm only casually familiar with the fuzzing code and can't say I understand what the goal of the change and new code actually is. It might be good to have a code comment saying what the purpose of TestingSetup/REGTEST/nodebuglogfile is here, or a commit description saying what was bad about the previous InitializeFuzzingContext call",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-20T14:38:29Z",
      "diff_hunk" : "@@ -15,7 +15,7 @@\n \n void initialize_load_external_block_file()\n {\n-    InitializeFuzzingContext();\n+    static TestingSetup setup{CBaseChainParams::REGTEST, {\"-nodebuglogfile\"}};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r561009408",
      "id" : 561009408,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTAwOTQwOA==",
      "original_commit_id" : "364fa81a2b014bd6257e011e6a201a48c1b8853e",
      "original_line" : 18,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/fuzz/load_external_block_file.cpp",
      "position" : null,
      "pull_request_review_id" : 572243158,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561009408",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK 364fa81a2b014bd6257e011e6a201a48c1b8853e\r\nChecked that this only moves methods around and doesn't change any validation logic.",
      "created_at" : "2021-01-20T17:53:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-763824082",
      "id" : 763824082,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MzgyNDA4Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-20T17:53:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/763824082",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Merge please.\r\n\r\nSent from my iPhone\r\n\r\nOn Jan 20, 2021, at 12:56 PM, Wladimir J. van der Laan <notifications@github.com> wrote:\r\n\r\nï»¿\r\n\r\nCode review ACK 364fa81<https://na01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fbitcoin%2Fbitcoin%2Fcommit%2F364fa81a2b014bd6257e011e6a201a48c1b8853e&data=04%7C01%7C%7Cbb75a1f8661a4fe05e2908d8bd6cbcd2%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637467622003259859%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&sdata=XHgPe6fSqzvsnh1XBHfIlLcDFoJ89waX8MwhVHKqYHg%3D&reserved=0>\r\nChecked that this only moves methods around and doesn't change any validation logic.\r\n\r\nâ\r\nYou are receiving this because you are subscribed to this thread.\r\nReply to this email directly, view it on GitHub<https://na01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fbitcoin%2Fbitcoin%2Fpull%2F20749%23issuecomment-763824082&data=04%7C01%7C%7Cbb75a1f8661a4fe05e2908d8bd6cbcd2%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637467622003269855%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&sdata=e6NczllcjARVxt57OIGgQXTAuwh1LFahbVEFKQ%2BoEJ4%3D&reserved=0>, or unsubscribe<https://na01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fnotifications%2Funsubscribe-auth%2FAPQQKWMMOFWXMSDHY7KC5H3S24KNNANCNFSM4VF7LJHQ&data=04%7C01%7C%7Cbb75a1f8661a4fe05e2908d8bd6cbcd2%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637467622003269855%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&sdata=nUXKoVrn0YpE%2BnV9fTaD2jQos%2Fv6dKR99y9QzrjAfnA%3D&reserved=0>.\r\n",
      "created_at" : "2021-01-20T18:11:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-763835015",
      "id" : 763835015,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MzgzNTAxNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-20T18:12:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/763835015",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/65078617?v=4",
         "events_url" : "https://api.github.com/users/kaycoinsUSA/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kaycoinsUSA/followers",
         "following_url" : "https://api.github.com/users/kaycoinsUSA/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kaycoinsUSA/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kaycoinsUSA",
         "id" : 65078617,
         "login" : "kaycoinsUSA",
         "node_id" : "MDQ6VXNlcjY1MDc4NjE3",
         "organizations_url" : "https://api.github.com/users/kaycoinsUSA/orgs",
         "received_events_url" : "https://api.github.com/users/kaycoinsUSA/received_events",
         "repos_url" : "https://api.github.com/users/kaycoinsUSA/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kaycoinsUSA/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kaycoinsUSA/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kaycoinsUSA"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r561293393"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561293393"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I agree with all the points made, I wanted to keep it this way as it doesn't change the existing (fragile) behaviour, but just makes it more obvious. However, I do think it'd be good to add the annotation.\r\n\r\nI opened a new PR for this: https://github.com/bitcoin/bitcoin/pull/20972",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-20T20:48:32Z",
      "diff_hunk" : "@@ -625,7 +625,7 @@ void CTxMemPool::check(const CCoinsViewCache *pcoins) const\n     uint64_t innerUsage = 0;\n \n     CCoinsViewCache mempoolDuplicate(const_cast<CCoinsViewCache*>(pcoins));\n-    const int64_t spendheight = GetSpendHeight(mempoolDuplicate);\n+    const int64_t spendheight = WITH_LOCK(::cs_main, return g_chainman.m_blockman.GetSpendHeight(mempoolDuplicate));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r561293393",
      "id" : 561293393,
      "in_reply_to_id" : 559425521,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTI5MzM5Mw==",
      "original_commit_id" : "364fa81a2b014bd6257e011e6a201a48c1b8853e",
      "original_line" : 629,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 572633494,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561293393",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r561293786"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561293786"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good catch, fixed!",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-20T20:49:10Z",
      "diff_hunk" : "@@ -50,6 +51,7 @@ struct ChainTxData;\n struct DisconnectedBlockTransactions;\n struct PrecomputedTransactionData;\n struct LockPoints;\n+struct CCheckpointData;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r561293786",
      "id" : 561293786,
      "in_reply_to_id" : 559429565,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTI5Mzc4Ng==",
      "original_commit_id" : "364fa81a2b014bd6257e011e6a201a48c1b8853e",
      "original_line" : 54,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 572633984,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561293786",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r561294017"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561294017"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed in: d8a5fe24af84c34492e2b23ed341bae70a3c8983",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-20T20:49:33Z",
      "diff_hunk" : "@@ -296,7 +289,7 @@ bool UndoReadFromDisk(CBlockUndo& blockundo, const CBlockIndex* pindex);\n bool CheckBlock(const CBlock& block, BlockValidationState& state, const Consensus::Params& consensusParams, bool fCheckPOW = true, bool fCheckMerkleRoot = true);\n \n /** Check a block is completely valid from start to finish (only works on top of our current best block) */\n-bool TestBlockValidity(BlockValidationState& state, const CChainParams& chainparams, const CBlock& block, CBlockIndex* pindexPrev, bool fCheckPOW = true, bool fCheckMerkleRoot = true) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+bool TestBlockValidity(BlockValidationState& state, const CChainParams& chainparams, CChainState& chainstate, const CBlock& block, CBlockIndex* pindexPrev, bool fCheckPOW = true, bool fCheckMerkleRoot = true) EXCLUSIVE_LOCKS_REQUIRED(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r561294017",
      "id" : 561294017,
      "in_reply_to_id" : 559437992,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTI5NDAxNw==",
      "original_commit_id" : "364fa81a2b014bd6257e011e6a201a48c1b8853e",
      "original_line" : 292,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 572634224,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561294017",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r561294078"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561294078"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed in: d8a5fe24af84c34492e2b23ed341bae70a3c8983",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-20T20:49:41Z",
      "diff_hunk" : "@@ -3778,42 +3780,44 @@ bool ChainstateManager::ProcessNewBlock(const CChainParams& chainparams, const s\n         bool ret = CheckBlock(*pblock, state, chainparams.GetConsensus());\n         if (ret) {\n             // Store to disk\n-            ret = ::ChainstateActive().AcceptBlock(pblock, state, chainparams, &pindex, fForceProcessing, nullptr, fNewBlock);\n+            ret = ActiveChainstate().AcceptBlock(pblock, state, chainparams, &pindex, fForceProcessing, nullptr, fNewBlock);\n         }\n         if (!ret) {\n             GetMainSignals().BlockChecked(*pblock, state);\n             return error(\"%s: AcceptBlock FAILED (%s)\", __func__, state.ToString());\n         }\n     }\n \n-    NotifyHeaderTip();\n+    NotifyHeaderTip(ActiveChainstate());\n \n     BlockValidationState state; // Only used to report errors, not invalidity - ignore it\n-    if (!::ChainstateActive().ActivateBestChain(state, chainparams, pblock))\n+    if (!ActiveChainstate().ActivateBestChain(state, chainparams, pblock))\n         return error(\"%s: ActivateBestChain failed (%s)\", __func__, state.ToString());\n \n     return true;\n }\n \n-bool TestBlockValidity(BlockValidationState& state, const CChainParams& chainparams, const CBlock& block, CBlockIndex* pindexPrev, bool fCheckPOW, bool fCheckMerkleRoot)\n+bool TestBlockValidity(BlockValidationState& state, const CChainParams& chainparams, CChainState& chainstate, const CBlock& block, CBlockIndex* pindexPrev, bool fCheckPOW, bool fCheckMerkleRoot)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r561294078",
      "id" : 561294078,
      "in_reply_to_id" : 559438289,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTI5NDA3OA==",
      "original_commit_id" : "364fa81a2b014bd6257e011e6a201a48c1b8853e",
      "original_line" : 3800,
      "original_position" : 201,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 572634298,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561294078",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r561294694"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561294694"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed in: d0454bad30253e735254cf7be359212293d952af",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-20T20:50:50Z",
      "diff_hunk" : "@@ -643,6 +649,8 @@ class CChainState\n     void PruneAndFlush();\n \n     /**\n+     * Find the best known block, and make it the tip of the block chain",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r561294694",
      "id" : 561294694,
      "in_reply_to_id" : 559524032,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTI5NDY5NA==",
      "original_commit_id" : "364fa81a2b014bd6257e011e6a201a48c1b8853e",
      "original_line" : 652,
      "original_position" : 120,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 572635102,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561294694",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r561295549"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561295549"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Added some context in the commit message here: 4c4eb967016d80247cbf38e6811c8640761ada42\r\nLmk if that needs additional explanation!",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-20T20:52:00Z",
      "diff_hunk" : "@@ -15,7 +15,7 @@\n \n void initialize_load_external_block_file()\n {\n-    InitializeFuzzingContext();\n+    static TestingSetup setup{CBaseChainParams::REGTEST, {\"-nodebuglogfile\"}};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r561295549",
      "id" : 561295549,
      "in_reply_to_id" : 561009408,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTI5NTU0OQ==",
      "original_commit_id" : "364fa81a2b014bd6257e011e6a201a48c1b8853e",
      "original_line" : 18,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/fuzz/load_external_block_file.cpp",
      "position" : null,
      "pull_request_review_id" : 572636047,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561295549",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r561320325"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561320325"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't think it makes too much of a difference, and I found it clearer to push that decision to a later commit when we've resolved everything under RPC and can see everything that depends on chainman. See: 02e3831e9cd10f78bfde2d67a99c47f08564f07b",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-20T21:31:46Z",
      "diff_hunk" : "@@ -375,7 +375,7 @@ static RPCHelpMan generateblock()\n         LOCK(cs_main);\n \n         BlockValidationState state;\n-        if (!TestBlockValidity(state, chainparams, block, LookupBlockIndex(block.hashPrevBlock), false, false)) {\n+        if (!TestBlockValidity(state, chainparams, ::ChainstateActive(), block, g_chainman.m_blockman.LookupBlockIndex(block.hashPrevBlock), false, false)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r561320325",
      "id" : 561320325,
      "in_reply_to_id" : 559441927,
      "line" : 378,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTMyMDMyNQ==",
      "original_commit_id" : "364fa81a2b014bd6257e011e6a201a48c1b8853e",
      "original_line" : 378,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/rpc/mining.cpp",
      "position" : 5,
      "pull_request_review_id" : 572667148,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561320325",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r561352940"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561352940"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Question: if the concern is that after #19806 the active chainstate may change after âcs_main is released in the code immediately aboveâ, then that concern would still exist even if we did not switch from ::ChainstateActive to ActiveChainstate, no? In other words, this is not a new problem that my PR introduced?\r\n\r\nAs far as I can tell, the behaviour change that switching from ::ChainstateActive to ActiveChainstate introduces is just a possible race condition in ActiveChainstate() whereby a race condition can occur if m_active_chainstate is modified between its assert and its return, which Iâd be happy to fix if we think itâs necessary.",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-20T22:36:24Z",
      "diff_hunk" : "@@ -3650,8 +3651,8 @@ bool ChainstateManager::ProcessNewBlockHeaders(const std::vector<CBlockHeader>&\n             }\n         }\n     }\n-    if (NotifyHeaderTip()) {\n-        if (::ChainstateActive().IsInitialBlockDownload() && ppindex && *ppindex) {\n+    if (NotifyHeaderTip(ActiveChainstate())) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r561352940",
      "id" : 561352940,
      "in_reply_to_id" : 559544027,
      "line" : 3665,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTM1Mjk0MA==",
      "original_commit_id" : "364fa81a2b014bd6257e011e6a201a48c1b8853e",
      "original_line" : 3665,
      "original_position" : 163,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 155,
      "pull_request_review_id" : 572708264,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/561352940",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Pushed d0454bad30253e735254cf7be359212293d952af -> 6ea8e92fc1105cf827acf6a72572d16696e2051c\r\n- Rebased over master to include #20946, dropped last commit accordingly",
      "created_at" : "2021-01-21T15:54:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-764741125",
      "id" : 764741125,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2NDc0MTEyNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-21T15:54:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/764741125",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r564577629"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564577629"
         }
      },
      "author_association" : "MEMBER",
      "body" : "For what it's worth, I'd figured that the [`GUARDED_BY` on `g_chainman`](https://github.com/bitcoin/bitcoin/blob/master/src/validation.h#L937) would've cascaded through to many of the usages in question, but maybe I misunderstood.",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-26T14:59:59Z",
      "diff_hunk" : "@@ -3650,8 +3651,8 @@ bool ChainstateManager::ProcessNewBlockHeaders(const std::vector<CBlockHeader>&\n             }\n         }\n     }\n-    if (NotifyHeaderTip()) {\n-        if (::ChainstateActive().IsInitialBlockDownload() && ppindex && *ppindex) {\n+    if (NotifyHeaderTip(ActiveChainstate())) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r564577629",
      "id" : 564577629,
      "in_reply_to_id" : 559544027,
      "line" : 3665,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDU3NzYyOQ==",
      "original_commit_id" : "364fa81a2b014bd6257e011e6a201a48c1b8853e",
      "original_line" : 3665,
      "original_position" : 163,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 155,
      "pull_request_review_id" : 576435123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564577629",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-ACK 6ea8e92fc1105cf827acf6a72572d16696e2051c",
      "created_at" : "2021-01-26T16:04:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-767646415",
      "id" : 767646415,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2NzY0NjQxNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-26T16:04:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/767646415",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r564711195"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564711195"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Er, why is `WITH_LOCK(cs_main)` needed if `check()` has already asserted that it's held?",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-26T17:51:06Z",
      "diff_hunk" : "@@ -625,7 +625,7 @@ void CTxMemPool::check(const CCoinsViewCache *pcoins) const\n     uint64_t innerUsage = 0;\n \n     CCoinsViewCache mempoolDuplicate(const_cast<CCoinsViewCache*>(pcoins));\n-    const int64_t spendheight = GetSpendHeight(mempoolDuplicate);\n+    const int64_t spendheight = WITH_LOCK(::cs_main, return g_chainman.m_blockman.GetSpendHeight(mempoolDuplicate));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r564711195",
      "id" : 564711195,
      "in_reply_to_id" : 559425521,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDcxMTE5NQ==",
      "original_commit_id" : "364fa81a2b014bd6257e011e6a201a48c1b8853e",
      "original_line" : 629,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 576608102,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564711195",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Pushed 6ea8e92fc1105cf827acf6a72572d16696e2051c -> 2bda16f4e46bf361bcfa600a4e751e6303a63d0d\r\n- Rebased over master to include #20972, dropped cs_main locking according to https://github.com/bitcoin/bitcoin/pull/20749#discussion_r564711195",
      "created_at" : "2021-01-26T20:13:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-767799339",
      "id" : 767799339,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2Nzc5OTMzOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-26T20:13:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/767799339",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r564802417"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564802417"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed!",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-26T20:13:18Z",
      "diff_hunk" : "@@ -625,7 +625,7 @@ void CTxMemPool::check(const CCoinsViewCache *pcoins) const\n     uint64_t innerUsage = 0;\n \n     CCoinsViewCache mempoolDuplicate(const_cast<CCoinsViewCache*>(pcoins));\n-    const int64_t spendheight = GetSpendHeight(mempoolDuplicate);\n+    const int64_t spendheight = WITH_LOCK(::cs_main, return g_chainman.m_blockman.GetSpendHeight(mempoolDuplicate));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r564802417",
      "id" : 564802417,
      "in_reply_to_id" : 559425521,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDgwMjQxNw==",
      "original_commit_id" : "364fa81a2b014bd6257e011e6a201a48c1b8853e",
      "original_line" : 629,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 576723024,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/564802417",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "reACK https://github.com/bitcoin/bitcoin/commit/2bda16f4e46bf361bcfa600a4e751e6303a63d0d, only change is dropping repeat-lock of cs_main",
      "created_at" : "2021-01-27T13:11:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-768275550",
      "id" : 768275550,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2ODI3NTU1MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-27T13:11:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/768275550",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-ACK 2bda16f4e46bf361bcfa600a4e751e6303a63d0d",
      "created_at" : "2021-01-27T13:58:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-768303293",
      "id" : 768303293,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2ODMwMzI5Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-27T13:58:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/768303293",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "If anyone was wondering about resolving the AssumeUTXO changes in #19806 with the deglobalizing-chainman changes, here's an update: https://github.com/bitcoin/bitcoin/pull/19806#issuecomment-768673523.\r\n\r\nThe conclusion was that the PRs are mergeable in any order without much pain if the last commit of the AssumeUTXO changes in #19806 is slightly modified.",
      "created_at" : "2021-01-28T00:50:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-768677337",
      "id" : 768677337,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2ODY3NzMzNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-28T00:53:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/768677337",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r565985090"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565985090"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This isn't required. You can just forward declare `CCheckpointData` and then include chainparams.h in validation.cpp (if a type is only used as a reference argument for a function declaration, you don't need the full definition for that type).",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-28T10:32:54Z",
      "diff_hunk" : "@@ -12,6 +12,7 @@\n \n #include <amount.h>\n #include <coins.h>\n+#include <chainparams.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r565985090",
      "id" : 565985090,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTk4NTA5MA==",
      "original_commit_id" : "2bda16f4e46bf361bcfa600a4e751e6303a63d0d",
      "original_line" : 15,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 578192234,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565985090",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r565987283"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565987283"
         }
      },
      "author_association" : "MEMBER",
      "body" : "\"Keeping a local reference allows us to test more easily as opposed to referencing a global.\" is outdated, since this reference is no longer used just for testing and is part of the public interface.",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-28T10:36:06Z",
      "diff_hunk" : "@@ -525,18 +533,18 @@ class CChainState\n      */\n     mutable std::atomic<bool> m_cached_finished_ibd{false};\n \n-    //! Reference to a BlockManager instance which itself is shared across all\n-    //! CChainState instances. Keeping a local reference allows us to test more\n-    //! easily as opposed to referencing a global.\n-    BlockManager& m_blockman;\n-\n     //! mempool that is kept in sync with the chain\n     CTxMemPool& m_mempool;\n \n     //! Manages the UTXO set, which is a reflection of the contents of `m_chain`.\n     std::unique_ptr<CoinsViews> m_coins_views;\n \n public:\n+    //! Reference to a BlockManager instance which itself is shared across all\n+    //! CChainState instances. Keeping a local reference allows us to test more\n+    //! easily as opposed to referencing a global.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r565987283",
      "id" : 565987283,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTk4NzI4Mw==",
      "original_commit_id" : "2bda16f4e46bf361bcfa600a4e751e6303a63d0d",
      "original_line" : 545,
      "original_position" : 98,
      "original_start_line" : 544,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 578192234,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565987283",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r565989760"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565989760"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I was going to ask if you could `const CChainState&` to indicate that you're not mutating the chainstate...\r\n\r\n... but in fact `TestBlockValidity()` connects the passed-in block to the chain tip. What a terrible name for this function!",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-28T10:39:47Z",
      "diff_hunk" : "@@ -291,7 +283,13 @@ bool UndoReadFromDisk(CBlockUndo& blockundo, const CBlockIndex* pindex);\n bool CheckBlock(const CBlock& block, BlockValidationState& state, const Consensus::Params& consensusParams, bool fCheckPOW = true, bool fCheckMerkleRoot = true);\n \n /** Check a block is completely valid from start to finish (only works on top of our current best block) */\n-bool TestBlockValidity(BlockValidationState& state, const CChainParams& chainparams, const CBlock& block, CBlockIndex* pindexPrev, bool fCheckPOW = true, bool fCheckMerkleRoot = true) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+bool TestBlockValidity(BlockValidationState& state,\n+                       const CChainParams& chainparams,\n+                       CChainState& chainstate,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r565989760",
      "id" : 565989760,
      "line" : 288,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTk4OTc2MA==",
      "original_commit_id" : "2bda16f4e46bf361bcfa600a4e751e6303a63d0d",
      "original_line" : 288,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 38,
      "pull_request_review_id" : 578192234,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565989760",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r566009682"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566009682"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ok!",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-28T11:10:24Z",
      "diff_hunk" : "@@ -375,7 +375,7 @@ static RPCHelpMan generateblock()\n         LOCK(cs_main);\n \n         BlockValidationState state;\n-        if (!TestBlockValidity(state, chainparams, block, LookupBlockIndex(block.hashPrevBlock), false, false)) {\n+        if (!TestBlockValidity(state, chainparams, ::ChainstateActive(), block, g_chainman.m_blockman.LookupBlockIndex(block.hashPrevBlock), false, false)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r566009682",
      "id" : 566009682,
      "in_reply_to_id" : 559441927,
      "line" : 378,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjAwOTY4Mg==",
      "original_commit_id" : "364fa81a2b014bd6257e011e6a201a48c1b8853e",
      "original_line" : 378,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/rpc/mining.cpp",
      "position" : 5,
      "pull_request_review_id" : 578192234,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566009682",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r566019524"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566019524"
         }
      },
      "author_association" : "MEMBER",
      "body" : ">  if the concern is that after #19806 the active chainstate may change after âcs_main is released in the code immediately aboveâ, then that concern would still exist even if we did not switch from ::ChainstateActive to ActiveChainstate, no? In other words, this is not a new problem that my PR introduced?\r\n\r\nThe concern is that reading/writing `m_active_chainstate` is not guaranteed to be atomic. If this thread reads the variable while another thread is writing to it, then it could read the old value, the new value, or anything else. We have no guarantees at all about what is read if the value is not atomic (or guarded by a mutex to prevent multiple threads accessing it at the same time).\r\n\r\nThis seems fairly simple to solve - just make `m_active_chainstate` atomic.",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-28T11:26:56Z",
      "diff_hunk" : "@@ -3650,8 +3651,8 @@ bool ChainstateManager::ProcessNewBlockHeaders(const std::vector<CBlockHeader>&\n             }\n         }\n     }\n-    if (NotifyHeaderTip()) {\n-        if (::ChainstateActive().IsInitialBlockDownload() && ppindex && *ppindex) {\n+    if (NotifyHeaderTip(ActiveChainstate())) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r566019524",
      "id" : 566019524,
      "in_reply_to_id" : 559544027,
      "line" : 3665,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjAxOTUyNA==",
      "original_commit_id" : "364fa81a2b014bd6257e011e6a201a48c1b8853e",
      "original_line" : 3665,
      "original_position" : 163,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 155,
      "pull_request_review_id" : 578192234,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566019524",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r566020865"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566020865"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same problem as above: you're grabbing `m_active_chainstate` without locking cs_main first. I think it'd be easiest to make a local `CChainstate*` variable and set it while holding cs_main.",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-28T11:29:14Z",
      "diff_hunk" : "@@ -3788,42 +3790,50 @@ bool ChainstateManager::ProcessNewBlock(const CChainParams& chainparams, const s\n         bool ret = CheckBlock(*pblock, state, chainparams.GetConsensus());\n         if (ret) {\n             // Store to disk\n-            ret = ::ChainstateActive().AcceptBlock(pblock, state, chainparams, &pindex, fForceProcessing, nullptr, fNewBlock);\n+            ret = ActiveChainstate().AcceptBlock(pblock, state, chainparams, &pindex, fForceProcessing, nullptr, fNewBlock);\n         }\n         if (!ret) {\n             GetMainSignals().BlockChecked(*pblock, state);\n             return error(\"%s: AcceptBlock FAILED (%s)\", __func__, state.ToString());\n         }\n     }\n \n-    NotifyHeaderTip();\n+    NotifyHeaderTip(ActiveChainstate());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r566020865",
      "id" : 566020865,
      "line" : 3802,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjAyMDg2NQ==",
      "original_commit_id" : "2bda16f4e46bf361bcfa600a4e751e6303a63d0d",
      "original_line" : 3802,
      "original_position" : 190,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 182,
      "pull_request_review_id" : 578192234,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T18:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566020865",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Pushed 2bda16f4e46bf361bcfa600a4e751e6303a63d0d -> 246cb0f29b01e9b24cd13388dfd38c4b0729783c\r\n- Rebased on top of #21025 to fix locking\r\n- Addressed jnewbery's review comments (thanks!)",
      "created_at" : "2021-01-28T19:03:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-769305311",
      "id" : 769305311,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2OTMwNTMxMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-28T19:03:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/769305311",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r566338288"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566338288"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed!",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-28T19:04:41Z",
      "diff_hunk" : "@@ -12,6 +12,7 @@\n \n #include <amount.h>\n #include <coins.h>\n+#include <chainparams.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r566338288",
      "id" : 566338288,
      "in_reply_to_id" : 565985090,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjMzODI4OA==",
      "original_commit_id" : "2bda16f4e46bf361bcfa600a4e751e6303a63d0d",
      "original_line" : 15,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 578651849,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T19:04:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566338288",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r566339904"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566339904"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed by rebasing over #21025",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-28T19:07:26Z",
      "diff_hunk" : "@@ -3788,42 +3790,50 @@ bool ChainstateManager::ProcessNewBlock(const CChainParams& chainparams, const s\n         bool ret = CheckBlock(*pblock, state, chainparams.GetConsensus());\n         if (ret) {\n             // Store to disk\n-            ret = ::ChainstateActive().AcceptBlock(pblock, state, chainparams, &pindex, fForceProcessing, nullptr, fNewBlock);\n+            ret = ActiveChainstate().AcceptBlock(pblock, state, chainparams, &pindex, fForceProcessing, nullptr, fNewBlock);\n         }\n         if (!ret) {\n             GetMainSignals().BlockChecked(*pblock, state);\n             return error(\"%s: AcceptBlock FAILED (%s)\", __func__, state.ToString());\n         }\n     }\n \n-    NotifyHeaderTip();\n+    NotifyHeaderTip(ActiveChainstate());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r566339904",
      "id" : 566339904,
      "in_reply_to_id" : 566020865,
      "line" : 3802,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjMzOTkwNA==",
      "original_commit_id" : "2bda16f4e46bf361bcfa600a4e751e6303a63d0d",
      "original_line" : 3802,
      "original_position" : 190,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 182,
      "pull_request_review_id" : 578653891,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T19:07:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566339904",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r566340540"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566340540"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed by rebasing over #21025, thanks all for the patience and guidance!",
      "commit_id" : "246cb0f29b01e9b24cd13388dfd38c4b0729783c",
      "created_at" : "2021-01-28T19:08:19Z",
      "diff_hunk" : "@@ -3650,8 +3651,8 @@ bool ChainstateManager::ProcessNewBlockHeaders(const std::vector<CBlockHeader>&\n             }\n         }\n     }\n-    if (NotifyHeaderTip()) {\n-        if (::ChainstateActive().IsInitialBlockDownload() && ppindex && *ppindex) {\n+    if (NotifyHeaderTip(ActiveChainstate())) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#discussion_r566340540",
      "id" : 566340540,
      "in_reply_to_id" : 559544027,
      "line" : 3665,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjM0MDU0MA==",
      "original_commit_id" : "364fa81a2b014bd6257e011e6a201a48c1b8853e",
      "original_line" : 3665,
      "original_position" : 163,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 155,
      "pull_request_review_id" : 578654620,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20749",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T19:08:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566340540",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Pushed 246cb0f29b01e9b24cd13388dfd38c4b0729783c -> 67c9a83df19c6e2a2edb32336879204e7770b4a7\r\n- Rebased over new changes in #21025",
      "created_at" : "2021-01-28T19:16:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-769312396",
      "id" : 769312396,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2OTMxMjM5Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-28T19:16:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/769312396",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 67c9a83df19c6e2a2edb32336879204e7770b4a7",
      "created_at" : "2021-01-28T19:27:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-769318849",
      "id" : 769318849,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2OTMxODg0OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-28T19:27:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/769318849",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "If @laanwj reACKs this, then I think it'll be ready for merge",
      "created_at" : "2021-02-01T09:34:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-770716244",
      "id" : 770716244,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3MDcxNjI0NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-01T09:34:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/770716244",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-ACK 67c9a83df19c6e2a2edb32336879204e7770b4a7",
      "created_at" : "2021-02-01T12:04:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-770807215",
      "id" : 770807215,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3MDgwNzIxNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-01T12:04:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/770807215",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Warnings are fixed in #21051.",
      "created_at" : "2021-02-01T12:43:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20749#issuecomment-770829188",
      "id" : 770829188,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20749",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3MDgyOTE4OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-01T12:43:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/770829188",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   }
]
