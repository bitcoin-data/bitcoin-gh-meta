[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #20243 (rpc, wallet: Expose wallet id in getwalletinfo RPC output by hebasto)\n* #20205 (wallet: Properly support a wallet id by achow101)\n* #19101 (refactor: remove ::vpwallets and related global variables by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-12-26T18:04:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#issuecomment-751381033",
      "id" : 751381033,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20773",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1MTM4MTAzMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-15T17:03:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/751381033",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r555413735"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/555413735"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"refactor: Track first run state in CWallet\" (b528485dc7701dcd8fafcf2da996160c52546f07)\r\n\r\nCould this be initialized with `bool m_first_run = true` or `bool m_first_run = false` here? It would be nice to avoid possibility of non-determinism since it is technically possible to create a `CWallet` object without loading it",
      "commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "created_at" : "2021-01-11T23:54:20Z",
      "diff_hunk" : "@@ -720,6 +720,9 @@ class CWallet final : public WalletStorage, public interfaces::Chain::Notificati\n     // ScriptPubKeyMan::GetID. In many cases it will be the hash of an internal structure\n     std::map<uint256, std::unique_ptr<ScriptPubKeyMan>> m_spk_managers;\n \n+    /** True if this wallet is loaded for the first time. */\n+    bool m_first_run;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r555413735",
      "id" : 555413735,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTQxMzczNQ==",
      "original_commit_id" : "b528485dc7701dcd8fafcf2da996160c52546f07",
      "original_line" : 724,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 565829082,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T07:53:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/555413735",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r555436448"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/555436448"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"refactor: Move chain checks into CWallet::AttachChain\" (eabcd952d1c664cd964eb3376bc2865a49b33f16)\r\n\r\nI think this commit is not an improvement and that it would be better to drop. Safer and clearer to check these values for errors early as they are initialized, than to initialize one place and do checking later.",
      "commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "created_at" : "2021-01-12T00:52:12Z",
      "diff_hunk" : "@@ -3955,11 +3955,6 @@ std::shared_ptr<CWallet> CWallet::Create(interfaces::Chain& chain, const std::st\n                                _(\"This is the transaction fee you will pay if you send a transaction.\"));\n         }\n         walletInstance->m_pay_tx_fee = CFeeRate(nFeePerK, 1000);\n-        if (walletInstance->m_pay_tx_fee < chain.relayMinFee()) {\n-            error = strprintf(_(\"Invalid amount for -paytxfee=<amount>: '%s' (must be at least %s)\"),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r555436448",
      "id" : 555436448,
      "line" : 4008,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTQzNjQ0OA==",
      "original_commit_id" : "eabcd952d1c664cd964eb3376bc2865a49b33f16",
      "original_line" : 4008,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 89,
      "pull_request_review_id" : 565829082,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T07:53:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/555436448",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r555437036"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/555437036"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"refactor: Update CWallet::AttachChain signature\" (847588a4b8e0dcc9975a675c46eca095c7cce4eb)\r\n\r\nCompile error this line (should say `CWallet`)",
      "commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "created_at" : "2021-01-12T00:54:04Z",
      "diff_hunk" : "@@ -2,13 +2,16 @@\n // Distributed under the MIT software license, see the accompanying\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n+#include <util/translation.h>\n #include <wallet/test/wallet_test_fixture.h>\n \n WalletTestingSetup::WalletTestingSetup(const std::string& chainName)\n     : TestingSetup(chainName),\n       m_wallet(m_node.chain.get(), \"\", CreateMockWalletDatabase())\n {\n     m_wallet.LoadWallet();\n-    CWallet::AttachChain({ &m_wallet, [](CWallet*) {} });\n+    bilingual_str error;\n+    std::vector<bilingual_str> warnings;\n+    CWalle::AttachChain({&m_wallet, [](CWallet*) {}}, *m_node.chain.get(), error, warnings);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r555437036",
      "id" : 555437036,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTQzNzAzNg==",
      "original_commit_id" : "847588a4b8e0dcc9975a675c46eca095c7cce4eb",
      "original_line" : 15,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/wallet/test/wallet_test_fixture.cpp",
      "position" : null,
      "pull_request_review_id" : 565829082,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T07:53:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/555437036",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r555438988"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/555438988"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"refactor: Update CWallet::AttachChain signature\" (847588a4b8e0dcc9975a675c46eca095c7cce4eb)\r\n\r\nThis change seems good but it would be nice to squash this commit into the first commit 4398236619aa1f70886a0e9ae7093b413ec172c6 to make the PR simpler and avoid defining an enum in an an earlier change that gets deleted later",
      "commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "created_at" : "2021-01-12T01:00:09Z",
      "diff_hunk" : "@@ -791,15 +791,12 @@ class CWallet final : public WalletStorage, public interfaces::Chain::Notificati\n     /** Registered interfaces::Chain::Notifications handler. */\n     std::unique_ptr<interfaces::Handler> m_chain_notifications_handler;\n \n-    /** Result of scanning a chain for new transactions */\n-    enum class ScanStatus { SUCCESS, FAILED, MISSING_BLOCKS, SKIPPED };",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r555438988",
      "id" : 555438988,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTQzODk4OA==",
      "original_commit_id" : "847588a4b8e0dcc9975a675c46eca095c7cce4eb",
      "original_line" : 795,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 565829082,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T07:53:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/555438988",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r555441172"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/555441172"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"CWallet::Create move CWallet::AttachChain up into calling code\" (9b575783f0f075d66350def60a842aee9ee05267)\r\n\r\nI don't think it's safe to reorder loading sequence and call AttachChain after g_load_wallet_fns callbacks. It also adds extra code to give callers responsibility to call AttachChain. If the point is to allow wallets to be created without syncing, would suggest just changing `Create` methods's `Chain&` argument to `Chain*` and `if (!walletInstance->AttachChain(chain))` to `if (chain && !walletInstance->AttachChain(*chain))`",
      "commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "created_at" : "2021-01-12T01:07:29Z",
      "diff_hunk" : "@@ -3980,10 +3990,6 @@ std::shared_ptr<CWallet> CWallet::Create(interfaces::Chain& chain, const std::st\n \n     LOCK(walletInstance->cs_wallet);\n \n-    if (!walletInstance->AttachChain(chain, error, warnings)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r555441172",
      "id" : 555441172,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTQ0MTE3Mg==",
      "original_commit_id" : "9b575783f0f075d66350def60a842aee9ee05267",
      "original_line" : 3983,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 565829082,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T07:53:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/555441172",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r555828788"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/555828788"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"refactor: Handle first run in CWallet::AttachChain\" (b20c1e516d5bfc87e8d75a34799a91d71475ee8b)\r\n\r\nI think it's good that this PR adds `m_first_run`, to be able to freely move code around without changing behavior. In the future, though I think it would be good to eliminate `m_first_run`. This `chainStateFlushed` call seems to be the main place it is used, and it would seem better if this code updated the best block in a smarter way less awkwardly tied to the presence of keys and descriptors.",
      "commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "created_at" : "2021-01-12T14:50:20Z",
      "diff_hunk" : "@@ -4036,6 +4034,10 @@ CWallet::ScanStatus CWallet::AttachChain(std::shared_ptr<CWallet> wallet, bool s\n     auto& walletInstance = wallet;\n     LOCK(walletInstance->cs_wallet);\n \n+    if (walletInstance->m_first_run) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r555828788",
      "id" : 555828788,
      "line" : 4071,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTgyODc4OA==",
      "original_commit_id" : "b20c1e516d5bfc87e8d75a34799a91d71475ee8b",
      "original_line" : 4071,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 163,
      "pull_request_review_id" : 565829082,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T07:53:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/555828788",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r557242356"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557242356"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks. I initialised it to `false` so it wouldn't call `chainStateFlushed` by default. I think this is a safer option.",
      "commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "created_at" : "2021-01-14T09:10:19Z",
      "diff_hunk" : "@@ -720,6 +720,9 @@ class CWallet final : public WalletStorage, public interfaces::Chain::Notificati\n     // ScriptPubKeyMan::GetID. In many cases it will be the hash of an internal structure\n     std::map<uint256, std::unique_ptr<ScriptPubKeyMan>> m_spk_managers;\n \n+    /** True if this wallet is loaded for the first time. */\n+    bool m_first_run;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r557242356",
      "id" : 557242356,
      "in_reply_to_id" : 555413735,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzI0MjM1Ng==",
      "original_commit_id" : "b528485dc7701dcd8fafcf2da996160c52546f07",
      "original_line" : 724,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 568038150,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T07:53:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557242356",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r557243331"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557243331"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Squashed.",
      "commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "created_at" : "2021-01-14T09:11:53Z",
      "diff_hunk" : "@@ -791,15 +791,12 @@ class CWallet final : public WalletStorage, public interfaces::Chain::Notificati\n     /** Registered interfaces::Chain::Notifications handler. */\n     std::unique_ptr<interfaces::Handler> m_chain_notifications_handler;\n \n-    /** Result of scanning a chain for new transactions */\n-    enum class ScanStatus { SUCCESS, FAILED, MISSING_BLOCKS, SKIPPED };",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r557243331",
      "id" : 557243331,
      "in_reply_to_id" : 555438988,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzI0MzMzMQ==",
      "original_commit_id" : "847588a4b8e0dcc9975a675c46eca095c7cce4eb",
      "original_line" : 795,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 568039455,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T07:53:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557243331",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r557243550"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557243550"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ð¤¦ ",
      "commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "created_at" : "2021-01-14T09:12:14Z",
      "diff_hunk" : "@@ -2,13 +2,16 @@\n // Distributed under the MIT software license, see the accompanying\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n+#include <util/translation.h>\n #include <wallet/test/wallet_test_fixture.h>\n \n WalletTestingSetup::WalletTestingSetup(const std::string& chainName)\n     : TestingSetup(chainName),\n       m_wallet(m_node.chain.get(), \"\", CreateMockWalletDatabase())\n {\n     m_wallet.LoadWallet();\n-    CWallet::AttachChain({ &m_wallet, [](CWallet*) {} });\n+    bilingual_str error;\n+    std::vector<bilingual_str> warnings;\n+    CWalle::AttachChain({&m_wallet, [](CWallet*) {}}, *m_node.chain.get(), error, warnings);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r557243550",
      "id" : 557243550,
      "in_reply_to_id" : 555437036,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzI0MzU1MA==",
      "original_commit_id" : "847588a4b8e0dcc9975a675c46eca095c7cce4eb",
      "original_line" : 15,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/wallet/test/wallet_test_fixture.cpp",
      "position" : null,
      "pull_request_review_id" : 568039743,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T07:53:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557243550",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r557244933"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557244933"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Totally! I started to look at how the best block record is used and maintained but it sent me down the rabbit hole as I'm not familiar with the codebase yet. I'll look at it as a follow up.",
      "commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "created_at" : "2021-01-14T09:14:13Z",
      "diff_hunk" : "@@ -4036,6 +4034,10 @@ CWallet::ScanStatus CWallet::AttachChain(std::shared_ptr<CWallet> wallet, bool s\n     auto& walletInstance = wallet;\n     LOCK(walletInstance->cs_wallet);\n \n+    if (walletInstance->m_first_run) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r557244933",
      "id" : 557244933,
      "in_reply_to_id" : 555828788,
      "line" : 4071,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzI0NDkzMw==",
      "original_commit_id" : "b20c1e516d5bfc87e8d75a34799a91d71475ee8b",
      "original_line" : 4071,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 163,
      "pull_request_review_id" : 568041513,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T07:53:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557244933",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r557265784"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557265784"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Addressed in a general comment below",
      "commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "created_at" : "2021-01-14T09:45:36Z",
      "diff_hunk" : "@@ -3955,11 +3955,6 @@ std::shared_ptr<CWallet> CWallet::Create(interfaces::Chain& chain, const std::st\n                                _(\"This is the transaction fee you will pay if you send a transaction.\"));\n         }\n         walletInstance->m_pay_tx_fee = CFeeRate(nFeePerK, 1000);\n-        if (walletInstance->m_pay_tx_fee < chain.relayMinFee()) {\n-            error = strprintf(_(\"Invalid amount for -paytxfee=<amount>: '%s' (must be at least %s)\"),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r557265784",
      "id" : 557265784,
      "in_reply_to_id" : 555436448,
      "line" : 4008,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzI2NTc4NA==",
      "original_commit_id" : "eabcd952d1c664cd964eb3376bc2865a49b33f16",
      "original_line" : 4008,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 89,
      "pull_request_review_id" : 568067702,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T07:53:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557265784",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r557270303"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557270303"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for bringing it up. I looked at `g_load_wallet_fns` and there are two use-cases for it both in UI:\r\n * register handler for show progress messages\r\n * create and connect wallet model for UI controller\r\n\r\nI have almost zero understanding of GUI code and QT, but it looks like a safe change to me. Can we ask someone with better understanding of GUI to comment on that?\r\n\r\nAlso see my general comment below regarding the responsibility to call `AttachChain`.",
      "commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "created_at" : "2021-01-14T09:52:28Z",
      "diff_hunk" : "@@ -3980,10 +3990,6 @@ std::shared_ptr<CWallet> CWallet::Create(interfaces::Chain& chain, const std::st\n \n     LOCK(walletInstance->cs_wallet);\n \n-    if (!walletInstance->AttachChain(chain, error, warnings)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r557270303",
      "id" : 557270303,
      "in_reply_to_id" : 555441172,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzI3MDMwMw==",
      "original_commit_id" : "9b575783f0f075d66350def60a842aee9ee05267",
      "original_line" : 3983,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 568073389,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T07:53:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557270303",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@ryanofsky greatly appreciate your review.\r\n\r\n> * It would be good to squash 5th commit into 1st commit. No need to add a method and enum in one commit and then change the signature and drop the enum right after.\r\n\r\nI squashed handling first run and changing signature commits into adding `AttachChain`. There are less changing back and forth and overall it looks a bit simpler now.\r\n\r\n> * I think 4th and 7th commits should probably be dropped, but see specific comments below.\r\n\r\nI believe it's good to discuss a bit the design and future of `CWallet` before moving forward. I made those changes based on the following assumptions:\r\n A)Â a wallet instance is not dependent on a chain object and could exist without a chain\r\n B) a wallet instance could be later attached to a chain if required\r\nThose assumption are based on my observation of the `wallet tool` which operates completely \"offline\". In my opinion this provides nice and clear wallet lifecycle and delineation of concerns. Thus we would remove `chain` argument from `CWallet` ctr and `Create` methods in the future. It would require changing how tx are loaded, but I think it's doable and would simplify the code.\r\n\r\nI'd like to know what do you think.",
      "created_at" : "2021-01-14T09:52:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#issuecomment-760086132",
      "id" : 760086132,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20773",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MDA4NjEzMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-14T09:52:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/760086132",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ISTM there are 5 main components of `CWallet::Create`: Loading/creating the wallet file, initializing new wallets, processing all of the wallet CLI args, setting up the chain, and setting up wallet client interfaces.\r\n\r\nWhat I had envisioned for splitting up `CWallet::Create` was to have separate functions for each of those components but still having `CWallet::Create` call all of them. This would allow for the typical use case to have a convenience function that does everything. But for the wallet tool where we don't need to do some of those parts, we could just call the underlying functions directly. For example, for `bitcoin-wallet create`, we would just call the load/create wallet file function, and then the setup new wallet function.\r\n\r\nI agree with @ryanofsky that the assumption that changing the attached chain later is incorrect. I don't think it makes sense that the wallet would want to be able to change to a new chain after being initialized. However it does make sense that we would want to create a wallet with no chain for the offline mode stuff.",
      "created_at" : "2021-01-15T20:31:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#issuecomment-761182042",
      "id" : 761182042,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20773",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MTE4MjA0Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-15T20:31:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/761182042",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks ryanofsky and achow101, I have a better understanding now and adjusted my PR accordingly:\r\n\r\n1) I removed the last commit and  restored `AttachChain` call within `CWallet::Create`\r\n2) I made `chain` arg of `CWallet::Create` optional to accommodate wallet tool use-case\r\n\r\nI kept the 3rd commit which moves chain related checks to `AttachChain`. This way we can have all chain related code in `AttachChain` method in alignment with what achow101 said. As a benefit we need to check if `chain` is passed into `CWallet::Create` only once.\r\n\r\nThanks for your reviews, I'm more satisfied with how this PR looks right now.",
      "created_at" : "2021-01-18T08:51:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#issuecomment-762091567",
      "id" : 762091567,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20773",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MjA5MTU2Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-18T08:51:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/762091567",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-03-12T07:41:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#issuecomment-797300676",
      "id" : 797300676,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20773",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5NzMwMDY3Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-12T07:41:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/797300676",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@meshcollider did you want to have a look here?",
      "created_at" : "2021-04-01T09:18:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#issuecomment-811775801",
      "id" : 811775801,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20773",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMTc3NTgwMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-01T09:18:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/811775801",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Yep I will review this sometime in the next couple of days ð \r\n\r\nConcept ACK",
      "created_at" : "2021-04-06T04:54:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#issuecomment-813820506",
      "id" : 813820506,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20773",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMzgyMDUwNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-06T04:54:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/813820506",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/meshcollider/followers",
         "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/meshcollider",
         "id" : 3211283,
         "login" : "meshcollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
         "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
         "repos_url" : "https://api.github.com/users/meshcollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/meshcollider"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-04-13T16:30:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#issuecomment-818873866",
      "id" : 818873866,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20773",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxODg3Mzg2Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-13T16:30:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/818873866",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased to fix conflict in `src/wallet/test/wallet_tests.cpp`",
      "created_at" : "2021-04-14T07:53:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#issuecomment-819311990",
      "id" : 819311990,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20773",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxOTMxMTk5MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-14T07:53:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/819311990",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r628893976"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/628893976"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Question: How does one distinguish whether accessing a wallet field (in this case `walletInstance->m_first_run`) requires `cs_wallet` lock or not? I'm asking because `cs_wallet` is described like this:\r\n\r\n```cpp\r\n/*\r\n * Main wallet lock.\r\n * This lock protects all the fields added by CWallet.  */\r\nmutable RecursiveMutex cs_wallet;\r\n```\r\n\r\nCan anybody shed light on this for my information?\r\n",
      "commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "created_at" : "2021-05-09T13:55:09Z",
      "diff_hunk" : "@@ -3879,7 +3877,7 @@ std::shared_ptr<CWallet> CWallet::Create(interfaces::Chain& chain, const std::st\n         }\n     }\n \n-    if (fFirstRun)\n+    if (walletInstance->m_first_run)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r628893976",
      "id" : 628893976,
      "line" : 3880,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyODg5Mzk3Ng==",
      "original_commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "original_line" : 3880,
      "original_position" : 71,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 71,
      "pull_request_review_id" : 655081122,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-09T13:55:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/628893976",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/58662979?v=4",
         "events_url" : "https://api.github.com/users/kiminuo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kiminuo/followers",
         "following_url" : "https://api.github.com/users/kiminuo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kiminuo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kiminuo",
         "id" : 58662979,
         "login" : "kiminuo",
         "node_id" : "MDQ6VXNlcjU4NjYyOTc5",
         "organizations_url" : "https://api.github.com/users/kiminuo/orgs",
         "received_events_url" : "https://api.github.com/users/kiminuo/received_events",
         "repos_url" : "https://api.github.com/users/kiminuo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kiminuo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kiminuo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kiminuo"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-05-10T12:13:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#issuecomment-836622316",
      "id" : 836622316,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20773",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgzNjYyMjMxNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-10T12:13:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/836622316",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r629334016"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/629334016"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Question: How does one distinguish whether accessing a wallet field (in this case `walletInstance->m_first_run`) requires `cs_wallet` lock or not?\r\n\r\nPeople may have different ideas about what \"requires\" means, but I would say a variable is required to be locked if not locking it would cause bugs. I.e. if it can be read and written at the same time from multiple threads. So a lock is not required for this because parts of wallet loading code which use this are single threaded.\r\n\r\nBut I do think it would be a small improvement to write `bool m_first_run GUARDED_BY(cs_wallet) = false;` and lock during init to avoid questions and doubts about races during loading.",
      "commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "created_at" : "2021-05-10T12:54:23Z",
      "diff_hunk" : "@@ -3879,7 +3877,7 @@ std::shared_ptr<CWallet> CWallet::Create(interfaces::Chain& chain, const std::st\n         }\n     }\n \n-    if (fFirstRun)\n+    if (walletInstance->m_first_run)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r629334016",
      "id" : 629334016,
      "in_reply_to_id" : 628893976,
      "line" : 3880,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyOTMzNDAxNg==",
      "original_commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "original_line" : 3880,
      "original_position" : 71,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 71,
      "pull_request_review_id" : 655608573,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-10T12:54:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/629334016",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r629602249"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/629602249"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for the review. Since I need to rebase the branch anyway I'm going to incorporate the suggestion",
      "commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "created_at" : "2021-05-10T18:48:42Z",
      "diff_hunk" : "@@ -3879,7 +3877,7 @@ std::shared_ptr<CWallet> CWallet::Create(interfaces::Chain& chain, const std::st\n         }\n     }\n \n-    if (fFirstRun)\n+    if (walletInstance->m_first_run)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r629602249",
      "id" : 629602249,
      "in_reply_to_id" : 628893976,
      "line" : 3880,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyOTYwMjI0OQ==",
      "original_commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "original_line" : 3880,
      "original_position" : 71,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 71,
      "pull_request_review_id" : 655980749,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-10T18:48:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/629602249",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "While I think this is a good improvement, there are a few changes I would like to see before ACK'ing this.\r\n\r\n1. We don't need `m_first_run`. The only reason it needs to be in `AttachChain` is to allow for new wallets to be initialized with a best block that is the current tip to avoid unnecessary rescanning. But because we shouldn't be using `AttachChain` outside of `Create`, I think it would be better to have `first_run` parameter on `AttachChain` rather than `CWallet::m_first_run`.\r\n\r\n   Even so, I'm not sure if it really makes sense to have `AttachChain` be setting that for newly created wallets. Instead, because `Create` has a chain optionally, we can just check if the chain exists and do the `walletInstance->chainStateFlushed` if it does.\r\n\r\n2. `AttachChain` should be a private function since I don't think we want to have callers to be able to change the chain after the wallet has been created.\r\n\r\nAlso, needs rebase.",
      "created_at" : "2021-05-10T20:09:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#issuecomment-837258798",
      "id" : 837258798,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20773",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgzNzI1ODc5OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-10T20:09:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/837258798",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r629660134"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/629660134"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> People may have different ideas about what \"requires\" means, but I would say a variable is required to be locked if not locking it would cause bugs. I.e. if it can be read and written at the same time from multiple threads. So a lock is not required for this because parts of wallet loading code which use this are single threaded.\r\n\r\nThank you for the explanation. \r\n\r\n> But I do think it would be a small improvement to write `bool m_first_run GUARDED_BY(cs_wallet) = false;` and lock during init to avoid questions and doubts about races during loading.\r\n\r\nThis makes a lot of sense to me because it's much easier to follow comments specifying a class design rather than read all code that uses given class (possibly many many places).",
      "commit_id" : "37b55f38d31c05f1ae6e22537eea8707463168a6",
      "created_at" : "2021-05-10T20:24:39Z",
      "diff_hunk" : "@@ -3879,7 +3877,7 @@ std::shared_ptr<CWallet> CWallet::Create(interfaces::Chain& chain, const std::st\n         }\n     }\n \n-    if (fFirstRun)\n+    if (walletInstance->m_first_run)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r629660134",
      "id" : 629660134,
      "in_reply_to_id" : 628893976,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyOTY2MDEzNA==",
      "original_commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "original_line" : 3880,
      "original_position" : 71,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 656054596,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-10T20:24:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/629660134",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/58662979?v=4",
         "events_url" : "https://api.github.com/users/kiminuo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kiminuo/followers",
         "following_url" : "https://api.github.com/users/kiminuo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kiminuo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kiminuo",
         "id" : 58662979,
         "login" : "kiminuo",
         "node_id" : "MDQ6VXNlcjU4NjYyOTc5",
         "organizations_url" : "https://api.github.com/users/kiminuo/orgs",
         "received_events_url" : "https://api.github.com/users/kiminuo/received_events",
         "repos_url" : "https://api.github.com/users/kiminuo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kiminuo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kiminuo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kiminuo"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Agree with Achow's suggestions. But if the suggestions turn out to be hard to implement, I hope we consider them optional. The big improvement I see in this PR is that that it unscrambles wallet loading code from wallet syncing code. This is important so syncing code can be moved to a higher-level, so wallet code can be less monolithic and so multiple wallets can be synced in a single scan during loading.\r\n\r\nIf having a first run member or a having public attach method helps keep this PR a plain refactor instead of introducing new logic, or helps keep this PR small, while still separating loading from syncing, this doesn't seem like a bad tradeoff. But it's pretty likely no tradeoff is necessary, so this does seem worth looking into.",
      "created_at" : "2021-05-10T20:36:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#issuecomment-837298935",
      "id" : 837298935,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20773",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgzNzI5ODkzNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-10T20:36:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/837298935",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "1. Reworked the first commit. It doesn't introduce `m_frist_run`, but rather just moves the first run detection closer to the point of use\r\n2. Updated `AttachChain` signature. Made it private and changed the first param to const reference\r\n3. Added a check that chain can't be changed.",
      "created_at" : "2021-05-15T13:00:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#issuecomment-841655833",
      "id" : 841655833,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20773",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg0MTY1NTgzMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-15T13:00:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/841655833",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r632946907"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632946907"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I've dropped `m_first_run` altogether ",
      "commit_id" : "37b55f38d31c05f1ae6e22537eea8707463168a6",
      "created_at" : "2021-05-15T13:02:04Z",
      "diff_hunk" : "@@ -3879,7 +3877,7 @@ std::shared_ptr<CWallet> CWallet::Create(interfaces::Chain& chain, const std::st\n         }\n     }\n \n-    if (fFirstRun)\n+    if (walletInstance->m_first_run)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r632946907",
      "id" : 632946907,
      "in_reply_to_id" : 628893976,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMjk0NjkwNw==",
      "original_commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "original_line" : 3880,
      "original_position" : 71,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 660342590,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-15T13:02:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632946907",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r633120365"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/633120365"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: could be `const`",
      "commit_id" : "37b55f38d31c05f1ae6e22537eea8707463168a6",
      "created_at" : "2021-05-16T18:06:41Z",
      "diff_hunk" : "@@ -3924,6 +3920,10 @@ std::shared_ptr<CWallet> CWallet::Create(interfaces::Chain& chain, const std::st\n         }\n     }\n \n+    // This wallet is in its first run if there are no ScriptPubKeyMans and it isn't blank or no privkeys\n+    bool fFirstRun = walletInstance->m_spk_managers.empty() &&",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r633120365",
      "id" : 633120365,
      "line" : 3924,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMzEyMDM2NQ==",
      "original_commit_id" : "efd5396b894f5a73aac1940d41642345b2adf86f",
      "original_line" : 3924,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 71,
      "pull_request_review_id" : 660454406,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-16T19:50:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/633120365",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code Review ACK 37b55f38d31c05f1ae6e22537eea8707463168a6",
      "created_at" : "2021-05-17T19:10:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#issuecomment-842565169",
      "id" : 842565169,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20773",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg0MjU2NTE2OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-17T19:10:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/842565169",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r634407700"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634407700"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"refactor: Add CWallet:::AttachChain method\" (491feef0e97adf4ec5ca1b17a0c097a4f7324a9e)\r\n\r\nNot very important but I wonder if you could drop the `|| walletInstance->m_chain == &chain` condition. It seems like it would be a bug to call attachchain more than once, even with the same chain pointer.",
      "commit_id" : "37b55f38d31c05f1ae6e22537eea8707463168a6",
      "created_at" : "2021-05-18T13:55:32Z",
      "diff_hunk" : "@@ -4089,6 +4089,35 @@ std::shared_ptr<CWallet> CWallet::Create(interfaces::Chain& chain, const std::st\n \n     LOCK(walletInstance->cs_wallet);\n \n+    if (!AttachChain(walletInstance, chain, error, warnings)) {\n+        return nullptr;\n+    }\n+\n+    {\n+        LOCK(cs_wallets);\n+        for (auto& load_wallet : g_load_wallet_fns) {\n+            load_wallet(interfaces::MakeWallet(walletInstance));\n+        }\n+    }\n+\n+    walletInstance->SetBroadcastTransactions(gArgs.GetBoolArg(\"-walletbroadcast\", DEFAULT_WALLETBROADCAST));\n+\n+    {\n+        walletInstance->WalletLogPrintf(\"setKeyPool.size() = %u\\n\",      walletInstance->GetKeyPoolSize());\n+        walletInstance->WalletLogPrintf(\"mapWallet.size() = %u\\n\",       walletInstance->mapWallet.size());\n+        walletInstance->WalletLogPrintf(\"m_address_book.size() = %u\\n\",  walletInstance->m_address_book.size());\n+    }\n+\n+    return walletInstance;\n+}\n+\n+bool CWallet::AttachChain(const std::shared_ptr<CWallet>& walletInstance, interfaces::Chain& chain, bilingual_str& error, std::vector<bilingual_str>& warnings)\n+{\n+    LOCK(walletInstance->cs_wallet);\n+    // allow setting the chain if it hasn't been set already but prevent changing it\n+    assert(!walletInstance->m_chain || walletInstance->m_chain == &chain);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r634407700",
      "id" : 634407700,
      "line" : 4105,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDQwNzcwMA==",
      "original_commit_id" : "491feef0e97adf4ec5ca1b17a0c097a4f7324a9e",
      "original_line" : 4118,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 150,
      "pull_request_review_id" : 662119150,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-18T14:31:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634407700",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r634430171"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634430171"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"refactor: Move chain checks into CWallet::AttachChain\" (88f19822bd14d23e2e0f4ebc7e7221f029d0abad)\r\n\r\nI still think this commit is not an improvement and should be dropped because it makes the already complicated handling of these fee options and errors more complicated and less transparent. Instead of handling the settings in one place in `Create`, it splits up handling between two functions `Create` and `AttachChain`, when the code doesn't actually have anything to do with attaching to the chain. It is true that this code **currently** depends on some chain methods. But this should be fixed in the future by [making the chain object less monolithic](https://github.com/bitcoin/bitcoin/blob/741749a6159eb68dd8a3c5ef0d1701337931e6df/src/interfaces/chain.h#L69-L88) and by improving options handling in general.\r\n\r\nI understand the motivation for this commit which is stated at https://github.com/bitcoin/bitcoin/pull/20773#issuecomment-760086132 and is basically to help implement the subsequent commit \"wallet: make chain optional for CWallet::Create\" (37b55f38d31c05f1ae6e22537eea8707463168a6).\r\n\r\nBut I don't think a good way to make the chain optional is to move these checks to an unrelated place where they don't belong. The simplest and clearest way to make the chain optional for now is simply to skip these checks if the chain pointer is null. And in the future, these checks can be updated to not use the chain interface at all.",
      "commit_id" : "37b55f38d31c05f1ae6e22537eea8707463168a6",
      "created_at" : "2021-05-18T14:19:12Z",
      "diff_hunk" : "@@ -3955,11 +3955,6 @@ std::shared_ptr<CWallet> CWallet::Create(interfaces::Chain& chain, const std::st\n                                _(\"This is the transaction fee you will pay if you send a transaction.\"));\n         }\n         walletInstance->m_pay_tx_fee = CFeeRate(nFeePerK, 1000);\n-        if (walletInstance->m_pay_tx_fee < chain.relayMinFee()) {\n-            error = strprintf(_(\"Invalid amount for -paytxfee=<amount>: '%s' (must be at least %s)\"),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r634430171",
      "id" : 634430171,
      "in_reply_to_id" : 555436448,
      "line" : 4053,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDQzMDE3MQ==",
      "original_commit_id" : "eabcd952d1c664cd964eb3376bc2865a49b33f16",
      "original_line" : 4053,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 93,
      "pull_request_review_id" : 662119150,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-18T14:33:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634430171",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r634626623"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634626623"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`m_chain` is initialized in the CWallet ctr. I've tried to drop it originally, but there were some issues, so I decided to leave it for the follow up.",
      "commit_id" : "37b55f38d31c05f1ae6e22537eea8707463168a6",
      "created_at" : "2021-05-18T18:00:30Z",
      "diff_hunk" : "@@ -4089,6 +4089,35 @@ std::shared_ptr<CWallet> CWallet::Create(interfaces::Chain& chain, const std::st\n \n     LOCK(walletInstance->cs_wallet);\n \n+    if (!AttachChain(walletInstance, chain, error, warnings)) {\n+        return nullptr;\n+    }\n+\n+    {\n+        LOCK(cs_wallets);\n+        for (auto& load_wallet : g_load_wallet_fns) {\n+            load_wallet(interfaces::MakeWallet(walletInstance));\n+        }\n+    }\n+\n+    walletInstance->SetBroadcastTransactions(gArgs.GetBoolArg(\"-walletbroadcast\", DEFAULT_WALLETBROADCAST));\n+\n+    {\n+        walletInstance->WalletLogPrintf(\"setKeyPool.size() = %u\\n\",      walletInstance->GetKeyPoolSize());\n+        walletInstance->WalletLogPrintf(\"mapWallet.size() = %u\\n\",       walletInstance->mapWallet.size());\n+        walletInstance->WalletLogPrintf(\"m_address_book.size() = %u\\n\",  walletInstance->m_address_book.size());\n+    }\n+\n+    return walletInstance;\n+}\n+\n+bool CWallet::AttachChain(const std::shared_ptr<CWallet>& walletInstance, interfaces::Chain& chain, bilingual_str& error, std::vector<bilingual_str>& warnings)\n+{\n+    LOCK(walletInstance->cs_wallet);\n+    // allow setting the chain if it hasn't been set already but prevent changing it\n+    assert(!walletInstance->m_chain || walletInstance->m_chain == &chain);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r634626623",
      "id" : 634626623,
      "in_reply_to_id" : 634407700,
      "line" : 4105,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYyNjYyMw==",
      "original_commit_id" : "491feef0e97adf4ec5ca1b17a0c097a4f7324a9e",
      "original_line" : 4118,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 150,
      "pull_request_review_id" : 662406680,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-18T18:00:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634626623",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r634666757"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634666757"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hm... thanks for mentioning that the dependency on the chain is accidental. I didn't look deep into it before.\r\n\r\nI'm much more happy to drop that commit now, but should we explore other options as well?\r\n\r\nIt looks like we're just comparing one arg against other args. paytxfee and maxtxfee against `minRelayFee`, plus `minRelayFee` against some constant. There should be a better place for those checks rather than wallet creation code. I'm not familiar with the codebase enough to say where it belongs.\r\n\r\n@ryanofsky and @fjahr could you help me locate a better place for those checks?\r\n",
      "commit_id" : "37b55f38d31c05f1ae6e22537eea8707463168a6",
      "created_at" : "2021-05-18T18:54:56Z",
      "diff_hunk" : "@@ -3955,11 +3955,6 @@ std::shared_ptr<CWallet> CWallet::Create(interfaces::Chain& chain, const std::st\n                                _(\"This is the transaction fee you will pay if you send a transaction.\"));\n         }\n         walletInstance->m_pay_tx_fee = CFeeRate(nFeePerK, 1000);\n-        if (walletInstance->m_pay_tx_fee < chain.relayMinFee()) {\n-            error = strprintf(_(\"Invalid amount for -paytxfee=<amount>: '%s' (must be at least %s)\"),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r634666757",
      "id" : 634666757,
      "in_reply_to_id" : 555436448,
      "line" : 4053,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDY2Njc1Nw==",
      "original_commit_id" : "eabcd952d1c664cd964eb3376bc2865a49b33f16",
      "original_line" : 4053,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 93,
      "pull_request_review_id" : 662466456,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-18T18:56:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634666757",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r634776548"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634776548"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> @ryanofsky and @fjahr could you help me locate a better place for those checks?\r\n\r\nI think the checks are in a good place. Good to validate settings in the same place where they are parsed. There are just other ways this code could access `::minRelayTxFee` value other than by calling a chain method. It could passed as a create option or be part of a different struct or interface. Simply changing the check to `if (chain && walletInstance->m_pay_tx_fee < chain->relayMinFee())` seems good for now though.\r\n\r\n",
      "commit_id" : "37b55f38d31c05f1ae6e22537eea8707463168a6",
      "created_at" : "2021-05-18T21:59:43Z",
      "diff_hunk" : "@@ -3955,11 +3955,6 @@ std::shared_ptr<CWallet> CWallet::Create(interfaces::Chain& chain, const std::st\n                                _(\"This is the transaction fee you will pay if you send a transaction.\"));\n         }\n         walletInstance->m_pay_tx_fee = CFeeRate(nFeePerK, 1000);\n-        if (walletInstance->m_pay_tx_fee < chain.relayMinFee()) {\n-            error = strprintf(_(\"Invalid amount for -paytxfee=<amount>: '%s' (must be at least %s)\"),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r634776548",
      "id" : 634776548,
      "in_reply_to_id" : 555436448,
      "line" : 4053,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDc3NjU0OA==",
      "original_commit_id" : "eabcd952d1c664cd964eb3376bc2865a49b33f16",
      "original_line" : 4053,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 93,
      "pull_request_review_id" : 662611734,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-18T21:59:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634776548",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r634778183"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634778183"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> And in the future, these checks can be updated to not use the chain interface at all.\r\n\r\nFor the `chain` topic this seems a good solution going forward.\r\n\r\nOtherwise, I am not sure why you are interested in moving this code. These are checks that can make the wallet creation process fail or at least print a warning. So this seems to be a good place for it. Fee options are part of the wallet \"world\". Maybe the confusion is because these are config options and not args of `createwallet`? Or you don't see the direct connection between fee options and the wallet? These options are only relevant to the wallet and thus are only checked once the user wants to create a wallet because only then weird numbers there can be dangerous for the user. \r\n\r\nOn a smaller, organizational scale some of these checks could probably be helper functions and overall the fee part of wallet create can probably be encapsulated similar to `AttachChain`. If, however, you want to challenge that fee checks are done at all during wallet creation, that would require a lot more conceptual discussion. After that conceptual discussion, there could be a decision on where to put it. But the chances of a significant change in this regard are slim because this would be a huge behavior change I think, potentially breaking compatibility with any program that uses the wallet because these options will need to be set and checked in some kind of way.\r\n\r\nJust some first thoughts by someone also not very familiar with the codebase :) If you have ideas or want to challenge this in general as I teased above I would recommend you to bring that as a topic to one of the next wallet IRC meetings, this Friday for example.",
      "commit_id" : "37b55f38d31c05f1ae6e22537eea8707463168a6",
      "created_at" : "2021-05-18T22:03:11Z",
      "diff_hunk" : "@@ -3955,11 +3955,6 @@ std::shared_ptr<CWallet> CWallet::Create(interfaces::Chain& chain, const std::st\n                                _(\"This is the transaction fee you will pay if you send a transaction.\"));\n         }\n         walletInstance->m_pay_tx_fee = CFeeRate(nFeePerK, 1000);\n-        if (walletInstance->m_pay_tx_fee < chain.relayMinFee()) {\n-            error = strprintf(_(\"Invalid amount for -paytxfee=<amount>: '%s' (must be at least %s)\"),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r634778183",
      "id" : 634778183,
      "in_reply_to_id" : 555436448,
      "line" : 4053,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDc3ODE4Mw==",
      "original_commit_id" : "eabcd952d1c664cd964eb3376bc2865a49b33f16",
      "original_line" : 4053,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 93,
      "pull_request_review_id" : 662614506,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-18T22:04:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634778183",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r634958163"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634958163"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "489ebb7b34c403a3ce78ff6fb271f8e6ecb47304",
      "created_at" : "2021-05-19T06:50:34Z",
      "diff_hunk" : "@@ -3924,6 +3920,10 @@ std::shared_ptr<CWallet> CWallet::Create(interfaces::Chain& chain, const std::st\n         }\n     }\n \n+    // This wallet is in its first run if there are no ScriptPubKeyMans and it isn't blank or no privkeys\n+    bool fFirstRun = walletInstance->m_spk_managers.empty() &&",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r634958163",
      "id" : 634958163,
      "in_reply_to_id" : 633120365,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDk1ODE2Mw==",
      "original_commit_id" : "efd5396b894f5a73aac1940d41642345b2adf86f",
      "original_line" : 3924,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 662821797,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-19T06:50:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634958163",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r634960131"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634960131"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Maybe the confusion is because these are config options and not args of createwallet? \r\n\r\nyes, and \r\n> and thus are only checked once the user wants to create a wallet.\r\n\r\nShouldn't we check them earlier? They are from the wallet \"world\" but have nothing to do with the wallet *creation*. Especially `chain.relayMinFee().GetFeePerK() > HIGH_TX_FEE_PER_KB`. It seems just a coincidence that the option parsing is done during wallet creation process.\r\n\r\nNevermind, I've dropped the commit. Thanks for your time and patience.\r\n",
      "commit_id" : "489ebb7b34c403a3ce78ff6fb271f8e6ecb47304",
      "created_at" : "2021-05-19T06:54:09Z",
      "diff_hunk" : "@@ -3955,11 +3955,6 @@ std::shared_ptr<CWallet> CWallet::Create(interfaces::Chain& chain, const std::st\n                                _(\"This is the transaction fee you will pay if you send a transaction.\"));\n         }\n         walletInstance->m_pay_tx_fee = CFeeRate(nFeePerK, 1000);\n-        if (walletInstance->m_pay_tx_fee < chain.relayMinFee()) {\n-            error = strprintf(_(\"Invalid amount for -paytxfee=<amount>: '%s' (must be at least %s)\"),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r634960131",
      "id" : 634960131,
      "in_reply_to_id" : 555436448,
      "line" : 4053,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDk2MDEzMQ==",
      "original_commit_id" : "eabcd952d1c664cd964eb3376bc2865a49b33f16",
      "original_line" : 4053,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 94,
      "pull_request_review_id" : 662824270,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-19T06:54:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634960131",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I've dropped \"refactor: Move chain checks into CWallet::AttachChain\" (88f1982)",
      "created_at" : "2021-05-19T06:54:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#issuecomment-843800432",
      "id" : 843800432,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20773",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg0MzgwMDQzMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-19T06:54:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/843800432",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r635158578"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/635158578"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Shouldn't we check them earlier? They are from the wallet \"world\" but have nothing to do with the wallet _creation_. \r\n\r\nYes, these settings could be [`WalletContext`](https://github.com/bitcoin/bitcoin/blob/4da26fb85d6d6d205a2794ccb98beee1302b4a25/src/wallet/context.h#L23) members and shared across multiple `CWallet` instances instead of being `CWallet` members. (Or maybe if we want keep these as global settings but allow individual wallet overrides they could be members of both `CWallet` and `WalletContext`, with `CWallet` copying the `WalletContext` values on construction.) There's a general issue about wallet setting in #13044 for background & discussion about these things. And #19101 is another PR moving more variables to `WalletContext`.\r\n\r\nMy only reason for wanting to drop the commit is wanting to keep options parsing and option validation code together. I wouldn't want to move the checks without also moving the `IsArgSet`/`GetArg` code they are a part of. But all of this code could run before wallet creation if settings were stored outside `CWallet` in a place like `WalletContext`.\r\n\r\n> Especially `chain.relayMinFee().GetFeePerK() > HIGH_TX_FEE_PER_KB`. It seems just a coincidence that the option parsing is done during wallet creation process.\r\n\r\nI'm not sure. This is also a warning passed back to the `loadwallet` and `createwallet` RPCs. It seems like a reasonable thing to warn user about when they are loading a wallet, but maybe it could happen at another time. It's more of a UX question than a code organization question, I think.",
      "commit_id" : "489ebb7b34c403a3ce78ff6fb271f8e6ecb47304",
      "created_at" : "2021-05-19T11:42:42Z",
      "diff_hunk" : "@@ -3955,11 +3955,6 @@ std::shared_ptr<CWallet> CWallet::Create(interfaces::Chain& chain, const std::st\n                                _(\"This is the transaction fee you will pay if you send a transaction.\"));\n         }\n         walletInstance->m_pay_tx_fee = CFeeRate(nFeePerK, 1000);\n-        if (walletInstance->m_pay_tx_fee < chain.relayMinFee()) {\n-            error = strprintf(_(\"Invalid amount for -paytxfee=<amount>: '%s' (must be at least %s)\"),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r635158578",
      "id" : 635158578,
      "in_reply_to_id" : 555436448,
      "line" : 4053,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNTE1ODU3OA==",
      "original_commit_id" : "eabcd952d1c664cd964eb3376bc2865a49b33f16",
      "original_line" : 4053,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 94,
      "pull_request_review_id" : 663088862,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-19T11:42:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/635158578",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   }
]
