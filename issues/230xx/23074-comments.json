[
   {
      "author_association" : "MEMBER",
      "body" : "CI failure seems completely unrelated (`feature_asmap` failure on a `Addrman` log line figuring `3` instead of `2`). Here is the log trace, \"just in case\".\r\n<details>\r\n<p>\r\n<summary>Random `feature_asmap` failure logs</summary>\r\n\r\n```\r\n2021-09-23T14:53:38.217000Z TestFramework (INFO): Initializing test directory /tmp/cirrus-ci-build/ci/scratch/test_runner/test_runner_â¿_ð_20210923_145026/feature_asmap_26\r\n2021-09-23T14:53:39.000000Z TestFramework (INFO): Test bitcoind with no -asmap arg passed\r\n2021-09-23T14:53:39.442000Z TestFramework (INFO): Test bitcoind -asmap=<absolute path>\r\n2021-09-23T14:53:40.286000Z TestFramework (INFO): Test bitcoind -asmap=<relative path>\r\n2021-09-23T14:53:40.859000Z TestFramework (INFO): Test bitcoind -asmap (using default map file)\r\n2021-09-23T14:53:41.404000Z TestFramework (INFO): Test bitcoind -asmap= (using default map file)\r\n2021-09-23T14:53:42.007000Z TestFramework (INFO): Test bitcoind -asmap restart with addrman containing new and tried entries\r\n2021-09-23T14:55:03.894000Z TestFramework (ERROR): Assertion failed\r\nTraceback (most recent call last):\r\n  File \"/tmp/cirrus-ci-build/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/test/functional/test_framework/test_framework.py\", line 131, in main\r\n    self.run_test()\r\n  File \"/tmp/cirrus-ci-build/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/test/functional/feature_asmap.py\", line 124, in run_test\r\n    self.test_asmap_interaction_with_addrman_containing_entries()\r\n  File \"/tmp/cirrus-ci-build/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/test/functional/feature_asmap.py\", line 96, in test_asmap_interaction_with_addrman_containing_entries\r\n    self.node.getnodeaddresses()  # getnodeaddresses re-runs the addrman checks\r\n  File \"/usr/lib/python3.6/contextlib.py\", line 88, in __exit__\r\n    next(self.gen)\r\n  File \"/tmp/cirrus-ci-build/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/test/functional/test_framework/test_node.py\", line 400, in assert_debug_log\r\n    self._raise_assertion_error('Expected messages \"{}\" does not partially match log:\\n\\n{}\\n\\n'.format(str(expected_msgs), print_log))\r\n  File \"/tmp/cirrus-ci-build/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/test/functional/test_framework/test_node.py\", line 166, in _raise_assertion_error\r\n    raise AssertionError(self._node_msg(msg))\r\nAssertionError: [node 0] Expected messages \"['Addrman checks started: new 2, tried 2, total 4', 'Addrman checks completed successfully']\" does not partially match log:\r\n - 2021-09-23T14:53:43.886617Z [http] [httpserver.cpp:237] [http_request_cb] Received a POST request for / from 127.0.0.1:52652\r\n - 2021-09-23T14:53:43.886733Z [httpworker.3] [rpc/request.cpp:174] [parse] ThreadRPCServer method=getnodeaddresses user=__cookie__\r\n - 2021-09-23T14:53:43.886809Z [httpworker.3] [addrman.cpp:770] [ForceCheckAddrman] Addrman checks started: new 3, tried 1, total 4\r\n - 2021-09-23T14:53:43.886870Z [httpworker.3] [addrman.cpp:48] [GetTriedBucket] IP 101.0.0.0 mapped to AS1 belongs to tried bucket 113\r\n - 2021-09-23T14:53:43.886980Z [httpworker.3] [addrman.cpp:850] [ForceCheckAddrman] Addrman checks completed successfully\r\n - 2021-09-23T14:53:43.886991Z [httpworker.3] [addrman.cpp:770] [ForceCheckAddrman] Addrman checks started: new 3, tried 1, total 4\r\n - 2021-09-23T14:53:43.887016Z [httpworker.3] [addrman.cpp:48] [GetTriedBucket] IP 101.0.0.0 mapped to AS1 belongs to tried bucket 113\r\n - 2021-09-23T14:53:43.887102Z [httpworker.3] [addrman.cpp:850] [ForceCheckAddrman] Addrman checks completed successfully\r\n - 2021-09-23T14:54:28.662861Z [scheduler] [net.h:865] [StartExtraBlockRelayPeers] net: enabling extra block-relay-only peers\r\n - 2021-09-23T14:54:43.321822Z [scheduler] [random.cpp:523] [SeedPeriodic] Feeding 33048 bytes of dynamic environment data into RNG\r\n```\r\n</p>\r\n</details>",
      "created_at" : "2021-09-23T17:03:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23074#issuecomment-925995340",
      "id" : 925995340,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23074",
      "node_id" : "IC_kwDOABII5843MZFM",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-23T17:03:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/925995340",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#23075](https://github.com/bitcoin/bitcoin/pull/23075) (refactoring: Fee estimation functional test cleanups by darosior)\n* [#22919](https://github.com/bitcoin/bitcoin/pull/22919) (fees: skip pointless fee parameter calculation during IBD by RohitRanjangit)\n* [#22722](https://github.com/bitcoin/bitcoin/pull/22722) (rpc: update estimatesmartfee to return max of CBlockPolicyEstimator::estimateSmartFee, mempoolMinFee and minRelayTxFee by pranabp-bit)\n* [#22539](https://github.com/bitcoin/bitcoin/pull/22539) (Re-include RBF replacement txs in fee estimation by darosior)\n* [#22014](https://github.com/bitcoin/bitcoin/pull/22014) (refactor: Make m_cs_fee_estimator non-recursive by hebasto)\n* [#17786](https://github.com/bitcoin/bitcoin/pull/17786) (refactor: Nuke policy/fees->mempool circular dependencies by hebasto)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-09-23T22:15:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23074#issuecomment-926203885",
      "id" : 926203885,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23074",
      "node_id" : "IC_kwDOABII5843NL_t",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-27T15:28:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/926203885",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "concept ACK",
      "created_at" : "2021-09-24T03:11:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23074#issuecomment-926309437",
      "id" : 926309437,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23074",
      "node_id" : "IC_kwDOABII5843Nlw9",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-24T03:11:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/926309437",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Removed the commit asserting `blocksToConfirm > 0`, it would cause more issues with fuzzing targets than i want to deal with in this PR :)",
      "created_at" : "2021-09-24T09:58:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23074#issuecomment-926502098",
      "id" : 926502098,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23074",
      "node_id" : "IC_kwDOABII5843OUzS",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-24T09:58:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/926502098",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK, planning to review but as I have very little background on the fee estimator it may take me a bit of time :)",
      "created_at" : "2021-09-24T14:01:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23074#issuecomment-926650119",
      "id" : 926650119,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23074",
      "node_id" : "IC_kwDOABII5843O48H",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-24T14:01:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/926650119",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Unrelated CI error: Windows socket error (the use of UNIX-only `os.killpg` was just a symptom, not the cause)\r\n\r\n<details>\r\n\r\n```\r\n2021-09-24T10:29:15.111000Z TestFramework (ERROR): Unexpected exception caught during testing \r\n                                   Traceback (most recent call last):\r\n                                     File \"C:\\Users\\ContainerAdministrator\\AppData\\Local\\Temp\\cirrus-ci-build\\test\\functional\\test_framework\\test_framework.py\", line 131, in main\r\n                                       self.run_test()\r\n                                     File \"C:\\Users\\ContainerAdministrator\\AppData\\Local\\Temp\\cirrus-ci-build\\test\\functional\\feature_taproot.py\", line 1465, in run_test\r\n                                       self.test_spenders(self.nodes[1], spenders_taproot_active(), input_counts=[1, 2, 2, 2, 2, 3])\r\n                                     File \"C:\\Users\\ContainerAdministrator\\AppData\\Local\\Temp\\cirrus-ci-build\\test\\functional\\feature_taproot.py\", line 1451, in test_spenders\r\n                                       self.block_submit(node, [tx], msg, witness=True, accept=fail_input is None, cb_pubkey=cb_pubkey, fees=fee, sigops_weight=sigops_weight, err_msg=expected_fail_msg)\r\n                                     File \"C:\\Users\\ContainerAdministrator\\AppData\\Local\\Temp\\cirrus-ci-build\\test\\functional\\feature_taproot.py\", line 1244, in block_submit\r\n                                       block_response = node.submitblock(block.serialize().hex())\r\n                                     File \"C:\\Users\\ContainerAdministrator\\AppData\\Local\\Temp\\cirrus-ci-build\\test\\functional\\test_framework\\coverage.py\", line 49, in __call__\r\n                                       return_val = self.auth_service_proxy_instance.__call__(*args, **kwargs)\r\n                                     File \"C:\\Users\\ContainerAdministrator\\AppData\\Local\\Temp\\cirrus-ci-build\\test\\functional\\test_framework\\authproxy.py\", line 144, in __call__\r\n                                       response, status = self._request('POST', self.__url.path, postdata.encode('utf-8'))\r\n                                     File \"C:\\Users\\ContainerAdministrator\\AppData\\Local\\Temp\\cirrus-ci-build\\test\\functional\\test_framework\\authproxy.py\", line 107, in _request\r\n                                       self.__conn.request(method, path, postdata, headers)\r\n                                     File \"C:\\Python39\\lib\\http\\client.py\", line 1257, in request\r\n                                       self._send_request(method, url, body, headers, encode_chunked)\r\n                                     File \"C:\\Python39\\lib\\http\\client.py\", line 1303, in _send_request\r\n                                       self.endheaders(body, encode_chunked=encode_chunked)\r\n                                     File \"C:\\Python39\\lib\\http\\client.py\", line 1252, in endheaders\r\n                                       self._send_output(message_body, encode_chunked=encode_chunked)\r\n                                     File \"C:\\Python39\\lib\\http\\client.py\", line 1012, in _send_output\r\n                                       self.send(msg)\r\n                                     File \"C:\\Python39\\lib\\http\\client.py\", line 952, in send\r\n                                       self.connect()\r\n                                     File \"C:\\Python39\\lib\\http\\client.py\", line 923, in connect\r\n                                       self.sock = self._create_connection(\r\n                                     File \"C:\\Python39\\lib\\socket.py\", line 843, in create_connection\r\n                                       raise err\r\n                                     File \"C:\\Python39\\lib\\socket.py\", line 831, in create_connection\r\n                                       sock.connect(sa)\r\n                                   OSError: [WinError 10048] Only one usage of each socket address (protocol/network address/port) is normally permitted\r\n```\r\n",
      "created_at" : "2021-09-24T15:54:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23074#issuecomment-926737249",
      "id" : 926737249,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23074",
      "node_id" : "IC_kwDOABII5843PONh",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-24T15:54:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/926737249",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. Seems like a well-justified improvement.\r\n\r\n----------------\r\n\r\nDo you think this PR could degrade the prediction performance in certain cases? For example, if someone RBFs their package with 1 tx. I actually think we get an improvement here in that case, but yeah, that's just an example.",
      "created_at" : "2021-09-27T07:00:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23074#issuecomment-927586023",
      "id" : 927586023,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23074",
      "node_id" : "IC_kwDOABII5843Sdbn",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-27T07:00:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/927586023",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I don't think this can degrade estimation in any case, it should be a strict improvement (/fix?).\r\n\r\n> For example, if someone RBFs their package with 1 tx.\r\n\r\nFor now the replacement transaction would not be considered. Assuming we have both https://github.com/bitcoin/bitcoin/pull/22539 and this PR this would give a much more correct estimation: taking the entire package feerate instead of ignoring it (#22539), or wrongly assuming the feerate of the parent transaction alone was enough to get it confirmed (this PR).",
      "created_at" : "2021-09-27T07:06:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23074#issuecomment-927590580",
      "id" : 927590580,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23074",
      "node_id" : "IC_kwDOABII5843Sei0",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-27T07:07:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/927590580",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23074#discussion_r716763703"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23074"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/716763703"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think this approach may _overestimate_ the number of blocks it takes to a tx at a certain feerate to confirm: if a transaction is first accepted at time `t` with a feerate of 1sat/vB, sits in the mempool for a long time, and then is fee-bumped to 10sat/vB and included in a block at time `t+500`, this will record that the transaction had a feerate of 10sat/vB but took 500 blocks to confirm. That would be inaccurate, since it was 1sat/vB for most of that time.",
      "commit_id" : "18399e5fdc95d1d604f35e135ac88c25e443452c",
      "created_at" : "2021-09-27T14:44:46Z",
      "diff_hunk" : "@@ -574,35 +577,51 @@ void CBlockPolicyEstimator::processTransaction(const CTxMemPoolEntry& entry, boo\n     assert(bucketIndex == bucketIndex3);\n }\n \n-bool CBlockPolicyEstimator::processBlockTx(unsigned int nBlockHeight, const CTxMemPoolEntry* entry)\n+void CBlockPolicyEstimator::processBlockTx(unsigned int nBlockHeight, const CTxMemPoolEntry& entry, CFeeRate fee_rate)\n {\n-    if (!removeTx(entry->GetTx().GetHash(), true)) {\n-        // This transaction wasn't being tracked for fee estimation\n-        return false;\n-    }\n-\n     // How many blocks did it take for miners to include this transaction?\n     // blocksToConfirm is 1-based, so a transaction included in the earliest\n     // possible block has confirmation count of 1\n-    int blocksToConfirm = nBlockHeight - entry->GetHeight();\n+    int blocksToConfirm = nBlockHeight - entry.GetHeight();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23074#discussion_r716763703",
      "id" : 716763703,
      "line" : 585,
      "node_id" : "PRRC_kwDOABII584quPI3",
      "original_commit_id" : "18399e5fdc95d1d604f35e135ac88c25e443452c",
      "original_line" : 585,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : 35,
      "pull_request_review_id" : 764375424,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23074",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-27T15:34:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/716763703",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23074#discussion_r716805860"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23074"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/716805860"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "You can remove the txmempool forward declarations below if including the header.",
      "commit_id" : "18399e5fdc95d1d604f35e135ac88c25e443452c",
      "created_at" : "2021-09-27T15:29:29Z",
      "diff_hunk" : "@@ -10,6 +10,7 @@\n #include <uint256.h>\n #include <random.h>\n #include <sync.h>\n+#include <txmempool.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23074#discussion_r716805860",
      "id" : 716805860,
      "line" : 13,
      "node_id" : "PRRC_kwDOABII584quZbk",
      "original_commit_id" : "18399e5fdc95d1d604f35e135ac88c25e443452c",
      "original_line" : 13,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/policy/fees.h",
      "position" : 4,
      "pull_request_review_id" : 764375424,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23074",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-27T15:34:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/716805860",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> However, I'm not sure about the approach. Looking at a block transaction and its descendants can tell us the feerate at which it was mined, but not the feerate it was offered at. We wouldn't know when it was fee-bumped and how long it took to mine after the high-fee descendant(s) were broadcast (which imo is what we're actually interested in).\r\n\r\nRight, this would be the accurate approach. I chose to go with the current hack because i found the \"right approach\" would make it really hard to think about edge cases. Now -and given the overestimation would not be fixed without further hacks-  i can't give any good argument for not tracking by ancestor. Will give this approach a go, hopefully in the coming weeks!",
      "created_at" : "2021-09-28T08:20:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23074#issuecomment-928966768",
      "id" : 928966768,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23074",
      "node_id" : "IC_kwDOABII5843Xuhw",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-28T08:20:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/928966768",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-09-28T22:12:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23074#issuecomment-929663339",
      "id" : 929663339,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23074",
      "node_id" : "IC_kwDOABII5843aYlr",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-28T22:12:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/929663339",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--13523179cfe9479db18ec6c5d236f789-->There hasn't been much activity lately and the patch still needs rebase. What is the status here?\n\n* Is it still relevant? â¡ï¸ Please solve the conflicts to make it ready for review and to ensure the CI passes.\n* Is it no longer relevant? â¡ï¸ Please close.\n* Did the author lose interest or time to work on this? â¡ï¸ Please close it and mark it 'Up for grabs' with the label, so that it can be picked up in the future.\n",
      "created_at" : "2022-02-22T10:49:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23074#issuecomment-1047667041",
      "id" : 1047667041,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23074",
      "node_id" : "IC_kwDOABII584-ciFh",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1047667041/reactions"
      },
      "updated_at" : "2022-02-22T10:49:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1047667041",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Hello Drahbot. I have not forgotten about this PR and i plan to rebase it asap.\n\n------- Original Message -------\nLe mardi 22 fÃ©vrier 2022 Ã  11:49 AM, DrahtBot ***@***.***> a Ã©crit :\n\n> There hasn't been much activity lately and the patch still needs rebase. What is the status here?\n>\n> - Is it still relevant? â¡ï¸ Please solve the conflicts to make it ready for review and to ensure the CI passes.\n> - Is it no longer relevant? â¡ï¸ Please close.\n> - Did the author lose interest or time to work on this? â¡ï¸ Please close it and mark it 'Up for grabs' with the label, so that it can be picked up in the future.\n>\n> â\n> Reply to this email directly, [view it on GitHub](https://github.com/bitcoin/bitcoin/pull/23074#issuecomment-1047667041), or [unsubscribe](https://github.com/notifications/unsubscribe-auth/AFLK3F2C3KDHGU2TSJ6A573U4NS3HANCNFSM5ET2B5MQ).\n> Triage notifications on the go with GitHub Mobile for [iOS](https://apps.apple.com/app/apple-store/id1477376905?ct=notification-email&mt=8&pt=524675) or [Android](https://play.google.com/store/apps/details?id=com.github.android&referrer=utm_campaign%3Dnotification-email%26utm_medium%3Demail%26utm_source%3Dgithub).\n> You are receiving this because you authored the thread.Message ID: ***@***.***>",
      "created_at" : "2022-02-22T11:13:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23074#issuecomment-1047687718",
      "id" : 1047687718,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23074",
      "node_id" : "IC_kwDOABII584-cnIm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1047687718/reactions"
      },
      "updated_at" : "2022-02-22T11:13:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1047687718",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Finally got back to give this some thought, and i'm going to close it for now. It sticked around for too long and unfortunately i don't expect to be able to invest the necessary time anytime soon. (It's more complicated than just tracking per ancestor feerate.)\r\n\r\nI'm still happy to discuss different approaches if people are still interested. I still believe it's very much needed.",
      "created_at" : "2022-06-10T13:56:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23074#issuecomment-1152390533",
      "id" : 1152390533,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23074",
      "node_id" : "IC_kwDOABII585EsBWF",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1152390533/reactions"
      },
      "updated_at" : "2022-06-10T13:56:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1152390533",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "One thing we could do at least is to ignore transactions with child. This would reduce our number of data points but better have less rather than wrong ones.",
      "created_at" : "2022-06-10T14:05:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23074#issuecomment-1152399594",
      "id" : 1152399594,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23074",
      "node_id" : "IC_kwDOABII585EsDjq",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1152399594/reactions"
      },
      "updated_at" : "2022-06-10T14:05:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1152399594",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   }
]
