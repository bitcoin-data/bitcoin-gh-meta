[
   {
      "body" : "Have you benchmarked these optimisations?",
      "created_at" : "2015-07-16T22:44:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6445#issuecomment-122124125",
      "id" : 122124125,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6445",
      "updated_at" : "2015-07-16T22:44:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/122124125",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6762681?v=3",
         "events_url" : "https://api.github.com/users/NanoAkron/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NanoAkron/followers",
         "following_url" : "https://api.github.com/users/NanoAkron/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NanoAkron/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NanoAkron",
         "id" : 6762681,
         "login" : "NanoAkron",
         "organizations_url" : "https://api.github.com/users/NanoAkron/orgs",
         "received_events_url" : "https://api.github.com/users/NanoAkron/received_events",
         "repos_url" : "https://api.github.com/users/NanoAkron/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NanoAkron/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NanoAkron/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NanoAkron"
      }
   },
   {
      "body" : "@NanoAkron Actually, no, I haven't. I don't really think the improvement will be that great, but hopefully it will be obvious to reviewers that performance can only be better, not worse (and the code is also cleaner IMO).\r\nOne thing is not easy to benchmark is changing the order of checks, for example, moving the check that impedes transactions from creating new money before checking the \"standard-ness\" of input scripts. Is that better? Well, that depends on how many of the transactions checked my acceptToMempool don't have standard scripts and how many are attempting to create new money, etc. So it basically depends on the test set and benchmarking that is not really that interesting. I can move those checks less if I'm asked to though.\r\n\r\nBut benchmarking the other changes (less repeated operations if the transaction is affected) would be great. @sipa do you have some advice (or maybe a code snippet to copy) on how to benchmark this?\r\n",
      "created_at" : "2015-07-17T08:10:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6445#issuecomment-122211927",
      "id" : 122211927,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6445",
      "updated_at" : "2015-07-17T08:10:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/122211927",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6445#discussion_r35453119"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6445"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/35453119"
         }
      },
      "body" : "Not your fault, but I wasn't aware of this call from mempool to main; I think we should get rid of it.",
      "commit_id" : "2b23dd340a9e2d241a0f82bf5f033997c30d0b0a",
      "created_at" : "2015-07-24T18:39:51Z",
      "diff_hunk" : "@@ -275,7 +275,8 @@ void CTxMemPool::check(const CCoinsViewCache *pcoins) const\n             waitingOnDependants.push_back(&it->second);\n         else {\n             CValidationState state;\n-            assert(CheckInputs(tx, state, mempoolDuplicate, false, 0, false, NULL));\n+            CAmount nTxFees;\n+            assert(Consensus::CheckTxInputs(tx, state, mempoolDuplicate, GetSpendHeight(mempoolDuplicate), nTxFees));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6445#discussion_r35453119",
      "id" : 35453119,
      "original_commit_id" : "2b23dd340a9e2d241a0f82bf5f033997c30d0b0a",
      "original_position" : 6,
      "path" : "src/txmempool.cpp",
      "position" : 6,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6445",
      "updated_at" : "2015-07-24T18:39:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/35453119",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6445#discussion_r35466016"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6445"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/35466016"
         }
      },
      "body" : "Sure, these 2 checks can be removed instead of adapted if that's preferrable.",
      "commit_id" : "2b23dd340a9e2d241a0f82bf5f033997c30d0b0a",
      "created_at" : "2015-07-24T21:08:16Z",
      "diff_hunk" : "@@ -275,7 +275,8 @@ void CTxMemPool::check(const CCoinsViewCache *pcoins) const\n             waitingOnDependants.push_back(&it->second);\n         else {\n             CValidationState state;\n-            assert(CheckInputs(tx, state, mempoolDuplicate, false, 0, false, NULL));\n+            CAmount nTxFees;\n+            assert(Consensus::CheckTxInputs(tx, state, mempoolDuplicate, GetSpendHeight(mempoolDuplicate), nTxFees));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6445#discussion_r35466016",
      "id" : 35466016,
      "original_commit_id" : "2b23dd340a9e2d241a0f82bf5f033997c30d0b0a",
      "original_position" : 6,
      "path" : "src/txmempool.cpp",
      "position" : 6,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6445",
      "updated_at" : "2015-07-24T21:08:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/35466016",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Needed rebase after #6077 . I also removed the checks in txmempool.cpp as suggested by @sipa ",
      "created_at" : "2015-07-28T16:31:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6445#issuecomment-125672296",
      "id" : 125672296,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6445",
      "updated_at" : "2015-07-28T16:31:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/125672296",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Note that this is now kind of a de-optimization, since the cache has not being properly adapted (and thus the Consensus::CheckTxInputs calls are not using the cache anymore).\r\nI'm not sure anymore which version is faster. This may not be faster than master after #6077 so benchmarks would be appreciated.\r\nOr maybe I can just close this and \"start\" again. Something like  https://github.com/jtimon/bitcoin/commit/ddd505a4f62603d6b2ed07e0fecb213b81c8f795 can't be a \"next step\" to this anymore, and https://github.com/jtimon/bitcoin/commit/a6d1e6e60d1757fc850f5798266bb2a4c7145193 (very outdated) now looks more far away in the future than ever...\r\n\r\nYeah, probably closing unless someone really wants it open. Mhmm, this was the last consensus PR I had open...",
      "created_at" : "2015-07-28T16:45:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6445#issuecomment-125675795",
      "id" : 125675795,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6445",
      "updated_at" : "2015-07-28T16:47:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/125675795",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Maybe I should Maybe I should open one just removing the checks in txmempool.cpp ?",
      "created_at" : "2015-07-28T17:18:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6445#issuecomment-125683104",
      "id" : 125683104,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6445",
      "updated_at" : "2015-07-28T17:18:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/125683104",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Rebased and reopened after #6077 has been reverted. ",
      "created_at" : "2015-07-29T11:52:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6445#issuecomment-125929327",
      "id" : 125929327,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6445",
      "updated_at" : "2015-07-29T11:52:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/125929327",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Needed rebase after #6519 (which by the way it's a step forwards for completing libconsensus, thanks @laanwj ).",
      "created_at" : "2015-08-20T23:08:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6445#issuecomment-133207921",
      "id" : 133207921,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6445",
      "updated_at" : "2015-08-20T23:08:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/133207921",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Closing until one of #6526/#6625 gets merged and probably also until #6557 / https://github.com/TheBlueMatt/bitcoin/commit/88a3b8d52432f437a3d194748e446461f721cf9b gets merged as well.",
      "created_at" : "2015-09-06T22:53:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6445#issuecomment-138134342",
      "id" : 138134342,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6445",
      "updated_at" : "2015-09-06T22:53:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/138134342",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   }
]
