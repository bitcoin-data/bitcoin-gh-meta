[
   {
      "author_association" : "MEMBER",
      "body" : "I think this should resolve #15484, but it's not clear to me if this is entirely sufficient to protect against the class of error, or if we should add additional logic to ResolveCollisions() to ensure that collisions get eventually resolved.",
      "created_at" : "2019-02-26T20:31:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15486#issuecomment-467601659",
      "id" : 467601659,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15486",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2NzYwMTY1OQ==",
      "updated_at" : "2019-02-26T20:31:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/467601659",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.",
      "created_at" : "2019-02-26T21:37:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15486#issuecomment-467624016",
      "id" : 467624016,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15486",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2NzYyNDAxNg==",
      "updated_at" : "2019-02-26T23:59:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/467624016",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Updated with a commit that tries to fix the underlying problem in addrman, by doing eviction anyway after 20 minutes (to prevent m_tried_collisions from never being drained).  \r\n\r\nIf it looks good, I'll update the OP of this PR before merge.",
      "created_at" : "2019-02-26T21:39:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15486#issuecomment-467624670",
      "id" : 467624670,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15486",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2NzYyNDY3MA==",
      "updated_at" : "2019-02-26T21:39:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/467624670",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This bugfix should probably get tagged for 0.18.",
      "created_at" : "2019-02-26T22:43:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15486#issuecomment-467645594",
      "id" : 467645594,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15486",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2NzY0NTU5NA==",
      "updated_at" : "2019-02-26T22:43:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/467645594",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r260900957"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/260900957"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Unless I'm missing something this should be set to a value higher than 20 minutes.\r\n\r\n1. A feeler connection is made according to a Poisson distribution with an average of 2 minutes. 50% of the time the interval will take more than 2 minutes. Additionally this interval does not include the connection time. Consider that if each address in the buffer times out.\r\n2. The collision set buffer can hold at least 10 entries.\r\n\r\nThus at 20 minutes it is very possible that a value might be added to the collision set buffer and not be tried for more than 20 minutes and then evicted. I would set this to at least 40 minutes. This won't eliminate the chance an untried entry is evicted, but it will reduce it.\r\n\r\nSadly I don't have time to do the math, but if someone else has a few minutes, could someone compute the probability that a address would sit in the collision set for 40 minutes and not be tried. Assume that each prior attempt times out.",
      "commit_id" : "20e6ea259b222b10f066f22695a5f56c52071f63",
      "created_at" : "2019-02-27T19:13:21Z",
      "diff_hunk" : "@@ -166,6 +166,9 @@ class CAddrInfo : public CAddress\n //! the maximum number of tried addr collisions to store\n #define ADDRMAN_SET_TRIED_COLLISION_SIZE 10\n \n+//! the maximum time we'll spend trying to resolve a tried table collision, in seconds\n+static const int64_t ADDRMAN_TEST_WINDOW = 20*60; // 20 minutes",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r260900957",
      "id" : 260900957,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MDkwMDk1Nw==",
      "original_commit_id" : "1b0621b544d2c49eec39d7b63d5c9eb822cbaf5f",
      "original_position" : 5,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 208712159,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486",
      "updated_at" : "2019-03-01T21:16:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/260900957",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "node_id" : "MDQ6VXNlcjI3NDgxNA==",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r260902403"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/260902403"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I haven't looked into this in detail, but wanted to point out that the chance that the time between 2 Poisson-distributed events has only a 1/e = 36.8% chance of being larger than the average interval.",
      "commit_id" : "20e6ea259b222b10f066f22695a5f56c52071f63",
      "created_at" : "2019-02-27T19:17:02Z",
      "diff_hunk" : "@@ -166,6 +166,9 @@ class CAddrInfo : public CAddress\n //! the maximum number of tried addr collisions to store\n #define ADDRMAN_SET_TRIED_COLLISION_SIZE 10\n \n+//! the maximum time we'll spend trying to resolve a tried table collision, in seconds\n+static const int64_t ADDRMAN_TEST_WINDOW = 20*60; // 20 minutes",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r260902403",
      "id" : 260902403,
      "in_reply_to_id" : 260900957,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MDkwMjQwMw==",
      "original_commit_id" : "1b0621b544d2c49eec39d7b63d5c9eb822cbaf5f",
      "original_position" : 5,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 208713954,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486",
      "updated_at" : "2019-03-01T21:16:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/260902403",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r260906838"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/260906838"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oops, used the wrong arguments on Wolfram Alpha in the previous comment.\r\n\r\nIs the question what the probability is that the sum of 10 exponentially-distributed variables (independent and each with an average of 2 minutes) exceeds 20 minutes?\r\n\r\nhttps://www.wolframalpha.com/input/?i=P(X%3E20)+where+X~GammaDistribution(10,2) says 45.8%.\r\n\r\nExceeding 40 minutes has a chance of 0.5%.",
      "commit_id" : "20e6ea259b222b10f066f22695a5f56c52071f63",
      "created_at" : "2019-02-27T19:26:32Z",
      "diff_hunk" : "@@ -166,6 +166,9 @@ class CAddrInfo : public CAddress\n //! the maximum number of tried addr collisions to store\n #define ADDRMAN_SET_TRIED_COLLISION_SIZE 10\n \n+//! the maximum time we'll spend trying to resolve a tried table collision, in seconds\n+static const int64_t ADDRMAN_TEST_WINDOW = 20*60; // 20 minutes",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r260906838",
      "id" : 260906838,
      "in_reply_to_id" : 260900957,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MDkwNjgzOA==",
      "original_commit_id" : "1b0621b544d2c49eec39d7b63d5c9eb822cbaf5f",
      "original_position" : 5,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 208719316,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486",
      "updated_at" : "2019-03-01T21:16:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/260906838",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r260914594"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/260914594"
         }
      },
      "author_association" : "MEMBER",
      "body" : "How likely is it that we add things to `m_tried_collisions` more often than once every 2 minutes or so?",
      "commit_id" : "20e6ea259b222b10f066f22695a5f56c52071f63",
      "created_at" : "2019-02-27T19:46:26Z",
      "diff_hunk" : "@@ -166,6 +166,9 @@ class CAddrInfo : public CAddress\n //! the maximum number of tried addr collisions to store\n #define ADDRMAN_SET_TRIED_COLLISION_SIZE 10\n \n+//! the maximum time we'll spend trying to resolve a tried table collision, in seconds\n+static const int64_t ADDRMAN_TEST_WINDOW = 20*60; // 20 minutes",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r260914594",
      "id" : 260914594,
      "in_reply_to_id" : 260900957,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MDkxNDU5NA==",
      "original_commit_id" : "1b0621b544d2c49eec39d7b63d5c9eb822cbaf5f",
      "original_position" : 5,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 208729213,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486",
      "updated_at" : "2019-03-01T21:16:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/260914594",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r260933977"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/260933977"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : ">How likely is it that we add things to `m_tried_collisions` more often than once every 2 minutes or so?\r\n\r\nNot sure how to compute that probability but I can contrive a scenario where it happens:\r\n\r\n1. Assume a victim nodes tried table is full of good nodes, and the victim nodes new table is full of attacker nodes. \r\n\r\n2. Victim makes 8 outgoing connections and gets unlucky and chooses all 8 from new. This means the victim tries to move these 8 IPs in new to tried causing 8 collisions (remember we assumed tried is full). All 8 of these connections are being made to attacker nodes (since all new addresses are attack controlled).\r\n\r\n3. Attacker then breaks each of these 8 connections so the victim must reconnect. The victim chooses at least 2 nodes from new and causes two new collisions when it tries to add them to tried. Now there are 10 addresses in `m_tried_collisions`.",
      "commit_id" : "20e6ea259b222b10f066f22695a5f56c52071f63",
      "created_at" : "2019-02-27T20:39:38Z",
      "diff_hunk" : "@@ -166,6 +166,9 @@ class CAddrInfo : public CAddress\n //! the maximum number of tried addr collisions to store\n #define ADDRMAN_SET_TRIED_COLLISION_SIZE 10\n \n+//! the maximum time we'll spend trying to resolve a tried table collision, in seconds\n+static const int64_t ADDRMAN_TEST_WINDOW = 20*60; // 20 minutes",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r260933977",
      "id" : 260933977,
      "in_reply_to_id" : 260900957,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MDkzMzk3Nw==",
      "original_commit_id" : "1b0621b544d2c49eec39d7b63d5c9eb822cbaf5f",
      "original_position" : 5,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 208753546,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486",
      "updated_at" : "2019-03-01T21:16:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/260933977",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "node_id" : "MDQ6VXNlcjI3NDgxNA==",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r260962177"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/260962177"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've updated to 40 minutes, thanks.",
      "commit_id" : "20e6ea259b222b10f066f22695a5f56c52071f63",
      "created_at" : "2019-02-27T21:56:11Z",
      "diff_hunk" : "@@ -166,6 +166,9 @@ class CAddrInfo : public CAddress\n //! the maximum number of tried addr collisions to store\n #define ADDRMAN_SET_TRIED_COLLISION_SIZE 10\n \n+//! the maximum time we'll spend trying to resolve a tried table collision, in seconds\n+static const int64_t ADDRMAN_TEST_WINDOW = 20*60; // 20 minutes",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r260962177",
      "id" : 260962177,
      "in_reply_to_id" : 260900957,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MDk2MjE3Nw==",
      "original_commit_id" : "1b0621b544d2c49eec39d7b63d5c9eb822cbaf5f",
      "original_position" : 5,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 208787811,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486",
      "updated_at" : "2019-03-01T21:16:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/260962177",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK f71fdda3bc2e7acd2a8b74e882364866b8b0f55b",
      "created_at" : "2019-02-28T00:53:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15486#issuecomment-468091836",
      "id" : 468091836,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15486",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2ODA5MTgzNg==",
      "updated_at" : "2019-02-28T00:53:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/468091836",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r261029373"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/261029373"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm not sure, but shouldn't the variables be swapped?",
      "commit_id" : "20e6ea259b222b10f066f22695a5f56c52071f63",
      "created_at" : "2019-02-28T02:48:04Z",
      "diff_hunk" : "@@ -567,6 +569,13 @@ void CAddrMan::ResolveCollisions_()\n                         Good_(info_new, false, GetAdjustedTime());\n                         erase_collision = true;\n                     }\n+                } else if (GetAdjustedTime() - info_new.nLastSuccess > ADDRMAN_TEST_WINDOW) {\n+                    // If the collision hasn't resolved in some reasonable amount of time,\n+                    // just evict the old entry -- we must not be able to\n+                    // connect to it for some reason.\n+                    LogPrint(BCLog::ADDRMAN, \"Unable to test; swapping %s for %s in tried table anyway\\n\", info_new.ToString(), info_old.ToString());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r261029373",
      "id" : 261029373,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MTAyOTM3Mw==",
      "original_commit_id" : "f71fdda3bc2e7acd2a8b74e882364866b8b0f55b",
      "original_position" : 19,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 208869190,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486",
      "updated_at" : "2019-03-01T21:16:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/261029373",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r261245001"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/261245001"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The log message is correct, but agree the log message doesn't match what the code is doing. I think there is a bug in the code.\r\n\r\nThe collision logic puts the entry in tried into `m_tried_collisions` and then feeler connections tests values in `m_tried_collisions`. Why is it using the `info_new.nLastSuccess` shouldn't it be checking the last success of `info_old` in `m_tried_collisions`?\r\n\r\nThat is, shouldn't \r\n`} else if (GetAdjustedTime() - info_new.nLastSuccess > ADDRMAN_TEST_WINDOW) {`\r\nbe\r\n`} else if (GetAdjustedTime() - info_old.nLastSuccess > ADDRMAN_TEST_WINDOW) {`\r\ninstead or I am I missing something?",
      "commit_id" : "20e6ea259b222b10f066f22695a5f56c52071f63",
      "created_at" : "2019-02-28T15:23:42Z",
      "diff_hunk" : "@@ -567,6 +569,13 @@ void CAddrMan::ResolveCollisions_()\n                         Good_(info_new, false, GetAdjustedTime());\n                         erase_collision = true;\n                     }\n+                } else if (GetAdjustedTime() - info_new.nLastSuccess > ADDRMAN_TEST_WINDOW) {\n+                    // If the collision hasn't resolved in some reasonable amount of time,\n+                    // just evict the old entry -- we must not be able to\n+                    // connect to it for some reason.\n+                    LogPrint(BCLog::ADDRMAN, \"Unable to test; swapping %s for %s in tried table anyway\\n\", info_new.ToString(), info_old.ToString());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r261245001",
      "id" : 261245001,
      "in_reply_to_id" : 261029373,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MTI0NTAwMQ==",
      "original_commit_id" : "f71fdda3bc2e7acd2a8b74e882364866b8b0f55b",
      "original_position" : 19,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 209133984,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486",
      "updated_at" : "2019-03-01T21:16:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/261245001",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "node_id" : "MDQ6VXNlcjI3NDgxNA==",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r261246357"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/261246357"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nevermind, I am wrong ignore my last message. The log message and the code is correct.\r\n\r\n`} else if (GetAdjustedTime() - info_new.nLastSuccess > ADDRMAN_TEST_WINDOW) {`\r\nis testing how long it has been since the collision was first found.",
      "commit_id" : "20e6ea259b222b10f066f22695a5f56c52071f63",
      "created_at" : "2019-02-28T15:26:32Z",
      "diff_hunk" : "@@ -567,6 +569,13 @@ void CAddrMan::ResolveCollisions_()\n                         Good_(info_new, false, GetAdjustedTime());\n                         erase_collision = true;\n                     }\n+                } else if (GetAdjustedTime() - info_new.nLastSuccess > ADDRMAN_TEST_WINDOW) {\n+                    // If the collision hasn't resolved in some reasonable amount of time,\n+                    // just evict the old entry -- we must not be able to\n+                    // connect to it for some reason.\n+                    LogPrint(BCLog::ADDRMAN, \"Unable to test; swapping %s for %s in tried table anyway\\n\", info_new.ToString(), info_old.ToString());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r261246357",
      "id" : 261246357,
      "in_reply_to_id" : 261029373,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MTI0NjM1Nw==",
      "original_commit_id" : "f71fdda3bc2e7acd2a8b74e882364866b8b0f55b",
      "original_position" : 19,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 209133984,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486",
      "updated_at" : "2019-03-01T21:16:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/261246357",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "node_id" : "MDQ6VXNlcjI3NDgxNA==",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Useful background info for context:\r\n* Eclipse Attacks on BitcoinÃ¢ÂÂs Peer-to-Peer Network\" https://eprint.iacr.org/2015/263.pdf (by @ethanheilman e.a.\r\n* #8282\r\n* #9037",
      "created_at" : "2019-03-01T16:18:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15486#issuecomment-468720505",
      "id" : 468720505,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15486",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2ODcyMDUwNQ==",
      "updated_at" : "2019-03-01T16:19:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/468720505",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r261707616"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/261707616"
         }
      },
      "author_association" : "MEMBER",
      "body" : "when `m_tried_collisions` is full we don't add the entry, so this log statement should be inside the if statement below.\r\n\r\nBackground question: why is ok that we don't add this collision to `m_tried_collisions`, yet also don't call `MakeTried`? I assume it' because when called with `test_before_evict`, we don't evict when in doubt.",
      "commit_id" : "20e6ea259b222b10f066f22695a5f56c52071f63",
      "created_at" : "2019-03-01T18:21:03Z",
      "diff_hunk" : "@@ -239,7 +239,9 @@ void CAddrMan::Good_(const CService& addr, bool test_before_evict, int64_t nTime\n \n     // Will moving this address into tried evict another entry?\n     if (test_before_evict && (vvTried[tried_bucket][tried_bucket_pos] != -1)) {\n-        LogPrint(BCLog::ADDRMAN, \"Collision inserting element into tried table, moving %s to m_tried_collisions=%d\\n\", addr.ToString(), m_tried_collisions.size());\n+        // Output the entry we'd be colliding with, for debugging purposes\n+        auto colliding_entry = mapInfo.find(vvTried[tried_bucket][tried_bucket_pos]);\n+        LogPrint(BCLog::ADDRMAN, \"Collision inserting element into tried table (%s), moving %s to m_tried_collisions=%d\\n\", colliding_entry != mapInfo.end() ? colliding_entry->second.ToString() : \"\", addr.ToString(), m_tried_collisions.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r261707616",
      "id" : 261707616,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MTcwNzYxNg==",
      "original_commit_id" : "f71fdda3bc2e7acd2a8b74e882364866b8b0f55b",
      "original_position" : 7,
      "path" : "src/addrman.cpp",
      "position" : 7,
      "pull_request_review_id" : 209719301,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486",
      "updated_at" : "2019-03-01T21:16:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/261707616",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r261711418"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/261711418"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The word \"swap\" confused me, also in the log message a few lines above (`if (GetAdjustedTime() - info_old.nLastTry > 60)`). The phrase \"replace [old] with [new]\" is more clear.\r\n\r\nAlso, this new behaviour contradicts the \"when in doubt, don't evict\" rule I mentioned above. Though maybe I'm wrong there?  It seems more consistent to just drop the entry.",
      "commit_id" : "20e6ea259b222b10f066f22695a5f56c52071f63",
      "created_at" : "2019-03-01T18:33:22Z",
      "diff_hunk" : "@@ -567,6 +569,13 @@ void CAddrMan::ResolveCollisions_()\n                         Good_(info_new, false, GetAdjustedTime());\n                         erase_collision = true;\n                     }\n+                } else if (GetAdjustedTime() - info_new.nLastSuccess > ADDRMAN_TEST_WINDOW) {\n+                    // If the collision hasn't resolved in some reasonable amount of time,\n+                    // just evict the old entry -- we must not be able to\n+                    // connect to it for some reason.\n+                    LogPrint(BCLog::ADDRMAN, \"Unable to test; swapping %s for %s in tried table anyway\\n\", info_new.ToString(), info_old.ToString());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r261711418",
      "id" : 261711418,
      "in_reply_to_id" : 261029373,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MTcxMTQxOA==",
      "original_commit_id" : "f71fdda3bc2e7acd2a8b74e882364866b8b0f55b",
      "original_position" : 19,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 209719301,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486",
      "updated_at" : "2019-03-01T21:16:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/261711418",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r261713340"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/261713340"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```cpp\r\n// Require outbound connections, other than feelers, to be to distinct network groups\r\n```",
      "commit_id" : "20e6ea259b222b10f066f22695a5f56c52071f63",
      "created_at" : "2019-03-01T18:39:39Z",
      "diff_hunk" : "@@ -1765,9 +1765,15 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n                 addr = addrman.Select(fFeeler);\n             }\n \n+            // Require outbound connections to be to distinct network groups",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r261713340",
      "id" : 261713340,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MTcxMzM0MA==",
      "original_commit_id" : "f71fdda3bc2e7acd2a8b74e882364866b8b0f55b",
      "original_position" : 4,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 209719301,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486",
      "updated_at" : "2019-03-01T21:16:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/261713340",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r261713892"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/261713892"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```cpp\r\n// if we selected an invalid or a local address, restart\r\n```",
      "commit_id" : "20e6ea259b222b10f066f22695a5f56c52071f63",
      "created_at" : "2019-03-01T18:41:25Z",
      "diff_hunk" : "@@ -1765,9 +1765,15 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n                 addr = addrman.Select(fFeeler);\n             }\n \n+            // Require outbound connections to be to distinct network groups\n+            if (!fFeeler && setConnected.count(addr.GetGroup())) {\n+                break;\n+            }\n+\n             // if we selected an invalid address, restart\n-            if (!addr.IsValid() || setConnected.count(addr.GetGroup()) || IsLocal(addr))\n+            if (!addr.IsValid() || IsLocal(addr)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r261713892",
      "id" : 261713892,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MTcxMzg5Mg==",
      "original_commit_id" : "f71fdda3bc2e7acd2a8b74e882364866b8b0f55b",
      "original_position" : 11,
      "path" : "src/net.cpp",
      "position" : 12,
      "pull_request_review_id" : 209719301,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486",
      "updated_at" : "2019-03-01T21:16:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/261713892",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r261724754"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/261724754"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Which line are you referring to with the statement about not adding the collision to `m_tried_collisions`?",
      "commit_id" : "20e6ea259b222b10f066f22695a5f56c52071f63",
      "created_at" : "2019-03-01T19:13:50Z",
      "diff_hunk" : "@@ -239,7 +239,9 @@ void CAddrMan::Good_(const CService& addr, bool test_before_evict, int64_t nTime\n \n     // Will moving this address into tried evict another entry?\n     if (test_before_evict && (vvTried[tried_bucket][tried_bucket_pos] != -1)) {\n-        LogPrint(BCLog::ADDRMAN, \"Collision inserting element into tried table, moving %s to m_tried_collisions=%d\\n\", addr.ToString(), m_tried_collisions.size());\n+        // Output the entry we'd be colliding with, for debugging purposes\n+        auto colliding_entry = mapInfo.find(vvTried[tried_bucket][tried_bucket_pos]);\n+        LogPrint(BCLog::ADDRMAN, \"Collision inserting element into tried table (%s), moving %s to m_tried_collisions=%d\\n\", colliding_entry != mapInfo.end() ? colliding_entry->second.ToString() : \"\", addr.ToString(), m_tried_collisions.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r261724754",
      "id" : 261724754,
      "in_reply_to_id" : 261707616,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MTcyNDc1NA==",
      "original_commit_id" : "f71fdda3bc2e7acd2a8b74e882364866b8b0f55b",
      "original_position" : 7,
      "path" : "src/addrman.cpp",
      "position" : 7,
      "pull_request_review_id" : 209741553,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486",
      "updated_at" : "2019-03-01T21:37:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/261724754",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "node_id" : "MDQ6VXNlcjI3NDgxNA==",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r261726038"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/261726038"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This new behavior does contradict \"when in doubt, don't evict\" but only minimally because we give the IP-to-be-tested 40 minutes to be tested. If something prevents us from connecting to the IP-to-be-tested in that 40 minute window something is probably wrong with the IP-to-be-tested.",
      "commit_id" : "20e6ea259b222b10f066f22695a5f56c52071f63",
      "created_at" : "2019-03-01T19:17:52Z",
      "diff_hunk" : "@@ -567,6 +569,13 @@ void CAddrMan::ResolveCollisions_()\n                         Good_(info_new, false, GetAdjustedTime());\n                         erase_collision = true;\n                     }\n+                } else if (GetAdjustedTime() - info_new.nLastSuccess > ADDRMAN_TEST_WINDOW) {\n+                    // If the collision hasn't resolved in some reasonable amount of time,\n+                    // just evict the old entry -- we must not be able to\n+                    // connect to it for some reason.\n+                    LogPrint(BCLog::ADDRMAN, \"Unable to test; swapping %s for %s in tried table anyway\\n\", info_new.ToString(), info_old.ToString());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r261726038",
      "id" : 261726038,
      "in_reply_to_id" : 261029373,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MTcyNjAzOA==",
      "original_commit_id" : "f71fdda3bc2e7acd2a8b74e882364866b8b0f55b",
      "original_position" : 19,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 209741553,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486",
      "updated_at" : "2019-03-01T21:37:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/261726038",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "node_id" : "MDQ6VXNlcjI3NDgxNA==",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r261756762"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/261756762"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The idea is that if we've been trying to test the old entry and can't for some reason, then something is probably wrong with that old entry, so we do want to do the replacement.",
      "commit_id" : "20e6ea259b222b10f066f22695a5f56c52071f63",
      "created_at" : "2019-03-01T21:02:02Z",
      "diff_hunk" : "@@ -567,6 +569,13 @@ void CAddrMan::ResolveCollisions_()\n                         Good_(info_new, false, GetAdjustedTime());\n                         erase_collision = true;\n                     }\n+                } else if (GetAdjustedTime() - info_new.nLastSuccess > ADDRMAN_TEST_WINDOW) {\n+                    // If the collision hasn't resolved in some reasonable amount of time,\n+                    // just evict the old entry -- we must not be able to\n+                    // connect to it for some reason.\n+                    LogPrint(BCLog::ADDRMAN, \"Unable to test; swapping %s for %s in tried table anyway\\n\", info_new.ToString(), info_old.ToString());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r261756762",
      "id" : 261756762,
      "in_reply_to_id" : 261029373,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MTc1Njc2Mg==",
      "original_commit_id" : "f71fdda3bc2e7acd2a8b74e882364866b8b0f55b",
      "original_position" : 19,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 209782940,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486",
      "updated_at" : "2019-03-01T21:16:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/261756762",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r261758663"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/261758663"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I can edit the language of the log message if this is confusing.",
      "commit_id" : "20e6ea259b222b10f066f22695a5f56c52071f63",
      "created_at" : "2019-03-01T21:09:24Z",
      "diff_hunk" : "@@ -567,6 +569,13 @@ void CAddrMan::ResolveCollisions_()\n                         Good_(info_new, false, GetAdjustedTime());\n                         erase_collision = true;\n                     }\n+                } else if (GetAdjustedTime() - info_new.nLastSuccess > ADDRMAN_TEST_WINDOW) {\n+                    // If the collision hasn't resolved in some reasonable amount of time,\n+                    // just evict the old entry -- we must not be able to\n+                    // connect to it for some reason.\n+                    LogPrint(BCLog::ADDRMAN, \"Unable to test; swapping %s for %s in tried table anyway\\n\", info_new.ToString(), info_old.ToString());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r261758663",
      "id" : 261758663,
      "in_reply_to_id" : 261029373,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MTc1ODY2Mw==",
      "original_commit_id" : "f71fdda3bc2e7acd2a8b74e882364866b8b0f55b",
      "original_position" : 19,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 209785448,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486",
      "updated_at" : "2019-03-01T21:16:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/261758663",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r261758676"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/261758676"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think it's quite as simple as \"when in doubt, don't evict\".  I think in the case of a collision we bias ourselves towards not evicting, unless the peer we might evict can't be connected to via feeler connection.\r\n\r\nMy thought is that if `m_tried_collisions` is ever full, it seems like that is a scenario where we may be under attack; so not replacing things in our tried table (which we assume to have some good peers in it) is safe, even if not optimal.  Maybe @EthanHeilman or @gmaxwell has a better intuition for how this works though.",
      "commit_id" : "20e6ea259b222b10f066f22695a5f56c52071f63",
      "created_at" : "2019-03-01T21:09:28Z",
      "diff_hunk" : "@@ -239,7 +239,9 @@ void CAddrMan::Good_(const CService& addr, bool test_before_evict, int64_t nTime\n \n     // Will moving this address into tried evict another entry?\n     if (test_before_evict && (vvTried[tried_bucket][tried_bucket_pos] != -1)) {\n-        LogPrint(BCLog::ADDRMAN, \"Collision inserting element into tried table, moving %s to m_tried_collisions=%d\\n\", addr.ToString(), m_tried_collisions.size());\n+        // Output the entry we'd be colliding with, for debugging purposes\n+        auto colliding_entry = mapInfo.find(vvTried[tried_bucket][tried_bucket_pos]);\n+        LogPrint(BCLog::ADDRMAN, \"Collision inserting element into tried table (%s), moving %s to m_tried_collisions=%d\\n\", colliding_entry != mapInfo.end() ? colliding_entry->second.ToString() : \"\", addr.ToString(), m_tried_collisions.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r261758676",
      "id" : 261758676,
      "in_reply_to_id" : 261707616,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MTc1ODY3Ng==",
      "original_commit_id" : "f71fdda3bc2e7acd2a8b74e882364866b8b0f55b",
      "original_position" : 7,
      "path" : "src/addrman.cpp",
      "position" : 7,
      "pull_request_review_id" : 209785462,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486",
      "updated_at" : "2019-03-01T21:16:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/261758676",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Addressed nits.",
      "created_at" : "2019-03-01T21:18:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15486#issuecomment-468814869",
      "id" : 468814869,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15486",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2ODgxNDg2OQ==",
      "updated_at" : "2019-03-01T21:18:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/468814869",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r261766151"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/261766151"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I agree with your intuition.\r\n\r\nWe bias toward not evicting. The assumption is that if the tried table is contains many evil IPs we have  already lost and won't hear about good IPs. Thus, we assume the tried has many good IPs and that they should not be evicted unless a particular IP in tried is offline and thus no longer provides security.",
      "commit_id" : "20e6ea259b222b10f066f22695a5f56c52071f63",
      "created_at" : "2019-03-01T21:37:29Z",
      "diff_hunk" : "@@ -239,7 +239,9 @@ void CAddrMan::Good_(const CService& addr, bool test_before_evict, int64_t nTime\n \n     // Will moving this address into tried evict another entry?\n     if (test_before_evict && (vvTried[tried_bucket][tried_bucket_pos] != -1)) {\n-        LogPrint(BCLog::ADDRMAN, \"Collision inserting element into tried table, moving %s to m_tried_collisions=%d\\n\", addr.ToString(), m_tried_collisions.size());\n+        // Output the entry we'd be colliding with, for debugging purposes\n+        auto colliding_entry = mapInfo.find(vvTried[tried_bucket][tried_bucket_pos]);\n+        LogPrint(BCLog::ADDRMAN, \"Collision inserting element into tried table (%s), moving %s to m_tried_collisions=%d\\n\", colliding_entry != mapInfo.end() ? colliding_entry->second.ToString() : \"\", addr.ToString(), m_tried_collisions.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15486#discussion_r261766151",
      "id" : 261766151,
      "in_reply_to_id" : 261707616,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MTc2NjE1MQ==",
      "original_commit_id" : "f71fdda3bc2e7acd2a8b74e882364866b8b0f55b",
      "original_position" : 7,
      "path" : "src/addrman.cpp",
      "position" : 7,
      "pull_request_review_id" : 209741553,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15486",
      "updated_at" : "2019-03-01T21:37:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/261766151",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "node_id" : "MDQ6VXNlcjI3NDgxNA==",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK",
      "created_at" : "2019-03-01T23:23:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15486#issuecomment-468845833",
      "id" : 468845833,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15486",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2ODg0NTgzMw==",
      "updated_at" : "2019-03-01T23:23:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/468845833",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "To clarify what I brought up inline:\r\nhttps://github.com/bitcoin/bitcoin/blob/20e6ea259b222b10f066f22695a5f56c52071f63/src/addrman.cpp#L240-L253\r\n\r\nThe log statement says we're moving it to `m_tried_collisions`, but that's not true if that's full. Hence my suggestion to move the log statement inside the if statement (line 245).\r\n\r\nFor the case `m_tried_collisions` is full @sdaftuar wrote:\r\n> I don't think it's quite as simple as \"when in doubt, don't evict\". I think in the case of a collision we bias ourselves towards not evicting, unless the peer we might evict can't be connected to via feeler connection.\r\n\r\n> My thought is that if m_tried_collisions is ever full, it seems like that is a scenario where we may be under attack; so not replacing things in our tried table (which we assume to have some good peers in it) is safe, even if not optimal. Maybe @EthanHeilman or @gmaxwell has a better intuition for how this works though. \r\n\r\nAnd @EthanHeilman replied:\r\n\r\n> I agree with your intuition.\r\n\r\n> We bias toward not evicting. The assumption is that if the tried table is contains many evil IPs we have already lost and won't hear about good IPs. Thus, we assume the tried has many good IPs and that they should not be evicted unless a particular IP in tried is offline and thus no longer provides security.\r\n\r\n\r\nBut a few lines down it seems we're doing the opposite, namely bias ourselves towards evicting:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/20e6ea259b222b10f066f22695a5f56c52071f63/src/addrman.cpp#L572-L579\r\n\r\nWe don't know anything about this new entry, because we couldn't connect, so it seems to me it would be more consistent to keep the old entry.\r\n\r\nIt's still much better than getting stuck of course, so utACK 20e6ea2.",
      "created_at" : "2019-03-02T10:48:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15486#issuecomment-468909429",
      "id" : 468909429,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15486",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2ODkwOTQyOQ==",
      "updated_at" : "2019-03-02T10:48:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/468909429",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> We don't know anything about this new entry,\r\n\r\nWhen we insert the new entry in tried in the first place, it's because we've actually tried it.  When inserting it we may find that it causes us to want to evict an old tried entry (which has also been tried, but not as recently).  What the code is supposed to do (post try before evict) is to test the old tried entry before evicting it, in order to give it a second chance to stay around iff its still connectible.\r\n",
      "created_at" : "2019-03-02T14:14:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15486#issuecomment-468924236",
      "id" : 468924236,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15486",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2ODkyNDIzNg==",
      "updated_at" : "2019-03-02T14:14:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/468924236",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Ah, I think I get it now... since we don't specifically track when things were added to `m_tried_collisions`,  the check `info_new.nLastSuccess > ADDRMAN_TEST_WINDOW`  is just the way we determine when the entry was added to the `new` table, which coincides with the time we last heard from it, i.e. when it last sent us a version message. And that's also when it's added to `m_tried_collisions`.\r\n\r\nIf we receive a version message:\r\nhttps://github.com/bitcoin/bitcoin/blob/20e6ea259b222b10f066f22695a5f56c52071f63/src/net_processing.cpp#L1765\r\n\r\nFrom an outbound node:\r\nhttps://github.com/bitcoin/bitcoin/blob/20e6ea259b222b10f066f22695a5f56c52071f63/src/net_processing.cpp#L1885\r\n\r\nThat's when we call `MarkAddressGood` in `net.cpp` which in turn calls `CAddrMan::Good_`, which adds it to `m_tried_collisions`.\r\n",
      "created_at" : "2019-03-02T14:55:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15486#issuecomment-468927608",
      "id" : 468927608,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15486",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2ODkyNzYwOA==",
      "updated_at" : "2019-03-02T14:58:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/468927608",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Ah, I think I get it now... since we don't specifically track when things were added to m_tried_collisions, the check info_new.nLastSuccess > ADDRMAN_TEST_WINDOW is just the way we determine when the entry was added to the new table\r\n\r\nThat's not necessarily when the entry was added to the `new` table -- we can do that when learning about an address, for instance when relayed to us via an addr message from another peer.  But otherwise I think your description is correct (in particular, that should be the time that we attempted to put it in the `tried` table but discovered the collision).",
      "created_at" : "2019-03-02T16:39:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15486#issuecomment-468936769",
      "id" : 468936769,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15486",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2ODkzNjc2OQ==",
      "updated_at" : "2019-03-02T16:39:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/468936769",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "utACK",
      "created_at" : "2019-03-04T20:25:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15486#issuecomment-469408312",
      "id" : 469408312,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15486",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2OTQwODMxMg==",
      "updated_at" : "2019-03-04T20:25:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/469408312",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think this is ready to go -- anything left that I missed?",
      "created_at" : "2019-03-06T21:45:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15486#issuecomment-470289925",
      "id" : 470289925,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15486",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3MDI4OTkyNQ==",
      "updated_at" : "2019-03-06T21:45:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/470289925",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 20e6ea259b222b10f066f22695a5f56c52071f63",
      "created_at" : "2019-03-09T06:12:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15486#issuecomment-471149918",
      "id" : 471149918,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15486",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3MTE0OTkxOA==",
      "updated_at" : "2019-03-09T06:12:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/471149918",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "~~Backported in #15563.~~\r\n\r\nDone by @laanwj in https://github.com/bitcoin/bitcoin/compare/f810f14cf61d...b80dedb59678b3b35a7808e3fc09cf0610170070.",
      "created_at" : "2019-03-09T07:07:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15486#issuecomment-471153160",
      "id" : 471153160,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15486",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3MTE1MzE2MA==",
      "updated_at" : "2019-03-09T07:17:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/471153160",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   }
]
