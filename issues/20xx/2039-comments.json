[
   {
      "body" : "Details of failure?  File changes?  debug.log entries?\r\n",
      "created_at" : "2012-11-26T21:47:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2039#issuecomment-10735433",
      "id" : 10735433,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2039",
      "updated_at" : "2012-11-26T21:47:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/10735433",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "bitcoind makes the (generally valid) assumption a that it can write anything in its data directory. Reindexing from read-only block files may be a useful feature in some cases, but I'm removing the bug label.",
      "created_at" : "2015-05-18T09:54:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2039#issuecomment-103000608",
      "id" : 103000608,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2039",
      "updated_at" : "2015-05-18T09:54:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/103000608",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I was just looking at this. The fix introduced by https://github.com/bitcoin/bitcoin/pull/24858 gets us very close to being able to allow read only blk files that are already finalized. This only makes sense with **finalized** block files as blk files that have logical space under the 128 MiB limit need to be writable for appending additional blocks. Even with the #24858 fix, `BlockManager::FlushBlockFile` still tries to open the finalized block file for writing. But, I don't think it would be very difficult to keep track in `BlockManager::FindBlockPos` via the `m_blockfile_info[nFile]` to know if the current blk file has been appended. We'd have to add another data member to track if any new blocks have been appended to the blockfile. If it hasn't been appended, then we could accept the blk flush failing as it was not changed, and the failure was caused by not being able to open it for writing.\r\n\r\nFor reference, I tested current master branch functionality and got the following while using only a single finalized blk00000.dat (fe4b764e0ce523cfce6d9e4f326e0d0977ee317a51b4a129cda707cfa4699dd7  blocks/blk00000.dat):\r\n```\r\nUnable to open file /tmp/btc/blocks/blk00000.dat\r\nERROR: Flush: failed to open file 0\r\n*** Flushing block file to disk failed. This is likely the result of an I/O error.\r\nError: A fatal internal error occurred, see debug.log for details\r\n```",
      "created_at" : "2022-04-18T11:31:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2039#issuecomment-1101330894",
      "id" : 1101330894,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2039",
      "node_id" : "IC_kwDOABII585BpPnO",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1101330894/reactions"
      },
      "updated_at" : "2022-04-18T11:31:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1101330894",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6440430?v=4",
         "events_url" : "https://api.github.com/users/mruddy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mruddy/followers",
         "following_url" : "https://api.github.com/users/mruddy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mruddy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mruddy",
         "id" : 6440430,
         "login" : "mruddy",
         "node_id" : "MDQ6VXNlcjY0NDA0MzA=",
         "organizations_url" : "https://api.github.com/users/mruddy/orgs",
         "received_events_url" : "https://api.github.com/users/mruddy/received_events",
         "repos_url" : "https://api.github.com/users/mruddy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mruddy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mruddy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mruddy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@luke-jr possible fix here, with tests: https://github.com/bitcoin/bitcoin/pull/27039",
      "created_at" : "2023-02-07T12:14:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/2039#issuecomment-1420677366",
      "id" : 1420677366,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2039",
      "node_id" : "IC_kwDOABII585UrdD2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1420677366/reactions"
      },
      "updated_at" : "2023-02-07T12:14:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1420677366",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   }
]
